import{f9 as Pe,fa as se,cD as _e,e$ as L,r as m,w as ze,bg as Ge,aV as j,P as K,dP as Ce,u as g,ae as N,j as ae,bC as W,af as ue,d3 as ve,d as re,fb as Ee,x as Te,a8 as V,R as we,e7 as be,e_ as Le,v as De,fc as Fe,el as ce,a as P,h as G,a3 as ne}from"./jzo1gvcwh9pppzs1.js";import{cy as le,cF as Y,dx as qe,fB as Re,fC as Ue,cJ as y,fD as He,bQ as Qe,c8 as b,a1 as u,fE as Ae,fd as xe,f9 as Ke,fF as Oe,fG as Ie}from"./beucmu6zcawzhvqq.js";import{T as F,G as Ne,b as ke}from"./wgqxthyy0ty9wjfc.js";import{b as oe}from"./n52qu0rpacsut12w.js";function Be({clientThreadId:e}){const t=F.getThreadCurrentLeafId(e),r=F.getTree(e).getMessage(t).metadata?.model_switcher_deny??[],n={};r.forEach(a=>{const{slug:i,context:c,reason:d,description:l}=a,f=n[i]??{},h=f[c]??[];h.push({reason:d,description:l}),f[c]=h,n[i]=f});const o=Pe();for(const{resets_after:a,model_slug:i}of o)[se.CONVERSATION,se.REGENERATE].forEach(c=>{const d=n[i]??{},l=d[c]??[],f={reason:_e.RATE_LIMIT,resetsAfter:a};l.push(f),d[c]=l,n[i]=d});return n}const mt="text-davinci-002-render-sha",ft="gpt-4",gt="gpt-4o",yt="o1-preview",ht="o1-mini",O=le({slug:Y,max_tokens:4097,title:"Default",description:"",tags:[L.GPT_3_5],product_features:{}}),$e=({default_model:e,tagline:t,color:s,human_category_name:r,category:n,human_category_short_name:o,human_category_shorter_name:a,subscription_level:i,short_explainer:c,subcategory:d,is_beta:l,...f})=>({color:s,tagline:t,defaultModel:e,label:r,shortLabel:o,description:c,shorterLabel:a??o,subscriptionLevel:i,categoryId:n,subcategory:d,isBeta:l,...f}),je=({icon:e,icon_filled_src:t,icon_outline_src:s})=>({iconName:e,iconFilledSrc:t,iconOutlineSrc:s}),We=({group:e,human_group_name:t,human_group_short_name:s,model_ids:r})=>({group:e,label:t,shortLabel:s,modelIds:r});function Ve(){return N({retry:5,queryKey:["modelIcons"],queryFn:async()=>await ae.getModelIcons().then(e=>Object.fromEntries(Object.entries(e).map(([t,s])=>[t,je(s)])))})}function Ye(e){return N({retry:5,queryKey:["models",{isHistoryDisabled:e}],queryFn:async()=>await ae.getModels(e).then(t=>{const{models:s,internal_groups:r,categories:n,default_model_slug:o}=t,a=s.map(le);return{categories:n.concat().reverse().map($e),groups:r?.map(We)??[],defaultModelSlug:o??null,modelsList:a,modelsMap:Object.fromEntries(a.map(i=>[i.id,i]))}})})}function C(){const e=Ce();return g(Ye(e))}function St(){return g(Ve())}function Ze({isRegen:e=!1}={}){const{isLoading:t,data:{categories:s=[],groups:r=[]}={}}=C(),n=m.useMemo(()=>e?s.filter(o=>o.is_regenerate_category!==!1):s.filter(o=>!o.is_regenerate_category),[s,e]);return{isLoading:t,categories:n,groups:r??[]}}function pt(){const{categories:e}=Ze();return!!e.find(({categoryId:t})=>t===qe.GPT4o)}function Mt(){const{data:e}=C();return m.useMemo(()=>e?new Set(Object.keys(e.modelsMap)):new Set([Y]),[e])}const Je={[Y]:O};function Xe(){const{data:e}=C();return e?.modelsMap??Je}function de(e,t,s){if(e?.defaultModelSlug&&e?.modelsMap[e.defaultModelSlug])return e.modelsMap[e.defaultModelSlug];let r=L.GPT_3_5;return s?r=L.GPT_4:t&&(r=L.GPT_4o),e?.modelsList.find(n=>n.tags.includes(r))??e?.modelsList[0]??O}function Pt(e=!1){const t=ze(),s=Ge(),[,r]=j();return m.useCallback(({location:n,modelId:o})=>{const a=t.pathname.includes("/g/");e||a?(K.logNewChatButtonClicked({location:n}),s({pathname:"/",search:`?model=${encodeURIComponent(o)}`})):(r(i=>(i.set("model",o),i)),K.logNewChatButtonClicked({location:n}))},[e,t,s,r])}function _t(){const{data:{categories:e=[]}={}}=C(),{doesUserHaveAnyAccountsWithPlusFeatures:t}=W();return t?null:e.find(Re)?.defaultModel??null}function et(e){return Ne(e)}function me(e){const t=et(e),s=Xe();return m.useMemo(()=>t==null?O:s[t]??O,[t,s])}function tt(e,t){return me(e).enabledTools?.includes(t)??!1}function zt(e){const t=Ue(),s=me(e),r=m.useMemo(()=>!t.isSuccess||!t.data?[]:t.data,[t.data,t.isSuccess]),n=Be({clientThreadId:e});return m.useMemo(()=>{const a=new Set(s.enabledTools||[]);return r.filter(i=>!(!(i.requiredFeatures.length===0||i.requiredFeatures.every(l=>a.has(l)))||!(i.requiredModels.length===0||i.requiredModels.some(l=>!n[l]))))},[r,s,n])}function Gt(){const{data:e}=C(),{doesUserHaveAnyAccountsWithPlusFeatures:t}=W(),s=ue();return de(e,!!t,!!s?.isEnterprisey())}const fe="hints";class I extends ve()(t=>({persistedSystemHints:new Set(t),persistedSystemHintTriggers:{}})){static getPersistedSystemHints=({persistedSystemHints:t})=>t;addPersistedSystemHint=(t,s,r)=>{t===y.Search&&K.logEventWithStatsig(re.searchModeEngaged,"search_mode_engaged",{...oe(s),triggerSource:r}),this.setState(({persistedSystemHints:n,persistedSystemHintTriggers:o})=>({persistedSystemHints:new Set(n).add(t),persistedSystemHintTriggers:{...o,[t]:r}}))};removePersistedSystemHint=(t,s)=>{t===y.Search&&K.logEventWithStatsig(re.searchModeDisabled,"search_mode_disabled",oe(s)),this.setState(({persistedSystemHints:r,persistedSystemHintTriggers:n})=>{const o=new Set(r);o.delete(t);const a={...n};return delete a[t],{persistedSystemHints:o,persistedSystemHintTriggers:a}})};getPersistedSystemHintTrigger=t=>{if(this.getState().persistedSystemHints.has(t))return this.getState().persistedSystemHintTriggers[t]};clearPersistedSystemHintTrigger=t=>{this.setState(({persistedSystemHints:s,persistedSystemHintTriggers:r})=>{const n={...r};return delete n[t],{persistedSystemHints:new Set(s),persistedSystemHintTriggers:n}})}}const Ct=()=>I.useState(I.getPersistedSystemHints);function vt({children:e,clientThreadId:t,currentLeafId:s}){const[r]=j(),n=r.get(fe)===y.Search,o=tt(t,Ee.Search),i=(F.getLastMessgageSystemHints(t,s).includes(y.Search)||n)&&o,[c]=m.useState(()=>new I(i?[y.Search]:[]));return m.useEffect(()=>{const d=c.getState().persistedSystemHints;i&&!d.has(y.Search)&&c?.addPersistedSystemHint(y.Search,{clientThreadId:t,turnIndex:0})},[i,c,t]),Te.jsx(I.Provider,{store:c,children:e})}function st(e){const t=new Set;if(e){const s=e.split(",");Array.isArray(s)&&s.forEach(r=>{Object.values(y).includes(r)&&t.add(r)})}return t}const x="q",$="m";function Et(e){const{clientThreadId:t,currentLeafId:s,handleRequestCompletion:r}=e,n=m.useRef(!1),{isLoading:o,data:a}=C(),{doesUserHaveAnyAccountsWithPlusFeatures:i,isLoading:c}=W(),d=ue(),[l,f]=j(),h=V(),q=m.useCallback((S,E,_,z)=>{F.updateTree(t,p=>{p.addNode(S,_,E,we.User,void 0,z)})},[t]),J=m.useCallback(async(S,{content:E,attachments:_},z,p,T,w)=>{const H=s,Q=_.length>0?{attachments:_}:{};Q.system_hints=p.systemHints,q(S,H,E,Q),r({type:be.Next,promptId:S,requestedModelId:w,eventMetadata:z,cancelActiveRequests:!0,completionMetadata:p,turnTracker:T})},[q,r,s]),R=Le(()=>window.location.pathname)??null,X=He();let ee=!o&&!c&&R!=null;const[U,v]=m.useState(!0);return m.useEffect(()=>{if(!U||n.current)return;const S=ke.getConversationMode(t);if(!ee||S==null)return;if(!nt(R)||rt(R)&&X===void 0||F.getServerThreadId(t)!=null){v(!1);return}const E=(()=>{try{return Object.fromEntries(new URLSearchParams(location.hash.slice(1)).entries())}catch{return{}}})(),_={...Object.fromEntries(l),...E},{[x]:z,[$]:p,[fe]:T}=_,w=(typeof z=="string"?z:null)??(typeof p=="string"?p:null);if(!w||!w.trim()){v(!1);return}const H=st(T),Q=De();n.current=!0;let k=a?.modelsList;H.has(y.Search)&&(k=k?.filter(A=>A.enabledTools?.includes(y.Search)));const te=a&&de({...a,modelsList:k??[]},!!i,!!d?.isEnterprisey());if(te==null){h.warning("No model available for this request"),v(!1);return}const Se=new Qe,pe=T?.includes(y.Search);(e.prefetchSearchPromise??Promise.resolve(null)).then(A=>{f(Me=>{const B=new URLSearchParams(Me);return B.delete(x),B.delete($),B}),J(Q,{content:w,attachments:[]},{eventSource:"url"},{conversationMode:S,source:"instant-query",systemHints:T?Array.from(H):void 0,prefetchIds:A!=null?[A]:void 0,searchSource:pe?Fe.URL_SEARCH_HINT:void 0},Se,te?.id),v(!1)})},[o,c,ee,R,a,i,d,J,U,t,X,h,e.prefetchSearchPromise,l,f]),U&&(e.prefetchSearchPromise!=null||l.has(x)||l.has($)?!0:(v(!1),!1))}function rt(e){return ge(e)}function ge(e){return e==null?!1:/^\/g\/[\w-]+$/.test(e)}function nt(e){return e==null?!1:e==="/"||ge(e)}const Tt="GPT Builder";function wt(e){if(e)return`ChatGPT - ${e}`}function Z(e){return e.gizmo.short_url??e.gizmo.id??"-"}function ye(e){return`/g/${e}`}function bt(e){return`https://chatgpt.com${ye(e)}`}function ot(e){return ye(Z(e))}function Lt(e,t){const s=new URLSearchParams;return t!=null&&s.set(x,t),Ae(new URL(`${ot(e)}?${s}`,"https://chatgpt.com"))}function Dt(e){return`/g/${Z(e)}`}function Ft(e){return xe(e)&&e.gizmo.live_version===0||Ke(e)&&e.liveVersion===0}function qt(e,t){return g({queryKey:["gizmos","discovery",{locale:e,isAnon:t}],queryFn:async()=>u.getGizmoDiscovery(e,t)})}function Rt({cutId:e,locale:t,limit:s,cursor:r,enabled:n=!0}){return ce({queryKey:["gizmos","discovery",{cutId:e,locale:t,limit:s}],queryFn:async({pageParam:o})=>u.getGizmoDiscoveryCut(e,{locale:t,cursor:o,limit:s}),initialPageParam:r,getNextPageParam:o=>o.list.cursor??void 0,enabled:n})}function Ut(){return g({queryKey:["gizmos","pinned"],queryFn:async()=>u.getGizmoPinned()})}function D(){return N({queryKey:["gizmos","bootstrap"],queryFn:async()=>u.getGizmoBootstrap().then(e=>({gizmos:e.gizmos.map(t=>({resource:t.resource,flair:t.flair}))}))})}function Ht(){return g(D())}function ie(e,t){const s=e.filter(n=>n.resource.gizmo.id!==t.resource.gizmo.id);let r=s.findIndex(n=>n.flair.kind===b.Recent);return r===-1&&(r=s.length),s.splice(r,0,t),s}const Qt={handleGizmoInteracted(e,t){const s=e.getQueryData(M(e,t).queryKey);s!=null&&e.setQueryData(D().queryKey,r=>{if(r==null)return r;const n=r.gizmos.find(o=>o.resource.gizmo.id===t);return n?.flair.kind===b.FirstParty||n?.flair.kind===b.SidebarKeep?r:{gizmos:ie(r.gizmos,{resource:s,flair:{kind:b.Recent}})}})},handleGizmoSidebarKeep(e,t){const s=e.getQueryData(M(e,t).queryKey);s!=null&&e.setQueryData(D().queryKey,r=>r==null?r:{gizmos:ie(r.gizmos,{resource:s,flair:{kind:b.SidebarKeep}})})},handleGizmoSidebarHide(e,t){e.setQueryData(D().queryKey,s=>s?.gizmos.some(r=>r.resource.gizmo.id===t)?{gizmos:s.gizmos.filter(r=>r.resource.gizmo.id!==t)}:s)}};function At(e,t=!1){const s=P();return g(M(s,e,t))}function xt({gizmoId:e,draft:t,version:s}){const r=P(),n=s?{queryKey:["gizmo","version",{gizmoId:e,version:s}],queryFn:async()=>u.getVersion({gizmoId:e,version:s}),enabled:e!=null}:M(r,e,t);return g(n)}function Kt(e,t){return g({queryKey:["gizmo","userActionSettings",{gizmoId:e}],queryFn:async()=>u.getUserActionSettings(e),enabled:e!=null&&t})}function M(e,t,s=!1){return N({queryKey:["gizmo",{gizmoId:t},{draft:s}],queryFn:async()=>u.getGizmo(t,s),enabled:t!=null,initialData:()=>{if(s===!0)return;const r=e.getQueryData(D().queryKey);if(r!=null)return r.gizmos.find(o=>o.resource.gizmo.id===t)?.resource;const n=e.getQueryData(["gizmos","discovery"]);if(n!=null)for(const o of n.cuts){const a=o.list.items.find(i=>i.resource.gizmo.id===t)?.resource;if(a!=null)return a}}})}function Ot(e,t){return e.fetchQuery(M(e,t))}function It(e){return g({queryKey:["gizmo",{search:e}],queryFn:async()=>u.getGizmoSearch(e),enabled:e.length>0})}function Nt(e,t){return g({queryKey:["gizmo-search-workspace",{search:e}],queryFn:async()=>u.getGizmoSearchForWorkspace(e),enabled:e.length>0&&t})}function kt(e,t=!1,s=!1,r=null){return ce({queryKey:[s?"gizmo-search-workspace":"gizmo",{query:e,cursor:r}],queryFn:async({pageParam:n})=>s?u.getGizmoSearchForWorkspace(e,r=n):u.getGizmoSearch(e,r=n),initialPageParam:r,getNextPageParam:n=>n.cursor??void 0,enabled:t})}function Bt(){const e=P();return G({mutationFn:async({gizmoId:t,editorData:s})=>{const{instructions:r,name:n,description:o,profilePictureId:a,profilePictureUrl:i,promptStarters:c,tools:d,files:l,trainingDisabled:f}=s,h={instructions:r,display:{name:n,description:o,profile_pic_id:a,profile_picture_url:i,prompt_starters:c},tools:d,files:l.map(q=>({...q,location:Oe.FILE_SERVICE})),training_disabled:f};return u.upsertDraft(h,t)},onSettled:t=>{t&&(e.setQueryData(M(e,t.gizmo.id,!0).queryKey,t),e.invalidateQueries({queryKey:["gizmos","mine"],refetchType:"none"}))}})}function $t(){const e=P();return G({mutationFn:async({gizmoId:t,data:s})=>{const{sharingRecipient:r,categories:n}=s,o=await u.promoteDraft({sharing:s.sharingSubjects&&s.sharingSubjects.length>0?s.sharingSubjects:{recipient:r},categories:n},t);if(o.error)throw new Ie(o);return o.resource},onSettled:t=>{e.invalidateQueries({queryKey:["gizmos"],refetchType:"all"}),e.invalidateQueries({queryKey:["gizmos","pinned"],refetchType:"none"}),t&&e.setQueryData(M(e,t.gizmo.id,!1).queryKey,t)}})}function jt(){const e=P();return G({mutationFn:async({gizmoId:t})=>u.deleteGizmo(t),onSettled:()=>{e.invalidateQueries({queryKey:["gizmos"],refetchType:"all"})}})}function Wt(){const e=P(),t=V();return G({mutationFn:async({name:s,hideName:r,websiteUrl:n,willReceiveSupportEmails:o})=>u.updateBuilderProfile({name:s,hide_name:r,website_url:n,will_receive_support_emails:o}),onSuccess:s=>{e.setQueryData(["builderProfile"],s)},onError:s=>{t.warning(s.message)}})}function Vt(){return g({queryKey:["builderProfile"],queryFn:async()=>u.getBuilderProfile()})}function Yt(){return G({mutationFn:async({gizmoId:e})=>u.copyGizmo({gizmoId:e})})}function Zt(){return g({queryKey:["gizmoCategories"],queryFn:async()=>u.getCategories()})}function Jt(e,t){return!!(t!=null&&[ne.PrimaryAssistant,ne.GizmoInteraction].includes(t)&&e?.includes(L.GPT_4))}function Xt(e,t){const s=P(),r=V();return G({mutationFn:async({rating:n,message:o,includeFrom:a})=>{await u.upsertUserReview(e,n,o,a)},onSuccess:async()=>{s.invalidateQueries({queryKey:["gizmo","review",{gizmoId:e}]})},onError:n=>{r.danger(n.message)}})}function es(e,t){return t?`/g/${Z(t)}/c/${e}`:`/c/${e}`}function ts(){return"/gpts"}function ss(){return"/gpts/mine"}function he(e){return e?`/gpts/editor/${e}`:"/gpts/editor"}function rs(e){const t=it();return e==null?t:he(e)}function it(e){return he(e)}function ns(e){try{const t=new URL(e);return t.hostname=t.hostname.replace(/^(www\.|web\.|mbasic\.|mobile\.)(secure\.)?/,""),t.pathname="",[...t.searchParams.keys()].forEach(s=>t.searchParams.delete(s)),t.toString()}catch{return e}}function at(e){if(!e)return null;try{return new URL(e).hostname}catch{return null}}function os(e){const t=at(e);return t?t.replace(/^www\./,""):e}export{Jt as $,Yt as A,ns as B,Et as C,Kt as D,rs as E,me as F,Qt as G,Gt as H,et as I,Xe as J,vt as K,Ct as L,tt as M,ss as N,Vt as O,I as P,Wt as Q,Zt as R,xt as S,C as T,ft as U,Bt as V,$t as W,M as X,Ot as Y,Mt as Z,zt as _,At as a,Tt as a0,yt as a1,ht as a2,St as a3,Be as a4,_t as a5,mt as a6,pt as b,ot as c,Xt as d,jt as e,Dt as f,es as g,It as h,Nt as i,Rt as j,kt as k,qt as l,ts as m,he as n,os as o,Ht as p,ye as q,wt as r,Ft as s,it as t,Pt as u,Ze as v,gt as w,Ut as x,bt as y,Lt as z};
//# sourceMappingURL=otrvvqtzgopvxe2m.js.map
