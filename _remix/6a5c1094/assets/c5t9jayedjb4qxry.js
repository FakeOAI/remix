import{f6 as ce,f7 as W,bD as le,f8 as T,r as m,dp as de,ay as fe,f9 as ye,P as $,d9 as me,u as f,au as K,R as Z,e4 as U,aq as J,X as ge,b3 as x,cR as pe,e8 as he,bv as Me,ag as _e,d8 as X,E as z,F as C,bM as j}from"./byjsl6fmrkvfkikz.js";import{c8 as ee,Z as N,bI as ze,dG as Se,dH as Ge,dI as Pe,dJ as Ce,dK as V,bT as qe,dL as ve,dM as E,aN as a,dN as Fe,dO as Ee,dP as Te,dQ as Le,dR as Re}from"./haljegjt87cup22y.js";import{T as w,s as be,f as De}from"./k9y60274mtouqpk6.js";function Qe({clientThreadId:e}){var i;const t=w.getThreadCurrentLeafId(e),s=((i=w.getTree(e).getMessage(t).metadata)==null?void 0:i.model_switcher_deny)??[],n={};s.forEach(u=>{const{slug:d,context:c,reason:l,description:y}=u,g=n[d]??{},v=g[c]??[];v.push({reason:l,description:y}),g[c]=v,n[d]=g});const o=ce();for(const{resets_after:u,model_slug:d}of o)[W.CONVERSATION,W.REGENERATE].forEach(c=>{const l=n[d]??{},y=l[c]??[],g={reason:le.RATE_LIMIT,resetsAfter:u};y.push(g),l[c]=y,n[d]=l});return n}const Ze="text-davinci-002-render-sha",Je="gpt-4",Xe="gpt-4o",et="o1-preview",tt="o1-mini",A=ee({slug:N,max_tokens:4097,title:"Default",description:"",tags:[T.GPT_3_5],product_features:{}}),we=({default_model:e,tagline:t,color:r,human_category_name:s,category:n,human_category_short_name:o,human_category_shorter_name:i,subscription_level:u,short_explainer:d,subcategory:c,is_beta:l,...y})=>({color:r,tagline:t,defaultModel:e,label:s,shortLabel:o,description:d,shorterLabel:i??o,subscriptionLevel:u,categoryId:n,subcategory:c,isBeta:l,...y}),Ae=({icon:e,icon_filled_src:t,icon_outline_src:r})=>({iconName:e,iconFilledSrc:t,iconOutlineSrc:r}),Ke=({group:e,human_group_name:t,human_group_short_name:r,model_ids:s})=>({group:e,label:t,shortLabel:r,modelIds:s});function Ie(){return K({retry:5,queryKey:["modelIcons"],queryFn:async()=>await Z.getModelIcons().then(e=>Object.fromEntries(Object.entries(e).map(([t,r])=>[t,Ae(r)])))})}function Oe(e){return K({retry:5,queryKey:["models",{isHistoryDisabled:e}],queryFn:async()=>await Z.getModels(e).then(t=>{const{models:r,internal_groups:s,categories:n}=t,o=r.map(ee);return{categories:n.concat().reverse().map(we),groups:(s==null?void 0:s.map(Ke))??[],modelsList:o,modelsMap:Object.fromEntries(o.map(i=>[i.id,i]))}})})}function q(){const e=me();return f(Oe(e))}function rt(){return f(Ie())}function Ue({isRegen:e=!1}={}){const{isLoading:t,data:{categories:r=[],groups:s=[]}={}}=q(),n=m.useMemo(()=>e?r.filter(o=>o.is_regenerate_category!==!1):r.filter(o=>!o.is_regenerate_category),[r,e]);return{isLoading:t,categories:n,groups:s??[]}}function st(){const{categories:e}=Ue();return!!e.find(({categoryId:t})=>t===ze.GPT4o)}function nt(){const{data:e}=q();return m.useMemo(()=>e?new Set(Object.keys(e.modelsMap)):new Set([N]),[e])}const xe={[N]:A};function Ne(){const{data:e}=q();return(e==null?void 0:e.modelsMap)??xe}function te(e,t,r){let s=T.GPT_3_5;return r?s=T.GPT_4:t&&(s=T.GPT_4o),(e==null?void 0:e.modelsList.find(n=>n.tags.includes(s)))??(e==null?void 0:e.modelsList[0])??A}function ot(e=!1){const t=de(),r=fe(),[,s]=ye();return m.useCallback(({location:n,modelId:o})=>{const i=t.pathname.includes("/g/");e||i?($.logNewChatButtonClicked({location:n}),r({pathname:"/",search:`?model=${encodeURIComponent(o)}`})):(s(u=>(u.set("model",encodeURIComponent(o)),u)),$.logNewChatButtonClicked({location:n}))},[e,t,r,s])}function it(){const{data:{categories:e=[]}={}}=q(),{doesUserHaveAnyAccountsWithPlusFeatures:t}=U();if(t)return null;const r=e.find(Se);return(r==null?void 0:r.defaultModel)??null}function He(e){return be(e)}function re(e){const t=He(e),r=Ne();return m.useMemo(()=>t==null?A:r[t]??A,[t,r])}function ut(e,t){var s;return((s=re(e).enabledTools)==null?void 0:s.includes(t))??!1}function at(e){const t=Ge(),r=re(e),s=m.useMemo(()=>!t.isSuccess||!t.data?[]:t.data,[t.data,t.isSuccess]),n=Qe({clientThreadId:e});return m.useMemo(()=>{const i=new Set(r.enabledTools||[]);return s.filter(u=>!(!(u.requiredFeatures.length===0||u.requiredFeatures.every(l=>i.has(l)))||!(u.requiredModels.length===0||u.requiredModels.some(l=>!n[l]))))},[s,r,n])}function ct(e){return decodeURIComponent(e.model??"")||null}function lt(){const{data:e}=q(),{doesUserHaveAnyAccountsWithPlusFeatures:t}=U(),r=J();return te(e,!!t,!!(r!=null&&r.isEnterprise()))}const se="q",ke="m";function dt(e){const{clientThreadId:t,currentLeafId:r,handleRequestCompletion:s}=e,n=m.useRef(!1),{isLoading:o,data:i}=q(),{doesUserHaveAnyAccountsWithPlusFeatures:u,isLoading:d}=U(),c=J(),l=ge(),y=x(),g=m.useCallback((h,S,M,G)=>{w.updateTree(t,P=>{P.addNode(h,M,S,pe.User,void 0,G)})},[t]),v=m.useCallback(async(h,{content:S,attachments:M},G,P,F,D)=>{const O=r,p=M.length>0?{attachments:M}:{};p.system_hints=P.systemHints,g(h,O,S,p),s({type:he.Next,promptId:h,requestedModelId:D,eventMetadata:G,cancelActiveRequests:!0,completionMetadata:P,turnTracker:F})},[g,s,r]),R=Me(()=>window.location.pathname)??null,H=Pe();let k=!o&&!d&&R!=null;const[I,b]=m.useState(!0);return m.useEffect(()=>{if(!I||n.current)return;const h=De.getConversationMode(t);if(!k||h==null)return;if(!We(R)||Be(R)&&H===void 0||w.getServerThreadId(t)!=null){b(!1);return}const{[se]:S,[ke]:M,[ve]:G,...P}=l.query,F=(typeof S=="string"?S:null)??(typeof M=="string"?M:null);if(!F||!F.trim()){b(!1);return}const D=Ce(G),O=_e();n.current=!0;let p=i==null?void 0:i.modelsList;D.has(V.Search)&&(p=p==null?void 0:p.filter(ae=>{var B;return(B=ae.enabledTools)==null?void 0:B.includes(V.Search)}));const Q=i&&te({...i,modelsList:p??[]},!!u,!!(c!=null&&c.isEnterprise()));if(l.replace({query:P},void 0,{shallow:!0}),Q==null){y.warning("No model available for this request"),b(!1);return}const ue=new qe;v(O,{content:F,attachments:[]},{eventSource:"url"},{conversationMode:h,source:"instant-query",systemHints:G?Array.from(D):void 0},ue,Q==null?void 0:Q.id),b(!1)},[o,d,k,R,l,i,u,c,v,I,t,H,y]),I}function Be(e){return ne(e)}function ne(e){return e==null?!1:/^\/g\/[\w-]+$/.test(e)}function We(e){return e==null?!1:e==="/"||ne(e)}const ft="GPT Builder";function yt(e){if(e)return`ChatGPT - ${e}`}function oe(e){return e.gizmo.short_url??e.gizmo.id??"-"}function ie(e){return`/g/${e}`}function mt(e){return`https://chatgpt.com${ie(e)}`}function $e(e){return ie(oe(e))}function gt(e,t){const r=new URLSearchParams;return t!=null&&r.set(se,t),Fe(new URL(`${$e(e)}?${r}`,"https://chatgpt.com"))}function pt(e){return`/g/${oe(e)}`}function ht(e){return Ee(e)&&e.gizmo.live_version===0||Te(e)&&e.liveVersion===0}function Mt(e,t){return f({queryKey:["gizmos","discovery",{locale:e,isAnon:t}],queryFn:async()=>a.getGizmoDiscovery(e,t)})}function _t({cutId:e,locale:t,limit:r,cursor:s,enabled:n=!0}){return X({queryKey:["gizmos","discovery",{cutId:e,locale:t,limit:r}],queryFn:async({pageParam:o})=>a.getGizmoDiscoveryCut(e,{locale:t,cursor:o,limit:r}),initialPageParam:s,getNextPageParam:o=>o.list.cursor??void 0,enabled:n})}function zt(){return f({queryKey:["gizmos","pinned"],queryFn:async()=>a.getGizmoPinned()})}function L(){return K({queryKey:["gizmos","bootstrap"],queryFn:async()=>a.getGizmoBootstrap().then(e=>({gizmos:e.gizmos.map(t=>({resource:t.resource,flair:t.flair}))}))})}function St(){return f(L())}function Y(e,t){const r=e.filter(n=>n.resource.gizmo.id!==t.resource.gizmo.id);let s=r.findIndex(n=>n.flair.kind===E.Recent);return s===-1&&(s=r.length),r.splice(s,0,t),r}const Gt={handleGizmoInteracted(e,t){const r=e.getQueryData(_(e,t).queryKey);r!=null&&e.setQueryData(L().queryKey,s=>{if(s==null)return s;const n=s.gizmos.find(o=>o.resource.gizmo.id===t);return(n==null?void 0:n.flair.kind)===E.FirstParty||(n==null?void 0:n.flair.kind)===E.SidebarKeep?s:{gizmos:Y(s.gizmos,{resource:r,flair:{kind:E.Recent}})}})},handleGizmoSidebarKeep(e,t){const r=e.getQueryData(_(e,t).queryKey);r!=null&&e.setQueryData(L().queryKey,s=>s==null?s:{gizmos:Y(s.gizmos,{resource:r,flair:{kind:E.SidebarKeep}})})},handleGizmoSidebarHide(e,t){e.setQueryData(L().queryKey,r=>r!=null&&r.gizmos.some(s=>s.resource.gizmo.id===t)?{gizmos:r.gizmos.filter(s=>s.resource.gizmo.id!==t)}:r)}};function Pt(e,t=!1){const r=z();return f(_(r,e,t))}function Ct({gizmoId:e,draft:t,version:r}){const s=z(),n=r?{queryKey:["gizmo","version",{gizmoId:e,version:r}],queryFn:async()=>a.getVersion({gizmoId:e,version:r}),enabled:e!=null}:_(s,e,t);return f(n)}function qt(e,t){return f({queryKey:["gizmo","userActionSettings",{gizmoId:e}],queryFn:async()=>a.getUserActionSettings(e),enabled:e!=null&&t})}function _(e,t,r=!1){return K({queryKey:["gizmo",{gizmoId:t},{draft:r}],queryFn:async()=>a.getGizmo(t,r),enabled:t!=null,initialData:()=>{var o,i;if(r===!0)return;const s=e.getQueryData(L().queryKey);if(s!=null)return(o=s.gizmos.find(u=>u.resource.gizmo.id===t))==null?void 0:o.resource;const n=e.getQueryData(["gizmos","discovery"]);if(n!=null)for(const u of n.cuts){const d=(i=u.list.items.find(c=>c.resource.gizmo.id===t))==null?void 0:i.resource;if(d!=null)return d}}})}function vt(e,t){return e.fetchQuery(_(e,t))}function Ft(e){return f({queryKey:["gizmo",{search:e}],queryFn:async()=>a.getGizmoSearch(e),enabled:e.length>0})}function Et(e,t){return f({queryKey:["gizmo-search-workspace",{search:e}],queryFn:async()=>a.getGizmoSearchForWorkspace(e),enabled:e.length>0&&t})}function Tt(e,t=!1,r=!1,s=null){return X({queryKey:[r?"gizmo-search-workspace":"gizmo",{query:e,cursor:s}],queryFn:async({pageParam:n})=>r?a.getGizmoSearchForWorkspace(e,s=n):a.getGizmoSearch(e,s=n),initialPageParam:s,getNextPageParam:n=>n.cursor??void 0,enabled:t})}function Lt(){const e=z();return C({mutationFn:async({gizmoId:t,editorData:r})=>{const{instructions:s,name:n,description:o,profilePictureId:i,profilePictureUrl:u,promptStarters:d,tools:c,files:l,trainingDisabled:y}=r;return a.upsertDraft({instructions:s,display:{name:n,description:o,profile_pic_id:i,profile_picture_url:u,prompt_starters:d},tools:c,files:l.map(g=>({...g,location:Le.FILE_SERVICE})),training_disabled:y},t)},onSettled:t=>{t&&(e.setQueryData(_(e,t.gizmo.id,!0).queryKey,t),e.invalidateQueries({queryKey:["gizmos","mine"],refetchType:"none"}))}})}function Rt(){const e=z();return C({mutationFn:async({gizmoId:t,data:r})=>{const{sharingRecipient:s,categories:n}=r,o=await a.promoteDraft({sharing:r.sharingSubjects&&r.sharingSubjects.length>0?r.sharingSubjects:{recipient:s},categories:n},t);if(o.error)throw new Re(o);return o.resource},onSettled:t=>{e.invalidateQueries({queryKey:["gizmos"],refetchType:"all"}),e.invalidateQueries({queryKey:["gizmos","pinned"],refetchType:"none"}),t&&e.setQueryData(_(e,t.gizmo.id,!1).queryKey,t)}})}function bt(){const e=z();return C({mutationFn:async({gizmoId:t})=>a.deleteGizmo(t),onSettled:()=>{e.invalidateQueries({queryKey:["gizmos"],refetchType:"all"})}})}function Dt(){const e=z(),t=x();return C({mutationFn:async({name:r,hideName:s,websiteUrl:n,willReceiveSupportEmails:o})=>a.updateBuilderProfile({name:r,hide_name:s,website_url:n,will_receive_support_emails:o}),onSuccess:r=>{e.setQueryData(["builderProfile"],r)},onError:r=>{t.warning(r.message)}})}function Qt(){return f({queryKey:["builderProfile"],queryFn:async()=>a.getBuilderProfile()})}function wt(){return C({mutationFn:async({gizmoId:e})=>a.copyGizmo({gizmoId:e})})}function At(){return f({queryKey:["gizmoCategories"],queryFn:async()=>a.getCategories()})}function Kt(e,t){return!!(t!=null&&[j.PrimaryAssistant,j.GizmoInteraction].includes(t)&&(e!=null&&e.includes(T.GPT_4)))}function It(e,t){const r=z(),s=x();return C({mutationFn:async({rating:n,message:o,includeFrom:i})=>{await a.upsertUserReview(e,n,o,i)},onSuccess:async()=>{r.invalidateQueries({queryKey:["gizmo","review",{gizmoId:e}]})},onError:n=>{s.danger(n.message)}})}export{Et as A,Tt as B,Mt as C,vt as D,Qt as E,Dt as F,Xe as G,At as H,Ct as I,q as J,Je as K,Lt as L,Rt as M,_ as N,rt as O,Qe as P,ut as Q,at as R,Ne as S,Kt as T,ft as U,et as V,tt as W,it as X,Ze as Y,dt as Z,He as a,ot as b,Pt as c,st as d,ie as e,It as f,$e as g,bt as h,pt as i,ht as j,lt as k,St as l,Gt as m,_t as n,zt as o,yt as p,mt as q,gt as r,oe as s,wt as t,Ue as u,qt as v,nt as w,ct as x,re as y,Ft as z};
//# sourceMappingURL=c5t9jayedjb4qxry.js.map
