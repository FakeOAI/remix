import{r as o,a1 as V,j as e,aJ as T,K as q,P as N,y as S,c as x,u as J,ap as Q,br as $,I as f}from"./nkav6u5sgjh9k32o.js";import{c as _,T as Y,d as L,a as Z,C as ee,b as te,F as ae,g as se}from"./na8cqrsd81y9fsxv.js";import{F as re,P as ne,b3 as H,b4 as O,aL as oe,aM as R,b5 as ie,b6 as le}from"./nk3ns16telurqv2s.js";import{d as ce}from"./n1qrfihyqo1d937u.js";import{S as C}from"./smd1nut9r0oa3cgd.js";import{cA as B,bD as I,cB as de,j as E,cC as z,A as me,bC as F}from"./fvuv8t2jnmmokuz9.js";import{C as W}from"./evdzombk82q3qygv.js";import{l as ue,p as xe,m as fe,o as pe,X as he}from"./m5lg5n98cj0obuc4.js";import{m as M}from"./modnlcjxa99o7fdj.js";import"./ln063wei5z3h4x09.js";import"./d1p1ukq1ad0lpjuk.js";import"./fz1kd7qtrga6ohek.js";import"./dha2x2fzb3q3x33r.js";import"./nkdpb84sj0t5lqnq.js";import"./nn9qoplyb7jz0hlz.js";import"./njh27zrodvyq73sa.js";import"./cwuhomq0i0r45ouk.js";import"./h09g8hg5w2r23p7n.js";import"./tz0vzalk94czn40w.js";import"./van4l4xc9kuswyp4.js";import"./c1dp657f8l24ezf5.js";import"./jtk42zoopw7aysx6.js";import"./l89whj9rc1rrsavy.js";import"./dknq3w19d1xohuce.js";import"./bjtnyg2vr856qrgu.js";import"./i4v7yy58lrb4jmds.js";import"./igs79b6j25fqrrxx.js";import"./ebzifnge6vgrd3cf.js";function ge(t){const a=o.useRef(!1);return()=>{a.current||(t(),a.current=!0)}}const G=300,je=350;function et({visualization:t,clientThreadId:a,expanded:n=!1}){return t.type==="chart"?t.fallback_image==null?(V.addError("Chart visualizations require a fallback image message"),null):t.fallback_to_image?t.fallback_image==null?(V.addError("No fallback image message provided for fallback chart"),null):e.jsx(ke,{visualization:t,expanded:n}):e.jsx(Ce,{visualization:t,clientThreadId:a,expanded:n}):t.type==="table"?e.jsx(be,{visualization:t,expanded:n}):(V.addError("Unsupported visualization type",t.type),null)}function be({visualization:t,expanded:a}){const n=B(),c=n&&!a,{isLoading:r,data:s,isError:u}=ue(t),[p,l]=o.useState(),g=o.useCallback(()=>{s&&_(s.download_url)},[s]),[b,h]=o.useState(0),[y,k]=o.useState(0),j=o.useRef(null);let d;s&&(Array.isArray(s.content)?d=s.content.find(i=>i.name===p)??s.content[0]:d=s.content);const m=()=>{j.current&&k(j.current.offsetWidth)};return o.useEffect(()=>(m(),window.addEventListener("resize",m),()=>window.removeEventListener("resize",m)),[]),o.useEffect(()=>{const i=()=>{const v=window.innerHeight-48;h(v)};return i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]),u?e.jsx(P,{fileName:t.title}):e.jsx(D,{ref:j,focusObject:{type:I.ADAVisualization,visualization:t},title:e.jsxs(e.Fragment,{children:[t.title,!c&&Array.isArray(s==null?void 0:s.content)&&e.jsxs(C.Root,{defaultValue:p,onValueChange:i=>{l(i)},children:[e.jsxs(C.Trigger,{className:"m-0 h-4 bg-transparent p-1 text-xs font-semibold",children:[p??s.content[0].name,e.jsx(C.Icon,{})]}),e.jsx(C.Portal,{children:e.jsx(C.Content,{children:s.content.map(i=>e.jsx(C.Item,{className:"text-xs font-semibold",value:i.name??"",children:i.name},i.name))})})]})]}),onDownload:g,expanded:a,children:r||d==null?e.jsx("div",{className:"flex w-full items-center justify-center",children:e.jsx(T,{})}):e.jsx("div",{className:"border-t border-token-border-light",children:e.jsx(Y,{table:{...d,name:t.title,sheetName:p},height:a?b:G,width:y,isInFocusedView:n})})})}function ye({showStatic:t,setShowStatic:a}){return e.jsx(E,{side:"top",sideOffset:4,label:t?e.jsx(f,{id:"o0thnT",defaultMessage:"Switch to interactive chart"}):e.jsx(f,{id:"cigiQO",defaultMessage:"Switch to static chart"}),children:e.jsx("button",{className:"flex",onClick:()=>{a(!t)},children:t?e.jsx(oe,{className:"icon-md text-token-text-tertiary hover:text-token-text-primary"}):e.jsx(R,{className:"icon-md text-token-text-tertiary hover:text-token-text-primary"})})})}function ve({type:t}){return e.jsx(we,{children:t==="chart"?e.jsxs(e.Fragment,{children:[e.jsx(f,{id:"XBhWwK",defaultMessage:"Now interactive! (Beta)"})," ",e.jsx(R,{className:"icon-md"})]}):e.jsx(f,{id:"N0TMRs",defaultMessage:"Now interactive!"})})}const we=q.div`flex flex-shrink-0 cursor-pointer flex-nowrap items-center gap-1 rounded-lg bg-blue-selection/[0.1] py-1 pl-2 pr-1.5 text-xs font-semibold text-blue-selection`;function Ce({visualization:t,clientThreadId:a,expanded:n}){const{isLoading:c,data:r,isError:s}=xe(t),u=o.useRef(null),p=fe(),[l,g]=o.useState(!p),b=o.useCallback(async()=>{if(l&&t.fallback_image)N.logEvent(S.adaDownloadedStaticChart),await L(t.fallback_image);else if(u.current){const m=u.current.getBase64Image();m&&(N.logEvent(S.adaDownloadedInteractiveChart),_(m,`${t.title}.png`))}},[t.fallback_image,l,u,t.title]),[h,y]=o.useState(void 0),k=ce(a),j=ge(()=>{N.logEvent(S.adaToggledInteractiveChart,{conversationId:k})}),d=m=>{j(),g(m)};return o.useEffect(()=>{N.logEvent(S.adaInteractiveChartShown)},[]),o.useEffect(()=>{if(r&&r.content!==h){const{chart_type:m,datasets:i,labels:w}=r.content,v=r.content;v.datasets=i.map((A,K)=>{const X=Z(m,A,K);return{...A,colors:X}}),v.labels=Array.isArray(w)?w:[w],y(v)}},[h,r]),s?e.jsx(P,{fileName:t.title}):e.jsx(D,{focusObject:{type:I.ADAVisualization,visualization:t},title:t.title,onDownload:b,additionalActions:[e.jsx(ye,{showStatic:l,setShowStatic:d},0),e.jsx(ee,{chartData:h,setChartData:y},1)],expanded:n,children:c||h==null?e.jsx("div",{className:"flex w-full items-center justify-center",children:e.jsx(T,{})}):l&&t.fallback_image?e.jsx(W,{jupyterMessage:t.fallback_image}):e.jsx(te,{ref:u,chart:h})})}function ke({visualization:t,expanded:a}){const[n,c]=o.useState(!1),r=pe(),s=o.useCallback(async()=>{t.fallback_image&&await L(t.fallback_image)},[t.fallback_image]);return t.fallback_image==null?null:e.jsx(D,{focusObject:{type:I.ADAVisualization,visualization:t},title:t.title,onDownload:s,expanded:a,children:e.jsx("div",{className:x("h-full w-full",a&&"cursor-pointer items-center justify-center"),onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:e.jsxs("div",{className:x("relative flex h-full cursor-pointer items-center justify-center",!a&&"w-full"),children:[e.jsx(W,{jupyterMessage:t.fallback_image}),r&&e.jsx(ae,{isHovered:n})]})})})}const D=J.forwardRef(({focusObject:t,title:a="",onDownload:n=()=>{},additionalActions:c=[],expanded:r=!1,children:s},u)=>{const p=B(),l=de(),g=l&&l.type===I.ADAVisualization&&l.type===t.type&&l.visualization.file_id===t.visualization.file_id&&t.visualization.title===l.visualization.title,b=Q(),h=t.visualization.type,[y,k]=he(h,(b==null?void 0:b.id)??""),j=$(),d=t.visualization.type,{sourceUrl:m,contextConnectorName:i}=se(t.visualization);if(p&&!r||j)return e.jsx(Ne,{focusObject:t,title:a,type:d,isFocused:g??!1,disabled:j});const w=e.jsxs(e.Fragment,{children:[c.map((v,A)=>e.jsx("div",{className:"flex p-0",children:v},A)),m&&i&&e.jsx(E,{side:"top",sideOffset:4,label:e.jsx(f,{id:"KG958Q",defaultMessage:"Open in {contextConnectorName}",values:{contextConnectorName:i}}),children:e.jsx("a",{className:"flex items-center text-xs",href:m,target:"_blank",children:e.jsx(re,{className:x("icon-md text-token-text-tertiary hover:text-token-text-primary")})})}),n&&e.jsx(E,{side:"top",sideOffset:4,label:e.jsx(f,{id:"X0SJIT",defaultMessage:"Download {type}",values:{type:d}}),children:e.jsx("button",{onClick:n,className:"flex items-center text-xs",children:e.jsx(ne,{className:x("icon-md text-token-text-tertiary hover:text-token-text-primary")})})}),e.jsx(E,{side:"top",sideOffset:4,label:g?e.jsx(f,{id:"vilGuu",defaultMessage:"Collapse {type}",values:{type:d}}):e.jsx(f,{id:"7kLyF5",defaultMessage:"Expand {type}",values:{type:d}}),children:e.jsx("button",{onClick:()=>{U(g??!1,t)},className:"flex items-center text-xs",children:g?e.jsx(H,{className:x("icon-md text-token-text-tertiary hover:text-token-text-primary")}):e.jsx(O,{className:x("icon-md text-token-text-tertiary hover:text-token-text-primary")})})})]});return e.jsxs(M.div,{className:x("relative overflow-hidden border-token-border-light text-token-text-primary",!r&&"rounded-2xl border"),ref:u,onMouseEnter:()=>{k(!0)},...z,children:[e.jsxs("div",{className:x("flex items-center justify-between gap-2 bg-token-main-surface-primary px-4 py-3"),children:[e.jsx("span",{className:"flex-grow items-center truncate font-semibold capitalize",children:a}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{children:!y&&e.jsx(M.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",ease:"easeInOut",duration:.2},className:"absolute right-3 top-3",children:e.jsx(ve,{type:d})})}),y&&w]})]}),e.jsx("div",{className:"flex items-center justify-center bg-token-main-surface-primary",style:{height:r?"calc(100vh - 48px)":`${d==="table"?G:je}px`},children:s})]})});D.displayName="ADAVisualizationWrapper";function Ne({focusObject:t,title:a="",type:n,isFocused:c,disabled:r=!1}){const[s,u]=o.useState(!1),p=n==="chart"?ie:le,l=c||s||r;return e.jsx(M.div,{className:x("relative w-52 overflow-hidden rounded-2xl border",c&&"border-blue-selection/[.3]",l?"text-token-text-primary":"text-token-text-secondary",!r&&"cursor-pointer"),onMouseEnter:()=>{r||u(!0)},onMouseLeave:()=>{r||u(!1)},onClick:()=>{r||U(c,t)},...z,children:e.jsxs("div",{className:"flex justify-between bg-token-main-surface-primary px-3 py-2",children:[e.jsxs("div",{className:"my-0 flex w-full items-center gap-2 overflow-hidden text-sm font-semibold capitalize",children:[e.jsx(p,{className:x("icon-lg flex-shrink-0",l?"text-brand-green-800":"text-token-text-quaternary")}),e.jsx("span",{className:"flex-grow truncate",children:a})]}),s&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(E,{side:"top",sideOffset:4,label:c?e.jsx(f,{id:"vilGuu",defaultMessage:"Collapse {type}",values:{type:n}}):e.jsx(f,{id:"7kLyF5",defaultMessage:"Expand {type}",values:{type:n}}),children:c?e.jsx(H,{className:"icon-md icon-md text-token-text-secondary"}):e.jsx(O,{className:x("icon-md text-token-text-secondary")})})})]})})}function P({fileName:t=""}){return e.jsx("div",{className:"w-full rounded-2xl border border-red-600 p-3",children:e.jsxs("div",{className:"my-0 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("p",{className:"m-0 p-0 text-lg font-semibold capitalize",children:t})}),e.jsx("span",{className:"text-sm text-red-600",children:e.jsx(f,{id:"ADAVisualzationComponent.unableToLoadOutput",defaultMessage:"Unable to display visualization"})})]})})}const U=(t,a)=>{N.logEvent(S.adaFocusModeToggled),t?F.close():F.setFocusedObject(a)};export{et as default};
//# sourceMappingURL=e8usfodb1kylwxtw.js.map
