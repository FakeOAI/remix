const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/onmt21j1auxc05tu.js","assets/lyvmbpf7ocwbhkqv.js","assets/c7ci0rjyj4htmm6k.js","assets/root-dcq62fgs.css","assets/g6lhcxpyem234o4q.js","assets/conversation-small-ict01xsi.css","assets/f0kzyx7tsxe3xvmk.js","assets/dw2bwtw7gv4b633n.js","assets/mgblivg7zbb6krjc.js","assets/nf0lyo87fmthbxnm.js","assets/fum5k2u9xxdkha3i.js","assets/g2ca5q7bw0mlea5j.js","assets/f7hryzhmf6534y0i.js","assets/glkomea2c74965d0.js","assets/hkev4rv8r7g1sve7.js","assets/es7g14wntoycmfeg.js","assets/hno1f3wnjcbh8n5u.js","assets/textdoc-sandpack-code-preview-mk0lbw6o.css"])))=>i.map(i=>d[i]);
import{aE as hn,aF as pn,j as i,ar as H,r as p,Y as $,aK as Ee,aG as He,aY as Z,X as ee,n as gn,c4 as se,R as $e,Z as vn,d2 as Cn,bR as xn,bS as yn,bT as Tn,ab as wn,h as _t,o as En,gi as ut,b as ft,m as jt,am as bn,a5 as Sn}from"./lyvmbpf7ocwbhkqv.js";import{j_ as j,mk as kn,fN as O,ml as Mn,mm as ae,O as An,mn as Dn,mo as Nn,kI as Rt,dP as In,fD as _n,dO as jn,dR as Rn,mp as On,br as Ot,kG as Pt,kH as le,mq as Lt,ks as dt,bJ as K,kz as ce,B as Pn,mr as be,ht as Ht,fQ as ue,ms as Se,hr as Ln,kf as $t,hk as qt,mt as Ut,mu as Hn,Z as _,ky as $n,mv as qn,jK as Un,fl as Fn,cj as Bn,jH as zn,mw as Gn,iX as Vn,dk as Yn,v as mt,mx as R,my as Jn,mz as Ft,mA as Wn,mB as Qn,d as Xn,mC as Zn,mD as Kn,mE as es,fC as ts,mF as ns,mG as ss,ft as os,mH as rs,fv as as,mI as is,kF as ls,hl as cs,fw as us,fx as fs,hn as ds,mJ as ms,b4 as hs,mK as ps,mL as gs,mM as vs,mN as Cs,_ as ht,mO as xs,mP as ys,mQ as pt,mR as Ts,ki as oe}from"./g6lhcxpyem234o4q.js";import{O as ws,k as ie,l as Es,A as bs,m as Ss,D as ks}from"./mgblivg7zbb6krjc.js";import{e as Ms,C as As}from"./fnas3sx9icripad8.js";import{S as Ds}from"./k2y9y6jp2p2f60qu.js";import{C as ke,a0 as Ns,$ as Is,S as X,a1 as gt}from"./dw2bwtw7gv4b633n.js";import{m as W}from"./fum5k2u9xxdkha3i.js";import{p as _s,Q as js,ad as Rs,ar as Os,ah as Ps,bY as Ls,bZ as Hs,aI as $s,aO as qs,B as Us}from"./c7ci0rjyj4htmm6k.js";import{D as Fs}from"./jfec09n9f8qvv3j3.js";import{i as Bs}from"./hw10e1ayp99m2hf3.js";import{C as zs}from"./dix6qsz4ydykm8n4.js";import{P as Gs}from"./g2ca5q7bw0mlea5j.js";import{u as Vs}from"./kjmjj3btbfkn56qw.js";import{u as Ys}from"./nwn7mr0xxa9yw8bk.js";var qe=(t=>(t.Close="close",t.Loaded="loaded",t.Streaming="streaming",t.Download="download",t))(qe||{});function Js(t){return t.includes("'react'")||t.includes('"react"')}function Ws(t,e){switch(t){case j.CODE_HTML:return"static";case j.CODE_REACT:return"react";case j.CODE_JAVASCRIPT:case j.CODE_TYPESCRIPT:return Js(e)?"react":void 0;default:return}}function Ue(t,e){return Ws(t,e)!=null}function Bt(t){return kn([j.CODE_JAVASCRIPT,j.CODE_TYPESCRIPT,j.CODE_PYTHON],t)}function vt(){if(typeof globalThis<"u")return globalThis;if(typeof window<"u")return window;if(typeof global<"u")return global;if(typeof self<"u")return self;throw new Error("Unable to locate global object.")}function Qs(){const t=eval;function e(n){return n==="this"?vt():t(n)}try{vt().eval=e}catch(n){O.logError("Failed to polyfill eval",n)}}Qs();const Xs=hn(()=>pn(()=>import("./onmt21j1auxc05tu.js").then(t=>t.t),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17])).then(t=>t.TextdocSandpackCodePreview),{fallback:()=>i.jsx("div",{className:"h-full w-full",children:"Failed to load"}),loading:()=>i.jsx("div",{className:"h-full w-full"})});function Zs(t){return i.jsx(Xs,{...t})}function Ks({hidden:t,isStreaming:e,textdocContent:n,textdocType:s}){return s===j.CODE_HTML?i.jsx(Ds,{className:H("min-h-full w-full",{hidden:t}),srcDoc:n}):i.jsx(Zs,{hidden:t,isStreaming:e,textdocContent:n,textdocType:s})}const Ct=(t=[])=>t.filter(({status:e})=>e!==Mn.DISMISSED),eo=({isTextdocStreaming:t,isRequestActive:e,value:n,comments:s})=>{const[o,r]=p.useState(!1);return p.useEffect(()=>{t&&o&&(r(!1),ke.reset())},[n,s]),p.useEffect(()=>{e||(r(!1),ke.reset())},[e]),[o,r]};function to({onClickRestore:t,onClickResetLatest:e}){const n=$();return i.jsx(W.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{bounce:0,duration:.24},className:"absolute bottom-0 left-0 z-30 w-full items-center border-t border-gray-100 bg-token-main-surface-primary p-6 shadow-[0_-4px_32px_rgba(0,0,0,0.08)] @container dark:border-token-border-xlight dark:shadow-[0_-4px_32px_rgba(0,0,0,0.12)] lg:border-l",children:i.jsxs("div",{className:"mx-auto flex max-w-[48rem] flex-col flex-wrap justify-center gap-5 @2xl:flex-row @2xl:justify-between",children:[i.jsxs("div",{className:"flex flex-col px-2 text-center @2xl:text-start",children:[i.jsx("span",{className:"text-md text-wrap font-semibold",children:n.formatMessage({id:"gt23pb",defaultMessage:"You are viewing a previous version"})}),i.jsx("span",{className:"text-wrap text-sm text-token-text-secondary",children:n.formatMessage({id:"sAlUJn",defaultMessage:"Restore this version to make edits"})})]}),i.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4",children:[i.jsx(Ee,{as:"button",color:"primary",onClick:t,children:n.formatMessage({id:"+cddAb",defaultMessage:"Restore this version"})}),i.jsx(Ee,{as:"button",color:"secondary",onClick:e,children:n.formatMessage({id:"qCD3eu",defaultMessage:"Back to latest version"})})]})]})})}const no=({onClose:t,onClear:e})=>i.jsxs("div",{className:"flex items-center justify-between border-b border-gray-100 bg-token-main-surface-primary p-2 dark:border-token-border-medium",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Ee,{size:"small",color:"ghost",as:"button",className:"aspect-square !p-1",onClick:t,icon:_s}),i.jsx(He,{...xt.output})]}),i.jsx("div",{className:"flex items-center gap-2",children:i.jsx(Z,{label:i.jsx(He,{...xt.clearConsole}),children:i.jsx(Ee,{size:"small",color:"ghost",as:"button",className:"aspect-square !p-1",icon:js,onClick:e})})})]}),xt=ee({output:{id:"P/lYBq",defaultMessage:"Output"},clearConsole:{id:"gAICYK",defaultMessage:"Clear console"}}),so=({onDrag:t,onDragEnd:e,onDoubleClick:n})=>i.jsx(W.div,{drag:"y",className:"absolute top-[-2px] z-10 h-[4px] w-full cursor-ns-resize bg-token-text-quaternary opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,height:"8px",top:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateY(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onDrag:(s,o)=>{t?.(o)},onDragEnd:e,onDoubleClick:n});var Me=(t=>(t.RAN_CODE="ran_code",t))(Me||{});const oo=({name:t,message:e,stack:n})=>`${t}: ${e}
${n.join(`
`)}`,ro=({time:t})=>{const[,e]=p.useState(0);return p.useEffect(()=>{const n=setInterval(()=>e(s=>s+1),6e4);return()=>clearInterval(n)},[]),Dn(t,{addSuffix:!0})},ao=({log:t,level:e})=>i.jsx("span",{className:H("whitespace-pre-wrap",e==="error"&&"text-red-500"),children:t}),io=({error:t})=>i.jsx("span",{className:"flex flex-col gap-2 whitespace-pre-wrap text-red-500",children:oo(t)}),lo=({ranAt:t})=>i.jsxs("div",{className:"flex items-center justify-between gap-2 font-sans",children:[i.jsx("div",{className:"rounded-full bg-token-main-surface-secondary px-2 py-0.5",children:i.jsx(He,{...zt.ranCode})}),i.jsx("div",{className:"flex items-center gap-2",children:i.jsx(ro,{time:t})})]}),co=({output:t})=>{const e=$();return t==null?null:typeof t=="string"&&t.startsWith("blob:")?i.jsx("img",{alt:e.formatMessage(zt.imgAlt),src:t}):i.jsx("span",{className:"flex items-center gap-2",children:An(t)})},uo=({log:t})=>{let e=null;switch(t.type){case ae.LOG:{e=i.jsx(ao,{...t});break}case ae.ERROR:{e=i.jsx(io,{...t});break}case ae.OUTPUT:{e=i.jsx(co,{...t});break}case Me.RAN_CODE:{e=i.jsx(lo,{...t});break}case ae.RUN_COMPLETE:break}return i.jsx("li",{className:H("whitespace-pre px-2 py-1 font-mono",t.type===Me.RAN_CODE&&"sticky top-0 border-b border-token-border-light bg-token-main-surface-primary shadow-[0_-1px_0_0_var(--border-light)]"),children:e})},zt=ee({imgAlt:{id:"L6t7Yb",defaultMessage:"Plot"},ranCode:{id:"ffa9Nt",defaultMessage:"Ran code"}}),fo=({logs:t,onClear:e,onClose:n})=>{const[s,o]=p.useState(320);return i.jsxs(W.div,{className:"relative w-full border-t border-token-border-light",children:[i.jsx(so,{onDrag:({delta:{y:r}})=>o(a=>a-r)}),i.jsxs("div",{className:"flex flex-col",style:{height:s},children:[i.jsx(no,{onClear:e,onClose:n}),i.jsx("div",{className:"flex flex-1 flex-col-reverse overflow-auto bg-white dark:bg-black",children:i.jsx("ol",{className:"flex flex-1 flex-col justify-end pb-4",children:t.map((r,a)=>i.jsx(uo,{log:r},a))})})]})]})},mo=(t,e)=>{const n=Nn(),[s,o]=p.useState(!1),[r,a]=p.useState([]);return p.useImperativeHandle(e,()=>({runCode:async(l,f)=>{if(!Bt(l))return;o(!0),a(d=>[...d,{type:Me.RAN_CODE,ranAt:Date.now()}]);const c=Rt(l),u=gn(n.current).evalAsync({code:f,type:c});for await(const d of u)d.type!==ae.READY&&a(m=>[...m,d])},open:()=>o(!0)})),s?i.jsx(fo,{onClose:()=>o(!1),onClear:()=>a([]),logs:r}):null};p.forwardRef(mo);const ho={type:"spring",damping:35,stiffness:300},po=({clientThreadId:t,turn:e})=>{const n=In(),s=_n(e.messages);return i.jsxs(W.div,{className:"absolute left-0 right-0 top-0 z-10 -translate-y-full",children:[i.jsx(W.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-vert-light-gradient dark:bg-vert-dark-gradient"}),i.jsx(W.div,{className:"flex items-center px-6 py-2",initial:{opacity:.75,translateX:-50,translateY:"100%"},animate:{opacity:1,translateX:0,translateY:"0"},exit:{opacity:0,translateY:20},transition:ho,children:i.jsx(zs,{clientThreadId:t,onChangeItemInView:se,onRequestCompletion:async o=>se(o),onRequestMoreCompletions:se,groupedMessagesToRender:s,allGroupedMessages:s,isEditing:!1,isUserTurn:!0,turnIndex:0,isCompletionRequestInProgress:!1,isFeedbackEnabled:!1,isFinalTurn:!1,hasActiveRequest:n,showEditButton:!1,handleEnterEdit:se,handleExitEdit:se})})]},"user-message")},go=({clientThreadId:t})=>{const e=jn(t),n=Rn(t,e),{lastUserTurn:s,lastAssistantTurn:o}=p.useMemo(()=>{let a=null,l=null;for(let f=n.length-1;f>0;f--){const c=n[f];if(!a&&c.role===$e.User?a=c:!l&&c.role===$e.Assistant&&(l=c),a&&l)break}return{lastUserTurn:a,lastAssistantTurn:l}},[n]),r=s&&!o?.messages.find(({message:a})=>a.recipient?.startsWith(On));return i.jsx(Ot,{initial:!1,children:r&&i.jsx(po,{turn:s,clientThreadId:t})})},vo=({isRequestActive:t=!1,clientThreadId:e,onCancel:n,onSubmit:s,onSubmitAccelerator:o,acceleratorActions:r=[]})=>{const[a,l]=p.useState(!1),[f,c]=p.useState(""),[u,d]=p.useState(!0),m=$(),[T,v]=p.useState(!1),h=Ns(),C=()=>{s?.(f),c("")},x=g=>{const{metaKey:b,shiftKey:y,key:M}=g;M==="Enter"&&f.trim()&&!(y||b)&&(C(),g.preventDefault())};return i.jsxs(i.Fragment,{children:[a&&!h&&i.jsx(ws,{zIndexKey:"acceleratorsOverlay",className:"bg-white/95 dark:bg-black/85"}),i.jsx("div",{className:"relative mb-3 flex flex-1 justify-center",children:i.jsxs("div",{className:"mx-6 max-w-2xl flex-1",children:[i.jsx(go,{clientThreadId:e}),i.jsx("div",{className:"flex flex-auto items-start",children:i.jsx("div",{className:H("flex min-h-12 flex-auto items-center bg-[#f4f4f4] py-1 pl-6 pr-2 dark:bg-token-main-surface-secondary",{"rounded-full":u,"rounded-2xl":!u,"bg-transparent":T}),children:i.jsxs("div",{className:"relative flex flex-auto items-center self-stretch",children:[i.jsx(Bs,{placeholder:m.formatMessage({id:"zrUbTJ",defaultMessage:"Ask ChatGPT to edit"}),disabled:t,value:f,className:H("w-full resize-none border-0 bg-transparent p-0 text-token-text-primary outline-0 placeholder:text-token-text-secondary focus:ring-0 focus-visible:ring-0",{"opacity-0":T}),maxRows:4,onChange:({target:{value:g}})=>c(g),onKeyDown:x,onHeightChange:(g,{rowHeight:b})=>d(Math.floor(g/b)<=1)}),f?i.jsx(W.button,{className:H("dark h-8 w-8 rounded-full bg-token-main-surface-primary text-center dark:bg-token-main-surface-primary",{"self-end":!u}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:()=>C(),children:i.jsx(Rs,{className:"h-8 w-8 text-token-text-primary"})}):(r?.length??0)>0&&i.jsx(Is,{disableHint:!0,disableOverlay:!0,isEmbeddedInPromptArea:!0,isRequestActive:t,actions:r,onCancel:n,onExpandedChange:g=>{h||v(g),l(g)},onSubmit:o,right:0,bottom:4})]})})})]})})]})};function P(){}P.prototype={diff:function(e,n){var s,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=o.callback;typeof o=="function"&&(r=o,o={});var a=this;function l(y){return y=a.postProcess(y,o),r?(setTimeout(function(){r(y)},0),!0):y}e=this.castInput(e,o),n=this.castInput(n,o),e=this.removeEmpty(this.tokenize(e,o)),n=this.removeEmpty(this.tokenize(n,o));var f=n.length,c=e.length,u=1,d=f+c;o.maxEditLength!=null&&(d=Math.min(d,o.maxEditLength));var m=(s=o.timeout)!==null&&s!==void 0?s:1/0,T=Date.now()+m,v=[{oldPos:-1,lastComponent:void 0}],h=this.extractCommon(v[0],n,e,0,o);if(v[0].oldPos+1>=c&&h+1>=f)return l(yt(a,v[0].lastComponent,n,e,a.useLongestToken));var C=-1/0,x=1/0;function g(){for(var y=Math.max(C,-u);y<=Math.min(x,u);y+=2){var M=void 0,k=v[y-1],D=v[y+1];k&&(v[y-1]=void 0);var S=!1;if(D){var q=D.oldPos-y;S=D&&0<=q&&q<f}var U=k&&k.oldPos+1<c;if(!S&&!U){v[y]=void 0;continue}if(!U||S&&k.oldPos<D.oldPos?M=a.addToPath(D,!0,!1,0,o):M=a.addToPath(k,!1,!0,1,o),h=a.extractCommon(M,n,e,y,o),M.oldPos+1>=c&&h+1>=f)return l(yt(a,M.lastComponent,n,e,a.useLongestToken));v[y]=M,M.oldPos+1>=c&&(x=Math.min(x,y-1)),h+1>=f&&(C=Math.max(C,y+1))}u++}if(r)(function y(){setTimeout(function(){if(u>d||Date.now()>T)return r();g()||y()},0)})();else for(;u<=d&&Date.now()<=T;){var b=g();if(b)return b}},addToPath:function(e,n,s,o,r){var a=e.lastComponent;return a&&!r.oneChangePerToken&&a.added===n&&a.removed===s?{oldPos:e.oldPos+o,lastComponent:{count:a.count+1,added:n,removed:s,previousComponent:a.previousComponent}}:{oldPos:e.oldPos+o,lastComponent:{count:1,added:n,removed:s,previousComponent:a}}},extractCommon:function(e,n,s,o,r){for(var a=n.length,l=s.length,f=e.oldPos,c=f-o,u=0;c+1<a&&f+1<l&&this.equals(s[f+1],n[c+1],r);)c++,f++,u++,r.oneChangePerToken&&(e.lastComponent={count:1,previousComponent:e.lastComponent,added:!1,removed:!1});return u&&!r.oneChangePerToken&&(e.lastComponent={count:u,previousComponent:e.lastComponent,added:!1,removed:!1}),e.oldPos=f,c},equals:function(e,n,s){return s.comparator?s.comparator(e,n):e===n||s.ignoreCase&&e.toLowerCase()===n.toLowerCase()},removeEmpty:function(e){for(var n=[],s=0;s<e.length;s++)e[s]&&n.push(e[s]);return n},castInput:function(e){return e},tokenize:function(e){return Array.from(e)},join:function(e){return e.join("")},postProcess:function(e){return e}};function yt(t,e,n,s,o){for(var r=[],a;e;)r.push(e),a=e.previousComponent,delete e.previousComponent,e=a;r.reverse();for(var l=0,f=r.length,c=0,u=0;l<f;l++){var d=r[l];if(d.removed)d.value=t.join(s.slice(u,u+d.count)),u+=d.count;else{if(!d.added&&o){var m=n.slice(c,c+d.count);m=m.map(function(T,v){var h=s[u+v];return h.length>T.length?h:T}),d.value=t.join(m)}else d.value=t.join(n.slice(c,c+d.count));c+=d.count,d.added||(u+=d.count)}}return r}function Tt(t,e){var n;for(n=0;n<t.length&&n<e.length;n++)if(t[n]!=e[n])return t.slice(0,n);return t.slice(0,n)}function wt(t,e){var n;if(!t||!e||t[t.length-1]!=e[e.length-1])return"";for(n=0;n<t.length&&n<e.length;n++)if(t[t.length-(n+1)]!=e[e.length-(n+1)])return t.slice(-n);return t.slice(-n)}function Fe(t,e,n){if(t.slice(0,e.length)!=e)throw Error("string ".concat(JSON.stringify(t)," doesn't start with prefix ").concat(JSON.stringify(e),"; this is a bug"));return n+t.slice(e.length)}function Be(t,e,n){if(!e)return t+n;if(t.slice(-e.length)!=e)throw Error("string ".concat(JSON.stringify(t)," doesn't end with suffix ").concat(JSON.stringify(e),"; this is a bug"));return t.slice(0,-e.length)+n}function re(t,e){return Fe(t,e,"")}function Te(t,e){return Be(t,e,"")}function Et(t,e){return e.slice(0,Co(t,e))}function Co(t,e){var n=0;t.length>e.length&&(n=t.length-e.length);var s=e.length;t.length<e.length&&(s=t.length);var o=Array(s),r=0;o[0]=0;for(var a=1;a<s;a++){for(e[a]==e[r]?o[a]=o[r]:o[a]=r;r>0&&e[a]!=e[r];)r=o[r];e[a]==e[r]&&r++}r=0;for(var l=n;l<t.length;l++){for(;r>0&&t[l]!=e[r];)r=o[r];t[l]==e[r]&&r++}return r}var Ae="a-zA-Z0-9_\\u{C0}-\\u{FF}\\u{D8}-\\u{F6}\\u{F8}-\\u{2C6}\\u{2C8}-\\u{2D7}\\u{2DE}-\\u{2FF}\\u{1E00}-\\u{1EFF}",xo=new RegExp("[".concat(Ae,"]+|\\s+|[^").concat(Ae,"]"),"ug"),De=new P;De.equals=function(t,e,n){return n.ignoreCase&&(t=t.toLowerCase(),e=e.toLowerCase()),t.trim()===e.trim()};De.tokenize=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n;if(e.intlSegmenter){if(e.intlSegmenter.resolvedOptions().granularity!="word")throw new Error('The segmenter passed must have a granularity of "word"');n=Array.from(e.intlSegmenter.segment(t),function(r){return r.segment})}else n=t.match(xo)||[];var s=[],o=null;return n.forEach(function(r){/\s/.test(r)?o==null?s.push(r):s.push(s.pop()+r):/\s/.test(o)?s[s.length-1]==o?s.push(s.pop()+r):s.push(o+r):s.push(r),o=r}),s};De.join=function(t){return t.map(function(e,n){return n==0?e:e.replace(/^\s+/,"")}).join("")};De.postProcess=function(t,e){if(!t||e.oneChangePerToken)return t;var n=null,s=null,o=null;return t.forEach(function(r){r.added?s=r:r.removed?o=r:((s||o)&&bt(n,o,s,r),n=r,s=null,o=null)}),(s||o)&&bt(n,o,s,null),t};function bt(t,e,n,s){if(e&&n){var o=e.value.match(/^\s*/)[0],r=e.value.match(/\s*$/)[0],a=n.value.match(/^\s*/)[0],l=n.value.match(/\s*$/)[0];if(t){var f=Tt(o,a);t.value=Be(t.value,a,f),e.value=re(e.value,f),n.value=re(n.value,f)}if(s){var c=wt(r,l);s.value=Fe(s.value,l,c),e.value=Te(e.value,c),n.value=Te(n.value,c)}}else if(n)t&&(n.value=n.value.replace(/^\s*/,"")),s&&(s.value=s.value.replace(/^\s*/,""));else if(t&&s){var u=s.value.match(/^\s*/)[0],d=e.value.match(/^\s*/)[0],m=e.value.match(/\s*$/)[0],T=Tt(u,d);e.value=re(e.value,T);var v=wt(re(u,T),m);e.value=Te(e.value,v),s.value=Fe(s.value,u,v),t.value=Be(t.value,u,u.slice(0,u.length-v.length))}else if(s){var h=s.value.match(/^\s*/)[0],C=e.value.match(/\s*$/)[0],x=Et(C,h);e.value=Te(e.value,x)}else if(t){var g=t.value.match(/\s*$/)[0],b=e.value.match(/^\s*/)[0],y=Et(g,b);e.value=re(e.value,y)}}var yo=new P;yo.tokenize=function(t){var e=new RegExp("(\\r?\\n)|[".concat(Ae,"]+|[^\\S\\n\\r]+|[^").concat(Ae,"]"),"ug");return t.match(e)||[]};var Ne=new P;Ne.tokenize=function(t,e){e.stripTrailingCr&&(t=t.replace(/\r\n/g,`
`));var n=[],s=t.split(/(\n|\r\n)/);s[s.length-1]||s.pop();for(var o=0;o<s.length;o++){var r=s[o];o%2&&!e.newlineIsToken?n[n.length-1]+=r:n.push(r)}return n};Ne.equals=function(t,e,n){return n.ignoreWhitespace?((!n.newlineIsToken||!t.includes(`
`))&&(t=t.trim()),(!n.newlineIsToken||!e.includes(`
`))&&(e=e.trim())):n.ignoreNewlineAtEof&&!n.newlineIsToken&&(t.endsWith(`
`)&&(t=t.slice(0,-1)),e.endsWith(`
`)&&(e=e.slice(0,-1))),P.prototype.equals.call(this,t,e,n)};function To(t,e,n){return Ne.diff(t,e,n)}var wo=new P;wo.tokenize=function(t){return t.split(/(\S.+?[.!?])(?=\s+|$)/)};var Eo=new P;Eo.tokenize=function(t){return t.split(/([{}:;,]|\s+)/)};function ze(t){"@babel/helpers - typeof";return ze=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ze(t)}var fe=new P;fe.useLongestToken=!0;fe.tokenize=Ne.tokenize;fe.castInput=function(t,e){var n=e.undefinedReplacement,s=e.stringifyReplacer,o=s===void 0?function(r,a){return typeof a>"u"?n:a}:s;return typeof t=="string"?t:JSON.stringify(Ge(t,null,null,o),o,"  ")};fe.equals=function(t,e,n){return P.prototype.equals.call(fe,t.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"),n)};function Ge(t,e,n,s,o){e=e||[],n=n||[],s&&(t=s(o,t));var r;for(r=0;r<e.length;r+=1)if(e[r]===t)return n[r];var a;if(Object.prototype.toString.call(t)==="[object Array]"){for(e.push(t),a=new Array(t.length),n.push(a),r=0;r<t.length;r+=1)a[r]=Ge(t[r],e,n,s,o);return e.pop(),n.pop(),a}if(t&&t.toJSON&&(t=t.toJSON()),ze(t)==="object"&&t!==null){e.push(t),a={},n.push(a);var l=[],f;for(f in t)Object.prototype.hasOwnProperty.call(t,f)&&l.push(f);for(l.sort(),r=0;r<l.length;r+=1)f=l[r],a[f]=Ge(t[f],e,n,s,f);e.pop(),n.pop()}else a=t;return a}var Ve=new P;Ve.tokenize=function(t){return t.slice()};Ve.join=Ve.removeEmpty=function(t){return t};var we=(t=>(t.ADDED="added",t.REMOVED="removed",t.UNCHANGED="unchanged",t))(we||{});function Ye(t){if(t==="")return 0;const e=t.split(`
`).length;return t.endsWith(`
`)?e-1:e}function bo(t,e){return To(t,e,{newlineIsToken:!0}).map(s=>({count:s.count??Ye(s.value),value:s.value,type:s.added?"added":s.removed?"removed":"unchanged"}))}function So(t){let e="";for(const{type:n,value:s}of t)(n==="added"||n==="unchanged")&&(e+=s);return e}function ko(t,e){const n=Ye(e),s=Do(t,n);return{changes:bo(s,e),numLinesDiffed:n}}function Mo(t){const e=[...t],n=[],s=[];for(;e.length>0;){const o=e[e.length-1];if(o.type===we.REMOVED)e.pop(),o.type===we.REMOVED&&n.unshift(o);else if(o.type===we.ADDED)e.pop(),s.unshift(o);else break}return{prunedChanges:[...e,...s],prunedRemovedChanges:n}}function Ao(t,e){const{changes:n,numLinesDiffed:s}=ko(t,e),{prunedChanges:o,prunedRemovedChanges:r}=Mo(n),a=So(o),l=r.map(c=>c.value).join(`
`),f=Gt(t,s,"start");return{content:a+l+f,numLinesDiffed:Ye(a)}}function Do(t,e){if(e<=0)return"";let n=0,s=t.length;for(let o=0;o<t.length;o++)if(t[o]===`
`&&(n++,n===e)){s=o+1;break}return t.substring(0,s)}function Gt(t,e,n="start"){if(e<=0)return t;if(n==="start"){let a=0;for(let l=0;l<t.length;l++)if(t[l]===`
`&&(a++,a===e))return t.substring(l+1);return""}let s=0,o=-1;const r=t.endsWith(`
`)?e+1:e;for(let a=t.length-1;a>=0;a--)if(t[a]===`
`&&(s++,s===r)){o=a;break}return o===-1?"":t.substring(0,o+1)}function No(t,e){const n=t?.type??j.LOADING,s=t?.content??"",o=Pt(t);if(!le(n)||e==null||!o||!Lt(t))return{content:s,currentlyStreamingLineIndex:null};const r=Gt(s,1,"end");if(r==="")return{content:e.content,currentlyStreamingLineIndex:0};const a=Ao(e.content,r);return{content:a.content,currentlyStreamingLineIndex:a.numLinesDiffed}}function Io(t,e){const n=new Set(t.map(l=>l.id)),s=new Set(e.map(l=>l.id)),o=t.filter(l=>!s.has(l.id)).map(l=>({...l,diffStatus:dt.REMOVED})),r=e.filter(l=>!n.has(l.id)).map(l=>({...l,diffStatus:dt.ADDED})),a=t.filter(l=>s.has(l.id));return o.concat(r,a)}function _o({textdocVersion:t}){const e=$(),n=vn(),[s,o]=p.useState(!1),r=Cn(),a=p.useRef(t?.content??"");p.useEffect(()=>{a.current=t?.content??""},[t]);const l=f=>{s||(r(()=>{O.logButtonClick(ce.COPY,{contentLength:a.current.length,textdocType:t?.type}),Pn(a.current,n,f)},0),o(!0),r(()=>o(!1),2e3))};return i.jsx(Z,{label:e.formatMessage(jo.copy),children:i.jsx(K,{icon:s?Os:Ps,onClick:l})})}const jo=ee({copy:{id:"rbIYfo",defaultMessage:"Copy"}});function Ro({disabled:t=!1,textdocId:e,version:n,isHistorical:s,isShowingChanges:o,latestVersionInt:r,nextVersion:a,previousVersion:l,onHoverPrevious:f,textdocType:c}){const u=$(),d=n==null||n===1,m=n!=null&&n>1;return d&&!s?null:i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx(Z,{label:m&&u.formatMessage({id:"PoD5+8",defaultMessage:"Previous version"}),children:i.jsx(K,{disabled:!m||t,icon:Ls,onMouseOver:f,onClick:()=>{O.logButtonClick(ce.HISTORY_PREVIOUS,{textdocType:c,isShowingChanges:o,textdocId:e,versionInt:n}),e&&n&&m&&be(e,{beforeVersion:n},o&&l!=null?l:void 0)}})}),i.jsx(Z,{label:s&&u.formatMessage({id:"PJ8YVJ",defaultMessage:"Next version"}),children:i.jsx(K,{disabled:!s||t,icon:Hs,onClick:()=>{O.logButtonClick(ce.HISTORY_NEXT,{textdocType:c,isShowingChanges:o,textdocId:e,versionInt:n}),s&&(a?be(e,{version:a},o?a:void 0):o&&r?Ht(e,r,null):ue(e))}})})]})}function Oo({disabled:t=!1,isShowingCodePreview:e,onClick:n}){const[s,o]=p.useState(!1),r=$(),a=()=>{o(!0)},l=()=>{o(!1)};return i.jsx(Z,{label:e?r.formatMessage(St.hidePreview):r.formatMessage(St.showPreview),children:i.jsx(K,{disabled:t,onMouseEnter:a,onMouseLeave:l,icon:$s,onClick:n,className:H("transition-colors",{[Se.hoverActive]:s&&e,[Se.active]:!s&&e})})})}const St=ee({showPreview:{id:"m61vYn",defaultMessage:"Preview code"},hidePreview:{id:"ot1Rmq",defaultMessage:"Preview code"}});function Po({disabled:t=!1,textdocId:e,textdocType:n,history:s,version:o,isShowingChanges:r,latestVersionInt:a,onMouseEnter:l}){const f=$(),[c,u]=p.useState(!1),d=()=>{s?be(e,s):ue(e)},m=(o?.versionInt??0)>1,T=()=>{O.logButtonClick(ce.SHOW_CHANGES,{textdocType:n,textdocId:e,versionInt:o?.versionInt,latestVersionInt:a}),o?.versionInt!=null&&Ht(e,o.versionInt,s)},v=()=>{u(!0),l?.()},h=()=>{u(!1)};return i.jsx(Z,{label:m&&f.formatMessage(r?kt.hideChanges:kt.showChanges),children:i.jsx(K,{icon:qs,disabled:!m||t,onClick:r?d:T,onMouseEnter:v,onMouseLeave:h,className:H("transition-colors",{[Se.hoverActive]:c&&r&&m,[Se.active]:!c&&r&&m,"!bg-transparent":!c&&!r&&m})})})}const kt=ee({done:{id:"0MCBfo",defaultMessage:"Done"},showChanges:{id:"3jMGNS",defaultMessage:"Show changes"},hideChanges:{id:"HWiQSk",defaultMessage:"Hide changes"}}),Lo=800,Ho=100,Mt=100,$o=({textdocId:t,isHistoricalVersion:e,nextHistoricalTextdocVersion:n,previousHistoricalTextdocVersion:s,textdocVersion:o,readonlyReason:r,history:a,latestVersionInt:l,hasDebug:f,contentWidth:c,isEmbedded:u,isPersisting:d,isShowChangesFeatureEnabled:m,isShowingChanges:T,hideHistoryActions:v=!1,prefetchHistoricalTextdocVersion:h,restoreHistoricalTextdocVersion:C,setShowDebugView:x,onClickCodePreview:g,onClose:b,isShowingCodePreview:y})=>{const M=Ln(o?.title??""),[{width:k},D]=$t(),S=c-k-Ho-Mt>0,q=qt(),U=Ut(),F=Hn(),N=o==null?!1:Ue(o.type,o.content)&&U||Bt(o.type)&&F,J=H("transition-opacity duration-500",r===_.Streaming&&"pointer-events-none opacity-0");return i.jsxs(ie.Header,{children:[i.jsxs("div",{className:"flex flex-1 items-center leading-[0]",children:[i.jsx(ie.CloseButton,{onClick:b}),S&&i.jsx("div",{className:"flex flex-row items-center gap-2.5",children:i.jsx(ie.Title,{style:{maxWidth:c-k-Mt},children:M||i.jsx("div",{className:"w-52",children:i.jsx(Gs,{lines:1,size:"base",width:100,widthVariance:0})})})}),d&&i.jsx($n,{size:12,className:"pl-2 text-token-text-secondary"})]}),i.jsxs("div",{className:"flex select-none items-center gap-2 leading-[0]",ref:D,children:[i.jsxs("div",{className:"flex items-center gap-2",children:[f&&c>Lo&&i.jsx(K,{icon:Us,onClick:()=>x(B=>!B)}),!v&&i.jsx("div",{className:J,children:i.jsx(Ro,{disabled:r===_.Streaming,textdocId:t,isHistorical:e,isShowingChanges:T,version:o?.versionInt,previousVersion:s?.versionInt,nextVersion:n?.versionInt,readonlyReason:r,onHoverPrevious:h,onClickRestore:C,textdocType:o?.type,latestVersionInt:l})}),!v&&m&&i.jsx("div",{className:J,children:i.jsx(Po,{disabled:r===_.Streaming,textdocId:t,textdocType:o?.type,history:a,version:o,isShowingChanges:T,latestVersionInt:l,onMouseEnter:()=>{o?.versionInt&&q(t,o.versionInt),h()}})}),N&&i.jsx(Oo,{disabled:o?.versionInt==null,onClick:g,isShowingCodePreview:y}),i.jsx(_o,{textdocVersion:o})]}),!u&&i.jsx(Es,{})]})]})},qo=/\s/,Uo=30;function At(t,e){const n=t.indexOf(e);return n===-1?!1:t.indexOf(e,n+e.length)===-1}function Y(t,e){return qo.test(t[e])}function Dt(t,e,n=!1){if(e===0||n&&Y(t,e-1))return e;for(;e>0&&Y(t,e-1);)e--;for(;e>0&&!Y(t,e-1);)e--;return Y(t,e)&&e++,e}function Nt(t,e,n=!1){if(e===t.length||n&&Y(t,e))return e;for(;e<t.length&&Y(t,e);)e++;for(;e<t.length&&!Y(t,e);)e++;return Y(t,e-1)&&e--,e}function Fo(t,e,n=!0,s=Uo){if(t.start<0||t.end>e.length||t.start>t.end)throw new Error("Invalid commentSourceRange provided.");const o=e.substring(t.start,t.end);let r=t.start,a=t.end;n&&(r=Dt(e,r,!0),a=Nt(e,a,!0));let l=e.substring(r,t.start),f=e.substring(t.end,a),c=`${l}${o}${f}`;if(At(e,c)&&(s==null||c.length>=s))return{before:l,after:f,allSurrounding:c};let u=r,d=a,m=!0;for(;m&&(s==null||c.length<s);){let T=!1;const v=u>0?Dt(e,u):u;v<u&&(u=v,T=!0);const h=d<e.length?Nt(e,d):d;if(h>d&&(d=h,T=!0),T){const C=e.substring(u,t.start),x=e.substring(t.end,d),g=`${C}${o}${x}`;if(At(e,g)&&(s==null||g.length>=s))return{before:C,after:x,allSurrounding:g};l=C,f=x,c=g}else m=!1}return{before:l,after:f,allSurrounding:c}}const de="# Context",me="# Instructions";function he(t,e,n){if(e==null||n==null)return`The user is referring to the entire text of "${t}".`;const s=`
## Selected Text
The user has selected this text in "${t}" in particular:
${e}
`.trim();return n.allSurrounding===e?s:`
${s}

## Surrounding Context
Here is the surrounding context:
${n.allSurrounding}
`.trim()}function Vt(t,e){return t==null||e==null?"entire document":t===e.allSurrounding?"selected text":"surrounding context"}function Yt(t){return`For the update pattern, create a regex which exactly matches the ${t}. Edit just this string in order to fullfill the user's request. NEVER rewrite the entire document. Instead, ALWAYS edit ONLY the ${t}. The only exception to this rule is if the ${t} includes markdown lists or tables. In that case, fully rewrite the document using ".*" as the regex update pattern.`.trim()}function Bo(t,e,n,s){if(!le(e)&&n&&s){const o=Vt(n,s);return`
${de}
The user requests that you directly edit the document.

${he(t,n,s)}

${me}
Use the update_textdoc tool to make this edit. ${Yt(o)}`.trim()}return`
${de}
The user requests that you directly edit the document.

${he(t,n,s)}

${me}
Use the update_textdoc tool to make this edit. You MUST fully rewrite the entire document by using ".*" as the update regex pattern.`.trim()}function zo(t,e,n){return`
${de}
The user requests that you add comments about some text.

${he(t,e,n)}

${me}
Do not respond to the user's question directly, just leave comments.`.trim()}function Go(t,e){return le(t)?e==="entire document"?` If you choose to update the ${e}, you MUST fully rewrite the ${e} by using ".*" as the update regex pattern.`:` If you choose to update the ${e}, you MUST fully rewrite the entire document by using ".*" as the update regex pattern. When you do so, ONLY modify the ${e} and rewrite other sections exactly as is, except for parts that must change based on this update`:e==="entire document"?"":` If you choose to update the ${e}, follow these instructions: ${Yt(e)}`}function Vo(t,e,n,s){const o=Vt(n,s),r=Go(e,o);return`
${de}
${he(t,n,s)}

${me}
The user would like you perform one of the following actions:
- Update the ${o} via the \`update_textdoc\` tool.${r}
- Explain the selected text via chat, or answer a general question about the selected text (no tool call required).
- Comment on the ${o} with feedback via the \`comment_textdoc\` tool. This should only be used if the user very explicitly asks for feedback, critique, or comments.

Based on the user's request, choose the appropriate action.
`.trim()}function Yo(t,e,n){return`
${de}
${he(t,e,n)}

${me}
The user would like you to create a new textdoc.
`.trim()}function Jo(t,e,n,s=null,o=null){switch(n){case X.ASK:return Vo(t,e,s,o);case X.CREATE_TEXTDOC:return Yo(t,s,o);case X.EDIT:return Bo(t,e,s,o);case X.COMMENT:return zo(t,s,o)}}function Wo(t){switch(t){case R.ACCELERATOR:case R.ACCEPT_COMMENT:return!0;case R.ASK_CHATGPT:case R.FULL_SCREEN_SUBMIT:return!1}}function Qo(t,e){switch(e){case R.ASK_CHATGPT:case R.ACCEPT_COMMENT:case R.FULL_SCREEN_SUBMIT:return t.formatMessage(Zo.askChatGPT);case R.ACCELERATOR:return}}const Xo=(t,e)=>{const n=$(),{tags:s}=qn(t),o=Un(),r=Fn(t),a=Bn(t)??o.id,l=zn({clientThreadId:t});return p.useCallback(async({content:f,sourceRange:c,action:u,userMessageType:d,acceleratorMetadata:m,selectionMetadata:T})=>{if(e?.versionInt==null)return;const{textdocId:v,type:h,versionInt:C,content:x}=e;let g,b=null;c&&c.start!==c.end&&(g=x.slice(c.start,c.end),b=Fo(c,x));const y=Jo(v,h,u,g,b),k=Gn(y,{exclude_after_next_user_message:!0}),D=performance.now(),S=await xn(),[q,U,F]=await Promise.all([yn.getEnforcementToken(S),Vn.getEnforcementToken(S),Tn.getEnforcementToken(S)]),N=new Yn,J=mt.getThreadCurrentLeafId(t),B=`${J}-nextPrompt`;mt.updateTree(t,Ie=>{Ie.addNode(B,f,J,$e.User,void 0,{canvas:{textdoc_id:v,textdoc_type:h,version:C,textdoc_content_length:x.length,user_message_type:d,accelerator_metadata:m,selection_metadata:T},is_visually_hidden_from_conversation:Wo(d),targeted_reply:g,targeted_reply_label:Qo(n,d),open_in_canvas_view:{type:"canvas_textdoc",id:v}})}),l({model:a,completionType:wn.Next,parentNodeId:B,metadata:{eventSource:"mouse"},completionMetadata:r?{conversationMode:r}:void 0,chatReq:S,arkoseToken:q??null,turnstileToken:U??null,proofToken:F??null,preflightTime:performance.now()-D,appendMessages:[k],turnTracker:N})},[e,s,t,l,a,r,n])},Zo=ee({askChatGPT:{id:"h5ANdM",defaultMessage:"Asked ChatGPT"}});function Ko(t){const e=/\[([^\]]+)\]\((https?:\/\/[^\s)]+|www\.[^\s)]+)\)/gi,n=new Set,s=t.matchAll(e);for(const o of s){const r=o[2];try{let a=r;a.startsWith("www.")&&(a="http://"+r),new URL(a),n.add(r)}catch{}}return n}const er=async({lastVersion:t,textdocId:e,content:n,comments:s})=>{const o=Jn(s,n);return(await _t.safePost("/textdoc/{textdoc_id}",{parameters:{path:{textdoc_id:e}},requestBody:{version:t,content:n,comments:o}})).version},tr=()=>{const t=p.useRef([]),e=p.useRef(null),{mutateAsync:n,isPending:s}=En({mutationKey:["canvas","textdoc","persist"],mutationFn:er});return[p.useCallback(async(r,a,l)=>{const f=new AbortController,u=(async()=>{const[v]=t.current;try{await v?.promise}catch(h){O.logError("Saving document",h)}if(!f.signal.aborted)try{const h=Math.max(e.current??0,r.versionInt??Ft);let C="";try{ut(a)?C=a():C=a}catch(y){O.logError("Serializing document",y)}let x=[];try{ut(l)?x=l():x=l}catch(y){O.logError("Adjusting comments",y)}const{textdocId:g}=r;Wn({textdocId:g,basedOnVersionInt:h,content:C,comments:x});const b=await n({textdocId:g,lastVersion:h,content:C,comments:x});Qn({textdocId:g,basedOnVersionInt:h,newVersion:b}),e.current=b}catch(h){O.logError("Error saving document",h)}finally{t.current.shift()}})(),d={abort:()=>f.abort(),promise:u},[m,T]=t.current;return T&&(T.abort(),t.current=m?[m]:[]),t.current=m?[m,d]:[d],u},[n]),t,s]},nr=3e3,sr=t=>{const[e,n,s]=tr(),o=$(),r=p.useRef(null),a=p.useCallback(Xn(e,nr,{leading:!1}),[e]),l=Zn(t);return p.useEffect(()=>{if(!l)return;const c=ft(window,{pagehide:()=>a.flush(),beforeunload:d=>{a.flush(),d.returnValue=o.formatMessage({id:"QZrKwi",defaultMessage:"You have a canvas save in progress."})}}),u=ft(document,{visibilitychange:()=>a.flush(),keydown:()=>{r.current="keyboard"},mousemove:()=>{r.current!=="mouse"&&a.flush(),r.current="mouse"}});return()=>{r.current=null,u(),c()}},[o,l,a]),p.useEffect(()=>()=>{a.flush()},[t,a]),Kn(async()=>{await a.flush(),await Promise.allSettled(n.current?.map(({promise:c})=>c)??[])}),[p.useCallback((c,u,d)=>{const{textdocId:m}=c;return es(m),a(c,u,d)},[a]),a.flush,s||l]};function or(t,e,n){const s=jt(),o=n!=null&&e!=null,{data:r,error:a,fetchNextPage:l,hasNextPage:f,isFetching:c}=bn(It(t,e,o)),u=p.useCallback(async()=>{const h=e!=null;await s.prefetchInfiniteQuery(It(t,e,h))},[s,t,e]);p.useEffect(()=>{const h=e;return()=>{s.removeQueries({queryKey:Jt(t,h),exact:!0})}},[s,t,e]);const[d,m,T,v]=p.useMemo(()=>{if(r&&n){const C=r.pages.flatMap(g=>g),x=C.findIndex(g=>"beforeVersion"in n?(g.versionInt??Ft)<n.beforeVersion:g.versionInt===n.version);if(x!==-1)return[x===C.length-1,C[x],x>0?C[x-1]:null,x<C.length-1?C[x+1]:null]}const h=r?.pages.flatMap(C=>C)??[];return[!0,null,null,h.length===0?null:h[0]]},[r,n]);return p.useEffect(()=>{!c&&o&&f&&d&&l()},[c,o,f,d,l]),p.useEffect(()=>{!m&&a&&ue(t)},[m,a,t]),{historicalTextdocVersion:m,nextHistoricalTextdocVersion:T,prefetchHistoricalTextdocVersion:u,previousHistoricalTextdocVersion:v}}function Jt(t,e=null){return["textdocHistory",t,e]}function It(t,e,n=!0){return{queryKey:Jt(t,e),queryFn:({pageParam:s})=>rr(t,s),initialPageParam:e??void 0,getNextPageParam:s=>{const o=ts(s)?.versionInt;if(o&&o>1)return o},enabled:n,staleTime:1/0,retry:2}}async function rr(t,e){return e===void 0?[]:(await _t.safeGet("/textdoc/{textdoc_id}/history",{parameters:{path:{textdoc_id:t},query:{before_version:e}}})).previous_doc_states.map(({id:s,version:o,textdoc_type:r,title:a,content:l,updated_at:f,comments:c})=>({textdocId:s,versionInt:o,messageId:null,title:a,type:ns(r),content:l,status:ss.COMPLETE,createdAt:os(f),comments:rs(c,l)}))}const wr=({isFullScreen:t=!1,isEmbedded:e=!1,hideHeader:n=!1,readonlyReason:s,clientThreadId:o,focusedTextdoc:r,onClose:a,isAnimating:l=!1,width:f,hideBottomComposer:c=!1})=>{const{textdocId:u,history:d,showChangesAtVersion:m=null}=r,T=Ut(),[v,h,C]=sr(u),{targetedContent:x}=as(),g=is(),[b,y]=p.useState(!1),M=ls(u),k=cs(),D=us(o),S=fs(D),[q,U]=$t(),F=ds(),{data:N,isLoading:J}=ms(u,F?m:null),[B,Ie]=p.useState(!1),L=M?.versions??[],Je=L[0]?.versionInt,{historicalTextdocVersion:pe,nextHistoricalTextdocVersion:Wt,previousHistoricalTextdocVersion:We,prefetchHistoricalTextdocVersion:Qt}=or(u,Je,d),Xt=qt();p.useEffect(()=>{ke.reset()},[u]);const Qe=L.length>0?L[L.length-1]:null,_e=L.length>1?L[L.length-2]:null,Xe=hs(o),{restoreHistoricalTextdocVersion:Ze,optimisticRestoredTextdocVersion:Zt}=ps(Xe,Qe,pe),te=d!=null,E=te?pe:Qe,ge=F&&m!=null,ve=Xo(o,E),Ke=l||!F?null:N,Ce=(()=>{if(l||E==null)return[];const w=Ct(E.comments);return!ge&&pe!=null?pe.comments:!ge||N==null?w:N.contentBefore!==N.contentAfter?[]:Io(N.commentsBefore,N.commentsAfter)})(),z=E?.type??j.LOADING,Kt=gs(),ne=Pt(E),je=Lt(E),en=vs(E),tn=Ys(k);p.useEffect(()=>{L.length===0&&!k&&tn&&a?.()},[L.length,k]);const nn=!!s&&s!==_.OldVersion,{content:G,currentlyStreamingLineIndex:et}=N?.contentBefore!=null&&!le(z)?{content:N.contentBefore,currentlyStreamingLineIndex:null}:No(E,_e),sn=Vs(Xe,Array.from(Ko(G))),[xe,Re]=eo({value:G,isRequestActive:S,isTextdocStreaming:ne,comments:Ce}),tt=Cs(E);p.useEffect(()=>{u&&ht().sendMessage({type:qe.Loaded})},[u]);const nt=Kt===xs.LAST_TURN||xe||C;p.useEffect(()=>{ht().sendMessage({type:qe.Streaming,streaming:nt})},[nt]);const on=({getSerializedDocument:w,getAdjustedComments:A})=>{E&&v(E,w,A)},rn=w=>{if(!E)return;const A=w.doc.toString();v(E,A,w.field(Ms,!1)??[])},st=(w,A,V,Q)=>{Re(!0),ve({action:A,content:w,userMessageType:R.ASK_CHATGPT,sourceRange:V,selectionMetadata:{selection_type:Q,selection_position_range:V}})},ot=({id:w})=>{tt(w,pt.DISMISS),ke.reset()},rt=async w=>{Re(!0);const{id:A,at:V,content:Q}=w;if(await tt(A,pt.ACCEPT)===!1)return Re(!1);ve({content:Q,userMessageType:R.ACCEPT_COMMENT,sourceRange:V,action:X.EDIT,selectionMetadata:{selection_type:gt.SELECTION,selection_position_range:V}})},Oe=(w,A,V)=>{const{action:Q}=V;ve({action:Q,content:A,sourceRange:w,userMessageType:R.ACCELERATOR,acceleratorMetadata:{action:Q,id:V.id,prompt:A},selectionMetadata:w!=null?{selection_type:gt.SELECTION,selection_position_range:w}:void 0})},an=w=>{ve({action:X.EDIT,content:w,userMessageType:R.FULL_SCREEN_SUBMIT})},ln=Sn(),cn=jt(),un=ys(),at=w=>un?.[w]??w,Pe=()=>Ts({clientThreadId:o,currentRequestId:D,queryClient:cn,isHistoryAndTrainingDisabled:ln}),fn=()=>{d?be(u,d):ue(u)};let I=s;te?I=_.OldVersion:ge?I=_.ShowingChanges:Zt!=null?I=_.Restoring:(ne||S)&&(I=_.Streaming);let ye=null;const it=l||I!=null||xe,lt=()=>{if(l&&Ce.length>0)return oe.ALL_HIDDEN;if(I==null)return oe.ENABLED;switch(I){case _.Streaming:return oe.ENABLED;case _.ShowingChanges:case _.OldVersion:return oe.COMMENTS_READONLY;default:return oe.ALL_HIDDEN}},ct=t||l;let Le=[];switch(z){case j.LOADING:ye=i.jsx(ks,{});break;case j.DOCUMENT:ye=i.jsx(Ss,{value:G,comments:Ce,previousValue:_e?.content,previousComments:Ct(_e?.comments),isRewriting:je,isAnimatingFromPreview:l,getStableCommentId:at,diff:Ke,isRequestActive:S,isDisabled:I!=null||k,isWaitingForCommentResponse:xe,hideAccelerators:ct,hideToolbar:it,hideEditOverlay:l,commentsMode:lt(),readonlyReason:I,onBlur:h,onSave:h,onChange:on,onCancelRequest:Pe,targetedContent:x,onAddComment:st,onAcceptComment:rt,onDismissComment:ot,onSubmitAccelerator:Oe,onExitShowChanges:fn,safeUrls:sn,width:f,modelCursor:ne&&!je?E?.modelCursor:void 0,shouldResetSelection:E?.versionInt===1}),Le=Fs;break;default:if(le(z)){const w=Ue(z,G),A=i.jsx(bs,{id:"codemirror",getStableCommentId:at,language:Rt(z),value:G,comments:Ce,hideAccelerators:ct,commentsMode:lt(),hideToolbar:it,onSubmitAccelerator:Oe,currentlyStreamingLineIndex:et??null,readonlyReason:I,isRequestActive:S,isWaitingForCommentResponse:xe,onChange:rn,onCancelRequest:Pe,onAddComment:st,onDismissComment:ot,onAcceptComment:rt,textdocDiff:Ke??void 0,modelCursor:ne&&et==null?E?.modelCursor:void 0});ye=!T||!w?A:i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{display:B?"none":"block"},children:A}),i.jsx(Ks,{hidden:!B,isStreaming:ne,textdocContent:G,textdocType:z})]}),Le=As}}const dn=p.useRef(null),mn=()=>{Ue(z,G)?Ie(w=>!w):dn.current?.runCode(z,G)};return i.jsxs(ie,{children:[!n&&i.jsx($o,{textdocId:u,isHistoricalVersion:te,nextHistoricalTextdocVersion:Wt,previousHistoricalTextdocVersion:We,textdocVersion:E,readonlyReason:I,history:d,hasDebug:g,contentWidth:q.width,isEmbedded:e,isPersisting:C,isShowChangesFeatureEnabled:F,isShowingChanges:ge,latestVersionInt:Je,hideHistoryActions:I===_.QueryParam,prefetchHistoricalTextdocVersion:()=>{Qt();const w=We?.versionInt;w!=null&&Xt(u,w)},restoreHistoricalTextdocVersion:Ze,setShowDebugView:y,onClose:()=>{O.logButtonClick(ce.CLOSE_TEXTDOC,{textdocType:E?.type}),a?.()},onClickCodePreview:mn,isShowingCodePreview:B}),i.jsxs(ie.Content,{ref:U,scrollToBottomMode:en?"bottom":"top",shouldScrollToTop:je,isLoading:J,children:[!1,ye]}),!1,i.jsx(Ot,{children:te&&!nn&&i.jsx(to,{onClickRestore:Ze,onClickResetLatest:()=>ue(u)})}),t&&!te&&!c&&i.jsx(vo,{isRequestActive:S,clientThreadId:o,onSubmitAccelerator:Oe,onSubmit:an,onCancel:Pe,acceleratorActions:Le})]})};export{qe as C,wr as T,Ws as g,Js as i};
//# sourceMappingURL=c3yevlrksv5keue9.js.map
