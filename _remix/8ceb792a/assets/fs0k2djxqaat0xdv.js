const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/fbgn1mb0xz5fk964.js","assets/e3xeno1cu716gcg9.js","assets/lpkv4et7sc41df9j.js","assets/root-ddartmnc.css","assets/j6tvpaphcbh2fuzt.js","assets/j1rh8xoh845awegn.js","assets/jxs547bnb2yoygwx.js","assets/conversation-small-eplmind9.css","assets/e3tfr8ucflf3b9us.js","assets/i03ls2mks41867lg.js","assets/lgx29x6ex8qazm6a.js","assets/lfbvefb6ad632qyb.js","assets/m5pwmfgr53dxm35d.js","assets/oc3sxxhebw1fgvmk.js","assets/3ptiyyug7znu1m29.js","assets/irgrposfj42k93nh.js","assets/ncjjhchb4wc73bld.js","assets/iby7ffhpn0s1ruu6.js","assets/hwp7x6j06bj01jnh.js","assets/gj52c0pvpet7fe83.js","assets/ikl2usntxz66i9a1.js","assets/ovqol5rtsewfgkaj.js","assets/ln7bjo8ug36nvw2o.js","assets/cpcuii40eywhjtfu.js","assets/tv3jbd9obp189rtm.js","assets/lz1490s59y3g06a4.js","assets/jnd0ivhr3ehv056k.js","assets/ibddflef003za457.js","assets/fovws5ax93h1yghp.js","assets/ju55ajx7hr6eobq9.js","assets/n1x5xnwsjwoxhjc7.js","assets/hvc2s79vb33fsx92.js","assets/sso-oprvrxl1huargirm.js","assets/eu5hxh2b1rn9c6gz.js","assets/fo3ayb31yfae4gga.js","assets/goj2bdg35s6563l9.js","assets/ixygh7swweew5j8c.js","assets/d3nlfzubxg5blcy6.js","assets/goraxzayyjqi9oiv.js","assets/hr9gdgti02yhm2pk.js","assets/ccvqjy2jwhxzph2d.js","assets/jg32k44xy4kup00k.js","assets/ch6yrzfdz1ui2zmw.js","assets/lvzzkwcfmok6zn95.js","assets/kqwdyvkaaavvn8k3.js","assets/hjvjwpdfpia9zc68.js","assets/ddezb78tviphx77u.js","assets/m4jczsv1cg97iutp.js","assets/h3o5a6aus3inuud4.js","assets/mc8n67no5tz2id4d.js","assets/oizvvpi3a22xsygd.js","assets/eko311eyemaytf12.js","assets/c4rqlnqhkwe8hc9g.js","assets/fvxei6mnbbduna7a.js","assets/cyu4rhgm62vd5m75.js","assets/iia4z9rmc9qivvkq.js","assets/hmq81er09e347pyd.js","assets/nhwwej1nq0zrd7sc.js","assets/epn6ddupp35hz4r6.js","assets/f3763ndmg1p2sfyp.js","assets/d5izy8szc50xhnhe.js","assets/o8l7ktvtm5cq68e7.js","assets/infhdfhs5hw908cw.js","assets/cuqpnp67jqytqhek.js","assets/llm43q52tldrz8f2.js","assets/huia8uftpyqhrt64.js","assets/mf04rkwl51owazmp.js","assets/isjdmfmhzv09v01t.js","assets/hcd9j2csuz1fm6cs.js","assets/la4in8xwwtiyffes.js","assets/bkvq09zp631oi90u.js","assets/st8s7ss61rg8ps4q.js","assets/e0mv2r5tr25it1kp.js","assets/hge3zeb64h6d53pd.js","assets/epx1309qmpc2vnhh.js","assets/o7ptt9a3a9tgt4ys.js","assets/nnvozga540pn87pr.js","assets/iej0cupg2dqkmejt.js","assets/fq83tluy2hevwcly.js","assets/jk8w36bsokizpx57.js","assets/hcxh7nr7wy5ptwyp.js","assets/ogz3dffgvyg6lnic.js","assets/fds594ltabfzyk26.js","assets/jsy14r1nw44yyyf6.js","assets/hgw9qls5oaho2iv4.js","assets/gqdr7i9f0a5nz77f.js","assets/inwdsmls8rfz0c7g.js","assets/kw9gk4tszyt4wnms.js","assets/emqjmjwrdk9lmwpr.js","assets/fphzy1e86ergks6y.js","assets/carousel-bss5aguy.css","assets/i8l4c6m8msfuvxka.js","assets/nm04jgpfyxi6pn12.js","assets/lkr62729s74635yd.js","assets/bdv5knvg3uk0gdhl.js","assets/ebs4n2k8r0uoq3a9.js","assets/shared-mk6ngktc.css","assets/sso-e9dukfxt.css","assets/mwn2u9dq8qywh0mi.js","assets/bz3qkafcdogaf677.js"])))=>i.map(i=>d[i]);
var yo=Object.defineProperty;var Wn=t=>{throw TypeError(t)};var vo=(t,e,s)=>e in t?yo(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var X=(t,e,s)=>vo(t,typeof e!="symbol"?e+"":e,s),nn=(t,e,s)=>e.has(t)||Wn("Cannot "+s);var i=(t,e,s)=>(nn(t,e,"read from private field"),s?s.call(t):e.get(t)),G=(t,e,s)=>e.has(t)?Wn("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),I=(t,e,s,a)=>(nn(t,e,"write to private field"),a?a.call(t,s):e.set(t,s),s),j=(t,e,s)=>(nn(t,e,"access private method"),s);var bs=(t,e,s,a)=>({set _(o){I(t,e,o,s)},get _(){return i(t,e,a)}});import{H as qe,cs as bt,j as n,N as Le,aC as Rs,en as Ut,fd as wa,bD as So,r as m,aD as _a,R as De,ag as Ps,c as te,e4 as os,P as J,A as Z,K as R,cm as yt,c2 as vt,as as is,aN as Ds,B as zt,bw as wo,aU as _o,fH as Co,cN as xe,cA as Mo,ax as ko,bt as Rt,cq as jn,fI as To,L as jo,ak as Ue,fJ as Ca,e8 as Ma,c8 as it,cD as Ao,cE as No,cH as Zt,a7 as hn,cF as Hn,cG as Eo,J as ft,fK as Io,cK as ka,aQ as ks,a_ as Fo,cz as Ta,O as $e,d9 as Ro,ai as Yt,fq as Po,cX as Xt,ee as Ts,bz as Do,aM as An,bM as ie,fC as Vn,bQ as at,w as Lo,fB as Oo,fL as ja,fp as Uo,u as zo,E as Aa,dl as Bo,a4 as qn,fM as Go,fN as Wo,bB as Ho,cx as Vo,fO as qo,c$ as $o,d0 as Qo,d1 as Ko,ei as Yo,fP as $n,fn as Xo,bA as Jo,aT as Zo,bo as ei}from"./e3xeno1cu716gcg9.js";import{d as Ls,H as Na,c as Nn,A as ti,I as si,S as ni,G as ai,z as oi,u as ii,a as ri,J as li,m as ci,K as di,f as ui}from"./i03ls2mks41867lg.js";import{G as hi,T as mi}from"./ovqol5rtsewfgkaj.js";import{hL as Ea,ct as En,cs as In,cv as Fn,n as Os,b5 as Rn,hM as gi,x as Ia,eD as Qn,A as Fa,eI as fi,bM as Ra,aC as Pa,gu as Da,hN as pi,dN as xi,av as bi,hO as yi,a8 as vi,cz as Si,c8 as wi,eB as _i,u as ts,hP as js,dR as La,er as Ci,a3 as Mi,hQ as Oa,dV as As,es as ki,ak as rs,aY as Ti,bU as mn,a6 as ji,hR as Ai,aX as ws,eG as Ni,aQ as gn,hS as Ei,hT as Ii,fX as Fi,Y as Ua,b4 as za,gs as Ri,p as Ba,hU as Ga,hV as Pi,Z as Di,hW as Li,q as Ns,ao as ot,bw as Es,b$ as Pn,eM as Oi,hX as Ui,eJ as Wa,a1 as zi,hY as Bi,hZ as Gi,cN as Wi,b3 as Hi,h_ as Vi,h$ as qi,i0 as $i,i1 as Qi,i2 as Ki,i3 as Yi,i4 as Xi,i5 as Ji,i6 as Zi,eE as er,k as tr,l as sr,i7 as nr,eC as ar,B as or,ab as ir,cQ as rr,i8 as Kn,hv as Yn,i9 as lr,g6 as cr,bm as dr,ia as ur,ev as hr,ew as mr,r as gr,ib as fr,gB as Xn,ic as pr,id as xr,ie as br,P as yr,ig as vr,ih as Sr,ii as wr,ij as _r,ik as Cr,il as Mr,im as kr}from"./jxs547bnb2yoygwx.js";import{a as Tr,t as fn,T as Ha,H as jr,b as Ar,c as Nr,d as Er,e as Ir,M as pn}from"./gj52c0pvpet7fe83.js";import{P as Fr,v as Rr,C as xn,w as Pr,l as Dr,x as an,y as Lr,u as Or,z as on,F as Ur,T as zr}from"./f3763ndmg1p2sfyp.js";import{e as Br,i as es,A as Va,T as z,f as St,g as Dn,u as Ln,b as Gr,L as qa,d as Us,c as zs,M as Jn,j as Zn,N as Wr,q as Bs,a as Hr,O as Vr,P as qr,Q as $r,k as Qr,h as Kr,R as Yr,S as Xr,U as $a,D as Qa,V as Jr,W as Zr,w as Ka,X as Ya}from"./lgx29x6ex8qazm6a.js";import{W as el,G as tl,H as sl,I as On}from"./infhdfhs5hw908cw.js";import{m as Ot}from"./lfbvefb6ad632qyb.js";import{U as nl,b as Xa,bd as Gs,br as al,bb as ol,bS as Ja,bT as Za,a4 as il,bU as rl,bV as ll,aE as cl,bW as dl,w as ul,ax as eo,ay as to,a as hl,aw as ml,av as gl,S as fl,t as pl,bi as xl,bN as bl}from"./lpkv4et7sc41df9j.js";import{H as yl}from"./0hpxwcvw697ey3cb.js";import{G as vl,L as Sl}from"./hwp7x6j06bj01jnh.js";import{d as wl,r as _l}from"./fovws5ax93h1yghp.js";import{T as Cl,u as Ml,M as so,a as kl,b as Tl,C as jl,W as Al}from"./huia8uftpyqhrt64.js";import{b as Nl,C as El}from"./jnd0ivhr3ehv056k.js";import"./goraxzayyjqi9oiv.js";import{D as ke,$ as no}from"./irgrposfj42k93nh.js";import{a as Il,G as Fl}from"./iby7ffhpn0s1ruu6.js";import{M as Rl}from"./hcxh7nr7wy5ptwyp.js";import{I as Pl}from"./ch6yrzfdz1ui2zmw.js";function rn({label:t,tooltip:e,Icon:s}){return n.jsxs("div",{className:"flex items-center gap-1 text-sm font-semibold opacity-70",children:[s&&n.jsx(s,{className:"icon-sm"}),n.jsx("div",{children:t}),n.jsx(Os,{label:e,children:n.jsx(Xa,{className:"icon-sm ml-1"})})]})}function Dl({clientThreadId:t,gizmoId:e}){const s=qe(),a=Ea(),o=En(),r=In(),{data:l}=Fn(e,!1,r),c=!!e,d=bt(),h=Br(t);return r?d&&(!h||c)?n.jsx(rn,{label:s.formatMessage(Et.temporaryChat),tooltip:s.formatMessage(Et.temporaryChatTooltip),Icon:nl}):a&&!o&&!d?n.jsx(rn,{label:s.formatMessage(Et.memoryOff),tooltip:s.formatMessage(Et.memoryOffTooltip)}):l&&(l==null?void 0:l.memoryFullPct)>=100?n.jsx(rn,{label:s.formatMessage(Et.memoryFull),tooltip:s.formatMessage(Et.memoryFullTooltip)}):null:null}const Et=Le({temporaryChat:{id:"ConversationPrivacyIndicator.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatTooltip:{id:"ConversationPrivacyIndicator.temporaryChatTooltip",defaultMessage:"Temporary Chats won't appear in your history, and ChatGPT won't remember anything you talk about."},memoryOff:{id:"ConversationPrivacyIndicator.memoryOff",defaultMessage:"Memory Off"},memoryOffTooltip:{id:"ConversationPrivacyIndicator.memoryOffTooltip",defaultMessage:"ChatGPT won't remember anything you talk about in this conversation."},memoryFull:{id:"2Eq+5y",defaultMessage:"Memory Full"},memoryFullTooltip:{id:"dNA8jQ",defaultMessage:"ChatGPT's memory is full. You can forget existing memories to make space."}}),ea=4;function Ll(t){const{layer:e}=Rs("4031588851"),{layer:s}=Ut("4031588851");return t?e.get("enable_new_homepage",!1):s.get("enable_new_homepage",!1)}function Ol(){const{layer:t}=Ut("4031588851"),e=t.get("autocomplete_qualified_start_date","2099-09-13T00:00:00Z"),s=Rn();return!!s&&s.created*1e3>=new Date(e).getTime()}function Ul(t){const{layer:e}=Rs("3533083032"),{layer:s}=Ut("3533083032");return t?e.get("enable_new_homepage_anon",!1):s.get("enable_new_homepage_anon",!1)}function zl(t){const{layer:e}=Rs("4031588851"),{layer:s}=Ut("4031588851");return t?e.get("enable_new_autocomplete_homepage",!1):s.get("enable_new_autocomplete_homepage",!1)}function Bl(t){return n.jsx(el,{children:e=>n.jsx(Gl,{...t,composerController:e})})}function Gl({clientThreadId:t,currentModelId:e,onRequestCompletion:s,composerController:a,v2HomepageDisclaimer:o}){const r=es(t),l=Va(t),c=wa(),d=So(),[h,p]=m.useState([]),f=m.useRef(!1);gi(a);const x=_a("589604007").value,{layer:v}=Ut("4031588851"),{promptStarters:y,isSuccess:g,isError:S}=Tr(r&&!l,t,d?4:8,x,!0,e),u=!!h.find(A=>!!A.requires_file_upload),b=m.useCallback(A=>{const w=a.getCurrentText();return w&&`${A.title}${A.body}`.toLowerCase().startsWith(w.toLowerCase())},[a]),_=m.useCallback(A=>{const w=a.getCurrentText(),V=A.title+A.body;return b(A)?{...A,title:w,body:V.slice(w.length)}:{...A,title:V,body:""}},[a,b]),C=m.useCallback((A=!1)=>{p(w=>!w.some(b)&&w.length>0?[]:A?w:w.map(_))},[b,_]),T=(A,w,V)=>{const W=`${A.title} `;p([]),a.focus(),a.setText(W),requestAnimationFrame(()=>{const B=((y==null?void 0:y.filter(q=>q.theme===A.theme))??[]).map(q=>({...q,title:`${q.title} `,type:Qn.Autocomplete}));p(B),B.length>0&&fn(B,t),Ar(A,V,t)})},D=y==null?void 0:y.reduce((A,w)=>(w.theme&&!A[w.theme]&&(A[w.theme]=w),A),{}),N=[];if(D)for(const A in D)N.push(D[A]);const H=N&&N.length>0,O=!!(g&&H),k=ea-h.filter(b).length,P=v.get("autocomplete_mode","HARDCODED"),U=m.useCallback(Ia(async A=>{const w=a.getCurrentText();if(!w||w.length<2||w.length>80){p([]);return}if(!f.current)try{const W=(await De.generateAutocompletions(w,A)).completions.map(B=>({id:Ps(),type:Qn.Autocomplete,title:w,body:B.slice(w.length),oneliner:B,prompt:B})).filter(b).map(_);p(B=>{const q=B.filter(b),Te=W.filter(be=>!q.some(ue=>ue.title===be.title&&ue.body===be.body)).slice(0,ea-q.length);return[...q,...Te]}),W.length>0&&fn(W,t)}catch{}},P==="BING"?150:200),[a,P,_]),E=m.useCallback(()=>{C(),k>0&&U(k)},[U,C,k]);m.useEffect(()=>{f.current&&p([])},[f]);const se=m.useMemo(()=>P==="HARDCODED"?C:E,[P,E,C]),ee=m.useCallback(()=>{a instanceof tl&&C(!0),a.getCurrentText().indexOf(`
`)>0&&p([])},[a,C]);return n.jsx(n.Fragment,{children:n.jsx(Fa,{children:(S||g)&&n.jsx(n.Fragment,{children:n.jsx(Ha,{isStaticSharedThread:!1,showInlineEmbeddedDisplay:!1,withVerticalPadding:!0,withHorizontalPadding:!0,clientThreadId:t,children:n.jsxs(jr,{children:[n.jsx(Wl,{}),n.jsx("div",{className:"w-full",children:n.jsx(Fr,{clientThreadId:t,isNewThread:r,currentModelId:e,onRequestCompletion:s,showPromptStarters:!1,composerController:a,autocompletions:h,requiresFileUpload:u,onComposerInput:se,onComposerChange:ee,onAutocompleteSelect:(A,w,V)=>{p([w[V]])},onTaggingDropdownClose:()=>{f.current=!1},onTaggingDropdownOpen:()=>{f.current=!0},hideHeader:!0})}),O&&n.jsx(Hl,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},promptStarters:N,onSelectStarterPrompt:T,isSendBlocked:c,clientThreadId:t,className:o?"":"h-8"}),o&&n.jsx("div",{className:"relative mt-5 w-full px-2 py-2 text-center text-xs text-token-text-tertiary empty:hidden md:px-[60px]",children:n.jsx("div",{className:"min-h-4",children:o})})]})})})})})}function Wl(){const{layer:t}=Ut("4031588851"),e=t.get("headline_option","HELP_WITH"),a=qe().formatMessage(e==="WHERE_TO_START"?bn.whereShouldWeStart:bn.whatCanIHelpWith),[o,r]=m.useState(1),[l,c]=m.useState(!0),d=20;return m.useEffect(()=>{let h;return o<a.length?h=setTimeout(()=>{r(o+1)},d):l&&(h=setTimeout(()=>{c(!1)},500)),()=>clearTimeout(h)},[a,o,l]),n.jsx("div",{className:"text-center",children:n.jsxs("div",{className:"mb-7 inline-flex justify-center text-2xl font-semibold leading-9",children:[n.jsx("h1",{children:a.substring(0,o)}),n.jsx("h1",{className:"result-streaming transition-opacity",style:{opacity:l?1:0},children:n.jsx("span",{})})]})})}function Hl({promptStarters:t,onSelectStarterPrompt:e,isSendBlocked:s,clientThreadId:a,...o}){return n.jsx(Ot.div,{...o,children:n.jsx(Ql,{starterPrompts:t,onSelectStarterPrompt:e,disabled:s,clientThreadId:a})})}const Vl=/\s/;function ql({starterPrompt:t,starterPrompts:e,index:s,disabled:a,onSelectStarterPrompt:o}){const r=t.theme??t.title,l=Vl.test(r);return n.jsxs("button",{className:"relative flex items-center gap-1.5 rounded-full border border-token-border-light px-3 py-2 text-start text-[13px] shadow-xxs transition enabled:hover:bg-token-main-surface-secondary disabled:cursor-not-allowed xl:gap-2 xl:text-[14px]",disabled:a,onClick:()=>o(t,e,s),children:[n.jsx(fi,{starterPrompt:t,useV2Colors:!0}),n.jsx("div",{className:te("max-w-full text-balance text-gray-600 dark:text-gray-500",l?"break-word":"break-all"),children:r})]})}function ta({starterPrompts:t,onSelectStarterPrompt:e,disabled:s,clientThreadId:a,children:o}){return m.useEffect(()=>{fn(t,a)},[a]),n.jsxs("ul",{className:"flex max-w-3xl flex-wrap items-stretch justify-center gap-2 xl:mx-3 xl:gap-2.5",children:[t.map((r,l)=>n.jsx(Ot.li,{initial:{opacity:0},animate:{opacity:1},transition:{delay:l*.03},exit:{opacity:0},children:n.jsx(ql,{starterPrompt:r,starterPrompts:t,index:l,disabled:s,onSelectStarterPrompt:e})},r.id??l)),o]})}function $l({clientThreadId:t,onClick:e}){m.useEffect(()=>{Nr(t)},[t]);const s=qe();return n.jsx("button",{className:"relative flex max-w-full items-center gap-2 text-balance rounded-full border border-token-border-light px-3 py-2 text-start text-[14px] text-gray-600 shadow-xxs transition enabled:hover:bg-token-main-surface-secondary disabled:cursor-not-allowed dark:text-gray-500",onClick:()=>{Er(t),e()},children:s.formatMessage(bn.moreStarterPrompts)})}function Ql({starterPrompts:t,onSelectStarterPrompt:e,disabled:s,clientThreadId:a}){const[o,r]=m.useState(4),l=4,c=t.slice(0,l),d=t.slice(l,o).map(h=>({...h,isAdditional:!0}));return n.jsxs("div",{className:"mt-7 flex flex-col flex-wrap gap-y-2.5",children:[n.jsx("div",{children:n.jsx(ta,{starterPrompts:c,onSelectStarterPrompt:e,disabled:s,clientThreadId:a,children:t.length>o&&n.jsx($l,{clientThreadId:a,onClick:()=>{r(t.length)}})})}),d&&d.length>0&&n.jsx(ta,{starterPrompts:d,onSelectStarterPrompt:e,disabled:s,clientThreadId:a})]})}const bn=Le({whatCanIHelpWith:{id:"SplashScreenV2.whatCanIHelpWith",defaultMessage:"What can I help with?"},whereShouldWeStart:{id:"SplashScreenV2.whereShouldWeStart",defaultMessage:"Where should we start?"},moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}});function Kl({children:t}){const e=Ra(Pa.AG8PqS2q),{eligible:s,isLoading:a}=wl(),{doesUserHaveAnyAccountsWithPlusFeatures:o}=os(),r=s&&!a;if(m.useEffect(()=>{r&&J.logEvent(Z.gpt4oNUXTooltipShown)},[r]),!r)return n.jsx(n.Fragment,{children:t});const l=()=>{J.logEvent(Z.gpt4oNUXTooltipDismissed),e.markAsViewed()};return n.jsx(Da,{side:"bottom",show:!0,title:n.jsx(R,{...ln.title,values:{modelName:"GPT‑4o"}}),onDismiss:l,sideOffset:0,theme:"default",description:n.jsx(R,{...o?ln.bodyPaidFinal:ln.bodyFreeFinal,values:{modelName:"GPT‑4o",anotherModelName:"GPT‑4"}}),children:t})}const ln=Le({title:{id:"1kewDD",defaultMessage:"Introducing {modelName}"},bodyPaidFinal:{id:"Z6KHqN",defaultMessage:"You can now try our newest model, {modelName}. It’s faster than {anotherModelName}, better at understanding images, and speaks more languages."},bodyFreeFinal:{id:"w8Y79o",defaultMessage:"You now have limited access to our latest model, {modelName}. It’s smarter, understands images, can browse the web, and speaks more languages."}}),Yl=yt(()=>vt(()=>import("./fbgn1mb0xz5fk964.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31])).then(t=>t.GizmoUsingAsOwnerNotice)),Xl=({clientThreadId:t})=>{const e=vi(d=>d.activeStageSidebar),s=z.getServerThreadId(t),a=Si(Ds.WorkspaceShareLinks),{isUnauthenticated:o}=zt(),r=bt(),l=a&&s&&!o&&!r,c=!e;return n.jsx("div",{className:"flex items-center gap-2 pr-1 leading-[0]",children:n.jsx(El,{showShareButton:l,showProfileDropdown:c,clientThreadId:t})})};function Jl({clientThreadId:t,gizmoId:e}){var r;const s=pi(),{data:a}=Ls(e),o=is();return n.jsxs(n.Fragment,{children:[n.jsxs(xi,{className:"max-md:hidden",children:[n.jsxs("div",{className:"absolute start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2",children:[a!=null&&(o==null?void 0:o.isWorkspaceAccount())&&((r=a.gizmo.tags)==null?void 0:r.includes(bi.WorkspaceDisabled))&&n.jsx(Yl,{gizmo:a}),n.jsx(Dl,{gizmoId:e,clientThreadId:t})]}),n.jsx(Kl,{children:n.jsxs("div",{className:"flex items-center gap-0 overflow-hidden",children:[n.jsx(Nl,{clientThreadId:t}),n.jsx(Cl,{clientThreadId:t})]})}),n.jsx(Xl,{clientThreadId:t})]}),s&&n.jsx(yi,{})]})}function ao({clientThreadId:t}){const e=St(t);return Dn()?null:n.jsx(Jl,{gizmoId:e,clientThreadId:t})}function Zl({clientThreadId:t,currentModelId:e,onRequestCompletion:s,enableV2Homepage:a,v2HomepageDisclaimer:o}){const r=bt();let l=n.jsx(Sl,{}),c;return r?(c=n.jsx(ec,{}),l=n.jsx(_o,{className:"mb-6 h-12 w-12"})):t!=null?(c=a?n.jsx(Bl,{clientThreadId:t,currentModelId:e,onRequestCompletion:s,v2HomepageDisclaimer:o}):n.jsx(Ir,{clientThreadId:t}),l=null):c=n.jsx(tc,{}),n.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-token-text-primary",children:[l,c]})}function ec({gizmo:t}){const e=Ea(),s=t?sl(t.tools):!1,a=is();return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"mb-5 text-2xl font-semibold",children:n.jsx(R,{...mt.temporaryChat})}),n.jsxs("div",{className:"max-w-sm text-center text-sm font-normal text-token-text-tertiary",children:[n.jsx(R,{...a!=null&&a.isWorkspaceAccount()?e?mt.temporaryChatBizMemoryAvailable:mt.temporaryChatBizMemoryUnavailable:e?mt.temporaryChatDescriptionMemoryAvailable:mt.temporaryChatDescriptionMemoryUnavailable}),s&&n.jsx("div",{className:"mt-3",children:n.jsx(R,{...mt.temporaryChatDescriptionGptActions,values:{link:o=>n.jsx("a",{href:"https://help.openai.com/en/articles/8914046-temporary-chat-faq",target:"_blank",className:"underline",rel:"noreferrer",children:o})}})})]})]})}function tc(){return n.jsx("div",{className:"mb-5 text-2xl font-semibold",children:n.jsx(R,{...mt.howCanIHelpYouToday})})}function sc({clientThreadId:t,currentModelId:e,onRequestCompletion:s,enableV2Homepage:a,v2HomepageDisclaimer:o}){const r=St(t),l=wi(),c=wa(),{data:d}=Ls(r),h=_i(),p=wo(()=>navigator.windowControlsOverlay);return(l!=null||r!=null)&&d==null?null:n.jsxs("div",{className:"relative h-full",children:[n.jsx("div",{className:p!=null&&p.visible?te("absolute right-[calc(100dvw-env(titlebar-area-width,100dvw)-env(titlebar-area-x,0))]",h?"left-[env(titlebar-area-x,0)]":"left-0"):"absolute left-0 right-0",children:n.jsx(ao,{clientThreadId:t})}),d!=null?n.jsx(vl,{gizmo:d,showStarterPrompts:!0,disableStarterPrompts:c}):n.jsx(Zl,{clientThreadId:t,currentModelId:e,onRequestCompletion:s,enableV2Homepage:a,v2HomepageDisclaimer:o})]})}const mt=Le({temporaryChat:{id:"GizmoLanding.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatBizMemoryAvailable:{id:"g1opBW",defaultMessage:"This chat won't appear in your history and won't use or create memories."},temporaryChatBizMemoryUnavailable:{id:"fQmbtG",defaultMessage:"This chat won't appear your conversation history."},temporaryChatDescriptionMemoryAvailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryAvailable",defaultMessage:"This chat won't appear in history, use or create memories, or be used to train our models. For safety purposes, we may keep a copy for up to 30 days."},temporaryChatDescriptionMemoryUnavailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryUnavailable",defaultMessage:"This chat won't appear in history or be used to train our models. For safety purposes, we may keep a copy of this chat for up to 30 days."},temporaryChatDescriptionGptActions:{id:"GizmoLanding.temporaryChatDescriptionGptActions",defaultMessage:"Any data shared with a third party through GPT actions are subject to the third party's privacy policy. <link>Learn more</link>"},howCanIHelpYouToday:{id:"GizmoLanding.howCanIHelpYouToday",defaultMessage:"How can I help you today?"}});function oo(t){const s=Ln(t)==="root",a=Gr(t),o=ts(a),{serviceStatus:r}=m.useContext(Co),l=js(),{isUnauthenticated:c}=zt(),d=qa(t);return!s&&!o&&!(r!=null&&r.oof)&&!l.displayingSideBySideFeedback&&!c&&!d}const io=({clientThreadId:t,message:e})=>{var b,_,C,T,D,N,H,O;const s=Ml(),a=Na(),o=Ra(Pa.ModelSwitcherAutoDowngrade),{categories:r}=Nn({isRegen:!0}),l=ti({clientThreadId:t}),{doesUserHaveAnyAccountsWithPlusFeatures:c}=os(),d=si()!=null,h=[];for(const k of r){if(La(k))continue;const{defaultModel:P,label:U,tagline:E,categoryId:se,subscriptionLevel:ee,subcategory:A}=k,w=(_=(b=l[P])==null?void 0:b.regenerate)==null?void 0:_[0];h.push({label:U,value:P,subtitle:E,icon:n.jsx(so,{className:"icon-md h-4 w-4",categoryId:se,type:"filled"}),modelSwitcherDeny:w,subscriptionLevel:ee,subcategory:A})}const p=nc(t,e.nodeId),f=(C=e.message.metadata)==null?void 0:C.model_slug,x=(T=s.find(k=>k.value===f))==null?void 0:T.name,v=f!=null?a[f]:void 0,y=(v==null?void 0:v.enabledTools)||[],g=ac(d,p,f),S=(D=e.message.metadata)==null?void 0:D.model_adjustments,u=c&&o.eligible&&!o.isLoading&&x&&((N=h[0])==null?void 0:N.label)&&x!==((H=h[0])==null?void 0:H.label)&&(S==null?void 0:S.some(k=>k.startsWith("auto:smaller_model")));return{modelOptions:h,modelSlug:f,messageModelEnabledTools:y,animateModelLabelOnRender:g,nuxProps:{shouldRenderNux:u,usedModelName:x,largestModelName:(O=h[0])==null?void 0:O.label,announcement:o}}};function nc(t,e){var l,c;return(c=(l=z.getTree(t).getConversationTurns(e).flatMap(d=>d.messages).filter(d=>d.message.author.role===xe.Assistant&&!Mo(d.message)).reverse()[1])==null?void 0:l.message.metadata)==null?void 0:c.model_slug}function ac(t,e,s){return t&&!e?!0:!!(e&&s!==e)}function oc(){const{doesUserHaveAnyAccountsWithPlusFeatures:t}=os(),{categories:e}=Nn();return!!t||!!e.find(La)}const Ft=({modelSwitcherDeny:t,value:e,label:s,subtitle:a,icon:o,onMouseEnter:r,onMouseLeave:l,onSelect:c,messageModelSlug:d,isHovered:h=!1,shouldShowUpsell:p=!1,className:f,includeCheck:x,includeRegenerate:v,justifyIcon:y,wrapIcon:g=!0})=>{const S=is(),u=!t,b=!u&&!p,_=ko(),C=()=>{if(!p){c==null||c();return}J.logEvent(Z.openModalAccountPaymentfromMessageModelPicker),J.logRateLimitGetPlusButtonClicked({type:jn.RATE_LIMIT,location:"message_model_switcher_dropdown",plan_type:(S==null?void 0:S.planType)??"unknown",is_hard_block:!1,hard_block_reason:"",is_new_conversation:!1}),Mi(_,"Message model switcher dropdown")};return n.jsx(ke.Item,{onSelect:C,onMouseEnter:()=>u&&(r==null?void 0:r()),onMouseLeave:()=>u&&(l==null?void 0:l()),disabled:b,className:f??"radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed radix-disabled:hover:bg-transparent",children:n.jsxs(Os,{label:t&&n.jsx(Ci,{modelSwitcherDeny:t}),className:"flex w-full items-center justify-between gap-2",sideOffset:0,children:[n.jsxs("div",{className:te("flex items-center gap-3",y==="right"&&"w-full"),children:[!!o&&(g?n.jsx("span",{className:te("flex h-7 w-7 items-center justify-center rounded-full bg-token-main-surface-secondary",y==="right"&&"order-10 ml-auto"),children:o}):o),n.jsxs("div",{children:[n.jsx("div",{children:s}),n.jsx("div",{className:te({"text-sm text-token-text-secondary":!b},{"text-sm text-token-text-quaternary":b}),children:a})]})]}),p?n.jsx(Rt,{color:"secondary",size:"small",children:n.jsx(R,{id:"54fmrA",defaultMessage:"Get Plus"})}):n.jsx(ic,{messageModelSlug:d,isHovered:h,modelSwitcherDeny:t,optionModelSlug:e,includeCheck:x,includeRegenerate:v})]})})},ic=({modelSwitcherDeny:t,optionModelSlug:e,isHovered:s,messageModelSlug:a,includeRegenerate:o=!0,includeCheck:r=!0})=>{let l=null;if(t)switch(t.reason){case jn.RATE_LIMIT:l=ol;break;default:l=Xa;break}if(t)return n.jsx(l,{className:"icon-md"});const c=!!o&&n.jsx(Gs,{className:te("icon-md hidden text-token-text-tertiary",{"group-hover:block":s})});return a===e&&r?n.jsxs(n.Fragment,{children:[n.jsx(al,{className:te("icon-md text-token-text-primary",{"group-hover:hidden":s})}),c]}):c};function rc({className:t,clientThreadId:e,message:s,onModelSelect:a,onDropdownChange:o}){var A;const r=qe(),[l,c]=m.useState(null),[d,h]=m.useState(!1),[p,f]=m.useState(!1),x=oc(),v=oo(e),y=St(e),g=io({clientThreadId:e,message:s}),S=(A=s.message.metadata)==null?void 0:A.model_slug,{modelOptions:u,modelSlug:b,animateModelLabelOnRender:_,nuxProps:C,messageModelEnabledTools:T}=g,D=Oa(s.message),N=T.includes(As.Search),H=m.useMemo(()=>u.find(w=>w.value==S),[u,S]),{doesUserHaveAnyAccountsWithPlusFeatures:O}=os(),k=m.useRef(null),P=w=>{w||setTimeout(()=>{k.current&&k.current.blur()},10)};if(m.useEffect(()=>{P(d)},[d]),!x||y)return null;const U=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:r.formatMessage(sa.search),icon:n.jsx(Ja,{className:"icon-sm"}),condition:N&&!D},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:r.formatMessage(sa.nosearch),icon:n.jsx(Za,{className:"icon-sm"}),condition:N&&D}];let E,se;C.shouldRenderNux?(E=cc,se={title:n.jsx(R,{id:"g/+2Hh",defaultMessage:"Optimized your response"}),description:n.jsx(R,{id:"H0Flqm",defaultMessage:"Used {usedModelName} for a faster response that saves your limited {largestModelName} messages",values:{usedModelName:C.usedModelName,largestModelName:C.largestModelName}}),markAsViewed:C.announcement.markAsViewed}):(E=lc,se={label:v?n.jsx(R,{id:"LBYK9a",defaultMessage:"Change model"}):n.jsx(R,{id:"nygjPN",defaultMessage:"Used {modelName}",values:{modelName:C.usedModelName}})});const ee=v&&u.some(w=>ss(w,O));return n.jsxs(ke.Root,{onOpenChange:w=>{v&&(h(w),o(w),P(w)),w&&J.logEvent(Z.conversationOpenMessageModelSelector,{has_get_plus_button:ee})},children:[n.jsx(E,{...se,children:n.jsx(no,{ref:k,className:te("cursor-pointer",t),onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:n.jsx(yn,{modelSlug:b,animateModelLabelOnRender:_,isDropdownOpen:d,isRegenerateEnabled:v,isHovered:p})})}),v&&n.jsxs(ke.Content,{className:"z-30 origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[u.map(w=>{var q;const V=ss(w,O),{value:W,...B}=w;return n.jsx(Ft,{value:W,onSelect:()=>a({requestedModelId:W}),onMouseEnter:()=>c(W),onMouseLeave:()=>c(null),isHovered:l===W,messageModelSlug:(q=s.message.metadata)==null?void 0:q.model_slug,shouldShowUpsell:V,...B},W)}),!!H&&n.jsxs(n.Fragment,{children:[n.jsx(ke.Separator,{}),U.filter(w=>w.condition).map(w=>n.jsx(Ft,{onSelect:()=>a({requestedModelId:H.value,extraStreamParams:w.extraStreamParams}),includeRegenerate:!0,onMouseEnter:()=>c(w.key),onMouseLeave:()=>c(null),isHovered:l===w.key,messageModelSlug:S,includeCheck:!1,...H,label:w.label,subtitle:"",icon:w.icon},w.key))]})]})]})}function yn({modelSlug:t,animateModelLabelOnRender:e,isDropdownOpen:s,isRegenerateEnabled:a,isHovered:o,isRegenLabel:r=!1,animateShortLabel:l,omitIcon:c}){const[d,h]=m.useState("initial"),{categories:p}=Nn({isRegen:!!r});m.useEffect(()=>{if(e){const u=setTimeout(()=>h("show"),500),b=setTimeout(()=>h("initial"),2e3);return()=>{clearTimeout(u),clearTimeout(b)}}h("initial")},[e]);const f=p.find(({defaultModel:u})=>u===t),x=t===ni?{categoryId:"gpt_3.5",shorterLabel:"3.5"}:{},{categoryId:v,shorterLabel:y}=f??x,g={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},S=s?"visible":o?"show":d;return n.jsxs(Ot.div,{initial:"initial",animate:S,className:"flex items-center pb-0",children:[!c&&(r?n.jsx(Gs,{className:"icon-md"}):v&&n.jsx(so,{type:"outline",categoryId:v,className:"icon-md h-4 w-4"})),(a||l)&&n.jsx(Ot.span,{className:"overflow-hidden text-clip whitespace-nowrap text-sm",variants:g,transition:{type:"tween",duration:.18},children:y}),a&&n.jsx(il,{className:te("icon-sm",{"text-token-text-quaternary":!o&&!r},{"text-token-text-secondary":o&&!r})})]})}function lc({children:t,label:e}){return n.jsx(Os,{label:e,sideOffset:0,children:t})}function cc({children:t,title:e,description:s,markAsViewed:a}){return n.jsx(Da,{show:!0,side:"bottom",sideOffset:-4,title:e,description:s,badge:"beta",onDismiss:a,dismissOnOutsideClick:!0,children:t})}function ss(t,e){const{modelSwitcherDeny:s,subscriptionLevel:a}=t;return!!s&&s.reason===jn.RATE_LIMIT&&a===To.PLUS&&!e}const sa=Le({search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),dc=m.memo(rc),na=jo.IndepthFeedbackDismissedAt;function uc(){const[t,e]=m.useState(()=>{const a=localStorage.getItem(na);return a?hc(new Date(a)):!1}),s=m.useCallback(()=>{e(!0),localStorage.setItem(na,new Date().toISOString())},[]);return[t,s]}function hc(t){const e=new Date;return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}function mc({clientThreadId:t,conversationLeafId:e,trigger:s,variantIds:a}){const o=a.find(p=>p!==e),r=rs(p=>p.forceIndepthFeedback&&p.forceIndepthFeedbackPrompt),l=Ue.getExperimentValue({experimentName:"4146182738",key:s==="paragen"?"enable_indepth_feedback_paragen":"enable_indepth_feedback_thumbsdown",defaultValue:!1,shouldLogExposure:!1}),c=Ue.getExperimentValue({experimentName:"4146182738",key:s==="paragen"?"indepth_feedback_paragen_prompt":"indepth_feedback_thumbsdown_prompt",defaultValue:"",shouldLogExposure:!1}),d=o?z.getTree(t).getTextFromNode(o):"NONE";return(r||(l?c:"")).replace("{paragen_losing_response}",d)}function gc({clientThreadId:t,conversationLeafId:e,trigger:s,variantIds:a}){const[o,r]=uc(),l=pc({clientThreadId:t}),c=mc({clientThreadId:t,conversationLeafId:e,trigger:s,variantIds:a}),d=()=>{r(),J.logEventWithStatsig(Z.messageIndepthFeedbackDeclined,"chatgpt_indepth_feedback_declined",{trigger:s})},h=()=>{const p=new mn;l(e,{intent:"indepth_feedback"},c,p),J.logEventWithStatsig(Z.messageIndepthFeedbackAccepted,"chatgpt_indepth_feedback_accepted",{trigger:s})};return o||!c?null:n.jsx(Ti,{content:n.jsx(R,{...cn.indepthFeedbackPrompt}),primaryCtaText:n.jsx(R,{...cn.indepthFeedbackAcceptButton}),onPrimaryCtaClick:h,secondaryCtaText:n.jsx(R,{...cn.indepthFeedbackRejectButton}),onSecondaryCtaClick:d})}function fc(t){const e=t.rating==="thumbsDown"?"thumbsDown":ki(["original","new"],t.inlineComparisonRating)?"paragen":void 0,s=rs(o=>o.forceIndepthFeedback);if(!e||s||e==="paragen"||Ue.getExperimentValue({experimentName:"4146182738",key:"enable_indepth_feedback_thumbsdown",defaultValue:!1,shouldLogExposure:!0}))return e}function pc({clientThreadId:t}){const e=m.useContext(Ca),s=Us.getConversationMode(t);return(o,r,l,c)=>{e({type:Ma.Next,promptId:o,eventMetadata:r,focusOnNewCompletion:!0,cancelActiveRequests:!1,completionMetadata:{conversationMode:s},useDefaultModel:!1,appendMessages:[{id:Ps(),author:{role:xe.System},content:{content_type:it.Text,parts:[l]},metadata:{is_indepth_feedback:!0,indepth_feedback_prompt:l}}],turnTracker:c})}}const cn=Le({indepthFeedbackPrompt:{id:"qEHwDx",defaultMessage:"Would you like to tell ChatGPT more about your feedback, so it can improve its responses?"},indepthFeedbackAcceptButton:{id:"IeyTQ7",defaultMessage:"Continue"},indepthFeedbackRejectButton:{id:"+o5xmp",defaultMessage:"Not now"},indepthFeedbackRejectAlwaysButton:{id:"Qdko+f",defaultMessage:"Don't ask again"}});function xc({clientThreadId:t,conversationMode:e}){const s=Rr(t);return({id:o,eventMetadata:r,turnTracker:l,requestedModelId:c,systemMessage:d,juice:h,extraStreamParams:p})=>{const x=z.getTree(t).getConversationTurns(o),v=x==null?void 0:x[(x==null?void 0:x.length)-1].variantIds,y=(v==null?void 0:v.length)===1&&(p==null?void 0:p.forceUseSearch)===void 0,g=y?{...r,intent:"comparison_implicit"}:r;s({id:o,requestedModelId:c,eventMetadata:g,focusOnNewCompletion:!0,variantPurpose:y?"comparison_implicit":"none",conversationMode:e??Us.getConversationMode(t),useDefaultModel:!1,appendMessages:d?[{id:Ps(),author:{role:xe.System},content:{content_type:it.Text,parts:[d]},metadata:{exclude_after_next_user_message:!0}}]:void 0,juice:h,turnTracker:l,extraStreamParams:p})}}const It=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,ro=new Set,vn=typeof process=="object"&&process?process:{},lo=(t,e,s,a)=>{typeof vn.emitWarning=="function"?vn.emitWarning(t,e,s,a):console.error(`[${s}] ${e}: ${t}`)};let Is=globalThis.AbortController,aa=globalThis.AbortSignal;var ya;if(typeof Is>"u"){aa=class{constructor(){X(this,"onabort");X(this,"_onabort",[]);X(this,"reason");X(this,"aborted",!1)}addEventListener(a,o){this._onabort.push(o)}},Is=class{constructor(){X(this,"signal",new aa);e()}abort(a){var o,r;if(!this.signal.aborted){this.signal.reason=a,this.signal.aborted=!0;for(const l of this.signal._onabort)l(a);(r=(o=this.signal).onabort)==null||r.call(o,a)}}};let t=((ya=vn.env)==null?void 0:ya.LRU_CACHE_IGNORE_AC_WARNING)!=="1";const e=()=>{t&&(t=!1,lo("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}const bc=t=>!ro.has(t),et=t=>t&&t===Math.floor(t)&&t>0&&isFinite(t),co=t=>et(t)?t<=Math.pow(2,8)?Uint8Array:t<=Math.pow(2,16)?Uint16Array:t<=Math.pow(2,32)?Uint32Array:t<=Number.MAX_SAFE_INTEGER?_s:null:null;class _s extends Array{constructor(e){super(e),this.fill(0)}}var Pt;const gt=class gt{constructor(e,s){X(this,"heap");X(this,"length");if(!i(gt,Pt))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new s(e),this.length=0}static create(e){const s=co(e);if(!s)return[];I(gt,Pt,!0);const a=new gt(e,s);return I(gt,Pt,!1),a}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}};Pt=new WeakMap,G(gt,Pt,!1);let Sn=gt;var va,Sa,je,Se,Ae,Ne,Dt,oe,Ee,ne,Y,F,fe,we,me,ce,Ie,de,Fe,Re,_e,Pe,nt,pe,M,_n,pt,He,ns,Ce,uo,xt,Lt,as,tt,st,Cn,Cs,Ms,K,Mn,Jt;const Bn=class Bn{constructor(e){G(this,M);G(this,je);G(this,Se);G(this,Ae);G(this,Ne);G(this,Dt);X(this,"ttl");X(this,"ttlResolution");X(this,"ttlAutopurge");X(this,"updateAgeOnGet");X(this,"updateAgeOnHas");X(this,"allowStale");X(this,"noDisposeOnSet");X(this,"noUpdateTTL");X(this,"maxEntrySize");X(this,"sizeCalculation");X(this,"noDeleteOnFetchRejection");X(this,"noDeleteOnStaleGet");X(this,"allowStaleOnFetchAbort");X(this,"allowStaleOnFetchRejection");X(this,"ignoreFetchAbort");G(this,oe);G(this,Ee);G(this,ne);G(this,Y);G(this,F);G(this,fe);G(this,we);G(this,me);G(this,ce);G(this,Ie);G(this,de);G(this,Fe);G(this,Re);G(this,_e);G(this,Pe);G(this,nt);G(this,pe);G(this,pt,()=>{});G(this,He,()=>{});G(this,ns,()=>{});G(this,Ce,()=>!1);G(this,xt,e=>{});G(this,Lt,(e,s,a)=>{});G(this,as,(e,s,a,o)=>{if(a||o)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0});X(this,va,"LRUCache");const{max:s=0,ttl:a,ttlResolution:o=1,ttlAutopurge:r,updateAgeOnGet:l,updateAgeOnHas:c,allowStale:d,dispose:h,disposeAfter:p,noDisposeOnSet:f,noUpdateTTL:x,maxSize:v=0,maxEntrySize:y=0,sizeCalculation:g,fetchMethod:S,noDeleteOnFetchRejection:u,noDeleteOnStaleGet:b,allowStaleOnFetchRejection:_,allowStaleOnFetchAbort:C,ignoreFetchAbort:T}=e;if(s!==0&&!et(s))throw new TypeError("max option must be a nonnegative integer");const D=s?co(s):Array;if(!D)throw new Error("invalid max value: "+s);if(I(this,je,s),I(this,Se,v),this.maxEntrySize=y||i(this,Se),this.sizeCalculation=g,this.sizeCalculation){if(!i(this,Se)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(S!==void 0&&typeof S!="function")throw new TypeError("fetchMethod must be a function if specified");if(I(this,Dt,S),I(this,nt,!!S),I(this,ne,new Map),I(this,Y,new Array(s).fill(void 0)),I(this,F,new Array(s).fill(void 0)),I(this,fe,new D(s)),I(this,we,new D(s)),I(this,me,0),I(this,ce,0),I(this,Ie,Sn.create(s)),I(this,oe,0),I(this,Ee,0),typeof h=="function"&&I(this,Ae,h),typeof p=="function"?(I(this,Ne,p),I(this,de,[])):(I(this,Ne,void 0),I(this,de,void 0)),I(this,Pe,!!i(this,Ae)),I(this,pe,!!i(this,Ne)),this.noDisposeOnSet=!!f,this.noUpdateTTL=!!x,this.noDeleteOnFetchRejection=!!u,this.allowStaleOnFetchRejection=!!_,this.allowStaleOnFetchAbort=!!C,this.ignoreFetchAbort=!!T,this.maxEntrySize!==0){if(i(this,Se)!==0&&!et(i(this,Se)))throw new TypeError("maxSize must be a positive integer if specified");if(!et(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");j(this,M,uo).call(this)}if(this.allowStale=!!d,this.noDeleteOnStaleGet=!!b,this.updateAgeOnGet=!!l,this.updateAgeOnHas=!!c,this.ttlResolution=et(o)||o===0?o:1,this.ttlAutopurge=!!r,this.ttl=a||0,this.ttl){if(!et(this.ttl))throw new TypeError("ttl must be a positive integer if specified");j(this,M,_n).call(this)}if(i(this,je)===0&&this.ttl===0&&i(this,Se)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!i(this,je)&&!i(this,Se)){const N="LRU_CACHE_UNBOUNDED";bc(N)&&(ro.add(N),lo("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",N,Bn))}}static unsafeExposeInternals(e){return{starts:i(e,Re),ttls:i(e,_e),sizes:i(e,Fe),keyMap:i(e,ne),keyList:i(e,Y),valList:i(e,F),next:i(e,fe),prev:i(e,we),get head(){return i(e,me)},get tail(){return i(e,ce)},free:i(e,Ie),isBackgroundFetch:s=>{var a;return j(a=e,M,K).call(a,s)},backgroundFetch:(s,a,o,r)=>{var l;return j(l=e,M,Ms).call(l,s,a,o,r)},moveToTail:s=>{var a;return j(a=e,M,Jt).call(a,s)},indexes:s=>{var a;return j(a=e,M,tt).call(a,s)},rindexes:s=>{var a;return j(a=e,M,st).call(a,s)},isStale:s=>{var a;return i(a=e,Ce).call(a,s)}}}get max(){return i(this,je)}get maxSize(){return i(this,Se)}get calculatedSize(){return i(this,Ee)}get size(){return i(this,oe)}get fetchMethod(){return i(this,Dt)}get dispose(){return i(this,Ae)}get disposeAfter(){return i(this,Ne)}getRemainingTTL(e){return i(this,ne).has(e)?1/0:0}*entries(){for(const e of j(this,M,tt).call(this))i(this,F)[e]!==void 0&&i(this,Y)[e]!==void 0&&!j(this,M,K).call(this,i(this,F)[e])&&(yield[i(this,Y)[e],i(this,F)[e]])}*rentries(){for(const e of j(this,M,st).call(this))i(this,F)[e]!==void 0&&i(this,Y)[e]!==void 0&&!j(this,M,K).call(this,i(this,F)[e])&&(yield[i(this,Y)[e],i(this,F)[e]])}*keys(){for(const e of j(this,M,tt).call(this)){const s=i(this,Y)[e];s!==void 0&&!j(this,M,K).call(this,i(this,F)[e])&&(yield s)}}*rkeys(){for(const e of j(this,M,st).call(this)){const s=i(this,Y)[e];s!==void 0&&!j(this,M,K).call(this,i(this,F)[e])&&(yield s)}}*values(){for(const e of j(this,M,tt).call(this))i(this,F)[e]!==void 0&&!j(this,M,K).call(this,i(this,F)[e])&&(yield i(this,F)[e])}*rvalues(){for(const e of j(this,M,st).call(this))i(this,F)[e]!==void 0&&!j(this,M,K).call(this,i(this,F)[e])&&(yield i(this,F)[e])}[(Sa=Symbol.iterator,va=Symbol.toStringTag,Sa)](){return this.entries()}find(e,s={}){for(const a of j(this,M,tt).call(this)){const o=i(this,F)[a],r=j(this,M,K).call(this,o)?o.__staleWhileFetching:o;if(r!==void 0&&e(r,i(this,Y)[a],this))return this.get(i(this,Y)[a],s)}}forEach(e,s=this){for(const a of j(this,M,tt).call(this)){const o=i(this,F)[a],r=j(this,M,K).call(this,o)?o.__staleWhileFetching:o;r!==void 0&&e.call(s,r,i(this,Y)[a],this)}}rforEach(e,s=this){for(const a of j(this,M,st).call(this)){const o=i(this,F)[a],r=j(this,M,K).call(this,o)?o.__staleWhileFetching:o;r!==void 0&&e.call(s,r,i(this,Y)[a],this)}}purgeStale(){let e=!1;for(const s of j(this,M,st).call(this,{allowStale:!0}))i(this,Ce).call(this,s)&&(this.delete(i(this,Y)[s]),e=!0);return e}info(e){const s=i(this,ne).get(e);if(s===void 0)return;const a=i(this,F)[s],o=j(this,M,K).call(this,a)?a.__staleWhileFetching:a;if(o===void 0)return;const r={value:o};if(i(this,_e)&&i(this,Re)){const l=i(this,_e)[s],c=i(this,Re)[s];if(l&&c){const d=l-(It.now()-c);r.ttl=d,r.start=Date.now()}}return i(this,Fe)&&(r.size=i(this,Fe)[s]),r}dump(){const e=[];for(const s of j(this,M,tt).call(this,{allowStale:!0})){const a=i(this,Y)[s],o=i(this,F)[s],r=j(this,M,K).call(this,o)?o.__staleWhileFetching:o;if(r===void 0||a===void 0)continue;const l={value:r};if(i(this,_e)&&i(this,Re)){l.ttl=i(this,_e)[s];const c=It.now()-i(this,Re)[s];l.start=Math.floor(Date.now()-c)}i(this,Fe)&&(l.size=i(this,Fe)[s]),e.unshift([a,l])}return e}load(e){this.clear();for(const[s,a]of e){if(a.start){const o=Date.now()-a.start;a.start=It.now()-o}this.set(s,a.value,a)}}set(e,s,a={}){var x,v,y,g,S;if(s===void 0)return this.delete(e),this;const{ttl:o=this.ttl,start:r,noDisposeOnSet:l=this.noDisposeOnSet,sizeCalculation:c=this.sizeCalculation,status:d}=a;let{noUpdateTTL:h=this.noUpdateTTL}=a;const p=i(this,as).call(this,e,s,a.size||0,c);if(this.maxEntrySize&&p>this.maxEntrySize)return d&&(d.set="miss",d.maxEntrySizeExceeded=!0),this.delete(e),this;let f=i(this,oe)===0?void 0:i(this,ne).get(e);if(f===void 0)f=i(this,oe)===0?i(this,ce):i(this,Ie).length!==0?i(this,Ie).pop():i(this,oe)===i(this,je)?j(this,M,Cs).call(this,!1):i(this,oe),i(this,Y)[f]=e,i(this,F)[f]=s,i(this,ne).set(e,f),i(this,fe)[i(this,ce)]=f,i(this,we)[f]=i(this,ce),I(this,ce,f),bs(this,oe)._++,i(this,Lt).call(this,f,p,d),d&&(d.set="add"),h=!1;else{j(this,M,Jt).call(this,f);const u=i(this,F)[f];if(s!==u){if(i(this,nt)&&j(this,M,K).call(this,u)){u.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:b}=u;b!==void 0&&!l&&(i(this,Pe)&&((x=i(this,Ae))==null||x.call(this,b,e,"set")),i(this,pe)&&((v=i(this,de))==null||v.push([b,e,"set"])))}else l||(i(this,Pe)&&((y=i(this,Ae))==null||y.call(this,u,e,"set")),i(this,pe)&&((g=i(this,de))==null||g.push([u,e,"set"])));if(i(this,xt).call(this,f),i(this,Lt).call(this,f,p,d),i(this,F)[f]=s,d){d.set="replace";const b=u&&j(this,M,K).call(this,u)?u.__staleWhileFetching:u;b!==void 0&&(d.oldValue=b)}}else d&&(d.set="update")}if(o!==0&&!i(this,_e)&&j(this,M,_n).call(this),i(this,_e)&&(h||i(this,ns).call(this,f,o,r),d&&i(this,He).call(this,d,f)),!l&&i(this,pe)&&i(this,de)){const u=i(this,de);let b;for(;b=u==null?void 0:u.shift();)(S=i(this,Ne))==null||S.call(this,...b)}return this}pop(){var e;try{for(;i(this,oe);){const s=i(this,F)[i(this,me)];if(j(this,M,Cs).call(this,!0),j(this,M,K).call(this,s)){if(s.__staleWhileFetching)return s.__staleWhileFetching}else if(s!==void 0)return s}}finally{if(i(this,pe)&&i(this,de)){const s=i(this,de);let a;for(;a=s==null?void 0:s.shift();)(e=i(this,Ne))==null||e.call(this,...a)}}}has(e,s={}){const{updateAgeOnHas:a=this.updateAgeOnHas,status:o}=s,r=i(this,ne).get(e);if(r!==void 0){const l=i(this,F)[r];if(j(this,M,K).call(this,l)&&l.__staleWhileFetching===void 0)return!1;if(i(this,Ce).call(this,r))o&&(o.has="stale",i(this,He).call(this,o,r));else return a&&i(this,pt).call(this,r),o&&(o.has="hit",i(this,He).call(this,o,r)),!0}else o&&(o.has="miss");return!1}peek(e,s={}){const{allowStale:a=this.allowStale}=s,o=i(this,ne).get(e);if(o===void 0||!a&&i(this,Ce).call(this,o))return;const r=i(this,F)[o];return j(this,M,K).call(this,r)?r.__staleWhileFetching:r}async fetch(e,s={}){const{allowStale:a=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,ttl:l=this.ttl,noDisposeOnSet:c=this.noDisposeOnSet,size:d=0,sizeCalculation:h=this.sizeCalculation,noUpdateTTL:p=this.noUpdateTTL,noDeleteOnFetchRejection:f=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:x=this.allowStaleOnFetchRejection,ignoreFetchAbort:v=this.ignoreFetchAbort,allowStaleOnFetchAbort:y=this.allowStaleOnFetchAbort,context:g,forceRefresh:S=!1,status:u,signal:b}=s;if(!i(this,nt))return u&&(u.fetch="get"),this.get(e,{allowStale:a,updateAgeOnGet:o,noDeleteOnStaleGet:r,status:u});const _={allowStale:a,updateAgeOnGet:o,noDeleteOnStaleGet:r,ttl:l,noDisposeOnSet:c,size:d,sizeCalculation:h,noUpdateTTL:p,noDeleteOnFetchRejection:f,allowStaleOnFetchRejection:x,allowStaleOnFetchAbort:y,ignoreFetchAbort:v,status:u,signal:b};let C=i(this,ne).get(e);if(C===void 0){u&&(u.fetch="miss");const T=j(this,M,Ms).call(this,e,C,_,g);return T.__returned=T}else{const T=i(this,F)[C];if(j(this,M,K).call(this,T)){const k=a&&T.__staleWhileFetching!==void 0;return u&&(u.fetch="inflight",k&&(u.returnedStale=!0)),k?T.__staleWhileFetching:T.__returned=T}const D=i(this,Ce).call(this,C);if(!S&&!D)return u&&(u.fetch="hit"),j(this,M,Jt).call(this,C),o&&i(this,pt).call(this,C),u&&i(this,He).call(this,u,C),T;const N=j(this,M,Ms).call(this,e,C,_,g),O=N.__staleWhileFetching!==void 0&&a;return u&&(u.fetch=D?"stale":"refresh",O&&D&&(u.returnedStale=!0)),O?N.__staleWhileFetching:N.__returned=N}}get(e,s={}){const{allowStale:a=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,status:l}=s,c=i(this,ne).get(e);if(c!==void 0){const d=i(this,F)[c],h=j(this,M,K).call(this,d);return l&&i(this,He).call(this,l,c),i(this,Ce).call(this,c)?(l&&(l.get="stale"),h?(l&&a&&d.__staleWhileFetching!==void 0&&(l.returnedStale=!0),a?d.__staleWhileFetching:void 0):(r||this.delete(e),l&&a&&(l.returnedStale=!0),a?d:void 0)):(l&&(l.get="hit"),h?d.__staleWhileFetching:(j(this,M,Jt).call(this,c),o&&i(this,pt).call(this,c),d))}else l&&(l.get="miss")}delete(e){var a,o,r,l;let s=!1;if(i(this,oe)!==0){const c=i(this,ne).get(e);if(c!==void 0)if(s=!0,i(this,oe)===1)this.clear();else{i(this,xt).call(this,c);const d=i(this,F)[c];if(j(this,M,K).call(this,d)?d.__abortController.abort(new Error("deleted")):(i(this,Pe)||i(this,pe))&&(i(this,Pe)&&((a=i(this,Ae))==null||a.call(this,d,e,"delete")),i(this,pe)&&((o=i(this,de))==null||o.push([d,e,"delete"]))),i(this,ne).delete(e),i(this,Y)[c]=void 0,i(this,F)[c]=void 0,c===i(this,ce))I(this,ce,i(this,we)[c]);else if(c===i(this,me))I(this,me,i(this,fe)[c]);else{const h=i(this,we)[c];i(this,fe)[h]=i(this,fe)[c];const p=i(this,fe)[c];i(this,we)[p]=i(this,we)[c]}bs(this,oe)._--,i(this,Ie).push(c)}}if(i(this,pe)&&((r=i(this,de))!=null&&r.length)){const c=i(this,de);let d;for(;d=c==null?void 0:c.shift();)(l=i(this,Ne))==null||l.call(this,...d)}return s}clear(){var e,s,a;for(const o of j(this,M,st).call(this,{allowStale:!0})){const r=i(this,F)[o];if(j(this,M,K).call(this,r))r.__abortController.abort(new Error("deleted"));else{const l=i(this,Y)[o];i(this,Pe)&&((e=i(this,Ae))==null||e.call(this,r,l,"delete")),i(this,pe)&&((s=i(this,de))==null||s.push([r,l,"delete"]))}}if(i(this,ne).clear(),i(this,F).fill(void 0),i(this,Y).fill(void 0),i(this,_e)&&i(this,Re)&&(i(this,_e).fill(0),i(this,Re).fill(0)),i(this,Fe)&&i(this,Fe).fill(0),I(this,me,0),I(this,ce,0),i(this,Ie).length=0,I(this,Ee,0),I(this,oe,0),i(this,pe)&&i(this,de)){const o=i(this,de);let r;for(;r=o==null?void 0:o.shift();)(a=i(this,Ne))==null||a.call(this,...r)}}};je=new WeakMap,Se=new WeakMap,Ae=new WeakMap,Ne=new WeakMap,Dt=new WeakMap,oe=new WeakMap,Ee=new WeakMap,ne=new WeakMap,Y=new WeakMap,F=new WeakMap,fe=new WeakMap,we=new WeakMap,me=new WeakMap,ce=new WeakMap,Ie=new WeakMap,de=new WeakMap,Fe=new WeakMap,Re=new WeakMap,_e=new WeakMap,Pe=new WeakMap,nt=new WeakMap,pe=new WeakMap,M=new WeakSet,_n=function(){const e=new _s(i(this,je)),s=new _s(i(this,je));I(this,_e,e),I(this,Re,s),I(this,ns,(r,l,c=It.now())=>{if(s[r]=l!==0?c:0,e[r]=l,l!==0&&this.ttlAutopurge){const d=setTimeout(()=>{i(this,Ce).call(this,r)&&this.delete(i(this,Y)[r])},l+1);d.unref&&d.unref()}}),I(this,pt,r=>{s[r]=e[r]!==0?It.now():0}),I(this,He,(r,l)=>{if(e[l]){const c=e[l],d=s[l];if(!c||!d)return;r.ttl=c,r.start=d,r.now=a||o();const h=r.now-d;r.remainingTTL=c-h}});let a=0;const o=()=>{const r=It.now();if(this.ttlResolution>0){a=r;const l=setTimeout(()=>a=0,this.ttlResolution);l.unref&&l.unref()}return r};this.getRemainingTTL=r=>{const l=i(this,ne).get(r);if(l===void 0)return 0;const c=e[l],d=s[l];if(!c||!d)return 1/0;const h=(a||o())-d;return c-h},I(this,Ce,r=>{const l=s[r],c=e[r];return!!c&&!!l&&(a||o())-l>c})},pt=new WeakMap,He=new WeakMap,ns=new WeakMap,Ce=new WeakMap,uo=function(){const e=new _s(i(this,je));I(this,Ee,0),I(this,Fe,e),I(this,xt,s=>{I(this,Ee,i(this,Ee)-e[s]),e[s]=0}),I(this,as,(s,a,o,r)=>{if(j(this,M,K).call(this,a))return 0;if(!et(o))if(r){if(typeof r!="function")throw new TypeError("sizeCalculation must be a function");if(o=r(a,s),!et(o))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return o}),I(this,Lt,(s,a,o)=>{if(e[s]=a,i(this,Se)){const r=i(this,Se)-e[s];for(;i(this,Ee)>r;)j(this,M,Cs).call(this,!0)}I(this,Ee,i(this,Ee)+e[s]),o&&(o.entrySize=a,o.totalCalculatedSize=i(this,Ee))})},xt=new WeakMap,Lt=new WeakMap,as=new WeakMap,tt=function*({allowStale:e=this.allowStale}={}){if(i(this,oe))for(let s=i(this,ce);!(!j(this,M,Cn).call(this,s)||((e||!i(this,Ce).call(this,s))&&(yield s),s===i(this,me)));)s=i(this,we)[s]},st=function*({allowStale:e=this.allowStale}={}){if(i(this,oe))for(let s=i(this,me);!(!j(this,M,Cn).call(this,s)||((e||!i(this,Ce).call(this,s))&&(yield s),s===i(this,ce)));)s=i(this,fe)[s]},Cn=function(e){return e!==void 0&&i(this,ne).get(i(this,Y)[e])===e},Cs=function(e){var r,l;const s=i(this,me),a=i(this,Y)[s],o=i(this,F)[s];return i(this,nt)&&j(this,M,K).call(this,o)?o.__abortController.abort(new Error("evicted")):(i(this,Pe)||i(this,pe))&&(i(this,Pe)&&((r=i(this,Ae))==null||r.call(this,o,a,"evict")),i(this,pe)&&((l=i(this,de))==null||l.push([o,a,"evict"]))),i(this,xt).call(this,s),e&&(i(this,Y)[s]=void 0,i(this,F)[s]=void 0,i(this,Ie).push(s)),i(this,oe)===1?(I(this,me,I(this,ce,0)),i(this,Ie).length=0):I(this,me,i(this,fe)[s]),i(this,ne).delete(a),bs(this,oe)._--,s},Ms=function(e,s,a,o){const r=s===void 0?void 0:i(this,F)[s];if(j(this,M,K).call(this,r))return r;const l=new Is,{signal:c}=a;c==null||c.addEventListener("abort",()=>l.abort(c.reason),{signal:l.signal});const d={signal:l.signal,options:a,context:o},h=(g,S=!1)=>{const{aborted:u}=l.signal,b=a.ignoreFetchAbort&&g!==void 0;if(a.status&&(u&&!S?(a.status.fetchAborted=!0,a.status.fetchError=l.signal.reason,b&&(a.status.fetchAbortIgnored=!0)):a.status.fetchResolved=!0),u&&!b&&!S)return f(l.signal.reason);const _=v;return i(this,F)[s]===v&&(g===void 0?_.__staleWhileFetching?i(this,F)[s]=_.__staleWhileFetching:this.delete(e):(a.status&&(a.status.fetchUpdated=!0),this.set(e,g,d.options))),g},p=g=>(a.status&&(a.status.fetchRejected=!0,a.status.fetchError=g),f(g)),f=g=>{const{aborted:S}=l.signal,u=S&&a.allowStaleOnFetchAbort,b=u||a.allowStaleOnFetchRejection,_=b||a.noDeleteOnFetchRejection,C=v;if(i(this,F)[s]===v&&(!_||C.__staleWhileFetching===void 0?this.delete(e):u||(i(this,F)[s]=C.__staleWhileFetching)),b)return a.status&&C.__staleWhileFetching!==void 0&&(a.status.returnedStale=!0),C.__staleWhileFetching;if(C.__returned===C)throw g},x=(g,S)=>{var b;const u=(b=i(this,Dt))==null?void 0:b.call(this,e,r,d);u&&u instanceof Promise&&u.then(_=>g(_===void 0?void 0:_),S),l.signal.addEventListener("abort",()=>{(!a.ignoreFetchAbort||a.allowStaleOnFetchAbort)&&(g(void 0),a.allowStaleOnFetchAbort&&(g=_=>h(_,!0)))})};a.status&&(a.status.fetchDispatched=!0);const v=new Promise(x).then(h,p),y=Object.assign(v,{__abortController:l,__staleWhileFetching:r,__returned:void 0});return s===void 0?(this.set(e,y,{...d.options,status:void 0}),s=i(this,ne).get(e)):i(this,F)[s]=y,y},K=function(e){if(!i(this,nt))return!1;const s=e;return!!s&&s instanceof Promise&&s.hasOwnProperty("__staleWhileFetching")&&s.__abortController instanceof Is},Mn=function(e,s){i(this,we)[s]=e,i(this,fe)[e]=s},Jt=function(e){e!==i(this,ce)&&(e===i(this,me)?I(this,me,i(this,fe)[e]):j(this,M,Mn).call(this,i(this,we)[e],i(this,fe)[e]),j(this,M,Mn).call(this,i(this,ce),e),I(this,ce,e))};let wn=Bn;function yc({conversationId:t,messageId:e}){const[s,a]=m.useState(!1),o=m.useRef({isMediaSourceAvailable:Un(),mediaSourceFormat:zn()??"n/a",playPromise:null,shouldAbortQueuedPlayback:!1}).current,r=qe(),{voiceName:l}=ji(),c=`${t}.${e}.${l}`,d=Ao(),h=No(y=>{var g;return y.isPlaying&&y.sourceUrl===((g=Me.get(c))==null?void 0:g.src)}),p=m.useCallback(async()=>{if(!d)return;a(!0);const y={isMediaSourceAvailable:o.isMediaSourceAvailable,format:o.mediaSourceFormat};try{const g=await vc({key:c,message_id:e,conversation_id:t,voice:l,onStreamingError:S=>{Zt.readAloud.error(S,y),a(!1),hn.danger(r.formatMessage(oa.playbackError,{error:S.message}))},onStreamingStart:()=>{a(!1)}});if(o.shouldAbortQueuedPlayback){o.shouldAbortQueuedPlayback=!1;return}d.changeSource(g),o.playPromise=d.play()}catch(g){Zt.readAloud.error(g,y),a(!1),hn.danger(r.formatMessage(oa.playbackError,{error:g.message}))}},[d,c,e,t,l,o,r]),f=m.useCallback(()=>{const y=Hn();y&&(o.playPromise?o.playPromise.then(()=>{y.stop(),o.playPromise=null}):y.stop())},[o]),x=m.useCallback(()=>{var g;const y=Hn();y&&(y.state.isPlaying&&y.state.sourceUrl===((g=Me.get(c))==null?void 0:g.src)?f():(Zt.readAloud.click({isMediaSourceAvailable:o.isMediaSourceAvailable,format:o.mediaSourceFormat}),p()))},[c,o,p,f]);m.useEffect(()=>{s&&h&&a(!1)},[s,h]);const v=m.useRef(c);return m.useEffect(()=>{v.current=c}),m.useEffect(()=>(o.shouldAbortQueuedPlayback=!1,()=>{var S;const y=Eo();y.isPlaying&&y.sourceUrl===((S=Me.get(v.current))==null?void 0:S.src)?f():o.shouldAbortQueuedPlayback=!0}),[o,f]),{togglePlayback:x,isPlaying:h,isLoading:s}}async function ho({message_id:t,conversation_id:e,voice:s}){const a=await De.synthesize({message_id:t,conversation_id:e,voice:s,format:zn()}),o=a.headers.get("content-type")??"audio/aac";return{response:a,format:o}}async function vc(t){return Un()?wc(t):Sc(t)}async function Sc({key:t,...e}){const s=Me.get(t);if(s!=null&&s.blob)return s.src;const{response:a,format:o}=await ho(e),r=await a.arrayBuffer(),l=new Blob([r],{type:o}),c=mo({key:t,src:URL.createObjectURL(l),format:o,blob:l});return Me.set(t,c),c.src}async function wc({key:t,onStreamingError:e,onStreamingStart:s,...a}){let o=Me.get(t);o!=null&&o.streaming&&(Me.delete(t),o=void 0);let r,l;const c=Cc(),d=new c;if(o)r=o,r.src=URL.createObjectURL(d);else{const{format:f,response:x}=await ho(a);l=x,r=mo({key:t,src:URL.createObjectURL(d),format:f})}const h=_c(r.id),p={sourceopen:async()=>{var v,y;h("sourceopen");const f=d.addSourceBuffer(r.format),x=async()=>{f.updating&&await new Promise(g=>f.addEventListener("updateend",g,{once:!0}))};if(r.segments.length&&!r.streaming){h("streaming from cache"),r.streaming=!0,s();for(const g of r.segments)f.appendBuffer(g),await x();d.readyState==="open"&&d.endOfStream(),r.streaming=!1,h("done streaming from cache");return}if(l){h("fetching audio");try{const g=(v=l.body)==null?void 0:v.getReader();if(!g)return;for(;((y=Me.get(t))==null?void 0:y.id)===r.id;){const{done:S,value:u}=await g.read();if(S){h("done streaming"),r.streaming=!1,d.readyState==="open"&&d.endOfStream();break}if(!Array.from(d.sourceBuffers).includes(f)){h("stop streaming, source buffer removed"),r.streaming=!1;break}r.streaming||(h("start streaming"),r.streaming=!0,s()),f.appendBuffer(u),r.segments.push(u),await x()}}catch(g){if(h("error while streaming",g),r.streaming=!1,d.readyState==="open")try{d.endOfStream("network")}catch(S){Zt.readAloud.error(S)}Me.delete(t),e(g)}}},sourceclose:()=>{var f;h("sourceclose"),r.streaming&&(r.streaming=!1,((f=Me.get(t))==null?void 0:f.id)===r.id&&(h("sourceclosed while streaming, cleaning up cache"),Me.delete(t)))},sourceended:ft};for(const[f,x]of Object.entries(p))d.addEventListener(f,()=>{try{return x()}catch(v){Zt.readAloud.error(v)}});return Me.set(t,r),r.src}const oa=Le({playbackError:{id:"useVoiceReadAloudAudio.playbackError",defaultMessage:"Failed to play message"}}),_c=t=>ft;function Cc(){return Un()?window.MediaSource:null}function Un(){return!!zn()}function zn(){if("MediaSource"in window){const t=e=>Io(e)&&MediaSource.isTypeSupported(e);if(t("audio/aac"))return"aac";if(t("audio/mpeg"))return"mp3";if(t("audio/ogg"))return"ogg"}}const mo=t=>({id:Ps(),segments:[],streaming:!1,...t}),Me=new wn({max:50,dispose:t=>{URL.revokeObjectURL(t.src)}}),Mc=m.memo(function(e){var l;const s=(l=ks("1923022511"))==null?void 0:l.value,a=zs(e.conversationId),{errCode:o}=On(e.message);if(!s||!a||o)return null;const r=ka.getAudioAssetPointers(e.message.message)[0];return r?n.jsx(kc,{audioAssetPointer:r,conversationId:a}):n.jsx(Tc,{...e,conversationId:a})});function kc({audioAssetPointer:t,conversationId:e}){const{isLoading:s,isPlaying:a,togglePlayback:o}=Ai({audioAssetPointer:t,conversationId:e});return n.jsx(go,{onClick:o,isPlaying:a,isLoading:s,playText:Fs.replay,playIcon:rl})}function Tc({conversationId:t,message:e}){const{isLoading:s,isPlaying:a,togglePlayback:o}=yc({conversationId:t,messageId:e.message.id});return n.jsx(go,{onClick:o,isPlaying:a,isLoading:s,playText:Fs.play,playIcon:ll})}function go({onClick:t,isPlaying:e,isLoading:s,playText:a,playIcon:o}){let r,l;const c=qe();return s?(r=Fo,l=Fs.loading):e?(r=cl,l=Fs.stop):(r=o,l=a),n.jsx(ws,{icon:r,label:l?c.formatMessage(l):void 0,disabled:s,onClick:t,style:e||s?{visibility:"visible"}:void 0,testId:"voice-play-turn-action-button"})}const Fs={replay:{id:"VoiceReadOutLoudButton.replay",defaultMessage:"Replay",description:"The tooltip for the replay button"},play:{id:"VoiceReadOutLoudButton.play",defaultMessage:"Read aloud",description:"The tooltip for the read aloud button"},stop:{id:"VoiceReadOutLoudButton.stop",defaultMessage:"Stop",description:"The tooltip for the stop button"},loading:{id:"VoiceReadOutLoudButton.loading",defaultMessage:"Loading",description:"The tooltip for the spinner"}},jc="bg-token-main-surface-primary text-token-text-primary",Ac="openai",ia=["bg-blue-300 text-white"];function Nc(t){return ia[((t==null?void 0:t.charCodeAt(0))??0)%ia.length]}const ys=({children:t})=>n.jsx("div",{className:"pt-0",children:n.jsx("div",{className:te(m.isValidElement(t)&&t.type===gn?"gizmo-bot-avatar":"gizmo-shadow-stroke","flex h-8 w-8 items-center justify-center overflow-hidden rounded-full"),children:t})});function kn({messages:t,isUserTurn:e,avatarClassName:s,gizmo:a,showInlineEmbeddedDisplay:o=!1}){var v;const r="medium",l=t[0],c=(v=l==null?void 0:l.message.metadata)==null?void 0:v.shared_conversation_id,d=c!=null,h=Rn(),{gizmoEditorData:p,mode:f}=Ni();let x=n.jsx(ys,{children:n.jsx(gn,{className:s??jc,iconName:Ac,size:r})});return a?x=n.jsx(ys,{children:n.jsx(Il,{gizmoId:a.gizmo.id,className:"h-full w-full"})}):p!=null&&f==="test"&&(x=n.jsx(Fl,{isFirstParty:!1,src:p.profilePictureUrl,className:"h-8 w-8 first:pt-[3px]"})),n.jsx("div",{children:e?d||o?n.jsx(ys,{children:n.jsx(gn,{className:Nc(c),iconName:"user",size:r})}):n.jsx(ys,{children:n.jsx(Ei,{user:h,size:r})}):x})}const vs="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function Ec({className:t,clientThreadId:e,message:s,onModelSelect:a,onDropdownChange:o,canRegenerateResponse:r}){var U;const l=_a("566128514").value,[c,d]=m.useState(null),[h,p]=m.useState(!1),[f,x]=m.useState(!1),v=St(e),y=io({clientThreadId:e,message:s}),g=(U=s.message.metadata)==null?void 0:U.model_slug,{modelOptions:S,modelSlug:u,animateModelLabelOnRender:b,messageModelEnabledTools:_}=y,C=Oa(s.message),T=_.includes(As.Search),D=m.useMemo(()=>S.find(E=>E.value===g),[S,g]),N=m.useRef(null),{doesUserHaveAnyAccountsWithPlusFeatures:H}=os(),O=E=>{E||setTimeout(()=>{N.current&&N.current.blur()},10)};if(m.useEffect(()=>{O(h)},[h]),qa(e))return null;const P=r&&S.some(E=>ss(E,H));return v?null:n.jsxs(ke.Root,{onOpenChange:E=>{r&&(p(E),o(E),O(E)),E&&J.logEvent(Z.conversationOpenMessageModelSelector,{has_get_plus_button:P,is_new_regen_dropdown:!0})},children:[r?n.jsx(Fc,{label:n.jsx(R,{id:"wDs5sz",defaultMessage:"Switch model"}),children:n.jsx(no,{ref:N,className:te("cursor-pointer",t),onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),children:n.jsx(yn,{modelSlug:u,animateModelLabelOnRender:b,isDropdownOpen:h,isRegenerateEnabled:r,isHovered:f,isRegenLabel:!0,omitIcon:!1})})}):n.jsx("button",{className:te("cursor-pointer",t),onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),children:n.jsx(yn,{modelSlug:u,animateModelLabelOnRender:b,isDropdownOpen:!1,isRegenerateEnabled:!1,isHovered:f,omitIcon:l,animateShortLabel:!0})}),r&&n.jsxs(ke.Content,{className:"z-30 min-w-fit origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[n.jsx(ke.Item,{disabled:!0,className:"pb-0 pt-2",children:n.jsx("span",{className:"text-token-text-secondary",children:n.jsx(R,{id:"bFLh5u",defaultMessage:"Switch model"})})}),n.jsx(Ic,{onModelSelect:a,messageModelSlug:g,omitModelIcons:l,modelOptions:S,setHoveredOption:d,hoveredOption:c,retryOption:D,lastResponseUsedSearch:C,modelSupportsSearch:T,doesUserHaveAnyAccountsWithPlusFeatures:H})]})]})}function Ic({modelOptions:t,messageModelSlug:e,onModelSelect:s,omitModelIcons:a,setHoveredOption:o,hoveredOption:r,retryOption:l,lastResponseUsedSearch:c,modelSupportsSearch:d,doesUserHaveAnyAccountsWithPlusFeatures:h}){const p=qe(),[f,x]=m.useMemo(()=>Ii(t,u=>u.subcategory),[t]),v=m.useMemo(()=>{const u=new Map;return f.forEach(b=>{var C;const _=b.subcategory;_&&(u.has(_)||u.set(_,[]),(C=u.get(_))==null||C.push(b))}),u},[f]),y=te("icon-sm",a&&"order-10 ml-auto text-token-text-tertiary icon-md"),g=a?"right":"left",S=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:p.formatMessage(dn.search),icon:n.jsx(Ja,{className:y}),condition:d&&!c},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:p.formatMessage(dn.nosearch),icon:n.jsx(Za,{className:y}),condition:d&&c}];return n.jsxs(n.Fragment,{children:[x.map(u=>{const{value:b,..._}=u;return n.jsx(Ft,{value:b,onSelect:()=>s({requestedModelId:b}),includeRegenerate:!1,onMouseEnter:()=>o(b),onMouseLeave:()=>o(null),isHovered:r===b,messageModelSlug:e,includeCheck:!1,shouldShowUpsell:ss(u,h),className:vs,..._,icon:a?n.jsx("span",{className:y}):_.icon,justifyIcon:g,wrapIcon:!a},b)}),[...v.entries()].map(([u,b])=>n.jsxs(ke.Sub,{children:[n.jsx(ke.SubMenuTrigger,{children:n.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:u})}),n.jsx(ke.Portal,{children:n.jsx(ke.SubContent,{className:"min-w-fit",children:b.map(_=>{const{value:C,...T}=_;return n.jsx(Ft,{value:C,onSelect:()=>s({requestedModelId:C}),includeRegenerate:!1,onMouseEnter:()=>o(C),onMouseLeave:()=>o(null),isHovered:r===C,messageModelSlug:e,includeCheck:!1,className:vs,...T,icon:null,justifyIcon:g,wrapIcon:!a,shouldShowUpsell:ss(_,h)},u+"-"+C)})})})]},u)),!!l&&n.jsxs(n.Fragment,{children:[n.jsx(ke.Separator,{}),n.jsx(Ft,{onSelect:()=>s({requestedModelId:l.value}),includeRegenerate:!0,onMouseEnter:()=>o(l.value),onMouseLeave:()=>o(null),messageModelSlug:e,includeCheck:!1,className:vs,...l,label:p.formatMessage(dn.tryAgain),subtitle:l.label,icon:n.jsx(Gs,{className:y}),justifyIcon:g,wrapIcon:!a},l.value),S.filter(u=>u.condition).map(u=>n.jsx(Ft,{onSelect:()=>s({requestedModelId:l.value,extraStreamParams:u.extraStreamParams}),includeRegenerate:!1,onMouseEnter:()=>o(u.key),onMouseLeave:()=>o(null),isHovered:r===u.key,messageModelSlug:e,includeCheck:!1,className:vs,...l,label:u.label,subtitle:"",icon:u.icon,justifyIcon:g,wrapIcon:!a},u.key))]})]})}function Fc({children:t,label:e}){return n.jsx(Os,{label:e,sideOffset:0,children:t})}const dn=Le({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Rc=m.memo(Ec);function Tn({messages:t,isMemoryEnabled:e,isMemoryFull:s,gizmoId:a,isParagen:o}){const[r,l]=m.useState(!1),[c,d]=m.useState(!1),{eligible:h,isLoading:p}=Fi(),f=e&&!s,x=t.filter((g,S)=>{const u=t[S+1],_=(u==null?void 0:u.message.recipient)==="assistant"&&(u==null?void 0:u.message.author.role)===xe.Tool&&(u==null?void 0:u.message.author.name)==="bio"&&Ta(u.message)==="Model set context updated."||!u&&f;return g.message.author.role===xe.Assistant&&g.message.recipient==="bio"&&_}).flatMap(g=>{const S=g.message.content.content_type;return S===it.Text?g.message.content.parts:S===it.Code?[g.message.content.text]:[]}).map(Pc),v=m.useMemo(()=>x.length>0,[x]);if(m.useEffect(()=>{v&&h&&!p&&Ua.openModal(za.GlobalMemoryOnboarding)},[v,h,p]),x.length===0)return null;const y=g=>{const S=g??!c;d(S),S&&J.logEvent(Z.memoryUpdatePopoverShown,{updateCount:x.length})};return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"inline-block",onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1),children:n.jsxs(Ri,{open:c,sideOffset:4,side:"bottom",alignAgainstAnchor:"start",size:"none",className:"z-10 min-w-60 max-w-96 text-sm",onOpenChange:g=>y(g),disableAutofocus:!0,triggerButton:n.jsxs("button",{className:te("my-1 flex items-center gap-1 text-sm font-semibold outline-none",c?"text-token-text-secondary":"text-token-text-tertiary"),children:[n.jsx(dl,{className:"mb-[-1px]"}),x.length===1?n.jsx(R,{id:"MemoryActionResult.memoryWriteSingular.1",defaultMessage:"Memory updated"}):n.jsx(R,{id:"MemoryActionResult.memoryWritePlural.1",defaultMessage:"Memories updated"})]}),children:[n.jsx("div",{className:"mb-2 rounded border border-token-border-light bg-token-main-surface-secondary",children:x.map((g,S)=>n.jsx("div",{className:"border-b border-token-border-light px-3 py-2 first-letter:uppercase last:border-b-0",children:g},S))}),o?n.jsx("div",{className:"text-xs text-token-text-tertiary",children:n.jsx(R,{id:"MemoryActionResult.paragenMessage",defaultMessage:"This memory will be saved if you choose this response."})}):n.jsxs("button",{className:"flex w-full items-center justify-between rounded px-3 py-2 font-semibold hover:bg-token-main-surface-secondary",onClick:()=>{l(!0),J.logEvent(Z.memoryUpdatePopoverManageButtonClicked,{updateCount:x.length})},children:[n.jsx(R,{id:"MemoryActionResult.manageMemories",defaultMessage:"Manage memories"}),n.jsx(ul,{className:"icon-md -mr-1 text-token-text-tertiary"})]})]})}),r&&n.jsx(Rl,{initialGizmoId:a,onClose:()=>l(!1)})]})}function Pc(t){const e=["The user ","The user's ","User ","User's "];for(const s of e)if(t.startsWith(s))return t.slice(s.length);return t}function ra(t,e,s){z.updateTree(t,a=>{a.updateNodeMetadata(e,{inlineComparisonRating:s})})}function la(t){var a,o;return{is_dark_mode:t==="dark",time_since_loaded:Math.floor(performance.now()/1e3),page_height:window==null?void 0:window.innerHeight,page_width:window==null?void 0:window.innerWidth,pixel_ratio:window==null?void 0:window.devicePixelRatio,screen_height:(a=window==null?void 0:window.screen)==null?void 0:a.height,screen_width:(o=window==null?void 0:window.screen)==null?void 0:o.width}}const ca=({messages:t})=>{for(const{message:{metadata:e}}of t){const{augmented_paragen_prompt_label:s}=e??{};if(s)return s}};function Dc(t){const e=m.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});return t.stubSideBySideFeedback?n.jsx(fo,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:e,...t}):n.jsx(Lc,{...t,visibilityStateRef:e})}function Lc(t){const{clientThreadId:e,variantIds:s,variantsInStreamInfo:a}=t;if(s.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const[o]=m.useState(()=>Date.now()),r=Ba(),{resolvedTheme:l}=Ro(),[c,d]=m.useMemo(()=>Ga(s.join(""))()<.5?[0,1]:[1,0],[s[0],s[1]]),h=c<d?"left":"right",p=h==="left"?"right":"left",f=s[c],x=s[d],v=Jn(e,f),y=Jn(e,x),g=Yt(Zn(e,Yt(v).id)),S=Yt(Zn(e,Yt(y).id)),u=h==="left"?g:S,b=h==="left"?S:g,_=a.display_treatment==="unskippable",C=_?"unskippable_parallel_2_in_stream:a:1.0":"skippable_parallel_2_in_stream:a:1.5";m.useEffect(()=>(js.setState({displayingSideBySideFeedback:!0,unskippable:_}),()=>{js.setState({displayingSideBySideFeedback:!1,unskippable:!1})}),[_]),Pi();const T=m.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});m.useEffect(()=>Po(Di,{requestCompletion:()=>{var O,k,P,U;const N=(O=Xt(u.messages))==null?void 0:O.completionSampleFinishTime,H=(k=Xt(b.messages))==null?void 0:k.completionSampleFinishTime;De.submitMessageComparisonFeedback({feedback_version:C,original_message_id:(P=u.messages[u.messages.length-1])==null?void 0:P.message.id,new_message_id:(U=b.messages[b.messages.length-1])==null?void 0:U.message.id,rating:"none",conversation_id:z.getServerThreadId(e),text:"",tags:[],completion_comparison_rating:"skip",new_completion_placement:p,feedback_start_time:o,compare_step_start_time:o,original_completion_load_start_time:o,original_completion_load_end_time:N??0,new_completion_load_start_time:o,new_completion_load_end_time:H??0,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:la(l),...T.current})}}),[g,S,e,o,C,p,u==null?void 0:u.messages,b==null?void 0:b.messages,l]);const D=N=>{var ee,A,w,V;const O=z.getTree(e).getLeafFromNode(N);z.setThreadCurrentLeafId(e,O.id);const P=N===f===(h==="left"),U=(ee=Xt(u.messages))==null?void 0:ee.completionSampleFinishTime,E=(A=Xt(b.messages))==null?void 0:A.completionSampleFinishTime;u.messages.length>0&&ra(e,u.messages[u.messages.length-1].nodeId,P?"original":"new"),b.messages.length>0&&ra(e,b.messages[b.messages.length-1].nodeId,P?"original":"new");let se;U==null||E==null?se=P?"partial_load_comparison_original":"partial_load_comparison_new":se=P?"original":"new",De.submitMessageComparisonFeedback({feedback_version:C,original_message_id:(w=u.messages[u.messages.length-1])==null?void 0:w.message.id,new_message_id:(V=b.messages[b.messages.length-1])==null?void 0:V.message.id,rating:"none",conversation_id:z.getServerThreadId(e),text:"",tags:[],completion_comparison_rating:se,new_completion_placement:p,feedback_start_time:o,compare_step_start_time:o,original_completion_load_start_time:o,original_completion_load_end_time:U??null,new_completion_load_start_time:o,new_completion_load_end_time:E??null,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:la(l),...T.current})};return n.jsx(fo,{...t,setPreferredFeedback:D,leftVariantId:f,rightVariantId:x,leftTurn:g,rightTurn:S,hasActiveRequest:r,originalTurn:u,visibilityStateRef:T})}function Oc(t){if(!t.length)return!1;const e=t.filter(s=>s.type===ot.Text||s.type===ot.MultiText).filter(s=>{var a;return s.message.message.status!=="finished_successfully"&&((a=s.message.message.metadata)==null?void 0:a.snorkle_status)!==void 0});return e.length>0&&e.every(s=>{const a=s.message.message.content;return(a==null?void 0:a.content_type)===it.Text&&a.parts.join("")===""})}function fo({setPreferredFeedback:t,leftVariantId:e,rightVariantId:s,leftTurn:a,rightTurn:o,hasActiveRequest:r,originalTurn:l,visibilityStateRef:c,...d}){const{defaultParagenLabel:h,shouldShowParagenLabels:p=!1}=Li(),f=a&&ca(a)||h,x=o&&ca(o)||h,v=m.useMemo(()=>(a==null?void 0:a.messages)??[],[a==null?void 0:a.messages]),y=m.useMemo(()=>(o==null?void 0:o.messages)??[],[o==null?void 0:o.messages]),{avatarClassName:g}=d,S=m.useMemo(()=>Ns(v),[v]),u=m.useMemo(()=>Ns(y),[y]),b=In(),_=rs();function C(V){var Te,be;if(!_.showDebugConversationTurns&&!_.forceParagen)return null;let W=V===l?"ORIGINAL":"NEW";const B=V.messages[V.messages.length-1],q=(be=(Te=B==null?void 0:B.message)==null?void 0:Te.metadata)==null?void 0:be.__internal;if(q){const{model_id:ue,model_definition_slug:wt,model_definition_virtual_model_id:ze,alternative_model_selection_rule:Qe,augmented_paragen_prompt_group_id:Ke,augmented_paragen_prompt_id:Ye,augmented_paragen_prompt:Xe}=q;ue&&(W+=`
Model ID: ${ue}`),wt&&(W+=`
Model Slug: ${wt}`),ze&&(W+=`
Virtual Model ID: ${ze}`),Qe&&(W+=`
Alternative Model Rule: ${Qe}`),Ke&&(W+=`
Prompt Group ID: ${Ke}`),Ye&&(W+=`
Prompt ID: ${Ye}`),Xe&&(W+=`
Prompt: ${Xe}`)}return n.jsx("div",{className:"whitespace-pre-wrap text-sm text-red-500",children:W})}const[T,D]=m.useMemo(()=>[S,u].map(V=>Oc(V)),[S,u]),N=ts(a?Ts.getRequestIdFromConversationTurn(a):"")||T,H=ts(o?Ts.getRequestIdFromConversationTurn(o):"")||D,O=(a==null?void 0:a.role)===xe.User,k=(o==null?void 0:o.role)===xe.User,P=En(),U=m.useRef(null),E=m.useRef(null),se=m.useRef(null);m.useEffect(()=>{if(U.current&&E.current&&se.current){const V=Array(11).fill(0).map((B,q)=>q/10),W=new IntersectionObserver(B=>B.forEach(q=>{q.target===E.current?(c.current.left_visibility_initial==null&&(c.current.left_visibility_initial=q.intersectionRatio),c.current.left_visibility_max=Math.max(c.current.left_visibility_max??0,q.intersectionRatio)):q.target===se.current&&(c.current.right_visibility_initial==null&&(c.current.right_visibility_initial=q.intersectionRatio),c.current.right_visibility_max=Math.max(c.current.right_visibility_max??0,q.intersectionRatio))}),{root:U.current,threshold:V});return W.observe(E.current),W.observe(se.current),()=>W.disconnect()}},[c]);const{data:ee}=Fn(void 0,!1,b),A=ee==null?void 0:ee.memoryFullPct,w=typeof A=="number"&&A>=100;return n.jsxs("div",{className:"relative flex flex-col",children:[n.jsx("div",{className:"sticky top-[-1px] z-[1] text-pretty bg-token-main-surface-primary px-6 text-center text-lg md:static",children:n.jsx(R,{id:"JgCHDY",defaultMessage:"You’re giving feedback on a new version of ChatGPT."})}),n.jsx("div",{className:"text-pretty px-6 pb-5 pt-1 text-center text-sm text-token-text-secondary",children:n.jsx(R,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),n.jsx("div",{className:"sticky top-[calc(1.75em-1px)] z-[1] h-3 bg-gradient-to-b from-token-main-surface-primary from-50% to-transparent md:static"}),n.jsx("div",{className:"-mb-2 snap-x snap-mandatory overflow-x-auto px-3 pb-4 md:px-5 lg:px-10",ref:U,children:n.jsx("div",{className:"min-w-fit",children:n.jsxs("div",{className:"mx-auto flex max-w-6xl items-start gap-4 sm:gap-6",children:[n.jsxs(da,{elemRef:E,onClick:()=>{t(e)},hasActiveRequest:r,children:[n.jsxs(ha,{children:[n.jsx(kn,{messages:v,isUserTurn:O,avatarClassName:g,showInlineEmbeddedDisplay:!1}),n.jsx(ua,{children:p?n.jsx("span",{className:"font-bold text-token-text-primary",children:f}):n.jsx(R,{...ma.responseNumber,values:{responseIndex:1}})})]}),ee!=null&&!O&&n.jsx(Tn,{messages:v,isMemoryEnabled:P,isMemoryFull:w,isParagen:!0}),n.jsx(xn,{...d,groupedMessagesToRender:S,allGroupedMessages:S,isEditing:!1,isUserTurn:O,isCompletionRequestInProgress:N,hasActiveRequest:r,handleEnterEdit:ft,handleExitEdit:ft,shouldGrowContainer:!1}),!!a&&C(a)]}),n.jsxs(da,{elemRef:se,onClick:()=>{t(s)},hasActiveRequest:r,children:[n.jsxs(ha,{children:[n.jsx(kn,{messages:y,isUserTurn:k,avatarClassName:g,showInlineEmbeddedDisplay:!1}),n.jsx(ua,{children:p?n.jsx("span",{className:"font-bold text-token-text-primary",children:x}):n.jsx(R,{...ma.responseNumber,values:{responseIndex:2}})})]}),ee!=null&&!k&&n.jsx(Tn,{messages:y,isMemoryEnabled:P,isMemoryFull:w,isParagen:!0}),n.jsx(xn,{...d,groupedMessagesToRender:u,allGroupedMessages:u,isEditing:!1,isUserTurn:k,isCompletionRequestInProgress:H,hasActiveRequest:r,handleEnterEdit:ft,handleExitEdit:ft,shouldGrowContainer:!1}),!!o&&C(o)]})]})})})]})}function da({elemRef:t,onClick:e,children:s,hasActiveRequest:a}){return n.jsxs("div",{className:"relative flex w-full min-w-[min(450px,80vw)] snap-center flex-col gap-1 truncate rounded-2xl border border-token-main-surface-tertiary bg-white p-5 text-left dark:bg-gray-700",ref:t,children:[s,a?null:n.jsx(Rt,{className:"mt-4 self-start",onClick:e,children:n.jsx(R,{id:"U2EAH6",defaultMessage:"I prefer this response"})})]})}const ua=$e.div`text-sm text-token-text-tertiary font-semibold`,ha=$e.div`flex gap-4 items-center mb-1`,ma=Le({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}"},responseChoice:{id:"ConversationTurnTwoUpFeedback.responseChoice",defaultMessage:"Choose this response"}});function Uc({clientThreadId:t,messageForRating:e,variantIds:s,conversationTurnMountTime:a}){const[o]=m.useState(()=>e.message.create_time!=null?e.message.create_time*1e3:Date.now()),[r]=m.useState(()=>Date.now());function l(c){var T,D;const d=z.getTree(t),h=s[0]||"",p=(d==null?void 0:d.getConversationTurns(h))||[],f=p[p.length-1],x=(f==null?void 0:f.messages)||[],v=x[x.length-1],y=((T=v==null?void 0:v.message)==null?void 0:T.id)||"",g=s[1]||"",S=(d==null?void 0:d.getConversationTurns(g))||[],u=S[S.length-1],b=(u==null?void 0:u.messages)||[],_=b[b.length-1],C=((D=_==null?void 0:_.message)==null?void 0:D.id)||"";De.submitMessageComparisonFeedback({feedback_version:"inline_regen_feedback:a:1.0",original_message_id:y,new_message_id:C,rating:"none",conversation_id:z.getServerThreadId(t),text:"",tags:[],completion_comparison_rating:c,new_completion_placement:"not-applicable",feedback_start_time:a,compare_step_start_time:a,new_completion_load_start_time:o,new_completion_load_end_time:r,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset()}),z.updateTree(t,N=>{N.updateNodeMetadata(e.nodeId,{inlineComparisonRating:c})}),z.updateTree(t,N=>{N.updateNodeMetadata(v.nodeId,{inlineComparisonRating:"baseline"})})}return n.jsxs(zc,{children:[n.jsx("h6",{className:"min-w-[150px] grow",children:n.jsx(R,{...Ss.regenTitle})}),n.jsxs("div",{className:"flex flex-wrap items-end justify-center gap-2",children:[n.jsx(Rt,{color:"secondary",onClick:()=>l("new"),children:n.jsx(R,{...Ss.regenBetterText})}),n.jsx(Rt,{color:"secondary",onClick:()=>l("original"),children:n.jsx(R,{...Ss.regenWorseText})}),n.jsx(Rt,{color:"secondary",onClick:()=>l("same"),children:n.jsx(R,{...Ss.regenSameText})})]}),n.jsx(Do,{onClick:()=>{z.updateTree(t,c=>{c.updateNodeMetadata(e.nodeId,{inlineComparisonRating:"skip"})})}})]})}const zc=$e.div`flex items-center p-4 rounded-2xl bg-token-main-surface-primary text-token-text-primary text-sm border border-token-border-light gap-5 mt-3`,Ss=Le({regenTitle:{id:"ConversationTurnInlineFeedback.regenTitle",defaultMessage:"Was this response better or worse?"},regenBetterText:{id:"ConversationTurnInlineFeedback.regenBetterText",defaultMessage:"Better"},regenWorseText:{id:"ConversationTurnInlineFeedback.regenWorseText",defaultMessage:"Worse"},regenSameText:{id:"ConversationTurnInlineFeedback.regenSameText",defaultMessage:"Same"}}),ga=({allGroupedMessages:t})=>t.some(e=>[ot.Browsing,ot.RetrievalBrowsing,ot.ParallelBrowsing].includes(e.type)),fa=({allGroupedMessages:t})=>t.some(e=>e.type===ot.CodeInterpreter);function Bc(t){return!t||!t.instructions?"":typeof t.instructions=="string"?t.instructions:t.instructions.filter(e=>typeof e=="string").join("")}const Gc=[{match:ga,tag:"Shouldn't have searched the web",label:ie({id:"kL047b",defaultMessage:"Shouldn't have searched the web"})},{match:ga,tag:"Don't like the source it cited",label:ie({id:"+ds/Q/",defaultMessage:"Don't like the source it cited"})},{match:fa,tag:"Shouldn't have run code",label:ie({id:"53w4ay",defaultMessage:"Shouldn't have run code"})},{match:fa,tag:"Couldn't handle my file",label:ie({id:"EkFTQ5",defaultMessage:"Couldn't handle my file"})},{match:({allGroupedMessages:t})=>t.some(e=>e.type===ot.Dalle),tag:"Shouldn't have created an image",label:ie({id:"S8FRsr",defaultMessage:"Shouldn't have created an image"})},{match:({allGroupedMessages:t})=>t.some(e=>{if(e.type!==ot.Text)return!1;const{message:s}=e.message,{content:a}=s;return a.content_type===it.Text&&Ta(s).match(/^```[\S]+\n/gm)}),tag:"Code was incorrect",label:ie({id:"4EBdQk",defaultMessage:"Code was incorrect"})},{match:({systemContent:t})=>Bc(t).includes("Personality")??!1,tag:"Too chatty or casual",label:ie({id:"ATzJKW",defaultMessage:"Too chatty or casual"})},{match:({features:t})=>t.includes(Ds.Sunshine),tag:"Shouldn't have used Memory",label:ie({id:"yfUEiz",defaultMessage:"Shouldn't have used Memory"})},{tag:"Don't like the style",label:ie({id:"nGxjdj",defaultMessage:"Don't like the style"})},{tag:"Not factually correct",label:ie({id:"Ke7JtQ",defaultMessage:"Not factually correct"})},{tag:"Didn't fully follow instructions",label:ie({id:"Rdlt9V",defaultMessage:"Didn't fully follow instructions"})},{tag:"Refused when it shouldn't have",label:ie({id:"2yRS/Q",defaultMessage:"Refused when it shouldn't have"})},{tag:"Being lazy",label:ie({id:"14MPmT",defaultMessage:"Being lazy"})},{tag:"Unsafe or problematic",label:ie({id:"02pXBl",defaultMessage:"Unsafe or problematic"})},{tag:"Other",label:ie({id:"WiIGE+",defaultMessage:"Other"})}],Wc=[{tag:"I disagree with the policy",label:ie({id:"oKyDLz",defaultMessage:"I disagree with the policy"})},{tag:"This didn't violate the policy",label:ie({id:"7fUkVF",defaultMessage:"This didn't violate the policy"})},{tag:"I don't understand the policy",label:ie({id:"4Cdp6N",defaultMessage:"I don't understand the policy"})},{tag:"This didn't take the full context",label:ie({id:"vnZJDP",defaultMessage:"This didn't take the full context"})}];function Hc(t,e,s){return e.filter(a=>!a.match||a.match(s)).map(a=>({value:a.tag,label:t.formatMessage(a.label)}))}function Vc(t){const e=t[t.length-1];if(!e)return!1;const s="message"in e?e.message:null;if(s){const{errCode:a}=On(s);return[Vn.ContentPolicy,Vn.ContentOrTos].includes(a)}else return!1}function qc({clientThreadId:t,conversationMessage:e,currentModelId:s,allGroupedMessages:a}){const o=qe(),r=An()??[],l=e.rating,c=Wr(t,e.message.id),d=(c==null?void 0:c.message.content.content_type)===it.SystemContent?c==null?void 0:c.message.content:null,h=m.useCallback(x=>{const v=z.getServerThreadId(t);v&&(x.tags.length===0&&!x.textFeedback||(J.logEvent(x.source==="inline"?Z.messageFeedbackInlineSubmitted:Z.messageFeedbackDialogSubmitted,{id:e.message.id,threadId:v,tags:x.tags,content:x.textFeedback,model:s,rating:l}),l&&De.submitMessageFeedback({message_id:e.message.id,conversation_id:v,rating:l,text:x.textFeedback,tags:x.tags,tag_choices:x.tagChoices})))},[t,e.message,s,l]),p=()=>{J.logEvent(Z.messageFeedbackMoreOptionsClicked,{id:e.message.id,threadId:z.getServerThreadId(t),model:s,rating:l})},f=Hc(o,Vc(a)?Wc:Gc,{allGroupedMessages:a,features:r,currentModelId:s,systemContent:d});return l==="thumbsUp"?null:n.jsx(Pl,{tagOptions:f,onSubmit:h,onMoreClicked:p})}const pa=[1,2,3,4,10,20,30],$c=.5;function Qc({clientThreadId:t,conversationLeafId:e}){const s=Es(Pn.isBusinessWorkspace),a=m.useRef(!1),o=zs(t),r=Bs(t),{isUnauthenticated:l}=zt(),c=m.useMemo(()=>{if(!o)return-1;const k=Ga(o);return k()>$c?-1:pa[Math.floor(k()*pa.length)]},[o]),d=Hr(t,e),h=d[d.length-1],p=m.useMemo(()=>Ts.getRequestIdFromConversationTurn(h),[h]),f=ts(p),[x,v]=m.useState(null),[y,g]=m.useState(!1),[S,u]=m.useState(!1),[b,_]=m.useState(!1),C=k=>{var U,E;const P=(E=(U=Xt(d))==null?void 0:U.messages[0])==null?void 0:E.message.id;v(k),H(P,k)},T=d.filter(k=>k.role===xe.Assistant).length,D=(h==null?void 0:h.role)===xe.Assistant,N=h==null?void 0:h.messages.some(k=>{var P;return(P=k.message.metadata)==null?void 0:P.is_nulligen}),H=m.useMemo(()=>Ia((k,P)=>{o&&k&&De.submitConversationRating({conversation_id:o,message_id:k,rating:P,shown_at_assistant_turn:c}),J.logEvent(Z.conversationRatingSubmitted,{rating:P,showAtAssistantTurn:c,conversationId:o}),g(!0),setTimeout(()=>{u(!0)},1500)},2e3),[o,c]),O=T!==c||f||!D||N||!!s||(r==null?void 0:r.kind)!==at.PrimaryAssistant||b||l;return m.useEffect(()=>{!O&&!a.current&&(J.logEvent(Z.conversationRatingShown,{showAtAssistantTurn:c,conversationId:o}),a.current=!0)},[O]),b||O?null:n.jsxs("div",{className:"mx-auto",children:[n.jsx(Fa,{children:y&&!S&&n.jsx(Ot.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:n.jsx(xa,{$padded:!0,children:n.jsx("span",{className:"text-sm text-token-text-tertiary",children:n.jsx(R,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!y&&n.jsx(Ot.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:n.jsxs(xa,{$padded:!1,children:[n.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-secondary",children:[n.jsx(R,{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?"}),n.jsxs("div",{className:"flex items-center gap-5",children:[n.jsx(un,{$selected:x==="thumbsUp",onClick:()=>C("thumbsUp"),children:n.jsx(eo,{className:"icon-md"})}),n.jsx(un,{$selected:x==="thumbsDown",onClick:()=>C("thumbsDown"),children:n.jsx(to,{className:"icon-md"})})]})]}),n.jsx("div",{className:"w-px flex-1 self-stretch bg-token-main-surface-tertiary"}),n.jsx(un,{className:"p-3",$selected:!1,onClick:()=>_(!0),children:n.jsx(hl,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const un=$e.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,xa=$e.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`;function Kc({clientThreadId:t,conversationLeafId:e,canShowIndepthFeedbackType:s,canShowInlineComparisonFeedback:a,canShowInlineMessageFeedback:o,messageForRating:r,allGroupedMessages:l,currentModelId:c,conversationTurnMountTime:d,variantIds:h}){let p=null;return Vr(t,e)?null:(s!==void 0?p=n.jsx(gc,{clientThreadId:t,conversationLeafId:e,trigger:s,variantIds:h}):r.rating&&o?p=n.jsx(qc,{clientThreadId:t,conversationMessage:r,allGroupedMessages:l,currentModelId:c}):a?p=n.jsx(Uc,{clientThreadId:t,messageForRating:r,variantIds:h,conversationTurnMountTime:d}):p=n.jsx("div",{className:"text-center",children:n.jsx(Qc,{clientThreadId:t,conversationLeafId:e})}),n.jsx("div",{className:"mt-3 w-full empty:hidden",children:p}))}const Yc=yt(()=>vt(()=>import("./sso-oprvrxl1huargirm.js").then(t=>t.m),__vite__mapDeps([32,1,2,3,33,6,7,13,34,35,36,37,38,39,15,40,11,10,41,42,43,44,45,12,9,46,47,48,49,50,17,30,51,52,28,29,53,26,27,31,54,55,56,57,58,59,60,61,19,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,16,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97])).then(t=>t.ContextualAnswerCitationCards).catch(()=>()=>null));function Xc(t){var Ze;const{turnIndex:e,conversationLeafId:s,isFinalTurn:a,clientThreadId:o,onChangeItemInView:r,onChangeRating:l,showInlineEmbeddedDisplay:c=!1,currentModelId:d,initiallyHighlightedMessageId:h,avatarClassName:p,scrollToBottom:f}=t,x=qe(),v=Rn(),y=!!v&&Oo(v),g=Dn(),S=Es(Pn.isBusinessWorkspace),u=En(),b=In(),_=Yt(qr(o,e,s)),{messages:C,variantIds:T,variantsInStreamInfo:D}=_,N=Ns(C),H=Oi();let O=C[C.length-1];for(const Q of N){const le=Pr(Q);if(le.some(ht=>H.has(ht.message.id))){O=le[le.length-1];break}}const k=C.slice(0,C.indexOf(O)+1),P=ja(),[U,E]=m.useState(!1),[se,ee]=m.useState(!1),A=T.findIndex(Q=>k.some(le=>le.nodeId===Q)),w=_.role===xe.User,V=bt(),W=St(o),B=(Ze=Ls(_.gizmoId??W))==null?void 0:Ze.data,q=Ui(),Te=B&&q.includes(B.gizmo.id),be=Wa(d),ue=Bs(o,B==null?void 0:B.gizmo.id),ze=$r(o)===Uo.PENDING,{data:Qe}=Fn(B==null?void 0:B.gizmo.id,!1,b),Ke=Qe==null?void 0:Qe.memoryFullPct,Ye=Ke!==void 0&&Ke>=100,Xe=An(),{value:Ws}=ks("1410082514"),{value:_t}=ks("2291672486"),ls=k.some(Q=>Q.message.content.content_type===it.MultimodalText),{isUnauthenticated:ae}=zt(),[rt,Ct]=m.useState(!1),[cs,Oe]=m.useState(!1);zi(()=>{_.role==="user"&&f&&f()});const lt=m.useRef(null);m.useEffect(()=>{var le;if(h==null)return;_.messages.map(ht=>ht.message.id).includes(h)&&((le=lt.current)==null||le.scrollIntoView({behavior:"auto"}))},[h]);const $=C[C.length-1],Be=$.rating,Hs=()=>{k.length===1&&(J.logEvent(Z.editPrompt,{id:k[0].message.id,threadId:z.getServerThreadId(o)}),Ue.logEvent("chatgpt_edit_prompt"),E(!0))},Vs=m.useCallback(()=>{E(!1)},[]),qs=m.useCallback(()=>{z.copyMessageToClipboard(o,e)},[o,e]),Mt=Q=>{l({nodeId:$.nodeId,messageId:$.message.id,rating:Q}),J.logEvent(Z.messageFeedbackThumbsDownClicked,{id:$.message.id,threadId:z.getServerThreadId(o),model:d,rating:Q}),ee(!0)},[ds]=m.useState(()=>Date.now()),us=m.useMemo(()=>Ts.getRequestIdFromConversationTurn(_),[_]),$s=Qr({clientThreadId:o,conversationLeafId:s}),ye=ts(us)&&!$s,Qs=Ba(),Ks=Ns(k),{showDebugConversationTurns:Ys}=rs(),hs=Kr(o),Bt=oo(o),kt=xc({clientThreadId:o,conversationMode:ue}),Gt=Ln(o),Wt=m.useCallback(({requestedModelId:Q,systemMessage:le,juice:ht,extraStreamParams:xo})=>{const bo=new mn;kt({id:$.nodeId,eventMetadata:{eventSource:"mouse"},turnTracker:bo,requestedModelId:Q,systemMessage:le,juice:ht,extraStreamParams:xo})},[$,kt]),Ht=Ws&&k.some(Q=>{var le;return((le=Q.message.metadata)==null?void 0:le.snorkle_status)!=null}),Vt=!g&&!hs&&!V&&!w,qt=Vt&&(!S||Ht),Tt=Bi(),ms=!ae&&qt&&P&&!ye&&!ze&&!c&&!U&&(ue==null?void 0:ue.kind)!==at.GizmoMagicCreate&&A===1&&a&&!$.inlineComparisonRating&&!Be&&T.length===2&&!Tt&&Date.now()-($.message.create_time??0)*1e3<1e3*60*10,gs=!ae&&qt&&!ye&&!ze&&!c&&!U&&(ue==null?void 0:ue.kind)!==at.GizmoMagicCreate&&d===ai&&a&&u&&!Ye&&Date.now()-($.message.create_time??0)*1e3<1e3*60*10,Xs=fc($),fs=O.message.author.role===xe.Assistant?O.message:null;Gi({isCompletionRequestInProgress:ye,isUserTurn:w,message:fs});const Js=gs?Xs:void 0,ct=Yr(o,T),jt=Wi(ue),ps=!Tt&&!jt&&Vt&&a&&(D==null?void 0:D.num_variants_in_stream)===2&&!$.inlineComparisonRating&&!ct,Zs=T.length===2,dt=ps,xs=ps&&!Zs,Je=!w&&!c&&!g&&!hs&&!jt&&!ze&&!ye,$t=Je&&(!S||Ht||be||y)&&!jt&&!ae&&!V,At=!g&&!c&&!((ye||ze)&&a)&&T.length>1&&!U&&!dt;let L=!1;if(w&&k.length===1){const{shouldHideContent:Q}=On(k[0]);Q&&(L=!0)}const ve=w&&!c&&!jt&&!g&&!ls&&k.length===1&&!L&&!U&&!ae,re=Q=>{r(T[Q]),J.logEvent(Z.changeNode,{intent:"toggle_between"})};if(!(_.role===xe.Root?!1:_.role===xe.System||k.every(Q=>{var le;return(le=Q.message.metadata)==null?void 0:le.is_visually_hidden_from_conversation})?Ys:!0)&&!dt)return null;const Ge=k.some(({message:Q})=>ka.getAssetPointers(Q).length>0),ut=!Ge&&a&&Bt&&!_t?n.jsx(ws,{onClick:()=>{const Q=new mn;kt({id:Gt,eventMetadata:{eventSource:"mouse"},turnTracker:Q}),Hi()},icon:Gs,label:x.formatMessage({id:"ConversationTurn.regenerateTooltip",defaultMessage:"Regenerate"}),testId:"regenerate-turn-action-button"}):null,We="h-[30px] rounded-md px-1 text-token-text-secondary hover:bg-token-main-surface-secondary",en=!Ge&&_t?n.jsx(Rc,{className:We,clientThreadId:o,message:$,onModelSelect:Wt,onDropdownChange:Ct,canRegenerateResponse:Bt}):null,tn=!w&&!L&&!c&&(!a||!ye)?n.jsx(Xi,{onClick:qs}):null,Qt=!w&&!c&&(!a||!ye)&&($.disclaimers??[]).length===0&&$.nodeId?n.jsx(Mc,{conversationId:o,message:$,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-xs text-token-text-tertiary hover:text-token-text-primary"}):null,sn=!w&&!c&&$&&(!a||!ye)?n.jsx(Ji,{message:$,isFinalTurn:a,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-token-text-tertiary hover:text-token-text-primary"}):null,Kt=$t&&!ye?n.jsxs("div",{className:"flex",children:[!(Xe!=null&&Xe.includes(Ds.ThumbsDownOnly))&&Be!=="thumbsDown"&&n.jsx(ws,{onClick:()=>Mt("thumbsUp"),disabled:Be==="thumbsUp",icon:Be==="thumbsUp"?ml:eo,label:x.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"},`thumbsUp:${$.nodeId}`),Be!=="thumbsUp"&&n.jsx(ws,{onClick:()=>Mt("thumbsDown"),disabled:Be==="thumbsDown",icon:Be==="thumbsDown"?gl:to,label:x.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"},`thumbsDown:${$.nodeId}`)]}):null,he=!_t&&n.jsx(dc,{className:We,clientThreadId:o,message:$,onModelSelect:Wt,onDropdownChange:Ct});return n.jsxs("article",{className:"w-full text-token-text-primary focus-visible:outline-2 focus-visible:outline-offset-[-4px]",ref:lt,dir:"auto","data-testid":`conversation-turn-${e}`,"data-scroll-anchor":a,onMouseEnter:()=>Oe(!0),onMouseLeave:()=>Oe(!1),children:[n.jsx(Vi,{role:_.role}),n.jsx(Ha,{clientThreadId:o,showInlineEmbeddedDisplay:c,isStaticSharedThread:g,withVerticalPadding:!0,withHorizontalPadding:!dt,children:dt?n.jsx(Dc,{isFeedbackEnabled:$t,variantIds:T,variantsInStreamInfo:D,conversationTurnMountTime:ds,stubSideBySideFeedback:xs,...t}):n.jsxs(pn,{children:[!w&&n.jsx(Zc,{children:n.jsx(kn,{messages:k,isUserTurn:w,avatarClassName:p,showInlineEmbeddedDisplay:c,gizmo:B})}),n.jsx("div",{className:te("group/conversation-turn relative flex w-full min-w-0 flex-col",!w&&qi),children:n.jsx("div",{className:"flex-col gap-1 md:gap-3",children:n.jsxs(n.Fragment,{children:[!w&&!g&&n.jsx(Tn,{messages:k,isMemoryEnabled:u,isMemoryFull:Ye,gizmoId:B==null?void 0:B.gizmo.id}),n.jsx(xn,{groupedMessagesToRender:Ks,allGroupedMessages:N,...t,isEditing:U,isUserTurn:w,isCompletionRequestInProgress:ye,isFeedbackEnabled:$t,isFinalTurn:a,hasActiveRequest:Qs,showEditButton:ve,handleEnterEdit:Hs,handleExitEdit:Vs}),Te&&n.jsx("div",{className:"mb-4",children:n.jsx($i,{messages:k})}),be&&n.jsx("div",{className:"mb-4",children:n.jsx(Yc,{messages:k})}),(Je||At)&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:te("mb-2 flex gap-3 empty:hidden",w?"mr-1 flex-row-reverse":"-ml-2"),children:n.jsx(Qi,{alwaysShow:a,showInline:a||At,isHovered:cs||rt,pagination:At&&n.jsx(Ki,{showInline:a||At,currentPage:A,onChangeIndex:re,length:T.length,className:te("self-center",T.length>1?"visible":"!invisible")}),actions:Je&&n.jsxs(n.Fragment,{children:[Qt,tn,ut,Kt,sn,he,en]})})}),Je&&!ye?n.jsx("div",{className:"pr-2 lg:pr-0",children:n.jsx(Yi,{message:$,isFinalTurn:a})}):null,a&&!ye&&n.jsx(Kc,{canShowIndepthFeedbackType:Js,canShowInlineComparisonFeedback:ms,canShowInlineMessageFeedback:se,clientThreadId:o,conversationLeafId:s,messageForRating:$,allGroupedMessages:N,currentModelId:d,conversationTurnMountTime:ds,variantIds:T})]})]})})})]})})]})}const Jc=Lo.memo(Xc),Zc=$e.div`flex-shrink-0 flex flex-col relative items-end`,ed=t=>{const e=bt();return m.useCallback(s=>{var c,d;Zi(s);const{target:a}=s;if(!(a instanceof Element))return;const o=(c=a.closest("[data-message-id]"))==null?void 0:c.getAttribute("data-message-id"),r=(d=document.getSelection())==null?void 0:d.toString(),l=z.getServerThreadId(t);!o||!r||!l||e||De.submitImplicitMessageFeedback({source:"keyboard",type:"copy",messageId:o,serverThreadId:l,selectedText:r})},[t,e])};function td({onChangeItemInView:t,onRequestMoreCompletions:e,onChangeRating:s,onRequestCompletion:a,clientThreadId:o,conversationLeafId:r,inlineEmbeddedDisplay:l,hideHeader:c}){const d=er(),h=Xr(),p=tr(),[f]=sr(),x=Bs(o),v=is(),y=oi(o),g=d.store.useContentAreaDimensions(nr.Header,E=>E!=null&&E.height?E.height:void 0),S=d.store.useIsHeaderContentAreaPopulated(),u=$a(o),{isArchived:b}=u,_=kl(y.id),C=(x==null?void 0:x.kind)===at.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":_,T=Qa(o,r),D=ar(),[N,H]=m.useState(0);m.useEffect(()=>{h&&(N===0?H(T):T-N===1&&(Ue.logEvent("chatgpt_continue_conversation_first_message_sent"),J.logEvent(Z.continueConversationFirstMessageSent)))},[T,N,h]),h&&(Ue.logEvent("chatgpt_continue_conversation_page_loaded"),J.logEvent(Z.continueConversationPageLoaded));const O=m.useCallback(()=>{p({behavior:"smooth"})},[p]),k=ed(o),P=D&&!b,U=(E,se,ee)=>[...new Array(se-E).keys()].map(A=>{const w=A+E;return n.jsx(Jc,{isFinalTurn:ee(w),turnIndex:w,clientThreadId:o,conversationLeafId:r,onChangeItemInView:t,onChangeRating:s,onRequestMoreCompletions:e,onRequestCompletion:a,currentModelId:y.id,showInlineEmbeddedDisplay:l,avatarClassName:C,scrollToBottom:O},w)});return n.jsxs("div",{onCopy:k,className:te("flex flex-col text-sm",P&&"pb-[120px]",g||P?null:"md:pb-9"),style:{paddingBottom:P?void 0:g},children:[!c&&(v==null?void 0:v.data)&&!l&&n.jsx(ao,{clientThreadId:o}),h&&n.jsxs(n.Fragment,{children:[n.jsx(pn,{children:n.jsx("p",{className:"text-xs text-gray-500",children:n.jsx(R,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),T-N===0&&n.jsx("div",{className:"text-center text-xs font-semibold text-token-text-primary",children:n.jsx("button",{onClick:()=>{Ua.openModal(za.ReportConversation)},children:n.jsx(R,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})}),U(0,N,E=>E===N-1),n.jsx(pn,{children:n.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[n.jsx(fl,{className:"icon-xs mr-2"}),n.jsx(R,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})}),U(N,T,E=>E===T-1)]}),!h&&U(0,T,E=>E===T-1),!f&&!l&&n.jsx(sd,{className:te(g?null:"bottom-5",P?S?"translate-y-[-50px]":"translate-y-[-10px]":""),style:{bottom:D?"calc(var(--composer-bar_footer-current-height) + var(--composer-bar_current-height))":g},onClick:()=>{Ue.logEvent("chatgpt_thread_scroll_to_bottom"),p({behavior:"smooth"})},children:n.jsx(pl,{className:"icon-md text-token-text-primary"})})]})}const sd=$e.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-light right-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`;function nd({clientThreadId:t,currentModelId:e}){const s=Tl(e,jl.CODE_INTERPRETER);od(s,t)}async function ad({queryKey:[t,e]}){return await De.getThreadInterpreterState(e).then(s=>(s.time_remaining_ms===0&&s.kernel_started&&hn.warning("This advanced data analysis (beta) chat has timed out. You may continue the conversation, but previous files, links, and code blocks below may not work as expected.",{hasCloseButton:!0,duration:0}),s))}function od(t,e){const s=Dn(),a=z.getServerThreadId(e);return zo({queryKey:["interpreterState",a],queryFn:ad,enabled:!!(t&&a&&!s),gcTime:0})}const id=yt(()=>vt(()=>import("./mwn2u9dq8qywh0mi.js"),__vite__mapDeps([98,1,2,3,10,6,7,11,9,30,72,48,49,85,65,27,15,38])).then(t=>t.OpenDebugSidebarButton)),rd=yt(()=>vt(()=>import("./bz3qkafcdogaf677.js"),__vite__mapDeps([99,1,2,3,6,7,68,11])),{ssr:!1}),ld=yt(()=>vt(()=>import("./sso-oprvrxl1huargirm.js").then(t=>t.n),__vite__mapDeps([32,1,2,3,33,6,7,13,34,35,36,37,38,39,15,40,11,10,41,42,43,44,45,12,9,46,47,48,49,50,17,30,51,52,28,29,53,26,27,31,54,55,56,57,58,59,60,61,19,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,16,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97])).catch(()=>()=>null),{ssr:!1}),cd=yt(()=>vt(()=>import("./sso-oprvrxl1huargirm.js").then(t=>t.P),__vite__mapDeps([32,1,2,3,33,6,7,13,34,35,36,37,38,39,15,40,11,10,41,42,43,44,45,12,9,46,47,48,49,50,17,30,51,52,28,29,53,26,27,31,54,55,56,57,58,59,60,61,19,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,16,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97])).then(t=>t.default)),dd=yt(()=>vt(()=>import("./sso-oprvrxl1huargirm.js").then(t=>t.q),__vite__mapDeps([32,1,2,3,33,6,7,13,34,35,36,37,38,39,15,40,11,10,41,42,43,44,45,12,9,46,47,48,49,50,17,30,51,52,28,29,53,26,27,31,54,55,56,57,58,59,60,61,19,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,16,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97])).then(t=>t.CAFeedbackModal).catch(()=>()=>null)),Ve=Le({doNotShareSensitive:{id:"thread.modal.onboarding.title",defaultMessage:"Do not share sensitive materials with this application"},mayProduceInaccurateInformation:{id:"thread.chatgptMayProduceInaccurateInformation-oct-30",defaultMessage:"ChatGPT can make mistakes. Check important info."},mayProduceInaccurateInformationNoAuth:{id:"thread.chatgptMayProduceInaccurateInformationNoAuth-march-27",defaultMessage:"ChatGPT can make mistakes. Check important info. Read our <termsLink>Terms</termsLink> and <privacyLink>Privacy Policy</privacyLink>."},mayProduceInaccurateInformationNoAuthV2:{id:"thread.chatgptMayProduceInaccurateInformationNoAuth-may-06",defaultMessage:"By messaging ChatGPT, you agree to our <termsLink>Terms</termsLink> and have read our <privacyLink>Privacy Policy</privacyLink>."},mayProduceInaccurateInformationNoAuthKorea:{id:"thread.chatgptMayProduceInaccurateInformationNoAuthKorea-may-06",defaultMessage:"By messaging ChatGPT, you agree to our <termsLink>Terms</termsLink> and have read our <privacyLink>Privacy Policy</privacyLink> and its <koreaAddendumLink>Korea addendum</koreaAddendumLink>."},businessDisclaimer:{id:"thread.businessDisclaimer-oct-30",defaultMessage:"{workspaceName} workspace chats aren't used to train our models. ChatGPT can make mistakes."},businessDisclaimerNoName:{id:"thread.businessDisclaimerNoName-oct-30",defaultMessage:"Your workspace chats aren'ts used to train our models. ChatGPT can make mistakes."},outdatedGptDisclaimer:{id:"thread.outdatedGptDisclaimer.0",defaultMessage:"<bold>New version of GPT available</bold> - Continue chatting to use the old version, or start a <link>new chat</link> for the latest version."},somethingWentWrong:{id:"thread.modal.unrecoverableError.title",defaultMessage:"Something went wrong"},tryAgainLater:{id:"thread.modal.unrecoverableError.description",defaultMessage:"We're sorry, but something went wrong. Please try again later."},resetThread:{id:"thread.modal.unrecoverableError.resetThread",defaultMessage:"Reset thread"},sharedConversationReportConversation:{id:"thread.sharedConversation.report",defaultMessage:"Report conversation"},latencyButton:{id:"thread.latencyButton",defaultMessage:"Latency"},archivedConversationDescription:{id:"thread.archivedConversationDescription",defaultMessage:"This conversation is archived. To continue, please unarchive it first."},unarchiveButton:{id:"thread.unarchiveButton",defaultMessage:"Unarchive"}});function ba({clientThreadId:t}){const e=St(t);return e!=null?n.jsx(ud,{clientThreadId:t,gizmoId:e}):n.jsx(po,{clientThreadId:t})}function ud({clientThreadId:t,gizmoId:e}){const s=Ls(e).data,a=Ka(r=>Us.getThreadCreateTime(t,r)),o=(s==null?void 0:s.gizmo.updated_at)!=null?new Date(s.gizmo.updated_at):void 0;return(s==null?void 0:s.gizmo.short_url)==null||o==null||a==null||o<=a?n.jsx(po,{clientThreadId:t}):n.jsxs("div",{className:"text-token-text-tertiary",children:[n.jsx(xl,{className:"text-token-secondary mb-1 mr-1 inline-block h-4 w-4 stroke-0"}),n.jsx(R,{...Ve.outdatedGptDisclaimer,values:{link:r=>n.jsx(Jo,{to:ui(s.gizmo.short_url),className:"underline",children:r}),bold:r=>n.jsx("span",{className:"text-token-secondary font-semibold",children:r})}})]})}function hd({clientThreadId:t}){return Mr(s=>s.hasAcceptedFooterDisclaimer)?n.jsx("div",{children:n.jsx(R,{...Ve.mayProduceInaccurateInformation})}):n.jsx(md,{clientThreadId:t})}function po({clientThreadId:t}){const e=Es(Pn.isBusinessWorkspace),s=Es(d=>d.currentWorkspace),a=s==null?void 0:s.name,{isUnauthenticated:o,isLoading:r}=zt(),c=Ya({clientThreadId:t,role:xe.User})>0;return r?null:e?n.jsx("div",{children:a!=null?n.jsx(R,{...Ve.businessDisclaimer,values:{workspaceName:a}}):n.jsx(R,{...Ve.businessDisclaimerNoName})}):o&&!c?n.jsx(Zo,{children:n.jsx(hd,{clientThreadId:t})}):n.jsx("div",{children:n.jsx(R,{...Ve.mayProduceInaccurateInformation})})}function md({clientThreadId:t}){const{country:e}=ei(),s=e==="KR"?Ve.mayProduceInaccurateInformationNoAuthKorea:Ve.mayProduceInaccurateInformationNoAuthV2,{layer:a}=Rs("3637408529"),o=(a==null?void 0:a.get("should_show_disclaimer_only_once_per_device",!1))??!1;return m.useEffect(()=>()=>{Ya({clientThreadId:t,role:xe.User})>0&&kr.updateHasAcceptedFooterDisclaimer(o)},[t,o]),n.jsx("span",{className:"text-sm leading-none",children:n.jsx(R,{...s,values:{privacyLink:r=>n.jsx("a",{href:"https://openai.com/privacy",target:"_blank",className:"text-token-text-primary underline decoration-token-text-primary",onClick:()=>{Ue.logEvent("chatgpt_footer_disclaimer_privacy_link_clicked"),J.logEvent(Z.footerDisclaimerPrivacyLinkClicked)},rel:"noreferrer",children:r}),termsLink:r=>n.jsx("a",{href:"https://openai.com/terms",target:"_blank",className:"text-token-text-primary underline decoration-token-text-primary",onClick:()=>{Ue.logEvent("chatgpt_footer_disclaimer_terms_link_clicked"),J.logEvent(Z.footerDisclaimerTermsLinkClicked)},rel:"noreferrer",children:r}),koreaAddendumLink:r=>n.jsx("a",{href:"https://openai.com/ko/policies/kr-privacy-policy-addendum",target:"_blank",className:"text-token-text-primary underline decoration-token-text-primary",onClick:()=>{Ue.logEvent("chatgpt_footer_disclaimer_korea_addendum_link_clicked"),J.logEvent(Z.footerDisclaimerKoreaAddendumLinkClicked)},rel:"noreferrer",children:r})}})})}function gd({clientThreadId:t}){const e=Aa(),s=zs(t),a=async()=>{s&&(await De.patchConversation(s,{is_archived:!1}),e.invalidateQueries({queryKey:["conversation",t]}),Ka.setState(o=>{const r=o.threads[s];r!=null&&(r.initialThreadData.isArchived=!1)}),_l(e))};return n.jsxs("div",{className:"my-6 flex flex-col items-center justify-center gap-4",children:[n.jsx("div",{className:"px-3 text-center text-sm text-token-text-secondary",children:n.jsx(R,{...Ve.archivedConversationDescription})}),n.jsx("div",{children:n.jsx(Rt,{disabled:!s,onClick:a,icon:bl,children:n.jsx(R,{...Ve.unarchiveButton})})})]})}function fd(t,e){const s=es(t),a=z.getTitle(t);return e&&e.kind===at.GizmoInteraction&&e.gizmo?s?`ChatGPT - ${e.gizmo.gizmo.display.name}`:a&&`${e.gizmo.gizmo.display.name} - ${a}`:s?"ChatGPT":a}const Bd=function({clientThreadId:t,onCompletionFinished:e,onCreate:s,preRequestCompletion:a,hideHeader:o,hideMessages:r,hideFooter:l,hideToolsOverlay:c,messagesVerticalAlign:d="top",prependThreadChildren:h,renderEmptyState:p}){const f=Aa(),x=Bo(),v=is(),y=An(),g=ja(),S=js(),u=Dr(t),b=Va(t),_=Ln(t),T=$a(t).isArchived;m.useEffect(()=>{b||(es(t)?qn.addTiming("chatgpt.web.chatPage.renderNewConversation"):qn.addTiming("chatgpt.web.chatPage.renderExistingConversation"))},[t,b]);const D=Jr(t,_),N=Qa(t,_),{setTargetedContent:H}=or(),O=y==null?void 0:y.includes(Go),k=ir(),P=N>=2,U=es(t)&&!P&&an(u),E=es(t)&&!D&&(an(u)||(u==null?void 0:u.kind)===at.GizmoTest),ee=ii().id,A=ri(t)??ee,{value:w}=ks("4203174056"),V=li(t,Wo.Search),W=Wa(A),q=Na()[A],Te=fd(t,u),be=Bs(t),ue=rr(),wt=Lr(t),{config:ze}=Ho("1013114931"),Qe=ze.get("show_follow_ups",!1)&&(v==null?void 0:v.isPersonalAccount()),Ke=!S.displayingSideBySideFeedback&&Qe,Ye=bt();m.useEffect(()=>{Kn()},[]),m.useEffect(()=>{ue||H(void 0),z.getLastMessgageSystemHints(t,_).includes(As.Search)&&V?Yn.addPersistedSystemHint(As.Search):Yn.clear()},[t,H,ue,_,x.search,V]);const Xe=m.useCallback(L=>{if(L==null||(e==null||e(L),Ye)||((be==null?void 0:be.kind)===at.GizmoInteraction&&ci.handleGizmoInteracted(f,be.gizmo_id),!(wt||Ke)))return;const re=z.getThreadCurrentLeafId(L),ge=z.getTree(L).getMessage(re);Vo(ge)||qo(ge)||lr(L,ge.id,A)},[f,e,be,wt,Ke,A,Ye]),Ws=Zr(t),_t=Or({clientThreadId:t,continuingFromSharedConversationId:Ws,onCompletionFinished:Xe,onCreate:s}),ls=m.useCallback(()=>{const L=z.getThreadCurrentLeafId(t);if(L==null)return;const re=z.getTree(t).getBranchFromLeaf(L);cr.abortRequests(re.map(ge=>ge.id))},[t]),ae=rs(),{isUnauthenticated:rt,isLoading:Ct}=zt(),cs=dr(),Oe=m.useCallback(async({type:L,promptId:ve,requestedModelId:re,eventMetadata:ge,cancelActiveRequests:Ge,focusOnNewCompletion:Nt=!0,useDefaultModel:ut,completionMetadata:We,appendMessages:Gn,updateTree:en,turnTracker:tn,extraStreamParams:Qt})=>{Kn(),ur.reset(),Ge&&ls();const sn=performance.now();let Kt=A;re?Kt=re:ut&&(Kt=ee);const he=hr({namespace:mr.CompletionRequest,key:ve});he==null||he.logTiming("start_chat_requirements");const Ze=await $o();he==null||he.logTiming("fetched_chat_requirements"),Ze.force_login&&cs({authType:"login"});const Q=await Qo.getEnforcementToken(Ze);he==null||he.logTiming("fetched_arkose_token");const le=await gr.getEnforcementToken(Ze);he==null||he.logTiming("fetched_turnstile_token");const ht=await Ko.getEnforcementToken(Ze);he==null||he.logTiming("fetched_p_token"),a==null||a(t,ve),_t({model:Kt,completionType:L,parentNodeId:ve,metadata:ge,focusOnNewCompletion:Nt,completionMetadata:We,chatReq:Ze,arkoseToken:Q??null,turnstileToken:le??null,proofToken:ht??null,preflightTime:performance.now()-sn,extraStreamParams:{forceParagen:ae.forceParagen,forceParagenModel:ae.forceParagenModel.value,forceNulligen:ae.forceNulligen,forceRateLimit:ae.forceRateLimit,resetRateLimits:ae.resetRateLimits,disableSystemContentToggling:ae.rebaseSystemMessageContent?!0:void 0,forceUseSearch:ae.forceUseSearch??(Qt==null?void 0:Qt.forceUseSearch)},appendMessages:Gn,updateTree:en,turnTracker:tn}),rt&&fr.incrementUserMessageCount()},[ee,A,a,t,_t,ae.forceParagen,ae.forceParagenModel,ae.forceNulligen,ae.forceRateLimit,ae.resetRateLimits,ae.rebaseSystemMessageContent,ae.forceUseSearch,ls,cs,rt]),lt=!!(v!=null&&v.features.includes(Ds.SharedWebsocket));m.useEffect(()=>{lt&&on.registerIfNotConnected()},[lt]),m.useEffect(()=>{const L=()=>{if(document.visibilityState==="visible"){if(!lt)return;on.registerIfNotConnected()}};return document.addEventListener("visibilitychange",L),()=>{document.removeEventListener("visibilitychange",L)}},[lt]);const $=zs(t);m.useEffect(()=>{const L=()=>{on.stopConversation($)};return window.addEventListener("beforeunload",L),()=>{window.removeEventListener("beforeunload",L)}},[$]);const Be=di({clientThreadId:t,currentLeafId:_,handleRequestCompletion:Oe}),Hs=m.useCallback((L,ve,re,ge=!0,Ge="none",Nt)=>{const We=z.getTree(t).getParentPromptNode(L).id;Oe({type:Ma.Variant,promptId:We,eventMetadata:ve,cancelActiveRequests:!1,focusOnNewCompletion:ge,useDefaultModel:Nt,completionMetadata:{variantPurpose:Ge,conversationMode:Us.getConversationMode(t)},turnTracker:re})},[Oe,t]),Vs=m.useCallback(L=>{const re=z.getTree(t).getLeafFromNode(L);z.setThreadCurrentLeafId(t,re.id)},[t]),[qs,Mt]=m.useState(),ds=m.useCallback(({nodeId:L,messageId:ve,rating:re})=>{var ut;const ge=z.getServerThreadId(t);J.logEvent(Z.thumbRating,{id:ve,threadId:ge,rating:re,model:A});const Ge=z.getTree(t),Nt=Ge.getNodeByIdOrMessageId(L);if(ge!==void 0&&(W?ft:De.submitMessageFeedback)({message_id:ve,conversation_id:ge,rating:re}),z.updateTree(t,We=>{We.updateNodeMetadata(L,{rating:re})}),W){Mt(n.jsx(dd,{citations:((ut=Nt.message.metadata)==null?void 0:ut.citations)??[],rating:re,conversationId:ge??"",messageId:ve,onSubmit:()=>{Mt(void 0)},onCancel:()=>Mt(void 0),conversationTree:Ge,nodeId:L},`${L}-${re}`));return}},[t,A,W]),{setShowReferralInviteModal:us}=Xn(L=>({setShowReferralInviteModal:L.setShowReferralInviteModal})),$s=m.useCallback(()=>{us(!1)},[us]),ye=Xn(L=>L.showReferralInviteModal);nd({clientThreadId:t,currentModelId:A});const Qs=L=>n.jsx(Al,{scrollAnchorTopOffset:o?0:Cr,children:d==="bottom"?n.jsxs("div",{className:"flex h-full flex-col",children:[n.jsx("div",{className:"flex-1"}),L]}):L});m.useEffect(()=>{document.title=Te??"ChatGPT"},[Te]);const Ks=St(t),Ys=bt(),hs=Ol(),Bt=E&&!p&&g&&!Ks&&!W&&!Ys,kt=Bt&&!Ct&&rt,Gt=Bt&&!Ct&&!rt,Wt=Gt&&hs,Ht=Ul(kt),Vt=Ll(Gt),qt=zl(Wt),Tt=kt&&Ht||Gt&&Vt||Wt&&qt,ms=Ht||Vt||qt,gs=Tt&&!Ct&&rt,{composerBarSize:Xs,composerSkeleton:fs,footerBarSize:Js,isClippedComposerBar:ct,setComposerBarElement:jt,setFooterBarElement:ps,ThreadSizeWrapper:Zs}=pr({isArchived:T}),dt=xr(),{reset:xs,streamingContext:Je,StreamingProvider:$t}=br();m.useEffect(()=>{dt&&(Je.setOnResetContext=()=>{xs()})},[dt,xs,Je]);const At=ct?{footerBarSize:Js,composerBarSize:Xs}:{};return n.jsx($t,{value:Je,children:n.jsxs(Zs,{...At,children:[O&&n.jsx(rd,{}),w&&n.jsx(cd,{}),n.jsx(Yo,{children:Te!=null&&n.jsx("title",{children:Te})}),(u==null?void 0:u.kind)===at.GizmoInteraction&&u.gizmo&&n.jsx(hi,{gizmo:u.gizmo}),n.jsx(Ca.Provider,{value:Oe,children:n.jsxs(yr,{children:[n.jsxs(Ur,{clientThreadId:t,currentModelConfig:q,className:"composer-parent flex h-full flex-col focus-visible:outline-0",children:[!r&&n.jsx(pd,{className:te(ct&&"masked-content"),style:{"--composer-bar_skeleton":fs},children:!b&&!Be?E?p??n.jsx($n,{shouldSSR:!ms,children:n.jsx(sc,{clientThreadId:t,currentModelId:A,onRequestCompletion:Oe,enableV2Homepage:Tt,v2HomepageDisclaimer:gs&&n.jsx(ba,{clientThreadId:t})})}):P?Qs(n.jsxs(n.Fragment,{children:[h,n.jsx(td,{onChangeItemInView:Vs,onRequestMoreCompletions:Hs,onChangeRating:ds,onRequestCompletion:Oe,clientThreadId:t,inlineEmbeddedDisplay:!1,conversationLeafId:_,hideHeader:o},t)]})):null:null}),n.jsx(xd,{className:te(ct&&"mask-scrollbars absolute bottom-0 z-20"),children:T?n.jsx(gd,{clientThreadId:t}):n.jsxs("div",{className:te(ct&&"relative mx-auto flex max-w-3xl flex-1 flex-col"),children:[ct?n.jsx(vr,{skeleton:fs}):null,!Tt&&n.jsx($n,{shouldSSR:!ms,children:n.jsx(zr,{clientThreadId:t,isNewThread:U,setComposerBarElement:jt,showPromptStarters:U||!D,currentModelId:A,onRequestCompletion:Oe})}),!l&&n.jsx("div",{ref:ps,className:"relative w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",children:an(u)&&!gs&&n.jsx("div",{className:"min-h-4",children:n.jsx(ba,{clientThreadId:t})})})]})})]}),!c&&n.jsxs("div",{className:"group absolute bottom-2 end-2 z-20 hidden gap-1 md:flex lg:bottom-3 lg:end-3",children:[k?n.jsxs(n.Fragment,{children:[n.jsx(id,{}),n.jsx(ld,{})]}):null,n.jsx(yl,{})]}),qs,n.jsx(mi,{clientThreadId:t,isStaticSharedThread:!1}),n.jsx(Sr,{}),(y==null?void 0:y.includes(Xo))&&n.jsx(wr,{isOpen:ye,onClose:$s}),n.jsx(_r,{conversationId:t,currentModelId:A})]})})]})})},pd=$e.div`grow flex-1 overflow-hidden`,xd=$e.div`md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent w-full`;export{Jc as C,Bd as T,td as a,Dl as b};
//# sourceMappingURL=fs0k2djxqaat0xdv.js.map
