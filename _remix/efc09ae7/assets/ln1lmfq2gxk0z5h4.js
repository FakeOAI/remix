const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/im4fxk9qc4brzbwa.js","assets/og7ldlwzbwhzl9hz.js","assets/maxs0xk15a82pqfq.js","assets/k81ulejtlkx2713k.js","assets/ogb0m6wfmpkwr4v0.js","assets/b9t2rzfm26s20fe0.js","assets/root-jhqn5s0d.css","assets/m0ujq4si8sio1lz0.js","assets/conversation-small-lkohtmkm.css","assets/cymro46oa7nb2e4p.js","assets/ebbi4stfxu4leo9p.js","assets/nath3ahjullxvkj2.js","assets/jeztwd4vodinit8p.js","assets/g04e24001bc4ci45.js","assets/deb02ocluok9oo0e.js","assets/k16m2blxis1lpu5v.js","assets/lto5kz4mx804bx31.js","assets/fzrn137102spawew.js","assets/mmu1mgyeh9mpscy4.js","assets/1mq4bl028ayzaqnn.js","assets/mth7lkecabvrdtw9.js","assets/pa6676obnrhvhjmt.js","assets/lg1w1hqcuu1wg906.js","assets/ctqpas7qullo0dti.js","assets/bq1gy5eu91rjynn4.js","assets/k1fzkqjpkkbdu3n6.js","assets/em9xvr7o2er75712.js","assets/ob9x0as5f3378ugm.js","assets/gfl51laubp5uvdto.js","assets/kodfiaxamg96joox.js","assets/htl6ak4q1wj6u6hf.js","assets/kp4pdsymfh6nf4al.js","assets/c2tpob5fa1037mb8.js","assets/kwhmc9f1dnjae9qo.js","assets/oi46w43asy7iv6cx.js","assets/ot88f4qd1uexqhjn.js"])))=>i.map(i=>d[i]);
import{b9 as N,n as q,r as v,V as Ve,go as bt,m as p,aJ as B,l as J,b as yt,e1 as He,aV as se,gz as xt,c1 as Fe,c2 as Tt,c3 as Pt,c4 as Ge,aW as St,aO as Ye}from"./ogb0m6wfmpkwr4v0.js";import{j as _,E as le,Z as K,k as Ue,l as kt,H as Ot,G as I,i as Ee,C as Ce}from"./ebbi4stfxu4leo9p.js";import{c as Lt,S as At,H as Mt,x as wt,t as c}from"./maxs0xk15a82pqfq.js";import{_ as ze}from"./fzrn137102spawew.js";import{E as It,a5 as Q,a6 as H,a7 as L,a8 as ae,a9 as Rt,aa as ie,ab as _e,ac as Dt,ad as Bt,ae as jt,af as Vt,a2 as j,ag as Ke,ah as Ht,ai as Xe,aj as Ft,ak as $e,al as Gt,am as Yt}from"./k81ulejtlkx2713k.js";import{b1 as X,bx as w,bi as We,kT as Ut,k_ as zt,cy as Kt,c$ as qe,iq as Y,k$ as Xt,l0 as ve,kn as $t,ke as Wt,l1 as qt,l2 as Jt,kg as Zt,i as Qt,g6 as eo}from"./m0ujq4si8sio1lz0.js";import{b as to}from"./cof65v04mq70bnz9.js";import{T as oo,P as Je,f as no,c as ro,i as so,j as ao,D as Ne,h as Ze}from"./k16m2blxis1lpu5v.js";import{m as D}from"./cymro46oa7nb2e4p.js";import{u as ce}from"./g04e24001bc4ci45.js";import{c as Qe,R as io,I as co}from"./dd0dshqjyy6eihs0.js";import{al as lo,bW as uo}from"./b9t2rzfm26s20fe0.js";import{u as mo}from"./lg1w1hqcuu1wg906.js";import{i as fo}from"./lto5kz4mx804bx31.js";const po="_modelCursor_1mtn0_1",$n={modelCursor:po},go=(...e)=>o=>{e.forEach(t=>{if(typeof t=="function")t(o);else if(t){const n=t;n.current=o}})};function k(e){return new Lt(At.define(e))}const be=()=>N(()=>import("./pbl95wx6493wq92j.js"),[]).then(e=>k(e.shell)),et={[_.bash]:be,[_.zsh]:be,[_.swift]:()=>N(()=>import("./pijqfo56g5y7ss6b.js"),[]).then(e=>k(e.swift)),[_.css]:()=>N(()=>import("./im4fxk9qc4brzbwa.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(e=>e.css()),[_.html]:()=>N(()=>import("./ctqpas7qullo0dti.js"),__vite__mapDeps([23,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,0,24])).then(e=>e.html()),[_.javascript]:()=>N(()=>import("./bq1gy5eu91rjynn4.js"),__vite__mapDeps([24,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(e=>e.javascript({jsx:!0,typescript:!1})),[_.typescript]:()=>N(()=>import("./bq1gy5eu91rjynn4.js"),__vite__mapDeps([24,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(e=>e.javascript({jsx:!0,typescript:!0})),[_.json]:()=>N(()=>import("./k1fzkqjpkkbdu3n6.js"),__vite__mapDeps([25,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(e=>e.json()),[_.python]:()=>N(()=>import("./em9xvr7o2er75712.js"),__vite__mapDeps([26,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(e=>e.python()),[_.sql]:()=>N(()=>import("./ob9x0as5f3378ugm.js"),__vite__mapDeps([27,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,1])).then(e=>e.sql()),[_.go]:()=>N(()=>import("./gfl51laubp5uvdto.js"),__vite__mapDeps([28,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(e=>e.go()),[_.yaml]:()=>N(()=>import("./kodfiaxamg96joox.js"),__vite__mapDeps([29,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(e=>e.yaml()),[_.java]:()=>N(()=>import("./htl6ak4q1wj6u6hf.js"),__vite__mapDeps([30,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(e=>e.java()),[_.rust]:()=>N(()=>import("./kp4pdsymfh6nf4al.js"),__vite__mapDeps([31,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(e=>e.rust()),[_.cpp]:()=>N(()=>import("./c2tpob5fa1037mb8.js"),__vite__mapDeps([32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(e=>e.cpp()),[_.php]:()=>N(()=>import("./kwhmc9f1dnjae9qo.js"),__vite__mapDeps([33,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,0,24])).then(e=>e.php()),[_.xml]:()=>N(()=>import("./oi46w43asy7iv6cx.js"),__vite__mapDeps([34,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(e=>e.xml()),[_.vue]:()=>N(()=>import("./ot88f4qd1uexqhjn.js"),__vite__mapDeps([35,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,1,0,24])).then(e=>e.vue()),[_.ruby]:()=>N(()=>import("./e4lhyu305wu0fcut.js"),[]).then(e=>k(e.ruby)),[_.haskell]:()=>N(()=>import("./bf6r3t2rw7f01so5.js"),[]).then(e=>k(e.haskell)),[_.kotlin]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>k(e.kotlin)),[_.csharp]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>k(e.csharp)),[_.c]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>k(e.c)),[_.objectivec]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>k(e.objectiveC)),[_.r]:()=>N(()=>import("./n0t2rpizlasjzcxa.js"),[]).then(e=>k(e.r)),[_.lua]:()=>N(()=>import("./harowmpdmpnd9wki.js"),[]).then(e=>k(e.lua)),[_.dart]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>k(e.dart)),[_.scala]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>k(e.scala)),[_.perl]:()=>N(()=>import("./gq1ss5v2zpbborxl.js"),[]).then(e=>k(e.perl)),[_.commonlisp]:()=>N(()=>import("./jr6cjysmysifr6mr.js"),[]).then(e=>k(e.commonLisp)),[_.clojure]:()=>N(()=>import("./gf1tfl9d2himhfic.js"),[]).then(e=>k(e.clojure)),[_.ocaml]:()=>N(()=>import("./khji33iw1sxityyt.js"),[]).then(e=>k(e.oCaml)),[_.powershell]:()=>N(()=>import("./i9u5kd7kvamutmln.js"),[]).then(e=>k(e.powerShell)),[_.verilog]:()=>N(()=>import("./fix340p09fldyqxz.js"),[]).then(e=>k(e.verilog)),[_.dockerfile]:()=>N(()=>import("./cgm5tyzi32u32j10.js"),[]).then(e=>k(e.dockerFile)),[_.other]:()=>null},ho=e=>e in et,oe={},Wn=async e=>{if(oe[e]!=null)return oe[e];if(ho(e)){const o=await et[e]();return oe[e]=o,o}return null},qn=e=>oe[e]??null;var tt=e=>{var{theme:o,settings:t={},styles:n=[]}=e,r={".cm-gutters":{}},s={};t.background&&(s.backgroundColor=t.background),t.backgroundImage&&(s.backgroundImage=t.backgroundImage),t.foreground&&(s.color=t.foreground),t.fontSize&&(s.fontSize=t.fontSize),(t.background||t.foreground)&&(r["&"]=s),t.fontFamily&&(r["&.cm-editor .cm-scroller"]={fontFamily:t.fontFamily}),t.gutterBackground&&(r[".cm-gutters"].backgroundColor=t.gutterBackground),t.gutterForeground&&(r[".cm-gutters"].color=t.gutterForeground),t.gutterBorder&&(r[".cm-gutters"].borderRightColor=t.gutterBorder),t.caret&&(r[".cm-content"]={caretColor:t.caret},r[".cm-cursor, .cm-dropCursor"]={borderLeftColor:t.caret});var a={};t.gutterActiveForeground&&(a.color=t.gutterActiveForeground),t.lineHighlight&&(r[".cm-activeLine"]={backgroundColor:t.lineHighlight},a.backgroundColor=t.lineHighlight),r[".cm-activeLineGutter"]=a,t.selection&&(r["&.cm-focused .cm-selectionBackground, & .cm-line::selection, & .cm-selectionLayer .cm-selectionBackground, .cm-content ::selection"]={background:t.selection+" !important"}),t.selectionMatch&&(r["& .cm-selectionMatch"]={backgroundColor:t.selectionMatch});var i=It.theme(r,{dark:o==="dark"}),l=Mt.define(n),u=[i,wt(l)];return u},Eo={background:"#ffffff",foreground:"#383a42",caret:"#000",selection:"#add6ff",selectionMatch:"#a8ac94",lineHighlight:"#f0f0f0",gutterBackground:"#fff",gutterForeground:"#237893",gutterActiveForeground:"#0b216f",fontFamily:'Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace'},Co=[{tag:[c.keyword,c.operatorKeyword,c.modifier,c.color,c.constant(c.name),c.standard(c.name),c.standard(c.tagName),c.special(c.brace),c.atom,c.bool,c.special(c.variableName)],color:"#0000ff"},{tag:[c.moduleKeyword,c.controlKeyword],color:"#af00db"},{tag:[c.name,c.deleted,c.character,c.macroName,c.propertyName,c.variableName,c.labelName,c.definition(c.name)],color:"#0070c1"},{tag:c.heading,fontWeight:"bold",color:"#0070c1"},{tag:[c.typeName,c.className,c.tagName,c.number,c.changed,c.annotation,c.self,c.namespace],color:"#267f99"},{tag:[c.function(c.variableName),c.function(c.propertyName)],color:"#795e26"},{tag:[c.number],color:"#098658"},{tag:[c.operator,c.punctuation,c.separator,c.url,c.escape,c.regexp],color:"#383a42"},{tag:[c.regexp],color:"#af00db"},{tag:[c.special(c.string),c.processingInstruction,c.string,c.inserted],color:"#a31515"},{tag:[c.angleBracket],color:"#383a42"},{tag:c.strong,fontWeight:"bold"},{tag:c.emphasis,fontStyle:"italic"},{tag:c.strikethrough,textDecoration:"line-through"},{tag:[c.meta,c.comment],color:"#008000"},{tag:c.link,color:"#4078f2",textDecoration:"underline"},{tag:c.invalid,color:"#e45649"}];function _o(e){var{theme:o="dark",settings:t={},styles:n=[]}=e||{};return tt({theme:o,settings:ze({},Eo,t),styles:[...Co,...n]})}_o();var vo={background:"#1e1e1e",foreground:"#9cdcfe",caret:"#c6c6c6",selection:"#6199ff2f",selectionMatch:"#72a1ff59",lineHighlight:"#ffffff0f",gutterBackground:"#1e1e1e",gutterForeground:"#838383",gutterActiveForeground:"#fff",fontFamily:'Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace'},No=[{tag:[c.keyword,c.operatorKeyword,c.modifier,c.color,c.constant(c.name),c.standard(c.name),c.standard(c.tagName),c.special(c.brace),c.atom,c.bool,c.special(c.variableName)],color:"#569cd6"},{tag:[c.controlKeyword,c.moduleKeyword],color:"#c586c0"},{tag:[c.name,c.deleted,c.character,c.macroName,c.propertyName,c.variableName,c.labelName,c.definition(c.name)],color:"#9cdcfe"},{tag:c.heading,fontWeight:"bold",color:"#9cdcfe"},{tag:[c.typeName,c.className,c.tagName,c.number,c.changed,c.annotation,c.self,c.namespace],color:"#4ec9b0"},{tag:[c.function(c.variableName),c.function(c.propertyName)],color:"#dcdcaa"},{tag:[c.number],color:"#b5cea8"},{tag:[c.operator,c.punctuation,c.separator,c.url,c.escape,c.regexp],color:"#d4d4d4"},{tag:[c.regexp],color:"#d16969"},{tag:[c.special(c.string),c.processingInstruction,c.string,c.inserted],color:"#ce9178"},{tag:[c.angleBracket],color:"#808080"},{tag:c.strong,fontWeight:"bold"},{tag:c.emphasis,fontStyle:"italic"},{tag:c.strikethrough,textDecoration:"line-through"},{tag:[c.meta,c.comment],color:"#6a9955"},{tag:c.link,color:"#6a9955",textDecoration:"underline"},{tag:c.invalid,color:"#ff0000"}];function bo(e){var{theme:o="dark",settings:t={},styles:n=[]}=e||{};return tt({theme:o,settings:ze({},vo,t),styles:[...No,...n]})}var Jn=bo(),V=(e=>(e[e.up=-1]="up",e[e.down=1]="down",e))(V||{}),ne=(e=>(e.COMMENT="comment",e.COMPOSER="composer",e))(ne||{}),O=(e=>(e.COLLAPSED="collapsed",e.EXPANDED="expanded",e))(O||{});const ot=([e,o],[t,n])=>{const r=e+o,s=t+n;return e<s&&t<r},de=([e,o])=>e+o,z=e=>{if(e.type===O.COLLAPSED)return[e.offsetY??0,0];const{offsetY:o,shiftY:t=0,height:n=0}=e,r=o+t;return t<0?[r,n+Math.abs(t)]:[r,n]},yo=(e,o,t)=>{if(!ot(e,o))return null;const[n,r]=e,s=n+r,[a,i]=o,l=a+i,u=a-s,f=l-n;return t===V.up?u:f};var nt=(e=>(e.ABOVE="above",e.BELOW="below",e))(nt||{});function W(e,o){return q(e.coordsAtPos(o))}const ye=360,xo=250,rt=44,xe=.5,Te=[.5,.9,1],To=[1,.75,.2],Po=({onClose:e,onSubmit:o,opensOverDocument:t=!1,opensFromGutter:n=!1,gutterHasComments:r=!1},s)=>{const a=Ve(),i=v.useRef(null),l=v.useRef(!1),[u,f]=v.useState(""),[d,m]=v.useState(!0),g=()=>{f(""),e?.(l.current)},h=(y=u)=>{l.current=!0,o?.(y),f("")},C=bt(({windowWidth:y})=>t?y<ye+100?xo:ye:le,0),E={};n&&(E.top=-12),t&&n?E.right=0:E.left=0;let b="";n&&!t?b="8px 50%":n&&t?b="calc(100% + 8px) 50%":t&&(b="center left");let P=0;n&&!t&&r&&(P=kt);const T=y=>{const{metaKey:R,shiftKey:S,key:A}=y;A==="Enter"&&u&&!(S||R)?(h(),y.preventDefault()):A==="Escape"&&(f(""),e?.(!1))},x=a.formatMessage({id:"VvfbvY",defaultMessage:"Edit or explain..."});return p.jsx(D.div,{ref:go(i,s),className:B("absolute flex items-center",K.commentComposer),style:{...E,minHeight:rt},transition:{type:"spring",bounce:.18,duration:.48},initial:{translateX:0},animate:{translateX:P},exit:{translateX:0},children:p.jsx(D.div,{className:B("no-scrollbar relative z-10 flex items-center overflow-x-hidden border border-token-border-light",Ue,{"rounded-full":d,"rounded-2xl":!d}),initial:{width:t?le:24,scaleX:t?xe:void 0,scale:t?void 0:xe},animate:{width:C,scaleX:t?Te:void 0,scale:t?void 0:Te},exit:{filter:"blur(16px)",scale:t?void 0:To,width:t?le:24,opacity:t?0:[1,1,0]},transition:{type:"spring",bounce:t?.14:0,duration:.28,scale:{type:"tween",duration:.2},opacity:{type:"tween",time:[0,.95,1]}},style:{transformOrigin:b},children:p.jsxs(D.div,{className:"relative z-0 flex w-full items-center bg-token-main-surface-primary px-4 py-2.5",children:[p.jsx(D.div,{className:"backdrop-saturate-25 absolute inset-0 z-[-1] bg-gray-50/75 backdrop-blur-3xl dark:bg-gray-700/75",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.2}}),p.jsx(fo,{"aria-placeholder":x,value:u,className:"w-full resize-none border-0 bg-transparent px-1 py-0 pr-2 text-token-text-primary outline-0 placeholder:text-token-text-secondary focus:ring-0 focus-visible:ring-0",autoFocus:!0,maxRows:4,onBlur:g,onHeightChange:(y,{rowHeight:R})=>{m(Math.floor(y/R)<=1)},onChange:({target:{value:y}})=>f(y),onKeyDown:T}),!u&&p.jsx("span",{"aria-hidden":!0,className:"absolute inline-block text-nowrap pl-1 text-token-text-secondary",children:x}),p.jsx(D.button,{className:B("-mr-1.5 h-6 w-6 rounded-full bg-black text-center dark:bg-white",{"self-end":!d}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:()=>h(),children:p.jsx(lo,{className:"h-6 w-6 text-white dark:text-black"})})]})})})},st=v.forwardRef(Po),So=(e,o)=>{if(o?.type!==H.SELECTION)return null;try{const{from:t,to:n}=o,{top:r}=e.dom.getBoundingClientRect(),{bottom:s,top:a}=W(e,t),{bottom:i}=W(e,n),l=ae(e)?-30:-24;let u=s-r+l;const f=a-r;return u=i-r+8,{composerTop:u,loadingTop:f}}catch(t){return w.logError("Invalid position in SelectionCommentComposer",t),null}},ko=({toolbarPosition:e,composerRect:o,view:t})=>{let{width:n,height:r}=o;if(r||=rt,t==null||e==null)return null;const{right:s,left:a}=t.dom.getBoundingClientRect(),{left:i,top:l,aboveOrBelow:u,toolbarSize:f}=e,d=l-(u===nt.ABOVE&&r!==0?r-f.height:0),m=Rt(t)?12:0;return{left:Math.min(i,s-a-n-m),composerTop:d,aboveOrBelow:u}},Oo=({toolbarPosition:e,commentingOn:o,isWaitingForCommentResponse:t=!1,onAddComment:n})=>{const r=Q()(),[s,a]=ce(),i=ko({view:r,toolbarPosition:e,composerRect:s});if(r==null||i==null)return null;const{left:l,composerTop:u}=i,f=d=>{if(o?.type!==H.SELECTION)return;const{action:m,sourceRange:g}=o;n?.(d,m,g,o.type)};return p.jsx(X,{children:o?.type===H.SELECTION&&!t&&p.jsx("div",{className:B("absolute",K.commentComposer),style:{left:l,top:u},children:p.jsx(st,{opensOverDocument:!0,onClose:d=>{d||(L.cancelCommentingOn(),r&&ae(r)&&!r.state.selection.empty&&r.dispatch(r.state.tr.setSelection(new oo(r.state.selection.$from))),document.getSelection()?.removeAllRanges())},onSubmit:f,ref:a})},"composer")})};function at(e,o){return o?e.getState(o)??null:null}function Lo(e){return e.nodeSize-2}function Ao(e,o){return o>=0&&o<=Lo(e)}class F{constructor(o,t,n={}){this.match=o,this.match=o,this.handler=typeof t=="string"?Mo(t):t,this.undoable=n.undoable!==!1,this.inCode=n.inCode||!1}}function Mo(e){return function(o,t,n,r){let s=e;if(t[1]){let a=t[0].lastIndexOf(t[1]);s+=t[0].slice(a+t[1].length),n+=a;let i=n-r;i>0&&(s=t[0].slice(a-i,a)+s,n=r)}return o.tr.insertText(s,n,r)}}const wo=500;function Zn({rules:e}){let o=new Je({state:{init(){return null},apply(t,n){let r=t.getMeta(this);return r||(t.selectionSet||t.docChanged?null:n)}},props:{handleTextInput(t,n,r,s){return Pe(t,n,r,s,e,o)},handleDOMEvents:{compositionend:t=>{setTimeout(()=>{let{$cursor:n}=t.state.selection;n&&Pe(t,n.pos,n.pos,"",e,o)})}}},isInputRules:!0});return o}function Pe(e,o,t,n,r,s){if(e.composing)return!1;let a=e.state,i=a.doc.resolve(o),l=i.parent.textBetween(Math.max(0,i.parentOffset-wo),i.parentOffset,null,"￼")+n;for(let u=0;u<r.length;u++){let f=r[u];if(i.parent.type.spec.code){if(!f.inCode)continue}else if(f.inCode==="only")continue;let d=f.match.exec(l),m=d&&f.handler(a,d,o-(d[0].length-n.length),t);if(m)return f.undoable&&m.setMeta(s,{transform:m,from:o,to:t,text:n}),e.dispatch(m),!0}return!1}new F(/--$/,"—");new F(/\.\.\.$/,"…");new F(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"“");new F(/"$/,"”");new F(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"‘");new F(/'$/,"’");function Qn(e,o,t=null,n){return new F(e,(r,s,a,i)=>{let l=t instanceof Function?t(s):t,u=r.tr.delete(a,i),f=u.doc.resolve(a),d=f.blockRange(),m=d&&no(d,o,l);if(!m)return null;u.wrap(d,m);let g=u.doc.resolve(a-1).nodeBefore;return g&&g.type==o&&ro(u.doc,a-1)&&(!n||n(s,g))&&u.join(a-1),u})}function Io(e,o,t=null){return new F(e,(n,r,s,a)=>{let i=n.doc.resolve(s),l=t instanceof Function?t(r):t;return i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),o)?n.tr.delete(s,a).setBlockType(s,s,o,l):null})}function me(e,o,t,n={}){if(e==null)return null;const r=(Array.isArray(t)?t:[t]).filter(We),s=o.nodes[e].createAndFill(n,r);return s??null}const Ro={content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM(){return["p",0]}},Do="paragraph";class it extends ie{unistNodeName(){return Do}static proseMirrorNodeName(){return"paragraph"}proseMirrorNodeSpec(){return Ro}unistNodeToProseMirrorNodes({schema:o,convertedChildren:t,attrs:n}){return me(this.proseMirrorNodeName(),o,t,n)}proseMirrorNodeToUnistNodes(o,t){return[{type:this.unistNodeName(),children:t}]}}const Bo=(e,o,t,n)=>e.value?o.text(e.value,[o.marks.startend.create(t),...n??[]]):null;class Z extends ie{unistNodeName(){return"text"}static proseMirrorNodeName(){return"text"}proseMirrorNodeSpec(){return{group:"inline"}}unistNodeToProseMirrorNodes({node:o,schema:t,attrs:n}){return Bo(o,t,n)}proseMirrorNodeToUnistNodes(o){return[{type:this.unistNodeName(),value:o.text??""}]}}class U extends ie{static isAtStart(o,t){return o.selection.empty?t!==void 0?t.endOfTextblock("backward",o):o.selection.$anchor.parentOffset>0:!1}static headingLevelCommandBuilder(o,t,n){return(r,s,a)=>{if(n&&!U.isAtStart(r,a))return!1;const{$anchor:i}=r.selection,l=i.parent;if(l.type.name!=="heading")return!1;const u=l.attrs.level+t;if(u<0||u>6)return!1;if(s===void 0)return!0;const f=i.before(i.depth);return u>0?s(r.tr.setNodeMarkup(f,void 0,{level:u})):s(r.tr.setNodeMarkup(f,o.nodes.paragraph)),!0}}dependencies(){return[new it,new Z]}unistNodeName(){return"heading"}static proseMirrorNodeName(){return"heading"}proseMirrorNodeSpec(){return{attrs:{level:{default:1}},content:"text*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM(o){return["h"+o.attrs.level.toString(),0]}}}proseMirrorInputRules(o){return[Io(/^\s{0,3}(#{1,6})\s$/,o.nodes[this.proseMirrorNodeName()],t=>({level:t[1].length}))]}proseMirrorKeymap(o){const t={Tab:U.headingLevelCommandBuilder(o,1,!1),"#":U.headingLevelCommandBuilder(o,1,!0),"Shift-Tab":U.headingLevelCommandBuilder(o,-1,!1)};for(let n=1;n<=6;n++)t[`Shift-Mod-${n.toString()}`]=to(o.nodes[this.proseMirrorNodeName()],{level:n});return t}unistNodeToProseMirrorNodes({node:o,schema:t,convertedChildren:n,attrs:r}){const{depth:s}=o;return me(this.proseMirrorNodeName(),t,n,{...r,level:s})}proseMirrorNodeToUnistNodes(o,t){return[{type:this.unistNodeName(),depth:o.attrs.level,children:t}]}}const Se=(e,o,t)=>{const n=t==="min"?0:o.length-1;for(let r=n;t==="min"?r<o.length:r>=0;t==="min"?r++:r--){const{sourcePos:s,pmPos:a}=o[r];if(s===e)return a;if(t==="min"&&s>e||t==="max"&&s<e)return t==="min"?o[r-1]?.pmPos??a:a}return null};class jo extends ie{unistNodeName(){return"root"}static proseMirrorNodeName(){return"doc"}proseMirrorNodeSpec(){return{content:"block+"}}unistNodeToProseMirrorNodes({schema:o,convertedChildren:t,attrs:n}){return me(this.proseMirrorNodeName(),o,t,n)}proseMirrorNodeToUnistNodes(o,t){return[{type:this.unistNodeName(),children:t}]}}const ke=(e,o)=>{if(!o)return!1;const[t,n]=o;return e>=t&&e<n},ct=(e,o)=>e.pmPos-o.pmPos,Oe=(e,o)=>{const t=o[o.length-1].sourcePos;return Math.min(Math.max(e,0),t)},Le=(e,o)=>{const t=J(o)?.sourcePos??0;return Math.min(Math.max(e,0),t)},Ae=({positions:e,sourcePos:o,sourceEndPos:t})=>{const n=[];for(let r=0;r<e.length;r++){const s=e[r],{sourcePos:a,leafSourceRange:i,isClose:l=!1}=s;if(t!=null&&a>t)break;const u=e[r+1]??null,f=d=>{let m=e[d];if(m==null)return d;let g=e[d+1],{leafSourceRange:h}=m;for(;m.nodeTypeName!==Z.proseMirrorNodeName()&&!m.isClose&&g!=null&&!ke(o,h);)n.push(g),m=g,g=e[d+2],h=m.leafSourceRange,d++;return d};if(a===o&&!l||ke(o,i))n.push(s),r=f(r);else if(a<=o&&(u?.sourcePos??Number.POSITIVE_INFINITY)>=o){let d=r+1;const m=[];for(;e[d]?.isClose===!0;)m.push(d),d++;if(e[d]){const{sourcePos:g}=e[d];do n.push(e[d]);while(e[++d].sourcePos===g);d=f(d-1)}else{(a===o||l)&&n.push(s);for(const g of m)n.push(e[g])}r=d}}return n.sort(ct)},Me=({positions:e,sourcePos:o})=>{const t=[],n=r=>{r&&t.push(r)};for(let r=0;r<e.length;r++){const s=e[r],{sourcePos:a}=s;if(o==null||a>o)break;const i=e[r-1]??null,l=e[r+1]??null,u=o>a&&o<(l?.sourcePos??-1),f=s.nodeTypeName===Z.proseMirrorNodeName();if(a===o||u&&!f){if(s.isClose&&!i?.isClose&&s.nodeTypeName===i?.nodeTypeName||!s.isClose&&l.isClose&&s.nodeTypeName===l.nodeTypeName||s.isClose&&i?.isClose||!s.isClose&&i!=null&&i?.nodeTypeName!==Z.proseMirrorNodeName()){n(i);let h=r-2,C=e[h];for(;h>=0&&C.isClose;)n(C),C=e[--h]}let d=r,m=s,g=m;do n(m),g=m,m=e[++d];while(m?.sourcePos===o||m?.depth<g?.depth);break}else if(u&&f){let d=r+1,m=e[d];for(;m?.isClose;)n(m),m=e[++d];break}}return t.sort(ct)},Vo=e=>{const o=new zt(Kt.GetPositionTransformer,{debug:!1});o.startBlock("get_positition_transformer");const t=new Map;e.descendants((s,a)=>{const i=_e(s);if(!i)return;const{start:l,end:u}=i,f=s.type.name,{depth:d}=e.resolve(a);if(t.set(a,{pmPos:a,sourcePos:l,leafSourceRange:s.isBlock?void 0:[l,u],depth:d,nodeTypeName:f,isClose:!1,parentNodeTypeNameStack:[]}),s.isBlock){const m=a+s.nodeSize-1;t.set(m,{pmPos:m,sourcePos:u,depth:e.resolve(m).depth,nodeTypeName:f,isClose:!0,parentNodeTypeNameStack:[]})}if(s.isText)for(let m=0;m<(s.text?.length??0);m++){const g=a+m;t.set(g,{pmPos:g,sourcePos:l+m,depth:d,nodeTypeName:f,isClose:!1,parentNodeTypeNameStack:[]})}}),t.set(e.content.size,{pmPos:e.content.size,nodeTypeName:e.type.name,depth:0,isClose:!0,sourcePos:q(_e(e)).end,parentNodeTypeNameStack:[]});const n=Array.from(t.entries()).sort(([s],[a])=>s-a).map(([,s])=>s),r=[jo.proseMirrorNodeName()];for(const s of n)s.isClose?(s.parentNodeTypeNameStack=r.concat(),r.pop()):(s.parentNodeTypeNameStack=r.concat(),s.nodeTypeName!==Z.proseMirrorNodeName()&&J(r)!==s.nodeTypeName&&r.push(s.nodeTypeName));return o.endBlock("get_positition_transformer"),{positions:n,pmRangeToSourceRange:({start:s,end:a})=>({start:n[Math.max(s,0)].sourcePos,end:n[Math.min(a,n.length-1)].sourcePos}),sourceStartToPmPos:s=>Ae({sourcePos:Oe(s,n),positions:n,sourceEndPos:null}),sourceEndToPmPos:s=>Me({sourcePos:Le(s,n),positions:n}),sourceRangeToPmRange:s=>{o.startBlock("source_range_to_pm_range");const{start:a,end:i}=s,l=Le(i,n),u=Ae({sourcePos:Oe(a,n),sourceEndPos:l,positions:n}),f=Me({sourcePos:l,positions:n});return o.endBlock("source_range_to_pm_range"),{start:u,end:f}}}},Ho=Ut(Vo);function Fo(e,o){const t=Uo(e);if(t.length===0)return o;let n=o;return t.forEach(r=>{n=Go(r,n)}),n}function Go(e,o){return Dt(o,{start:e.from,end:e.to},Yo(e))}function Yo(e){return e.slice.size-(e.to-e.from)}function Uo(e){return e.steps.filter(o=>o instanceof so)}const re=new ao("comments");function we(e,o){const{sourceRangeToPmRange:t}=Ho(e),n=o.map(({id:r,at:s})=>{const{start:a,end:i}=t(s),l=Se(s.start,a,"max"),u=Se(s.end,i,"min");return u==null||l==null?null:[r,{start:l,end:u}]}).filter(We);return new Map(n)}function zo(e,o){const{type:t}=o;if(t===H.SELECTION){const{from:s,to:a}=o;return[s,a]}const{pos:n}=o,r=n+(e.nodeAt(n)?.nodeSize??0);return[n,r]}const Ie=(e,o,t=null,n=null)=>{const r=[],s=Array.from(o.entries()).reverse(),a=new Map(e.map(i=>[i.id,i]));for(const[i,l]of s){const u=a.get(i),m=jt({isHovered:t===i,isFocused:n===i,isCode:!1,diffStatus:u?.diffStatus});r.push(Ze.inline(l.start,l.end,{class:m,"data-comment-id":i,nodeName:"span"}))}return r},er=e=>new Je({key:re,state:{init:(o,{doc:t})=>{const n=we(t,e);return{comments:e,commentingOn:null,hoveredOnBlock:null,hoveredCommentId:null,focusedCommentId:null,decorations:Ie(e,n),positions:n}},apply:(o,t)=>{const n=o.getMeta(re)??{},r=n.comments,s=r??t.comments,a=r!=null?we(o.doc,s):t.positions;let i=n.commentingOn;i===void 0&&(i=t.commentingOn);let l=n.hoveredCommentId;l===void 0&&(l=t.hoveredCommentId);let u=n.focusedCommentId;u===void 0&&(u=t.focusedCommentId);const f=Fo(o,a),d=Bt(s,f);return{comments:d,commentingOn:i,hoveredCommentId:l,focusedCommentId:u,decorations:Ie(d,f,l,u),positions:f}}},props:{handleClickOn:(o,t,n,r,s)=>{const{target:a}=s;if(a instanceof HTMLElement){const{commentId:i}=a.dataset;if(!i)return;L.focusComment(i)}},handleDOMEvents:{mouseover(o,t){const{target:n}=t;if(n instanceof HTMLElement){const{commentId:r}=n.dataset;r?L.mouseEnterComment(r):L.mouseLeaveComment()}}},decorations(o){const t=this.getState(o);if(!t)return Ne.empty;const{commentingOn:n,decorations:r}=t,{doc:s}=o;if(n){const[a,i]=zo(s,n);a!=null&&i!=null&&r.push(Ze.inline(a,i,{class:Ot.document},{comment:{pattern:n}}))}return Ne.create(s,r.concat())}}});function Ko(e,o,t){const n=e+o;for(const r of t.values()){const s=r.start,a=r.end;if(e<a&&s<n)return!0}return!1}const Xo=50,$o=200,Wo=[it.proseMirrorNodeName(),U.proseMirrorNodeName()],qo=e=>e?e.isBlock:!1,Jo=e=>{if(!e)return!1;const{isBlock:o,type:{name:t}}=e;return o&&Wo.includes(t)},Zo=(e,o,t,n)=>{const r=e.posAtCoords({left:o,top:t});if(r==null)return;const{pos:s,inside:a}=r;if(a===-1)return;const{state:i}=e;let l=s,u=i.doc.nodeAt(l);for(;!qo(u)&&l>=0;)l--,u=i.doc.nodeAt(l);if(!u||!Jo(u))return;const f=n!=null&&Ko(l,u.nodeSize,n);return{node:u,nodeHasComment:f,pos:l}};function Qo(e,o,t){const n=Zo(e,o.x,o.y,t);if(n==null)return null;const{node:r,pos:s,nodeHasComment:a}=n,{top:i}=e.coordsAtPos(0);function l(){const g=s+1;return Ao(e.state.doc,g)&&e.state.doc.nodeAt(g)?.isText?e.coordsAtPos(g).top:e.coordsAtPos(s).top}const u=l(),f=u-i;return{height:e.coordsAtPos(s+r.nodeSize-1).bottom-u,nodeHasComment:a,mouseEnteredAt:Date.now(),yOffset:f,pos:s}}function en(e){const o=v.useRef(!1),t=v.useRef(!1),[n,r]=v.useState(null),s=Vt(),a=s()?.dom,i=v.useRef(!1),l=j(({visibleBlockCommentLauncher_DEBUG_ONLY:d})=>d),u=v.useCallback(qe(d=>{o.current=!0;const{commentingOn:m}=j.getState();if(t.current||m!=null)return;const g=s();if(g==null||!o.current)return r(null);const{dom:h,state:C}=g,E=at(re,C)?.positions;if(E==null)return r(null);const b=Qo(g,d,E);if(b==null||b.nodeHasComment&&e===I.COLLAPSED){r(null);return}if(i.current&&b.yOffset!==n?.yOffset){r(null);return}const P=g.coordsAtPos(0),T=h.getBoundingClientRect().width,y=(d.x-P.left)/T>=Xo/100;r(y?b:null)},$o),[s,i,n]);v.useEffect(()=>{if(a!=null)return yt(a,{mouseenter:()=>{o.current=!0,t.current=!1},mouseleave:({relatedTarget:d})=>{if(u.cancel(),d instanceof HTMLElement&&d.closest("[data-block-comment-launcher]")){t.current=!0;return}t.current=!1,o.current=!1,j.getState().commentingOn==null&&r(null)},mousemove:u})},[s,a,e,u]);const f=v.useCallback(({relatedTarget:d})=>{const{commentingOn:m}=j.getState();m==null&&d!==a&&(t.current=!1,r(null))},[a]);return{visibleBlockComment:l??n,handleMouseLeave:f,onComposerVisibleChange:d=>{i.current=d}}}const tn=({isWaitingForCommentResponse:e=!1,opensOverDocument:o=!1,hasComments:t=!1,activeBlockComment:n,composerRef:r,onLaunchComposer:s,onMouseLeave:a,onSubmit:i})=>{const[l,u]=v.useState(!1),{yOffset:f,height:d,pos:m}=n,g=()=>{u(!0),s?.(),w.logButtonClick(Y.BLOCK_COMMENT_LAUNCHER),L.startCommentingOn({type:H.BLOCK,pos:m})},h=b=>{b||(u(!1),L.cancelCommentingOn())},C=b=>{u(!1),i?.(b)};v.useEffect(()=>()=>{L.mouseLeaveBlock()},[]);const E=t&&l?o?-88:88:0;return p.jsx(D.div,{className:B("pointer-events-auto absolute flex h-6 w-5 origin-[14px_50%] items-start after:absolute after:-inset-4 after:content-['']",K.commentComposer),initial:!1,animate:{opacity:1},exit:{opacity:0},transition:{type:"spring",duration:.2,bounce:.1},style:{top:0,height:d,translateY:f},onMouseLeave:a,"data-block-comment-launcher":!0,children:p.jsxs(X,{children:[l?p.jsx(st,{ref:r,opensFromGutter:!0,onClose:h,onSubmit:C,gutterHasComments:t,opensOverDocument:o},"composer"):null,p.jsx(D.button,{initial:{opacity:0},animate:{opacity:l?0:1,translateX:E},transition:{duration:.15,translateX:{type:"spring",bounce:.18,duration:.48}},className:"group absolute z-10 flex h-6 gap-1 bg-transparent after:absolute after:-inset-y-4 after:-left-1 after:-right-4 after:content-['']",onClick:g,onMouseEnter:()=>L.mouseEnterBlock(m),onMouseLeave:()=>L.mouseLeaveBlock(),disabled:l||e,children:p.jsx(Ht,{isLoading:e})},"launcer")]})})},on=({isWaitingForCommentResponse:e=!1,isRequestActive:o=!1,hasComments:t=!1,composerRef:n,gutterMode:r,onAddComment:s})=>{const a=Ke(),{visibleBlockComment:i,handleMouseLeave:l,onComposerVisibleChange:u}=en(r),f=d=>{if(!i||!a)return;const{doc:m}=a,{pos:g}=i,h=m.nodeAt(g);if(!h)return;const{attrs:{start:C,end:E}}=h;s?.(d,Xe.ASK,{start:C,end:E},H.BLOCK)};return p.jsx(X,{onExitComplete:()=>u(!1),children:i&&a&&(e||!o)&&p.jsx(tn,{composerRef:n,isWaitingForCommentResponse:e,opensOverDocument:r===I.COLLAPSED,activeBlockComment:i,hasComments:t,onSubmit:f,onMouseLeave:l,onLaunchComposer:()=>u(!0)},"launcher")})},nn=({onAcceptComment:e,onDismissComment:o,disableActions:t=!1,entry:n,isGutterCollapsed:r=!1,isHovered:s=!1,isFocused:a=!1,isSomeCommentFocused:i=!1})=>{const{offsetY:l,type:u}=n,[f,d]=Xt();let m=null;if(u===O.COLLAPSED)m=!a&&p.jsx(Ft,{offsetY:l,count:n.count,onClick:()=>{w.logButtonClick(Y.COLLAPSED_COMMENT),L.focusComment(n.children[0])}},"collapsed");else{const{comment:g}=n;if(g==null||g.content===""||g.status===ve.DISMISSED)m=null;else if(g.status===ve.ACCEPT_INITIATED)m=p.jsx("div",{className:"absolute",style:{top:l},children:p.jsx($e,{})},"loading");else{const{id:h}=g;m=p.jsx(Gt,{isSomeCommentFocused:i,isHovered:s,isFocused:a,offsetY:l,disableActions:t,onClick:()=>{w.logButtonClick(Y.EXPANDED_COMMENT),L.focusComment(h)},onMouseEnter:()=>L.mouseEnterComment(h),onMouseLeave:()=>L.mouseLeaveComment(),comment:g,onAccept:()=>{w.logButtonClick(Y.COMMENT_ACCEPT,{commentId:h}),e?.(h)},onDismiss:()=>{w.logButtonClick(Y.COMMENT_DISMISS,{commentId:h}),o?.(h)},opensOverDocument:r},"expanded")}}return p.jsx(X,{onExitComplete:()=>d?.(),children:f&&m})},Re=({onMeasureHeight:e,comment:o,isFocused:t=!1})=>{const[{height:n},r]=ce();return He(()=>{e?.(n)},[n]),p.jsx(Yt,{ref:r,comment:o,isFocused:t,disableAnimations:!0})},rn=({comments:e,onMeasure:o,getStableCommentId:t})=>{const n=v.useRef(new Map),r=v.useRef(new Map),s=v.useRef(null),a=(i,l,u=!1)=>{l&&(u?r.current.set(t(i),l):n.current.set(t(i),l),s.current&&cancelAnimationFrame(s.current),s.current=requestAnimationFrame(()=>{o?.({focusedHeights:new Map(r.current),heights:new Map(n.current)}),s.current=null}))};return e?.length?p.jsxs("div",{className:"pointer-events-none invisible fixed left-0 top-0 overflow-clip","aria-hidden":"true",children:[e.map(i=>p.jsx(Re,{comment:i,onMeasureHeight:l=>a(i.id,l)},t(i.id))),e.map(i=>p.jsx(Re,{isFocused:!0,comment:i,onMeasureHeight:l=>a(i.id,l,!0)},`${t(i.id)}-focused`))]}):null},De=(e,o,t)=>{let n=t+o;for(;o===V.down?n<e.length:n>-1;){const r=e[n],s=e[n-o],a=yo(z(r),z(s),o);if(a!=null&&r.type!==O.COLLAPSED)r.shiftY+=a;else break;n+=o}},Be=(e,o)=>{for(const t of o){const{index:n,amount:r}=t,s=e[n];s.type===O.EXPANDED&&(s.shiftY+=r),De(e,V.down,n),De(e,V.up,n);for(const a of e)a.type!==O.COLLAPSED&&(a.offsetY+=a.shiftY,a.shiftY=0)}},sn=(e,o)=>{const t=[],[n,r]=o,s=n+r;for(let a=0;a<e.length;a++){const i=e[a],[l]=z(i),u=[l,i.type===O.EXPANDED?i.height:0],[f,d]=u;if(ot(u,o)){const m=f+d,g=n-m,h=s-f,E=(Math.abs(g)<Math.abs(h)?V.up:V.down)===V.up?g:h;t.push({index:a,amount:E})}}return t},an=({gutterMode:e,focusedCommentId:o,gutterPositions:t,getCommentKey:n,getComment:r})=>{if(!t?.size)return[];const s=new Map,a=[];let i=null,l=-1;for(const f of t.values()){if(f.type===ne.COMPOSER){i=[f.offsetY,f.height];continue}const{commentId:d,height:m,collapsedOffsetY:g,offsetY:h}=f;if(e===I.EXPANDED){const b=J(a),P=b?de(z(b)):0;let T=h;b&&T<=P&&(T=P),s.set(d,{originalOffsetY:h,offsetY:T}),o===d&&(l=a.length),a.push({key:n(d),comment:r(d),type:O.EXPANDED,height:m,offsetY:T,shiftY:0});continue}let C=a.findIndex(({offsetY:b,type:P})=>P===O.COLLAPSED&&b===g),E=a[C]??null;if(!E)E={key:a.length,type:O.COLLAPSED,offsetY:h,count:1,children:[d]},C=a.length,a.push(E);else{if(E.type!==O.COLLAPSED)throw new Error("Collapsed parent type expected to be collapsed");E.count+=1,E.children.push(d),E.offsetY=g}o===d&&(l=C)}const u=a[l];if(e===I.COLLAPSED&&u?.type===O.COLLAPSED){const f=[];for(let d=0;d<u.children.length;d++){const m=u.children[d];m===o&&(l+=d+1);const g=J(f),h=g?de(z(g)):0,C=t.get(m)?.offsetY??0,E=Math.max(h,C);s.set(m,{originalOffsetY:C,offsetY:E}),f.push({type:O.EXPANDED,key:n(m),comment:r(m),offsetY:E,height:t.get(m)?.height??0,shiftY:0})}a.splice(l,0,...f)}if(o){const f=s.get(o);if(!f)return a;const{offsetY:d,originalOffsetY:m}=f,g=m-d,h=[{amount:g,index:l}];let C=l+1;for(;C<a.length;){const E=a[C],{type:b}=E;let P=g;if(b===O.EXPANDED&&E.comment?.id){const{offsetY:T,originalOffsetY:x}=q(s.get(E.comment.id));if(T===x)break;P=Math.max(x-T,g)}else break;h.push({amount:P,index:C}),C++}h.length&&Be(a,h)}else if(e!==I.COLLAPSED&&i){const f=sn(a,i);Be(a,f)}return a},cn=e=>{try{return an(e)}catch(o){return w.logError("Generating comment gutter entries",o),[]}},ln=e=>"length"in e?e.length===0:e.nodeSize===0,ue=12,un=({composerHeight:e,getCommentHeight:o,getCollapsedStartPos:t,commentingOn:n,commentPositions:r,view:s})=>{if(!r||!s||ln(s.state.doc))return null;const{top:a}=s.dom.getBoundingClientRect(),i=Array.from(r.entries()).sort(([u,f],[d,m])=>f.start-m.start),l=new Map;for(const[u,{start:f}]of i)try{const d=t?.(f)??f,{top:m}=W(s,d),{top:g}=W(s,f),h=g-a,C=m-a,E=(o(u)??0)+ue;l.set(u,{commentId:u,height:E,collapsedOffsetY:C,offsetY:h,type:ne.COMMENT})}catch{continue}if(n?.type===H.BLOCK){const{pos:u}=n;try{const{top:f}=W(s,u),m=f-a-ue;l.set("block-composer",{type:ne.COMPOSER,height:(e??0)+ue,offsetY:m})}catch{}}return l},lt=(e,o)=>o.nodeAt(e)?.isBlock?e+1:lt(e-1,o);function dn(e){const o=Ke(),n=Q()?.();if(!n)return null;if(ae(n)){if(!o)return null;const r=at(re,o);return r?r.positions:null}return new Map(e.map(r=>[r.id,r.at]))}const mn=({gutterMode:e,focusedCommentId:o,commentingOn:t,comments:n,getStableId:r})=>{const[{height:s},a]=ce(),i=Q(),[l,u]=v.useState(()=>new Map),[f,d]=v.useState(()=>new Map),m=v.useCallback(({focusedHeights:x,heights:y})=>{u(x),d(y)},[]),g=x=>{const y=r(x);return x===o?l.get(y)??0:f.get(y)??0},h=i(),C=h!=null&&ae(h)?x=>lt(x,h.state.doc):void 0,E=new Map(n?.map(x=>[r(x.id),x])),b=dn(n),P=un({composerHeight:s,commentingOn:t,getCommentHeight:g,getCollapsedStartPos:C,commentPositions:b,view:h}),T=cn({gutterMode:e,gutterPositions:P,focusedCommentId:o,getComment:x=>E.get(r(x))??null,getCommentKey:r});return{blockComposerRef:a,onMeasureComments:m,gutterEntries:T}};function fn(){const o=Q()(),t=j(({commentingOn:s})=>s),r=o==null?null:So(o,t);return r==null?null:p.jsx(D.div,{className:"absolute",style:{top:r.loadingTop},initial:!1,animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},transition:{delay:.2},children:p.jsx($e,{})},"selection-loading")}const pn=e=>p.jsx("div",{className:"absolute",style:{top:de(z(e))},children:p.jsx("div",{className:"h-[max(3rem,18vh)] w-1"})}),tr=({availableWidth:e,comments:o,commentsMode:t,disableBlockComments:n=!1,isRequestActive:r=!1,isWaitingForCommentResponse:s=!1,onAddComment:a,onAcceptComment:i,onDismissComment:l,getStableCommentId:u})=>{const f=j(({focusedCommentId:M})=>M),d=j(({hoveredCommentId:M})=>M),m=j(({commentingOn:M})=>M),g=$t(),h=e<Ee?I.COLLAPSED:I.EXPANDED,{onMeasureComments:C,blockComposerRef:E,gutterEntries:b}=mn({comments:o,getStableId:u,gutterMode:h,focusedCommentId:f,commentingOn:m}),P=b.length>0,T=m!=null&&!s&&m.type!=="selection"||P,y=(()=>{if(!T)return 0;switch(h){case I.COLLAPSED:return 0;case I.EXPANDED:return Ee}})(),R=m?.type==="selection",S=J(b),A=t===Ce.ENABLED&&g&&!R&&!n;return p.jsxs(D.div,{className:B("pointer-events-none relative flex h-full flex-shrink-0",K.commentGutter,h===I.COLLAPSED&&y?"basis-[32px]":"basis-0"),initial:{width:0,opacity:0},animate:{width:y,opacity:1},exit:{width:0,opacity:0},children:[p.jsx(rn,{getStableCommentId:u,comments:o,onMeasure:C}),p.jsxs("div",{className:B("pointer-events-auto absolute bottom-0 left-0 top-0 w-0 overflow-visible",{"pl-2":T||!n}),children:[p.jsx(X,{children:b.map(M=>{const{key:_t,type:he}=M,vt=!!f&&he===O.EXPANDED&&M.comment?.id===f,Nt=!!f&&M.type===O.COLLAPSED&&M.children.includes(f);return p.jsx(nn,{isGutterCollapsed:h===I.COLLAPSED,isSomeCommentFocused:!!m||!!f,isHovered:he===O.EXPANDED&&M.comment?.id===d,isFocused:vt||Nt,entry:M,disableActions:r||s||t===Ce.COMMENTS_READONLY,onAcceptComment:$=>{try{i?.(q(o?.find(G=>G.id===$)))}catch(G){w.logError(`Comment ${$} not found`,G)}},onDismissComment:$=>{try{l?.(q(o?.find(G=>G.id===$)))}catch(G){w.logError(`Comment ${$} not found`,G)}}},_t)})}),P&&S&&p.jsx(pn,{...S}),A&&p.jsx(on,{composerRef:E,gutterMode:h,onAddComment:a,isWaitingForCommentResponse:s,isRequestActive:r,hasComments:P}),s&&R&&p.jsx(fn,{})]})]})};var gn="Separator",je="horizontal",hn=["horizontal","vertical"],ut=v.forwardRef((e,o)=>{const{decorative:t,orientation:n=je,...r}=e,s=En(n)?n:je,i=t?{role:"none"}:{"aria-orientation":s==="vertical"?s:void 0,role:"separator"};return p.jsx(se.div,{"data-orientation":s,...i,...r,ref:o})});ut.displayName=gn;function En(e){return hn.includes(e)}var Cn=ut,fe="Toolbar",[_n,or]=xt(fe,[Fe,Qe]),pe=Fe(),dt=Qe(),[vn,mt]=_n(fe),ft=v.forwardRef((e,o)=>{const{__scopeToolbar:t,orientation:n="horizontal",dir:r,loop:s=!0,...a}=e,i=pe(t),l=Tt(r);return p.jsx(vn,{scope:t,orientation:n,dir:l,children:p.jsx(Pt,{asChild:!0,...i,orientation:n,dir:l,loop:s,children:p.jsx(se.div,{role:"toolbar","aria-orientation":n,dir:l,...a,ref:o})})})});ft.displayName=fe;var pt="ToolbarSeparator",gt=v.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=mt(pt,t);return p.jsx(Cn,{orientation:r.orientation==="horizontal"?"vertical":"horizontal",...n,ref:o})});gt.displayName=pt;var Nn="ToolbarButton",ge=v.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=pe(t);return p.jsx(Ge,{asChild:!0,...r,focusable:!e.disabled,children:p.jsx(se.button,{type:"button",...n,ref:o})})});ge.displayName=Nn;var bn="ToolbarLink",yn=v.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=pe(t);return p.jsx(Ge,{asChild:!0,...r,focusable:!0,children:p.jsx(se.a,{...n,ref:o,onKeyDown:St(e.onKeyDown,s=>{s.key===" "&&s.currentTarget.click()})})})});yn.displayName=bn;var ht="ToolbarToggleGroup",xn=v.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=mt(ht,t),s=dt(t);return p.jsx(io,{"data-orientation":r.orientation,dir:r.dir,...s,...n,ref:o,rovingFocus:!1})});xn.displayName=ht;var Tn="ToolbarToggleItem",Pn=v.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=dt(t),s={__scopeToolbar:e.__scopeToolbar};return p.jsx(ge,{asChild:!0,...s,children:p.jsx(co,{...r,...n,ref:o})})});Pn.displayName=Tn;var Sn=ft,kn=gt,On=(e=>(e.CODE="code",e.WRITING="writing",e))(On||{});const ee=({children:e,toolbarType:o})=>p.jsx(Sn,{className:B("m-0 flex h-10 w-fit min-w-0 flex-shrink items-center overflow-hidden rounded-xl border border-token-border-light bg-token-main-surface-primary",Ue,o==="code"?"p-0":"p-1"),children:e}),Et=({icon:e,hideLabel:o,label:t})=>p.jsxs(p.Fragment,{children:[p.jsx(e,{className:B("icon-sm",{"mr-0.5 text-token-text-tertiary":!o,"text-token-text-primary":o})}),!o&&p.jsx("span",{className:"truncate text-sm text-token-text-primary",children:t})]}),Ct=Ye(ge)`flex h-full items-center gap-1 rounded-lg px-2.5 hover:bg-[#f5f5f5] disabled:opacity-50 disabled:cursor-not-allowed dark:hover:bg-token-main-surface-secondary disabled:hover:bg-transparent`,Ln=({label:e,icon:o,isDisabled:t=!1,hideLabel:n=!1,onClick:r,onMouseDown:s})=>p.jsx(Ct,{onClick:r,"aria-label":n?e:void 0,onMouseDown:s,disabled:t,children:p.jsx(Et,{icon:o,hideLabel:n,label:e})}),An=({icon:e,hideLabel:o,label:t,children:n})=>p.jsxs(Wt,{children:[p.jsx(qt,{asChild:!0,children:p.jsx(Ct,{"aria-label":o?t:void 0,children:p.jsx(Et,{icon:e,hideLabel:o,label:t})})}),p.jsx(Jt,{children:p.jsx(Zt,{align:"end",className:K.toolbar,sideOffset:8,children:n})})]});ee.Separator=Ye(kn)`mx-1 p-0 list-none h-full w-[1px] bg-token-border-light`;ee.Action=Ln;ee.Popover=An;const Mn=({isSendDisabled:e=!1,getSelectionRange:o})=>{const t=Ve(),n=()=>{const r=o();if(r==null)return;const{from:s,to:a,sourceFrom:i,sourceTo:l}=r;if(s==null||a==null||i==null||l==null){w.logError("Missing selection range on targeted edit",r);return}const u=Xe.ASK;w.logButtonClick(Y.TOOLBAR_ASK_CHATGPT,{action:u,sourceFrom:i,sourceTo:l}),L.startCommentingOn({type:H.SELECTION,from:s,to:a,sourceRange:{start:i,end:l},action:u})};return p.jsx(ee.Action,{isDisabled:e,label:t.formatMessage({id:"wOaJUU",defaultMessage:"Ask ChatGPT"}),onClick:n,icon:uo})},nr=({getEditorDom:e,getToolbarPosition:o,getSelectionRange:t,toolbarType:n,children:r,onAddComment:s,isWaitingForCommentResponse:a=!1,isSendDisabled:i=!1})=>{const[{height:l,width:u},f]=ce(),[d,m]=v.useState(!0),[g,h]=v.useState(!1),C=e(),E=j(({commentingOn:S})=>S),[b,P]=v.useState(null),T=v.useCallback(()=>{const S=e(),A=document.getSelection();return!A||A.type!=="Range"||A.isCollapsed||!S?.contains(A.anchorNode)},[e]);v.useEffect(()=>{const S=Qt(()=>{h(!0)},200,{leading:!0}),A=()=>{S.cancel(),h(!1)};return C?.addEventListener("pointerdown",S,{passive:!0}),document.addEventListener("pointerup",A,{passive:!0}),()=>{C?.removeEventListener("pointerdown",S),document.removeEventListener("pointerup",A)}},[C]),v.useEffect(()=>{const S=()=>{m(T())};return document.addEventListener("selectionchange",S,{passive:!0}),()=>{document.removeEventListener("selectionchange",S)}},[T]),He(()=>{if(d||T())return m(!0);try{const S=o({width:u,height:l});S!=null&&P(S)}catch(S){w.logError("Invalid position in getToolbarPosition",S)}},[l,u,d,T,o]);const x=p.jsxs(ee,{toolbarType:n,children:[p.jsx(Mn,{isSendDisabled:i,getSelectionRange:t}),r]}),y=!d&&!E&&b!=null,R=mo(y);return v.useEffect(()=>{!y&&R&&!E&&C?.focus()},[C,R,y,E]),p.jsxs(p.Fragment,{children:[p.jsx("div",{"aria-hidden":"true",className:"pointer-events-none invisible fixed left-0 top-0 h-0 overflow-clip",children:p.jsx("div",{ref:f,children:x})}),p.jsx(X,{children:y&&p.jsx(D.div,{initial:{opacity:0,scale:.95},animate:{opacity:g?0:1,scale:g?.95:1},style:{top:b.top,left:b.left},exit:{opacity:0,scale:.95},transition:{type:"spring",bounce:.1,duration:.1,delay:g?0:.1},className:B("absolute",K.toolbar,g?"pointer-events-none":"pointer-events-auto"),children:x})}),p.jsx(Oo,{toolbarPosition:b,commentingOn:E,isWaitingForCommentResponse:a,onAddComment:s})]})};function wn(e){let o=e;for(;o;){const n=window.getComputedStyle(o).overflowY;if(n==="auto"||n==="scroll")return o;o=o.parentElement}return null}function rr(e,o){const t=Q(),n=eo(),r=t();v.useEffect(()=>{const s=r?.dom;if(!s||e.length===0)return;const a=wn(s),i=o?qe(o,100):null;return a&&i&&a.addEventListener("scroll",i,{passive:!0}),()=>{i&&(a&&a.removeEventListener("scroll",i),i.cancel())}},[r,n,e,o])}let te=null;function sr(){if(te!=null)return te;if(typeof window>"u")return 0;const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.overflow="scroll",e.style.position="absolute",e.style.top="-9999px",document.body.appendChild(e);try{te=e.offsetWidth-e.clientWidth}finally{document.body.removeChild(e)}return te}function ar(e){return e==null?null:e.scrollHeight>e.clientHeight}export{nt as A,ln as B,tr as C,ee as D,U as H,F as I,Ro as P,jo as R,nr as T,_o as a,qn as b,On as c,sr as d,Z as e,Jn as f,Wn as g,me as h,ar as i,Bo as j,Do as k,it as l,go as m,Zn as n,Ho as o,Se as p,Ao as q,er as r,$n as s,Io as t,rr as u,bo as v,Qn as w,at as x,re as y,Lo as z};
//# sourceMappingURL=ln1lmfq2gxk0z5h4.js.map
