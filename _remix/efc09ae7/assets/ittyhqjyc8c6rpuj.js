import{gY as I,bK as _,r as h,m as n,aH as P,aI as Y,aF as K,fa as $,e0 as Z,l as J,f as X,T as R,f1 as Q,e6 as k,go as ee,aJ as te,gZ as se}from"./ogb0m6wfmpkwr4v0.js";import{fY as ae,fZ as oe,C as g,f_ as ne,f$ as ie,g0 as re,g1 as ce,cr as de,g2 as le,c4 as j,g3 as ue,g4 as he,g5 as L,bx as fe,fo as M,g6 as pe,g7 as me,u as ge,g8 as xe,g9 as W,U as F,b1 as ve,bv as D}from"./m0ujq4si8sio1lz0.js";import{s as Ce,g as be,u as we}from"./oe13nnltmvjngnjb.js";import{L as Se}from"./ebbi4stfxu4leo9p.js";import{u as Te}from"./lg1w1hqcuu1wg906.js";import{T as ye}from"./k81ulejtlkx2713k.js";import{m as x}from"./cymro46oa7nb2e4p.js";import"./b9t2rzfm26s20fe0.js";import"./nath3ahjullxvkj2.js";import"./jeztwd4vodinit8p.js";import"./g04e24001bc4ci45.js";import"./deb02ocluok9oo0e.js";import"./k16m2blxis1lpu5v.js";import"./lto5kz4mx804bx31.js";import"./fzrn137102spawew.js";import"./mmu1mgyeh9mpscy4.js";import"./1mq4bl028ayzaqnn.js";import"./mth7lkecabvrdtw9.js";import"./pa6676obnrhvhjmt.js";const O="oai/apps/canmoreSidebarWidth",Ie=.25,Ee=400,H=400;function U(e){return e-Ee}function T(e,s){return oe(H,U(e),s??Ie*e)}function Ae(){const e=I.useState(I.selectWindowWidth),s=T(e,ae(_.DANGER_SECRET_FOLDERS_ONLY_getItem(O))),o=V(),[t,l]=h.useState(s);h.useEffect(()=>{(t<H||t>U(e))&&l(T(e,t))},[e]);function a(i){l(m=>T(e,m+=i.delta.x))}function d(i){l(i),_.DANGER_SECRET_FOLDERS_ONLY_setItem(O,i)}function r(){const i=T(e,void 0);d(i)}const c=`calc(100vw - ${t}px)`;return o?{chatWidth:t,canvasWidth:e-t,canvasWidthCalc:c,viewportWidth:e,handleDrag:a,handleDoubleClick:r,persist:d}:{chatWidth:0,canvasWidth:e,canvasWidthCalc:"100vw",viewportWidth:e,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function V(e){const s=I.useState(I.selectWindowWidth);return(e??s)>1e3}function Ne(e,s){let o;return s?.type===g.Textdoc&&(o={type:"canvas_textdoc",id:s.textdocId}),{...e,messageMetadata:{...e.messageMetadata,open_in_canvas_view:o}}}const z=({isFullScreen:e=!1,clientThreadId:s,focusedObject:o,onClose:t,isAnimating:l=!1,width:a})=>{const{setTargetedContent:d}=ne(),r=h.useRef(!1);if(h.useEffect(()=>(r.current&&d(void 0),r.current=!0,()=>{r.current=!1}),[o]),o==null)return null;switch(o.type){case g.Textdoc:return n.jsx(ye,{isFullScreen:e,onClose:t,clientThreadId:s,focusedTextdoc:o,isAnimating:l,width:a});case g.ADAVisualization:return null;case g.Sonic:return!1}},_e=300,Re=e=>{switch(e?.type){case g.Textdoc:return e.textdocId;case g.Sonic:return e.id;default:return null}};function je(e,s){const o=P(e),t=Y(o),l=K(e),a=$(e,l),d=Z({clientThreadId:e,conversationLeafId:l}),r=ie(),[c,i]=h.useMemo(()=>{if(a&&re(a))return[void 0,null];if(s===!0)return[void 0,null];let f;return!d&&a&&(f=J(ce(a.messages))),Me(t,r,f)},[d,a,t,r,s]),m=i!=null,b=Re(i);h.useEffect(()=>{if(i&&c&&!de()&&(le(i,c),i.type===g.Textdoc)){const{textdocId:f}=i,v=be(f);Ce(document.getElementById(v))}},[m,b])}function Me(e,s,o){switch(o?.type){case j.Canmore:{const[t,l]=o.messages;if(!ue(t?.message))break;const a=he(e,t.message,l?.message??null),d=a.textdocId??s;if(d&&(a.function===X.CreateTextdoc?(a.content??"").length>_e||a.status===R.WAITING:a.status===R.STREAMING))return[a.messageId,{type:g.Textdoc,textdocId:d}];break}case j.SonicCanvas:break}return[void 0,null]}const We=260,y={type:"spring",bounce:.12,duration:.64},Fe={type:"spring",bounce:0,duration:.58},De=({clientThreadId:e,focusedObject:s,onClose:o})=>{const{chatWidth:t,canvasWidthCalc:l,handleDrag:a,handleDoubleClick:d,persist:r}=Ae(),c=k(),[i,m]=h.useState(!0),[b,f]=h.useState(!1),v=M(u=>u.activeSidebar),E=we(({rect:u})=>u),{windowHeight:w,windowWidth:C}=ee(u=>u,{windowWidth:0,windowHeight:0});let p=E??{top:0,left:t,width:C-t,height:w},N=!1;if(E&&(p.top<0||p.top+p.height>w)){N=!0;const u={width:(C-t)*.75,height:w*.75};p={top:w/2-u.height/2,left:(C-t-u.width)/2+t,width:u.width,height:u.height}}if(c){const u=C-p.width-p.left;p={...p,left:-u}}const S=E?.borderRadius,A=pe(),G=A?.history!=null||A?.showChangesAtVersion!=null,B=M(u=>u.isDesktopNavCollapsed);return n.jsxs(n.Fragment,{children:[G&&n.jsx(Se,{onClick:()=>me(A.textdocId),zIndexKey:"chatOverlay"}),n.jsxs(x.div,{initial:!c&&{marginRight:B?0:-We},animate:!c&&{marginRight:0},transition:Fe,children:[n.jsx(x.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:{...y,delay:.22},className:"pointer-events-none absolute left-0 top-0 z-20 h-full w-full bg-token-main-surface-primary"}),!c&&n.jsx(x.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"pointer-events-none absolute left-0 top-0 z-10 h-full w-full bg-black/[0.025] dark:bg-transparent"}),n.jsx(x.div,{className:"relative z-20 h-full",style:{width:l},exit:{width:0},transition:{type:"spring",bounce:0,duration:.1}})]}),n.jsx(x.div,{className:te("absolute z-20 h-full transition-shadow",c&&"right-0 max-h-[100cqh] max-w-[var(--available-details-width)] overflow-y-auto overflow-x-clip",!c&&"overflow-hidden",!c&&(v==="debug"?"md:left-[-250px] lg:left-[-300px] xl:left-[-350px] 2xl:left-[-400px]":"left-0")),initial:{borderRadius:S,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)",opacity:N?0:1,x:p.left,y:p.top,height:p.height,width:p.width},animate:{opacity:1,x:c?0:t,y:0,width:c?`calc(100cqw - ${t}px)`:l,height:"100%",borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:{opacity:{duration:.14,bounce:.1}},borderRadius:S,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:b?{duration:0}:y,onAnimationComplete:()=>m(!1),children:n.jsx(x.div,{className:"h-full overflow-hidden border-l border-gray-100 dark:border-token-border-medium",initial:{borderRadius:S},animate:{borderRadius:0},exit:{borderRadius:S},transition:y,children:n.jsxs("div",{className:"h-full",children:[n.jsx(x.div,{drag:"x",className:"absolute left-[-2px] z-10 h-full w-[4px] cursor-ew-resize bg-token-text-quaternary opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onDrag:(u,q)=>{f(!0),a(q)},onDragEnd:()=>{f(!1),r(t)},onDoubleClick:()=>d()}),n.jsx(z,{onClose:o,clientThreadId:e,isAnimating:i,focusedObject:s,width:C-t})]})})})]})},Oe=h.memo(De),ke=({clientThreadId:e,focusedObject:s,onClose:o})=>n.jsx(se,{children:n.jsx(x.div,{className:"fixed inset-0 z-40 overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:y,children:n.jsx(z,{isFullScreen:!0,clientThreadId:e,focusedObject:s,onClose:o})})}),Le=({clientThreadId:e,overrideWidth:s,isAutoFocusDisabled:o=!1})=>{let t=V(s);const l=Te(e);je(e,o);const a=ge(),d=xe(),r=h.useMemo(()=>{let f=a;if(a?.type===g.Textdoc){const v=d?.[a.textdocId];v&&(f={...a,textdocId:v})}return f},[a,d]);h.useEffect(()=>{L()},[e]);const c=r&&(t?n.jsx(Oe,{clientThreadId:e,onClose:D,focusedObject:r},"canvas-sidebar"):n.jsx(ke,{clientThreadId:e,onClose:D,focusedObject:r},"canvas-modal"));h.useEffect(()=>{if(r)return W(f=>Ne(f,r)),()=>W(null)},[r,d]);const i=k(),m=c!=null;return h.useEffect(()=>{if(!i)return F.setActiveStageSidebar(m),()=>{m&&F.setActiveStageSidebar(!1)}},[m,i]),l!==e?null:n.jsx(ve,{children:c})},ot=e=>{const s=h.useRef(null);return n.jsx(Q,{ref:s,onError:(o,t)=>{L(),setTimeout(()=>{s.current?.resetErrorBoundary()}),fe.logError("Error boundary hit",o,{componentStack:t})},name:"canmore-focused-view",children:n.jsx(Le,{...e})})};export{ot as CanvasFocusedViewManager};
//# sourceMappingURL=ittyhqjyc8c6rpuj.js.map
