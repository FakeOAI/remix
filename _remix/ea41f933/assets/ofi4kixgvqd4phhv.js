import{r as w,V as N,cI as $,e0 as A,bf as x,bl as O,bz as C,B as m,an as u,au as F,D as h,a5 as E,bL as D,dD as V}from"./hehcvio4m1gb3l50.js";import{cL as j,bG as H,cM as P,aL as i,cN as Y,cO as I,cP as W,cQ as J,cR as Z}from"./d1od5t75rjre0q37.js";import{e as X}from"./e27c3plf709pfjps.js";import{T as K,g as ee}from"./blc6m9yvfbiqw7tj.js";const T="q",re="m";function ye(e){const{clientThreadId:r,currentLeafId:n,handleRequestCompletion:t}=e,s=w.useRef(!1),{isLoading:o}=X(),a=N(),c=w.useCallback((y,d,p,z)=>{K.updateTree(r,v=>{v.addNode(y,p,d,$.User,void 0,z)})},[r]),l=w.useCallback(async(y,{content:d,attachments:p},z,v,b)=>{const k=n,B=p.length>0?{attachments:p}:{};c(y,k,d,B),t({type:A.Next,promptId:y,eventMetadata:z,cancelActiveRequests:!0,completionMetadata:v,turnTracker:b})},[c,t,n]),g=x(()=>window.location.pathname)??null;let G=!o&&te(g);const q=ee.getConversationMode(r),S=j();ne(g)&&S===void 0&&(G=!1),w.useEffect(()=>{if(!G||s.current)return;const{[T]:y,[re]:d,...p}=a.query,z=(typeof y=="string"?y:null)??(typeof d=="string"?d:null);if(!z||K.getServerThreadId(r)!=null||q==null)return;const v=O();s.current=!0,a.replace({query:p},void 0,{shallow:!0});const b=new H;l(v,{content:z,attachments:[]},{eventSource:"url"},{conversationMode:q,source:"instant-query"},b)},[G,a,l,r,q])}function ne(e){return M(e)}function M(e){return e==null?!1:/^\/g\/[\w-]+$/.test(e)}function te(e){return e==null?!1:e==="/"||M(e)}const fe="GPT Builder";function me(e){if(e)return`ChatGPT - ${e}`}function R(e){return e.gizmo.short_url??e.gizmo.id??"-"}function _(e){return`/g/${e}`}function ge(e){return`https://chatgpt.com${_(e)}`}function se(e){return _(R(e))}function de(e,r){const n=new URLSearchParams;return r!=null&&n.set(T,r),Y(new URL(`${se(e)}?${n}`,"https://chatgpt.com"))}function pe(e){return`/g/${R(e)}`}function ze(e){return I(e)&&e.gizmo.live_version===0||W(e)&&e.liveVersion===0}function he(e,r){return u({queryKey:["gizmos","discovery",{locale:e,isAnon:r}],queryFn:async()=>i.getGizmoDiscovery(e,r)})}function Ge({cutId:e,locale:r,limit:n,cursor:t,enabled:s=!0}){return C({queryKey:["gizmos","discovery",{cutId:e,locale:r,limit:n}],queryFn:async({pageParam:o})=>i.getGizmoDiscoveryCut(e,{locale:r,cursor:o,limit:n}),initialPageParam:t,getNextPageParam:o=>o.list.cursor??void 0,enabled:s})}function qe(){return u({queryKey:["gizmos","pinned"],queryFn:async()=>i.getGizmoPinned()})}function Q(){return F({queryKey:["gizmos","bootstrap"],queryFn:async()=>i.getGizmoBootstrap().then(e=>({gizmos:e.gizmos.map(r=>({resource:r.resource,flair:r.flair}))}))})}function ve(){return u(Q())}function U(e,r){const n=e.filter(s=>s.resource.gizmo.id!==r.resource.gizmo.id);let t=n.findIndex(s=>s.flair.kind===P.Recent);return t===-1&&(t=n.length),n.splice(t,0,r),n}const Pe={handleGizmoInteracted(e,r){const n=e.getQueryData(f(e,r).queryKey);n!=null&&e.setQueryData(Q().queryKey,t=>{if(t==null)return t;const s=t.gizmos.find(o=>o.resource.gizmo.id===r);return(s==null?void 0:s.flair.kind)===P.FirstParty||(s==null?void 0:s.flair.kind)===P.SidebarKeep?t:{gizmos:U(t.gizmos,{resource:n,flair:{kind:P.Recent}})}})},handleGizmoSidebarKeep(e,r){const n=e.getQueryData(f(e,r).queryKey);n!=null&&e.setQueryData(Q().queryKey,t=>t==null?t:{gizmos:U(t.gizmos,{resource:n,flair:{kind:P.SidebarKeep}})})},handleGizmoSidebarHide(e,r){e.setQueryData(Q().queryKey,n=>n!=null&&n.gizmos.some(t=>t.resource.gizmo.id===r)?{gizmos:n.gizmos.filter(t=>t.resource.gizmo.id!==r)}:n)}};function Qe(e,r=!1){const n=m();return u(f(n,e,r))}function we({gizmoId:e,draft:r,version:n}){const t=m(),s=n?{queryKey:["gizmo","version",{gizmoId:e,version:n}],queryFn:async()=>i.getVersion({gizmoId:e,version:n}),enabled:e!=null}:f(t,e,r);return u(s)}function Se(e,r){return u({queryKey:["gizmo","userActionSettings",{gizmoId:e}],queryFn:async()=>i.getUserActionSettings(e),enabled:e!=null&&r})}function f(e,r,n=!1){return F({queryKey:["gizmo",{gizmoId:r},{draft:n}],queryFn:async()=>i.getGizmo(r,n),enabled:r!=null,initialData:()=>{var o,a;if(n===!0)return;const t=e.getQueryData(Q().queryKey);if(t!=null)return(o=t.gizmos.find(c=>c.resource.gizmo.id===r))==null?void 0:o.resource;const s=e.getQueryData(["gizmos","discovery"]);if(s!=null)for(const c of s.cuts){const l=(a=c.list.items.find(g=>g.resource.gizmo.id===r))==null?void 0:a.resource;if(l!=null)return l}}})}function be(e,r){return e.fetchQuery(f(e,r))}function Re(e){return u({queryKey:["gizmo",{search:e}],queryFn:async()=>i.getGizmoSearch(e),enabled:e.length>0})}function De(e,r){return u({queryKey:["gizmo-search-workspace",{search:e}],queryFn:async()=>i.getGizmoSearchForWorkspace(e),enabled:e.length>0&&r})}function Ke(e,r=!1,n=!1,t=null){return C({queryKey:[n?"gizmo-search-workspace":"gizmo",{query:e,cursor:t}],queryFn:async({pageParam:s})=>n?i.getGizmoSearchForWorkspace(e,t=s):i.getGizmoSearch(e,t=s),initialPageParam:t,getNextPageParam:s=>s.cursor??void 0,enabled:r})}function Ue(){const e=m();return h({mutationFn:async({gizmoId:r,editorData:n})=>{const{instructions:t,name:s,description:o,profilePictureId:a,profilePictureUrl:c,promptStarters:l,tools:g,files:G,trainingDisabled:q}=n;return i.upsertDraft({instructions:t,display:{name:s,description:o,profile_pic_id:a,profile_picture_url:c,prompt_starters:l},tools:g,files:G.map(S=>({...S,location:J.FILE_SERVICE})),training_disabled:q},r)},onSettled:r=>{r&&(e.setQueryData(f(e,r.gizmo.id,!0).queryKey,r),e.invalidateQueries({queryKey:["gizmos","mine"],refetchType:"none"}))}})}function Ce(){const e=m();return h({mutationFn:async({gizmoId:r,data:n})=>{const{sharingRecipient:t,categories:s}=n,o=await i.promoteDraft({sharing:n.sharingSubjects&&n.sharingSubjects.length>0?n.sharingSubjects:{recipient:t},categories:s},r);if(o.error)throw new Z(o);return o.resource},onSettled:r=>{e.invalidateQueries({queryKey:["gizmos"],refetchType:"all"}),e.invalidateQueries({queryKey:["gizmos","pinned"],refetchType:"none"}),r&&e.setQueryData(f(e,r.gizmo.id,!1).queryKey,r)}})}function Fe(){const e=m();return h({mutationFn:async({gizmoId:r})=>i.deleteGizmo(r),onSettled:()=>{e.invalidateQueries({queryKey:["gizmos"],refetchType:"all"})}})}function Ee(){const e=m();return h({mutationFn:async({name:r,hideName:n,websiteUrl:t,willReceiveSupportEmails:s})=>i.updateBuilderProfile({name:r,hide_name:n,website_url:t,will_receive_support_emails:s}),onSuccess:r=>{e.setQueryData(["builderProfile"],r)},onError:r=>{E.warning(r.message)}})}function Te(){return u({queryKey:["builderProfile"],queryFn:async()=>i.getBuilderProfile()})}function Me(){return h({mutationFn:async({gizmoId:e})=>i.copyGizmo({gizmoId:e})})}function _e(){return u({queryKey:["gizmoCategories"],queryFn:async()=>i.getCategories()})}function Le(e,r){return!!(r!=null&&[D.PrimaryAssistant,D.GizmoInteraction].includes(r)&&(e!=null&&e.includes(V.GPT_4)))}function ke(e,r){const n=m();return h({mutationFn:async({rating:t,message:s,includeFrom:o})=>{await i.upsertUserReview(e,t,s,o)},onSuccess:async()=>{n.invalidateQueries({queryKey:["gizmo","review",{gizmoId:e}]})},onError:t=>{E.danger(t.message)}})}function Be(e,r){return r?`/g/${R(r)}/c/${e}`:`/c/${e}`}function Ne(){return"/gpts"}function $e(){return"/gpts/mine"}function L(e){return e?`/gpts/editor/${e}`:"/gpts/editor"}function Ae(e){const r=ie();return e==null?r:L(e)}function ie(e){return L(e)}function xe(e){try{const r=new URL(e);return r.hostname=r.hostname.replace(/^(www\.|web\.|mbasic\.|mobile\.)(secure\.)?/,""),r.pathname="",[...r.searchParams.keys()].forEach(n=>r.searchParams.delete(n)),r.toString()}catch{return e}}function oe(e){if(!e)return null;try{return new URL(e).hostname}catch{return null}}function Oe(e){const r=oe(e);return r?r.replace(/^www\./,""):e}export{Te as A,Ee as B,_e as C,we as D,Ue as E,Ce as F,Pe as G,f as H,_ as I,be as J,Le as K,fe as L,ye as M,ke as a,Fe as b,pe as c,L as d,se as e,ie as f,Be as g,Oe as h,ze as i,ve as j,Ge as k,qe as l,ge as m,de as n,xe as o,me as p,Se as q,Ae as r,Me as s,$e as t,Qe as u,Ne as v,Re as w,De as x,Ke as y,he as z};
//# sourceMappingURL=ofi4kixgvqd4phhv.js.map
