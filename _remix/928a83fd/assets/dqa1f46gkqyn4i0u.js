import{a0 as We,m as $,r as x,am as ae,d as Yt,X as Ge,aK as Dr,b2 as qt,l as g,d3 as _r,ch as Vr,$ as jr,D as Hr,c as zr,f1 as $r,fj as Fr}from"./isi6i55eeemdaxmu.js";import{a0 as Xe,a1 as Ur,V as Kr,a2 as lt,F as Wr,E as Gr,K as Xr,B as Yr,z as qr,a3 as Jr,A as Zr,O as Qr,U as en,a4 as Ye,a5 as V,a6 as Jt,a7 as tn,a8 as Zt,a9 as rn,aa as nn,ab as Qt,ac as er,ad as on,ae as sn,u as qe,af as ut,ag as Pe,x as an,ah as tr,M as rr,ai as cn,aj as nr,S as Je,ak as ln,al as un,W as dn,X as pn,am as ye,Y as dt,Z as hn,_ as fn,$ as pt}from"./dz61hmynm60k268n.js";import{a7 as ce,r as ht,h as ft,E as mt,q as mn,a8 as gn,a3 as j,a9 as Re,aa as Mn,a4 as gt,ab as kn,u as wn,ac as Nn,ad as yn,ae as xn,a5 as Ze,a6 as or,af as bn,a0 as Qe,B as xe,f as En}from"./ci1y8wxjlwsoo94t.js";import{p as X,P as U,d as z,o as ie,D as W,X as Cn,Y as Pn,M as Sn,S as et,N as Tn,A as Mt,Z as vn,_ as je,f as An,F as A,R as ge,b as Me,e as sr,l as Rn,c as In,I as Bn,G as On,$ as Ln,J as ir,E as ar}from"./loixfmr6ytf0pfrm.js";import{jd as kt,fc as He,an as wt,nJ as Dn,fg as _n,nK as Vn,nL as jn,nM as Hn,nN as zn,bU as $n,fr as _,j9 as Fn,jg as cr,jM as lr,jc as Nt,m4 as Un,nO as yt,nl as Kn,iG as xt,ie as ne,l$ as Wn,aj as Se,ft as Gn,cf as Xn,js as Yn,fu as qn,jN as Jn,kI as bt,jL as De,kJ as Et,jP as Zn,kK as Qn}from"./g344clpmm9csab6e.js";import{w as eo,c as ur,e as to,t as ze,d as ro,b as dr}from"./h9ualmnhqdfirnsv.js";import{f as Ct,a as no,p as oo,h as so,R as io}from"./izko9izzqejb19tm.js";import{k as tt,g as ao,h as co,i as lo,u as uo,r as Pt}from"./g2onwas6lnzml0up.js";import{m as se}from"./degf32ael4dvv0yi.js";import{c9 as po,ca as ho,cb as fo,bo as mo,U as go}from"./lzv3m24lczy39xt0.js";import{D as Mo}from"./b6t2banoywm8cvi3.js";import"./fzrn137102spawew.js";import"./dewf117j94lfjmem.js";import"./is32rwz8hic8x102.js";import"./n5y7pmoljogvovy8.js";import"./dsc2fryxyusgjz0e.js";import"./d74pqb25x2nbe4b7.js";import"./r2u8flwozaontxkq.js";import"./egewzi8a5y7qju58.js";import"./jtrkdsj2hd1164z4.js";import"./ohpoyszch3mlqwsm.js";import"./fx7mucxyea7fii3k.js";import"./mmok6cc45zl1vh57.js";import"./czq4y95706tw281o.js";import"./buoh6uwgso1uhk9b.js";import"./megy9kkk9hn5qfg6.js";import"./h1s3gwo8b4sz68is.js";class pr extends ce{unistNodeName(){return"link"}static proseMirrorMarkName(){return"link"}proseMirrorMarkSpec(){return{attrs:{href:{},title:{default:null},disabled:{default:!0}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs(e){return{href:e.getAttribute("href"),title:e.getAttribute("title")}}}],toDOM(e){return["a",{...e.attrs,...e.attrs.disabled?{href:void 0}:{}}]}}}unistNodeToProseMirrorNodes({node:e,convertedChildren:t,schema:r}){const{url:o,title:s}=e;return t.map(i=>i.mark(i.marks.concat([r.marks[this.proseMirrorMarkName()].create({href:o,title:s})])))}processConvertedUnistNode(e,t){return{type:this.unistNodeName(),url:t.attrs.href,...t.attrs.title!=null&&{title:t.attrs.title},children:[e]}}}function ko(n,e){const t=[];return n.descendants((r,o)=>{r.marks.forEach(s=>{s.type===e&&t.push({from:o,to:o+r.nodeSize,mark:s})})}),t}function wo(n,e,t){const r=e.mark.type,o={...e.mark.attrs,disabled:t};return n.removeMark(e.from,e.to,r),n.addMark(e.from,e.to,r.create(o)),n}const rt=new X("disableUnsafeLinks");function No(n,e){return n.setMeta(rt,{safeUrls:e})}function yo(n){return n.getMeta(rt)??null}function xo(n=new Set){return new U({key:rt,state:{init(e){return{safeUrls:n}},apply(e,t){const r=yo(e);if(r==null)return t;const{safeUrls:o}=r;return{...t,safeUrls:o}}},appendTransaction(e,t,r){const o=this.getState(r),s=r.tr,i=r.schema.marks[pr.proseMirrorMarkName()],a=ko(r.doc,i);let c=!1;return a.forEach(u=>{const l=u.mark.attrs.href,d=o.safeUrls.has(l),m=u.mark.attrs.disabled===!0;d===m&&(wo(s,u,!d),c=!0)}),c?s:null}})}const Te=new X("placeholder");function bo(n,e){return n.setMeta(Te,{isDisabled:e})}function Eo(n){return n.getMeta(Te)??null}function Co(n,e=!1){return new U({key:Te,state:{init(){return{isDisabled:e}},apply(t,r){const o=Eo(t);return o?.isDisabled!=null?{...r,isDisabled:o.isDisabled}:r}},props:{decorations(t){const{doc:r,selection:o}=t;if(Te.getState(t).isDisabled||!(o instanceof z&&o.empty))return null;const{$cursor:i}=o;if(!i||!n)return null;const a=i.start();if(!((i.parent.isTextblock||i.parent.type.name==="doc")&&i.pos===a&&i.node().content.size===0))return null;const u=ie.widget(a,()=>{const l=document.createTextNode(n.formatMessage(Po.placeholder)),d=document.createElement("span");return d.className="text-token-text-tertiary dark:text-gray-500 pointer-events-none select-none",d.style.position="absolute",d.appendChild(l),d});return W.create(r,[u])}}})}const Po=We({placeholder:{id:"n2B51U",defaultMessage:"Write something..."}}),So={"override-strong-color":"_override-strong-color_y6grp_1"};function hr({isHovered:n,isRejected:e,isTextAcive:t}){return $("cursor-pointer",{"line-through":!t,"filter grayscale-[0.6]":e&&!t,"opacity-60":e&&!t,"bg-opacity-50 dark:bg-opacity-50":e&&n,"bg-opacity-10 dark:bg-opacity-10":e&&!n,"bg-opacity-60 dark:bg-opacity-60":!e&&!n})}function To({isHovered:n,isRejected:e,isReplacement:t}){return $("bg-red-100 dark:bg-red-600",hr({isHovered:n,isRejected:e,isTextAcive:e}),{"dark:bg-red-800":e,"text-red-500 dark:text-red-200":!e,"border border-red-400 rounded-l border-r-0":e&&t,"border border-red-400 rounded":e&&!t})}function vo({isHovered:n,isRejected:e,isReplacement:t}){const r=!e;return $(So["override-strong-color"],"text-green-600 dark:text-green-200 bg-green-100 dark:bg-green-600",hr({isHovered:n,isRejected:e,isTextAcive:r}),{"dark:bg-green-800":e,"border border-green-500 rounded-r border-l-0":e&&t,"border border-green-500 rounded":e&&!t})}const $e=new X("edit"),St=(n,e,t,r)=>{const o=[];for(const s of e)o.push(ie.inline(s.start,s.end,{class:To({isHovered:!1,isRejected:!1,isReplacement:!1})}));for(const s of n)o.push(ie.inline(s.start,s.end,{class:vo({isHovered:!1,isRejected:!1,isReplacement:!0})}));return o},Ao=(n,e)=>new U({key:$e,state:{init(){const r=new Set;return{decorations:St(n,e),hoveredEditId:null,rejectedEdits:r}},apply(t,r){const o=t.getMeta($e)??null,{hoveredEditId:s,rejectedEdits:i}=o??r;return{decorations:St(n,e),hoveredEditId:s,rejectedEdits:i}}},props:{decorations(t){const r=this.getState(t);return r?W.create(t.doc,r.decorations.concat()):W.empty},editable(){return!1},attributes(){return{class:"select-none cursor-default",style:"--text-primary:var(--text-secondary)"}}}});class K{constructor(e,t){this.length=e,this.step=t}cut(e){return e===this.length?this:new K(e,this.step)}static slice(e,t,r){if(t===r)return K.none;if(t===0&&r===K.len(e))return e;const o=[];for(let s=0,i=0;i<r;s++){const a=e[s],c=i+a.length,u=Math.min(r,c)-Math.max(t,i);u>0&&o.push(a.cut(u)),i=c}return o}static join(e,t,r){if(e.length===0)return t;if(t.length===0)return e;const o=r(e[e.length-1].step,t[0].step);if(o==null)return e.concat(t);const s=e.slice(0,e.length-1);s.push(new K(e[e.length-1].length+t[0].length,o));for(const i of t)s.push(i);return s}static len(e){let t=0;for(const r of e)t+=r.length;return t}static none=[]}class Ro{constructor(e,t,r,o,s,i){this.fromA=e,this.toA=t,this.fromB=r,this.toB=o,this.deleted=s,this.inserted=i}get lenA(){return this.toA-this.fromA}get lenB(){return this.toB-this.fromB}}const Tt=(n,e,t,r,o)=>new Ro(n,e,t,r,n===e?K.none:[new K(e-n,o)],t===r?K.none:[new K(r-t,o)]);class ve{constructor(e,t){this.doc=e,this.changes=t}static create(e){return new ve(e,[])}addSteps(e,t){const r=[];for(const s of t){let i=0;if(s.getMap().forEach((a,c,u,l)=>{r.push(Tt(a+i,c+i,u,l,s)),i=l-u-(c-a)}),s instanceof Cn||s instanceof Pn){const{from:a,to:c}=s;r.push(Tt(a,c,a,c,s))}}if(r.length===0)return this;const o=this.changes.concat(r);return new ve(e,o)}}const fe=new X("changeset"),Fe=new X("highlightChanges"),fr=n=>fe.getState(n),Io=n=>{const{state:e}=n,t=e.tr.setMeta(fe,!0);n.updateState(e.apply(t))},Bo=n=>{const{state:e}=n,t=fr(e);if(!t)return;const{maps:r,steps:o}=t,s=new Sn(r),i=e.tr;for(let c=o.length-1;c>=0;c--){const u=o[c].map(s.slice(c+1));if(!u)continue;i.maybeStep(u).doc&&s.appendMap(u.getMap(),c)}const a=e.apply(i.setMeta(fe,!0));n.updateState(a)},Oo=()=>{const n=r=>({changeset:ve.create(r),maps:[],steps:[]}),e=new U({key:fe,state:{init:(r,{doc:o})=>n(o),apply:(r,o,s,i)=>{const{doc:a}=i;if(r.getMeta(fe))return n(a);const{docChanged:u,mapping:l,steps:d,docs:m}=r;if(!u)return o;const{changeset:h,maps:p,steps:f}=o,{maps:k}=l,w=d.map((y,N)=>y.invert(m[N]));return{changeset:h.addSteps(a,d),maps:p.concat(k),steps:f.concat(w)}}}}),t=new U({key:Fe,state:{init(){return{deco:W.empty,show:!1}},apply(r,o,s,i){const a=e.getState(i);if(!a)return o;const{changeset:c}=a,{doc:u}=i,{changes:l}=c,d=l.map(({fromB:h,toB:p})=>ie.inline(h,p,{class:"blame-marker"})),m=r.getMeta(Fe);return{deco:W.create(u,d),show:m??o.show}}},props:{decorations(r){const o=this.getState(r);if(!o?.show)return W.empty;const{deco:s}=o;return s}}});return[e,t]},J=(n,e,t)=>{x.useEffect(()=>{const r=e.current;if(!r)return;const{state:o}=r,s=n(o.tr);s&&r.dispatch(s)},t)};var me=(n=>(n.PROSEMIRROR_CONTEXT_CHILDREN="prosemirror-context-children",n.PROSEMIRROR_EDITOR_CONTAINER="prosemirror-editor-container",n))(me||{});function Lo(n,e){return{x:kt(e.x,n.left,n.right),y:kt(e.y,n.top,n.bottom)}}function mr(n){let e=n.selection.$from.pos-1;if(e<0)return null;let t=n.doc.nodeAt(e);for(;(t==null||t.type.name===Xe.proseMirrorNodeName())&&e>0;)e-=1,t=n.doc.nodeAt(e);return t!=null?{node:t,pos:e}:t}function Do(n,e){const t=mr(n);if(t==null)return!1;const{node:r,pos:o}=t,s=o+r.nodeSize,i=n.tr,c=n.schema.nodes.paragraph.create(null);i.insert(s,c);const u=s+c.nodeSize-1,l=i.doc.resolve(u),d=new z(l);return i.setSelection(d),e(i),!0}function _o(n,e){const t=mr(n);if(t==null)return!1;const{node:r,pos:o}=t,s=n.tr;return s.deleteRange(o,o+r.nodeSize),e(s),!0}const vt=(n,e)=>{if(n===e)return null;let t=0,r=n.length,o=e.length;for(;t<r&&n.charCodeAt(t)===e.charCodeAt(t);)t+=1;for(;r>t&&o>t&&n.charCodeAt(r-1)===e.charCodeAt(o-1);)r-=1,o-=1;return{from:t,to:r,text:e.slice(t,o)}},At=Ur({settings:{background:"var(--gray-100)"}});class nt{constructor(e,t,r,o){this.pmView=t,this.getPos=r,this.node=e;const s=[{key:"ArrowUp",run:this.maybeEscape("line",-1)},{key:"ArrowLeft",run:this.maybeEscape("char",-1)},{key:"ArrowDown",run:this.maybeEscape("line",1)},{key:"ArrowRight",run:this.maybeEscape("char",1)},{key:"Backspace",run:this.handleBackspace},{key:"Shift-Enter",run:this.handleShiftEnter}];this.languageCompartment=new ht,this.themeCompartment=new ht;const i=Kr(e.attrs.lang),a=ft.create({doc:this.node.textContent,extensions:[this.themeCompartment.of(o?lt:At),mt.theme({"&":{borderRadius:"4px",padding:"0.5rem"},"&.cm-focused":{outline:"none"}}),mn.of([...s,...Wr,...Gr,Xr]),Yr(),qr(),Jr(),gn(),Zr(Qr),this.languageCompartment.of(i!=null?[i]:[]),ft.changeFilter.of(c=>(!c.docChanged&&!this.updating&&this.forwardSelection(),!0))]});this.cm=new mt({state:a,dispatch:this.dispatch}),i==null&&this.setLanguage(e.attrs.lang)}node;updating=!1;cm;languageCompartment;themeCompartment;get pmSchema(){return this.pmView.state.schema}get dom(){return this._setIsCodeBlockView(),this.cm.dom}setLanguage=async e=>{const t=await en(e);t&&this.cm.dispatch({effects:this.languageCompartment.reconfigure(t)})};setTheme=e=>{const t=e?lt:At;this.cm.dispatch({effects:this.themeCompartment.reconfigure(t)})};handleBackspace=e=>{const{selection:t}=e.state;if(!(t.main.empty&&t.main.from===0)||this.cm.state.doc.length>0)return!1;const r=_o(this.pmView.state,this.pmView.dispatch);return this.pmView.focus(),r};handleShiftEnter=()=>{const e=Do(this.pmView.state,this.pmView.dispatch);return this.pmView.focus(),e};dispatch=e=>{if(this.cm.update([e]),this.updating)return;const t=(this.getPos()??0)+1,r=e.state.doc.toString(),o=vt(this.node.textContent,r);if(o){const{text:s,from:i,to:a}=o,c=s?this.pmSchema.text(s):null,u=this.pmView.state.tr.replaceWith(i+t,a+t,c);this.pmView.dispatch(u)}this.forwardSelection()};update=e=>{if(e.type!==this.node.type)return!1;e.attrs.lang!==this.node.attrs.lang&&this.setLanguage(e.attrs.lang),e.attrs.isDarkMode!=null&&e.attrs.isDarkMode!==this.node.attrs.isDarkMode&&this.setTheme(e.attrs.isDarkMode),this.node=e;const t=vt(this.cm.state.doc.toString(),e.textContent);if(t){const{text:r,from:o,to:s}=t;this.updating=!0,this.cm.dispatch({changes:{from:o,to:s,insert:r}}),this.updating=!1}return!0};asProseMirrorSelection=e=>{const t=(this.getPos()??0)+2,{anchor:r,head:o}=this.cm.state.selection.main;return z.create(e,r+t,o+t)};forwardSelection=()=>{if(!this.cm.hasFocus)return;const{state:e}=this.pmView,t=this.asProseMirrorSelection(e.doc);t.eq(e.selection)||this.pmView.dispatch(e.tr.setSelection(t))};maybeEscape=(e,t)=>r=>{const{state:o}=r,{selection:s}=o,a=(()=>{const h=s.main.from,{number:p,from:f}=o.doc.lineAt(h);return{line:p,ch:h-f}})(),c=o.selection.ranges.some(h=>!h.empty),u=1,l=o.doc.lineAt(o.doc.length).number;if(c||a.line!==(t<0?u:l)||e==="char"&&a.ch!==(t<0?0:o.doc.line(a.line).length))return!1;const d=(this.getPos()??0)+(t<0?0:this.node.nodeSize),m=et.near(this.pmView.state.doc.resolve(d),t);return this.pmView.dispatch(this.pmView.state.tr.setSelection(m).scrollIntoView()),this.pmView.focus(),!0};setSelection=(e,t)=>{this.focus(),this.updating=!0,this.cm.dispatch({selection:{anchor:e,head:t}}),this.updating=!1};focus=()=>{this.cm.focus(),this.forwardSelection()};selectNode=()=>{this.focus()};stopEvent=()=>!0;destroy=()=>{this.cm.destroy()};_setIsCodeBlockView=()=>{this.cm.dom.dataset.isCodeBlockView="true"};static _getIsCodeBlockView=e=>e.dataset.isCodeBlockView==="true";static isInCodeBlockView(e){return e instanceof HTMLElement?e.closest("[data-is-code-block-view]")!=null:!1}}function Vo(n,e,t){try{return e instanceof z?z.create(n,e.anchor,e.head):e instanceof Tn?z.create(n,e.from,e.to):e instanceof Mt?new Mt(n):void 0}catch{return z.create(n,0)}}class jo extends j{unistNodeName(){return"blockquote"}static proseMirrorNodeName(){return"blockquote"}proseMirrorNodeSpec(){return{content:"block+",group:"block",parseDOM:[{tag:"blockquote"}],toDOM(){return["blockquote",0]}}}proseMirrorInputRules(e){return[Ye(/^\s{0,3}>\s$/,e.nodes[this.proseMirrorNodeName()])]}proseMirrorKeymap(e){return{"Mod->":eo(e.nodes[this.proseMirrorNodeName()])}}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:r}){return V(this.proseMirrorNodeName(),e,t,r)}proseMirrorNodeToUnistNodes(e,t){return[{type:this.unistNodeName(),children:t}]}}function Ho(n,e,t,r){for(let o=0;o<e.length;o++){let{$from:s,$to:i}=e[o],a=s.depth===0?n.inlineContent&&n.type.allowsMarkType(t):!1;if(n.nodesBetween(s.pos,i.pos,(c,u)=>{if(a||!r)return!1;a=c.inlineContent&&c.type.allowsMarkType(t)}),a)return!0}return!1}function Rt(n){return/^\s*/.exec(n)?.[0]?.length??0}function It(n){return/\s*$/.exec(n)?.[0]?.length??0}function zo(n,e,t){for(;e>0;){const r=e-1;if(!n.rangeHasMark(r,e,t))break;e=r}return e}function $o(n,e,t){for(;e<n.content.size&&n.rangeHasMark(e,e+1,t);)e+=1;return e}function gr(n,e,t,r=null){const{selection:o}=n;if(!(o instanceof z))return!1;let{empty:s,$cursor:i,ranges:a}=o;if(s&&!i||!Ho(n.doc,a,t,!0))return!1;if(i)t.isInSet(n.storedMarks||i.marks())?e(n.tr.removeStoredMark(t)):e(n.tr.addStoredMark(t.create(r)));else{let c=n.tr;const u=!a.some(l=>n.doc.rangeHasMark(l.$from.pos,l.$to.pos,t));for(let l=0;l<a.length;l++){let{$from:d,$to:m}=a[l],h=d.pos,p=m.pos;const f=n.doc.textBetween(h,p,`
`);if(/^\s*$/.test(f))continue;const k=d.nodeBefore?.text??"",w=d.nodeAfter?.text??"",y=m.nodeBefore?.text??"",N=m.nodeAfter?.text??"";if(u){let M=Rt(w),C=It(y);h+M<p&&(h+=M,p-=C),h=zo(n.doc,h,t),p=$o(n.doc,p,t),c.removeMark(h,p,n.schema.marks[Re.proseMirrorMarkName()]),c.addMark(h,p,t.create(r))}else{const M=It(k),C=Rt(N);h-=M,p+=C,c.removeMark(h,p,t)}}e(c.scrollIntoView())}return!0}function Bt(n,e=null){return(t,r)=>r?gr(t,r,n,e):!0}class G extends Jt{markType;constructor(e,t){super(e,(r,o,s,i)=>this.markHandler(r,o,s,i)),this.markType=t}static markApplies(e,t,r){for(const o of t){const{$from:s,$to:i}=o;let a=s.depth===0?e.type.allowsMarkType(r):!1;if(e.nodesBetween(s.pos,i.pos,c=>a?!1:(a=c.inlineContent&&c.type.allowsMarkType(r),!0)),a)return!0}return!1}markHandler(e,t,r,o){if(!(e.selection instanceof z))return null;const s=e.doc.resolve(r),i=e.doc.resolve(o),a=[new vn(s,i)];if(!G.markApplies(e.doc,a,this.markType))return null;const c=e.doc.nodeAt(r)?.marks.map(l=>l.type)??[];c.push(this.markType);const u=e.tr.replaceWith(r,o,this.markType.schema.text(t[1]));for(const l of c)u.addMark(u.mapping.map(r),u.mapping.map(o),l.create(null));for(const l of c)u.removeStoredMark(l);return u.insertText(t[2])}}class Mr extends ce{unistNodeName(){return"strong"}static proseMirrorMarkName(){return"strong"}proseMirrorMarkSpec(){return{parseDOM:[{tag:"b"},{tag:"strong"},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}],toDOM(){return["strong"]}}}proseMirrorInputRules(e){return[new G(/\*\*([^\s](?:.*[^\s])?)\*\*([\s\S])$/,e.marks[this.proseMirrorMarkName()]),new G(/__([^\s](?:.*[^\s])?)__([\s\S])$/,e.marks[this.proseMirrorMarkName()])]}proseMirrorKeymap(e){const t=e.marks[this.proseMirrorMarkName()];return{"Mod-b":Bt(t),"Mod-B":Bt(t)}}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:r}){return t.map(o=>o.mark(o.marks.concat([e.marks[this.proseMirrorMarkName()].create(r)])))}processConvertedUnistNode(e){return{type:this.unistNodeName(),children:[e]}}}const kr=92,Fo=10,Ae="backslashEscape";function Uo(n,e,t){function r(o){return o==null||o===Fo?(n.exit(Ae),e(o)):t(o)}return o=>o!==kr?t(o):(n.enter(Ae),n.consume(o),r)}function Ko(){return{text:{[kr]:{name:Ae,tokenize:Uo}}}}function Wo(){const n=this.data();n.micromarkExtensions??=[],n.micromarkExtensions.push(Ko()),n.fromMarkdownExtensions??=[],n.fromMarkdownExtensions.push({enter:{[Ae](e){this.enter({type:"break"},e),this.exit(e)}}})}class Go extends j{unistNodeName(){return"break"}static proseMirrorNodeName(){return"hard_break"}proseMirrorNodeSpec(){return{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],marks:Re.proseMirrorMarkName(),toDOM(){return["br"]}}}proseMirrorKeymap(e){const t=ur(to,(o,s)=>(s&&s(o.tr.replaceSelectionWith(e.nodes[this.proseMirrorNodeName()].create()).scrollIntoView()),!0)),r=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;return{"Mod-Enter":t,"Shift-Enter":t,...r&&{"Ctrl-Enter":t}}}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:r}){return V(this.proseMirrorNodeName(),e,t,r)}proseMirrorNodeToUnistNodes(){return[{type:this.unistNodeName()}]}unifiedInitializationHook(e){return e.use(Wo)}}const Ie="code_block",Ot="```\n";function Xo(n,e){const{start:t,end:r}=n;return t==null||r==null?null:{start:t+Ot.length+(e.lang??"").length,end:r-Ot.length}}class Ue extends j{dependencies(){return[new Xe]}unistNodeName(){return"code"}static proseMirrorNodeName(){return Ie}proseMirrorNodeSpec(){return{content:"text*",group:"block",code:!0,defining:!0,marks:[Re.proseMirrorMarkName()].join(" "),attrs:{lang:{default:null},isDarkMode:{default:null}},parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM(){return["pre",["code",0]]}}}proseMirrorInputRules(e){return[tn(/^\s{0,3}```$/,e.nodes[this.proseMirrorNodeName()])]}unistNodeToProseMirrorNodes({node:e,attrs:t,schema:r}){const{lang:o}=e;return V(this.proseMirrorNodeName(),r,Zt(e,r,{...t,...Xo(t,e)??{}}),{lang:o,...t})}proseMirrorNodeToUnistNodes(e,t){return[{type:this.unistNodeName(),value:t.map(r=>r.type==="startend"?r.children.map(o=>o.value).join(""):r.value).join(""),lang:e.attrs.lang}]}}class Yo extends j{unistNodeName(){return"thematicBreak"}static proseMirrorNodeName(){return"horizontal_rule"}proseMirrorNodeSpec(){return{group:"block",parseDOM:[{tag:"hr"}],toDOM(){return["div",["hr"]]}}}proseMirrorInputRules(e){return[new Jt(/^\s{0,3}(?:\*\*\*|---|___)\n$/,(t,r,o,s)=>t.tr.replaceWith(o,s,V(this.proseMirrorNodeName(),e,[])??[]))]}proseMirrorKeymap(e){return{"Mod-_":(t,r)=>(r&&r(t.tr.replaceSelectionWith(e.nodes[this.proseMirrorNodeName()].create()).scrollIntoView()),!0)}}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:r}){return V(this.proseMirrorNodeName(),e,t,r)}proseMirrorNodeToUnistNodes(){return[{type:this.unistNodeName()}]}}class qo extends ce{unistNodeName(){return"inlineCode"}static proseMirrorMarkName(){return"code"}proseMirrorMarkSpec(){return{inclusive:!1,parseDOM:[{tag:"code"}],toDOM(){return["code"]}}}proseMirrorInputRules(e){return[new G(/`([^\s](?:.*[^\s])?)`([\s\S])$/,e.marks[this.proseMirrorMarkName()])]}proseMirrorKeymap(e){const t=e.marks[this.proseMirrorMarkName()];return{"Ctrl-`":ze(t)}}unistNodeToProseMirrorNodes({node:e,schema:t,attrs:r}){const o=Zt(e,t,r,[t.marks[this.proseMirrorMarkName()].create(r)]);return o?[o]:[]}processConvertedUnistNode(e){return{type:this.unistNodeName(),value:e.value}}}class wr extends ce{unistNodeName(){return"emphasis"}static proseMirrorMarkName(){return"em"}proseMirrorMarkSpec(){return{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style",getAttrs:e=>e==="italic"&&null}],toDOM(){return["em"]}}}proseMirrorInputRules(e){return[new G(new RegExp("(?<!\\*)\\*([^\\s*](?:.*[^\\s])?)\\*([^*])$"),e.marks[this.proseMirrorMarkName()]),new G(new RegExp("(?<!_)_([^\\s_](?:.*[^\\s])?)_([^_])$"),e.marks[this.proseMirrorMarkName()])]}proseMirrorKeymap(e){const t=e.marks[this.proseMirrorMarkName()];return{"Mod-i":ze(t),"Mod-I":ze(t)}}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:r}){return t.map(o=>o.mark(o.marks.concat([e.marks[this.proseMirrorMarkName()].create(r)])))}processConvertedUnistNode(e){return{type:this.unistNodeName(),children:[e]}}}function Nr(n){return"children"in n}const oe="lineEndingBlank";function Lt(n){return n.type===oe}const Jo=({startIndex:n,endIndex:e,depth:t,isLastChild:r,parent:o=null})=>{const s=e-n;return t>0&&o?.type!=="list"?s:r||n===0?s-Math.floor((s+1)/2):s-Math.floor((s-1)/2)};function Zo(){const n=this.data();n.fromMarkdownExtensions??=[],n.fromMarkdownExtensions.push({enter:{lineEndingBlank(t){this.enter({type:oe},t)}},exit:{lineEndingBlank(t){this.exit(t)}}});const e=(t,r=0)=>{if(!Nr(t))return;const{children:o}=t;let s=0,i=null,a=null;const c=o.length;for(let u=0;u<c;u++){const l=o[u-s];e(l,r+1);const{type:d}=l,h=u===c-1&&d===oe;if(d===oe&&i==null?i=u:d!==oe&&i!=null?a=u:h&&i!=null&&(a=u+1),i!=null&&a!=null){const p=Jo({startIndex:i,endIndex:a,depth:r,isLastChild:h,parent:t});o.splice(i-s,p),i=null,a=null,s+=p}}};return t=>{e(t)}}class Qo extends j{unistNodeName(){return oe}static proseMirrorNodeName(){return"paragraph"}proseMirrorNodeSpec(){return rn}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:r}){return V(this.proseMirrorNodeName(),e,t,r)}proseMirrorNodeToUnistNodes(e,t){return[{type:nn,children:t}]}unifiedInitializationHook(e){return e.use(Zo)}}function yr(n,e=null){return function(t,r){let{$from:o,$to:s}=t.selection,i=o.blockRange(s),a=!1,c=i;if(!i)return!1;if(i.depth>=2&&o.node(i.depth-1).type.compatibleContent(n)&&i.startIndex==0){if(o.index(i.depth-1)==0)return!1;let l=t.doc.resolve(i.start-2);c=new je(l,l,i.depth),i.endIndex<i.parent.childCount&&(i=new je(o,t.doc.resolve(s.end(i.depth)),i.depth)),a=!0}let u=An(c,n,e,i);return u?(r&&r(es(t.tr,i,u,a,n).scrollIntoView()),!0):!1}}function es(n,e,t,r,o){let s=A.empty;for(let l=t.length-1;l>=0;l--)s=A.from(t[l].type.create(t[l].attrs,s));n.step(new ge(e.start-(r?2:0),e.end,e.start,e.end,new Me(s,0,0),t.length,!0));let i=0;for(let l=0;l<t.length;l++)t[l].type==o&&(i=l+1);let a=t.length-i,c=e.start+t.length-(r?2:0),u=e.parent;for(let l=e.startIndex,d=e.endIndex,m=!0;l<d;l++,m=!1)!m&&sr(n.doc,c,a)&&(n.split(c,a),c+=2*a),c+=u.child(l).nodeSize;return n}function ts(n,e){return function(t,r){let{$from:o,$to:s,node:i}=t.selection;if(i&&i.isBlock||o.depth<2||!o.sameParent(s))return!1;let a=o.node(-1);if(a.type!=n)return!1;if(o.parent.content.size==0&&o.node(-1).childCount==o.indexAfter(-1)){if(o.depth==3||o.node(-3).type!=n||o.index(-2)!=o.node(-2).childCount-1)return!1;if(r){let d=A.empty,m=o.index(-1)?1:o.index(-2)?2:3;for(let w=o.depth-m;w>=o.depth-3;w--)d=A.from(o.node(w).copy(d));let h=o.indexAfter(-1)<o.node(-2).childCount?1:o.indexAfter(-2)<o.node(-3).childCount?2:3;d=d.append(A.from(n.createAndFill()));let p=o.before(o.depth-(m-1)),f=t.tr.replace(p,o.after(-h),new Me(d,4-m,0)),k=-1;f.doc.nodesBetween(p,f.doc.content.size,(w,y)=>{if(k>-1)return!1;w.isTextblock&&w.content.size==0&&(k=y+1)}),k>-1&&f.setSelection(et.near(f.doc.resolve(k))),r(f.scrollIntoView())}return!0}let c=s.pos==o.end()?a.contentMatchAt(0).defaultType:null,u=t.tr.delete(o.pos,s.pos),l=c?[null,{type:c}]:void 0;return sr(u.doc,o.pos,2,l)?(r&&r(u.split(o.pos,2,l).scrollIntoView()),!0):!1}}function rs(n){return function(e,t){let{$from:r,$to:o}=e.selection,s=r.blockRange(o,i=>i.childCount>0&&i.firstChild.type==n);return s?t?r.node(s.depth-1).type==n?ns(e,t,n,s):os(e,t,s):!0:!1}}function ns(n,e,t,r){let o=n.tr,s=r.end,i=r.$to.end(r.depth);s<i&&(o.step(new ge(s-1,i,s,i,new Me(A.from(t.create(null,r.parent.copy())),1,0),1,!0)),r=new je(o.doc.resolve(r.$from.pos),o.doc.resolve(i),r.depth));const a=Rn(r);if(a==null)return!1;o.lift(r,a);let c=o.mapping.map(s,-1)-1;return In(o.doc,c)&&o.join(c),e(o.scrollIntoView()),!0}function os(n,e,t){let r=n.tr,o=t.parent;for(let h=t.end,p=t.endIndex-1,f=t.startIndex;p>f;p--)h-=o.child(p).nodeSize,r.delete(h-1,h+1);let s=r.doc.resolve(t.start),i=s.nodeAfter;if(r.mapping.map(t.end)!=t.start+s.nodeAfter.nodeSize)return!1;let a=t.startIndex==0,c=t.endIndex==o.childCount,u=s.node(-1),l=s.index(-1);if(!u.canReplace(l+(a?0:1),l+1,i.content.append(c?A.empty:A.from(o))))return!1;let d=s.pos,m=d+i.nodeSize;return r.step(new ge(d-(a?1:0),m+(c?1:0),d+1,m-1,new Me((a?A.empty:A.from(o.copy(A.empty))).append(c?A.empty:A.from(o.copy(A.empty))),a?0:1,c?0:1),a?0:1)),e(r.scrollIntoView()),!0}function ss(n){return function(e,t){let{$from:r,$to:o}=e.selection,s=r.blockRange(o,u=>u.childCount>0&&u.firstChild.type==n);if(!s)return!1;let i=s.startIndex;if(i==0)return!1;let a=s.parent,c=a.child(i-1);if(c.type!=n)return!1;if(t){let u=c.lastChild&&c.lastChild.type==a.type,l=A.from(u?n.create():null),d=new Me(A.from(n.create(null,A.from(a.type.create(null,l)))),u?3:1,0),m=s.start,h=s.end;t(e.tr.step(new ge(m-(u?3:1),h,m,h,d,1,!0)).scrollIntoView())}return!0}}class ot extends j{unistNodeName(){return"listItem"}static proseMirrorNodeName(){return"regular_list_item"}proseMirrorNodeSpec(){return{content:"paragraph block*",defining:!0,group:"list_item",parseDOM:[{tag:"li"}],toDOM(){return["li",0]}}}unistToProseMirrorTest(e){return e.type===this.unistNodeName()&&(!("checked"in e)||typeof e.checked!="boolean")}proseMirrorKeymap(e){const t=e.nodes[this.proseMirrorNodeName()];return{Enter:ts(t),"Shift-Tab":rs(t),Tab:ss(t)}}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:r}){return V(this.proseMirrorNodeName(),e,t,r)}proseMirrorNodeToUnistNodes(e,t){return[{type:this.unistNodeName(),children:t}]}}class is extends j{dependencies(){return[new ot]}unistNodeName(){return"list"}unistToProseMirrorTest(e){return e.type===this.unistNodeName()&&e.ordered===!0}static proseMirrorNodeName(){return"ordered_list"}proseMirrorNodeSpec(){return{content:"list_item+",group:"block",attrs:{spread:{default:!1},startingNumber:{default:1}},parseDOM:[{getAttrs(e){const t=e.getAttribute("start");return{spread:e.getAttribute("data-spread")==="true",startingNumber:t!=null?parseInt(t):1}},tag:"ol"}],toDOM(e){return["ol",{"data-spread":e.attrs.spread,start:e.attrs.startingNumber},0]}}}proseMirrorInputRules(e){return[Ye(/^\s{0,3}(\d+)\.\s$/,e.nodes[this.proseMirrorNodeName()],t=>({startingNumber:+t[1]}),(t,r)=>r.childCount+r.attrs.startingNumber===+t[1])]}proseMirrorKeymap(e){return{"Shift-Mod-9":yr(e.nodes[this.proseMirrorNodeName()])}}unistNodeToProseMirrorNodes({node:e,schema:t,convertedChildren:r,attrs:o}){const{spread:s,start:i}=e;return V(this.proseMirrorNodeName(),t,r,{...o,spread:s,startingNumber:i??1})}proseMirrorNodeToUnistNodes(e,t){const r=e.attrs.spread;return[{type:this.unistNodeName(),ordered:!0,spread:r,start:e.attrs.startingNumber,children:t.map(o=>(o.spread=r,o))}]}}class as extends ce{unistNodeName(){return"delete"}static proseMirrorMarkName(){return"strikethrough"}proseMirrorMarkSpec(){return{parseDOM:[{tag:"s"},{tag:"del"},{style:"text-decoration",getAttrs:e=>/(^|[\s])line-through([\s]|$)/.test(e)&&null}],toDOM(){return["s"]}}}proseMirrorInputRules(e){return[new G(/~([^\s](?:.*[^\s~])?)~([^~])$/,e.marks[this.proseMirrorMarkName()]),new G(/~~([^\s](?:.*[^\s])?)~~([\s\S])$/,e.marks[this.proseMirrorMarkName()])]}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t}){return t.map(r=>r.mark(r.marks.concat([e.marks[this.proseMirrorMarkName()].create()])))}processConvertedUnistNode(e){return{type:this.unistNodeName(),children:[e]}}}function cs(){return n=>{let e=-1;function t(o,s){if(o.type==="tableRow"&&e++,o.type==="tableCell"){const i=o;i.data={...i.data??{},rowIndex:e,columnIndex:s}}}function r(o){if(Nr(o))for(let s=0;s<o.children.length;s++){const i=o.children[s];t(i,s),r(i)}}r(n)}}class xr extends j{unistNodeName(){return"tableCell"}unistToProseMirrorTest(e){return e.type===this.unistNodeName()}static proseMirrorNodeName(){return"table_cell"}proseMirrorNodeSpec(){return{content:"inline*",attrs:{rowIndex:{default:null},columnIndex:{default:null},colspan:{default:1},rowspan:{default:1}},tableRole:"cell",isolating:!0,parseDOM:[{tag:"td",getAttrs(e){const t=e;return{colspan:He(t.getAttribute("colspan"),1),rowspan:He(t.getAttribute("rowspan"),1)}}}],toDOM(e){const{colspan:t,rowspan:r}=e.attrs,o={colspan:t!==1?wt(t,void 0):void 0,rowspan:r!==1?wt(r,void 0):void 0};return[e.attrs.rowIndex==null||e.attrs.rowIndex>0?"td":"th",o,0]}}}proseMirrorInputRules(e){return[]}proseMirrorKeymap(e){return{}}unistNodeToProseMirrorNodes({node:e,schema:t,convertedChildren:r,attrs:o}){return V(this.proseMirrorNodeName(),t,r,{...o,colspan:1,rowspan:1,rowIndex:e.data?.rowIndex,columnIndex:e.data?.columnIndex})}proseMirrorNodeToUnistNodes(e,t){return[{type:this.unistNodeName(),children:t,data:{rowIndex:e.attrs.rowIndex,columnIndex:e.attrs.columnIndex}}]}}class br extends j{dependencies(){return[new xr]}unistNodeName(){return"tableRow"}static proseMirrorNodeName(){return"table_row"}proseMirrorNodeSpec(){return{content:"(table_cell+)",tableRole:"row",parseDOM:[{tag:"tr"}],toDOM(){return["tr",0]}}}proseMirrorInputRules(e){return[]}proseMirrorKeymap(e){return{}}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:r}){return V(this.proseMirrorNodeName(),e,t,r)}proseMirrorNodeToUnistNodes(e,t){return[{type:this.unistNodeName(),children:t}]}}class ls extends j{dependencies(){return[new br]}unistNodeName(){return"table"}static proseMirrorNodeName(){return"table"}proseMirrorNodeSpec(){return{content:"(table_row+)",tableRole:"table",isolating:!0,group:"block",parseDOM:[{tag:"table"}],toDOM(){return["table",["tbody",0]]}}}proseMirrorInputRules(e){return[]}proseMirrorKeymap(e){return{}}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:r}){return V(this.proseMirrorNodeName(),e,t,r)}proseMirrorNodeToUnistNodes(e,t){return[{type:this.unistNodeName(),align:[],children:t}]}unifiedInitializationHook(e){return e.use(cs)}}class us extends j{dependencies(){return[new ot]}unistNodeName(){return"list"}unistToProseMirrorTest(e){return e.type===this.unistNodeName()&&e.ordered!==!0}static proseMirrorNodeName(){return"list"}proseMirrorNodeSpec(){return{content:"list_item+",group:"block",attrs:{spread:{default:!1}},parseDOM:[{getAttrs(e){return{spread:e.getAttribute("data-spread")==="true"}},tag:"ul"}],toDOM(e){return["ul",{"data-spread":e.attrs.spread},0]}}}proseMirrorInputRules(e){return[Ye(/^\s{0,3}([-+*])\s$/,e.nodes[this.proseMirrorNodeName()])]}proseMirrorKeymap(e){return{"Shift-Mod-8":yr(e.nodes[this.proseMirrorNodeName()])}}unistNodeToProseMirrorNodes({node:e,schema:t,convertedChildren:r,attrs:o}){const{spread:s}=e;return V(this.proseMirrorNodeName(),t,r,{...o,spread:s})}proseMirrorNodeToUnistNodes(e,t){const r=e.attrs.spread;return[{type:this.unistNodeName(),ordered:!1,spread:r,children:t.map(o=>(o.spread=r,o))}]}}function Dt(n,e){if(!(n==null||e==null))return{start:{...n},end:{...e}}}const ds=()=>n=>{Dn(n,"list",(e,t,r)=>{if(r==null||t==null)return;const o=[];let s=[],i=0;for(;i<e.children.length;){const a=e.children[i];if(Lt(a)){const c=[];for(;i<e.children.length&&Lt(e.children[i]);)c.push(e.children[i]),i++;if(s.length===0)throw new Error("Unexpected state: currentListItems is empty after encountering blank lines.");const u=s[0],l=ae(_n(s)),d=Dt(u.position?.start??e.position?.start,l.position?.end??e.position?.end),m={type:"list",ordered:e.ordered,start:e.start,spread:e.spread,children:s,position:d};o.push(m),s=[],o.push(...c.map(h=>({type:"lineEndingBlank",position:h.position})))}else s.push(a),i++}if(s.length>0){const a=s[0],c=s[s.length-1],u=Dt(a.position?.start??e.position?.start,c.position?.end??e.position?.end),l={type:"list",ordered:e.ordered,start:e.start,spread:e.spread,children:s,position:u};o.push(l)}r.children.splice(t,1,...o)})};var _t={}.hasOwnProperty;function ps(n,e){var t=e||{};function r(o){var s=r.invalid,i=r.handlers;if(o&&_t.call(o,n)&&(s=_t.call(i,o[n])?i[o[n]]:r.unknown),s)return s.apply(this,arguments)}return r.handlers=t.handlers||{},r.invalid=t.invalid,r.unknown=t.unknown,r}const hs={}.hasOwnProperty;function Er(n,e){let t=-1,r;if(e.extensions)for(;++t<e.extensions.length;)Er(n,e.extensions[t]);for(r in e)if(hs.call(e,r))switch(r){case"extensions":break;case"unsafe":{Vt(n[r],e[r]);break}case"join":{Vt(n[r],e[r]);break}case"handlers":{fs(n[r],e[r]);break}default:n.options[r]=e[r]}return n}function Vt(n,e){e&&n.push(...e)}function fs(n,e){e&&Object.assign(n,e)}const ms=[gs];function gs(n,e,t,r){if(e.type==="code"&&Ct(e,r)&&(n.type==="list"||n.type===e.type&&Ct(n,r)))return!1;if("spread"in t&&typeof t.spread=="boolean")return n.type==="paragraph"&&(n.type===e.type||e.type==="definition"||e.type==="heading"&&no(e,r))?void 0:t.spread?1:0}const Z=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"],Ms=[{character:"	",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"	",before:"[\\r\\n]",inConstruct:"phrasing"},{character:"	",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"\r",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:`
`,inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:" ",after:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",before:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"!",after:"\\[",inConstruct:"phrasing",notInConstruct:Z},{character:'"',inConstruct:"titleQuote"},{atBreak:!0,character:"#"},{character:"#",inConstruct:"headingAtx",after:`(?:[\r
]|$)`},{character:"&",after:"[#A-Za-z]",inConstruct:"phrasing"},{character:"'",inConstruct:"titleApostrophe"},{character:"(",inConstruct:"destinationRaw"},{before:"\\]",character:"(",inConstruct:"phrasing",notInConstruct:Z},{atBreak:!0,before:"\\d+",character:")"},{character:")",inConstruct:"destinationRaw"},{atBreak:!0,character:"*",after:`(?:[ 	\r
*])`},{character:"*",inConstruct:"phrasing",notInConstruct:Z},{atBreak:!0,character:"+",after:`(?:[ 	\r
])`},{atBreak:!0,character:"-",after:`(?:[ 	\r
-])`},{atBreak:!0,before:"\\d+",character:".",after:`(?:[ 	\r
]|$)`},{atBreak:!0,character:"<",after:"[!/?A-Za-z]"},{character:"<",after:"[!/?A-Za-z]",inConstruct:"phrasing",notInConstruct:Z},{character:"<",inConstruct:"destinationLiteral"},{atBreak:!0,character:"="},{atBreak:!0,character:">"},{character:">",inConstruct:"destinationLiteral"},{atBreak:!0,character:"["},{character:"[",inConstruct:"phrasing",notInConstruct:Z},{character:"[",inConstruct:["label","reference"]},{character:"\\",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"]",inConstruct:["label","reference"]},{atBreak:!0,character:"_"},{character:"_",inConstruct:"phrasing",notInConstruct:Z},{atBreak:!0,character:"`"},{character:"`",inConstruct:["codeFencedLangGraveAccent","codeFencedMetaGraveAccent"]},{character:"`",inConstruct:"phrasing",notInConstruct:Z},{atBreak:!0,character:"~"}];function ks(n){return n.label||!n.identifier?n.label||"":Vn(n.identifier)}function ws(n){if(!n._compiled){const e=(n.atBreak?"[\\r\\n][\\t ]*":"")+(n.before?"(?:"+n.before+")":"");n._compiled=new RegExp((e?"("+e+")":"")+(/[|\\{}()[\]^$+*?.-]/.test(n.character)?"\\":"")+n.character+(n.after?"(?:"+n.after+")":""),"g")}return n._compiled}function Ns(n,e,t){const r=e.indexStack,o=n.children||[],s=[];let i=-1,a=t.before;r.push(-1);let c=e.createTracker(t);for(;++i<o.length;){const u=o[i];let l;if(r[r.length-1]=i,i+1<o.length){let d=e.handle.handlers[o[i+1].type];d&&d.peek&&(d=d.peek),l=d?d(o[i+1],n,e,{before:"",after:"",...c.current()}).charAt(0):""}else l=t.after;s.length>0&&(a==="\r"||a===`
`)&&u.type==="html"&&(s[s.length-1]=s[s.length-1].replace(/(\r?\n|\r)$/," "),a=" ",c=e.createTracker(t),c.move(s.join(""))),s.push(c.move(e.handle(u,n,e,{...c.current(),before:a,after:l}))),a=s[s.length-1].slice(-1)}return r.pop(),s.join("")}function ys(n,e,t){const r=e.indexStack,o=n.children||[],s=e.createTracker(t),i=[];let a=-1;for(r.push(-1);++a<o.length;){const c=o[a];r[r.length-1]=a,i.push(s.move(e.handle(c,n,e,{before:`
`,after:`
`,...s.current()}))),c.type!=="list"&&(e.bulletLastUsed=void 0),a<o.length-1&&i.push(s.move(xs(c,o[a+1],n,e)))}return r.pop(),i.join("")}function xs(n,e,t,r){let o=r.join.length;for(;o--;){const s=r.join[o](n,e,t,r);if(s===!0||s===1)break;if(typeof s=="number")return`
`.repeat(1+s);if(s===!1)return`

<!---->

`}return`

`}const bs=/\r?\n|\r/g;function Es(n,e){const t=[];let r=0,o=0,s;for(;s=bs.exec(n);)i(n.slice(r,s.index)),t.push(s[0]),r=s.index+s[0].length,o++;return i(n.slice(r)),t.join("");function i(a){t.push(e(a,o,!a))}}function Cs(n,e,t){const r=(t.before||"")+(e||"")+(t.after||""),o=[],s=[],i={};let a=-1;for(;++a<n.unsafe.length;){const l=n.unsafe[a];if(!oo(n.stack,l))continue;const d=n.compilePattern(l);let m;for(;m=d.exec(r);){const h="before"in l||!!l.atBreak,p="after"in l,f=m.index+(h?m[1].length:0);o.includes(f)?(i[f].before&&!h&&(i[f].before=!1),i[f].after&&!p&&(i[f].after=!1)):(o.push(f),i[f]={before:h,after:p})}}o.sort(Ps);let c=t.before?t.before.length:0;const u=r.length-(t.after?t.after.length:0);for(a=-1;++a<o.length;){const l=o[a];l<c||l>=u||l+1<u&&o[a+1]===l+1&&i[l].after&&!i[l+1].before&&!i[l+1].after||o[a-1]===l-1&&i[l].before&&!i[l-1].before&&!i[l-1].after||(c!==l&&s.push(jt(r.slice(c,l),"\\")),c=l,/[!-/:-@[-`{-~]/.test(r.charAt(l))&&(!t.encode||!t.encode.includes(r.charAt(l)))?s.push("\\"):(s.push("&#x"+r.charCodeAt(l).toString(16).toUpperCase()+";"),c++))}return s.push(jt(r.slice(c,u),t.after)),s.join("")}function Ps(n,e){return n-e}function jt(n,e){const t=/\\(?=[!-/:-@[-`{-~])/g,r=[],o=[],s=n+e;let i=-1,a=0,c;for(;c=t.exec(s);)r.push(c.index);for(;++i<r.length;)a!==r[i]&&o.push(n.slice(a,r[i])),o.push("\\"),a=r[i];return o.push(n.slice(a)),o.join("")}function Ss(n){const e=n||{},t=e.now||{};let r=e.lineShift||0,o=t.line||1,s=t.column||1;return{move:c,current:i,shift:a};function i(){return{now:{line:o,column:s},lineShift:r}}function a(u){r+=u}function c(u){const l=u||"",d=l.split(/\r?\n|\r/g),m=d[d.length-1];return o+=d.length-1,s=d.length===1?s+m.length:1+m.length+r,l}}function Ts(n,e={}){const t={enter:o,indentLines:Es,associationId:ks,containerPhrasing:Is,containerFlow:Bs,createTracker:Ss,compilePattern:ws,safe:Os,stack:[],unsafe:[...Ms],join:[...ms],handlers:{...so},options:{},indexStack:[],handle:void 0};Er(t,e),t.options.tightDefinitions&&t.join.push(Rs),t.handle=ps("type",{invalid:vs,unknown:As,handlers:t.handlers});let r=t.handle(n,void 0,t,{before:`
`,after:`
`,now:{line:1,column:1},lineShift:0});return r&&r.charCodeAt(r.length-1)!==10&&r.charCodeAt(r.length-1)!==13&&(r+=`
`),r;function o(s){return t.stack.push(s),i;function i(){t.stack.pop()}}}function vs(n){throw new Error("Cannot handle value `"+n+"`, expected node")}function As(n){const e=n;throw new Error("Cannot handle unknown node `"+e.type+"`")}function Rs(n,e){if(n.type==="definition"&&n.type===e.type)return 0}function Is(n,e){return Ns(n,this,e)}function Bs(n,e){return ys(n,this,e)}function Os(n,e){return Cs(this,n,e)}const Ls=(n,e,t,r)=>n.children.map(o=>t.handle(o,void 0,t,r)).join(""),Ds=(n,e,t,r)=>t.safe(n.value,r).replaceAll("\\[","[").replaceAll("\\&","&");function _s(){const n=this;n.compiler=e;function e(t){return Ts(t,{...n.data("settings"),fences:!0,bullet:"-",bulletOther:"*",listItemIndent:"one",resourceLink:!0,tightDefinitions:!0,rule:"-",handlers:{text:Ds,startend:Ls},extensions:n.data("toMarkdownExtensions")||[]})}}class Vs extends Mn{dependencies(){return[new Qo,new Qt,new jo,new Mr,new Go,new Ue,new er,new Yo,new qo,new wr,new pr,new ot,new is,new on,new Xe,new us,new as,new Re,new ls,new br,new xr]}unifiedInitializationHook(e){return e.use(jn).use(io).use(ds).use(_s)}}class js{rules;constructor(e,t){this.rules=[].concat.apply([],e.syntaxExtensions().map(r=>r.proseMirrorInputRules(t)))}build(){return sn({rules:this.rules})}}class Hs{keymap;constructor(e,t){this.keymap=new Map;for(const r of e.syntaxExtensions())this.addKeymap(r.proseMirrorKeymap(t));this.addKeymap(ro)}build(){const e={};return this.keymap.forEach((t,r)=>{e[r]=ur(...t)}),tt(e)}addKeymap(e){for(const t in e)this.keymap.get(t)||this.keymap.set(t,[]),ae(this.keymap.get(t)).push(e[t])}}class zs{nodeViews;constructor(e){this.nodeViews={};for(const t of e.nodeExtensions()){const r=t.proseMirrorNodeName(),o=t.proseMirrorNodeView();r!=null&&o!=null&&(this.nodeViews[r]=o)}}build(){return this.nodeViews}}class $s{nodes={};marks={};constructor(e){for(const t of e.nodeExtensions()){const r=t.proseMirrorNodeName(),o=t.proseMirrorNodeSpec();r!=null&&o!=null&&(r!=="text"&&(o.attrs={...o.attrs,start:{default:void 0},end:{default:void 0}}),this.nodes[r]=o)}for(const t of e.markExtensions()){const r=t.proseMirrorMarkName(),o=t.proseMirrorMarkSpec();r!=null&&o!=null&&(this.marks[r]=o)}}build(){return new Bn({nodes:this.nodes,marks:this.marks})}}class Fs{extensionManager;constructor(e){this.extensionManager=e}build(){let e=Hn();for(const t of this.extensionManager.extensions())e=t.unifiedInitializationHook(e);return e}}function Us(n){return n instanceof j}function Ks(n){return n instanceof ce}class Ws{markExtensionList;nodeExtensionList;otherExtensionList;constructor(e){this.markExtensionList=new Map,this.nodeExtensionList=new Map,this.otherExtensionList=new Map;for(const t of e)this.add(t)}extensions(){return this.syntaxExtensions().concat(Array.from(this.otherExtensionList.values()))}markExtensions(){return Array.from(this.markExtensionList.values())}getMarkExtension(e){return this.markExtensionList.get(e)??null}nodeExtensions(){return Array.from(this.nodeExtensionList.values())}getNodeExtension(e){return this.nodeExtensionList.get(e)??null}syntaxExtensions(){return this.nodeExtensions().concat(this.markExtensions())}add(e){for(const t of e.dependencies())this.add(t);if(Ks(e)){this.markExtensionList.set(e.constructor.name,e);return}if(Us(e)){this.nodeExtensionList.set(e.constructor.name,e);return}this.otherExtensionList.set(e.constructor.name,e)}}class Gs{extensionManager;constructor(e){this.extensionManager=e}convert(e){const t=this.convertNode(e);if(t.length!==1)throw new Error("Couldn't find any way to convert the root ProseMirror node.");return t[0]}convertNode(e){let t=null;const r=[];for(const o of this.extensionManager.nodeExtensions()){if(!o.proseMirrorToUnistTest(e))continue;r.push(o);let s=[];for(let i=0;i<e.childCount;++i)s=s.concat(this.convertNode(e.child(i)));t=o.proseMirrorNodeToUnistNodes(e,s)}return t==null?(console.warn(`Couldn't find any way to convert ProseMirror node of type "`+e.type.name+'" to a unist node.'),[]):t.map(o=>{for(const s of e.marks){const{type:{name:i}}=s;if(r.some(u=>{const l=u.proseMirrorNodeSpec()?.marks;return l!=null&&!l.includes(i)}))continue;let c=!1;for(const u of this.extensionManager.markExtensions())s.type.name===u.proseMirrorMarkName()&&(o=u.processConvertedUnistNode(o,s),c=!0);c||console.warn(`Couldn't find any way to convert ProseMirror mark of type "`+i+'" to a unist node.')}return o})}}class st{extensionManager;proseMirrorSchema;constructor(e,t){this.extensionManager=e,this.proseMirrorSchema=t}static unistNodeIsParent(e){return"children"in e}convert(e){const t={},r=this.convertNode(e,t);for(const o of this.extensionManager.syntaxExtensions())o.postUnistToProseMirrorHook(t);if(r.length!==1)throw new Error("Couldn't find any way to convert the root unist node.");return r[0]}convertNode(e,t){let r=0;const o=(s,i)=>{for(const a of this.extensionManager.syntaxExtensions()){if(!a.unistToProseMirrorTest(s))continue;let c=[];st.unistNodeIsParent(s)&&(c=s.children.flatMap(p=>o(p,i)));const{position:u}=s;let l=u?.start.offset??r,d=u?.end.offset;if(d==null&&"value"in s&&typeof s.value=="string"){const{value:p}=s;d=l+p.length}d==null&&(d=l),r=d;const m={start:l,end:d};return zn(a.unistNodeToProseMirrorNodes({node:s,schema:this.proseMirrorSchema,convertedChildren:c,context:i,attrs:m})).filter($n)}return console.warn(`Couldn't find any way to convert unist node of type "`+s.type+'" to a ProseMirror node.'),[]};return o(e,t)}}const Xs=5;class Ys{builtSchema;inputRulesBuilder;keymapBuilder;nodeViewBuilder;unistToProseMirrorConverter;proseMirrorToUnistConverter;unified;memoizedProsemirrorDocs=new Map;constructor(e=[]){const t=new Ws(e);this.builtSchema=new $s(t).build(),this.inputRulesBuilder=new js(t,this.builtSchema),this.keymapBuilder=new Hs(t,this.builtSchema),this.nodeViewBuilder=new zs(t),this.unistToProseMirrorConverter=new st(t,this.builtSchema),this.proseMirrorToUnistConverter=new Gs(t),this.unified=new Fs(t).build()}parse(e){try{if(this.memoizedProsemirrorDocs.has(e))return ae(this.memoizedProsemirrorDocs.get(e));const t=this.unistToProseMirrorConverter.convert(this.parseUnist(e));if(this.memoizedProsemirrorDocs.set(e,t),this.memoizedProsemirrorDocs.size>Xs){const r=this.memoizedProsemirrorDocs.keys().next().value;this.memoizedProsemirrorDocs.delete(r)}return t}catch(t){_.logError("Failed to parse document",t)}return this.schema().text(" ")}parseUnist(e){return this.unified.runSync(this.unified.parse(e))}schema(){return this.builtSchema}inputRulesPlugin(){return this.inputRulesBuilder.build()}keymapPlugin(){return this.keymapBuilder.build()}nodeViews(){return this.nodeViewBuilder.build()}serialize(e){const t=this.proseMirrorToUnistConverter.convert(e);return this.unified.stringify(t)}}let Ht=null;function ee(){return Ht??=new Ys([new Vs]),Ht}const qs=(n,e)=>{if(!e)return!1;const[t,r]=e;return n>=t&&n<r},zt=n=>{const e=new Map;n.descendants((r,o)=>{const s=gt(r);if(!s)return;const{start:i,end:a}=s,c=r.type.name,{depth:u}=n.resolve(o),l=Math.random().toString();if(e.set(o,{pmPos:o,sourcePos:i,leafSourceRange:r.isBlock?void 0:[i,a],blockId:r.isBlock?l:null,depth:u,nodeTypeName:c}),r.isBlock){const d=o+r.nodeSize-1;e.set(d,{pmPos:d,sourcePos:a,depth:n.resolve(d).depth,blockId:l,nodeTypeName:c,isClose:!0})}if(r.isText)for(let d=0;d<(r.text?.length??0);d++){const m=o+d;e.set(m,{pmPos:m,sourcePos:i+d,depth:u,blockId:null,nodeTypeName:c})}}),e.set(n.content.size,{pmPos:n.content.size,nodeTypeName:n.type.name,depth:0,isClose:!0,blockId:null,sourcePos:ae(gt(n)).end});const t=Array.from(e.entries()).sort(([r],[o])=>r-o).map(([,r])=>r);return{positions:t,pmRangeToSourceRange:({start:r,end:o})=>({start:t[Math.max(r,0)].sourcePos,end:t[Math.min(o,t.length-1)].sourcePos}),sourceRangeToPmRange:r=>{let o=[],s=[];const{start:i,end:a}=r,c=t[t.length-1].sourcePos,u=Math.min(Math.max(i,0),c),l=Math.min(Math.max(a,0),c),d=p=>{const{depth:f,nodeTypeName:k,blockId:w,pmPos:y,isClose:N=!1}=p;o.push({depth:f,blockId:w,nodeTypeName:k,pmPos:y,isClose:N})},m=p=>{const{depth:f,nodeTypeName:k,blockId:w,pmPos:y,isClose:N=!1}=p;s.push({depth:f,blockId:w,nodeTypeName:k,pmPos:y,isClose:N})};for(let p=0;p<t.length;p++){const f=t[p],{sourcePos:k,leafSourceRange:w,isClose:y=!1}=f;if(k>l)break;const N=t[p+1]??null;if(k===u&&!y||qs(u,w))d(f);else if(k<=u&&(N?.sourcePos??Number.POSITIVE_INFINITY)>=u){let M=p+1;const C=[];for(;t[M]?.isClose===!0;)C.push(M),M++;if(t[M]){const{sourcePos:P}=t[M];do d(t[M]);while(t[++M].sourcePos===P)}else{(k===u||y)&&d(f);for(const P of C)d(t[P])}p=M}}for(let p=0;p<t.length;p++){const f=t[p],{sourcePos:k}=f;if(k>l)break;const w=t[p-1]??null,y=t[p+1]??null;if(k===l||l>k&&l<(y?.sourcePos??-1)){if(f.isClose&&!w?.isClose&&f.nodeTypeName===w.nodeTypeName||!f.isClose&&y.isClose&&f.nodeTypeName===y.nodeTypeName||f.isClose&&w?.isClose){m(w);let P=p-2,S=t[P];for(;P>=0&&S.isClose;)m(S),S=t[--P]}let N=p,M=f,C=M;do m(M),C=M,M=t[++N];while(M?.sourcePos===l||M?.depth<C?.depth);break}}const h=(p,f)=>p.pmPos-f.pmPos;return{start:o.sort(h),end:s.sort(h)}}}},Js=(n,e,t)=>{const r=[];for(const o of e)for(const s of t)r.push(n.slice(o.pmPos,s.pmPos));return r},Zs=(n,e)=>{const t=n[0].pmPos,r=e.filter(({pmPos:o})=>o<t);return e.filter(({pmPos:o})=>o>=t).concat(n).concat(r)},Qs=({diff:n})=>{const e=ee(),{contentAfter:t,contentBefore:r,edits:o}=n,s=e.parse(t),i=e.parse(r),a=o.concat().sort((p,f)=>p.positionBefore.start-f.positionBefore.start),c=[],u=[],{sourceRangeToPmRange:l}=zt(i),{sourceRangeToPmRange:d}=zt(s);let m=i,h=0;for(let p=0;p<a.length;p++){const{positionBefore:f,positionAfter:k}=a[p],w=l(f),y=d(k),N=f.start!==f.end,{start:M,end:C}=w,{start:P,end:S}=y,R=Zs(M,C),B=Js(s,P,S),O=Math.max(...M.map(({pmPos:I})=>I)),H=Math.min(...C.map(({pmPos:I})=>I));let b=!1;for(const I of R){for(const D of B)try{const T=I.pmPos+h;m=m.replace(T,T,D),N&&u.push({start:O+h,end:H+h}),c.push({start:T,end:T+D.size}),h+=D.size,b=!0;break}catch{}if(b)break}if(!b){const D=Math.min(...R.map(({pmPos:T})=>T))+h-1;for(const T of B)try{m=m.replace(D,D,T),c.push({start:D,end:D+T.size}),h+=T.size,N&&u.push({start:O+h,end:H+h}),b=!0;break}catch{}}b||_.logError("Failed to insert edit for diffed doc",null,{replaceFromCandidates:M,replaceToCandidates:C,sliceFromCandidates:P,sliceToCandidates:S})}return{doc:m,addedRanges:c,deletedRanges:u}},be=new X("focus"),ei=(n,e)=>new U({key:be,state:{init:()=>!1,apply(t,r){const o=t.getMeta(be);return typeof o=="boolean"?o:r}},props:{handleDOMEvents:{blur:(t,r)=>{const{relatedTarget:o}=r;return o!=null&&nt.isInCodeBlockView(o)||(e(r),t.dispatch(t.state.tr.setMeta(be,!1))),!1},focus:(t,r)=>(n(r),t.dispatch(t.state.tr.setMeta(be,!0)),!1)}}});function Cr(n,e){const t=e&&n.dom?.querySelectorAll(`[data-edit-id="${e}"]`);return t?Array.from(t):[]}function ti(n,e){return Cr(n,e).flatMap(r=>Array.from(r.getClientRects()))}function Ke(n,e,t){return n>=t.left&&n<=t.right&&e>=t.top&&e<=t.bottom}function Pr(n){const e=Math.min(...n.map(s=>s.left)),t=Math.max(...n.map(s=>s.right)),r=Math.min(...n.map(s=>s.top)),o=Math.max(...n.map(s=>s.bottom));return{left:e,right:t,top:r,bottom:o}}function ri(n,e,t){return t.some(o=>Ke(n,e,o))?!0:t.length<2?!1:t.some(o=>n>=o.left&&n<=o.right&&e>o.bottom)&&t.some(o=>n>=o.left&&n<=o.right&&e<o.top)}const ni=new X("linkTooltip"),oi=36;class si{tooltipElement;button;onMouseLeave;constructor(e){this.tooltipElement=document.createElement("div"),this.tooltipElement.className=$("absolute  py-1.5 px-2.5 bg-token-main-surface-primary border border-token-border-light rounded-lg text-xs z-50 items-center cursor-pointer shadow-md flex justify-center cursor-pointer","transform -translate-x-1/2"),this.button=document.createElement("button"),this.button.textContent="Open link",this.button.className=$("bg-none","border-none","text-token-text-primary ","text-sm"),this.tooltipElement.appendChild(this.button),this.onMouseLeave=e,this.tooltipElement.addEventListener("mouseleave",e)}show(e,t,r){document.body.appendChild(this.tooltipElement),this.tooltipElement.style.left=`${e}px`,this.tooltipElement.style.top=`${t}px`;const o=()=>{window.open(r,"_blank"),this.hide()};this.button.addEventListener("click",o,{once:!0})}hide(){this.tooltipElement.parentNode&&this.tooltipElement.parentNode.removeChild(this.tooltipElement)}}function ii(){let n=null,e=null;const t=s=>{if(n==null||e==null)return!1;const i=Array.from(e.getClientRects()),a=n.tooltipElement.getBoundingClientRect();if(i.length===1){const c=i[0];return!Ke(s.clientX,s.clientY,Pr([c,a]))}else return!ri(s.clientX,s.clientY,[a,...i])},r=(s,i)=>{n&&(n.hide(),n=null);const a=s.getAttribute("href");if(!a)return;const c=Array.from(s.getClientRects()),u=c.find(m=>Ke(i.clientX,i.clientY,m))??c[0],l=u.left+u.width/2,d=u.top-oi;n=new si(m=>{t(m)&&o()}),n.show(l,d,a),e=s},o=()=>{n&&(n.hide(),n=null),e=null};return new U({key:ni,props:{handleDOMEvents:{mousemove(s,i){const a=()=>{const{target:u}=i;if(!(u instanceof HTMLElement))return!1;const l=u.closest("a[href]");return l!=null&&l!==e?(r(l,i),!0):!1},c=()=>{n==null||!t(i)||o()};a()||c()}}},view:()=>({destroy:o})})}function Sr(n){return ee().serialize(n).length}const ai=new X("maxLength"),ci=(n,e,t)=>new U({key:ai,state:{init(){return t},apply:()=>{}},filterTransaction(r){if(n==null||!r.steps.some(i=>i instanceof On||i instanceof ge?i.slice.size>i.to-i.from:!1))return!0;const s=Sr(r.doc);return s<=t?!0:(e&&qe(e,n,t),_.logEvent(Yt.canvasProsemirrorMaxLength,{maxLength:t,newLength:s}),!1)}});function li(n={}){return new U({view(e){return new ui(e,n)}})}class ui{constructor(e,t){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=t.width)!==null&&r!==void 0?r:1,this.color=t.color===!1?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map(o=>{let s=i=>{this[o](i)};return e.dom.addEventListener(o,s),{name:o,handler:s}})}destroy(){this.handlers.forEach(({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t))}update(e,t){this.cursorPos!=null&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),t=!e.parent.inlineContent,r;if(t){let a=e.nodeBefore,c=e.nodeAfter;if(a||c){let u=this.editorView.nodeDOM(this.cursorPos-(a?a.nodeSize:0));if(u){let l=u.getBoundingClientRect(),d=a?l.bottom:l.top;a&&c&&(d=(d+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),r={left:l.left,right:l.right,top:d-this.width/2,bottom:d+this.width/2}}}}if(!r){let a=this.editorView.coordsAtPos(this.cursorPos);r={left:a.left-this.width/2,right:a.left+this.width/2,top:a.top,bottom:a.bottom}}let o=this.editorView.dom.offsetParent;this.element||(this.element=o.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",t),this.element.classList.toggle("prosemirror-dropcursor-inline",!t);let s,i;if(!o||o==document.body&&getComputedStyle(o).position=="static")s=-pageXOffset,i=-pageYOffset;else{let a=o.getBoundingClientRect();s=a.left-o.scrollLeft,i=a.top-o.scrollTop}this.element.style.left=r.left-s+"px",this.element.style.top=r.top-i+"px",this.element.style.width=r.right-r.left+"px",this.element.style.height=r.bottom-r.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),o=r&&r.type.spec.disableDropCursor,s=typeof o=="function"?o(this.editorView,t,e):o;if(t&&!s){let i=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=Ln(this.editorView.state.doc,i,this.editorView.dragging.slice);a!=null&&(i=a)}this.setCursor(i),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){(e.target==this.editorView.dom||!this.editorView.dom.contains(e.relatedTarget))&&this.setCursor(null)}}function Ee(n){return(e,t,r)=>{const{doc:o,selection:s}=e,{empty:i,$head:a}=s;if(i&&r?.endOfTextblock(n)){const c=n==="left"||n==="up"?-1:1,u=et.near(o.resolve(c>0?a.after():a.before()),c);if(u.$head?.parent.type.name===Ie)return t?.(e.tr.setSelection(u)),!0}return!1}}const di=tt({ArrowLeft:Ee("left"),ArrowRight:Ee("right"),ArrowUp:Ee("up"),ArrowDown:Ee("down")}),it=new X("modelCursor");function pi(n,e){return n.setMeta(it,{modelCursor:e})}function hi(n){return n.getMeta(it)??null}const $t=(n,e)=>{const{doc:t}=n,r=[],{modelSelectionPositionRange:o,modelCursorPosition:s}=e??{};if(s!=null){const i=ut(t,[s])[0];if(Pe(t,i)){const a=t.resolve(i);if(t.nodeAt(i)?.type.name===Ue.proseMirrorNodeName()||a.nodeBefore?.type.name===Ue.proseMirrorNodeName())return W.empty}r.push(ie.widget(i,()=>{const a=document.createElement("span");return a.className=an.modelCursor,a},{ignoreSelection:!0,side:1}))}else if(o!=null){const[i,a]=ut(n.doc,[o.start,o.end]);r.push(ie.inline(i,a,{class:`${Fn} !bg-[Highlight]`}))}return r.length?W.create(t,r):W.empty};function fi(n=void 0){return new U({key:it,state:{init:(e,t)=>({modelCursor:n,deco:$t(t,n)}),apply:(e,t,r,o)=>{const i=hi(e)?.modelCursor??t.modelCursor;return{modelCursor:i,deco:$t(o,i)}}},props:{decorations(e){return this.getState(e)?.deco}}})}const Tr="ignoreDocChange";function mi(n){return n.setMeta(Tr,!0)}function gi(n){return n.getMeta(Tr)===!0}function Mi(n){const e=n.content.size-(n.lastChild?.content.size??0)-1;if(Pe(n,e))return z.create(n,e)}const vr=({intl:n,toaster:e,value:t,comments:r,diff:o,maxLength:s=rr,selection:i,onFocus:a,onBlur:c,onSave:u,safeUrls:l,modelCursor:d,isDisabled:m})=>{const h=ee(),p=h.schema();let f=t;s!=null&&f.length>s&&(f=f.slice(0,s),e!=null&&n!=null&&qe(e,n,s));let k,w=[],y=[];o?{doc:k,addedRanges:w,deletedRanges:y}=Qs({diff:o}):k=h.parse(f);const N=i?Vo(k,i):Mi(k);return ir.create({doc:k,schema:p,selection:N,plugins:[ci(n,e,s),h.inputRulesPlugin(),h.keymapPlugin(),tt({"Mod-s":()=>(u(),!0),"Mod-z":uo,"Mod-shift-z":Pt,"Mod-y":Pt}),di,li(),ao(),co(),ei(a,c),tr(r??[]),...o?[Ao(w,y)]:[],fi(d),xo(new Set(l??[])),Co(n,m),ii(),...Oo()]})},Ar=(n,e)=>{const t=ee(),r=t.schema(),o=t.parse(n);return ir.create({doc:o,schema:r,plugins:[tr(e??[])]})},ki=({mount:n,value:e,comments:t,isDarkMode:r})=>new ar({mount:n},{editable:()=>!1,state:Ar(e,t),nodeViews:{[Ie]:(s,i,a)=>new nt(s,i,a,r)}}),wi=(n,{intl:e,toaster:t,comments:r,value:o,maxLength:s=rr,onBlur:i,onFocus:a,onChange:c,onUpdate:u,onSave:l,safeUrls:d,modelCursor:m,selection:h,isDisabled:p},f=!1)=>{const k=vr({intl:e,toaster:t,comments:r,value:o,maxLength:s,onBlur:i,onFocus:a,onSave:l,safeUrls:d,modelCursor:m,selection:h,isDisabled:p});u(k);const w=N=>{const M=y.state.apply(N);if(y.updateState(M),u(M),!N.docChanged||gi(N))return;const C=fr(M);if(!C)return;const{doc:P}=M,{changeset:S}=C;c?.({transaction:N,changeset:S,doc:P,getSerializedDocument:()=>ee().serialize(P),getAdjustedComments:()=>{const R=cn(nr,M);if(R==null)return[];const B=ee(),O=B.parse(B.serialize(P)),H=kn(O,R.positions);return wn(R.comments,H)}})},y=new ar({mount:n},{state:k,dispatchTransaction:w,nodeViews:{[Ie]:(N,M,C)=>new nt(N,M,C,f)},handlePaste(N,M){const C=M.clipboardData?.getData("text/plain");if(C==null)return!1;_.logEvent(Yt.canvasProsemirrorPaste,{textLength:C.length});const P=Sr(N.state.doc),S=P+C.length;let R=C;if(s!=null&&S>s){t!=null&&e!=null&&qe(t,e,s);const O=s-P-50;R=O>0?C.slice(0,O):""}return lo(N,R),!0}});return{view:y,pmu:ee()}},Ni="_main_gvo0h_1",Rr={main:Ni};function yi(n,e){const t=e.target;if(t instanceof Element&&[me.PROSEMIRROR_EDITOR_CONTAINER,me.PROSEMIRROR_CONTEXT_CHILDREN].some(c=>t.closest(`#${c}`)!=null))return!1;n.focus();const r=Lo(n.dom.getBoundingClientRect(),{x:e.clientX,y:e.clientY}),o=n.state.tr,s=n.posAtCoords({left:r.x,top:r.y});if(s!=null){const i=Math.min(s.pos,ln(n.state.doc)-1);o.setSelection(new z(o.doc.resolve(i))),n.dispatch(o)}return!0}const he=({editorRef:n,wrapperClassName:e,transparentBackground:t=!1,comments:r,commentingOn:o,diff:s,paddingBottom:i,hoveredCommentId:a,focusedCommentId:c,hoveredEditId:u,rejectedEdits:l,showChanges:d,readonlyReason:m,isDisabled:h=!1,value:p,onBlur:f,onFocus:k,onChange:w,onMouseLeave:y,onSave:N,safeUrls:M,children:C,width:P,modelCursor:S,shouldResetSelection:R=!1})=>{const B=Ge(),O=Dr(),H=x.useRef(null),b=x.useRef(null),[I,D]=x.useState(null),T=qt(),q=T.resolvedTheme==="dark",[{width:Be},Oe]=cr(),te=x.useRef(f);te.current=f;const le=x.useRef(k);le.current=k;const ue=x.useRef(w);ue.current=w;const de=x.useRef(N);de.current=N;const pe=x.useCallback((E=p)=>vr({intl:B,toaster:O,comments:r,diff:s,value:E,selection:R?void 0:b.current?.state.selection,onBlur:v=>te.current?.(v),onFocus:v=>le.current?.(v),onSave:()=>de.current?.(),modelCursor:S,isDisabled:h,safeUrls:M}),[B,O,r,s,p,R,S,h,M]),at=x.useCallback(E=>{const v=pe(E);b.current?.updateState(v),D(v)},[pe]);x.useImperativeHandle(n,()=>({UNSAFE_setValue:at,revertChanges:()=>{if(b.current==null)throw new Error("Tried to call revertChanges, but viewRef.current is null");Bo(b.current)},flushChanges:()=>{if(b.current==null)throw new Error("Tried to call flushChanges, but viewRef.current is null");Io(b.current)},maybeFocusOnEditor:E=>{if(b.current==null)throw new Error("Tried to call maybeFocus, but viewRef.current is null");return yi(b.current,E)},viewRef:b})),x.useEffect(()=>{const{current:E}=H;if(!E)return;const{view:v}=wi(E,{intl:B,toaster:O,comments:r,value:p,onBlur:F=>te.current?.(F),onFocus:F=>le.current?.(F),onChange:F=>ue.current?.(F),onUpdate:D,onSave:()=>de.current?.(),isDisabled:h,safeUrls:M},q);return b.current=v,()=>{v?.destroy()}},[m]),x.useEffect(()=>{b.current?.updateState(pe())},[s]),x.useEffect(()=>{b.current?.setProps({editable:()=>!h})},[h]),J(E=>bo(E,h),b,[h]),J(E=>{if(T.resolvedTheme==null)return;const{schema:v}=E.doc.type,F=v.nodes.code_block;return F?(E.doc.descendants((Y,Ne)=>{if(Y.type===F){const Le=Y.type.create({...Y.attrs,isDarkMode:q},Y.content,Y.marks);E.replaceWith(Ne,Ne+Y.nodeSize,Le)}}),mi(E)):E},b,[T.resolvedTheme,q]),J(E=>E.setMeta(Fe,d),b,[d]),J(E=>pi(E,S),b,[S]),J(E=>E.setMeta(nr,{comments:r,commentingOn:o,hoveredCommentId:a,focusedCommentId:c}),b,[r,a,c,o]),J(E=>E.setMeta($e,{hoveredEditId:u,rejectedEdits:l??new Set}),b,[u,l]),J(E=>No(E,new Set(M??[])),b,[M]);const ke=x.useCallback(()=>b.current,[b]),re=[],we=[];return x.Children.forEach(C,E=>{if(!x.isValidElement(E))return;const{type:v}=E;if(v===Br)re.push(E);else if(v===Ir)we.push(E);else throw new Error("Invalid Prosemirror child: "+JSON.stringify(v))}),g.jsx(Nn.Provider,{value:ke,children:g.jsx(yn.Provider,{value:I,children:g.jsxs(xn.Provider,{value:Be,children:[g.jsx("div",{id:me.PROSEMIRROR_CONTEXT_CHILDREN,children:re}),g.jsxs("div",{className:e,onMouseLeave:y,id:me.PROSEMIRROR_EDITOR_CONTAINER,style:{paddingBottom:i},children:[g.jsx("div",{ref:Je(H,Oe),className:$(Rr.main,lr.composer,"markdown prose dark:prose-invert focus:outline-none",t?"bg-transparent":"bg-token-main-surface-primary"),style:{width:P}}),we]})]})})})},Ir=({children:n})=>n,Br=({children:n})=>n;he.EditorChildren=Ir;he.ContextChildren=Br;function xi(n,e){x.useEffect(()=>{const t=n?.current;if(t!=null)return _r(t,{mousedown:r=>{e.current?.maybeFocusOnEditor(r)===!0&&r.preventDefault()}})},[e,n])}const bi=({wrapperClassName:n,value:e="",width:t,comments:r,paddingBottom:o})=>{const s=x.useRef(null),i=x.useRef(null),a=qt().resolvedTheme==="dark";return x.useEffect(()=>{const{current:c}=s;if(c)return i.current=ki({mount:c,comments:r,value:e,isDarkMode:a}),()=>{i.current?.destroy()}},[]),x.useEffect(()=>{const c=Ar(e,r);i.current?.updateState(c)},[e,r]),g.jsx("div",{className:n,children:g.jsx("div",{ref:Je(s),className:$(Rr.main,"markdown prose dark:prose-invert focus:outline-none"),style:{width:t,paddingBottom:o}})})},Ce=100,Ei={type:"spring",duration:1.5,bounce:.1},Ci={type:"spring",duration:.5,bounce:0},Ft={type:"spring",duration:.2},Ut={type:"spring",duration:1,delay:.1},Pi={type:"spring",duration:1},Si={type:"spring",duration:.5,bounce:0},Ti=({isRewriting:n=!1,value:e,previousValue:t,previousComments:r,documentWidth:o,paddingBottom:s,onStart:i})=>{const a=Ze(),c=Nt(0),u=Nt(-Ce),l=x.useRef(!1),[d,m]=Un();Vr(()=>{const p=a();if(p)return p.dom.style.clipPath="inset(0 0 100% 0)",()=>{const f=a();f&&(f.dom.style.clipPath="")}},[]),x.useEffect(()=>{const p=a();if(!(!p||un(p.state.doc)))try{const{top:f}=p.coordsAtPos(0),{top:k,bottom:w}=p.coordsAtPos(Math.max(p.state.doc.content.size-1,0),-1),y=w-f,N=k-f;if(c.set(y-N),!d){yt(u,y+2*c.get(),Ci).then(()=>m?.());return}yt(u,y,Ei)}catch(f){_.logError("Failed to set rewrite animation position",f),m?.()}},[d,e]);const h=Kn(u,p=>He(p)-Ce+2);return xt(u,"change",p=>{const f=a();!f||!p||!l.current||(f.dom.style.clipPath=`inset(0 0 calc(100% - ${p}px) 0)`)}),xt(u,"animationStart",()=>{n&&i?.()}),g.jsxs(g.Fragment,{children:[g.jsx(se.div,{className:"absolute top-0 z-10 w-full origin-bottom bg-gradient-to-t from-token-main-surface-primary from-10% to-transparent",style:{translateY:h,height:Ce},initial:{opacity:0},animate:{opacity:1,transition:Ft},exit:{opacity:0,transition:Ut},onAnimationComplete:()=>l.current=!0},"wash-top"),g.jsx(se.div,{className:"absolute top-0 z-10 w-full bg-gradient-to-b from-token-main-surface-primary to-transparent",style:{translateY:u,height:Ce},initial:{opacity:0},animate:{opacity:1,transition:Ft},exit:{opacity:0,transition:Ut}},"wash-bottom"),g.jsx(se.div,{className:"pointer-events-none absolute z-0 min-w-0 max-w-full",initial:{opacity:1},animate:{opacity:.3,transition:Pi},exit:{opacity:0,transition:Si},children:g.jsx(bi,{value:t,width:o,comments:r,wrapperClassName:"h-fit flex",paddingBottom:s})},"previousValue")]})};function Kt(n,e){if(n==null)return!1;const t=n.state.schema.marks[e];return t==null?!1:gr(n.state,n.dispatch,t)}function _e(n,e){if(n==null)return!1;const{state:t,dispatch:r}=n,o=ae(t.schema.nodes[er.proseMirrorNodeName()]);return dr(o,{level:e})(t,r)}function vi(n){if(n==null)return!1;const{state:e,dispatch:t}=n,r=ae(e.schema.nodes[Qt.proseMirrorNodeName()]);return dr(r)(e,t)}const Ai=({onAddComment:n,isWaitingForCommentResponse:e=!1})=>{const t=Ge(),r=Ze(),o=or(),s=x.useCallback(c=>{const{width:u,height:l}=c,d=r();if(!o||!d||"docView"in d&&d.docView==null)return null;const{to:m,empty:h,head:p}=o.selection,f=p===m;if(h||!Pe(d.state.doc,p))return null;const{right:k,left:w,top:y}=d.coordsAtPos(0);let N=p,M=d.state.doc.nodeAt(N);const C=f?-1:1;for(;!M?.isText&&Pe(d.state.doc,N+C);)N+=C,M=d.state.doc.nodeAt(N);const{left:P,bottom:S,top:R}=d.coordsAtPos(N,f?-1:1),B=k-w;function O(){if(f)return Math.max(P-w-u,0);let I=P-w;return I+u>B&&(I=-(u-B)),I}function H(){const I=window.innerHeight-S>l*2;return f&&I?{top:S-y+8,aboveOrBelow:dt.BELOW}:{top:R-y-l-8,aboveOrBelow:dt.ABOVE}}const b=H();return{left:O(),top:b.top,aboveOrBelow:b.aboveOrBelow,toolbarSize:c}},[o,r]),i=x.useCallback(()=>r()?.dom??null,[r]),a=[{label:t.formatMessage(Q.heading1),className:"text-5xl font-semibold",onClick:()=>{_.logButtonClick(ne.TOOLBAR_FORMAT_HEADER1),_e(r(),1)}},{label:t.formatMessage(Q.heading2),className:"text-3xl font-semibold",onClick:()=>{_.logButtonClick(ne.TOOLBAR_FORMAT_HEADER2),_e(r(),2)}},{label:t.formatMessage(Q.heading3),className:"text-2xl font-semibold",onClick:()=>{_.logButtonClick(ne.TOOLBAR_FORMAT_HEADER3),_e(r(),3)}},{label:t.formatMessage(Q.body),className:"text-base",onClick:()=>{_.logButtonClick(ne.TOOLBAR_FORMAT_PARAGRAPH),vi(r())}}];return g.jsxs(dn,{isWaitingForCommentResponse:e,onAddComment:n,toolbarType:pn.WRITING,getToolbarPosition:s,getEditorDom:i,getSelectionRange:()=>{const c=r();if(!c)return null;const{state:u}=c,{from:l,to:d,sourceFrom:m,sourceTo:h}=bn(u);return l==null||d==null||m==null||h==null?(_.logError("Prosemirror getSelectionRange has null values",null,{from:l,to:d,sourceFrom:m,sourceTo:h}),null):{from:l,to:d,sourceFrom:m,sourceTo:h}},children:[g.jsx(ye.Separator,{}),g.jsx(ye.Action,{label:t.formatMessage(Q.bold),hideLabel:!0,icon:po,onClick:()=>{_.logButtonClick(ne.TOOLBAR_FORMAT_BOLD),Kt(r(),Mr.proseMirrorMarkName())},onMouseDown:c=>c.preventDefault()}),g.jsx(ye.Action,{label:t.formatMessage(Q.italic),hideLabel:!0,icon:ho,onClick:()=>{_.logButtonClick(ne.TOOLBAR_FORMAT_ITALIC),Kt(r(),wr.proseMirrorMarkName())},onMouseDown:c=>c.preventDefault()}),g.jsx(ye.Popover,{label:t.formatMessage(Q.textStyle),hideLabel:!0,icon:fo,children:g.jsx("div",{className:$("flex flex-col items-stretch rounded-xl bg-token-main-surface-primary",Wn),children:a.map(({label:c,className:u,onClick:l})=>g.jsx("button",{onClick:l,className:"w-full rounded-xl p-4 text-start hover:bg-token-main-surface-secondary",children:g.jsx("div",{className:u,children:c})},c))})})]})},Q=We({bold:{id:"qqbk91",defaultMessage:"Bold"},italic:{id:"5oh4LV",defaultMessage:"Italic"},textStyle:{id:"+SV1Ro",defaultMessage:"Text style"},heading1:{id:"AR5o30",defaultMessage:"Heading 1"},heading2:{id:"zb/wrc",defaultMessage:"Heading 2"},heading3:{id:"xZJvLM",defaultMessage:"Heading 3"},body:{id:"Hi6z3L",defaultMessage:"Body"},caption:{id:"VXpL7v",defaultMessage:"Caption"}});function Wt({position:n,numEdits:e,closestEditId:t,scrollTopBound:r}){const o=Qe(),s=Ge(),i=n==="top"?mo:go,a=()=>{const l=o();if(!l||!t)return;const d=Cr(l,t);if(d.length===0){Hr.addError("Edit could not be found while attempting to scroll",{closestEditId:t});return}d[n==="top"?0:d.length-1].scrollIntoView({behavior:"smooth",block:"center"})},c=n==="top"?-4:4,u=r+20;return g.jsx(Se,{children:e>0&&g.jsx(se.div,{className:$("fixed left-1/2 z-20 select-none",{"bottom-[20px]":n==="bottom",[`top-[${u}px]`]:n==="top"}),initial:{scale:.95,translateY:c,translateX:"-50%",opacity:0},animate:{scale:1,translateY:0,translateX:"-50%",opacity:1},exit:{scale:.95,translateY:c,translateX:"-50%",opacity:0},transition:{type:"spring",duration:.3},children:g.jsxs("div",{className:$("flex items-center justify-center rounded-full border px-4 py-2","border-token-main-surface-tertiary bg-token-main-surface-primary shadow-md hover:bg-token-main-surface-secondary"),"aria-label":s.formatMessage(Gt.ariaLabel),role:"button",onClick:a,children:[g.jsx(jr,{...Gt.label,values:{count:e}}),g.jsx(i,{className:"icon-sm ml-2"})]})})})}const Gt=We({label:{id:"Pf30w4",defaultMessage:"{count, plural, one {1 more edit} other {{count} more edits}}"},ariaLabel:{id:"qTJjzl",defaultMessage:"Button to scroll the next edit into view."}});function Ri(n){let e=n;for(;e;){const r=window.getComputedStyle(e).overflowY;if(r==="auto"||r==="scroll")return e;e=e.parentElement}return null}function Ii(n,e){const t=Qe(),r=Gn();x.useEffect(()=>{const s=t()?.dom;if(!s||!r||n.length===0)return;const i=()=>{const{textdocId:l,history:d}=r;d?Yn(l,d):qn(l)},a=Ri(s),c=l=>{l.key==="Escape"&&i()},u=Xn(e,100);return window.document.addEventListener("keydown",c,{passive:!0}),a&&a.addEventListener("scroll",u,{passive:!0}),()=>{window.document.removeEventListener("keydown",c),a&&a.removeEventListener("scroll",u),u.cancel()}},[t,r,n,e])}function Bi({diff:n=null,canvasContentRect:e}){const t=Qe(),[r,o]=x.useState([]),[s,i]=x.useState([]),a=e?.top??0,c=e?.bottom??window.innerHeight,u=x.useCallback(()=>{const l=t();if(!l||!n)return;const d=[],m=[];for(const h of n.edits){const p=ti(l,h.id);if(p.length>0){const f=Pr(p);f.bottom<a?d.push([h.id,f]):f.top>c&&m.push([h.id,f])}}d.sort(([,h],[,p])=>h.bottom-p.bottom),m.sort(([,h],[,p])=>h.top-p.top),o(d.map(([h])=>h)),i(m.map(([h])=>h))},[n,t,a,c]);return Ii(n?.edits??[],u),x.useEffect(()=>{const l=setTimeout(u,500);return()=>{clearTimeout(l)}},[u]),g.jsxs(g.Fragment,{children:[g.jsx(Wt,{position:"top",numEdits:r.length,closestEditId:r[r.length-1],scrollTopBound:a}),g.jsx(Wt,{position:"bottom",numEdits:s.length,closestEditId:s[0],scrollTopBound:a})]})}const Xt=zr(()=>({rejectedEdits:new Set,hoveredEditId:null})),Oi=({pos:n})=>{const e=Ze()(),t=or();if(!e||!t||n==null)return null;const{doc:r}=t,{top:o,left:s}=e.coordsAtPos(0),{top:i,left:a}=e.coordsAtPos(n),c=r.nodeAt(n),u=n+(c?.nodeSize??0)-1,{top:l}=e.coordsAtPos(n+1),{top:d,bottom:m,right:h}=e.coordsAtPos(u),f=(l>=d?h:e.dom.getBoundingClientRect().right)-a,k=m-i+4;return g.jsx(se.div,{style:{top:i-o,left:a-s,height:k,width:f},className:$("absolute after:absolute after:inset-x-[-4px] after:inset-y-0 after:z-0 after:rounded-md after:bg-[Highlight] after:content-[''] dark:after:bg-[Highlight]",lr.blockCommentHover),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}})},Li=({pos:n})=>g.jsx(Se,{children:n!=null&&g.jsx(Oi,{pos:n})}),Di={type:"spring",bounce:.12,duration:.64},Ve=24,_i=8,da=({comments:n,diff:e,readonlyReason:t,isDisabled:r=!1,isRewriting:o=!1,isAnimatingFromPreview:s=!1,previousComments:i,previousValue:a,isPreview:c=!1,isRequestActive:u=!1,isWaitingForCommentResponse:l=!1,targetedContent:d=null,canvasContentRect:m,getStableCommentId:h=Fr,onBlur:p,onCancelRequest:f,onChange:k,onSave:w,onAddComment:y,onSubmitAccelerator:N,onAcceptComment:M,onDismissComment:C,value:P,commentsMode:S=De.ENABLED,hideAccelerators:R=!1,hideToolbar:B=!1,hideEditOverlay:O=!1,safeUrls:H,width:b,modelCursor:I,shouldResetSelection:D})=>{const T=x.useRef(null),q=x.useRef(null);xi(q,T);const[{width:Be},Oe]=cr(),te=x.useRef(null),[le,ue]=x.useState(!1),de=te.current,pe=hn(de)??!1,ke=(()=>{if(b==null){const L=pe?0:pt();return Be-L}return b-bt*2-pt()})(),re=ke>=Et+Zn?Et:Qn,we=ke-re,E=xe(({commentingOn:L})=>L),v=xe(({hoveredCommentId:L})=>L),F=xe(({focusedCommentId:L})=>L),Y=xe(({hoveredBlockCommentLauncherPos:L})=>L),Ne=Xt(L=>L.hoveredEditId),Le=Xt(L=>L.rejectedEdits);x.useEffect(()=>{d==null&&T.current?.revertChanges()},[d]),x.useEffect(()=>{T.current?.flushChanges(),T.current?.UNSAFE_setValue(P)},[P]);const Or=$r.useState(({windowHeight:L})=>{if(c)return Ve;const Lr=_i/100*L;return Math.max(Ve,Lr)}),ct="max(3rem,24vh)";return g.jsx("div",{className:"h-full w-full",ref:q,children:g.jsx(se.div,{className:Jn.document,style:{margin:`0 ${bt}px`},initial:s?{paddingTop:Ve}:!1,animate:{paddingTop:Or},transition:Di,children:g.jsx("div",{ref:Je(Oe,te),className:"z-0 flex w-full flex-col items-center",children:g.jsxs(he,{comments:n,diff:e,editorRef:T,hoveredCommentId:v,focusedCommentId:F,hoveredEditId:Ne,rejectedEdits:Le,value:P,commentingOn:E,isDisabled:r,readonlyReason:t,onBlur:p,onChange:k,onSave:w,width:re,safeUrls:H,wrapperClassName:"relative z-10 flex max-w-full h-fit",paddingBottom:ct,modelCursor:I,shouldResetSelection:D,transparentBackground:!le,children:[g.jsxs(he.EditorChildren,{children:[g.jsx(Se,{onExitComplete:()=>ue(!1),children:o&&g.jsx(Ti,{isRewriting:o,documentWidth:re,previousValue:a,previousComments:i,value:P,paddingBottom:ct,onStart:()=>ue(!0)})}),!B&&g.jsx(Ai,{isWaitingForCommentResponse:l,onAddComment:y}),S===De.ENABLED&&g.jsx(Li,{pos:Y}),g.jsx(Se,{children:S!==De.ALL_HIDDEN&&g.jsx(fn,{availableWidth:we,comments:n,commentsMode:S,isRequestActive:u,onAddComment:y,onAcceptComment:M,onDismissComment:C,isWaitingForCommentResponse:l,disableBlockComments:u,getStableCommentId:h})}),!O&&g.jsx(Bi,{diff:e,canvasContentRect:m})]}),g.jsx(he.ContextChildren,{children:!R&&g.jsx(En,{isRequestActive:u,onSubmit:N,readonlyReason:t,actions:Mo,onCancel:f})})]})})})})};export{da as DocumentComposer};
//# sourceMappingURL=dqa1f46gkqyn4i0u.js.map
