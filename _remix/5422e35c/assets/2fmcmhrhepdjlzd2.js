import{r as c,aL as FA,bH as YA,a as OA,aI as he,cT as L,g as CA,W as J,l as o,dP as pe,Z as fe,X as GA,be as LA,m as nA,b0 as P,D as ve,bY as tA,am as Ce,cZ as be,fw as xe,fx as ke,aw as Ee,c$ as Ie,b3 as Se}from"./cy64emva2uzrk485.js";import{bM as Be,o as Me,b as we,bN as ye,bO as Qe,bP as De,bQ as Ve,ae as je,bR as Te,d as MA,bS as Re,W as Ze,bl as Ne,Q as Fe,bT as Ye,z as Oe}from"./m1w0e9mshx1kxsyq.js";import{au as JA,aJ as wA,ka as XA,kb as Ge,c as Le,kc as Je,ag as N,a1 as Xe,kd as We,ke as Ue,N as Pe}from"./j735z7kkcepyp8y2.js";import{d as V,e as iA,f as cA,R as oA,g as U,b,h as M,c as I,I as qe,i as j,j as W,r as _e,L as He,k as Ke,l as D,m as WA,n as UA,a as PA,C as qA,u as ze,o as rA,T as bA,p as _A,q as HA,s as $e,P as At,t as yA,v as QA,V as et,E as tt,w as ot,x as nt,y as at}from"./k381peh5rfno1abt.js";import{q as KA}from"./ehuratfqdza89wob.js";import{r as st}from"./m9bhi499hm1n51b7.js";import{f as it}from"./l9ljdfvuq5zywldm.js";import{l as zA,d as q,T as DA,a as $A,m as ct}from"./cknnke94em4nivg3.js";import{r as xA,A as aA}from"./n3h0t5brbjpa342f.js";import{m as S}from"./dzgqww1rafiwckp5.js";import{G as rt,W as lt}from"./mkx55htxkx0nf0yd.js";import{B as dt,D as ut}from"./kxb6j537cf0vxln8.js";import{_ as mt}from"./hpp947n5rplbu58l.js";import"./ehb75ilhui1076ee.js";import"./f4bade4g0o45i4rd.js";import"./deovd2qhauetjiwg.js";import"./m8uv83e8qsvk5cah.js";import"./l1lmxzbhhle72h3t.js";import"./dywbkbifr0ayki46.js";import"./qxsj1l42erkbuwc6.js";import"./maooj5f1lintbuj4.js";import"./mbh3dou1gcx9ziuu.js";import"./nzhmuw3i6t164b6h.js";import"./ijh2y7o5pzxbifv5.js";import"./i7y30xwqnlt1hc97.js";import"./j0t5pu2pmnlemvhv.js";import"./f99zq3s8pqk4thnl.js";import"./oad20zxhutmy394e.js";import"./idj1um47tb8f15nx.js";import"./o6f018keuxci0i7r.js";import"./frb09mevmcqzi83z.js";import"./nw2yfjqvd35ue7qh.js";import"./goworgaz3i320d7w.js";import"./h6c0bohmhdn61j1a.js";import"./kjeuhdqpq8p6604r.js";import"./dasfo2l8kg52ax2s.js";import"./osybsbcp4gj3qmjs.js";import"./kn3xnf076tvydluu.js";import"./hor9pfpmgngfbiws.js";function gt(){pt(),ft(),vt(),ht()}function ht(){const{room:e,debug:A}=V();c.useEffect(()=>{async function t(){Promise.all(["audioinput","audiooutput","videoinput"].map(async n=>{const a=await oA.getLocalDevices(n),s=e?.getActiveDevice(n);if(!a.find(r=>r.deviceId===s)){const r=await U(n);let l=null;r?l=r.deviceId:a[0]&&(l=a[0].deviceId),A(`switching ${n} to ${l}`),l&&await e?.switchActiveDevice(n,l)}}))}if(navigator)return navigator.mediaDevices.addEventListener("devicechange",t),()=>{navigator.mediaDevices.removeEventListener("devicechange",t)}},[e,A])}function pt(){const{room:e,debug:A}=V(),t=e?.getActiveDevice("audioinput"),n=e?.getActiveDevice("audiooutput");c.useEffect(()=>{async function a(){const s=(await U("audioinput"))?.deviceId,i=(await U("audiooutput"))?.deviceId,r=async()=>{s&&t!==s&&(A("switching audio input to default"),await e?.switchActiveDevice("audioinput",s))},l=async()=>{if(i&&n!==i){A("switching audio output to default");try{await e?.switchActiveDevice("audiooutput",i)}catch(u){A("failed to switch audio output",u)}}};await Promise.all([r(),l()])}a()},[t,n,A,e])}function ft(){const{isVideoEnabled:e,endStartingVideo:A}=iA(),{room:t,debug:n}=V(),a=t?.getActiveDevice("videoinput");c.useEffect(()=>{async function s(){if(e)try{await t?.localParticipant.setCameraEnabled(!0),A(!0)}catch{A(!1)}else await t?.localParticipant.setCameraEnabled(!1)}t&&s()},[e,A,t]),c.useEffect(()=>{async function s(){const i=(await U("videoinput"))?.deviceId;await(async()=>{i&&a!==i&&(n("switching video input to default"),await t?.switchActiveDevice("videoinput",i))})()}s()},[a,n,t])}function vt(){const{room:e}=V(),{isScreenshareEnabled:A,endStartingScreenshare:t}=cA();c.useEffect(()=>{async function n(){if(A)try{await e?.localParticipant.setScreenShareEnabled(!0,{video:{displaySurface:"monitor"}}),t(!0)}catch{t(!1)}else await e?.localParticipant.setScreenShareEnabled(!1)}e&&n()},[e,A,t])}function Ae(){const{debug:e}=V(),A=b(n=>n.conversationId),t=FA();return c.useCallback(async n=>{const a=n,s=A&&!zA(A)?A:void 0,i=a??s;if(i){e(`refetch conversationId ${i}`);try{await it(i,!0)}catch(r){const l="Failed to update conversation";e(l,r),t.danger(l)}}},[A,e,t])}const Ct=5e3,bt=2e3,lA=e=>{const{room:A}=V(),t=b(g=>g.disconnectPending),n=b(g=>g.server.remoteState===M.Speaking),a=b(g=>g.conversationId)??void 0,s=q(a),i=c.useRef(!1),r=Ae(),l=YA(),u=OA();i.current=n||i.current;const m=c.useCallback(async g=>{clearTimeout(t),I.setState(v=>{v.disconnectPending=void 0}),A?.disconnect(),await r(s),I.setState(qe);const p=s??g;p&&KA(l,u,p),e?.refetchLater&&window.setTimeout(()=>{r(s)},bt)},[t,A,r,s,e?.refetchLater,l,u]),d=i.current&&!s,h=c.useCallback(()=>{I.setState(g=>{g.disconnectPending=window.setTimeout(m,Ct)})},[m]);return{disconnectPending:t!==void 0,shouldDelayDisconnect:d,delayDisconnect:h,immediateDisconnect:m}};function xt(){const e=OA(),{room:A,debug:t,decoder:n}=V(),{disconnectPending:a,immediateDisconnect:s}=lA(),i=Ae(),r=YA(),l=c.useRef(!1);c.useEffect(()=>{const u=async x=>{const{new_state:f}=x;I.setState(k=>{k.server.remoteState=f})},m=async x=>{I.setState(f=>{f.server.usage=x})},d=async x=>{I.setState(f=>{f.server.toolUpdate={...x}})},h=async x=>{let f;try{f=JSON.parse(n.decode(x)),t("data recevied",f)}catch(k){t("error parsing data",k);return}switch(I.setState(k=>(k.server.messages.push({...f,timestamp:new Date,source:"remote"}),k)),f.type){case W.StateUpdate:t("state update",f.payload);const{new_state:k,delay_s:B}=f.payload;if(k===M.Listening&&!l.current){l.current=!0,performance.mark("voice_mode.end");const E=performance.measure("voice_mode","voice_mode.start","voice_mode.end").duration.toFixed(0);L.voiceMode.connect({durationMs:E})}k===M.Thinking&&B&&(t(`${A?.name} delay thinking state by ${B} seconds`),u({new_state:M.ListeningIntently,delay_s:B}),await new Promise(E=>setTimeout(E,B*1e3))),u(f.payload);break;case W.ConversationUpdate:{t("conversation update",f.payload);const E=I.getState().conversationId,{conversation_id:y}=f.payload;E&&zA(E)&&(DA.initThread(E,{kind:he.PrimaryAssistant}),DA.setServerIdForNewThread(E,y),I.setState(w=>{w.conversationId=y}),KA(JA,e,y),st(e)),await i(y),a&&s(y);break}case W.UsageUpdate:m(f.payload);break;case W.ToolUpdate:d(f.payload);break}},g=(x,f)=>{t("track published",x,f)},p=()=>{t("disconnected"),_e()},v=(x,f)=>{f instanceof He&&(t(`Connection quality changed for participant ${f.identity}: ${x}`),I.setState(k=>{k.server.voiceConnectionQuality=x}))};return A?.on(j.DataReceived,h),A?.on(j.TrackPublished,g),A?.on(j.ConnectionQualityChanged,v),A?.on(j.Disconnected,p),()=>{A?.off(j.DataReceived,h),A?.off(j.TrackPublished,g),A?.off(j.ConnectionQualityChanged,v),A?.off(j.Disconnected,p)}},[e,A,i,t,n,r,a,s])}function kt(){Et(),It(),St(),Bt()}function Et(){const{room:e}=V();c.useEffect(()=>{I.setState(A=>{A.dev.room=e})},[e])}function It(){const{room:e}=V(),A=Ke(e);c.useEffect(()=>{I.setState(t=>{t.server.connectionState=A})},[A])}function St(){const{room:e,debug:A,encoder:t}=V();c.useEffect(()=>{const n=!!I.getState().server.actions;if(e&&!n){const a=async s=>{A("publishing action",s);const i={type:W.ActionRequest,payload:{action:s}};await e.localParticipant.publishData(t.encode(JSON.stringify(i)),{reliable:!0}),I.setState(r=>{r.server.messages.push({...i,timestamp:new Date,source:"local"})})};I.setState(s=>{s.server.actions={[D.StartListeningIntently]:()=>a(D.StartListeningIntently),[D.StopListeningIntently]:()=>a(D.StopListeningIntently),[D.HaltAllActivity]:()=>a(D.HaltAllActivity),[D.ResumeListening]:()=>a(D.ResumeListening),[D.RelayMessage]:()=>a(D.RelayMessage)}})}},[e,A,t])}function Bt(){const e=I(A=>A.isVoiceModeActive);c.useEffect(()=>(wA.setState({isVoiceActive:e}),()=>{wA.setState({isVoiceActive:!1})}),[e])}const Mt=c.memo(function(){return xt(),kt(),gt(),null});var wt={webm:"data:video/webm;base64,GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4EEQoWBAhhTgGcBAAAAAAAVkhFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsghV17AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU1LjMzLjEwMFdBjUxhdmY1NS4zMy4xMDBzpJBlrrXf3DCDVB8KcgbMpcr+RImIQJBgAAAAAAAWVK5rAQAAAAAAD++uAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDiDgQEj44OEAmJaAOABAAAAAAAABrCBsLqBkK4BAAAAAAAPq9eBAnPFgQKcgQAitZyDdW5khohBX1ZPUkJJU4OBAuEBAAAAAAAAEZ+BArWIQOdwAAAAAABiZIEgY6JPbwIeVgF2b3JiaXMAAAAAAoC7AAAAAAAAgLUBAAAAAAC4AQN2b3JiaXMtAAAAWGlwaC5PcmcgbGliVm9yYmlzIEkgMjAxMDExMDEgKFNjaGF1ZmVudWdnZXQpAQAAABUAAABlbmNvZGVyPUxhdmM1NS41Mi4xMDIBBXZvcmJpcyVCQ1YBAEAAACRzGCpGpXMWhBAaQlAZ4xxCzmvsGUJMEYIcMkxbyyVzkCGkoEKIWyiB0JBVAABAAACHQXgUhIpBCCGEJT1YkoMnPQghhIg5eBSEaUEIIYQQQgghhBBCCCGERTlokoMnQQgdhOMwOAyD5Tj4HIRFOVgQgydB6CCED0K4moOsOQghhCQ1SFCDBjnoHITCLCiKgsQwuBaEBDUojILkMMjUgwtCiJqDSTX4GoRnQXgWhGlBCCGEJEFIkIMGQcgYhEZBWJKDBjm4FITLQagahCo5CB+EIDRkFQCQAACgoiiKoigKEBqyCgDIAAAQQFEUx3EcyZEcybEcCwgNWQUAAAEACAAAoEiKpEiO5EiSJFmSJVmSJVmS5omqLMuyLMuyLMsyEBqyCgBIAABQUQxFcRQHCA1ZBQBkAAAIoDiKpViKpWiK54iOCISGrAIAgAAABAAAEDRDUzxHlETPVFXXtm3btm3btm3btm3btm1blmUZCA1ZBQBAAAAQ0mlmqQaIMAMZBkJDVgEACAAAgBGKMMSA0JBVAABAAACAGEoOogmtOd+c46BZDppKsTkdnEi1eZKbirk555xzzsnmnDHOOeecopxZDJoJrTnnnMSgWQqaCa0555wnsXnQmiqtOeeccc7pYJwRxjnnnCateZCajbU555wFrWmOmkuxOeecSLl5UptLtTnnnHPOOeecc84555zqxekcnBPOOeecqL25lpvQxTnnnE/G6d6cEM4555xzzjnnnHPOOeecIDRkFQAABABAEIaNYdwpCNLnaCBGEWIaMulB9+gwCRqDnELq0ehopJQ6CCWVcVJKJwgNWQUAAAIAQAghhRRSSCGFFFJIIYUUYoghhhhyyimnoIJKKqmooowyyyyzzDLLLLPMOuyssw47DDHEEEMrrcRSU2011lhr7jnnmoO0VlprrbVSSimllFIKQkNWAQAgAAAEQgYZZJBRSCGFFGKIKaeccgoqqIDQkFUAACAAgAAAAABP8hzRER3RER3RER3RER3R8RzPESVREiVREi3TMjXTU0VVdWXXlnVZt31b2IVd933d933d+HVhWJZlWZZlWZZlWZZlWZZlWZYgNGQVAAACAAAghBBCSCGFFFJIKcYYc8w56CSUEAgNWQUAAAIACAAAAHAUR3EcyZEcSbIkS9IkzdIsT/M0TxM9URRF0zRV0RVdUTdtUTZl0zVdUzZdVVZtV5ZtW7Z125dl2/d93/d93/d93/d93/d9XQdCQ1YBABIAADqSIymSIimS4ziOJElAaMgqAEAGAEAAAIriKI7jOJIkSZIlaZJneZaomZrpmZ4qqkBoyCoAABAAQAAAAAAAAIqmeIqpeIqoeI7oiJJomZaoqZoryqbsuq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq4LhIasAgAkAAB0JEdyJEdSJEVSJEdygNCQVQCADACAAAAcwzEkRXIsy9I0T/M0TxM90RM901NFV3SB0JBVAAAgAIAAAAAAAAAMybAUy9EcTRIl1VItVVMt1VJF1VNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVN0zRNEwgNWQkAkAEAkBBTLS3GmgmLJGLSaqugYwxS7KWxSCpntbfKMYUYtV4ah5RREHupJGOKQcwtpNApJq3WVEKFFKSYYyoVUg5SIDRkhQAQmgHgcBxAsixAsiwAAAAAAAAAkDQN0DwPsDQPAAAAAAAAACRNAyxPAzTPAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAA0DwP8DwR8EQRAAAAAAAAACzPAzTRAzxRBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAAsDwP8EQR0DwRAAAAAAAAACzPAzxRBDzRAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAEOAAABBgIRQasiIAiBMAcEgSJAmSBM0DSJYFTYOmwTQBkmVB06BpME0AAAAAAAAAAAAAJE2DpkHTIIoASdOgadA0iCIAAAAAAAAAAAAAkqZB06BpEEWApGnQNGgaRBEAAAAAAAAAAAAAzzQhihBFmCbAM02IIkQRpgkAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAGHAAAAgwoQwUGrIiAIgTAHA4imUBAIDjOJYFAACO41gWAABYliWKAABgWZooAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAYcAAACDChDBQashIAiAIAcCiKZQHHsSzgOJYFJMmyAJYF0DyApgFEEQAIAAAocAAACLBBU2JxgEJDVgIAUQAABsWxLE0TRZKkaZoniiRJ0zxPFGma53meacLzPM80IYqiaJoQRVE0TZimaaoqME1VFQAAUOAAABBgg6bE4gCFhqwEAEICAByKYlma5nmeJ4qmqZokSdM8TxRF0TRNU1VJkqZ5niiKommapqqyLE3zPFEURdNUVVWFpnmeKIqiaaqq6sLzPE8URdE0VdV14XmeJ4qiaJqq6roQRVE0TdNUTVV1XSCKpmmaqqqqrgtETxRNU1Vd13WB54miaaqqq7ouEE3TVFVVdV1ZBpimaaqq68oyQFVV1XVdV5YBqqqqruu6sgxQVdd1XVmWZQCu67qyLMsCAAAOHAAAAoygk4wqi7DRhAsPQKEhKwKAKAAAwBimFFPKMCYhpBAaxiSEFEImJaXSUqogpFJSKRWEVEoqJaOUUmopVRBSKamUCkIqJZVSAADYgQMA2IGFUGjISgAgDwCAMEYpxhhzTiKkFGPOOScRUoox55yTSjHmnHPOSSkZc8w556SUzjnnnHNSSuacc845KaVzzjnnnJRSSuecc05KKSWEzkEnpZTSOeecEwAAVOAAABBgo8jmBCNBhYasBABSAQAMjmNZmuZ5omialiRpmud5niiapiZJmuZ5nieKqsnzPE8URdE0VZXneZ4oiqJpqirXFUXTNE1VVV2yLIqmaZqq6rowTdNUVdd1XZimaaqq67oubFtVVdV1ZRm2raqq6rqyDFzXdWXZloEsu67s2rIAAPAEBwCgAhtWRzgpGgssNGQlAJABAEAYg5BCCCFlEEIKIYSUUggJAAAYcAAACDChDBQashIASAUAAIyx1lprrbXWQGettdZaa62AzFprrbXWWmuttdZaa6211lJrrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmstpZRSSimllFJKKaWUUkoppZRSSgUA+lU4APg/2LA6wknRWGChISsBgHAAAMAYpRhzDEIppVQIMeacdFRai7FCiDHnJKTUWmzFc85BKCGV1mIsnnMOQikpxVZjUSmEUlJKLbZYi0qho5JSSq3VWIwxqaTWWoutxmKMSSm01FqLMRYjbE2ptdhqq7EYY2sqLbQYY4zFCF9kbC2m2moNxggjWywt1VprMMYY3VuLpbaaizE++NpSLDHWXAAAd4MDAESCjTOsJJ0VjgYXGrISAAgJACAQUooxxhhzzjnnpFKMOeaccw5CCKFUijHGnHMOQgghlIwx5pxzEEIIIYRSSsaccxBCCCGEkFLqnHMQQgghhBBKKZ1zDkIIIYQQQimlgxBCCCGEEEoopaQUQgghhBBCCKmklEIIIYRSQighlZRSCCGEEEIpJaSUUgohhFJCCKGElFJKKYUQQgillJJSSimlEkoJJYQSUikppRRKCCGUUkpKKaVUSgmhhBJKKSWllFJKIYQQSikFAAAcOAAABBhBJxlVFmGjCRcegEJDVgIAZAAAkKKUUiktRYIipRikGEtGFXNQWoqocgxSzalSziDmJJaIMYSUk1Qy5hRCDELqHHVMKQYtlRhCxhik2HJLoXMOAAAAQQCAgJAAAAMEBTMAwOAA4XMQdAIERxsAgCBEZohEw0JweFAJEBFTAUBigkIuAFRYXKRdXECXAS7o4q4DIQQhCEEsDqCABByccMMTb3jCDU7QKSp1IAAAAAAADADwAACQXAAREdHMYWRobHB0eHyAhIiMkAgAAAAAABcAfAAAJCVAREQ0cxgZGhscHR4fICEiIyQBAIAAAgAAAAAggAAEBAQAAAAAAAIAAAAEBB9DtnUBAAAAAAAEPueBAKOFggAAgACjzoEAA4BwBwCdASqwAJAAAEcIhYWIhYSIAgIABhwJ7kPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99YAD+/6tQgKOFggADgAqjhYIAD4AOo4WCACSADqOZgQArADECAAEQEAAYABhYL/QACIBDmAYAAKOFggA6gA6jhYIAT4AOo5mBAFMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAGSADqOFggB6gA6jmYEAewAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAj4AOo5mBAKMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAKSADqOFggC6gA6jmYEAywAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAz4AOo4WCAOSADqOZgQDzADECAAEQEAAYABhYL/QACIBDmAYAAKOFggD6gA6jhYIBD4AOo5iBARsAEQIAARAQFGAAYWC/0AAiAQ5gGACjhYIBJIAOo4WCATqADqOZgQFDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggFPgA6jhYIBZIAOo5mBAWsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAXqADqOFggGPgA6jmYEBkwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIBpIAOo4WCAbqADqOZgQG7ADECAAEQEAAYABhYL/QACIBDmAYAAKOFggHPgA6jmYEB4wAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIB5IAOo4WCAfqADqOZgQILADECAAEQEAAYABhYL/QACIBDmAYAAKOFggIPgA6jhYICJIAOo5mBAjMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAjqADqOFggJPgA6jmYECWwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYICZIAOo4WCAnqADqOZgQKDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggKPgA6jhYICpIAOo5mBAqsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCArqADqOFggLPgA6jmIEC0wARAgABEBAUYABhYL/QACIBDmAYAKOFggLkgA6jhYIC+oAOo5mBAvsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAw+ADqOZgQMjADECAAEQEAAYABhYL/QACIBDmAYAAKOFggMkgA6jhYIDOoAOo5mBA0sAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA0+ADqOFggNkgA6jmYEDcwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIDeoAOo4WCA4+ADqOZgQObADECAAEQEAAYABhYL/QACIBDmAYAAKOFggOkgA6jhYIDuoAOo5mBA8MAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA8+ADqOFggPkgA6jhYID+oAOo4WCBA+ADhxTu2sBAAAAAAAAEbuPs4EDt4r3gQHxghEr8IEK",mp4:"data:video/mp4;base64,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"};const{webm:yt,mp4:Qt}=wt,hA=()=>typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,pA=()=>"wakeLock"in navigator;class Dt{constructor(){if(this.enabled=!1,pA()){this._wakeLock=null;const A=()=>{this._wakeLock!==null&&document.visibilityState==="visible"&&this.enable()};document.addEventListener("visibilitychange",A),document.addEventListener("fullscreenchange",A)}else hA()?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("title","No Sleep"),this.noSleepVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.noSleepVideo,"webm",yt),this._addSourceToVideo(this.noSleepVideo,"mp4",Qt),this.noSleepVideo.addEventListener("loadedmetadata",()=>{this.noSleepVideo.duration<=1?this.noSleepVideo.setAttribute("loop",""):this.noSleepVideo.addEventListener("timeupdate",()=>{this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())})}))}_addSourceToVideo(A,t,n){var a=document.createElement("source");a.src=n,a.type=`video/${t}`,A.appendChild(a)}get isEnabled(){return this.enabled}enable(){return pA()?navigator.wakeLock.request("screen").then(A=>{this._wakeLock=A,this.enabled=!0,console.log("Wake Lock active."),this._wakeLock.addEventListener("release",()=>{console.log("Wake Lock released.")})}).catch(A=>{throw this.enabled=!1,console.error(`${A.name}, ${A.message}`),A}):hA()?(this.disable(),console.warn(`
        NoSleep enabled for older iOS devices. This can interrupt
        active or long-running network requests from completing successfully.
        See https://github.com/richtr/NoSleep.js/issues/15 for more details.
      `),this.noSleepTimer=window.setInterval(()=>{document.hidden||(window.location.href=window.location.href.split("#")[0],window.setTimeout(window.stop,0))},15e3),this.enabled=!0,Promise.resolve()):this.noSleepVideo.play().then(t=>(this.enabled=!0,t)).catch(t=>{throw this.enabled=!1,t})}disable(){pA()?(this._wakeLock&&this._wakeLock.release(),this._wakeLock=null):hA()?this.noSleepTimer&&(console.warn(`
          NoSleep now disabled for older iOS devices.
        `),window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause(),this.enabled=!1}}var Vt=Dt;const jt=CA(Vt);function Tt(){const{shouldDelayDisconnect:e,delayDisconnect:A,immediateDisconnect:t}=lA({refetchLater:!0}),{toggleMute:n}=WA();return c.useCallback(async()=>{L.exitVoiceState.click(),e?(await n(),A()):t()},[A,t,e,n])}function Rt(e){const A=e.default_voice_mode,t=e.modes.find(n=>n.mode===A);if(!t)throw new Error("Voice status returned a default_voice_mode that does not exist in the modes array");return t.default_model_slug}function kA(){const e=J(),A=FA(),{startVoiceMode:t,stopVoiceMode:n,isConnected:a,isVoiceModeActive:s}=UA(),i=c.useCallback(async r=>{const l={conversation_id:r.serverThreadId,parent_message_id:r.parentMessageId,model_slug:r.modelSlug,model_slug_advanced:r.isAdvancedMode?r.modelSlug:void 0,voice_mode:r.isAdvancedMode?"advanced":"standard",eventSource:r.eventSource,clientThreadId:r.clientThreadId},u=e.formatMessage({id:"useVoiceModeButtonAction.error",defaultMessage:"Failed to start voice mode"});try{await t(l)}catch{if(r.isAdvancedMode&&r.retryWithStandard)try{await t({...l,voice_mode:"standard"})}catch{A.danger(u),L.voiceMode.error({error:u})}else A.danger(u),L.voiceMode.error({error:u})}},[e,t,A]);return{isVoiceModeActive:s,isConnected:a,toggleVoiceMode:i,stopVoiceMode:n}}function Zt(e){const{button:A,conversationId:t,modelId:n,onClick:a}=e,s=q(t),i=xA(t),r=A.action==="new_chat"?i:n,{toggleVoiceMode:l}=kA(),u=c.useCallback(()=>{switch(A.action){case"new_chat":{const m=r??aA;JA(`/?model=${m}`),l({serverThreadId:void 0,modelSlug:m,isAdvancedMode:!0,eventSource:`modal_${A.action}`,parentMessageId:void 0,retryWithStandard:!1,clientThreadId:pe()});break}case"switch_to_standard":s&&n&&l({serverThreadId:s,modelSlug:r??aA,isAdvancedMode:!1,eventSource:`modal_${A.action}`,parentMessageId:void 0,retryWithStandard:!1,clientThreadId:s});break;case"ok":break;default:return}a?.()},[A.action,r,n,a,s,l]);return o.jsx(fe.Button,{onClick:u,title:A.title,color:e.color})}function ee({buttons:e,conversationId:A,modelId:t,onClick:n}){let a,s;return!e||e.length===0?{primary:void 0,secondary:void 0}:(e.forEach(i=>{const r=i.action==="new_chat",l=i.action==="switch_to_standard",u=r&&A,m=l&&A&&t,d=o.jsx(Zt,{button:i,conversationId:A,modelId:t,onClick:n,color:i.style});(u||m||i.action==="ok")&&(a?s||(s=d):a=d)}),{primary:a,secondary:s})}function Nt({conversationId:e,modelId:A,isOpen:t,onClose:n,buttons:a,title:s,description_markdown:i}){const r=ee({buttons:a,conversationId:e,modelId:A,onClick:n}),l=o.jsx(XA,{children:i});return o.jsx(GA,{title:s,isOpen:t,onClose:n,size:"custom",className:"max-w-[550px]",type:"warning",showCloseButton:!0,children:o.jsxs("div",{className:"w-full",children:[o.jsx("p",{className:"mb-6 text-token-text-secondary",children:l}),o.jsx("div",{className:"flex justify-end",children:r.primary})]})})}const Ft=async()=>{const e=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),A=await navigator.mediaDevices.enumerateDevices();return e.getTracks().forEach(n=>n.stop()),A.some(n=>n.kind==="audioinput"&&n.label!=="")};function Yt({conversationId:e,currentModelId:A}){const t=J(),n=Tt(),a=b(C=>C.server.usage),s=b(C=>C.server.voiceConnectionQuality),i=C=>C===qA.Lost,r=b(C=>C.server.connectionState),l=PA(),[u,m]=c.useState(!1),d=b(C=>C.server.toolUpdate),[h,g]=c.useState(!1),[p,v]=c.useState(!0),[x,f]=c.useState(null),[k,B]=c.useState(null),[E,y]=c.useState(null),[w,dA]=c.useState(!1),[F,H]=c.useState(!1),R=c.useRef(!1),X=q(e),{stopVoiceMode:Q,toggleVoiceMode:K,isVoiceModeActive:Y}=kA();c.useEffect(()=>{F||Ft().then(C=>{dA(C)}).finally(()=>{H(!0)})},[F]);const IA=Y&&F&&!w,SA=Y&&w&&!r&&l;c.useEffect(()=>{IA&&(f(t.formatMessage({id:"5n1Tdb",defaultMessage:"Enable microphone access in Settings"})),B({title:t.formatMessage({id:"FL4BKs",defaultMessage:"Microphone access required"}),description_markdown:t.formatMessage({id:"J815Ip",defaultMessage:"To use voice mode, you'll need to enable your microphone and try again."}),buttons:[]}),m(!0))},[t,IA]),c.useEffect(()=>{if(SA&&!R.current){R.current=!0,f(null),B(null);const C=Rt(l),G=$A.getCurrentNode(e)?.parentId,z={serverThreadId:X,modelSlug:C,parentMessageId:G,isAdvancedMode:l.default_voice_mode==="advanced",retryWithStandard:!0,eventSource:"composer_speech_button",clientThreadId:e};L.voiceSessionStarted.click(),K(z)}},[e,SA,l,X,K]);const{reaching_limit_disclosure:uA,exceed_limit_message:O}=a?.rate_limit_message??{},mA=l?.modes.find(C=>C.mode===l?.default_voice_mode)?.disclosure_message,gA=i(s)?"Lost connection.":uA?.hint??O?.title??mA?.hint??null;c.useEffect(()=>{const C=d?.text;let G,z,BA;return C&&(v(!1),G=setTimeout(()=>{g(!0),z=setTimeout(()=>{g(!1),BA=setTimeout(()=>{v(!0)},750)},3e3)},750)),()=>{clearTimeout(G),clearTimeout(z),clearTimeout(BA)}},[d]),c.useEffect(()=>{if(gA&&f(gA),O&&Y){Q();const C={title:O.title,description_markdown:O.description_markdown,buttons:O.buttons};u?y(C):(B(C),m(!0))}else if(!k){const C=uA??mA;C&&B({title:C.title,description_markdown:C.message_markdown,buttons:C.buttons})}},[a,mA,Q,Y,gA,O,uA,u,k,s]);const ie=c.useCallback(()=>{E&&(B(E),y(null)),m(!0)},[E]),ce=c.useCallback(()=>{m(!1)},[]),{startVoiceMode:re}=UA(),le=xA(e),de=b(C=>C.voiceMode),{voiceName:ue}=Ge(),me=async()=>{try{f(null),await re({conversation_id:X,model_slug:le??aA,eventSource:"lost_connection_hint_message",voice_mode:de,voice:ue,clientThreadId:e})}catch(C){const G=C instanceof Error?C.message:String(C);L.voiceMode.error({error:G,eventSource:"lost_connection_hint_message"})}},ge=()=>x?i(s)?o.jsxs("div",{className:"inline-flex items-center",children:[x,o.jsx("button",{onClick:me,className:"ml-1",children:o.jsx("strong",{children:t.formatMessage({id:"oyHr3m",defaultMessage:"Retry"})})})]}):o.jsxs("button",{onClick:ie,className:"inline-flex items-center bg-transparent text-token-text-secondary hover:text-token-text-primary","aria-label":t.formatMessage({id:"+fKsfr",defaultMessage:"Open info modal"}),children:[x,o.jsx(we,{className:"icon-sm ml-1"})]}):null;return o.jsxs("div",{className:"flex w-full flex-col items-center",children:[o.jsxs("div",{className:"relative mb-6 flex min-h-5 w-full items-center justify-center text-xs text-token-text-secondary",children:[d?.text&&o.jsx(S.div,{initial:{opacity:0},animate:{opacity:h?1:0},transition:{duration:.5},style:{position:"absolute",left:"50%",transform:"translateX(-50%)",textAlign:"center"},children:o.jsxs("div",{className:"flex items-center",children:[d?.text&&o.jsx(Be,{className:"icon-sm mr-1"}),d?.text]})}),o.jsx(S.div,{initial:{opacity:0},animate:{opacity:p?1:0},transition:{duration:.5},style:{position:"absolute",left:"50%",transform:"translateX(-50%)",textAlign:"center"},children:o.jsx("div",{className:"flex items-center",children:ge()})})]}),o.jsxs("div",{className:nA("flex flex-row items-center gap-6","rounded-full px-3 py-1","transition-width duration-200 ease-in-out"),children:[o.jsx(VA,{capability:"video",children:o.jsx(Gt,{})}),o.jsx(Jt,{}),o.jsx(VA,{capability:"screenshare",children:o.jsx(Xt,{})}),o.jsx(EA,{onClick:n})]}),o.jsx(Nt,{conversationId:e,modelId:A,isOpen:u,onClose:ce,title:k?.title,description_markdown:k?.description_markdown,buttons:k?.buttons??[]})]})}function Ot(){const e=tA("716722001")?.value??!1,A=tA("2436427643")?.value??!1,t=tA("1413999995")?.value??!1;return{av:e,video:A,screenshare:t}}function VA({children:e,capability:A}){const t=Ot();return!t.av||!t[A]?null:o.jsx(o.Fragment,{children:e})}function Gt(){const{isVideoEnabled:e,isStartingVideo:A,toggleVideo:t}=iA();let n=null;A?n=P:n=ye;const a=e?"bg-gray-900 hover:bg-gray-800 active:bg-gray-700":"bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10",s=e?"text-white dark:text-black":"text-black dark:text-white";return o.jsx(_,{onClick:()=>t("ControlButton"),disabled:A,icon:n,className:a,iconColor:s})}const Lt=async()=>{try{const e=await U("audioinput");return e?e.label||"Unknown microphone":"No microphone found"}catch(e){return console.warn("Error fetching default media device:",e),ve.addError("Failed to fetch default media device",{error:e}),"Error accessing microphone devices"}};function Jt(){const{isMicrophoneEnabled:e,isMuting:A,toggleMute:t}=WA(),n=J(),{disconnectPending:a}=lA(),[s,i]=c.useState(!1),[r,l]=c.useState(""),u=e?Qe:De,m=e?"bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10":"bg-red-500/10 hover:bg-red-500/15 active:bg-red-500/20 dark:bg-red-500/10 dark:hover:bg-red-500/15 dark:active:bg-red-500/20",d=e?"text-black dark:text-white":"text-red-500";c.useEffect(()=>{Lt().then(v=>l(v))},[]);const h=c.useCallback(()=>{i(!0)},[]),g=c.useCallback(()=>{i(!1)},[]),p=e?n.formatMessage({id:"/y/kyH",defaultMessage:"Click to mute"}):n.formatMessage({id:"YolhLY",defaultMessage:"Click to unmute"});return o.jsx(Le,{sideOffset:14,label:p,secondaryLabel:r,contentClassName:"flex flex-col items-center justify-center",className:"flex",open:s,side:"top",children:o.jsx("span",{onPointerEnter:h,onPointerLeave:g,children:o.jsx(_,{"aria-label":p,onClick:t,icon:u,disabled:A||a,className:m,iconColor:d})})})}function Xt(){const{isScreenshareEnabled:e,isScreenshareStarting:A,toggleScreenShare:t}=cA();let n=null;A?n=P:n=Ve;const a=e?"bg-gray-900 hover:bg-gray-800 active:bg-gray-700":"bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10",s=e?"text-white dark:text-black":"text-black dark:text-white";return o.jsx(_,{onClick:()=>t("ControlButton"),disabled:A,icon:n,className:a,iconColor:s})}function EA({className:e,onClick:A}){const t=J(),{disconnectPending:n}=lA();return o.jsx(_,{disabled:n,onClick:A,icon:n?P:Me,iconColor:"text-black dark:text-white",className:e??"bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10","aria-label":t.formatMessage({id:"7/8k4Y",defaultMessage:"End voice mode"})})}function _(e){const{icon:A,disabled:t,className:n,iconColor:a="text-current",iconSize:s="icon-xl",buttonSize:i="h-16 w-16",...r}=e;return o.jsx(Wt,{className:nA(n,i,"overflow-hidden rounded-full border-none p-0.5 text-token-text-primary transition-colors duration-200 ease-in-out hover:text-token-text-secondary"),disabled:t,...r,children:o.jsx(A,{className:nA(s,a)})})}const Wt=S(LA);var Ut=mt,Pt=Je,qt=Ut(function(e,A,t){return e+(t?" ":"")+Pt(A)}),_t=qt;const Ht=CA(_t);function Kt({conversationId:e}){const A=tA("1426009137")?.value,t=q(e),n=ct(e),a=xA(e),s=$A.getCurrentNode(e)?.parentId;ze({conversationId:t??null,requestedVoiceMode:null,gizmoId:n,eventSource:"voice_mode_picker"});const i=PA();return!A||!a?null:o.jsx(Z,{conversationId:t??e,parentMessageId:s,status:i})}function Z(e){const A=e?.status?.modes,[t,n]=c.useState(!1),[a,s]=c.useState(),i=c.useCallback(u=>{s(u),n(!0)},[]),r=J(),l=c.useCallback(()=>n(!1),[]);return o.jsxs(o.Fragment,{children:[o.jsx(dt,{contentAlign:"center",triggerButton:o.jsx(Z.Trigger,{}),children:A?A.map(u=>{const m=u.default_model_slug;return c.createElement(Z.Item,{...e,modelSlug:m,key:u.mode,voiceStatusMode:u,onShowModal:i})}):o.jsx("div",{role:"progressbar","aria-valuetext":r.formatMessage({defaultMessage:"Loading voice modes",id:"voiceModeButton.loadingModes"}),"aria-busy":"true","aria-live":"assertive","aria-valuemin":0,"aria-valuemax":100,children:o.jsx(P,{"aria-hidden":"true",className:"my-4 min-w-full"})})}),o.jsx(Z.Modal,{conversationId:e.conversationId,disabledModeMetadata:a,isOpen:t,onClose:l})]})}Z.Modal=function(A){const t=A.disabledModeMetadata?.buttons??[],n=ee({buttons:t,conversationId:A.conversationId,modelId:aA,onClick:A.onClose}),a=o.jsx(XA,{children:A.disabledModeMetadata?.description_markdown});return o.jsx(GA,{title:A.disabledModeMetadata?.title,description:a,isOpen:A.isOpen,onClose:A.onClose,type:"success",primaryButton:n.primary,secondaryButton:n.secondary})};Z.Trigger=c.forwardRef(function(A,t){const n=b(a=>a.voiceMode);return o.jsxs(rt,{ref:t,...A,children:[Ht(n)??o.jsx(P,{}),o.jsx(je,{className:"icon-md text-token-text-tertiary"})]})});Z.Item=function({conversationId:A,modelSlug:t,parentMessageId:n,voiceStatusMode:a,onShowModal:s}){const{disabled_mode_metadata:i,mode:r}=a,{toggleVoiceMode:l}=kA(),u=q(A),m=c.useCallback(async()=>{i?s(i.disabled_message):l({serverThreadId:u,modelSlug:t,parentMessageId:n,isAdvancedMode:r==="advanced"&&!i,eventSource:"voice_mode_picker",retryWithStandard:!1,clientThreadId:A})},[A,i,r,t,s,n,u,l]);return o.jsx(ut.Item,{onClick:m,children:o.jsxs("div",{children:[a.display_name,o.jsx("div",{className:"text-xs text-token-text-tertiary",children:a.description})]})})};function zt({conversationId:e}){const A=b(n=>n.server.messages),t=b(n=>n.voiceSessionId);return o.jsx(S.div,{className:"hidden h-full max-w-[400px] overflow-y-auto border-l border-l-token-sidebar-surface-secondary bg-token-main-surface-secondary pt-16 shadow-inner md:block",initial:{opacity:0,x:420,width:"0px"},animate:{opacity:1,x:0,width:"400px"},exit:{opacity:0,x:420,width:"0px"},transition:{type:"tween"},children:o.jsxs(N,{children:[o.jsx(Kt,{conversationId:e}),o.jsxs("div",{className:"p-4 py-2 text-lg font-semibold",children:["Voice Session ID: ",t]}),A.length?o.jsxs(S.div,{className:"flex h-full w-full flex-col",initial:{opacity:0,x:-100},animate:{opacity:1,x:0},exit:{opacity:0,x:-100},children:[o.jsxs("div",{children:[o.jsx("h3",{className:"p-4 py-2 text-lg font-semibold text-token-text-secondary",children:"Room Stats"}),o.jsx($t,{})]}),o.jsx("h3",{className:"p-4 py-2 text-lg font-semibold text-token-text-secondary",children:"Messages"}),o.jsx("div",{className:"grow overflow-hidden",children:o.jsx(lt,{children:o.jsx(S.ul,{className:"pointer-events-none flex w-full flex-col gap-4 pb-24 pt-4",initial:"initial",animate:"animate",exit:"exit",variants:te,transition:{delayChildren:.25,staggerChildren:.05},children:A.map((n,a)=>o.jsx(oo,{index:a,message:n},a))})})})]}):null]})})}function $t(){const e=b(n=>n.dev.room);if(!e)return null;const A=e.numParticipants,t=e.activeSpeakers;return o.jsx("div",{className:"px-4 pb-8",children:o.jsxs("div",{className:"flex flex-col flex-nowrap gap-2",children:[o.jsx(Ao,{}),o.jsx(sA,{text:"Attendees"}),o.jsx(T,{name:"Participants",text:A}),o.jsx(T,{name:"Speakers",text:t.length}),o.jsx(eo,{})]})})}function Ao(){const e=b(s=>s.server.connectionState),A=b(s=>s.dev.room),[t,n]=c.useState("Unknown"),a=A?.localParticipant;return c.useEffect(()=>{if(a){const s=i=>{n(i)};return a.on("connectionQualityChanged",s),()=>{a.off("connectionQualityChanged",s)}}},[a]),o.jsxs(o.Fragment,{children:[o.jsx(sA,{text:"Connection"}),o.jsx(T,{name:"Quality",text:String(t)}),o.jsx(T,{name:"State",text:String(e)})]})}function eo(){const e=b(m=>m.dev.room),[A,t]=c.useState(null),[n,a]=c.useState(null),[s,i]=c.useState(null),r=e?.getActiveDevice("audioinput"),l=e?.getActiveDevice("audiooutput"),u=e?.getActiveDevice("videoinput");return c.useEffect(()=>{async function m(){const d=await oA.getLocalDevices("audioinput"),h=await oA.getLocalDevices("audiooutput"),g=await oA.getLocalDevices("videoinput"),p=d.find(f=>f.deviceId===r),v=h.find(f=>f.deviceId===l),x=g.find(f=>f.deviceId===u);t(p?.label??"Unknown"),a(v?.label??"Unknown"),i(x?.label??null)}m()},[r,l,u]),o.jsxs(o.Fragment,{children:[o.jsx(sA,{text:"Devices"}),s?o.jsx(T,{icon:Te,name:"Video Input",text:s}):null,o.jsx(T,{icon:MA,name:"Audio Input",text:A??"Unknown"}),o.jsx(T,{icon:Re,name:"Audio Output",text:n??"Unknown"}),o.jsx(sA,{text:"Monitors"}),o.jsx(T,{name:"Mic level",icon:MA,text:"unknown",content:o.jsx(to,{})})]})}function to(){const e=b(A=>A.dev.room?.localParticipant.audioLevel);return o.jsx("div",{className:"flex flex-row flex-nowrap items-center gap-1",children:o.jsx("div",{className:"flex flex-row flex-nowrap items-center gap-1",children:Array.from({length:10}).map((A,t)=>o.jsx("div",{className:`h-2 w-2 rounded-full ${(e??0)>t*.1?"bg-gray-500":"bg-token-main-surface-tertiary"}`},t))})})}function sA({text:e}){return o.jsx("h4",{className:"text-md font-semibold",children:e})}function T(e){return o.jsxs("div",{className:"flex flex-row flex-nowrap items-center gap-2",children:[o.jsx("span",{className:"opacity-85",children:e.icon?o.jsx(e.icon,{className:"h-[0.75rem] w-[0.75rem]"}):`${e.name}:`}),e.content??o.jsx("span",{className:"line-clamp-1 rounded-lg bg-token-main-surface-tertiary p-0.5 px-1 font-mono text-xs",children:e.text})]})}function oo({index:e,message:A}){const[t,n]=c.useState(!1);let a=null;switch(A.source){case"remote":a=Fe;break;case"local":a=Ne;break}return o.jsx(S.div,{className:"w-full border-t border-token-main-surface-tertiary p-4",variants:te,children:o.jsxs("div",{className:"flex w-full flex-col gap-2 rounded-lg bg-token-main-surface-secondary",children:[o.jsxs("div",{className:"font-mono text-[0.65rem] font-semibold text-token-text-secondary",children:[o.jsxs("div",{className:"flex w-full flex-row flex-nowrap items-center justify-between",children:[o.jsxs("div",{className:"flex flex-row flex-nowrap items-center gap-1",children:[o.jsx(a,{className:"h-3 w-3 text-token-text-secondary"}),o.jsx("span",{children:` | ${e+1} | ${Xe(A.timestamp,"H:m:s:SS")}`})]}),o.jsx("div",{className:"flex flex-row flex-nowrap items-center gap-2",children:o.jsx(LA,{className:"rounded-full p-0.5",color:"ghost",size:"small",onClick:()=>n(s=>!s),children:o.jsx(Ze,{className:`transform transition-transform ${t?"rotate-180":""}`})})})]}),o.jsx("div",{className:"mt-1 text-xs font-bold",children:A.type})]}),o.jsx(N,{children:t?o.jsx(S.pre,{initial:{opacity:0,transform:"blur(4px)"},animate:{opacity:1,transform:"blur(0px)"},exit:{opacity:0,transform:"blur(4px)"},className:"overflow-x-auto rounded-md bg-token-main-surface-tertiary p-2 text-xs text-token-text-secondary",children:JSON.stringify(A.payload,null,2)}):null})]})})}const te={hidden:{opacity:0,x:100},animate:{opacity:1,x:0},exit:{opacity:0,x:100}};function no({children:e}){const{isVideoEnabled:A}=iA(),{isScreenshareEnabled:t}=cA(),n=A||t;return o.jsx(N,{mode:"wait",children:n?o.jsx("div",{className:"flex h-full w-full flex-nowrap items-center",children:A?o.jsx(ao,{}):o.jsx(so,{})}):o.jsx(S.div,{className:"flex h-full w-full items-center justify-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e},"children")})}function ao(){const{isVideoEnabled:e,isStartingVideo:A,toggleVideo:t}=iA(),a=rA([bA.Source.Camera]).find(i=>i.participant.isLocal),s=e&&!A&&a;return c.useEffect(()=>{const i=a?.publication?.track;if(i){const r=()=>{t("Browser Video Controls")};return i.on("ended",r),()=>{i.off("ended",r)}}},[a,t]),o.jsx(N,{children:s&&o.jsx(oe,{children:o.jsxs("div",{className:"aspect-w-16 aspect-h-9 group relative max-h-[95%] w-fit max-w-[60%] overflow-hidden rounded-3xl shadow-md",children:[o.jsx("div",{className:"absolute right-2 top-2 z-10 opacity-0 transition-opacity group-hover:opacity-90",children:o.jsx(EA,{onClick:()=>t("StopButton"),className:"bg-gray-900 bg-opacity-20 backdrop-blur-lg hover:bg-opacity-30 dark:bg-gray-900 dark:bg-opacity-20 dark:backdrop-blur-lg dark:hover:bg-opacity-30"})}),o.jsx(_A,{className:"h-full w-full object-contain",trackRef:a})]})},"camera-renderer")})}function so(){const{isScreenshareEnabled:e,isScreenshareStarting:A,toggleScreenShare:t}=cA(),a=rA([bA.Source.ScreenShare]).find(i=>i.participant.isLocal),s=e&&!A&&a;return c.useEffect(()=>{const i=a?.publication?.track;if(i){const r=()=>{t("Browser ScreenShare Controls")};return i.on("ended",r),()=>{i.off("ended",r)}}},[a,t]),o.jsx(N,{children:s&&o.jsx(oe,{children:o.jsxs("div",{className:"aspect-w-16 aspect-h-9 group relative max-h-[95%] w-fit max-w-[60%] overflow-hidden rounded-3xl shadow-md",children:[o.jsx("div",{className:"absolute right-2 top-2 z-10 opacity-0 transition-opacity group-hover:opacity-90",children:o.jsx(EA,{onClick:()=>t("StopButton"),className:"bg-gray-900 bg-opacity-20 backdrop-blur-lg hover:bg-opacity-30 dark:bg-gray-900 dark:bg-opacity-20 dark:backdrop-blur-lg dark:hover:bg-opacity-30"})}),o.jsx(_A,{className:"h-full w-full object-contain",trackRef:a})]})},"screenshare-renderer")})}function oe({children:e,key:A}){return o.jsx(S.div,{className:"flex h-full w-full flex-col items-center justify-center gap-2 bg-token-main-surface-primary",initial:{opacity:0,transform:"blur(12px)",scale:.75},animate:{opacity:1,transform:"blur(0px)",scale:1},exit:{opacity:0,transform:"blur(12px)",scale:.75},transition:{duration:.2},children:e},A)}const $=(e,A)=>{const[t,n]=c.useState(e===A?performance.now():0),a=c.useRef(A);c.useEffect(()=>{a.current!==A&&e===A&&n(performance.now()),a.current=A},[A,e]);const s=c.useCallback(()=>{n(0)},[]);return[e===A?1:0,t,s]},AA=([e,A,t],n=500)=>{const[a,s]=c.useState(e),i=c.useRef(e),r=c.useRef(void 0),l=c.useCallback((u,m,d)=>{const h=g=>{const p=Math.min((g-u)/n,1),v=m+p*(d-m);s(v),p<1&&(r.current=requestAnimationFrame(h))};r.current=requestAnimationFrame(h)},[n]);return c.useEffect(()=>{if(i.current!==e){i.current=e,r.current&&cancelAnimationFrame(r.current);const u=a,m=e;l(performance.now(),u,m)}},[l,a,e]),[a,A/1e3,t]};var io=Ce,co=be;function ro(e){return co(e)&&io(e)}var lo=ro,uo=xe,mo=Ee,go=Ie,ho=ke,po=lo,fo=Math.max;function vo(e){if(!(e&&e.length))return[];var A=0;return e=uo(e,function(t){if(po(t))return A=fo(t.length,A),!0}),ho(A,function(t){return mo(e,go(t))})}var Co=vo,bo=We,xo=Co,ko=bo(xo),Eo=ko;const fA=CA(Eo),ne=240,Io=2048,So=60,ae=Math.floor(1e3/So),Bo=new Array(ne).fill(0),Mo=e=>{const A=HA(e,{bands:ne,updateInterval:ae,loPass:0,hiPass:400,analyserOptions:{fftSize:Io}});return A.length===0?Bo:A},se=e=>{const{magnitudes:A,binCount:t,gainMultiplier:n}=e;if(A.length===0)return new Array(t).fill(0);const a=Math.ceil(A.length/t),s=[];for(let i=0;i<A.length;i+=a){const r=Math.min(i+a,A.length),l=A.slice(i,r).sort((h,g)=>h-g),u=Math.floor(l.length/2);let m;l.length%2===0?m=(l[u-1]+l[u])/2:m=l[u],m=Math.abs(m),m*=n;const d=m/(m+1);s.push(d)}return s},wo=(e,A)=>{const t=A.sampleRate,n=e.length,a=A.bandCount,s=A.binCount,i=A.gainMultipliers;if(i.length!==a)throw new Error("gainMultipliers must have length equal to bandCount");const r=n*2,l=t/r,u=e.map((p,v)=>v*l),m=20,d=t/2,h=new Array(a+1).fill(0).map((p,v)=>m*Math.pow(d/m,v/a)),g=new Array(a).fill(null).map(()=>[]);for(let p=0;p<u.length;p+=1)for(let v=0;v<a;v+=1)if(u[p]>=h[v]&&u[p]<h[v+1]){g[v].push(e[p]);break}for(let p=0;p<a;p+=1){const v=g[p],x=i[p];g[p]=se({magnitudes:v,binCount:s,gainMultiplier:x})}return g},jA=60,yo=48e3,Qo=1,Do=2,Vo=40,jo=2;function TA({time:e,timeConstant:A}){return 1-Math.exp(-e/A)}function RA(e,A){const t=A[1]-A[0];return A[0]+e*t}const vA=e=>{if(!Array.isArray(e)||e.length!==2||typeof e[0]!="number"||typeof e[1]!="number")throw new Error("zip failed - received a value that is not a [number, number] tuple")},To=e=>{const{prevAudioData:A,prevCumulativeAudioData:t,deltaTimeS:n,audioDataRaw:a}=e,s=a.map(h=>h*n*jA*Qo),i=TA({time:n,timeConstant:Do}),r=fA(A,s).map(h=>(vA(h),RA(i,h))),l=a.map(h=>h*n*jA*Vo),u=fA(t,l).map(h=>(vA(h),h[0]+h[1])),m=TA({time:n,timeConstant:jo}),d=fA(t,u).map(h=>(vA(h),RA(m,h)));return{audioData:r,cumulativeAudioData:d}},Ro=(e,A)=>{const t=Mo(e),n=wo(t,{sampleRate:yo,binCount:A.bins,bandCount:A.bands,gainMultipliers:A.gainMultipliers}),a=se({magnitudes:t,binCount:1,gainMultiplier:1});return{bandMagnitudes:n,cumulativeMagnitude:a}},ZA=e=>{const[A,t]=c.useState({audioData:[0,0,0,0],cumulativeAudioData:[0,0,0,0]}),n=c.useRef([0,0,0,0]),a=c.useRef(void 0),s=c.useRef(performance.now()),{bandMagnitudes:i,cumulativeMagnitude:r}=Ro(e,{bands:3,bins:1,gainMultipliers:[10,1,1]});n.current=[...i,r].flat();const l=c.useCallback(()=>{const u=performance.now(),m=(u-s.current)/1e3;s.current=u;const d=n.current,{audioData:h,cumulativeAudioData:g}=A,p=To({deltaTimeS:m,audioDataRaw:d,prevAudioData:h,prevCumulativeAudioData:g});t(p)},[A]);return c.useEffect(()=>(a.current||(a.current=window.setInterval(l,ae)),()=>{clearInterval(a.current),a.current=void 0}),[l]),A};function NA({className:e}){return o.jsx(Lo,{className:e})}const Zo=1.55,No="voice-wav",Fo="shout",Yo="User",Oo=[300,300];function Go(){const{resolvedTheme:e}=Se(),A=e==="dark",t=b(g=>g.voiceMode==="advanced"),n=rA([bA.Source.Microphone]),a=n.find(g=>g.publication.trackName===No),s=n.find(g=>g.publication.trackName===Fo);let i=ZA(s?.publication.audioTrack),r=ZA(a?.publication.audioTrack);const l=i.audioData.map((g,p)=>{const v=r.audioData[p];return g>0&&v>0?(g+v)/2:g>0?g:v}),u=i.cumulativeAudioData.map((g,p)=>{const v=r.cumulativeAudioData[p];return g>0&&v>0?(g+v)/2:g>0?g:v}),m=b(g=>g.server.remoteState),d=n.find(g=>g.participant.identity===Yo),h=(HA(d,{bands:1,loPass:0,hiPass:400})[0]??0)*Zo;return{remoteState:m,userVolume:h,isAdvanced:t,avgMag:l,cumulativeAudio:u,isDarkMode:A}}function Lo({className:e}){const{remoteState:A,userVolume:t,isAdvanced:n,avgMag:a,cumulativeAudio:s,isDarkMode:i}=Go(),[r,l]=c.useState(Oo),u=c.useCallback(Q=>{l([Q.width,Q.height])},[]),m=c.useRef([0,0,0,0]);c.useEffect(()=>{A===M.Connecting&&(m.current=[0,0,0,0])},[A]);const d=c.useRef(performance.now());c.useEffect(()=>{const Q=performance.now();A===M.Speaking&&Q-d.current>50&&(d.current=Q,m.current=m.current.map((K,Y)=>K+a[Y]))},[A,a]);const[h,g]=AA($(M.Listening,A)),[p,v]=AA($(M.Speaking,A)),[x,f]=AA($(M.Thinking,A)),[k,B]=AA($(M.Halted,A)),[E,y]=c.useState(performance.now()/1e3);c.useEffect(()=>{const Q=setInterval(()=>{y(performance.now()/1e3)},50);return()=>clearInterval(Q)},[]);const w=c.useMemo(()=>performance.now()/1e3,[]),[dA,F]=c.useState(1e5),H=c.useRef(A);c.useEffect(()=>{A===M.Connecting?F(1e5):H.current===M.Connecting&&F(E),H.current=A},[A,h,E]);const R=$e(n),X={time:E-w,micLevel:t,stateListen:h,listenTimestamp:Math.max(g-w,0),stateThink:x,thinkTimestamp:Math.max(f-w,0),stateSpeak:p,speakTimestamp:Math.max(v-w,0),readyTimestamp:dA-w,stateHalt:k,haltTimestamp:Math.max(B-w,0),touchDownTimestamp:0,touchUpTimestamp:0,stateFailedToConnect:0,failedToConnectTimestamp:0,avgMag:new Float32Array(a),cumulativeAudio:new Float32Array(s??m.current),isNewBloop:!0,isAdvancedBloop:n,bloopColorMain:R.bloopColorMain,bloopColorLow:R.bloopColorLow,bloopColorMid:R.bloopColorMid,bloopColorHigh:R.bloopColorHigh,isDarkMode:i,screenScaleFactor:window.devicePixelRatio,viewport:new Float32Array(r),silenceAmount:0,silenceTimestamp:0,fadeBloopWhileListening:!1};return o.jsx(At,{className:nA("flex items-center justify-center",e),source:"remote",variables:{blorbFragVariables:X},onViewportUpdate:u})}const Jo=({conversationId:e})=>{const A=rA(),[t,n]=c.useState(!1),[a,s]=c.useState(!1),i=c.useCallback(()=>{A&&A.length>0&&A.forEach(m=>{const{publication:d}=m;d.audioTrack instanceof yA?(s(d.audioTrack.isMuted),d.audioTrack.mute()):d.audioTrack instanceof QA&&d.audioTrack.setMuted(!0)})},[A]),r=c.useCallback(()=>{A&&A.length>0&&A.forEach(m=>{const{publication:d}=m;d.audioTrack instanceof yA?a||d.audioTrack.unmute():d.audioTrack instanceof QA&&d.audioTrack.setMuted(!1)})},[A,a]),l=()=>{i(),n(!0)},u=()=>{r(),n(!1)};return o.jsxs(o.Fragment,{children:[o.jsx(_,{onClick:l,icon:Ye,iconColor:"text-[#A4A4A4] dark:text-[#858585]",className:"bg-transparent hover:bg-black/10 active:bg-black/20 dark:bg-transparent dark:hover:bg-white/5 dark:active:bg-white/10",iconSize:"icon-md",buttonSize:"h-10 w-10"}),t&&o.jsx(et,{conversationId:e,onClose:u})]})};class Xo extends Worker{constructor(A,t){const n=String(A);super(n.includes("://")&&!n.startsWith(location.origin)?URL.createObjectURL(new Blob([`import("${n}")`],{type:"text/javascript"})):A,t)}}const Wo=new Xo(new URL("https://cdn.oaistatic.com/assets/livekit-client.e2ee.worker-DCt9knlM.js",import.meta.url),{type:"module"}),Uo=c.memo(function({children:A}){const t=c.useRef({keyProvider:new tt}).current,[n,a]=c.useState(!1),{token:s,url:i,e2eeKey:r}=b(d=>d.credentials),l=ot(),u=b(d=>d.isVoiceModeActive),m=b(d=>d.audioInputDevice?.deviceId);return c.useEffect(()=>{const d=s&&i&&r;!n&&d?t.keyProvider.setKey(r).then(()=>{a(!0)}):n&&!d&&a(!1)},[s,i,r,n,t]),u?o.jsxs(nt,{...l,connect:!0,token:s??void 0,serverUrl:i??void 0,audio:{deviceId:{ideal:m,exact:m},noiseSuppression:!0,echoCancellation:!0},options:{e2ee:{keyProvider:t.keyProvider,worker:Wo}},children:[A,n&&s&&i&&o.jsx(Mt,{}),n&&s&&i&&o.jsx(at,{})]}):null});function Tn({conversationId:e,currentModelId:A,isActiveWindow:t}){const[n,a]=c.useState(!1),s=b(d=>d.isVoiceModeActive),i=b(d=>d.server.voiceConnectionQuality),r=Ue(),l=b(d=>d.screenshare!=null),u=b(d=>d.video!=null),m=J();return c.useEffect(()=>{if(!t)return;const d=new jt;return s?d.enable():d.disable(),()=>{d.disable()}},[s,t]),t&&o.jsxs(Uo,{children:[o.jsx(N,{children:s?o.jsx(S.div,{className:"fixed left-0 top-0 z-50 flex h-full w-full flex-col bg-token-main-surface-primary",initial:"hidden",animate:"visible",exit:"hidden",variants:eA,children:o.jsxs(S.div,{className:"relative h-full w-full",variants:eA,children:[o.jsxs(S.div,{variants:eA,className:"flex h-full w-full flex-col justify-between gap-6",children:[o.jsxs(S.div,{className:"relative mt-6 flex w-full justify-center",children:[o.jsx("div",{className:"flex w-full items-center justify-center",children:(l||u)&&o.jsx(NA,{className:"h-16 w-16"})}),o.jsx("div",{className:"mr-4",children:o.jsx(Jo,{conversationId:e})})]}),o.jsxs("div",{className:"flex h-full min-h-0 items-center justify-center",children:[o.jsx(no,{children:o.jsx(NA,{className:"h-max min-h-52 w-max min-w-52"})}),o.jsx(N,{children:n?o.jsx(zt,{conversationId:e}):null})]}),o.jsx(S.div,{className:"mb-6 flex justify-center",children:o.jsx(Yt,{conversationId:e,currentModelId:A})})]}),o.jsx(S.div,{className:"absolute bottom-0 right-0 flex w-auto items-center justify-end p-4",variants:eA,children:r?o.jsx(Pe,{onClick:()=>a(d=>!d),icon:Oe}):null})]})}):null}),i===qA.Poor&&o.jsx("div",{className:"absolute left-1/2 top-6 z-50 -translate-x-1/2 transform",children:o.jsx("div",{className:"inline-flex flex-col items-center rounded-full border border-token-border-light bg-token-main-surface-primary px-6 py-3",children:o.jsx("span",{className:"text-token-text-secondary",children:m.formatMessage({id:"YE2Eng",defaultMessage:"Poor connection"})})})})]})}const eA={hidden:{opacity:0,transform:"blur(4px)"},visible:{transform:"blur(0px)",opacity:1},exit:{opacity:0,transform:"blur(4px)"}};export{Tn as VoiceModeLayout};
//# sourceMappingURL=2fmcmhrhepdjlzd2.js.map
