import{fl as E,ay as R,r as u,a6 as i,dk as P,fm as $,ar as Y,fn as K}from"./emaotesjjrbo0vnn.js";import{fQ as X,fR as Z,W as b,fS as Q,fT as J,fU as ee,d_ as te,fV as se,fW as ae,fX as oe,fY as ne,fZ as ie,f_ as re,f$ as ce,g0 as de,g1 as le,g2 as ue,g3 as fe,g4 as pe,g5 as W,g6 as he,g7 as F,g8 as me,b7 as k,bZ as N,g9 as ge,ga as xe,gb as be,gc as ve,R as Ce,gd as Se,ge as O,U as D,bA as we,gf as j,gg as Te,gh as ye}from"./pfgfa28h4zko09ji.js";import{L as Ie}from"./uum3qt88kgyy5xax.js";import{u as Ee}from"./ewyb95qzyni49h6u.js";import{T as Ae}from"./mrzrevxkl8sghw22.js";import{m as x}from"./kye660kh5ct8polq.js";import"./i2h9sd6w9obmp6kj.js";import"./f4d4hsc2yuigyhy9.js";import"./kn0ak9fkjsb1xfsy.js";import"./fokwkkbk6knx4amm.js";import"./hd7b3v6d032g9uc2.js";import"./cwrkr657k0yctpo3.js";import"./et7c03cyivi8l0td.js";import"./lx13f5tx2fvtfihh.js";import"./fjxlwcafgbqx6k83.js";import"./ir6hxzp3zib1lm87.js";import"./bxhjcgl41yecukvk.js";import"./ckzo3d3wgyies2u0.js";import"./bebphm0teh27dp33.js";import"./opzvq2rekkh5bmjo.js";import"./jz69zxs95gnlksyl.js";const M="oai/apps/canmoreSidebarWidth",_e=.25,Re=400,L=400;function H(e){return e-Re}function y(e,a){return Z(L,H(e),a??_e*e)}function We(){const e=E.useState(E.selectWindowWidth),a=y(e,X(R.DANGER_SECRET_FOLDERS_ONLY_getItem(M))),s=U(),[t,r]=u.useState(a);u.useEffect(()=>{(t<L||t>H(e))&&r(y(e,t))},[e]);function o(l){r(g=>y(e,g+=l.delta.x))}function d(l){r(l),R.DANGER_SECRET_FOLDERS_ONLY_setItem(M,l)}function c(){const l=y(e,void 0);d(l)}const n=`calc(100vw - ${t}px)`;return s?{chatWidth:t,canvasWidth:e-t,canvasWidthCalc:n,viewportWidth:e,handleDrag:o,handleDoubleClick:c,persist:d}:{chatWidth:0,canvasWidth:e,canvasWidthCalc:"100vw",viewportWidth:e,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function U(){return E.useState(e=>E.selectWindowWidth(e)>1e3)}function Ne(e,a){let s;return a?.type===b.Textdoc&&(s={type:"canvas_textdoc",id:a.textdocId}),{...e,messageMetadata:{...e.messageMetadata,open_in_canvas_view:s}}}const V=({isFullScreen:e=!1,clientThreadId:a,focusedObject:s,onClose:t,isAnimating:r=!1,width:o})=>{const{setTargetedContent:d}=Q(),c=u.useRef(!1);if(u.useEffect(()=>(c.current&&d(void 0),c.current=!0,()=>{c.current=!1}),[s]),s==null)return null;switch(s.type){case b.Textdoc:return i.jsx(Ae,{isFullScreen:e,onClose:t,clientThreadId:a,focusedTextdoc:s,isAnimating:r,width:o});case b.ADAVisualization:return null}},Oe=300,De=e=>e?.type===b.Textdoc?e.textdocId:null;function je(e){const a=J(e),s=ee(a),t=te(e),r=se(e,t),o=ae({clientThreadId:e,conversationLeafId:t}),d=oe(),[c,n]=u.useMemo(()=>{if(r&&ne(r))return[void 0,null];let p;return!o&&r&&(p=ie(re(r.messages))),Me(s,d,p)},[o,r,s,d]),l=n!=null,g=De(n);u.useEffect(()=>{if(n&&c&&(ce(n,c),n.type===b.Textdoc)){const{textdocId:p}=n,C=he(p);de(document.getElementById(C))}},[l,g])}function Me(e,a,s){switch(s?.type){case le.Canmore:{const[t,r]=s.messages;if(!ue(t?.message))break;const o=fe(e,t.message,r?.message??null),d=o.textdocId??a;if(d&&(o.function===pe.CreateTextdoc?(o.content??"").length>Oe||o.status===W.WAITING:o.status===W.STREAMING))return[o.messageId,{type:b.Textdoc,textdocId:d}];break}}return[void 0,null]}const Fe=260,G=280,I={type:"spring",bounce:.12,duration:.64},ke={type:"spring",bounce:0,duration:.58},Le=({clientThreadId:e,focusedObject:a,onClose:s})=>{const{chatWidth:t,canvasWidthCalc:r,handleDrag:o,handleDoubleClick:d,persist:c}=We(),n=k(),[l,g]=u.useState(!0),[p,C]=u.useState(!1),h=N(f=>f.activeSidebar),v=ge(({rect:f})=>f),{windowHeight:S,windowWidth:w}=$(f=>f,{windowWidth:0,windowHeight:0});let m=v??{top:0,left:t,width:w-t,height:S},_=!1;if(v&&(m.top<0||m.top+m.height>S)){_=!0;const f={width:(w-t)*.75,height:S*.75};m={top:S/2-f.height/2,left:(w-t-f.width)/2+t,width:f.width,height:f.height}}n&&(m.left-=G+t/2);const T=v?.borderRadius,A=xe(),z=A?.history!=null||A?.showChangesAtVersion!=null,B=N(f=>f.isDesktopNavCollapsed);return i.jsxs(i.Fragment,{children:[z&&i.jsx(Ie,{onClick:()=>be(A.textdocId),zIndexKey:"chatOverlay"}),i.jsxs(x.div,{initial:!n&&{marginRight:B?0:-Fe},animate:!n&&{marginRight:0},transition:ke,children:[i.jsx(x.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:{...I,delay:.22},className:"pointer-events-none absolute left-0 top-0 z-20 h-full w-full bg-token-main-surface-primary"}),!n&&i.jsx(x.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"pointer-events-none absolute left-0 top-0 z-10 h-full w-full bg-black/[0.025] dark:bg-transparent"}),i.jsx(x.div,{className:"relative z-20 h-full",style:{width:r},exit:{width:0},transition:{type:"spring",bounce:0,duration:.1}})]}),i.jsx(x.div,{className:Y("absolute z-20 h-full transition-shadow",n&&"right-0 max-h-[100cqh] max-w-[var(--available-details-width)] overflow-y-auto overflow-x-clip",!n&&"overflow-hidden",!n&&(h==="debug"?"md:left-[-250px] lg:left-[-300px] xl:left-[-350px] 2xl:left-[-400px]":"left-0")),initial:{borderRadius:T,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)",opacity:_?0:1,x:m.left,y:m.top,height:m.height,width:m.width},animate:{opacity:1,x:n?0:t,y:0,width:n?`calc(100cqw - ${t}px)`:r,height:"100%",borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:{opacity:{duration:.14,bounce:.1}},borderRadius:T,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:p?{duration:0}:I,onAnimationComplete:()=>g(!1),children:i.jsx(x.div,{className:"h-full overflow-hidden border-l border-gray-100 dark:border-token-border-medium",initial:{borderRadius:T},animate:{borderRadius:0},exit:{borderRadius:T},transition:I,children:i.jsxs("div",{className:"h-full",children:[i.jsx(x.div,{drag:"x",className:"absolute left-[-2px] z-10 h-full w-[4px] cursor-ew-resize bg-token-text-quaternary opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onDrag:(f,q)=>{C(!0),o(q)},onDragEnd:()=>{C(!1),c(t)},onDoubleClick:()=>d()}),i.jsx(V,{onClose:s,clientThreadId:e,isAnimating:l,focusedObject:a,width:w-t})]})})})]})},He=u.memo(Le),Ue=({clientThreadId:e,focusedObject:a,onClose:s})=>i.jsx(K,{children:i.jsx(x.div,{className:"fixed inset-0 z-20 overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:I,children:i.jsx(V,{isFullScreen:!0,clientThreadId:e,focusedObject:a,onClose:s})})}),Ve=({clientThreadId:e})=>{const{store:a,actions:s}=ve(),t=U(),r=Ee(e);je(e);const o=Ce(),d=Se(),c=u.useMemo(()=>{let h=o;if(o?.type===b.Textdoc){const v=d?.[o.textdocId];v&&(h={...o,textdocId:v})}return h},[o,d]);u.useEffect(()=>{F()},[e]);const n=c&&(t?i.jsx(He,{clientThreadId:e,onClose:j,focusedObject:c},"canvas-sidebar"):i.jsx(Ue,{clientThreadId:e,onClose:j,focusedObject:c},"canvas-modal"));u.useEffect(()=>{if(c)return O(h=>Ne(h,c)),()=>O(null)},[c,d]);const l=k(),g=G+400+64+Te+ye,p=n!=null;return u.useEffect(()=>{const h=l&&a.getState().isSidebarOpen&&window.innerWidth<g;return h&&p&&s.closeSidebar(),D.setActiveStageSidebar(p),()=>{p&&(l&&h&&s.openSidebar(),D.setActiveStageSidebar(!1))}},[p,a,s,l,g]),r!==e?null:i.jsx(we,{children:n})},dt=e=>{const a=u.useRef(null);return i.jsx(P,{ref:a,onError:(s,t)=>{F(),setTimeout(()=>{a.current?.resetErrorBoundary()}),me.logError("Error boundary hit",s,{componentStack:t})},name:"canmore-focused-view",children:i.jsx(Ve,{...e})})};export{dt as CanvasFocusedViewManager};
//# sourceMappingURL=keitruny7xvt8zoi.js.map
