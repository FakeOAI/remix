const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/sso-j86rkpjzhf17bvy6.js","assets/emaotesjjrbo0vnn.js","assets/i2h9sd6w9obmp6kj.js","assets/root-c2ck6e7e.css","assets/pfgfa28h4zko09ji.js","assets/conversation-small-gncbdz17.css","assets/uum3qt88kgyy5xax.js","assets/f4d4hsc2yuigyhy9.js","assets/kn0ak9fkjsb1xfsy.js","assets/fokwkkbk6knx4amm.js","assets/hd7b3v6d032g9uc2.js","assets/kye660kh5ct8polq.js","assets/cwrkr657k0yctpo3.js","assets/k4xw2es9s9q81zyc.js","assets/ljecs4cg1y5g65up.js","assets/eob1xdp4kpugfu4x.js","assets/ey4rj8mbwa32kgc2.js","assets/c467ue4i5lbeb89f.js","assets/3p05eijvj4g6mqye.js","assets/itghwucfyv5ciib7.js","assets/b0ipzc3x8nonv0ce.js","assets/j8erhhhcmofta5pt.js","assets/lpind7u7kxg5epnf.js","assets/eucqo6o6hyu0egye.js","assets/lnzhx8yc876tttki.js","assets/983a0dy92b3ronpv.js","assets/cs4bjp92e9nxt329.js","assets/kqwdyvkaaavvn8k3.js","assets/byijvpmq97km2lrm.js","assets/csbslavgyt6i53et.js","assets/ge6isglz9xrj5wqv.js","assets/bybn08hitelouvnc.js","assets/e9lafxuzyeh4418f.js","assets/bebphm0teh27dp33.js","assets/e119zo881rsl8gp6.js","assets/ndxe446nd815wevs.js","assets/g8sx3eix2jticw3k.js","assets/o64e5uf1vpuc7u6u.js","assets/j7csdhafwm3typw2.js","assets/iej0cupg2dqkmejt.js","assets/zv6fyhpqeaapss5a.js","assets/gxso8g2takgmhjtl.js","assets/jk8w36bsokizpx57.js","assets/gp7374ju1voyvsik.js","assets/m4qavq6u1tv4dyuu.js","assets/fy8fd66itbk1l0er.js","assets/rh5b08odrk9wf7sr.js","assets/hai6ts4stzvmr0rr.js","assets/cp31o4r3h0au8ghs.js","assets/maa35cw6f615gn3x.js","assets/e2j0okib9lbb8e0b.js","assets/nkzzqp3mqjhb9ebn.js","assets/kad7loaf7djyppb1.js","assets/jo829q2ctc26m0v8.js","assets/h2ogvhqe0xseyoo4.js","assets/iokid8u61yzd9i3r.js","assets/m6p529gvpob3zv4v.js"])))=>i.map(i=>d[i]);
import{r as d,aw as Me,a6 as e,P as W,d as G,aG as P,b3 as Fa,g8 as Lo,bU as La,c as $r,f as Kr,ax as En,aj as te,ak as ve,cB as Nn,aB as Ge,c2 as Ct,R as be,ar as T,aZ as Pe,da as Oo,bF as Bo,U as kt,g9 as Yr,ga as Xr,a7 as Nt,dD as Qr,c_ as Oa,b0 as zo,bY as Uo,aE as Rt,aF as Pt,w as Ie,a2 as Qs,S as re,aY as It,b7 as fs,aK as qe,aa as Zs,a5 as Ho,aJ as Ba,a3 as Dt,$ as Go,Z as Js,bR as en,an as Ft,cX as Zr,eL as Qn,I as tt,aR as lt,bO as Jr,bP as el,bQ as tl,s as sl,bs as De,D as Rn,O as Wo,a0 as nl,a8 as za,j as Vo,eH as al,K as Ye,v as qo,n as vt,gb as ol,at as $o,gc as Ua,a9 as il,X as Zn,gd as rl,dx as ll,dy as cl,dB as os,dz as Ha,dA as dl,c1 as yt,ge as ul,M as _t,aO as hl,cQ as ml,a_ as fe,aP as fl,bL as gl,b6 as pl,gf as xl,di as Sl}from"./emaotesjjrbo0vnn.js";import{mj as tn,nC as bl,nD as vl,bh as gs,e5 as yl,nE as wl,nF as jl,fT as sn,fU as ct,bA as ps,nG as Ml,dr as We,cL as Ko,cO as Yo,aj as Cl,a2 as kl,da as _l,cK as Tl,nH as Ne,nI as Tt,nJ as Al,nK as El,nL as Nl,nM as Rl,nN as Pl,nO as Il,mn as Dl,d_ as dt,nP as Fl,nQ as Ll,v as J,nR as Ol,nS as ie,nT as Xo,nU as Qo,nV as Jn,nW as Bl,nX as Zo,ne as ea,nY as ta,nZ as zl,n_ as Ul,n$ as nn,o0 as es,iJ as Pn,cw as an,dA as sa,F as on,o1 as Jo,o2 as Hl,o3 as Gl,o4 as Wl,mS as rs,s as ei,o5 as Vl,o6 as ql,o7 as $l,d6 as ti,cW as Kl,o8 as Yl,jB as Xl,fF as Ql,o9 as Zl,oa as Jl,ob as si,oc as ec,b7 as Xe,od as tc,oe as Hs,r as Ga,gJ as sc,i4 as nc,gB as ac,of as ni,ic as oc,kl as ic,og as ai,oh as rc,d5 as lc,hJ as na,fL as aa,oi as cc,oj as oi,dE as ls,cC as At,ok as ii,ol as ri,cx as rn,dx as cs,p as li,om as Ve,on as ci,oo as dc,op as uc,oq as Gs,or as hc,os as mc,ot as fc,ou as gc,n as pc,ov as xc,ow as Sc,ox as bc,oy as vc,oz as ln,oA as oa,oB as yc,dF as di,oC as wc,bc as Lt,oD as jc,mu as ui,oE as Mc,cs as Cc,cq as kc,oF as _c,m9 as Ws,aa as ia,gy as hi,t as Tc,fJ as mi,iH as Wa,oG as Ac,oH as Ec,iI as Nc,mR as Rc,m_ as Va,oI as Pc,oJ as Ic,iG as Dc,oK as Fc,gn as fi,oL as Lc,oM as Oc,kr as gi,fS as pi,A as ra,oN as qa,cl as Bc,oO as zc,oP as Uc,ft as Hc,mP as Gc,fu as Wc,fv as Vc,oQ as xi,oR as In,oS as qc,oT as $c,oU as Kc,oV as Yc,oW as Xc,bZ as Si,U as ds,bV as la,bY as Qc,oX as Zc,oY as Jc,oZ as ed,o_ as td,o$ as sd,p0 as nd,p1 as ad,p2 as od,dv as id,fw as rd,a8 as Et,p3 as ld,p4 as cd,b$ as bi,p5 as dd,p6 as ud,p7 as hd,p8 as md,p9 as fd,pa as gd,dq as ca,d$ as da,a7 as ua,pb as vi,pc as ha,cD as us,pd,pe as xd,pf as Sd,fh as et,iD as Vs,mo as Dn,iz as yi,fW as wi,pg as ji,ph as bd,pi as vd,pj as yd,cv as ma,cA as Fn,pk as wd,pl as Mi,ds as cn,pm as jd,cu as Os,pn as Ln,d as Ci,po as $a,pp as Md,pq as Cd,pr as kd,ct as _d,ps as Td,pt as Ad,u as Ed,dB as Nd,pu as ki,dC as fa,kq as ga,fo as Rd,b_ as Pd,c5 as Id,pv as Dd,m as Fd,pw as Ze,q as _i,px as Ld,dD as Mn,py as Ti,l as Od,i as Bd,iZ as Ps,pz as zd,dO as Ud,pA as Hd,dX as Gd,iP as Wd,pB as Vd,pC as qd,pD as $d,f1 as Kd,nu as Yd,pE as Xd,pF as Qd,pG as Ai,pH as Ei,li as Ni,pI as Zd,jP as Jd,l6 as pa,dj as Ri,pJ as eu,pK as ts,pL as tu,bw as Pi,pM as su,ae as Ii,hY as nu,pN as Di,pO as Ka,pP as On,pQ as au,fZ as ss,eR as ou,f_ as qs,mZ as $s,pR as Bn,pS as iu,pT as ru,pU as lu,pV as cu,k5 as Ya,pW as Is,g1 as Ke,pX as du,ch as Fi,ci as Li,e1 as uu,pY as hu,fH as mu,lg as fu,cz as Oi,mp as gu,pZ as pu,p_ as xu,p$ as Su,q0 as bu,dt as vu,fY as yu,q1 as wu,q2 as ju,q3 as Mu,q4 as Cu,q5 as ku,q6 as _u,q7 as Tu,q8 as Au,q9 as Eu,c7 as Bi,jN as Nu,kY as Ru,kX as Pu,qa as Iu,qb as Du,qc as zi,gN as Fu,gk as Ui,qd as Lu,gi as Ou,j$ as Bu,gj as Cn,qe as zu,qf as Uu,gu as Hu,gl as Gu,qg as Wu,le as Vu,lf as qu,gE as $u,cV as Ku,b6 as Yu,gC as Xu,gD as Qu,gF as Zu,qh as Ju,go as Xa,c8 as eh,c9 as th,iT as sh,qi as nh,hU as ah}from"./pfgfa28h4zko09ji.js";import{e as xs,P as Ss,d as oh,D as ih,T as zn,g as rh,E as lh,h as ch}from"./fjxlwcafgbqx6k83.js";import{p as dh,k as Un,c as Qa,h as uh,u as hh,r as Za,g as mh,i as fh,n as gh}from"./krrjy8wlh5tt1p9i.js";import{g as ph,c as xh,C as Hn,d as Sh}from"./opzvq2rekkh5bmjo.js";import{b$ as bh,aa as vh,c0 as yh,bO as wh,ad as jh,c1 as Mh,d as Hi,bI as Ch,p as kh,ar as xa,bm as _h,ap as Gi,c2 as bs,ae as Wi,H as Th,c3 as Ah,bA as Vi,au as Eh,bQ as Nh,c4 as Rh,a1 as Ph,c5 as Ih,c as qi,aJ as dn,a4 as Dh,c6 as $i,aV as Fh,c7 as Lh,aU as Oh,bJ as Bh,E as zh,bj as Ki,bk as Yi,b as Uh,al as Hh,ak as Gh,b4 as Wh,P as Vh,bo as qh,X as $h,bD as Kh}from"./i2h9sd6w9obmp6kj.js";import{m as ne}from"./kye660kh5ct8polq.js";import{n as Yh,w as Bs,o as Xh,p as Qh,q as Zh}from"./uum3qt88kgyy5xax.js";import{D as B,B as Jh,$ as Xi}from"./f4d4hsc2yuigyhy9.js";import{b as em}from"./h5woj1r6i6wwcaf0.js";import{S as Qi,a as tm,b as sm,G as nm,L as am,c as om}from"./kad7loaf7djyppb1.js";import im from"./l55ilh4snakvqc47.js";import{I as rm,B as lm}from"./hd7b3v6d032g9uc2.js";import{a as cm}from"./m4qavq6u1tv4dyuu.js";const Zi=new xs("transactionEventPlugin"),Gn="prosemirrorDispatchTransaction";function Ja(t,s){const{eventTarget:n}=Zi.getState(t.state);return n.addEventListener(Gn,s),()=>{n.removeEventListener(Gn,s)}}function dm(t){return new Ss({key:Zi,state:{init(){return{eventTarget:t}},apply(s,n){return n}}})}const zs=new xs("customKeymapPlugin");function um(t,s){t.dispatch(t.state.tr.setMeta(zs,{handlers:s}))}function hm(t={handlers:{}}){return new Ss({key:zs,state:{init(){return{...t}},apply(s,n){const a=s.getMeta(zs);return a?{...n,...a}:n}},props:{handleKeyDown(s,n){const o=zs.getState(s.state).handlers[n.key];return o?o(n):!1}}})}const rt=new xs("menuSelectorPlugin");function wt(t){t.dispatch(t.state.tr.setMeta(rt,{active:!1,onMenuAction:void 0}))}function mm(t,s){t.dispatch(t.state.tr.setMeta(rt,{active:!0,onMenuAction:s}))}function fm(t={submitKeys:["Enter","Tab"],cancelKeys:["Escape"],checkStrictMatchKeys:[]}){return new Ss({key:rt,state:{init(){return{...t,active:!1}},apply(s,n){const a=s.getMeta(rt);return a?{...n,...a}:n}},props:{handleKeyDown(s,n){const a=rt.getState(s.state);return a.active?a.submitKeys.includes(n.key)?(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),a.onMenuAction?.("submit"),wt(s),!0):a.cancelKeys.includes(n.key)?(n.preventDefault(),a.onMenuAction?.("cancel"),wt(s),!0):n.key==="ArrowUp"?(n.preventDefault(),a.onMenuAction?.("up"),!0):n.key==="ArrowDown"?(n.preventDefault(),a.onMenuAction?.("down"),!0):(a.checkStrictMatchKeys.includes(n.key)&&a.onMenuAction?.("checkMatch"),!1):!1},handleDOMEvents:{blur:s=>{rt.getState(s.state).onMenuAction?.("cancel")}}}})}const ns=new xs("placeholderPlugin");function gm(t){return new Ss({key:ns,state:{init(){return{placeholder:t}},apply(s,n){return s.getMeta(ns)?{placeholder:s.getMeta(ns).placeholder}:n}},props:{decorations(s){const{doc:n}=s;if(n.childCount===1&&n.firstChild?.isTextblock&&n.firstChild.content.size===0){const o=[],{placeholder:i}=ns.getState(s);return s.doc.descendants((r,l)=>{const c=oh.node(l,l+r.nodeSize,{class:"placeholder","data-placeholder":i});o.push(c)}),ih.create(n,o)}}}})}const un="command_token",pm={group:"inline",inline:!0,atom:!0,content:"text*",attrs:{id:"",hint:""},selectable:!1,draggable:!1,toDOM:t=>["span",{"data-mention-id":t.attrs.id,"data-mention-hint":t.attrs.hint,class:"hint-pill"},t.attrs.hint],parseDOM:[{tag:"span[data-mention-id][data-mention-hint]",getAttrs:t=>{const s=t.getAttribute("data-mention-id"),n=t.getAttribute("data-mention-hint");return{id:s,hint:n}}}]};function Ji(t,s){if(t.depth===0)return;const n=t.before(),o=t.doc.textBetween(n,t.pos,`
`,"\0").match(new RegExp(/(^|\s)\/(\w*)$/));if(o&&o.index!==void 0){const i=o[0].startsWith(" ")?o.index+1:o.index,r=o[0].startsWith(" ")?o[0].length-1:o[0].length,l=t.start()+i,c=l+r,h=l===s?.from;return{range:{from:l,to:c},queryText:o[2],isDismissed:h}}}const hs=new xs("slashCommandPlugin");function xm(t){const n=t.state.selection.$from,a=Ji(n,void 0);if(!a)return;const o=t.state.tr;t.dispatch(o.setMeta(hs,{...o.getMeta(hs),dismissedRange:a.range}))}function eo(){return{queryText:"",active:!1,range:void 0}}function Sm(t,s,n,a,o,i){let r;if(s.id===tn.Search&&o)r=t.state.tr.delete(n.from,n.to),i(!0);else{const l=t.state.schema.nodes[un].create({...s},t.state.schema.text(s.hint));r=t.state.tr.replaceWith(n.from,n.to,l),a&&r.insertText(" ",n.from+l.nodeSize)}t.dispatch(r)}function to(t){const{active:s,range:n,queryText:a,onHintMatch:o,dismissedRange:i}=t;if(o)return!s||!n||i?.from===n.from?o(void 0):o({text:a,range:n})}function bm(t){const s=[];return t.descendants(n=>{n.type.name===un&&typeof n.attrs?.id=="string"&&s.push(n.attrs.id)}),s}function vm(t){const s=t.state.tr;s.doc.descendants((n,a)=>{n.type.name===un&&s.insertText(n.textContent,a,a+n.nodeSize)}),s.steps.length>0&&t.dispatch(s)}function ym(){return new Ss({key:hs,state:{init(){return eo()},apply(t,s){const n=t.getMeta(hs),a=t.selection,o=a.$from,i=Ji(o,s.dismissedRange),r={...eo(),...s,...n};return a.from!==a.to?(to(r),r):(r.active=!!i,i&&(r.queryText=i.queryText,r.range=i.range,i.isDismissed&&(i.queryText===""&&s.queryText!==""?r.dismissedRange=void 0:r.dismissedRange=i.range)),to(r),r)}}})}class hn extends bl{constructor(s){super(),this.view=s}get document(){return this.view.dom.ownerDocument}isEmpty(){return this.view.state.doc.textContent.trim().length===0}trimLeadingText(s){const a=this.view.state.tr;let o=!1,i=!1;return a.doc.descendants((r,l)=>{o||!r.isText||(o=!0,r.text?.startsWith(s)&&(i=!0,a.insertText(r.text.replace(s,""),l,l+r.text.length)))}),i&&this.view.dispatch(a),i}replaceAll(s,n){const o=this.view.state.tr,i=[];o.doc.descendants((r,l)=>{!r.isText||r.text===void 0||i.push({node:r,pos:l})}),i.reverse(),i.forEach(({node:r,pos:l})=>{!r.isText||r.text===void 0||r.text.includes(s)&&o.insertText(r.text.replaceAll(s,n),l,l+r.text.length)}),this.view.dispatch(o)}appendText(s){this.view.dispatch(this.view.state.tr.insertText(s))}focus(){this.view.focus(),this.view.dispatch(this.view.state.tr.setSelection(zn.atEnd(this.view.state.doc)))}setText(s){const{tr:n,schema:a}=this.view.state,o=s?a.nodes.paragraph.create(null,a.text(s)):a.nodes.paragraph.create();this.view.dispatch(n.replaceWith(0,this.view.state.doc.content.size,o)),this.view.hasFocus()&&this.view.dispatch(this.view.state.tr.setSelection(zn.atEnd(this.view.state.doc)))}getCurrentText(){return this.view.state.doc.textContent}hasMultipleLines(){let s=0;return this.view.state.doc.descendants(n=>{n.isBlock&&s++}),s>1}getContentToSend(){return dh(this.view)}resize(){}isReady(){return!!this.view.state.doc}setPlaceholder(s){this.view.dispatch(this.view.state.tr.setMeta(ns,{placeholder:s}))}getSelectionStart(){return this.view.state.selection.ranges[0].$from.pos}isMenuSelectorActive(){return rt.getState(this.view.state).active}registerKeyHandlers(s){um(this.view,s)}acceptLegacyKeydown(){return!1}subscribe(s,n){if(s==="change"){const a=()=>n(void 0);return Ja(this.view,a)}return this.view.dom?.addEventListener(s,n),()=>{this.view.dom?.removeEventListener(s,n)}}useState(s){return d.useSyncExternalStore(n=>Ja(this.view,n),()=>s(this),()=>s(this))}getSystemHintsFromDoc(){return bm(this.view.state.tr.doc)}getSystemHints(){const s=this.getSystemHintsFromDoc();return s.length?[s[0]]:[]}replaceSlashCommandTokensWithText(){vm(this.view)}canShowAutocompletion(){return!this.isMenuSelectorActive()&&!this.getSystemHintsFromDoc().length}}const so=Me.div`m-8 flex flex-col items-center`;function no(t){return e.jsx(ne.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...t})}function wm({clientThreadId:t}){const n=vl(t)?.gizmoId,{data:a}=gs(n);return n==null||a==null||!yl(a)?null:e.jsx(jm,{gizmoId:n})}function jm({gizmoId:t}){const[s,n]=d.useState(!1),[a,o]=d.useState(!1),i=wl(t),r=async c=>{n(!0),setTimeout(()=>{o(!0)},5e3),W.logEvent(G.submitInlineRating,{gizmo_id:t,rating:c}),await i.mutateAsync({rating:c})},l=async()=>{o(!0),W.logEvent(G.dismissInlineRating,{gizmo_id:t}),await i.mutateAsync({})};return d.useEffect(()=>{a||W.logEvent(G.showInlineRating,{gizmo_id:t})},[a,t]),a?null:s?e.jsx(so,{children:e.jsxs(no,{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"rounded-lg border border-token-border-heavy p-4",children:e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(P,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),e.jsx(Fa,{onClick:()=>{o(!0)}})]})}),e.jsx("div",{className:"text-xs text-token-text-tertiary",children:e.jsx(P,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):e.jsx(so,{children:e.jsxs(no,{className:"flex flex-col items-center gap-4 rounded-lg border border-token-border-heavy p-4",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(P,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),e.jsx(Fa,{onClick:l})]}),e.jsx(jl,{rating:void 0,onRating:r})]})})}const Mm=({clientThreadId:t})=>{const s=Lo(),n=sn(t),a=ct(n);d.useEffect(()=>{a&&La.dismissBanner()},[a]);const o=s?.is_dismissible?()=>La.dismissBanner():void 0;return e.jsx(ps,{children:s&&e.jsx(ne.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(Ml,{clientThreadId:t,rateLimitInfo:s,onDismiss:o})})})};function Cm(t){const s=sn(t),n=ct(s),a=Lo();return!n&&a!=null}const Wn=window.sessionStorage,Vn=$r(Kr(()=>({memoryFullBannerDismissed:!!Wn?.getItem(En.MemoryFullBannerDismissed)}))),er={dismissBanner(){Vn.setState(t=>{t.memoryFullBannerDismissed=!0}),Wn?.setItem(En.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){Vn.setState(t=>{t.memoryFullBannerDismissed=!1}),Wn?.removeItem(En.MemoryFullBannerDismissed)}};function km(t){const s=We(t),n=Ko(),{data:a}=Yo(s,!1,n),o=a!=null,i=o&&a.memoryFullPct>=100,[r,l]=d.useState(!1);d.useEffect(()=>{!i&&o&&(l(!0),er.clearDismissedBanner())},[i,o]);const c=Vn(h=>h.memoryFullBannerDismissed);return i&&r&&!c}function _m(){const t=te(),{openSettings:s}=Cl();return e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(kl,{title:t.formatMessage(Ds.memoryFullTitle),content:t.formatMessage(Ds.memoryFullTooltip,Ds.memoryFullTooltip.values),primaryCtaText:t.formatMessage(Ds.memoryManageButton),onPrimaryCtaClick:()=>s(_l.Personalization),onDismiss:()=>er.dismissBanner()})})}const Ds=ve({memoryFullTitle:{id:"yRGU2/",defaultMessage:"Memory is full."},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"neUc+N",defaultMessage:"New memories won’t be created until you make space. <a>Learn more</a>",values:{a:t=>e.jsx("a",{href:Tl,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}}}),Tm=d.memo(function(s){return Am(s),Em(s),Nm(),null});function Am(t){const{store:s}=Ne(),n=s.useSetSharedProps();Nn(()=>{n(t)},[t,n])}function Em(t){const{clientThreadId:s,canContinue:n}=t,{store:a}=Ne(),o=d.useRef({top:a.useContentAreaApi(Tt.HeaderTop),bottom:a.useContentAreaApi(Tt.HeaderBottom)}).current,i=Im(t),r=Al(s),{shouldShowBannerSignup:l,shouldShowBannerTermsDisclaimer:c}=Dm(s),h=Cm(s),u=El(t),f=Nl(t),g=Rl(t),p=km(s),y=Pl(),m=Il(t);Nn(()=>{m.eligible?o.top.set(ie.AdvancedVoiceOnMobileAnnouncement):y?o.top.set(ie.ParagenControls):c?o.top.set(ie.BannerTermsDisclaimer):h?o.top.set(ie.BannersRateLimit):u.eligible?o.top.set(ie.BannerSidekickAnnouncement):f?o.top.set(ie.SearchBrowserExtensionAnnouncement):g?o.top.set(ie.SearchBrowserExtensionReactiveAnnouncement):i?o.top.set(ie.ItemActions):n?o.top.set(ie.PromptTextareaAction):l?o.top.set(ie.BannerSignup):p?o.top.set(ie.BannerMemoryFull):o.top.set(null)},[o,i,n,c,l,h,u,p,y,m]),Nn(()=>{r&&o.bottom.set(Xo.DallePromptControls)},[o,r])}function Nm(){const{store:t}=Ne();d.useEffect(()=>()=>{t.reset()},[t])}function Rm(t){const s=Qo(),n=dt(t),a=J.getTree(t).getLastValidNode(n)?.message?.id;return s?.messageId===a?s.suggestions:[]}function Pm(t){return Rm(t).length>0}function Im(t){const s=Dl(t.clientThreadId),n=Pm(t.clientThreadId);return t.isDisabled?!1:t.isNewThread||s||n}function Dm(t){const{isUnauthenticated:s}=Ge(),n=dt(t),{layer:a}=Ct("3637408529"),o=a.get("should_show_no_auth_signup_banner",!0),i=Fl(g=>g.bannerDisclaimerClientThreadId),r=Ll(),l={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1};if(!t)return l;const c=J.getTree(t),h=c.countMessagesByAuthor(be.User),u=c.getNodeByIdOrMessageId(n),f=u?.message?.author.role===be.Assistant&&Ol(u.message);return l.shouldShowBannerTermsDisclaimer=f&&s&&h===1&&!r&&(i==null||i===t),l.shouldShowBannerSignup=o&&f&&s&&h>0&&h%5===0,l}function tr({children:t,className:s,showBackground:n}){return e.jsxs("div",{className:"relative",children:[t,n&&e.jsx(ne.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:T("pointer-events-none absolute bottom-0 top-0 h-8 w-8 rounded-full",s)})]})}function ao({entry:t,onClick:s}){const{connectorConfig:n}=Jn();d.useEffect(()=>{if(!open||t.type!==Pe.GDRIVE)return;const l=n.get(Pe.GDRIVE)?.access_token;l&&Bl(l)},[n,t.type]);const a=Zo(t.type),o=te(),i=t.access_token?oo.uploadFromMessage:oo.signinWithMessage;return e.jsx(B.Item,{onClick:s,icon:a,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx(P,{...i,values:{connectorName:ea(t.type,o)}}),t.type===Pe.O365_BUSINESS&&e.jsx("div",{className:"text-s text-token-text-tertiary",children:e.jsx(P,{...ta.includesSharePoint})})]})},t.id)}const oo=ve({signinWithMessage:{id:"ContextConnectorPickerDropdownItem.signInWithMessage",defaultMessage:"Connect to {connectorName}"},uploadFromMessage:{id:"ContextConnectorPickerDropdownItem.uploadWithMessage",defaultMessage:"Add from {connectorName}"}});function Fm({clientThreadId:t,icon:s,setOpen:n,isDisabled:a=!1,highlightTooltip:o=!1}){const i=Oo(),r=te();return a=a||!!i,e.jsxs(e.Fragment,{children:[e.jsx(B.Trigger,{className:"m-0 h-0 w-0 border-none bg-transparent p-0"}),e.jsx(zl,{clientThreadId:t,rateLimitPopup:i,highlightTooltip:o,children:e.jsx(Ul,{disabled:a,"aria-disabled":a,"aria-label":r.formatMessage({id:"tA7CXR",defaultMessage:"Attach files"}),onClick:l=>{l.preventDefault(),n(!0)},children:s})})]})}function Lm({connectorEntries:t,onOauthRedirect:s}){const n=te();return e.jsxs(B.Sub,{children:[e.jsx(B.SubMenuTrigger,{icon:bh,children:e.jsx("div",{className:"line-clamp-1 text-ellipsis",children:e.jsx(P,{...Om.connectApps})})}),e.jsx(B.Portal,{children:e.jsx(B.SubContent,{children:t.map(a=>e.jsx(B.Item,{onClick:()=>s(a),icon:Zo(a.type),children:e.jsxs("div",{className:"flex flex-col",children:[ea(a.type,n),a.type===Pe.O365_BUSINESS&&e.jsx("div",{className:"text-s text-token-text-tertiary",children:e.jsx(P,{...ta.includesSharePoint})})]})},a.id))})})]})}const Om=ve({connectApps:{id:"ContextConnectorPicker.connectApps",defaultMessage:"Connect apps"}});function Bm({onOauthRedirect:t,connectors:s}){const n=te();return e.jsxs(B.Sub,{children:[e.jsx(B.SubMenuTrigger,{icon:vh,children:e.jsx(P,{...zm.oneDriveSubmenuName})}),e.jsx(B.Portal,{children:e.jsx(B.SubContent,{children:s.map(a=>a?e.jsx(B.Item,{onClick:()=>t(a),children:e.jsxs("div",{className:"flex flex-col",children:[ea(a.type,n),a.type===Pe.O365_BUSINESS&&e.jsx("div",{className:"text-s text-token-text-tertiary",children:e.jsx(P,{...ta.includesSharePoint})})]})},a.id):null)})})]})}const zm=ve({oneDriveSubmenuName:{id:"ContextConnectorPickerOneDriveSubmenu.oneDriveSubmenuName",defaultMessage:"Connect to Microsoft OneDrive"}}),Um={"image/jpeg":".jpg","image/png":".png"};function Hm({entry:t}){return e.jsx(B.Item,{onClick:t.onClick,icon:t.icon,children:e.jsx(P,{...t.label})},t.key)}function Gm(t){const s=te(),n=Nt(),a=nn();return d.useCallback(async i=>{const r=`${new Date().toISOString().replaceAll(":","-")}${Um[i.mimeType]}`;es.uploadFile(a,new File([i.data],r,{type:i.mimeType}),t,s,n,void 0,void 0,Pn.Multimodal)},[a,s,n,t])}function Wm(t){const s=Gm(t),n=Vm(s),a=qm(s);return{desktopConnectors:d.useMemo(()=>Bo?[n,a].filter(i=>i!==void 0):[],[n,a])}}function Vm(t){const{value:s}=kt("4204519260");return d.useMemo(()=>{if(s)return{key:"takeScreenshot",label:sr.takeScreenshot,icon:yh,onClick:async()=>{const n=await Yr();n&&(W.logEvent(G.sidetronScreenshotAttached),await t(n))}}},[s,t])}function qm(t){const{value:s}=kt("239993468");return d.useMemo(()=>{if(s)return{key:"takePhoto",label:sr.takePhoto,icon:wh,onClick:async()=>{const n=await Xr();n&&(W.logEvent(G.sidetronPhotoAttached),await t(n))}}},[s,t])}const sr=ve({takeScreenshot:{id:"ContextConnectorPickerDropdownItem.takeScreenshotDesktop",defaultMessage:"Take screenshot"},takePhoto:{id:"ContextConnectorPickerDropdownItem.takePhotoDesktop",defaultMessage:"Take photo"}});function $m(){const{connectorConfig:t}=Jn(),s=an(),n=ti(),[a,o]=rs(ei([...t.values()],u=>!!u.access_token),u=>!!u.access_token),[i,r]=rs(o,u=>u.type===Pe.O365_PERSONAL||u.type===Pe.O365_BUSINESS),l=!s&&!n&&a.length>0,c=!s&&!n&&!l&&i.length>1;return{unconnectedConnectors:n?[]:c?r:o,showUnconnectedInSubmenu:l,showOneDriveInSubmenu:c}}function Km({clientThreadId:t,icon:s,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:a,attachmentsProductFeature:o,onOauthRedirect:i,uploadType:r,getInputProps:l,openFileDialog:c,isDisabled:h=!1,highlightTooltip:u=!1}){const{currentLocale:f}=Qr(),g=te(),p=Nt(),y=nn(),m=an(),{connectorConfig:b,isLoading:x}=Jn(),M=sa(on.ContextConnectors),{getGizmoId:S}=Jo(),[v,C]=d.useState();d.useEffect(()=>{S?S().then(I=>C(I)):C(void 0)},[S]);const F=d.useRef(null),[N,j]=d.useState(!1),w=d.useRef(!1),k=d.useCallback(()=>{const I=F.current?.files;Array.from(I??[]).forEach(ce=>es.uploadFile(y,ce,a,g,p,o))},[y,a,g,p,o]),[X,U]=d.useState(null),R=d.useCallback(()=>U(null),[U]),O=d.useCallback((I,ce)=>es.uploadPickedFile(y,I,ce,a,n,o,v,g,p),[y,a,n,o,v,g,p]),{openMenu:L,confirmMenuOpened:E}=Hl();d.useEffect(()=>{L&&(j(!0),E())},[L,E,j]);const _=d.useCallback(I=>{es.doContextConnectorOauthRedirect(location.pathname+location.search+location.hash,I,i,Oa.Picker),i()},[i]),V=d.useCallback(I=>{es.uploadPickedFile(y,I,Pe.GDRIVE,a,n,o,v,g,p)},[y,a,n,o,v,g,p]),q=d.useCallback(async I=>{const{access_token:ce}=I;if(!ce){_(I);return}switch(Gl(I,Oa.Picker),I.type){case Pe.GDRIVE:Wl(f,I.type,ce,Fe=>Fe.forEach(V));break;case Pe.O365_PERSONAL:case Pe.O365_BUSINESS:U(I.type);break}},[V,_,U,f]),K=()=>{W.logEvent(G.openFileViewer,{intent:r.toString()}),c()},H=I=>{if(!I&&w.current&&!x)K();else if(I&&we&&!x){K();return}j(I),I&&(M.eligible&&M.markAsViewed(),W.logEvent(G.composerOpenContextConnectorPicker),w.current=!0,setTimeout(()=>{w.current=!1},250))},[Z,ye]=rs(ei([...b.values()],I=>!!I.access_token),I=>!!I.access_token);Ym(Z,q);const[me]=rs(ye,I=>I.type===Pe.O365_PERSONAL||I.type===Pe.O365_BUSINESS),{unconnectedConnectors:le,showUnconnectedInSubmenu:oe,showOneDriveInSubmenu:Ae}=$m(),{desktopConnectors:se}=Wm(a),we=!Z.length&&!le.length&&!se.length,xe=e.jsxs(e.Fragment,{children:[oe&&le.length>0&&e.jsx(Lm,{connectorEntries:le,onOauthRedirect:I=>_(I)}),!oe&&le.map(I=>e.jsx(ao,{entry:I,onClick:()=>q(I)},I.id)),Ae&&e.jsx(Bm,{connectors:me,onOauthRedirect:_}),x&&e.jsx(B.Item,{icon:e.jsx(zo,{className:"text-token-text-secondary"})}),(le.length>0||x)&&e.jsx(B.Separator,{}),Z.map(I=>e.jsx(ao,{entry:I,onClick:()=>q(I)},I.id)),se.map(I=>e.jsx(Hm,{entry:I},I.key)),e.jsx(B.Item,{onClick:K,icon:jh,children:e.jsx(P,{...m?io.uploadFileMobile:io.uploadFile})},"upload")]}),Ce=e.jsxs("div",{className:"flex flex-col",children:[e.jsx(Vl,{type:X,onClose:R,uploadPickedFile:O}),e.jsx("input",{onChange:k,...l({className:"hidden"})}),e.jsxs(B.Root,{open:N,onOpenChange:H,children:[e.jsx(Fm,{clientThreadId:t,icon:s,setOpen:H,isDisabled:h,highlightTooltip:u}),e.jsx(B.Portal,{children:e.jsx(B.Content,{size:"large",children:xe})})]}),e.jsx(ql,{hasConnectors:!x&&!we})]});return{dropdownItems:xe,mainComponent:Ce}}function Ym(t,s){const{connector:n,clearParam:a}=$l(),o=t.find(i=>i.type===n&&!!i.access_token);d.useEffect(()=>{o&&(s(o),a())},[o,s,a])}function Xm(t){const{mainComponent:s}=Km(t);return s}const io=ve({attachFiles:{id:"ContextConnectorPicker.attachFiles",defaultMessage:"Attach files"},uploadFile:{id:"LocalFileDropdownItem.uploadFile",defaultMessage:"Upload from computer"},uploadFileMobile:{id:"LocalFileDropdownItem.uploadFileMobile",defaultMessage:"Upload file"}});function Qm({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:a,attachmentsProductFeature:o,getInputProps:i,openFileDialog:r,onOauthRedirect:l,historyDisabled:c,isDisabled:h,highlightTooltip:u}){const f=ti(),{gdriveStatus:g,o365Status:p}=Kl(),y=e.jsx(Mh,{className:c?"text-white":u?"text-brand-blue-800":void 0}),m=g!=="false"||p!=="false"||f;return e.jsx("div",{className:T("relative",h&&"pointer-events-none opacity-30"),children:e.jsx(tr,{showBackground:u,className:"bg-brand-blue-800/20",children:m?e.jsx(Xm,{clientThreadId:t,icon:y,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:a,attachmentsProductFeature:o,onOauthRedirect:l,uploadType:s,openFileDialog:r,getInputProps:i,isDisabled:h,highlightTooltip:u}):e.jsx(Yl,{clientThreadId:t,uploadType:s,openFileDialog:r,getInputProps:i,icon:y,isDisabled:h,highlightTooltip:u})})})}function Zm(){return Un({"Shift-Enter":(t,s)=>Qa(t,s),Enter:(t,s)=>window.innerWidth>Xl[Ql.Medium]?!1:Qa(t,s)})}const Jm=["p",0],ef=["br"],tf=new rh({nodes:{paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p",preserveWhitespace:"full"}],toDOM(){return Jm}},text:{group:"inline"},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM(){return ef}},[un]:pm,doc:{content:"block+"}},marks:{}});function sf(){const t=new EventTarget,s=new lh(null,{state:ch.create({schema:tf,plugins:[uh(),fm({submitKeys:["Enter","Tab"],cancelKeys:["Escape"],checkStrictMatchKeys:[" "]}),gm(""),ym(),Zm(),Un({"Mod-z":hh,"Mod-y":Za,"Mod-Shift-z":Za}),hm(),Un(em),dm(t),mh()]}),dispatchTransaction(n){const a=s.state.apply(n);s.updateState(a),n.docChanged&&t.dispatchEvent(new Event(Gn))},handlePaste(n,a){const o=a.clipboardData?.getData("text/plain");return o===void 0?!1:(Zl(o)||fh(n,o),!0)},clipboardTextSerializer(n){return gh(n.content).content}});return s}function nf(){try{return navigator.userAgent.toLocaleLowerCase().includes("firefox")}catch{return!1}}const af=[T([Jl["prosemirror-parent"],"text-token-text-primary","max-h-[25dvh]","max-h-52","overflow-auto",nf()?"firefox":"default-browser"])],of=({children:t})=>{const[s]=d.useState(()=>new hn(sf()));return t(s)},ro=({composerController:t,placeholder:s})=>{const n=d.useContext(Uo),a=d.useRef(null),o=d.useRef(null),i=d.useRef(!1);return d.useEffect(()=>{if(i.current)return;if(!(t instanceof hn))throw new Error(`Expected instance of ProseMirrorComposerController but got ${t.constructor.name}`);i.current=!0;const r=o.current;if(r!=null){const{value:l,selectionStart:c,selectionEnd:h}=r;t.view.dispatch(t.view.state.tr.insertText(l)),t.view.dispatch(t.view.state.tr.setSelection(zn.create(t.view.state.doc,c+1,h+1))),r.style.display="none",r.value=""}a.current.appendChild(t.view.dom),t.view.dom.id=si,ec(t.view.dom),t.view.focus()},[t]),d.useEffect(()=>{t.setPlaceholder(s)},[s,t]),d.useEffect(()=>{t.logPageMount()},[]),e.jsxs("div",{ref:a,className:T(af),children:[e.jsx("textarea",{className:"block h-10 w-full resize-none border-0 bg-transparent px-0 py-2 text-token-text-primary placeholder:text-token-text-secondary",autoFocus:!0,placeholder:s,ref:o}),e.jsx("script",{nonce:n.cspScriptNonce,suppressHydrationWarning:!0,children:"window.__oai_logHTML?window.__oai_logHTML():window.__oai_SSR_HTML=window.__oai_SSR_HTML||Date.now();requestAnimationFrame((function(){window.__oai_logTTI?window.__oai_logTTI():window.__oai_SSR_TTI=window.__oai_SSR_TTI||Date.now()}))"})]})},rf=Rt(()=>Pt(()=>import("./sso-j86rkpjzhf17bvy6.js").then(t=>t.b),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44])).then(t=>({default:t.ComposerRightActions}))),lf=d.forwardRef(function({type:s,placeholder:n,replyRegions:a,state:o,renderFiles:i,leftSideActions:r,onSubmit:l,inputState:c,currentLeafId:h,composerController:u,clientThreadId:f,gizmoId:g,disableReason:p,modelId:y},m){const b=Xe(),x=tc(),{value:M}=Ie("1567586774"),{value:S}=Ie("1028682714");d.useEffect(()=>{u.focus()},[x?.modelId,u]);const v=C=>{mf({target:C.target,rootId:"composer-background",additonalInteractiveIds:["reply-regions"]})||u.focus()};return e.jsxs("div",{id:"composer-background",ref:m,className:T("flex w-full flex-col transition-colors contain-inline-size",b&&"backdrop-blur-2xl no-transparency:backdrop-blur-none",b&&s!=="temporary"&&"bg-token-composer-surface",M?"cursor-text rounded-3xl px-2.5 py-1":"gap-1.5 rounded-[26px] px-2.5 py-1.5",!b&&s!=="temporary"&&"bg-[#f4f4f4] dark:bg-token-main-surface-secondary",s==="temporary"&&"dark bg-black"),onClick:v,children:[e.jsx(ps,{initial:!1,children:a.length>0&&e.jsx(ne.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0,transition:{duration:.06}},transition:{ease:"easeOut",duration:.1},id:"reply-regions",children:e.jsx(cf,{replyRegions:a})})}),M?e.jsxs(e.Fragment,{children:[i,e.jsx("div",{className:"flex min-h-[44px] items-center px-2",children:e.jsx("div",{className:"max-w-full flex-1",children:u instanceof Hs?e.jsx(lo,{composerController:u,currentLeafId:h,placeholder:n,inputState:c}):e.jsx(ro,{composerController:u,placeholder:n})})}),e.jsxs("div",{className:"flex h-[44px] items-center justify-between",children:[e.jsx("div",{className:"flex gap-x-1",children:r}),S?e.jsx(rf,{inputState:c,state:o,onSubmit:l,composerController:u,clientThreadId:f,gizmoId:g,disableReason:p,modelId:y}):e.jsx(Ga,{inputState:c,state:o,onSubmit:l,composerController:u,clientThreadId:f,gizmoId:g,disableReason:p})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-end gap-1.5 pl-4 md:gap-2",children:[!!r?.length&&e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{ease:"easeOut",duration:.06},className:"-ml-2.5 mb-1 flex",children:r},"leftSideActions"),e.jsxs(ne.div,{layout:!0,transition:{duration:.1},className:T("flex min-w-0 flex-1 flex-col"),children:[i,u instanceof Hs?e.jsx(lo,{composerController:u,currentLeafId:h,placeholder:n,inputState:c}):e.jsx(ro,{composerController:u,placeholder:n})]}),e.jsx("div",{className:"mb-1 me-1",children:e.jsx(Ga,{inputState:c,state:o,onSubmit:l,composerController:u,clientThreadId:f,gizmoId:g,disableReason:p})})]})})]})});function lo({composerController:t,currentLeafId:s,placeholder:n,inputState:a}){const o=d.useContext(Uo);return e.jsxs(e.Fragment,{children:[e.jsx(sc,{id:si,autoFocus:!0,tabIndex:0,"data-id":s,dir:"auto",ref:i=>{if(!(t instanceof Hs))throw new Error("Expected TextAreaComposerController");i!=null&&(t.textArea=i,t.logPageMount())},rows:1,placeholder:n,disabled:a!=="default",className:T("m-0 resize-none border-0 bg-transparent px-0 text-token-text-primary focus:ring-0 focus-visible:ring-0",a==="disabled"&&"text-center",["max-h-[25dvh]","max-h-52"])}),e.jsx("script",{nonce:o.cspScriptNonce,suppressHydrationWarning:!0,children:"requestAnimationFrame((function(){window.__oai_logTTI?window.__oai_logTTI():window.__oai_SSR_TTI=window.__oai_SSR_TTI??Date.now()}))"})]})}function cf({replyRegions:t}){return e.jsx("div",{className:"flex cursor-auto flex-col divide-y divide-token-border-light overflow-hidden rounded-b-lg rounded-t-[20px] bg-token-main-surface-primary",children:t.map((s,n)=>{switch(s.type){case"text":return e.jsx(df,{value:s.value,onRemoveRegion:s.onRemoveRegion},n);case"object":return e.jsx(uf,{value:s.value,onRemoveRegion:s.onRemoveRegion},n);case"mention":case"system_hint":return e.jsx(hf,{value:s.value,icon:s.icon,onRemoveRegion:s.onRemoveRegion},n)}})})}function df({value:t,onRemoveRegion:s}){return e.jsxs(ba,{className:"text-token-text-secondary",children:[e.jsx(va,{children:e.jsx(Hi,{className:"icon-lg-heavy"})}),e.jsx(ya,{children:`“${t}”`}),e.jsx(Sa,{onClick:s})]})}function uf({value:t,onRemoveRegion:s}){return e.jsxs(ba,{className:"text-blue-selection",children:[e.jsx(va,{children:e.jsx(Hi,{className:"icon-lg-heavy"})}),e.jsx(ya,{className:"font-semibold",children:t}),e.jsx(Sa,{onClick:s})]})}function hf({value:t,icon:s,onRemoveRegion:n}){return e.jsxs(ba,{children:[e.jsx(va,{className:"mt-0",children:s}),e.jsx(ya,{className:"font-semibold text-token-text-primary",children:t}),e.jsx(Sa,{onClick:n})]})}function Sa({onClick:t}){return e.jsx("button",{onClick:t,type:"button",className:"flex-shrink-0 text-token-text-secondary",children:e.jsx(Ch,{className:"icon-lg"})})}const ba=Me.div`flex items-start py-2.5 gap-3 pl-3 pr-1.5 text-sm`,va=Me.span`flex-shrink-0 mt-0.5 w-7 h-6 flex justify-center items-center`,ya=Me.span`flex-1 line-clamp-3 py-0.5`;function mf({target:t,rootId:s,additonalInteractiveIds:n}){let a=t;for(;a&&a!=null;){if(a.tagName==="BUTTON"||a.tagName==="INPUT"||a.tagName==="TEXTAREA"||a.isContentEditable||n.includes(a.id))return!0;if(a.id===s)return!1;a=a.parentElement}return!1}const ff=t=>{const{metadata:s}=t;return s?.type?ic(s.type):!1},gf=({textdocId:t,pastedTextdoc:s,isCanvasOpen:n=!1,isFocused:a=!1})=>{const{content:o,metadata:i}=s;return e.jsxs("div",{className:"group/file-tile relative",children:[e.jsx("button",{onClick:()=>ni.removePastedContent(t),className:"absolute -left-1 -top-1 z-10 hidden rounded-full border-[3px] border-[#f4f4f4] bg-black p-[2px] text-white group-hover/file-tile:block dark:border-token-main-surface-secondary dark:bg-white dark:text-black",children:e.jsx(kh,{className:"icon-xs"})}),e.jsx(Yh,{isInlinePreview:!0,isCanvasOpen:n,isFocused:a,textdocId:t,name:i?.title??null,type:i?.type??null,size:"small",onClick:()=>oc(t),children:e.jsx("div",{className:T("whitespace-pre px-4",ff(s)&&"font-mono"),children:o})})]})},pf=({textdocId:t,pastedTextdoc:s})=>{const n=nc(t),a=ac();return e.jsx(gf,{isFocused:n,isCanvasOpen:a,pastedTextdoc:s,textdocId:t})};function xf({composerController:t}){const{doesUserHaveAnyAccountsWithPlusFeatures:s}=Qs(),n=te(),a=ai();return e.jsxs("div",{className:T("flex justify-between",!a&&"bg-gradient-to-t from-token-main-surface-primary to-transparent px-4"),children:[e.jsx("div",{className:"flex gap-2",children:e.jsx(bf,{onClickStyle:o=>{uo(n.formatMessage(o.expandedName??o.name),t)}})}),s&&e.jsx("div",{className:"flex gap-2",children:e.jsx(Sf,{onClickAspectRatio:o=>uo(n.formatMessage(o.expandedName),t)})})]})}function Sf({onClickAspectRatio:t}){const s=te();return e.jsxs(B.Root,{onOpenChange:n=>{n&&(re.logEvent(G.dalleOpenAspectRatioDropdown),W.logEvent(G.dalleOpenAspectRatioDropdown))},children:[e.jsxs(qn,{$as:B.Trigger,className:"pr-1.5",children:[e.jsx(P,{id:"dalleControls.aspectRatio",defaultMessage:"Aspect Ratio"}),e.jsx(xa,{className:"icon-md"})]}),e.jsx(B.Portal,{children:e.jsx(B.Content,{children:rc.map(n=>e.jsx(B.Item,{onClick:()=>{t(n),re.logEvent(G.dalleClickAspectRatio,n.name.defaultMessage?.toString()),W.logEvent(G.dalleClickAspectRatio,{aspectRatio:n.name.defaultMessage})},icon:n.icon,children:s.formatMessage(n.name)},n.name.id))})})]})}function bf({onClickStyle:t}){const[s,n]=d.useState(co()),a=lc(),o=na(),i=aa(),r=te();let l=2;return i||(o?l=5:a&&(l=3)),e.jsxs(e.Fragment,{children:[s.slice(0,l).map(c=>e.jsx(It,{label:e.jsx(vf,{style:c}),side:"top",sideOffset:4,customPaddingClassName:"p-1",children:e.jsxs(qn,{$as:"button",type:"button",onClick:()=>{t(c),re.logEvent(G.dalleClickStyle,c.name.defaultMessage?.toString()),W.logEvent(G.dalleClickStyle,{style:c.name.defaultMessage})},children:[e.jsx(_h,{className:"h-4 w-4 text-token-text-tertiary"}),r.formatMessage(c.name)]})},c.name.id)),e.jsx(qn,{$as:"button",type:"button",onClick:()=>{n(co()),re.logEvent(G.dalleShuffleStyles),W.logEvent(G.dalleShuffleStyles)},children:e.jsx(cc,{className:"icon-sm text-token-text-tertiary"})}),oi.map(c=>e.jsx("img",{src:c.image.src,alt:r.formatMessage(c.name),width:100,height:100,className:"invisible fixed -left-96 -top-96"},c.name.id))]})}function vf({style:t}){const s=te();return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("img",{src:t.image.src,alt:s.formatMessage(t.name),width:100,height:100,className:"rounded-md"}),e.jsx("div",{className:"text-xs font-medium",children:s.formatMessage(t.name)})]})}function co(){return[...oi].sort(()=>Math.random()-.5)}function yf(t,s){const n=s.getCurrentText();return n.trim()===""?t:n.endsWith(",")?` ${t.toLocaleLowerCase()}`:n.endsWith(", ")?t.toLocaleLowerCase():`, ${t.toLocaleLowerCase()}`}function uo(t,s){const n=yf(t,s);s.appendText(n),ls()}const qn=Me.div`h-7 bg-token-main-surface-primary border border-token-border-light text-xs hover:bg-token-main-surface-secondary hover:text-token-text-primary px-2.5 radix-state-open:bg-token-main-surface-secondary radix-state-open:text-token-text-primary rounded-full flex flex-nowrap gap-0.5 items-center text-token-text-secondary font-normal`,Fs={initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:.1},exit:{opacity:0,scale:.5,transition:{duration:.2}}},wf=({suggestions:t,onSelectingSuggestedReply:s})=>e.jsx("div",{className:"absolute bottom-full flex w-full max-w-[100vw] grow gap-2 overflow-auto px-1 pb-1 contain-inline-size sm:mb-0 sm:justify-start sm:px-2 sm:pb-0 md:static md:mb-2 md:max-w-none md:justify-center md:overflow-visible",children:t.slice(0,2).map((n,a)=>e.jsx(ne.div,{initial:Fs.initial,animate:Fs.animate,transition:{delay:(a-1)*Fs.transition.delay},exit:Fs.exit,children:e.jsx(qe,{as:"button",color:"secondary",size:"small",onClick:()=>{s(n,t,a)},className:"group whitespace-nowrap md:whitespace-normal",children:e.jsx(Mf,{suggestion:n})},a)},a))});function jf({suggestions:t,onSelectingSuggestedReply:s,clientThreadId:n}){const a=t?.length>0;d.useEffect(()=>{a&&At(t,n)},[a,n]);const{isUnauthenticated:o}=Ge();return a?t.every(ii)?e.jsxs(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"flex flex-col items-center",children:[o&&e.jsx(fs,{className:"mb-6 h-12 w-12 sm:hidden"}),e.jsx(Qi,{starterPrompts:t,onSelectStarterPrompt:s})]}):t.every(ri)?e.jsx(wf,{suggestions:t,onSelectingSuggestedReply:s}):null:null}function Mf({suggestion:t}){return ri(t)?e.jsx(e.Fragment,{children:t.text}):ii(t)?e.jsxs("div",{className:"flex flex-col overflow-hidden",children:[t.title&&e.jsx("div",{className:"truncate font-semibold",children:t.title}),e.jsx("div",{className:T("truncate font-normal",t.title?"opacity-50":""),children:t.body})]}):null}function Cf(){const{store:t}=Ne(),s=t.useSharedProps();return s?e.jsx(kf,{...s}):null}function kf({clientThreadId:t,suggestions:s}){const n=rn();return s===void 0||s.length===0?null:e.jsx("div",{children:e.jsx(_f,{children:e.jsx("div",{className:"grow",children:s!==void 0&&e.jsx(jf,{suggestions:s,onSelectingSuggestedReply:n,clientThreadId:t})})})})}const _f=Me.div`h-full flex ml-1 md:w-full md:m-auto gap-0 md:gap-2 justify-center`,nr=({className:t,children:s})=>e.jsx(ne.div,{className:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:s});function Tf({currentLeafId:t,canContinue:s,onContinueGenerating:n}){const a=d.useCallback(()=>{const i=new cs;n(t,i),ls()},[n,t]);let o=null;return s&&(o=e.jsx(Af,{onHandleContinueGenerating:a})),o&&e.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:o})}const Af=({onHandleContinueGenerating:t})=>{const s=li();return e.jsx(nr,{children:e.jsxs(qe,{as:"button",color:"secondary",onClick:t,className:"whitespace-nowrap border-0 md:border",children:[e.jsx(Gi,{className:T("-rotate-180",s?"icon-xs":"icon-sm")}),s&&e.jsx(P,{...Ve.continueGenerating})]})})},Ef=()=>{const{shouldShowSkipButton:t}=ci();return t?e.jsx(nr,{className:"flex justify-center",children:e.jsx(qe,{as:"button",color:"secondary",onClick:()=>dc.skipParagen(),children:e.jsx(P,{...Nf.skip})})}):null},Nf=ve({skip:{id:"dvcUbp",defaultMessage:"Skip"}}),ar=d.memo(function({className:s}){const{store:n}=Ne(),a=n.useIsHeaderContentAreaPopulated();return e.jsx("div",{className:T(s??"absolute bottom-full left-0 right-0",Gs.PromptTextareaHeader),children:e.jsx(uc,{shouldRender:a,contentArea:Tt.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(or,{}),e.jsx(ir,{})]})})})});function or(){const{store:t}=Ne(),s=t.useSharedProps(o=>o?.clientThreadId),n=t.useContentAreaId(Tt.HeaderTop);let a;switch(n){case ie.AdvancedVoiceOnMobileAnnouncement:a=e.jsx(gc,{clientThreadId:s});break;case ie.ParagenControls:a=e.jsx(Ef,{});break;case ie.ItemActions:a=e.jsx(Cf,{});break;case ie.BannerSignup:a=e.jsx(Pf,{});break;case ie.BannerTermsDisclaimer:a=e.jsx(If,{});break;case ie.PromptTextareaAction:a=e.jsx(Df,{});break;case ie.BannersRateLimit:a=e.jsx(Ff,{});break;case ie.BannerSidekickAnnouncement:a=e.jsx(fc,{});break;case ie.SearchBrowserExtensionAnnouncement:a=e.jsx(mc,{});break;case ie.SearchBrowserExtensionReactiveAnnouncement:a=e.jsx(hc,{});break;case ie.BannerMemoryFull:a=e.jsx(_m,{});break;case ie.Box:a=e.jsxs("div",{className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;default:a=null;break}return a}function ir(){const{store:t}=Ne(),s=t.useContentAreaId(Tt.HeaderBottom);let n;switch(s){case Xo.DallePromptControls:n=e.jsx(Rf,{});break;default:n=null;break}return n}function Rf(){const{store:t}=Ne(),s=t.useSharedProps(n=>n?.composerController);return s?e.jsx(xf,{composerController:s}):null}function Pf(){const{store:t}=Ne(),s=t.useSharedProps(o=>o?.clientThreadId),n=pc(),a=xc();return s?n?e.jsx(Sc,{threadId:s,showSignUp:a}):e.jsx(bc,{threadId:s,showLogin:a}):null}function If(){const{store:t}=Ne(),s=t.useSharedProps(n=>n?.clientThreadId);return s?e.jsx(vc,{threadId:s}):null}function Df(){const{store:t}=Ne(),s=t.useSharedProps();return s?e.jsx(Tf,{...s}):null}function Ff(){const{store:t}=Ne(),s=t.useSharedProps(n=>n?.clientThreadId);return s?e.jsx(Mm,{clientThreadId:s}):null}function Lf(t){const{value:s}=Ie("1567586774");return s?e.jsx(Of,{...t}):e.jsx(Bf,{...t})}function Of({composerController:t,isDisabled:s,highlightTooltip:n,clientThreadId:a}){const{setThreadSearchMode:o}=ln(),i=oa(),r=yc(),[l,c]=d.useState(!1),h=te(),u={clientThreadId:a};return e.jsx(rr,{highlightTooltip:n,analyticsMetadata:u,isThreadUsingSearchMode:i,isDisabled:s,children:e.jsxs("button",{className:T("flex h-8 min-w-8 items-center justify-center rounded-lg p-1 text-xs font-semibold disabled:opacity-30",l&&"transition-all duration-150",i||n?"!rounded-2xl bg-blue-250 text-blue-1000 hover:bg-[#BDDCF4] dark:bg-[#2A4A6D] dark:text-[#48AAFF] dark:hover:bg-[#1A416A]":"hover:bg-black/10 focus-visible:outline-black dark:focus-visible:outline-white"),"aria-pressed":i,"aria-label":h.formatMessage({id:"Sl1VH/",defaultMessage:"Search the web"}),disabled:s,onTransitionEnd:()=>c(!1),onClick:f=>{f.stopPropagation(),f.preventDefault(),c(!0),W.logEventWithStatsig(G.composerSearchButtonClicked,"composer_search_button_clicked",u),o(!i,u,Zs.CONVERSATION_COMPOSER_WEB_ICON),/^search\s?$/i.test(t.getCurrentText())&&t.setText(""),t.replaceSlashCommandTokensWithText(),t.focus()},children:[e.jsx(bs,{}),e.jsx(ps,{children:i&&e.jsx(ne.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:r?0:.15},children:e.jsx("div",{className:"pl-1 pr-2",children:e.jsx(P,{id:"TbHx8d",defaultMessage:"Search"})})})})]})})}function Bf({composerController:t,highlightTooltip:s,clientThreadId:n,isDisabled:a}){const{setThreadSearchMode:o}=ln(),i={clientThreadId:n};return e.jsx(rr,{highlightTooltip:s,analyticsMetadata:i,isThreadUsingSearchMode:!1,isDisabled:a,children:e.jsx(tr,{showBackground:s,className:"bg-brand-purple/20",children:e.jsx("button",{className:"flex h-8 w-8 items-center justify-center text-token-text-primary disabled:opacity-30",disabled:a,onClick:()=>{W.logEventWithStatsig(G.composerSearchButtonClicked,"composer_search_button_clicked",i),o(!0,i,Zs.CONVERSATION_COMPOSER_WEB_ICON),/^search\s?$/i.test(t.getCurrentText())&&t.setText(""),t.replaceSlashCommandTokensWithText(),t.focus()},children:e.jsx(bs,{className:T(s&&"text-brand-purple-800 dark:text-brand-purple-600")})})})})}function zf(){const t=sa(on.hasSeenComposerSearchButtonTooltip);return!t.isLoading&&t.eligible}function rr({children:t,highlightTooltip:s,analyticsMetadata:n,isThreadUsingSearchMode:a,isDisabled:o}){const i=zf()&&!a,r=sa(on.hasSeenComposerSearchButtonTooltip);return o?e.jsx("div",{children:t}):i?e.jsx(di,{side:"right",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(P,{id:"Yjduqi",defaultMessage:"Search the web"}),onDismiss:r.markAsViewed,sideOffset:0,className:"!max-w-sm",description:e.jsx(P,{id:"W51Aei",defaultMessage:"Get fast answers with trusted sources. {learnMore}",values:{learnMore:e.jsx(wc,{href:"https://openai.com/index/introducing-chatgpt-search",className:"underline",children:e.jsx(P,{id:"stA7F4",defaultMessage:"Learn more"})})}}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx(It,{sideOffset:0,label:e.jsx(P,{id:"c+4o2s",defaultMessage:"Search the web"}),side:"right",open:s||(a?!1:void 0),onOpenChange:l=>{l&&W.logEventWithStatsig(G.composerSearchButtonHovered,"composer_search_button_hovered",n)},children:t})})}function Uf({composerController:t,clientThreadId:s}){const n=Lt(s),{setThreadSearchMode:a}=ln(),i=jc().size>0,r=ui(s,Ho.Search),l=Mc(s),[c,h]=d.useState([]),[u,f]=d.useState(void 0),[g,p]=d.useState(0);d.useEffect(()=>{h(u?l.filter(j=>j.name.toLocaleLowerCase().startsWith(u.text.toLocaleLowerCase())||j.systemHint.toLocaleLowerCase().startsWith(u.text.toLocaleLowerCase())):[])},[u]);const y=t.useState(j=>j.getSystemHints().length>0);d.useEffect(()=>{const j=w=>{f(k=>!k||!w?w:k.text===w.text&&k.range.from===w.range.to&&k.range.to?k:w)};t.view.dispatch(t.view.state.tr.setMeta(hs,{onHintMatch:j}))},[t]);const m=i||y||!l.length||!c.length||!u;d.useEffect(()=>{m&&p(0)},[m]);const b=c.length,x=d.useCallback(j=>{p(w=>(j(w)%b+b)%b)},[b]),M=c[g],S=({hintToSave:j=M,expectPerfectMatch:w,appendSpace:k=!0})=>{if(!u||!M||w&&j.name.toLowerCase()!==u.text.toLowerCase())return;W.logEvent(G.systemHintSelected,{system_hint:j.systemHint,conversation_id:n??Ba});const X=u.text+j.name.slice(u.text.length),U={clientThreadId:s};Sm(t.view,{id:j.systemHint,hint:X},u.range,k,r,R=>a(R,U,Zs.CONVERSATION_COMPOSER_SLASH_SEARCH)),wt(t.view)},v=d.useRef(S);v.current=S;const C=d.useRef(x);C.current=x;const F=d.useRef(u);F.current=u;const N=t.view;return d.useEffect(()=>(m||mm(N,j=>{j==="up"?C.current(w=>w-1):j==="down"?C.current(w=>w+1):j==="cancel"?(wt(N),xm(N)):j==="submit"?(v.current({expectPerfectMatch:!1}),wt(N)):j==="checkMatch"&&v.current({expectPerfectMatch:!0,appendSpace:!1})}),()=>wt(N)),[m,N]),d.useEffect(()=>{m||W.logEvent(G.systemHintListOpened,{conversation_id:n??Ba})},[m]),m?null:e.jsx(Cc,{className:"max-w-60",onMouseDown:j=>{j.preventDefault()},children:c.map((j,w)=>e.jsx("div",{onMouseOver:()=>p(w),onClick:()=>{S({hintToSave:j,expectPerfectMatch:!1}),t.focus()},children:e.jsx(kc,{autoFocus:!1,className:"group rounded-lg px-1 py-2 hover:bg-token-hint-text",spoofHovered:w===g,children:e.jsx(Hf,{title:j.name,description:j.description,icon:e.jsx(_c,{svgString:j.logo,className:"icon-lg text-token-text-secondary group-hover:text-white"}),checked:!1})})},j.systemHint))})}function Hf({title:t,description:s,icon:n,checked:a}){return e.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-1.5 pl-1.5 pr-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:n}),e.jsxs("div",{className:"shrink grow basis-0",children:[e.jsx("p",{className:"text-sm font-normal leading-tight text-token-text-primary group-hover:text-white",children:t}),!!s&&e.jsx("p",{className:"text-[13px] font-normal leading-[18px] text-token-text-secondary group-hover:text-white",children:s})]}),a&&e.jsx(Wi,{className:T("icon-md text-token-text-primary",{"group-hover:hidden":!a})})]})}function Gf({composerController:t,clientThreadId:s}){return t instanceof hn?e.jsx(Uf,{composerController:t,clientThreadId:s}):null}function Wf({suggestions:t,composerController:s,onSelect:n,onChange:a}){const o=rn(),i=d.useCallback((u,f,g)=>{n?.(u,f,g),o(u,f,g)},[n,o]),[r,l]=d.useState(-1),[c,h]=d.useState(!1);return d.useEffect(()=>{const u=f=>{if(f.key==="ArrowDown"){const g=r===t.length-1?0:r+1;l(g),a?.(g,!0,t[g])}else if(f.key==="ArrowUp"){f.preventDefault();const g=r<=0?t.length-1:r-1;l(g),a?.(g,!0,t[g])}else f.key==="Enter"&&!f.shiftKey&&t[r]&&i(t[r],t,r)};return s.subscribe("keydown",u)},[t,r,a,i,s]),d.useEffect(()=>s.subscribe("blur",()=>{l(-1),a?.(-1,!1)}),[s,a]),d.useEffect(()=>{if(!c){const u=()=>{h(!0),window.removeEventListener("mousemove",u)};return window.addEventListener("mousemove",u),()=>{window.removeEventListener("mousemove",u)}}},[c]),d.useEffect(()=>{l(-1),a?.(-1,!1),h(!1)},[t,a]),e.jsx(ne.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"hidden w-full flex-col p-2.5 group-focus-within:flex group-focus-within:max-lg:flex-col-reverse",children:t.map((u,f)=>e.jsxs(ne.li,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:f*.03},exit:{opacity:0,translateY:4},className:"w-full",children:[f>0&&e.jsx("div",{className:T("h-[1px] opacity-60 max-lg:hidden",r===f||r===f-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")}),e.jsxs("button",{className:T("flex w-full cursor-pointer items-center justify-start whitespace-pre-wrap rounded-lg px-2.5 py-3 text-start",r===f?"bg-token-main-surface-secondary":"bg-token-main-surface-primary"),onClick:g=>{g.preventDefault(),i(u,t,f)},onMouseDown:g=>{g.preventDefault()},onMouseEnter:()=>{c&&(l(f),a?.(f,!1,u))},onMouseLeave:()=>{l(-1),a?.(-1,!1,u)},children:[u.icon?e.jsx("span",{className:"mr-4 h-6 w-6 text-token-text-secondary",children:u.icon}):null,e.jsx("span",{className:"whitespace-pre-wrap",children:u.autocompletionChunks&&u.autocompletionChunks.length>0?e.jsx(e.Fragment,{children:u.autocompletionChunks.map((g,p)=>e.jsx("span",{className:T(g.isMatched?"text-token-text-tertiary":"text-token-text-primary"),children:g.text},p))}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:T(u.type===Ws.Starter?"text-token-text-secondary":"text-token-text-tertiary"),children:u.title}),e.jsx("span",{className:"text-token-text-primary",children:u.body})]})})]}),f>0&&e.jsx("div",{className:T("h-[1px] opacity-60 lg:hidden",r===f||r===f-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")})]},u.id??f))})}function Vf(t,s){t=t.toLocaleLowerCase();const n=s;s=s.toLocaleLowerCase();const a=[];let o=0;for(let l=0;l<s.length&&(o<t.length&&t[o]===s[l]&&(a.push(l),o++),o!==t.length);l++);const i=[];let r=0;if(a.forEach(l=>{if(l>r){const c=n.slice(r,l);c&&i.push({text:c,isMatched:!1})}i.push({text:n[l],isMatched:!0}),r=l+1}),r<s.length){const l=n.slice(r);l&&i.push({text:l,isMatched:!1})}return qf(i)}function qf(t){if(t.length===0)return t;let s=[t[0]];for(let a=1;a<t.length;a++){const o=s[s.length-1],i=t[a];o.isMatched===i.isMatched?o.text+=i.text:s.push(i)}const n=s.filter(a=>a.isMatched).reduce((a,o)=>a+o.text.trim().length,0);return s.length<=4&&n>=2?s:[{text:s.map(a=>a.text).join(""),isMatched:!1}]}const $f=1,Kf=3e3;function Yf({files:t,className:s}){const n=an(),a=nn(),{value:o}=Ie("1567586774"),i=od();return e.jsxs("div",{className:s,children:[i.map(r=>e.jsx(pf,{pastedTextdoc:r,textdocId:r.tempId},r.tempId)),t.map(r=>e.jsx(id,{borderRadius:o?"2xl":"xl",useV2Style:o,width:n?"normal":"wide",onRemoveFileClick:()=>In.remove(a,r.tempId,"none"),file:r.file,fileId:r.fileId??void 0,contextConnectorInfo:r.contextConnectorInfo,loadingPercentage:r.status===rd.Uploading?r.progress:void 0},r.tempId))]})}function Xf({onAbortCompletion:t,onCreateNewCompletion:s,onContinueGenerating:n,currentModelId:a,clientThreadId:o,isNewThread:i,isCompletionInProgress:r,className:l,disabled:c=!1,disabledReason:h,canPause:u=!1,canContinue:f=!1,suggestions:g,isInteractableSharedThread:p,composerContainerRef:y,composerController:m,autocompletions:b,requiresFileUpload:x,onComposerInput:M,onComposerChange:S,onAutocompleteSelect:v,headerClassName:C,hideHeader:F,setComposerBarElement:N,onTaggingDropdownOpen:j,onTaggingDropdownClose:w}){const k=ia(),X=Dt(),{isUnauthenticated:U}=Ge(),R=te(),O=Nt(),L=nn(),E=dt(o),_=sn(o),[V]=Go(),q=Js(),K=na(),{gizmoEditorData:H,mode:Z,getGizmoId:ye}=Jo(),me=en(),le=li(),oe=Ft(),Ae=aa(),se=Lt(o),we=!!Zr(),xe=!!Qn(),[Ce,I]=d.useState({}),{setThreadSearchMode:ce,clearSearchModeTrigger:Fe,getSearchModeTrigger:je}=ln(),D=oa(),[z,de]=d.useState(!1),[ue,ae]=d.useState(!1),$=Xe(),he=d.useRef(!1),ke=hi(),{value:Se}=Ie("1567586774"),ge=a!==null?ke[a]:void 0,Ue=Tc(o);let Q=mi(o),Le=Q&&"gizmo"in Q?Q.gizmo:void 0;const[ee,_e]=d.useState(null);ee!==null&&(Q={gizmo:ee,gizmo_id:ee.gizmo.id,kind:tt.GizmoInteraction},Le=ee);const ut=Wa(ge,Q);let vs=!1;Ac(Q)&&Le?.gizmo.id===Ec&&(vs=!0);const mn=Oo(),Ot=!c&&!vs&&ut!==Pn.None&&!U,Qe=Nc(ge,Q),ht=Rc(ge,Q);let Oe=Va(A=>A.files);const[mt]=d.useState(()=>Pc());Z==="magic"?Oe=Oe.filter(A=>A.gizmoId!=null):Oe=Oe.filter(A=>A.gizmoId==null);const fn=Ic(),ft=Oe.length>0||fn,Bt=Va(Dc.hasUploadInProgress),zt=m.useState(A=>{const pe=Fc(A);return typeof ge?.maxTokens=="number"&&pe>ge.maxTokens}),Ut=m.useState(A=>!A.isEmpty()),$e=!zt&&!Bt&&(Ut||ft);fi(Oe.length>0||Bt||Ut);const Ht=(ut===Pn.Multimodal?Lc:Oc)-Oe.length,ys=Ht<=0,He=$e&&!c&&!r&&!xe,[ws,gt]=d.useState(!1),Gt=gi(),st=a||Gt.id,Wt=ui(o,Ho.Search),js=!c&&!Le&&me?.includes(lt.SearchTool)&&(me?.includes(lt.BrowsingAvailable)||!X?.isEnterprisey()),Vt=js&&Wt,ka=ke[st]?.tags,{targetedContent:qt,setTargetedContent:$t}=pi(),Re=qt?.isFocusedViewContent&&!Ae?void 0:qt,{rebaseSystemMessageContent:Kt}=ra();d.useEffect(()=>{if(!k?.id)return;const A=qa.getAndReset(k?.id,se);A&&m.setText(A.inputText)},[k?.id,se,m]),d.useEffect(()=>{ws!==He&&(gt(He),He&&(Jr(!0).then(A=>{el.startEnforcement(A),Bc.startEnforcement(A),tl.startEnforcement(A)}),me?.includes(lt.SharedWebsocket)&&Bs.registerIfNotConnected()))},[He,ws,Q?.kind,me]);const Ms=zc(ge,Q),{handleFileAccepted:gn}=Uc(R,Wa(ge,Q),Qe,"mouse",ye,Ms?.attachments),{getInputProps:pn,open:xn}=Hc({disabled:c||!Ot||ys,noClick:!0,onDropAccepted:gn,onDropRejected:A=>Gc(A,R,O,ut),multiple:!0,maxSize:Wc,maxFiles:Ht,...Vc(ht)}),Cs=sl(mt),ks=d.useCallback(()=>{m.eraseContent(),Cs.clearMessages(),m.resize($f),J.clearOverrideModelId(o),xi();for(const A of Oe)In.remove(L,A.tempId,"none");ni.markAllAsSent()},[m,Cs,Oe,L,o]),pt=async(A,pe)=>{if(A?.preventDefault(),c||!$e&&!pe||!Q||Et.isLoading(o)!==!1)return;const Be=new cs;de(!0);const Ee=m.getContentToSend(),at=ld(Ee.content),yn=`${E}-nextPrompt`,Zt=new cd(bi.CompletionRequest,{expectedTimingLogs:[{name:"prompt_submitted",expectedInMs:3e3}]}),{content:Vr,attachments:Pa}=ph(L,at,ge,Q),wn=[];Kt&&wn.push(dd(Kt));const jn={...Q};"gizmo"in jn&&delete jn.gizmo;let Rs=m.getSystemHints();D&&(Rs=[tn.Search]);const Ia=je(),qr=D?Ia??Zs.CONVERSATION_COMPOSER_WEB_ICON:void 0,Da=ud();let Jt={promptId:yn,content:Vr,eventMetadata:{eventSource:A?"mouse":"keyboard"},completionMetadata:{suggestions:g,conversationMode:jn,systemHints:Rs,searchSource:qr},messageMetadata:{...Pa.length>0&&{attachments:Pa},...ee&&{gizmo_id:ee?.gizmo.id},...Ce,...Rs.length>0&&{system_hints:Rs},...!!Ee.metadata&&{serialization_metadata:Ee.metadata},...Da.length>0&&{canvas:{pasted_textdocs:Da}}},appendMessages:wn.length>0?wn:void 0,turnTracker:Be,profiler:Zt,requestedModelId:Ue};Jt=hd(Jt),Re?.createNewCompletionParams&&(Jt=await Re.createNewCompletionParams(Jt)),Zt.logTiming("request_params_ready"),await s(Jt),Re?.onCreateCompletion?.({serverThreadId:se,currentLeafId:E}),Re?.shouldPersistAcrossMessages!==!0&&$t(void 0),ds.hideThreadHeader(),ks(),de(!1),Zt.logTiming("prompt_submitted"),g!==void 0&&(re.logEvent("chatgpt_prompt_ignore_suggestions"),W.logEvent(G.promptIgnoreSuggestions)),D&&Ia&&Fe()},Sn=d.useRef(pt);d.useEffect(()=>{Sn.current=pt});const bn=A=>{$t(A.targetedReply),A.targetedReply&&(m.focus(),W.logEvent(G.targetedReplyButtonClicked,{conversationId:se,sourceMessageId:A.messageId}))},_s=d.useCallback(()=>{Re?.onCleared?.({serverThreadId:se,currentLeafId:E}),$t(void 0),m.focus()},[E,se,Re,$t,m]),Y={Enter:{validator:A=>{const pe=A.isComposing||A.keyCode===229;return!(ue&&he.current)&&(A.metaKey||(le||Bo)&&!A.shiftKey&&!pe)},handler:A=>{if(!He){zt&&O.danger("The message you submitted was too long, please submit something shorter.",{hasCloseButton:!0});return}A.preventDefault(),pt()}},Escape:{validator:A=>!A.isComposing,handler:A=>{u&&r&&(t("",_),W.logEvent(G.pauseCompletion,{threadId:J.getServerThreadId(o),currentLeafId:J.getTree(o).getMessageId(E),eventSource:"keyboard"})),A.target.value===""&&_s()}}},Te=d.useRef(Y);Te.current=Y;const xt=d.useRef(null),nt=qc(ka,Q?.kind),[Yt,Ts]=d.useState(!1),[vn,_a]=d.useState(!1),As=nt&&Yt,Ta=m.isReady();d.useEffect(()=>m.subscribe("keydown",A=>{m.acceptLegacyKeydown()&&Te.current[A.key]?.validator(A)&&Te.current[A.key].handler(A);const Be=m.getCurrentText();if(A.key==="@"){const Ee=m.getSelectionStart(),at=Be.substring(0,Ee);(!at||/\s$/.test(at)||Ee===0)&&(xt.current?.handleClose(),setTimeout(()=>Ts(!0),10))}else Yt&&Ts(!1);if(A.key==="Escape"&&(_e(null),ae(!1)),Vt&&!D){let Ee;A.key==="Backspace"?Ee=Be.substring(0,Be.length-1):Ee=Be+A.key,/^search\s?$/i.test(Ee)?_a(!0):vn&&_a(!1)}D&&A.key==="Escape"&&ce(!1,{clientThreadId:o})}),[m,Ta,Yt,vn,Vt,D,ce,o]),d.useEffect(()=>{const A=Object.fromEntries(Object.keys(Te.current).map(pe=>[pe,Ee=>{const at=Te.current[pe];if(!at||m.acceptLegacyKeydown())return!1;const{validator:yn,handler:Zt}=at;return yn(Ee)?(Zt(Ee),!0):!1}]));m.registerKeyHandlers(A)},[m,Ta]),d.useEffect(()=>m.subscribe("paste",A=>{$c({filePickerStore:L,event:A,intl:R,toaster:O,clientThreadId:o,conversationMode:Q,currentModelConfig:ge,getEditorGizmoId:ye,modelSupportedImageMimeTypes:Qe})}),[R,o,Q,ge,ye,Qe,m,O,L]);const _r=A=>{we||_e(A),m.trimLeadingText("@"),ls(),Ts(!1)},Tr=Kc(o,mt,R,Qe,Ms?.attachments),Ar=d.useCallback(A=>{A?.preventDefault(),t("",_),W.logEvent(G.pauseCompletion,{threadId:J.getServerThreadId(o),currentLeafId:J.getTree(o).getMessageId(E),eventSource:"mouse"}),ls()},[t,o,_,E]),Aa=d.useCallback(()=>{qa.set(k?.id,se,m.getCurrentText())},[se,k?.id,m]);d.useEffect(()=>{H||!z&&!Yc()&&m.focus()},[z,m]),d.useEffect(()=>{H||In.reset(L)},[a,L,H]),d.useEffect(()=>{(!nt&&ee||we)&&_e(null)},[nt,ee,we]);const[Er,Nr]=(()=>{switch(h){case"workspaceDisallowsGizmo":return[Ve.disallowedByWorkspacePlaceholder,!0];case"feedbackRequired":return[Ve.disabledFeedbackPlaceholder,!0];case"noModelsAvailable":return[Ve.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[Ve.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[Ve.loading,!0];case"noTestGizmoId":return[Ve.noTestGizmoId,!0];default:return p?[Ve.placeholderWithName,!1]:Re?.placeholderTextOverride!=null?[Re.placeholderTextOverride,!1]:[Ve.placeholderWithName,!1]}})(),Rr=R.formatMessage(Er,{name:H!=null?Z==="magic"?Xc:H.name||"GPT":Le?.gizmo.display.name??"ChatGPT"});d.useEffect(()=>m.subscribe("input",()=>{Si.getState().isThreadHeaderVisible&&ds.hideThreadHeader(),ae(!0)}),[m]),d.useEffect(()=>{if(M)return m.subscribe("input",()=>{M?.()})},[m,M]),d.useEffect(()=>{if(S)return m.subscribe("change",()=>{S?.()})},[m,S]),d.useEffect(()=>m.subscribe("focus",()=>{ae(!0)}),[m]);const Pr={clientThreadId:o,uploadType:ut,modelAcceptedMimeTypes:ht,modelSupportedImageMimeTypes:Qe,attachmentsProductFeature:Ms?.attachments,getInputProps:pn,openFileDialog:xn,historyDisabled:oe,onOauthRedirect:Aa,highlightTooltip:x&&!ft},Xt=[],Ea=!c&&!ys&&(Ot||mn!=null)&&!D;(Se||Ea)&&Xt.push(e.jsx(Qm,{...Pr,isDisabled:!Ea},"file-upload-button")),js&&(!D||Se)&&Xt.push(e.jsx(Lf,{composerController:m,highlightTooltip:vn,clientThreadId:o,isDisabled:!Vt||ft},"search-button"));const Ir=ft&&e.jsxs(e.Fragment,{children:[Z==="magic"&&e.jsx("div",{className:"m-2 mb-0 rounded-lg bg-token-main-surface-secondary p-2 text-xs text-token-text-secondary",children:e.jsx(P,{...Ve.gizmoKnowledgeWarning})}),e.jsx(Yf,{files:Oe,className:T("flex flex-nowrap gap-2 overflow-x-auto",Se?"p-1.5":"pb-1.5 pt-[7px]")})]}),Dr=Nr?"disabled":"default",Fr=r&&u,Lr=!He||z,Or=md(Bt,Ut,zt),Es=Fr?"streaming":Lr?"disabled":"idle",Qt=d.useRef(null),St=d.useRef(null),{layer:Br}=De("387752763"),{layer:zr}=De("51287004"),Ur=Br.get("enable_slash_commands",!1)&&(U||!X?.isFree()||zr.get("enable",!1)),Hr=a&&[fd,gd].includes(a),Gr=Ur&&Q?.kind===tt.PrimaryAssistant&&!D;d.useEffect(()=>{const A=()=>{Qt.current!=null&&Rn.addAction("composer_state_disabled",{threadId:J.getServerThreadId(o),disabledReason:Qt.current})};if($e&&Es==="disabled"){let pe="unknown";c?pe=h??"component_disabled_unknown":r?pe="completion_in_progress":xe?pe="thread_hard_blocked":z&&(pe="starting_new_completion_request"),Qt.current!==pe&&(St.current&&clearTimeout(St.current),St.current=setTimeout(A,Kf)),Qt.current=pe}else Qt.current=null;return()=>{St.current&&(clearTimeout(St.current),St.current=null)}},[o,$e,Es,c,h,r,xe,z]);const Ns=[];if(D&&!Se&&Ns.push({type:"system_hint",value:R.formatMessage(Qf.searchMode),icon:e.jsx("span",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-brand-purple/15",children:e.jsx(bs,{className:"h-[20px] w-[20px] shrink-0 text-[#814CFF]"})}),onRemoveRegion:()=>{ce(!1,{clientThreadId:o}),m.focus()}}),Re?.label&&Ns.push({type:Re.type,value:Re.label,onRemoveRegion:_s}),ee!==null){const A=!!ee.gizmo.tags?.includes(la.FirstParty);Ns.push({type:"mention",value:ee.gizmo.display.name,icon:e.jsx(Qc,{isFirstParty:A,src:ee.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{_e(null),m.focus()}})}d.useEffect(()=>{(!b||b.length===0||!ue)&&(he.current=!1)},[b,ue]);const Wr=(A,pe,Be)=>{he.current=A>=0,pe&&m.setText(Be?`${Be.title}${Be.body}`:"")},Na=ue&&b&&b.length>0&&!As&&!m.hasMultipleLines()&&m.canShowAutocompletion();d.useEffect(()=>{As?j?.():w?.()},[As,j,w]);const Ra=Es==="streaming"?Ar:pt;return e.jsxs(Zc.Provider,{value:mt,children:[e.jsx(Jc,{onOauthRedirect:Aa,children:e.jsx("form",{className:l,onSubmit:Ra,children:e.jsxs("div",{className:"relative flex h-full max-w-full flex-1 flex-col",children:[!F&&!$&&e.jsx(ar,{className:C}),e.jsxs("div",{className:"relative h-0",children:[As&&e.jsx("div",{className:T("absolute bottom-3 w-full space-y-2",Gs.TagGpt),children:e.jsx(ed,{onClick:A=>_r(A),onClose:()=>{Ts(!1),m.focus()}})}),Gr&&e.jsx("div",{className:T("absolute bottom-3 space-y-2",Gs.TagGpt),children:e.jsx(Gf,{composerController:m,clientThreadId:o})})]}),e.jsxs("div",{ref:y,className:"group relative flex w-full items-center",children:[i&&V.has("from_template_row")&&e.jsx("button",{type:"button",onClick:()=>{q("/")},className:"mr-2 flex h-8 w-8 items-center justify-center text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(Th,{className:"icon-lg"})}),nt&&!!se&&e.jsx(td,{ref:xt}),e.jsx(lf,{type:oe?"temporary":"default",ref:N,replyRegions:Ns,placeholder:Rr,inputState:Dr,composerController:m,leftSideActions:Xt,state:Es,onSubmit:Ra,renderFiles:Ir,currentLeafId:E,clientThreadId:o,gizmoId:Le?.gizmo.id,disableReason:Or,modelId:st}),Na&&e.jsx("div",{className:T("absolute left-0 z-10 box-border w-full bg-token-main-surface-primary max-lg:bottom-full lg:top-full",Xt?.length>0&&K&&!Se?`px-${Xt.length*8}`:"pl-0"),children:e.jsx(Wf,{suggestions:b,composerController:m,onSelect:v,onChange:Wr})})]}),e.jsx(sd,{composerController:m,parsedDocumentHandler:Tr})]})})}),e.jsx(Tm,{canUseInlineTagging:nt,isDisabled:c,clientThreadId:o,currentLeafId:E,currentRequestId:_,canContinue:f,composerController:m,setPromptInputMetadata:I,suggestions:g,isNewThread:i,onCreateNewCompletion:s,onContinueGenerating:n,onResetState:ks,conversationMode:Q,isShowingAutocomplete:!!Na}),Q!=null&&!Hr&&nd.includes(Q.kind)&&e.jsx(ad,{onTargetedReply:bn})]})}const Qf=ve({searchMode:{id:"LSO1pB",defaultMessage:"Search the web"}}),Zf=({children:t})=>{const[s]=d.useState(()=>new Hs);return t(s)},lr=({children:t})=>{const{layer:s}=De("387752763");return s.get("enable_rich_text_composer",!1)?e.jsx(of,{children:t}):e.jsx(Zf,{children:t})};function Jf(t){const s=t.message?.author.role===be.User,n=t.metadata?.err!=null&&t.metadata?.errCode!==Vs.ContentPolicy,a=t.metadata?.errCode===Vs.ModelIncompatibility;return t.metadata?.canRetry===!1||a?!1:s||n}function eg(t){return t.composerController?e.jsx(ho,{...t,composerController:t.composerController}):e.jsx(lr,{children:s=>e.jsx(ho,{...t,composerController:s})})}function ho({clientThreadId:t,isNewThread:s,currentModelId:n,showPromptStarters:a,noWrap:o,onRequestCompletion:i,composerContainerRef:r,composerController:l}){const c=ca(),h=da(),u=ua(g=>{const p=Et.getCurrentNode(t,g);return Jf(p)});if(vi(l),!h&&u)return e.jsx(tg,{clientThreadId:t});const f=e.jsx(e.Fragment,{children:e.jsx(cr,{composerContainerRef:r,composerController:l,clientThreadId:t,currentModelId:n,isNewThread:s,showPromptStarters:a,onRequestCompletion:i})});return o?f:e.jsxs(e.Fragment,{children:[e.jsx(wm,{clientThreadId:t}),e.jsx(ha,{clientThreadId:t,isStaticSharedThread:c,withVerticalPadding:!1,withHorizontalPadding:!0,children:e.jsx(us,{children:f})})]})}function tg({clientThreadId:t}){const s=pd(t),n=ua(i=>Et.getCurrentNode(t,i).metadata?.errCode===xd),a=Sd(i=>i.isoDate),o=dt(t);return n&&a!=null&&a!==""?null:e.jsxs("div",{children:[e.jsx("div",{className:"mb-3 text-center text-xs",children:e.jsx(P,{...mo.errorGeneratingResponse})}),e.jsx("div",{className:"flex items-center md:mb-4",children:e.jsx(qe,{as:"button",color:"primary",onClick:()=>{const i=new cs;re.logEvent("chatgpt_regenerate_due_to_error_button_clicked",void 0,et({clientThreadId:t})),s({id:o,eventMetadata:{eventSource:"mouse"},conversationMode:Et.getConversationMode(t),turnTracker:i})},className:"m-auto",icon:Gi,"data-testid":"regenerate-thread-error-button",children:e.jsx(P,{...mo.regenerateResponse})})})]})}function cr({clientThreadId:t,currentModelId:s,isNewThread:n,onRequestCompletion:a,showPromptStarters:o,composerContainerRef:i,composerController:r,autocompletions:l,requiresFileUpload:c,onComposerInput:h,onComposerChange:u,onAutocompleteSelect:f,headerClassName:g,hideHeader:p,onTaggingDropdownClose:y,onTaggingDropdownOpen:m}){const b=dt(t),x=sn(t),M=Dn(),{isUnauthenticated:S}=Ge(),C=yi(t)===Wo.STREAMING,F=wi({clientThreadId:t,conversationLeafId:b}),N=ct(x),j=ji({clientThreadId:t}),w=!S,k=nl(),{isOpen:X,onClose:U}=bd({type:"just-hit-rate-limit"}),R=d.useCallback((je,D)=>{W.logEvent(G.continueCompletion),a({type:za.Continue,promptId:je,eventMetadata:{eventSource:"mouse"},cancelActiveRequests:!1,completionMetadata:{conversationMode:Et.getConversationMode(t)},turnTracker:D})},[a,t]),O=Vo(),L=d.useCallback(async(je,D)=>xh({clientThreadId:t,currentRequestId:D,isHistoryAndTrainingDisabled:k,queryClient:O}),[t,k,O]),E=d.useCallback(async({promptId:je,content:D,eventMetadata:z,completionMetadata:de,messageMetadata:ue,appendMessages:ae,turnTracker:$,profiler:he,requestedModelId:ke})=>{const Se=J.getThreadCurrentLeafId(t);J.updateTree(t,ge=>{ge.addNode(je,D,Se,be.User,void 0,ue)}),await a({type:za.Next,promptId:je,eventMetadata:z,cancelActiveRequests:!0,completionMetadata:de,appendMessages:ae,turnTracker:$,profiler:he,...ke?{requestedModelId:ke}:{}})},[t,a]),_=vd(t,b),V=yd(t,b),q=!F&&(N||C),K=d.useMemo(()=>q?!1:!_&&V,[_,V,q]),H=q&&s!=="gpt-4-pbrowse",Z=ma(t),ye=We(t),me=gs(ye).data,{promptStarters:le,isSuccess:oe}=Fn(n&&!Z,t,4),Ae=Qo(),se=(()=>{if(Ae?.messageId===J.getTree(t).getLastValidNode(b)?.message?.id)return Ae?.suggestions;if(o&&!Z&&oe&&!w)return le})(),we=wd(),xe=al(),Ce=(()=>{if(me?.gizmo.tags?.includes(la.WorkspaceDisabled)&&!xe)return"workspaceDisallowsGizmo";if(we.size){if(M.displayingSideBySideFeedback&&M.unskippable)return"feedbackRequired"}else return"noModelsAvailable";const D=Et.getConversationMode(t);return D?.kind===tt.GizmoTest&&D.gizmo_id==null?"noTestGizmoId":null})(),I=Mi(t),ce=cn(t),Fe=kt("15117983")?.value;return e.jsxs(e.Fragment,{children:[X?e.jsx(jd,{onClose:U}):null,Fe&&ce&&ce.kind===tt.PrimaryAssistant&&ce.plugin_ids&&ce.plugin_ids.length>0?e.jsx(sg,{}):e.jsx(Xf,{composerContainerRef:i,composerController:r,clientThreadId:t,onCreateNewCompletion:E,onAbortCompletion:L,onContinueGenerating:R,currentModelId:s,isNewThread:n,isCompletionInProgress:j,className:"w-full",canContinue:K,suggestions:se??[],disabled:!!Ce,disabledReason:Ce??void 0,canPause:H,isInteractableSharedThread:I,autocompletions:l,requiresFileUpload:c,onComposerInput:h,onComposerChange:u,onAutocompleteSelect:f,headerClassName:g,hideHeader:p,onTaggingDropdownClose:y,onTaggingDropdownOpen:m},t)]})}function sg(){return e.jsxs("div",{className:"mx-auto flex max-w-md flex-col items-center justify-center gap-2 rounded-xl border border-token-border-light bg-token-main-surface-primary p-6 shadow-lg",children:[e.jsx("span",{className:"text-token-text-primary",children:e.jsx(P,{id:"PluginsDecrepatedNotice.pluginsDeprecationTitle",defaultMessage:"Conversations with plugins are archived"})}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(P,{id:"PluginsDecrepatedNotice.pluginsDeprecationSubtitle",defaultMessage:"Explore GPT Store to find a replacement"})}),e.jsxs("a",{href:"https://chat.openai.com/gpts",className:"text-green-500 hover:cursor-pointer dark:text-green-400",children:[e.jsx(P,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLink",defaultMessage:"Explore GPTs"}),e.jsx("span",{className:"ml-2",children:e.jsx(P,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLinkArrow",defaultMessage:"→"})})]})]})}const mo=ve({errorGeneratingResponse:{id:"PromptTextarea.errorGeneratingResponse",defaultMessage:"There was an error generating a response"},regenerateResponse:{id:"PromptTextarea.regenerateResponse",defaultMessage:"Regenerate"}}),dr=d.memo(function(){return e.jsxs("div",{className:`flex flex-col gap-2 ${Gs.PromptTextareaHeader}`,children:[e.jsx(or,{}),e.jsx(ir,{})]})}),Yp=Object.freeze(Object.defineProperty({__proto__:null,ChatScreenComposerAlerts:dr},Symbol.toStringTag,{value:"Module"})),kn=4;function ng(t){const{layer:s}=De("3533083032"),{layer:n}=Ct("3533083032"),{value:a,isLoading:o}=Ie("3006519778");return o||!a?!1:t?s.get("enable_new_homepage_anon",!1):n.get("enable_new_homepage_anon",!1)}function ag(){const{layer:t}=Ct("4031588851"),s=t.get("autocomplete_qualified_start_date","2099-09-13T00:00:00Z"),n=ia();return!!n&&n.created*1e3>=new Date(s).getTime()}function og(t){const{layer:s}=De("4031588851"),{layer:n}=Ct("4031588851"),{value:a,isLoading:o}=Ie("633009675");return o||!a?!1:t?s.get("enable_new_autocomplete_homepage",!1):n.get("enable_new_autocomplete_homepage",!1)}const _n=t=>`${t.title}${t.body}`.toLocaleLowerCase();function ig(t){return We(t.clientThreadId),e.jsx(lr,{children:s=>e.jsx(ug,{...t,composerController:s})})}function rg({children:t,composerController:s}){const{store:n}=Ne(),[a,o]=d.useState(!1);d.useEffect(()=>s.subscribe("focus",()=>{o(!0)}),[s]),d.useEffect(()=>s.subscribe("blur",()=>{o(!1)}),[s]);const r=!!n.useSharedProps()?.isShowingAutocomplete;return t(r&&a)}function lg({isUnauthenticated:t,shouldShowLegacyStarterPrompts:s,legacyPromptStarters:n,isSendBlocked:a,clientThreadId:o}){return e.jsxs("div",{className:T(t?"justify-end lg:justify-center":"justify-center","flex h-full flex-shrink flex-col items-center overflow-y-hidden text-token-text-primary lg:hidden"),children:[e.jsx("div",{className:T(t&&"flex sm:items-center md:flex-1","flex-shrink-0"),children:e.jsx(fs,{className:"mb-6 h-12 w-12"})}),s&&(n&&n.length>0?e.jsx(gg,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},promptStarters:n,isSendBlocked:a,clientThreadId:o,isSquare:t}):e.jsx(tm,{}))]})}function cg({composerController:t,isSendBlocked:s,clientThreadId:n,isModelLoaded:a,headlineOption:o,enableNewMobileDesign:i,shouldShowStarterPrompts:r,promptChips:l,onSelectStarterPrompt:c,starterPromptExpanded:h,setStarterPromptExpanded:u}){return e.jsx(rg,{composerController:t,children:f=>e.jsxs(ne.div,{initial:{opacity:0},animate:{opacity:f?0:1},exit:{opacity:0},transition:{duration:.1},className:T("justify-center",f?"pointer-events-none":"","flex h-full flex-shrink flex-col items-center overflow-hidden text-token-text-primary lg:hidden"),children:[o==="CHATGPT_LOGO"?e.jsx(fs,{className:"inline-block h-12 w-12"}):e.jsx(ur,{headlineOption:o,isModelLoaded:a}),e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:T(!i&&"lg:hidden",!h&&"h-[116px]"),children:r&&e.jsx(mr,{starterPrompts:l,onSelectStarterPrompt:c,disabled:s,clientThreadId:n,onExpand:()=>u(!0),mobileLayout:!0})})]})})}function dg(t,s,n){const a=Ie("1468311859").value,o=Ie("3664702598").value,{layer:i}=De("4031588851"),r=ag(),l=t||s,c=l&&a,h=l&&o&&r;let u="HARDCODED";if(l)if(n){const f=i.get("search_autocomplete_mode","");c&&f&&(u=f)}else h&&(u=i.get("autocomplete_mode","HARDCODED"));return u}function ug({clientThreadId:t,currentModelId:s,isModelLoaded:n,onRequestCompletion:a,composerController:o,v2HomepageDisclaimer:i}){const r=Os(t),l=ma(t),c=Qn(),[h,u]=d.useState([]),{trendingSuggestions:f,fetchTrendingSuggestions:g}=pg(kn),p=d.useRef(!1),{isUnauthenticated:y}=Ge(),m=na(),[b,x]=d.useState(!1),M=oa(),S=Xe();vi(o);const v=Ie("589604007").value,{layer:C}=Ct("4031588851"),{layer:F}=De("4031588851"),{layer:N}=Ct("3533083032"),{layer:j}=De("3533083032"),{promptStarters:w,isSuccess:k}=Fn(r&&!l&&n,t,8,v,!0,s??void 0),{promptStarters:X,isSuccess:U,isError:R}=Fn(r&&!l&&n,t,4,void 0,void 0,s??void 0),O=m&&!!h.find(D=>!!D.requires_file_upload),L=d.useCallback(D=>{const z=o.getCurrentText();return z&&_n(D).startsWith(z.toLocaleLowerCase())},[o]),E=d.useCallback(D=>{const z=o.getCurrentText(),de=D.title+D.body;return L(D)?{...D,title:z,body:de.slice(z.length)}:{...D,title:de,body:""}},[o,L]),_=d.useCallback((D=!1)=>{u(z=>!z.some(L)&&z.length>0?[]:D?z:z.map(E))},[L,E]),V=(D,z,de)=>{const ue=D.title;u([]),o.focus(),o.setText(ue),requestAnimationFrame(()=>{const ae=(w?.filter($=>$.theme===D.theme)??[]).map($=>{const he=vt($.oneliner),ke=he.startsWith($.title);return{...$,title:ke?`${$.title} `:"",body:ke?$.body:he,autocompletionChunks:Vf(ue,he),type:Ws.Autocomplete}});u(ae),ae.length>0&&At(ae,t),Cd(D,de,t)})};d.useEffect(()=>{const D=h.some(z=>z.theme===Ln.Search);M&&o.getCurrentText()===""?f.length>0?u(f):g():D&&!M&&u(z=>z.filter(de=>de.theme!==Ln.Search))},[h,M,f,g,o]);const q=w?.reduce((D,z)=>(z.theme&&!D[z.theme]&&(D[z.theme]=z),D),{}),K=[];if(q)for(const D in q)K.push(q[D]);const H=K&&K.length>0,Z=!!(k&&H&&n),ye=!!((U||R)&&n),me=kn-h.filter(L).length,le=y?j.get("enable_new_mobile",!1):F.get("enable_new_mobile",!1),oe=dg(le,m,M),Ae=y?N.get("headline_option","HELP_WITH"):C.get("headline_option","HELP_WITH"),se=C.get("autocomplete_min_char",4),we=C.get("autocomplete_fetch_interval",200),xe=d.useRef(null),Ce=d.useCallback(Ci(async D=>{const z=o.getCurrentText();if(!z||z.length<se||z.length>80||o.hasMultipleLines()){u([]);return}if(!p.current&&!(xe.current&&xe.current.length>se&&z.startsWith(xe.current)))try{const de=await Ye.generateAutocompletions(z,D,M);if(de.completions.length===0){xe.current=z;return}const ue=de.completions.map(ae=>({id:qo(),type:Ws.Autocomplete,title:ae.slice(0,z.length),body:ae.slice(z.length),oneliner:ae,prompt:ae,source:oe})).filter(L).map(E);u(ae=>{const $=ae.filter(L),he=ue.filter(ke=>{const Se=_n(ke);return!$.some(ge=>{const Ue=_n(ge);if(Se===Ue)return!0;const Q=/[\p{P}\p{S}]$/u,Le=Se.replace(Q,""),ee=Ue.replace(Q,"");return Le===Ue||Se===ee||Le===ee})}).slice(0,kn-$.length);return[...$,...he]}),ue.length>0&&At(ue,t)}catch{}},oe==="BING"?150:we),[o,oe,E,we]),I=d.useCallback(()=>{_(),me>0&&Ce(me)},[Ce,_,me]);d.useEffect(()=>{p.current&&u([])},[p]);const ce=d.useMemo(()=>oe==="HARDCODED"?_:I,[oe,I,_]),Fe=d.useCallback(()=>{o instanceof hn&&_(!0),o.getCurrentText().indexOf(`
`)>0&&u([])},[o,_]),je=d.useCallback((D,z,de)=>{z.forEach(ue=>{ue.id===D.id&&(ue.userInput=o.getCurrentText())}),u([z[de]])},[o]);return e.jsx(e.Fragment,{children:e.jsx(ps,{children:e.jsx("div",{className:"h-full w-full lg:py-[18px]",children:e.jsx(ha,{isStaticSharedThread:!1,withVerticalPadding:!1,withHorizontalPadding:!0,clientThreadId:t,fullHeight:!0,children:e.jsxs($a,{children:[e.jsx("div",{className:"mb-7 hidden text-center lg:block",children:Ae==="CHATGPT_LOGO"?e.jsx(fs,{className:"inline-block h-12 w-12"}):e.jsx(ur,{headlineOption:Ae,isModelLoaded:n})}),!le&&e.jsx(lg,{isUnauthenticated:y,shouldShowLegacyStarterPrompts:ye,legacyPromptStarters:X,isSendBlocked:c,clientThreadId:t}),le&&e.jsx(cg,{composerController:o,isModelLoaded:n,headlineOption:Ae,enableNewMobileDesign:le,shouldShowStarterPrompts:Z,promptChips:K,onSelectStarterPrompt:V,starterPromptExpanded:b,setStarterPromptExpanded:x,isSendBlocked:c,clientThreadId:t}),e.jsx("div",{className:T("lg:w-full","lg:absolute lg:bottom-8 lg:left-0"),children:e.jsx($a,{children:S?e.jsx(dr,{}):e.jsx(ar,{className:"block"})})}),e.jsx("div",{className:"w-full",children:e.jsx(cr,{clientThreadId:t,isNewThread:r,currentModelId:s,onRequestCompletion:a,showPromptStarters:!1,composerController:o,autocompletions:h,requiresFileUpload:O,onComposerInput:ce,onComposerChange:Fe,onAutocompleteSelect:je,onTaggingDropdownClose:()=>{p.current=!1},onTaggingDropdownOpen:()=>{p.current=!0},hideHeader:!0})}),e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:T("hidden lg:block",i&&y&&b?"":"h-[70px]"),children:Z&&e.jsx(mr,{starterPrompts:K,onSelectStarterPrompt:V,disabled:c,clientThreadId:t,onExpand:()=>x(!0)})}),i&&e.jsx("div",{className:"w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px] lg:absolute lg:bottom-0 lg:left-0",children:e.jsx("div",{className:"min-h-4",children:i})})]})})})})})}function ur({headlineOption:t,isModelLoaded:s}){const n=te(),[a,o]=d.useState(0),[i,r]=d.useState(!0),l=20,c=n.formatMessage(xg[t]||is.whatCanIHelpWith);return d.useEffect(()=>{if(!s)return;let h;return a<c.length?h=setTimeout(()=>{o(a+1)},l):i&&(h=setTimeout(()=>{r(!1)},500)),()=>clearTimeout(h)},[c,a,i,s]),e.jsxs("div",{className:"relative inline-flex justify-center text-center text-2xl font-semibold leading-9",children:[e.jsx("h1",{children:c.substring(0,a)||"​"}),e.jsx("h1",{className:"result-streaming absolute left-full transition-opacity",style:{opacity:i?1:0},children:e.jsx("span",{})})]})}function hr({label:t,onClick:s,disabled:n=!1,icon:a}){return e.jsxs("button",{className:"group relative flex h-[42px] items-center gap-1.5 rounded-full border border-token-border-light px-3 py-2 text-start text-[13px] shadow-xxs transition enabled:hover:bg-token-main-surface-secondary disabled:cursor-not-allowed xl:gap-2 xl:text-[14px]",disabled:n,onClick:s,children:[a,e.jsx("span",{className:"max-w-full select-none whitespace-nowrap text-gray-600 transition group-hover:text-token-text-primary dark:text-gray-500",children:t})]})}function hg({starterPrompt:t,starterPrompts:s,index:n,disabled:a,onSelectStarterPrompt:o}){const i=t.theme??t.title,r=rn(),{mutate:l}=kd(),c=t.category==="onboarding"?()=>{l({key:on.hasUsedConversationalOnboardingStarterPrompt}),r(t,s,n)}:()=>o(t,s,n);return e.jsx(hr,{disabled:a,onClick:c,icon:e.jsx(_d,{starterPrompt:t,useV2Colors:!0}),label:i})}function fo({clientThreadId:t,onClick:s}){d.useEffect(()=>{Td(t)},[t]);const n=te();return e.jsx(ne.div,{initial:{opacity:0,translateY:5},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:5},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(hr,{onClick:()=>{Ad(t),s()},label:n.formatMessage(is.moreStarterPrompts)})})}const mg=5,fg=3;function mr({starterPrompts:t,onSelectStarterPrompt:s,disabled:n,clientThreadId:a,onExpand:o,mobileLayout:i=!1}){const r=i?fg:mg,[l,c]=d.useState(r),[h,u]=d.useState(r),[f,g]=d.useState(!1),p=d.useRef(null),y=t.length<=l;d.useEffect(()=>{At(t.slice(0,r),a)},[a]),d.useEffect(()=>{if(!f&&!y&&p.current){const b=p.current,x=b.getBoundingClientRect(),M=x.width,S=Array.from(b.children);let v=0;for(let C=0;C<S.length&&S[C].getBoundingClientRect().right-x.left<=M;C++)v++;c(v),u(v),g(!0)}},[t,y,f]);const m=()=>{const b=t.slice(l,t.length).map(x=>({...x,isAdditional:!0}));b.length>0&&At(b,a),c(t.length),o()};return e.jsxs("div",{className:T("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",f&&t.length>0?"opacity-100":"opacity-[0.01]",i?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:T("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",y||i?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:p,children:[t.slice(0,l).map((b,x)=>e.jsx(ne.li,{initial:{opacity:0,...x<h?{translateY:5}:{}},animate:{opacity:1,...x<h?{translateY:0}:{}},exit:{opacity:0,...x<h?{translateY:5}:{}},transition:{duration:.3,delay:x>=h?(x-h)*.06:0,ease:"easeOut"},children:e.jsx(hg,{starterPrompt:b,starterPrompts:t,index:x,disabled:n,onSelectStarterPrompt:s})},b.id??x)),i&&t.length>l&&e.jsx(fo,{clientThreadId:a,onClick:m})]}),!i&&t.length>l&&e.jsx(fo,{clientThreadId:a,onClick:m})]})}function gg({promptStarters:t,isSendBlocked:s,clientThreadId:n,isSquare:a,...o}){d.useEffect(()=>{At(t,n)},[n]);const i=rn();return e.jsx(e.Fragment,{children:a?e.jsx(ne.div,{...o,className:"mb-2 w-full flex-shrink overflow-y-hidden",children:e.jsx(us,{children:e.jsx(Qi,{starterPrompts:t,onSelectStarterPrompt:i,disabled:s})})}):e.jsx(ne.div,{...o,className:"flex-shrink overflow-y-hidden",children:e.jsx(sm,{starterPrompts:t,onSelectStarterPrompt:i,disabled:s,cssMobileDisplayLimit:2,marginOverride:"mt-6 lg:mt-12"})})})}const pg=t=>{const[s,n]=d.useState([]),a=d.useCallback(async()=>{const i=(await Ye.generateTrendingSuggestions(t)).suggestions.map((r,l)=>({type:Ws.Starter,title:go(r),body:"",icon:e.jsx(Ah,{}),prompt:go(r),id:`starter-${l}`,theme:Ln.Search}));n(i)},[t]);return{trendingSuggestions:s,fetchTrendingSuggestions:a}};function go(t){return t.split(" ").map(Md).join(" ")}const is=ve({whatCanIHelpWith:{id:"SplashScreenV2.whatCanIHelpWith",defaultMessage:"What can I help with?"},whereShouldWeStart:{id:"SplashScreenV2.whereShouldWeStart",defaultMessage:"Where should we start?"},askChatgptAnything:{id:"SplashScreenV2.askChatgptAnything",defaultMessage:"Ask ChatGPT anything"},moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),xg={HELP_WITH:is.whatCanIHelpWith,WHERE_TO_START:is.whereShouldWeStart,ASK_CHATGPT:is.askChatgptAnything};function Sg({currentModel:t,categoryOptions:s,className:n,modelSwitcherDenialsBySlug:a,displayInFull_INTERNAL_USE_ONLY:o=!1}){const i=t?.id;return e.jsx(B.Portal,{children:e.jsx(B.SubContent,{className:n,children:s.map(r=>{const{value:l}=r;return"options"in r?e.jsx(as,{currentModel:t,isSelected:i.startsWith(l),option:r,modelSwitcherDenialsBySlug:a,displayInFull_INTERNAL_USE_ONLY:o},l):e.jsx(Ks,{isSelected:i===l,value:l,renderName:()=>r.name,modelSwitcherDenialsBySlug:a,showNewChatHint:!1,displayInFull_INTERNAL_USE_ONLY:o},l)})})})}function as({currentModel:t,option:s,isSelected:n=!1,modelSwitcherDenialsBySlug:a,displayInFull_INTERNAL_USE_ONLY:o=!1}){const{name:i,options:r,categoryId:l}=s,c=`${i} Models`,h=()=>e.jsx("div",{className:"flex shrink-0 grow justify-between gap-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Eh,{className:"icon-md w-7 text-token-text-secondary"}),c]})});let u;return o&&n&&(u=s.options.find(f=>f.value===t.id)?.name),e.jsxs(B.Sub,{children:[e.jsx(B.SubMenuTrigger,{children:e.jsxs("div",{className:T("flex grow justify-between gap-2 overflow-hidden",o?"items-center break-all":""),children:[l?h():i,n&&e.jsx("div",{className:"truncate text-token-text-tertiary",children:u??t.title})]})}),e.jsx(Sg,{currentModel:t,categoryOptions:r,modelSwitcherDenialsBySlug:a,displayInFull_INTERNAL_USE_ONLY:o})]})}function Ks({value:t,renderName:s,isSelected:n,showNewChatHint:a=!0,onClick:o,modelSwitcherDenialsBySlug:i,isUpgradeUpsell:r=!1,testId:l,displayInFull_INTERNAL_USE_ONLY:c=!1}){const h=Ed(),u=Nd(),f=t?i[t]?.conversation?.[0]:null,{layer:g}=De("1846737571"),p=e.jsx(B.Item,{onClick:()=>{if(o)o();else if(t){const y=t;h({modelId:y,location:"Model switcher menu item"}),u(y)}},className:T("!pr-3",n&&"!opacity-100",f&&"pointer-events-none text-token-text-quaternary"),"data-testid":l,children:e.jsxs("div",{className:"flex grow items-center justify-between gap-2",children:[e.jsx("div",{className:c?"break-all":"",children:s(f!=null)}),r&&e.jsx(qe,{color:"secondary",size:"small",className:g.get("is_upgrade_button_blue",!1)?"border-none bg-blue-600 text-white hover:bg-blue-800":"",children:e.jsx(P,{id:"oKo8wt",defaultMessage:"Upgrade"})}),r?e.jsx(e.Fragment,{children:n&&e.jsx(Vi,{className:T("icon-md group-hover:invisible",!a&&"block group-hover:hidden")})}):n&&e.jsx(Wi,{className:"icon-md"})]})},t);return f?e.jsx(It,{isLeftArrow:!0,sideOffset:-10,label:e.jsx(ki,{modelSwitcherDeny:f}),children:p}):p}const bg=Rt(()=>Pt(()=>import("./fy8fd66itbk1l0er.js"),__vite__mapDeps([45,1,2,3,4,5,46])).then(t=>t.ThreadHeaderGizmoDropdown)),po=Me.button`group flex cursor-pointer items-center gap-1 rounded-lg py-1.5 ${({$isScreenArch:t})=>t?"text-md px-2 ml-1.5 translate-x-[-0.4rem]":"px-3 text-lg"} hover:bg-token-main-surface-secondary radix-state-open:bg-token-main-surface-secondary font-semibold text-token-text-secondary overflow-hidden whitespace-nowrap`;function vg({clientThreadId:t}){const s=te(),n=Ft(),a=Od(t),o=Js(),[,i]=Go(),r=()=>{!a&&!n?o({pathname:"/",search:new URLSearchParams({[Ps]:"true"}).toString()}):i(l=>(l.get(Ps)==="true"?l.delete(Ps):l.set(Ps,"true"),l),{replace:a,state:zd()})};return e.jsx(B.Item,{size:"large",className:"!pr-3",onClick:r,icon:Ph,children:e.jsxs("div",{className:"flex grow items-center justify-between gap-2",children:[e.jsx("div",{className:"flex flex-1 items-center gap-3",children:e.jsx(P,{...pr.temporaryChat})}),e.jsx(Bd,{enabled:n,label:s.formatMessage({defaultMessage:"Temporary",id:"temporaryChatToggleLabel"}),testId:"temporary-chat-toggle"})]})})}function fr(t,s,n){let a=t;if(t===Ua.AUTO){const r=s.filter(({defaultModel:l})=>l!==Ua.AUTO);r.length===1&&(a=r[0].defaultModel)}const o=s.find(({defaultModel:r})=>r===a);if(o){const{categoryId:r,shortLabel:l}=o;return{selectedCategory:r,modelLabel:l}}const i=n.find(({modelIds:r})=>r.includes(a));if(i){const{group:r,shortLabel:l}=i;return{selectedCategory:r,modelLabel:l}}return{selectedCategory:null,modelLabel:null}}function yg({modelLabel:t}){return e.jsx("span",{className:"text-token-text-secondary",children:t})}function wg({clientThreadId:t,inMobileHeader:s}){const{isLoading:n,categories:a,groups:o}=fa(),i=ol(),l=ga(t).id,c=Rd(),{modelLabel:h}=fr(l,a,o),u=Mg(t,c),f=te(),{isUnauthenticated:g}=Ge(),p=gr(),y=(!g||!p)&&!i;d.useEffect(()=>{n||Pd({namespace:bi.ChatPageLoad})?.logTiming("render_model_switcher")},[n]);const m=Xe(),b=e.jsxs("div",{className:T(!m&&"text-token-text-secondary"),children:[Id," ",y?e.jsx("span",{className:"text-token-text-secondary",children:h}):g&&h?e.jsx(yg,{modelLabel:h}):null]});return u.length?n?null:e.jsx(Jh,{sideOffset:8,size:"large",triggerButton:e.jsxs(po,{$isScreenArch:m,"aria-label":h?f.formatMessage({id:"JrtGPQ",defaultMessage:"Model selector, current model is {modelLabel}"},{modelLabel:h}):"",children:[b,m?e.jsx(Nh,{className:"icon-md text-token-text-tertiary"}):e.jsx(xa,{className:"icon-md text-token-text-tertiary"})]}),onOpenChange:x=>{W.logEvent(G.toggleModelSwitcher,{isOpen:x}),re.logEvent("toggle_model_switcher",null,{isOpen:String(x)})},contentAlign:s?"center":"start",testId:"model-switcher-dropdown",children:e.jsx(kg,{sections:u})}):e.jsx(po,{className:"cursor-default",children:b})}function gr(){return Ie("462735957").value}function jg({category:t,modelSwitcherDenialsBySlug:s,currentGizmoId:n,currentModelId:a,omitIcon:o,testId:i}){const{defaultModel:r,label:l,categoryId:c,description:h,isBeta:u}=t;return e.jsx(Ks,{value:r,modelSwitcherDenialsBySlug:s,renderName:f=>e.jsx($n,{categoryId:c,name:l,description:h,isDisabled:f,omitIcon:o,isBeta:u}),isSelected:!n&&a===r,testId:i},r)}function Mg(t,s){const n=ga(t),a=n.id,o=We(t),{categories:i,groups:r}=fa(),{doesUserHaveAnyAccountsWithPlusFeatures:l}=Qs(),c=J.getServerThreadId(t),h=Dd({clientThreadId:t}),u=te(),f=!c,{isUnauthenticated:g}=Ge(),p=Fd(),{layer:y}=De("2723963139"),m=y.get("is_dynamic_model_enabled",!1),b=gr(),x=s.find(({categoryId:_})=>_===Ze.ALPHA),M=s.find(({categoryId:_})=>_===Ze.DATA_CAMPAIGNS),S=s.find(({categoryId:_})=>_===Ze.EXPERIMENTS),v=s.find(({categoryId:_})=>_===Ze.MAINLINE),C=Ie("566128514").value,F=!!x?.options?.length,N=!!M?.options?.length,j=!!S?.options?.length,w=!!v?.options?.length,k=Js(),X=d.useCallback(()=>{W.logEvent(G.openModalAccountPaymentfromModelPicker,{content:"gizmo-button"}),_i(k,"Thread header dropdown")},[k]),U=()=>{re.logEvent("chatgpt_model_switcher_plus_upgrade_button_clicked"),W.logEvent(G.modelSwitcherPlusUpgradeButtonClicked),g?p({shouldOpenPaymentModalOnAuth:!0,callback:_=>{W.logSignUpButtonClicked({location:"Model switcher GPT-4 upsell",provider:_})}}):X()},R=[],O=e.jsxs("div",{className:"mb-1 flex items-center justify-between px-5 pt-2",children:[e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(P,{id:"ilkdMh",defaultMessage:"Model"})}),e.jsx("a",{href:m?"https://help.openai.com/en/articles/9155758-what-is-the-chatgpt-plus-model-selector":"https://help.openai.com/en/articles/7102672-how-can-i-access-gpt-4",target:"_blank",rel:"noreferrer",children:e.jsx(qi,{className:"icon-md h-5 w-5 pl-0.5 text-token-text-tertiary"})})]},"header");if(b&&g){const _={id:"modelSection",content:[]};_.content.push(e.jsx(Ld,{},"noAuthUpsell")),R.push(_)}else if(l){const _={id:"modelSection",content:[]};i.length&&_.content.push(O);const V=new Map;i.forEach(q=>{const K=e.jsx(jg,{category:q,currentGizmoId:o,currentModelId:a,modelSwitcherDenialsBySlug:h,omitIcon:C,testId:`model-switcher-${q.defaultModel}`},q.categoryId);q.subcategory?(V.has(q.subcategory)||V.set(q.subcategory,[]),V.get(q.subcategory)?.push(K)):_.content.push(K)}),V.forEach((q,K)=>{const H=i.find(Z=>Z.subcategory===K&&Z.defaultModel===n.id);_.content.push(e.jsxs(B.Sub,{children:[e.jsx(B.SubMenuTrigger,{"data-testid":K==="More models"?"more-models-submenu":void 0,children:e.jsxs("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:[K,!!H&&e.jsx("div",{className:"truncate text-token-text-tertiary",children:H.label})]})}),e.jsx(B.Portal,{children:e.jsx(B.SubContent,{className:"min-w-72",children:q})})]},K))}),R.push(_)}else{const _={id:"modelSection",content:[]};_.content.push(e.jsx(Ks,{value:"",onClick:U,modelSwitcherDenialsBySlug:h,isUpgradeUpsell:!0,renderName:V=>e.jsx($n,{icon:Ih,isDisabled:V,name:u.formatMessage({id:"mzDzkX",defaultMessage:"ChatGPT Plus"}),description:u.formatMessage({id:"bqTHri",defaultMessage:"Our smartest model & more"}),omitIcon:!1}),isSelected:!1,showNewChatHint:!1},"plusUpgrade")),_.content.push(e.jsx(Ks,{value:Mn.AUTO,modelSwitcherDenialsBySlug:h,renderName:V=>e.jsx($n,{icon:Rh,name:u.formatMessage({id:"U9E7Rx",defaultMessage:"ChatGPT"}),description:u.formatMessage({id:"n96qML",defaultMessage:"Great for everyday tasks"}),isDisabled:V,omitIcon:!1}),isSelected:!o&&a===Mn.AUTO,showNewChatHint:!0},Mn.AUTO)),R.push(_)}const L={id:"otherOptionsSection",content:[]},{selectedCategory:E}=fr(a,i,r);return f&&(F&&L.content.push(e.jsx(as,{isSelected:E===Ze.ALPHA,currentModel:n,option:x,modelSwitcherDenialsBySlug:h,displayInFull_INTERNAL_USE_ONLY:!0},x.value)),N&&L.content.push(e.jsx(as,{isSelected:E===Ze.DATA_CAMPAIGNS,currentModel:n,option:M,modelSwitcherDenialsBySlug:h,displayInFull_INTERNAL_USE_ONLY:!0},M.value)),j&&L.content.push(e.jsx(as,{currentModel:n,isSelected:E===Ze.EXPERIMENTS,option:S,modelSwitcherDenialsBySlug:h,displayInFull_INTERNAL_USE_ONLY:!0},S.value)),w&&L.content.push(e.jsx(as,{isSelected:E===Ze.MAINLINE,currentModel:n,option:v,modelSwitcherDenialsBySlug:h,displayInFull_INTERNAL_USE_ONLY:!0},v.value))),L.content.length&&R.push(L),g||R.push({id:"temporaryChatSection",content:[e.jsx(vg,{clientThreadId:t},"tempChat")]}),R}function Cg(){const t=te();return e.jsx("div",{className:"border-token-text-quartenary items-center rounded-full border px-1 py-0.5 text-[8px] font-semibold uppercase leading-3 text-token-text-secondary dark:border-token-border-heavy dark:text-token-text-tertiary",children:t.formatMessage(pr.beta)})}function $n({isDisabled:t,name:s,icon:n,categoryId:a,description:o,extra:i,omitIcon:r,isBeta:l=!1}){let c=s;return l&&(c=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),e.jsx(Cg,{})]})),e.jsxs("div",{className:"flex items-center gap-3",children:[!r&&e.jsx("span",{className:"flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-full bg-token-main-surface-secondary",children:n?e.jsx(n,{className:"h-4 w-4 text-token-text-primary"}):a&&e.jsx(Ti,{type:"filled",className:T("h-4 w-4",t&&"text-gray-300",!t&&"text-token-text-primary"),categoryId:a})}),e.jsxs("div",{children:[c,e.jsxs("div",{className:T(!t&&"text-token-text-secondary","text-xs"),children:[o,i]})]})]})}function kg({sections:t}){return e.jsx(e.Fragment,{children:t.map((s,n)=>e.jsxs($o.Fragment,{children:[n!==0?e.jsx(B.Separator,{}):null,s.content]},s.id))})}function _g({clientThreadId:t,inMobileHeader:s=!1}){const n=We(t);return n==null?e.jsx(wg,{clientThreadId:t,inMobileHeader:s}):e.jsx(bg,{clientThreadId:t,gizmoId:n,inMobileHeader:s})}const pr=ve({beta:{id:"XZwFET",defaultMessage:"Beta"},gpt35ShortExplainer:{defaultMessage:"Great for everyday tasks",id:"ModelSwitcher.gpt35ShortExplainer"},modelTunerSmartSelectionTitle:{id:"czjW8I",defaultMessage:"Dynamic"},modelTunerSmartSelectionExplainer:{id:"gp/YH1",defaultMessage:"Optimized for speed and intelligence"},gpt4ShortExplainer:{defaultMessage:"With DALL·E, browsing and analysis",id:"ModelSwitcher.gpt4ShortExplainer"},gpt4ShortExplainerWithoutBrowse:{defaultMessage:"With DALL·E and analysis",id:"ModelSwitcher.gpt4ShortExplainerWithoutBrowse"},gpt4UpsellExplainer:{id:"ModelSwitcher.gpt4Upsell",defaultMessage:"Our smartest and most capable model. Includes DALL·E, browsing and more."},userUpgrade:{id:"ModelSwithcer.upgradeButton",defaultMessage:"Upgrade to Plus"},userUpgradeSignup:{id:"ModelSwitcher.signupUpgradeButton",defaultMessage:"Sign up for ChatGPT Plus"},temporaryChat:{id:"ModelSwitcher.temporaryChat",defaultMessage:"Temporary chat"},shareChat:{id:"ModelSwitcher.shareChat",defaultMessage:"Share chat"}}),Tg=Rt(()=>Pt(()=>import("./hai6ts4stzvmr0rr.js"),__vite__mapDeps([47,1,2,3,48,49,4,5,50,51,7,43,52,11,6,8,9,10,12,53])).then(t=>t.GizmoUsingAsOwnerNotice)),Ag=({clientThreadId:t})=>{const s=Si(h=>h.activeStageSidebar),n=J.getServerThreadId(t),a=Ud(lt.WorkspaceShareLinks),{isUnauthenticated:o}=Ge(),i=Ft(),r=a&&n&&!o&&!i,l=Xe(),c=!s&&!l;return e.jsx("div",{className:"flex items-center gap-2 pr-1 leading-[0]",children:e.jsx(Xh,{showShareButton:r,showProfileDropdown:c,clientThreadId:t})})};function Eg({clientThreadId:t,gizmoId:s}){const n=Hd(),{data:a}=gs(s),o=Dt();return e.jsxs(e.Fragment,{children:[e.jsxs(Gd,{className:"max-md:hidden",children:[e.jsxs("div",{className:"absolute start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2",children:[a!=null&&o?.isWorkspaceAccount()&&a.gizmo.tags?.includes(la.WorkspaceDisabled)&&e.jsx(Tg,{gizmo:a}),e.jsx(Wd,{gizmoId:s,clientThreadId:t})]}),e.jsx(Vd,{children:e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden",children:[e.jsx(Qh,{clientThreadId:t}),e.jsx(_g,{clientThreadId:t})]})}),e.jsx(Ag,{clientThreadId:t})]}),n&&e.jsx(qd,{})]})}function xr({clientThreadId:t}){const s=We(t),n=ca(),a=Xe();return n||a?null:e.jsx(Eg,{gizmoId:s,clientThreadId:t})}function Ng({clientThreadId:t,currentModelId:s,isModelLoaded:n,onRequestCompletion:a,enableV2Homepage:o,v2HomepageDisclaimer:i}){const r=Ft();let l=e.jsx(am,{}),c;return r?(c=e.jsx(Rg,{}),l=e.jsx(fs,{className:"mb-6 h-12 w-12"})):t!=null?(c=o?e.jsx(ig,{clientThreadId:t,currentModelId:s,isModelLoaded:n,onRequestCompletion:a,v2HomepageDisclaimer:i}):e.jsx(om,{clientThreadId:t}),l=null):c=e.jsx(Pg,{}),e.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-token-text-primary",children:[l,c]})}function Rg({gizmo:t}){const s=Yd(),n=t?Xd(t.tools):!1,a=Dt();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-5 text-2xl font-semibold","data-testid":"temporary-chat-label",children:e.jsx(P,{...it.temporaryChat})}),e.jsxs("div",{className:"max-w-sm text-center text-sm font-normal text-token-text-tertiary",children:[e.jsx(P,{...a?.isWorkspaceAccount()?s?it.temporaryChatBizMemoryAvailable:it.temporaryChatBizMemoryUnavailable:s?it.temporaryChatDescriptionMemoryAvailable:it.temporaryChatDescriptionMemoryUnavailable}),n&&e.jsx("div",{className:"mt-3",children:e.jsx(P,{...it.temporaryChatDescriptionGptActions,values:{link:o=>e.jsx("a",{href:"https://help.openai.com/en/articles/8914046-temporary-chat-faq",target:"_blank",className:"underline",rel:"noreferrer",children:o})}})})]})]})}function Pg(){return e.jsx("div",{className:"mb-5 text-2xl font-semibold",children:e.jsx(P,{...it.howCanIHelpYouToday})})}function Ig({clientThreadId:t,currentModelId:s,isModelLoaded:n,onRequestCompletion:a,enableV2Homepage:o,v2HomepageDisclaimer:i}){const r=We(t),l=$d(),c=Qn(),{data:h}=gs(r),u=Kd(),f=il(()=>navigator.windowControlsOverlay);return(l!=null||r!=null)&&h==null?null:e.jsxs("div",{className:"relative h-full",children:[e.jsx("div",{className:f?.visible?T("absolute right-[calc(100dvw-env(titlebar-area-width,100dvw)-env(titlebar-area-x,0))]",u?"left-[env(titlebar-area-x,0)]":"left-0"):"absolute left-0 right-0",children:e.jsx(xr,{clientThreadId:t})}),h!=null?e.jsx(nm,{gizmo:h,showStarterPrompts:!0,disableStarterPrompts:c}):e.jsx(Ng,{clientThreadId:t,currentModelId:s,isModelLoaded:n,onRequestCompletion:a,enableV2Homepage:o,v2HomepageDisclaimer:i})]})}const it=ve({temporaryChat:{id:"GizmoLanding.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatBizMemoryAvailable:{id:"g1opBW",defaultMessage:"This chat won't appear in your history and won't use or create memories."},temporaryChatBizMemoryUnavailable:{id:"fQmbtG",defaultMessage:"This chat won't appear your conversation history."},temporaryChatDescriptionMemoryAvailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryAvailable",defaultMessage:"This chat won't appear in history, use or create memories, or be used to train our models. For safety purposes, we may keep a copy for up to 30 days."},temporaryChatDescriptionMemoryUnavailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryUnavailable",defaultMessage:"This chat won't appear in history or be used to train our models. For safety purposes, we may keep a copy of this chat for up to 30 days."},temporaryChatDescriptionGptActions:{id:"GizmoLanding.temporaryChatDescriptionGptActions",defaultMessage:"Any data shared with a third party through GPT actions are subject to the third party's privacy policy. <link>Learn more</link>"},howCanIHelpYouToday:{id:"GizmoLanding.howCanIHelpYouToday",defaultMessage:"How can I help you today?"}}),jt=({modelSwitcherDeny:t,value:s,label:n,subtitle:a,icon:o,onMouseEnter:i,onMouseLeave:r,onSelect:l,messageModelSlug:c,isHovered:h=!1,shouldShowUpsell:u=!1,className:f,includeCheck:g,includeRegenerate:p,justifyIcon:y,wrapIcon:m=!0})=>{const b=Dt(),x=!t,M=!x&&!u,S=Js(),v=()=>{if(!u){l?.();return}W.logEvent(G.openModalAccountPaymentfromMessageModelPicker),W.logRateLimitGetPlusButtonClicked({type:Zn.RATE_LIMIT,location:"message_model_switcher_dropdown",plan_type:b?.planType??"unknown",is_hard_block:!1,hard_block_reason:"",is_new_conversation:!1}),_i(S,"Message model switcher dropdown")};return e.jsx(B.Item,{onSelect:v,onMouseEnter:()=>x&&i?.(),onMouseLeave:()=>x&&r?.(),disabled:M,className:f??"radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed radix-disabled:hover:bg-transparent",children:e.jsxs(It,{label:t&&e.jsx(ki,{modelSwitcherDeny:t}),className:"flex w-full items-center justify-between gap-2",sideOffset:0,children:[e.jsxs("div",{className:T("flex items-center gap-3",y==="right"&&"w-full"),children:[!!o&&(m?e.jsx("span",{className:T("flex h-7 w-7 items-center justify-center rounded-full bg-token-main-surface-secondary",y==="right"&&"order-10 ml-auto"),children:o}):o),e.jsxs("div",{children:[e.jsx("div",{children:n}),e.jsx("div",{className:T({"text-sm text-token-text-secondary":!M},{"text-sm text-token-text-quaternary":M}),children:a})]})]}),u?e.jsx(qe,{color:"secondary",size:"small",children:e.jsx(P,{id:"54fmrA",defaultMessage:"Get Plus"})}):e.jsx(Dg,{messageModelSlug:c,isHovered:h,modelSwitcherDeny:t,optionModelSlug:s,includeCheck:g,includeRegenerate:p})]})})},Dg=({modelSwitcherDeny:t,optionModelSlug:s,isHovered:n,messageModelSlug:a,includeRegenerate:o=!0,includeCheck:i=!0})=>{let r=null;if(t)switch(t.reason){case Zn.RATE_LIMIT:r=Dh;break;default:r=qi;break}if(t)return e.jsx(r,{className:"icon-md"});const l=!!o&&e.jsx(dn,{className:T("icon-md hidden text-token-text-tertiary",{"group-hover:block":n})});return a===s&&i?e.jsxs(e.Fragment,{children:[e.jsx(Vi,{className:T("icon-md text-token-text-primary",{"group-hover:hidden":n})}),l]}):l};function Fg({className:t,clientThreadId:s,message:n,onModelSelect:a,onDropdownChange:o}){const i=te(),[r,l]=d.useState(null),[c,h]=d.useState(!1),[u,f]=d.useState(!1),g=Qd(),p=Ai(s),y=We(s),m=Ei({clientThreadId:s,message:n}),b=n.message.metadata?.model_slug,{modelOptions:x,modelSlug:M,animateModelLabelOnRender:S,nuxProps:v,messageModelEnabledTools:C}=m,F=Ni(n.message),N=C.includes(tn.Search),j=d.useMemo(()=>x.find(E=>E.value==b),[x,b]),{doesUserHaveAnyAccountsWithPlusFeatures:w}=Qs(),k=d.useRef(null),X=E=>{E||setTimeout(()=>{k.current&&k.current.blur()},10)};if(d.useEffect(()=>{X(c)},[c]),!g||y)return null;const U=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:i.formatMessage(xo.search),icon:e.jsx(bs,{className:"icon-sm"}),condition:N&&!F,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:i.formatMessage(xo.nosearch),icon:e.jsx($i,{className:"icon-sm"}),condition:N&&F,eventName:"chatgpt_regenerate_without_search_button_clicked"}];let R,O;v.shouldRenderNux?(R=Og,O={title:e.jsx(P,{id:"g/+2Hh",defaultMessage:"Optimized your response"}),description:e.jsx(P,{id:"H0Flqm",defaultMessage:"Used {usedModelName} for a faster response that saves your limited {largestModelName} messages",values:{usedModelName:v.usedModelName,largestModelName:v.largestModelName}}),markAsViewed:v.announcement.markAsViewed}):(R=Lg,O={label:p?e.jsx(P,{id:"LBYK9a",defaultMessage:"Change model"}):e.jsx(P,{id:"nygjPN",defaultMessage:"Used {modelName}",values:{modelName:v.usedModelName}})});const L=p&&x.some(E=>ms(E,w));return e.jsxs(B.Root,{onOpenChange:E=>{p&&(h(E),o(E),X(E)),E&&W.logEvent(G.conversationOpenMessageModelSelector,{has_get_plus_button:L})},children:[e.jsx(R,{...O,children:e.jsx(Xi,{ref:k,className:T("cursor-pointer",t),onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:e.jsx(Kn,{modelSlug:M,animateModelLabelOnRender:S,isDropdownOpen:c,isRegenerateEnabled:p,isHovered:u})})}),p&&e.jsxs(B.Content,{className:"z-30 origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[x.map(E=>{const _=ms(E,w),{value:V,...q}=E;return e.jsx(jt,{value:V,onSelect:()=>{re.logEvent("chatgpt_regenerate_switch_model_button_clicked",V,{requestedModelId:V,...et({clientThreadId:s})}),a({requestedModelId:V})},onMouseEnter:()=>l(V),onMouseLeave:()=>l(null),isHovered:r===V,messageModelSlug:n.message.metadata?.model_slug,shouldShowUpsell:_,...q},V)}),!!j&&e.jsxs(e.Fragment,{children:[e.jsx(B.Separator,{}),U.filter(E=>E.condition).map(E=>e.jsx(jt,{onSelect:()=>{re.logEvent(E.eventName,j.value,{requestedModelId:j.value,...et({clientThreadId:s})}),a({requestedModelId:j.value,extraStreamParams:E.extraStreamParams})},includeRegenerate:!0,onMouseEnter:()=>l(E.key),onMouseLeave:()=>l(null),isHovered:r===E.key,messageModelSlug:b,includeCheck:!1,...j,label:E.label,subtitle:"",icon:E.icon},E.key))]})]})]})}function Kn({modelSlug:t,animateModelLabelOnRender:s,isDropdownOpen:n,isRegenerateEnabled:a,isHovered:o,isRegenLabel:i=!1,animateShortLabel:r,omitIcon:l}){const[c,h]=d.useState("initial"),{categories:u}=fa({isRegen:!!i});d.useEffect(()=>{if(s){const x=setTimeout(()=>h("show"),500),M=setTimeout(()=>h("initial"),2e3);return()=>{clearTimeout(x),clearTimeout(M)}}h("initial")},[s]);const f=u.find(({defaultModel:x})=>x===t),g=t===Zd?{categoryId:"gpt_3.5",shorterLabel:"3.5"}:{},{categoryId:p,shorterLabel:y}=f??g,m={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},b=n?"visible":o?"show":c;return e.jsxs(ne.div,{initial:"initial",animate:b,className:"flex items-center pb-0",children:[!l&&(i?e.jsx(dn,{className:"icon-md"}):p&&e.jsx(Ti,{type:"outline",categoryId:p,className:"icon-md h-4 w-4"})),(a||r)&&e.jsx(ne.span,{className:"overflow-hidden text-clip whitespace-nowrap text-sm",variants:m,transition:{type:"tween",duration:.18},children:y}),a&&e.jsx(xa,{className:T("icon-sm",{"text-token-text-quaternary":!o&&!i},{"text-token-text-secondary":o&&!i})})]})}function Lg({children:t,label:s}){return e.jsx(It,{label:s,sideOffset:0,children:t})}function Og({children:t,title:s,description:n,markAsViewed:a}){return e.jsx(di,{show:!0,side:"bottom",sideOffset:-4,title:s,description:n,badge:"beta",onDismiss:a,dismissOnOutsideClick:!0,children:t})}function ms(t,s){const{modelSwitcherDeny:n,subscriptionLevel:a}=t;return!!n&&n.reason===Zn.RATE_LIMIT&&a===rl.PLUS&&!s}const xo=ve({search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Bg=d.memo(Fg),bt=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,Sr=new Set,Yn=typeof process=="object"&&process?process:{},br=(t,s,n,a)=>{typeof Yn.emitWarning=="function"?Yn.emitWarning(t,s,n,a):console.error(`[${n}] ${s}: ${t}`)};let Ys=globalThis.AbortController,So=globalThis.AbortSignal;if(typeof Ys>"u"){So=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(a,o){this._onabort.push(o)}},Ys=class{constructor(){s()}signal=new So;abort(a){if(!this.signal.aborted){this.signal.reason=a,this.signal.aborted=!0;for(const o of this.signal._onabort)o(a);this.signal.onabort?.(a)}}};let t=Yn.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1";const s=()=>{t&&(t=!1,br("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",s))}}const zg=t=>!Sr.has(t),Je=t=>t&&t===Math.floor(t)&&t>0&&isFinite(t),vr=t=>Je(t)?t<=Math.pow(2,8)?Uint8Array:t<=Math.pow(2,16)?Uint16Array:t<=Math.pow(2,32)?Uint32Array:t<=Number.MAX_SAFE_INTEGER?Us:null:null;class Us extends Array{constructor(s){super(s),this.fill(0)}}class Mt{heap;length;static#l=!1;static create(s){const n=vr(s);if(!n)return[];Mt.#l=!0;const a=new Mt(s,n);return Mt.#l=!1,a}constructor(s,n){if(!Mt.#l)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new n(s),this.length=0}push(s){this.heap[this.length++]=s}pop(){return this.heap[--this.length]}}class wa{#l;#u;#g;#p;#A;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#a;#x;#n;#s;#e;#c;#h;#r;#o;#S;#i;#b;#v;#m;#y;#C;#d;static unsafeExposeInternals(s){return{starts:s.#v,ttls:s.#m,sizes:s.#b,keyMap:s.#n,keyList:s.#s,valList:s.#e,next:s.#c,prev:s.#h,get head(){return s.#r},get tail(){return s.#o},free:s.#S,isBackgroundFetch:n=>s.#t(n),backgroundFetch:(n,a,o,i)=>s.#R(n,a,o,i),moveToTail:n=>s.#T(n),indexes:n=>s.#w(n),rindexes:n=>s.#j(n),isStale:n=>s.#f(n)}}get max(){return this.#l}get maxSize(){return this.#u}get calculatedSize(){return this.#x}get size(){return this.#a}get fetchMethod(){return this.#A}get dispose(){return this.#g}get disposeAfter(){return this.#p}constructor(s){const{max:n=0,ttl:a,ttlResolution:o=1,ttlAutopurge:i,updateAgeOnGet:r,updateAgeOnHas:l,allowStale:c,dispose:h,disposeAfter:u,noDisposeOnSet:f,noUpdateTTL:g,maxSize:p=0,maxEntrySize:y=0,sizeCalculation:m,fetchMethod:b,noDeleteOnFetchRejection:x,noDeleteOnStaleGet:M,allowStaleOnFetchRejection:S,allowStaleOnFetchAbort:v,ignoreFetchAbort:C}=s;if(n!==0&&!Je(n))throw new TypeError("max option must be a nonnegative integer");const F=n?vr(n):Array;if(!F)throw new Error("invalid max value: "+n);if(this.#l=n,this.#u=p,this.maxEntrySize=y||this.#u,this.sizeCalculation=m,this.sizeCalculation){if(!this.#u&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(b!==void 0&&typeof b!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#A=b,this.#C=!!b,this.#n=new Map,this.#s=new Array(n).fill(void 0),this.#e=new Array(n).fill(void 0),this.#c=new F(n),this.#h=new F(n),this.#r=0,this.#o=0,this.#S=Mt.create(n),this.#a=0,this.#x=0,typeof h=="function"&&(this.#g=h),typeof u=="function"?(this.#p=u,this.#i=[]):(this.#p=void 0,this.#i=void 0),this.#y=!!this.#g,this.#d=!!this.#p,this.noDisposeOnSet=!!f,this.noUpdateTTL=!!g,this.noDeleteOnFetchRejection=!!x,this.allowStaleOnFetchRejection=!!S,this.allowStaleOnFetchAbort=!!v,this.ignoreFetchAbort=!!C,this.maxEntrySize!==0){if(this.#u!==0&&!Je(this.#u))throw new TypeError("maxSize must be a positive integer if specified");if(!Je(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#O()}if(this.allowStale=!!c,this.noDeleteOnStaleGet=!!M,this.updateAgeOnGet=!!r,this.updateAgeOnHas=!!l,this.ttlResolution=Je(o)||o===0?o:1,this.ttlAutopurge=!!i,this.ttl=a||0,this.ttl){if(!Je(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#P()}if(this.#l===0&&this.ttl===0&&this.#u===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#l&&!this.#u){const N="LRU_CACHE_UNBOUNDED";zg(N)&&(Sr.add(N),br("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",N,wa))}}getRemainingTTL(s){return this.#n.has(s)?1/0:0}#P(){const s=new Us(this.#l),n=new Us(this.#l);this.#m=s,this.#v=n,this.#I=(i,r,l=bt.now())=>{if(n[i]=r!==0?l:0,s[i]=r,r!==0&&this.ttlAutopurge){const c=setTimeout(()=>{this.#f(i)&&this.delete(this.#s[i])},r+1);c.unref&&c.unref()}},this.#k=i=>{n[i]=s[i]!==0?bt.now():0},this.#M=(i,r)=>{if(s[r]){const l=s[r],c=n[r];if(!l||!c)return;i.ttl=l,i.start=c,i.now=a||o();const h=i.now-c;i.remainingTTL=l-h}};let a=0;const o=()=>{const i=bt.now();if(this.ttlResolution>0){a=i;const r=setTimeout(()=>a=0,this.ttlResolution);r.unref&&r.unref()}return i};this.getRemainingTTL=i=>{const r=this.#n.get(i);if(r===void 0)return 0;const l=s[r],c=n[r];if(!l||!c)return 1/0;const h=(a||o())-c;return l-h},this.#f=i=>{const r=n[i],l=s[i];return!!l&&!!r&&(a||o())-r>l}}#k=()=>{};#M=()=>{};#I=()=>{};#f=()=>!1;#O(){const s=new Us(this.#l);this.#x=0,this.#b=s,this.#_=n=>{this.#x-=s[n],s[n]=0},this.#D=(n,a,o,i)=>{if(this.#t(a))return 0;if(!Je(o))if(i){if(typeof i!="function")throw new TypeError("sizeCalculation must be a function");if(o=i(a,n),!Je(o))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return o},this.#E=(n,a,o)=>{if(s[n]=a,this.#u){const i=this.#u-s[n];for(;this.#x>i;)this.#N(!0)}this.#x+=s[n],o&&(o.entrySize=a,o.totalCalculatedSize=this.#x)}}#_=s=>{};#E=(s,n,a)=>{};#D=(s,n,a,o)=>{if(a||o)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#w({allowStale:s=this.allowStale}={}){if(this.#a)for(let n=this.#o;!(!this.#F(n)||((s||!this.#f(n))&&(yield n),n===this.#r));)n=this.#h[n]}*#j({allowStale:s=this.allowStale}={}){if(this.#a)for(let n=this.#r;!(!this.#F(n)||((s||!this.#f(n))&&(yield n),n===this.#o));)n=this.#c[n]}#F(s){return s!==void 0&&this.#n.get(this.#s[s])===s}*entries(){for(const s of this.#w())this.#e[s]!==void 0&&this.#s[s]!==void 0&&!this.#t(this.#e[s])&&(yield[this.#s[s],this.#e[s]])}*rentries(){for(const s of this.#j())this.#e[s]!==void 0&&this.#s[s]!==void 0&&!this.#t(this.#e[s])&&(yield[this.#s[s],this.#e[s]])}*keys(){for(const s of this.#w()){const n=this.#s[s];n!==void 0&&!this.#t(this.#e[s])&&(yield n)}}*rkeys(){for(const s of this.#j()){const n=this.#s[s];n!==void 0&&!this.#t(this.#e[s])&&(yield n)}}*values(){for(const s of this.#w())this.#e[s]!==void 0&&!this.#t(this.#e[s])&&(yield this.#e[s])}*rvalues(){for(const s of this.#j())this.#e[s]!==void 0&&!this.#t(this.#e[s])&&(yield this.#e[s])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(s,n={}){for(const a of this.#w()){const o=this.#e[a],i=this.#t(o)?o.__staleWhileFetching:o;if(i!==void 0&&s(i,this.#s[a],this))return this.get(this.#s[a],n)}}forEach(s,n=this){for(const a of this.#w()){const o=this.#e[a],i=this.#t(o)?o.__staleWhileFetching:o;i!==void 0&&s.call(n,i,this.#s[a],this)}}rforEach(s,n=this){for(const a of this.#j()){const o=this.#e[a],i=this.#t(o)?o.__staleWhileFetching:o;i!==void 0&&s.call(n,i,this.#s[a],this)}}purgeStale(){let s=!1;for(const n of this.#j({allowStale:!0}))this.#f(n)&&(this.delete(this.#s[n]),s=!0);return s}info(s){const n=this.#n.get(s);if(n===void 0)return;const a=this.#e[n],o=this.#t(a)?a.__staleWhileFetching:a;if(o===void 0)return;const i={value:o};if(this.#m&&this.#v){const r=this.#m[n],l=this.#v[n];if(r&&l){const c=r-(bt.now()-l);i.ttl=c,i.start=Date.now()}}return this.#b&&(i.size=this.#b[n]),i}dump(){const s=[];for(const n of this.#w({allowStale:!0})){const a=this.#s[n],o=this.#e[n],i=this.#t(o)?o.__staleWhileFetching:o;if(i===void 0||a===void 0)continue;const r={value:i};if(this.#m&&this.#v){r.ttl=this.#m[n];const l=bt.now()-this.#v[n];r.start=Math.floor(Date.now()-l)}this.#b&&(r.size=this.#b[n]),s.unshift([a,r])}return s}load(s){this.clear();for(const[n,a]of s){if(a.start){const o=Date.now()-a.start;a.start=bt.now()-o}this.set(n,a.value,a)}}set(s,n,a={}){if(n===void 0)return this.delete(s),this;const{ttl:o=this.ttl,start:i,noDisposeOnSet:r=this.noDisposeOnSet,sizeCalculation:l=this.sizeCalculation,status:c}=a;let{noUpdateTTL:h=this.noUpdateTTL}=a;const u=this.#D(s,n,a.size||0,l);if(this.maxEntrySize&&u>this.maxEntrySize)return c&&(c.set="miss",c.maxEntrySizeExceeded=!0),this.delete(s),this;let f=this.#a===0?void 0:this.#n.get(s);if(f===void 0)f=this.#a===0?this.#o:this.#S.length!==0?this.#S.pop():this.#a===this.#l?this.#N(!1):this.#a,this.#s[f]=s,this.#e[f]=n,this.#n.set(s,f),this.#c[this.#o]=f,this.#h[f]=this.#o,this.#o=f,this.#a++,this.#E(f,u,c),c&&(c.set="add"),h=!1;else{this.#T(f);const g=this.#e[f];if(n!==g){if(this.#C&&this.#t(g)){g.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:p}=g;p!==void 0&&!r&&(this.#y&&this.#g?.(p,s,"set"),this.#d&&this.#i?.push([p,s,"set"]))}else r||(this.#y&&this.#g?.(g,s,"set"),this.#d&&this.#i?.push([g,s,"set"]));if(this.#_(f),this.#E(f,u,c),this.#e[f]=n,c){c.set="replace";const p=g&&this.#t(g)?g.__staleWhileFetching:g;p!==void 0&&(c.oldValue=p)}}else c&&(c.set="update")}if(o!==0&&!this.#m&&this.#P(),this.#m&&(h||this.#I(f,o,i),c&&this.#M(c,f)),!r&&this.#d&&this.#i){const g=this.#i;let p;for(;p=g?.shift();)this.#p?.(...p)}return this}pop(){try{for(;this.#a;){const s=this.#e[this.#r];if(this.#N(!0),this.#t(s)){if(s.__staleWhileFetching)return s.__staleWhileFetching}else if(s!==void 0)return s}}finally{if(this.#d&&this.#i){const s=this.#i;let n;for(;n=s?.shift();)this.#p?.(...n)}}}#N(s){const n=this.#r,a=this.#s[n],o=this.#e[n];return this.#C&&this.#t(o)?o.__abortController.abort(new Error("evicted")):(this.#y||this.#d)&&(this.#y&&this.#g?.(o,a,"evict"),this.#d&&this.#i?.push([o,a,"evict"])),this.#_(n),s&&(this.#s[n]=void 0,this.#e[n]=void 0,this.#S.push(n)),this.#a===1?(this.#r=this.#o=0,this.#S.length=0):this.#r=this.#c[n],this.#n.delete(a),this.#a--,n}has(s,n={}){const{updateAgeOnHas:a=this.updateAgeOnHas,status:o}=n,i=this.#n.get(s);if(i!==void 0){const r=this.#e[i];if(this.#t(r)&&r.__staleWhileFetching===void 0)return!1;if(this.#f(i))o&&(o.has="stale",this.#M(o,i));else return a&&this.#k(i),o&&(o.has="hit",this.#M(o,i)),!0}else o&&(o.has="miss");return!1}peek(s,n={}){const{allowStale:a=this.allowStale}=n,o=this.#n.get(s);if(o===void 0||!a&&this.#f(o))return;const i=this.#e[o];return this.#t(i)?i.__staleWhileFetching:i}#R(s,n,a,o){const i=n===void 0?void 0:this.#e[n];if(this.#t(i))return i;const r=new Ys,{signal:l}=a;l?.addEventListener("abort",()=>r.abort(l.reason),{signal:r.signal});const c={signal:r.signal,options:a,context:o},h=(m,b=!1)=>{const{aborted:x}=r.signal,M=a.ignoreFetchAbort&&m!==void 0;if(a.status&&(x&&!b?(a.status.fetchAborted=!0,a.status.fetchError=r.signal.reason,M&&(a.status.fetchAbortIgnored=!0)):a.status.fetchResolved=!0),x&&!M&&!b)return f(r.signal.reason);const S=p;return this.#e[n]===p&&(m===void 0?S.__staleWhileFetching?this.#e[n]=S.__staleWhileFetching:this.delete(s):(a.status&&(a.status.fetchUpdated=!0),this.set(s,m,c.options))),m},u=m=>(a.status&&(a.status.fetchRejected=!0,a.status.fetchError=m),f(m)),f=m=>{const{aborted:b}=r.signal,x=b&&a.allowStaleOnFetchAbort,M=x||a.allowStaleOnFetchRejection,S=M||a.noDeleteOnFetchRejection,v=p;if(this.#e[n]===p&&(!S||v.__staleWhileFetching===void 0?this.delete(s):x||(this.#e[n]=v.__staleWhileFetching)),M)return a.status&&v.__staleWhileFetching!==void 0&&(a.status.returnedStale=!0),v.__staleWhileFetching;if(v.__returned===v)throw m},g=(m,b)=>{const x=this.#A?.(s,i,c);x&&x instanceof Promise&&x.then(M=>m(M===void 0?void 0:M),b),r.signal.addEventListener("abort",()=>{(!a.ignoreFetchAbort||a.allowStaleOnFetchAbort)&&(m(void 0),a.allowStaleOnFetchAbort&&(m=M=>h(M,!0)))})};a.status&&(a.status.fetchDispatched=!0);const p=new Promise(g).then(h,u),y=Object.assign(p,{__abortController:r,__staleWhileFetching:i,__returned:void 0});return n===void 0?(this.set(s,y,{...c.options,status:void 0}),n=this.#n.get(s)):this.#e[n]=y,y}#t(s){if(!this.#C)return!1;const n=s;return!!n&&n instanceof Promise&&n.hasOwnProperty("__staleWhileFetching")&&n.__abortController instanceof Ys}async fetch(s,n={}){const{allowStale:a=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,ttl:r=this.ttl,noDisposeOnSet:l=this.noDisposeOnSet,size:c=0,sizeCalculation:h=this.sizeCalculation,noUpdateTTL:u=this.noUpdateTTL,noDeleteOnFetchRejection:f=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:g=this.allowStaleOnFetchRejection,ignoreFetchAbort:p=this.ignoreFetchAbort,allowStaleOnFetchAbort:y=this.allowStaleOnFetchAbort,context:m,forceRefresh:b=!1,status:x,signal:M}=n;if(!this.#C)return x&&(x.fetch="get"),this.get(s,{allowStale:a,updateAgeOnGet:o,noDeleteOnStaleGet:i,status:x});const S={allowStale:a,updateAgeOnGet:o,noDeleteOnStaleGet:i,ttl:r,noDisposeOnSet:l,size:c,sizeCalculation:h,noUpdateTTL:u,noDeleteOnFetchRejection:f,allowStaleOnFetchRejection:g,allowStaleOnFetchAbort:y,ignoreFetchAbort:p,status:x,signal:M};let v=this.#n.get(s);if(v===void 0){x&&(x.fetch="miss");const C=this.#R(s,v,S,m);return C.__returned=C}else{const C=this.#e[v];if(this.#t(C)){const k=a&&C.__staleWhileFetching!==void 0;return x&&(x.fetch="inflight",k&&(x.returnedStale=!0)),k?C.__staleWhileFetching:C.__returned=C}const F=this.#f(v);if(!b&&!F)return x&&(x.fetch="hit"),this.#T(v),o&&this.#k(v),x&&this.#M(x,v),C;const N=this.#R(s,v,S,m),w=N.__staleWhileFetching!==void 0&&a;return x&&(x.fetch=F?"stale":"refresh",w&&F&&(x.returnedStale=!0)),w?N.__staleWhileFetching:N.__returned=N}}get(s,n={}){const{allowStale:a=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,status:r}=n,l=this.#n.get(s);if(l!==void 0){const c=this.#e[l],h=this.#t(c);return r&&this.#M(r,l),this.#f(l)?(r&&(r.get="stale"),h?(r&&a&&c.__staleWhileFetching!==void 0&&(r.returnedStale=!0),a?c.__staleWhileFetching:void 0):(i||this.delete(s),r&&a&&(r.returnedStale=!0),a?c:void 0)):(r&&(r.get="hit"),h?c.__staleWhileFetching:(this.#T(l),o&&this.#k(l),c))}else r&&(r.get="miss")}#L(s,n){this.#h[n]=s,this.#c[s]=n}#T(s){s!==this.#o&&(s===this.#r?this.#r=this.#c[s]:this.#L(this.#h[s],this.#c[s]),this.#L(this.#o,s),this.#o=s)}delete(s){let n=!1;if(this.#a!==0){const a=this.#n.get(s);if(a!==void 0)if(n=!0,this.#a===1)this.clear();else{this.#_(a);const o=this.#e[a];if(this.#t(o)?o.__abortController.abort(new Error("deleted")):(this.#y||this.#d)&&(this.#y&&this.#g?.(o,s,"delete"),this.#d&&this.#i?.push([o,s,"delete"])),this.#n.delete(s),this.#s[a]=void 0,this.#e[a]=void 0,a===this.#o)this.#o=this.#h[a];else if(a===this.#r)this.#r=this.#c[a];else{const i=this.#h[a];this.#c[i]=this.#c[a];const r=this.#c[a];this.#h[r]=this.#h[a]}this.#a--,this.#S.push(a)}}if(this.#d&&this.#i?.length){const a=this.#i;let o;for(;o=a?.shift();)this.#p?.(...o)}return n}clear(){for(const s of this.#j({allowStale:!0})){const n=this.#e[s];if(this.#t(n))n.__abortController.abort(new Error("deleted"));else{const a=this.#s[s];this.#y&&this.#g?.(n,a,"delete"),this.#d&&this.#i?.push([n,a,"delete"])}}if(this.#n.clear(),this.#e.fill(void 0),this.#s.fill(void 0),this.#m&&this.#v&&(this.#m.fill(0),this.#v.fill(0)),this.#b&&this.#b.fill(0),this.#r=0,this.#o=0,this.#S.length=0,this.#x=0,this.#a=0,this.#d&&this.#i){const s=this.#i;let n;for(;n=s?.shift();)this.#p?.(...n)}}}function Ug({conversationId:t,messageId:s}){const[n,a]=d.useState(!1),o=d.useRef({isMediaSourceAvailable:ja(),mediaSourceFormat:Ma()??"n/a",playPromise:null,shouldAbortQueuedPlayback:!1}).current,i=te(),r=Nt(),{voiceName:l}=Jd(),c=`${t}.${s}.${l}`,h=ll(),u=cl(m=>m.isPlaying&&m.sourceUrl===ze.get(c)?.src),f=d.useCallback(async()=>{if(!h)return;a(!0);const m={isMediaSourceAvailable:o.isMediaSourceAvailable,format:o.mediaSourceFormat};try{const b=await Hg({key:c,message_id:s,conversation_id:t,voice:l,onStreamingError:x=>{os.readAloud.error(x,m),a(!1),r.danger(i.formatMessage(bo.playbackError,{error:x.message}))},onStreamingStart:()=>{a(!1)}});if(o.shouldAbortQueuedPlayback){o.shouldAbortQueuedPlayback=!1;return}h.changeSource(b),o.playPromise=h.play()}catch(b){os.readAloud.error(b,m),a(!1),r.danger(i.formatMessage(bo.playbackError,{error:b.message}))}},[h,o,c,s,t,l,r,i]),g=d.useCallback(()=>{const m=Ha();m&&(o.playPromise?o.playPromise.then(()=>{m.stop(),o.playPromise=null}):m.stop())},[o]),p=d.useCallback(()=>{const m=Ha();m&&(m.state.isPlaying&&m.state.sourceUrl===ze.get(c)?.src?g():(os.readAloud.click({isMediaSourceAvailable:o.isMediaSourceAvailable,format:o.mediaSourceFormat}),f()))},[c,o,f,g]);d.useEffect(()=>{n&&u&&a(!1)},[n,u]);const y=d.useRef(c);return d.useEffect(()=>{y.current=c}),d.useEffect(()=>(o.shouldAbortQueuedPlayback=!1,()=>{const m=dl();m.isPlaying&&m.sourceUrl===ze.get(y.current)?.src?g():o.shouldAbortQueuedPlayback=!0}),[o,g]),{togglePlayback:p,isPlaying:u,isLoading:n}}async function yr({message_id:t,conversation_id:s,voice:n}){const a=await Ye.synthesize({message_id:t,conversation_id:s,voice:n,format:Ma()}),o=a.headers.get("content-type")??"audio/aac";return{response:a,format:o}}async function Hg(t){return ja()?Wg(t):Gg(t)}async function Gg({key:t,...s}){const n=ze.get(t);if(n?.blob)return n.src;const{response:a,format:o}=await yr(s),i=await a.arrayBuffer(),r=new Blob([i],{type:o}),l=wr({key:t,src:URL.createObjectURL(r),format:o,blob:r});return ze.set(t,l),l.src}async function Wg({key:t,onStreamingError:s,onStreamingStart:n,...a}){let o=ze.get(t);o?.streaming&&(ze.delete(t),o=void 0);let i,r;const l=qg(),c=new l;if(o)i=o,i.src=URL.createObjectURL(c);else{const{format:f,response:g}=await yr(a);r=g,i=wr({key:t,src:URL.createObjectURL(c),format:f})}const h=Vg(i.id),u={sourceopen:async()=>{h("sourceopen");const f=c.addSourceBuffer(i.format),g=async()=>{f.updating&&await new Promise(p=>f.addEventListener("updateend",p,{once:!0}))};if(i.segments.length&&!i.streaming){h("streaming from cache"),i.streaming=!0,n();for(const p of i.segments)f.appendBuffer(p),await g();c.readyState==="open"&&c.endOfStream(),i.streaming=!1,h("done streaming from cache");return}if(r){h("fetching audio");try{const p=r.body?.getReader();if(!p)return;for(;ze.get(t)?.id===i.id;){const{done:y,value:m}=await p.read();if(y){h("done streaming"),i.streaming=!1,c.readyState==="open"&&c.endOfStream();break}if(!Array.from(c.sourceBuffers).includes(f)){h("stop streaming, source buffer removed"),i.streaming=!1;break}i.streaming||(h("start streaming"),i.streaming=!0,n()),f.appendBuffer(m),i.segments.push(m),await g()}}catch(p){if(h("error while streaming",p),i.streaming=!1,c.readyState==="open")try{c.endOfStream("network")}catch(y){os.readAloud.error(y)}ze.delete(t),s(p)}}},sourceclose:()=>{h("sourceclose"),i.streaming&&(i.streaming=!1,ze.get(t)?.id===i.id&&(h("sourceclosed while streaming, cleaning up cache"),ze.delete(t)))},sourceended:yt};for(const[f,g]of Object.entries(u))c.addEventListener(f,()=>{try{return g()}catch(p){os.readAloud.error(p)}});return ze.set(t,i),i.src}const bo=ve({playbackError:{id:"useVoiceReadAloudAudio.playbackError",defaultMessage:"Failed to play message"}}),Vg=t=>yt;function qg(){return ja()?window.MediaSource:null}function ja(){return!!Ma()}function Ma(){if("MediaSource"in window){const t=s=>ul(s)&&MediaSource.isTypeSupported(s);if(t("audio/aac"))return"aac";if(t("audio/mpeg"))return"mp3";if(t("audio/ogg"))return"ogg"}}const wr=t=>({id:qo(),segments:[],streaming:!1,...t}),ze=new wa({max:50,dispose:t=>{URL.revokeObjectURL(t.src)}}),$g=d.memo(function(s){const n=kt("1923022511")?.value,a=Lt(s.conversationId),{errCode:o}=pa(s.message);if(!n||!a||o)return null;const i=Ri.getAudioAssetPointers(s.message.message)[0];return i?e.jsx(Kg,{audioAssetPointer:i,conversationId:a}):e.jsx(Yg,{...s,conversationId:a})});function Kg({audioAssetPointer:t,conversationId:s}){const{isLoading:n,isPlaying:a,togglePlayback:o}=eu({audioAssetPointer:t,conversationId:s});return e.jsx(jr,{onClick:o,isPlaying:a,isLoading:n,playText:Xs.replay,playIcon:Fh})}function Yg({conversationId:t,message:s}){const{isLoading:n,isPlaying:a,togglePlayback:o}=Ug({conversationId:t,messageId:s.message.id});return e.jsx(jr,{onClick:o,isPlaying:a,isLoading:n,playText:Xs.play,playIcon:Lh})}function jr({onClick:t,isPlaying:s,isLoading:n,playText:a,playIcon:o}){let i,r;const l=te();return n?(i=zo,r=Xs.loading):s?(i=Oh,r=Xs.stop):(i=o,r=a),e.jsx(ts,{icon:i,label:r?l.formatMessage(r):void 0,disabled:n,onClick:t,style:s||n?{visibility:"visible"}:void 0,testId:"voice-play-turn-action-button"})}const Xs={replay:{id:"VoiceReadOutLoudButton.replay",defaultMessage:"Replay",description:"The tooltip for the replay button"},play:{id:"VoiceReadOutLoudButton.play",defaultMessage:"Read aloud",description:"The tooltip for the read aloud button"},stop:{id:"VoiceReadOutLoudButton.stop",defaultMessage:"Stop",description:"The tooltip for the stop button"},loading:{id:"VoiceReadOutLoudButton.loading",defaultMessage:"Loading",description:"The tooltip for the spinner"}},Ls="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function Xg({className:t,clientThreadId:s,message:n,onModelSelect:a,onDropdownChange:o,canRegenerateResponse:i}){const r=Ie("566128514").value,[l,c]=d.useState(null),[h,u]=d.useState(!1),[f,g]=d.useState(!1),p=We(s),y=Ei({clientThreadId:s,message:n}),m=n.message.metadata?.model_slug,b=n.message.id,{modelOptions:x,modelSlug:M,animateModelLabelOnRender:S,messageModelEnabledTools:v}=y,C=Ni(n.message),F=v.includes(tn.Search),N=d.useMemo(()=>x.find(R=>R.value===m),[x,m]),j=d.useRef(null),{doesUserHaveAnyAccountsWithPlusFeatures:w}=Qs(),k=R=>{R||setTimeout(()=>{j.current&&j.current.blur()},10)};if(d.useEffect(()=>{k(h)},[h]),tu(s))return null;const U=i&&x.some(R=>ms(R,w));return p?null:e.jsxs(B.Root,{onOpenChange:R=>{i&&(u(R),o(R),k(R)),R&&W.logEvent(G.conversationOpenMessageModelSelector,{has_get_plus_button:U,is_new_regen_dropdown:!0})},children:[i?e.jsx(Zg,{label:e.jsx(P,{id:"wDs5sz",defaultMessage:"Switch model"}),children:e.jsx(Xi,{ref:j,className:T("cursor-pointer",t),onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:e.jsx(Kn,{modelSlug:M,animateModelLabelOnRender:S,isDropdownOpen:h,isRegenerateEnabled:i,isHovered:f,isRegenLabel:!0,omitIcon:!1})})}):e.jsx("button",{className:T("cursor-pointer",t),onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:e.jsx(Kn,{modelSlug:M,animateModelLabelOnRender:S,isDropdownOpen:!1,isRegenerateEnabled:!1,isHovered:f,omitIcon:r,animateShortLabel:!0})}),i&&e.jsx(B.Portal,{children:e.jsxs(B.Content,{className:"z-30 min-w-fit origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[e.jsx(B.Item,{disabled:!0,className:"pb-0 pt-2",children:e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(P,{id:"bFLh5u",defaultMessage:"Switch model"})})}),e.jsx(Qg,{clientThreadId:s,messageId:b,onModelSelect:a,messageModelSlug:m,omitModelIcons:r,modelOptions:x,setHoveredOption:c,hoveredOption:l,retryOption:N,lastResponseUsedSearch:C,modelSupportsSearch:F,doesUserHaveAnyAccountsWithPlusFeatures:w})]})})]})}function Qg({clientThreadId:t,messageId:s,modelOptions:n,messageModelSlug:a,onModelSelect:o,omitModelIcons:i,setHoveredOption:r,hoveredOption:l,retryOption:c,lastResponseUsedSearch:h,modelSupportsSearch:u,doesUserHaveAnyAccountsWithPlusFeatures:f}){const g=te(),[p,y]=d.useMemo(()=>rs(n,S=>S.subcategory),[n]),m=d.useMemo(()=>{const S=new Map;return p.forEach(v=>{const C=v.subcategory;C&&(S.has(C)||S.set(C,[]),S.get(C)?.push(v))}),S},[p]),b=T("icon-sm",i&&"order-10 ml-auto text-token-text-tertiary icon-md"),x=i?"right":"left",M=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:g.formatMessage(Tn.search),icon:e.jsx(bs,{className:b}),condition:u&&!h,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:g.formatMessage(Tn.nosearch),icon:e.jsx($i,{className:b}),condition:u&&h,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return e.jsxs(e.Fragment,{children:[y.map(S=>{const{value:v,...C}=S;return e.jsx(jt,{value:v,onSelect:()=>{re.logEvent("chatgpt_regenerate_switch_model_button_clicked",v,{requestedModelId:v,...et({clientThreadId:t,messageId:s})}),o({requestedModelId:v})},includeRegenerate:!1,onMouseEnter:()=>r(v),onMouseLeave:()=>r(null),isHovered:l===v,messageModelSlug:a,includeCheck:!1,shouldShowUpsell:ms(S,f),className:Ls,...C,icon:i?e.jsx("span",{className:b}):C.icon,justifyIcon:x,wrapIcon:!i},v)}),[...m.entries()].map(([S,v])=>e.jsxs(B.Sub,{children:[e.jsx(B.SubMenuTrigger,{children:e.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:S})}),e.jsx(B.Portal,{children:e.jsx(B.SubContent,{className:"min-w-fit",children:v.map(C=>{const{value:F,...N}=C;return e.jsx(jt,{value:F,onSelect:()=>{re.logEvent("chatgpt_regenerate_switch_model_button_clicked",F,{requestedModelId:F,...et({clientThreadId:t,messageId:s})}),o({requestedModelId:F})},includeRegenerate:!1,onMouseEnter:()=>r(F),onMouseLeave:()=>r(null),isHovered:l===F,messageModelSlug:a,includeCheck:!1,className:Ls,...N,icon:null,justifyIcon:x,wrapIcon:!i,shouldShowUpsell:ms(C,f)},S+"-"+F)})})})]},S)),!!c&&e.jsxs(e.Fragment,{children:[e.jsx(B.Separator,{}),e.jsx(jt,{onSelect:()=>{re.logEvent("chatgpt_regenerate_try_again_button_clicked",c.value,{requestedModelId:c.value,...et({clientThreadId:t,messageId:s})}),o({requestedModelId:c.value})},includeRegenerate:!0,onMouseEnter:()=>r(c.value),onMouseLeave:()=>r(null),messageModelSlug:a,includeCheck:!1,className:Ls,...c,label:g.formatMessage(Tn.tryAgain),subtitle:c.label,icon:e.jsx(dn,{className:b}),justifyIcon:x,wrapIcon:!i},c.value),M.filter(S=>S.condition).map(S=>e.jsx(jt,{onSelect:()=>{re.logEvent(S.eventName,c.value,{requestedModelId:c.value,...et({clientThreadId:t,messageId:s})}),o({requestedModelId:c.value,extraStreamParams:S.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>r(S.key),onMouseLeave:()=>r(null),isHovered:l===S.key,messageModelSlug:a,includeCheck:!1,className:Ls,...c,label:S.label,subtitle:"",icon:S.icon,justifyIcon:x,wrapIcon:!i},S.key))]})]})}function Zg({children:t,label:s}){return e.jsx(It,{label:s,sideOffset:0,children:t})}const Tn=ve({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Jg=d.memo(Xg);function Mr(t){return t.find(s=>s.message.author.role===be.Tool&&s.message.metadata?.pending_memory_info)}function ep(t){return t.filter((s,n)=>{const a=t[n+1],i=a?.message.recipient==="assistant"&&a?.message.author.role===be.Tool&&a?.message.author.name==="bio"&&Pi(a.message).startsWith("Model set context");return s.message.author.role===be.Assistant&&s.message.recipient==="bio"&&i}).flatMap(s=>{const n=s.message.content.content_type;return n===_t.Text?s.message.content.parts:n===_t.Code?[s.message.content.text]:[]}).map(rp)}function tp(t){return t.some(s=>s.message.author.role===be.Assistant&&s.message.recipient==="bio"&&s.message.status==="in_progress")}function sp(t){const{eligible:s,isLoading:n}=su(),a=d.useMemo(()=>t.length>0,[t]);d.useEffect(()=>{a&&s&&!n&&ds.openModal(Ii.GlobalMemoryOnboarding)},[a,s,n])}function np(t){const[s,n]=d.useState(!1);return{isPopoverOpen:s,setIsPopoverOpen:n,handleTogglePopover:o=>{const i=o??!s;n(i),i&&W.logEvent(G.memoryUpdatePopoverShown,{updateCount:t.length})}}}function Cr({memoryWrites:t,popoverState:s,triggerButton:n,isParagen:a,setShowMemoriesModal:o}){return e.jsxs(nu,{open:s.isPopoverOpen,sideOffset:4,side:"bottom",alignAgainstAnchor:"start",size:"none",className:"z-10 min-w-60 max-w-96 text-sm",onOpenChange:i=>s.handleTogglePopover(i),disableAutofocus:!0,triggerButton:n,children:[e.jsx("div",{className:"mb-2 rounded border border-token-border-light bg-token-main-surface-secondary",children:t.map((i,r)=>e.jsx("div",{className:"border-b border-token-border-light px-3 py-2 first-letter:uppercase last:border-b-0",children:i},r))}),a?e.jsx("div",{className:"text-xs text-token-text-tertiary",children:e.jsx(P,{id:"MemoryActionResult.paragenMessage",defaultMessage:"This memory will be saved if you choose this response."})}):e.jsxs("button",{className:"flex w-full items-center justify-between rounded px-3 py-2 font-semibold hover:bg-token-main-surface-secondary",onClick:()=>{o(!0),W.logEvent(G.memoryUpdatePopoverManageButtonClicked,{updateCount:t.length})},children:[e.jsx(P,{id:"MemoryActionResult.manageMemories",defaultMessage:"Manage memories"}),e.jsx(zh,{className:"icon-md -mr-1 text-token-text-tertiary"})]})]})}function ap({clientThreadId:t,pendingMessage:s,memoryWrites:n,popoverState:a,setShowMemoriesModal:o}){const i=Nt(),r=te(),l=J.getServerThreadId(t),c=ji({clientThreadId:t}),h=n.join(" ");let u=h.slice(0,50).replace(new RegExp("^\\p{L}","u"),g=>g.toLocaleUpperCase()).replace(/\.$/,"");h.length>50&&(u+="...");const f=async g=>{if(!l)throw new Error("Failed to confirm or reject memory update: serverThreadId is not found");const p=s.message.metadata?.pending_memory_info;J.updateTree(t,y=>{y.updateNodeMessageMetadata(s.nodeId,{pending_memory_info:{...p,is_pending:!1,confirm_result:g}})});try{await Ye.confirmOrRejectMemory(s.message.id,l,g)}catch{i.danger(r.formatMessage({id:"memory.confirmOrDenyFail",defaultMessage:"Failed to confirm or reject memory update"})),J.updateTree(t,m=>{m.updateNodeMessageMetadata(s.nodeId,{pending_memory_info:p})})}};return e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"inline-block text-sm font-semibold text-token-text-tertiary outline-none",children:e.jsx(P,{id:"MemoryActionResult.memoryConfirmation",defaultMessage:"Remember this? {memoryText}",values:{memoryText:e.jsx("div",{className:"inline-block py-1",onMouseOver:()=>a.handleTogglePopover(!0),onMouseOut:()=>a.handleTogglePopover(!1),children:e.jsx(Cr,{memoryWrites:n,popoverState:a,triggerButton:e.jsx("button",{className:T("text-left font-normal",a.isPopoverOpen?"text-token-text-secondary":"text-token-text-tertiary"),children:e.jsx(P,{id:"MemoryActionResult.memoryWrapper",defaultMessage:"“{memoryWrites}”",values:{memoryWrites:u}})}),setShowMemoriesModal:o})})}})}),e.jsx(qe,{className:"ml-3 text-token-text-tertiary hover:text-token-text-primary",size:"xs",color:"secondary",disabled:c,onClick:()=>{f(!0)},children:e.jsx(P,{id:"MemoryActionResult.confirm",defaultMessage:"Yes"})}),e.jsx(qe,{className:"ml-2 text-token-text-tertiary hover:text-token-text-primary",size:"xs",color:"secondary",disabled:c,onClick:()=>{f(!1)},children:e.jsx(P,{id:"MemoryActionResult.deny",defaultMessage:"No"})})]})}function op({memoryWrites:t,popoverState:s,isParagen:n,setShowMemoriesModal:a}){return t.length===0?null:e.jsx(e.Fragment,{children:e.jsx("div",{className:"inline-block",onMouseOver:()=>s.handleTogglePopover(!0),onMouseOut:()=>s.handleTogglePopover(!1),children:e.jsx(Cr,{memoryWrites:t,popoverState:s,isParagen:n,triggerButton:e.jsxs("button",{className:T("my-1 flex items-center gap-1 text-sm font-semibold outline-none",s.isPopoverOpen?"text-token-text-secondary":"text-token-text-tertiary"),children:[e.jsx(Bh,{className:"mb-[-1px]"}),t.length===1?e.jsx(P,{id:"MemoryActionResult.memoryWriteSingular.1",defaultMessage:"Memory updated"}):e.jsx(P,{id:"MemoryActionResult.memoryWritePlural.1",defaultMessage:"Memories updated"})]}),setShowMemoriesModal:a})})})}function ip(t){const s=Mr(t),n=s?.message.metadata?.pending_memory_info?.confirm_result;return s==null?null:n===!0?"confirmed":n===!1?"denied":"pending"}function Xn({messages:t,clientThreadId:s,gizmoId:n,isParagen:a}){const o=ep(t),i=np(o),r=tp(t);sp(o);const[l,c]=d.useState(!1),h=Mr(t),u=ip(t);return u==="denied"?null:r?e.jsx("div",{className:"result-streaming",children:e.jsx("span",{children:e.jsx("pre",{})})}):e.jsxs(e.Fragment,{children:[u==="pending"?e.jsx(ap,{clientThreadId:s,memoryWrites:o,popoverState:i,setShowMemoriesModal:c,pendingMessage:h}):e.jsx(op,{memoryWrites:o,popoverState:i,isParagen:a,setShowMemoriesModal:c}),l&&e.jsx(cm,{initialGizmoId:n,onClose:()=>c(!1)})]})}function rp(t){const s=["The user ","The user's ","User ","User's "];for(const n of s)if(t.startsWith(n))return t.slice(n.length);return t}function vo(t,s,n){J.updateTree(t,a=>{a.updateNodeMetadata(s,{inlineComparisonRating:n})})}function yo(t){return{is_dark_mode:t==="dark",time_since_loaded:Math.floor(performance.now()/1e3),page_height:window?.innerHeight,page_width:window?.innerWidth,pixel_ratio:window?.devicePixelRatio,screen_height:window?.screen?.height,screen_width:window?.screen?.width}}const wo=({messages:t})=>{for(const{message:{metadata:s}}of t){const{augmented_paragen_prompt_label:n}=s??{};if(n)return n}};function lp(t){const s=d.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});return t.stubSideBySideFeedback?e.jsx(kr,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:s,...t}):e.jsx(cp,{...t,visibilityStateRef:s})}function cp(t){const{clientThreadId:s,variantIds:n,variantsInStreamInfo:a,turnIndex:o}=t;if(n.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const i=Ca(),[r]=d.useState(()=>Date.now()),l=da(),{resolvedTheme:c}=hl(),[h,u]=d.useMemo(()=>Di(n.join(""))()<.5?[0,1]:[1,0],[n[0],n[1]]),f=h<u?"left":"right",g=f==="left"?"right":"left",p=n[h],y=n[u],m=Ka(s,p),b=Ka(s,y),x=vt(On(s,o,vt(m).id)),M=vt(On(s,o,vt(b).id)),S=f==="left"?x:M,v=f==="left"?M:x,C=a.display_treatment==="unskippable",F=i?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";d.useEffect(()=>(Dn.setState({displayingSideBySideFeedback:!0,unskippable:C}),()=>{Dn.setState({displayingSideBySideFeedback:!1,unskippable:!1})}),[C]),au();const N=d.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});d.useEffect(()=>ml(ou,{requestCompletion:()=>{const w=ss(S.messages)?.completionSampleFinishTime,k=ss(v.messages)?.completionSampleFinishTime;Ye.submitMessageComparisonFeedback({feedback_version:F,original_message_id:S.messages[S.messages.length-1]?.message.id,new_message_id:v.messages[v.messages.length-1]?.message.id,conversation_id:J.getServerThreadId(s),completion_comparison_rating:"skip",new_completion_placement:g,feedback_start_time:r,compare_step_start_time:r,original_completion_load_start_time:r,original_completion_load_end_time:w??0,new_completion_load_start_time:r,new_completion_load_end_time:k??0,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:yo(c),...N.current})}}),[x,M,s,r,F,g,S?.messages,v?.messages,c]);const j=w=>{const X=J.getTree(s).getLeafFromNode(w);J.setThreadCurrentLeafId(s,X.id);const R=w===p===(f==="left"),O=ss(S.messages)?.completionSampleFinishTime,L=ss(v.messages)?.completionSampleFinishTime;S.messages.length>0&&vo(s,S.messages[S.messages.length-1].nodeId,R?"original":"new"),v.messages.length>0&&vo(s,v.messages[v.messages.length-1].nodeId,R?"original":"new");let E;O==null||L==null?E=R?"partial_load_comparison_original":"partial_load_comparison_new":E=R?"original":"new",Ye.submitMessageComparisonFeedback({feedback_version:F,original_message_id:S.messages[S.messages.length-1]?.message.id,new_message_id:v.messages[v.messages.length-1]?.message.id,conversation_id:J.getServerThreadId(s),completion_comparison_rating:E,new_completion_placement:g,feedback_start_time:r,compare_step_start_time:r,original_completion_load_start_time:r,original_completion_load_end_time:O??null,new_completion_load_start_time:r,new_completion_load_end_time:L??null,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:yo(c),...N.current})};return e.jsx(kr,{...t,setPreferredFeedback:j,leftVariantId:p,rightVariantId:y,leftTurn:x,rightTurn:M,hasActiveRequest:l,originalTurn:S,visibilityStateRef:N})}function dp(t){if(!t.length)return!1;const s=t.filter(n=>n.type===Ke.Text||n.type===Ke.MultiText).filter(n=>n.message.message.status!=="finished_successfully"&&n.message.message.metadata?.snorkle_status!==void 0);return s.length>0&&s.every(n=>{const a=n.message.message.content;return a?.content_type===_t.Text&&a.parts.join("")===""})}function kr({setPreferredFeedback:t,leftVariantId:s,rightVariantId:n,leftTurn:a,rightTurn:o,hasActiveRequest:i,originalTurn:r,visibilityStateRef:l,...c}){const{defaultParagenLabel:h,shouldShowParagenLabels:u=!1}=ci(),f=a&&wo(a)||h,g=o&&wo(o)||h,p=d.useMemo(()=>a?.messages??[],[a?.messages]),y=d.useMemo(()=>o?.messages??[],[o?.messages]),{avatarClassName:m}=c,b=d.useMemo(()=>qs(p),[p]),x=d.useMemo(()=>qs(y),[y]),M=Ko(),[S,v]=d.useMemo(()=>[b,x].map(V=>dp(V)),[b,x]),C=ct(a?$s.getRequestIdFromConversationTurn(a):"")||S,F=ct(o?$s.getRequestIdFromConversationTurn(o):"")||v,N=a?.role===be.User,j=o?.role===be.User,w=d.useRef(null),k=d.useRef(null),X=d.useRef(null),U=c.stubSideBySideFeedback||S,R=c.stubSideBySideFeedback||v;d.useEffect(()=>{if(w.current&&k.current&&X.current){const V=Array(11).fill(0).map((K,H)=>H/10),q=new IntersectionObserver(K=>K.forEach(H=>{H.target===k.current?(l.current.left_visibility_initial==null&&(l.current.left_visibility_initial=H.intersectionRatio),l.current.left_visibility_max=Math.max(l.current.left_visibility_max??0,H.intersectionRatio)):H.target===X.current&&(l.current.right_visibility_initial==null&&(l.current.right_visibility_initial=H.intersectionRatio),l.current.right_visibility_max=Math.max(l.current.right_visibility_max??0,H.intersectionRatio))}),{root:w.current,threshold:V});return q.observe(k.current),q.observe(X.current),()=>q.disconnect()}},[l]);const{data:O}=Yo(void 0,!1,M),L=Ca(),E=e.jsx("div",{className:"text-pretty px-6 pb-5 pt-1 text-center text-sm text-token-text-secondary",children:e.jsx(P,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),_=Xe();return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:T("sticky z-[1] text-pretty bg-token-main-surface-primary px-6 text-center text-lg",_&&"top-[var(--thread-leading-height)] pt-3",!_&&"top-[-1px]",L&&!_?"md:top-header-height":_?"":"md:static"),children:[e.jsx(P,{id:"JgCHDY",defaultMessage:"You’re giving feedback on a new version of ChatGPT."}),L?E:null]}),L?null:E,e.jsx("div",{className:"relative -mb-2 snap-x snap-mandatory overflow-x-auto px-3 pb-4 md:px-5 lg:px-10",ref:w,children:e.jsx("div",{className:T(!_&&"min-w-fit"),children:e.jsxs("div",{className:T("mx-auto flex max-w-6xl items-start",L&&!_&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",!L&&!_&&"gap-4 sm:gap-6",L&&_&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",_&&!L&&"gap-4 sm:gap-6"),children:[e.jsxs(jo,{horizontalScrollContainerRef:w,rootElementRef:k,onClick:()=>{t(s)},hasActiveRequest:i,isWaitingOnFirstUserVisibleToken:U,children:[e.jsxs(ko,{children:[e.jsx(Bn,{messages:p,isUserTurn:N,avatarClassName:m}),e.jsx(Co,{children:u?e.jsx("span",{className:"font-bold text-token-text-primary",children:f}):e.jsx(P,{...To.responseNumber,values:{responseIndex:1}})})]}),L&&U?e.jsx(Mo,{}):e.jsxs(e.Fragment,{children:[O!=null&&!N&&e.jsx(Xn,{clientThreadId:c.clientThreadId,messages:p,isParagen:!0}),e.jsx(Hn,{...c,groupedMessagesToRender:b,allGroupedMessages:b,isEditing:!1,isUserTurn:N,isCompletionRequestInProgress:C,hasActiveRequest:i,handleEnterEdit:yt,handleExitEdit:yt,shouldGrowContainer:!1}),e.jsx(_o,{turn:a,originalTurn:r})]})]}),e.jsxs(jo,{horizontalScrollContainerRef:w,rootElementRef:X,onClick:()=>{t(n)},hasActiveRequest:i,isWaitingOnFirstUserVisibleToken:R,children:[e.jsxs(ko,{children:[e.jsx(Bn,{messages:y,isUserTurn:j,avatarClassName:m}),e.jsx(Co,{children:u?e.jsx("span",{className:"font-bold text-token-text-primary",children:g}):e.jsx(P,{...To.responseNumber,values:{responseIndex:2}})})]}),L&&R?e.jsx(Mo,{}):e.jsxs(e.Fragment,{children:[O!=null&&!j&&e.jsx(Xn,{clientThreadId:c.clientThreadId,messages:y,isParagen:!0}),e.jsx(Hn,{...c,groupedMessagesToRender:x,allGroupedMessages:x,isEditing:!1,isUserTurn:j,isCompletionRequestInProgress:F,hasActiveRequest:i,handleEnterEdit:yt,handleExitEdit:yt,shouldGrowContainer:!1}),e.jsx(_o,{turn:o,originalTurn:r})]})]})]})})})]})}function jo({horizontalScrollContainerRef:t,rootElementRef:s,onClick:n,children:a,hasActiveRequest:o,isWaitingOnFirstUserVisibleToken:i}){const r=Ca(),l=Xe(),{scrollX:c}=iu({layoutEffect:!1,container:t,target:s}),h=ru(),u=lu(),f=d.useRef(null),g=d.useRef(null),p=d.useRef(null),[y,m]=d.useState(!1),[b,x]=d.useState(!1),[M,S]=d.useState(!1),[v,C]=d.useState(0);d.useEffect(()=>{if(!r)return;const U=new IntersectionObserver(R=>{for(const O of R)O.target===f.current?m(O.isIntersecting):O.target===p.current?S(O.isIntersecting):O.target===g.current&&x(O.isIntersecting)},{root:h?.current,rootMargin:l?`0px 0px -${v}px 0px`:void 0});return f.current&&g.current&&p.current&&(U.observe(f.current),U.observe(g.current),U.observe(p.current)),()=>{U.disconnect()}},[v,r,l,h]);const F=!M&&(b||y),N=cu(c,U=>F?-1*U:0),j=Ya(0);d.useEffect(()=>{if(!r)return;const U=new ResizeObserver(R=>{Is(R.length===1,"entryList.length === 1");const O=R[0];Is(O.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),j.set(O.contentBoxSize[0].inlineSize)});return s.current&&U.observe(s.current),()=>{U.disconnect()}},[r,j,s]);const w=Ya(0);d.useEffect(()=>{if(!r)return;const U=new ResizeObserver(R=>{Is(R.length===1,"entryList.length === 1");const O=R[0];Is(O.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),w.set(O.contentBoxSize[0].blockSize+16),C(O.contentBoxSize[0].blockSize)});return u.current&&U.observe(u.current),()=>{U.disconnect()}},[r,w,u]);const k=e.jsx(qe,{className:r?"px-5":"mt-4 self-start",onClick:n,children:e.jsx(P,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),X=i;return e.jsxs("div",{"data-paragen-root":!0,className:T("relative flex w-full min-w-[min(450px,80vw)] snap-center flex-col gap-1 text-left",l&&r&&"pl-3 pr-5 sm:w-[calc(100cqw-62px)] sm:pl-3 sm:pr-5 md:px-10",!l&&r&&"px-10",r?"min-h-60 py-4":"rounded-2xl border border-token-main-surface-tertiary bg-white p-5 dark:bg-gray-700"),ref:s,children:[e.jsx("div",{className:T("absolute left-0 right-0 top-48 h-px","invisible"),ref:f}),e.jsx("div",{className:T("absolute bottom-0 left-0 right-0 top-48","invisible"),ref:g}),e.jsx("div",{className:T("absolute bottom-0 left-0 right-0 h-px","invisible"),ref:p}),a,r?e.jsx("div",{className:"flex-1"}):null,r?e.jsx("div",{className:"mt-4 min-h-10",children:X?null:e.jsx(ne.div,{style:{translateX:N,width:j,bottom:w},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:T({fixed:F,"z-20 flex w-full justify-center":!0}),children:k})}):o?null:k]})}function Mo(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pb-5 pt-3",children:[e.jsx(ot,{className:"h-4 w-[75%]"}),e.jsx(ot,{className:"h-4 w-[50%]"}),e.jsx(ot,{className:"h-4 w-[80%]"}),e.jsx(ot,{className:"h-4 w-[55%]"}),e.jsx(ot,{className:"h-4 w-[66%]"}),e.jsx(ot,{className:"h-4 w-[64%]"}),e.jsx(ot,{className:"h-4 w-[48%]"})]})}function Ca(){const{layer:t}=De("3119715334");return t.get("should-enable-hojicha",!1)}const Co=Me.div`text-sm text-token-text-secondary font-semibold`,ko=Me.div`flex gap-4 items-center mb-1`,ot=Me.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function _o({turn:t,originalTurn:s}){const n=ra();if(!n.showParagenMetadata||!n.showDebugConversationTurns&&!n.forceParagen||t==null)return null;let a=t===s?"ORIGINAL":"NEW";const i=t.messages[t.messages.length-1]?.message?.metadata?.__internal;if(i){const{model_id:r,model_definition_slug:l,model_definition_virtual_model_id:c,alternative_model_selection_rule:h,augmented_paragen_prompt_group_id:u,augmented_paragen_prompt_id:f,augmented_paragen_prompt:g}=i;r&&(a+=`
Model ID: ${r}`),l&&(a+=`
Model Slug: ${l}`),c&&(a+=`
Virtual Model ID: ${c}`),h&&(a+=`
Alternative Model Rule: ${h}`),u&&(a+=`
Prompt Group ID: ${u}`),f&&(a+=`
Prompt ID: ${f}`),g&&(a+=`
Prompt: ${g}`)}return e.jsx("div",{className:"whitespace-pre-wrap text-sm text-red-500",children:a})}const To=ve({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}"}}),Ao=(...t)=>s=>t.some(n=>n(s)),Eo=({allGroupedMessages:t})=>t.some(s=>[Ke.Browsing,Ke.RetrievalBrowsing,Ke.ParallelBrowsing].includes(s.type)),No=({allGroupedMessages:t})=>t.some(s=>s.type===Ke.SearchGPTQuery),Ro=({allGroupedMessages:t})=>t.some(s=>s.type===Ke.CodeInterpreter);function up(t){return!t||!t.instructions?"":typeof t.instructions=="string"?t.instructions:t.instructions.filter(s=>typeof s=="string").join("")}const hp=[{match:Ao(Eo,No),tag:"Shouldn't have searched the web",label:fe({id:"kL047b",defaultMessage:"Shouldn't have searched the web"})},{match:Ao(Eo,No),tag:"Don't like the source it cited",label:fe({id:"OWjzGX",defaultMessage:"Don't like the sources it cited"})},{match:Ro,tag:"Shouldn't have run code",label:fe({id:"53w4ay",defaultMessage:"Shouldn't have run code"})},{match:Ro,tag:"Couldn't handle my file",label:fe({id:"EkFTQ5",defaultMessage:"Couldn't handle my file"})},{match:({allGroupedMessages:t})=>t.some(s=>s.type===Ke.Dalle),tag:"Shouldn't have created an image",label:fe({id:"S8FRsr",defaultMessage:"Shouldn't have created an image"})},{match:({allGroupedMessages:t})=>t.some(s=>{if(s.type!==Ke.Text)return!1;const{message:n}=s.message,{content:a}=n;return a.content_type===_t.Text&&Pi(n).match(/^```[\S]+\n/gm)}),tag:"Code was incorrect",label:fe({id:"4EBdQk",defaultMessage:"Code was incorrect"})},{match:({systemContent:t})=>up(t).includes("Personality")??!1,tag:"Too chatty or casual",label:fe({id:"ATzJKW",defaultMessage:"Too chatty or casual"})},{match:({features:t})=>t.includes(lt.Sunshine),tag:"Shouldn't have used Memory",label:fe({id:"yfUEiz",defaultMessage:"Shouldn't have used Memory"})},{tag:"Don't like the style",label:fe({id:"nGxjdj",defaultMessage:"Don't like the style"})},{tag:"Not factually correct",label:fe({id:"Ke7JtQ",defaultMessage:"Not factually correct"})},{tag:"Didn't fully follow instructions",label:fe({id:"Rdlt9V",defaultMessage:"Didn't fully follow instructions"})},{tag:"Refused when it shouldn't have",label:fe({id:"2yRS/Q",defaultMessage:"Refused when it shouldn't have"})},{tag:"Being lazy",label:fe({id:"14MPmT",defaultMessage:"Being lazy"})},{tag:"Unsafe or problematic",label:fe({id:"02pXBl",defaultMessage:"Unsafe or problematic"})},{tag:"Other",label:fe({id:"WiIGE+",defaultMessage:"Other"})}],mp=[{tag:"I disagree with the policy",label:fe({id:"oKyDLz",defaultMessage:"I disagree with the policy"})},{tag:"This didn't violate the policy",label:fe({id:"7fUkVF",defaultMessage:"This didn't violate the policy"})},{tag:"I don't understand the policy",label:fe({id:"4Cdp6N",defaultMessage:"I don't understand the policy"})},{tag:"This didn't take the full context",label:fe({id:"vnZJDP",defaultMessage:"This didn't take the full context"})}];function fp(t,s,n){return s.filter(a=>!a.match||a.match(n)).map(a=>({value:a.tag,label:t.formatMessage(a.label)}))}function gp(t){const s=t[t.length-1];if(!s)return!1;const n="message"in s?s.message:null;if(n){const{errCode:a}=pa(n);return[Vs.ContentPolicy,Vs.ContentOrTos].includes(a)}else return!1}function pp({clientThreadId:t,conversationMessage:s,currentModelId:n,allGroupedMessages:a}){const o=te(),i=en()??[],r=s.rating,l=du(t,s.message.id),c=l?.message.content.content_type===_t.SystemContent?l?.message.content:null,h=d.useCallback(g=>{const p=J.getServerThreadId(t);p&&(g.tags.length===0&&!g.textFeedback||(W.logEvent(g.source==="inline"?G.messageFeedbackInlineSubmitted:G.messageFeedbackDialogSubmitted,{id:s.message.id,threadId:p,tags:g.tags,content:g.textFeedback,model:n,rating:r}),re.logEvent(g.source==="inline"?"chatgpt_feedback_inline_submitted":"chatgpt_feedback_dialog_submitted",g.tags?.[0]??null,{id:s.message.id,threadId:p,tag:g.tags?.[0]??"",content:g.textFeedback??"",model:n,rating:r??""}),r&&Ye.submitMessageFeedback({message_id:s.message.id,conversation_id:p,rating:r,text:g.textFeedback,tags:g.tags,tag_choices:g.tagChoices})))},[t,s.message,n,r]),u=()=>{W.logEvent(G.messageFeedbackMoreOptionsClicked,{id:s.message.id,threadId:J.getServerThreadId(t),model:n,rating:r})},f=fp(o,gp(a)?mp:hp,{allGroupedMessages:a,features:i,currentModelId:n,systemContent:c});return r==="thumbsUp"?null:e.jsx(rm,{tagOptions:f,onSubmit:h,onMoreClicked:u})}const Po=[1,2,3,4,10,20,30],xp=.5;function Sp({clientThreadId:t,conversationLeafId:s}){const n=Fi(Li.isBusinessWorkspace),a=d.useRef(!1),o=Lt(t),i=cn(t),{isUnauthenticated:r}=Ge(),l=d.useMemo(()=>{if(!o)return-1;const w=Di(o);return w()>xp?-1:Po[Math.floor(w()*Po.length)]},[o]),c=uu(t,s),h=c[c.length-1],u=d.useMemo(()=>$s.getRequestIdFromConversationTurn(h),[h]),f=ct(u),[g,p]=d.useState(null),[y,m]=d.useState(!1),[b,x]=d.useState(!1),[M,S]=d.useState(!1),v=w=>{const k=ss(c)?.messages[0]?.message.id;p(w),N(k,w)},C=c.filter(w=>w.role===be.Assistant).length,F=h?.role===be.Assistant,N=d.useMemo(()=>Ci((w,k)=>{o&&w&&Ye.submitConversationRating({conversation_id:o,message_id:w,rating:k,shown_at_assistant_turn:l}),W.logEvent(G.conversationRatingSubmitted,{rating:k,showAtAssistantTurn:l,conversationId:o}),m(!0),setTimeout(()=>{x(!0)},1500)},2e3),[o,l]),j=C!==l||f||!F||!!n||i?.kind!==tt.PrimaryAssistant||M||r;return d.useEffect(()=>{!j&&!a.current&&(W.logEvent(G.conversationRatingShown,{showAtAssistantTurn:l,conversationId:o}),a.current=!0)},[j]),M||j?null:e.jsxs("div",{className:"mx-auto",children:[e.jsx(ps,{children:y&&!b&&e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(Io,{$padded:!0,children:e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(P,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!y&&e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:e.jsxs(Io,{$padded:!1,children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-secondary",children:[e.jsx(P,{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(An,{$selected:g==="thumbsUp",onClick:()=>v("thumbsUp"),children:e.jsx(Ki,{className:"icon-md"})}),e.jsx(An,{$selected:g==="thumbsDown",onClick:()=>v("thumbsDown"),children:e.jsx(Yi,{className:"icon-md"})})]})]}),e.jsx("div",{className:"w-px flex-1 self-stretch bg-token-main-surface-tertiary"}),e.jsx(An,{className:"p-3",$selected:!1,onClick:()=>S(!0),children:e.jsx(Uh,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const An=Me.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,Io=Me.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`;function bp({clientThreadId:t,conversationLeafId:s,canShowInlineMessageFeedback:n,messageForRating:a,allGroupedMessages:o,currentModelId:i}){let r=null;return hu(t,s)?null:(a.rating&&n?r=e.jsx(pp,{clientThreadId:t,conversationMessage:a,allGroupedMessages:o,currentModelId:i}):r=e.jsx("div",{className:"text-center",children:e.jsx(Sp,{clientThreadId:t,conversationLeafId:s})}),e.jsx("div",{className:"mt-3 w-full empty:hidden",children:r}))}function vp(t){const{turnIndex:s,conversationLeafId:n,isFinalTurn:a,clientThreadId:o,onChangeItemInView:i,onChangeRating:r,currentModelId:l,initiallyHighlightedMessageId:c,avatarClassName:h,scrollToBottom:u,showAvatar:f=!0}=t,g=te(),p=ia(),y=!!p&&fl(p),m=ca(),b=Fi(Li.isBusinessWorkspace),x=Nt(),M=J.getServerThreadId(o),S=vt(On(o,s,n)),{messages:v,variantIds:C,variantsInStreamInfo:F}=S,N=qs(v),j=mu();let w=v[v.length-1];for(const Y of N){const Te=Sh(Y);if(Te.some(xt=>j.has(xt.message.id))){w=Te[Te.length-1];break}}const k=v.slice(0,v.indexOf(w)+1),X=an(),[U,R]=d.useState(!1),[O,L]=d.useState(!1),E=C.findIndex(Y=>k.some(Te=>Te.nodeId===Y)),_=S.role===be.User,V=Ft(),q=We(o),K=gs(S.gizmoId??q)?.data,H=fu(),Z=K&&H.includes(K.gizmo.id),ye=Oi(l),me=gu(l),le=Xe(),oe=cn(o,K?.gizmo.id),se=yi(o)===Wo.STREAMING,we=en(),{value:xe}=kt("1410082514"),{value:Ce}=kt("2291672486"),I=k.some(Y=>Y.message.content.content_type===_t.MultimodalText),{layer:ce}=De("1547743984"),Fe=M&&X&&ce.get("show_share_button_inline",!1),{isUnauthenticated:je}=Ge(),[D,z]=d.useState(!1),[de,ue]=d.useState(!1);gl(()=>{S.role==="user"&&u&&u()});const ae=d.useRef(null);d.useEffect(()=>{if(c==null)return;S.messages.map(Te=>Te.message.id).includes(c)&&ae.current?.scrollIntoView({behavior:"auto"})},[c]);const $=v[v.length-1],he=$.rating,ke=()=>{k.length===1&&(W.logEvent(G.editPrompt,{id:k[0].message.id,threadId:J.getServerThreadId(o)}),re.logEvent("chatgpt_edit_prompt"),R(!0))},Se=d.useCallback(()=>{R(!1)},[]),ge=d.useCallback(Y=>{J.copyMessageToClipboard(o,s,x,Y)},[o,s,x]),Ue=Y=>{r({nodeId:$.nodeId,messageId:$.message.id,rating:Y}),W.logEvent(Y==="thumbsDown"?G.messageFeedbackThumbsDownClicked:G.messageFeedbackThumbsUpClicked,{id:$.message.id,threadId:J.getServerThreadId(o),model:l,rating:Y}),L(!0)},[Q]=d.useState(()=>Date.now()),Le=d.useMemo(()=>$s.getRequestIdFromConversationTurn(S),[S]),ee=wi({clientThreadId:o,conversationLeafId:n}),_e=ct(Le)&&!ee,ut=da(),vs=qs(k),{showDebugConversationTurns:mn}=ra(),Ot=Mi(o),Qe=Ai(o),ht=pu({clientThreadId:o,conversationMode:oe}),Oe=dt(o),mt=d.useCallback(({requestedModelId:Y,systemMessage:Te,juice:xt,extraStreamParams:nt})=>{const Yt=new cs;ht({id:$.nodeId,eventMetadata:{eventSource:"mouse"},turnTracker:Yt,requestedModelId:Y,systemMessage:Te,juice:xt,extraStreamParams:nt})},[$,ht]),fn=xe&&k.some(Y=>Y.message.metadata?.snorkle_status!=null),ft=!m&&!Ot&&!V&&!_,Bt=xu(),zt=w.message.author.role===be.Assistant?w.message:null;Su({isCompletionRequestInProgress:_e,isUserTurn:_,message:zt});const Ut=bu(o,C),$e=vu(oe),Ht=!Bt&&!$e&&ft&&a&&F?.num_variants_in_stream===2&&!$.inlineComparisonRating&&!Ut,ys=yu(S),He=Ht,ws=Ht&&!ys,gt=!_&&!m&&!Ot&&!$e&&!se&&!_e,Gt=gt&&(!b||fn||me||y)&&!$e&&!je&&!V,st=!m&&!((_e||se)&&a)&&C.length>1&&!U&&!He;let Wt=!1;if(_&&k.length===1){const{shouldHideContent:Y}=pa(k[0]);Y&&(Wt=!0)}const js=_&&!$e&&!m&&!I&&k.length===1&&!Wt&&!U&&!je,Vt=Y=>{i(C[Y]),W.logEvent(G.changeNode,{intent:"toggle_between"})};if(!(S.role===be.Root?!1:S.role===be.System||S.role===be.Developer||k.every(Y=>Y.message.metadata?.is_visually_hidden_from_conversation)?mn:!0)&&!He)return null;const qt=k.some(({message:Y})=>Ri.getAssetPointers(Y).length>0),Re=!qt&&a&&Qe&&!Ce?e.jsx(ts,{onClick:()=>{re.logEvent("chatgpt_regenerate_try_again_button_clicked",l,{requestedModelId:l,...et({clientThreadId:o,turnIndex:s})});const Y=new cs;ht({id:Oe,eventMetadata:{eventSource:"mouse"},turnTracker:Y}),ls()},icon:dn,label:g.formatMessage({id:"ConversationTurn.regenerateTooltip",defaultMessage:"Regenerate"}),testId:"regenerate-turn-action-button"}):null,Kt="h-[30px] rounded-md px-1 text-token-text-secondary hover:bg-token-main-surface-secondary",gn=!qt&&Ce?e.jsx(Jg,{className:Kt,clientThreadId:o,message:$,onModelSelect:mt,onDropdownChange:z,canRegenerateResponse:Qe}):null,pn=!_&&!Wt&&(!a||!_e)?e.jsx(Au,{onClick:ge}):null,xn=!_&&(!a||!_e)&&($.disclaimers??[]).length===0&&$.nodeId?e.jsx($g,{conversationId:o,message:$,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-xs text-token-text-tertiary hover:text-token-text-primary"}):null,Cs=!_&&$&&(!a||!_e)?e.jsx(Eu,{message:$,isFinalTurn:a,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-token-text-tertiary hover:text-token-text-primary"}):null,ks=Gt&&!_e?e.jsxs("div",{className:"flex",children:[!we?.includes(lt.ThumbsDownOnly)&&he!=="thumbsDown"&&e.jsx(ts,{onClick:()=>Ue("thumbsUp"),disabled:he==="thumbsUp",icon:he==="thumbsUp"?Hh:Ki,label:g.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"},`thumbsUp:${$.nodeId}`),he!=="thumbsUp"&&e.jsx(ts,{onClick:()=>Ue("thumbsDown"),disabled:he==="thumbsDown",icon:he==="thumbsDown"?Gh:Yi,label:g.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"},`thumbsDown:${$.nodeId}`)]}):null,pt=Fe&&e.jsx(ts,{onClick:()=>{ds.openSharingModal(M)},label:g.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:Wh}),Sn=!Ce&&e.jsx(Bg,{className:Kt,clientThreadId:o,message:$,onModelSelect:mt,onDropdownChange:z});function bn(Y){return le?Y:e.jsx(ha,{clientThreadId:o,isStaticSharedThread:m,withVerticalPadding:!0,withHorizontalPadding:!He,children:Y})}function _s(Y){return le?Y:e.jsx(us,{children:Y})}return e.jsxs("article",{className:"w-full text-token-text-primary focus-visible:outline-2 focus-visible:outline-offset-[-4px]",ref:ae,dir:"auto","data-testid":`conversation-turn-${s}`,"data-scroll-anchor":a,onMouseEnter:()=>ue(!0),onMouseLeave:()=>ue(!1),children:[e.jsx(wu,{role:S.role}),bn(e.jsx(e.Fragment,{children:He?e.jsx(lp,{isFeedbackEnabled:Gt,variantIds:C,variantsInStreamInfo:F,conversationTurnMountTime:Q,stubSideBySideFeedback:ws,...t}):_s(e.jsxs(e.Fragment,{children:[!_&&f&&e.jsx(wp,{children:e.jsx(Bn,{messages:k,isUserTurn:_,avatarClassName:h,gizmo:K})}),e.jsx("div",{className:T("group/conversation-turn relative flex w-full min-w-0 flex-col",!_&&ju),children:e.jsx("div",{className:"flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[!_&&!m&&e.jsx(Xn,{messages:k,clientThreadId:o,gizmoId:K?.gizmo.id}),e.jsx(Hn,{groupedMessagesToRender:vs,allGroupedMessages:N,...t,isEditing:U,isUserTurn:_,isCompletionRequestInProgress:_e,isFeedbackEnabled:Gt,isFinalTurn:a,hasActiveRequest:ut,showEditButton:js,handleEnterEdit:ke,handleExitEdit:Se}),Z&&e.jsx("div",{className:"mb-4",children:e.jsx(Mu,{messages:k})}),ye&&e.jsx("div",{className:"mb-4",children:e.jsx(Cu,{messages:k})}),(gt||st)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:T("mb-2 flex gap-3 empty:hidden",_?"mr-1 flex-row-reverse":"-ml-2"),children:e.jsx(ku,{alwaysShow:a,showInline:a||st,isHovered:de||D,pagination:st&&e.jsx(_u,{showInline:a||st,currentPage:E,onChangeIndex:Vt,length:C.length,className:T("self-center",C.length>1?"visible":"!invisible")}),actions:gt&&e.jsxs(e.Fragment,{children:[xn,pn,Re,ks,Cs,Sn,pt,gn]})})}),gt&&!_e?e.jsx("div",{className:"pr-2 lg:pr-0",children:e.jsx(Tu,{message:$,isFinalTurn:a})}):null,a&&!_e&&e.jsx(bp,{canShowInlineMessageFeedback:O,clientThreadId:o,conversationLeafId:n,messageForRating:$,allGroupedMessages:N,currentModelId:l})]})]})})})]}))}))]})}const yp=$o.memo(vp),wp=Me.div`flex-shrink-0 flex flex-col relative items-end`,jp=3;function Mp({onChangeItemInView:t,onRequestMoreCompletions:s,onChangeRating:n,onRequestCompletion:a,clientThreadId:o,conversationLeafId:i,hideHeader:r}){const l=Ne(),c=Bi(),h=Nu(),[u]=Ru(),f=Pu(),[g]=Iu(),p=cn(o),y=Dt(),m=ga(o),b=Du(o),x=l.store.useContentAreaDimensions(Tt.Header,H=>H?.height?H.height:void 0),M=l.store.useIsHeaderContentAreaPopulated(),S=zi(o),{isArchived:v}=S,C=Fu(m.id),F=p?.kind===tt.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":C,N=Ui(o,i),j=ai(),[w,k]=d.useState(0),[X,U]=d.useState(!1);d.useEffect(()=>{c&&(w===0?k(N):!X&&N>w&&(U(!0),re.logEvent("chatgpt_continue_conversation_first_message_sent"),W.logEvent(G.continueConversationFirstMessageSent)))},[N,w,X,c]),c&&(re.logEvent("chatgpt_continue_conversation_page_loaded"),W.logEvent(G.continueConversationPageLoaded));const R=d.useCallback(()=>{h({behavior:"smooth"})},[h]),O=Lu(o),L=j&&!v,E=(H,Z,ye,me)=>(me&&(H=H+jp),[...new Array(Z-H).keys()].map(le=>{const oe=le+H;return e.jsx(yp,{isFinalTurn:ye(oe),turnIndex:oe,clientThreadId:o,conversationLeafId:i,onChangeItemInView:t,onChangeRating:n,onRequestMoreCompletions:s,onRequestCompletion:a,currentModelId:m.id,avatarClassName:F,scrollToBottom:R},oe)})),{layer:_}=De("4031588851"),V=_.get("enable_hardcoded_onboarding_prompt",!1),[q,K]=d.useState(!1);return d.useEffect(()=>{if(!V)return;const H=J.getTree(o),Z=H.getChildrenFromNode("root")[0],me=H.getChildrenFromNode(Z.id)[0].message.author.metadata?.is_system_initiated_conversation===!0;K(me)},[i,N,a,o,V]),e.jsxs("div",{onCopy:O,className:T("flex flex-col text-sm",L&&"pb-[120px]",x||L?null:"md:pb-9"),style:{paddingBottom:L?void 0:x},children:[!r&&y?.data&&e.jsx(xr,{clientThreadId:o}),c&&e.jsxs(e.Fragment,{children:[e.jsx(us,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(P,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),N-w===0&&e.jsx("div",{className:"text-center text-xs font-semibold text-token-text-primary",children:e.jsx("button",{onClick:()=>{ds.openModal(Ii.ReportConversation),re.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),W.logEvent(G.sharedConversationReportContentClicked,{location:"Dynamic Shared Thread Page"})},children:e.jsx(P,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})}),E(0,w,H=>H===w-1),e.jsx(us,{children:e.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(Vh,{className:"icon-xs mr-2"}),e.jsx(P,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})}),E(w,N,H=>H===N-1)]}),!c&&E(0,N,H=>H===N-1,q),b&&u&&!g&&e.jsx(Do,{className:T("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{re.logEvent("chatgpt_thread_scroll_to_top"),f({behavior:"smooth"})},children:e.jsx(qh,{className:"icon-md text-token-text-primary"})}),!u&&e.jsx(Do,{className:T(x?null:"bottom-5",L?M?"translate-y-[-50px]":"translate-y-[-10px]":""),style:{bottom:j?"calc(var(--composer-bar_footer-current-height) + var(--composer-bar_current-height))":x},onClick:()=>{re.logEvent("chatgpt_thread_scroll_to_bottom"),h({behavior:"smooth"})},children:e.jsx($h,{className:"icon-md text-token-text-primary"})})]})}const Do=Me.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-light right-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`,Cp=60,kp=({children:t,scrollViewClassName:s,scrollAnchorTopOffset:n=0})=>{const a=d.useRef(null);return e.jsx("div",{className:"h-full",ref:a,children:e.jsx(pl,{children:e.jsx(lm,{className:"h-full",followButtonClassName:"hidden",initialScrollBehavior:"auto",scrollViewClassName:s,scroller:()=>_p(a,n)?0:1/0,children:t})})})},_p=(t,s)=>{const n=Tp(t.current);if(n==null)return!1;const a=n>s,o=n<s-Cp;return!a&&!o};function Tp(t){if(!t)return null;const s=t.querySelector('[data-scroll-anchor="true"]');if(!s)return null;const n=s.getBoundingClientRect().top,a=t.getBoundingClientRect().top;return n-a}const Ap=Rt(()=>Pt(()=>import("./h2ogvhqe0xseyoo4.js"),__vite__mapDeps([54,1,2,3,4,5,31,32,33,34,55])).then(t=>t.OpenDebugSidebarButton)),Ep=Rt(()=>Pt(()=>import("./m6p529gvpob3zv4v.js"),__vite__mapDeps([56,1,2,3,4,5,11]))),Np=Rt(()=>Pt(()=>import("./sso-j86rkpjzhf17bvy6.js").then(t=>t.e),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44])).catch(()=>()=>null)),Fo=ve({doNotShareSensitive:{id:"thread.modal.onboarding.title",defaultMessage:"Do not share sensitive materials with this application"},somethingWentWrong:{id:"thread.modal.unrecoverableError.title",defaultMessage:"Something went wrong"},tryAgainLater:{id:"thread.modal.unrecoverableError.description",defaultMessage:"We're sorry, but something went wrong. Please try again later."},resetThread:{id:"thread.modal.unrecoverableError.resetThread",defaultMessage:"Reset thread"},sharedConversationReportConversation:{id:"thread.sharedConversation.report",defaultMessage:"Report conversation"},latencyButton:{id:"thread.latencyButton",defaultMessage:"Latency"},archivedConversationDescription:{id:"thread.archivedConversationDescription",defaultMessage:"This conversation is archived. To continue, please unarchive it first."},unarchiveButton:{id:"thread.unarchiveButton",defaultMessage:"Unarchive"}});function Rp({clientThreadId:t}){const s=Vo(),n=Lt(t),a=async()=>{n&&(await Ye.patchConversation(n,{is_archived:!1}),s.invalidateQueries({queryKey:["conversation",t]}),ua.setState(o=>{const i=o.threads[n];i!=null&&(i.initialThreadData.isArchived=!1)}),ah(s))};return e.jsxs("div",{className:"my-6 flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"px-3 text-center text-sm text-token-text-secondary",children:e.jsx(P,{...Fo.archivedConversationDescription})}),e.jsx("div",{children:e.jsx(qe,{disabled:!n,onClick:a,icon:Kh,children:e.jsx(P,{...Fo.unarchiveButton})})})]})}const Zp=function({clientThreadId:t,onCompletionFinished:s,onCreate:n,preRequestCompletion:a,hideHeader:o,hideMessages:i,hideFooter:r,hideToolsOverlay:l,messagesVerticalAlign:c="top",prependThreadChildren:h,renderEmptyState:u,prefetchSearch:f}){const g=Dt(),p=en(),y=mi(t),m=ma(t),b=dt(t),M=zi(t).isArchived;d.useEffect(()=>{m||(Os(t)?Rn.addTiming("chatgpt.web.chatPage.renderNewConversation"):Rn.addTiming("chatgpt.web.chatPage.renderExistingConversation"))},[t,m]);const S=Ou(t,b),v=Ui(t,b),{setTargetedContent:C}=pi(),F=p?.includes(xl),N=Bu(),j=v>=2;fi(j);const w=Os(t)&&!j&&Cn(y),k=Os(t)&&!S&&(Cn(y)||y?.kind===tt.GizmoTest),U=gi().id,R=zu(t),O=R??U,L=!!R,E=Oi(O),V=hi()[O],q=Uu(t,y),K=aa();Hu(v,t,b,w),d.useEffect(()=>{xi()},[]),d.useEffect(()=>{K||C(void 0)},[t,C,K,b]);const{caModal:H,onRequestCompletion:Z,onChangeItemInView:ye,onChangeRating:me,onRequestMoreCompletions:le}=Zh({clientThreadId:t,currentModelId:O,defaultModelId:U,onCompletionFinished:s,onThreadCreated:n,preRequestCompletion:a}),{isUnauthenticated:oe,isLoading:Ae}=Ge(),se=!!g?.features.includes(lt.SharedWebsocket);d.useEffect(()=>{se&&Bs.registerIfNotConnected()},[se]),d.useEffect(()=>{const ee=()=>{if(document.visibilityState==="visible"){if(!se)return;Bs.registerIfNotConnected()}};return document.addEventListener("visibilitychange",ee),()=>{document.removeEventListener("visibilitychange",ee)}},[se]);const we=Lt(t);d.useEffect(()=>{const ee=()=>{Bs.stopConversation(we)};return window.addEventListener("beforeunload",ee),()=>{window.removeEventListener("beforeunload",ee)}},[we]);const xe=Gu({clientThreadId:t,currentLeafId:b,handleRequestCompletion:Z,prefetchSearchPromise:f});Wu({clientThreadId:t,currentModelId:O});const Ce=ee=>e.jsx(kp,{scrollAnchorTopOffset:o?0:nh,children:c==="bottom"?e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex-1"}),ee]}):ee});d.useEffect(()=>{document.title=q??"ChatGPT"},[q]);const I=We(t),ce=Ft(),Fe=Sl(),je=k&&!Fe&&!u&&!I&&!E&&!ce,D=je&&!Ae&&oe,z=je&&!Ae&&!oe,de=ng(D),ue=og(z),ae=D&&de||z&&ue,$=Bi(),he=Vu(),{reset:ke,streamingContext:Se,StreamingProvider:ge}=qu();d.useEffect(()=>{he&&(Se.setOnResetContext=()=>{ke()})},[he,ke,Se]);const Ue=d.useRef(null),Q=d.useRef(null),Le=d.useMemo(()=>({threadContentScrollContainerElementRef:Ue,footerRootContainerElementRef:Q}),[]);return e.jsx($u,{clientThreadId:t,currentLeafId:b,children:e.jsxs(ge,{value:Se,children:[F&&e.jsx(Ep,{}),e.jsx(Ku,{children:q!=null&&e.jsx("title",{children:q})}),y?.kind===tt.GizmoInteraction&&y.gizmo&&e.jsx(Yu,{gizmo:y.gizmo}),e.jsx(Xu.Provider,{value:Z,children:e.jsxs(Qu,{children:[e.jsxs(Zu,{clientThreadId:t,currentModelConfig:V,className:"composer-parent flex h-full flex-col focus-visible:outline-0",children:[!i&&e.jsx(Ju,{value:Le,children:e.jsx(Pp,{ref:Ue,children:!m&&!xe?k?u??e.jsx(Ig,{clientThreadId:t,currentModelId:O,isModelLoaded:L,onRequestCompletion:Z,enableV2Homepage:ae,v2HomepageDisclaimer:ae&&e.jsx(Xa,{clientThreadId:t})}):j?Ce(e.jsxs(e.Fragment,{children:[h,e.jsx(Mp,{onChangeItemInView:ye,onRequestMoreCompletions:le,onChangeRating:me,onRequestCompletion:Z,clientThreadId:t,conversationLeafId:b,hideHeader:o},t)]})):null:null})}),e.jsx(Ip,{ref:Q,children:M?e.jsx(Rp,{clientThreadId:t}):e.jsxs("div",{children:[!ae&&e.jsx(eg,{clientThreadId:t,isNewThread:w,showPromptStarters:w||!S,currentModelId:O,onRequestCompletion:Z}),!r&&e.jsx("div",{className:"relative w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",children:Cn(y)&&!ae&&e.jsx("div",{className:"min-h-4",children:e.jsx(Xa,{clientThreadId:t})})})]})})]}),!l&&e.jsxs("div",{className:"group absolute bottom-2 end-2 z-20 hidden gap-1 md:flex lg:bottom-3 lg:end-3",children:[N?e.jsxs(e.Fragment,{children:[e.jsx(Ap,{}),e.jsx(Np,{})]}):null,e.jsx(im,{})]}),H,e.jsx(eh,{clientThreadId:t,isStaticSharedThread:!1,isDynamicSharedThread:$}),e.jsx(th,{}),e.jsx(sh,{conversationId:t,currentModelId:O,isActiveWindow:!Fe})]})})]})})},Pp=Me.div`grow flex-1 overflow-hidden`,Ip=Me.div`md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent w-full`;export{yp as C,Ig as E,po as G,ig as S,Zp as T,kp as W,eg as a,_g as b,Ag as c,Yp as d};
//# sourceMappingURL=d4972kkhqfka6fuz.js.map
