const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/i8abxr8lnlfmsydx.js","assets/gxugo3tivqbzcilz.js","assets/dx1v4at4ga3ipt3m.js","assets/gplf7djrn74q999j.js","assets/mjjokra5fbs3tqyz.js","assets/b4l6rrkq8epp8cm7.js","assets/root-cja20nu3.css","assets/exorepid259sp82k.js","assets/conversation-small-ile61fj8.css","assets/gp54b9cvu35g78o2.js","assets/c005wy31tpfc1ymj.js","assets/duvf0bosvxmgbgyc.js","assets/m09g3b6n4ffd7wgp.js","assets/hqt0grnzqhujdif0.js","assets/i5u1bqdya7diu1bo.js","assets/i22mqwjwskni89rt.js","assets/f7u6sqz3g17c0bhj.js","assets/fzrn137102spawew.js","assets/dywqhq7cqrgvcfib.js","assets/m1pxdc1h8oku7wjh.js","assets/gpuxke9idpike21m.js","assets/mxzgjon35kpcnzo3.js","assets/dkmmfcznx6w5ltp0.js","assets/obzcye6vcaotgs9p.js","assets/ibf19kv72aklbreb.js","assets/sbr4qcp4dg2m1j70.js","assets/d8m2zkudflapbp3q.js","assets/e4x6rhrqefahfdp4.js","assets/ahjq7v8wdbkc8jv2.js","assets/nmuu08qi7tfe3154.js","assets/f6kwvk1bwb9ja6sh.js","assets/bzi3wu2merp9eqde.js","assets/d55eeruug12bhfcr.js","assets/cq13cfkie3v2seci.js","assets/dn31goj5q1gq1ak5.js"])))=>i.map(i=>d[i]);
import{aI as y,i as St,g as Mt,hB as Ot,hs as Lt,m as d,aD as M,n as W,r as x,G as pe,gX as At,l as q,b as Fe,aY as wt,dJ as Ue,bJ as se,gu as It,bM as ze,bN as Rt,bP as Dt,bQ as Xe,bA as jt,aL as Ke}from"./mjjokra5fbs3tqyz.js";import{h as C,E as te,Z as j,i as $e,j as We,H as Bt,G as D,k as Vt,T as _e,C as ye}from"./c005wy31tpfc1ymj.js";import{c as Ht,S as Gt,H as Yt,x as Ft,t as c}from"./dx1v4at4ga3ipt3m.js";import{_ as qe}from"./fzrn137102spawew.js";import{E as Ut,a5 as Z,a6 as H,a7 as L,a8 as ae,a9 as zt,aa as ie,ab as Ne,ac as Xt,ad as Kt,ae as $t,af as Wt,a2 as B,ag as Je,ah as Ze}from"./gplf7djrn74q999j.js";import{ay as F,b1 as R,aO as Qe,j_ as qt,kE as Jt,hH as Zt,ch as et,ik as U,kF as me,kG as Qt,kH as eo,kI as be,jr as to,kx as oo,ky as no,jt as ro,i as so,fp as ao}from"./exorepid259sp82k.js";import{m as A}from"./gp54b9cvu35g78o2.js";import{bU as io,bV as co,ac as lo,b as uo,bW as mo}from"./b4l6rrkq8epp8cm7.js";import{b as fo}from"./mdh88rmazy6b93hj.js";import{T as po,P as tt,f as ho,c as go,e as Eo,g as vo,D as Te,d as ot}from"./i22mqwjwskni89rt.js";import{u as ce}from"./hqt0grnzqhujdif0.js";import{c as nt,R as xo,I as Co}from"./ffvamqd22b12zxcz.js";import{u as _o}from"./mxzgjon35kpcnzo3.js";import{i as yo}from"./f7u6sqz3g17c0bhj.js";const No="_modelCursor_1mtn0_1",br={modelCursor:No},bo=(...e)=>o=>{e.forEach(t=>{if(typeof t=="function")t(o);else if(t){const n=t;n.current=o}})};function S(e){return new Ht(Gt.define(e))}const Pe=()=>y(()=>import("./pbl95wx6493wq92j.js"),[]).then(e=>S(e.shell)),rt={[C.bash]:Pe,[C.zsh]:Pe,[C.swift]:()=>y(()=>import("./pijqfo56g5y7ss6b.js"),[]).then(e=>S(e.swift)),[C.css]:()=>y(()=>import("./i8abxr8lnlfmsydx.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.css()),[C.html]:()=>y(()=>import("./dkmmfcznx6w5ltp0.js"),__vite__mapDeps([22,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,0,23])).then(e=>e.html()),[C.javascript]:()=>y(()=>import("./obzcye6vcaotgs9p.js"),__vite__mapDeps([23,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.javascript({jsx:!0,typescript:!1})),[C.typescript]:()=>y(()=>import("./obzcye6vcaotgs9p.js"),__vite__mapDeps([23,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.javascript({jsx:!0,typescript:!0})),[C.json]:()=>y(()=>import("./ibf19kv72aklbreb.js"),__vite__mapDeps([24,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.json()),[C.python]:()=>y(()=>import("./sbr4qcp4dg2m1j70.js"),__vite__mapDeps([25,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.python()),[C.sql]:()=>y(()=>import("./d8m2zkudflapbp3q.js"),__vite__mapDeps([26,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,1])).then(e=>e.sql()),[C.go]:()=>y(()=>import("./e4x6rhrqefahfdp4.js"),__vite__mapDeps([27,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.go()),[C.yaml]:()=>y(()=>import("./ahjq7v8wdbkc8jv2.js"),__vite__mapDeps([28,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.yaml()),[C.java]:()=>y(()=>import("./nmuu08qi7tfe3154.js"),__vite__mapDeps([29,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.java()),[C.rust]:()=>y(()=>import("./f6kwvk1bwb9ja6sh.js"),__vite__mapDeps([30,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.rust()),[C.cpp]:()=>y(()=>import("./bzi3wu2merp9eqde.js"),__vite__mapDeps([31,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.cpp()),[C.php]:()=>y(()=>import("./d55eeruug12bhfcr.js"),__vite__mapDeps([32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,0,23])).then(e=>e.php()),[C.xml]:()=>y(()=>import("./cq13cfkie3v2seci.js"),__vite__mapDeps([33,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.xml()),[C.vue]:()=>y(()=>import("./dn31goj5q1gq1ak5.js"),__vite__mapDeps([34,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,1,0,23])).then(e=>e.vue()),[C.ruby]:()=>y(()=>import("./e4lhyu305wu0fcut.js"),[]).then(e=>S(e.ruby)),[C.haskell]:()=>y(()=>import("./bf6r3t2rw7f01so5.js"),[]).then(e=>S(e.haskell)),[C.kotlin]:()=>y(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>S(e.kotlin)),[C.csharp]:()=>y(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>S(e.csharp)),[C.c]:()=>y(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>S(e.c)),[C.objectivec]:()=>y(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>S(e.objectiveC)),[C.r]:()=>y(()=>import("./n0t2rpizlasjzcxa.js"),[]).then(e=>S(e.r)),[C.lua]:()=>y(()=>import("./harowmpdmpnd9wki.js"),[]).then(e=>S(e.lua)),[C.dart]:()=>y(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>S(e.dart)),[C.scala]:()=>y(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>S(e.scala)),[C.perl]:()=>y(()=>import("./gq1ss5v2zpbborxl.js"),[]).then(e=>S(e.perl)),[C.commonlisp]:()=>y(()=>import("./jr6cjysmysifr6mr.js"),[]).then(e=>S(e.commonLisp)),[C.clojure]:()=>y(()=>import("./gf1tfl9d2himhfic.js"),[]).then(e=>S(e.clojure)),[C.ocaml]:()=>y(()=>import("./khji33iw1sxityyt.js"),[]).then(e=>S(e.oCaml)),[C.powershell]:()=>y(()=>import("./i9u5kd7kvamutmln.js"),[]).then(e=>S(e.powerShell)),[C.verilog]:()=>y(()=>import("./fix340p09fldyqxz.js"),[]).then(e=>S(e.verilog)),[C.dockerfile]:()=>y(()=>import("./cgm5tyzi32u32j10.js"),[]).then(e=>S(e.dockerFile)),[C.other]:()=>null},To=e=>e in rt,oe={},Tr=async e=>{if(oe[e]!=null)return oe[e];if(To(e)){const o=await rt[e]();return oe[e]=o,o}return null},Pr=e=>oe[e]??null;var st=e=>{var{theme:o,settings:t={},styles:n=[]}=e,r={".cm-gutters":{}},s={};t.background&&(s.backgroundColor=t.background),t.backgroundImage&&(s.backgroundImage=t.backgroundImage),t.foreground&&(s.color=t.foreground),t.fontSize&&(s.fontSize=t.fontSize),(t.background||t.foreground)&&(r["&"]=s),t.fontFamily&&(r["&.cm-editor .cm-scroller"]={fontFamily:t.fontFamily}),t.gutterBackground&&(r[".cm-gutters"].backgroundColor=t.gutterBackground),t.gutterForeground&&(r[".cm-gutters"].color=t.gutterForeground),t.gutterBorder&&(r[".cm-gutters"].borderRightColor=t.gutterBorder),t.caret&&(r[".cm-content"]={caretColor:t.caret},r[".cm-cursor, .cm-dropCursor"]={borderLeftColor:t.caret});var a={};t.gutterActiveForeground&&(a.color=t.gutterActiveForeground),t.lineHighlight&&(r[".cm-activeLine"]={backgroundColor:t.lineHighlight},a.backgroundColor=t.lineHighlight),r[".cm-activeLineGutter"]=a,t.selection&&(r["&.cm-focused .cm-selectionBackground, & .cm-line::selection, & .cm-selectionLayer .cm-selectionBackground, .cm-content ::selection"]={background:t.selection+" !important"}),t.selectionMatch&&(r["& .cm-selectionMatch"]={backgroundColor:t.selectionMatch});var i=Ut.theme(r,{dark:o==="dark"}),l=Yt.define(n),u=[i,Ft(l)];return u},Po={background:"#ffffff",foreground:"#383a42",caret:"#000",selection:"#add6ff",selectionMatch:"#a8ac94",lineHighlight:"#f0f0f0",gutterBackground:"#fff",gutterForeground:"#237893",gutterActiveForeground:"#0b216f",fontFamily:'Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace'},ko=[{tag:[c.keyword,c.operatorKeyword,c.modifier,c.color,c.constant(c.name),c.standard(c.name),c.standard(c.tagName),c.special(c.brace),c.atom,c.bool,c.special(c.variableName)],color:"#0000ff"},{tag:[c.moduleKeyword,c.controlKeyword],color:"#af00db"},{tag:[c.name,c.deleted,c.character,c.macroName,c.propertyName,c.variableName,c.labelName,c.definition(c.name)],color:"#0070c1"},{tag:c.heading,fontWeight:"bold",color:"#0070c1"},{tag:[c.typeName,c.className,c.tagName,c.number,c.changed,c.annotation,c.self,c.namespace],color:"#267f99"},{tag:[c.function(c.variableName),c.function(c.propertyName)],color:"#795e26"},{tag:[c.number],color:"#098658"},{tag:[c.operator,c.punctuation,c.separator,c.url,c.escape,c.regexp],color:"#383a42"},{tag:[c.regexp],color:"#af00db"},{tag:[c.special(c.string),c.processingInstruction,c.string,c.inserted],color:"#a31515"},{tag:[c.angleBracket],color:"#383a42"},{tag:c.strong,fontWeight:"bold"},{tag:c.emphasis,fontStyle:"italic"},{tag:c.strikethrough,textDecoration:"line-through"},{tag:[c.meta,c.comment],color:"#008000"},{tag:c.link,color:"#4078f2",textDecoration:"underline"},{tag:c.invalid,color:"#e45649"}];function So(e){var{theme:o="dark",settings:t={},styles:n=[]}=e||{};return st({theme:o,settings:qe({},Po,t),styles:[...ko,...n]})}var kr=So(),Mo={background:"#1e1e1e",foreground:"#9cdcfe",caret:"#c6c6c6",selection:"#6199ff2f",selectionMatch:"#72a1ff59",lineHighlight:"#ffffff0f",gutterBackground:"#1e1e1e",gutterForeground:"#838383",gutterActiveForeground:"#fff",fontFamily:'Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace'},Oo=[{tag:[c.keyword,c.operatorKeyword,c.modifier,c.color,c.constant(c.name),c.standard(c.name),c.standard(c.tagName),c.special(c.brace),c.atom,c.bool,c.special(c.variableName)],color:"#569cd6"},{tag:[c.controlKeyword,c.moduleKeyword],color:"#c586c0"},{tag:[c.name,c.deleted,c.character,c.macroName,c.propertyName,c.variableName,c.labelName,c.definition(c.name)],color:"#9cdcfe"},{tag:c.heading,fontWeight:"bold",color:"#9cdcfe"},{tag:[c.typeName,c.className,c.tagName,c.number,c.changed,c.annotation,c.self,c.namespace],color:"#4ec9b0"},{tag:[c.function(c.variableName),c.function(c.propertyName)],color:"#dcdcaa"},{tag:[c.number],color:"#b5cea8"},{tag:[c.operator,c.punctuation,c.separator,c.url,c.escape,c.regexp],color:"#d4d4d4"},{tag:[c.regexp],color:"#d16969"},{tag:[c.special(c.string),c.processingInstruction,c.string,c.inserted],color:"#ce9178"},{tag:[c.angleBracket],color:"#808080"},{tag:c.strong,fontWeight:"bold"},{tag:c.emphasis,fontStyle:"italic"},{tag:c.strikethrough,textDecoration:"line-through"},{tag:[c.meta,c.comment],color:"#6a9955"},{tag:c.link,color:"#6a9955",textDecoration:"underline"},{tag:c.invalid,color:"#ff0000"}];function Lo(e){var{theme:o="dark",settings:t={},styles:n=[]}=e||{};return st({theme:o,settings:qe({},Mo,t),styles:[...Oo,...n]})}var Sr=Lo(),Ao=St;function wo(e){return typeof e=="function"?e:Ao}var Io=wo,Ro=Ot,Do=Io,jo=Lt,Bo=9007199254740991,ue=4294967295,Vo=Math.min;function Ho(e,o){if(e=jo(e),e<1||e>Bo)return[];var t=ue,n=Vo(e,ue);o=Do(o),e-=ue;for(var r=Ro(n,o);++t<e;)o(t);return r}var Go=Ho;const Yo=Mt(Go),Fo=e=>d.jsx(A.div,{className:"dark:bg-white-400 aspect-square rounded-full bg-gray-400",animate:{translateY:["0%","-50%","0%","0%","0%"]},style:{translateX:.5,width:3,height:3},transition:{repeat:1/0,type:"keyframes",delay:e/10,duration:.7}},e),Uo=()=>d.jsx(A.div,{className:"grid h-full max-w-full flex-1 grid-cols-3 items-center gap-[0.4] p-1",children:Yo(3,e=>Fo(e))});function zo(e){switch(e){case"dark_gray":return{normal:"text-token-text-secondary dark:text-white-400",hover:"cursor-pointer hover:text-token-text-primary group-hover:text-token-text-primary"};case"light_gray":return{normal:"text-gray-400",hover:"cursor-pointer hover:text-token-text-secondary group-hover:text-token-text-secondary"}}}function he({children:e,className:o,onClick:t,isClickable:n=!1,theme:r="dark_gray"}){const s=zo(r),a=(t!=null||n)&&s.hover;return d.jsxs("div",{className:M("relative inline-block h-[20px] w-[20px] shrink-0 transition-opacity",o,a,s.normal),onClick:t,children:[e?d.jsx(io,{className:"h-[20px] w-[20px] shrink-0"}):d.jsx(co,{className:"h-[20px] w-[20px] shrink-0"}),d.jsx("span",{className:M("absolute inset-0 flex items-center justify-center text-[8px] font-black",a,s.normal),children:e})]})}function le(){return d.jsx(he,{theme:"light_gray",children:d.jsx(Uo,{})})}function Xo({count:e,isLoading:o,onClick:t}){return o?d.jsx(le,{}):d.jsx(he,{onClick:t,theme:"dark_gray",children:e})}function Ko({isLoading:e=!1,onClick:o}){return e?d.jsx(le,{}):d.jsx(he,{isClickable:!0,onClick:o,theme:"light_gray"})}var V=(e=>(e[e.up=-1]="up",e[e.down=1]="down",e))(V||{}),ne=(e=>(e.COMMENT="comment",e.COMPOSER="composer",e))(ne||{}),O=(e=>(e.COLLAPSED="collapsed",e.EXPANDED="expanded",e))(O||{});const at=([e,o],[t,n])=>{const r=e+o,s=t+n;return e<s&&t<r},fe=([e,o])=>e+o,X=e=>{if(e.type===O.COLLAPSED)return[e.offsetY??0,0];const{offsetY:o,shiftY:t=0,height:n=0}=e,r=o+t;return t<0?[r,n+Math.abs(t)]:[r,n]},$o=(e,o,t)=>{if(!at(e,o))return null;const[n,r]=e,s=n+r,[a,i]=o,l=a+i,u=a-s,f=l-n;return t===V.up?u:f};var it=(e=>(e.ABOVE="above",e.BELOW="below",e))(it||{});function $(e,o){return W(e.coordsAtPos(o))}const ke=360,Wo=250,ct=44,Se=.5,Me=[.5,.9,1],qo=[1,.75,.2],Jo=({onClose:e,onSubmit:o,opensOverDocument:t=!1,opensFromGutter:n=!1,gutterHasComments:r=!1},s)=>{const a=pe(),i=x.useRef(null),l=x.useRef(!1),[u,f]=x.useState(""),[p,m]=x.useState(!0),h=()=>{f(""),e?.(l.current)},g=(T=u)=>{l.current=!0,o?.(T),f("")},v=At(({windowWidth:T})=>t?T<ke+100?Wo:ke:te,0),E={};n&&(E.top=-12),t&&n?E.right=0:E.left=0;let _="";n&&!t?_="8px 50%":n&&t?_="calc(100% + 8px) 50%":t&&(_="center left");let P=0;n&&!t&&r&&(P=We);const k=T=>{const{metaKey:w,shiftKey:N,key:I}=T;I==="Enter"&&u&&!(N||w)?(g(),T.preventDefault()):I==="Escape"&&(f(""),e?.(!1))},b=a.formatMessage({id:"VvfbvY",defaultMessage:"Edit or explain..."});return d.jsx(A.div,{ref:bo(i,s),className:M("absolute flex items-center",j.commentComposer),style:{...E,minHeight:ct},transition:{type:"spring",bounce:.18,duration:.48},initial:{translateX:0},animate:{translateX:P},exit:{translateX:0},children:d.jsx(A.div,{className:M("no-scrollbar relative z-10 flex items-center overflow-x-hidden border border-token-border-light",$e,{"rounded-full":p,"rounded-2xl":!p}),initial:{width:t?te:24,scaleX:t?Se:void 0,scale:t?void 0:Se},animate:{width:v,scaleX:t?Me:void 0,scale:t?void 0:Me},exit:{filter:"blur(16px)",scale:t?void 0:qo,width:t?te:24,opacity:t?0:[1,1,0]},transition:{type:"spring",bounce:t?.14:0,duration:.28,scale:{type:"tween",duration:.2},opacity:{type:"tween",time:[0,.95,1]}},style:{transformOrigin:_},children:d.jsxs(A.div,{className:"relative z-0 flex w-full items-center bg-token-main-surface-primary px-4 py-2.5",children:[d.jsx(A.div,{className:"backdrop-saturate-25 absolute inset-0 z-[-1] bg-gray-50/75 backdrop-blur-3xl dark:bg-gray-700/75",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.2}}),d.jsx(yo,{"aria-placeholder":b,value:u,className:"w-full resize-none border-0 bg-transparent px-1 py-0 pr-2 text-token-text-primary outline-0 placeholder:text-token-text-secondary focus:ring-0 focus-visible:ring-0",autoFocus:!0,maxRows:4,onBlur:h,onHeightChange:(T,{rowHeight:w})=>{m(Math.floor(T/w)<=1)},onChange:({target:{value:T}})=>f(T),onKeyDown:k}),!u&&d.jsx("span",{"aria-hidden":!0,className:"absolute inline-block text-nowrap pl-1 text-token-text-secondary",children:b}),d.jsx(A.button,{className:M("-mr-1.5 h-6 w-6 rounded-full bg-black text-center dark:bg-white",{"self-end":!p}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:()=>g(),children:d.jsx(lo,{className:"h-6 w-6 text-white dark:text-black"})})]})})})},lt=x.forwardRef(Jo),Zo=(e,o)=>{if(o?.type!==H.SELECTION)return null;try{const{from:t,to:n}=o,{top:r}=e.dom.getBoundingClientRect(),{bottom:s,top:a}=$(e,t),{bottom:i}=$(e,n),l=ae(e)?-30:-24;let u=s-r+l;const f=a-r;return u=i-r+8,{composerTop:u,loadingTop:f}}catch(t){return R.logError("Invalid position in SelectionCommentComposer",t),null}},Qo=({toolbarPosition:e,composerRect:o,view:t})=>{let{width:n,height:r}=o;if(r||=ct,t==null||e==null)return null;const{right:s,left:a}=t.dom.getBoundingClientRect(),{left:i,top:l,aboveOrBelow:u,toolbarSize:f}=e,p=l-(u===it.ABOVE&&r!==0?r-f.height:0),m=zt(t)?12:0;return{left:Math.min(i,s-a-n-m),composerTop:p,aboveOrBelow:u}},en=({toolbarPosition:e,commentingOn:o,isWaitingForCommentResponse:t=!1,onAddComment:n})=>{const r=Z()(),[s,a]=ce(),i=Qo({view:r,toolbarPosition:e,composerRect:s});if(r==null||i==null)return null;const{left:l,composerTop:u}=i,f=p=>{if(o?.type!==H.SELECTION)return;const{action:m,sourceRange:h}=o;n?.(p,m,h,o.type)};return d.jsx(F,{children:o?.type===H.SELECTION&&!t&&d.jsx("div",{className:M("absolute",j.commentComposer),style:{left:l,top:u},children:d.jsx(lt,{opensOverDocument:!0,onClose:p=>{p||(L.cancelCommentingOn(),r&&ae(r)&&!r.state.selection.empty&&r.dispatch(r.state.tr.setSelection(new po(r.state.selection.$from))),document.getSelection()?.removeAllRanges())},onSubmit:f,ref:a})},"composer")})};function ut(e,o){return o?e.getState(o)??null:null}function tn(e){return e.nodeSize-2}function on(e,o){return o>=0&&o<=tn(e)}class G{constructor(o,t,n={}){this.match=o,this.match=o,this.handler=typeof t=="string"?nn(t):t,this.undoable=n.undoable!==!1,this.inCode=n.inCode||!1}}function nn(e){return function(o,t,n,r){let s=e;if(t[1]){let a=t[0].lastIndexOf(t[1]);s+=t[0].slice(a+t[1].length),n+=a;let i=n-r;i>0&&(s=t[0].slice(a-i,a)+s,n=r)}return o.tr.insertText(s,n,r)}}const rn=500;function Mr({rules:e}){let o=new tt({state:{init(){return null},apply(t,n){let r=t.getMeta(this);return r||(t.selectionSet||t.docChanged?null:n)}},props:{handleTextInput(t,n,r,s){return Oe(t,n,r,s,e,o)},handleDOMEvents:{compositionend:t=>{setTimeout(()=>{let{$cursor:n}=t.state.selection;n&&Oe(t,n.pos,n.pos,"",e,o)})}}},isInputRules:!0});return o}function Oe(e,o,t,n,r,s){if(e.composing)return!1;let a=e.state,i=a.doc.resolve(o),l=i.parent.textBetween(Math.max(0,i.parentOffset-rn),i.parentOffset,null,"￼")+n;for(let u=0;u<r.length;u++){let f=r[u];if(i.parent.type.spec.code){if(!f.inCode)continue}else if(f.inCode==="only")continue;let p=f.match.exec(l),m=p&&f.handler(a,p,o-(p[0].length-n.length),t);if(m)return f.undoable&&m.setMeta(s,{transform:m,from:o,to:t,text:n}),e.dispatch(m),!0}return!1}new G(/--$/,"—");new G(/\.\.\.$/,"…");new G(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"“");new G(/"$/,"”");new G(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"‘");new G(/'$/,"’");function Or(e,o,t=null,n){return new G(e,(r,s,a,i)=>{let l=t instanceof Function?t(s):t,u=r.tr.delete(a,i),f=u.doc.resolve(a),p=f.blockRange(),m=p&&ho(p,o,l);if(!m)return null;u.wrap(p,m);let h=u.doc.resolve(a-1).nodeBefore;return h&&h.type==o&&go(u.doc,a-1)&&(!n||n(s,h))&&u.join(a-1),u})}function sn(e,o,t=null){return new G(e,(n,r,s,a)=>{let i=n.doc.resolve(s),l=t instanceof Function?t(r):t;return i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),o)?n.tr.delete(s,a).setBlockType(s,s,o,l):null})}function ge(e,o,t,n={}){if(e==null)return null;const r=(Array.isArray(t)?t:[t]).filter(Qe),s=o.nodes[e].createAndFill(n,r);return s??null}const an={content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM(){return["p",0]}},cn="paragraph";class dt extends ie{unistNodeName(){return cn}static proseMirrorNodeName(){return"paragraph"}proseMirrorNodeSpec(){return an}unistNodeToProseMirrorNodes({schema:o,convertedChildren:t,attrs:n}){return ge(this.proseMirrorNodeName(),o,t,n)}proseMirrorNodeToUnistNodes(o,t){return[{type:this.unistNodeName(),children:t}]}}const ln=(e,o,t,n)=>e.value?o.text(e.value,[o.marks.startend.create(t),...n??[]]):null;class J extends ie{unistNodeName(){return"text"}static proseMirrorNodeName(){return"text"}proseMirrorNodeSpec(){return{group:"inline"}}unistNodeToProseMirrorNodes({node:o,schema:t,attrs:n}){return ln(o,t,n)}proseMirrorNodeToUnistNodes(o){return[{type:this.unistNodeName(),value:o.text??""}]}}class z extends ie{static isAtStart(o,t){return o.selection.empty?t!==void 0?t.endOfTextblock("backward",o):o.selection.$anchor.parentOffset>0:!1}static headingLevelCommandBuilder(o,t,n){return(r,s,a)=>{if(n&&!z.isAtStart(r,a))return!1;const{$anchor:i}=r.selection,l=i.parent;if(l.type.name!=="heading")return!1;const u=l.attrs.level+t;if(u<0||u>6)return!1;if(s===void 0)return!0;const f=i.before(i.depth);return u>0?s(r.tr.setNodeMarkup(f,void 0,{level:u})):s(r.tr.setNodeMarkup(f,o.nodes.paragraph)),!0}}dependencies(){return[new dt,new J]}unistNodeName(){return"heading"}static proseMirrorNodeName(){return"heading"}proseMirrorNodeSpec(){return{attrs:{level:{default:1}},content:"text*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM(o){return["h"+o.attrs.level.toString(),0]}}}proseMirrorInputRules(o){return[sn(/^\s{0,3}(#{1,6})\s$/,o.nodes[this.proseMirrorNodeName()],t=>({level:t[1].length}))]}proseMirrorKeymap(o){const t={Tab:z.headingLevelCommandBuilder(o,1,!1),"#":z.headingLevelCommandBuilder(o,1,!0),"Shift-Tab":z.headingLevelCommandBuilder(o,-1,!1)};for(let n=1;n<=6;n++)t[`Shift-Mod-${n.toString()}`]=fo(o.nodes[this.proseMirrorNodeName()],{level:n});return t}unistNodeToProseMirrorNodes({node:o,schema:t,convertedChildren:n,attrs:r}){const{depth:s}=o;return ge(this.proseMirrorNodeName(),t,n,{...r,level:s})}proseMirrorNodeToUnistNodes(o,t){return[{type:this.unistNodeName(),depth:o.attrs.level,children:t}]}}const Le=(e,o,t)=>{const n=t==="min"?0:o.length-1;for(let r=n;t==="min"?r<o.length:r>=0;t==="min"?r++:r--){const{sourcePos:s,pmPos:a}=o[r];if(s===e)return a;if(t==="min"&&s>e||t==="max"&&s<e)return t==="min"?o[r-1]?.pmPos??a:a}return null};class un extends ie{unistNodeName(){return"root"}static proseMirrorNodeName(){return"doc"}proseMirrorNodeSpec(){return{content:"block+"}}unistNodeToProseMirrorNodes({schema:o,convertedChildren:t,attrs:n}){return ge(this.proseMirrorNodeName(),o,t,n)}proseMirrorNodeToUnistNodes(o,t){return[{type:this.unistNodeName(),children:t}]}}const Ae=(e,o)=>{if(!o)return!1;const[t,n]=o;return e>=t&&e<n},mt=(e,o)=>e.pmPos-o.pmPos,we=(e,o)=>{const t=o[o.length-1].sourcePos;return Math.min(Math.max(e,0),t)},Ie=(e,o)=>{const t=q(o)?.sourcePos??0;return Math.min(Math.max(e,0),t)},Re=({positions:e,sourcePos:o,sourceEndPos:t})=>{const n=[];for(let r=0;r<e.length;r++){const s=e[r],{sourcePos:a,leafSourceRange:i,isClose:l=!1}=s;if(t!=null&&a>t)break;const u=e[r+1]??null,f=p=>{let m=e[p];if(m==null)return p;let h=e[p+1],{leafSourceRange:g}=m;for(;m.nodeTypeName!==J.proseMirrorNodeName()&&!m.isClose&&h!=null&&!Ae(o,g);)n.push(h),m=h,h=e[p+2],g=m.leafSourceRange,p++;return p};if(a===o&&!l||Ae(o,i))n.push(s),r=f(r);else if(a<=o&&(u?.sourcePos??Number.POSITIVE_INFINITY)>=o){let p=r+1;const m=[];for(;e[p]?.isClose===!0;)m.push(p),p++;if(e[p]){const{sourcePos:h}=e[p];do n.push(e[p]);while(e[++p].sourcePos===h);p=f(p-1)}else{(a===o||l)&&n.push(s);for(const h of m)n.push(e[h])}r=p}}return n.sort(mt)},De=({positions:e,sourcePos:o})=>{const t=[],n=r=>{r&&t.push(r)};for(let r=0;r<e.length;r++){const s=e[r],{sourcePos:a}=s;if(o==null||a>o)break;const i=e[r-1]??null,l=e[r+1]??null,u=o>a&&o<(l?.sourcePos??-1),f=s.nodeTypeName===J.proseMirrorNodeName();if(a===o||u&&!f){if(s.isClose&&!i?.isClose&&s.nodeTypeName===i?.nodeTypeName||!s.isClose&&l.isClose&&s.nodeTypeName===l.nodeTypeName||s.isClose&&i?.isClose||!s.isClose&&i!=null&&i?.nodeTypeName!==J.proseMirrorNodeName()){n(i);let g=r-2,v=e[g];for(;g>=0&&v.isClose;)n(v),v=e[--g]}let p=r,m=s,h=m;do n(m),h=m,m=e[++p];while(m?.sourcePos===o||m?.depth<h?.depth);break}else if(u&&f){let p=r+1,m=e[p];for(;m?.isClose;)n(m),m=e[++p];break}}return t.sort(mt)},dn=e=>{const o=new Jt(Zt.GetPositionTransformer,{debug:!1});o.startBlock("get_positition_transformer");const t=new Map;e.descendants((s,a)=>{const i=Ne(s);if(!i)return;const{start:l,end:u}=i,f=s.type.name,{depth:p}=e.resolve(a);if(t.set(a,{pmPos:a,sourcePos:l,leafSourceRange:s.isBlock?void 0:[l,u],depth:p,nodeTypeName:f,isClose:!1,parentNodeTypeNameStack:[]}),s.isBlock){const m=a+s.nodeSize-1;t.set(m,{pmPos:m,sourcePos:u,depth:e.resolve(m).depth,nodeTypeName:f,isClose:!0,parentNodeTypeNameStack:[]})}if(s.isText)for(let m=0;m<(s.text?.length??0);m++){const h=a+m;t.set(h,{pmPos:h,sourcePos:l+m,depth:p,nodeTypeName:f,isClose:!1,parentNodeTypeNameStack:[]})}}),t.set(e.content.size,{pmPos:e.content.size,nodeTypeName:e.type.name,depth:0,isClose:!0,sourcePos:W(Ne(e)).end,parentNodeTypeNameStack:[]});const n=Array.from(t.entries()).sort(([s],[a])=>s-a).map(([,s])=>s),r=[un.proseMirrorNodeName()];for(const s of n)s.isClose?(s.parentNodeTypeNameStack=r.concat(),r.pop()):(s.parentNodeTypeNameStack=r.concat(),s.nodeTypeName!==J.proseMirrorNodeName()&&q(r)!==s.nodeTypeName&&r.push(s.nodeTypeName));return o.endBlock("get_positition_transformer"),{positions:n,pmRangeToSourceRange:({start:s,end:a})=>({start:n[Math.max(s,0)].sourcePos,end:n[Math.min(a,n.length-1)].sourcePos}),sourceStartToPmPos:s=>Re({sourcePos:we(s,n),positions:n,sourceEndPos:null}),sourceEndToPmPos:s=>De({sourcePos:Ie(s,n),positions:n}),sourceRangeToPmRange:s=>{o.startBlock("source_range_to_pm_range");const{start:a,end:i}=s,l=Ie(i,n),u=Re({sourcePos:we(a,n),sourceEndPos:l,positions:n}),f=De({sourcePos:l,positions:n});return o.endBlock("source_range_to_pm_range"),{start:u,end:f}}}},mn=qt(dn);function fn(e,o){const t=gn(e);if(t.length===0)return o;let n=o;return t.forEach(r=>{n=pn(r,n)}),n}function pn(e,o){return Xt(o,{start:e.from,end:e.to},hn(e))}function hn(e){return e.slice.size-(e.to-e.from)}function gn(e){return e.steps.filter(o=>o instanceof Eo)}const re=new vo("comments");function je(e,o){const{sourceRangeToPmRange:t}=mn(e),n=o.map(({id:r,at:s})=>{const{start:a,end:i}=t(s),l=Le(s.start,a,"max"),u=Le(s.end,i,"min");return u==null||l==null?null:[r,{start:l,end:u}]}).filter(Qe);return new Map(n)}function En(e,o){const{type:t}=o;if(t===H.SELECTION){const{from:s,to:a}=o;return[s,a]}const{pos:n}=o,r=n+(e.nodeAt(n)?.nodeSize??0);return[n,r]}const Be=(e,o,t=null,n=null)=>{const r=[],s=Array.from(o.entries()).reverse(),a=new Map(e.map(i=>[i.id,i]));for(const[i,l]of s){const u=a.get(i),m=$t({isHovered:t===i,isFocused:n===i,isCode:!1,diffStatus:u?.diffStatus});r.push(ot.inline(l.start,l.end,{class:m,"data-comment-id":i,nodeName:"span"}))}return r},Lr=e=>new tt({key:re,state:{init:(o,{doc:t})=>{const n=je(t,e);return{comments:e,commentingOn:null,hoveredOnBlock:null,hoveredCommentId:null,focusedCommentId:null,decorations:Be(e,n),positions:n}},apply:(o,t)=>{const n=o.getMeta(re)??{},r=n.comments,s=r??t.comments,a=r!=null?je(o.doc,s):t.positions;let i=n.commentingOn;i===void 0&&(i=t.commentingOn);let l=n.hoveredCommentId;l===void 0&&(l=t.hoveredCommentId);let u=n.focusedCommentId;u===void 0&&(u=t.focusedCommentId);const f=fn(o,a),p=Kt(s,f);return{comments:p,commentingOn:i,hoveredCommentId:l,focusedCommentId:u,decorations:Be(p,f,l,u),positions:f}}},props:{handleClickOn:(o,t,n,r,s)=>{const{target:a}=s;if(a instanceof HTMLElement){const{commentId:i}=a.dataset;if(!i)return;L.focusComment(i)}},handleDOMEvents:{mouseover(o,t){const{target:n}=t;if(n instanceof HTMLElement){const{commentId:r}=n.dataset;r?L.mouseEnterComment(r):L.mouseLeaveComment()}}},decorations(o){const t=this.getState(o);if(!t)return Te.empty;const{commentingOn:n,decorations:r}=t,{doc:s}=o;if(n){const[a,i]=En(s,n);a!=null&&i!=null&&r.push(ot.inline(a,i,{class:Bt.document},{comment:{pattern:n}}))}return Te.create(s,r.concat())}}});function vn(e,o,t){const n=e+o;for(const r of t.values()){const s=r.start,a=r.end;if(e<a&&s<n)return!0}return!1}const xn=50,Cn=200,_n=[dt.proseMirrorNodeName(),z.proseMirrorNodeName()],yn=e=>e?e.isBlock:!1,Nn=e=>{if(!e)return!1;const{isBlock:o,type:{name:t}}=e;return o&&_n.includes(t)},bn=(e,o,t,n)=>{const r=e.posAtCoords({left:o,top:t});if(r==null)return;const{pos:s,inside:a}=r;if(a===-1)return;const{state:i}=e;let l=s,u=i.doc.nodeAt(l);for(;!yn(u)&&l>=0;)l--,u=i.doc.nodeAt(l);if(!u||!Nn(u))return;const f=n!=null&&vn(l,u.nodeSize,n);return{node:u,nodeHasComment:f,pos:l}};function Tn(e,o,t){const n=bn(e,o.x,o.y,t);if(n==null)return null;const{node:r,pos:s,nodeHasComment:a}=n,{top:i}=e.coordsAtPos(0);function l(){const h=s+1;return on(e.state.doc,h)&&e.state.doc.nodeAt(h)?.isText?e.coordsAtPos(h).top:e.coordsAtPos(s).top}const u=l(),f=u-i;return{height:e.coordsAtPos(s+r.nodeSize-1).bottom-u,nodeHasComment:a,mouseEnteredAt:Date.now(),yOffset:f,pos:s}}function Pn(e){const o=x.useRef(!1),t=x.useRef(!1),[n,r]=x.useState(null),s=Wt(),a=s()?.dom,i=x.useRef(!1),l=B(({visibleBlockCommentLauncher_DEBUG_ONLY:p})=>p),u=x.useCallback(et(p=>{o.current=!0;const{commentingOn:m}=B.getState();if(t.current||m!=null)return;const h=s();if(h==null||!o.current)return r(null);const{dom:g,state:v}=h,E=ut(re,v)?.positions;if(E==null)return r(null);const _=Tn(h,p,E);if(_==null||_.nodeHasComment&&e===D.COLLAPSED){r(null);return}if(i.current&&_.yOffset!==n?.yOffset){r(null);return}const P=h.coordsAtPos(0),k=g.getBoundingClientRect().width,T=(p.x-P.left)/k>=xn/100;r(T?_:null)},Cn),[s,i,n]);x.useEffect(()=>{if(a!=null)return Fe(a,{mouseenter:()=>{o.current=!0,t.current=!1},mouseleave:({relatedTarget:p})=>{if(u.cancel(),p instanceof HTMLElement&&p.closest("[data-block-comment-launcher]")){t.current=!0;return}t.current=!1,o.current=!1,B.getState().commentingOn==null&&r(null)},mousemove:u})},[s,a,e,u]);const f=x.useCallback(({relatedTarget:p})=>{const{commentingOn:m}=B.getState();m==null&&p!==a&&(t.current=!1,r(null))},[a]);return{visibleBlockComment:l??n,handleMouseLeave:f,onComposerVisibleChange:p=>{i.current=p}}}const kn=({isWaitingForCommentResponse:e=!1,opensOverDocument:o=!1,hasComments:t=!1,activeBlockComment:n,composerRef:r,onLaunchComposer:s,onMouseLeave:a,onSubmit:i})=>{const[l,u]=x.useState(!1),{yOffset:f,height:p,pos:m}=n,h=()=>{u(!0),s?.(),R.logButtonClick(U.BLOCK_COMMENT_LAUNCHER),L.startCommentingOn({type:H.BLOCK,pos:m})},g=_=>{_||(u(!1),L.cancelCommentingOn())},v=_=>{u(!1),i?.(_)};x.useEffect(()=>()=>{L.mouseLeaveBlock()},[]);const E=t&&l?o?-88:88:0;return d.jsx(A.div,{className:M("pointer-events-auto absolute flex h-6 w-5 origin-[14px_50%] items-start after:absolute after:-inset-4 after:content-['']",j.commentComposer),initial:!1,animate:{opacity:1},exit:{opacity:0},transition:{type:"spring",duration:.2,bounce:.1},style:{top:0,height:p,translateY:f},onMouseLeave:a,"data-block-comment-launcher":!0,children:d.jsxs(F,{children:[l?d.jsx(lt,{ref:r,opensFromGutter:!0,onClose:g,onSubmit:v,gutterHasComments:t,opensOverDocument:o},"composer"):null,d.jsx(A.button,{initial:{opacity:0},animate:{opacity:l?0:1,translateX:E},transition:{duration:.15,translateX:{type:"spring",bounce:.18,duration:.48}},className:"group absolute z-10 flex h-6 gap-1 bg-transparent after:absolute after:-inset-y-4 after:-left-1 after:-right-4 after:content-['']",onClick:h,onMouseEnter:()=>L.mouseEnterBlock(m),onMouseLeave:()=>L.mouseLeaveBlock(),disabled:l||e,children:d.jsx(Ko,{isLoading:e})},"launcer")]})})},Sn=({isWaitingForCommentResponse:e=!1,isRequestActive:o=!1,hasComments:t=!1,composerRef:n,gutterMode:r,onAddComment:s})=>{const a=Je(),{visibleBlockComment:i,handleMouseLeave:l,onComposerVisibleChange:u}=Pn(r),f=p=>{if(!i||!a)return;const{doc:m}=a,{pos:h}=i,g=m.nodeAt(h);if(!g)return;const{attrs:{start:v,end:E}}=g;s?.(p,Ze.ASK,{start:v,end:E},H.BLOCK)};return d.jsx(F,{onExitComplete:()=>u(!1),children:i&&a&&(e||!o)&&d.jsx(kn,{composerRef:n,isWaitingForCommentResponse:e,opensOverDocument:r===D.COLLAPSED,activeBlockComment:i,hasComments:t,onSubmit:f,onMouseLeave:l,onLaunchComposer:()=>u(!0)},"launcher")})},ft={type:"spring",bounce:.12,duration:.5},pt="opacity-50",Mn=({count:e,offsetY:o,isLoading:t=!1,onClick:n})=>d.jsx(A.div,{className:M("absolute",j.collapsedComment),initial:{opacity:0},animate:{opacity:1},style:{translateY:o},transition:ft,exit:{opacity:0},children:d.jsx(Xo,{count:e,isLoading:t,onClick:n})}),On=({isFocused:e,isHovered:o})=>{const t=e||o?"grow font-medium text-token-text-primary transition-colors":"grow font-medium text-token-text-secondary transition-colors",n=e||o?"opacity-100 transition":"opacity-75 transition";return d.jsxs(d.Fragment,{children:[d.jsx("div",{className:n,children:d.jsx("div",{className:"gizmo-bot-avatar rounded-full",children:d.jsx(Qt,{size:"gizmoConversation",iconName:"openai"})})}),d.jsx("span",{className:t,children:"ChatGPT"})]})},Ln=({comment:e,isFocused:o,isSomeCommentFocused:t,isHovered:n})=>{const r=e.diffStatus===me.REMOVED;return d.jsx("div",{className:M("mt-2 text-token-text-primary transition-all",{"opacity-80":!o&&!t&&!n&&!r,"opacity-40":!o&&t&&!n&&!r,[pt]:r}),children:e.content})},An=({left:e,right:o,comment:t,disableAnimations:n=!1,onClick:r,onMouseEnter:s,onMouseLeave:a,onAccept:i,onDismiss:l,translateY:u,isFocused:f=!1,isSomeCommentFocused:p=!1,disableActions:m=!1,isHovered:h=!1},g)=>{const[v,E]=x.useState(!1),_=t.diffStatus===me.ADDED,P=t.diffStatus===me.REMOVED,k=t.diffStatus!=null,b=()=>{E(!0),s?.()},T=()=>{E(!1),a?.()},w=pe(),N=f||v&&!p;return d.jsx(A.div,{ref:g,className:M("absolute",j.expandedComment,{"cursor-default":f,"cursor-pointer":!f,[j.expandedCommentFocused]:f,[j.expandedCommentHovered]:h}),style:{left:e,right:o},initial:n?!1:{translateY:u,scale:.85,opacity:0},animate:n?void 0:{translateY:u,scale:f?1:.97,opacity:1},exit:n?void 0:{scale:.85,opacity:0,filter:"blur(16px)"},transition:ft,onClick:r,onMouseEnter:m?void 0:b,onMouseLeave:m?void 0:T,"data-comment-id":t.id,children:d.jsxs("div",{className:M("flex min-h-8 flex-col overflow-hidden rounded-2xl border p-4 pt-2 text-left text-sm transition-all",{"border-transparent bg-gray-50 dark:bg-gray-800":!f&&!h,"border-token-border-light bg-token-main-surface-primary":h&&!f,"border-token-border-light bg-token-main-surface-primary shadow-xl":f||v&&!p,"relative after:absolute after:bottom-0 after:left-0 after:top-0 after:w-1":k,"after:bg-green-500":_,"after:bg-red-500":P}),style:{width:te},children:[d.jsxs("div",{className:M("flex h-8 flex-row items-center gap-2.5",{[pt]:P}),children:[d.jsx(On,{isFocused:f,isHovered:h}),d.jsx("button",{className:M("-mr-1 rounded-full bg-transparent p-1 text-token-text-secondary",{"cursor-pointer hover:bg-gray-100 hover:text-token-text-primary dark:hover:bg-gray-700":!m,"cursor-not-allowed":m}),onClick:l,disabled:m,"aria-label":w.formatMessage({id:"fYDa3C",defaultMessage:"Dismiss comment"}),children:d.jsx(uo,{className:"icon-sm"})})]}),d.jsx(Ln,{comment:t,isFocused:f,isHovered:h,isSomeCommentFocused:p}),d.jsx(F,{initial:!1,children:N&&d.jsx(A.div,{initial:n?!1:{opacity:0,height:0},animate:{opacity:1,height:"auto",transition:{opacity:{delay:.14,duration:.2},height:{bounce:0,duration:.2}}},exit:n?void 0:{opacity:0,height:0,transition:{opacity:{duration:.08},height:{bounce:0,duration:.2}}},className:"flex items-center justify-start",children:d.jsx("div",{className:"mt-2.5",children:d.jsx(wt,{color:"secondary",onClick:i,disabled:m,children:w.formatMessage({id:"WIW5OL",defaultMessage:"Apply"})})})})})]})})},ht=x.forwardRef(An),wn=({offsetY:e,opensOverDocument:o=!1,disableActions:t=!1,isFocused:n=!1,isSomeCommentFocused:r=!1,onAccept:s,onClick:a,onDismiss:i,onMouseEnter:l,onMouseLeave:u,comment:f,isHovered:p=!1})=>{const m=x.useRef(null);return x.useEffect(()=>Fe(document,{mousedown:({target:h})=>{h instanceof HTMLElement&&!h.closest("[data-comment-id]")&&!m.current?.contains(h)&&L.blurComment()}})),d.jsx(ht,{ref:m,comment:f,disableActions:t,onAccept:s,onDismiss:i,onMouseEnter:l,onMouseLeave:u,isSomeCommentFocused:r,isHovered:p,onClick:a,translateY:e,isFocused:n,left:o?void 0:We,right:o?Vt:void 0})},In=({onAcceptComment:e,onDismissComment:o,disableActions:t=!1,entry:n,isGutterCollapsed:r=!1,isHovered:s=!1,isFocused:a=!1,isSomeCommentFocused:i=!1})=>{const{offsetY:l,type:u}=n,[f,p]=eo();let m=null;if(u===O.COLLAPSED)m=!a&&d.jsx(Mn,{offsetY:l,count:n.count,onClick:()=>{R.logButtonClick(U.COLLAPSED_COMMENT),L.focusComment(n.children[0])}},"collapsed");else{const{comment:h}=n;if(h==null||h.content===""||h.status===be.DISMISSED)m=null;else if(h.status===be.ACCEPT_INITIATED)m=d.jsx("div",{className:"absolute",style:{top:l},children:d.jsx(le,{})},"loading");else{const{id:g}=h;m=d.jsx(wn,{isSomeCommentFocused:i,isHovered:s,isFocused:a,offsetY:l,disableActions:t,onClick:()=>{R.logButtonClick(U.EXPANDED_COMMENT),L.focusComment(g)},onMouseEnter:()=>L.mouseEnterComment(g),onMouseLeave:()=>L.mouseLeaveComment(),comment:h,onAccept:()=>{R.logButtonClick(U.COMMENT_ACCEPT,{commentId:g}),e?.(g)},onDismiss:()=>{R.logButtonClick(U.COMMENT_DISMISS,{commentId:g}),o?.(g)},opensOverDocument:r},"expanded")}}return d.jsx(F,{onExitComplete:()=>p?.(),children:f&&m})},Ve=({onMeasureHeight:e,comment:o,isFocused:t=!1})=>{const[{height:n},r]=ce();return Ue(()=>{e?.(n)},[n]),d.jsx(ht,{ref:r,comment:o,isFocused:t,disableAnimations:!0})},Rn=({comments:e,onMeasure:o,getStableCommentId:t})=>{const n=x.useRef(new Map),r=x.useRef(new Map),s=x.useRef(null),a=(i,l,u=!1)=>{l&&(u?r.current.set(t(i),l):n.current.set(t(i),l),s.current&&cancelAnimationFrame(s.current),s.current=requestAnimationFrame(()=>{o?.({focusedHeights:new Map(r.current),heights:new Map(n.current)}),s.current=null}))};return e?.length?d.jsxs("div",{className:"pointer-events-none invisible fixed left-0 top-0 overflow-clip","aria-hidden":"true",children:[e.map(i=>d.jsx(Ve,{comment:i,onMeasureHeight:l=>a(i.id,l)},t(i.id))),e.map(i=>d.jsx(Ve,{isFocused:!0,comment:i,onMeasureHeight:l=>a(i.id,l,!0)},`${t(i.id)}-focused`))]}):null},He=(e,o,t)=>{let n=t+o;for(;o===V.down?n<e.length:n>-1;){const r=e[n],s=e[n-o],a=$o(X(r),X(s),o);if(a!=null&&r.type!==O.COLLAPSED)r.shiftY+=a;else break;n+=o}},Ge=(e,o)=>{for(const t of o){const{index:n,amount:r}=t,s=e[n];s.type===O.EXPANDED&&(s.shiftY+=r),He(e,V.down,n),He(e,V.up,n);for(const a of e)a.type!==O.COLLAPSED&&(a.offsetY+=a.shiftY,a.shiftY=0)}},Dn=(e,o)=>{const t=[],[n,r]=o,s=n+r;for(let a=0;a<e.length;a++){const i=e[a],[l]=X(i),u=[l,i.type===O.EXPANDED?i.height:0],[f,p]=u;if(at(u,o)){const m=f+p,h=n-m,g=s-f,E=(Math.abs(h)<Math.abs(g)?V.up:V.down)===V.up?h:g;t.push({index:a,amount:E})}}return t},jn=({gutterMode:e,focusedCommentId:o,gutterPositions:t,getCommentKey:n,getComment:r})=>{if(!t?.size)return[];const s=new Map,a=[];let i=null,l=-1;for(const f of t.values()){if(f.type===ne.COMPOSER){i=[f.offsetY,f.height];continue}const{commentId:p,height:m,collapsedOffsetY:h,offsetY:g}=f;if(e===D.EXPANDED){const _=q(a),P=_?fe(X(_)):0;let k=g;_&&k<=P&&(k=P),s.set(p,{originalOffsetY:g,offsetY:k}),o===p&&(l=a.length),a.push({key:n(p),comment:r(p),type:O.EXPANDED,height:m,offsetY:k,shiftY:0});continue}let v=a.findIndex(({offsetY:_,type:P})=>P===O.COLLAPSED&&_===h),E=a[v]??null;if(!E)E={key:a.length,type:O.COLLAPSED,offsetY:g,count:1,children:[p]},v=a.length,a.push(E);else{if(E.type!==O.COLLAPSED)throw new Error("Collapsed parent type expected to be collapsed");E.count+=1,E.children.push(p),E.offsetY=h}o===p&&(l=v)}const u=a[l];if(e===D.COLLAPSED&&u?.type===O.COLLAPSED){const f=[];for(let p=0;p<u.children.length;p++){const m=u.children[p];m===o&&(l+=p+1);const h=q(f),g=h?fe(X(h)):0,v=t.get(m)?.offsetY??0,E=Math.max(g,v);s.set(m,{originalOffsetY:v,offsetY:E}),f.push({type:O.EXPANDED,key:n(m),comment:r(m),offsetY:E,height:t.get(m)?.height??0,shiftY:0})}a.splice(l,0,...f)}if(o){const f=s.get(o);if(!f)return a;const{offsetY:p,originalOffsetY:m}=f,h=m-p,g=[{amount:h,index:l}];let v=l+1;for(;v<a.length;){const E=a[v],{type:_}=E;let P=h;if(_===O.EXPANDED&&E.comment?.id){const{offsetY:k,originalOffsetY:b}=W(s.get(E.comment.id));if(k===b)break;P=Math.max(b-k,h)}else break;g.push({amount:P,index:v}),v++}g.length&&Ge(a,g)}else if(e!==D.COLLAPSED&&i){const f=Dn(a,i);Ge(a,f)}return a},Bn=e=>{try{return jn(e)}catch(o){return R.logError("Generating comment gutter entries",o),[]}},Vn=e=>"length"in e?e.length===0:e.nodeSize===0,de=12,Hn=({composerHeight:e,getCommentHeight:o,getCollapsedStartPos:t,commentingOn:n,commentPositions:r,view:s})=>{if(!r||!s||Vn(s.state.doc))return null;const{top:a}=s.dom.getBoundingClientRect(),i=Array.from(r.entries()).sort(([u,f],[p,m])=>f.start-m.start),l=new Map;for(const[u,{start:f}]of i)try{const p=t?.(f)??f,{top:m}=$(s,p),{top:h}=$(s,f),g=h-a,v=m-a,E=(o(u)??0)+de;l.set(u,{commentId:u,height:E,collapsedOffsetY:v,offsetY:g,type:ne.COMMENT})}catch{continue}if(n?.type===H.BLOCK){const{pos:u}=n;try{const{top:f}=$(s,u),m=f-a-de;l.set("block-composer",{type:ne.COMPOSER,height:(e??0)+de,offsetY:m})}catch{}}return l},gt=(e,o)=>o.nodeAt(e)?.isBlock?e+1:gt(e-1,o);function Gn(e){const o=Je(),n=Z()?.();if(!n)return null;if(ae(n)){if(!o)return null;const r=ut(re,o);return r?r.positions:null}return new Map(e.map(r=>[r.id,r.at]))}const Yn=({gutterMode:e,focusedCommentId:o,commentingOn:t,comments:n,getStableId:r})=>{const[{height:s},a]=ce(),i=Z(),[l,u]=x.useState(()=>new Map),[f,p]=x.useState(()=>new Map),m=x.useCallback(({focusedHeights:b,heights:T})=>{u(b),p(T)},[]),h=b=>{const T=r(b);return b===o?l.get(T)??0:f.get(T)??0},g=i(),v=g!=null&&ae(g)?b=>gt(b,g.state.doc):void 0,E=new Map(n?.map(b=>[r(b.id),b])),_=Gn(n),P=Hn({composerHeight:s,commentingOn:t,getCommentHeight:h,getCollapsedStartPos:v,commentPositions:_,view:g}),k=Bn({gutterMode:e,gutterPositions:P,focusedCommentId:o,getComment:b=>E.get(r(b))??null,getCommentKey:r});return{blockComposerRef:a,onMeasureComments:m,gutterEntries:k}};function Fn(){const o=Z()(),t=B(({commentingOn:s})=>s),r=o==null?null:Zo(o,t);return r==null?null:d.jsx(A.div,{className:"absolute",style:{top:r.loadingTop},initial:!1,animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},transition:{delay:.2},children:d.jsx(le,{})},"selection-loading")}const Un=e=>d.jsx("div",{className:"absolute",style:{top:fe(X(e))},children:d.jsx("div",{className:"h-[max(3rem,18vh)] w-1"})}),Ar=({availableWidth:e,comments:o,commentsMode:t,disableBlockComments:n=!1,isRequestActive:r=!1,isWaitingForCommentResponse:s=!1,onAddComment:a,onAcceptComment:i,onDismissComment:l,getStableCommentId:u})=>{const f=B(({focusedCommentId:N})=>N),p=B(({hoveredCommentId:N})=>N),m=B(({commentingOn:N})=>N),h=e<_e?D.COLLAPSED:D.EXPANDED,{onMeasureComments:g,blockComposerRef:v,gutterEntries:E}=Yn({comments:o,getStableId:u,gutterMode:h,focusedCommentId:f,commentingOn:m}),_=E.length>0,P=m!=null&&!s&&m.type!=="selection"||_,b=(()=>{if(!P)return 0;switch(h){case D.COLLAPSED:return 0;case D.EXPANDED:return _e}})(),T=m?.type==="selection",w=q(E);return d.jsxs(A.div,{className:M("pointer-events-none relative flex h-full flex-shrink-0",j.commentGutter,h===D.COLLAPSED&&b?"basis-[32px]":"basis-0"),initial:{width:0,opacity:0},animate:{width:b,opacity:1},exit:{width:0,opacity:0},children:[d.jsx(Rn,{getStableCommentId:u,comments:o,onMeasure:g}),d.jsxs("div",{className:M("pointer-events-auto absolute bottom-0 left-0 top-0 w-0 overflow-visible",{"pl-2":P||!n}),children:[d.jsx(F,{children:E.map(N=>{const{key:I,type:Ce}=N,Pt=!!f&&Ce===O.EXPANDED&&N.comment?.id===f,kt=!!f&&N.type===O.COLLAPSED&&N.children.includes(f);return d.jsx(In,{isGutterCollapsed:h===D.COLLAPSED,isSomeCommentFocused:!!m||!!f,isHovered:Ce===O.EXPANDED&&N.comment?.id===p,isFocused:Pt||kt,entry:N,disableActions:r||s||t===ye.COMMENTS_READONLY,onAcceptComment:K=>{try{i?.(W(o?.find(Y=>Y.id===K)))}catch(Y){R.logError(`Comment ${K} not found`,Y)}},onDismissComment:K=>{try{l?.(W(o?.find(Y=>Y.id===K)))}catch(Y){R.logError(`Comment ${K} not found`,Y)}}},I)})}),_&&w&&d.jsx(Un,{...w}),t===ye.ENABLED&&!T&&!n&&d.jsx(Sn,{composerRef:v,gutterMode:h,onAddComment:a,isWaitingForCommentResponse:s,isRequestActive:r,hasComments:_}),s&&T&&d.jsx(Fn,{})]})]})};var zn="Separator",Ye="horizontal",Xn=["horizontal","vertical"],Et=x.forwardRef((e,o)=>{const{decorative:t,orientation:n=Ye,...r}=e,s=Kn(n)?n:Ye,i=t?{role:"none"}:{"aria-orientation":s==="vertical"?s:void 0,role:"separator"};return d.jsx(se.div,{"data-orientation":s,...i,...r,ref:o})});Et.displayName=zn;function Kn(e){return Xn.includes(e)}var $n=Et,Ee="Toolbar",[Wn,wr]=It(Ee,[ze,nt]),ve=ze(),vt=nt(),[qn,xt]=Wn(Ee),Ct=x.forwardRef((e,o)=>{const{__scopeToolbar:t,orientation:n="horizontal",dir:r,loop:s=!0,...a}=e,i=ve(t),l=Rt(r);return d.jsx(qn,{scope:t,orientation:n,dir:l,children:d.jsx(Dt,{asChild:!0,...i,orientation:n,dir:l,loop:s,children:d.jsx(se.div,{role:"toolbar","aria-orientation":n,dir:l,...a,ref:o})})})});Ct.displayName=Ee;var _t="ToolbarSeparator",yt=x.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=xt(_t,t);return d.jsx($n,{orientation:r.orientation==="horizontal"?"vertical":"horizontal",...n,ref:o})});yt.displayName=_t;var Jn="ToolbarButton",xe=x.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=ve(t);return d.jsx(Xe,{asChild:!0,...r,focusable:!e.disabled,children:d.jsx(se.button,{type:"button",...n,ref:o})})});xe.displayName=Jn;var Zn="ToolbarLink",Qn=x.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=ve(t);return d.jsx(Xe,{asChild:!0,...r,focusable:!0,children:d.jsx(se.a,{...n,ref:o,onKeyDown:jt(e.onKeyDown,s=>{s.key===" "&&s.currentTarget.click()})})})});Qn.displayName=Zn;var Nt="ToolbarToggleGroup",er=x.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=xt(Nt,t),s=vt(t);return d.jsx(xo,{"data-orientation":r.orientation,dir:r.dir,...s,...n,ref:o,rovingFocus:!1})});er.displayName=Nt;var tr="ToolbarToggleItem",or=x.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=vt(t),s={__scopeToolbar:e.__scopeToolbar};return d.jsx(xe,{asChild:!0,...s,children:d.jsx(Co,{...r,...n,ref:o})})});or.displayName=tr;var nr=Ct,rr=yt,sr=(e=>(e.CODE="code",e.WRITING="writing",e))(sr||{});const Q=({children:e,toolbarType:o})=>d.jsx(nr,{className:M("m-0 flex h-10 w-fit min-w-0 flex-shrink items-center overflow-hidden rounded-xl border border-token-border-light bg-token-main-surface-primary",$e,o==="code"?"p-0":"p-1"),children:e}),bt=({icon:e,hideLabel:o,label:t})=>d.jsxs(d.Fragment,{children:[d.jsx(e,{className:M("icon-sm",{"mr-0.5 text-token-text-tertiary":!o,"text-token-text-primary":o})}),!o&&d.jsx("span",{className:"truncate text-sm text-token-text-primary",children:t})]}),Tt=Ke(xe)`flex h-full items-center gap-1 rounded-lg px-2.5 hover:bg-[#f5f5f5] disabled:opacity-50 disabled:cursor-not-allowed dark:hover:bg-token-main-surface-secondary disabled:hover:bg-transparent`,ar=({label:e,icon:o,isDisabled:t=!1,hideLabel:n=!1,onClick:r,onMouseDown:s})=>d.jsx(Tt,{onClick:r,"aria-label":n?e:void 0,onMouseDown:s,disabled:t,children:d.jsx(bt,{icon:o,hideLabel:n,label:e})}),ir=({icon:e,hideLabel:o,label:t,children:n})=>d.jsxs(to,{children:[d.jsx(oo,{asChild:!0,children:d.jsx(Tt,{"aria-label":o?t:void 0,children:d.jsx(bt,{icon:e,hideLabel:o,label:t})})}),d.jsx(no,{children:d.jsx(ro,{align:"end",className:j.toolbar,sideOffset:8,children:n})})]});Q.Separator=Ke(rr)`mx-1 p-0 list-none h-full w-[1px] bg-token-border-light`;Q.Action=ar;Q.Popover=ir;const cr=({isSendDisabled:e=!1,getSelectionRange:o})=>{const t=pe(),n=()=>{const r=o();if(r==null)return;const{from:s,to:a,sourceFrom:i,sourceTo:l}=r;if(s==null||a==null||i==null||l==null){R.logError("Missing selection range on targeted edit",r);return}const u=Ze.ASK;R.logButtonClick(U.TOOLBAR_ASK_CHATGPT,{action:u,sourceFrom:i,sourceTo:l}),L.startCommentingOn({type:H.SELECTION,from:s,to:a,sourceRange:{start:i,end:l},action:u})};return d.jsx(Q.Action,{isDisabled:e,label:t.formatMessage({id:"wOaJUU",defaultMessage:"Ask ChatGPT"}),onClick:n,icon:mo})},Ir=({getEditorDom:e,getToolbarPosition:o,getSelectionRange:t,toolbarType:n,children:r,onAddComment:s,isWaitingForCommentResponse:a=!1,isSendDisabled:i=!1})=>{const[{height:l,width:u},f]=ce(),[p,m]=x.useState(!0),[h,g]=x.useState(!1),v=e(),E=B(({commentingOn:N})=>N),[_,P]=x.useState(null),k=x.useCallback(()=>{const N=e(),I=document.getSelection();return!I||I.type!=="Range"||I.isCollapsed||!N?.contains(I.anchorNode)},[e]);x.useEffect(()=>{const N=so(()=>{g(!0)},200,{leading:!0}),I=()=>{N.cancel(),g(!1)};return v?.addEventListener("pointerdown",N,{passive:!0}),document.addEventListener("pointerup",I,{passive:!0}),()=>{v?.removeEventListener("pointerdown",N),document.removeEventListener("pointerup",I)}},[v]),x.useEffect(()=>{const N=()=>{m(k())};return document.addEventListener("selectionchange",N,{passive:!0}),()=>{document.removeEventListener("selectionchange",N)}},[k]),Ue(()=>{if(p||k())return m(!0);try{const N=o({width:u,height:l});N!=null&&P(N)}catch(N){R.logError("Invalid position in getToolbarPosition",N)}},[l,u,p,k,o]);const b=d.jsxs(Q,{toolbarType:n,children:[d.jsx(cr,{isSendDisabled:i,getSelectionRange:t}),r]}),T=!p&&!E&&_!=null,w=_o(T);return x.useEffect(()=>{!T&&w&&!E&&v?.focus()},[v,w,T,E]),d.jsxs(d.Fragment,{children:[d.jsx("div",{"aria-hidden":"true",className:"pointer-events-none invisible fixed left-0 top-0 h-0 overflow-clip",children:d.jsx("div",{ref:f,children:b})}),d.jsx(F,{children:T&&d.jsx(A.div,{initial:{opacity:0,scale:.95},animate:{opacity:h?0:1,scale:h?.95:1},style:{top:_.top,left:_.left},exit:{opacity:0,scale:.95},transition:{type:"spring",bounce:.1,duration:.1,delay:h?0:.1},className:M("absolute",j.toolbar,h?"pointer-events-none":"pointer-events-auto"),children:b})}),d.jsx(en,{toolbarPosition:_,commentingOn:E,isWaitingForCommentResponse:a,onAddComment:s})]})};function lr(e){let o=e;for(;o;){const n=window.getComputedStyle(o).overflowY;if(n==="auto"||n==="scroll")return o;o=o.parentElement}return null}function Rr(e,o){const t=Z(),n=ao(),r=t();x.useEffect(()=>{const s=r?.dom;if(!s||e.length===0)return;const a=lr(s),i=o?et(o,100):null;return a&&i&&a.addEventListener("scroll",i,{passive:!0}),()=>{i&&(a&&a.removeEventListener("scroll",i),i.cancel())}},[r,n,e,o])}let ee=null;function Dr(){if(ee!=null)return ee;if(typeof window>"u")return 0;const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.overflow="scroll",e.style.position="absolute",e.style.top="-9999px",document.body.appendChild(e);try{ee=e.offsetWidth-e.clientWidth}finally{document.body.removeChild(e)}return ee}function jr(e){return e==null?null:e.scrollHeight>e.clientHeight}export{it as A,tn as B,Ar as C,Vn as D,Q as E,z as H,G as I,an as P,un as R,Ir as T,kr as a,Pr as b,sr as c,Dr as d,J as e,So as f,Tr as g,Sr as h,jr as i,ge as j,ln as k,cn as l,bo as m,dt as n,Mr as o,mn as p,Le as q,on as r,br as s,sn as t,Rr as u,Lo as v,Or as w,Lr as x,ut as y,re as z};
//# sourceMappingURL=o3mkf48kmm3kvrf9.js.map
