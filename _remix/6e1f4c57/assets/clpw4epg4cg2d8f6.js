const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/g5q7cm2onede96p5.js","assets/ez11474bqjo66p5i.js","assets/k83stg9qxgxqphbx.js","assets/root-iasegnfe.css","assets/kek6xubepuuj5zo4.js","assets/gbe017hlo17iwb0m.js","assets/cfb41k6efc3hcj52.js","assets/conversation-small-eplmind9.css","assets/of1v8kn234dc5kme.js","assets/fvshcr5rh004dfkt.js","assets/k1bk4p15rnnsrf5e.js","assets/ex63ej6mhmullknu.js","assets/olh1s5q2rvpf5l9h.js","assets/kpcft84j7ll35bl4.js","assets/hwo7kodqj3lxfpma.js","assets/oar5stbi88jbvaxi.js","assets/b9v5nu8kwp62ny4d.js","assets/fk97hmtvzg96eice.js","assets/lg18dgo0atbqak4e.js","assets/93mewq25d542i6ru.js","assets/enx7acd1833syw5d.js","assets/chwe6p9vcuwpfmgb.js","assets/ktyeqisxi141wisd.js","assets/ljislx6zy6dritt5.js","assets/huthsd9pcqk01dx4.js","assets/cv47924y1gm82u8g.js","assets/ujoe4hp4dt0hl3e3.js","assets/d1ghvv4hur3kpsbk.js","assets/htvuy2i3y3wcvw0q.js","assets/lioi74zf3mt1oe3n.js","assets/bvaru62g35nd7y25.js","assets/sso-b2akzs8aciezgo7r.js","assets/kn1obeg2hnh64rct.js","assets/b516qx4e6wu84jnx.js","assets/fddtsh7r650zly9q.js","assets/f3epbt0htt1tphg7.js","assets/j9hhe2lpiqqddnn8.js","assets/kbqnoeh2fi37q6px.js","assets/khmsu543ybbiqo0b.js","assets/ih52932v2aj1rcgp.js","assets/jhate3y4d8nqr3l4.js","assets/eh7mbu7pytz74mg3.js","assets/ls63vuf35rqt40hm.js","assets/kqwdyvkaaavvn8k3.js","assets/mttoi88dwp487hix.js","assets/logzsiyaju81t1k4.js","assets/glpd8az4mgh1uvar.js","assets/oi0a9sw6315dzjki.js","assets/nj3xsq0v8riqsj4g.js","assets/dzz6cx6nxbx3077d.js","assets/h8jmpdaz1bs44tiy.js","assets/gnlp1viz76dxtxuc.js","assets/bacupoh71hv73vqk.js","assets/ity9qw9vge910pqo.js","assets/domdjw1365r58n4a.js","assets/h5vk0qb717grqg9h.js","assets/nhwwej1nq0zrd7sc.js","assets/bm9vuehtdeyl8zp9.js","assets/ekriqai908zppcta.js","assets/cm2trz63rske0xta.js","assets/ex6xouuwhxt5o2we.js","assets/jhnf4bie2nzsnq4v.js","assets/onyz9bw0a5ukoplo.js","assets/dvest74fzdhb46gg.js","assets/o849e7cib8jur35a.js","assets/daot3hgv93sddd1o.js","assets/isjdmfmhzv09v01t.js","assets/gpm529758t28jxxq.js","assets/eepnao0v4yiiwdi0.js","assets/fx8q6cbpmcvdz68b.js","assets/m283bmkdf0tdtvte.js","assets/c5dyakq7dtq56c7r.js","assets/j1ouiyggdmqbex9n.js","assets/dvqd8xfu6s11gzfq.js","assets/min4sqrjh35pfstp.js","assets/c09n4s3ehkxlg3hm.js","assets/gsd7cj7e2kc27i8o.js","assets/iej0cupg2dqkmejt.js","assets/jkdcq49537zl9a5b.js","assets/jk8w36bsokizpx57.js","assets/kkusiaxgbaotuwfi.js","assets/e2dgzhiasz11gccg.js","assets/dw5k18ul8cmt99oa.js","assets/hnrgzmxhzc47q6g5.js","assets/owrs7petc400glup.js","assets/f9ho0zwxp2a6s36s.js","assets/l3xl9ng95q690c1k.js","assets/jxvgntqf6a4gi5gd.js","assets/chk4xmeghtjngal8.js","assets/elf3kdtznv5vrfyd.js","assets/dnsu18zcunipx1vf.js","assets/obstmx0y5qay653b.js","assets/shared-mk6ngktc.css","assets/sso-jmjhjxeo.css","assets/7qq2lazi5qjip5hq.js","assets/bj1pr0cy739fi2qi.js"])))=>i.map(i=>d[i]);
var Co=Object.defineProperty;var Yn=t=>{throw TypeError(t)};var wo=(t,e,n)=>e in t?Co(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Z=(t,e,n)=>wo(t,typeof e!="symbol"?e+"":e,n),hn=(t,e,n)=>e.has(t)||Yn("Cannot "+n);var r=(t,e,n)=>(hn(t,e,"read from private field"),n?n.call(t):e.get(t)),V=(t,e,n)=>e.has(t)?Yn("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),E=(t,e,n,a)=>(hn(t,e,"write to private field"),a?a.call(t,n):e.set(t,n),n),j=(t,e,n)=>(hn(t,e,"access private method"),n);var Ss=(t,e,n,a)=>({set _(o){E(t,e,o,n)},get _(){return r(t,e,a)}});import{H as ze,cs as xt,j as s,N as _e,aC as Ft,en as Ln,f8 as ja,bD as Mo,r as m,aD as Aa,R as Me,ag as Us,c as se,cL as Na,a7 as jt,a4 as Ns,M as mn,I as _o,as as Rt,A as $,K as F,aM as Bs,bt as nt,ak as Oe,P as ee,e4 as ss,cm as bt,c2 as yt,aN as Gs,B as Pt,bw as ko,aU as To,fB as jo,cN as xe,cA as Ao,ax as No,cq as On,fC as Eo,L as Io,fD as Ea,e8 as Ia,c8 as it,cD as Fo,cE as Ro,cH as Qt,cF as Xn,cG as Po,J as gt,fE as Do,cK as Lo,aQ as Es,a_ as Oo,cz as Fa,O as Ke,d8 as zo,ai as qt,fk as Uo,cX as $t,ee as Is,bz as Bo,bM as re,fw as Jn,bQ as at,w as Go,fv as Ho,fF as Ra,fj as Wo,eH as Vo,u as qo,E as Pa,dk as $o,X as Ko,fG as Qo,fH as Yo,bB as Xo,cx as Jo,fI as Zo,cZ as ei,c_ as ti,c$ as si,ei as ni,fJ as ai,fK as Zn,fh as oi,bA as ii,aT as ri,bo as li}from"./ez11474bqjo66p5i.js";import{d as ns,g as ci,H as Da,c as zn,A as di,I as ui,S as hi,G as mi,z as gi,u as fi,a as pi,J as xi,m as bi,K as yi,f as vi}from"./fvshcr5rh004dfkt.js";import{G as Si,T as Ci}from"./chwe6p9vcuwpfmgb.js";import{hJ as La,cp as Un,co as Bn,cr as Gn,n as Hs,b2 as Hn,hK as wi,B as Oa,eC as ea,A as za,eG as Mi,be as _i,b1 as Xt,U as Ws,hL as ki,X as gn,bj as Ti,bI as Ua,aF as Ba,gr as Ga,hM as ji,dL as Ai,ay as Ni,hN as Ei,ab as Ii,cv as Fi,c4 as Ri,eA as Pi,u as Jt,hO as Fs,dP as Ha,eq as Di,a6 as Li,hP as Wa,dT as Rs,er as Oi,an as as,bS as zi,bQ as wn,a9 as Ui,hQ as Bi,p as _s,eE as Gi,aS as Mn,hR as Hi,hS as Wi,fU as Vi,gp as qi,s as Va,hT as qa,hU as $i,a1 as Ki,hV as Qi,v as Ps,ar as ot,bt as Ds,bY as Wn,eK as Yi,hW as Xi,eH as $a,a4 as Ji,hX as Zi,hY as er,cN as tr,G as sr,hZ as nr,h_ as ar,h$ as or,i0 as ir,i1 as rr,i2 as lr,i3 as cr,i4 as dr,ej as ta,i5 as ur,eD as hr,k as mr,l as gr,i6 as fr,eB as pr,E as xr,ae as br,cQ as yr,i7 as sa,hs as na,i8 as vr,g3 as Sr,bi as Cr,i9 as wr,eu as Mr,ev as _r,w as kr,ia as Tr,gy as aa,ib as jr,P as Ar,ic as Nr,id as Er,ie as Ir,ig as Fr,ih as Rr,ii as Pr,ij as Dr,ik as Lr}from"./cfb41k6efc3hcj52.js";import{a as Or,t as _n,T as Ka,H as zr,b as Ur,c as Br,d as Gr,e as Hr,M as ks}from"./93mewq25d542i6ru.js";import{P as Wr,v as Vr,C as kn,w as qr,l as $r,x as fn,y as Kr,u as Qr,z as pn,F as Yr,T as Xr}from"./ekriqai908zppcta.js";import{e as Jr,i as Yt,A as Qa,T as G,f as rt,g as Vs,u as qs,b as Zr,I as Ya,d as os,c as $s,J as oa,j as ia,K as el,q as Ks,a as Xa,L as tl,M as sl,N as nl,k as al,h as ol,O as il,P as rl,Q as Ja,w as Vn,s as ll,t as cl,R as dl,S as Za,U as eo,V as ul,W as hl,X as to}from"./k1bk4p15rnnsrf5e.js";import{W as ml,C as gl,G as fl,H as qn}from"./jhnf4bie2nzsnq4v.js";import{m as It}from"./ex63ej6mhmullknu.js";import{U as pl,b as Ls,bc as Qs,aI as xl,ba as bl,bP as so,bQ as no,a4 as yl,bR as vl,bS as Sl,aF as Cl,bT as wl,w as Ml,ax as ao,ay as oo,a as _l,aw as kl,av as Tl,S as jl,t as Al,bg as Nl,bK as El}from"./k83stg9qxgxqphbx.js";import{H as Il}from"./nakiygcpf16jo52w.js";import{G as Fl,L as Rl}from"./lg18dgo0atbqak4e.js";import{d as Pl,r as Dl}from"./d1ghvv4hur3kpsbk.js";import{T as Ll,u as Ol,M as io,a as zl,b as Ul,C as Bl,W as Gl}from"./o849e7cib8jur35a.js";import{b as Hl,C as Wl}from"./cv47924y1gm82u8g.js";import"./kbqnoeh2fi37q6px.js";import{D as Te,$ as ro}from"./oar5stbi88jbvaxi.js";import{a as Vl,G as ql}from"./fk97hmtvzg96eice.js";import{M as $l}from"./kkusiaxgbaotuwfi.js";import{I as Kl}from"./eh7mbu7pytz74mg3.js";import{i as Ql}from"./onyz9bw0a5ukoplo.js";function xn({label:t,tooltip:e,Icon:n}){return s.jsxs("div",{className:"flex items-center gap-1 text-sm font-semibold opacity-70",children:[n&&s.jsx(n,{className:"icon-sm"}),s.jsx("div",{children:t}),s.jsx(Hs,{label:e,children:s.jsx(Ls,{className:"icon-sm ml-1"})})]})}function Yl({clientThreadId:t,gizmoId:e}){const n=ze(),a=La(),o=Un(),i=Bn(),{data:l}=Gn(e,!1,i),c=!!e,d=xt(),h=Jr(t);return i?d&&(!h||c)?s.jsx(xn,{label:n.formatMessage(Mt.temporaryChat),tooltip:n.formatMessage(Mt.temporaryChatTooltip),Icon:pl}):a&&!o&&!d?s.jsx(xn,{label:n.formatMessage(Mt.memoryOff),tooltip:n.formatMessage(Mt.memoryOffTooltip)}):l&&(l==null?void 0:l.memoryFullPct)>=100?s.jsx(xn,{label:n.formatMessage(Mt.memoryFull),tooltip:n.formatMessage(Mt.memoryFullTooltip)}):null:null}const Mt=_e({temporaryChat:{id:"ConversationPrivacyIndicator.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatTooltip:{id:"ConversationPrivacyIndicator.temporaryChatTooltip",defaultMessage:"Temporary Chats won't appear in your history, and ChatGPT won't remember anything you talk about."},memoryOff:{id:"ConversationPrivacyIndicator.memoryOff",defaultMessage:"Memory Off"},memoryOffTooltip:{id:"ConversationPrivacyIndicator.memoryOffTooltip",defaultMessage:"ChatGPT won't remember anything you talk about in this conversation."},memoryFull:{id:"2Eq+5y",defaultMessage:"Memory Full"},memoryFullTooltip:{id:"dNA8jQ",defaultMessage:"ChatGPT's memory is full. You can forget existing memories to make space."}}),ra=4;function Xl(t){const{layer:e}=Ft("4031588851"),{layer:n}=Ln("4031588851");return t?e.get("enable_new_homepage",!1):n.get("enable_new_homepage",!1)}function Jl(){const{layer:t}=Ln("4031588851"),e=t.get("autocomplete_qualified_start_date","2099-09-13T00:00:00Z"),n=Hn();return!!n&&n.created*1e3>=new Date(e).getTime()}function Zl(t){const{layer:e}=Ft("4031588851"),{layer:n}=Ln("4031588851");return t?e.get("enable_new_autocomplete_homepage",!1):n.get("enable_new_autocomplete_homepage",!1)}function ec(t){return s.jsx(ml,{children:e=>s.jsx(tc,{...t,composerController:e})})}function tc({clientThreadId:t,currentModelId:e,onRequestCompletion:n,composerController:a}){const o=Yt(t),i=Qa(t),l=ja(),c=Mo(),[d,h]=m.useState([]),p=m.useRef(!1);wi(a);const f=Aa("589604007").value,{layer:y}=Ft("4031588851"),{promptStarters:S,isSuccess:C,isError:g}=Or(o&&!i,t,c?4:8,f,!0,e),b=!!d.find(T=>!!T.requires_file_upload),u=m.useCallback(T=>{const R=a.getCurrentText();return R&&`${T.title}${T.body}`.toLowerCase().startsWith(R.toLowerCase())},[a]),x=m.useCallback(T=>{const R=a.getCurrentText(),k=T.title+T.body;return u(T)?{...T,title:R,body:k.slice(R.length)}:{...T,title:k,body:""}},[a,u]),w=m.useCallback((T=!1)=>{h(R=>!R.some(u)&&R.length>0?[]:T?R:R.map(x))},[u,x]),v=(T,R,k)=>{const Q=`${T.title} `;h([]),a.focus(),a.setText(Q),requestAnimationFrame(()=>{const z=((S==null?void 0:S.filter(q=>q.theme===T.theme))??[]).map(q=>({...q,title:`${q.title} `,type:ea.Autocomplete}));h(z),z.length>0&&_n(z,t),Ur(T,k,t)})},A=S==null?void 0:S.reduce((T,R)=>(R.theme&&!T[R.theme]&&(T[R.theme]=R),T),{}),L=[];if(A)for(const T in A)L.push(A[T]);const N=L&&L.length>0,H=!!(C&&N),P=ra-d.filter(u).length,_=y.get("autocomplete_mode","HARDCODED"),B=m.useCallback(Oa(async T=>{const R=a.getCurrentText();if(!R||R.length<2||R.length>80){h([]);return}if(!p.current)try{const Q=(await Me.generateAutocompletions(R,T)).completions.map(z=>({id:Us(),type:ea.Autocomplete,title:R,body:z.slice(R.length),oneliner:z,prompt:z})).filter(u).map(x);h(z=>{const q=z.filter(u),te=Q.filter(ne=>!q.some(Ue=>Ue.title===ne.title&&Ue.body===ne.body)).slice(0,ra-q.length);return[...q,...te]}),Q.length>0&&_n(Q,t)}catch{}},_==="BING"?150:200),[a,_,x]),W=m.useCallback(()=>{w(),P>0&&B(P)},[B,w,P]);m.useEffect(()=>{p.current&&h([])},[p]);const D=m.useMemo(()=>_==="HARDCODED"?w:W,[_,W,w]),Y=m.useCallback(()=>{a instanceof gl&&w(!0)},[a,w]);return s.jsx(s.Fragment,{children:s.jsx(za,{children:(g||C)&&s.jsx(s.Fragment,{children:s.jsx(Ka,{isStaticSharedThread:!1,showInlineEmbeddedDisplay:!1,withVerticalPadding:!0,withHorizontalPadding:!0,clientThreadId:t,children:s.jsxs(zr,{children:[s.jsx(sc,{}),s.jsx("div",{className:"w-full",children:s.jsx(Wr,{clientThreadId:t,isNewThread:o,currentModelId:e,onRequestCompletion:n,showPromptStarters:!1,composerController:a,autocompletions:d,requiresFileUpload:b,onComposerInput:D,onComposerChange:Y,onAutocompleteSelect:(T,R,k)=>{h([R[k]])},onTaggingDropdownClose:()=>{p.current=!1},onTaggingDropdownOpen:()=>{p.current=!0},hideHeader:!0})}),H&&s.jsx(nc,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},promptStarters:L,onSelectStarterPrompt:v,isSendBlocked:l,clientThreadId:t,className:"h-8"})]})})})})})}function sc(){const{layer:t}=Ft("4031588851"),e=t.get("headline_option","HELP_WITH"),a=ze().formatMessage(e==="WHERE_TO_START"?Tn.whereShouldWeStart:Tn.whatCanIHelpWith),[o,i]=m.useState(1),[l,c]=m.useState(!0),d=20;return m.useEffect(()=>{let h;return o<a.length?h=setTimeout(()=>{i(o+1)},d):l&&(h=setTimeout(()=>{c(!1)},500)),()=>clearTimeout(h)},[a,o,l]),s.jsx("div",{className:"text-center",children:s.jsxs("div",{className:"mb-7 inline-flex justify-center text-2xl font-semibold leading-9",children:[s.jsx("h1",{children:a.substring(0,o)}),s.jsx("h1",{className:"result-streaming transition-opacity",style:{opacity:l?1:0},children:s.jsx("span",{})})]})})}function nc({promptStarters:t,onSelectStarterPrompt:e,isSendBlocked:n,clientThreadId:a,...o}){return s.jsx(It.div,{...o,children:s.jsx(rc,{starterPrompts:t,onSelectStarterPrompt:e,disabled:n,clientThreadId:a})})}const ac=/\s/;function oc({starterPrompt:t,starterPrompts:e,index:n,disabled:a,onSelectStarterPrompt:o}){const i=t.theme??t.title,l=ac.test(i);return s.jsxs("button",{className:"relative flex items-center gap-1.5 rounded-full border border-token-border-light px-3 py-2 text-start text-[13px] shadow-xxs transition enabled:hover:bg-token-main-surface-secondary disabled:cursor-not-allowed xl:gap-2 xl:text-[14px]",disabled:a,onClick:()=>o(t,e,n),children:[s.jsx(Mi,{starterPrompt:t,useV2Colors:!0}),s.jsx("div",{className:se("max-w-full text-balance text-gray-600 dark:text-gray-500",l?"break-word":"break-all"),children:i})]})}function la({starterPrompts:t,onSelectStarterPrompt:e,disabled:n,clientThreadId:a,children:o}){return m.useEffect(()=>{_n(t,a)},[a]),s.jsxs("ul",{className:"flex max-w-3xl flex-wrap items-stretch justify-center gap-2 xl:mx-3 xl:gap-2.5",children:[t.map((i,l)=>s.jsx(It.li,{initial:{opacity:0},animate:{opacity:1},transition:{delay:l*.03},exit:{opacity:0},children:s.jsx(oc,{starterPrompt:i,starterPrompts:t,index:l,disabled:n,onSelectStarterPrompt:e})},i.id??l)),o]})}function ic({clientThreadId:t,onClick:e}){m.useEffect(()=>{Br(t)},[t]);const n=ze();return s.jsx("button",{className:"relative flex max-w-full items-center gap-2 text-balance rounded-full border border-token-border-light px-3 py-2 text-start text-[14px] text-gray-600 shadow-xxs transition enabled:hover:bg-token-main-surface-secondary disabled:cursor-not-allowed dark:text-gray-500",onClick:()=>{Gr(t),e()},children:n.formatMessage(Tn.moreStarterPrompts)})}function rc({starterPrompts:t,onSelectStarterPrompt:e,disabled:n,clientThreadId:a}){const[o,i]=m.useState(4),l=4,c=t.slice(0,l),d=t.slice(l,o).map(h=>({...h,isAdditional:!0}));return s.jsxs("div",{className:"mt-7 flex flex-col flex-wrap gap-y-2.5",children:[s.jsx("div",{children:s.jsx(la,{starterPrompts:c,onSelectStarterPrompt:e,disabled:n,clientThreadId:a,children:t.length>o&&s.jsx(ic,{clientThreadId:a,onClick:()=>{i(t.length)}})})}),d&&d.length>0&&s.jsx(la,{starterPrompts:d,onSelectStarterPrompt:e,disabled:n,clientThreadId:a})]})}const Tn=_e({whatCanIHelpWith:{id:"SplashScreenV2.whatCanIHelpWith",defaultMessage:"What can I help with?"},whereShouldWeStart:{id:"SplashScreenV2.whereShouldWeStart",defaultMessage:"Where should we start?"},moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),_t=_e({submitRejectModeration:{id:"feedbackModal.moderationReject",defaultMessage:"Block Content"},submitAcceptModeration:{id:"feedbackModal.moderationAccept",defaultMessage:"Allow Content"},thumbsDownPlaceholder:{id:"feedbackModal.thumbsDownPlaceholder",defaultMessage:"What was the issue with the response? How could it be improved?"},copyrightContent:{id:"feedbackModal.copyrightContent",defaultMessage:"This content violates copyright law"},reportOtherContent:{id:"feedbackModal.reportOtherContent",defaultMessage:"I don't like this for some other reason (please describe)"},provideAdditionalFeedback:{id:"feedbackModal.provideAdditionalFeedback",defaultMessage:"Provide additional feedback"}});function lc({onClose:t,clientThreadId:e}){var u;const n=ze(),a=G.getTree(e),o=(u=m.useContext(Na))==null?void 0:u.serverSharedThreadId,i=G.getServerThreadId(e),l=o??i,c=m.useRef([]),d=m.useRef(""),h=m.useRef(null),p=m.useCallback(()=>{var w;const x=(w=h.current)==null?void 0:w.elements;c.current=[...x||[]].filter(v=>v.checked).map(v=>v.id).map(v=>v.replace("feedback-","")),d.current=(x==null?void 0:x["feedback-other"].value)||""},[]),f=m.useCallback((x,w)=>{if(l==null){jt.danger("Moderation NOT logged successfully! serverThreadId is null"),Ns.addError("Moderation: serverThreadId is null");return}const v=a.getMessageId(G.getThreadCurrentLeafId(e));Me.submitSharedConversationReportFeedback({message_id:v,shared_conversation_id:l,text:x,tags:w}).then(()=>{jt.success("Moderation logged successfully")}).catch(A=>{jt.danger("Moderation NOT logged successfully! Please try again"),Ns.addError(new Error("Moderation: failed to log",{cause:A}))}),t()},[a,e,t,l]),y=m.useCallback(()=>{p(),c.current.push("moderation-reject"),f(d.current,c.current)},[f,p]),S=m.useCallback(()=>{p(),c.current.push("moderation-accept"),f(d.current,c.current)},[f,p]),C=s.jsxs(s.Fragment,{children:[s.jsx(mn.Button,{title:n.formatMessage(_t.submitRejectModeration),color:"danger",onClick:y}),s.jsx(mn.Button,{title:n.formatMessage(_t.submitAcceptModeration),color:"primary",onClick:S})]}),[g,b]=m.useState([]);return m.useEffect(()=>{Me.fetchShareModerationCategories().then(x=>{const w=x.moderation_categories;b(Object.keys(w).map(v=>[v,w[v]]))})},[]),s.jsxs(_o,{isOpen:!0,onClose:t,showCloseButton:!0,size:"custom",className:"md:max-w-[672px] lg:max-w-[896px] xl:max-w-6xl",type:"success",title:n.formatMessage(_t.provideAdditionalFeedback),children:[s.jsxs("form",{ref:h,children:[s.jsx(ki,{id:"feedback-other",placeholder:n.formatMessage(_t.thumbsDownPlaceholder),rows:3,className:"mb-1 mt-4 w-full resize-none rounded-md bg-token-main-surface-primary"}),s.jsxs("div",{className:"mb-4",children:[g.map(([x,w])=>s.jsx(gn,{id:"feedback-"+x,label:w},x)),s.jsx(gn,{id:"feedback-copyright",label:n.formatMessage(_t.copyrightContent)}),s.jsx(gn,{id:"feedback-content-other",label:n.formatMessage(_t.reportOtherContent)})]})]}),s.jsx(mn.Actions,{primaryButton:C})]})}function cc({clientThreadId:t}){return _i(Xt.SharedConversationModeration)?s.jsx(lc,{onClose:()=>Ws.closeModal(Xt.SharedConversationModeration),clientThreadId:t}):null}const dc=({clientThreadId:t})=>{const e=Rt(),n=rt(t),{data:a,isLoading:o}=ns(n);if(o)return null;const i=e!=null&&e.accountUserId?a?bn.loggedInCtaGizmo:bn.loggedInCta:bn.loggedOutCta,l=e&&a?ci(a):"/";let c=$.sharedConversationLoggedOutClicked;return e&&(e!=null&&e.accountUserId)&&(e.isFree()?c=a?$.sharedConversationFreeGizmoClicked:$.sharedConversationFreeClicked:c=a?$.sharedConversationPaidGizmoClicked:$.sharedConversationPaidClicked),s.jsx("div",{className:"flex flex-col items-center gap-4",children:s.jsx(Ti,{href:l,onClickTrackingEventName:c,children:s.jsx(F,{...i,values:{name:a==null?void 0:a.gizmo.display.name}})})})},bn=_e({loggedOutCta:{id:"GizmoSharedConversationCTA.loggedOutCta",defaultMessage:"Sign up to chat"},loggedInCtaGizmo:{id:"GizmoSharedConversationCTA.loggedInCtaGizmo",defaultMessage:"Get started with {name}"},loggedInCta:{id:"GizmoSharedConversationCTA.loggedInCta",defaultMessage:"Get started with ChatGPT"}});function uc({clientThreadId:t,isModeratingThread:e,continueConversationUrl:n}){const a=Bs(),o=ze(),{layer:i}=Ft("2840731323"),l=i.get("is_continue_enabled",!1)||(a==null?void 0:a.includes("debug"));return s.jsxs("div",{className:"relative flex w-full flex-1 flex-col items-center justify-center gap-2 pt-3 empty:hidden sm:flex-row",children:[!l&&s.jsx(dc,{clientThreadId:t}),e&&s.jsx(nt,{onClick:()=>{Ws.openModal(Xt.SharedConversationModeration)},children:o.formatMessage({id:"thread.sharedConversation.moderate",defaultMessage:"Moderate conversation"})}),l&&n&&s.jsx(nt,{color:"primary",as:"link",to:n,size:"giant",onClick:()=>{Oe.logEvent("chatgpt_continue_shared_conversation_click"),ee.logEvent($.sharedConversationContinueConversationClicked)},children:o.formatMessage({id:"thread.sharedConversation.continue",defaultMessage:"Continue this conversation"})})]})}function hc({children:t}){const e=Ua(Ba.AG8PqS2q),{eligible:n,isLoading:a}=Pl(),{doesUserHaveAnyAccountsWithPlusFeatures:o}=ss(),i=n&&!a;if(m.useEffect(()=>{i&&ee.logEvent($.gpt4oNUXTooltipShown)},[i]),!i)return s.jsx(s.Fragment,{children:t});const l=()=>{ee.logEvent($.gpt4oNUXTooltipDismissed),e.markAsViewed()};return s.jsx(Ga,{side:"bottom",show:!0,title:s.jsx(F,{...yn.title,values:{modelName:"GPT‑4o"}}),onDismiss:l,sideOffset:0,theme:"default",description:s.jsx(F,{...o?yn.bodyPaidFinal:yn.bodyFreeFinal,values:{modelName:"GPT‑4o",anotherModelName:"GPT‑4"}}),children:t})}const yn=_e({title:{id:"1kewDD",defaultMessage:"Introducing {modelName}"},bodyPaidFinal:{id:"Z6KHqN",defaultMessage:"You can now try our newest model, {modelName}. It’s faster than {anotherModelName}, better at understanding images, and speaks more languages."},bodyFreeFinal:{id:"w8Y79o",defaultMessage:"You now have limited access to our latest model, {modelName}. It’s smarter, understands images, can browse the web, and speaks more languages."}}),mc=bt(()=>yt(()=>import("./g5q7cm2onede96p5.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30])).then(t=>t.GizmoUsingAsOwnerNotice)),gc=({clientThreadId:t})=>{const e=Ii(d=>d.activeStageSidebar),n=G.getServerThreadId(t),a=Fi(Gs.WorkspaceShareLinks),{isUnauthenticated:o}=Pt(),i=xt(),l=a&&n&&!o&&!i,c=!e;return s.jsx("div",{className:"flex items-center gap-2 pr-1 leading-[0]",children:s.jsx(Wl,{showShareButton:l,showProfileDropdown:c,clientThreadId:t})})};function fc({clientThreadId:t,gizmoId:e}){var i;const n=ji(),{data:a}=ns(e),o=Rt();return s.jsxs(s.Fragment,{children:[s.jsxs(Ai,{className:"max-md:hidden",children:[s.jsxs("div",{className:"absolute start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2",children:[a!=null&&(o==null?void 0:o.isWorkspaceAccount())&&((i=a.gizmo.tags)==null?void 0:i.includes(Ni.WorkspaceDisabled))&&s.jsx(mc,{gizmo:a}),s.jsx(Yl,{gizmoId:e,clientThreadId:t})]}),s.jsx(hc,{children:s.jsxs("div",{className:"flex items-center gap-0 overflow-hidden",children:[s.jsx(Hl,{clientThreadId:t}),s.jsx(Ll,{clientThreadId:t})]})}),s.jsx(gc,{clientThreadId:t})]}),n&&s.jsx(Ei,{})]})}function lo({clientThreadId:t}){const e=rt(t);return Vs()?null:s.jsx(fc,{gizmoId:e,clientThreadId:t})}function pc({clientThreadId:t,currentModelId:e,onRequestCompletion:n,enableV2Homepage:a}){const o=xt();let i=s.jsx(Rl,{}),l;return o?(l=s.jsx(xc,{}),i=s.jsx(To,{className:"mb-6 h-12 w-12"})):t!=null?(l=a?s.jsx(ec,{clientThreadId:t,currentModelId:e,onRequestCompletion:n}):s.jsx(Hr,{clientThreadId:t}),i=null):l=s.jsx(bc,{}),s.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-token-text-primary",children:[i,l]})}function xc({gizmo:t}){const e=La(),n=t?fl(t.tools):!1,a=Rt();return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"mb-5 text-2xl font-semibold",children:s.jsx(F,{...ht.temporaryChat})}),s.jsxs("div",{className:"max-w-sm text-center text-sm font-normal text-token-text-tertiary",children:[s.jsx(F,{...a!=null&&a.isWorkspaceAccount()?e?ht.temporaryChatBizMemoryAvailable:ht.temporaryChatBizMemoryUnavailable:e?ht.temporaryChatDescriptionMemoryAvailable:ht.temporaryChatDescriptionMemoryUnavailable}),n&&s.jsx("div",{className:"mt-3",children:s.jsx(F,{...ht.temporaryChatDescriptionGptActions,values:{link:o=>s.jsx("a",{href:"https://help.openai.com/en/articles/8914046-temporary-chat-faq",target:"_blank",className:"underline",rel:"noreferrer",children:o})}})})]})]})}function bc(){return s.jsx("div",{className:"mb-5 text-2xl font-semibold",children:s.jsx(F,{...ht.howCanIHelpYouToday})})}function yc({clientThreadId:t,currentModelId:e,onRequestCompletion:n,enableV2Homepage:a}){const o=rt(t),i=Ri(),l=ja(),{data:c}=ns(o),d=Pi(),h=ko(()=>navigator.windowControlsOverlay);return(i!=null||o!=null)&&c==null?null:s.jsxs("div",{className:"relative h-full",children:[s.jsx("div",{className:h!=null&&h.visible?se("absolute right-[calc(100dvw-env(titlebar-area-width,100dvw)-env(titlebar-area-x,0))]",d?"left-[env(titlebar-area-x,0)]":"left-0"):"absolute left-0 right-0",children:s.jsx(lo,{clientThreadId:t})}),c!=null?s.jsx(Fl,{gizmo:c,showStarterPrompts:!0,disableStarterPrompts:l}):s.jsx(pc,{clientThreadId:t,currentModelId:e,onRequestCompletion:n,enableV2Homepage:a})]})}const ht=_e({temporaryChat:{id:"GizmoLanding.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatBizMemoryAvailable:{id:"g1opBW",defaultMessage:"This chat won't appear in your history and won't use or create memories."},temporaryChatBizMemoryUnavailable:{id:"fQmbtG",defaultMessage:"This chat won't appear your conversation history."},temporaryChatDescriptionMemoryAvailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryAvailable",defaultMessage:"This chat won't appear in history, use or create memories, or be used to train our models. For safety purposes, we may keep a copy for up to 30 days."},temporaryChatDescriptionMemoryUnavailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryUnavailable",defaultMessage:"This chat won't appear in history or be used to train our models. For safety purposes, we may keep a copy of this chat for up to 30 days."},temporaryChatDescriptionGptActions:{id:"GizmoLanding.temporaryChatDescriptionGptActions",defaultMessage:"Any data shared with a third party through GPT actions are subject to the third party's privacy policy. <link>Learn more</link>"},howCanIHelpYouToday:{id:"GizmoLanding.howCanIHelpYouToday",defaultMessage:"How can I help you today?"}});function co(t){const n=qs(t)==="root",a=Zr(t),o=Jt(a),{serviceStatus:i}=m.useContext(jo),l=Fs(),{isUnauthenticated:c}=Pt(),d=Ya(t);return!n&&!o&&!(i!=null&&i.oof)&&!l.displayingSideBySideFeedback&&!c&&!d}const uo=({clientThreadId:t,message:e})=>{var x,w,v,A,L,N,H,P;const n=Ol(),a=Da(),o=Ua(Ba.ModelSwitcherAutoDowngrade),{categories:i}=zn({isRegen:!0}),l=di({clientThreadId:t}),{doesUserHaveAnyAccountsWithPlusFeatures:c}=ss(),d=ui()!=null,h=[];for(const _ of i){if(Ha(_))continue;const{defaultModel:B,label:W,tagline:D,categoryId:Y,subscriptionLevel:T,subcategory:R}=_,k=(w=(x=l[B])==null?void 0:x.regenerate)==null?void 0:w[0];h.push({label:W,value:B,subtitle:D,icon:s.jsx(io,{className:"icon-md h-4 w-4",categoryId:Y,type:"filled"}),modelSwitcherDeny:k,subscriptionLevel:T,subcategory:R})}const p=vc(t,e.nodeId),f=(v=e.message.metadata)==null?void 0:v.model_slug,y=(A=n.find(_=>_.value===f))==null?void 0:A.name,S=f!=null?a[f]:void 0,C=(S==null?void 0:S.enabledTools)||[],g=Sc(d,p,f),b=(L=e.message.metadata)==null?void 0:L.model_adjustments,u=c&&o.eligible&&!o.isLoading&&y&&((N=h[0])==null?void 0:N.label)&&y!==((H=h[0])==null?void 0:H.label)&&(b==null?void 0:b.some(_=>_.startsWith("auto:smaller_model")));return{modelOptions:h,modelSlug:f,messageModelEnabledTools:C,animateModelLabelOnRender:g,nuxProps:{shouldRenderNux:u,usedModelName:y,largestModelName:(P=h[0])==null?void 0:P.label,announcement:o}}};function vc(t,e){var l,c;return(c=(l=G.getTree(t).getConversationTurns(e).flatMap(d=>d.messages).filter(d=>d.message.author.role===xe.Assistant&&!Ao(d.message)).reverse()[1])==null?void 0:l.message.metadata)==null?void 0:c.model_slug}function Sc(t,e,n){return t&&!e?!0:!!(e&&n!==e)}function Cc(){const{doesUserHaveAnyAccountsWithPlusFeatures:t}=ss(),{categories:e}=zn();return!!t||!!e.find(Ha)}const Tt=({modelSwitcherDeny:t,value:e,label:n,subtitle:a,icon:o,onMouseEnter:i,onMouseLeave:l,onSelect:c,messageModelSlug:d,isHovered:h=!1,shouldShowUpsell:p=!1,className:f,includeCheck:y,includeRegenerate:S,justifyIcon:C,wrapIcon:g=!0})=>{const b=Rt(),u=!t,x=!u&&!p,w=No(),v=()=>{if(!p){c==null||c();return}ee.logEvent($.openModalAccountPaymentfromMessageModelPicker),ee.logRateLimitGetPlusButtonClicked({type:On.RATE_LIMIT,location:"message_model_switcher_dropdown",plan_type:(b==null?void 0:b.planType)??"unknown",is_hard_block:!1,hard_block_reason:"",is_new_conversation:!1}),Li(w,"Message model switcher dropdown")};return s.jsx(Te.Item,{onSelect:v,onMouseEnter:()=>u&&(i==null?void 0:i()),onMouseLeave:()=>u&&(l==null?void 0:l()),disabled:x,className:f??"radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed radix-disabled:hover:bg-transparent",children:s.jsxs(Hs,{label:t&&s.jsx(Di,{modelSwitcherDeny:t}),className:"flex w-full items-center justify-between gap-2",sideOffset:0,children:[s.jsxs("div",{className:se("flex items-center gap-3",C==="right"&&"w-full"),children:[!!o&&(g?s.jsx("span",{className:se("flex h-7 w-7 items-center justify-center rounded-full bg-token-main-surface-secondary",C==="right"&&"order-10 ml-auto"),children:o}):o),s.jsxs("div",{children:[s.jsx("div",{children:n}),s.jsx("div",{className:se({"text-sm text-token-text-secondary":!x},{"text-sm text-token-text-quaternary":x}),children:a})]})]}),p?s.jsx(nt,{color:"secondary",size:"small",children:s.jsx(F,{id:"54fmrA",defaultMessage:"Get Plus"})}):s.jsx(wc,{messageModelSlug:d,isHovered:h,modelSwitcherDeny:t,optionModelSlug:e,includeCheck:y,includeRegenerate:S})]})})},wc=({modelSwitcherDeny:t,optionModelSlug:e,isHovered:n,messageModelSlug:a,includeRegenerate:o=!0,includeCheck:i=!0})=>{let l=null;if(t)switch(t.reason){case On.RATE_LIMIT:l=bl;break;default:l=Ls;break}if(t)return s.jsx(l,{className:"icon-md"});const c=!!o&&s.jsx(Qs,{className:se("icon-md hidden text-token-text-tertiary",{"group-hover:block":n})});return a===e&&i?s.jsxs(s.Fragment,{children:[s.jsx(xl,{className:se("icon-md text-token-text-primary",{"group-hover:hidden":n})}),c]}):c};function Mc({className:t,clientThreadId:e,message:n,onModelSelect:a,onDropdownChange:o}){var R;const i=ze(),[l,c]=m.useState(null),[d,h]=m.useState(!1),[p,f]=m.useState(!1),y=Cc(),S=co(e),C=rt(e),g=uo({clientThreadId:e,message:n}),b=(R=n.message.metadata)==null?void 0:R.model_slug,{modelOptions:u,modelSlug:x,animateModelLabelOnRender:w,nuxProps:v,messageModelEnabledTools:A}=g,L=Wa(n.message),N=A.includes(Rs.Search),H=m.useMemo(()=>u.find(k=>k.value==b),[u,b]),{doesUserHaveAnyAccountsWithPlusFeatures:P}=ss(),_=m.useRef(null),B=k=>{k||setTimeout(()=>{_.current&&_.current.blur()},10)};if(m.useEffect(()=>{B(d)},[d]),!y||C)return null;const W=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:i.formatMessage(ca.search),icon:s.jsx(so,{className:"icon-sm"}),condition:N&&!L},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:i.formatMessage(ca.nosearch),icon:s.jsx(no,{className:"icon-sm"}),condition:N&&L}];let D,Y;v.shouldRenderNux?(D=kc,Y={title:s.jsx(F,{id:"g/+2Hh",defaultMessage:"Optimized your response"}),description:s.jsx(F,{id:"H0Flqm",defaultMessage:"Used {usedModelName} for a faster response that saves your limited {largestModelName} messages",values:{usedModelName:v.usedModelName,largestModelName:v.largestModelName}}),markAsViewed:v.announcement.markAsViewed}):(D=_c,Y={label:S?s.jsx(F,{id:"LBYK9a",defaultMessage:"Change model"}):s.jsx(F,{id:"nygjPN",defaultMessage:"Used {modelName}",values:{modelName:v.usedModelName}})});const T=S&&u.some(k=>Zt(k,P));return s.jsxs(Te.Root,{onOpenChange:k=>{S&&(h(k),o(k),B(k)),k&&ee.logEvent($.conversationOpenMessageModelSelector,{has_get_plus_button:T})},children:[s.jsx(D,{...Y,children:s.jsx(ro,{ref:_,className:se("cursor-pointer",t),onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:s.jsx(jn,{modelSlug:x,animateModelLabelOnRender:w,isDropdownOpen:d,isRegenerateEnabled:S,isHovered:p})})}),S&&s.jsxs(Te.Content,{className:"z-30 origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[u.map(k=>{var te;const Q=Zt(k,P),{value:z,...q}=k;return s.jsx(Tt,{value:z,onSelect:()=>a({requestedModelId:z}),onMouseEnter:()=>c(z),onMouseLeave:()=>c(null),isHovered:l===z,messageModelSlug:(te=n.message.metadata)==null?void 0:te.model_slug,shouldShowUpsell:Q,...q},z)}),!!H&&s.jsxs(s.Fragment,{children:[s.jsx(Te.Separator,{}),W.filter(k=>k.condition).map(k=>s.jsx(Tt,{onSelect:()=>a({requestedModelId:H.value,extraStreamParams:k.extraStreamParams}),includeRegenerate:!0,onMouseEnter:()=>c(k.key),onMouseLeave:()=>c(null),isHovered:l===k.key,messageModelSlug:b,includeCheck:!1,...H,label:k.label,subtitle:"",icon:k.icon},k.key))]})]})]})}function jn({modelSlug:t,animateModelLabelOnRender:e,isDropdownOpen:n,isRegenerateEnabled:a,isHovered:o,isRegenLabel:i=!1,animateShortLabel:l,omitIcon:c}){const[d,h]=m.useState("initial"),{categories:p}=zn({isRegen:!!i});m.useEffect(()=>{if(e){const u=setTimeout(()=>h("show"),500),x=setTimeout(()=>h("initial"),2e3);return()=>{clearTimeout(u),clearTimeout(x)}}h("initial")},[e]);const f=p.find(({defaultModel:u})=>u===t),y=t===hi?{categoryId:"gpt_3.5",shorterLabel:"3.5"}:{},{categoryId:S,shorterLabel:C}=f??y,g={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},b=n?"visible":o?"show":d;return s.jsxs(It.div,{initial:"initial",animate:b,className:"flex items-center pb-0",children:[!c&&(i?s.jsx(Qs,{className:"icon-md"}):S&&s.jsx(io,{type:"outline",categoryId:S,className:"icon-md h-4 w-4"})),(a||l)&&s.jsx(It.span,{className:"overflow-hidden text-clip whitespace-nowrap text-sm",variants:g,transition:{type:"tween",duration:.18},children:C}),a&&s.jsx(yl,{className:se("icon-sm",{"text-token-text-quaternary":!o&&!i},{"text-token-text-secondary":o&&!i})})]})}function _c({children:t,label:e}){return s.jsx(Hs,{label:e,sideOffset:0,children:t})}function kc({children:t,title:e,description:n,markAsViewed:a}){return s.jsx(Ga,{show:!0,side:"bottom",sideOffset:-4,title:e,description:n,badge:"beta",onDismiss:a,dismissOnOutsideClick:!0,children:t})}function Zt(t,e){const{modelSwitcherDeny:n,subscriptionLevel:a}=t;return!!n&&n.reason===On.RATE_LIMIT&&a===Eo.PLUS&&!e}const ca=_e({search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Tc=m.memo(Mc),da=Io.IndepthFeedbackDismissedAt;function jc(){const[t,e]=m.useState(()=>{const a=localStorage.getItem(da);return a?Ac(new Date(a)):!1}),n=m.useCallback(()=>{e(!0),localStorage.setItem(da,new Date().toISOString())},[]);return[t,n]}function Ac(t){const e=new Date;return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}function Nc({clientThreadId:t,conversationLeafId:e,trigger:n,variantIds:a}){const o=a.find(p=>p!==e),i=as(p=>p.forceIndepthFeedback&&p.forceIndepthFeedbackPrompt),l=Oe.getExperimentValue({experimentName:"4146182738",key:n==="paragen"?"enable_indepth_feedback_paragen":"enable_indepth_feedback_thumbsdown",defaultValue:!1,shouldLogExposure:!1}),c=Oe.getExperimentValue({experimentName:"4146182738",key:n==="paragen"?"indepth_feedback_paragen_prompt":"indepth_feedback_thumbsdown_prompt",defaultValue:"",shouldLogExposure:!1}),d=o?G.getTree(t).getTextFromNode(o):"NONE";return(i||(l?c:"")).replace("{paragen_losing_response}",d)}function Ec({clientThreadId:t,conversationLeafId:e,trigger:n,variantIds:a}){const[o,i]=jc(),l=Fc({clientThreadId:t}),c=Nc({clientThreadId:t,conversationLeafId:e,trigger:n,variantIds:a}),d=()=>{i(),ee.logEventWithStatsig($.messageIndepthFeedbackDeclined,"chatgpt_indepth_feedback_declined",{trigger:n})},h=()=>{const p=new wn;l(e,{intent:"indepth_feedback"},c,p),ee.logEventWithStatsig($.messageIndepthFeedbackAccepted,"chatgpt_indepth_feedback_accepted",{trigger:n})};return o||!c?null:s.jsx(zi,{content:s.jsx(F,{...vn.indepthFeedbackPrompt}),primaryCtaText:s.jsx(F,{...vn.indepthFeedbackAcceptButton}),onPrimaryCtaClick:h,secondaryCtaText:s.jsx(F,{...vn.indepthFeedbackRejectButton}),onSecondaryCtaClick:d})}function Ic(t){const e=t.rating==="thumbsDown"?"thumbsDown":Oi(["original","new"],t.inlineComparisonRating)?"paragen":void 0,n=as(o=>o.forceIndepthFeedback);if(!e||n||e==="paragen"||Oe.getExperimentValue({experimentName:"4146182738",key:"enable_indepth_feedback_thumbsdown",defaultValue:!1,shouldLogExposure:!0}))return e}function Fc({clientThreadId:t}){const e=m.useContext(Ea),n=os.getConversationMode(t);return(o,i,l,c)=>{e({type:Ia.Next,promptId:o,eventMetadata:i,focusOnNewCompletion:!0,cancelActiveRequests:!1,completionMetadata:{conversationMode:n},useDefaultModel:!1,appendMessages:[{id:Us(),author:{role:xe.System},content:{content_type:it.Text,parts:[l]},metadata:{is_indepth_feedback:!0,indepth_feedback_prompt:l}}],turnTracker:c})}}const vn=_e({indepthFeedbackPrompt:{id:"qEHwDx",defaultMessage:"Would you like to tell ChatGPT more about your feedback, so it can improve its responses?"},indepthFeedbackAcceptButton:{id:"IeyTQ7",defaultMessage:"Continue"},indepthFeedbackRejectButton:{id:"+o5xmp",defaultMessage:"Not now"},indepthFeedbackRejectAlwaysButton:{id:"Qdko+f",defaultMessage:"Don't ask again"}});function Rc({clientThreadId:t,conversationMode:e}){const n=Vr(t);return({id:o,eventMetadata:i,turnTracker:l,requestedModelId:c,systemMessage:d,juice:h,extraStreamParams:p})=>{const y=G.getTree(t).getConversationTurns(o),S=y==null?void 0:y[(y==null?void 0:y.length)-1].variantIds,C=(S==null?void 0:S.length)===1&&(p==null?void 0:p.forceUseSearch)===void 0,g=C?{...i,intent:"comparison_implicit"}:i;n({id:o,requestedModelId:c,eventMetadata:g,focusOnNewCompletion:!0,variantPurpose:C?"comparison_implicit":"none",conversationMode:e??os.getConversationMode(t),useDefaultModel:!1,appendMessages:d?[{id:Us(),author:{role:xe.System},content:{content_type:it.Text,parts:[d]},metadata:{exclude_after_next_user_message:!0}}]:void 0,juice:h,turnTracker:l,extraStreamParams:p})}}const kt=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,ho=new Set,An=typeof process=="object"&&process?process:{},mo=(t,e,n,a)=>{typeof An.emitWarning=="function"?An.emitWarning(t,e,n,a):console.error(`[${n}] ${e}: ${t}`)};let Os=globalThis.AbortController,ua=globalThis.AbortSignal;var _a;if(typeof Os>"u"){ua=class{constructor(){Z(this,"onabort");Z(this,"_onabort",[]);Z(this,"reason");Z(this,"aborted",!1)}addEventListener(a,o){this._onabort.push(o)}},Os=class{constructor(){Z(this,"signal",new ua);e()}abort(a){var o,i;if(!this.signal.aborted){this.signal.reason=a,this.signal.aborted=!0;for(const l of this.signal._onabort)l(a);(i=(o=this.signal).onabort)==null||i.call(o,a)}}};let t=((_a=An.env)==null?void 0:_a.LRU_CACHE_IGNORE_AC_WARNING)!=="1";const e=()=>{t&&(t=!1,mo("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}const Pc=t=>!ho.has(t),Ze=t=>t&&t===Math.floor(t)&&t>0&&isFinite(t),go=t=>Ze(t)?t<=Math.pow(2,8)?Uint8Array:t<=Math.pow(2,16)?Uint16Array:t<=Math.pow(2,32)?Uint32Array:t<=Number.MAX_SAFE_INTEGER?Ts:null:null;class Ts extends Array{constructor(e){super(e),this.fill(0)}}var At;const mt=class mt{constructor(e,n){Z(this,"heap");Z(this,"length");if(!r(mt,At))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new n(e),this.length=0}static create(e){const n=go(e);if(!n)return[];E(mt,At,!0);const a=new mt(e,n);return E(mt,At,!1),a}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}};At=new WeakMap,V(mt,At,!1);let Nn=mt;var ka,Ta,Ne,ve,Ee,Ie,Nt,ie,Fe,oe,J,I,fe,Se,ge,de,Re,ue,Pe,De,Ce,Le,st,pe,M,In,ft,qe,es,we,fo,pt,Et,ts,et,tt,Fn,js,As,X,Rn,Kt;const Qn=class Qn{constructor(e){V(this,M);V(this,Ne);V(this,ve);V(this,Ee);V(this,Ie);V(this,Nt);Z(this,"ttl");Z(this,"ttlResolution");Z(this,"ttlAutopurge");Z(this,"updateAgeOnGet");Z(this,"updateAgeOnHas");Z(this,"allowStale");Z(this,"noDisposeOnSet");Z(this,"noUpdateTTL");Z(this,"maxEntrySize");Z(this,"sizeCalculation");Z(this,"noDeleteOnFetchRejection");Z(this,"noDeleteOnStaleGet");Z(this,"allowStaleOnFetchAbort");Z(this,"allowStaleOnFetchRejection");Z(this,"ignoreFetchAbort");V(this,ie);V(this,Fe);V(this,oe);V(this,J);V(this,I);V(this,fe);V(this,Se);V(this,ge);V(this,de);V(this,Re);V(this,ue);V(this,Pe);V(this,De);V(this,Ce);V(this,Le);V(this,st);V(this,pe);V(this,ft,()=>{});V(this,qe,()=>{});V(this,es,()=>{});V(this,we,()=>!1);V(this,pt,e=>{});V(this,Et,(e,n,a)=>{});V(this,ts,(e,n,a,o)=>{if(a||o)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0});Z(this,ka,"LRUCache");const{max:n=0,ttl:a,ttlResolution:o=1,ttlAutopurge:i,updateAgeOnGet:l,updateAgeOnHas:c,allowStale:d,dispose:h,disposeAfter:p,noDisposeOnSet:f,noUpdateTTL:y,maxSize:S=0,maxEntrySize:C=0,sizeCalculation:g,fetchMethod:b,noDeleteOnFetchRejection:u,noDeleteOnStaleGet:x,allowStaleOnFetchRejection:w,allowStaleOnFetchAbort:v,ignoreFetchAbort:A}=e;if(n!==0&&!Ze(n))throw new TypeError("max option must be a nonnegative integer");const L=n?go(n):Array;if(!L)throw new Error("invalid max value: "+n);if(E(this,Ne,n),E(this,ve,S),this.maxEntrySize=C||r(this,ve),this.sizeCalculation=g,this.sizeCalculation){if(!r(this,ve)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(b!==void 0&&typeof b!="function")throw new TypeError("fetchMethod must be a function if specified");if(E(this,Nt,b),E(this,st,!!b),E(this,oe,new Map),E(this,J,new Array(n).fill(void 0)),E(this,I,new Array(n).fill(void 0)),E(this,fe,new L(n)),E(this,Se,new L(n)),E(this,ge,0),E(this,de,0),E(this,Re,Nn.create(n)),E(this,ie,0),E(this,Fe,0),typeof h=="function"&&E(this,Ee,h),typeof p=="function"?(E(this,Ie,p),E(this,ue,[])):(E(this,Ie,void 0),E(this,ue,void 0)),E(this,Le,!!r(this,Ee)),E(this,pe,!!r(this,Ie)),this.noDisposeOnSet=!!f,this.noUpdateTTL=!!y,this.noDeleteOnFetchRejection=!!u,this.allowStaleOnFetchRejection=!!w,this.allowStaleOnFetchAbort=!!v,this.ignoreFetchAbort=!!A,this.maxEntrySize!==0){if(r(this,ve)!==0&&!Ze(r(this,ve)))throw new TypeError("maxSize must be a positive integer if specified");if(!Ze(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");j(this,M,fo).call(this)}if(this.allowStale=!!d,this.noDeleteOnStaleGet=!!x,this.updateAgeOnGet=!!l,this.updateAgeOnHas=!!c,this.ttlResolution=Ze(o)||o===0?o:1,this.ttlAutopurge=!!i,this.ttl=a||0,this.ttl){if(!Ze(this.ttl))throw new TypeError("ttl must be a positive integer if specified");j(this,M,In).call(this)}if(r(this,Ne)===0&&this.ttl===0&&r(this,ve)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!r(this,Ne)&&!r(this,ve)){const N="LRU_CACHE_UNBOUNDED";Pc(N)&&(ho.add(N),mo("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",N,Qn))}}static unsafeExposeInternals(e){return{starts:r(e,De),ttls:r(e,Ce),sizes:r(e,Pe),keyMap:r(e,oe),keyList:r(e,J),valList:r(e,I),next:r(e,fe),prev:r(e,Se),get head(){return r(e,ge)},get tail(){return r(e,de)},free:r(e,Re),isBackgroundFetch:n=>{var a;return j(a=e,M,X).call(a,n)},backgroundFetch:(n,a,o,i)=>{var l;return j(l=e,M,As).call(l,n,a,o,i)},moveToTail:n=>{var a;return j(a=e,M,Kt).call(a,n)},indexes:n=>{var a;return j(a=e,M,et).call(a,n)},rindexes:n=>{var a;return j(a=e,M,tt).call(a,n)},isStale:n=>{var a;return r(a=e,we).call(a,n)}}}get max(){return r(this,Ne)}get maxSize(){return r(this,ve)}get calculatedSize(){return r(this,Fe)}get size(){return r(this,ie)}get fetchMethod(){return r(this,Nt)}get dispose(){return r(this,Ee)}get disposeAfter(){return r(this,Ie)}getRemainingTTL(e){return r(this,oe).has(e)?1/0:0}*entries(){for(const e of j(this,M,et).call(this))r(this,I)[e]!==void 0&&r(this,J)[e]!==void 0&&!j(this,M,X).call(this,r(this,I)[e])&&(yield[r(this,J)[e],r(this,I)[e]])}*rentries(){for(const e of j(this,M,tt).call(this))r(this,I)[e]!==void 0&&r(this,J)[e]!==void 0&&!j(this,M,X).call(this,r(this,I)[e])&&(yield[r(this,J)[e],r(this,I)[e]])}*keys(){for(const e of j(this,M,et).call(this)){const n=r(this,J)[e];n!==void 0&&!j(this,M,X).call(this,r(this,I)[e])&&(yield n)}}*rkeys(){for(const e of j(this,M,tt).call(this)){const n=r(this,J)[e];n!==void 0&&!j(this,M,X).call(this,r(this,I)[e])&&(yield n)}}*values(){for(const e of j(this,M,et).call(this))r(this,I)[e]!==void 0&&!j(this,M,X).call(this,r(this,I)[e])&&(yield r(this,I)[e])}*rvalues(){for(const e of j(this,M,tt).call(this))r(this,I)[e]!==void 0&&!j(this,M,X).call(this,r(this,I)[e])&&(yield r(this,I)[e])}[(Ta=Symbol.iterator,ka=Symbol.toStringTag,Ta)](){return this.entries()}find(e,n={}){for(const a of j(this,M,et).call(this)){const o=r(this,I)[a],i=j(this,M,X).call(this,o)?o.__staleWhileFetching:o;if(i!==void 0&&e(i,r(this,J)[a],this))return this.get(r(this,J)[a],n)}}forEach(e,n=this){for(const a of j(this,M,et).call(this)){const o=r(this,I)[a],i=j(this,M,X).call(this,o)?o.__staleWhileFetching:o;i!==void 0&&e.call(n,i,r(this,J)[a],this)}}rforEach(e,n=this){for(const a of j(this,M,tt).call(this)){const o=r(this,I)[a],i=j(this,M,X).call(this,o)?o.__staleWhileFetching:o;i!==void 0&&e.call(n,i,r(this,J)[a],this)}}purgeStale(){let e=!1;for(const n of j(this,M,tt).call(this,{allowStale:!0}))r(this,we).call(this,n)&&(this.delete(r(this,J)[n]),e=!0);return e}info(e){const n=r(this,oe).get(e);if(n===void 0)return;const a=r(this,I)[n],o=j(this,M,X).call(this,a)?a.__staleWhileFetching:a;if(o===void 0)return;const i={value:o};if(r(this,Ce)&&r(this,De)){const l=r(this,Ce)[n],c=r(this,De)[n];if(l&&c){const d=l-(kt.now()-c);i.ttl=d,i.start=Date.now()}}return r(this,Pe)&&(i.size=r(this,Pe)[n]),i}dump(){const e=[];for(const n of j(this,M,et).call(this,{allowStale:!0})){const a=r(this,J)[n],o=r(this,I)[n],i=j(this,M,X).call(this,o)?o.__staleWhileFetching:o;if(i===void 0||a===void 0)continue;const l={value:i};if(r(this,Ce)&&r(this,De)){l.ttl=r(this,Ce)[n];const c=kt.now()-r(this,De)[n];l.start=Math.floor(Date.now()-c)}r(this,Pe)&&(l.size=r(this,Pe)[n]),e.unshift([a,l])}return e}load(e){this.clear();for(const[n,a]of e){if(a.start){const o=Date.now()-a.start;a.start=kt.now()-o}this.set(n,a.value,a)}}set(e,n,a={}){var y,S,C,g,b;if(n===void 0)return this.delete(e),this;const{ttl:o=this.ttl,start:i,noDisposeOnSet:l=this.noDisposeOnSet,sizeCalculation:c=this.sizeCalculation,status:d}=a;let{noUpdateTTL:h=this.noUpdateTTL}=a;const p=r(this,ts).call(this,e,n,a.size||0,c);if(this.maxEntrySize&&p>this.maxEntrySize)return d&&(d.set="miss",d.maxEntrySizeExceeded=!0),this.delete(e),this;let f=r(this,ie)===0?void 0:r(this,oe).get(e);if(f===void 0)f=r(this,ie)===0?r(this,de):r(this,Re).length!==0?r(this,Re).pop():r(this,ie)===r(this,Ne)?j(this,M,js).call(this,!1):r(this,ie),r(this,J)[f]=e,r(this,I)[f]=n,r(this,oe).set(e,f),r(this,fe)[r(this,de)]=f,r(this,Se)[f]=r(this,de),E(this,de,f),Ss(this,ie)._++,r(this,Et).call(this,f,p,d),d&&(d.set="add"),h=!1;else{j(this,M,Kt).call(this,f);const u=r(this,I)[f];if(n!==u){if(r(this,st)&&j(this,M,X).call(this,u)){u.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:x}=u;x!==void 0&&!l&&(r(this,Le)&&((y=r(this,Ee))==null||y.call(this,x,e,"set")),r(this,pe)&&((S=r(this,ue))==null||S.push([x,e,"set"])))}else l||(r(this,Le)&&((C=r(this,Ee))==null||C.call(this,u,e,"set")),r(this,pe)&&((g=r(this,ue))==null||g.push([u,e,"set"])));if(r(this,pt).call(this,f),r(this,Et).call(this,f,p,d),r(this,I)[f]=n,d){d.set="replace";const x=u&&j(this,M,X).call(this,u)?u.__staleWhileFetching:u;x!==void 0&&(d.oldValue=x)}}else d&&(d.set="update")}if(o!==0&&!r(this,Ce)&&j(this,M,In).call(this),r(this,Ce)&&(h||r(this,es).call(this,f,o,i),d&&r(this,qe).call(this,d,f)),!l&&r(this,pe)&&r(this,ue)){const u=r(this,ue);let x;for(;x=u==null?void 0:u.shift();)(b=r(this,Ie))==null||b.call(this,...x)}return this}pop(){var e;try{for(;r(this,ie);){const n=r(this,I)[r(this,ge)];if(j(this,M,js).call(this,!0),j(this,M,X).call(this,n)){if(n.__staleWhileFetching)return n.__staleWhileFetching}else if(n!==void 0)return n}}finally{if(r(this,pe)&&r(this,ue)){const n=r(this,ue);let a;for(;a=n==null?void 0:n.shift();)(e=r(this,Ie))==null||e.call(this,...a)}}}has(e,n={}){const{updateAgeOnHas:a=this.updateAgeOnHas,status:o}=n,i=r(this,oe).get(e);if(i!==void 0){const l=r(this,I)[i];if(j(this,M,X).call(this,l)&&l.__staleWhileFetching===void 0)return!1;if(r(this,we).call(this,i))o&&(o.has="stale",r(this,qe).call(this,o,i));else return a&&r(this,ft).call(this,i),o&&(o.has="hit",r(this,qe).call(this,o,i)),!0}else o&&(o.has="miss");return!1}peek(e,n={}){const{allowStale:a=this.allowStale}=n,o=r(this,oe).get(e);if(o===void 0||!a&&r(this,we).call(this,o))return;const i=r(this,I)[o];return j(this,M,X).call(this,i)?i.__staleWhileFetching:i}async fetch(e,n={}){const{allowStale:a=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,ttl:l=this.ttl,noDisposeOnSet:c=this.noDisposeOnSet,size:d=0,sizeCalculation:h=this.sizeCalculation,noUpdateTTL:p=this.noUpdateTTL,noDeleteOnFetchRejection:f=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:y=this.allowStaleOnFetchRejection,ignoreFetchAbort:S=this.ignoreFetchAbort,allowStaleOnFetchAbort:C=this.allowStaleOnFetchAbort,context:g,forceRefresh:b=!1,status:u,signal:x}=n;if(!r(this,st))return u&&(u.fetch="get"),this.get(e,{allowStale:a,updateAgeOnGet:o,noDeleteOnStaleGet:i,status:u});const w={allowStale:a,updateAgeOnGet:o,noDeleteOnStaleGet:i,ttl:l,noDisposeOnSet:c,size:d,sizeCalculation:h,noUpdateTTL:p,noDeleteOnFetchRejection:f,allowStaleOnFetchRejection:y,allowStaleOnFetchAbort:C,ignoreFetchAbort:S,status:u,signal:x};let v=r(this,oe).get(e);if(v===void 0){u&&(u.fetch="miss");const A=j(this,M,As).call(this,e,v,w,g);return A.__returned=A}else{const A=r(this,I)[v];if(j(this,M,X).call(this,A)){const _=a&&A.__staleWhileFetching!==void 0;return u&&(u.fetch="inflight",_&&(u.returnedStale=!0)),_?A.__staleWhileFetching:A.__returned=A}const L=r(this,we).call(this,v);if(!b&&!L)return u&&(u.fetch="hit"),j(this,M,Kt).call(this,v),o&&r(this,ft).call(this,v),u&&r(this,qe).call(this,u,v),A;const N=j(this,M,As).call(this,e,v,w,g),P=N.__staleWhileFetching!==void 0&&a;return u&&(u.fetch=L?"stale":"refresh",P&&L&&(u.returnedStale=!0)),P?N.__staleWhileFetching:N.__returned=N}}get(e,n={}){const{allowStale:a=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,status:l}=n,c=r(this,oe).get(e);if(c!==void 0){const d=r(this,I)[c],h=j(this,M,X).call(this,d);return l&&r(this,qe).call(this,l,c),r(this,we).call(this,c)?(l&&(l.get="stale"),h?(l&&a&&d.__staleWhileFetching!==void 0&&(l.returnedStale=!0),a?d.__staleWhileFetching:void 0):(i||this.delete(e),l&&a&&(l.returnedStale=!0),a?d:void 0)):(l&&(l.get="hit"),h?d.__staleWhileFetching:(j(this,M,Kt).call(this,c),o&&r(this,ft).call(this,c),d))}else l&&(l.get="miss")}delete(e){var a,o,i,l;let n=!1;if(r(this,ie)!==0){const c=r(this,oe).get(e);if(c!==void 0)if(n=!0,r(this,ie)===1)this.clear();else{r(this,pt).call(this,c);const d=r(this,I)[c];if(j(this,M,X).call(this,d)?d.__abortController.abort(new Error("deleted")):(r(this,Le)||r(this,pe))&&(r(this,Le)&&((a=r(this,Ee))==null||a.call(this,d,e,"delete")),r(this,pe)&&((o=r(this,ue))==null||o.push([d,e,"delete"]))),r(this,oe).delete(e),r(this,J)[c]=void 0,r(this,I)[c]=void 0,c===r(this,de))E(this,de,r(this,Se)[c]);else if(c===r(this,ge))E(this,ge,r(this,fe)[c]);else{const h=r(this,Se)[c];r(this,fe)[h]=r(this,fe)[c];const p=r(this,fe)[c];r(this,Se)[p]=r(this,Se)[c]}Ss(this,ie)._--,r(this,Re).push(c)}}if(r(this,pe)&&((i=r(this,ue))!=null&&i.length)){const c=r(this,ue);let d;for(;d=c==null?void 0:c.shift();)(l=r(this,Ie))==null||l.call(this,...d)}return n}clear(){var e,n,a;for(const o of j(this,M,tt).call(this,{allowStale:!0})){const i=r(this,I)[o];if(j(this,M,X).call(this,i))i.__abortController.abort(new Error("deleted"));else{const l=r(this,J)[o];r(this,Le)&&((e=r(this,Ee))==null||e.call(this,i,l,"delete")),r(this,pe)&&((n=r(this,ue))==null||n.push([i,l,"delete"]))}}if(r(this,oe).clear(),r(this,I).fill(void 0),r(this,J).fill(void 0),r(this,Ce)&&r(this,De)&&(r(this,Ce).fill(0),r(this,De).fill(0)),r(this,Pe)&&r(this,Pe).fill(0),E(this,ge,0),E(this,de,0),r(this,Re).length=0,E(this,Fe,0),E(this,ie,0),r(this,pe)&&r(this,ue)){const o=r(this,ue);let i;for(;i=o==null?void 0:o.shift();)(a=r(this,Ie))==null||a.call(this,...i)}}};Ne=new WeakMap,ve=new WeakMap,Ee=new WeakMap,Ie=new WeakMap,Nt=new WeakMap,ie=new WeakMap,Fe=new WeakMap,oe=new WeakMap,J=new WeakMap,I=new WeakMap,fe=new WeakMap,Se=new WeakMap,ge=new WeakMap,de=new WeakMap,Re=new WeakMap,ue=new WeakMap,Pe=new WeakMap,De=new WeakMap,Ce=new WeakMap,Le=new WeakMap,st=new WeakMap,pe=new WeakMap,M=new WeakSet,In=function(){const e=new Ts(r(this,Ne)),n=new Ts(r(this,Ne));E(this,Ce,e),E(this,De,n),E(this,es,(i,l,c=kt.now())=>{if(n[i]=l!==0?c:0,e[i]=l,l!==0&&this.ttlAutopurge){const d=setTimeout(()=>{r(this,we).call(this,i)&&this.delete(r(this,J)[i])},l+1);d.unref&&d.unref()}}),E(this,ft,i=>{n[i]=e[i]!==0?kt.now():0}),E(this,qe,(i,l)=>{if(e[l]){const c=e[l],d=n[l];if(!c||!d)return;i.ttl=c,i.start=d,i.now=a||o();const h=i.now-d;i.remainingTTL=c-h}});let a=0;const o=()=>{const i=kt.now();if(this.ttlResolution>0){a=i;const l=setTimeout(()=>a=0,this.ttlResolution);l.unref&&l.unref()}return i};this.getRemainingTTL=i=>{const l=r(this,oe).get(i);if(l===void 0)return 0;const c=e[l],d=n[l];if(!c||!d)return 1/0;const h=(a||o())-d;return c-h},E(this,we,i=>{const l=n[i],c=e[i];return!!c&&!!l&&(a||o())-l>c})},ft=new WeakMap,qe=new WeakMap,es=new WeakMap,we=new WeakMap,fo=function(){const e=new Ts(r(this,Ne));E(this,Fe,0),E(this,Pe,e),E(this,pt,n=>{E(this,Fe,r(this,Fe)-e[n]),e[n]=0}),E(this,ts,(n,a,o,i)=>{if(j(this,M,X).call(this,a))return 0;if(!Ze(o))if(i){if(typeof i!="function")throw new TypeError("sizeCalculation must be a function");if(o=i(a,n),!Ze(o))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return o}),E(this,Et,(n,a,o)=>{if(e[n]=a,r(this,ve)){const i=r(this,ve)-e[n];for(;r(this,Fe)>i;)j(this,M,js).call(this,!0)}E(this,Fe,r(this,Fe)+e[n]),o&&(o.entrySize=a,o.totalCalculatedSize=r(this,Fe))})},pt=new WeakMap,Et=new WeakMap,ts=new WeakMap,et=function*({allowStale:e=this.allowStale}={}){if(r(this,ie))for(let n=r(this,de);!(!j(this,M,Fn).call(this,n)||((e||!r(this,we).call(this,n))&&(yield n),n===r(this,ge)));)n=r(this,Se)[n]},tt=function*({allowStale:e=this.allowStale}={}){if(r(this,ie))for(let n=r(this,ge);!(!j(this,M,Fn).call(this,n)||((e||!r(this,we).call(this,n))&&(yield n),n===r(this,de)));)n=r(this,fe)[n]},Fn=function(e){return e!==void 0&&r(this,oe).get(r(this,J)[e])===e},js=function(e){var i,l;const n=r(this,ge),a=r(this,J)[n],o=r(this,I)[n];return r(this,st)&&j(this,M,X).call(this,o)?o.__abortController.abort(new Error("evicted")):(r(this,Le)||r(this,pe))&&(r(this,Le)&&((i=r(this,Ee))==null||i.call(this,o,a,"evict")),r(this,pe)&&((l=r(this,ue))==null||l.push([o,a,"evict"]))),r(this,pt).call(this,n),e&&(r(this,J)[n]=void 0,r(this,I)[n]=void 0,r(this,Re).push(n)),r(this,ie)===1?(E(this,ge,E(this,de,0)),r(this,Re).length=0):E(this,ge,r(this,fe)[n]),r(this,oe).delete(a),Ss(this,ie)._--,n},As=function(e,n,a,o){const i=n===void 0?void 0:r(this,I)[n];if(j(this,M,X).call(this,i))return i;const l=new Os,{signal:c}=a;c==null||c.addEventListener("abort",()=>l.abort(c.reason),{signal:l.signal});const d={signal:l.signal,options:a,context:o},h=(g,b=!1)=>{const{aborted:u}=l.signal,x=a.ignoreFetchAbort&&g!==void 0;if(a.status&&(u&&!b?(a.status.fetchAborted=!0,a.status.fetchError=l.signal.reason,x&&(a.status.fetchAbortIgnored=!0)):a.status.fetchResolved=!0),u&&!x&&!b)return f(l.signal.reason);const w=S;return r(this,I)[n]===S&&(g===void 0?w.__staleWhileFetching?r(this,I)[n]=w.__staleWhileFetching:this.delete(e):(a.status&&(a.status.fetchUpdated=!0),this.set(e,g,d.options))),g},p=g=>(a.status&&(a.status.fetchRejected=!0,a.status.fetchError=g),f(g)),f=g=>{const{aborted:b}=l.signal,u=b&&a.allowStaleOnFetchAbort,x=u||a.allowStaleOnFetchRejection,w=x||a.noDeleteOnFetchRejection,v=S;if(r(this,I)[n]===S&&(!w||v.__staleWhileFetching===void 0?this.delete(e):u||(r(this,I)[n]=v.__staleWhileFetching)),x)return a.status&&v.__staleWhileFetching!==void 0&&(a.status.returnedStale=!0),v.__staleWhileFetching;if(v.__returned===v)throw g},y=(g,b)=>{var x;const u=(x=r(this,Nt))==null?void 0:x.call(this,e,i,d);u&&u instanceof Promise&&u.then(w=>g(w===void 0?void 0:w),b),l.signal.addEventListener("abort",()=>{(!a.ignoreFetchAbort||a.allowStaleOnFetchAbort)&&(g(void 0),a.allowStaleOnFetchAbort&&(g=w=>h(w,!0)))})};a.status&&(a.status.fetchDispatched=!0);const S=new Promise(y).then(h,p),C=Object.assign(S,{__abortController:l,__staleWhileFetching:i,__returned:void 0});return n===void 0?(this.set(e,C,{...d.options,status:void 0}),n=r(this,oe).get(e)):r(this,I)[n]=C,C},X=function(e){if(!r(this,st))return!1;const n=e;return!!n&&n instanceof Promise&&n.hasOwnProperty("__staleWhileFetching")&&n.__abortController instanceof Os},Rn=function(e,n){r(this,Se)[n]=e,r(this,fe)[e]=n},Kt=function(e){e!==r(this,de)&&(e===r(this,ge)?E(this,ge,r(this,fe)[e]):j(this,M,Rn).call(this,r(this,Se)[e],r(this,fe)[e]),j(this,M,Rn).call(this,r(this,de),e),E(this,de,e))};let En=Qn;function Dc({conversationId:t,messageId:e}){const[n,a]=m.useState(!1),o=m.useRef({isMediaSourceAvailable:$n(),mediaSourceFormat:Kn()??"n/a",playPromise:null,shouldAbortQueuedPlayback:!1}).current,i=ze(),{voiceName:l}=Ui(),c=`${t}.${e}.${l}`,d=Fo(),h=Ro(C=>{var g;return C.isPlaying&&C.sourceUrl===((g=ke.get(c))==null?void 0:g.src)}),p=m.useCallback(async()=>{if(!d)return;a(!0);const C={isMediaSourceAvailable:o.isMediaSourceAvailable,format:o.mediaSourceFormat};try{const g=await Lc({key:c,message_id:e,conversation_id:t,voice:l,onStreamingError:b=>{Qt.readAloud.error(b,C),a(!1),jt.danger(i.formatMessage(ha.playbackError,{error:b.message}))},onStreamingStart:()=>{a(!1)}});if(o.shouldAbortQueuedPlayback){o.shouldAbortQueuedPlayback=!1;return}d.changeSource(g),o.playPromise=d.play()}catch(g){Qt.readAloud.error(g,C),a(!1),jt.danger(i.formatMessage(ha.playbackError,{error:g.message}))}},[d,c,e,t,l,o,i]),f=m.useCallback(()=>{const C=Xn();C&&(o.playPromise?o.playPromise.then(()=>{C.stop(),o.playPromise=null}):C.stop())},[o]),y=m.useCallback(()=>{var g;const C=Xn();C&&(C.state.isPlaying&&C.state.sourceUrl===((g=ke.get(c))==null?void 0:g.src)?f():(Qt.readAloud.click({isMediaSourceAvailable:o.isMediaSourceAvailable,format:o.mediaSourceFormat}),p()))},[c,o,p,f]);m.useEffect(()=>{n&&h&&a(!1)},[n,h]);const S=m.useRef(c);return m.useEffect(()=>{S.current=c}),m.useEffect(()=>(o.shouldAbortQueuedPlayback=!1,()=>{var b;const C=Po();C.isPlaying&&C.sourceUrl===((b=ke.get(S.current))==null?void 0:b.src)?f():o.shouldAbortQueuedPlayback=!0}),[o,f]),{togglePlayback:y,isPlaying:h,isLoading:n}}async function po({message_id:t,conversation_id:e,voice:n}){const a=await Me.synthesize({message_id:t,conversation_id:e,voice:n,format:Kn()}),o=a.headers.get("content-type")??"audio/aac";return{response:a,format:o}}async function Lc(t){return $n()?zc(t):Oc(t)}async function Oc({key:t,...e}){const n=ke.get(t);if(n!=null&&n.blob)return n.src;const{response:a,format:o}=await po(e),i=await a.arrayBuffer(),l=new Blob([i],{type:o}),c=xo({key:t,src:URL.createObjectURL(l),format:o,blob:l});return ke.set(t,c),c.src}async function zc({key:t,onStreamingError:e,onStreamingStart:n,...a}){let o=ke.get(t);o!=null&&o.streaming&&(ke.delete(t),o=void 0);let i,l;const c=Bc(),d=new c;if(o)i=o,i.src=URL.createObjectURL(d);else{const{format:f,response:y}=await po(a);l=y,i=xo({key:t,src:URL.createObjectURL(d),format:f})}const h=Uc(i.id),p={sourceopen:async()=>{var S,C;h("sourceopen");const f=d.addSourceBuffer(i.format),y=async()=>{f.updating&&await new Promise(g=>f.addEventListener("updateend",g,{once:!0}))};if(i.segments.length&&!i.streaming){h("streaming from cache"),i.streaming=!0,n();for(const g of i.segments)f.appendBuffer(g),await y();d.readyState==="open"&&d.endOfStream(),i.streaming=!1,h("done streaming from cache");return}if(l){h("fetching audio");try{const g=(S=l.body)==null?void 0:S.getReader();if(!g)return;for(;((C=ke.get(t))==null?void 0:C.id)===i.id;){const{done:b,value:u}=await g.read();if(b){h("done streaming"),i.streaming=!1,d.readyState==="open"&&d.endOfStream();break}if(!Array.from(d.sourceBuffers).includes(f)){h("stop streaming, source buffer removed"),i.streaming=!1;break}i.streaming||(h("start streaming"),i.streaming=!0,n()),f.appendBuffer(u),i.segments.push(u),await y()}}catch(g){if(h("error while streaming",g),i.streaming=!1,d.readyState==="open")try{d.endOfStream("network")}catch(b){Qt.readAloud.error(b)}ke.delete(t),e(g)}}},sourceclose:()=>{var f;h("sourceclose"),i.streaming&&(i.streaming=!1,((f=ke.get(t))==null?void 0:f.id)===i.id&&(h("sourceclosed while streaming, cleaning up cache"),ke.delete(t)))},sourceended:gt};for(const[f,y]of Object.entries(p))d.addEventListener(f,()=>{try{return y()}catch(S){Qt.readAloud.error(S)}});return ke.set(t,i),i.src}const ha=_e({playbackError:{id:"useVoiceReadAloudAudio.playbackError",defaultMessage:"Failed to play message"}}),Uc=t=>gt;function Bc(){return $n()?window.MediaSource:null}function $n(){return!!Kn()}function Kn(){if("MediaSource"in window){const t=e=>Do(e)&&MediaSource.isTypeSupported(e);if(t("audio/aac"))return"aac";if(t("audio/mpeg"))return"mp3";if(t("audio/ogg"))return"ogg"}}const xo=t=>({id:Us(),segments:[],streaming:!1,...t}),ke=new En({max:50,dispose:t=>{URL.revokeObjectURL(t.src)}}),Gc=m.memo(function(e){var l;const n=(l=Es("1923022511"))==null?void 0:l.value,a=$s(e.conversationId),{errCode:o}=qn(e.message);if(!n||!a||o)return null;const i=Lo.getAudioAssetPointers(e.message.message)[0];return i?s.jsx(Hc,{audioAssetPointer:i,conversationId:a}):s.jsx(Wc,{...e,conversationId:a})});function Hc({audioAssetPointer:t,conversationId:e}){const{isLoading:n,isPlaying:a,togglePlayback:o}=Bi({audioAssetPointer:t,conversationId:e});return s.jsx(bo,{onClick:o,isPlaying:a,isLoading:n,playText:zs.replay,playIcon:vl})}function Wc({conversationId:t,message:e}){const{isLoading:n,isPlaying:a,togglePlayback:o}=Dc({conversationId:t,messageId:e.message.id});return s.jsx(bo,{onClick:o,isPlaying:a,isLoading:n,playText:zs.play,playIcon:Sl})}function bo({onClick:t,isPlaying:e,isLoading:n,playText:a,playIcon:o}){let i,l;const c=ze();return n?(i=Oo,l=zs.loading):e?(i=Cl,l=zs.stop):(i=o,l=a),s.jsx(_s,{icon:i,label:l?c.formatMessage(l):void 0,disabled:n,onClick:t,style:e||n?{visibility:"visible"}:void 0,testId:"voice-play-turn-action-button"})}const zs={replay:{id:"VoiceReadOutLoudButton.replay",defaultMessage:"Replay",description:"The tooltip for the replay button"},play:{id:"VoiceReadOutLoudButton.play",defaultMessage:"Read aloud",description:"The tooltip for the read aloud button"},stop:{id:"VoiceReadOutLoudButton.stop",defaultMessage:"Stop",description:"The tooltip for the stop button"},loading:{id:"VoiceReadOutLoudButton.loading",defaultMessage:"Loading",description:"The tooltip for the spinner"}},Vc="bg-token-main-surface-primary text-token-text-primary",qc="openai",ma=["bg-blue-300 text-white"];function $c(t){return ma[((t==null?void 0:t.charCodeAt(0))??0)%ma.length]}const Cs=({children:t})=>s.jsx("div",{className:"pt-0",children:s.jsx("div",{className:se(m.isValidElement(t)&&t.type===Mn?"gizmo-bot-avatar":"gizmo-shadow-stroke","flex h-8 w-8 items-center justify-center overflow-hidden rounded-full"),children:t})});function Pn({messages:t,isUserTurn:e,avatarClassName:n,gizmo:a,showInlineEmbeddedDisplay:o=!1}){var S;const i="medium",l=t[0],c=(S=l==null?void 0:l.message.metadata)==null?void 0:S.shared_conversation_id,d=c!=null,h=Hn(),{gizmoEditorData:p,mode:f}=Gi();let y=s.jsx(Cs,{children:s.jsx(Mn,{className:n??Vc,iconName:qc,size:i})});return a?y=s.jsx(Cs,{children:s.jsx(Vl,{gizmoId:a.gizmo.id,className:"h-full w-full"})}):p!=null&&f==="test"&&(y=s.jsx(ql,{isFirstParty:!1,src:p.profilePictureUrl,className:"h-8 w-8 first:pt-[3px]"})),s.jsx("div",{children:e?d||o?s.jsx(Cs,{children:s.jsx(Mn,{className:$c(c),iconName:"user",size:i})}):s.jsx(Cs,{children:s.jsx(Hi,{user:h,size:i})}):y})}const ws="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function Kc({className:t,clientThreadId:e,message:n,onModelSelect:a,onDropdownChange:o,canRegenerateResponse:i}){var W;const l=Aa("566128514").value,[c,d]=m.useState(null),[h,p]=m.useState(!1),[f,y]=m.useState(!1),S=rt(e),C=uo({clientThreadId:e,message:n}),g=(W=n.message.metadata)==null?void 0:W.model_slug,{modelOptions:b,modelSlug:u,animateModelLabelOnRender:x,messageModelEnabledTools:w}=C,v=Wa(n.message),A=w.includes(Rs.Search),L=m.useMemo(()=>b.find(D=>D.value===g),[b,g]),N=m.useRef(null),{doesUserHaveAnyAccountsWithPlusFeatures:H}=ss(),P=D=>{D||setTimeout(()=>{N.current&&N.current.blur()},10)};if(m.useEffect(()=>{P(h)},[h]),Ya(e))return null;const B=i&&b.some(D=>Zt(D,H));return S?null:s.jsxs(Te.Root,{onOpenChange:D=>{i&&(p(D),o(D),P(D)),D&&ee.logEvent($.conversationOpenMessageModelSelector,{has_get_plus_button:B,is_new_regen_dropdown:!0})},children:[i?s.jsx(Yc,{label:s.jsx(F,{id:"wDs5sz",defaultMessage:"Switch model"}),children:s.jsx(ro,{ref:N,className:se("cursor-pointer",t),onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1),children:s.jsx(jn,{modelSlug:u,animateModelLabelOnRender:x,isDropdownOpen:h,isRegenerateEnabled:i,isHovered:f,isRegenLabel:!0,omitIcon:!1})})}):s.jsx("button",{className:se("cursor-pointer",t),onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1),children:s.jsx(jn,{modelSlug:u,animateModelLabelOnRender:x,isDropdownOpen:!1,isRegenerateEnabled:!1,isHovered:f,omitIcon:l,animateShortLabel:!0})}),i&&s.jsxs(Te.Content,{className:"z-30 min-w-fit origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[s.jsx(Te.Item,{disabled:!0,className:"pb-0 pt-2",children:s.jsx("span",{className:"text-token-text-secondary",children:s.jsx(F,{id:"bFLh5u",defaultMessage:"Switch model"})})}),s.jsx(Qc,{onModelSelect:a,messageModelSlug:g,omitModelIcons:l,modelOptions:b,setHoveredOption:d,hoveredOption:c,retryOption:L,lastResponseUsedSearch:v,modelSupportsSearch:A,doesUserHaveAnyAccountsWithPlusFeatures:H})]})]})}function Qc({modelOptions:t,messageModelSlug:e,onModelSelect:n,omitModelIcons:a,setHoveredOption:o,hoveredOption:i,retryOption:l,lastResponseUsedSearch:c,modelSupportsSearch:d,doesUserHaveAnyAccountsWithPlusFeatures:h}){const p=ze(),[f,y]=m.useMemo(()=>Wi(t,u=>u.subcategory),[t]),S=m.useMemo(()=>{const u=new Map;return f.forEach(x=>{var v;const w=x.subcategory;w&&(u.has(w)||u.set(w,[]),(v=u.get(w))==null||v.push(x))}),u},[f]),C=se("icon-sm",a&&"order-10 ml-auto text-token-text-tertiary icon-md"),g=a?"right":"left",b=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:p.formatMessage(Sn.search),icon:s.jsx(so,{className:C}),condition:d&&!c},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:p.formatMessage(Sn.nosearch),icon:s.jsx(no,{className:C}),condition:d&&c}];return s.jsxs(s.Fragment,{children:[y.map(u=>{const{value:x,...w}=u;return s.jsx(Tt,{value:x,onSelect:()=>n({requestedModelId:x}),includeRegenerate:!1,onMouseEnter:()=>o(x),onMouseLeave:()=>o(null),isHovered:i===x,messageModelSlug:e,includeCheck:!1,shouldShowUpsell:Zt(u,h),className:ws,...w,icon:a?s.jsx("span",{className:C}):w.icon,justifyIcon:g,wrapIcon:!a},x)}),[...S.entries()].map(([u,x])=>s.jsxs(Te.Sub,{children:[s.jsx(Te.SubMenuTrigger,{children:s.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:u})}),s.jsx(Te.Portal,{children:s.jsx(Te.SubContent,{className:"min-w-fit",children:x.map(w=>{const{value:v,...A}=w;return s.jsx(Tt,{value:v,onSelect:()=>n({requestedModelId:v}),includeRegenerate:!1,onMouseEnter:()=>o(v),onMouseLeave:()=>o(null),isHovered:i===v,messageModelSlug:e,includeCheck:!1,className:ws,...A,icon:null,justifyIcon:g,wrapIcon:!a,shouldShowUpsell:Zt(w,h)},u+"-"+v)})})})]},u)),!!l&&s.jsxs(s.Fragment,{children:[s.jsx(Te.Separator,{}),s.jsx(Tt,{onSelect:()=>n({requestedModelId:l.value}),includeRegenerate:!0,onMouseEnter:()=>o(l.value),onMouseLeave:()=>o(null),messageModelSlug:e,includeCheck:!1,className:ws,...l,label:p.formatMessage(Sn.tryAgain),subtitle:l.label,icon:s.jsx(Qs,{className:C}),justifyIcon:g,wrapIcon:!a},l.value),b.filter(u=>u.condition).map(u=>s.jsx(Tt,{onSelect:()=>n({requestedModelId:l.value,extraStreamParams:u.extraStreamParams}),includeRegenerate:!1,onMouseEnter:()=>o(u.key),onMouseLeave:()=>o(null),isHovered:i===u.key,messageModelSlug:e,includeCheck:!1,className:ws,...l,label:u.label,subtitle:"",icon:u.icon,justifyIcon:g,wrapIcon:!a},u.key))]})]})}function Yc({children:t,label:e}){return s.jsx(Hs,{label:e,sideOffset:0,children:t})}const Sn=_e({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Xc=m.memo(Kc);function Dn({messages:t,isMemoryEnabled:e,isMemoryFull:n,gizmoId:a,isParagen:o}){const[i,l]=m.useState(!1),[c,d]=m.useState(!1),{eligible:h,isLoading:p}=Vi(),f=e&&!n,y=t.filter((g,b)=>{const u=t[b+1],w=(u==null?void 0:u.message.recipient)==="assistant"&&(u==null?void 0:u.message.author.role)===xe.Tool&&(u==null?void 0:u.message.author.name)==="bio"&&Fa(u.message)==="Model set context updated."||!u&&f;return g.message.author.role===xe.Assistant&&g.message.recipient==="bio"&&w}).flatMap(g=>{const b=g.message.content.content_type;return b===it.Text?g.message.content.parts:b===it.Code?[g.message.content.text]:[]}).map(Jc),S=m.useMemo(()=>y.length>0,[y]);if(m.useEffect(()=>{S&&h&&!p&&Ws.openModal(Xt.GlobalMemoryOnboarding)},[S,h,p]),y.length===0)return null;const C=g=>{const b=g??!c;d(b),b&&ee.logEvent($.memoryUpdatePopoverShown,{updateCount:y.length})};return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"inline-block",onMouseEnter:()=>C(!0),onMouseLeave:()=>C(!1),children:s.jsxs(qi,{open:c,sideOffset:4,side:"bottom",alignAgainstAnchor:"start",size:"none",className:"z-10 min-w-60 max-w-96 text-sm",onOpenChange:g=>C(g),disableAutofocus:!0,triggerButton:s.jsxs("button",{className:se("my-1 flex items-center gap-1 text-sm font-semibold outline-none",c?"text-token-text-secondary":"text-token-text-tertiary"),children:[s.jsx(wl,{className:"mb-[-1px]"}),y.length===1?s.jsx(F,{id:"MemoryActionResult.memoryWriteSingular.1",defaultMessage:"Memory updated"}):s.jsx(F,{id:"MemoryActionResult.memoryWritePlural.1",defaultMessage:"Memories updated"})]}),children:[s.jsx("div",{className:"mb-2 rounded border border-token-border-light bg-token-main-surface-secondary",children:y.map((g,b)=>s.jsx("div",{className:"border-b border-token-border-light px-3 py-2 first-letter:uppercase last:border-b-0",children:g},b))}),o?s.jsx("div",{className:"text-xs text-token-text-tertiary",children:s.jsx(F,{id:"MemoryActionResult.paragenMessage",defaultMessage:"This memory will be saved if you choose this response."})}):s.jsxs("button",{className:"flex w-full items-center justify-between rounded px-3 py-2 font-semibold hover:bg-token-main-surface-secondary",onClick:()=>{l(!0),ee.logEvent($.memoryUpdatePopoverManageButtonClicked,{updateCount:y.length})},children:[s.jsx(F,{id:"MemoryActionResult.manageMemories",defaultMessage:"Manage memories"}),s.jsx(Ml,{className:"icon-md -mr-1 text-token-text-tertiary"})]})]})}),i&&s.jsx($l,{initialGizmoId:a,onClose:()=>l(!1)})]})}function Jc(t){const e=["The user ","The user's ","User ","User's "];for(const n of e)if(t.startsWith(n))return t.slice(n.length);return t}function ga(t,e,n){G.updateTree(t,a=>{a.updateNodeMetadata(e,{inlineComparisonRating:n})})}function fa(t){var a,o;return{is_dark_mode:t==="dark",time_since_loaded:Math.floor(performance.now()/1e3),page_height:window==null?void 0:window.innerHeight,page_width:window==null?void 0:window.innerWidth,pixel_ratio:window==null?void 0:window.devicePixelRatio,screen_height:(a=window==null?void 0:window.screen)==null?void 0:a.height,screen_width:(o=window==null?void 0:window.screen)==null?void 0:o.width}}const pa=({messages:t})=>{for(const{message:{metadata:e}}of t){const{augmented_paragen_prompt_label:n}=e??{};if(n)return n}};function Zc(t){const e=m.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});return t.stubSideBySideFeedback?s.jsx(yo,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:e,...t}):s.jsx(ed,{...t,visibilityStateRef:e})}function ed(t){const{clientThreadId:e,variantIds:n,variantsInStreamInfo:a}=t;if(n.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const[o]=m.useState(()=>Date.now()),i=Va(),{resolvedTheme:l}=zo(),[c,d]=m.useMemo(()=>qa(n.join(""))()<.5?[0,1]:[1,0],[n[0],n[1]]),h=c<d?"left":"right",p=h==="left"?"right":"left",f=n[c],y=n[d],S=oa(e,f),C=oa(e,y),g=qt(ia(e,qt(S).id)),b=qt(ia(e,qt(C).id)),u=h==="left"?g:b,x=h==="left"?b:g,w=a.display_treatment==="unskippable",v=w?"unskippable_parallel_2_in_stream:a:1.0":"skippable_parallel_2_in_stream:a:1.5";m.useEffect(()=>(Fs.setState({displayingSideBySideFeedback:!0,unskippable:w}),()=>{Fs.setState({displayingSideBySideFeedback:!1,unskippable:!1})}),[w]),$i();const A=m.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});m.useEffect(()=>Uo(Ki,{requestCompletion:()=>{var P,_,B,W;const N=(P=$t(u.messages))==null?void 0:P.completionSampleFinishTime,H=(_=$t(x.messages))==null?void 0:_.completionSampleFinishTime;Me.submitMessageComparisonFeedback({feedback_version:v,original_message_id:(B=u.messages[u.messages.length-1])==null?void 0:B.message.id,new_message_id:(W=x.messages[x.messages.length-1])==null?void 0:W.message.id,rating:"none",conversation_id:G.getServerThreadId(e),text:"",tags:[],completion_comparison_rating:"skip",new_completion_placement:p,feedback_start_time:o,compare_step_start_time:o,original_completion_load_start_time:o,original_completion_load_end_time:N??0,new_completion_load_start_time:o,new_completion_load_end_time:H??0,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:fa(l),...A.current})}}),[g,b,e,o,v,p,u==null?void 0:u.messages,x==null?void 0:x.messages,l]);const L=N=>{var T,R,k,Q;const P=G.getTree(e).getLeafFromNode(N);G.setThreadCurrentLeafId(e,P.id);const B=N===f===(h==="left"),W=(T=$t(u.messages))==null?void 0:T.completionSampleFinishTime,D=(R=$t(x.messages))==null?void 0:R.completionSampleFinishTime;u.messages.length>0&&ga(e,u.messages[u.messages.length-1].nodeId,B?"original":"new"),x.messages.length>0&&ga(e,x.messages[x.messages.length-1].nodeId,B?"original":"new");let Y;W==null||D==null?Y=B?"partial_load_comparison_original":"partial_load_comparison_new":Y=B?"original":"new",Me.submitMessageComparisonFeedback({feedback_version:v,original_message_id:(k=u.messages[u.messages.length-1])==null?void 0:k.message.id,new_message_id:(Q=x.messages[x.messages.length-1])==null?void 0:Q.message.id,rating:"none",conversation_id:G.getServerThreadId(e),text:"",tags:[],completion_comparison_rating:Y,new_completion_placement:p,feedback_start_time:o,compare_step_start_time:o,original_completion_load_start_time:o,original_completion_load_end_time:W??null,new_completion_load_start_time:o,new_completion_load_end_time:D??null,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:fa(l),...A.current})};return s.jsx(yo,{...t,setPreferredFeedback:L,leftVariantId:f,rightVariantId:y,leftTurn:g,rightTurn:b,hasActiveRequest:i,originalTurn:u,visibilityStateRef:A})}function td(t){if(!t.length)return!1;const e=t.filter(n=>n.type===ot.Text||n.type===ot.MultiText).filter(n=>{var a;return n.message.message.status!=="finished_successfully"&&((a=n.message.message.metadata)==null?void 0:a.snorkle_status)!==void 0});return e.length>0&&e.every(n=>{const a=n.message.message.content;return(a==null?void 0:a.content_type)===it.Text&&a.parts.join("")===""})}function yo({setPreferredFeedback:t,leftVariantId:e,rightVariantId:n,leftTurn:a,rightTurn:o,hasActiveRequest:i,originalTurn:l,visibilityStateRef:c,...d}){const{defaultParagenLabel:h,shouldShowParagenLabels:p=!1}=Qi(),f=a&&pa(a)||h,y=o&&pa(o)||h,S=m.useMemo(()=>(a==null?void 0:a.messages)??[],[a==null?void 0:a.messages]),C=m.useMemo(()=>(o==null?void 0:o.messages)??[],[o==null?void 0:o.messages]),{avatarClassName:g}=d,b=m.useMemo(()=>Ps(S),[S]),u=m.useMemo(()=>Ps(C),[C]),x=Bn(),w=as();function v(Q){var ne,Ue;if(!w.showDebugConversationTurns&&!w.forceParagen)return null;let z=Q===l?"ORIGINAL":"NEW";const q=Q.messages[Q.messages.length-1],te=(Ue=(ne=q==null?void 0:q.message)==null?void 0:ne.metadata)==null?void 0:Ue.__internal;if(te){const{model_id:be,model_definition_slug:Qe,model_definition_virtual_model_id:Ye,alternative_model_selection_rule:Xe,augmented_paragen_prompt_group_id:je,augmented_paragen_prompt_id:Ae,augmented_paragen_prompt:He}=te;be&&(z+=`
Model ID: ${be}`),Qe&&(z+=`
Model Slug: ${Qe}`),Ye&&(z+=`
Virtual Model ID: ${Ye}`),Xe&&(z+=`
Alternative Model Rule: ${Xe}`),je&&(z+=`
Prompt Group ID: ${je}`),Ae&&(z+=`
Prompt ID: ${Ae}`),He&&(z+=`
Prompt: ${He}`)}return s.jsx("div",{className:"whitespace-pre-wrap text-sm text-red-500",children:z})}const[A,L]=m.useMemo(()=>[b,u].map(Q=>td(Q)),[b,u]),N=Jt(a?Is.getRequestIdFromConversationTurn(a):"")||A,H=Jt(o?Is.getRequestIdFromConversationTurn(o):"")||L,P=(a==null?void 0:a.role)===xe.User,_=(o==null?void 0:o.role)===xe.User,B=Un(),W=m.useRef(null),D=m.useRef(null),Y=m.useRef(null);m.useEffect(()=>{if(W.current&&D.current&&Y.current){const Q=Array(11).fill(0).map((q,te)=>te/10),z=new IntersectionObserver(q=>q.forEach(te=>{te.target===D.current?(c.current.left_visibility_initial==null&&(c.current.left_visibility_initial=te.intersectionRatio),c.current.left_visibility_max=Math.max(c.current.left_visibility_max??0,te.intersectionRatio)):te.target===Y.current&&(c.current.right_visibility_initial==null&&(c.current.right_visibility_initial=te.intersectionRatio),c.current.right_visibility_max=Math.max(c.current.right_visibility_max??0,te.intersectionRatio))}),{root:W.current,threshold:Q});return z.observe(D.current),z.observe(Y.current),()=>z.disconnect()}},[c]);const{data:T}=Gn(void 0,!1,x),R=T==null?void 0:T.memoryFullPct,k=typeof R=="number"&&R>=100;return s.jsxs("div",{className:"relative flex flex-col",children:[s.jsx("div",{className:"sticky top-[-1px] z-[1] text-pretty bg-token-main-surface-primary px-6 text-center text-lg md:static",children:s.jsx(F,{id:"JgCHDY",defaultMessage:"You’re giving feedback on a new version of ChatGPT."})}),s.jsx("div",{className:"text-pretty px-6 pb-5 pt-1 text-center text-sm text-token-text-secondary",children:s.jsx(F,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),s.jsx("div",{className:"sticky top-[calc(1.75em-1px)] z-[1] h-3 bg-gradient-to-b from-token-main-surface-primary from-50% to-transparent md:static"}),s.jsx("div",{className:"-mb-2 snap-x snap-mandatory overflow-x-auto px-3 pb-4 md:px-5 lg:px-10",ref:W,children:s.jsx("div",{className:"min-w-fit",children:s.jsxs("div",{className:"mx-auto flex max-w-6xl items-start gap-4 sm:gap-6",children:[s.jsxs(xa,{elemRef:D,onClick:()=>{t(e)},hasActiveRequest:i,children:[s.jsxs(ya,{children:[s.jsx(Pn,{messages:S,isUserTurn:P,avatarClassName:g,showInlineEmbeddedDisplay:!1}),s.jsx(ba,{children:p?s.jsx("span",{className:"font-bold text-token-text-primary",children:f}):s.jsx(F,{...va.responseNumber,values:{responseIndex:1}})})]}),T!=null&&!P&&s.jsx(Dn,{messages:S,isMemoryEnabled:B,isMemoryFull:k,isParagen:!0}),s.jsx(kn,{...d,groupedMessagesToRender:b,allGroupedMessages:b,isEditing:!1,isUserTurn:P,isCompletionRequestInProgress:N,hasActiveRequest:i,handleEnterEdit:gt,handleExitEdit:gt,shouldGrowContainer:!1}),!!a&&v(a)]}),s.jsxs(xa,{elemRef:Y,onClick:()=>{t(n)},hasActiveRequest:i,children:[s.jsxs(ya,{children:[s.jsx(Pn,{messages:C,isUserTurn:_,avatarClassName:g,showInlineEmbeddedDisplay:!1}),s.jsx(ba,{children:p?s.jsx("span",{className:"font-bold text-token-text-primary",children:y}):s.jsx(F,{...va.responseNumber,values:{responseIndex:2}})})]}),T!=null&&!_&&s.jsx(Dn,{messages:C,isMemoryEnabled:B,isMemoryFull:k,isParagen:!0}),s.jsx(kn,{...d,groupedMessagesToRender:u,allGroupedMessages:u,isEditing:!1,isUserTurn:_,isCompletionRequestInProgress:H,hasActiveRequest:i,handleEnterEdit:gt,handleExitEdit:gt,shouldGrowContainer:!1}),!!o&&v(o)]})]})})})]})}function xa({elemRef:t,onClick:e,children:n,hasActiveRequest:a}){return s.jsxs("div",{className:"relative flex w-full min-w-[min(450px,80vw)] snap-center flex-col gap-1 truncate rounded-2xl border border-token-main-surface-tertiary bg-white p-5 text-left dark:bg-gray-700",ref:t,children:[n,a?null:s.jsx(nt,{className:"mt-4 self-start",onClick:e,children:s.jsx(F,{id:"U2EAH6",defaultMessage:"I prefer this response"})})]})}const ba=Ke.div`text-sm text-token-text-tertiary font-semibold`,ya=Ke.div`flex gap-4 items-center mb-1`,va=_e({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}"},responseChoice:{id:"ConversationTurnTwoUpFeedback.responseChoice",defaultMessage:"Choose this response"}});function sd({clientThreadId:t,messageForRating:e,variantIds:n,conversationTurnMountTime:a}){const[o]=m.useState(()=>e.message.create_time!=null?e.message.create_time*1e3:Date.now()),[i]=m.useState(()=>Date.now());function l(c){var A,L;const d=G.getTree(t),h=n[0]||"",p=(d==null?void 0:d.getConversationTurns(h))||[],f=p[p.length-1],y=(f==null?void 0:f.messages)||[],S=y[y.length-1],C=((A=S==null?void 0:S.message)==null?void 0:A.id)||"",g=n[1]||"",b=(d==null?void 0:d.getConversationTurns(g))||[],u=b[b.length-1],x=(u==null?void 0:u.messages)||[],w=x[x.length-1],v=((L=w==null?void 0:w.message)==null?void 0:L.id)||"";Me.submitMessageComparisonFeedback({feedback_version:"inline_regen_feedback:a:1.0",original_message_id:C,new_message_id:v,rating:"none",conversation_id:G.getServerThreadId(t),text:"",tags:[],completion_comparison_rating:c,new_completion_placement:"not-applicable",feedback_start_time:a,compare_step_start_time:a,new_completion_load_start_time:o,new_completion_load_end_time:i,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset()}),G.updateTree(t,N=>{N.updateNodeMetadata(e.nodeId,{inlineComparisonRating:c})}),G.updateTree(t,N=>{N.updateNodeMetadata(S.nodeId,{inlineComparisonRating:"baseline"})})}return s.jsxs(nd,{children:[s.jsx("h6",{className:"min-w-[150px] grow",children:s.jsx(F,{...Ms.regenTitle})}),s.jsxs("div",{className:"flex flex-wrap items-end justify-center gap-2",children:[s.jsx(nt,{color:"secondary",onClick:()=>l("new"),children:s.jsx(F,{...Ms.regenBetterText})}),s.jsx(nt,{color:"secondary",onClick:()=>l("original"),children:s.jsx(F,{...Ms.regenWorseText})}),s.jsx(nt,{color:"secondary",onClick:()=>l("same"),children:s.jsx(F,{...Ms.regenSameText})})]}),s.jsx(Bo,{onClick:()=>{G.updateTree(t,c=>{c.updateNodeMetadata(e.nodeId,{inlineComparisonRating:"skip"})})}})]})}const nd=Ke.div`flex items-center p-4 rounded-2xl bg-token-main-surface-primary text-token-text-primary text-sm border border-token-border-light gap-5 mt-3`,Ms=_e({regenTitle:{id:"ConversationTurnInlineFeedback.regenTitle",defaultMessage:"Was this response better or worse?"},regenBetterText:{id:"ConversationTurnInlineFeedback.regenBetterText",defaultMessage:"Better"},regenWorseText:{id:"ConversationTurnInlineFeedback.regenWorseText",defaultMessage:"Worse"},regenSameText:{id:"ConversationTurnInlineFeedback.regenSameText",defaultMessage:"Same"}}),Sa=({allGroupedMessages:t})=>t.some(e=>[ot.Browsing,ot.RetrievalBrowsing,ot.ParallelBrowsing].includes(e.type)),Ca=({allGroupedMessages:t})=>t.some(e=>e.type===ot.CodeInterpreter);function ad(t){return!t||!t.instructions?"":typeof t.instructions=="string"?t.instructions:t.instructions.filter(e=>typeof e=="string").join("")}const od=[{match:Sa,tag:"Shouldn't have searched the web",label:re({id:"kL047b",defaultMessage:"Shouldn't have searched the web"})},{match:Sa,tag:"Don't like the source it cited",label:re({id:"+ds/Q/",defaultMessage:"Don't like the source it cited"})},{match:Ca,tag:"Shouldn't have run code",label:re({id:"53w4ay",defaultMessage:"Shouldn't have run code"})},{match:Ca,tag:"Couldn't handle my file",label:re({id:"EkFTQ5",defaultMessage:"Couldn't handle my file"})},{match:({allGroupedMessages:t})=>t.some(e=>e.type===ot.Dalle),tag:"Shouldn't have created an image",label:re({id:"S8FRsr",defaultMessage:"Shouldn't have created an image"})},{match:({allGroupedMessages:t})=>t.some(e=>{if(e.type!==ot.Text)return!1;const{message:n}=e.message,{content:a}=n;return a.content_type===it.Text&&Fa(n).match(/^```[\S]+\n/gm)}),tag:"Code was incorrect",label:re({id:"4EBdQk",defaultMessage:"Code was incorrect"})},{match:({systemContent:t})=>ad(t).includes("Personality")??!1,tag:"Too chatty or casual",label:re({id:"ATzJKW",defaultMessage:"Too chatty or casual"})},{match:({features:t})=>t.includes(Gs.Sunshine),tag:"Shouldn't have used Memory",label:re({id:"yfUEiz",defaultMessage:"Shouldn't have used Memory"})},{tag:"Don't like the style",label:re({id:"nGxjdj",defaultMessage:"Don't like the style"})},{tag:"Not factually correct",label:re({id:"Ke7JtQ",defaultMessage:"Not factually correct"})},{tag:"Didn't fully follow instructions",label:re({id:"Rdlt9V",defaultMessage:"Didn't fully follow instructions"})},{tag:"Refused when it shouldn't have",label:re({id:"2yRS/Q",defaultMessage:"Refused when it shouldn't have"})},{tag:"Being lazy",label:re({id:"14MPmT",defaultMessage:"Being lazy"})},{tag:"Unsafe or problematic",label:re({id:"02pXBl",defaultMessage:"Unsafe or problematic"})},{tag:"Other",label:re({id:"WiIGE+",defaultMessage:"Other"})}],id=[{tag:"I disagree with the policy",label:re({id:"oKyDLz",defaultMessage:"I disagree with the policy"})},{tag:"This didn't violate the policy",label:re({id:"7fUkVF",defaultMessage:"This didn't violate the policy"})},{tag:"I don't understand the policy",label:re({id:"4Cdp6N",defaultMessage:"I don't understand the policy"})},{tag:"This didn't take the full context",label:re({id:"vnZJDP",defaultMessage:"This didn't take the full context"})}];function rd(t,e,n){return e.filter(a=>!a.match||a.match(n)).map(a=>({value:a.tag,label:t.formatMessage(a.label)}))}function ld(t){const e=t[t.length-1];if(!e)return!1;const n="message"in e?e.message:null;if(n){const{errCode:a}=qn(n);return[Jn.ContentPolicy,Jn.ContentOrTos].includes(a)}else return!1}function cd({clientThreadId:t,conversationMessage:e,currentModelId:n,allGroupedMessages:a}){const o=ze(),i=Bs()??[],l=e.rating,c=el(t,e.message.id),d=(c==null?void 0:c.message.content.content_type)===it.SystemContent?c==null?void 0:c.message.content:null,h=m.useCallback(y=>{const S=G.getServerThreadId(t);S&&(y.tags.length===0&&!y.textFeedback||(ee.logEvent(y.source==="inline"?$.messageFeedbackInlineSubmitted:$.messageFeedbackDialogSubmitted,{id:e.message.id,threadId:S,tags:y.tags,content:y.textFeedback,model:n,rating:l}),l&&Me.submitMessageFeedback({message_id:e.message.id,conversation_id:S,rating:l,text:y.textFeedback,tags:y.tags,tag_choices:y.tagChoices})))},[t,e.message,n,l]),p=()=>{ee.logEvent($.messageFeedbackMoreOptionsClicked,{id:e.message.id,threadId:G.getServerThreadId(t),model:n,rating:l})},f=rd(o,ld(a)?id:od,{allGroupedMessages:a,features:i,currentModelId:n,systemContent:d});return l==="thumbsUp"?null:s.jsx(Kl,{tagOptions:f,onSubmit:h,onMoreClicked:p})}const wa=[1,2,3,4,10,20,30],dd=.5;function ud({clientThreadId:t,conversationLeafId:e}){const n=Ds(Wn.isBusinessWorkspace),a=m.useRef(!1),o=$s(t),i=Ks(t),{isUnauthenticated:l}=Pt(),c=m.useMemo(()=>{if(!o)return-1;const _=qa(o);return _()>dd?-1:wa[Math.floor(_()*wa.length)]},[o]),d=Xa(t,e),h=d[d.length-1],p=m.useMemo(()=>Is.getRequestIdFromConversationTurn(h),[h]),f=Jt(p),[y,S]=m.useState(null),[C,g]=m.useState(!1),[b,u]=m.useState(!1),[x,w]=m.useState(!1),v=_=>{var W,D;const B=(D=(W=$t(d))==null?void 0:W.messages[0])==null?void 0:D.message.id;S(_),H(B,_)},A=d.filter(_=>_.role===xe.Assistant).length,L=(h==null?void 0:h.role)===xe.Assistant,N=h==null?void 0:h.messages.some(_=>{var B;return(B=_.message.metadata)==null?void 0:B.is_nulligen}),H=m.useMemo(()=>Oa((_,B)=>{o&&_&&Me.submitConversationRating({conversation_id:o,message_id:_,rating:B,shown_at_assistant_turn:c}),ee.logEvent($.conversationRatingSubmitted,{rating:B,showAtAssistantTurn:c,conversationId:o}),g(!0),setTimeout(()=>{u(!0)},1500)},2e3),[o,c]),P=A!==c||f||!L||N||!!n||(i==null?void 0:i.kind)!==at.PrimaryAssistant||x||l;return m.useEffect(()=>{!P&&!a.current&&(ee.logEvent($.conversationRatingShown,{showAtAssistantTurn:c,conversationId:o}),a.current=!0)},[P]),x||P?null:s.jsxs("div",{className:"mx-auto",children:[s.jsx(za,{children:C&&!b&&s.jsx(It.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:s.jsx(Ma,{$padded:!0,children:s.jsx("span",{className:"text-sm text-token-text-tertiary",children:s.jsx(F,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!C&&s.jsx(It.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:s.jsxs(Ma,{$padded:!1,children:[s.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-secondary",children:[s.jsx(F,{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?"}),s.jsxs("div",{className:"flex items-center gap-5",children:[s.jsx(Cn,{$selected:y==="thumbsUp",onClick:()=>v("thumbsUp"),children:s.jsx(ao,{className:"icon-md"})}),s.jsx(Cn,{$selected:y==="thumbsDown",onClick:()=>v("thumbsDown"),children:s.jsx(oo,{className:"icon-md"})})]})]}),s.jsx("div",{className:"w-px flex-1 self-stretch bg-token-main-surface-tertiary"}),s.jsx(Cn,{className:"p-3",$selected:!1,onClick:()=>w(!0),children:s.jsx(_l,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const Cn=Ke.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,Ma=Ke.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`;function hd({clientThreadId:t,conversationLeafId:e,canShowIndepthFeedbackType:n,canShowInlineComparisonFeedback:a,canShowInlineMessageFeedback:o,messageForRating:i,allGroupedMessages:l,currentModelId:c,conversationTurnMountTime:d,variantIds:h}){let p=null;return tl(t,e)?null:(n!==void 0?p=s.jsx(Ec,{clientThreadId:t,conversationLeafId:e,trigger:n,variantIds:h}):i.rating&&o?p=s.jsx(cd,{clientThreadId:t,conversationMessage:i,allGroupedMessages:l,currentModelId:c}):a?p=s.jsx(sd,{clientThreadId:t,messageForRating:i,variantIds:h,conversationTurnMountTime:d}):p=s.jsx("div",{className:"text-center",children:s.jsx(ud,{clientThreadId:t,conversationLeafId:e})}),s.jsx("div",{className:"mt-3 w-full empty:hidden",children:p}))}const md=bt(()=>yt(()=>import("./sso-b2akzs8aciezgo7r.js").then(t=>t.l),__vite__mapDeps([31,1,2,3,32,6,7,13,33,34,35,36,37,38,15,39,11,10,40,41,42,43,44,12,9,45,46,47,48,49,17,29,50,51,27,28,52,25,26,30,53,54,55,56,57,58,59,60,19,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,16,80,81,82,83,84,85,86,87,88,89,90,91,92,93])).then(t=>t.ContextualAnswerCitationCards).catch(()=>()=>null));function gd(t){var le;const{turnIndex:e,conversationLeafId:n,isFinalTurn:a,clientThreadId:o,onChangeItemInView:i,onChangeRating:l,showInlineEmbeddedDisplay:c=!1,currentModelId:d,initiallyHighlightedMessageId:h,avatarClassName:p,scrollToBottom:f}=t,y=ze(),S=Hn(),C=!!S&&Ho(S),g=Vs(),b=Ds(Wn.isBusinessWorkspace),u=Un(),x=Bn(),w=qt(sl(o,e,n)),{messages:v,variantIds:A,variantsInStreamInfo:L}=w,N=Ps(v),H=Yi();let P=v[v.length-1];for(const K of N){const ce=qr(K);if(ce.some(ut=>H.has(ut.message.id))){P=ce[ce.length-1];break}}const _=v.slice(0,v.indexOf(P)+1),B=Ra(),[W,D]=m.useState(!1),[Y,T]=m.useState(!1),R=A.findIndex(K=>_.some(ce=>ce.nodeId===K)),k=w.role===xe.User,Q=xt(),z=rt(o),q=(le=ns(w.gizmoId??z))==null?void 0:le.data,te=Xi(),ne=q&&te.includes(q.gizmo.id),Ue=$a(d),be=Ks(o,q==null?void 0:q.gizmo.id),Ye=nl(o)===Wo.PENDING,{data:Xe}=Gn(q==null?void 0:q.gizmo.id,!1,x),je=Xe==null?void 0:Xe.memoryFullPct,Ae=je!==void 0&&je>=100,He=Bs(),{value:is}=Es("1410082514"),{value:Dt}=Es("2291672486"),Ys=_.some(K=>K.message.content.content_type===it.MultimodalText),{isUnauthenticated:lt}=Pt(),[rs,ls]=m.useState(!1),[Xs,Lt]=m.useState(!1);Ji(()=>{w.role==="user"&&f&&f()});const Ot=m.useRef(null);m.useEffect(()=>{var ce;if(h==null)return;w.messages.map(ut=>ut.message.id).includes(h)&&((ce=Ot.current)==null||ce.scrollIntoView({behavior:"auto"}))},[h]);const U=v[v.length-1],Be=U.rating,cs=()=>{_.length===1&&(ee.logEvent($.editPrompt,{id:_[0].message.id,threadId:G.getServerThreadId(o)}),Oe.logEvent("chatgpt_edit_prompt"),D(!0))},We=m.useCallback(()=>{D(!1)},[]),vt=m.useCallback(()=>{G.copyMessageToClipboard(o,e)},[o,e]),zt=K=>{l({nodeId:U.nodeId,messageId:U.message.id,rating:K}),ee.logEvent($.messageFeedbackThumbsDownClicked,{id:U.message.id,threadId:G.getServerThreadId(o),model:d,rating:K}),T(!0)},[ds]=m.useState(()=>Date.now()),Js=m.useMemo(()=>Is.getRequestIdFromConversationTurn(w),[w]),Zs=al({clientThreadId:o,conversationLeafId:n}),ye=Jt(Js)&&!Zs,Ut=Va(),en=Ps(_),{showDebugConversationTurns:us}=as(),hs=ol(o),ms=co(o),Bt=Rc({clientThreadId:o,conversationMode:be}),tn=qs(o),gs=m.useCallback(({requestedModelId:K,systemMessage:ce,juice:ut,extraStreamParams:un})=>{const So=new wn;Bt({id:U.nodeId,eventMetadata:{eventSource:"mouse"},turnTracker:So,requestedModelId:K,systemMessage:ce,juice:ut,extraStreamParams:un})},[U,Bt]),fs=is&&_.some(K=>{var ce;return((ce=K.message.metadata)==null?void 0:ce.snorkle_status)!=null}),St=!g&&!hs&&!Q&&!k,Gt=St&&(!b||fs),Ht=Zi(),ps=!lt&&Gt&&B&&!ye&&!Ye&&!c&&!W&&(be==null?void 0:be.kind)!==at.GizmoMagicCreate&&R===1&&a&&!U.inlineComparisonRating&&!Be&&A.length===2&&!Ht&&Date.now()-(U.message.create_time??0)*1e3<1e3*60*10,xs=!lt&&Gt&&!ye&&!Ye&&!c&&!W&&(be==null?void 0:be.kind)!==at.GizmoMagicCreate&&d===mi&&a&&u&&!Ae&&Date.now()-(U.message.create_time??0)*1e3<1e3*60*10,bs=Ic(U),sn=P.message.author.role===xe.Assistant?P.message:null;er({isCompletionRequestInProgress:ye,isUserTurn:k,message:sn});const ys=xs?bs:void 0,nn=il(o,A),Ge=tr(be),vs=!Ht&&!Ge&&St&&a&&(L==null?void 0:L.num_variants_in_stream)===2&&!U.inlineComparisonRating&&!nn,an=A.length===2,Ct=vs,on=vs&&!an,ct=!k&&!c&&!g&&!hs&&!Ge&&!Ye&&!ye,O=ct&&(!b||fs||Ue||C)&&!Ge&&!lt&&!Q,he=!g&&!c&&!((ye||Ye)&&a)&&A.length>1&&!W&&!Ct;let ae=!1;if(k&&_.length===1){const{shouldHideContent:K}=qn(_[0]);K&&(ae=!0)}const me=k&&!c&&!Ge&&!g&&!Ys&&_.length===1&&!ae&&!W&&!lt,Je=K=>{i(A[K]),ee.logEvent($.changeNode,{intent:"toggle_between"})};if(!(w.role===xe.Root?!1:w.role===xe.System||_.every(K=>{var ce;return(ce=K.message.metadata)==null?void 0:ce.is_visually_hidden_from_conversation})?us:!0)&&!Ct)return null;const dt=a&&ms&&!Dt?s.jsx(_s,{onClick:()=>{const K=new wn;Bt({id:tn,eventMetadata:{eventSource:"mouse"},turnTracker:K}),sr()},icon:Qs,label:y.formatMessage({id:"ConversationTurn.regenerateTooltip",defaultMessage:"Regenerate"}),testId:"regenerate-turn-action-button"}):null,Ve="h-[30px] rounded-md px-1 text-token-text-secondary hover:bg-token-main-surface-secondary",rn=Dt?s.jsx(Xc,{className:Ve,clientThreadId:o,message:U,onModelSelect:gs,onDropdownChange:ls,canRegenerateResponse:ms}):null,ln=!k&&!ae&&!c&&(!a||!ye)?s.jsx(cr,{onClick:vt}):null,cn=!k&&!c&&(!a||!ye)&&(U.disclaimers??[]).length===0&&U.nodeId?s.jsx(Gc,{conversationId:o,message:U,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-xs text-token-text-tertiary hover:text-token-text-primary"}):null,Wt=!k&&!c&&U&&(!a||!ye)?s.jsx(dr,{message:U,isFinalTurn:a,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-token-text-tertiary hover:text-token-text-primary"}):null,dn=O&&!ye?s.jsxs("div",{className:"flex",children:[!(He!=null&&He.includes(Gs.ThumbsDownOnly))&&Be!=="thumbsDown"&&s.jsx(_s,{onClick:()=>zt("thumbsUp"),disabled:Be==="thumbsUp",icon:Be==="thumbsUp"?kl:ao,label:y.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"},`thumbsUp:${U.nodeId}`),Be!=="thumbsUp"&&s.jsx(_s,{onClick:()=>zt("thumbsDown"),disabled:Be==="thumbsDown",icon:Be==="thumbsDown"?Tl:oo,label:y.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"},`thumbsDown:${U.nodeId}`)]}):null,Vt=!Dt&&s.jsx(Tc,{className:Ve,clientThreadId:o,message:U,onModelSelect:gs,onDropdownChange:ls});return s.jsxs("article",{className:"w-full text-token-text-primary focus-visible:outline-2 focus-visible:outline-offset-[-4px]",ref:Ot,dir:"auto","data-testid":`conversation-turn-${e}`,"data-scroll-anchor":a,onMouseEnter:()=>Lt(!0),onMouseLeave:()=>Lt(!1),children:[s.jsx(nr,{role:w.role}),s.jsx(Ka,{clientThreadId:o,showInlineEmbeddedDisplay:c,isStaticSharedThread:g,withVerticalPadding:!0,withHorizontalPadding:!Ct,children:Ct?s.jsx(Zc,{isFeedbackEnabled:O,variantIds:A,variantsInStreamInfo:L,conversationTurnMountTime:ds,stubSideBySideFeedback:on,...t}):s.jsxs(ks,{children:[!k&&s.jsx(pd,{children:s.jsx(Pn,{messages:_,isUserTurn:k,avatarClassName:p,showInlineEmbeddedDisplay:c,gizmo:q})}),s.jsx("div",{className:se("group/conversation-turn relative flex w-full min-w-0 flex-col",!k&&ar),children:s.jsx("div",{className:"flex-col gap-1 md:gap-3",children:s.jsxs(s.Fragment,{children:[!k&&!g&&s.jsx(Dn,{messages:_,isMemoryEnabled:u,isMemoryFull:Ae,gizmoId:q==null?void 0:q.gizmo.id}),s.jsx(kn,{groupedMessagesToRender:en,allGroupedMessages:N,...t,isEditing:W,isUserTurn:k,isCompletionRequestInProgress:ye,isFeedbackEnabled:O,isFinalTurn:a,hasActiveRequest:Ut,showEditButton:me,handleEnterEdit:cs,handleExitEdit:We}),ne&&s.jsx("div",{className:"mb-4",children:s.jsx(or,{messages:_})}),Ue&&s.jsx("div",{className:"mb-4",children:s.jsx(md,{messages:_})}),(ct||he)&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:se("mb-2 flex gap-3 empty:hidden",k?"mr-1 flex-row-reverse":"-ml-2"),children:s.jsx(ir,{alwaysShow:a,showInline:a||he,isHovered:Xs||rs,pagination:he&&s.jsx(rr,{showInline:a||he,currentPage:R,onChangeIndex:Je,length:A.length,className:se("self-center",A.length>1?"visible":"!invisible")}),actions:ct&&s.jsxs(s.Fragment,{children:[cn,ln,dt,dn,Wt,Vt,rn]})})}),ct&&!ye?s.jsx("div",{className:"pr-2 lg:pr-0",children:s.jsx(lr,{message:U,isFinalTurn:a})}):null,a&&!ye&&s.jsx(hd,{canShowIndepthFeedbackType:ys,canShowInlineComparisonFeedback:ps,canShowInlineMessageFeedback:Y,clientThreadId:o,conversationLeafId:n,messageForRating:U,allGroupedMessages:N,currentModelId:d,conversationTurnMountTime:ds,variantIds:A})]})]})})})]})})]})}const fd=Go.memo(gd),pd=Ke.div`flex-shrink-0 flex flex-col relative items-end`;function xd(t){var n,a;const e=(n=t.message.metadata)==null?void 0:n.aggregate_result;return(a=e==null?void 0:e.messages)==null?void 0:a.some(Ql)}function bd(t){const e=t.message.content;return("parts"in e?e.parts.join(""):"").includes("sandbox:")}function yd(t){return t.some(e=>e.messages.some(n=>xd(n)||bd(n)))}function vd({clientThreadId:t}){const e=rl(t),n=Ja(t),a=Vn(p=>os.getThreadCreateTime(t,p)),o=qs(t),i=Xa(t,o),l=m.useMemo(()=>yd(i),[i]),c=ll(t),d=cl(t),h=c||d;return s.jsxs("div",{className:"border-b border-gray-100 px-4 pb-4 pt-3 sm:mb-2 sm:pb-6 sm:pt-8 md:px-0",children:[s.jsx("h1",{className:"text-3xl font-semibold leading-tight text-token-text-primary sm:text-4xl",children:e}),(n!=null||a!=null)&&s.jsxs("div",{className:"pt-3 text-base text-gray-400 sm:pt-4",children:[n!=null&&s.jsx("span",{children:n}),n!=null&&a!=null&&s.jsx("span",{className:"px-2",children:"•"}),a!=null&&s.jsx(Vo,{value:a,month:"long",year:"numeric",day:"numeric"})]}),s.jsx(Sd,{shouldShowCodeInterpreterDisclaimer:l,shouldShowPersonalizedDataDisclaimer:h})]})}const Sd=({shouldShowCodeInterpreterDisclaimer:t,shouldShowPersonalizedDataDisclaimer:e})=>s.jsxs(s.Fragment,{children:[t&&s.jsx("div",{className:"mt-4",children:s.jsx(ta,{icon:Ls,children:s.jsx(F,{id:"sharedConversation.advancedDataAnalysisSupportDisclaimer",defaultMessage:"This chat contains files or images produced by Advanced Data Analysis which are not yet visible in Shared Chats."})})}),e&&s.jsx("div",{className:"mt-4",children:s.jsx(ta,{icon:Ls,children:s.jsx(F,{id:"sharedConversation.personalizedDataDisclaimer",defaultMessage:"This conversation may reflect the link creator’s personalized data, which isn’t shared and can meaningfully change how the model responds."})})})]}),Cd=t=>{const e=xt();return m.useCallback(n=>{var c,d;ur(n);const{target:a}=n;if(!(a instanceof Element))return;const o=(c=a.closest("[data-message-id]"))==null?void 0:c.getAttribute("data-message-id"),i=(d=document.getSelection())==null?void 0:d.toString(),l=G.getServerThreadId(t);!o||!i||!l||e||Me.submitImplicitMessageFeedback({source:"keyboard",type:"copy",messageId:o,serverThreadId:l,selectedText:i})},[t,e])};function wd({onChangeItemInView:t,onRequestMoreCompletions:e,onChangeRating:n,onRequestCompletion:a,clientThreadId:o,conversationLeafId:i,inlineEmbeddedDisplay:l,initiallyHighlightedMessageId:c,hideHeader:d}){const h=hr(),p=Vs(),f=dl(),y=mr(),[S]=gr(),C=Ks(o),g=Rt(),b=gi(o),u=h.store.useContentAreaDimensions(fr.Header,T=>T!=null&&T.height?T.height:void 0),x=h.store.useIsHeaderContentAreaPopulated(),w=Za(o),{isArchived:v}=w,A=zl(b.id),L=(C==null?void 0:C.kind)===at.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":A,N=eo(o,i),H=pr(),[P,_]=m.useState(0);m.useEffect(()=>{f&&(P===0?_(N):N-P===1&&(Oe.logEvent("chatgpt_continue_conversation_first_message_sent"),ee.logEvent($.continueConversationFirstMessageSent)))},[N,P,f]),f&&(Oe.logEvent("chatgpt_continue_conversation_page_loaded"),ee.logEvent($.continueConversationPageLoaded));const B=m.useCallback(()=>{y({behavior:"smooth"})},[y]),W=Cd(o),D=H&&!v,Y=(T,R,k)=>[...new Array(R-T).keys()].map(Q=>{const z=Q+T;return s.jsx(fd,{isFinalTurn:k(z),turnIndex:z,clientThreadId:o,conversationLeafId:i,onChangeItemInView:t,onChangeRating:n,onRequestMoreCompletions:e,onRequestCompletion:a,currentModelId:b.id,showInlineEmbeddedDisplay:l,initiallyHighlightedMessageId:c,avatarClassName:L,scrollToBottom:B},z)});return s.jsxs("div",{onCopy:W,className:se("flex flex-col text-sm",p&&"pt-2",D&&"pb-[120px]",u||D?null:"md:pb-9"),style:{paddingBottom:D?void 0:u},children:[!d&&(p||(g==null?void 0:g.data))&&!l&&s.jsx(lo,{clientThreadId:o}),p&&!l&&s.jsx(ks,{children:s.jsx(vd,{clientThreadId:o})}),f&&s.jsxs(s.Fragment,{children:[s.jsx(ks,{children:s.jsx("p",{className:"text-xs text-gray-500",children:s.jsx(F,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),Y(0,P,T=>T===P-1),s.jsx(ks,{children:s.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[s.jsx(jl,{className:"icon-xs mr-2"}),s.jsx(F,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})}),Y(P,N,T=>T===N-1)]}),!f&&Y(0,N,T=>T===N-1),!S&&!l&&s.jsx(Md,{className:se(u?null:"bottom-5",D?x?"translate-y-[-50px]":"translate-y-[-10px]":""),style:{bottom:H?"calc(var(--composer-bar_footer-current-height) + var(--composer-bar_current-height))":u},onClick:()=>{Oe.logEvent("chatgpt_thread_scroll_to_bottom"),y({behavior:"smooth"})},children:s.jsx(Al,{className:"icon-md text-token-text-primary"})})]})}const Md=Ke.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-light right-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`;function _d({clientThreadId:t,currentModelId:e}){const n=Ul(e,Bl.CODE_INTERPRETER);Td(n,t)}async function kd({queryKey:[t,e]}){return await Me.getThreadInterpreterState(e).then(n=>(n.time_remaining_ms===0&&n.kernel_started&&jt.warning("This advanced data analysis (beta) chat has timed out. You may continue the conversation, but previous files, links, and code blocks below may not work as expected.",{hasCloseButton:!0,duration:0}),n))}function Td(t,e){const n=Vs(),a=G.getServerThreadId(e);return qo({queryKey:["interpreterState",a],queryFn:kd,enabled:!!(t&&a&&!n),gcTime:0})}const jd=bt(()=>yt(()=>import("./7qq2lazi5qjip5hq.js"),__vite__mapDeps([94,1,2,3,10,6,7,11,9,29,71,47,48,85,64,26,15,37])).then(t=>t.OpenDebugSidebarButton)),Ad=bt(()=>yt(()=>import("./bj1pr0cy739fi2qi.js"),__vite__mapDeps([95,1,2,3,6,7,69,11])),{ssr:!1}),Nd=bt(()=>yt(()=>import("./sso-b2akzs8aciezgo7r.js").then(t=>t.m),__vite__mapDeps([31,1,2,3,32,6,7,13,33,34,35,36,37,38,15,39,11,10,40,41,42,43,44,12,9,45,46,47,48,49,17,29,50,51,27,28,52,25,26,30,53,54,55,56,57,58,59,60,19,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,16,80,81,82,83,84,85,86,87,88,89,90,91,92,93])).catch(()=>()=>null),{ssr:!1}),Ed=bt(()=>yt(()=>import("./sso-b2akzs8aciezgo7r.js").then(t=>t.P),__vite__mapDeps([31,1,2,3,32,6,7,13,33,34,35,36,37,38,15,39,11,10,40,41,42,43,44,12,9,45,46,47,48,49,17,29,50,51,27,28,52,25,26,30,53,54,55,56,57,58,59,60,19,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,16,80,81,82,83,84,85,86,87,88,89,90,91,92,93])).then(t=>t.default)),Id=bt(()=>yt(()=>import("./sso-b2akzs8aciezgo7r.js").then(t=>t.n),__vite__mapDeps([31,1,2,3,32,6,7,13,33,34,35,36,37,38,15,39,11,10,40,41,42,43,44,12,9,45,46,47,48,49,17,29,50,51,27,28,52,25,26,30,53,54,55,56,57,58,59,60,19,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,16,80,81,82,83,84,85,86,87,88,89,90,91,92,93])).then(t=>t.CAFeedbackModal).catch(()=>()=>null)),$e=_e({doNotShareSensitive:{id:"thread.modal.onboarding.title",defaultMessage:"Do not share sensitive materials with this application"},mayProduceInaccurateInformation:{id:"thread.chatgptMayProduceInaccurateInformation-oct-30",defaultMessage:"ChatGPT can make mistakes. Check important info."},mayProduceInaccurateInformationNoAuth:{id:"thread.chatgptMayProduceInaccurateInformationNoAuth-march-27",defaultMessage:"ChatGPT can make mistakes. Check important info. Read our <termsLink>Terms</termsLink> and <privacyLink>Privacy Policy</privacyLink>."},mayProduceInaccurateInformationNoAuthV2:{id:"thread.chatgptMayProduceInaccurateInformationNoAuth-may-06",defaultMessage:"By messaging ChatGPT, you agree to our <termsLink>Terms</termsLink> and have read our <privacyLink>Privacy Policy</privacyLink>."},mayProduceInaccurateInformationNoAuthKorea:{id:"thread.chatgptMayProduceInaccurateInformationNoAuthKorea-may-06",defaultMessage:"By messaging ChatGPT, you agree to our <termsLink>Terms</termsLink> and have read our <privacyLink>Privacy Policy</privacyLink> and its <koreaAddendumLink>Korea addendum</koreaAddendumLink>."},businessDisclaimer:{id:"thread.businessDisclaimer-oct-30",defaultMessage:"{workspaceName} workspace chats aren't used to train our models. ChatGPT can make mistakes."},businessDisclaimerNoName:{id:"thread.businessDisclaimerNoName-oct-30",defaultMessage:"Your workspace chats aren'ts used to train our models. ChatGPT can make mistakes."},outdatedGptDisclaimer:{id:"thread.outdatedGptDisclaimer.0",defaultMessage:"<bold>New version of GPT available</bold> - Continue chatting to use the old version, or start a <link>new chat</link> for the latest version."},somethingWentWrong:{id:"thread.modal.unrecoverableError.title",defaultMessage:"Something went wrong"},tryAgainLater:{id:"thread.modal.unrecoverableError.description",defaultMessage:"We're sorry, but something went wrong. Please try again later."},resetThread:{id:"thread.modal.unrecoverableError.resetThread",defaultMessage:"Reset thread"},sharedConversationReportConversation:{id:"thread.sharedConversation.report",defaultMessage:"Report conversation"},latencyButton:{id:"thread.latencyButton",defaultMessage:"Latency"},archivedConversationDescription:{id:"thread.archivedConversationDescription",defaultMessage:"This conversation is archived. To continue, please unarchive it first."},unarchiveButton:{id:"thread.unarchiveButton",defaultMessage:"Unarchive"}});function Fd({clientThreadId:t}){const e=rt(t);return e!=null?s.jsx(Rd,{clientThreadId:t,gizmoId:e}):s.jsx(vo,{clientThreadId:t})}function Rd({clientThreadId:t,gizmoId:e}){const n=ns(e).data,a=Vn(i=>os.getThreadCreateTime(t,i)),o=(n==null?void 0:n.gizmo.updated_at)!=null?new Date(n.gizmo.updated_at):void 0;return(n==null?void 0:n.gizmo.short_url)==null||o==null||a==null||o<=a?s.jsx(vo,{clientThreadId:t}):s.jsxs("div",{className:"text-token-text-tertiary",children:[s.jsx(Nl,{className:"text-token-secondary mb-1 mr-1 inline-block h-4 w-4 stroke-0"}),s.jsx(F,{...$e.outdatedGptDisclaimer,values:{link:i=>s.jsx(ii,{to:vi(n.gizmo.short_url),className:"underline",children:i}),bold:i=>s.jsx("span",{className:"text-token-secondary font-semibold",children:i})}})]})}function Pd({clientThreadId:t}){return Dr(n=>n.hasAcceptedFooterDisclaimer)?s.jsx("div",{children:s.jsx(F,{...$e.mayProduceInaccurateInformation})}):s.jsx(Dd,{clientThreadId:t})}function vo({clientThreadId:t}){const e=Ds(Wn.isBusinessWorkspace),n=Ds(d=>d.currentWorkspace),a=n==null?void 0:n.name,{isUnauthenticated:o,isLoading:i}=Pt(),c=to({clientThreadId:t,role:xe.User})>0;return i?null:e?s.jsx("div",{children:a!=null?s.jsx(F,{...$e.businessDisclaimer,values:{workspaceName:a}}):s.jsx(F,{...$e.businessDisclaimerNoName})}):o&&!c?s.jsx(ri,{children:s.jsx(Pd,{clientThreadId:t})}):s.jsx("div",{children:s.jsx(F,{...$e.mayProduceInaccurateInformation})})}function Dd({clientThreadId:t}){const{country:e}=li(),n=e==="KR"?$e.mayProduceInaccurateInformationNoAuthKorea:$e.mayProduceInaccurateInformationNoAuthV2,{layer:a}=Ft("3637408529"),o=(a==null?void 0:a.get("should_show_disclaimer_only_once_per_device",!1))??!1;return m.useEffect(()=>()=>{to({clientThreadId:t,role:xe.User})>0&&Lr.updateHasAcceptedFooterDisclaimer(o)},[t,o]),s.jsx("span",{className:"text-sm leading-none",children:s.jsx(F,{...n,values:{privacyLink:i=>s.jsx("a",{href:"https://openai.com/privacy",target:"_blank",className:"text-token-text-primary underline decoration-token-text-primary",onClick:()=>{Oe.logEvent("chatgpt_footer_disclaimer_privacy_link_clicked"),ee.logEvent($.footerDisclaimerPrivacyLinkClicked)},rel:"noreferrer",children:i}),termsLink:i=>s.jsx("a",{href:"https://openai.com/terms",target:"_blank",className:"text-token-text-primary underline decoration-token-text-primary",onClick:()=>{Oe.logEvent("chatgpt_footer_disclaimer_terms_link_clicked"),ee.logEvent($.footerDisclaimerTermsLinkClicked)},rel:"noreferrer",children:i}),koreaAddendumLink:i=>s.jsx("a",{href:"https://openai.com/ko/policies/kr-privacy-policy-addendum",target:"_blank",className:"text-token-text-primary underline decoration-token-text-primary",onClick:()=>{Oe.logEvent("chatgpt_footer_disclaimer_korea_addendum_link_clicked"),ee.logEvent($.footerDisclaimerKoreaAddendumLinkClicked)},rel:"noreferrer",children:i})}})})}function Ld({clientThreadId:t}){const e=Pa(),n=$s(t),a=async()=>{n&&(await Me.patchConversation(n,{is_archived:!1}),e.invalidateQueries({queryKey:["conversation",t]}),Vn.setState(o=>{const i=o.threads[n];i!=null&&(i.initialThreadData.isArchived=!1)}),Dl(e))};return s.jsxs("div",{className:"my-6 flex flex-col items-center justify-center gap-4",children:[s.jsx("div",{className:"px-3 text-center text-sm text-token-text-secondary",children:s.jsx(F,{...$e.archivedConversationDescription})}),s.jsx("div",{children:s.jsx(nt,{disabled:!n,onClick:a,icon:El,children:s.jsx(F,{...$e.unarchiveButton})})})]})}function Od(t,e){const n=Yt(t),a=G.getTitle(t);return e&&e.kind===at.GizmoInteraction&&e.gizmo?n?`ChatGPT - ${e.gizmo.gizmo.display.name}`:a&&`${e.gizmo.gizmo.display.name} - ${a}`:n?"ChatGPT":a}const uu=function({clientThreadId:t,initiallyHighlightedMessageId:e,continueConversationUrl:n,onCompletionFinished:a,preRequestCompletion:o,hideHeader:i,hideMessages:l,hideFooter:c,hideToolsOverlay:d,messagesVerticalAlign:h="top",prependThreadChildren:p,renderEmptyState:f}){var ct;const y=Pa(),S=$o(),C=m.useContext(Na),g=C!=null,b=Rt(),u=Bs(),x=Ra(),w=Fs(),v=$r(t),A=Ko(),L=g&&((ct=A.query)==null?void 0:ct.action)==="moderate",N=Qa(t),H=qs(t),_=Za(t).isArchived;m.useEffect(()=>{N||(Yt(t)?Ns.addTiming("chatgpt.web.chatPage.renderNewConversation"):Ns.addTiming("chatgpt.web.chatPage.renderExistingConversation"))},[t,N]);const B=ul(t,H),W=eo(t,H),D=Ja(t),{setTargetedContent:Y}=xr(),T=u==null?void 0:u.includes(Qo),R=br(),k=W>=2,Q=Yt(t)&&!k&&fn(v),z=Yt(t)&&!B&&(fn(v)||(v==null?void 0:v.kind)===at.GizmoTest),te=fi().id,ne=pi(t)??te,{value:Ue}=Es("4203174056"),be=xi(t,Yo.Search),Qe=$a(ne),Xe=Da()[ne],je=Od(t,v),Ae=Ks(t),He=yr(),is=Kr(t),{config:Dt}=Xo("1013114931"),Ys=Dt.get("show_follow_ups",!1)&&(b==null?void 0:b.isPersonalAccount()),lt=!w.displayingSideBySideFeedback&&Ys,rs=xt();m.useEffect(()=>{sa()},[]),m.useEffect(()=>{He||Y(void 0),G.getLastMessgageSystemHints(t,H).includes(Rs.Search)&&be?na.addPersistedSystemHint(Rs.Search):na.clear()},[t,Y,He,H,S.search,be]);const ls=m.useCallback(O=>{if(O==null||(a==null||a(O),rs)||((Ae==null?void 0:Ae.kind)===at.GizmoInteraction&&bi.handleGizmoInteracted(y,Ae.gizmo_id),!(is||lt)))return;const ae=G.getThreadCurrentLeafId(O),me=G.getTree(O).getMessage(ae);Jo(me)||Zo(me)||vr(O,me.id,ne)},[y,a,Ae,is,lt,ne,rs]),Xs=hl(t),Lt=Qr(t,Xs,ls),Ot=m.useCallback(()=>{const O=G.getThreadCurrentLeafId(t);if(O==null)return;const ae=G.getTree(t).getBranchFromLeaf(O);Sr.abortRequests(ae.map(me=>me.id))},[t]),U=as(),{isUnauthenticated:Be}=Pt(),cs=Cr(),We=m.useCallback(async({type:O,promptId:he,requestedModelId:ae,eventMetadata:me,cancelActiveRequests:Je,focusOnNewCompletion:wt=!0,useDefaultModel:dt,completionMetadata:Ve,appendMessages:rn,updateTree:ln,turnTracker:cn,extraStreamParams:Wt})=>{sa(),wr.reset(),Je&&Ot();const dn=performance.now();let Vt=ne;ae?Vt=ae:dt&&(Vt=te);const le=Mr({namespace:_r.CompletionRequest,key:he});le==null||le.logTiming("start_chat_requirements");const K=await ei();le==null||le.logTiming("fetched_chat_requirements"),K.force_login&&cs({authType:"login"});const ce=await ti.getEnforcementToken(K);le==null||le.logTiming("fetched_arkose_token");const ut=await kr.getEnforcementToken(K);le==null||le.logTiming("fetched_turnstile_token");const un=await si.getEnforcementToken(K);le==null||le.logTiming("fetched_p_token"),o==null||o(t,he),Lt({model:Vt,completionType:O,parentNodeId:he,metadata:me,focusOnNewCompletion:wt,completionMetadata:Ve,chatReq:K,arkoseToken:ce??null,turnstileToken:ut??null,proofToken:un??null,preflightTime:performance.now()-dn,extraStreamParams:{forceParagen:U.forceParagen,forceParagenModel:U.forceParagenModel.value,forceNulligen:U.forceNulligen,forceRateLimit:U.forceRateLimit,resetRateLimits:U.resetRateLimits,disableSystemContentToggling:U.rebaseSystemMessageContent?!0:void 0,forceUseSearch:U.forceUseSearch??(Wt==null?void 0:Wt.forceUseSearch)},appendMessages:rn,updateTree:ln,turnTracker:cn}),Be&&Tr.incrementUserMessageCount()},[te,ne,o,t,Lt,U.forceParagen,U.forceParagenModel,U.forceNulligen,U.forceRateLimit,U.resetRateLimits,U.rebaseSystemMessageContent,U.forceUseSearch,Ot,cs,Be]),vt=!!(b!=null&&b.features.includes(Gs.SharedWebsocket));m.useEffect(()=>{vt&&pn.registerIfNotConnected()},[vt]),m.useEffect(()=>{const O=()=>{if(document.visibilityState==="visible"){if(!vt)return;pn.registerIfNotConnected()}};return document.addEventListener("visibilitychange",O),()=>{document.removeEventListener("visibilitychange",O)}},[vt]);const zt=$s(t);m.useEffect(()=>{const O=()=>{pn.stopConversation(zt)};return window.addEventListener("beforeunload",O),()=>{window.removeEventListener("beforeunload",O)}},[zt]);const ds=yi({clientThreadId:t,currentLeafId:H,handleRequestCompletion:We}),Js=m.useCallback((O,he,ae,me=!0,Je="none",wt)=>{const Ve=G.getTree(t).getParentPromptNode(O).id;We({type:Ia.Variant,promptId:Ve,eventMetadata:he,cancelActiveRequests:!1,focusOnNewCompletion:me,useDefaultModel:wt,completionMetadata:{variantPurpose:Je,conversationMode:os.getConversationMode(t)},turnTracker:ae})},[We,t]),Zs=m.useCallback(O=>{const ae=G.getTree(t).getLeafFromNode(O);G.setThreadCurrentLeafId(t,ae.id)},[t]),[ye,Ut]=m.useState(),en=m.useCallback(({nodeId:O,messageId:he,rating:ae})=>{var dt;const me=G.getServerThreadId(t);ee.logEvent($.thumbRating,{id:he,threadId:me,rating:ae,model:ne});const Je=G.getTree(t),wt=Je.getNodeByIdOrMessageId(O);if(me!==void 0&&(Qe?gt:Me.submitMessageFeedback)({message_id:he,conversation_id:me,rating:ae}),G.updateTree(t,Ve=>{Ve.updateNodeMetadata(O,{rating:ae})}),Qe){Ut(s.jsx(Id,{citations:((dt=wt.message.metadata)==null?void 0:dt.citations)??[],rating:ae,conversationId:me??"",messageId:he,onSubmit:()=>{Ut(void 0)},onCancel:()=>Ut(void 0),conversationTree:Je,nodeId:O},`${O}-${ae}`));return}},[t,ne,Qe]),{setShowReferralInviteModal:us}=aa(O=>({setShowReferralInviteModal:O.setShowReferralInviteModal})),hs=m.useCallback(()=>{us(!1)},[us]),ms=aa(O=>O.showReferralInviteModal);_d({clientThreadId:t,currentModelId:ne});const Bt=O=>g?s.jsx("div",{className:"h-full overflow-auto bg-token-main-surface-primary",children:O}):s.jsx(Gl,{scrollAnchorTopOffset:i?0:Pr,children:h==="bottom"?s.jsxs("div",{className:"flex h-full flex-col",children:[s.jsx("div",{className:"flex-1"}),O]}):O});m.useEffect(()=>{document.title=je??"ChatGPT"},[je]);const tn=rt(t),gs=xt(),fs=Jl(),St=z&&!f&&x&&!tn&&!Qe&&!gs,Gt=St&&fs,Ht=Xl(St),ps=Zl(Gt),xs=St&&Ht||Gt&&ps,bs=Ht||ps,{composerBarSize:sn,composerSkeleton:ys,footerBarSize:nn,isClippedComposerBar:Ge,setComposerBarElement:vs,setFooterBarElement:an,ThreadSizeWrapper:Ct}=jr({isArchived:_}),on=Ge?{footerBarSize:nn,composerBarSize:sn}:{};return s.jsxs(Ct,{...on,children:[T&&s.jsx(Ad,{}),Ue&&s.jsx(Ed,{}),s.jsxs(ni,{children:[je!=null&&s.jsx("title",{children:je}),g&&s.jsxs(s.Fragment,{children:[s.jsx("meta",{property:"og:site_name",content:"ChatGPT"}),s.jsx("meta",{name:"robots",content:C.isIndexable?"index,nofollow":"noindex,nofollow"},"robots"),s.jsx("meta",{property:"og:title",content:je??"Shared Chat on ChatGPT"},"og:title"),s.jsx("meta",{property:"og:description",content:"Shared "+(D!=null?`by ${D} `:"")+"via ChatGPT"},"og:description"),s.jsx("meta",{property:"og:image",content:ai.src},"og:image")]})]}),(v==null?void 0:v.kind)===at.GizmoInteraction&&v.gizmo&&s.jsx(Si,{gizmo:v.gizmo}),s.jsx(Ea.Provider,{value:We,children:s.jsxs(Ar,{children:[s.jsxs(Yr,{clientThreadId:t,currentModelConfig:Xe,className:"composer-parent flex h-full flex-col focus-visible:outline-0",children:[!l&&s.jsx(zd,{className:se(Ge&&"masked-content"),style:{"--composer-bar_skeleton":ys},children:!N&&!ds?z?f??s.jsx(Zn,{shouldSSR:!bs,children:s.jsx(yc,{clientThreadId:t,currentModelId:ne,onRequestCompletion:We,enableV2Homepage:xs})}):k?Bt(s.jsxs(s.Fragment,{children:[p,s.jsx(wd,{onChangeItemInView:Zs,onRequestMoreCompletions:Js,onChangeRating:en,onRequestCompletion:We,clientThreadId:t,initiallyHighlightedMessageId:e,inlineEmbeddedDisplay:!1,conversationLeafId:H,hideHeader:i},t)]})):null:null}),s.jsx(Ud,{className:se(Ge&&"mask-scrollbars absolute bottom-0 z-20"),children:_?s.jsx(Ld,{clientThreadId:t}):s.jsxs("div",{className:se(Ge&&"relative mx-auto flex max-w-3xl flex-1 flex-col"),children:[Ge?s.jsx(Nr,{skeleton:ys}):null,g?s.jsx(uc,{clientThreadId:t,isModeratingThread:L,continueConversationUrl:n}):!xs&&s.jsx(Zn,{shouldSSR:!bs,children:s.jsx(Xr,{clientThreadId:t,isNewThread:Q,setComposerBarElement:vs,showPromptStarters:Q||!B,currentModelId:ne,onRequestCompletion:We})}),!c&&s.jsx("div",{ref:an,className:"relative w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",children:g?s.jsx(Er,{onClickReportSharedConversation:()=>{Ws.openModal(Xt.ReportConversation)}}):fn(v)&&s.jsx("div",{className:"min-h-4",children:s.jsx(Fd,{clientThreadId:t})})})]})})]}),!d&&s.jsxs("div",{className:"group absolute bottom-2 end-2 z-20 hidden gap-1 md:flex lg:bottom-3 lg:end-3",children:[R?s.jsxs(s.Fragment,{children:[s.jsx(jd,{}),s.jsx(Nd,{})]}):null,s.jsx(Il,{})]}),ye,s.jsx(Ci,{serverThreadId:(C==null?void 0:C.serverSharedThreadId)??void 0,clientThreadId:t,isStaticSharedThread:g}),s.jsx(cc,{clientThreadId:t}),s.jsx(Ir,{}),(u==null?void 0:u.includes(oi))&&s.jsx(Fr,{isOpen:ms,onClose:hs}),s.jsx(Rr,{conversationId:t,currentModelId:ne})]})})]})},zd=Ke.div`grow flex-1 overflow-hidden`,Ud=Ke.div`md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent w-full`;export{Yl as C,uu as T,wd as a,fd as b,yd as m};
//# sourceMappingURL=clpw4epg4cg2d8f6.js.map
