const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/n87n7wnthv338n3k.js","assets/l8rxl89ki17pr98v.js","assets/niys9t9a5yd9d6hx.js","assets/root-br6a8pf9.css","assets/sso-jcpt3wpwa77ct2gh.js","assets/e5vof8gm97tserr9.js","assets/conversation-small-c8xg50op.css","assets/capudsrkh7w1vqn7.js","assets/gkunztsgik0aqyg7.js","assets/df1b7c14snj67tn9.js","assets/lbop392ix8ac1c7q.js","assets/nhwwej1nq0zrd7sc.js","assets/ftl72c2hlpp4f6dl.js","assets/o3g721mzy7gmgoww.js","assets/e7ac753yin3eac1x.js","assets/dkhngphbavt3kpt0.js","assets/luv4utua0o7oqp3f.js","assets/k5k0u70sshqn9l9b.js","assets/jl1h9jqa7gh9sjvc.js","assets/71f49l1kza5z634d.js","assets/et77vbu01vp6pvqt.js","assets/fyu3449k0cvp839t.js","assets/onkccjoyf6ouy7av.js","assets/gwhhb7qc7de07wo6.js","assets/k9taq4badzaso94p.js","assets/j121ml04l3ojcxtv.js","assets/hwzzakj3cx7tavbm.js","assets/ijox9dgs6ru4cb5y.js","assets/bx0chg4lqr8qiv8d.js","assets/kxtspueuxbdes089.js","assets/kgzroebcdh3i3f37.js","assets/d0g8ptgc5gcqjwyj.js","assets/o4hfkempnzzphymg.js","assets/jp6h8mmq9ut2s9ci.js","assets/isjdmfmhzv09v01t.js","assets/nzandgggesmysap7.js","assets/os9ksyx5fdddd8dt.js","assets/gtdc2nv2akxinwta.js","assets/om2uedl2a067zbvk.js","assets/my0vuev0yavb4hyt.js","assets/m1dw2mao2pbmru98.js","assets/ggw035cutjx60oao.js","assets/die0aqzgladqcmp2.js","assets/fn4vfah112zii1gl.js","assets/ctxp7fhho5smaqvf.js","assets/nwoav42peuifzvol.js","assets/ehavoypsbcyupg9k.js","assets/ncqmqsji36uic6wy.js","assets/cigtw697xp5ojbuw.js","assets/l17656ykny5ahl55.js","assets/g11fi263w9k5e46u.js","assets/g8i3rjwu4nmw0zcz.js","assets/jrhwsog740hzbp5u.js","assets/kqwdyvkaaavvn8k3.js","assets/d12eh8wov2oxolf8.js","assets/emmsfvgusxzjupf1.js","assets/iluyl4w9cpjg3c9f.js","assets/daevy6i15x9nlj7d.js","assets/gdxj1ao7vl9q46n7.js","assets/m95s2s414c5cjkje.js","assets/j5g2gd52a9p9xm2p.js","assets/ighjyarnxfm20w3b.js","assets/n00t4vf36qid6yh9.js","assets/iej0cupg2dqkmejt.js","assets/b0rjnj2e4njwr9o9.js","assets/jk8w36bsokizpx57.js","assets/hbt8jsrxro9opmsc.js","assets/dl2ntke3a0vlntdv.js","assets/d8ce5xweatfn88ix.js","assets/mwtz6muem1l28fm3.js","assets/gktwczoykurdafeo.js","assets/o846ieje0ajgs6k0.js","assets/k9sewidnufjjid16.js","assets/f0uwovd54nmpnr3s.js","assets/bniq8lqg5lxwfkoy.js","assets/shared-mk6ngktc.css","assets/sso-bibvzye1.css","assets/cyxx35mi27w6zas0.js","assets/oigm1o02katmi446.js","assets/o7tg2hyicap3122c.js","assets/bisry3gjq9ezwdys.js","assets/fsddy3bxlesj6ecw.js","assets/d9y7jsw60z5vw3pb.js","assets/k7yhdxhhiqc38pq4.js","assets/cu7i7jyqvstu6net.js","assets/o2a8sjdqs8rcel0d.js"])))=>i.map(i=>d[i]);
import{O as Oe,j as e,K as u,aD as Ce,r as h,bL as W,H as z,E as Be,ar as Le,I as ue,M as be,J as Re,dn as Q,bg as re,fz as rt,bA as ga,aa as it,fA as ot,Z as xa,fB as ha,fC as ja,fD as va,ce as ya,a0 as lt,fE as ba,dS as ka,dQ as ws,cT as ct,cU as dt,cj as ut,fF as wa,dR as Ma,fG as Ta,fH as _a,bz as Na,Y as Sa,co as Fe,c3 as Ee,a6 as ke,c as ie,u as Pa,R as $e,a7 as Z,N as he,az as ft,bo as pt,aN as Ms,bW as mt,bS as as,P as gt,A as xt,aA as ht,bU as Ts,bY as Ca,eW as jt,w as vt,bR as Te,fe as Ia,bq as Ue,cQ as fe,ca as Aa,d9 as yt,da as bt,db as kt,e4 as wt,eg as Ie,a4 as ps,fI as La,d4 as Ua,X as Ra,e$ as Ga,y as Us,L as Rs,d8 as Oa}from"./l8rxl89ki17pr98v.js";import{bq as x,a2 as Mt,aN as Ae,ax as oe,as as Xe,Q as Ba,hI as Tt,hJ as _t,hK as Nt,fm as F,b0 as St,hL as Pt,hM as Fa,hN as ms,hO as Ea,aj as gs,hP as ee,hQ as Ke,b2 as $a,gQ as Gs,gm as Wa,hR as Ge,bp as Je,bR as Ct,bT as qa,at as It,au as At,e8 as Ha,hS as Ka,U as _s,dJ as Lt,hT as Va,dK as Ut,dL as Rt,dO as Ya,dM as ne,hU as Qa,dN as Xa,dP as Ja,dQ as xs,dR as Za,hV as za,hW as Os,hX as ns,hY as Da,cH as Bs,cr as Gt,H as Ns,cs as en,A as sn,cw as tn,hZ as Fs,j as Ot,aZ as an,q as Bt,h_ as Ft,bv as Et,h$ as nn,a0 as $t,c3 as rn,i0 as on,bs as ln,w as cn,el as dn}from"./e5vof8gm97tserr9.js";import{d as Wt,K as qt,I as Ht,j as Ss,B as un,a as Kt,c as fn,k as pn,L as mn,M as gn,N as xn,O as hn,P as jn,Q as Es}from"./lbop392ix8ac1c7q.js";import{x as vn,E as hs,o as es,Y as Vt,b4 as js,a0 as Ve,Z as yn,az as bn,q as kn,aZ as rs,bd as Ze,aX as Yt,bk as Qt,T as Xt,aw as wn,bn as Mn,aB as Tn,aA as _n,S as Nn,z as Sn,ae as Pn,B as Cn,ay as In,bJ as An}from"./niys9t9a5yd9d6hx.js";import{a as J,F as ae,c as vs,b as is,G as Ln}from"./gdxj1ao7vl9q46n7.js";import{u as Un,H as Rn,l as Ye,T as B}from"./gkunztsgik0aqyg7.js";import{u as Gn}from"./die0aqzgladqcmp2.js";import{_ as On}from"./fsddy3bxlesj6ecw.js";import{G as Ps}from"./k5k0u70sshqn9l9b.js";import{G as Bn}from"./d9y7jsw60z5vw3pb.js";import{D as E,B as Cs}from"./capudsrkh7w1vqn7.js";import{S as Y}from"./bx0chg4lqr8qiv8d.js";import{G as Fn}from"./jl1h9jqa7gh9sjvc.js";import{ad as We,ae as En,af as $n,ag as Wn,y as Jt,z as Zt,W as qn,u as zt}from"./e7ac753yin3eac1x.js";import{G as Hn}from"./k7yhdxhhiqc38pq4.js";import{m as Dt}from"./df1b7c14snj67tn9.js";import{a as Kn}from"./cu7i7jyqvstu6net.js";import{G as Vn}from"./luv4utua0o7oqp3f.js";import{i as ys}from"./o2a8sjdqs8rcel0d.js";function ea(s){return s==x.User||s==x.Group?x.Private:s==x.WorkspaceLink?x.Workspace:s}function de(s,t){return s=ea(s),t===void 0?!1:t.some(a=>a.recipient===s&&a.allowed)}function Is(s,t){if(t===void 0)return[];s=ea(s);const a=t.find(r=>r.recipient===s);return a==null?void 0:a.moderated_fields}function os(s,t){const a=Is(s,t);return a&&a.length>0}const $s=Oe.a`bold underline`,Yn=Oe.textarea`w-full text-sm overflow-y-auto rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400 border-token-border-medium bg-token-main-surface-primary h-32`;var we=(s=>(s[s.None=0]="None",s[s.AppealAvailable=1]="AppealAvailable",s[s.AppealSent=2]="AppealSent",s))(we||{}),ss=(s=>(s[s.None=0]="None",s[s.PublishBlocked=1]="PublishBlocked",s[s.RemovedFromMarketplace=2]="RemovedFromMarketplace",s[s.RemovedFromPublic=3]="RemovedFromPublic",s[s.RemovedFromPrivate=4]="RemovedFromPrivate",s[s.Recategorized=5]="Recategorized",s))(ss||{});function Qn(s){var r;if(!s)return;const t=((r=s.gizmo.appeal_info)==null?void 0:r.state.kind)==="appeal_sent",a=Xn(s.gizmo.share_recipient,s.gizmo.sharing_targets);return{sharingRecipient:s.gizmo.share_recipient,categories:s.gizmo.categories,gizmoId:s.gizmo.id,moderationType:a,sharingTargets:s.gizmo.sharing_targets,showModal:t?2:a!==0?1:0}}const Ws={[x.User]:x.Private,[x.Group]:x.Private,[x.WorkspaceLink]:x.Workspace};function Xn(s,t=[]){const a=new Set(t.filter(n=>n.allowed).map(n=>n.recipient));if(!s||(s in Ws&&(s=Ws[s]),a.has(s)))return 0;const r=a.has(x.Private)||a.has(x.Workspace),i=a.has(x.Link)||a.has(x.Marketplace);return s===x.Marketplace&&i?2:!i&&r?3:4}function qs(s){switch(s){case 0:case 1:return W({id:"gizmo.appeals.publishBlockedTitle",defaultMessage:"Your changes couldn’t be published"});case 2:return W({id:"gizmo.appeals.removedFromMarketplaceTitle",defaultMessage:"Your GPT has been removed from the marketplace"});case 3:return W({id:"gizmo.appeals.removedFromPublicTitle",defaultMessage:"Your GPT has been removed from public view"});case 5:return W({id:"gizmo.appeals.recategorizedTitle",defaultMessage:"Your GPT has been recategorized"});default:Mt(s)}}function Jn(s){switch(s){case"profile_picture":return W({id:"gizmo.appeals.profilePictureFieldName",defaultMessage:"Profile Picture"});case"gizmo_name":return W({id:"gizmo.appeals.gizmoNameFieldName",defaultMessage:"Name"});case"gizmo_description":return W({id:"gizmo.appeals.gizmoDescriptionFieldName",defaultMessage:"Description"});case"gizmo_instructions":return W({id:"gizmo.appeals.gizmoInstructionsFieldName",defaultMessage:"Instructions"});case"gizmo_welcome_message":return W({id:"gizmo.appeals.gizmoWelcomeMessageFieldName",defaultMessage:"Welcome Message"});case"custom_actions":return W({id:"gizmo.appeals.customActionsFieldName",defaultMessage:"Custom Actions"});case"conversation_starter":return W({id:"gizmo.appeals.conversationStarterFieldName",defaultMessage:"Conversation Starter"});case"file":return W({id:"gizmo.appeals.fileFieldName",defaultMessage:"File"});case"gizmo_combined_content":return W({id:"gizmo.appeals.gizmoCombinedContentFieldName",defaultMessage:"Overall GPT Config"})}}function Zn(s){switch(s){case x.Private:case x.Workspace:return W({id:"gizmo.appeals.privateRecipientModerationText",defaultMessage:"Your GPT can’t be updated because it violates our {usagePolicyLink}Usage Policies{usagePolicyLink}."});case x.Link:return W({id:"gizmo.appeals.linkRecipientModerationText",defaultMessage:"Your GPT can’t be shared publicly because it violates our {usagePolicyLink}Usage Policies{usagePolicyLink}."});case x.Marketplace:return W({id:"gizmo.appeals.marketplaceRecipientModerationText",defaultMessage:"Your GPT can’t appear in the Explore GPTs page because it violates our {usagePolicyLink}Usage Policies{usagePolicyLink}."});default:Mt(s)}}function sa({sharingRecipient:s,moderatedFields:t,appealAvailable:a}){const r=t.length;return e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx(u,{...Zn(s),values:{usagePolicyLink:i=>e.jsx($s,{target:"_blank",href:"https://openai.com/policies/usage-policies",rel:"noreferrer",children:i})}})," ",r>0&&e.jsx(u,{id:"gizmo.appeals.seeBelowForSpecificIssues",defaultMessage:`{numModeratedFields, plural,
              one {See below for the specific issue:}
              other {See below for the specific issues:}
            }`,values:{numModeratedFields:r}})]}),r>0&&(t==null?void 0:t.map(i=>e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-bold",children:e.jsx(u,{...Jn(i.name)})}),e.jsx("ul",{className:"list-disc pl-5",children:i.reasons.map(n=>e.jsxs("li",{children:[n.description," ",n.link?e.jsx($s,{href:n.link,target:"_blank",rel:"noreferrer",children:e.jsx(u,{id:"gizmo.appeals.learnMore",defaultMessage:"Learn more"})}):""]},n.description))})]}))),a&&e.jsx("p",{children:e.jsx(u,{id:"gizmo.appeals.appealAvailableText",defaultMessage:"Alternatively you may appeal this decision and we will get back to you as soon as possible. Or you can publish to “Only me” and use this GPT privately."})})]})}function zn({gizmoId:s,sharingRecipient:t,categories:a,moderationType:r,sharingTargets:i,appealAvailable:n,onClose:l,onAppealSubmitted:o}){const f=z(),[j,y]=h.useState(""),[v,c]=h.useState(0),p=Be(),m=async()=>{await Ae.postGizmoAppeal(p,s,j,t,a),c(2),o==null||o()},d=Is(t,i),b=(d==null?void 0:d.length)??0,g=Le();if(b==0&&(g==null?void 0:g.isEnterprisey()))return e.jsx(ue,{title:f.formatMessage(qs(r)),isOpen:!0,onClose:l,showCloseButton:!0,type:"warning",primaryButton:e.jsx(be.Button,{color:"primary",onClick:l,children:e.jsx(u,{id:"wEsAOU",defaultMessage:"OK"})}),children:e.jsx("p",{className:"text-sm",children:e.jsx(u,{id:"gizmo.appeals.workspaceSettingsMessage",defaultMessage:"Access to your GPT has been reduced by your workspace's GPT sharing settings. An owner of the workspace can change these settings in the workspace settings page."})})});switch(v){case 0:return e.jsx(ue,{title:f.formatMessage(qs(r)),isOpen:!0,onClose:l,showCloseButton:!0,primaryButton:e.jsx(be.Button,{color:"primary",onClick:l,children:e.jsx(u,{id:"gizmo.appeals.contunueButton",defaultMessage:"Continue"})}),secondaryButton:n?e.jsx(be.Button,{onClick:()=>c(1),children:e.jsx(u,{id:"gizmo.appeals.appealButton",defaultMessage:"Appeal"})}):void 0,type:"warning",children:e.jsx("div",{className:"flex flex-col gap-2 text-sm",children:e.jsx(sa,{sharingRecipient:t,moderatedFields:d??[],appealAvailable:n})})});case 1:return e.jsx(ue,{title:f.formatMessage({id:"gizmo.appeals.appealModalTitle",defaultMessage:"Appeal"}),isOpen:!0,onClose:l,showCloseButton:!0,shouldIgnoreClickOutside:!0,primaryButton:e.jsx(be.Button,{color:"primary",onClick:m,disabled:j.trim().length===0,children:e.jsx(u,{id:"gizmo.appeals.submitAppealButton",defaultMessage:"Submit"})}),secondaryButton:e.jsx(be.Button,{onClick:()=>c(0),children:e.jsx(u,{id:"gizmo.appeals.backButton",defaultMessage:"Back"})}),type:"warning",children:e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsx("p",{children:e.jsx(u,{id:"gizmo.appeals.appealReasonText",defaultMessage:"Please provide a reason for why you believe this GPT doesn’t violate our policies and should be published"})}),e.jsx(Yn,{value:j,onChange:S=>y(S.target.value)})]})});case 2:return e.jsx(e.Fragment,{})}}function Dn({onClose:s}){const t=z();return e.jsx(ue,{title:t.formatMessage({id:"gizmo.appeals.appealSubmittedModalTitle",defaultMessage:"Appeal submitted"}),isOpen:!0,onClose:s,showCloseButton:!0,primaryButton:e.jsx(be.Button,{color:"primary",onClick:s,children:e.jsx(u,{id:"gizmo.appeals.closeButton",defaultMessage:"Close"})}),type:"success",children:e.jsx("div",{className:"flex flex-col gap-2 text-sm",children:e.jsx("div",{children:e.jsx(u,{id:"gizmo.appeals.appealSubmittedText",defaultMessage:"Your appeal has been submitted. We will get back to you as soon as possible."})})})})}function er({gizmoId:s,onClose:t}){const{data:a}=Wt(s,!0),r=Be(),i=async()=>{await Ae.postGizmoCancelAppeal(r,s)};return e.jsx(ue,{isOpen:!0,onClose:Re,primaryButton:e.jsx(be.Button,{color:"primary",onClick:()=>{i(),t==null||t()},children:e.jsx(u,{id:"gizmo.appeals.cancelAppealButton",defaultMessage:"Cancel appeal"})}),type:"warning",children:e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsx("h2",{className:"text-lg font-semibold",children:e.jsx(u,{id:"gizmo.appeals.appealReviewingHeader",defaultMessage:"Reviewing your appeal"})}),e.jsx("p",{children:e.jsx(u,{id:"gizmo.appeals.appealSentModalText",defaultMessage:"During the review you can continue using “{gizmoName}” as your private GPT, but won’t be able to update it or share it with others.",values:{gizmoName:a==null?void 0:a.gizmo.display.name}})})]})})}function sr({appealState:s,onAppealClose:t,onAppealSubmitted:a}){const{value:r}=Ce("4226692983"),[i,n]=h.useState(!1);return i?e.jsx(Dn,{onClose:()=>{n(!1),a==null||a()}}):e.jsxs(e.Fragment,{children:[(s==null?void 0:s.showModal)==2&&e.jsx(er,{gizmoId:s.gizmoId,onClose:t}),(s==null?void 0:s.showModal)==1&&e.jsx(zn,{gizmoId:s.gizmoId,sharingRecipient:s.sharingRecipient,categories:s.categories,moderationType:s.moderationType,sharingTargets:s.sharingTargets,appealAvailable:r,onClose:()=>t==null?void 0:t(),onAppealSubmitted:()=>n(!0)})]})}function tr({gizmoEditorData:s,onOpen:t}){var n;const a=(n=s==null?void 0:s.tools)==null?void 0:n.find(l=>l.type===Q.INTENT&&"prompt_config"in l.settings),[r]=h.useState((a==null?void 0:a.settings.prompt_config)??[]),[i]=h.useState((a==null?void 0:a.settings.state_keys)??[]);return e.jsxs(ae,{children:[e.jsx("div",{className:"text-sm",children:e.jsx(J,{label:"Blocks + State",description:"Blocks and State for your GPT"})}),e.jsxs("div",{className:"mb space-y-1",children:[!(r||i)&&e.jsx("div",{className:"flex text-token-text-primary",children:"Add prompt blocks and state keys to your GPT"}),e.jsx(oe,{onClick:()=>t(),children:r||i?"Show Blocks & State":"Add Blocks & State"})]})]})}function ar({gizmoEditorData:s,updateGizmo:t,onClose:a}){var v;const r=(v=s==null?void 0:s.tools)==null?void 0:v.find(c=>c.type===Q.INTENT&&"prompt_config"in c.settings),[i,n]=h.useState((r==null?void 0:r.settings.prompt_config)??[]),[l,o]=h.useState((r==null?void 0:r.settings.state_keys)??[]),f={key_name:"",description:""},j={prompt_key:"",prompt:"",continuation:"",hidden:!1},y=()=>{t(c=>({...c,tools:r?c.tools.map(p=>p.type===Q.INTENT?{...p,settings:{...p.settings,prompt_config:i,state_keys:l}}:p):[...c.tools,{type:Q.INTENT,settings:{prompt_config:i,state_keys:l}}]}))};return e.jsxs("div",{className:"h-full overflow-auto px-4 pb-12 text-sm",children:[e.jsxs("div",{className:"relative flex flex-col items-center px-16 py-6 text-center",children:[e.jsx("div",{className:"absolute left-0 top-6",children:e.jsx(re,{color:"secondary",onClick:a,icon:vn})}),e.jsx("div",{className:"text-xl font-semibold",children:e.jsx(u,{id:"eIFoMg",defaultMessage:"Blocks & State"})}),e.jsx("div",{className:"text-sm text-token-text-tertiary",children:e.jsx(u,{id:"rdK8Dl",defaultMessage:"Construct your GPT with instruction blocks and state."})}),e.jsx(J,{label:e.jsx("div",{className:"text-sm font-semibold text-token-text-tertiary",children:"Learn more"}),description:e.jsxs("div",{className:"space-y-2 text-sm font-normal",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Blocks"})," allow you to break up your GPT's instructions into smaller sections, letting the GPT decide which to load up in what scenario."]}),e.jsxs("div",{children:[e.jsx("b",{children:"State"})," gives the GPT a per-user storage for data, that will be provided at the start of all new conversations."]})]})})]}),e.jsx(ae,{children:e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"mb-4 space-y-5 text-lg",children:[e.jsx(J,{label:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"Instruction Blocks"}),e.jsx(hs,{className:"icon-sm"})]}),description:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:"Instruction Blocks are added to the end of your GPT's instructions when the GPT decides to use them."}),e.jsx("div",{children:"The GPT only knows these blocks by their name. and your initial GPT instructions must describe how to use at least one of these blocks."})]})}),e.jsxs("div",{className:"space-y-5 text-sm",children:[i.map((c,p)=>e.jsx(nr,{promptKey:c.prompt_key,prompt:c.prompt,continuation:c.continuation,hidden:c.hidden,visible:!1,isDuplicate:i.filter(m=>m.prompt_key===c.prompt_key).length>1,onChange:({promptKey:m,prompt:d,continuation:b,hidden:g})=>{n(k=>{const S=[...k];return S[p]={prompt_key:m,prompt:d,continuation:b,hidden:g},S}),y()},onDelete:({promptKey:m})=>{n(d=>d.filter(b=>b.prompt_key!==m)),y()}},p)),e.jsx(oe,{onClick:()=>{n(c=>[...c,j])},children:"Add Block"})]}),e.jsx(J,{label:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"Saved State"}),e.jsx(hs,{className:"icon-sm"})]}),description:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:"State the GPT can save per-user, that will be provided at the start of all new conversations"}),e.jsx("div",{children:"Your GPT has access to write to these state entries, and read from them."}),e.jsx("div",{children:"The user can see this data."})]})}),l.map((c,p)=>e.jsx(rr,{keyName:c.key_name,description:c.description,isDuplicate:l.filter(m=>m.key_name===c.key_name).length>1,onChange:({keyName:m,description:d})=>{o(b=>{const g=[...b];return g[p]={key_name:m,description:d},g}),y()},onDelete:({keyName:m})=>{o(d=>d.filter(b=>b.key_name!==m)),y()}},p))]}),e.jsx(oe,{onClick:()=>{o(c=>[...c,f])},children:"Add State Data"})]})})]})}function nr({promptKey:s,prompt:t,continuation:a,hidden:r,visible:i,isDuplicate:n,onChange:l,onDelete:o}){h.useState(r);const[f,j]=h.useState(i),y=()=>{j(!f)},v=[];s.length>20&&v.push({msg:"Block names work best when they are short"}),n&&v.push({msg:"Block names must be unique"});const c=v.length>0?Vt:void 0;return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex space-x-2 text-sm",children:[e.jsx(J,{collapsed:!f,label:"Block",onClick:y}),e.jsx(Xe,{name:"promptKey",value:s,onChange:p=>l({promptKey:p.target.value,prompt:t,continuation:a}),icon:c,className:"max-w-xs grow-0",placeholder:"Block name"})]}),v.map(p=>e.jsx("div",{className:"text-xs text-token-text-secondary",children:p.msg},p.msg)),f&&e.jsxs("div",{className:"mb-4 space-y-1",children:[e.jsx(Ba,{rows:5,name:"prompt",value:t,onChange:p=>l({promptKey:s,prompt:p.target.value,continuation:a}),className:"grow",placeholder:"Block Text"}),ir,e.jsx("div",{role:"button",className:"flex items-center space-x-2",onClick:()=>{o({promptKey:s})},children:e.jsx(es,{className:"icon-sm"})})]})]})}function rr({keyName:s,description:t,isDuplicate:a,onChange:r,onDelete:i}){const n=[];s.length>20&&n.push({msg:"State names work best when they are short"}),a&&n.push({msg:"State names must be unique"});const l=n.length>0?Vt:void 0;return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex space-x-2 text-sm",children:[e.jsx(Xe,{name:"key",value:s,onChange:o=>r({keyName:o.target.value,description:t}),icon:l,className:"max-w-xs grow-0",placeholder:"State Name"}),e.jsx(Xe,{name:"description",value:t,onChange:o=>r({keyName:s,description:o.target.value}),className:"max-w-s flex-grow",placeholder:"Description"}),e.jsx("div",{role:"button",className:"flex items-center space-x-2",onClick:()=>{i({keyName:s})},children:e.jsx(es,{className:"icon-sm"})})]}),n.map(o=>e.jsx("div",{className:"text-xs text-token-text-secondary",children:o.msg},o.msg))]})}const ir=!1;function or(s,t){for(var a=-1,r=s==null?0:s.length;++a<r&&t(s[a],a,s)!==!1;);return s}var lr=or,cr=rt,dr=ga;function ur(s,t,a,r){var i=!a;a||(a={});for(var n=-1,l=t.length;++n<l;){var o=t[n],f=r?r(a[o],s[o],o,a,s):void 0;f===void 0&&(f=s[o]),i?dr(a,o,f):cr(a,o,f)}return a}var ts=ur,fr=ts,pr=it;function mr(s,t){return s&&fr(t,pr(t),s)}var gr=mr,xr=ts,hr=ot;function jr(s,t){return s&&xr(t,hr(t),s)}var vr=jr,ze={exports:{}};ze.exports;(function(s,t){var a=xa,r=t&&!t.nodeType&&t,i=r&&!0&&s&&!s.nodeType&&s,n=i&&i.exports===r,l=n?a.Buffer:void 0,o=l?l.allocUnsafe:void 0;function f(j,y){if(y)return j.slice();var v=j.length,c=o?o(v):new j.constructor(v);return j.copy(c),c}s.exports=f})(ze,ze.exports);var yr=ze.exports,br=ts,kr=ha;function wr(s,t){return br(s,kr(s),t)}var Mr=wr,Tr=ts,_r=ja;function Nr(s,t){return Tr(s,_r(s),t)}var Sr=Nr,Pr=Object.prototype,Cr=Pr.hasOwnProperty;function Ir(s){var t=s.length,a=new s.constructor(t);return t&&typeof s[0]=="string"&&Cr.call(s,"index")&&(a.index=s.index,a.input=s.input),a}var Ar=Ir,Hs=va;function Lr(s){var t=new s.constructor(s.byteLength);return new Hs(t).set(new Hs(s)),t}var As=Lr,Ur=As;function Rr(s,t){var a=t?Ur(s.buffer):s.buffer;return new s.constructor(a,s.byteOffset,s.byteLength)}var Gr=Rr,Or=/\w*$/;function Br(s){var t=new s.constructor(s.source,Or.exec(s));return t.lastIndex=s.lastIndex,t}var Fr=Br,Ks=ya,Vs=Ks?Ks.prototype:void 0,Ys=Vs?Vs.valueOf:void 0;function Er(s){return Ys?Object(Ys.call(s)):{}}var $r=Er,Wr=As;function qr(s,t){var a=t?Wr(s.buffer):s.buffer;return new s.constructor(a,s.byteOffset,s.length)}var Hr=qr,Kr=As,Vr=Gr,Yr=Fr,Qr=$r,Xr=Hr,Jr="[object Boolean]",Zr="[object Date]",zr="[object Map]",Dr="[object Number]",ei="[object RegExp]",si="[object Set]",ti="[object String]",ai="[object Symbol]",ni="[object ArrayBuffer]",ri="[object DataView]",ii="[object Float32Array]",oi="[object Float64Array]",li="[object Int8Array]",ci="[object Int16Array]",di="[object Int32Array]",ui="[object Uint8Array]",fi="[object Uint8ClampedArray]",pi="[object Uint16Array]",mi="[object Uint32Array]";function gi(s,t,a){var r=s.constructor;switch(t){case ni:return Kr(s);case Jr:case Zr:return new r(+s);case ri:return Vr(s,a);case ii:case oi:case li:case ci:case di:case ui:case fi:case pi:case mi:return Xr(s,a);case zr:return new r;case Dr:case ti:return new r(s);case ei:return Yr(s);case si:return new r;case ai:return Qr(s)}}var xi=gi,hi=lt,Qs=Object.create,ji=function(){function s(){}return function(t){if(!hi(t))return{};if(Qs)return Qs(t);s.prototype=t;var a=new s;return s.prototype=void 0,a}}(),vi=ji,yi=vi,bi=ba,ki=ka;function wi(s){return typeof s.constructor=="function"&&!ki(s)?yi(bi(s)):{}}var Mi=wi,Ti=ws,_i=ct,Ni="[object Map]";function Si(s){return _i(s)&&Ti(s)==Ni}var Pi=Si,Ci=Pi,Ii=ut,Xs=dt,Js=Xs&&Xs.isMap,Ai=Js?Ii(Js):Ci,Li=Ai,Ui=ws,Ri=ct,Gi="[object Set]";function Oi(s){return Ri(s)&&Ui(s)==Gi}var Bi=Oi,Fi=Bi,Ei=ut,Zs=dt,zs=Zs&&Zs.isSet,$i=zs?Ei(zs):Fi,Wi=$i,qi=wa,Hi=lr,Ki=rt,Vi=gr,Yi=vr,Qi=yr,Xi=On,Ji=Mr,Zi=Sr,zi=Ta,Di=_a,eo=ws,so=Ar,to=xi,ao=Mi,no=Na,ro=Ma,io=Li,oo=lt,lo=Wi,co=it,uo=ot,fo=1,po=2,mo=4,ta="[object Arguments]",go="[object Array]",xo="[object Boolean]",ho="[object Date]",jo="[object Error]",aa="[object Function]",vo="[object GeneratorFunction]",yo="[object Map]",bo="[object Number]",na="[object Object]",ko="[object RegExp]",wo="[object Set]",Mo="[object String]",To="[object Symbol]",_o="[object WeakMap]",No="[object ArrayBuffer]",So="[object DataView]",Po="[object Float32Array]",Co="[object Float64Array]",Io="[object Int8Array]",Ao="[object Int16Array]",Lo="[object Int32Array]",Uo="[object Uint8Array]",Ro="[object Uint8ClampedArray]",Go="[object Uint16Array]",Oo="[object Uint32Array]",L={};L[ta]=L[go]=L[No]=L[So]=L[xo]=L[ho]=L[Po]=L[Co]=L[Io]=L[Ao]=L[Lo]=L[yo]=L[bo]=L[na]=L[ko]=L[wo]=L[Mo]=L[To]=L[Uo]=L[Ro]=L[Go]=L[Oo]=!0;L[jo]=L[aa]=L[_o]=!1;function Qe(s,t,a,r,i,n){var l,o=t&fo,f=t&po,j=t&mo;if(a&&(l=i?a(s,r,i,n):a(s)),l!==void 0)return l;if(!oo(s))return s;var y=no(s);if(y){if(l=so(s),!o)return Xi(s,l)}else{var v=eo(s),c=v==aa||v==vo;if(ro(s))return Qi(s,o);if(v==na||v==ta||c&&!i){if(l=f||c?{}:ao(s),!o)return f?Zi(s,Yi(l,s)):Ji(s,Vi(l,s))}else{if(!L[v])return i?s:{};l=to(s,v,o)}}n||(n=new qi);var p=n.get(s);if(p)return p;n.set(s,l),lo(s)?s.forEach(function(b){l.add(Qe(b,t,a,b,s,n))}):io(s)&&s.forEach(function(b,g){l.set(g,Qe(b,t,a,g,s,n))});var m=j?f?Di:zi:f?uo:co,d=y?void 0:m(s);return Hi(d||s,function(b,g){d&&(g=b,b=s[g]),Ki(l,g,Qe(b,t,a,g,s,n))}),l}var Bo=Qe,Fo=Bo,Eo=1,$o=4;function Wo(s){return Fo(s,Eo|$o)}var qo=Wo;const Pe=Sa(qo);function Ho(s,t){if(t==null)return s;function a(r){return typeof r=="object"&&r!=null?Array.isArray(r)?r.map(a):Object.fromEntries(Object.entries(r).map(([i,n])=>[i,a(n)])):r===null?void 0:r}return t=a(t),{...s,...t}}var pe=(s=>(s[s.Loading=0]="Loading",s[s.UploadingProfilePic=1]="UploadingProfilePic",s[s.GeneratingProfilePic=2]="GeneratingProfilePic",s[s.GizmoNameTooLong=3]="GizmoNameTooLong",s[s.GizmoDescriptionTooLong=4]="GizmoDescriptionTooLong",s[s.GizmoInstructionsTooLong=5]="GizmoInstructionsTooLong",s[s.NameEmpty=6]="NameEmpty",s[s.MissingPublicActionPrivacyPolicyURL=7]="MissingPublicActionPrivacyPolicyURL",s[s.MissingCategory=8]="MissingCategory",s))(pe||{});function bs(s){switch(s){case 0:return"Loading";case 1:return"Uploading profile picture";case 2:return"Generating profile picture";case 3:return"GPT name too long";case 4:return"GPT description too long";case 5:return"GPT instructions too long";case 6:return"GPT name cannot be empty";case 7:return"Public actions require valid privacy policy URLs";case 8:return"Public GPTs must have a category"}}function Ko(s){return s==="link"||s==="marketplace"}function Vo(s){try{return new URL(s),!0}catch{return!1}}function qe(s,t,a){var o,f,j,y;const r=s.name.length>Tt,i=(((o=s.description)==null?void 0:o.length)??0)>_t,n=(((f=s.instructions)==null?void 0:f.length)??0)>Nt,l=[];if((s==null?void 0:s.name)===""&&l.push(6),r&&l.push(3),i&&l.push(4),n&&l.push(5),t!=null&&Ko(t)){const v=(j=s.tools)==null?void 0:j.filter(c=>c.type===Q.JIT_PLUGIN);for(const c of v){const p=(y=c.metadata)==null?void 0:y.privacy_policy_url;if(p==null||!Vo(p)){l.push(7);break}}}return t===x.Marketplace&&a==null&&l.push(8),l}const ra=Fe(()=>Ee(()=>import("./n87n7wnthv338n3k.js"),__vite__mapDeps([0,1,2,3])).then(s=>s.DirectorySyncResourceManagedIndication)),Yo=[ee,Ke];function Qo(s,t){return s.type===F.USER?s.user_id===t.user_id:s.type===F.GROUP?s.group_id===t.group_id:s.type===t.type}const Xo={[F.USER]:x.User,[F.GROUP]:x.Group,[F.WORKSPACE]:x.Workspace,[F.ALL]:x.Marketplace};function ia(s){const t=Xo[s.type];if(!t)throw new Error("Unknown sharing subject type: "+s.type);return{...s,type:t}}function Jo({gizmo:s,publishedGizmo:t,updateGizmo:a,promoteGizmo:r,appealGizmo:i,setAppealState:n,showActionsModal:l,shareOnly:o,onClose:f,workspaceOwner:j=!1}){var ve,N,$;const y=z(),v=Le(),c=((ve=v==null?void 0:v.data)==null?void 0:ve.name)??"your workspace",p=St(),m=qt(),[d,b]=h.useState(void 0);h.useEffect(()=>{var w;if(d==null)if(t!=null&&t.gizmo.display.categories&&(t==null?void 0:t.gizmo.display.categories.length)>0){const A=(w=m.data)==null?void 0:w.categories.find(te=>te.id===(t==null?void 0:t.gizmo.display.categories[0]));A&&b(A)}else m.data!=null&&b(m.data.categories[m.data.categories.length-1])},[m.data,d,t]);const[g,k]=h.useState(s.sharingRecipient??x.Private),[S,G]=h.useState(((N=s.sharing)==null?void 0:N.subjects)??[]),[T,I]=h.useState(null),[O,D]=h.useState(!1),_=h.useCallback(()=>{var w;return!ke((w=s.sharing)==null?void 0:w.subjects,S)||s.sharingRecipient!==g},[s.sharing,s.sharingRecipient,g,S]),C=Be(),q=qe(s,g,(d==null?void 0:d.id)??void 0),H=q.includes(pe.MissingPublicActionPrivacyPolicyURL),U=s.tools.find(w=>w.type===Q.JIT_PLUGIN&&!w.metadata.privacy_policy_url);if(T)return e.jsx(la,{publishedGizmo:T,sharing:{recipient:g,subjects:S},workspaceName:c,onClose:f});function K(w){S.find(A=>Qo(A,w))||G([...S,w])}const R=Pt(S);function je(w){const A=S.filter(te=>[F.WORKSPACE,F.ALL].indexOf(te.type)===-1);w!=null&&A.push(w),G(A)}function se(w){switch(k(w),w){case x.Marketplace:case x.Link:je({type:F.ALL,capabilities:ee});break;case x.Workspace:case x.WorkspaceLink:je({type:F.WORKSPACE,capabilities:ee});break;default:je(null)}}function me(w){R!=null&&G(S.map(A=>A===R?{...A,capabilities:w}:A))}function ge(w,A,te){return w.type===F.USER&&w.user_id.indexOf("__")===-1?{...w,user_id:w.user_id+"__"+(v==null?void 0:v.getWorkspaceId())}:w}async function _e(w,A){if(O)return;if(w&&!A)throw new Error("Cannot share a gizmo that hasn't been promoted before");if(!d)return;D(!0);let le=S.map(ge).map(ia);if(le=Ge(g,le,(R==null?void 0:R.capabilities)??ee),j)return!v||!A?(Z.warning("Unable to change sharing settings"),f()):(await $e.updateWorkspaceGPTSharing(v.id,A,le),Z.success(y.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),C.invalidateQueries({queryKey:["workspace"]}),f());if(w){if(!A||!t)throw new Error("No gizmo ID to share");try{const M={sharing:le};d&&(M.categories=[d.id]);const P=await Ae.shareGizmo(A,M);P.error?os(g,P.sharing_targets)?(n({gizmoId:t.gizmo.id,sharingRecipient:g,categories:t.gizmo.display.categories,moderationType:ss.PublishBlocked,sharingTargets:P.sharing_targets,showModal:we.AppealAvailable}),f()):Z.warning(y.formatMessage({id:"tmIKmp",defaultMessage:"Unable to share GPT"})):(C.setQueryData(["gizmo",{gizmoId:t.gizmo.id},{draft:!1}],V=>P.resource),a(V=>({...V,sharingRecipient:g})),Z.success(y.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),f())}catch{return Z.warning(y.formatMessage({id:"dKC65l",defaultMessage:"Failed to update sharing settings"})),f()}}else{const M=await r({subjects:le,recipient:g},d.id);A||(A=M==null?void 0:M.gizmo.id),I(M??null),a({liveVersion:(M==null?void 0:M.gizmo.live_version)??void 0}),C.invalidateQueries({queryKey:["gizmo",{gizmoId:A}]})}D(!1),C.invalidateQueries({queryKey:["gizmos"]}),C.invalidateQueries({queryKey:["gizmo","userActionSettings",{gizmoId:A}]}),C.invalidateQueries({queryKey:["workspace"]}),a({sharing:{recipient:g,subjects:S},sharingRecipient:g},!1)}return e.jsx(ue,{type:"success",className:"max-w-[555px]",size:"custom",isOpen:!0,onClose:f,primaryButton:os(g,s.sharingTargets)?e.jsx(re,{onClick:()=>i(g,d==null?void 0:d.id),children:e.jsx(u,{id:"HRzqKK",defaultMessage:"Appeal"})}):e.jsx(re,{onClick:()=>_e(o,t==null?void 0:t.gizmo.id),loading:O,disabled:q.length>0||!de(g,s.sharingTargets),children:o?e.jsx(u,{id:"BEKjVh",defaultMessage:"Save"}):e.jsx(u,{id:"24j5ts",defaultMessage:"Update"})}),secondaryButton:e.jsxs(e.Fragment,{children:[_()&&e.jsx("div",{className:"absolute bottom-8 left-6 text-sm text-token-text-secondary",children:e.jsx(u,{id:"9CkgC4",defaultMessage:"Unsaved changes"})}),t&&e.jsx(re,{color:"secondary",onClick:()=>We(t,y.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:e.jsx(u,{id:"wvL15a",defaultMessage:"Copy link"})})]}),title:y.formatMessage({id:"7JggXH",defaultMessage:"Share GPT"}),showCloseButton:!0,children:e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsx(zo,{onAdd:w=>K(w),publishedGizmo:t}),e.jsx("h3",{className:"text-base font-semibold",children:e.jsx(u,{id:"bNQXcV",defaultMessage:"Share with..."})}),e.jsxs("div",{className:"max-h-[200px] space-y-2 overflow-y-auto",children:[e.jsxs("div",{className:"mb-4 flex flex-row items-center justify-between space-x-3",children:[e.jsx("div",{className:"shrink-0 grow-0 self-start",children:e.jsx(Fa,{user:p,size:"gizmoConversation",roundedStyle:"rounded-full"})}),e.jsx("div",{className:"grow",children:!t||Do(t==null?void 0:t.gizmo.author.user_id.split("__")[0],p==null?void 0:p.id)?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-base font-semibold",children:e.jsx(u,{id:"U7tzof",defaultMessage:"{userName} (you)",values:{userName:p==null?void 0:p.name}})}),e.jsx("span",{className:"-mt-1 text-sm text-token-text-secondary",children:p==null?void 0:p.email})]}):e.jsx("span",{className:"text-base font-semibold",children:e.jsx(u,{id:"scRZqV",defaultMessage:"{userName} (builder)",values:{userName:t==null?void 0:t.gizmo.author.display_name}})})})]}),S.map((w,A)=>ms(w)&&e.jsxs("div",{className:"mb-4 flex flex-row items-center justify-between space-x-3",children:[e.jsx(Ea,{name:w.type===F.GROUP?w.group_name:`${w.user_name} ${w.user_email}`,initialsCount:w.type===F.USER?2:1,size:"gizmoConversation",className:ie("shrink-0 grow-0",w.type===F.USER&&"self-start")}),e.jsxs("div",{className:"flex grow flex-col",children:[e.jsxs("span",{className:"flex flex-row",children:[e.jsx("span",{className:"mr-2 text-base font-semibold",children:w.type===F.GROUP?w.group_name:w.user_name}),w.type===F.GROUP&&w.is_scim_managed&&e.jsx(ra,{})]}),w.type===F.USER&&e.jsx("span",{className:"-mt-1 text-sm text-token-text-secondary",children:w.user_email})]}),e.jsxs(E.Root,{children:[e.jsxs(E.Trigger,{className:"whitespace-nowrap text-base text-token-text-secondary",children:[e.jsx(u,{...Me(w.capabilities)}),e.jsx(js,{className:"icon-md"})]}),e.jsx(E.Portal,{children:e.jsxs(E.Content,{className:"max-w-[280px]",children:[Yo.map((te,le)=>e.jsx(ls,{caps:te,selected:ke(te,w.capabilities),onClick:()=>{G(S.map(M=>M===w?{...M,capabilities:te}:M))}},le)),e.jsx(E.Separator,{}),e.jsx(E.Item,{onClick:()=>G(S.filter(te=>te!==w)),color:"danger",icon:es,children:e.jsx(u,{id:"NU0BOB",defaultMessage:"Remove"})})]})})]})]},A))]}),e.jsx("hr",{className:"border-token-border-medium"}),e.jsx("h3",{className:"text-base font-semibold",children:e.jsx(u,{id:"uqD7Y8",defaultMessage:"Access"})}),e.jsxs("div",{className:"-ms-3.5 flex flex-row items-center justify-between space-x-3",children:[e.jsxs(Y.Root,{value:g,onValueChange:w=>se(w),children:[e.jsxs(Y.Trigger,{children:[e.jsx(Y.Value,{}),e.jsx(Y.Icon,{})]}),e.jsx(Y.Portal,{children:e.jsxs(Y.Content,{children:[e.jsxs(Y.Group,{children:[e.jsx(Y.Label,{children:e.jsx(u,{id:"YIQwaP",defaultMessage:"Private"})}),e.jsx(Y.Item,{value:x.Private,children:e.jsx(Se,{shareLevel:x.Private,workspaceName:c})})]}),e.jsx(Y.Separator,{}),e.jsx(gs,{label:y.formatMessage({id:"n0m61x",defaultMessage:"Your workspace has disabled sharing with the workspace."}),side:"bottom",disabled:de("workspace",s.sharingTargets),children:e.jsxs(Y.Group,{children:[e.jsx(Y.Label,{children:c}),e.jsx(Y.Item,{value:x.WorkspaceLink,disabled:!de(x.WorkspaceLink,s.sharingTargets)&&!de(x.Workspace,s.sharingTargets),children:e.jsx(Se,{shareLevel:x.WorkspaceLink,workspaceName:c})}),e.jsx(Y.Item,{value:x.Workspace,disabled:!de("workspace",s.sharingTargets),children:e.jsx(Se,{shareLevel:x.Workspace,workspaceName:c})})]})}),e.jsx(Y.Separator,{}),e.jsx(gs,{label:y.formatMessage({id:"IHnort",defaultMessage:"Your workspace has disabled public sharing."}),side:"bottom",disabled:de("marketplace",s.sharingTargets),children:e.jsxs(Y.Group,{children:[e.jsx(Y.Label,{children:e.jsx(u,{id:"PjY9bi",defaultMessage:"Public"})}),e.jsx(Y.Item,{value:x.Link,disabled:!de("link",s.sharingTargets),children:e.jsx(Se,{shareLevel:x.Link,workspaceName:c})}),e.jsx(Y.Item,{disabled:!de("marketplace",s.sharingTargets),value:x.Marketplace,children:e.jsx(Se,{shareLevel:x.Marketplace,workspaceName:c})})]})})]})})]}),g!==x.Private&&g!==x.User&&e.jsxs(E.Root,{children:[e.jsxs(E.Trigger,{className:"whitespace-nowrap text-base text-token-text-secondary",children:[R==null?e.jsx(u,{...Me(ee)}):e.jsx(u,{...Me(R.capabilities)}),e.jsx(js,{className:"icon-md"})]}),e.jsx(E.Portal,{children:e.jsxs(E.Content,{className:"max-w-[280px]",children:[e.jsx(ls,{onClick:()=>me(ee),caps:ee,selected:ke(R==null?void 0:R.capabilities,ee)}),g!==x.Marketplace&&g!==x.Link&&e.jsx(ls,{onClick:()=>me(Ke),caps:Ke,selected:ke(R==null?void 0:R.capabilities,Ke)})]})})]})]}),H&&e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(u,{id:"/iw1Iv",defaultMessage:"Public actions require valid privacy policy URLs. Click <fixlink>here</fixlink> to update.",values:{fixlink:w=>e.jsx("button",{onClick:()=>{l(U==null?void 0:U.metadata.action_id),f()},className:"underline",children:w})}})}),(g===x.Marketplace||g===x.Workspace)&&(de(g,s.sharingTargets)?e.jsx(Ls,{gizmo:s,category:d==null?void 0:d.id,categories:($=m.data)==null?void 0:$.categories,onCategoryChange:w=>b(w)}):os(g,s.sharingTargets)?e.jsx("div",{className:"pb-2 text-xs text-red-500",children:e.jsx(sa,{sharingRecipient:g,moderatedFields:Is(g,s.sharingTargets)??[],appealAvailable:!0})}):e.jsx("div",{className:"pb-2 text-xs text-red-500",children:e.jsx(u,{id:"BzqqKH",defaultMessage:"Your workspace's settings don't allow this level of access. An owner of the workspace can change this setting in the workspace's GPTs settings."})}))]})})}const oa=he({private:{id:"pSXBWQ",defaultMessage:"Invite-only"},user:{id:"pSXBWQ",defaultMessage:"Invite-only"},group:{id:"pSXBWQ",defaultMessage:"Invite-only"},workspace_link:{id:"Giaxt1",defaultMessage:"Anyone at {workspaceName} with the link"},workspace:{id:"XLHaTU",defaultMessage:"{workspaceName}"},link:{id:"uP1+Ri",defaultMessage:"Anyone with the link"},marketplace:{id:"82Ilac",defaultMessage:"GPT Store"}}),Zo=he({workspace:{id:"1kpopF",defaultMessage:"Published to {workspaceName}"},marketplace:{id:"hdTRpJ",defaultMessage:"Published to GPT Store"}});function Me(s){return s.can_write?W({id:"SubCqD",defaultMessage:"Can edit"}):s.can_view_config?W({id:"ud3lp4",defaultMessage:"Can view configuration"}):s.can_read?W({id:"/0j34W",defaultMessage:"Can chat"}):W({id:"x2E8ET",defaultMessage:"Unknown"})}function ls({caps:s,selected:t,onClick:a}){let r=yn;return s.can_view_config?r=bn:s.can_read&&(r=kn),e.jsx(E.Item,{className:"flex h-auto flex-row items-start space-x-3 px-3 py-3",onClick:a,icon:r,children:s.can_write?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex grow flex-col",children:e.jsx("span",{className:"text-base font-semibold leading-tight",children:e.jsx(u,{...Me(s)})})}),e.jsx(Ve,{className:ie("icon-lg shrink-0",!t&&"invisible")})]}):s.can_view_config?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex grow flex-col",children:[e.jsx("span",{className:"align-baseline text-base font-semibold leading-tight",children:e.jsx(u,{...Me(s)})}),e.jsx("span",{className:"text-xs text-token-text-secondary",children:e.jsx(u,{id:"fL1rWw",defaultMessage:"View configuration settings, duplicate, and chat"})})]}),e.jsx(Ve,{className:ie("icon-lg shrink-0",!t&&"invisible")})]}):s.can_read?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex grow flex-col",children:[e.jsx("span",{className:"text-base font-semibold leading-tight",children:e.jsx(u,{...Me(s)})}),e.jsx("span",{className:"text-xs text-token-text-secondary",children:e.jsx(u,{id:"tx5q1o",defaultMessage:"Users can only chat with this GPT"})})]}),e.jsx(Ve,{className:ie("icon-lg shrink-0",!t&&"invisible")})]}):null})}const De={private:rs,user:rs,group:rs,workspace_link:Ze,workspace:Yt,link:Ze,marketplace:Qt};function Se({shareLevel:s,workspaceName:t,hasInviteSharing:a=!0}){(s===x.User||s===x.Group)&&(s=x.Private);const r=De[s];return e.jsxs("div",{className:"flex flex-row items-center gap-3 text-base",children:[e.jsx(r,{className:"icon-lg"}),e.jsx("div",{className:"line-clamp-1 pt-px text-start font-semibold",children:!a&&s===x.Private?e.jsx(u,{id:"vVJhYB",defaultMessage:"Only me"}):e.jsx(u,{...oa[s],values:{workspaceName:t}})})]})}function la({publishedGizmo:s,sharing:t,workspaceName:a,onClose:r}){const i=t.recipient,n=De[i],l=z();return e.jsxs(ue,{isOpen:!0,onClose:r,showCloseButton:!0,className:"w-[304px]",title:e.jsx(u,{id:"5CEceY",defaultMessage:"GPT Updated"}),primaryButton:e.jsx(re,{onClick:()=>{window.location.href=`/g/${s.gizmo.id}`},children:e.jsx(u,{id:"RF75o5",defaultMessage:"View GPT"})}),secondaryButton:e.jsx(re,{color:"secondary",onClick:()=>We(s,l.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:e.jsx(u,{id:"9hLOl9",defaultMessage:"Copy link"})}),type:"success",children:[e.jsx(Ls,{gizmo:{profilePictureUrl:s.gizmo.display.profile_picture_url??void 0,name:s.gizmo.display.name}}),t.subjects.filter(o=>ms(o)).length>0&&e.jsxs("div",{className:"my-4",children:[e.jsx("h4",{className:"text-xs font-semibold text-token-text-secondary",children:e.jsx(u,{id:"/paYH9",defaultMessage:"Shared with"})}),t.subjects&&t.subjects.map((o,f)=>ms(o)&&e.jsxs("div",{className:"flex flex-row items-center justify-between space-x-3 py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-base font-semibold",children:o.type===F.GROUP?o.group_name:o.user_name}),o.type===F.USER&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{className:"text-sm text-token-text-secondary",children:o.user_email})]})]}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(u,{...Me(o.capabilities)})})]},f))]}),e.jsxs("div",{className:"my-4",children:[e.jsx("h4",{className:"text-xs font-semibold text-token-text-secondary",children:e.jsx(u,{id:"q9XNZ7",defaultMessage:"Access"})}),e.jsxs("div",{className:"ml-[3px] flex flex-row items-center py-3 text-left text-base font-semibold",children:[e.jsx(n,{className:"md:icon-lg mr-3 h-6 w-6 shrink-0"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(u,{...Zo[i]??oa[i],values:{workspaceName:a}})}),(i===x.Workspace||i===x.Marketplace)&&e.jsx("span",{className:"text-xs text-token-text-secondary"})]})]})]})]})}function Ls({gizmo:s,category:t,categories:a,onCategoryChange:r}){const{data:i,isLoading:n}=Ht(),l=a==null?void 0:a.find(o=>o.id===t);return e.jsxs("div",{children:[e.jsxs("div",{className:ie("mb-[1px] flex flex-row items-center space-x-2 bg-token-main-surface-secondary p-4",n&&"invisible",a?"rounded-t-lg":"rounded-lg"),children:[e.jsx(Ps,{isFirstParty:!1,className:"h-11 w-11",src:s.profilePictureUrl}),e.jsxs("div",{className:"flex grow flex-col space-y-0",children:[e.jsx("span",{className:"text-base font-semibold",children:s.name}),e.jsx(Fn,{builderName:i==null?void 0:i.display_name,builderUrl:i==null?void 0:i.website_url,socials:[i==null?void 0:i.socials.linkedin,i==null?void 0:i.socials.github,i==null?void 0:i.socials.twitter].filter(o=>o!=null),className:"text-xs text-token-text-secondary"})]})]}),a&&e.jsxs("div",{className:"flex min-h-[56px] flex-row items-center justify-between space-x-2 rounded-b-lg bg-token-main-surface-secondary px-4 text-base",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(u,{id:"JcA4/t",defaultMessage:"Category"})}),e.jsx("div",{className:"text-token-text-secondary",children:r?e.jsx(Cs,{size:"small",triggerButton:e.jsxs("button",{className:"flex items-center gap-1",children:[l==null?void 0:l.title,e.jsx(js,{className:"icon-md"})]}),children:a.map((o,f)=>e.jsx(E.Item,{onClick:()=>r(o),children:o.title},f))}):e.jsx("span",{className:"text-token-text-secondary",children:l==null?void 0:l.title})})]})]})}const Ds=Oe.li`flex flex-col rounded-sm p-1 hover:bg-token-main-surface-secondary`;function zo({onAdd:s,publishedGizmo:t}){var m;const a=z(),r=Le(),[i,n]=h.useState(""),o=(m=$a(r==null?void 0:r.id,0,i,5).data)==null?void 0:m.items.filter(d=>d.id!==(t==null?void 0:t.gizmo.author.user_id.split("__")[0])),{data:f}=Pa({queryKey:[r==null?void 0:r.id,"groups","filtered",i],queryFn:()=>$e.getWorkspaceGroups(r.id,{query:i,orderby:"@score"}),enabled:i.trim()!==""&&r!=null&&!!r.getWorkspaceId()}),j=((o==null?void 0:o.length)??0)>0||((f==null?void 0:f.items.length)??0)>0,[y,v]=h.useState(!1);function c(d,b,g){s({type:F.GROUP,group_id:d,group_name:b,capabilities:{...ee},is_scim_managed:g}),n("")}function p(d,b,g){r&&(s({type:F.USER,user_id:d+"__"+r.getWorkspaceId(),user_name:b,user_email:g,capabilities:{...ee}}),n(""))}return e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex w-full flex-row space-x-3",children:e.jsxs(Gs,{as:"div",className:"group relative z-10 grow",children:[e.jsx(Xe,{list:"suggested-choices",name:"share-with-input",placeholder:r!=null&&r.isEnterprisey()?a.formatMessage({id:"xy/AMO",defaultMessage:"Add people and groups from your workspace"}):a.formatMessage({id:"Lh9njB",defaultMessage:"Add people from your workspace"}),value:i,onChange:d=>n(d.target.value),onFocus:()=>v(!0),onBlur:()=>v(!1)}),e.jsx(Wa,{show:i.trim()!==""&&j&&y,children:e.jsx(Gs.Panel,{static:!0,className:"absolute top-8 ml-0 w-full cursor-pointer overflow-y-auto rounded-lg rounded-t-none border border-t-0 border-token-border-light bg-token-main-surface-primary px-1 py-1 group-has-[:focus]:border-token-border-xheavy",children:i.trim()!==""&&e.jsxs("ul",{id:"suggested-choices",children:[o&&o.map(d=>e.jsxs(Ds,{tabIndex:0,className:"rounded-sm p-1 text-sm hover:bg-token-main-surface-secondary",onClick:()=>p(d.id,d.name,d.email??""),children:[e.jsx("span",{className:"w-full font-semibold",children:d.name}),e.jsx("span",{className:"text-sm text-token-text-secondary",children:d.email})]},d.id)),(f==null?void 0:f.items)&&f.items.slice(0,5).map(d=>e.jsx(Ds,{tabIndex:0,onClick:()=>c(d.id,d.name,d.is_scim_managed??!1),children:e.jsxs("span",{className:"flex flex-col",children:[e.jsxs("span",{className:"flex flex-row",children:[e.jsx("span",{className:"mr-2 font-semibold",children:d.name}),d.is_scim_managed&&e.jsx(ra,{})]}),e.jsx("span",{className:"text-sm text-token-text-secondary",children:e.jsx(u,{id:"r3Rx6X",defaultMessage:"{numMembers, plural, one {1 member} other {# members}}",values:{numMembers:d.num_members}})})]})},d.id))]})})})]})})})}function Do(s,t){return s===void 0||t===void 0?!1:s.split("__")[0]===t.split("__")[0]}function el({gizmo:s,updateGizmo:t,publishedGizmo:a,promoteGizmo:r,appealGizmo:i,setAppealState:n,showActionsModal:l,shareOnly:o,onClose:f}){const[j,y]=h.useState({type:"privacy"});return j.type==="privacy"?e.jsx(tl,{gizmo:s,updateGizmo:t,publishedGizmo:a,promoteGizmo:r,appealGizmo:i,setAppealState:n,setStep:y,showActionsModal:l,shareOnly:o,onClose:f}):e.jsx(al,{publishedGizmo:j.publishedGizmo,onClose:f})}function sl(s){return s?x.Workspace:x.Link}function tl({gizmo:s,publishedGizmo:t,updateGizmo:a,promoteGizmo:r,appealGizmo:i,setAppealState:n,setStep:l,showActionsModal:o,shareOnly:f,onClose:j}){var me,ge,_e,ve;const[y,v]=h.useState(!1),c=Je(Ct.isBusinessWorkspace),p=z(),[m,d]=h.useState(Ss(s)?sl(!!c):s.sharingRecipient),b=Be(),g=de(m,s.sharingTargets),{data:k,isLoading:S}=Ht(),G=qt(),[T,I]=h.useState(t!=null&&t.gizmo.display.categories.length>0?(ge=(me=G.data)==null?void 0:me.categories.find(N=>N.id===t.gizmo.display.categories[0]))==null?void 0:ge.id:void 0);h.useEffect(()=>{I(t==null?void 0:t.gizmo.display.categories[0])},[t==null?void 0:t.gizmo.display.categories]);const[O,D]=h.useState(void 0),_=h.useRef(qa((N,$)=>Ae.generateCategory(N,$),1e3)),C=k!=null&&k.is_verified?void 0:p.formatMessage({id:"qEQtmt",defaultMessage:"To publish your GPTs to the Explore GPTs page, set up your builder profile."});m===x.Marketplace&&C!=null&&!S&&d(x.Link);const q=c&&!((_e=s.sharingTargets)!=null&&_e.some(N=>N.recipient===x.Link)),H=qe(s,m,T),U=H.includes(pe.MissingPublicActionPrivacyPolicyURL),K=s.tools.find(N=>N.type===Q.JIT_PLUGIN&&!N.metadata.privacy_policy_url),R=Je(N=>N.currentWorkspace),je=ft();h.useEffect(()=>{let N=!0;return(async()=>{try{if(T!=null)return;const $=await _.current(s.name,s.instructions);N&&T==null&&($?I($.id):D(!0))}catch{N&&T==null&&D(!0)}})(),()=>{N=!1}},[s.instructions,s.name,je,T]);const{value:se}=Ce("4226692983");return e.jsx(ue,{type:"success",isOpen:!0,onClose:j,title:e.jsx(u,{id:"9viumf",defaultMessage:"Share GPT"}),showCloseButton:!0,primaryButton:g?e.jsx(re,{color:"primary",disabled:H.length>0,loading:y,onClick:async()=>{try{if(v(!0),f){if(!(t!=null&&t.gizmo.id)){Z.danger(p.formatMessage({id:"QYVEx8",defaultMessage:"Error sharing GPT"}));return}const N=await Ae.shareGizmo(t.gizmo.id,T?{sharing:Ge(m,[],ee),categories:[T]}:{sharing:Ge(m,[],ee)});N.error?(Z.warning(p.formatMessage({id:"tmIKmp",defaultMessage:"Unable to share GPT"})),a({sharingTargets:N.sharing_targets}),n({gizmoId:t.gizmo.id,sharingRecipient:m,categories:t.gizmo.display.categories,moderationType:ss.PublishBlocked,sharingTargets:N.sharing_targets,showModal:we.AppealAvailable})):(b.setQueryData(["gizmo",{gizmoId:t.gizmo.id},{draft:!1}],$=>N.resource),a($=>({...$,sharingRecipient:m})),Z.success(p.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),j())}else{const N=await r({recipient:m,subjects:Ge(m,[],ee)},T);N?(l({type:"published",publishedGizmo:N}),a($=>({...$,id:N.gizmo.id,sharingRecipient:m})),N.gizmo.live_version!=null&&a({liveVersion:N.gizmo.live_version}),Z.success(p.formatMessage({id:"R5zko1",defaultMessage:"GPT published"}))):(Z.warning(p.formatMessage({id:"uf7WYw",defaultMessage:"Unable to publish GPT"})),j())}}finally{v(!1)}},children:e.jsx(u,{id:"SW4DG4",defaultMessage:"Save"})}):se?e.jsx(e.Fragment,{children:e.jsx(re,{color:"primary",onClick:async()=>{await i(m,T)},children:e.jsx(u,{id:"bBmLUr",defaultMessage:"Appeal"})})}):null,secondaryButton:t?e.jsx(re,{color:"secondary",onClick:()=>We(t,p.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:e.jsx(u,{id:"wvL15a",defaultMessage:"Copy link"})}):null,children:e.jsxs("div",{className:"mx-[-16px] flex flex-col gap-3 text-sm",children:[e.jsx("div",{className:"space-y-1.5",children:e.jsxs(It,{value:m,onValueChange:N=>d(N),children:[s.sharingTargets&&s.sharingTargets.map((N,$)=>e.jsx(cs,{value:N.recipient,disabled:N.recipient===x.Marketplace&&C!=null,tooltipText:N.recipient===x.Marketplace?C??p.formatMessage({id:"0Rcb4e",defaultMessage:"Your GPT will appear in the Explore GPTs page"}):void 0,shareLevel:N.recipient},$)),q&&e.jsxs(e.Fragment,{children:[e.jsx(cs,{value:x.Link,disabled:!0,tooltipText:p.formatMessage(et.workspaceDisabledHint),shareLevel:x.Link,workspaceName:R==null?void 0:R.name}),e.jsx(cs,{value:x.Link,disabled:!0,tooltipText:p.formatMessage(et.workspaceDisabledHint),shareLevel:x.Marketplace,workspaceName:R==null?void 0:R.name})]})]})}),U&&e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(u,{id:"/iw1Iv",defaultMessage:"Public actions require valid privacy policy URLs. Click <fixlink>here</fixlink> to update.",values:{fixlink:N=>e.jsx("button",{onClick:()=>{o(K==null?void 0:K.metadata.action_id)},className:"underline",children:N})}})}),m!==x.Private&&e.jsx(Ls,{gizmo:s,category:T,categories:m===x.Marketplace?((ve=G.data)==null?void 0:ve.categories)??[]:void 0,onCategoryChange:m===x.Marketplace?N=>I(N.id):void 0}),m===x.Marketplace&&(O?e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(u,{id:"tpC3ui",defaultMessage:"There was an error updating the list of categories"})}):null),!g&&se&&e.jsx("div",{className:"flex items-center justify-between text-sm text-token-text-secondary",children:e.jsx(u,{id:"jLCMMV",defaultMessage:"Because this GPT previously may have violated our policies, you will have to submit an appeal to make it available at this level."})})]})})}function al({publishedGizmo:s,onClose:t}){const a=En(s),r=z();return e.jsx(ue,{type:"success",isOpen:!0,onClose:t,title:e.jsx(u,{id:"rCRRmx",defaultMessage:"Settings Saved"}),showCloseButton:!0,primaryButton:e.jsx(re,{color:"primary",as:"link",to:a,children:e.jsx(u,{id:"lyZz44",defaultMessage:"View GPT"})}),children:e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex gap-1 rounded bg-token-main-surface-secondary px-2 py-1",children:[e.jsx("div",{className:"line-clamp-1 text-ellipsis break-all",children:a}),e.jsx("button",{onClick:()=>{We(s,r.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"}))},className:"text-token-text-secondary transition hover:text-token-text-primary",children:e.jsx(Xt,{className:"icon-sm"})})]})})})}const et=he({workspaceDisabledHint:{id:"gizmo.workspaceDisabledHint",defaultMessage:"Your workspace administrator has disabled this setting"}});function cs({shareLevel:s,workspaceName:t,value:a,disabled:r=!1,tooltipText:i}){const n=h.useId();return e.jsx(gs,{disabled:i==null,label:i,side:"top",children:e.jsxs(At,{id:n,value:a,disabled:r,className:"flex h-14 w-full cursor-pointer flex-row items-center justify-between gap-2 rounded-md px-3 py-4 font-semibold hover:bg-token-main-surface-secondary",children:[e.jsx("label",{htmlFor:n,className:"flex cursor-pointer items-center gap-1",children:e.jsx(Se,{shareLevel:s,workspaceName:t??"",hasInviteSharing:!1})}),e.jsx(Ha,{children:e.jsx(Ve,{className:"icon-lg mr-1"})})]})})}function ca(s){window.history.length>1?s(-1):s(un())}function nl({gizmo:s,publishedGizmo:t,isLoading:a,isUploadingProfilePic:r,isGeneratingProfilePic:i,updateGizmo:n,promoteGizmo:l,appealGizmo:o,setAppealState:f,showActionsModal:j}){const y=Le(),v=s!=null?qe(s):[];(s==null||a)&&v.push(pe.Loading),r&&v.push(pe.UploadingProfilePic),i&&v.push(pe.GeneratingProfilePic);const c=Ss(s),[p,m]=h.useState(!1),[d,b]=h.useState(!1),g=s.sharingRecipient?De[s.sharingRecipient]:De.private;return e.jsxs(e.Fragment,{children:[c?e.jsx(oe,{color:"primary",onClick:()=>m("promote"),loading:a,disabled:s.id===void 0||v.length>0,tooltip:v.length>0?v.map(bs).join(`
`):void 0,children:e.jsx(u,{id:"svUGIb",defaultMessage:"Create"})}):e.jsxs(e.Fragment,{children:[e.jsxs(oe,{color:"secondary",loading:a||!t,onClick:()=>m("share"),children:[e.jsx(g,{className:"icon-sm shrink-0"}),e.jsx(u,{id:"aXKW4G",defaultMessage:"Share"})]}),e.jsx(oe,{color:"primary",onClick:async()=>{let k=s.sharing.subjects.map(ia);const S=Pt(s.sharing.subjects);k=Ge(s.sharing.recipient,k,(S==null?void 0:S.capabilities)??ee),await l({recipient:s.sharing.recipient,subjects:k},t==null?void 0:t.gizmo.display.categories[0])&&b(!0)},loading:a||!t,disabled:v.length>0,tooltip:v.length>0?v.map(bs).join(`
`):void 0,children:e.jsx(u,{id:"84QVoj",defaultMessage:"Update"})})]}),p&&((y==null?void 0:y.getWorkspaceId())==null?e.jsx(el,{gizmo:s,publishedGizmo:t,promoteGizmo:l,appealGizmo:o,setAppealState:f,showActionsModal:j,updateGizmo:n,shareOnly:p==="share",onClose:()=>m(!1)}):e.jsx(Jo,{gizmo:s,publishedGizmo:t,promoteGizmo:l,appealGizmo:o,setAppealState:f,showActionsModal:j,updateGizmo:n,onClose:()=>m(!1),shareOnly:p==="share"})),d&&e.jsx(la,{publishedGizmo:t,sharing:t.gizmo.sharing,onClose:()=>b(!1),workspaceName:(y==null?void 0:y.data.name)??""})]})}function rl({gizmoEditorData:s,publishedGizmo:t,revertDraft:a}){const r=z(),i=pt(),[n,l]=h.useState(!1),o=ft(),{value:f}=Ce("3645668434");return!(o!=null&&o.includes("debug"))&&(s==null?void 0:s.id)==null?null:e.jsxs(e.Fragment,{children:[e.jsxs(Cs,{side:"top",contentAlign:"end",sideOffset:8,triggerButton:e.jsx(oe,{color:"ghost",icon:wn}),children:[t!=null&&e.jsxs(E.Item,{onClick:()=>{We(t)},children:[e.jsx(Ze,{className:"icon-sm"}),e.jsx(u,{...xe.copyLink})]}),a!=null&&e.jsxs(E.Item,{onClick:()=>{window.confirm(r.formatMessage(xe.revertConfirm))&&a()},children:[e.jsx(Mn,{className:"icon-sm"}),e.jsx(u,{id:"W2blnV",defaultMessage:"Revert..."})]}),(s==null?void 0:s.id)!=null&&f&&s.liveVersion>0&&e.jsxs(e.Fragment,{children:[e.jsxs(E.Item,{onClick:()=>{i(`/g/${s.id}/view`)},children:[e.jsx(Tn,{className:"icon-sm"}),e.jsx(u,{id:"gizmo.versionHistory",defaultMessage:"Version History"})]}),e.jsxs(E.Item,{onClick:async()=>{const j=await Ae.copyGizmo({gizmoId:s.id});j.gizmo.id&&i(`/gpts/editor/${j.gizmo.id}`)},children:[e.jsx(Xt,{className:"icon-sm"}),e.jsx(u,{id:"GizmoInformation.copyGizmoLabel",defaultMessage:"Duplicate GPT"})]})]}),(s==null?void 0:s.id)!=null&&e.jsxs(E.Item,{color:"danger",onClick:()=>{l(!0)},children:[e.jsx(es,{className:"icon-sm"}),e.jsx(u,{id:"tNrOLG",defaultMessage:"Delete GPT"})]}),(o==null?void 0:o.includes("debug"))&&e.jsxs(e.Fragment,{children:[e.jsx(E.Separator,{}),e.jsxs(E.Item,{onClick:()=>{_s.toggleActiveSidebar("debug")},children:[e.jsx(_n,{className:"icon-sm"}),"Debug (Internal only)"]})]})]}),n&&e.jsx(Bn,{gizmoId:s.id,onSuccess:()=>ca(i),onClose:()=>{l(!1)}})]})}const He=Oe.div`flex items-center gap-1`;function il({gizmoEditorData:s}){const t=Je(a=>{var r;return(r=a.currentWorkspace)==null?void 0:r.name});switch(s.sharingRecipient){case x.Private:return e.jsxs(He,{children:[e.jsx(Nn,{className:"icon-xs"}),e.jsx(u,{...xe.onlyMe})]});case x.Link:return e.jsxs(He,{children:[e.jsx(Ze,{className:"icon-xs"}),e.jsx(u,{...xe.anyoneWithLink})]});case x.Workspace:return e.jsxs(He,{children:[e.jsx(Yt,{className:"icon-xs"}),t]});case x.Marketplace:return e.jsxs(He,{children:[e.jsx(Qt,{className:"icon-xs"}),e.jsx(u,{...xe.public})]});default:return e.jsx("div",{})}}function ol({gizmoEditorData:s}){return e.jsxs("div",{className:"flex items-center gap-2",children:[s.profilePictureUrl!=null?e.jsx(Ps,{isFirstParty:!1,src:s.profilePictureUrl,className:"h-8 w-8"}):e.jsx("div",{className:"h-8 w-8 rounded-full border-2 border-dashed border-token-border-medium"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:s.name||e.jsx(u,{...xe.newGPT})}),e.jsx("div",{className:"text-xs text-token-text-secondary",children:Ss(s)?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-token-text-tertiary"}),e.jsx(u,{...xe.draft})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-brand-green"}),s.sharingRecipient===x.Marketplace?e.jsx(u,{...xe.published}):e.jsx(u,{id:"gizmoEditorHeader.live",defaultMessage:"Live"})," · ",e.jsx(il,{gizmoEditorData:s})]})})]})]})}function ll({gizmoEditorData:s,isLoading:t,isUploadingProfilePic:a,isGeneratingProfilePic:r,publishedGizmo:i,updateGizmo:n,promoteGizmo:l,appealGizmo:o,setAppealState:f,revertDraft:j,draftMessage:y,className:v,hasUnpublishedChanges:c,showActionsModal:p}){const m=pt();return e.jsxs("div",{className:ie("relative flex h-14 w-full items-center justify-between gap-2 border-b border-token-border-medium px-3",v),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{className:"cursor-pointer text-token-text-primary",onClick:()=>ca(m),children:e.jsx(Ka,{className:"icon-lg"})}),e.jsx(ol,{gizmoEditorData:s})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[y,e.jsx(rl,{gizmoEditorData:s,publishedGizmo:i,revertDraft:j}),e.jsx(nl,{gizmo:s,publishedGizmo:i,isLoading:t,isUploadingProfilePic:a,isGeneratingProfilePic:r,updateGizmo:n,promoteGizmo:l,appealGizmo:o,setAppealState:f,hasUnpublishedChanges:c,showActionsModal:p})]})]})}const xe=he({onlyMe:{id:"gizmo.onlyMe",defaultMessage:"Only me"},anyoneWithLink:{id:"gizmo.anyoneWithLink",defaultMessage:"Anyone with a link"},public:{id:"gizmo.public",defaultMessage:"Everyone"},newGPT:{id:"gizmo.newGPT",defaultMessage:"New GPT"},draft:{id:"gizmo.draft",defaultMessage:"Draft"},published:{id:"gizmo.published",defaultMessage:"Published"},revertConfirm:{id:"gizmo.revertConfirm",defaultMessage:"Are you sure you want to revert to the last saved version?"},copyLink:{id:"gizmo.copyLink",defaultMessage:"Copy link"}}),cl=512;function dl(){return e.jsx("div",{className:"relative flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-token-border-medium",children:e.jsx(Ms,{className:"h-1/4 w-1/4"})})}function ul({gizmoEditorData:s,onFileChange:t,generateProfilePic:a,isGeneratingProfilePic:r,setIsGeneratingProfilePic:i}){const n=z(),[l,o]=h.useState(void 0),f=h.useRef(t);h.useEffect(()=>{f.current=t});async function j(c){if(c.length>0){i(!1);const p=await Ja(c[0],cl),m=xs(p);o({tempId:m,file:p,status:ne.Uploading,progress:1,fileId:null,cdnUrl:null}),f.current("uploading"),Za(m,p,n,mt.ProfilePicture,{onFileCreated(d,b,g){o(k=>k!=="initial"&&(k==null?void 0:k.tempId)===d&&k.status===ne.Uploading?{...k,progress:10,fileId:b,cdnUrl:g}:k)},onFileUploadProgress(d,b){o(g=>g!=="initial"&&(g==null?void 0:g.tempId)===d&&g.status===ne.Uploading?{...g,progress:b}:g)},onFileUploaded(d,b,g){o(k=>k!=="initial"&&(k==null?void 0:k.tempId)===d?(f.current(k),{...k,status:ne.Ready,progress:100,fileSpec:{name:k.file.name,id:k.fileId,size:k.file.size,...g??{}}}):k)},onError(d){o(b=>{if(b!=="initial"&&(b==null?void 0:b.tempId)===d){f.current(void 0);return}return b})}})}}const{open:y,getInputProps:v}=Lt({disabled:!1,noClick:!0,onDropAccepted:j,onDropRejected:c=>$n(c,n,Va.ProfilePicture),multiple:!0,maxSize:Ut,...Rt(Ya)});return e.jsxs("div",{className:"flex w-full items-center justify-center gap-4",children:[e.jsxs(Cs,{sideOffset:8,triggerButton:e.jsx("button",{className:"h-20 w-20",children:r?e.jsx(dl,{}):l!=null&&l!="initial"&&l.status!=ne.Ready?e.jsxs("div",{className:"relative h-full w-full overflow-hidden rounded-full",children:[e.jsx(Qa,{file:l.file}),l.status===ne.Uploading&&l.progress<90?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:e.jsx(Xa,{percentage:l.progress,className:"h-6 w-6"})}):null]}):(s==null?void 0:s.profilePictureUrl)!=null&&(s==null?void 0:s.profilePictureUrl)!==""?e.jsx(Ps,{isFirstParty:!1,src:s.profilePictureUrl}):e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-token-border-medium",children:e.jsx(Sn,{className:"text-4xl"})})}),children:[e.jsx(E.Item,{onClick:y,children:e.jsx(u,{id:"ERQwXg",defaultMessage:"Upload Photo"})}),e.jsx(E.Item,{onClick:a,children:e.jsx(u,{id:"NXAog/",defaultMessage:"Use DALL·E"})})]}),e.jsx("input",{...v()})]})}function fl({gizmoEditorData:s,updateGizmo:t}){var v;const a=(v=s==null?void 0:s.tools)==null?void 0:v.find(c=>c.type===Q.INTENT&&"intents"in c.settings),[r,i]=h.useState((a==null?void 0:a.settings.intents)??""),[n,l]=h.useState((a==null?void 0:a.settings.intent_hook)??""),[o,f]=h.useState(!1),j=z(),y=()=>{t(c=>({...c,tools:a?c.tools.map(p=>p.type===Q.INTENT?{...p,settings:{...p.settings,intents:r,intent_hook:n}}:p):[...c.tools,{type:Q.INTENT,settings:{intents:r,intent_hook:n}}]})),f(!1)};return e.jsxs(ae,{children:[e.jsx(J,{label:"GPT Script",description:j.formatMessage({id:"gizmo.gptScriptExplanation",defaultMessage:"Code and Intents to save GPT state"})}),o&&e.jsxs("div",{className:"mb-4",children:[e.jsx(J,{label:"Intent Hook"}),e.jsx(vs,{value:n,rows:20,onChange:c=>l(c.target.value),placeholder:`def f(input):
return {
  "instructions": str(input.intent),
  "conversation_state": input.conversation_state,
  "user_state": input.user_state,
  "pinned": {},
}`,className:"h-50 mb-4 block w-full resize-none rounded-md border border-gray-300 p-2 font-mono text-xs shadow-sm focus:border-blue-500 focus:ring-blue-500",spellCheck:"false"}),e.jsx(J,{label:"Intents"}),e.jsx(vs,{value:r,rows:20,onChange:c=>i(c.target.value),placeholder:"Enter Intent",className:"h-50 mb-4"}),e.jsx(re,{color:"primary",onClick:()=>{y()},children:"Update"})]}),!o&&e.jsx(oe,{onClick:()=>f(!0),children:n?"Update Script":"Add Script"})]})}function pl({gizmoEditorData:s,requireGizmoId:t,currentModelConfig:a,updateGizmo:r}){const i=z(),[n,l]=h.useState(0),o=h.useRef(new Map),f=za(a,void 0),j=async T=>{gt.logEvent(xt.uploadFile,{client:"web",eventSource:"mouse",intent:"gizmo"});const I=await t();T.length>0&&await Promise.all(T.map(O=>{const D=xs(O);o.current.set(D,{tempId:D,gizmoId:I,file:O,status:ne.Uploading,progress:1,fileId:null,cdnUrl:null}),Da(xs(O),O,i,{kind:mt.Gizmo,gizmoId:I},{onFileUploaded:(_,C,q,H)=>{const U=o.current.get(_);U==null||U.fileId==null||(r(K=>({...K,files:[...K.files??[],{file_id:U.fileId,name:U.file.name,size:U.file.size,type:U.file.type,last_modified:U.file.lastModified,file_size_tokens:H==null?void 0:H.fileTokenSize}]})),o.current.delete(_),l(K=>K+1))},onFileCreated:(_,C,q)=>{o.current.set(_,{tempId:_,gizmoId:I,file:O,status:ne.Uploading,progress:1,...o.current.get(_),fileId:C,cdnUrl:q}),l(H=>H+1)},onFileUploadProgress:(_,C)=>{const q=o.current.get(_);(q==null?void 0:q.status)===ne.Uploading&&o.current.set(_,{...q,progress:C}),l(H=>H+1)},onError:_=>{o.current.delete(_)}},{usesRetrievalIndex:a!=null&&ns(a,O.type,O.name)===as.Retrieval})}))},{getInputProps:y,open:v}=Lt({disabled:!1,noClick:!0,onDropAccepted:j,multiple:!0,maxSize:Ut,maxFiles:10,...Rt(f)}),c=(s==null?void 0:s.files)??[];function p(T){return e.jsx(Bs,{onRemoveFileClick:()=>{o.current.delete(T.tempId),l(I=>I+1)},file:T.file,loadingPercentage:T.status===ne.Uploading?T.progress:void 0},T.tempId)}function m(T){return e.jsx(Bs,{file:T.name,fileId:T.file_id,onRemoveFileClick:()=>r(I=>{var O;return{...I,files:(O=I==null?void 0:I.files)==null?void 0:O.filter(D=>D.file_id!==T.file_id)}}),gizmoId:s==null?void 0:s.id},T.file_id)}const d=Array.from(o.current.values()).filter(T=>c.every(I=>I.file_id!==T.fileId)),[b,g]=Os(d,T=>a!=null&&ns(a,T.file.type,T.file.name)===as.CodeInterpreter),[k,S]=Os(c,T=>a!=null&&T.type!=null&&ns(a,T.type,T.name)===as.CodeInterpreter),G=h.useRef(k.length);return h.useEffect(()=>{k.length>G.current&&r(T=>{var I;return(I=T.tools)!=null&&I.some(O=>O.type===Q.PYTHON)?T:{...T,tools:[...T.tools??[],{type:Q.PYTHON}]}}),G.current=k.length},[k.length]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"rounded-lg text-token-text-tertiary",children:e.jsx(u,{...ml.knowledgeWarning})}),g.length>0||S.length>0?e.jsxs("div",{className:"flex flex-wrap gap-2",children:[g.map(p),S.map(m)]}):null,b.length>0||k.length>0?e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs text-token-text-tertiary",children:e.jsx(u,{id:"i/QurZ",defaultMessage:"The following files are only available for Code Interpreter:"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[b.map(p),k.map(m)]})]}):null,e.jsx("div",{children:e.jsxs(oe,{onClick:v,children:[e.jsx("input",{...y()}),e.jsx(u,{id:"sr8Qp/",defaultMessage:"Upload files"})]})})]})}const ml=he({knowledgeWarning:{id:"gizmo.knowledgeWarning",defaultMessage:"If you upload files under Knowledge, conversations with your GPT may include file contents. Files can be downloaded when Code Interpreter is enabled"}});function gl({placeholder:s,text:t,onChange:a,onClose:r}){return e.jsx(ue,{className:"!max-h-[100vh] !max-w-[80vw]",type:"success",isOpen:!0,onClose:r,primaryButton:e.jsx(oe,{onClick:r,children:e.jsx(u,{id:"FeFVdS",defaultMessage:"Close"})}),children:e.jsx("textarea",{className:"h-[70vh] w-full resize-none rounded-lg bg-token-main-surface-primary dark:border-gray-700",value:t,onChange:i=>{a(i.target.value)},placeholder:s})})}const ds=Oe.div`text-sm text-red-500`;function xl({children:s,collapsed:t,initial:a}){return e.jsx(sn,{initial:a,children:!t&&e.jsx(Dt.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:s})})}function hl({gizmo:s,onShowActionsEditor:t,isDisabled:a}){var n,l;const r=z(),i=e.jsxs("div",{className:"space-y-1",children:[(n=s==null?void 0:s.tools)==null?void 0:n.map((o,f)=>{var j;return o.type!==Q.JIT_PLUGIN?null:e.jsxs("div",{children:[e.jsx(Ln,{isDisabled:a,actionTool:o,onShowActionsEditor:()=>t(o.metadata.domain)}),((j=o.metadata.auth)==null?void 0:j.type)==="oauth"&&e.jsx(tn,{label:r.formatMessage(X.callbackUrlLabel),value:`https://chat.openai.com/aip/${o.metadata.action_id}/oauth/callback`,onCopied:()=>{Z.success("Copied to clipboard",{duration:3})}})]},f)}),(((l=s==null?void 0:s.tools)==null?void 0:l.filter(o=>o.type===Q.JIT_PLUGIN))??[]).length>=Fs?e.jsx("div",{children:r.formatMessage(X.maxActionsReached,{number:Fs})}):e.jsx(oe,{disabled:a,onClick:()=>{t("Unknown domain")},className:"mt-2",children:e.jsx(u,{...X.createActionLabel})})]});return a?e.jsx(Ot,{side:"top",label:r.formatMessage(X.disabledCustomActionsTooltip),children:i}):i}function jl(s){var t,a;return(((t=s.files)==null?void 0:t.length)??0)>0||((a=s==null?void 0:s.tools)==null?void 0:a.some(r=>r.type===Q.JIT_PLUGIN))}const vl=12;function yl({gizmoEditorData:s,updateGizmo:t,currentModelConfig:a,generateProfilePic:r,setIsUploadingProfilePic:i,isGeneratingProfilePic:n,setIsGeneratingProfilePic:l,requireGizmoId:o,onShowActionsEditor:f,onShowBlocksEditor:j}){const y=(s==null?void 0:s.tools)??[],[v,c]=h.useState(!1),[p,m]=h.useState(!0),d=(s==null?void 0:s.promptStarters)??[],b=[...d,...d.length<vl?[""]:[]],g=qe(s),k=Le(),S=k==null?void 0:k.isWorkspaceAccount(),G=Gt(ht.WorkspaceGPTCustomActions),T=z(),{value:I}=Ce("804300613"),{value:O}=Ce("736089948"),{value:D}=Ce("3047641741");return e.jsxs("div",{className:"flex h-full grow flex-col overflow-y-auto px-2 pt-6 text-sm",children:[e.jsxs("div",{className:"grow",children:[e.jsxs(ae,{children:[e.jsx(ul,{gizmoEditorData:s,generateProfilePic:r,isGeneratingProfilePic:n,setIsGeneratingProfilePic:l,onFileChange:async _=>{if(_!=null&&_!=="uploading"&&_.fileId!=null){const C=await $e.getFileDownloadLink(_.fileId);C.status===Ts.Success&&t({profilePictureId:_.fileId!=null?_.fileId:void 0,profilePictureUrl:C.download_url})}else t({profilePictureId:void 0,profilePictureUrl:void 0});i(_==="uploading")}}),e.jsx(J,{label:e.jsx(u,{id:"M4dZms",defaultMessage:"Name"}),description:e.jsx(u,{id:"+Gkni2",defaultMessage:"The name of your GPT"})}),e.jsx(is,{type:"text",placeholder:T.formatMessage(X.gptNamePlaceholder),value:(s==null?void 0:s.name)??"",onChange:_=>{t({name:_.target.value})},onBlurCapture:()=>t(_=>({..._,name:_.name.trim()}))}),g.includes(pe.GizmoNameTooLong)?e.jsx(ds,{className:"mt-1",children:e.jsx(u,{...X.nameTooLong,values:{length:Tt}})}):null]}),e.jsxs(ae,{className:"mt-4",children:[e.jsx(J,{label:e.jsx(u,{id:"YDzNvf",defaultMessage:"Description"}),description:e.jsx(u,{id:"dpxCw8",defaultMessage:"Short description of what this GPT does"})}),e.jsx(is,{type:"text",placeholder:T.formatMessage(X.descriptionPlaceholder),value:(s==null?void 0:s.description)??"",onChange:_=>t({description:_.target.value}),onBlurCapture:()=>t(_=>{var C;return{..._,description:((C=_.description)==null?void 0:C.trim())??""}})}),g.includes(pe.GizmoDescriptionTooLong)?e.jsx(ds,{className:"mt-1",children:e.jsx(u,{...X.descriptionTooLong,values:{length:_t}})}):null]}),e.jsxs(ae,{children:[e.jsx(J,{label:e.jsx(u,{id:"2SO0RJ",defaultMessage:"Instructions"}),description:T.formatMessage(X.instructionsSubtitle)}),e.jsxs("div",{className:"relative",children:[e.jsx(vs,{className:"resize-none",rows:8,value:s==null?void 0:s.instructions,onChange:_=>t({instructions:_.target.value}),onBlurCapture:()=>t(_=>({..._,instructions:_.instructions.trim()})),placeholder:T.formatMessage(X.instructionsSubtitle)}),e.jsx("button",{className:"absolute bottom-3 right-2 text-token-text-tertiary",onClick:()=>c(!0),children:e.jsx(Pn,{className:"icon-sm"})})]}),g.includes(pe.GizmoInstructionsTooLong)?e.jsx(ds,{className:"mt-1",children:e.jsx(u,{...X.instructionsTooLong,values:{length:Nt}})}):null]}),e.jsxs(ae,{children:[e.jsx(J,{label:e.jsx(u,{id:"6rfYOX",defaultMessage:"Conversation starters"}),description:e.jsx(u,{id:"OSOIpd",defaultMessage:"Examples for the user to start the conversation"})}),e.jsx("div",{className:"flex flex-col gap-1",children:b.map((_,C)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(is,{className:"rounded-r-none",value:_,type:"text",onChange:q=>{const H=q.target.value;t(U=>({...U,promptStarters:Ns(C>=(d.length??0)?[...d??[],H]:d.map((K,R)=>R===C?H===""?void 0:H:K))}))}}),e.jsx("button",{className:"flex h-9 w-9 items-center justify-center rounded-lg rounded-l-none border border-l-0 border-token-border-medium",onClick:()=>t(q=>({...q,promptStarters:d.filter((H,U)=>U!==C)})),children:e.jsx(Cn,{className:"icon-sm"})})]},C))})]}),e.jsxs(ae,{children:[e.jsx(J,{label:e.jsx(u,{id:"bwXSkU",defaultMessage:"Knowledge"}),description:T.formatMessage(X.knowledgeExplanation)}),e.jsx(pl,{gizmoEditorData:s,requireGizmoId:o,currentModelConfig:a,updateGizmo:t})]}),e.jsxs(ae,{children:[e.jsx(J,{label:e.jsx(u,{id:"mcAwDU",defaultMessage:"Capabilities"}),description:e.jsx(u,{id:"2exQT6",defaultMessage:"Functionality this GPT can use"})}),e.jsx(Hn,{enabledTools:y,onEnabledToolsChange:_=>t({tools:_})})]}),e.jsxs(ae,{children:[e.jsx(J,{label:e.jsx(u,{id:"7r7v+u",defaultMessage:"Actions"}),description:e.jsx(u,{id:"fBln7I",defaultMessage:"APIs this GPT can use"})}),e.jsx(hl,{isDisabled:!!(S&&!G),gizmo:s,onShowActionsEditor:f})]}),!S&&jl(s)&&e.jsxs(ae,{children:[e.jsx(J,{label:e.jsx(u,{id:"R3KeU7",defaultMessage:"Additional Settings"}),collapsed:!!p,onClick:()=>{m(_=>!_)}}),e.jsx(xl,{collapsed:p,initial:!1,children:e.jsx(en,{className:"mx-3 my-1",labelClassName:"w-full cursor-pointer",label:e.jsx(u,{id:"tZgwFW",defaultMessage:"Use conversation data in your GPT to improve our models"}),id:"improve-chatgpt",checked:!s.trainingDisabled,onChange:()=>{t({trainingDisabled:!s.trainingDisabled})}})})]}),I&&e.jsx(bl,{gizmoEditorData:s,updateGizmo:t}),O&&!D&&e.jsx(fl,{gizmoEditorData:s,updateGizmo:t}),D&&e.jsx(tr,{gizmoEditorData:s,onOpen:j})]}),v&&e.jsx(gl,{text:s.instructions??"",onChange:_=>{t({instructions:_})},onClose:()=>c(!1),placeholder:T.formatMessage(X.instructionsSubtitle)})]})}const bl=Fe(()=>Ee(()=>import("./sso-jcpt3wpwa77ct2gh.js").then(s=>s.G),__vite__mapDeps([4,1,2,3,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76])).then(s=>s.GizmoContactsEditor)),X=he({nameTooLong:{id:"gizmo.nameTooLong",defaultMessage:"GPT names cannot be longer than {length} characters."},knowledgeExplanation:{id:"gizmo.knowledgeExplanation",defaultMessage:"Additional files for this GPT to reference."},descriptionTooLong:{id:"gizmo.descriptionTooLong",defaultMessage:"GPT descriptions cannot be longer than {length} characters."},instructionsTooLong:{id:"gizmo.instructionsTooLong",defaultMessage:"GPT instructions cannot be longer than {length} characters."},disabledCustomActionsTooltip:{id:"gizmo.disabledCustomActionsTooltip",defaultMessage:"Custom actions are disabled for your workspace. Contact your admin to enable them."},createActionLabel:{id:"gizmo.createActionLabel",defaultMessage:"Create new action"},maxActionsReached:{id:"gizmo.maxActionsReached",defaultMessage:"GPTs can have a maximum of {number} actions"},descriptionPlaceholder:{id:"gizmo.descriptionPlaceholder",defaultMessage:"Add a short description about what this GPT does"},instructionsSubtitle:{id:"gizmo.instructionsSubtitle",defaultMessage:"What does this GPT do? How does it behave? What should it avoid doing?"},gptNamePlaceholder:{id:"gizmo.gptNamePlaceholder",defaultMessage:"Name your GPT"},callbackUrlLabel:{id:"gizmo.callbackUrlLabel",defaultMessage:"Callback URL"}});function kl(s,t){const a=s.response,r=jt(s);if(!Array.isArray(a))return r;const i=Ns(a.map(n=>{if(n.type==="value_error.any_str.max_length")switch(n.loc[1]){case"display":{switch(n.loc[2]){case"name":return t.formatMessage(X.nameTooLong,{length:n.ctx.limit_value});case"description":return t.formatMessage(X.descriptionTooLong,{length:n.ctx.limit_value})}break}case"instructions":return t.formatMessage(X.instructionsTooLong,{length:n.ctx.limit_value})}if(typeof n.msg=="string")return n.msg}));return i.length>0?i.join(`
`):r}function wl({upsertDraftError:s}){const t=z(),a=kl(s,t);return e.jsxs("div",{className:"flex items-center gap-2 text-red-500",children:[e.jsx("div",{children:e.jsx(u,{...da.errorSavingDraft})}),a!=null&&e.jsx(Ot,{label:a,children:e.jsx(hs,{className:"icon-sm"})})]})}function Ml({isPublished:s,isSavingDraft:t,hasUnpublishedChanges:a,upsertDraftError:r,className:i}){return r instanceof Ca?e.jsx(wl,{upsertDraftError:r}):a?e.jsxs("div",{className:ie("flex items-center gap-2",i),children:[e.jsx("span",{className:"text-token-text-secondary",children:s?e.jsx(u,{id:"gizmoEditor.draftUnpublished",defaultMessage:"Unpublished changes"}):e.jsx(u,{id:"gizmoEditor.draftPending",defaultMessage:"Updates pending"})}),e.jsx("div",{className:"w-4 text-token-text-tertiary",children:t&&e.jsx(Ms,{})})]}):null}const da=he({errorSavingDraft:{id:"gizmo.errorSavingDraft",defaultMessage:"Error saving draft"}});function Tl({clientThreadId:s}){const t=Un(s),a=Kt(s),r=Rn(s,t),i=[...new Array(r).keys()].map(n=>e.jsx(Wn,{isFinalTurn:n===r-1,turnIndex:n,clientThreadId:s,conversationLeafId:t,onChangeItemInView:Re,onChangeRating:Re,onRequestMoreCompletions:Re,onRequestCompletion:Kn,currentModelId:a??""},n));return e.jsx(e.Fragment,{children:i})}function st({clientThreadIds:s}){return e.jsx(e.Fragment,{children:s.map(t=>e.jsx(Tl,{clientThreadId:t},t))})}const _l=Fe(()=>Ee(()=>import("./cyxx35mi27w6zas0.js"),__vite__mapDeps([77,1,2,3,8,5,6,9,10,58,56,57,39,14,15,16,17,18,7,19,20,21,22,23,24,25,26,27,28,29,30])).then(s=>s.DebugConversationSidebar));function tt(){return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"border-token-border-secondary flex-grow border-b"}),e.jsxs("div",{className:"flex flex-shrink-0 items-center gap-2 px-2 py-6 text-sm text-token-text-tertiary",children:[e.jsx(An,{className:"icon-sm"}),e.jsx(u,{id:"qtaMEG",defaultMessage:"GPT updated"})]}),e.jsx("div",{className:"border-token-border-secondary flex-grow border-b"})]})}var Nl=(s=>(s.TestGizmoAction="test_gizmo_action",s))(Nl||{});const Sl=new an;function Pl({gizmoEditorData:s,isSavingDraft:t,currentModelConfig:a,showTitle:r=!0}){var g;const[i,n]=h.useState(()=>Ye()),[l,o]=h.useState([]);h.useEffect(()=>{o(k=>k[k.length-1]===i?k:[...k,i])},[i]);const f=l.slice(0,-1);Jt(i,{kind:Te.GizmoTest,gizmo_id:s.id}),h.useEffect(()=>{B.updateConversationMode(i,{kind:Te.GizmoTest,gizmo_id:s.id})},[i,s.id]);const j=(g=s.files)==null?void 0:g.map(k=>k.file_id).join();h.useEffect(()=>{B.getServerThreadId(i)!=null&&n(Ye())},[s.id,s.instructions,s.tools,j,i]);const y=Bt(k=>k.activeSidebar),v=h.useMemo(()=>({gizmoEditorData:s,mode:"test"}),[s]),[c,p]=h.useState(0),m=()=>{p(k=>k-360)},d=s.id,b=Cl(i,a);return h.useEffect(()=>Ia(Sl,{test_gizmo_action:({rootDomain:k,operationName:S})=>{d&&b(d,k,S)}}),[b,d]),e.jsx(Ft.Provider,{value:v,children:e.jsxs("div",{className:ie("flex h-full w-full",t&&"cursor-wait opacity-80 transition"),children:[e.jsxs("div",{className:"flex grow flex-col",children:[e.jsx("div",{className:"relative mb-2 flex-shrink-0",children:e.jsx("div",{className:"flex justify-center py-1",children:r&&e.jsxs("div",{className:"group flex items-center gap-2 text-lg font-semibold",children:[e.jsx("div",{className:"icon-md"}),e.jsxs("button",{onClick:()=>{m(),o([]),n(Ye())},className:"flex items-center gap-2",children:[e.jsx(u,{id:"2u/6Ja",defaultMessage:"Preview"}),e.jsx(Dt.div,{className:"text-token-text-primary",animate:{rotate:c},transition:{duration:.3},children:e.jsx(In,{className:"icon-md invisible group-hover:visible"})})]})]})})}),e.jsx("div",{className:ie("relative grow overflow-auto px-2",t&&"pointer-events-none"),children:e.jsx(Zt,{clientThreadId:i,hideHeader:!0,renderEmptyState:e.jsxs("div",{className:"relative h-full w-full",children:[f!=null&&f.length>0&&e.jsx("div",{className:"h-full w-full opacity-20",children:e.jsxs(qn,{children:[e.jsx(st,{clientThreadIds:f}),e.jsx(tt,{})]})}),e.jsx("div",{className:"absolute left-0 top-0 h-full w-full",children:e.jsx(Vn,{gizmo:s,hideOwner:!0,showStarterPrompts:!0})})]}),prependThreadChildren:f.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"opacity-50",children:e.jsx(st,{clientThreadIds:f})}),e.jsx(tt,{})]})})})]}),y==="debug"&&e.jsx(_l,{clientThreadId:i,slideOver:!1,onClose:()=>_s.toggleActiveSidebar("debug"),isOpen:!0})]})})}const at=vt.memo(Pl);function Cl(s,t){const a=zt(s,void 0,Re);return h.useCallback(async(i,n,l)=>{if(!t)return;const o=new Et,f=B.getThreadCurrentLeafId(s),j=Ue(),y=nn(n);B.updateTree(s,b=>{b.addNodeToEnd(f,{id:j,children:[],parentId:f,message:{id:j,author:{role:fe.User},content:{content_type:Aa.Text,parts:[`Call the ${n} API with the ${l} operation`]},recipient:"all",metadata:{jit_plugin_data:{from_client:{type:"test",operation:l,tool_name:y}}}}})});const v={conversationMode:{kind:Te.GizmoTest,gizmo_id:i}},c=await yt(),[p,m,d]=await Promise.all([bt.getEnforcementToken(c),$t.getEnforcementToken(c),kt.getEnforcementToken(c)]);a({model:t.id,completionType:wt.Next,parentNodeId:j,metadata:{},focusOnNewCompletion:!0,chatReq:c,arkoseToken:p,turnstileToken:m,proofToken:d,preflightTime:0,completionMetadata:v,turnTracker:o})},[s,a,t])}function Il(s,t){const a=B.getThreadCurrentLeafId(s),r=B.getTree(s),i=[];let n=r.getNodeByIdOrMessageId(a);for(;n!=null&&(t==null||n.id!==t);)i.unshift(n.message),n=n.parentId!==""?r.getNodeByIdOrMessageId(n.parentId):void 0;return i}function Al(s){return s.filter(r=>r.recipient==="gizmo_editor.update_behavior").flatMap(r=>r.content.content_type==="text"?r.content.parts:r.content.content_type==="code"?[r.content.text]:[]).map(r=>JSON.parse(r)).reduce((r,i)=>({...r,...i}),{})}async function Ll(s){let t;for(const a of s)if(a.author.name==="gizmo_editor.generate_profile_pic"){const r=Ua.getImageAssetPointers(a);r.length>0&&(t=r.at(-1))}if(t!=null){const a=rn(t.asset_pointer),r=await $e.getFileDownloadLink(a);if(r.status===Ts.Success)return{id:a,permalink:r.download_url}}}async function Ul(s,t,a){const r=Il(t,a),i=Al(r);let n=await Ll(r);if(ys(i)&&n==null)return;const{name:l,context:o,description:f,profile_pic_file_id:j,prompt_starters:y}=i;if(j!=null)try{const c=await $e.getFileDownloadLink(j,s.id);c.status===Ts.Success&&(n={id:j,permalink:c.download_url})}catch(c){ps.addError(new Error("Error while retrieving profile pic in update",{cause:c})),Z.warning("Something went wrong updating your GPT's profile picture.",{duration:3})}const v={name:typeof l=="string"?l:void 0,description:typeof f=="string"?f:void 0,instructions:typeof o=="string"?o:void 0,promptStarters:Array.isArray(y)?y:void 0,profilePictureId:n==null?void 0:n.id,profilePictureUrl:n==null?void 0:n.permalink};return La(v,c=>c!=null)}function Rl(s){const t=new Set;for(const f of s.tools)t.add(f.type);const a=s.name??"",r=s.description??"",i=s.instructions??"",n=Array.from(t).join(","),l=a===""&&r===""&&i==="",o=s.profilePictureUrl!=null;return l?`The GPT you are about to has the following abilities: ${n}.`:`This is the GPT's current set of fields:

name: ${a}

description: ${r}

context: ${i}

abilities: ${n}

${o?"The GPT has a profile picture.":"This GPT does not have a profile picture. You must generate a profile picture when you next update your behavior."}
`}function ua(s,t,a,r){var c,p;const i=a.current,n=r.current;if(ke(i,n))return;const l={};i.name!==(n==null?void 0:n.name)&&(l.name=i.name),(i.description??"")!==((n==null?void 0:n.description)??"")&&(l.description=i.description??""),i.instructions!==((n==null?void 0:n.instructions)??"")&&(l.context=i.instructions??"");const o=new Set(((c=n==null?void 0:n.files)==null?void 0:c.map(m=>m.file_id))??[]),f=new Set(((p=i.files)==null?void 0:p.map(m=>m.file_id))??[]),j=(i.files??[]).filter(m=>!o.has(m.file_id)),y=((n==null?void 0:n.files)??[]).filter(m=>!f.has(m.file_id));if(ys(l)&&j.length===0&&y.length===0)return;const v=[];if(!ys(l)){const m=`Explicitly update the GPT's behavior to the following exact fields:

    ${JSON.stringify(l,null,2)}

    "Do not call update_behavior yet. Instead, use these updated fields as the GPT's current behavior, and in the next call to update_behavior, incorporate these changes."
    `;v.push(Ie.getTextAsMessage(m,fe.System))}y.length>0&&v.push(Ie.getTextAsMessage(`The user has removed the following files from the GPT. You can no longer reference these files: ${y.map(m=>m.file_id).join(", ")}`,fe.System)),j.length>0&&v.push(Ie.getTextAsMessage(`The user is adding these files to the GPT. The GPT may reference these files. The file IDs are: ${j.map(m=>m.file_id).join(", ")}`,fe.System,{attachments:j.map(m=>({id:m.file_id,name:m.name,size:m.size}))})),v.length>0&&B.updateTree(s,m=>{let d=m.getNodeByIdOrMessageId(t).parentId;for(const b of v){const g=Ue();m.insertNodeBefore(t,{id:g,children:[],parentId:d,message:b,metadata:{isClientCreatedSystemMessage:!0}}),d=g}})}function Gl(s,t,a){if(a.length===0)return;const r=Ue(),i=`The user is uploading files in their next message. If you need to reference these in calls to update_behavior, you will use the following File ID(s), in order: ${a.map(n=>`"${n.fileId}"`).join(", ")}`;B.updateTree(s,n=>{const l=n.getNodeByIdOrMessageId(t).parentId;n.insertNodeBefore(t,{id:r,children:[],parentId:l,message:Ie.getTextAsMessage(i,fe.System),metadata:{isClientCreatedSystemMessage:!0}})})}function Ol(s,t){const a="Remember, you should be calling either update_behavior or generate_profile_pic after most messages from the user. Your personality should be neutral and separate from the GPT you are creating.",r=B.getThreadCurrentLeafId(s),i=B.getTree(s);let n=i.getNodeByIdOrMessageId(r);for(;n!=null&&n.message.author.role!==fe.User;){if(n.message.content.content_type==="text"&&n.message.content.parts[0]===a)return;n=n.parentId!==""?i.getNodeByIdOrMessageId(n.parentId):void 0}B.updateTree(s,l=>{const o=l.getNodeByIdOrMessageId(t).parentId;l.insertNodeBefore(t,{id:Ue(),children:[],parentId:o,message:Ie.getTextAsMessage(a,fe.System,{exclude_after_next_user_message:!0}),metadata:{isClientCreatedSystemMessage:!0}})})}function Bl(s,t,a){B.initThread(s,{kind:Te.GizmoMagicCreate,gizmo_id:void 0,behavior_overrides:a});const i=fn().id,n=Kt(s)??i,l=zt(s,void 0,t);return async(f,j,y)=>{if(y.length===0)return;const v=new Et;let c=B.getThreadCurrentLeafId(s);for(const S of y){const G=Ue();B.updateTree(s,T=>{T.addNodeToEnd(c,{id:G,children:[],parentId:c,message:Ie.getTextAsMessage(S,fe.System),metadata:{isClientCreatedSystemMessage:!0}})}),B.setThreadCurrentLeafId(s,G),c=G}const p=c;ua(s,p,f,j);const m={conversationMode:{kind:Te.GizmoMagicCreate,gizmo_id:f.current.id,behavior_overrides:a}},d=await yt(),[b,g,k]=await Promise.all([bt.getEnforcementToken(d),$t.getEnforcementToken(d),kt.getEnforcementToken(d)]);l({model:n,completionType:wt.Next,parentNodeId:p,metadata:{},focusOnNewCompletion:!0,chatReq:d,arkoseToken:b,turnstileToken:g,proofToken:k,preflightTime:0,completionMetadata:m,turnTracker:v})}}const Fl="Generate a new profile picture for this GPT using gizmo_editor generate_profile_pic. Do not prompt the user for any clarification. Do not send extra text outside of the tool function call. DO NOT CALL update_behavior or otherwise update GPT behavior in your response.",El=Fe(()=>Ee(()=>import("./cyxx35mi27w6zas0.js"),__vite__mapDeps([77,1,2,3,8,5,6,9,10,58,56,57,39,14,15,16,17,18,7,19,20,21,22,23,24,25,26,27,28,29,30])).then(s=>s.DebugConversationSidebar));function $l(s,t){h.useEffect(()=>{const a=B.getTree(s);if(a.findNode(l=>{var o;return l.message.author.role===fe.User||((o=l.metadata)==null?void 0:o.isClientCreatedSystemMessage)===!0})||(B.deleteNodesByFilter(s,l=>{var o;return((o=l.metadata)==null?void 0:o.isPlaceholderTemplateAssistantWelcomeMessage)===!0}),t==null||t.length===0))return;const i=B.getThreadCurrentLeafId(s);if(!a.hasNodeOrMessageId(i))return;const n=Ue();B.updateTree(s,l=>{l.addNode(n,t,i,fe.Assistant,{isPlaceholderTemplateAssistantWelcomeMessage:!0})}),B.setThreadCurrentLeafId(s,n)},[s,t])}function Wl(s,t,a){Jt(s,{kind:Te.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:a}),h.useEffect(()=>{B.updateConversationMode(s,{kind:Te.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:a})},[s,t.id,a]);const[r]=h.useState(()=>{const i=t.id==null,n=t.id!=null&&t.name!==""&&t.description!=null&&t.instructions!==""&&t.profilePictureUrl!=null;return i?`Hi! I'll help you build a new GPT. You can say something like, "make a creative who helps generate visuals for new products" or "make a software engineer who helps format my code."

What would you like to make?`:n?`Welcome back! Is there anything ${t.name} should be doing better? Anything you'd like to change?`:"You're back! Let's continue where we left off..."});$l(s,r)}function ql({gizmoEditorData:s,updateGizmo:t,clientThreadId:a,completionCallbackResponse:r,gizmoEditorDataRef:i,magicMakerBehaviorOverrides:n,magicMakerConversationGizmoEditorDataRef:l,requireGizmoId:o}){const f=h.useMemo(()=>({gizmoEditorData:s,gizmoId:s.id,mode:"magic",behaviorOverrides:n,getGizmoId:o}),[o,s,n]),j=on(c=>c.files.filter(p=>p.status===ne.Ready&&p.gizmoId!=null)),y=h.useCallback((c,p)=>{Gl(c,p,j),ua(c,p,i,l),Ol(c,p),t(m=>({...m,files:[...m.files??[],...Ns(j.map(d=>{var b;return d.fileId!=null&&{file_id:d.fileId,name:d.file.name,size:d.file.size,type:d.file.type,last_modified:d.file.lastModified,file_size_tokens:(b=d.fileSpec)==null?void 0:b.fileTokenSize}}))]})),l.current=Pe(i.current)},[i,l,j,t]),v=Bt(c=>c.activeSidebar);return e.jsx(Ft.Provider,{value:f,children:e.jsxs("div",{className:"relative flex h-full grow overflow-auto",children:[e.jsx("div",{className:"grow",children:e.jsx(Zt,{clientThreadId:a,onCompletionFinished:r,preRequestCompletion:y,hideHeader:!0,prependThreadChildren:e.jsx("div",{className:"h-8"})})}),v==="debug"&&e.jsx(El,{clientThreadId:a,slideOver:!1,onClose:()=>_s.toggleActiveSidebar("debug"),isOpen:!0})]})})}const Hl=vt.memo(ql),Kl=Fe(()=>Ee(()=>import("./oigm1o02katmi446.js"),__vite__mapDeps([78,1,2,3,5,6,79,80,58,10,8,9,42,81,17,82,7,28,18,14,15,16,19,20,21,22,23,24,25,26,27,29,30,83,84,85])).then(s=>s.GizmoActionsEditor));var fa=(s=>(s.MAGIC_MAKER="magic",s.ADVANCED="advanced",s.PREVIEW="preview",s))(fa||{});function us({value:s,label:t}){return e.jsx(At,{value:s,className:"text-md w-1/3 flex-grow rounded-lg border-token-border-light p-1.5 font-semibold text-token-text-tertiary transition hover:text-token-text-primary radix-state-checked:border radix-state-checked:bg-token-main-surface-primary radix-state-checked:text-token-text-primary radix-state-checked:shadow-[0_0_2px_rgba(0,0,0,.03)] md:w-1/2",children:t})}function Vl({className:s,editorTab:t,setEditorTab:a}){const r=z();return e.jsxs(It,{className:ie("flex w-full overflow-hidden rounded-xl bg-token-main-surface-secondary p-1.5 md:w-1/2",s),value:t,onValueChange:i=>{a(i)},children:[e.jsx(us,{value:"magic",label:r.formatMessage(fs.magicMakerLabel)}),e.jsx(us,{value:"advanced",label:r.formatMessage(fs.configureLabel)}),e.jsx("div",{className:"flex w-1/3 md:hidden",children:e.jsx(us,{value:"preview",label:r.formatMessage(fs.previewLabel)})})]})}function Yl(s,t){return s.length!==t.length?!1:s.every(a=>t.some(r=>r.type===a.type))}function Ql(s,t){var a,r;return s.name===t.gizmo.display.name&&s.description===t.gizmo.display.description&&s.instructions===t.gizmo.instructions&&Yl(s.tools,t.tools)&&ke(((a=s.files)==null?void 0:a.map(i=>i.file_id))??[],((r=t.files)==null?void 0:r.map(i=>i.file_id))??[])&&s.profilePictureUrl==t.gizmo.display.profile_picture_url&&s.profilePictureId==t.gizmo.display.profile_pic_id}const ks={id:void 0,instructions:"",name:"",description:"",profilePictureId:void 0,profilePictureUrl:void 0,promptStarters:[],sharing:{recipient:x.Private,subjects:[]},tools:[{type:Q.DALLE}],files:[],trainingDisabled:!1,liveVersion:0},Xl={...ks,tools:[...ks.tools,{type:Q.BROWSER}]};function nt(s){return{id:s.gizmo.id,instructions:s.gizmo.instructions,name:s.gizmo.display.name,description:s.gizmo.display.description??"",profilePictureId:s.gizmo.display.profile_pic_id??void 0,profilePictureUrl:s.gizmo.display.profile_picture_url??void 0,promptStarters:s.gizmo.display.prompt_starters??[],tools:Pe(s.tools),files:Pe(s.files),sharing:s.gizmo.sharing?Pe(s.gizmo.sharing):{subjects:[],recipient:s.gizmo.share_recipient},trainingDisabled:s.gizmo.training_disabled??!1,sharingRecipient:s.gizmo.share_recipient,sharingTargets:Pe(s.gizmo.sharing_targets),liveVersion:s.gizmo.live_version??0}}const pa=({gizmo:s,onNewGizmoId:t})=>{const a=Be(),r=Gt(ht.BrowsingAvailable),i=z(),n=h.useRef(s!=null?nt(s):r?Xl:ks),l=h.useRef(s),o=h.useRef(n.current),[f,j]=h.useState(()=>n.current),[y,v]=h.useState(()=>Ye()),[c]=h.useState(()=>({context_message:Rl(n.current),model_slug:"unused",enabled_tools:[{tool_id:s!=null?"gizmo_editor":"gizmo_creator"}]}));Wl(y,o.current,c);const{data:p}=gn(),m=(p==null?void 0:p.modelsList.find(M=>M.tags.includes(Ga.GPT_4)))??(p==null?void 0:p.modelsList.find(M=>M.id===xn)),{data:d}=Wt(n.current.id),b=hn(),{isPending:g,error:k}=b,S=jn(),G=h.useMemo(()=>d!=null&&!Ql(f,d),[f,d]),T=async()=>{const M=n.current;try{const P=await b.mutateAsync({editorData:M,gizmoId:M.id});if(l.current=P,n.current.id==null){const V=P.gizmo.id;n.current={...n.current,id:V,sharingTargets:P.gizmo.sharing_targets},j(n.current),t==null||t(V)}for(const V of P.tools.filter(ce=>ce.type===Q.JIT_PLUGIN)){const ce=n.current.tools.find(ye=>ye.type===Q.JIT_PLUGIN&&ye.metadata.domain===V.metadata.domain);ce&&ce.metadata.action_id!==V.metadata.action_id&&(ce.metadata={...ce.metadata,action_id:V.metadata.action_id},j(n.current))}return P}catch(P){const V=jt(P)??i.formatMessage(da.errorSavingDraft);throw Z.warning(V,{duration:2}),P}},I=h.useRef(),O=async()=>n.current.id!=null?n.current.id:(I.current==null&&(I.current=T().then(M=>M.gizmo.id).catch(M=>{throw I.current=void 0,M})),I.current),[D]=h.useState(()=>cn(()=>T(),2e3,{trailing:!0}));function _(M,P=!0){const V=typeof M=="function"?M(n.current):Ho(n.current,M);ke(V,n.current)||(n.current=V,j(n.current),P&&D())}const C=h.useRef(),q=async M=>{if(M==null){$(!1);return}try{const P=await Ul(n.current,M,C.current);P!=null&&(_(P),o.current=Pe(n.current))}catch(P){ps.addError(P),Z.warning("Something went wrong generating your GPT",{duration:3})}finally{C.current=B.getThreadCurrentLeafId(M),$(!1)}},H=Bl(y,q,c),[U,K]=h.useState(void 0);h.useEffect(()=>{K(Qn(s))},[s==null?void 0:s.gizmo.id]);const R=async(M,P)=>{const V=qe(n.current,M.recipient,P);if(V.length>0){Z.warning(`Could not save GPT:

${V.map(Ne=>`- ${bs(Ne)}`).join(`
`)}`,{duration:3});return}const ce=await T(),ye=ce.gizmo.id;try{return gt.logEvent(xt.promoteGizmo,{gizmo_id:ce.gizmo.id,sharing_recipient:M.recipient,editor_tab:se}),await S.mutateAsync({gizmoId:ce.gizmo.id,data:{sharingSubjects:M.subjects,sharingRecipient:M.recipient,categories:P==null?void 0:[P]}},{onSuccess(ma){a.setQueryData(Es(a,ye).queryKey,ma),a.invalidateQueries({queryKey:["gizmos"]}),a.invalidateQueries({queryKey:["gizmo",{gizmoId:ye}]}),a.invalidateQueries({queryKey:["gizmo","userActionSettings",{gizmoId:ye}]})}})}catch(Ne){Ne instanceof dn?K({gizmoId:ye,sharingRecipient:M.recipient,moderationType:ss.PublishBlocked,sharingTargets:Ne.response.sharing_targets,showModal:we.AppealAvailable}):(ps.addError(Ne),Z.warning("Error saving GPT",{duration:2}))}},je=b.isPending||S.isPending,[se,me]=h.useState(()=>{const M=Us.getItem(Rs.GizmoEditorTab);return Object.values(fa).includes(M)?M:"magic"}),ge=Oa.useState(({windowWidth:M})=>M);h.useEffect(()=>{ge!=null&&ge>=768&&se==="preview"&&me("magic")},[ge,se]);const[_e,ve]=h.useState(!1),[N,$]=h.useState(!1),[w,A]=h.useState(void 0),[te,le]=h.useState(!1);return e.jsxs("div",{className:"flex h-screen w-full flex-col items-center",children:[e.jsx(ll,{gizmoEditorData:f,isLoading:je,hasUnpublishedChanges:G,isUploadingProfilePic:_e,isGeneratingProfilePic:N,publishedGizmo:d,updateGizmo:_,promoteGizmo:async(M,P)=>{const V=await R(M,P);return n.current={...n.current,sharingRecipient:M.recipient},j(n.current),Us.setItem(Rs.GizmoEditorTab,se),V},appealGizmo:async(M,P)=>{U!=null&&K({...U,sharingRecipient:M,categories:P==null?void 0:[P],showModal:we.AppealAvailable})},setAppealState:K,revertDraft:d!=null&&G?()=>{const M=a.getQueryData(Es(a,n.current.id).queryKey);if(M!=null){const P=nt(M);n.current=P,j(P),T()}}:void 0,draftMessage:e.jsx(Ml,{isPublished:d!=null&&(d.gizmo.share_recipient==="marketplace"||d.gizmo.share_recipient==="workspace"),hasUnpublishedChanges:G,isSavingDraft:g,upsertDraftError:k,className:"text-sm"}),showActionsModal:M=>{A(M)},className:"flex-shrink-0"}),U&&e.jsx(sr,{appealState:U,onAppealClose:()=>K({...U,showModal:we.None}),onAppealSubmitted:()=>K({...U,showModal:we.AppealSent})}),e.jsxs("div",{className:"relative flex w-full grow overflow-hidden",children:[e.jsx("div",{className:"flex w-full justify-center md:w-1/2",children:e.jsx("div",{className:"h-full grow overflow-hidden",children:w!==void 0?e.jsx(Kl,{currentlyEditingActionDomain:w,gizmoEditorData:f,updateGizmo:_,onClose:()=>{A(void 0)}}):te?e.jsx(ar,{gizmoEditorData:f,updateGizmo:_,onClose:()=>{le(!1)}}):e.jsxs("div",{className:"flex h-full flex-col px-2 pt-2",children:[e.jsx("div",{className:"flex w-full flex-row justify-center",children:e.jsx(Vl,{editorTab:se,setEditorTab:me,className:"mb-2 flex-shrink-0 self-center"})}),e.jsx("div",{className:"grow overflow-hidden",children:se==="magic"?e.jsx("div",{className:"h-full w-full pb-5",children:e.jsx(Hl,{gizmoEditorData:f,updateGizmo:_,completionCallbackResponse:q,clientThreadId:y,gizmoEditorDataRef:n,magicMakerBehaviorOverrides:c,magicMakerConversationGizmoEditorDataRef:o,requireGizmoId:O},y)}):se==="advanced"?e.jsx(yl,{gizmoEditorData:f,updateGizmo:_,currentModelConfig:m,generateProfilePic:()=>{$(!0),H(n,o,[Fl])},setIsUploadingProfilePic:ve,isGeneratingProfilePic:N,setIsGeneratingProfilePic:$,requireGizmoId:O,onShowActionsEditor:M=>{A(M)},onShowBlocksEditor:()=>{le(!0)}}):e.jsx(at,{gizmoEditorData:f,currentModelConfig:m,isSavingDraft:g,showTitle:!1})})]})})}),e.jsx("div",{className:ie("hidden w-1/2 justify-center border-l border-token-border-medium bg-token-main-surface-secondary pt-4",se!=="preview"&&"md:flex"),children:e.jsx("div",{className:"flex-grow pb-5",children:e.jsx("div",{className:"h-full",children:e.jsx(at,{gizmoEditorData:f,currentModelConfig:m,isSavingDraft:g})})})})]})]})};function Jl({gizmoId:s,version:t}){const{data:a}=mn({gizmoId:s,draft:!0,version:t}),r=Je(Ct.accountUserId),i=St(),n=i==null?void 0:i.id,l=a!=null&&r!=null&&n!=null&&ln(a);return a!=null&&l?e.jsx(pa,{gizmo:a}):null}function Zl({onNewGizmoId:s}){return e.jsx(pa,{gizmo:void 0,onNewGizmoId:s})}function hc({gizmoId:s,remixSourceId:t,version:a}){const r=Ra(),i=Le(),n=h.useRef(void 0);let l=s;return s!=null&&n.current===s&&(l=void 0),Gn({resetThreadAction:()=>{r.push("/")}}),e.jsx("div",{children:i!=null&&i.data?e.jsx("div",{children:l!=null?e.jsx(Jl,{gizmoId:l,version:a},l):e.jsx(Zl,{remixSourceId:t,onNewGizmoId:o=>{n.current=o,window.history.replaceState(window.history.state,"",pn(o))}})}):e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx(Ms,{})})})}const fs=he({magicMakerLabel:{id:"gizmo.magicMakerLabel",defaultMessage:"Create"},configureLabel:{id:"gizmo.advancedLabel",defaultMessage:"Configure"},previewLabel:{id:"gizmo.previewLabel",defaultMessage:"Preview"}});export{hc as G,Jo as S,Sl as a,Nl as b,nt as c};
//# sourceMappingURL=l2uxr75nbaynnow9.js.map
