import{t as s,bC as R,K as v,aw as W,al as J,W as F,r as c,c as Z,f as z,P as ee,a0 as q,g as te,cB as se,bh as ne,aY as H,b as ae,eo as oe,v as re,N as ce,bq as ie}from"./bzvcy3tl84gc3bl9.js";import{K,V as le,b4 as ue,t as de,S as me}from"./o4htpc5iqra16abg.js";import{aH as fe,eb as Q,d as xe}from"./moittmkqym6x2q8u.js";import{m as he}from"./d6ri6s3v2tbmwdon.js";import{u as E,F as $,a as k,b as ge}from"./k8qlw5luyf42jeyi.js";import{U as ye}from"./doew5jjpf8k0sin5.js";import{u as pe}from"./glkcmrbsq3gptlrq.js";import{u as ve}from"./b2nwax1gutiivxyr.js";import{g as U}from"./f064jjm5wr3qzqg4.js";import{u as ke}from"./fgf2dg6l6im1fsb5.js";import"./ebzdroxnuj9v1lzs.js";import"./c3nvn3bmsyj77vtl.js";import"./ia40vr3rpj4bcpvd.js";import"./o5egk1m8ftkmbhvq.js";function be({children:e,rootClassName:t,className:n,description:a,icon:i,isOpen:o=!1,onClose:r,primaryButton:f,secondaryButton:m,size:h="normal",title:x,type:l,noPadding:d=!1,hideSeparator:b=!1,showCloseButton:y=!1,shouldIgnoreClickOutside:w=!1,closeButton:_,isScrollable:S=!0,position:A="center",isProduceDesign:L=!1,showOverlayBackground:O=!0,shadow:M="normal"}){const P=!!x,I=!!e,u=P&&I&&!b;return s.jsx(fe,{children:o&&s.jsx(R.Root,{isOpen:!0,onClose:r,shouldIgnoreClickOutside:w,className:t,children:s.jsx(R.Overlay,{showBackground:O,children:s.jsxs(we,{size:h,position:A,className:v("flex flex-col focus:outline-none",{"max-w-md":h==="normal"},n),isProduceDesign:L,shadow:M,children:[s.jsx(R.Header,{icon:i,title:x,type:l,closeButton:y&&(_??s.jsx(W,{onClick:()=>r(!0)})),description:a,withSeparator:u}),s.jsxs("div",{className:v("flex-grow",S?"overflow-y-auto":"overflow-y-hidden",{"p-4 sm:p-6":h!=="fullscreen"&&!d,"md:!pt-0":!I}),children:[e,f!=null||m!=null?s.jsx(R.Actions,{primaryButton:f,secondaryButton:m,modalHasContent:I}):null]})]})})})})}function we({className:e,children:t,position:n="center",size:a,isProduceDesign:i=!1,shadow:o="normal"}){return s.jsx(he.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:14},transition:{duration:.175,ease:"easeInOut",exit:{opacity:{duration:.1,ease:"easeOut"},y:{duration:.175,ease:"easeOut"}}},className:v("z-50 h-full w-full overflow-y-auto",a!=="fullscreen"&&"grid grid-cols-[10px_1fr_10px]",a!=="fullscreen"&&n==="center"&&"grid-rows-[minmax(10px,_1fr)_auto_minmax(10px,_1fr)] md:grid-rows-[minmax(20px,_1fr)_auto_minmax(20px,_1fr)]",a!=="fullscreen"&&n==="bottom"&&"grid-rows-[minmax(10px,_1fr)_auto_10px] md:grid-rows-[minmax(20px,_1fr)_auto_20px]"),children:s.jsx(J,{className:v(!i&&"popover","relative start-1/2 col-auto col-start-2 row-auto row-start-2 h-full w-full bg-token-main-surface-primary text-start ltr:-translate-x-1/2 rtl:translate-x-1/2",a!=="fullscreen"&&"rounded-2xl",o==="normal"&&"shadow-xl",e),children:t})})}function je(){const e=F(),t=E(a=>a.item),n=c.useRef(null);return s.jsx("input",{className:"w-full border-none bg-transparent placeholder:text-token-text-tertiary focus:border-transparent focus:outline-none focus:ring-0",placeholder:e.formatMessage({id:"FannyPack.SearchPlaceholder",defaultMessage:"Search chats..."}),onChange:a=>$.setItem(a.target.value),onKeyDown:a=>{!a.shiftKey&&(a.key==="ArrowUp"||a.key==="ArrowDown")&&a.preventDefault()},value:t,ref:n})}const Ne={activeIndex:void 0,mouseInteractionsDisabled:!1},j=Z(z(()=>({...Ne}))),Ce=j.getState,T=j.setState,g={setActiveIndex:e=>{T(t=>{t.activeIndex=e,t.mouseInteractionsDisabled=!0})},getMouseInteractionsDisabled:()=>Ce().mouseInteractionsDisabled,setMouseInteractionsDisabled:e=>{T(t=>{t.mouseInteractionsDisabled=e})}};function C({className:e,isActive:t=!1,icon:n,children:a,onClick:i,onMouseEnter:o,onMouseLeave:r}){const f=j(m=>m.mouseInteractionsDisabled);return s.jsx("div",{className:v("cursor-pointer",e),onMouseEnter:f?void 0:o,onMouseLeave:f?void 0:r,onClick:i,children:s.jsxs("div",{className:v("group relative flex items-center rounded-lg px-4 py-3",t&&"bg-[#f4f4f4] dark:bg-token-main-surface-secondary"),children:[n,s.jsx("div",{className:v("relative grow overflow-hidden whitespace-nowrap",n?"pl-4":""),children:a})]})})}function Y(e){return e.formatMessage({id:"fannyPack.DefaultChatTitle",defaultMessage:"New chat"})}function Se({historyResult:e,index:t}){const n=F(),{item:a,onSelect:i}=e,o=j(r=>r.activeIndex);return s.jsx(C,{isActive:o===t,icon:s.jsx(K,{className:"icon-sidebar text-token-text-secondary"}),onClick:()=>{k.logClick(a.id,t,"history"),i&&i()},onMouseEnter:()=>g.setActiveIndex(t),onMouseLeave:()=>g.setActiveIndex(void 0),children:s.jsx("div",{className:"text-sm",children:a.title??Y(n)})})}function Me({labelResult:e}){return s.jsx("div",{className:"group relative my-2 px-4 py-2 text-xs font-medium leading-4 text-token-text-secondary",children:e.text})}function Pe({newChatResult:e,index:t}){const{onSelect:n}=e,a=j(i=>i.activeIndex);return s.jsx(C,{isActive:a===t,onClick:()=>{ee.logNewChatButtonClicked({location:"Fanny Pack"}),n&&n()},onMouseEnter:()=>g.setActiveIndex(t),onMouseLeave:()=>g.setActiveIndex(void 0),icon:s.jsx(le,{className:"icon-sidebar text-token-text-secondary"}),children:s.jsx("div",{className:"text-sm",children:s.jsx(q,{id:"FannyPack.NewChat",defaultMessage:"New chat"})})})}function Ie(e){return c.useMemo(()=>{if(!e)return null;const t=new Date(e*1e3),n=new Date;return t.toDateString()===n.toDateString()?"Today":new Date(new Date().setDate(n.getDate()-1)).toDateString()===t.toDateString()?"Yesterday":t.getFullYear()===n.getFullYear()?t.toLocaleDateString(void 0,{month:"short",day:"numeric"}):t.toLocaleDateString(void 0,{year:"2-digit",month:"numeric",day:"numeric"})},[e])}var Re=se,V=/[\\^$.*+?()[\]{}|]/g,Fe=RegExp(V.source);function Ee(e){return e=Re(e),e&&Fe.test(e)?e.replace(V,"\\$&"):e}var De=Ee;const _e=te(De),Ae=8;function Le(e){return e.isArchived?{titleClassName:"text-sm text-token-text-tertiary",titleHighlightedClassName:"text-token-text-secondary font-semibold",messageClassName:"text-xs text-token-text-tertiary",messageHighlightedClassName:"text-token-text-secondary font-medium"}:{titleClassName:"text-sm text-token-text-primary",titleHighlightedClassName:"text-token-text-primary font-semibold",messageClassName:"text-xs text-token-text-secondary",messageHighlightedClassName:"text-token-text-primary font-medium"}}function B({text:e,textToHighlight:t,shouldAdjustStart:n=!1,highlightClassName:a}){const i=c.useMemo(()=>{if(!n||!t)return e;const r=e.toLowerCase().indexOf(t?.toLowerCase());if(r===-1)return e;const f=Math.max(r-Ae,0),m=e.substring(f);return f===0?m:"â€¦"+m},[e,t,n]),o=c.useMemo(()=>{const r=new RegExp(`(${_e(t)})`,"gi");return i.split(r)},[i,t]);return!t||t.length===0?s.jsx("span",{children:e}):s.jsx("div",{className:"truncate",children:o.map((r,f)=>r.toLowerCase()===t.toLowerCase()?s.jsx("span",{className:a,children:r},f):r)})}function Oe({searchResult:e,index:t,elementRef:n}){const{item:a,onSelect:i,query:o}=e,r=F(),f=Ie(a.updateTime),m=Le(a),x=j(d=>d.activeIndex)===t,l=c.useRef(null);return c.useEffect(()=>{let d;const b=setTimeout(()=>{d=new IntersectionObserver(y=>{y.forEach(w=>{w.isIntersecting&&(k.logImpression(o,a.source,t,a.conversationId),d&&d.disconnect())})},{threshold:.5}),l.current&&d.observe(l.current)},250);return()=>{d&&d.disconnect(),clearTimeout(b)}},[l,a,o,t]),s.jsx("div",{ref:l,children:s.jsx(C,{isActive:x,icon:a.isArchived?s.jsx(ue,{className:"icon-sidebar text-token-text-tertiary"}):s.jsx(K,{className:"icon-sidebar text-token-text-secondary"}),onClick:()=>{k.logClick(a.conversationId,t,a.source),i&&i()},onMouseEnter:()=>g.setActiveIndex(t),onMouseLeave:()=>g.setActiveIndex(void 0),children:s.jsxs("div",{className:"flex items-center",ref:n,children:[s.jsxs("div",{className:"relative grow overflow-hidden whitespace-nowrap",children:[s.jsx("div",{className:m.titleClassName,children:s.jsx(B,{text:a.title&&a.title.length>0?a.title:Y(r),textToHighlight:o.length>=3?o:void 0,highlightClassName:m.titleHighlightedClassName})}),s.jsx("div",{className:v("pt-1",m.messageClassName),children:s.jsx(B,{text:a.snippet??"",textToHighlight:o.length>=3?o:void 0,shouldAdjustStart:!0,highlightClassName:m.messageHighlightedClassName})})]}),x&&s.jsx("div",{className:"pl-6 text-xs text-token-text-secondary",children:f})]})})})}function D(){return c.useMemo(()=>({closeFannyPackModal:e=>{k.logClose(e),$.setIsActive(!1)}}),[])}function X(){const e=ne(),t=Q(),{closeFannyPackModal:n}=D();return c.useCallback(a=>{t&&ye.closeActiveSidebar(),e(a),n("click")},[e,n,t])}function Te(){const{conversations:e}=ve(),t=H("550560761").config.value,n=Number(t?.history_results_limit??6),a=c.useMemo(()=>e.slice(0,Math.min(e.length,n)),[e,n]),i=pe(a,0),o=X(),r=c.useMemo(()=>({kind:"newChat",onSelect:()=>{o("/")}}),[o]);return c.useMemo(()=>{const m=[r];return m.push(...[i.recent,i.dynamicMonths,i.dynamicYears].reduce((h,x)=>(Object.entries(x).forEach(([l,{items:d,label:b}])=>{d.length>0&&(h.push({kind:"label",text:b}),d.forEach(y=>{h.push({kind:"history",onSelect:()=>{o(U(y.id))},item:y})}))}),h),[])),m},[r,i,o])}async function Be({query:e,cursor:t}){const n={query:e,...t&&{cursor:t}};return ae.getAnonAware("/conversations/search",{params:n,intercomEventOnError:"fetch-error:conversations:search:get"})}function qe(){const e=E(u=>u.item),t=X(),[n,a]=c.useState(""),[i,o]=c.useState(!1),r=c.useRef(xe(u=>{o(!1),a(u)},250)).current,f=c.useCallback(u=>{u!==n&&(o(!0),r(u))},[n,r]);c.useEffect(()=>{f(e)},[e,f]);const{data:m,isError:h,isLoading:x,isFetchingNextPage:l,hasNextPage:d,fetchNextPage:b}=oe({queryKey:[n],queryFn:({pageParam:u})=>Be({query:n,cursor:u}),initialPageParam:"",getNextPageParam:u=>u.cursor??void 0,enabled:!!n});c.useEffect(()=>{x&&k.logQuery(n)},[x,n]),c.useEffect(()=>{h&&k.logQueryError(n)},[h,n]),c.useEffect(()=>{l&&k.logQueryMore(n)},[l,n]);const y=c.useMemo(()=>m?.pages.flatMap(u=>u.items)??[],[m]),w=c.useRef(null),_=c.useCallback(u=>{x||u==null||(w.current?.disconnect(),w.current=new IntersectionObserver(p=>{p[0].isIntersecting&&!l&&d&&b()}),w.current.observe(u))},[x,l,d,b]);c.useEffect(()=>()=>{w.current?.disconnect()},[]);const S=y&&n===e,A=e.length>0&&(i||x||l),L=H("550560761").config.value,O=Number(L?.local_results_limit??0),M=ke(e,O),P=c.useMemo(()=>{const u=M;return S&&y.forEach(p=>{u.has(p.conversation_id)||u.set(p.conversation_id,{conversationId:p.conversation_id,nodeId:p.current_node_id,title:p.title,isArchived:p.is_archived,updateTime:p.update_time,snippet:p.payload.snippet,source:"remote"})}),Array.from(u.values())},[M,y,S]);return{searchResults:c.useMemo(()=>P.map(u=>({kind:"search",onSelect:()=>{t(U(u.conversationId))},item:u,query:e})),[P,t,e]),shouldShowLoading:A,infiniteScrollTriggerElementRef:_}}function He(e,t,n){switch(e.kind){case"history":return s.jsx(Se,{historyResult:e,index:t});case"label":return s.jsx(Me,{labelResult:e});case"loading":return s.jsx(Ue,{loadingResults:e});case"newChat":return s.jsx(Pe,{newChatResult:e,index:t});case"noResults":return s.jsx($e,{});case"search":return s.jsx(Oe,{searchResult:e,index:t,elementRef:n})}}function Ke(e,t){const n=c.useCallback(()=>{for(let o=(e??-1)+1;o<t.length;o++)if(t[o].onSelect)return o;return e},[e,t]),a=c.useCallback(()=>{for(let o=(e??t.length)-1;o>=0;o--)if(t[o].onSelect)return o;return e},[e,t]),i=c.useCallback(()=>{e!==void 0&&t[e]&&t[e].onSelect&&t[e].onSelect()},[e,t]);c.useEffect(()=>{const o=r=>{r.key==="ArrowUp"&&!r.shiftKey?g.setActiveIndex(a()):r.key==="ArrowDown"&&!r.shiftKey?g.setActiveIndex(n()):(r.key==="Enter"||r.key==="Return")&&(r.preventDefault(),i())};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[a,n,i]),c.useEffect(()=>{const o=()=>{g.getMouseInteractionsDisabled()&&g.setMouseInteractionsDisabled(!1)};return window.addEventListener("mousemove",o),()=>{window.removeEventListener("mousemove",o)}},[])}function Qe(e,t){const n=c.useRef([]);return c.useEffect(()=>{n.current=t.map(()=>ce.createRef())},[t]),c.useEffect(()=>{n.current.forEach((a,i)=>{e===i&&a?.current&&a.current.scrollIntoView({behavior:"instant",block:"nearest"})})},[e,n]),n}function $e(){return s.jsx(C,{className:"text-sm text-token-text-tertiary",icon:s.jsx(de,{className:"icon-sidebar"}),children:s.jsx(q,{id:"FannyPack.Noresults",defaultMessage:"No results"})})}function N(){return s.jsx(C,{icon:s.jsx("div",{className:"loading-results-shimmer h-[14px] w-[14px] rounded-full bg-token-main-surface-secondary"}),children:s.jsxs("div",{className:"flex min-h-[40px] flex-col justify-center",children:[s.jsx("div",{className:"loading-results-shimmer h-2 w-1/4 rounded-full bg-token-main-surface-secondary"}),s.jsx("div",{className:"loading-results-shimmer mt-3 h-2 w-1/2 rounded-full bg-token-main-surface-secondary"})]})})}function Ue({loadingResults:e}){return e.shouldShowMultiple?s.jsxs(s.Fragment,{children:[s.jsx(N,{}),s.jsx(N,{}),s.jsx(N,{}),s.jsx(N,{}),s.jsx(N,{})]}):s.jsx(N,{})}function Ye(){const{searchResults:e,shouldShowLoading:t,infiniteScrollTriggerElementRef:n}=qe(),a=Te(),i=E(l=>l.item),o=i.length>0;c.useEffect(()=>{k.setQuerySessionId(re())},[i]);const r=c.useMemo(()=>{const l=[];return o?l.push(...e):l.push(...a),t?l.push({kind:"loading",shouldShowMultiple:l.length===0}):l.length===0&&l.push({kind:"noResults"}),l},[o,t,e,a]),f=j(l=>l.activeIndex);Ke(f,r);const m=Qe(f,r),h=c.useRef(null);c.useEffect(()=>{g.setActiveIndex(0),h.current&&(h.current.scrollTop=0)},[i]);const x=c.useRef(!0);return c.useEffect(()=>{x.current&&!t&&r.length===1&&r[0].kind==="noResults"&&k.logNoResults(ge.getItem()),x.current=t},[t,r]),s.jsx("div",{ref:h,children:s.jsx("ol",{className:"mx-2",children:r.map((l,d)=>s.jsx("li",{ref:m.current[d],children:He(l,d,d===r.length-1?n:void 0)},d))})})}function ut(){const e=E(n=>n.isActive);return Q()?s.jsx(Xe,{isOpen:e}):s.jsx(Ge,{isOpen:e})}function Ve({onClick:e,className:t}){const n=F();return s.jsx("button",{className:v("flex items-center justify-center rounded-full bg-transparent p-1 hover:bg-token-main-surface-secondary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-token-text-quaternary focus-visible:ring-offset-1 focus-visible:ring-offset-transparent dark:hover:bg-token-main-surface-tertiary",t),"aria-label":n.formatMessage({id:"Px7S/2",defaultMessage:"Close"}),onClick:e,children:s.jsx(me,{className:"icon-sidebar text-token-text-tertiary hover:text-token-text-primary"})})}function G({className:e}){const{closeFannyPackModal:t}=D();return s.jsxs("div",{className:v("flex flex-col",e),children:[s.jsxs("div",{className:"ml-6 mr-4 flex max-h-[64px] min-h-[64px] items-center justify-between",children:[s.jsx(je,{}),s.jsx(Ve,{className:"ml-4",onClick:()=>{t("button")}})]}),s.jsx("hr",{className:"border-token-border-light"}),s.jsx("div",{className:"my-2 flex-grow overflow-y-auto",children:s.jsx(Ye,{})})]})}function Xe({isOpen:e}){const{closeFannyPackModal:t}=D();return s.jsx(ie,{isOpen:e,onClose:()=>{t("modal")},size:"fullscreen",showCloseButton:!0,type:"success",noPadding:!0,children:s.jsx(G,{})})}function Ge({isOpen:e}){const{closeFannyPackModal:t}=D();return s.jsx(be,{className:"border border-token-border-light shadow-[0_14px_62px_0_rgba(0,0,0,0.25)] md:min-w-[680px] md:max-w-[680px]",isOpen:e,onClose:()=>{t("modal")},showCloseButton:!0,type:"success",noPadding:!0,showOverlayBackground:!1,shadow:"custom",children:s.jsx(G,{className:"max-h-[440px] min-h-[440px]"})})}export{ut as FannyPackModalContainer};
//# sourceMappingURL=iv08grkmn782uzfq.js.map
