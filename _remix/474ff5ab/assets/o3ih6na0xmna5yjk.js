import{eY as ce,eZ as $,cp as le,e_ as b,r as d,dk as fe,bo as ye,e$ as de,P as j,f0 as me,u as y,e0 as I,ar as Z,av as U,R as X,X as ge,cM as pe,e4 as he,bk as Me,bq as _e,a7 as O,eQ as J,E as S,F as v,bN as W}from"./pcnl88zwhe6noauc.js";import{bY as ee,z as x,bD as ze,e9 as Se,ea as Ge,eb as Pe,ec as Ce,ed as Y,bK as ve,ee as Ee,ef as F,aK as a,eg as qe,eh as Fe,ei as be,ej as we,ek as Te}from"./id6kv7jv9hphxx5c.js";import{T as R,y as Le,f as De}from"./jihcmvvrci5c89vd.js";function Re({clientThreadId:e}){var i;const r=R.getThreadCurrentLeafId(e),n=((i=R.getTree(e).getMessage(r).metadata)==null?void 0:i.model_switcher_deny)??[],s={};n.forEach(u=>{const{slug:f,context:c,reason:l,description:g}=u,m=s[f]??{},h=m[c]??[];h.push({reason:l,description:g}),m[c]=h,s[f]=m});const o=ce();for(const{resets_after:u,model_slug:f}of o)[$.CONVERSATION,$.REGENERATE].forEach(c=>{const l=s[f]??{},g=l[c]??[],m={reason:le.RATE_LIMIT,resetsAfter:u};g.push(m),l[c]=g,s[f]=l});return s}const Je="text-davinci-002-render-sha",er="gpt-4",rr="gpt-4o",tr="o1-preview",nr="o1-mini",Q=ee({slug:x,max_tokens:4097,title:"Default",description:"",tags:[b.GPT_3_5],product_features:{}}),Qe=({default_model:e,tagline:r,color:t,human_category_name:n,category:s,human_category_short_name:o,human_category_shorter_name:i,subscription_level:u,short_explainer:f,subcategory:c,...l})=>({color:t,tagline:r,defaultModel:e,label:n,shortLabel:o,description:f,shorterLabel:i??o,subscriptionLevel:u,categoryId:s,subcategory:c,...l}),Ue=({icon:e,icon_filled_src:r,icon_outline_src:t})=>({iconName:e,iconFilledSrc:r,iconOutlineSrc:t}),Ae=({group:e,human_group_name:r,human_group_short_name:t,model_ids:n})=>({group:e,label:r,shortLabel:t,modelIds:n});function Ke(){return U({retry:5,queryKey:["modelIcons"],queryFn:async()=>await X.getModelIcons().then(e=>Object.fromEntries(Object.entries(e).map(([r,t])=>[r,Ue(t)])))})}function Ie(e){return U({retry:5,queryKey:["models",{isHistoryDisabled:e}],queryFn:async()=>await X.getModels(e).then(r=>{const{models:t,internal_groups:n,categories:s}=r,o=t.map(ee);return{categories:s.concat().reverse().map(Qe),groups:(n==null?void 0:n.map(Ae))??[],modelsList:o,modelsMap:Object.fromEntries(o.map(i=>[i.id,i]))}})})}function E(){const e=me();return y(Ie(e))}function sr(){return y(Ke())}function Oe({isRegen:e=!1}={}){const{isLoading:r,data:{categories:t=[],groups:n=[]}={}}=E(),s=d.useMemo(()=>e?t.filter(o=>o.is_regenerate_category!==!1):t.filter(o=>!o.is_regenerate_category),[t,e]);return{isLoading:r,categories:s,groups:n??[]}}function or(){const{categories:e}=Oe();return!!e.find(({categoryId:r})=>r===ze.GPT4o)}function ir(){const{data:e}=E();return d.useMemo(()=>e?new Set(Object.keys(e.modelsMap)):new Set([x]),[e])}const xe={[x]:Q};function Ne(){const{data:e}=E();return(e==null?void 0:e.modelsMap)??xe}function re(e,r,t){let n=b.GPT_3_5;return t?n=b.GPT_4:r&&(n=b.GPT_4o),(e==null?void 0:e.modelsList.find(s=>s.tags.includes(n)))??(e==null?void 0:e.modelsList[0])??Q}function ur(e=!1){const r=fe(),t=ye(),[,n]=de();return d.useCallback(({location:s,modelId:o})=>{const i=r.pathname.includes("/g/");e||i?(j.logNewChatButtonClicked({location:s}),t({pathname:"/",search:`?model=${encodeURIComponent(o)}`})):(n(u=>(u.set("model",encodeURIComponent(o)),u)),j.logNewChatButtonClicked({location:s}))},[e,r,t,n])}function ar(){const{data:{categories:e=[]}={}}=E(),{doesUserHaveAnyAccountsWithPlusFeatures:r}=I();if(r)return null;const t=e.find(Se);return(t==null?void 0:t.defaultModel)??null}function ke(e){return Le(e)}function te(e){const r=ke(e),t=Ne();return d.useMemo(()=>r==null?Q:t[r]??Q,[r,t])}function cr(e,r){var n;return((n=te(e).enabledTools)==null?void 0:n.includes(r))??!1}function lr(e){const r=Ge(),t=te(e),n=d.useMemo(()=>!r.isSuccess||!r.data?[]:r.data,[r.data,r.isSuccess]),s=Re({clientThreadId:e});return d.useMemo(()=>{const i=new Set(t.enabledTools||[]);return n.filter(u=>!(!(u.requiredFeatures.length===0||u.requiredFeatures.every(l=>i.has(l)))||!(u.requiredModels.length===0||u.requiredModels.some(l=>!s[l]))))},[n,t,s])}function fr(e){return decodeURIComponent(e.model??"")||null}function yr(){const{data:e}=E(),{doesUserHaveAnyAccountsWithPlusFeatures:r}=I(),t=Z();return re(e,!!r,!!(t!=null&&t.isEnterprise()))}const ne="q",He="m";function dr(e){const{clientThreadId:r,currentLeafId:t,handleRequestCompletion:n}=e,s=d.useRef(!1),{isLoading:o,data:i}=E(),{doesUserHaveAnyAccountsWithPlusFeatures:u,isLoading:f}=I(),c=Z(),l=ge(),g=d.useCallback((M,G,_,P)=>{R.updateTree(r,C=>{C.addNode(M,_,G,pe.User,void 0,P)})},[r]),m=d.useCallback(async(M,{content:G,attachments:_},P,C,q,L)=>{const K=t,p=_.length>0?{attachments:_}:{};p.system_hints=C.systemHints,g(M,K,G,p),n({type:he.Next,promptId:M,requestedModelId:L,eventMetadata:P,cancelActiveRequests:!0,completionMetadata:C,turnTracker:q})},[g,n,t]),h=Me(()=>window.location.pathname)??null,k=Pe();let H=!o&&!f&&h!=null;const[A,T]=d.useState(!0);return d.useEffect(()=>{if(!A||s.current)return;const M=De.getConversationMode(r);if(!H||M==null)return;if(!$e(h)||Be(h)&&k===void 0||R.getServerThreadId(r)!=null){T(!1);return}const{[ne]:G,[He]:_,[Ee]:P,...C}=l.query,q=(typeof G=="string"?G:null)??(typeof _=="string"?_:null);if(!q||!q.trim()){T(!1);return}const L=Ce(P),K=_e();s.current=!0;let p=i==null?void 0:i.modelsList;L.has(Y.Search)&&(p=p==null?void 0:p.filter(ae=>{var B;return(B=ae.enabledTools)==null?void 0:B.includes(Y.Search)}));const D=i&&re({...i,modelsList:p??[]},!!u,!!(c!=null&&c.isEnterprise()));if(l.replace({query:C},void 0,{shallow:!0}),D==null){O.warning("No model available for this request"),T(!1);return}const ue=new ve;m(K,{content:q,attachments:[]},{eventSource:"url"},{conversationMode:M,source:"instant-query",systemHints:P?Array.from(L):void 0},ue,D==null?void 0:D.id),T(!1)},[o,f,H,h,l,i,u,c,m,A,r,k]),A}function Be(e){return se(e)}function se(e){return e==null?!1:/^\/g\/[\w-]+$/.test(e)}function $e(e){return e==null?!1:e==="/"||se(e)}const mr="GPT Builder";function gr(e){if(e)return`ChatGPT - ${e}`}function N(e){return e.gizmo.short_url??e.gizmo.id??"-"}function oe(e){return`/g/${e}`}function pr(e){return`https://chatgpt.com${oe(e)}`}function je(e){return oe(N(e))}function hr(e,r){const t=new URLSearchParams;return r!=null&&t.set(ne,r),qe(new URL(`${je(e)}?${t}`,"https://chatgpt.com"))}function Mr(e){return`/g/${N(e)}`}function _r(e){return Fe(e)&&e.gizmo.live_version===0||be(e)&&e.liveVersion===0}function zr(e,r){return y({queryKey:["gizmos","discovery",{locale:e,isAnon:r}],queryFn:async()=>a.getGizmoDiscovery(e,r)})}function Sr({cutId:e,locale:r,limit:t,cursor:n,enabled:s=!0}){return J({queryKey:["gizmos","discovery",{cutId:e,locale:r,limit:t}],queryFn:async({pageParam:o})=>a.getGizmoDiscoveryCut(e,{locale:r,cursor:o,limit:t}),initialPageParam:n,getNextPageParam:o=>o.list.cursor??void 0,enabled:s})}function Gr(){return y({queryKey:["gizmos","pinned"],queryFn:async()=>a.getGizmoPinned()})}function w(){return U({queryKey:["gizmos","bootstrap"],queryFn:async()=>a.getGizmoBootstrap().then(e=>({gizmos:e.gizmos.map(r=>({resource:r.resource,flair:r.flair}))}))})}function Pr(){return y(w())}function V(e,r){const t=e.filter(s=>s.resource.gizmo.id!==r.resource.gizmo.id);let n=t.findIndex(s=>s.flair.kind===F.Recent);return n===-1&&(n=t.length),t.splice(n,0,r),t}const Cr={handleGizmoInteracted(e,r){const t=e.getQueryData(z(e,r).queryKey);t!=null&&e.setQueryData(w().queryKey,n=>{if(n==null)return n;const s=n.gizmos.find(o=>o.resource.gizmo.id===r);return(s==null?void 0:s.flair.kind)===F.FirstParty||(s==null?void 0:s.flair.kind)===F.SidebarKeep?n:{gizmos:V(n.gizmos,{resource:t,flair:{kind:F.Recent}})}})},handleGizmoSidebarKeep(e,r){const t=e.getQueryData(z(e,r).queryKey);t!=null&&e.setQueryData(w().queryKey,n=>n==null?n:{gizmos:V(n.gizmos,{resource:t,flair:{kind:F.SidebarKeep}})})},handleGizmoSidebarHide(e,r){e.setQueryData(w().queryKey,t=>t!=null&&t.gizmos.some(n=>n.resource.gizmo.id===r)?{gizmos:t.gizmos.filter(n=>n.resource.gizmo.id!==r)}:t)}};function vr(e,r=!1){const t=S();return y(z(t,e,r))}function Er({gizmoId:e,draft:r,version:t}){const n=S(),s=t?{queryKey:["gizmo","version",{gizmoId:e,version:t}],queryFn:async()=>a.getVersion({gizmoId:e,version:t}),enabled:e!=null}:z(n,e,r);return y(s)}function qr(e,r){return y({queryKey:["gizmo","userActionSettings",{gizmoId:e}],queryFn:async()=>a.getUserActionSettings(e),enabled:e!=null&&r})}function z(e,r,t=!1){return U({queryKey:["gizmo",{gizmoId:r},{draft:t}],queryFn:async()=>a.getGizmo(r,t),enabled:r!=null,initialData:()=>{var o,i;if(t===!0)return;const n=e.getQueryData(w().queryKey);if(n!=null)return(o=n.gizmos.find(u=>u.resource.gizmo.id===r))==null?void 0:o.resource;const s=e.getQueryData(["gizmos","discovery"]);if(s!=null)for(const u of s.cuts){const f=(i=u.list.items.find(c=>c.resource.gizmo.id===r))==null?void 0:i.resource;if(f!=null)return f}}})}function Fr(e,r){return e.fetchQuery(z(e,r))}function br(e){return y({queryKey:["gizmo",{search:e}],queryFn:async()=>a.getGizmoSearch(e),enabled:e.length>0})}function wr(e,r){return y({queryKey:["gizmo-search-workspace",{search:e}],queryFn:async()=>a.getGizmoSearchForWorkspace(e),enabled:e.length>0&&r})}function Tr(e,r=!1,t=!1,n=null){return J({queryKey:[t?"gizmo-search-workspace":"gizmo",{query:e,cursor:n}],queryFn:async({pageParam:s})=>t?a.getGizmoSearchForWorkspace(e,n=s):a.getGizmoSearch(e,n=s),initialPageParam:n,getNextPageParam:s=>s.cursor??void 0,enabled:r})}function Lr(){const e=S();return v({mutationFn:async({gizmoId:r,editorData:t})=>{const{instructions:n,name:s,description:o,profilePictureId:i,profilePictureUrl:u,promptStarters:f,tools:c,files:l,trainingDisabled:g}=t;return a.upsertDraft({instructions:n,display:{name:s,description:o,profile_pic_id:i,profile_picture_url:u,prompt_starters:f},tools:c,files:l.map(m=>({...m,location:we.FILE_SERVICE})),training_disabled:g},r)},onSettled:r=>{r&&(e.setQueryData(z(e,r.gizmo.id,!0).queryKey,r),e.invalidateQueries({queryKey:["gizmos","mine"],refetchType:"none"}))}})}function Dr(){const e=S();return v({mutationFn:async({gizmoId:r,data:t})=>{const{sharingRecipient:n,categories:s}=t,o=await a.promoteDraft({sharing:t.sharingSubjects&&t.sharingSubjects.length>0?t.sharingSubjects:{recipient:n},categories:s},r);if(o.error)throw new Te(o);return o.resource},onSettled:r=>{e.invalidateQueries({queryKey:["gizmos"],refetchType:"all"}),e.invalidateQueries({queryKey:["gizmos","pinned"],refetchType:"none"}),r&&e.setQueryData(z(e,r.gizmo.id,!1).queryKey,r)}})}function Rr(){const e=S();return v({mutationFn:async({gizmoId:r})=>a.deleteGizmo(r),onSettled:()=>{e.invalidateQueries({queryKey:["gizmos"],refetchType:"all"})}})}function Qr(){const e=S();return v({mutationFn:async({name:r,hideName:t,websiteUrl:n,willReceiveSupportEmails:s})=>a.updateBuilderProfile({name:r,hide_name:t,website_url:n,will_receive_support_emails:s}),onSuccess:r=>{e.setQueryData(["builderProfile"],r)},onError:r=>{O.warning(r.message)}})}function Ur(){return y({queryKey:["builderProfile"],queryFn:async()=>a.getBuilderProfile()})}function Ar(){return v({mutationFn:async({gizmoId:e})=>a.copyGizmo({gizmoId:e})})}function Kr(){return y({queryKey:["gizmoCategories"],queryFn:async()=>a.getCategories()})}function Ir(e,r){return!!(r!=null&&[W.PrimaryAssistant,W.GizmoInteraction].includes(r)&&(e!=null&&e.includes(b.GPT_4)))}function Or(e,r){const t=S();return v({mutationFn:async({rating:n,message:s,includeFrom:o})=>{await a.upsertUserReview(e,n,s,o)},onSuccess:async()=>{t.invalidateQueries({queryKey:["gizmo","review",{gizmoId:e}]})},onError:n=>{O.danger(n.message)}})}function xr(e,r){return r?`/g/${N(r)}/c/${e}`:`/c/${e}`}function Nr(){return"/gpts"}function kr(){return"/gpts/mine"}function ie(e){return e?`/gpts/editor/${e}`:"/gpts/editor"}function Hr(e){const r=We();return e==null?r:ie(e)}function We(e){return ie(e)}function Br(e){try{const r=new URL(e);return r.hostname=r.hostname.replace(/^(www\.|web\.|mbasic\.|mobile\.)(secure\.)?/,""),r.pathname="",[...r.searchParams.keys()].forEach(t=>r.searchParams.delete(t)),r.toString()}catch{return e}}function Ye(e){if(!e)return null;try{return new URL(e).hostname}catch{return null}}function $r(e){const r=Ye(e);return r?r.replace(/^www\./,""):e}export{nr as $,Ar as A,te as B,kr as C,Nr as D,br as E,wr as F,rr as G,Tr as H,zr as I,Ur as J,Qr as K,Kr as L,Er as M,E as N,er as O,Lr as P,Dr as Q,z as R,ir as S,fr as T,Fr as U,cr as V,lr as W,Ne as X,Ir as Y,mr as Z,tr as _,ke as a,sr as a0,Re as a1,ar as a2,Je as a3,dr as a4,Oe as b,yr as c,vr as d,or as e,oe as f,xr as g,Or as h,Rr as i,Mr as j,_r as k,ie as l,je as m,We as n,$r as o,gr as p,Pr as q,Cr as r,Sr as s,Gr as t,ur as u,pr as v,hr as w,Br as x,qr as y,Hr as z};
//# sourceMappingURL=o3ih6na0xmna5yjk.js.map
