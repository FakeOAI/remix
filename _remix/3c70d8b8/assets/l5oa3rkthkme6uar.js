const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/el6g0878s97kkafv.js","assets/oti7vwmetx1fp70i.js","assets/m6filf2kvowipmd6.js","assets/ni7jve08i7uda1il.js","assets/jkt8kpmqx1ob1zea.js","assets/root-ij0a8l2a.css","assets/j41xn51jmw95fwqz.js","assets/conversation-small-ile61fj8.css","assets/odmcipi3ftfc0735.js","assets/fv2w91oo1dle89gx.js","assets/jf9ynkz99gydqdid.js","assets/oki6nqdhywmww2nr.js","assets/nhihqknp1726s684.js","assets/n1a38274iwykbf8e.js","assets/enifny5o6rvmja92.js","assets/izpgkl6t0zj5iap0.js","assets/lmsnt8lcr16za38r.js","assets/fzrn137102spawew.js","assets/nlzjqb5fys1yuhid.js","assets/ire8jlg5ci46112o.js","assets/bx2mxhwomlpwxasz.js","assets/onluya6a2xtuiad6.js","assets/g37t8j4pta46yvzf.js","assets/ihik4l9ciml0s2py.js","assets/koo0qd7hnqvnsxil.js","assets/lwnze92z4z92w13r.js","assets/ewm88y4oe638s12y.js","assets/gvskpv99j1f832a7.js","assets/izowwoplzy921wg5.js","assets/dhqvvrd40xhvxf7d.js","assets/nv4rb44sxcatospj.js","assets/lbm313x6vrj3xzs2.js","assets/kr5tlctggchkj9js.js","assets/mwd9u0qvt1rs1inz.js","assets/n6cjdkzbz0rakupl.js"])))=>i.map(i=>d[i]);
import{b4 as N,n as Z,r as E,L as Ve,gt as xt,m as p,aE as B,l as q,b as yt,e7 as He,aQ as se,gB as bt,c5 as Ge,c6 as Tt,c7 as Pt,c8 as Fe,aR as St,aJ as Ye}from"./jkt8kpmqx1ob1zea.js";import{j as _,E as le,Z as K,k as Ue,l as kt,H as Lt,G as I,i as Ce,C as Ee}from"./fv2w91oo1dle89gx.js";import{c as At,S as Ot,H as Mt,x as wt,t as c}from"./m6filf2kvowipmd6.js";import{_ as ze}from"./fzrn137102spawew.js";import{E as It,a6 as Q,a7 as H,a8 as A,a9 as ae,aa as Rt,ab as ie,ac as ve,ad as Dt,ae as Bt,af as jt,ag as Vt,a3 as j,ah as Ke,ai as Ht,aj as Xe,ak as Gt,al as $e,am as Ft,an as Yt}from"./ni7jve08i7uda1il.js";import{l0 as Ut,oG as zt,kC as ce,b0 as X,gd as w,bl as We,lZ as Kt,na as Xt,cA as $t,c_ as Ze,i3 as Y,oH as Wt,oI as _e,kA as Zt,kL as qt,oJ as Jt,oK as Qt,kN as eo,i as to,gf as oo}from"./j41xn51jmw95fwqz.js";import{T as no,q as qe,r as ro,v as so,w as ao,z as io,A as co,D as Ne,B as Je}from"./izpgkl6t0zj5iap0.js";import{m as D}from"./odmcipi3ftfc0735.js";import{c as Qe,R as lo,I as uo}from"./efbwuoats7p4ku9g.js";import{u as mo}from"./onluya6a2xtuiad6.js";import{i as fo}from"./lmsnt8lcr16za38r.js";const po="_modelCursor_1mtn0_1",zn={modelCursor:po};function k(e){return new At(Ot.define(e))}const xe=()=>N(()=>import("./pbl95wx6493wq92j.js"),[]).then(e=>k(e.shell)),et={[_.bash]:xe,[_.zsh]:xe,[_.swift]:()=>N(()=>import("./pijqfo56g5y7ss6b.js"),[]).then(e=>k(e.swift)),[_.css]:()=>N(()=>import("./el6g0878s97kkafv.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.css()),[_.html]:()=>N(()=>import("./g37t8j4pta46yvzf.js"),__vite__mapDeps([22,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,0,23])).then(e=>e.html()),[_.javascript]:()=>N(()=>import("./ihik4l9ciml0s2py.js"),__vite__mapDeps([23,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.javascript({jsx:!0,typescript:!1})),[_.typescript]:()=>N(()=>import("./ihik4l9ciml0s2py.js"),__vite__mapDeps([23,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.javascript({jsx:!0,typescript:!0})),[_.json]:()=>N(()=>import("./koo0qd7hnqvnsxil.js"),__vite__mapDeps([24,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.json()),[_.python]:()=>N(()=>import("./lwnze92z4z92w13r.js"),__vite__mapDeps([25,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.python()),[_.sql]:()=>N(()=>import("./ewm88y4oe638s12y.js"),__vite__mapDeps([26,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,1])).then(e=>e.sql()),[_.go]:()=>N(()=>import("./gvskpv99j1f832a7.js"),__vite__mapDeps([27,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.go()),[_.yaml]:()=>N(()=>import("./izowwoplzy921wg5.js"),__vite__mapDeps([28,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.yaml()),[_.java]:()=>N(()=>import("./dhqvvrd40xhvxf7d.js"),__vite__mapDeps([29,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.java()),[_.rust]:()=>N(()=>import("./nv4rb44sxcatospj.js"),__vite__mapDeps([30,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.rust()),[_.cpp]:()=>N(()=>import("./lbm313x6vrj3xzs2.js"),__vite__mapDeps([31,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.cpp()),[_.php]:()=>N(()=>import("./kr5tlctggchkj9js.js"),__vite__mapDeps([32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,0,23])).then(e=>e.php()),[_.xml]:()=>N(()=>import("./mwd9u0qvt1rs1inz.js"),__vite__mapDeps([33,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.xml()),[_.vue]:()=>N(()=>import("./n6cjdkzbz0rakupl.js"),__vite__mapDeps([34,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,1,0,23])).then(e=>e.vue()),[_.ruby]:()=>N(()=>import("./e4lhyu305wu0fcut.js"),[]).then(e=>k(e.ruby)),[_.haskell]:()=>N(()=>import("./bf6r3t2rw7f01so5.js"),[]).then(e=>k(e.haskell)),[_.kotlin]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>k(e.kotlin)),[_.csharp]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>k(e.csharp)),[_.c]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>k(e.c)),[_.objectivec]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>k(e.objectiveC)),[_.r]:()=>N(()=>import("./n0t2rpizlasjzcxa.js"),[]).then(e=>k(e.r)),[_.lua]:()=>N(()=>import("./harowmpdmpnd9wki.js"),[]).then(e=>k(e.lua)),[_.dart]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>k(e.dart)),[_.scala]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>k(e.scala)),[_.perl]:()=>N(()=>import("./gq1ss5v2zpbborxl.js"),[]).then(e=>k(e.perl)),[_.commonlisp]:()=>N(()=>import("./jr6cjysmysifr6mr.js"),[]).then(e=>k(e.commonLisp)),[_.clojure]:()=>N(()=>import("./gf1tfl9d2himhfic.js"),[]).then(e=>k(e.clojure)),[_.ocaml]:()=>N(()=>import("./khji33iw1sxityyt.js"),[]).then(e=>k(e.oCaml)),[_.powershell]:()=>N(()=>import("./i9u5kd7kvamutmln.js"),[]).then(e=>k(e.powerShell)),[_.verilog]:()=>N(()=>import("./fix340p09fldyqxz.js"),[]).then(e=>k(e.verilog)),[_.dockerfile]:()=>N(()=>import("./cgm5tyzi32u32j10.js"),[]).then(e=>k(e.dockerFile)),[_.other]:()=>null},go=e=>e in et,oe={},Kn=async e=>{if(oe[e]!=null)return oe[e];if(go(e)){const o=await et[e]();return oe[e]=o,o}return null},Xn=e=>oe[e]??null;var tt=e=>{var{theme:o,settings:t={},styles:n=[]}=e,r={".cm-gutters":{}},s={};t.background&&(s.backgroundColor=t.background),t.backgroundImage&&(s.backgroundImage=t.backgroundImage),t.foreground&&(s.color=t.foreground),t.fontSize&&(s.fontSize=t.fontSize),(t.background||t.foreground)&&(r["&"]=s),t.fontFamily&&(r["&.cm-editor .cm-scroller"]={fontFamily:t.fontFamily}),t.gutterBackground&&(r[".cm-gutters"].backgroundColor=t.gutterBackground),t.gutterForeground&&(r[".cm-gutters"].color=t.gutterForeground),t.gutterBorder&&(r[".cm-gutters"].borderRightColor=t.gutterBorder),t.caret&&(r[".cm-content"]={caretColor:t.caret},r[".cm-cursor, .cm-dropCursor"]={borderLeftColor:t.caret});var a={};t.gutterActiveForeground&&(a.color=t.gutterActiveForeground),t.lineHighlight&&(r[".cm-activeLine"]={backgroundColor:t.lineHighlight},a.backgroundColor=t.lineHighlight),r[".cm-activeLineGutter"]=a,t.selection&&(r["&.cm-focused .cm-selectionBackground, & .cm-line::selection, & .cm-selectionLayer .cm-selectionBackground, .cm-content ::selection"]={background:t.selection+" !important"}),t.selectionMatch&&(r["& .cm-selectionMatch"]={backgroundColor:t.selectionMatch});var i=It.theme(r,{dark:o==="dark"}),l=Mt.define(n),u=[i,wt(l)];return u},ho={background:"#ffffff",foreground:"#383a42",caret:"#000",selection:"#add6ff",selectionMatch:"#a8ac94",lineHighlight:"#f0f0f0",gutterBackground:"#fff",gutterForeground:"#237893",gutterActiveForeground:"#0b216f",fontFamily:'Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace'},Co=[{tag:[c.keyword,c.operatorKeyword,c.modifier,c.color,c.constant(c.name),c.standard(c.name),c.standard(c.tagName),c.special(c.brace),c.atom,c.bool,c.special(c.variableName)],color:"#0000ff"},{tag:[c.moduleKeyword,c.controlKeyword],color:"#af00db"},{tag:[c.name,c.deleted,c.character,c.macroName,c.propertyName,c.variableName,c.labelName,c.definition(c.name)],color:"#0070c1"},{tag:c.heading,fontWeight:"bold",color:"#0070c1"},{tag:[c.typeName,c.className,c.tagName,c.number,c.changed,c.annotation,c.self,c.namespace],color:"#267f99"},{tag:[c.function(c.variableName),c.function(c.propertyName)],color:"#795e26"},{tag:[c.number],color:"#098658"},{tag:[c.operator,c.punctuation,c.separator,c.url,c.escape,c.regexp],color:"#383a42"},{tag:[c.regexp],color:"#af00db"},{tag:[c.special(c.string),c.processingInstruction,c.string,c.inserted],color:"#a31515"},{tag:[c.angleBracket],color:"#383a42"},{tag:c.strong,fontWeight:"bold"},{tag:c.emphasis,fontStyle:"italic"},{tag:c.strikethrough,textDecoration:"line-through"},{tag:[c.meta,c.comment],color:"#008000"},{tag:c.link,color:"#4078f2",textDecoration:"underline"},{tag:c.invalid,color:"#e45649"}];function Eo(e){var{theme:o="dark",settings:t={},styles:n=[]}=e||{};return tt({theme:o,settings:ze({},ho,t),styles:[...Co,...n]})}Eo();var vo={background:"#1e1e1e",foreground:"#9cdcfe",caret:"#c6c6c6",selection:"#6199ff2f",selectionMatch:"#72a1ff59",lineHighlight:"#ffffff0f",gutterBackground:"#1e1e1e",gutterForeground:"#838383",gutterActiveForeground:"#fff",fontFamily:'Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace'},_o=[{tag:[c.keyword,c.operatorKeyword,c.modifier,c.color,c.constant(c.name),c.standard(c.name),c.standard(c.tagName),c.special(c.brace),c.atom,c.bool,c.special(c.variableName)],color:"#569cd6"},{tag:[c.controlKeyword,c.moduleKeyword],color:"#c586c0"},{tag:[c.name,c.deleted,c.character,c.macroName,c.propertyName,c.variableName,c.labelName,c.definition(c.name)],color:"#9cdcfe"},{tag:c.heading,fontWeight:"bold",color:"#9cdcfe"},{tag:[c.typeName,c.className,c.tagName,c.number,c.changed,c.annotation,c.self,c.namespace],color:"#4ec9b0"},{tag:[c.function(c.variableName),c.function(c.propertyName)],color:"#dcdcaa"},{tag:[c.number],color:"#b5cea8"},{tag:[c.operator,c.punctuation,c.separator,c.url,c.escape,c.regexp],color:"#d4d4d4"},{tag:[c.regexp],color:"#d16969"},{tag:[c.special(c.string),c.processingInstruction,c.string,c.inserted],color:"#ce9178"},{tag:[c.angleBracket],color:"#808080"},{tag:c.strong,fontWeight:"bold"},{tag:c.emphasis,fontStyle:"italic"},{tag:c.strikethrough,textDecoration:"line-through"},{tag:[c.meta,c.comment],color:"#6a9955"},{tag:c.link,color:"#6a9955",textDecoration:"underline"},{tag:c.invalid,color:"#ff0000"}];function No(e){var{theme:o="dark",settings:t={},styles:n=[]}=e||{};return tt({theme:o,settings:ze({},vo,t),styles:[..._o,...n]})}var $n=No(),V=(e=>(e[e.up=-1]="up",e[e.down=1]="down",e))(V||{}),ne=(e=>(e.COMMENT="comment",e.COMPOSER="composer",e))(ne||{}),L=(e=>(e.COLLAPSED="collapsed",e.EXPANDED="expanded",e))(L||{});const ot=([e,o],[t,n])=>{const r=e+o,s=t+n;return e<s&&t<r},de=([e,o])=>e+o,z=e=>{if(e.type===L.COLLAPSED)return[e.offsetY??0,0];const{offsetY:o,shiftY:t=0,height:n=0}=e,r=o+t;return t<0?[r,n+Math.abs(t)]:[r,n]},xo=(e,o,t)=>{if(!ot(e,o))return null;const[n,r]=e,s=n+r,[a,i]=o,l=a+i,u=a-s,f=l-n;return t===V.up?u:f};var nt=(e=>(e.ABOVE="above",e.BELOW="below",e))(nt||{});function W(e,o){return Z(e.coordsAtPos(o))}const ye=360,yo=250,rt=44,be=.5,Te=[.5,.9,1],bo=[1,.75,.2],To=({onClose:e,onSubmit:o,opensOverDocument:t=!1,opensFromGutter:n=!1,gutterHasComments:r=!1},s)=>{const a=Ve(),i=E.useRef(null),l=E.useRef(!1),[u,f]=E.useState(""),[d,m]=E.useState(!0),g=()=>{f(""),e?.(l.current)},h=(y=u)=>{l.current=!0,o?.(y),f("")},v=xt(({windowWidth:y})=>t?y<ye+100?yo:ye:le,0),C={};n&&(C.top=-12),t&&n?C.right=0:C.left=0;let x="";n&&!t?x="8px 50%":n&&t?x="calc(100% + 8px) 50%":t&&(x="center left");let P=0;n&&!t&&r&&(P=kt);const T=y=>{const{metaKey:R,shiftKey:S,key:O}=y;O==="Enter"&&u&&!(S||R)?(h(),y.preventDefault()):O==="Escape"&&(f(""),e?.(!1))},b=a.formatMessage({id:"VvfbvY",defaultMessage:"Edit or explain..."});return p.jsx(D.div,{ref:Ut(i,s),className:B("absolute flex items-center",K.commentComposer),style:{...C,minHeight:rt},transition:{type:"spring",bounce:.18,duration:.48},initial:{translateX:0},animate:{translateX:P},exit:{translateX:0},children:p.jsx(D.div,{className:B("no-scrollbar relative z-10 flex items-center overflow-x-hidden border border-token-border-light",Ue,{"rounded-full":d,"rounded-2xl":!d}),initial:{width:t?le:24,scaleX:t?be:void 0,scale:t?void 0:be},animate:{width:v,scaleX:t?Te:void 0,scale:t?void 0:Te},exit:{filter:"blur(16px)",scale:t?void 0:bo,width:t?le:24,opacity:t?0:[1,1,0]},transition:{type:"spring",bounce:t?.14:0,duration:.28,scale:{type:"tween",duration:.2},opacity:{type:"tween",time:[0,.95,1]}},style:{transformOrigin:x},children:p.jsxs(D.div,{className:"relative z-0 flex w-full items-center bg-token-main-surface-primary px-4 py-2.5",children:[p.jsx(D.div,{className:"backdrop-saturate-25 absolute inset-0 z-[-1] bg-gray-50/75 backdrop-blur-3xl dark:bg-gray-700/75",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.2}}),p.jsx(fo,{"aria-placeholder":b,value:u,className:"w-full resize-none border-0 bg-transparent px-1 py-0 pr-2 text-token-text-primary outline-0 placeholder:text-token-text-secondary focus:ring-0 focus-visible:ring-0",autoFocus:!0,maxRows:4,onBlur:g,onHeightChange:(y,{rowHeight:R})=>{m(Math.floor(y/R)<=1)},onChange:({target:{value:y}})=>f(y),onKeyDown:T}),!u&&p.jsx("span",{"aria-hidden":!0,className:"absolute inline-block text-nowrap pl-1 text-token-text-secondary",children:b}),p.jsx(D.button,{className:B("-mr-1.5 h-6 w-6 rounded-full bg-black text-center dark:bg-white",{"self-end":!d}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:()=>h(),children:p.jsx(zt,{className:"h-6 w-6 text-white dark:text-black"})})]})})})},st=E.forwardRef(To),Po=(e,o)=>{if(o?.type!==H.SELECTION)return null;try{const{from:t,to:n}=o,{top:r}=e.dom.getBoundingClientRect(),{bottom:s,top:a}=W(e,t),{bottom:i}=W(e,n),l=ae(e)?-30:-24;let u=s-r+l;const f=a-r;return u=i-r+8,{composerTop:u,loadingTop:f}}catch(t){return w.logError("Invalid position in SelectionCommentComposer",t),null}},So=({toolbarPosition:e,composerRect:o,view:t})=>{let{width:n,height:r}=o;if(r||=rt,t==null||e==null)return null;const{right:s,left:a}=t.dom.getBoundingClientRect(),{left:i,top:l,aboveOrBelow:u,toolbarSize:f}=e,d=l-(u===nt.ABOVE&&r!==0?r-f.height:0),m=Rt(t)?12:0;return{left:Math.min(i,s-a-n-m),composerTop:d,aboveOrBelow:u}},ko=({toolbarPosition:e,commentingOn:o,isWaitingForCommentResponse:t=!1,onAddComment:n})=>{const r=Q()(),[s,a]=ce(),i=So({view:r,toolbarPosition:e,composerRect:s});if(r==null||i==null)return null;const{left:l,composerTop:u}=i,f=d=>{if(o?.type!==H.SELECTION)return;const{action:m,sourceRange:g}=o;n?.(d,m,g,o.type)};return p.jsx(X,{children:o?.type===H.SELECTION&&!t&&p.jsx("div",{className:B("absolute",K.commentComposer),style:{left:l,top:u},children:p.jsx(st,{opensOverDocument:!0,onClose:d=>{d||(A.cancelCommentingOn(),r&&ae(r)&&!r.state.selection.empty&&r.dispatch(r.state.tr.setSelection(new no(r.state.selection.$from))),document.getSelection()?.removeAllRanges())},onSubmit:f,ref:a})},"composer")})};function at(e,o){return o?e.getState(o)??null:null}function Lo(e){return e.nodeSize-2}function Ao(e,o){return o>=0&&o<=Lo(e)}class G{constructor(o,t,n={}){this.match=o,this.match=o,this.handler=typeof t=="string"?Oo(t):t,this.undoable=n.undoable!==!1,this.inCode=n.inCode||!1}}function Oo(e){return function(o,t,n,r){let s=e;if(t[1]){let a=t[0].lastIndexOf(t[1]);s+=t[0].slice(a+t[1].length),n+=a;let i=n-r;i>0&&(s=t[0].slice(a-i,a)+s,n=r)}return o.tr.insertText(s,n,r)}}const Mo=500;function Wn({rules:e}){let o=new qe({state:{init(){return null},apply(t,n){let r=t.getMeta(this);return r||(t.selectionSet||t.docChanged?null:n)}},props:{handleTextInput(t,n,r,s){return Pe(t,n,r,s,e,o)},handleDOMEvents:{compositionend:t=>{setTimeout(()=>{let{$cursor:n}=t.state.selection;n&&Pe(t,n.pos,n.pos,"",e,o)})}}},isInputRules:!0});return o}function Pe(e,o,t,n,r,s){if(e.composing)return!1;let a=e.state,i=a.doc.resolve(o),l=i.parent.textBetween(Math.max(0,i.parentOffset-Mo),i.parentOffset,null,"￼")+n;for(let u=0;u<r.length;u++){let f=r[u];if(i.parent.type.spec.code){if(!f.inCode)continue}else if(f.inCode==="only")continue;let d=f.match.exec(l),m=d&&f.handler(a,d,o-(d[0].length-n.length),t);if(m)return f.undoable&&m.setMeta(s,{transform:m,from:o,to:t,text:n}),e.dispatch(m),!0}return!1}new G(/--$/,"—");new G(/\.\.\.$/,"…");new G(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"“");new G(/"$/,"”");new G(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"‘");new G(/'$/,"’");function Zn(e,o,t=null,n){return new G(e,(r,s,a,i)=>{let l=t instanceof Function?t(s):t,u=r.tr.delete(a,i),f=u.doc.resolve(a),d=f.blockRange(),m=d&&ro(d,o,l);if(!m)return null;u.wrap(d,m);let g=u.doc.resolve(a-1).nodeBefore;return g&&g.type==o&&so(u.doc,a-1)&&(!n||n(s,g))&&u.join(a-1),u})}function wo(e,o,t=null){return new G(e,(n,r,s,a)=>{let i=n.doc.resolve(s),l=t instanceof Function?t(r):t;return i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),o)?n.tr.delete(s,a).setBlockType(s,s,o,l):null})}function me(e,o,t,n={}){if(e==null)return null;const r=(Array.isArray(t)?t:[t]).filter(We),s=o.nodes[e].createAndFill(n,r);return s??null}const Io={content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM(){return["p",0]}},Ro="paragraph";class it extends ie{unistNodeName(){return Ro}static proseMirrorNodeName(){return"paragraph"}proseMirrorNodeSpec(){return Io}unistNodeToProseMirrorNodes({schema:o,convertedChildren:t,attrs:n}){return me(this.proseMirrorNodeName(),o,t,n)}proseMirrorNodeToUnistNodes(o,t){return[{type:this.unistNodeName(),children:t}]}}const Do=(e,o,t,n)=>e.value?o.text(e.value,[o.marks.startend.create(t),...n??[]]):null;class J extends ie{unistNodeName(){return"text"}static proseMirrorNodeName(){return"text"}proseMirrorNodeSpec(){return{group:"inline"}}unistNodeToProseMirrorNodes({node:o,schema:t,attrs:n}){return Do(o,t,n)}proseMirrorNodeToUnistNodes(o){return[{type:this.unistNodeName(),value:o.text??""}]}}class U extends ie{static isAtStart(o,t){return o.selection.empty?t!==void 0?t.endOfTextblock("backward",o):o.selection.$anchor.parentOffset>0:!1}static headingLevelCommandBuilder(o,t,n){return(r,s,a)=>{if(n&&!U.isAtStart(r,a))return!1;const{$anchor:i}=r.selection,l=i.parent;if(l.type.name!=="heading")return!1;const u=l.attrs.level+t;if(u<0||u>6)return!1;if(s===void 0)return!0;const f=i.before(i.depth);return u>0?s(r.tr.setNodeMarkup(f,void 0,{level:u})):s(r.tr.setNodeMarkup(f,o.nodes.paragraph)),!0}}dependencies(){return[new it,new J]}unistNodeName(){return"heading"}static proseMirrorNodeName(){return"heading"}proseMirrorNodeSpec(){return{attrs:{level:{default:1}},content:"text*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM(o){return["h"+o.attrs.level.toString(),0]}}}proseMirrorInputRules(o){return[wo(/^\s{0,3}(#{1,6})\s$/,o.nodes[this.proseMirrorNodeName()],t=>({level:t[1].length}))]}proseMirrorKeymap(o){const t={Tab:U.headingLevelCommandBuilder(o,1,!1),"#":U.headingLevelCommandBuilder(o,1,!0),"Shift-Tab":U.headingLevelCommandBuilder(o,-1,!1)};for(let n=1;n<=6;n++)t[`Shift-Mod-${n.toString()}`]=ao(o.nodes[this.proseMirrorNodeName()],{level:n});return t}unistNodeToProseMirrorNodes({node:o,schema:t,convertedChildren:n,attrs:r}){const{depth:s}=o;return me(this.proseMirrorNodeName(),t,n,{...r,level:s})}proseMirrorNodeToUnistNodes(o,t){return[{type:this.unistNodeName(),depth:o.attrs.level,children:t}]}}const Se=(e,o,t)=>{const n=t==="min"?0:o.length-1;for(let r=n;t==="min"?r<o.length:r>=0;t==="min"?r++:r--){const{sourcePos:s,pmPos:a}=o[r];if(s===e)return a;if(t==="min"&&s>e||t==="max"&&s<e)return t==="min"?o[r-1]?.pmPos??a:a}return null};class Bo extends ie{unistNodeName(){return"root"}static proseMirrorNodeName(){return"doc"}proseMirrorNodeSpec(){return{content:"block+"}}unistNodeToProseMirrorNodes({schema:o,convertedChildren:t,attrs:n}){return me(this.proseMirrorNodeName(),o,t,n)}proseMirrorNodeToUnistNodes(o,t){return[{type:this.unistNodeName(),children:t}]}}const ke=(e,o)=>{if(!o)return!1;const[t,n]=o;return e>=t&&e<n},ct=(e,o)=>e.pmPos-o.pmPos,Le=(e,o)=>{const t=o[o.length-1].sourcePos;return Math.min(Math.max(e,0),t)},Ae=(e,o)=>{const t=q(o)?.sourcePos??0;return Math.min(Math.max(e,0),t)},Oe=({positions:e,sourcePos:o,sourceEndPos:t})=>{const n=[];for(let r=0;r<e.length;r++){const s=e[r],{sourcePos:a,leafSourceRange:i,isClose:l=!1}=s;if(t!=null&&a>t)break;const u=e[r+1]??null,f=d=>{let m=e[d];if(m==null)return d;let g=e[d+1],{leafSourceRange:h}=m;for(;m.nodeTypeName!==J.proseMirrorNodeName()&&!m.isClose&&g!=null&&!ke(o,h);)n.push(g),m=g,g=e[d+2],h=m.leafSourceRange,d++;return d};if(a===o&&!l||ke(o,i))n.push(s),r=f(r);else if(a<=o&&(u?.sourcePos??Number.POSITIVE_INFINITY)>=o){let d=r+1;const m=[];for(;e[d]?.isClose===!0;)m.push(d),d++;if(e[d]){const{sourcePos:g}=e[d];do n.push(e[d]);while(e[++d].sourcePos===g);d=f(d-1)}else{(a===o||l)&&n.push(s);for(const g of m)n.push(e[g])}r=d}}return n.sort(ct)},Me=({positions:e,sourcePos:o})=>{const t=[],n=r=>{r&&t.push(r)};for(let r=0;r<e.length;r++){const s=e[r],{sourcePos:a}=s;if(o==null||a>o)break;const i=e[r-1]??null,l=e[r+1]??null,u=o>a&&o<(l?.sourcePos??-1),f=s.nodeTypeName===J.proseMirrorNodeName();if(a===o||u&&!f){if(s.isClose&&!i?.isClose&&s.nodeTypeName===i?.nodeTypeName||!s.isClose&&l.isClose&&s.nodeTypeName===l.nodeTypeName||s.isClose&&i?.isClose||!s.isClose&&i!=null&&i?.nodeTypeName!==J.proseMirrorNodeName()){n(i);let h=r-2,v=e[h];for(;h>=0&&v.isClose;)n(v),v=e[--h]}let d=r,m=s,g=m;do n(m),g=m,m=e[++d];while(m?.sourcePos===o||m?.depth<g?.depth);break}else if(u&&f){let d=r+1,m=e[d];for(;m?.isClose;)n(m),m=e[++d];break}}return t.sort(ct)},jo=e=>{const o=new Xt($t.GetPositionTransformer,{debug:!1});o.startBlock("get_positition_transformer");const t=new Map;e.descendants((s,a)=>{const i=ve(s);if(!i)return;const{start:l,end:u}=i,f=s.type.name,{depth:d}=e.resolve(a);if(t.set(a,{pmPos:a,sourcePos:l,leafSourceRange:s.isBlock?void 0:[l,u],depth:d,nodeTypeName:f,isClose:!1,parentNodeTypeNameStack:[]}),s.isBlock){const m=a+s.nodeSize-1;t.set(m,{pmPos:m,sourcePos:u,depth:e.resolve(m).depth,nodeTypeName:f,isClose:!0,parentNodeTypeNameStack:[]})}if(s.isText)for(let m=0;m<(s.text?.length??0);m++){const g=a+m;t.set(g,{pmPos:g,sourcePos:l+m,depth:d,nodeTypeName:f,isClose:!1,parentNodeTypeNameStack:[]})}}),t.set(e.content.size,{pmPos:e.content.size,nodeTypeName:e.type.name,depth:0,isClose:!0,sourcePos:Z(ve(e)).end,parentNodeTypeNameStack:[]});const n=Array.from(t.entries()).sort(([s],[a])=>s-a).map(([,s])=>s),r=[Bo.proseMirrorNodeName()];for(const s of n)s.isClose?(s.parentNodeTypeNameStack=r.concat(),r.pop()):(s.parentNodeTypeNameStack=r.concat(),s.nodeTypeName!==J.proseMirrorNodeName()&&q(r)!==s.nodeTypeName&&r.push(s.nodeTypeName));return o.endBlock("get_positition_transformer"),{positions:n,pmRangeToSourceRange:({start:s,end:a})=>({start:n[Math.max(s,0)].sourcePos,end:n[Math.min(a,n.length-1)].sourcePos}),sourceStartToPmPos:s=>Oe({sourcePos:Le(s,n),positions:n,sourceEndPos:null}),sourceEndToPmPos:s=>Me({sourcePos:Ae(s,n),positions:n}),sourceRangeToPmRange:s=>{o.startBlock("source_range_to_pm_range");const{start:a,end:i}=s,l=Ae(i,n),u=Oe({sourcePos:Le(a,n),sourceEndPos:l,positions:n}),f=Me({sourcePos:l,positions:n});return o.endBlock("source_range_to_pm_range"),{start:u,end:f}}}},Vo=Kt(jo);function Ho(e,o){const t=Yo(e);if(t.length===0)return o;let n=o;return t.forEach(r=>{n=Go(r,n)}),n}function Go(e,o){return Dt(o,{start:e.from,end:e.to},Fo(e))}function Fo(e){return e.slice.size-(e.to-e.from)}function Yo(e){return e.steps.filter(o=>o instanceof io)}const re=new co("comments");function we(e,o){const{sourceRangeToPmRange:t}=Vo(e),n=o.map(({id:r,at:s})=>{const{start:a,end:i}=t(s),l=Se(s.start,a,"max"),u=Se(s.end,i,"min");return u==null||l==null?null:[r,{start:l,end:u}]}).filter(We);return new Map(n)}function Uo(e,o){const{type:t}=o;if(t===H.SELECTION){const{from:s,to:a}=o;return[s,a]}const{pos:n}=o,r=n+(e.nodeAt(n)?.nodeSize??0);return[n,r]}const Ie=(e,o,t=null,n=null)=>{const r=[],s=Array.from(o.entries()).reverse(),a=new Map(e.map(i=>[i.id,i]));for(const[i,l]of s){const u=a.get(i),m=jt({isHovered:t===i,isFocused:n===i,isCode:!1,diffStatus:u?.diffStatus});r.push(Je.inline(l.start,l.end,{class:m,"data-comment-id":i,nodeName:"span"}))}return r},qn=e=>new qe({key:re,state:{init:(o,{doc:t})=>{const n=we(t,e);return{comments:e,commentingOn:null,hoveredOnBlock:null,hoveredCommentId:null,focusedCommentId:null,decorations:Ie(e,n),positions:n}},apply:(o,t)=>{const n=o.getMeta(re)??{},r=n.comments,s=r??t.comments,a=r!=null?we(o.doc,s):t.positions;let i=n.commentingOn;i===void 0&&(i=t.commentingOn);let l=n.hoveredCommentId;l===void 0&&(l=t.hoveredCommentId);let u=n.focusedCommentId;u===void 0&&(u=t.focusedCommentId);const f=Ho(o,a),d=Bt(s,f);return{comments:d,commentingOn:i,hoveredCommentId:l,focusedCommentId:u,decorations:Ie(d,f,l,u),positions:f}}},props:{handleClickOn:(o,t,n,r,s)=>{const{target:a}=s;if(a instanceof HTMLElement){const{commentId:i}=a.dataset;if(!i)return;A.focusComment(i)}},handleDOMEvents:{mouseover(o,t){const{target:n}=t;if(n instanceof HTMLElement){const{commentId:r}=n.dataset;r?A.mouseEnterComment(r):A.mouseLeaveComment()}}},decorations(o){const t=this.getState(o);if(!t)return Ne.empty;const{commentingOn:n,decorations:r}=t,{doc:s}=o;if(n){const[a,i]=Uo(s,n);a!=null&&i!=null&&r.push(Je.inline(a,i,{class:Lt.document},{comment:{pattern:n}}))}return Ne.create(s,r.concat())}}});function zo(e,o,t){const n=e+o;for(const r of t.values()){const s=r.start,a=r.end;if(e<a&&s<n)return!0}return!1}const Ko=50,Xo=200,$o=[it.proseMirrorNodeName(),U.proseMirrorNodeName()],Wo=e=>e?e.isBlock:!1,Zo=e=>{if(!e)return!1;const{isBlock:o,type:{name:t}}=e;return o&&$o.includes(t)},qo=(e,o,t,n)=>{const r=e.posAtCoords({left:o,top:t});if(r==null)return;const{pos:s,inside:a}=r;if(a===-1)return;const{state:i}=e;let l=s,u=i.doc.nodeAt(l);for(;!Wo(u)&&l>=0;)l--,u=i.doc.nodeAt(l);if(!u||!Zo(u))return;const f=n!=null&&zo(l,u.nodeSize,n);return{node:u,nodeHasComment:f,pos:l}};function Jo(e,o,t){const n=qo(e,o.x,o.y,t);if(n==null)return null;const{node:r,pos:s,nodeHasComment:a}=n,{top:i}=e.coordsAtPos(0);function l(){const g=s+1;return Ao(e.state.doc,g)&&e.state.doc.nodeAt(g)?.isText?e.coordsAtPos(g).top:e.coordsAtPos(s).top}const u=l(),f=u-i;return{height:e.coordsAtPos(s+r.nodeSize-1).bottom-u,nodeHasComment:a,mouseEnteredAt:Date.now(),yOffset:f,pos:s}}function Qo(e){const o=E.useRef(!1),t=E.useRef(!1),[n,r]=E.useState(null),s=Vt(),a=s()?.dom,i=E.useRef(!1),l=j(({visibleBlockCommentLauncher_DEBUG_ONLY:d})=>d),u=E.useCallback(Ze(d=>{o.current=!0;const{commentingOn:m}=j.getState();if(t.current||m!=null)return;const g=s();if(g==null||!o.current)return r(null);const{dom:h,state:v}=g,C=at(re,v)?.positions;if(C==null)return r(null);const x=Jo(g,d,C);if(x==null||x.nodeHasComment&&e===I.COLLAPSED){r(null);return}if(i.current&&x.yOffset!==n?.yOffset){r(null);return}const P=g.coordsAtPos(0),T=h.getBoundingClientRect().width,y=(d.x-P.left)/T>=Ko/100;r(y?x:null)},Xo),[s,i,n]);E.useEffect(()=>{if(a!=null)return yt(a,{mouseenter:()=>{o.current=!0,t.current=!1},mouseleave:({relatedTarget:d})=>{if(u.cancel(),d instanceof HTMLElement&&d.closest("[data-block-comment-launcher]")){t.current=!0;return}t.current=!1,o.current=!1,j.getState().commentingOn==null&&r(null)},mousemove:u})},[s,a,e,u]);const f=E.useCallback(({relatedTarget:d})=>{const{commentingOn:m}=j.getState();m==null&&d!==a&&(t.current=!1,r(null))},[a]);return{visibleBlockComment:l??n,handleMouseLeave:f,onComposerVisibleChange:d=>{i.current=d}}}const en=({isWaitingForCommentResponse:e=!1,opensOverDocument:o=!1,hasComments:t=!1,activeBlockComment:n,composerRef:r,onLaunchComposer:s,onMouseLeave:a,onSubmit:i})=>{const[l,u]=E.useState(!1),{yOffset:f,height:d,pos:m}=n,g=()=>{u(!0),s?.(),w.logButtonClick(Y.BLOCK_COMMENT_LAUNCHER),A.startCommentingOn({type:H.BLOCK,pos:m})},h=x=>{x||(u(!1),A.cancelCommentingOn())},v=x=>{u(!1),i?.(x)};E.useEffect(()=>()=>{A.mouseLeaveBlock()},[]);const C=t&&l?o?-88:88:0;return p.jsx(D.div,{className:B("pointer-events-auto absolute flex h-6 w-5 origin-[14px_50%] items-start after:absolute after:-inset-4 after:content-['']",K.commentComposer),initial:!1,animate:{opacity:1},exit:{opacity:0},transition:{type:"spring",duration:.2,bounce:.1},style:{top:0,height:d,translateY:f},onMouseLeave:a,"data-block-comment-launcher":!0,children:p.jsxs(X,{children:[l?p.jsx(st,{ref:r,opensFromGutter:!0,onClose:h,onSubmit:v,gutterHasComments:t,opensOverDocument:o},"composer"):null,p.jsx(D.button,{initial:{opacity:0},animate:{opacity:l?0:1,translateX:C},transition:{duration:.15,translateX:{type:"spring",bounce:.18,duration:.48}},className:"group absolute z-10 flex h-6 gap-1 bg-transparent after:absolute after:-inset-y-4 after:-left-1 after:-right-4 after:content-['']",onClick:g,onMouseEnter:()=>A.mouseEnterBlock(m),onMouseLeave:()=>A.mouseLeaveBlock(),disabled:l||e,children:p.jsx(Ht,{isLoading:e})},"launcer")]})})},tn=({isWaitingForCommentResponse:e=!1,isRequestActive:o=!1,hasComments:t=!1,composerRef:n,gutterMode:r,onAddComment:s})=>{const a=Ke(),{visibleBlockComment:i,handleMouseLeave:l,onComposerVisibleChange:u}=Qo(r),f=d=>{if(!i||!a)return;const{doc:m}=a,{pos:g}=i,h=m.nodeAt(g);if(!h)return;const{attrs:{start:v,end:C}}=h;s?.(d,Xe.ASK,{start:v,end:C},H.BLOCK)};return p.jsx(X,{onExitComplete:()=>u(!1),children:i&&a&&(e||!o)&&p.jsx(en,{composerRef:n,isWaitingForCommentResponse:e,opensOverDocument:r===I.COLLAPSED,activeBlockComment:i,hasComments:t,onSubmit:f,onMouseLeave:l,onLaunchComposer:()=>u(!0)},"launcher")})},on=({onAcceptComment:e,onDismissComment:o,disableActions:t=!1,entry:n,isGutterCollapsed:r=!1,isHovered:s=!1,isFocused:a=!1,isSomeCommentFocused:i=!1})=>{const{offsetY:l,type:u}=n,[f,d]=Wt();let m=null;if(u===L.COLLAPSED)m=!a&&p.jsx(Gt,{offsetY:l,count:n.count,onClick:()=>{w.logButtonClick(Y.COLLAPSED_COMMENT),A.focusComment(n.children[0])}},"collapsed");else{const{comment:g}=n;if(g==null||g.content===""||g.status===_e.DISMISSED)m=null;else if(g.status===_e.ACCEPT_INITIATED)m=p.jsx("div",{className:"absolute",style:{top:l},children:p.jsx($e,{})},"loading");else{const{id:h}=g;m=p.jsx(Ft,{isSomeCommentFocused:i,isHovered:s,isFocused:a,offsetY:l,disableActions:t,onClick:()=>{w.logButtonClick(Y.EXPANDED_COMMENT),A.focusComment(h)},onMouseEnter:()=>A.mouseEnterComment(h),onMouseLeave:()=>A.mouseLeaveComment(),comment:g,onAccept:()=>{w.logButtonClick(Y.COMMENT_ACCEPT,{commentId:h}),e?.(h)},onDismiss:()=>{w.logButtonClick(Y.COMMENT_DISMISS,{commentId:h}),o?.(h)},opensOverDocument:r},"expanded")}}return p.jsx(X,{onExitComplete:()=>d?.(),children:f&&m})},Re=({onMeasureHeight:e,comment:o,isFocused:t=!1})=>{const[{height:n},r]=ce();return He(()=>{e?.(n)},[n]),p.jsx(Yt,{ref:r,comment:o,isFocused:t,disableAnimations:!0})},nn=({comments:e,onMeasure:o,getStableCommentId:t})=>{const n=E.useRef(new Map),r=E.useRef(new Map),s=E.useRef(null),a=(i,l,u=!1)=>{l&&(u?r.current.set(t(i),l):n.current.set(t(i),l),s.current&&cancelAnimationFrame(s.current),s.current=requestAnimationFrame(()=>{o?.({focusedHeights:new Map(r.current),heights:new Map(n.current)}),s.current=null}))};return e?.length?p.jsxs("div",{className:"pointer-events-none invisible fixed left-0 top-0 overflow-clip","aria-hidden":"true",children:[e.map(i=>p.jsx(Re,{comment:i,onMeasureHeight:l=>a(i.id,l)},t(i.id))),e.map(i=>p.jsx(Re,{isFocused:!0,comment:i,onMeasureHeight:l=>a(i.id,l,!0)},`${t(i.id)}-focused`))]}):null},De=(e,o,t)=>{let n=t+o;for(;o===V.down?n<e.length:n>-1;){const r=e[n],s=e[n-o],a=xo(z(r),z(s),o);if(a!=null&&r.type!==L.COLLAPSED)r.shiftY+=a;else break;n+=o}},Be=(e,o)=>{for(const t of o){const{index:n,amount:r}=t,s=e[n];s.type===L.EXPANDED&&(s.shiftY+=r),De(e,V.down,n),De(e,V.up,n);for(const a of e)a.type!==L.COLLAPSED&&(a.offsetY+=a.shiftY,a.shiftY=0)}},rn=(e,o)=>{const t=[],[n,r]=o,s=n+r;for(let a=0;a<e.length;a++){const i=e[a],[l]=z(i),u=[l,i.type===L.EXPANDED?i.height:0],[f,d]=u;if(ot(u,o)){const m=f+d,g=n-m,h=s-f,C=(Math.abs(g)<Math.abs(h)?V.up:V.down)===V.up?g:h;t.push({index:a,amount:C})}}return t},sn=({gutterMode:e,focusedCommentId:o,gutterPositions:t,getCommentKey:n,getComment:r})=>{if(!t?.size)return[];const s=new Map,a=[];let i=null,l=-1;for(const f of t.values()){if(f.type===ne.COMPOSER){i=[f.offsetY,f.height];continue}const{commentId:d,height:m,collapsedOffsetY:g,offsetY:h}=f;if(e===I.EXPANDED){const x=q(a),P=x?de(z(x)):0;let T=h;x&&T<=P&&(T=P),s.set(d,{originalOffsetY:h,offsetY:T}),o===d&&(l=a.length),a.push({key:n(d),comment:r(d),type:L.EXPANDED,height:m,offsetY:T,shiftY:0});continue}let v=a.findIndex(({offsetY:x,type:P})=>P===L.COLLAPSED&&x===g),C=a[v]??null;if(!C)C={key:a.length,type:L.COLLAPSED,offsetY:h,count:1,children:[d]},v=a.length,a.push(C);else{if(C.type!==L.COLLAPSED)throw new Error("Collapsed parent type expected to be collapsed");C.count+=1,C.children.push(d),C.offsetY=g}o===d&&(l=v)}const u=a[l];if(e===I.COLLAPSED&&u?.type===L.COLLAPSED){const f=[];for(let d=0;d<u.children.length;d++){const m=u.children[d];m===o&&(l+=d+1);const g=q(f),h=g?de(z(g)):0,v=t.get(m)?.offsetY??0,C=Math.max(h,v);s.set(m,{originalOffsetY:v,offsetY:C}),f.push({type:L.EXPANDED,key:n(m),comment:r(m),offsetY:C,height:t.get(m)?.height??0,shiftY:0})}a.splice(l,0,...f)}if(o){const f=s.get(o);if(!f)return a;const{offsetY:d,originalOffsetY:m}=f,g=m-d,h=[{amount:g,index:l}];let v=l+1;for(;v<a.length;){const C=a[v],{type:x}=C;let P=g;if(x===L.EXPANDED&&C.comment?.id){const{offsetY:T,originalOffsetY:b}=Z(s.get(C.comment.id));if(T===b)break;P=Math.max(b-T,g)}else break;h.push({amount:P,index:v}),v++}h.length&&Be(a,h)}else if(e!==I.COLLAPSED&&i){const f=rn(a,i);Be(a,f)}return a},an=e=>{try{return sn(e)}catch(o){return w.logError("Generating comment gutter entries",o),[]}},cn=e=>"length"in e?e.length===0:e.nodeSize===0,ue=12,ln=({composerHeight:e,getCommentHeight:o,getCollapsedStartPos:t,commentingOn:n,commentPositions:r,view:s})=>{if(!r||!s||cn(s.state.doc))return null;const{top:a}=s.dom.getBoundingClientRect(),i=Array.from(r.entries()).sort(([u,f],[d,m])=>f.start-m.start),l=new Map;for(const[u,{start:f}]of i)try{const d=t?.(f)??f,{top:m}=W(s,d),{top:g}=W(s,f),h=g-a,v=m-a,C=(o(u)??0)+ue;l.set(u,{commentId:u,height:C,collapsedOffsetY:v,offsetY:h,type:ne.COMMENT})}catch{continue}if(n?.type===H.BLOCK){const{pos:u}=n;try{const{top:f}=W(s,u),m=f-a-ue;l.set("block-composer",{type:ne.COMPOSER,height:(e??0)+ue,offsetY:m})}catch{}}return l},lt=(e,o)=>o.nodeAt(e)?.isBlock?e+1:lt(e-1,o);function un(e){const o=Ke(),n=Q()?.();if(!n)return null;if(ae(n)){if(!o)return null;const r=at(re,o);return r?r.positions:null}return new Map(e.map(r=>[r.id,r.at]))}const dn=({gutterMode:e,focusedCommentId:o,commentingOn:t,comments:n,getStableId:r})=>{const[{height:s},a]=ce(),i=Q(),[l,u]=E.useState(()=>new Map),[f,d]=E.useState(()=>new Map),m=E.useCallback(({focusedHeights:b,heights:y})=>{u(b),d(y)},[]),g=b=>{const y=r(b);return b===o?l.get(y)??0:f.get(y)??0},h=i(),v=h!=null&&ae(h)?b=>lt(b,h.state.doc):void 0,C=new Map(n?.map(b=>[r(b.id),b])),x=un(n),P=ln({composerHeight:s,commentingOn:t,getCommentHeight:g,getCollapsedStartPos:v,commentPositions:x,view:h}),T=an({gutterMode:e,gutterPositions:P,focusedCommentId:o,getComment:b=>C.get(r(b))??null,getCommentKey:r});return{blockComposerRef:a,onMeasureComments:m,gutterEntries:T}};function mn(){const o=Q()(),t=j(({commentingOn:s})=>s),r=o==null?null:Po(o,t);return r==null?null:p.jsx(D.div,{className:"absolute",style:{top:r.loadingTop},initial:!1,animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},transition:{delay:.2},children:p.jsx($e,{})},"selection-loading")}const fn=e=>p.jsx("div",{className:"absolute",style:{top:de(z(e))},children:p.jsx("div",{className:"h-[max(3rem,18vh)] w-1"})}),Jn=({availableWidth:e,comments:o,commentsMode:t,disableBlockComments:n=!1,isRequestActive:r=!1,isWaitingForCommentResponse:s=!1,onAddComment:a,onAcceptComment:i,onDismissComment:l,getStableCommentId:u})=>{const f=j(({focusedCommentId:M})=>M),d=j(({hoveredCommentId:M})=>M),m=j(({commentingOn:M})=>M),g=Zt(),h=e<Ce?I.COLLAPSED:I.EXPANDED,{onMeasureComments:v,blockComposerRef:C,gutterEntries:x}=dn({comments:o,getStableId:u,gutterMode:h,focusedCommentId:f,commentingOn:m}),P=x.length>0,T=m!=null&&!s&&m.type!=="selection"||P,y=(()=>{if(!T)return 0;switch(h){case I.COLLAPSED:return 0;case I.EXPANDED:return Ce}})(),R=m?.type==="selection",S=q(x),O=t===Ee.ENABLED&&g&&!R&&!n;return p.jsxs(D.div,{className:B("pointer-events-none relative flex h-full flex-shrink-0",K.commentGutter,h===I.COLLAPSED&&y?"basis-[32px]":"basis-0"),initial:{width:0,opacity:0},animate:{width:y,opacity:1},exit:{width:0,opacity:0},children:[p.jsx(nn,{getStableCommentId:u,comments:o,onMeasure:v}),p.jsxs("div",{className:B("pointer-events-auto absolute bottom-0 left-0 top-0 w-0 overflow-visible",{"pl-2":T||!n}),children:[p.jsx(X,{children:x.map(M=>{const{key:vt,type:he}=M,_t=!!f&&he===L.EXPANDED&&M.comment?.id===f,Nt=!!f&&M.type===L.COLLAPSED&&M.children.includes(f);return p.jsx(on,{isGutterCollapsed:h===I.COLLAPSED,isSomeCommentFocused:!!m||!!f,isHovered:he===L.EXPANDED&&M.comment?.id===d,isFocused:_t||Nt,entry:M,disableActions:r||s||t===Ee.COMMENTS_READONLY,onAcceptComment:$=>{try{i?.(Z(o?.find(F=>F.id===$)))}catch(F){w.logError(`Comment ${$} not found`,F)}},onDismissComment:$=>{try{l?.(Z(o?.find(F=>F.id===$)))}catch(F){w.logError(`Comment ${$} not found`,F)}}},vt)})}),P&&S&&p.jsx(fn,{...S}),O&&p.jsx(tn,{composerRef:C,gutterMode:h,onAddComment:a,isWaitingForCommentResponse:s,isRequestActive:r,hasComments:P}),s&&R&&p.jsx(mn,{})]})]})};var pn="Separator",je="horizontal",gn=["horizontal","vertical"],ut=E.forwardRef((e,o)=>{const{decorative:t,orientation:n=je,...r}=e,s=hn(n)?n:je,i=t?{role:"none"}:{"aria-orientation":s==="vertical"?s:void 0,role:"separator"};return p.jsx(se.div,{"data-orientation":s,...i,...r,ref:o})});ut.displayName=pn;function hn(e){return gn.includes(e)}var Cn=ut,fe="Toolbar",[En,Qn]=bt(fe,[Ge,Qe]),pe=Ge(),dt=Qe(),[vn,mt]=En(fe),ft=E.forwardRef((e,o)=>{const{__scopeToolbar:t,orientation:n="horizontal",dir:r,loop:s=!0,...a}=e,i=pe(t),l=Tt(r);return p.jsx(vn,{scope:t,orientation:n,dir:l,children:p.jsx(Pt,{asChild:!0,...i,orientation:n,dir:l,loop:s,children:p.jsx(se.div,{role:"toolbar","aria-orientation":n,dir:l,...a,ref:o})})})});ft.displayName=fe;var pt="ToolbarSeparator",gt=E.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=mt(pt,t);return p.jsx(Cn,{orientation:r.orientation==="horizontal"?"vertical":"horizontal",...n,ref:o})});gt.displayName=pt;var _n="ToolbarButton",ge=E.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=pe(t);return p.jsx(Fe,{asChild:!0,...r,focusable:!e.disabled,children:p.jsx(se.button,{type:"button",...n,ref:o})})});ge.displayName=_n;var Nn="ToolbarLink",xn=E.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=pe(t);return p.jsx(Fe,{asChild:!0,...r,focusable:!0,children:p.jsx(se.a,{...n,ref:o,onKeyDown:St(e.onKeyDown,s=>{s.key===" "&&s.currentTarget.click()})})})});xn.displayName=Nn;var ht="ToolbarToggleGroup",yn=E.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=mt(ht,t),s=dt(t);return p.jsx(lo,{"data-orientation":r.orientation,dir:r.dir,...s,...n,ref:o,rovingFocus:!1})});yn.displayName=ht;var bn="ToolbarToggleItem",Tn=E.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=dt(t),s={__scopeToolbar:e.__scopeToolbar};return p.jsx(ge,{asChild:!0,...s,children:p.jsx(uo,{...r,...n,ref:o})})});Tn.displayName=bn;var Pn=ft,Sn=gt,kn=(e=>(e.CODE="code",e.WRITING="writing",e))(kn||{});const ee=({children:e,toolbarType:o})=>p.jsx(Pn,{className:B("m-0 flex h-10 w-fit min-w-0 flex-shrink items-center overflow-hidden rounded-xl border border-token-border-light bg-token-main-surface-primary",Ue,o==="code"?"p-0":"p-1"),children:e}),Ct=({icon:e,hideLabel:o,label:t})=>p.jsxs(p.Fragment,{children:[p.jsx(e,{className:B("icon-sm",{"mr-0.5 text-token-text-tertiary":!o,"text-token-text-primary":o})}),!o&&p.jsx("span",{className:"truncate text-sm text-token-text-primary",children:t})]}),Et=Ye(ge)`flex h-full items-center gap-1 rounded-lg px-2.5 hover:bg-[#f5f5f5] disabled:opacity-50 disabled:cursor-not-allowed dark:hover:bg-token-main-surface-secondary disabled:hover:bg-transparent`,Ln=({label:e,icon:o,isDisabled:t=!1,hideLabel:n=!1,onClick:r,onMouseDown:s})=>p.jsx(Et,{onClick:r,"aria-label":n?e:void 0,onMouseDown:s,disabled:t,children:p.jsx(Ct,{icon:o,hideLabel:n,label:e})}),An=({icon:e,hideLabel:o,label:t,children:n})=>p.jsxs(qt,{children:[p.jsx(Jt,{asChild:!0,children:p.jsx(Et,{"aria-label":o?t:void 0,children:p.jsx(Ct,{icon:e,hideLabel:o,label:t})})}),p.jsx(Qt,{children:p.jsx(eo,{align:"end",className:K.toolbar,sideOffset:8,children:n})})]});ee.Separator=Ye(Sn)`mx-1 p-0 list-none h-full w-[1px] bg-token-border-light`;ee.Action=Ln;ee.Popover=An;const On=e=>E.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},E.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 4.5C7.5271 4.5 4 7.91095 4 12C4 13.6958 4.5996 15.263 5.62036 16.5254C5.80473 16.7534 5.87973 17.0509 5.82551 17.339C5.72928 17.8505 5.60336 18.3503 5.45668 18.8401C6.08722 18.743 6.69878 18.6098 7.2983 18.4395C7.54758 18.3687 7.81461 18.3975 8.04312 18.5197C9.20727 19.1423 10.5566 19.5 12 19.5C16.4729 19.5 20 16.0891 20 12C20 7.91095 16.4729 4.5 12 4.5ZM2 12C2 6.70021 6.53177 2.5 12 2.5C17.4682 2.5 22 6.70021 22 12C22 17.2998 17.4682 21.5 12 21.5C10.3694 21.5 8.82593 21.1286 7.46141 20.4675C6.36717 20.7507 5.2423 20.9253 4.06155 20.9981C3.72191 21.019 3.39493 20.8658 3.19366 20.5915C2.9924 20.3171 2.94448 19.9592 3.06647 19.6415C3.35663 18.8859 3.6004 18.1448 3.77047 17.399C2.65693 15.8695 2 14.0088 2 12ZM12 8C12.5523 8 13 8.44772 13 9V11H15C15.5523 11 16 11.4477 16 12C16 12.5523 15.5523 13 15 13H13V15C13 15.5523 12.5523 16 12 16C11.4477 16 11 15.5523 11 15V13H9C8.44772 13 8 12.5523 8 12C8 11.4477 8.44772 11 9 11H11V9C11 8.44772 11.4477 8 12 8Z",fill:"currentColor"})),Mn=({isSendDisabled:e=!1,getSelectionRange:o})=>{const t=Ve(),n=()=>{const r=o();if(r==null)return;const{from:s,to:a,sourceFrom:i,sourceTo:l}=r;if(s==null||a==null||i==null||l==null){w.logError("Missing selection range on targeted edit",r);return}const u=Xe.ASK;w.logButtonClick(Y.TOOLBAR_ASK_CHATGPT,{action:u,sourceFrom:i,sourceTo:l}),A.startCommentingOn({type:H.SELECTION,from:s,to:a,sourceRange:{start:i,end:l},action:u})};return p.jsx(ee.Action,{isDisabled:e,label:t.formatMessage({id:"wOaJUU",defaultMessage:"Ask ChatGPT"}),onClick:n,icon:On})},er=({getEditorDom:e,getToolbarPosition:o,getSelectionRange:t,toolbarType:n,children:r,onAddComment:s,isWaitingForCommentResponse:a=!1,isSendDisabled:i=!1})=>{const[{height:l,width:u},f]=ce(),[d,m]=E.useState(!0),[g,h]=E.useState(!1),v=e(),C=j(({commentingOn:S})=>S),[x,P]=E.useState(null),T=E.useCallback(()=>{const S=e(),O=document.getSelection();return!O||O.type!=="Range"||O.isCollapsed||!S?.contains(O.anchorNode)},[e]);E.useEffect(()=>{const S=to(()=>{h(!0)},200,{leading:!0}),O=()=>{S.cancel(),h(!1)};return v?.addEventListener("pointerdown",S,{passive:!0}),document.addEventListener("pointerup",O,{passive:!0}),()=>{v?.removeEventListener("pointerdown",S),document.removeEventListener("pointerup",O)}},[v]),E.useEffect(()=>{const S=()=>{m(T())};return document.addEventListener("selectionchange",S,{passive:!0}),()=>{document.removeEventListener("selectionchange",S)}},[T]),He(()=>{if(d||T())return m(!0);try{const S=o({width:u,height:l});S!=null&&P(S)}catch(S){w.logError("Invalid position in getToolbarPosition",S)}},[l,u,d,T,o]);const b=p.jsxs(ee,{toolbarType:n,children:[p.jsx(Mn,{isSendDisabled:i,getSelectionRange:t}),r]}),y=!d&&!C&&x!=null,R=mo(y);return E.useEffect(()=>{!y&&R&&!C&&v?.focus()},[v,R,y,C]),p.jsxs(p.Fragment,{children:[p.jsx("div",{"aria-hidden":"true",className:"pointer-events-none invisible fixed left-0 top-0 h-0 overflow-clip",children:p.jsx("div",{ref:f,children:b})}),p.jsx(X,{children:y&&p.jsx(D.div,{initial:{opacity:0,scale:.95},animate:{opacity:g?0:1,scale:g?.95:1},style:{top:x.top,left:x.left},exit:{opacity:0,scale:.95},transition:{type:"spring",bounce:.1,duration:.1,delay:g?0:.1},className:B("absolute",K.toolbar,g?"pointer-events-none":"pointer-events-auto"),children:b})}),p.jsx(ko,{toolbarPosition:x,commentingOn:C,isWaitingForCommentResponse:a,onAddComment:s})]})};function wn(e){let o=e;for(;o;){const n=window.getComputedStyle(o).overflowY;if(n==="auto"||n==="scroll")return o;o=o.parentElement}return null}function tr(e,o){const t=Q(),n=oo(),r=t();E.useEffect(()=>{const s=r?.dom;if(!s||e.length===0)return;const a=wn(s),i=o?Ze(o,100):null;return a&&i&&a.addEventListener("scroll",i,{passive:!0}),()=>{i&&(a&&a.removeEventListener("scroll",i),i.cancel())}},[r,n,e,o])}let te=null;function or(){if(te!=null)return te;if(typeof window>"u")return 0;const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.overflow="scroll",e.style.position="absolute",e.style.top="-9999px",document.body.appendChild(e);try{te=e.offsetWidth-e.clientWidth}finally{document.body.removeChild(e)}return te}function nr(e){return e==null?null:e.scrollHeight>e.clientHeight}export{nt as A,ee as B,Jn as C,U as H,G as I,Io as P,Bo as R,er as T,Eo as a,Xn as b,kn as c,or as d,J as e,$n as f,Kn as g,me as h,nr as i,Do as j,Ro as k,it as l,Wn as m,Vo as n,Se as o,Ao as p,qn as q,at as r,zn as s,wo as t,tr as u,No as v,Zn as w,re as x,Lo as y,cn as z};
//# sourceMappingURL=l5oa3rkthkme6uar.js.map
