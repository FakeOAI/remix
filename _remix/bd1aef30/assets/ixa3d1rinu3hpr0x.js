import{l as e,m as g,a5 as n,a7 as F,a1 as U,u as L,r as v,P as N,V as k,aw as q,Z as O,a2 as A,aM as H,d as P,b5 as Q}from"./gghzs582a65dvm3m.js";import{T as D,c4 as R,c5 as W,c6 as Y,c7 as I,c8 as K,a4 as c,c9 as G,ca as V,ak as Z,cb as J}from"./pd094ob9wacofnvk.js";import{D as f}from"./ljnuyiuz0czms6ve.js";import{b0 as X,a1 as $,am as z}from"./e34jsxd5qw5romn0.js";import{G as ee}from"./bzna72oknccd3y3z.js";import{m as se}from"./knl5287dkf7ic29t.js";const re=91,S=100;function C(s){return s<S?"bg-[#fcf6e0] text-yellow-500 dark:bg-yellow-600 dark:text-yellow-100":"bg-orange-100 text-[#f48c15] dark:bg-orange-800 dark:text-orange-100"}function E(s){return W()&&s!=null&&s>=re}function ae({memoryFullPct:s,className:t,children:o}){return E(s)?e.jsx("div",{className:g("rounded-lg border border-token-border-light p-1 text-sm",t),children:e.jsxs(se.div,{className:g("flex items-center overflow-hidden whitespace-nowrap rounded px-2 py-1.5",C(s)),initial:{width:0},animate:{width:`${s}%`},transition:{duration:.5},children:[e.jsx(n,{id:"6D2etG",defaultMessage:"{memoryFullPct}% full",values:{memoryFullPct:s}}),o]})}):null}function xe({memoryFullPct:s}){return E(s)?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:g("relative -mr-1 h-2 w-2 rotate-45 transform border-white/10",C(s))}),e.jsxs("div",{className:g("flex items-center rounded-lg px-3 py-1.5",C(s)),children:[e.jsx(n,{id:"x7M6HK",defaultMessage:"{memoryFullPct}%",values:{memoryFullPct:s}}),e.jsx(D,{label:s<S?e.jsx(n,{id:"VXohcH",defaultMessage:"Memory is almost full. Once memory is full, new memories won’t be created. You can forget existing memories to make space."}):e.jsx(n,{id:"pQ9dnt",defaultMessage:"Memory is full. New memories won’t be created. You can forget existing memories to make space."}),children:e.jsx(X,{className:"icon-sm ml-1 text-token-text-secondary"})})]})]}):null}function te({memoryFullPct:s,className:t}){return E(s)?e.jsxs("div",{className:g("flex flex-col gap-2",t),children:[e.jsx(ae,{memoryFullPct:s}),e.jsx("div",{className:"pl-3 text-sm text-token-text-secondary",children:s<S?e.jsx(n,{id:"z3LYM2",defaultMessage:"<strong>Memory almost full</strong>. Once memory is full, new memories won’t be created. You can forget existing memories to make space. <a>Learn more</a>.",values:{strong:r=>e.jsx("strong",{children:r}),a:r=>e.jsx("a",{href:R,target:"_blank",rel:"noopener noreferrer",className:"underline",children:r})}}):e.jsx(n,{id:"6rc4Jv",defaultMessage:"<strong>Memory is full</strong>. New memories won’t be created. You can forget existing memories to make space. <a>Learn more</a>.",values:{strong:r=>e.jsx("strong",{children:r}),a:r=>e.jsx("a",{href:R,target:"_blank",rel:"noopener noreferrer",className:"underline",children:r})}})})]}):null}function ne({gizmo:s,memory:t}){const o=U(),r=H(),m=L(),{mutate:a,isPending:M}=P({mutationFn:x=>O.deleteMemory(x,s==null?void 0:s.id),onSettled:()=>{m.invalidateQueries({queryKey:G(s==null?void 0:s.id)})},onError:()=>{r.danger(o.formatMessage({id:"MemoriesModal.deleteFailed",defaultMessage:"Failed to forget memory"}),{id:"memoryDeleteFailed"})}}),[j,l]=v.useState(!1),u=o.formatMessage({id:"z2CNgB",defaultMessage:"Forget"});return e.jsxs(e.Fragment,{children:[e.jsxs(c.Row,{disabled:M,children:[e.jsx(c.Cell,{children:e.jsx("div",{className:"whitespace-pre-wrap py-2",children:t.content})}),e.jsx(c.Cell,{textAlign:"right",children:e.jsx(c.Actions,{children:e.jsx("button",{onClick:()=>{N.logEvent(k.memoryModalMemoryDeleteClicked),l(!0)},"aria-label":u,className:"text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(D,{className:"leading-none",label:u,sideOffset:4,side:"top",children:e.jsx($,{className:"icon-sm"})})})})})]}),j&&e.jsx(Z,{isOpen:!0,primaryButtonColor:"danger",title:u,confirmText:o.formatMessage({id:"fCn0ar",defaultMessage:"Forget"}),onConfirm:()=>{N.logEvent(k.memoryModalMemoryDeleteConfirmed),a(t.id),l(!1)},onClose:()=>{l(!1)},children:e.jsx(n,{id:"pZ/TCe",defaultMessage:'{name} will forget "{title}". This cannot be undone. <link>Learn more</link>',values:{name:(s==null?void 0:s.name)??"ChatGPT",title:e.jsx("strong",{children:J(t.content,{length:130,omission:"..."})}),link:x=>e.jsx("a",{href:"https://help.openai.com/en/articles/8590148-memory-faq#h_41527f643d",target:"_blank",className:"underline",rel:"noreferrer",children:x})}})})]})}function oe({selectedGizmoId:s,onSelect:t,items:o}){const r=o.find(a=>a.id===s);function m(a){return e.jsx(ee,{isFirstParty:a.id===void 0,src:a.iconUrl??null,className:"icon-md"})}return e.jsx("div",{className:"mb-2 inline-flex rounded-md border border-token-border-medium",children:e.jsxs(f.Root,{children:[e.jsx(f.Trigger,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[r?e.jsxs(e.Fragment,{children:[m(r),e.jsx("span",{className:"text-token-text-primary",children:r==null?void 0:r.name})]}):e.jsx(n,{id:"MemoriesModal.unknownGizmo",defaultMessage:"Unknown GPT"}),e.jsx(z,{className:"icon-sm text-token-text-tertiary"})]})}),e.jsx(f.Portal,{children:e.jsx(f.Content,{children:o.map(a=>e.jsxs(f.Item,{className:"flex items-center gap-3",onClick:()=>{t(a.id)},children:[m(a),a.name]},a.id))})})]})})}const w=F.div`flex h-full items-center justify-center pb-8 text-sm text-token-text-tertiary rounded-lg border border-token-border-light`;function he({onClose:s,initialGizmoId:t}){var B;const o=U(),r=L(),m=Y(),[a,M]=v.useState(t),j=I();v.useEffect(()=>{N.logEvent(k.memoryModalShown)},[]);const{data:l,isLoading:u,isError:x,refetch:T}=K(a,!0,m),y=l==null?void 0:l.memories,{data:p,refetch:_}=q({queryKey:["memory_gizmos"],queryFn:()=>O.getGizmosWithMemory(),refetchOnMount:"always"}),b=[{id:void 0,name:"ChatGPT",iconUrl:null},...((B=p==null?void 0:p.items)==null?void 0:B.map(({gizmo:i})=>({id:i.id,name:i.display.name,iconUrl:i.display.profile_picture_url})))??[]],d=b.find(i=>i.id===a);let h;return u?h=e.jsx(w,{children:e.jsx(n,{id:"MemoriesModal.loading",defaultMessage:"Loading..."})}):x?h=e.jsx(w,{children:e.jsxs("div",{className:"max-w-sm text-center",children:[e.jsx("div",{className:"mb-4 text-red-500",children:e.jsx(n,{id:"MemoriesModal.somethingWentWrong",defaultMessage:"Something went wrong..."})}),e.jsx("div",{children:e.jsx(Q,{color:"secondary",onClick:()=>{T()},children:e.jsx(n,{id:"MemoriesModal.retry",defaultMessage:"Retry"})})})]})}):!y||y.length===0?h=e.jsx(w,{children:e.jsx("div",{className:"max-w-sm text-center",children:m?e.jsx(n,{id:"MemoriesModal.noMemories.1",defaultMessage:"As you chat with {name}, the details and preferences it remembers will be shown here.",values:{name:(d==null?void 0:d.name)??"ChatGPT"}}):e.jsx(n,{id:"MemoriesModal.noMemoriesAndDisabled",defaultMessage:"Memory is disabled. ChatGPT won't use or create memories."})})}):h=e.jsx(c.Root,{className:"h-full",size:"compact",bordered:!0,children:e.jsx(c.Body,{children:y.map(i=>e.jsx(ne,{gizmo:d?{id:d.id,name:d.name}:void 0,memory:i},i.id))})}),e.jsxs(A,{isOpen:!0,onClose:s,size:"custom",className:"max-w-5xl",type:"success",title:o.formatMessage({id:"MemoriesModal.title",defaultMessage:"Memory"}),showCloseButton:!0,children:[j&&b.length>1&&e.jsx("div",{className:"mb-4",children:e.jsx(oe,{selectedGizmoId:a,items:b,onSelect:i=>{r.invalidateQueries({queryKey:G(i)}),M(i)}})}),e.jsx(te,{memoryFullPct:l==null?void 0:l.memoryFullPct,className:"mb-5"}),e.jsx("div",{className:"h-[24rem]",children:h}),e.jsx("div",{className:"mt-5 flex justify-end",children:e.jsx(V,{onReset:()=>{T(),_(),a&&M(void 0)},gizmoId:a,memoryName:(d==null?void 0:d.name)??"ChatGPT"})})]})}export{xe as M,he as a};
//# sourceMappingURL=ixa3d1rinu3hpr0x.js.map
