import{fm as b}from"./mj0lqn4ze2fljnbl.js";import{j as k,c as A,s as T,l as N,a as K}from"./i05b781ldlkbpamo.js";import{F as p,a as h,P as g,S as u,T as x,N as S,D as P,d as D}from"./nx475br6f1fubfqz.js";import{em as M,en as B}from"./eufwkg2s3wcyxsss.js";function F(n){let e="",t=!1;const l=[];function r(s){if(t=!1,s.type.name==="paragraph")return s.descendants(i=>r(i)),e+=`
`,t=!0,!1;if(s.type.name==="command_token"){const i=s.textContent;return l.push({symbol:b.SystemHint,startIndex:e.length,endIndex:e.length+i.length}),e+=i,!1}else s.isText&&s.text!==void 0&&(e+=s.text)}return n.descendants(s=>r(s)),t&&e.endsWith(`
`)&&(e=e.slice(0,-1)),{content:e,metadata:{custom_symbol_offsets:l}}}function Y(n){return F(n.state.doc)}const O=A(K,N,T);async function v(n,e){const{schema:t}=n.state,l=e.split(`
`);if(n.dispatch(n.state.tr.deleteSelection()),n.dispatch(n.state.tr.insertText(l[0])),l.length>1){O(n.state,n.dispatch);const r=l.slice(1),s=p.fromArray(r.map(o=>t.nodes.paragraph.create(null,o===""?null:t.text(o)))),i=new h(s,0,0);n.dispatch(n.state.tr.replaceSelection(i)),k(n.state,n.dispatch,n)}}const z=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function E(n){let e=n.split(/-(?!$)/),t=e[e.length-1];t=="Space"&&(t=" ");let l,r,s,i;for(let o=0;o<e.length-1;o++){let f=e[o];if(/^(cmd|meta|m)$/i.test(f))i=!0;else if(/^a(lt)?$/i.test(f))l=!0;else if(/^(c|ctrl|control)$/i.test(f))r=!0;else if(/^s(hift)?$/i.test(f))s=!0;else if(/^mod$/i.test(f))z?i=!0:r=!0;else throw new Error("Unrecognized modifier name: "+f)}return l&&(t="Alt-"+t),r&&(t="Ctrl-"+t),i&&(t="Meta-"+t),s&&(t="Shift-"+t),t}function I(n){let e=Object.create(null);for(let t in n)e[E(t)]=n[t];return e}function d(n,e,t=!0){return e.altKey&&(n="Alt-"+n),e.ctrlKey&&(n="Ctrl-"+n),e.metaKey&&(n="Meta-"+n),t&&e.shiftKey&&(n="Shift-"+n),n}function G(n){return new g({props:{handleKeyDown:C(n)}})}function C(n){let e=I(n);return function(t,l){let r=M(l),s,i=e[d(r,l)];if(i&&i(t.state,t.dispatch,t))return!0;if(r.length==1&&r!=" "){if(l.shiftKey){let o=e[d(r,l,!1)];if(o&&o(t.state,t.dispatch,t))return!0}if((l.shiftKey||l.altKey||l.metaKey||r.charCodeAt(0)>127)&&(s=B[l.keyCode])&&s!=r){let o=e[d(s,l)];if(o&&o(t.state,t.dispatch,t))return!0}}return!1}}class a extends u{constructor(e){super(e,e)}map(e,t){let l=e.resolve(t.map(this.head));return a.valid(l)?new a(l):u.near(l)}content(){return h.empty}eq(e){return e instanceof a&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new a(e.resolve(t.pos))}getBookmark(){return new m(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!j(e)||!w(e))return!1;let l=t.type.spec.allowGapCursor;if(l!=null)return l;let r=t.contentMatchAt(e.index()).defaultType;return r&&r.isTextblock}static findGapCursorFrom(e,t,l=!1){e:for(;;){if(!l&&a.valid(e))return e;let r=e.pos,s=null;for(let i=e.depth;;i--){let o=e.node(i);if(t>0?e.indexAfter(i)<o.childCount:e.index(i)>0){s=o.child(t>0?e.indexAfter(i):e.index(i)-1);break}else if(i==0)return null;r+=t;let f=e.doc.resolve(r);if(a.valid(f))return f}for(;;){let i=t>0?s.firstChild:s.lastChild;if(!i){if(s.isAtom&&!s.isText&&!S.isSelectable(s)){e=e.doc.resolve(r+s.nodeSize*t),l=!1;continue e}break}s=i,r+=t;let o=e.doc.resolve(r);if(a.valid(o))return o}return null}}}a.prototype.visible=!1;a.findFrom=a.findGapCursorFrom;u.jsonID("gapcursor",a);class m{constructor(e){this.pos=e}map(e){return new m(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return a.valid(t)?new a(t):u.near(t)}}function j(n){for(let e=n.depth;e>=0;e--){let t=n.index(e),l=n.node(e);if(t==0){if(l.type.spec.isolating)return!0;continue}for(let r=l.child(t-1);;r=r.lastChild){if(r.childCount==0&&!r.inlineContent||r.isAtom||r.type.spec.isolating)return!0;if(r.inlineContent)return!1}}return!0}function w(n){for(let e=n.depth;e>=0;e--){let t=n.indexAfter(e),l=n.node(e);if(t==l.childCount){if(l.type.spec.isolating)return!0;continue}for(let r=l.child(t);;r=r.firstChild){if(r.childCount==0&&!r.inlineContent||r.isAtom||r.type.spec.isolating)return!0;if(r.inlineContent)return!1}}return!0}function Q(){return new g({props:{decorations:R,createSelectionBetween(n,e,t){return e.pos==t.pos&&a.valid(t)?new a(t):null},handleClick:L,handleKeyDown:J,handleDOMEvents:{beforeinput:H}}})}const J=C({ArrowLeft:c("horiz",-1),ArrowRight:c("horiz",1),ArrowUp:c("vert",-1),ArrowDown:c("vert",1)});function c(n,e){const t=n=="vert"?e>0?"down":"up":e>0?"right":"left";return function(l,r,s){let i=l.selection,o=e>0?i.$to:i.$from,f=i.empty;if(i instanceof x){if(!s.endOfTextblock(t)||o.depth==0)return!1;f=!1,o=l.doc.resolve(e>0?o.after():o.before())}let y=a.findGapCursorFrom(o,e,f);return y?(r&&r(l.tr.setSelection(new a(y))),!0):!1}}function L(n,e,t){if(!n||!n.editable)return!1;let l=n.state.doc.resolve(e);if(!a.valid(l))return!1;let r=n.posAtCoords({left:t.clientX,top:t.clientY});return r&&r.inside>-1&&S.isSelectable(n.state.doc.nodeAt(r.inside))?!1:(n.dispatch(n.state.tr.setSelection(new a(l))),!0)}function H(n,e){if(e.inputType!="insertCompositionText"||!(n.state.selection instanceof a))return!1;let{$from:t}=n.state.selection,l=t.parent.contentMatchAt(t.index()).findWrapping(n.state.schema.nodes.text);if(!l)return!1;let r=p.empty;for(let i=l.length-1;i>=0;i--)r=p.from(l[i].createAndFill(null,r));let s=n.state.tr.replace(t.pos,t.pos,new h(r,0,0));return s.setSelection(x.near(s.doc.resolve(t.pos+1))),n.dispatch(s),!1}function R(n){if(!(n.selection instanceof a))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",P.create(n.doc,[D.widget(n.selection.head,e,{key:"gapcursor"})])}export{O as c,Q as g,v as i,G as k,F as n,Y as p};
//# sourceMappingURL=owx9u9anlka4h8j6.js.map
