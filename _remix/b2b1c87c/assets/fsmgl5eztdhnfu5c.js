const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/eqw5gpjx2itvjo97.js","assets/d4leej2qw3qpt1pk.js","assets/okxdn8hddblnp0ou.js","assets/root-eakuwlaq.css","assets/fz81i3fl330y5ew1.js","assets/conversation-small-eplmind9.css","assets/dywhugbdhvsxyyf5.js","assets/hyhugnup8jw7vymu.js","assets/f2il2wfcdnz6iwbp.js","assets/htugu8grc2zkjf6t.js","assets/lb6o9fdebdcca1rq.js","assets/kd847zqymupw3yev.js","assets/c6czee0ptvr50b6w.js","assets/ohxwppau79l98jz8.js","assets/fjudouet3a78cgv3.js","assets/c03cyiw531bfxkuh.js","assets/o6zznuciznt3qyz0.js","assets/gcg3s799tx64lwzh.js","assets/9icnhfjc3wq4r4fn.js","assets/d4t0vtbfqthmj7np.js","assets/jj9lp929lmdlnrht.js","assets/g3ajm57p2xx770mv.js"])))=>i.map(i=>d[i]);
import{r as d,aF as J,aG as W,S as R,P as N,V as w,a1 as L,bS as P,eN as T,eO as H,bw as Z,l as s,m as p,bs as ee,W as te,u as F,bq as se,aM as ae,Z as C,a5 as k,a6 as ne}from"./d4leej2qw3qpt1pk.js";import{dg as re,dh as ie,di as q,dj as oe,dk as le,bk as de,a8 as ce,a_ as G,T as ue,dl as fe,dm as B,dn as me,dp as he,dq as A,dr as ye,ds as ge}from"./fz81i3fl330y5ew1.js";import{b as pe,g as be}from"./dywhugbdhvsxyyf5.js";import{b as xe,r as _,s as Te}from"./c6czee0ptvr50b6w.js";import{f as ve}from"./kd847zqymupw3yev.js";import{m as Se,n as Y,o as Ee,p as Ne,T as z}from"./hyhugnup8jw7vymu.js";import{G as U}from"./lb6o9fdebdcca1rq.js";import{ai as we}from"./okxdn8hddblnp0ou.js";import{m as Ce}from"./f2il2wfcdnz6iwbp.js";function Ie(e,t,i){const{title:a,titleSource:r}=Se(e),[n,l]=d.useState(!1),o=a??t,c=d.useRef(o);return d.useEffect(()=>(i&&r===Y.Generated&&o!==c.current&&l(!0),()=>{c.current=o}),[i,o,r]),{isTypingEffect:n,resolvedTitle:o}}const ke=J(()=>W(()=>import("./eqw5gpjx2itvjo97.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.GizmoConversationOptionsDropdown)),je=new Date(2024,8,24,13);function _e(e){R.checkGate("3922476776")||re.abortAllRequests(),N.logEvent(w.loadThread,{threadId:e})}function Me({conversation:e,conversationTitle:t,onOpenChange:i}){const a=L(),{isUnauthenticated:r}=te(),{eligible:n,markAsViewed:l}=de(ce.ArchiveConversationOnboarding),o=Ne(e.id),[c,f]=d.useState(!1),m=F(),u=se(),b=ae();return d.useEffect(()=>H(U,{deleteChat:({serverThreadId:h})=>{h===e.id&&f(!0)},archiveChat:async({serverThreadId:h})=>{h===e.id&&(await C.patchConversation(e.id,{is_archived:!0}),_(m),R.logEvent("chatgpt_conversation_archived"),N.logEvent(w.conversationArchived),n&&(b.info(a.formatMessage({defaultMessage:"You can view archived chats in Settings",id:"HistoryGizmoItem.archiveChatOnboarding"}),{duration:10,hasCloseButton:!0}),l()),o&&G(u))}}),[u,b,m,n,e.id,a,o,l]),r?null:s.jsxs(s.Fragment,{children:[s.jsx(ue,{label:a.formatMessage({id:"tJPHEQ",defaultMessage:"Options"}),sideOffset:4,side:"top",children:s.jsx(ke,{clientThreadId:e.id,onOpenChange:i,children:s.jsx("button",{className:"flex items-center justify-center text-token-text-secondary transition hover:text-token-text-primary radix-state-open:text-token-text-secondary",children:s.jsx(we,{className:"icon-md"})})})}),c&&s.jsx(fe,{title:t,handleDelete:()=>{C.patchConversation(e.id,{is_visible:!1}).then(()=>{_(m),R.logEvent("chatgpt_conversation_deleted"),N.logEvent(w.conversationDeleted)}),o&&G(u)},onClose:()=>{f(!1)}})]})}function De({conversation:e,onClose:t}){const[i,a]=d.useState(e.title),r=F();function n(){i!==e.title&&(z.setTitle(e.id,i,Y.User),N.logEvent(w.renameThread,{threadId:e.id,content:i}),C.patchConversation(e.id,{title:i}).then(()=>{_(r)}))}return s.jsx("input",{type:"text",value:i,onChange:l=>{a(l.target.value)},onKeyDown:l=>{switch(l.key){case"Escape":t();break;case"Enter":n(),t();break}},onBlur:()=>{n(),t()},autoFocus:!0,className:"w-full border border-token-border-light bg-transparent p-0 text-sm"})}const V=5,Oe=3e3;function Re({threadId:e}){const t=F(),i=d.useRef(!1),a=d.useRef(null);return d.useEffect(()=>{async function r(){i.current=!0;const n=await ve(e);if(n.async_status===T.FINISHED){_(t),z.initThreadFromServerData(e,n,!0,void 0,!0);return}if(n.async_status!==T.PENDING)return;const l=n.update_time??0;q(new Date,new Date(l*1e3))<V?a.current=window.setTimeout(r,Oe):C.clearConversationStatus(e)}return i.current||r(),()=>{a.current&&window.clearTimeout(a.current)}},[t,e]),null}function Le({conversation:e,isActive:t,elementRef:i,isPrimaryBackgroundColor:a}){const r=L(),[n,l]=d.useState(!1),[o,c]=d.useState(!1),{value:f}=P("3922476776"),{value:m}=P("232791851"),u=xe(e.id),b=Ee(e.id),h=ie(b),I=q(new Date,new Date(e.update_time??0))<V,y=e.update_time&&oe(new Date(e.update_time),je),x=u===T.PENDING&&I,M=m&&!t&&!h&&y&&u===T.FINISHED,D=m&&!t&&(h||x),O=m&&u===T.PENDING&&!h&&I,v=d.useRef(!1);d.useEffect(()=>{!v.current&&!h&&u===T.FINISHED&&t&&f&&(async()=>(v.current=!0,await C.clearConversationStatus(e.id),Te(e.id,null),v.current=!1))()},[f,t,e.id,u,h]),d.useEffect(()=>H(U,{editTitle:({serverThreadId:g})=>{(g?g===e.id:t)&&l(!0)}}),[e.id,t]);const S=r.formatMessage({id:"mpXAeu",defaultMessage:"New chat"}),{resolvedTitle:E,isTypingEffect:$}=Ie(e.id,e.title,t),K=Z(),X=$&&t&&K,{data:Q}=pe(e.conversation_template_id??void 0);return s.jsxs("div",{className:p("no-draggable group relative rounded-lg active:opacity-90",t?"bg-token-sidebar-surface-secondary":"hover:bg-token-sidebar-surface-secondary",o&&!t&&"bg-token-sidebar-surface-secondary"),children:[O&&s.jsx(Re,{threadId:e.id}),s.jsx(ee,{to:be(e.id,Q),onClick:g=>{g.metaKey||g.ctrlKey||t||_e(e.id)},onDoubleClick:()=>{l(!0)},ref:i,className:"flex items-center gap-2 p-2",children:s.jsxs("div",{className:p("relative grow overflow-hidden whitespace-nowrap",D&&"loading-shimmer"),dir:"auto",children:[X?s.jsx(le,{text:E||S}):E||S,s.jsx("div",{className:p("absolute bottom-0 top-0 to-transparent ltr:right-0 ltr:bg-gradient-to-l rtl:left-0 rtl:bg-gradient-to-r",a?t||!t&&o?"from-token-sidebar-surface-secondary":"from-token-main-surface-primary":!1,a?!1:t||!t&&o?"from-token-sidebar-surface-secondary":"from-token-sidebar-surface-primary",{"from-token-main-surface-primary can-hover:group-hover:from-token-sidebar-surface-secondary":a&&!t&&!o,"from-token-sidebar-surface-primary can-hover:group-hover:from-token-sidebar-surface-secondary":!a&&!t&&!o,"w-10 from-60%":t||o,"w-8 from-0% can-hover:group-hover:w-10 can-hover:group-hover:from-60%":!t&&!o})})]})}),n?s.jsx("div",{className:"absolute bottom-0 left-[7px] right-2 top-0 flex items-center bg-token-sidebar-surface-secondary",children:s.jsx(De,{conversation:e,onClose:()=>{l(!1)}})}):M?s.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:s.jsx("div",{className:"h-2 w-2 rounded-full bg-blue-selection"})}):s.jsx("div",{className:p("absolute bottom-0 top-0 items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",t||o?"flex":"hidden can-hover:group-hover:flex"),children:s.jsx(Me,{conversation:e,conversationTitle:E??e.title,onOpenChange:g=>{c(g),g&&N.logEvent(w.conversationHistoryItemOpenMenu,{conversationId:e.id})}})})]})}const Fe={initial:({isNew:e})=>e?{opacity:0,height:0,overflow:"hidden"}:{},animate:()=>({opacity:1,height:"auto"}),exit:()=>({opacity:0,height:0})};function Pe({elementRef:e,item:t,isActive:i,isFirstItem:a,isExistingItem:r,isPrimaryBackgroundColor:n}){const l=B();return s.jsx(Ce.li,{className:p("relative",a&&!l?"z-[15]":""),layout:"position",custom:{isNew:!r},variants:Fe,initial:"initial",animate:"animate",exit:"exit","data-testid":"history-item",children:s.jsx(Le,{isPrimaryBackgroundColor:n,conversation:t,isActive:i,elementRef:e})})}const j=ne({historyBucketToday:{id:"history.bucket.today",defaultMessage:"Today"},historyBucketYesterday:{id:"history.bucket.yesterday",defaultMessage:"Yesterday"},historyBucketLastSeven:{id:"history.bucket.lastSeven",defaultMessage:"Previous 7 Days"},historyBucketLastThirty:{id:"history.bucket.lastThirty",defaultMessage:"Previous 30 Days"}}),Ge=5;function Ke(e,t){const i=L();return d.useMemo(()=>e.reduce((a,r)=>{const n=new Date(r.update_time??r.create_time??0),l=me(new Date,n);if(l===0)a.recent.today.items.push(r);else if(l<=1)a.recent.yesterday.items.push(r);else if(l<=7)a.recent.lastSeven.items.push(r);else if(l<=30)a.recent.lastThirty.items.push(r);else if(he(n)){const o=A(n),c=ye(n),f=`${o}-${c}`;a.dynamicMonths[f]?a.dynamicMonths[f].items.push(r):a.dynamicMonths[f]={label:i.formatDate(n,{month:"long"}),items:[r]}}else{const c=`${A(n)}-`;a.dynamicYears[c]?a.dynamicYears[c].items.push(r):a.dynamicYears[c]={label:i.formatDate(n,{year:"numeric"}),items:[r]}}return a},{recent:{today:{label:s.jsx(k,{...j.historyBucketToday}),items:[]},yesterday:{label:s.jsx(k,{...j.historyBucketYesterday}),items:[]},lastSeven:{label:s.jsx(k,{...j.historyBucketLastSeven}),items:[]},lastThirty:{label:s.jsx(k,{...j.historyBucketLastThirty}),items:[]}},dynamicMonths:{},dynamicYears:{}}),[t,e])}function Xe({activeId:e,bucketedItems:t,items:i,hasNextPage:a,isPrimaryBackgroundColor:r,previousItems:n,infiniteScrollTriggerElementRef:l}){const o=B();return s.jsx(s.Fragment,{children:[t.recent,t.dynamicMonths,t.dynamicYears].flatMap((c,f)=>s.jsx(d.Fragment,{children:Object.entries(c).map(([m,{items:u,label:b}],h)=>{if(m!=="today"&&!u.length)return null;const I=!!u.find(y=>{var x;return i.length>0&&y.id===((x=i[0])==null?void 0:x.id)});return u.length>0&&s.jsxs("div",{className:p(r&&"first:mt-0","relative mt-5 first:mt-0 last:mb-5"),children:[s.jsx("div",{className:p("sticky z-20 bg-token-sidebar-surface-primary",o?"top-[--sidebar-sticky-threshold] mb-2":"top-0"),children:s.jsx("span",{className:"flex h-9 items-center",children:s.jsx(ge,{children:b})})}),s.jsx("ol",{children:u.map((y,x)=>{var S;const M=e===y.id,D=I&&x===0,O=n==null?void 0:n.find(({id:E})=>E===y.id),v=a&&((S=i[i.length-Ge-1])==null?void 0:S.id)===y.id?l:void 0;return s.jsx(Pe,{item:y,isActive:M,isFirstItem:D,isExistingItem:!!O,isPrimaryBackgroundColor:r,elementRef:v},`history-item-${y.id}-${m}`)})})]},`${m}-${f}-${h}`)})},`category-${f}`))})}export{Xe as H,Pe as a,_e as o,Ke as u};
//# sourceMappingURL=fsmgl5eztdhnfu5c.js.map
