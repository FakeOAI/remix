var me=Object.defineProperty;var ye=(e,t,r)=>t in e?me(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var K=(e,t,r)=>ye(e,typeof t!="symbol"?t+"":t,r);import{e_ as ge,e$ as J,cg as he,f0 as F,r as f,de as pe,bq as Se,f1 as Me,P as x,dL as Pe,aw as m,aT as I,Z as re,d$ as B,aP as se,d1 as _e,V as X,f2 as ze,l as Ge,ad as ve,aM as $,R as Ce,d_ as Ee,bx as we,v as be,bK as ne,u as _,d as C,aJ as ee}from"./d4leej2qw3qpt1pk.js";import{bM as oe,bP as j,bm as qe,ey as Fe,ez as Te,bS as h,eA as Le,bi as Re,ed as q,ag as u,eB as De,en as Ue,ei as Qe,eC as Ae,eD as He}from"./fz81i3fl330y5ew1.js";import{T as L,F as Ke,b as xe}from"./hyhugnup8jw7vymu.js";function Oe({clientThreadId:e}){var i;const t=L.getThreadCurrentLeafId(e),s=((i=L.getTree(e).getMessage(t).metadata)==null?void 0:i.model_switcher_deny)??[],n={};s.forEach(a=>{const{slug:d,context:c,reason:l,description:y}=a,g=n[d]??{},w=g[c]??[];w.push({reason:l,description:y}),g[c]=w,n[d]=g});const o=ge();for(const{resets_after:a,model_slug:d}of o)[J.CONVERSATION,J.REGENERATE].forEach(c=>{const l=n[d]??{},y=l[c]??[],g={reason:he.RATE_LIMIT,resetsAfter:a};y.push(g),l[c]=y,n[d]=l});return n}const lt="text-davinci-002-render-sha",dt="gpt-4",ft="gpt-4o",mt="o1-preview",yt="o1-mini",O=oe({slug:j,max_tokens:4097,title:"Default",description:"",tags:[F.GPT_3_5],product_features:{}}),Ie=({default_model:e,tagline:t,color:r,human_category_name:s,category:n,human_category_short_name:o,human_category_shorter_name:i,subscription_level:a,short_explainer:d,subcategory:c,is_beta:l,...y})=>({color:r,tagline:t,defaultModel:e,label:s,shortLabel:o,description:d,shorterLabel:i??o,subscriptionLevel:a,categoryId:n,subcategory:c,isBeta:l,...y}),Ne=({icon:e,icon_filled_src:t,icon_outline_src:r})=>({iconName:e,iconFilledSrc:t,iconOutlineSrc:r}),ke=({group:e,human_group_name:t,human_group_short_name:r,model_ids:s})=>({group:e,label:t,shortLabel:r,modelIds:s});function Be(){return I({retry:5,queryKey:["modelIcons"],queryFn:async()=>await re.getModelIcons().then(e=>Object.fromEntries(Object.entries(e).map(([t,r])=>[t,Ne(r)])))})}function $e(e){return I({retry:5,queryKey:["models",{isHistoryDisabled:e}],queryFn:async()=>await re.getModels(e).then(t=>{const{models:r,internal_groups:s,categories:n}=t,o=r.map(oe);return{categories:n.concat().reverse().map(Ie),groups:(s==null?void 0:s.map(ke))??[],modelsList:o,modelsMap:Object.fromEntries(o.map(i=>[i.id,i]))}})})}function E(){const e=Pe();return m($e(e))}function gt(){return m(Be())}function je({isRegen:e=!1}={}){const{isLoading:t,data:{categories:r=[],groups:s=[]}={}}=E(),n=f.useMemo(()=>e?r.filter(o=>o.is_regenerate_category!==!1):r.filter(o=>!o.is_regenerate_category),[r,e]);return{isLoading:t,categories:n,groups:s??[]}}function ht(){const{categories:e}=je();return!!e.find(({categoryId:t})=>t===qe.GPT4o)}function pt(){const{data:e}=E();return f.useMemo(()=>e?new Set(Object.keys(e.modelsMap)):new Set([j]),[e])}const Ve={[j]:O};function We(){const{data:e}=E();return(e==null?void 0:e.modelsMap)??Ve}function ie(e,t,r){let s=F.GPT_3_5;return r?s=F.GPT_4:t&&(s=F.GPT_4o),(e==null?void 0:e.modelsList.find(n=>n.tags.includes(s)))??(e==null?void 0:e.modelsList[0])??O}function St(e=!1){const t=pe(),r=Se(),[,s]=Me();return f.useCallback(({location:n,modelId:o})=>{const i=t.pathname.includes("/g/");e||i?(x.logNewChatButtonClicked({location:n}),r({pathname:"/",search:`?model=${encodeURIComponent(o)}`})):(s(a=>(a.set("model",encodeURIComponent(o)),a)),x.logNewChatButtonClicked({location:n}))},[e,t,r,s])}function Mt(){const{data:{categories:e=[]}={}}=E(),{doesUserHaveAnyAccountsWithPlusFeatures:t}=B();if(t)return null;const r=e.find(Fe);return(r==null?void 0:r.defaultModel)??null}function Ye(e){return Ke(e)}function ae(e){const t=Ye(e),r=We();return f.useMemo(()=>t==null?O:r[t]??O,[t,r])}function Ze(e,t){var s;return((s=ae(e).enabledTools)==null?void 0:s.includes(t))??!1}function Pt(e){const t=Te(),r=ae(e),s=f.useMemo(()=>!t.isSuccess||!t.data?[]:t.data,[t.data,t.isSuccess]),n=Oe({clientThreadId:e});return f.useMemo(()=>{const i=new Set(r.enabledTools||[]);return s.filter(a=>!(!(a.requiredFeatures.length===0||a.requiredFeatures.every(l=>i.has(l)))||!(a.requiredModels.length===0||a.requiredModels.some(l=>!n[l]))))},[s,r,n])}function _t(e){return decodeURIComponent(e.model??"")||null}function zt(){const{data:e}=E(),{doesUserHaveAnyAccountsWithPlusFeatures:t}=B(),r=se();return ie(e,!!t,!!(r!=null&&r.isEnterprise()))}const Je="hints";class R extends _e()(r=>({persistedSystemHints:new Set(r)})){constructor(){super(...arguments);K(this,"addPersistedSystemHint",r=>{r===h.Search&&x.logEvent(X.searchModeEngaged),this.setState(({persistedSystemHints:s})=>({persistedSystemHints:new Set(s).add(r)}))});K(this,"removePersistedSystemHint",r=>{r===h.Search&&x.logEvent(X.searchModeDisabled),this.setState(({persistedSystemHints:s})=>{const n=new Set(s);return n.delete(r),{persistedSystemHints:n}})})}}K(R,"getPersistedSystemHints",({persistedSystemHints:r})=>r);const Gt=()=>R.useState(R.getPersistedSystemHints);function vt({children:e,clientThreadId:t,currentLeafId:r}){const s=Ze(t,ze.Search),o=L.getLastMessgageSystemHints(t,r).includes(h.Search)&&s,[i]=f.useState(()=>new R(o?[h.Search]:[]));return f.useEffect(()=>{const a=i.getState().persistedSystemHints;o&&!a.has(h.Search)&&(i==null||i.addPersistedSystemHint(h.Search))},[o,i]),Ge.jsx(R.Provider,{store:i,children:e})}function Xe(e){const t=new Set;if(e){const r=e.split(",");Array.isArray(r)&&r.forEach(s=>{Object.values(h).includes(s)&&t.add(s)})}return t}const ue="q",et="m";function Ct(e){const{clientThreadId:t,currentLeafId:r,handleRequestCompletion:s}=e,n=f.useRef(!1),{isLoading:o,data:i}=E(),{doesUserHaveAnyAccountsWithPlusFeatures:a,isLoading:d}=B(),c=se(),l=ve(),y=$(),g=f.useCallback((S,z,M,G)=>{L.updateTree(t,v=>{v.addNode(S,M,z,Ce.User,void 0,G)})},[t]),w=f.useCallback(async(S,{content:z,attachments:M},G,v,b,Q)=>{const k=r,p=M.length>0?{attachments:M}:{};p.system_hints=v.systemHints,g(S,k,z,p),s({type:Ee.Next,promptId:S,requestedModelId:Q,eventMetadata:G,cancelActiveRequests:!0,completionMetadata:v,turnTracker:b})},[g,s,r]),D=we(()=>window.location.pathname)??null,W=Le();let Y=!o&&!d&&D!=null;const[N,U]=f.useState(!0);return f.useEffect(()=>{if(!N||n.current)return;const S=xe.getConversationMode(t);if(!Y||S==null)return;if(!rt(D)||tt(D)&&W===void 0||L.getServerThreadId(t)!=null){U(!1);return}const{[ue]:z,[et]:M,[Je]:G,...v}=l.query,b=(typeof z=="string"?z:null)??(typeof M=="string"?M:null);if(!b||!b.trim()){U(!1);return}const Q=Xe(G),k=be();n.current=!0;let p=i==null?void 0:i.modelsList;Q.has(h.Search)&&(p=p==null?void 0:p.filter(H=>{var Z;return(Z=H.enabledTools)==null?void 0:Z.includes(h.Search)}));const A=i&&ie({...i,modelsList:p??[]},!!a,!!(c!=null&&c.isEnterprise()));if(l.replace({query:v},void 0,{shallow:!0}),A==null){y.warning("No model available for this request"),U(!1);return}const fe=new Re;(e.prefetchSearchPromise??Promise.resolve(null)).then(H=>{w(k,{content:b,attachments:[]},{eventSource:"url"},{conversationMode:S,source:"instant-query",systemHints:G?Array.from(Q):void 0,prefetchIds:H!=null?[H]:void 0},fe,A==null?void 0:A.id),U(!1)})},[o,d,Y,D,l,i,a,c,w,N,t,W,y,e.prefetchSearchPromise]),N}function tt(e){return ce(e)}function ce(e){return e==null?!1:/^\/g\/[\w-]+$/.test(e)}function rt(e){return e==null?!1:e==="/"||ce(e)}const Et="GPT Builder";function wt(e){if(e)return`ChatGPT - ${e}`}function V(e){return e.gizmo.short_url??e.gizmo.id??"-"}function le(e){return`/g/${e}`}function bt(e){return`https://chatgpt.com${le(e)}`}function st(e){return le(V(e))}function qt(e,t){const r=new URLSearchParams;return t!=null&&r.set(ue,t),De(new URL(`${st(e)}?${r}`,"https://chatgpt.com"))}function Ft(e){return`/g/${V(e)}`}function Tt(e){return Ue(e)&&e.gizmo.live_version===0||Qe(e)&&e.liveVersion===0}function Lt(e,t){return m({queryKey:["gizmos","discovery",{locale:e,isAnon:t}],queryFn:async()=>u.getGizmoDiscovery(e,t)})}function Rt({cutId:e,locale:t,limit:r,cursor:s,enabled:n=!0}){return ne({queryKey:["gizmos","discovery",{cutId:e,locale:t,limit:r}],queryFn:async({pageParam:o})=>u.getGizmoDiscoveryCut(e,{locale:t,cursor:o,limit:r}),initialPageParam:s,getNextPageParam:o=>o.list.cursor??void 0,enabled:n})}function Dt(){return m({queryKey:["gizmos","pinned"],queryFn:async()=>u.getGizmoPinned()})}function T(){return I({queryKey:["gizmos","bootstrap"],queryFn:async()=>u.getGizmoBootstrap().then(e=>({gizmos:e.gizmos.map(t=>({resource:t.resource,flair:t.flair}))}))})}function Ut(){return m(T())}function te(e,t){const r=e.filter(n=>n.resource.gizmo.id!==t.resource.gizmo.id);let s=r.findIndex(n=>n.flair.kind===q.Recent);return s===-1&&(s=r.length),r.splice(s,0,t),r}const Qt={handleGizmoInteracted(e,t){const r=e.getQueryData(P(e,t).queryKey);r!=null&&e.setQueryData(T().queryKey,s=>{if(s==null)return s;const n=s.gizmos.find(o=>o.resource.gizmo.id===t);return(n==null?void 0:n.flair.kind)===q.FirstParty||(n==null?void 0:n.flair.kind)===q.SidebarKeep?s:{gizmos:te(s.gizmos,{resource:r,flair:{kind:q.Recent}})}})},handleGizmoSidebarKeep(e,t){const r=e.getQueryData(P(e,t).queryKey);r!=null&&e.setQueryData(T().queryKey,s=>s==null?s:{gizmos:te(s.gizmos,{resource:r,flair:{kind:q.SidebarKeep}})})},handleGizmoSidebarHide(e,t){e.setQueryData(T().queryKey,r=>r!=null&&r.gizmos.some(s=>s.resource.gizmo.id===t)?{gizmos:r.gizmos.filter(s=>s.resource.gizmo.id!==t)}:r)}};function At(e,t=!1){const r=_();return m(P(r,e,t))}function Ht({gizmoId:e,draft:t,version:r}){const s=_(),n=r?{queryKey:["gizmo","version",{gizmoId:e,version:r}],queryFn:async()=>u.getVersion({gizmoId:e,version:r}),enabled:e!=null}:P(s,e,t);return m(n)}function Kt(e,t){return m({queryKey:["gizmo","userActionSettings",{gizmoId:e}],queryFn:async()=>u.getUserActionSettings(e),enabled:e!=null&&t})}function P(e,t,r=!1){return I({queryKey:["gizmo",{gizmoId:t},{draft:r}],queryFn:async()=>u.getGizmo(t,r),enabled:t!=null,initialData:()=>{var o,i;if(r===!0)return;const s=e.getQueryData(T().queryKey);if(s!=null)return(o=s.gizmos.find(a=>a.resource.gizmo.id===t))==null?void 0:o.resource;const n=e.getQueryData(["gizmos","discovery"]);if(n!=null)for(const a of n.cuts){const d=(i=a.list.items.find(c=>c.resource.gizmo.id===t))==null?void 0:i.resource;if(d!=null)return d}}})}function xt(e,t){return e.fetchQuery(P(e,t))}function Ot(e){return m({queryKey:["gizmo",{search:e}],queryFn:async()=>u.getGizmoSearch(e),enabled:e.length>0})}function It(e,t){return m({queryKey:["gizmo-search-workspace",{search:e}],queryFn:async()=>u.getGizmoSearchForWorkspace(e),enabled:e.length>0&&t})}function Nt(e,t=!1,r=!1,s=null){return ne({queryKey:[r?"gizmo-search-workspace":"gizmo",{query:e,cursor:s}],queryFn:async({pageParam:n})=>r?u.getGizmoSearchForWorkspace(e,s=n):u.getGizmoSearch(e,s=n),initialPageParam:s,getNextPageParam:n=>n.cursor??void 0,enabled:t})}function kt(){const e=_();return C({mutationFn:async({gizmoId:t,editorData:r})=>{const{instructions:s,name:n,description:o,profilePictureId:i,profilePictureUrl:a,promptStarters:d,tools:c,files:l,trainingDisabled:y}=r;return u.upsertDraft({instructions:s,display:{name:n,description:o,profile_pic_id:i,profile_picture_url:a,prompt_starters:d},tools:c,files:l.map(g=>({...g,location:Ae.FILE_SERVICE})),training_disabled:y},t)},onSettled:t=>{t&&(e.setQueryData(P(e,t.gizmo.id,!0).queryKey,t),e.invalidateQueries({queryKey:["gizmos","mine"],refetchType:"none"}))}})}function Bt(){const e=_();return C({mutationFn:async({gizmoId:t,data:r})=>{const{sharingRecipient:s,categories:n}=r,o=await u.promoteDraft({sharing:r.sharingSubjects&&r.sharingSubjects.length>0?r.sharingSubjects:{recipient:s},categories:n},t);if(o.error)throw new He(o);return o.resource},onSettled:t=>{e.invalidateQueries({queryKey:["gizmos"],refetchType:"all"}),e.invalidateQueries({queryKey:["gizmos","pinned"],refetchType:"none"}),t&&e.setQueryData(P(e,t.gizmo.id,!1).queryKey,t)}})}function $t(){const e=_();return C({mutationFn:async({gizmoId:t})=>u.deleteGizmo(t),onSettled:()=>{e.invalidateQueries({queryKey:["gizmos"],refetchType:"all"})}})}function jt(){const e=_(),t=$();return C({mutationFn:async({name:r,hideName:s,websiteUrl:n,willReceiveSupportEmails:o})=>u.updateBuilderProfile({name:r,hide_name:s,website_url:n,will_receive_support_emails:o}),onSuccess:r=>{e.setQueryData(["builderProfile"],r)},onError:r=>{t.warning(r.message)}})}function Vt(){return m({queryKey:["builderProfile"],queryFn:async()=>u.getBuilderProfile()})}function Wt(){return C({mutationFn:async({gizmoId:e})=>u.copyGizmo({gizmoId:e})})}function Yt(){return m({queryKey:["gizmoCategories"],queryFn:async()=>u.getCategories()})}function Zt(e,t){return!!(t!=null&&[ee.PrimaryAssistant,ee.GizmoInteraction].includes(t)&&(e!=null&&e.includes(F.GPT_4)))}function Jt(e,t){const r=_(),s=$();return C({mutationFn:async({rating:n,message:o,includeFrom:i})=>{await u.upsertUserReview(e,n,o,i)},onSuccess:async()=>{r.invalidateQueries({queryKey:["gizmo","review",{gizmoId:e}]})},onError:n=>{s.danger(n.message)}})}function Xt(e,t){return t?`/g/${V(t)}/c/${e}`:`/c/${e}`}function er(){return"/gpts"}function tr(){return"/gpts/mine"}function de(e){return e?`/gpts/editor/${e}`:"/gpts/editor"}function rr(e){const t=nt();return e==null?t:de(e)}function nt(e){return de(e)}function sr(e){try{const t=new URL(e);return t.hostname=t.hostname.replace(/^(www\.|web\.|mbasic\.|mobile\.)(secure\.)?/,""),t.pathname="",[...t.searchParams.keys()].forEach(r=>t.searchParams.delete(r)),t.toString()}catch{return e}}function ot(e){if(!e)return null;try{return new URL(e).hostname}catch{return null}}function nr(e){const t=ot(e);return t?t.replace(/^www\./,""):e}export{We as $,er as A,Gt as B,Ot as C,It as D,Nt as E,Lt as F,ft as G,tr as H,ae as I,zt as J,Vt as K,jt as L,Yt as M,Ht as N,E as O,R as P,dt as Q,kt as R,Bt as S,P as T,xt as U,pt as V,_t as W,gt as X,Oe as Y,Ze as Z,Pt as _,Ye as a,Zt as a0,Et as a1,mt as a2,yt as a3,Mt as a4,lt as a5,Ct as a6,vt as a7,At as b,ht as c,st as d,Jt as e,$t as f,Xt as g,Ft as h,nr as i,je as j,le as k,Tt as l,de as m,nt as n,Ut as o,wt as p,Qt as q,Rt as r,Dt as s,bt as t,St as u,qt as v,Wt as w,sr as x,Kt as y,rr as z};
//# sourceMappingURL=dywhugbdhvsxyyf5.js.map
