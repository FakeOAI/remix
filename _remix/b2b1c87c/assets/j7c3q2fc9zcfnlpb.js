import{a1 as Ce,l,b5 as qe,a3 as F,r as M,R as He,m as Fe,cH as vn,cI as hn,cJ as Cn,d_ as Tn,a6 as yn,dL as xn,u as En}from"./d4leej2qw3qpt1pk.js";import{dO as wn,gy as In,gL as Ln,A as Ke,gM as Mn,gN as V,gO as Ve,gP as Dn,gQ as en,eL as An,N as Nn,gR as Rn,gS as kn,gT as _n,bi as bn,bC as Sn,gU as On,gV as jn,gW as Pn,gX as Un,gY as I,gZ as qn,fY as Hn,dh as Fn,g_ as zn,g$ as Bn,h0 as Gn,aD as ze,h1 as fe,h2 as me,h3 as Jn,h4 as $n,as as P,h5 as Yn,h6 as Wn,h7 as Xn,gm as Qn,h8 as Zn,eN as Kn,eO as Vn,h9 as et,ha as Be,hb as Ge,hc as Je,hd as nt,he as tt}from"./fz81i3fl330y5ew1.js";import{y as st,C as B,b as ot,z as rt,B as at,H as it,I as lt,J as ut}from"./nfvveyk9d6ahnf1o.js";import{c as ct}from"./kp4k2v7si1wz6dgb.js";import{m as G}from"./f2il2wfcdnz6iwbp.js";import{c as ft}from"./fi1eifnoy9tspxqm.js";import{bH as mt,N as dt}from"./okxdn8hddblnp0ou.js";import{q as gt,r as pt,T as vt,o as ht,a as Ct}from"./hyhugnup8jw7vymu.js";import{L as Tt,d as yt,e as xt,f as Et}from"./blb377wa0lv0gl05.js";import{P as wt}from"./ftyo1ydzzolwv3v6.js";import{J as It,a as Lt}from"./dywhugbdhvsxyyf5.js";import{u as Mt}from"./i0atr71q351gx0hb.js";function Dt({onClickRestore:n,onClickResetLatest:e}){const t=Ce();return l.jsx(G.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{bounce:0,duration:.24},className:"absolute bottom-0 left-0 z-30 w-full items-center border-t border-gray-100 bg-token-main-surface-primary p-6 shadow-[0_-4px_32px_rgba(0,0,0,0.08)] @container dark:border-token-border-xlight dark:shadow-[0_-4px_32px_rgba(0,0,0,0.12)] lg:border-l",children:l.jsxs("div",{className:"mx-auto flex max-w-[48rem] flex-col flex-wrap justify-center gap-5 @2xl:flex-row @2xl:justify-between",children:[l.jsxs("div",{className:"flex flex-col px-2 text-center @2xl:text-start",children:[l.jsx("span",{className:"text-md text-wrap font-semibold",children:t.formatMessage({id:"gt23pb",defaultMessage:"You are viewing a previous version"})}),l.jsx("span",{className:"text-wrap text-sm text-token-text-secondary",children:t.formatMessage({id:"sAlUJn",defaultMessage:"Restore this version to make edits"})})]}),l.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4",children:[l.jsx(qe,{as:"button",color:"primary",onClick:n,children:t.formatMessage({id:"+cddAb",defaultMessage:"Restore this version"})}),l.jsx(qe,{as:"button",color:"secondary",onClick:e,children:t.formatMessage({id:"qCD3eu",defaultMessage:"Back to latest version"})})]})]})})}const At={type:"spring",damping:35,stiffness:300},Nt=({clientThreadId:n,turn:e})=>{const t=wn(),s=In(e.messages);return l.jsxs(G.div,{className:"absolute left-0 right-0 top-0 z-10 -translate-y-full",children:[l.jsx(G.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-vert-light-gradient dark:bg-vert-dark-gradient"}),l.jsx(G.div,{className:"flex items-center px-6 py-2",initial:{opacity:.75,translateX:-50,translateY:"100%"},animate:{opacity:1,translateX:0,translateY:"0"},exit:{opacity:0,translateY:20},transition:At,children:l.jsx(st,{clientThreadId:n,onChangeItemInView:F,onRequestCompletion:async r=>F(r),onRequestMoreCompletions:F,groupedMessagesToRender:s,allGroupedMessages:s,isEditing:!1,isUserTurn:!0,turnIndex:0,isCompletionRequestInProgress:!1,isFeedbackEnabled:!1,isFinalTurn:!1,hasActiveRequest:t,showEditButton:!1,handleEnterEdit:F,handleExitEdit:F})})]},"user-message")},Rt=({clientThreadId:n})=>{const e=gt(n),t=pt(n,e),{lastUserTurn:s,lastAssistantTurn:r}=M.useMemo(()=>{let a=null,i=null;for(let c=t.length-1;c>0;c--){const u=t[c];if(!a&&u.role===He.User?a=u:!i&&u.role===He.Assistant&&(i=u),a&&i)break}return{lastUserTurn:a,lastAssistantTurn:i}},[t]),o=s&&!(r!=null&&r.messages.find(({message:a})=>{var i;return(i=a.recipient)==null?void 0:i.startsWith(Ln)}));return l.jsx(Ke,{initial:!1,children:o&&l.jsx(Nt,{turn:s,clientThreadId:n})})},kt=({isRequestActive:n=!1,clientThreadId:e,onCancel:t,onSubmit:s,onSubmitAccelerator:r,acceleratorActions:o=[]})=>{const[a,i]=M.useState(""),[c,u]=M.useState(!0),f=Ce(),d=()=>{s==null||s(a),i("")},C=h=>{const{metaKey:p,shiftKey:T,key:L}=h;L==="Enter"&&a.trim()&&!(T||p)&&(d(),h.preventDefault())};return l.jsxs("div",{className:"relative mb-3 flex max-w-2xl flex-1 justify-center",children:[l.jsx(Rt,{clientThreadId:e}),l.jsx("div",{className:"flex flex-auto items-start",children:l.jsx("div",{className:Fe("mx-6 flex min-h-12 flex-auto items-center bg-[#f4f4f4] py-1 pl-6 pr-2 dark:bg-token-main-surface-secondary",{"rounded-full":c,"rounded-2xl":!c}),children:l.jsxs("div",{className:"relative flex flex-auto items-center self-stretch",children:[l.jsx(Mn,{placeholder:f.formatMessage({id:"zrUbTJ",defaultMessage:"Ask ChatGPT to edit"}),disabled:n,value:a,className:"w-full resize-none border-0 bg-transparent p-0 text-token-text-primary outline-0 placeholder:text-token-text-secondary focus:ring-0 focus-visible:ring-0",maxRows:4,onChange:({target:{value:h}})=>i(h),onKeyDown:C,onHeightChange:(h,{rowHeight:p})=>u(Math.floor(h/p)<=1)}),a?l.jsx(G.button,{className:Fe("dark h-8 w-8 rounded-full bg-token-main-surface-primary text-center dark:bg-token-main-surface-primary",{"self-end":!c}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:()=>d(),children:l.jsx(mt,{className:"h-8 w-8 text-token-text-primary"})}):((o==null?void 0:o.length)??0)>0&&l.jsx(ft,{disableHint:!0,isEmbeddedInPromptArea:!0,isRequestActive:n,actions:o,onCancel:t,onSubmit:r,right:0,bottom:4})]})})})]})};function A(){}A.prototype={diff:function(e,t){var s,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=r.callback;typeof r=="function"&&(o=r,r={});var a=this;function i(v){return v=a.postProcess(v,r),o?(setTimeout(function(){o(v)},0),!0):v}e=this.castInput(e,r),t=this.castInput(t,r),e=this.removeEmpty(this.tokenize(e,r)),t=this.removeEmpty(this.tokenize(t,r));var c=t.length,u=e.length,f=1,d=c+u;r.maxEditLength!=null&&(d=Math.min(d,r.maxEditLength));var C=(s=r.timeout)!==null&&s!==void 0?s:1/0,h=Date.now()+C,p=[{oldPos:-1,lastComponent:void 0}],T=this.extractCommon(p[0],t,e,0,r);if(p[0].oldPos+1>=u&&T+1>=c)return i($e(a,p[0].lastComponent,t,e,a.useLongestToken));var L=-1/0,k=1/0;function N(){for(var v=Math.max(L,-f);v<=Math.min(k,f);v+=2){var x=void 0,E=p[v-1],_=p[v+1];E&&(p[v-1]=void 0);var H=!1;if(_){var b=_.oldPos-v;H=_&&0<=b&&b<c}var $=E&&E.oldPos+1<u;if(!H&&!$){p[v]=void 0;continue}if(!$||H&&E.oldPos<_.oldPos?x=a.addToPath(_,!0,!1,0,r):x=a.addToPath(E,!1,!0,1,r),T=a.extractCommon(x,t,e,v,r),x.oldPos+1>=u&&T+1>=c)return i($e(a,x.lastComponent,t,e,a.useLongestToken));p[v]=x,x.oldPos+1>=u&&(k=Math.min(k,v-1)),T+1>=c&&(L=Math.max(L,v+1))}f++}if(o)(function v(){setTimeout(function(){if(f>d||Date.now()>h)return o();N()||v()},0)})();else for(;f<=d&&Date.now()<=h;){var y=N();if(y)return y}},addToPath:function(e,t,s,r,o){var a=e.lastComponent;return a&&!o.oneChangePerToken&&a.added===t&&a.removed===s?{oldPos:e.oldPos+r,lastComponent:{count:a.count+1,added:t,removed:s,previousComponent:a.previousComponent}}:{oldPos:e.oldPos+r,lastComponent:{count:1,added:t,removed:s,previousComponent:a}}},extractCommon:function(e,t,s,r,o){for(var a=t.length,i=s.length,c=e.oldPos,u=c-r,f=0;u+1<a&&c+1<i&&this.equals(s[c+1],t[u+1],o);)u++,c++,f++,o.oneChangePerToken&&(e.lastComponent={count:1,previousComponent:e.lastComponent,added:!1,removed:!1});return f&&!o.oneChangePerToken&&(e.lastComponent={count:f,previousComponent:e.lastComponent,added:!1,removed:!1}),e.oldPos=c,u},equals:function(e,t,s){return s.comparator?s.comparator(e,t):e===t||s.ignoreCase&&e.toLowerCase()===t.toLowerCase()},removeEmpty:function(e){for(var t=[],s=0;s<e.length;s++)e[s]&&t.push(e[s]);return t},castInput:function(e){return e},tokenize:function(e){return Array.from(e)},join:function(e){return e.join("")},postProcess:function(e){return e}};function $e(n,e,t,s,r){for(var o=[],a;e;)o.push(e),a=e.previousComponent,delete e.previousComponent,e=a;o.reverse();for(var i=0,c=o.length,u=0,f=0;i<c;i++){var d=o[i];if(d.removed)d.value=n.join(s.slice(f,f+d.count)),f+=d.count;else{if(!d.added&&r){var C=t.slice(u,u+d.count);C=C.map(function(h,p){var T=s[f+p];return T.length>h.length?T:h}),d.value=n.join(C)}else d.value=n.join(t.slice(u,u+d.count));u+=d.count,d.added||(f+=d.count)}}return o}function Ye(n,e){var t;for(t=0;t<n.length&&t<e.length;t++)if(n[t]!=e[t])return n.slice(0,t);return n.slice(0,t)}function We(n,e){var t;if(!n||!e||n[n.length-1]!=e[e.length-1])return"";for(t=0;t<n.length&&t<e.length;t++)if(n[n.length-(t+1)]!=e[e.length-(t+1)])return n.slice(-t);return n.slice(-t)}function de(n,e,t){if(n.slice(0,e.length)!=e)throw Error("string ".concat(JSON.stringify(n)," doesn't start with prefix ").concat(JSON.stringify(e),"; this is a bug"));return t+n.slice(e.length)}function ge(n,e,t){if(!e)return n+t;if(n.slice(-e.length)!=e)throw Error("string ".concat(JSON.stringify(n)," doesn't end with suffix ").concat(JSON.stringify(e),"; this is a bug"));return n.slice(0,-e.length)+t}function z(n,e){return de(n,e,"")}function K(n,e){return ge(n,e,"")}function Xe(n,e){return e.slice(0,_t(n,e))}function _t(n,e){var t=0;n.length>e.length&&(t=n.length-e.length);var s=e.length;n.length<e.length&&(s=n.length);var r=Array(s),o=0;r[0]=0;for(var a=1;a<s;a++){for(e[a]==e[o]?r[a]=r[o]:r[a]=o;o>0&&e[a]!=e[o];)o=r[o];e[a]==e[o]&&o++}o=0;for(var i=t;i<n.length;i++){for(;o>0&&n[i]!=e[o];)o=r[o];n[i]==e[o]&&o++}return o}var ne="a-zA-Z0-9_\\u{C0}-\\u{FF}\\u{D8}-\\u{F6}\\u{F8}-\\u{2C6}\\u{2C8}-\\u{2D7}\\u{2DE}-\\u{2FF}\\u{1E00}-\\u{1EFF}",bt=new RegExp("[".concat(ne,"]+|\\s+|[^").concat(ne,"]"),"ug"),te=new A;te.equals=function(n,e,t){return t.ignoreCase&&(n=n.toLowerCase(),e=e.toLowerCase()),n.trim()===e.trim()};te.tokenize=function(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t;if(e.intlSegmenter){if(e.intlSegmenter.resolvedOptions().granularity!="word")throw new Error('The segmenter passed must have a granularity of "word"');t=Array.from(e.intlSegmenter.segment(n),function(o){return o.segment})}else t=n.match(bt)||[];var s=[],r=null;return t.forEach(function(o){/\s/.test(o)?r==null?s.push(o):s.push(s.pop()+o):/\s/.test(r)?s[s.length-1]==r?s.push(s.pop()+o):s.push(r+o):s.push(o),r=o}),s};te.join=function(n){return n.map(function(e,t){return t==0?e:e.replace(/^\s+/,"")}).join("")};te.postProcess=function(n,e){if(!n||e.oneChangePerToken)return n;var t=null,s=null,r=null;return n.forEach(function(o){o.added?s=o:o.removed?r=o:((s||r)&&Qe(t,r,s,o),t=o,s=null,r=null)}),(s||r)&&Qe(t,r,s,null),n};function Qe(n,e,t,s){if(e&&t){var r=e.value.match(/^\s*/)[0],o=e.value.match(/\s*$/)[0],a=t.value.match(/^\s*/)[0],i=t.value.match(/\s*$/)[0];if(n){var c=Ye(r,a);n.value=ge(n.value,a,c),e.value=z(e.value,c),t.value=z(t.value,c)}if(s){var u=We(o,i);s.value=de(s.value,i,u),e.value=K(e.value,u),t.value=K(t.value,u)}}else if(t)n&&(t.value=t.value.replace(/^\s*/,"")),s&&(s.value=s.value.replace(/^\s*/,""));else if(n&&s){var f=s.value.match(/^\s*/)[0],d=e.value.match(/^\s*/)[0],C=e.value.match(/\s*$/)[0],h=Ye(f,d);e.value=z(e.value,h);var p=We(z(f,h),C);e.value=K(e.value,p),s.value=de(s.value,f,p),n.value=ge(n.value,f,f.slice(0,f.length-p.length))}else if(s){var T=s.value.match(/^\s*/)[0],L=e.value.match(/\s*$/)[0],k=Xe(L,T);e.value=K(e.value,k)}else if(n){var N=n.value.match(/\s*$/)[0],y=e.value.match(/^\s*/)[0],v=Xe(N,y);e.value=z(e.value,v)}}var St=new A;St.tokenize=function(n){var e=new RegExp("(\\r?\\n)|[".concat(ne,"]+|[^\\S\\n\\r]+|[^").concat(ne,"]"),"ug");return n.match(e)||[]};var se=new A;se.tokenize=function(n,e){e.stripTrailingCr&&(n=n.replace(/\r\n/g,`
`));var t=[],s=n.split(/(\n|\r\n)/);s[s.length-1]||s.pop();for(var r=0;r<s.length;r++){var o=s[r];r%2&&!e.newlineIsToken?t[t.length-1]+=o:t.push(o)}return t};se.equals=function(n,e,t){return t.ignoreWhitespace?((!t.newlineIsToken||!n.includes(`
`))&&(n=n.trim()),(!t.newlineIsToken||!e.includes(`
`))&&(e=e.trim())):t.ignoreNewlineAtEof&&!t.newlineIsToken&&(n.endsWith(`
`)&&(n=n.slice(0,-1)),e.endsWith(`
`)&&(e=e.slice(0,-1))),A.prototype.equals.call(this,n,e,t)};function Ot(n,e,t){return se.diff(n,e,t)}var jt=new A;jt.tokenize=function(n){return n.split(/(\S.+?[.!?])(?=\s+|$)/)};var Pt=new A;Pt.tokenize=function(n){return n.split(/([{}:;,]|\s+)/)};function pe(n){"@babel/helpers - typeof";return pe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pe(n)}var J=new A;J.useLongestToken=!0;J.tokenize=se.tokenize;J.castInput=function(n,e){var t=e.undefinedReplacement,s=e.stringifyReplacer,r=s===void 0?function(o,a){return typeof a>"u"?t:a}:s;return typeof n=="string"?n:JSON.stringify(ve(n,null,null,r),r,"  ")};J.equals=function(n,e,t){return A.prototype.equals.call(J,n.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"),t)};function ve(n,e,t,s,r){e=e||[],t=t||[],s&&(n=s(r,n));var o;for(o=0;o<e.length;o+=1)if(e[o]===n)return t[o];var a;if(Object.prototype.toString.call(n)==="[object Array]"){for(e.push(n),a=new Array(n.length),t.push(a),o=0;o<n.length;o+=1)a[o]=ve(n[o],e,t,s,r);return e.pop(),t.pop(),a}if(n&&n.toJSON&&(n=n.toJSON()),pe(n)==="object"&&n!==null){e.push(n),a={},t.push(a);var i=[],c;for(c in n)Object.prototype.hasOwnProperty.call(n,c)&&i.push(c);for(i.sort(),o=0;o<i.length;o+=1)c=i[o],a[c]=ve(n[c],e,t,s,c);e.pop(),t.pop()}else a=n;return a}var he=new A;he.tokenize=function(n){return n.slice()};he.join=he.removeEmpty=function(n){return n};var ee=(n=>(n.ADDED="added",n.REMOVED="removed",n.UNCHANGED="unchanged",n))(ee||{});function Te(n){if(n==="")return 0;const e=n.split(`
`).length;return n.endsWith(`
`)?e-1:e}function Ut(n,e){return Ot(n,e,{newlineIsToken:!0}).map(s=>({count:s.count??Te(s.value),value:s.value,type:s.added?"added":s.removed?"removed":"unchanged"}))}function qt(n){let e="";for(const{type:t,value:s}of n)(t==="added"||t==="unchanged")&&(e+=s);return e}function Ht(n,e){const t=Te(e),s=Bt(n,t);return{changes:Ut(s,e),numLinesDiffed:t}}function Ft(n){const e=[...n],t=[],s=[];for(;e.length>0;){const r=e[e.length-1];if(r.type===ee.REMOVED)e.pop(),r.type===ee.REMOVED&&t.unshift(r);else if(r.type===ee.ADDED)e.pop(),s.unshift(r);else break}return{prunedChanges:[...e,...s],prunedRemovedChanges:t}}function zt(n,e){const{changes:t,numLinesDiffed:s}=Ht(n,e),{prunedChanges:r,prunedRemovedChanges:o}=Ft(t),a=qt(r),i=o.map(u=>u.value).join(`
`),c=nn(n,s,"start");return{content:a+i+c,numLinesDiffed:Te(a)}}function Bt(n,e){if(e<=0)return"";let t=0,s=n.length;for(let r=0;r<n.length;r++)if(n[r]===`
`&&(t++,t===e)){s=r+1;break}return n.substring(0,s)}function nn(n,e,t="start"){if(e<=0)return n;if(t==="start"){let a=0;for(let i=0;i<n.length;i++)if(n[i]===`
`&&(a++,a===e))return n.substring(i+1);return""}let s=0,r=-1;const o=n.endsWith(`
`)?e+1:e;for(let a=n.length-1;a>=0;a--)if(n[a]===`
`&&(s++,s===o)){r=a;break}return r===-1?"":n.substring(0,r+1)}function Gt(n,e){const t=(n==null?void 0:n.type)??V.LOADING,s=(n==null?void 0:n.content)??"",r=!!(n!=null&&n.isPartial);if(!Ve(t)||e==null||!r||(n==null?void 0:n.isRewriting)!==!0)return{content:s,currentlyStreamingLineIndex:null};const o=nn(s,1,"end");if(o==="")return{content:e.content,currentlyStreamingLineIndex:0};const a=zt(e.content,o);return{content:a.content,currentlyStreamingLineIndex:a.numLinesDiffed}}const Jt=800,$t=100,Ze=100,Yt=({textdocId:n,isHistoricalVersion:e,nextHistoricalTextdocVersion:t,textdocVersion:s,updatedReadonlyReason:r,history:o,hasDebug:a,contentWidth:i,isEmbedded:c,isPersisting:u,isShowChangesFeatureEnabled:f,isShowingChanges:d,hideHistoryActions:C=!1,prefetchHistoricalTextdocVersion:h,restoreHistoricalTextdocVersion:p,setShowDebugView:T,onClose:L})=>{const k=Dn((s==null?void 0:s.title)??""),[{width:N},y]=en(),v=i-N-$t-Ze>0;return l.jsxs(B.Header,{children:[l.jsxs("div",{className:"flex flex-1 items-center leading-[0]",children:[l.jsx(B.CloseButton,{onClick:L}),v&&l.jsx("div",{className:"flex flex-row items-center gap-2.5",children:l.jsx(B.Title,{style:{maxWidth:i-N-Ze},children:k||l.jsx("div",{className:"w-52",children:l.jsx(wt,{lines:1,size:"base",width:100,widthVariance:0})})})}),u&&l.jsx(An,{size:12,className:"pl-2 text-token-text-secondary"})]}),l.jsxs("div",{className:"flex items-center gap-2 leading-[0]",ref:y,children:[a&&i>Jt&&l.jsx(Nn,{icon:dt,onClick:()=>T(x=>!x)}),!d&&!C&&l.jsx(Rn,{textdocId:n,isHistorical:e,version:s==null?void 0:s.versionInt,nextVersion:t==null?void 0:t.versionInt,readonlyReason:r,onHoverPrevious:h,onClickRestore:p,textdocType:s==null?void 0:s.type}),!C&&f&&l.jsx(kn,{textdocId:n,history:o,version:s,isShowingChanges:d}),l.jsx(_n,{textdocVersion:s}),!c&&!d&&l.jsx(Tt,{})]})]})};function Wt(n){const e=It(),t=ot(n),s=Lt(n)??e.id,r=rt({clientThreadId:n});return async function(o){const a=new bn,i=vt.getThreadCurrentLeafId(n),c=performance.now(),u=await vn(),[f,d,C]=await Promise.all([hn.getEnforcementToken(u),Sn.getEnforcementToken(u),Cn.getEnforcementToken(u)]);r({model:s,completionType:Tn.Next,parentNodeId:i,metadata:{eventSource:"mouse"},completionMetadata:{conversationMode:t},chatReq:u,arkoseToken:f??null,turnstileToken:d??null,proofToken:C??null,preflightTime:performance.now()-c,appendMessages:o,turnTracker:a})}}function Xt(n){switch(n){case I.ACCELERATOR:case I.ACCEPT_COMMENT:return!0;case I.ASK_CHATGPT:case I.FULL_SCREEN_SUBMIT:return!1}}function Qt(n,e){switch(e){case I.ASK_CHATGPT:case I.ACCEPT_COMMENT:case I.FULL_SCREEN_SUBMIT:return n.formatMessage(Kt.askChatGPT);case I.ACCELERATOR:return}}const Zt=(n,e)=>{const t=Wt(n),s=Ce();return M.useCallback(({content:r,sourceRange:o,action:a,userMessageType:i,acceleratorMetadata:c,selectionMetadata:u})=>{if(!e)return;const{textdocId:f,type:d,versionInt:C,content:h}=e;let p,T=null;o&&(p=h.slice(o.start,o.end),T=On(o,h)),t([jn([r],{canvas:{textdoc_id:f,textdoc_type:d,version:C,textdoc_content_length:h.length,user_message_type:i,accelerator_metadata:c,selection_metadata:u},is_visually_hidden_from_conversation:Xt(i),targeted_reply:p,targeted_reply_label:Qt(s,i),open_in_canvas_view:{type:"canvas_textdoc",id:f}}),Pn([Un(f,d,a,p,T)],{exclude_after_next_user_message:!0})])},[t,s,e])},Kt=yn({askChatGPT:{id:"h5ANdM",defaultMessage:"Asked ChatGPT"}}),ms=({isFullScreen:n=!1,isEmbedded:e=!1,hideHeader:t=!1,readonlyReason:s,clientThreadId:r,focusedTextdoc:o,onClose:a,isAnimating:i=!1,width:c})=>{var Pe,Ue;const{textdocId:u,history:f,showChangesAtVersion:d}=o,[C,h,p]=qn(u),{targetedContent:T}=Hn(),L=yt(),[k,N]=M.useState(!1),y=xt(u),v=Et(),x=ht(r),E=Fn(x),[_,H]=en(),b=zn(),{data:$}=Bn(u,b?d:void 0),{textdocEdits:ye,previousContent:xe}=$??{},R=(y==null?void 0:y.versions)??[],tn=(Pe=R[0])==null?void 0:Pe.versionInt,{historicalTextdocVersion:Ee,nextHistoricalTextdocVersion:sn,prefetchHistoricalTextdocVersion:on}=Gn(u,tn,f);M.useEffect(()=>{ze.reset()},[u]),M.useEffect(()=>{var g;(g=y==null?void 0:y.metadata)!=null&&g.textdocId&&fe().sendMessage({type:me.Loaded})},[(Ue=y==null?void 0:y.metadata)==null?void 0:Ue.textdocId]);const we=R.length>0?R[R.length-1]:null,O=R.length>1?R[R.length-2]:null,Ie=Ct(r),{restoreHistoricalTextdocVersion:Le,optimisticRestoredTextdocVersion:rn}=Jn(Ie,we,Ee),U=f!=null,m=U?Ee:we,Y=Zt(r,m),W=M.useMemo(()=>i?[]:(m==null?void 0:m.comments.filter(g=>g.status!==$n.DISMISSED))??[],[i,m]),Me=M.useMemo(()=>i||!b?[]:ye??[],[i,b,ye]),oe=(m==null?void 0:m.type)??V.LOADING,j=!!(m!=null&&m.isPartial);M.useEffect(()=>{R.length===0&&!v&&(a==null||a())},[R.length,a,v]);const an=!!s&&s!==P.OldVersion,re=b&&d!=null&&Me.length>0,ae=j&&!!(m!=null&&m.isRewriting),ln=j&&!!(m!=null&&m.isCreation),{content:X,currentlyStreamingLineIndex:De}=xe!=null?{content:xe,currentlyStreamingLineIndex:null}:Gt(m,O),un=Mt(Ie,Array.from(Yn(X))),[Q,ie]=Wn({value:X,isRequestActive:E,isTextdocStreaming:j,comments:W}),Ae=Xn(m),Ne=j||E||Q||p;M.useEffect(()=>{fe().sendMessage({type:me.Streaming,streaming:Ne})},[Ne]);const cn=({getSerializedDocument:g,getAdjustedComments:D})=>{m&&C(m,g,D)},fn=g=>{if(!m)return;const D=g.doc.toString();C(m,D,g.field(ct,!1)??[])},Re=(g,D,S,q)=>{ie(!0),Y({action:D,content:g,userMessageType:I.ASK_CHATGPT,sourceRange:S,selectionMetadata:{selection_type:q,selection_position_range:S}})},ke=({id:g})=>{Ae(g,Be.DISMISS),ze.reset()},_e=async g=>{ie(!0);const{id:D,at:S,content:q}=g;if(await Ae(D,Be.ACCEPT)===!1)return ie(!1);Y({content:q,userMessageType:I.ACCEPT_COMMENT,sourceRange:S,action:Ge.EDIT,selectionMetadata:{selection_type:Je.SELECTION,selection_position_range:S}})},le=(g,D,S)=>{const{action:q}=S;Y({action:q,content:D,sourceRange:g,userMessageType:I.ACCELERATOR,acceleratorMetadata:{action:q,id:S.id,prompt:D},selectionMetadata:g!=null?{selection_type:Je.SELECTION,selection_position_range:g}:void 0})},mn=g=>{Y({action:Ge.EDIT,content:g,userMessageType:I.FULL_SCREEN_SUBMIT})},dn=xn(),gn=En(),pn=Qn(({resolveTempCommentId:g})=>g),be=g=>pn[g]||g,ue=()=>lt({clientThreadId:r,currentRequestId:x,queryClient:gn,isHistoryAndTrainingDisabled:dn});let w=s;U?w=P.OldVersion:re?w=P.ShowingChanges:rn!=null?w=P.Restoring:(j||E)&&(w=P.Streaming);let Z=null;const Se=i||w!=null||Q,Oe=i&&W.length>0||U||w!=null&&w!==P.Streaming,je=n||i;let ce=[];switch(oe){case V.LOADING:Z=l.jsx(ut,{});break;case V.DOCUMENT:Z=l.jsx(it,{value:X,comments:W,previousValue:O==null?void 0:O.content,previousComments:O==null?void 0:O.comments,isRewriting:ae,getStableCommentId:be,edits:Me,isRequestActive:E,isDisabled:w!=null||v,isWaitingForCommentResponse:Q,hideAccelerators:je,hideToolbar:Se,hideEditOverlay:i,hideComments:Oe,readonlyReason:w,canvasContentRect:_,onBlur:h,onSave:h,onChange:cn,onCancelRequest:ue,targetedContent:T,onAddComment:Re,onAcceptComment:_e,onDismissComment:ke,onSubmitAccelerator:le,safeUrls:un,width:c,modelCursor:j&&!ae?m==null?void 0:m.modelCursor:void 0,shouldResetSelection:(m==null?void 0:m.versionInt)===1}),ce=tt;break;default:Ve(oe)&&(Z=l.jsx(at,{id:"codemirror",getStableCommentId:be,language:Zn(oe),value:X,comments:W,hideAccelerators:je,hideComments:Oe,hideToolbar:Se,onSubmitAccelerator:le,currentlyStreamingLineIndex:De??null,readonlyReason:w,isRequestActive:E,isWaitingForCommentResponse:Q,onChange:fn,onCancelRequest:ue,onAddComment:Re,onDismissComment:ke,onAcceptComment:_e,modelCursor:j&&De==null?m==null?void 0:m.modelCursor:void 0}),ce=nt)}return l.jsxs(B,{children:[!t&&l.jsx(Yt,{textdocId:u,isHistoricalVersion:U,nextHistoricalTextdocVersion:sn,textdocVersion:m,updatedReadonlyReason:w,history:f,hasDebug:L,contentWidth:_.width,isEmbedded:e,isPersisting:p,isShowChangesFeatureEnabled:b,isShowingChanges:re,hideHistoryActions:w===P.QueryParam,prefetchHistoricalTextdocVersion:on,restoreHistoricalTextdocVersion:Le,setShowDebugView:N,onClose:()=>{const g=fe();g.isNative&&g.sendMessage({type:me.Close}),Kn.logButtonClick(Vn.CLOSE_TEXTDOC,{textdocType:m==null?void 0:m.type}),a==null||a()}}),l.jsxs(B.Content,{ref:H,scrollToBottomMode:ln?"bottom":"top",shouldScrollToTop:ae,children:[!1,Z]}),l.jsx(Ke,{children:!re&&U&&!an&&l.jsx(Dt,{onClickRestore:Le,onClickResetLatest:()=>et(u)})}),n&&!U&&l.jsx("div",{className:"relative flex items-center justify-center pb-3",children:l.jsx(kt,{isRequestActive:E,clientThreadId:r,onSubmitAccelerator:le,onSubmit:mn,onCancel:ue,acceleratorActions:ce})})]})};export{ms as T};
//# sourceMappingURL=j7c3q2fc9zcfnlpb.js.map
