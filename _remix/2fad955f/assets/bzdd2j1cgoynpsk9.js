const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/dqrn0417ditrat7w.js","assets/orw3ylzo1pm5yat5.js","assets/fx9bt06582fbthzh.js","assets/root-jo2ifv11.css","assets/dxebepq3id20w15z.js","assets/conversation-small-o3h1ik6j.css","assets/lss4wb9bh914zjsw.js","assets/o5orcnsvw6erjj60.js","assets/fzrn137102spawew.js","assets/e9lafxuzyeh4418f.js","assets/b2bk4kuankch3yug.js","assets/myddz1bi17ca7ijd.js","assets/lh4vtpp21ntaxjhl.js","assets/bw4ctp8abcsg3zop.js","assets/mzkxlhrlmxhntkvn.js","assets/ehs0s6hg3yhu4gmc.js","assets/lw0nxvfsub8bf9ml.js","assets/ehn61jby4isgvyt5.js","assets/bsl38p3kh125dox0.js","assets/c4bxzbp1808foto4.js","assets/0ti1rubp7qr756yo.js","assets/di1lxahr5ylfawf3.js","assets/c4cb45z74gff2p0u.js","assets/hqywcvuljgbsi726.js","assets/kybzozngy46m6xfv.js","assets/l7dkwa6mtvyu3o7c.js","assets/ky7siiuco8pnrpwv.js","assets/d6a0bnfjzkpzl5w1.js","assets/dtkf52uf577kfoiz.js","assets/cgg1e390sr851bjv.js","assets/k3ld11xi664pibru.js","assets/d2xc7mdqjw8fr3fq.js"])))=>i.map(i=>d[i]);
import{z as Ue,R as $,v as oe,C as te,O as Fe,aD as Oe,D as Ge,dN as Zs,bI as Be,bJ as De,bK as We,a3 as ms,ao as He,ap as qe,an as fs,r as d,j as e,J as K,K as ae,m as gs,ca as V,aR as ps,u as hs,bA as $e,aC as f,aG as pe,I as le,d7 as et,ar as xs,W as ue,ak as re,fU as st,Z as ye,dP as vs,aX as Q,bw as Ve,cd as js,aI as ke,P as ys,d as bs,aL as Ms,aq as ws,bN as tt,fn as ks,aO as Te,cb as he,d5 as at,M as nt,V as it,at as es,as as ss,ft as rt,cw as ot,cx as lt,E as ct,X as dt,eM as ut}from"./orw3ylzo1pm5yat5.js";import{ku as ie,p as I,c2 as mt,c1 as Ts,kv as Ps,c6 as Ss,jb as Ke,dn as ft,bp as gt,kw as pt,c as Qe,kx as Cs,gK as Is,ky as Ns,U as de,ge as D,Y as _s,cB as je,cC as Gs,fj as Ye,f2 as ht,eW as xt,c$ as vt,dq as Ae,be as _,f4 as xe,f0 as ve,eY as Xe,e as As,kz as jt,I as Ls,fD as yt,kA as bt,en as ee,eX as Mt,cP as Rs,gb as zs,kB as wt,b_ as kt,gc as Es,gd as Us,gf as Tt,kC as Pt,bJ as St,gg as Ct,bZ as Le,gh as It,kD as Nt,kE as ts,kF as Pe,kG as _t,dw as as,ei as Fs,eS as Gt,eT as At,eU as Lt,ej as Rt,aa as zt,cY as Et,kH as ns,c5 as Ut,fG as Ft,kI as Ot,kJ as Bt,dl as Dt,eo as Wt,kK as Ht,bS as qt,eK as $t,h3 as is,kL as Vt,kM as Kt,ba as Qt,kN as Yt,kO as Xt,d as Jt,kP as rs,kQ as Zt,ep as ea,di as sa}from"./dxebepq3id20w15z.js";import{i as ta,c as be,C as se,M as Os,A as ce,G as aa,a as na,b as os,s as ia,r as Re,S as ra,d as oa,g as la,e as ca,f as da}from"./ehn61jby4isgvyt5.js";import{T as Bs,C as ua,W as ma}from"./c4cb45z74gff2p0u.js";import{i as ze}from"./k3ld11xi664pibru.js";import{ag as Ds,af as fa,L as ga,b2 as Ws,aw as pa,aP as ha,D as xa,aO as va,bc as ja,w as ya,x as ba,s as Ma,bB as wa,b as ka,c as Ta,aI as Pa,bD as Sa}from"./fx9bt06582fbthzh.js";import{G as Ca}from"./d2xc7mdqjw8fr3fq.js";import{F as Y,a as X,b as Se,c as Ia,G as Na,d as _a}from"./lw0nxvfsub8bf9ml.js";import{m as Hs}from"./ky7siiuco8pnrpwv.js";import{G as Ga}from"./d6a0bnfjzkpzl5w1.js";function Aa(s,t){const a=I.getThreadCurrentLeafId(s),o=I.getTree(s),i=[];let r=o.getNodeByIdOrMessageId(a);for(;r!=null&&(t==null||r.id!==t);)i.unshift(r.message),r=r.parentId!==""?o.getNodeByIdOrMessageId(r.parentId):void 0;return i}function La(s){return s.filter(o=>o.recipient==="gizmo_editor.update_behavior").flatMap(o=>o.content.content_type==="text"?o.content.parts:o.content.content_type==="code"?[o.content.text]:[]).map(o=>JSON.parse(o)).reduce((o,i)=>({...o,...i}),{})}async function Ra(s){let t;for(const a of s)if(a.author.name==="gizmo_editor.generate_profile_pic"){const o=ft.getImageAssetPointers(a);o.length>0&&(t=o.at(-1))}if(t!=null){const a=gt(t.asset_pointer),o=await Fe.getFileDownloadLink(a);if(o.status===Oe.Success)return{id:a,permalink:o.download_url}}}async function za(s,t,a,o){const i=Aa(t,o),r=La(i);let n=await Ra(i);if(ze(r)&&n==null)return;const{name:m,context:l,description:p,profile_pic_file_id:v,prompt_starters:x}=r;if(v!=null)try{const u=await Fe.getFileDownloadLink(v,s.id);u.status===Oe.Success&&(n={id:v,permalink:u.download_url})}catch(u){Ge.addError(new Error("Error while retrieving profile pic in update",{cause:u})),a.warning("Something went wrong updating your GPT's profile picture.",{duration:3})}const c={name:typeof m=="string"?m:void 0,description:typeof p=="string"?p:void 0,instructions:typeof l=="string"?l:void 0,promptStarters:Array.isArray(x)?x:void 0,profilePictureId:n?.id,profilePictureUrl:n?.permalink};return Zs(c,u=>u!=null)}function Ea(s){const t=new Set;for(const l of s.tools)t.add(l.type);const a=s.name??"",o=s.description??"",i=s.instructions??"",r=Array.from(t).join(","),n=a===""&&o===""&&i==="",m=s.profilePictureUrl!=null;return n?`The GPT you are about to has the following abilities: ${r}.`:`This is the GPT's current set of fields:

name: ${a}

description: ${o}

context: ${i}

abilities: ${r}

${m?"The GPT has a profile picture.":"This GPT does not have a profile picture. You must generate a profile picture when you next update your behavior."}
`}function qs(s,t,a,o){const i=a.current,r=o.current;if(Ue(i,r))return;const n={};i.name!==r?.name&&(n.name=i.name),(i.description??"")!==(r?.description??"")&&(n.description=i.description??""),i.instructions!==(r?.instructions??"")&&(n.context=i.instructions??"");const m=new Set(r?.files?.map(c=>c.file_id)??[]),l=new Set(i.files?.map(c=>c.file_id)??[]),p=(i.files??[]).filter(c=>!m.has(c.file_id)),v=(r?.files??[]).filter(c=>!l.has(c.file_id));if(ze(n)&&p.length===0&&v.length===0)return;const x=[];if(!ze(n)){const c=`Explicitly update the GPT's behavior to the following exact fields:

    ${JSON.stringify(n,null,2)}

    "Do not call update_behavior yet. Instead, use these updated fields as the GPT's current behavior, and in the next call to update_behavior, incorporate these changes."
    `;x.push(ie.getTextAsMessage(c,$.System))}v.length>0&&x.push(ie.getTextAsMessage(`The user has removed the following files from the GPT. You can no longer reference these files: ${v.map(c=>c.file_id).join(", ")}`,$.System)),p.length>0&&x.push(ie.getTextAsMessage(`The user is adding these files to the GPT. The GPT may reference these files. The file IDs are: ${p.map(c=>c.file_id).join(", ")}`,$.System,{attachments:p.map(c=>({id:c.file_id,name:c.name,size:c.size}))})),x.length>0&&I.updateTree(s,c=>{let u=c.getNodeByIdOrMessageId(t).parentId;for(const y of x){const g=oe();c.insertNodeBefore(t,{id:g,children:[],parentId:u,message:y,metadata:{isClientCreatedSystemMessage:!0}}),u=g}})}function Ua(s,t,a){if(a.length===0)return;const o=oe(),i=`The user is uploading files in their next message. If you need to reference these in calls to update_behavior, you will use the following File ID(s), in order: ${a.map(r=>`"${r.fileId}"`).join(", ")}`;I.updateTree(s,r=>{const n=r.getNodeByIdOrMessageId(t).parentId;r.insertNodeBefore(t,{id:o,children:[],parentId:n,message:ie.getTextAsMessage(i,$.System),metadata:{isClientCreatedSystemMessage:!0}})})}function Fa(s,t){const a="Remember, you should be calling either update_behavior or generate_profile_pic after most messages from the user. Your personality should be neutral and separate from the GPT you are creating.",o=I.getThreadCurrentLeafId(s),i=I.getTree(s);let r=i.getNodeByIdOrMessageId(o);for(;r!=null&&r.message.author.role!==$.User;){if(r.message.content.content_type==="text"&&r.message.content.parts[0]===a)return;r=r.parentId!==""?i.getNodeByIdOrMessageId(r.parentId):void 0}I.updateTree(s,n=>{const m=n.getNodeByIdOrMessageId(t).parentId;n.insertNodeBefore(t,{id:oe(),children:[],parentId:m,message:ie.getTextAsMessage(a,$.System,{exclude_after_next_user_message:!0}),metadata:{isClientCreatedSystemMessage:!0}})})}function Oa(s,t,a){I.initThread(s,{kind:te.GizmoMagicCreate,gizmo_id:void 0,behavior_overrides:a});const i=mt().id,r=Ts(s)??i,n=Ps({clientThreadId:s,onCompletionFinished:t});return async(l,p,v)=>{if(v.length===0)return;const x=new Ss;let c=I.getThreadCurrentLeafId(s);for(const T of v){const G=oe();I.updateTree(s,j=>{j.addNodeToEnd(c,{id:G,children:[],parentId:c,message:ie.getTextAsMessage(T,$.System),metadata:{isClientCreatedSystemMessage:!0}})}),I.setThreadCurrentLeafId(s,G),c=G}const u=c;qs(s,u,l,p);const y={conversationMode:{kind:te.GizmoMagicCreate,gizmo_id:l.current.id,behavior_overrides:a}},g=await Be(),[w,k,P]=await Promise.all([De.getEnforcementToken(g),Ke.getEnforcementToken(g),We.getEnforcementToken(g)]);n({model:r,completionType:ms.Next,parentNodeId:u,metadata:{},focusOnNewCompletion:!0,chatReq:g,arkoseToken:w,turnstileToken:k,proofToken:P,preflightTime:0,completionMetadata:y,turnTracker:x})}}const Ba="Generate a new profile picture for this GPT using gizmo_editor generate_profile_pic. Do not prompt the user for any clarification. Do not send extra text outside of the tool function call. DO NOT CALL update_behavior or otherwise update GPT behavior in your response.",Da=He(()=>qe(()=>import("./dqrn0417ditrat7w.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])).then(s=>s.DebugConversationSidebar));function Wa(s,t){d.useEffect(()=>{const a=I.getTree(s);if(a.findNode(n=>n.message.author.role===$.User||n.metadata?.isClientCreatedSystemMessage===!0)||(I.deleteNodesByFilter(s,n=>n.metadata?.isPlaceholderTemplateAssistantWelcomeMessage===!0),t==null||t.length===0))return;const i=I.getThreadCurrentLeafId(s);if(!a.hasNodeOrMessageId(i))return;const r=oe();I.updateTree(s,n=>{n.addNode(r,t,i,$.Assistant,{isPlaceholderTemplateAssistantWelcomeMessage:!0})}),I.setThreadCurrentLeafId(s,r)},[s,t])}function Ha(s,t,a){_s(s,{kind:te.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:a}),d.useEffect(()=>{I.updateConversationMode(s,{kind:te.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:a})},[s,t.id,a]);const[o]=d.useState(()=>{const i=t.id==null,r=t.id!=null&&t.name!==""&&t.description!=null&&t.instructions!==""&&t.profilePictureUrl!=null;return i?`Hi! I'll help you build a new GPT. You can say something like, "make a creative who helps generate visuals for new products" or "make a software engineer who helps format my code."

What would you like to make?`:r?`Welcome back! Is there anything ${t.name} should be doing better? Anything you'd like to change?`:"You're back! Let's continue where we left off..."});Wa(s,o)}function qa({gizmoEditorData:s,updateGizmo:t,clientThreadId:a,completionCallbackResponse:o,gizmoEditorDataRef:i,magicMakerBehaviorOverrides:r,magicMakerConversationGizmoEditorDataRef:n,requireGizmoId:m}){const l=d.useMemo(()=>({gizmoEditorData:s,gizmoId:s.id,mode:"magic",behaviorOverrides:r,getGizmoId:m}),[m,s,r]),p=pt(c=>c.files.filter(u=>u.status===D.Ready&&u.gizmoId!=null)),v=d.useCallback((c,u)=>{Ua(c,u,p),qs(c,u,i,n),Fa(c,u),t(y=>({...y,files:[...y.files??[],...Qe(p.map(g=>g.fileId!=null&&{file_id:g.fileId,name:g.file.name,size:g.file.size,type:g.file.type,last_modified:g.file.lastModified,file_size_tokens:g.fileSpec?.fileTokenSize}))]})),n.current=Cs(i.current)},[i,n,p,t]),x=Is(c=>c.activeSidebar);return e.jsx(Ns.Provider,{value:l,children:e.jsxs("div",{className:"relative flex h-full grow overflow-auto",children:[e.jsx("div",{className:"grow",children:e.jsx(Bs,{clientThreadId:a,onCompletionFinished:o,preRequestCompletion:v,hideHeader:!0,prependThreadChildren:e.jsx("div",{className:"h-8"})})}),x==="debug"&&e.jsx(Da,{clientThreadId:a,slideOver:!1,onClose:()=>de.toggleActiveSidebar("debug"),isOpen:!0})]})})}const $a=fs.memo(qa);function Va({gizmo:s,updateGizmo:t,publishedGizmo:a,promoteGizmo:o,appealGizmo:i,setAppealState:r,showActionsModal:n,shareOnly:m,onClose:l}){const[p,v]=d.useState({type:"privacy"});return p.type==="privacy"?e.jsx(Qa,{gizmo:s,updateGizmo:t,publishedGizmo:a,promoteGizmo:o,appealGizmo:i,setAppealState:r,setStep:v,showActionsModal:n,shareOnly:m,onClose:l}):e.jsx(Ya,{publishedGizmo:p.publishedGizmo,onClose:l})}function Ka(s){return s?_.Workspace:_.Link}function Qa({gizmo:s,publishedGizmo:t,updateGizmo:a,promoteGizmo:o,appealGizmo:i,setAppealState:r,setStep:n,showActionsModal:m,shareOnly:l,onClose:p}){const[v,x]=d.useState(!1),c=je(Gs.isBusinessWorkspace),u=K(),y=ae(),[g,w]=d.useState(Ye(s)?Ka(!!c):s.sharingRecipient),k=gs(),P=ta(g,s.sharingTargets),{data:T,isLoading:G}=ht(),j=xt(),[h,C]=d.useState(t!=null&&t.gizmo.display.categories.length>0?j.data?.categories.find(b=>b.id===t.gizmo.display.categories[0])?.id:void 0);d.useEffect(()=>{C(t?.gizmo.display.categories[0])},[t?.gizmo.display.categories]);const[A,O]=d.useState(void 0),N=d.useRef(vt((b,R)=>Ae.generateCategory(b,R),1e3)),U=T?.is_verified?void 0:u.formatMessage({id:"qEQtmt",defaultMessage:"To publish your GPTs to the Explore GPTs page, set up your builder profile."});g===_.Marketplace&&U!=null&&!G&&w(_.Link);const W=c&&!s.sharingTargets?.some(b=>b.recipient===_.Link),H=be(s,g,h),L=H.includes(se.MissingPublicActionPrivacyPolicyURL),F=s.tools.find(b=>b.type===V.JIT_PLUGIN&&!b.metadata.privacy_policy_url),me=je(b=>b.currentWorkspace),Me=ps();d.useEffect(()=>{let b=!0;return(async()=>{try{if(h!=null)return;const R=await N.current(s.name,s.instructions);b&&h==null&&(R?C(R.id):O(!0))}catch{b&&h==null&&O(!0)}})(),()=>{b=!1}},[s.instructions,s.name,Me,h]);const{value:B}=hs("4226692983");return e.jsx($e,{type:"success",isOpen:!0,onClose:p,title:e.jsx(f,{id:"9viumf",defaultMessage:"Share GPT"}),showCloseButton:!0,primaryButton:P?e.jsx(pe,{color:"primary",disabled:H.length>0,loading:v,onClick:async()=>{try{if(x(!0),l){if(!t?.gizmo.id){y.danger(u.formatMessage({id:"QYVEx8",defaultMessage:"Error sharing GPT"}));return}const b=await Ae.shareGizmo(t.gizmo.id,h?{sharing:xe(g,[],ve),categories:[h]}:{sharing:xe(g,[],ve)});b.error?(y.warning(u.formatMessage({id:"tmIKmp",defaultMessage:"Unable to share GPT"})),a({sharingTargets:b.sharing_targets}),r({gizmoId:t.gizmo.id,sharingRecipient:g,categories:t.gizmo.display.categories,moderationType:Os.PublishBlocked,sharingTargets:b.sharing_targets,showModal:ce.AppealAvailable})):(k.setQueryData(["gizmo",{gizmoId:t.gizmo.id},{draft:!1}],R=>b.resource),a(R=>({...R,sharingRecipient:g})),y.success(u.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),p())}else{const b=await o({recipient:g,subjects:xe(g,[],ve)},h);b?(n({type:"published",publishedGizmo:b}),a(R=>({...R,id:b.gizmo.id,sharingRecipient:g})),b.gizmo.live_version!=null&&a({liveVersion:b.gizmo.live_version}),y.success(u.formatMessage({id:"R5zko1",defaultMessage:"GPT published"}),{testId:"gpt-published-toast"})):(y.warning(u.formatMessage({id:"uf7WYw",defaultMessage:"Unable to publish GPT"})),p())}}finally{x(!1)}},"data-testid":"save-gizmo-button",children:e.jsx(f,{id:"SW4DG4",defaultMessage:"Save"})}):B?e.jsx(e.Fragment,{children:e.jsx(pe,{color:"primary",onClick:async()=>{await i(g,h)},children:e.jsx(f,{id:"bBmLUr",defaultMessage:"Appeal"})})}):null,secondaryButton:t?e.jsx(pe,{color:"secondary",onClick:b=>Xe(t,y,b,u.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:e.jsx(f,{id:"wvL15a",defaultMessage:"Copy link"})}):null,children:e.jsxs("div",{className:"mx-[-16px] flex flex-col gap-3 text-sm",children:[e.jsx("div",{className:"space-y-1.5",children:e.jsxs(As,{value:g,onValueChange:b=>w(b),children:[s.sharingTargets&&s.sharingTargets.map((b,R)=>e.jsx(Ce,{value:b.recipient,disabled:b.recipient===_.Marketplace&&U!=null,tooltipText:b.recipient===_.Marketplace?U??u.formatMessage({id:"0Rcb4e",defaultMessage:"Your GPT will appear in the Explore GPTs page"}):void 0,shareLevel:b.recipient},R)),W&&e.jsxs(e.Fragment,{children:[e.jsx(Ce,{value:_.Link,disabled:!0,tooltipText:u.formatMessage(ls.workspaceDisabledHint),shareLevel:_.Link,workspaceName:me?.name}),e.jsx(Ce,{value:_.Link,disabled:!0,tooltipText:u.formatMessage(ls.workspaceDisabledHint),shareLevel:_.Marketplace,workspaceName:me?.name})]})]})}),L&&e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(f,{id:"/iw1Iv",defaultMessage:"Public actions require valid privacy policy URLs. Click <fixlink>here</fixlink> to update.",values:{fixlink:b=>e.jsx("button",{onClick:()=>{m(F?.metadata.action_id)},className:"underline",children:b})}})}),g!==_.Private&&e.jsx(aa,{gizmo:s,category:h,categories:g===_.Marketplace?j.data?.categories??[]:void 0,onCategoryChange:g===_.Marketplace?b=>C(b.id):void 0}),g===_.Marketplace&&(A?e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(f,{id:"tpC3ui",defaultMessage:"There was an error updating the list of categories"})}):null),!P&&B&&e.jsx("div",{className:"flex items-center justify-between text-sm text-token-text-secondary",children:e.jsx(f,{id:"jLCMMV",defaultMessage:"Because this GPT previously may have violated our policies, you will have to submit an appeal to make it available at this level."})})]})})}function Ya({publishedGizmo:s,onClose:t}){const a=jt(s),o=K(),i=ae();return e.jsx($e,{type:"success",isOpen:!0,onClose:t,title:e.jsx(f,{id:"rCRRmx",defaultMessage:"Settings Saved"}),showCloseButton:!0,primaryButton:e.jsx(pe,{color:"primary",as:"link",to:a,children:e.jsx(f,{id:"lyZz44",defaultMessage:"View GPT"})}),children:e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex gap-1 rounded bg-token-main-surface-secondary px-2 py-1",children:[e.jsx("div",{className:"line-clamp-1 text-ellipsis break-all",children:a}),e.jsx("button",{onClick:r=>{Xe(s,i,r,o.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"}))},className:"text-token-text-secondary transition hover:text-token-text-primary","data-testid":"copy-saved-gpt-url-button",children:e.jsx(Ds,{className:"icon-sm"})})]})})})}const ls=le({workspaceDisabledHint:{id:"gizmo.workspaceDisabledHint",defaultMessage:"Your workspace administrator has disabled this setting"}});function Ce({shareLevel:s,workspaceName:t,value:a,disabled:o=!1,tooltipText:i}){const r=d.useId();return e.jsx(et,{disabled:i==null,label:i,side:"top",children:e.jsxs(Ls,{id:r,value:a,disabled:o,className:"flex h-14 w-full cursor-pointer flex-row items-center justify-between gap-2 rounded-md px-3 py-4 font-semibold hover:bg-token-main-surface-secondary",children:[e.jsx("label",{htmlFor:r,className:"flex cursor-pointer items-center gap-1",children:e.jsx(na,{shareLevel:s,workspaceName:t??"",hasInviteSharing:!1})}),e.jsx(yt,{children:e.jsx(fa,{className:"icon-lg mr-1"})})]})})}function $s(s){window.history.length>1?s(-1):s(bt())}function Xa({gizmo:s,publishedGizmo:t,isLoading:a,isUploadingProfilePic:o,isGeneratingProfilePic:i,updateGizmo:r,promoteGizmo:n,appealGizmo:m,setAppealState:l,showActionsModal:p}){const v=ye(),x=s!=null?be(s):[];(s==null||a)&&x.push(se.Loading),o&&x.push(se.UploadingProfilePic),i&&x.push(se.GeneratingProfilePic);const c=Ye(s),[u,y]=d.useState(!1),[g,w]=d.useState(!1),k=s.sharingRecipient?os[s.sharingRecipient]:os.private;return e.jsxs(e.Fragment,{children:[c?e.jsx(ee,{color:"primary",onClick:()=>y("promote"),loading:a,disabled:s.id===void 0||x.length>0,tooltip:x.length>0?x.map(Re).join(`
`):void 0,testId:"gizmo-editor-create-gpt-button",children:e.jsx(f,{id:"svUGIb",defaultMessage:"Create"})}):e.jsxs(e.Fragment,{children:[e.jsxs(ee,{color:"secondary",loading:a||!t,onClick:()=>y("share"),children:[e.jsx(k,{className:"icon-sm shrink-0"}),e.jsx(f,{id:"aXKW4G",defaultMessage:"Share"})]}),e.jsx(ee,{color:"primary",onClick:async()=>{let P=s.sharing.subjects.map(ia);const T=Mt(s.sharing.subjects);P=xe(s.sharing.recipient,P,T?.capabilities??ve),await n({recipient:s.sharing.recipient,subjects:P},t?.gizmo.display.categories[0])&&w(!0)},loading:a||!t,disabled:x.length>0,tooltip:x.length>0?x.map(Re).join(`
`):void 0,children:e.jsx(f,{id:"84QVoj",defaultMessage:"Update"})})]}),u&&(v?.getWorkspaceId()==null?e.jsx(Va,{gizmo:s,publishedGizmo:t,promoteGizmo:n,appealGizmo:m,setAppealState:l,showActionsModal:p,updateGizmo:r,shareOnly:u==="share",onClose:()=>y(!1)}):e.jsx(ra,{gizmo:s,publishedGizmo:t,promoteGizmo:n,appealGizmo:m,setAppealState:l,showActionsModal:p,updateGizmo:r,onClose:()=>y(!1),shareOnly:u==="share"})),g&&e.jsx(oa,{publishedGizmo:t,sharing:t.gizmo.sharing,onClose:()=>w(!1),workspaceName:v?.data.name??""})]})}function Ja({gizmoEditorData:s,publishedGizmo:t,revertDraft:a}){const o=K(),i=ae(),r=ue(),[n,m]=d.useState(!1),l=ps(),{value:p}=hs("3645668434");return!l?.includes("debug")&&s?.id==null?null:e.jsxs(e.Fragment,{children:[e.jsxs(vs,{side:"top",contentAlign:"end",sideOffset:8,triggerButton:e.jsx(ee,{color:"ghost",icon:ga}),children:[t!=null&&e.jsxs(Q.Item,{onClick:v=>{Xe(t,i,v)},children:[e.jsx(Ws,{className:"icon-sm"}),e.jsx(f,{...J.copyLink})]}),a!=null&&e.jsxs(Q.Item,{onClick:()=>{window.confirm(o.formatMessage(J.revertConfirm))&&a()},children:[e.jsx(pa,{className:"icon-sm"}),e.jsx(f,{id:"W2blnV",defaultMessage:"Revert..."})]}),s?.id!=null&&p&&s.liveVersion>0&&e.jsxs(e.Fragment,{children:[e.jsxs(Q.Item,{onClick:()=>{r(`/g/${s.id}/view`)},children:[e.jsx(ha,{className:"icon-sm"}),e.jsx(f,{id:"gizmo.versionHistory",defaultMessage:"Version History"})]}),e.jsxs(Q.Item,{onClick:async()=>{const v=await Ae.copyGizmo({gizmoId:s.id});v.gizmo.id&&r(`/gpts/editor/${v.gizmo.id}`)},children:[e.jsx(Ds,{className:"icon-sm"}),e.jsx(f,{id:"GizmoInformation.copyGizmoLabel",defaultMessage:"Duplicate GPT"})]})]}),s?.id!=null&&e.jsxs(Q.Item,{color:"danger",onClick:()=>{m(!0)},children:[e.jsx(xa,{className:"icon-sm"}),e.jsx(f,{id:"tNrOLG",defaultMessage:"Delete GPT"})]}),l?.includes("debug")&&e.jsxs(e.Fragment,{children:[e.jsx(Q.Separator,{}),e.jsxs(Q.Item,{onClick:()=>{de.toggleActiveSidebar("debug")},children:[e.jsx(va,{className:"icon-sm"}),"Debug (Internal only)"]})]})]}),n&&e.jsx(Ca,{gizmoId:s.id,onSuccess:()=>$s(r),onClose:()=>{m(!1)}})]})}const ge=xs.div`flex items-center gap-1`;function Za({gizmoEditorData:s}){const t=je(a=>a.currentWorkspace?.name);switch(s.sharingRecipient){case _.Private:return e.jsxs(ge,{children:[e.jsx(ba,{className:"icon-xs"}),e.jsx(f,{...J.onlyMe})]});case _.Link:return e.jsxs(ge,{children:[e.jsx(Ws,{className:"icon-xs"}),e.jsx(f,{...J.anyoneWithLink})]});case _.Workspace:return e.jsxs(ge,{children:[e.jsx(ya,{className:"icon-xs"}),t]});case _.Marketplace:return e.jsxs(ge,{children:[e.jsx(ja,{className:"icon-xs"}),e.jsx(f,{...J.public})]});default:return e.jsx("div",{})}}function en({gizmoEditorData:s}){return e.jsxs("div",{className:"flex items-center gap-2",children:[s.profilePictureUrl!=null?e.jsx(Rs,{isFirstParty:!1,src:s.profilePictureUrl,className:"h-8 w-8"}):e.jsx("div",{className:"h-8 w-8 rounded-full border-2 border-dashed border-token-border-medium"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:s.name||e.jsx(f,{...J.newGPT})}),e.jsx("div",{className:"text-xs text-token-text-secondary",children:Ye(s)?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-token-text-tertiary"}),e.jsx(f,{...J.draft})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-brand-green"}),s.sharingRecipient===_.Marketplace?e.jsx(f,{...J.published}):e.jsx(f,{id:"gizmoEditorHeader.live",defaultMessage:"Live"})," · ",e.jsx(Za,{gizmoEditorData:s})]})})]})]})}function sn({gizmoEditorData:s,isLoading:t,isUploadingProfilePic:a,isGeneratingProfilePic:o,publishedGizmo:i,updateGizmo:r,promoteGizmo:n,appealGizmo:m,setAppealState:l,revertDraft:p,draftMessage:v,className:x,hasUnpublishedChanges:c,showActionsModal:u}){const y=ue();return e.jsxs("div",{className:re("relative flex h-14 w-full items-center justify-between gap-2 border-b border-token-border-medium px-3",x),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{className:"cursor-pointer text-token-text-primary",onClick:()=>$s(y),children:e.jsx(st,{className:"icon-lg"})}),e.jsx(en,{gizmoEditorData:s})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[v,e.jsx(Ja,{gizmoEditorData:s,publishedGizmo:i,revertDraft:p}),e.jsx(Xa,{gizmo:s,publishedGizmo:i,isLoading:t,isUploadingProfilePic:a,isGeneratingProfilePic:o,updateGizmo:r,promoteGizmo:n,appealGizmo:m,setAppealState:l,hasUnpublishedChanges:c,showActionsModal:u})]})]})}const J=le({onlyMe:{id:"gizmo.onlyMe",defaultMessage:"Only me"},anyoneWithLink:{id:"gizmo.anyoneWithLink",defaultMessage:"Anyone with a link"},public:{id:"gizmo.public",defaultMessage:"Everyone"},newGPT:{id:"gizmo.newGPT",defaultMessage:"New GPT"},draft:{id:"gizmo.draft",defaultMessage:"Draft"},published:{id:"gizmo.published",defaultMessage:"Published"},revertConfirm:{id:"gizmo.revertConfirm",defaultMessage:"Are you sure you want to revert to the last saved version?"},copyLink:{id:"gizmo.copyLink",defaultMessage:"Copy link"}}),tn=512;function an(){return e.jsx("div",{className:"relative flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-token-border-medium",children:e.jsx(Ve,{className:"h-1/4 w-1/4"})})}function nn({gizmoEditorData:s,onFileChange:t,generateProfilePic:a,isGeneratingProfilePic:o,setIsGeneratingProfilePic:i}){const r=K(),n=ae(),[m,l]=d.useState(void 0),p=d.useRef(t);d.useEffect(()=>{p.current=t});async function v(u){if(u.length>0){i(!1);const y=await Ct(u[0],tn),g=Le(y);l({tempId:g,file:y,status:D.Uploading,progress:1,fileId:null,cdnUrl:null}),p.current("uploading"),It(g,y,r,n,js.ProfilePicture,{onFileCreated(w,k,P){l(T=>T!=="initial"&&T?.tempId===w&&T.status===D.Uploading?{...T,progress:10,fileId:k,cdnUrl:P}:T)},onFileUploadProgress(w,k){l(P=>P!=="initial"&&P?.tempId===w&&P.status===D.Uploading?{...P,progress:k}:P)},onFileUploaded(w,k,P){l(T=>T!=="initial"&&T?.tempId===w?(p.current(T),{...T,status:D.Ready,progress:100,fileSpec:{name:T.file.name,id:T.fileId,size:T.file.size,...P??{}}}):T)},onError(w){l(k=>{if(k!=="initial"&&k?.tempId===w){p.current(void 0);return}return k})}})}}const{open:x,getInputProps:c}=zs({disabled:!1,noClick:!0,onDropAccepted:v,onDropRejected:u=>wt(u,r,n,kt.ProfilePicture),multiple:!0,maxSize:Es,...Us(Tt)});return e.jsxs("div",{className:"flex w-full items-center justify-center gap-4",children:[e.jsxs(vs,{sideOffset:8,triggerButton:e.jsx("button",{className:"h-20 w-20",children:o?e.jsx(an,{}):m!=null&&m!="initial"&&m.status!=D.Ready?e.jsxs("div",{className:"relative h-full w-full overflow-hidden rounded-full",children:[e.jsx(Pt,{file:m.file}),m.status===D.Uploading&&m.progress<90?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:e.jsx(St,{percentage:m.progress,className:"h-6 w-6"})}):null]}):s?.profilePictureUrl!=null&&s?.profilePictureUrl!==""?e.jsx(Rs,{isFirstParty:!1,src:s.profilePictureUrl}):e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-token-border-medium",children:e.jsx(Ma,{className:"text-4xl"})})}),children:[e.jsx(Q.Item,{onClick:x,children:e.jsx(f,{id:"ERQwXg",defaultMessage:"Upload Photo"})}),e.jsx(Q.Item,{onClick:a,children:e.jsx(f,{id:"NXAog/",defaultMessage:"Use DALL·E"})})]}),e.jsx("input",{...c()})]})}function rn({gizmoEditorData:s,requireGizmoId:t,currentModelConfig:a,updateGizmo:o}){const i=K(),r=ae(),[n,m]=d.useState(0),l=d.useRef(new Map),p=Nt(a,void 0),v=async h=>{ys.logEvent(bs.uploadFile,{client:"web",eventSource:"mouse",intent:"gizmo"});const C=await t();h.length>0&&await Promise.all(h.map(A=>{const O=Le(A);l.current.set(O,{tempId:O,gizmoId:C,file:A,status:D.Uploading,progress:1,fileId:null,cdnUrl:null}),_t(Le(A),A,i,r,{kind:js.Gizmo,gizmoId:C},{onFileUploaded:(N,U,W,H)=>{const L=l.current.get(N);L==null||L.fileId==null||(o(F=>({...F,files:[...F.files??[],{file_id:L.fileId,name:L.file.name,size:L.file.size,type:L.file.type,last_modified:L.file.lastModified,file_size_tokens:H?.fileTokenSize}]})),l.current.delete(N),m(F=>F+1))},onFileCreated:(N,U,W)=>{l.current.set(N,{tempId:N,gizmoId:C,file:A,status:D.Uploading,progress:1,...l.current.get(N),fileId:U,cdnUrl:W}),m(H=>H+1)},onFileUploadProgress:(N,U)=>{const W=l.current.get(N);W?.status===D.Uploading&&l.current.set(N,{...W,progress:U}),m(H=>H+1)},onError:N=>{l.current.delete(N)}},{usesRetrievalIndex:a!=null&&Pe(a,A.type,A.name)===ke.Retrieval})}))},{getInputProps:x,open:c}=zs({disabled:!1,noClick:!0,onDropAccepted:v,multiple:!0,maxSize:Es,maxFiles:10,...Us(p)}),u=s?.files??[];function y(h){return e.jsx(as,{onRemoveFileClick:()=>{l.current.delete(h.tempId),m(C=>C+1)},file:h.file,loadingPercentage:h.status===D.Uploading?h.progress:void 0},h.tempId)}function g(h){return e.jsx(as,{file:h.name,fileId:h.file_id,onRemoveFileClick:()=>o(C=>({...C,files:C?.files?.filter(A=>A.file_id!==h.file_id)})),gizmoId:s?.id},h.file_id)}const w=Array.from(l.current.values()).filter(h=>u.every(C=>C.file_id!==h.fileId)),[k,P]=ts(w,h=>a!=null&&Pe(a,h.file.type,h.file.name)===ke.CodeInterpreter),[T,G]=ts(u,h=>a!=null&&h.type!=null&&Pe(a,h.type,h.name)===ke.CodeInterpreter),j=d.useRef(T.length);return d.useEffect(()=>{T.length>j.current&&o(h=>h.tools?.some(C=>C.type===V.PYTHON)?h:{...h,tools:[...h.tools??[],{type:V.PYTHON}]}),j.current=T.length},[T.length]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"rounded-lg text-token-text-tertiary",children:e.jsx(f,{...on.knowledgeWarning})}),P.length>0||G.length>0?e.jsxs("div",{className:"flex flex-wrap gap-2",children:[P.map(y),G.map(g)]}):null,k.length>0||T.length>0?e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs text-token-text-tertiary",children:e.jsx(f,{id:"i/QurZ",defaultMessage:"The following files are only available for Code Interpreter:"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[k.map(y),T.map(g)]})]}):null,e.jsx("div",{children:e.jsxs(ee,{onClick:c,children:[e.jsx("input",{...x()}),e.jsx(f,{id:"sr8Qp/",defaultMessage:"Upload files"})]})})]})}const on=le({knowledgeWarning:{id:"gizmo.knowledgeWarning",defaultMessage:"If you upload files under Knowledge, conversations with your GPT may include file contents. Files can be downloaded when Code Interpreter is enabled"}});function ln({placeholder:s,text:t,onChange:a,onClose:o}){return e.jsx($e,{className:"!max-h-[100vh] !max-w-[80vw]",type:"success",isOpen:!0,onClose:o,primaryButton:e.jsx(ee,{onClick:o,children:e.jsx(f,{id:"FeFVdS",defaultMessage:"Close"})}),children:e.jsx("textarea",{className:"h-[70vh] w-full resize-none rounded-lg bg-token-main-surface-primary dark:border-gray-700",value:t,onChange:i=>{a(i.target.value)},placeholder:s})})}const Ie=xs.div`text-sm text-red-500`;function cn({children:s,collapsed:t,initial:a}){return e.jsx(zt,{initial:a,children:!t&&e.jsx(Hs.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:s})})}function dn({gizmo:s,onShowActionsEditor:t,isDisabled:a}){const o=K(),i=ae(),r=e.jsxs("div",{className:"space-y-1",children:[s?.tools?.map((n,m)=>n.type!==V.JIT_PLUGIN?null:e.jsxs("div",{children:[e.jsx(_a,{isDisabled:a,actionTool:n,onShowActionsEditor:()=>t(n.metadata.domain)}),n.metadata.auth?.type==="oauth"&&e.jsx(Et,{label:o.formatMessage(E.callbackUrlLabel),value:`https://chat.openai.com/aip/${n.metadata.action_id}/oauth/callback`,onCopied:()=>{i.success("Copied to clipboard",{duration:3})}})]},m)),(s?.tools?.filter(n=>n.type===V.JIT_PLUGIN)??[]).length>=ns?e.jsx("div",{children:o.formatMessage(E.maxActionsReached,{number:ns})}):e.jsx(ee,{disabled:a,onClick:()=>{t("Unknown domain")},className:"mt-2",children:e.jsx(f,{...E.createActionLabel})})]});return a?e.jsx(ws,{side:"top",label:o.formatMessage(E.disabledCustomActionsTooltip),children:r}):r}function un(s){return(s.files?.length??0)>0||s?.tools?.some(t=>t.type===V.JIT_PLUGIN)}const mn=12;function fn({gizmoEditorData:s,updateGizmo:t,currentModelConfig:a,generateProfilePic:o,setIsUploadingProfilePic:i,isGeneratingProfilePic:r,setIsGeneratingProfilePic:n,requireGizmoId:m,onShowActionsEditor:l}){const p=s?.tools??[],[v,x]=d.useState(!1),[c,u]=d.useState(!0),y=s?.promptStarters??[],g=[...y,...y.length<mn?[""]:[]],w=be(s),P=ye()?.isWorkspaceAccount(),T=Fs(Ms.WorkspaceGPTCustomActions),G=K();return e.jsxs("div",{className:"flex h-full grow flex-col overflow-y-auto px-2 pt-6 text-sm",children:[e.jsxs("div",{className:"grow",children:[e.jsxs(Y,{children:[e.jsx(nn,{gizmoEditorData:s,generateProfilePic:o,isGeneratingProfilePic:r,setIsGeneratingProfilePic:n,onFileChange:async j=>{if(j!=null&&j!=="uploading"&&j.fileId!=null){const h=await Fe.getFileDownloadLink(j.fileId);h.status===Oe.Success&&t({profilePictureId:j.fileId!=null?j.fileId:void 0,profilePictureUrl:h.download_url})}else t({profilePictureId:void 0,profilePictureUrl:void 0});i(j==="uploading")}}),e.jsx(X,{label:e.jsx(f,{id:"M4dZms",defaultMessage:"Name"}),description:e.jsx(f,{id:"+Gkni2",defaultMessage:"The name of your GPT"})}),e.jsx(Se,{type:"text",placeholder:G.formatMessage(E.gptNamePlaceholder),value:s?.name??"",onChange:j=>{t({name:j.target.value})},onBlurCapture:()=>t(j=>({...j,name:j.name.trim()})),"data-testid":"gizmo-name-input"}),w.includes(se.GizmoNameTooLong)?e.jsx(Ie,{className:"mt-1",children:e.jsx(f,{...E.nameTooLong,values:{length:Gt}})}):null]}),e.jsxs(Y,{className:"mt-4",children:[e.jsx(X,{label:e.jsx(f,{id:"YDzNvf",defaultMessage:"Description"}),description:e.jsx(f,{id:"dpxCw8",defaultMessage:"Short description of what this GPT does"})}),e.jsx(Se,{type:"text",placeholder:G.formatMessage(E.descriptionPlaceholder),value:s?.description??"",onChange:j=>t({description:j.target.value}),onBlurCapture:()=>t(j=>({...j,description:j.description?.trim()??""})),"data-testid":"gizmo-description-input"}),w.includes(se.GizmoDescriptionTooLong)?e.jsx(Ie,{className:"mt-1",children:e.jsx(f,{...E.descriptionTooLong,values:{length:At}})}):null]}),e.jsxs(Y,{children:[e.jsx(X,{label:e.jsx(f,{id:"2SO0RJ",defaultMessage:"Instructions"}),description:G.formatMessage(E.instructionsSubtitle)}),e.jsxs("div",{className:"relative",children:[e.jsx(Ia,{className:"resize-none",rows:8,value:s?.instructions,onChange:j=>t({instructions:j.target.value}),onBlurCapture:()=>t(j=>({...j,instructions:j.instructions.trim()})),placeholder:G.formatMessage(E.instructionsSubtitle),"data-testid":"gizmo-instructions-input"}),e.jsx("button",{className:"absolute bottom-3 right-2 text-token-text-tertiary",onClick:()=>x(!0),children:e.jsx(wa,{className:"icon-sm"})})]}),w.includes(se.GizmoInstructionsTooLong)?e.jsx(Ie,{className:"mt-1",children:e.jsx(f,{...E.instructionsTooLong,values:{length:Lt}})}):null]}),e.jsxs(Y,{children:[e.jsx(X,{label:e.jsx(f,{id:"6rfYOX",defaultMessage:"Conversation starters"}),description:e.jsx(f,{id:"OSOIpd",defaultMessage:"Examples for the user to start the conversation"})}),e.jsx("div",{className:"flex flex-col gap-1",children:g.map((j,h)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(Se,{className:"rounded-r-none",value:j,type:"text",onChange:C=>{const A=C.target.value;t(O=>({...O,promptStarters:Qe(h>=(y.length??0)?[...y??[],A]:y.map((N,U)=>U===h?A===""?void 0:A:N))}))}}),e.jsx("button",{className:"flex h-9 w-9 items-center justify-center rounded-lg rounded-l-none border border-l-0 border-token-border-medium",onClick:()=>t(C=>({...C,promptStarters:y.filter((A,O)=>O!==h)})),children:e.jsx(ka,{className:"icon-sm"})})]},h))})]}),e.jsxs(Y,{children:[e.jsx(X,{label:e.jsx(f,{id:"bwXSkU",defaultMessage:"Knowledge"}),description:G.formatMessage(E.knowledgeExplanation)}),e.jsx(rn,{gizmoEditorData:s,requireGizmoId:m,currentModelConfig:a,updateGizmo:t})]}),e.jsxs(Y,{children:[e.jsx(X,{label:e.jsx(f,{id:"mcAwDU",defaultMessage:"Capabilities"}),description:e.jsx(f,{id:"2exQT6",defaultMessage:"Functionality this GPT can use"})}),e.jsx(Na,{enabledTools:p,onEnabledToolsChange:j=>t({tools:j})})]}),e.jsxs(Y,{children:[e.jsx(X,{label:e.jsx(f,{id:"7r7v+u",defaultMessage:"Actions"}),description:e.jsx(f,{id:"fBln7I",defaultMessage:"APIs this GPT can use"})}),e.jsx(dn,{isDisabled:!!(P&&!T),gizmo:s,onShowActionsEditor:l})]}),!P&&un(s)&&e.jsxs(Y,{children:[e.jsx(X,{label:e.jsx(f,{id:"R3KeU7",defaultMessage:"Additional Settings"}),collapsed:!!c,onClick:()=>{u(j=>!j)}}),e.jsx(cn,{collapsed:c,initial:!1,children:e.jsx(Rt,{className:"mx-3 my-1",labelClassName:"w-full cursor-pointer",label:e.jsx(f,{id:"tZgwFW",defaultMessage:"Use conversation data in your GPT to improve our models"}),id:"improve-chatgpt",checked:!s.trainingDisabled,onChange:()=>{t({trainingDisabled:!s.trainingDisabled})}})})]})]}),v&&e.jsx(ln,{text:s.instructions??"",onChange:j=>{t({instructions:j})},onClose:()=>x(!1),placeholder:G.formatMessage(E.instructionsSubtitle)})]})}const E=le({nameTooLong:{id:"gizmo.nameTooLong",defaultMessage:"GPT names cannot be longer than {length} characters."},knowledgeExplanation:{id:"gizmo.knowledgeExplanation",defaultMessage:"Additional files for this GPT to reference."},descriptionTooLong:{id:"gizmo.descriptionTooLong",defaultMessage:"GPT descriptions cannot be longer than {length} characters."},instructionsTooLong:{id:"gizmo.instructionsTooLong",defaultMessage:"GPT instructions cannot be longer than {length} characters."},disabledCustomActionsTooltip:{id:"gizmo.disabledCustomActionsTooltip",defaultMessage:"Custom actions are disabled for your workspace. Contact your admin to enable them."},createActionLabel:{id:"gizmo.createActionLabel",defaultMessage:"Create new action"},maxActionsReached:{id:"gizmo.maxActionsReached",defaultMessage:"GPTs can have a maximum of {number} actions"},descriptionPlaceholder:{id:"gizmo.descriptionPlaceholder",defaultMessage:"Add a short description about what this GPT does"},instructionsSubtitle:{id:"gizmo.instructionsSubtitle",defaultMessage:"What does this GPT do? How does it behave? What should it avoid doing?"},gptNamePlaceholder:{id:"gizmo.gptNamePlaceholder",defaultMessage:"Name your GPT"},callbackUrlLabel:{id:"gizmo.callbackUrlLabel",defaultMessage:"Callback URL"}});function gn(s,t){const a=ks(s);if(!Array.isArray(s.detail))return a;const o=Qe(s.detail.map(i=>{if(i.type==="value_error.any_str.max_length")switch(i.loc[1]){case"display":{switch(i.loc[2]){case"name":return t.formatMessage(E.nameTooLong,{length:i.ctx.limit_value});case"description":return t.formatMessage(E.descriptionTooLong,{length:i.ctx.limit_value})}break}case"instructions":return t.formatMessage(E.instructionsTooLong,{length:i.ctx.limit_value})}if(typeof i.msg=="string")return i.msg}));return o.length>0?o.join(`
`):a}function pn({upsertDraftError:s}){const t=K(),a=gn(s,t);return e.jsxs("div",{className:"flex items-center gap-2 text-red-500",children:[e.jsx("div",{children:e.jsx(f,{...Vs.errorSavingDraft})}),a!=null&&e.jsx(ws,{label:a,children:e.jsx(Ta,{className:"icon-sm"})})]})}function hn({isPublished:s,isSavingDraft:t,hasUnpublishedChanges:a,upsertDraftError:o,className:i}){return o instanceof tt?e.jsx(pn,{upsertDraftError:o}):a?e.jsxs("div",{className:re("flex items-center gap-2",i),children:[e.jsx("span",{className:"text-token-text-secondary",children:s?e.jsx(f,{id:"gizmoEditor.draftUnpublished",defaultMessage:"Unpublished changes"}):e.jsx(f,{id:"gizmoEditor.draftPending",defaultMessage:"Updates pending"})}),e.jsx("div",{className:"w-4 text-token-text-tertiary",children:t&&e.jsx(Ve,{})})]}):null}const Vs=le({errorSavingDraft:{id:"gizmo.errorSavingDraft",defaultMessage:"Error saving draft"}});async function xn(){}function vn({clientThreadId:s}){const t=Ut(s),a=Ts(s),o=Ft(s,t),i=[...new Array(o).keys()].map(r=>e.jsx(ua,{isFinalTurn:r===o-1,turnIndex:r,clientThreadId:s,conversationLeafId:t,onChangeItemInView:Te,onChangeRating:Te,onRequestMoreCompletions:Te,onRequestCompletion:xn,currentModelId:a??""},r));return e.jsx(e.Fragment,{children:i})}function cs({clientThreadIds:s}){return e.jsx(e.Fragment,{children:s.map(t=>e.jsx(vn,{clientThreadId:t},t))})}const jn=He(()=>qe(()=>import("./dqrn0417ditrat7w.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])).then(s=>s.DebugConversationSidebar));function ds(){return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"border-token-border-secondary flex-grow border-b"}),e.jsxs("div",{className:"flex flex-shrink-0 items-center gap-2 px-2 py-6 text-sm text-token-text-tertiary",children:[e.jsx(Sa,{className:"icon-sm"}),e.jsx(f,{id:"qtaMEG",defaultMessage:"GPT updated"})]}),e.jsx("div",{className:"border-token-border-secondary flex-grow border-b"})]})}var yn=(s=>(s.TestGizmoAction="test_gizmo_action",s))(yn||{});const bn=new Ot;function Mn({gizmoEditorData:s,isSavingDraft:t,currentModelConfig:a,showTitle:o=!0}){const[i,r]=d.useState(()=>he()),[n,m]=d.useState([]);d.useEffect(()=>{m(k=>k[k.length-1]===i?k:[...k,i])},[i]);const l=n.slice(0,-1);_s(i,{kind:te.GizmoTest,gizmo_id:s.id}),d.useEffect(()=>{I.updateConversationMode(i,{kind:te.GizmoTest,gizmo_id:s.id})},[i,s.id]);const p=s.files?.map(k=>k.file_id).join();d.useEffect(()=>{I.getServerThreadId(i)!=null&&r(he())},[s.id,s.instructions,s.tools,p,i]);const v=Is(k=>k.activeSidebar),x=d.useMemo(()=>({gizmoEditorData:s,mode:"test"}),[s]),[c,u]=d.useState(0),y=()=>{u(k=>k-360)},g=s.id,w=wn(i,a);return d.useEffect(()=>at(bn,{test_gizmo_action:({rootDomain:k,operationName:P})=>{g&&w(g,k,P)}}),[w,g]),e.jsx(Ns.Provider,{value:x,children:e.jsxs("div",{className:re("flex h-full w-full",t&&"cursor-wait opacity-80 transition"),children:[e.jsxs("div",{className:"flex grow flex-col",children:[e.jsx("div",{className:"relative mb-2 flex-shrink-0",children:e.jsx("div",{className:"flex justify-center py-1",children:o&&e.jsxs("div",{className:"group flex items-center gap-2 text-lg font-semibold",children:[e.jsx("div",{className:"icon-md"}),e.jsxs("button",{onClick:()=>{y(),m([]),r(he())},className:"flex items-center gap-2",children:[e.jsx(f,{id:"2u/6Ja",defaultMessage:"Preview"}),e.jsx(Hs.div,{className:"text-token-text-primary",animate:{rotate:c},transition:{duration:.3},children:e.jsx(Pa,{className:"icon-md invisible group-hover:visible"})})]})]})})}),e.jsx("div",{className:re("relative grow overflow-auto px-2",t&&"pointer-events-none"),children:e.jsx(Bs,{clientThreadId:i,hideHeader:!0,renderEmptyState:e.jsxs("div",{className:"relative h-full w-full",children:[l!=null&&l.length>0&&e.jsx("div",{className:"h-full w-full opacity-20",children:e.jsxs(ma,{children:[e.jsx(cs,{clientThreadIds:l}),e.jsx(ds,{})]})}),e.jsx("div",{className:"absolute left-0 top-0 h-full w-full",children:e.jsx(Ga,{gizmo:s,hideOwner:!0,showStarterPrompts:!0})})]}),prependThreadChildren:l.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"opacity-50",children:e.jsx(cs,{clientThreadIds:l})}),e.jsx(ds,{})]})})})]}),v==="debug"&&e.jsx(jn,{clientThreadId:i,slideOver:!1,onClose:()=>de.toggleActiveSidebar("debug"),isOpen:!0})]})})}const us=fs.memo(Mn);function wn(s,t){const a=Ps({clientThreadId:s});return d.useCallback(async(i,r,n)=>{if(!t)return;const m=new Ss,l=I.getThreadCurrentLeafId(s),p=oe(),v=Bt(r);I.updateTree(s,w=>{w.addNodeToEnd(l,{id:p,children:[],parentId:l,message:{id:p,author:{role:$.User},content:{content_type:nt.Text,parts:[`Call the ${r} API with the ${n} operation`]},recipient:"all",metadata:{jit_plugin_data:{from_client:{type:"test",operation:n,tool_name:v}}}}})});const x={conversationMode:{kind:te.GizmoTest,gizmo_id:i}},c=await Be(),[u,y,g]=await Promise.all([De.getEnforcementToken(c),Ke.getEnforcementToken(c),We.getEnforcementToken(c)]);a({model:t.id,completionType:ms.Next,parentNodeId:p,metadata:{},focusOnNewCompletion:!0,chatReq:c,arkoseToken:u,turnstileToken:y,proofToken:g,preflightTime:0,completionMetadata:x,turnTracker:m})},[s,a,t])}const kn=He(()=>qe(()=>import("./bw4ctp8abcsg3zop.js"),__vite__mapDeps([13,1,2,3,4,5,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31])).then(s=>s.GizmoActionsEditor));var Ks=(s=>(s.MAGIC_MAKER="magic",s.ADVANCED="advanced",s.PREVIEW="preview",s))(Ks||{});function Ne({value:s,label:t,testId:a}){return e.jsx(Ls,{value:s,className:"text-md w-1/3 flex-grow rounded-lg border-token-border-light p-1.5 font-semibold text-token-text-tertiary transition hover:text-token-text-primary radix-state-checked:border radix-state-checked:bg-token-main-surface-primary radix-state-checked:text-token-text-primary radix-state-checked:shadow-[0_0_2px_rgba(0,0,0,.03)] md:w-1/2","data-testid":a,children:t})}function Tn({className:s,editorTab:t,setEditorTab:a}){const o=K();return e.jsxs(As,{className:re("flex w-full overflow-hidden rounded-xl bg-token-main-surface-secondary p-1.5 md:w-1/2",s),value:t,onValueChange:i=>{a(i)},children:[e.jsx(Ne,{value:"magic",label:o.formatMessage(_e.magicMakerLabel)}),e.jsx(Ne,{value:"advanced",label:o.formatMessage(_e.configureLabel),testId:"gizmo-editor-configure-button"}),e.jsx("div",{className:"flex w-1/3 md:hidden",children:e.jsx(Ne,{value:"preview",label:o.formatMessage(_e.previewLabel)})})]})}function Pn(s,t){return s.length!==t.length?!1:s.every(a=>t.some(o=>o.type===a.type))}function Sn(s,t){return s.name===t.gizmo.display.name&&s.description===t.gizmo.display.description&&s.instructions===t.gizmo.instructions&&Pn(s.tools,t.tools)&&Ue(s.files?.map(a=>a.file_id)??[],t.files?.map(a=>a.file_id)??[])&&s.profilePictureUrl==t.gizmo.display.profile_picture_url&&s.profilePictureId==t.gizmo.display.profile_pic_id}const Ee={id:void 0,instructions:"",name:"",description:"",profilePictureId:void 0,profilePictureUrl:void 0,promptStarters:[],sharing:{recipient:_.Private,subjects:[]},tools:[{type:V.DALLE}],files:[],trainingDisabled:!1,liveVersion:0,contextStuffingBudget:null},Cn={...Ee,tools:[...Ee.tools,{type:V.BROWSER}]},Qs=({gizmo:s,onNewGizmoId:t})=>{const a=gs(),o=Fs(Ms.BrowsingAvailable),i=K(),r=ae(),n=d.useRef(s!=null?is(s):o?Cn:Ee),m=d.useRef(s),l=d.useRef(n.current),[p,v]=d.useState(()=>n.current),[x,c]=d.useState(()=>he()),[u]=d.useState(()=>({context_message:Ea(n.current),model_slug:"unused",enabled_tools:[{tool_id:s!=null?"gizmo_editor":"gizmo_creator"}]}));Ha(x,l.current,u);const{data:y}=Vt(),g=y?.modelsList.find(M=>M.tags.includes(it.GPT_4))??y?.modelsList.find(M=>M.id===Kt),{data:w}=Qt(n.current.id),k=Yt(),{isPending:P,error:T}=k,G=Xt(),j=d.useMemo(()=>w!=null&&!Sn(p,w),[p,w]),h=async()=>{const M=n.current;try{const S=await k.mutateAsync({editorData:M,gizmoId:M.id});if(m.current=S,n.current.id==null){const z=S.gizmo.id;n.current={...n.current,id:z,sharingTargets:S.gizmo.sharing_targets},v(n.current),t?.(z)}for(const z of S.tools.filter(q=>q.type===V.JIT_PLUGIN)){const q=n.current.tools.find(Z=>Z.type===V.JIT_PLUGIN&&Z.metadata.domain===z.metadata.domain);q&&q.metadata.action_id!==z.metadata.action_id&&(q.metadata={...q.metadata,action_id:z.metadata.action_id},v(n.current))}return S}catch(S){const z=ks(S)??i.formatMessage(Vs.errorSavingDraft);throw r.warning(z,{duration:2}),S}},C=d.useRef(void 0),A=async()=>n.current.id!=null?n.current.id:(C.current==null&&(C.current=h().then(M=>M.gizmo.id).catch(M=>{throw C.current=void 0,M})),C.current),[O]=d.useState(()=>Jt(()=>h(),2e3,{trailing:!0}));function N(M,S=!0){const z=typeof M=="function"?M(n.current):da(n.current,M);Ue(z,n.current)||(n.current=z,v(n.current),S&&O())}const U=d.useRef(void 0),W=async M=>{if(M==null){fe(!1);return}try{const S=await za(n.current,M,r,U.current);S!=null&&(N(S),l.current=Cs(n.current))}catch(S){Ge.addError(S),r.warning("Something went wrong generating your GPT",{duration:3})}finally{U.current=I.getThreadCurrentLeafId(M),fe(!1)}},H=Oa(x,W,u),[L,F]=d.useState(void 0);d.useEffect(()=>{F(la(s))},[s?.gizmo.id]);const me=async(M,S)=>{const z=be(n.current,M.recipient,S);if(z.length>0){r.warning(`Could not save GPT:

${z.map(ne=>`- ${Re(ne)}`).join(`
`)}`,{duration:3});return}const q=await h(),Z=q.gizmo.id;try{return ys.logEvent(bs.promoteGizmo,{gizmo_id:q.gizmo.id,sharing_recipient:M.recipient,editor_tab:B}),await G.mutateAsync({gizmoId:q.gizmo.id,data:{sharingSubjects:M.subjects,sharingRecipient:M.recipient,categories:S==null?void 0:[S]}},{onSuccess(Js){a.setQueryData(rs(a,Z).queryKey,Js),a.invalidateQueries({queryKey:["gizmos"]}),a.invalidateQueries({queryKey:["gizmo",{gizmoId:Z}]}),a.invalidateQueries({queryKey:["gizmo","userActionSettings",{gizmoId:Z}]})}})}catch(ne){ne instanceof Zt?F({gizmoId:Z,sharingRecipient:M.recipient,moderationType:Os.PublishBlocked,sharingTargets:ne.response.sharing_targets,showModal:ce.AppealAvailable}):(Ge.addError(ne),r.warning("Error saving GPT",{duration:2}))}},Me=k.isPending||G.isPending,[B,b]=d.useState(()=>{const M=es.getItem(ss.GizmoEditorTab);return Object.values(Ks).includes(M)?M:"magic"}),R=rt.useState(({windowWidth:M})=>M);d.useEffect(()=>{R!=null&&R>=768&&B==="preview"&&b("magic")},[R,B]);const[Ys,Xs]=d.useState(!1),[Je,fe]=d.useState(!1),[Ze,we]=d.useState(void 0);return e.jsxs("div",{className:"flex h-screen w-full flex-col items-center",children:[e.jsx(sn,{gizmoEditorData:p,isLoading:Me,hasUnpublishedChanges:j,isUploadingProfilePic:Ys,isGeneratingProfilePic:Je,publishedGizmo:w,updateGizmo:N,promoteGizmo:async(M,S)=>{const z=await me(M,S);return n.current={...n.current,sharingRecipient:M.recipient},v(n.current),es.setItem(ss.GizmoEditorTab,B),z},appealGizmo:async(M,S)=>{L!=null&&F({...L,sharingRecipient:M,categories:S==null?void 0:[S],showModal:ce.AppealAvailable})},setAppealState:F,revertDraft:w!=null&&j?()=>{const M=a.getQueryData(rs(a,n.current.id).queryKey);if(M!=null){const S=is(M);n.current=S,v(S),h()}}:void 0,draftMessage:e.jsx(hn,{isPublished:w!=null&&(w.gizmo.share_recipient==="marketplace"||w.gizmo.share_recipient==="workspace"),hasUnpublishedChanges:j,isSavingDraft:P,upsertDraftError:T,className:"text-sm"}),showActionsModal:M=>{we(M)},className:"flex-shrink-0"}),L&&e.jsx(ca,{appealState:L,onAppealClose:()=>F({...L,showModal:ce.None}),onAppealSubmitted:()=>F({...L,showModal:ce.AppealSent})}),e.jsxs("div",{className:"relative flex w-full grow overflow-hidden",children:[e.jsx("div",{className:"flex w-full justify-center md:w-1/2",children:e.jsx("div",{className:"h-full grow overflow-hidden",children:Ze!==void 0?e.jsx(kn,{currentlyEditingActionDomain:Ze,gizmoEditorData:p,updateGizmo:N,onClose:()=>{we(void 0)}}):e.jsxs("div",{className:"flex h-full flex-col px-2 pt-2",children:[e.jsx("div",{className:"flex w-full flex-row justify-center",children:e.jsx(Tn,{editorTab:B,setEditorTab:b,className:"mb-2 flex-shrink-0 self-center"})}),e.jsx("div",{className:"grow overflow-hidden",children:B==="magic"?e.jsx("div",{className:"h-full w-full pb-5",children:e.jsx($a,{gizmoEditorData:p,updateGizmo:N,completionCallbackResponse:W,clientThreadId:x,gizmoEditorDataRef:n,magicMakerBehaviorOverrides:u,magicMakerConversationGizmoEditorDataRef:l,requireGizmoId:A},x)}):B==="advanced"?e.jsx(fn,{gizmoEditorData:p,updateGizmo:N,currentModelConfig:g,generateProfilePic:()=>{fe(!0),H(n,l,[Ba])},setIsUploadingProfilePic:Xs,isGeneratingProfilePic:Je,setIsGeneratingProfilePic:fe,requireGizmoId:A,onShowActionsEditor:M=>{we(M)}}):e.jsx(us,{gizmoEditorData:p,currentModelConfig:g,isSavingDraft:P,showTitle:!1})})]})})}),e.jsx("div",{className:re("hidden w-1/2 justify-center border-l border-token-border-medium bg-token-main-surface-secondary pt-4",B!=="preview"&&"md:flex"),children:e.jsx("div",{className:"flex-grow pb-5",children:e.jsx("div",{className:"h-full",children:e.jsx(us,{gizmoEditorData:p,currentModelConfig:g,isSavingDraft:P})})})})]})]})};function In({gizmoId:s,version:t}){const{data:a}=Ht({gizmoId:s,draft:!0,version:t}),o=je(Gs.accountUserId),r=qt()?.id,n=a!=null&&o!=null&&r!=null&&$t(a);return a==null||!n?null:e.jsx(Qs,{gizmo:a})}function Nn({onNewGizmoId:s}){return e.jsx(Qs,{onNewGizmoId:s})}const _n=({gizmoId:s,remixSourceId:t,version:a})=>{const o=ue(),i=ye(),r=d.useRef(void 0);d.useEffect(()=>(de.enterGizmoEditor(),()=>{de.exitGizmoEditor()}),[]);let n=s;return s!=null&&r.current===s&&(n=void 0),Dt({resetThreadAction:()=>{o("/")}}),i?.data?n!==void 0?e.jsx(In,{gizmoId:n,version:a},n):e.jsx(Nn,{remixSourceId:t,onNewGizmoId:m=>{r.current=m,window.history.replaceState(window.history.state,"",Wt(m))}}):e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx(Ve,{})})},_e=le({magicMakerLabel:{id:"gizmo.magicMakerLabel",defaultMessage:"Create"},configureLabel:{id:"gizmo.advancedLabel",defaultMessage:"Configure"},previewLabel:{id:"gizmo.previewLabel",defaultMessage:"Preview"}});function Gn(s){const t=ue();d.useEffect(()=>{s||t(ot(lt.NO_ACCESS))},[s,t])}const Wn=()=>(ut(),null);function Hn(){const s=ye();Gn(s==null||s.canCreateGizmos());const t=ct(),[a]=dt(),o=ue(),i=t.slug,r=a.get("version"),n=i?ea(i):void 0,m=a.get("remixFrom");return d.useEffect(()=>{Be(!0).then(l=>{De.initializeAndGatherData(l),Ke.initializeAndGatherData(l),We.initializeAndGatherData(l)})},[]),d.useEffect(()=>{s!=null&&!s.canCreateGizmos()&&o("/")},[s,o]),s?.canCreateGizmos()?e.jsx(sa,{children:e.jsx(_n,{gizmoId:n,remixSourceId:m??void 0,version:r!=null?Number(r):void 0})}):null}export{bn as G,yn as a,Hn as b,Wn as c};
//# sourceMappingURL=bzdd2j1cgoynpsk9.js.map
