import{r as c,E as M,J as y,K as N,W as T,j as D,O as m,cw as i,cx as u,dL as R,h as b,I as A}from"./orw3ylzo1pm5yat5.js";import{$ as v}from"./dxebepq3id20w15z.js";import"./fx9bt06582fbthzh.js";function x(){const p=c.useRef(!1),[E,g]=c.useState(""),{code:a,error:l,error_description:f,state:r}=Object.fromEntries(new URLSearchParams(E.substring(1)).entries()),t=M().pluginId,n=y(),C=N(),s=T();return c.useEffect(()=>{g(window.location.hash)},[]),c.useEffect(()=>{if(p.current)return;t&&a&&r&&(p.current=!0);async function S(){const O=`https://chatgpt.com/ca/${t}/oauth/callback`;if(!t||!a||!r){s("/");return}const e=await m.connectorOauthCallback(t,a,O,r);if(!e.success){s(i(u.CUSTOM_ERROR,e.redirect_path,e.error??e.message));return}let o=R.SLACK_SYNC_CONNECTOR;t===v&&(o=R.GDRIVE_SYNC_CONNECTOR);try{const h=await b.safePost("/connectors/{connector_name}/connect_account",{parameters:{path:{connector_name:o}},requestBody:{}});if(!h.success){await m.deleteUserConnectedApp(o);let _=d.connectedDriveErrorDesc;h.status_code===405&&(_=d.emailNotMatchDesc),s(i(u.CUSTOM_ERROR,e.redirect_path,n.formatMessage(_)));return}}catch{await m.deleteUserConnectedApp(o),s(i(u.CUSTOM_ERROR,e.redirect_path,n.formatMessage(d.connectedDriveErrorDesc)));return}s(i(u.CUSTOM_MSG,e.redirect_path,n.formatMessage(d.connectedDriveSyncDesc)))}S()},[t,a,r,n,s]),c.useEffect(()=>{l&&C.danger(`${l}${f?`: ${f}`:""}`)},[l,f,C]),D.jsx(D.Fragment,{})}const d=A({connectedDriveSyncDesc:{id:"CACallback.connectedDriveSyncDesc.1",defaultMessage:"Your account has been connected."},connectedDriveErrorDesc:{id:"CACallback.connectedDriveErrorDesc.1",defaultMessage:"We encountered an issue. Please retry and contact your admin if this issue persists."},emailNotMatchDesc:{id:"CACallback.emailNotMatchDesc.1",defaultMessage:"The account you're trying to connect to doesn't match your ChatGPT account"}});export{x as default};
//# sourceMappingURL=j9xlh0gsc1pztbsu.js.map
