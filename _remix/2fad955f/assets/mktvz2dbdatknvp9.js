const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/h5h85s2ko4jqqdiq.js","assets/orw3ylzo1pm5yat5.js","assets/fx9bt06582fbthzh.js","assets/root-jo2ifv11.css","assets/dxebepq3id20w15z.js","assets/conversation-small-o3h1ik6j.css","assets/fzrn137102spawew.js"])))=>i.map(i=>d[i]);
import{fg as S,ao as z,ap as D,j as e,bA as E,ar as F,r as m,aG as P,bb as H,ak as O,K as L}from"./orw3ylzo1pm5yat5.js";import{C as $}from"./lh4vtpp21ntaxjhl.js";import{a4 as U}from"./fx9bt06582fbthzh.js";import{D as A}from"./egxk01sw6bxspot4.js";import{u as I,a as B,U as k}from"./h8fz40et6la6l8tj.js";import{a as J}from"./ej0z4utcygnui32i.js";import{q as G,r as q,t as j,v as g,x as K,dI as X}from"./dxebepq3id20w15z.js";import"./1y2ciw5ivyc1brc6.js";import"./bsl38p3kh125dox0.js";import"./c4bxzbp1808foto4.js";import"./j38fy6kebn5rue51.js";import"./f0yp7yq5sp6tagmm.js";import"./kh80qdo5h35u5z2d.js";import"./fm5umpejds0pvlu2.js";import"./b8hv43pppf9pad2c.js";function Q(s){return S({tag:"svg",attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{d:"M9 9H4v1h5V9z"}},{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M5 3l1-1h7l1 1v7l-1 1h-2v2l-1 1H3l-1-1V6l1-1h2V3zm1 2h4l1 1v4h2V3H6v2zm4 1H3v7h7V6z"}}]})(s)}function W(s){return S({tag:"svg",attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{d:"M9 9H4v1h5V9z"}},{tag:"path",attr:{d:"M7 12V7H6v5h1z"}},{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M5 3l1-1h7l1 1v7l-1 1h-2v2l-1 1H3l-1-1V6l1-1h2V3zm1 2h4l1 1v4h2V3H6v2zm4 1H3v7h7V6z"}}]})(s)}const Y=z(()=>D(()=>import("./h5h85s2ko4jqqdiq.js"),__vite__mapDeps([0,1,2,3,4,5,6])));function ge({threadId:s,threadUserId:a}){return I(B.isDebugModalOpen)&&e.jsx(E,{isOpen:!0,onClose:()=>k.toggleDebugModalOpen(),type:"success",size:"fullscreen",noPadding:!0,rootClassName:"z-50",children:e.jsx(te,{threadId:s,threadUserId:a??void 0,onClose:()=>k.toggleDebugModalOpen()})})}const Z=(s,a)=>{const t=JSON.stringify(a,null,2),r=new Blob([t],{type:"application/json"}),l=window.URL.createObjectURL(r),n=document.createElement("a");n.href=l,n.download=s,n.click(),window.URL.revokeObjectURL(l)},C="<|im_start|>",y="<|im_sep|>",M="<|im_end|>",ee="<|fim_suffix|>";function se({prompt:s}){const a=[];let t=0;for(;;){const r=s.indexOf(C,t);if(r===-1)break;const l=s.indexOf(y,r);if(l===-1)break;let n=s.indexOf(M,l);const d=s.indexOf(ee,l);if(d!==-1&&(n===-1||d<n)&&(n=d),n===-1)break;const h=s.substring(r+C.length,l),u=s.substring(l+y.length,n);a.push(e.jsxs("div",{children:[e.jsxs("span",{className:"font-semibold",children:["[",h,"]"]}),e.jsx("div",{className:"whitespace-pre-wrap",children:u})]},r)),t=n+M.length}return a}const x=F.div`mb-[-5px] pb-0.5 font-semibold uppercase border-b-2 ${({$isSelected:s})=>s?"border-black dark:border-white":"border-transparent"}`;function te({threadId:s,threadUserId:a,message:t,onClose:r}){const[l,n]=m.useState(t?"message":"json"),{data:d,isLoading:h,refetch:u}=J({threadId:s,threadUserId:a,refetchOnMount:"always"}),o=d?.thread;if(m.useEffect(()=>{n(t?"message":o?.turns.length?`turn${o?.turns.length-1}`:"thread")},[o?.turns.length,t]),!h&&!o&&!t)return e.jsxs(A,{onClickRetry:()=>u(),children:["Failed to load."," "]});if(h)return e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:"Loading..."});const b=o?.turns,p=o?.turns[o.turns.length-1],R=p?.artifacts__?.model_snapshots?.default_id,T=p?.artifacts__?.settings?.model_response?.completion_model?.model,_=R??T,f=p?.artifacts__?.eval_preset,w=a&&s?X(a,s):null;return e.jsx("div",{className:"flex flex-col gap-2 break-words font-mono text-xs",children:e.jsxs(G,{orientation:"vertical",value:l,onValueChange:c=>n(c),children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs(q,{className:"flex items-center justify-start gap-3 p-2",children:[t&&e.jsx(j,{value:"message",children:e.jsx(x,{$isSelected:l==="message",children:"Message"})},"message"),o&&e.jsx(j,{value:"thread",children:e.jsx(x,{$isSelected:l==="thread",children:"Thread"})},"thread"),b?.map((c,i)=>e.jsxs(m.Fragment,{children:[e.jsx(j,{value:`turn${i}`,children:e.jsxs(x,{$isSelected:l===`turn${i}`,children:["Turn[",i,"]"]})},i),c.artifacts__?.debug_ddtrace_urls?.map(N=>e.jsx(x,{$isSelected:!1,children:e.jsxs("a",{target:"_blank",href:N,className:"text-nowrap",rel:"noreferrer",children:["Trace[",i,"] â†—"]})},N))]},i))]}),e.jsxs("div",{className:"flex items-center justify-end",children:[o&&e.jsxs(P,{size:"xs",color:"secondary",onClick:()=>Z("thread.json",o),children:[e.jsx(U,{className:"icon-sm"})," thread.json"]}),e.jsx(H,{onClick:r})]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-2",children:[_&&e.jsxs(e.Fragment,{children:[e.jsx(v,{name:"Model",id:_,className:"flex-shrink-0"})," ",e.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),f&&f!=="production"&&e.jsxs(e.Fragment,{children:[e.jsx(v,{name:"Eval Preset",id:f,className:"flex-shrink-0"}),e.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),w&&e.jsx(e.Fragment,{children:e.jsx(v,{name:"Permalink",id:w,className:"flex-shrink-1"})})]}),b?.map((c,i)=>e.jsxs(g,{value:`turn${i}`,className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth",children:[e.jsxs("div",{className:O("flex flex-col gap-2 p-6",(c.index??0)%2===0&&"bg-token-main-surface-tertiary"),children:[e.jsx(se,{prompt:c.artifacts__?.debug_info?.main_model_response?.prompt_string??""}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"[assistant]"}),e.jsx("div",{"data-testid":"assistant-response",className:"whitespace-pre-wrap",children:c.model_response?.text})]})]})," "]},i)),o&&e.jsx(g,{value:"thread",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:e.jsx(V,{data:o,collapsed:4})}),t&&e.jsx(g,{value:"message",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:e.jsx(V,{data:t,collapsed:4})})]},o?.turns.length??"message")})}function V({data:s,collapsed:a}){const[t,r]=m.useState(a??!0);return e.jsxs("div",{className:"flex flex-col items-start gap-1",children:[e.jsx("button",{onClick:()=>r(!t),className:"flex items-center gap-1",children:t?e.jsxs(e.Fragment,{children:[e.jsx(W,{size:14})," Expand all"]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{size:14})," Collapse all"]})}),e.jsx("div",{className:"w-full",children:e.jsx(Y,{json:s,jsonViewProps:{collapsed:t,shortenTextAfterLength:0}},String(t))})]})}function v({name:s,id:a,className:t}){const r=L(),l=m.useCallback(n=>{K(a,r,n)},[a,r]);return e.jsxs("div",{className:O("flex items-center gap-2 truncate",t),children:[e.jsxs("span",{className:"text-nowrap font-semibold",children:[s,":"]}),e.jsx("span",{title:a,className:"truncate text-gray-500 dark:text-white",children:a}),e.jsx($,{onCopy:l})]})}export{V as DebugJsonViewer,ge as DebugModal,te as DebugModalContents};
//# sourceMappingURL=mktvz2dbdatknvp9.js.map
