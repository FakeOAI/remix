import{f8 as T,bx as j,r as d,t as n,cF as V,f9 as B,T as q,fa as P}from"./jf8dax6efxk3ntrb.js";import{fq as $,fr as Y,am as g,fs as K,cz as X,ft as J,fu as Q,fv as Z,fw as ee,fx as te,fy as se,fz as ae,fA as oe,fB as _,fC as ne,fD as O,fE as ie,fF as re,fG as ce,fH as R,af as de,fI as D}from"./iy5hn0mjbnzt38c5.js";import{L as le}from"./h6kbjc718o9wdihq.js";import{e as ue,f as fe,u as pe,g as me}from"./c3pi5fxvo5runnrv.js";import{u as F,U as M}from"./e3v3yphi6j699k9m.js";import{f as he}from"./k5y7kdc8zx0zxgg3.js";import{T as xe}from"./jo4axzvaq2b8071g.js";import{B as ge,i as ve,D as be,E as Ce}from"./hqt4zfekukrwmgoh.js";import{m as h}from"./hjtfi4y9shjj710l.js";import"./fsip9vfxppjksmhp.js";import"./hewk9wb6mx1qiqnx.js";import"./b4m1xo20435mqr8f.js";import"./k1syenyfb41jsafy.js";import"./ekvxzdf96oarhu21.js";import"./fr1q197ib394lfx1.js";import"./jdi7i9l9ih2o13vl.js";import"./ca133gzxpn4mqfre.js";import"./hkgypyj4gy3dzmj2.js";import"./eqgxp8owtrhh3q22.js";import"./vaswdq1ww4snn3z9.js";import"./f597fz72anxa345c.js";import"./liz48xinx6ndw8t4.js";import"./jn59n5aa3tm5bet0.js";import"./mwrv65g4wvyripes.js";import"./go41oml7kvtk8m11.js";import"./jar88zgmbsecvseo.js";import"./kw7qgqveatdolae8.js";import"./fvkpodyzwrbfdbqo.js";import"./g57flob8d7062a3b.js";const W="oai/apps/canmoreSidebarWidth",ye=.25,we=400,k=400;function L(e){return e-we}function y(e,o){return Y(k,L(e),o??ye*e)}function Te(){const e=T.useState(T.selectWindowWidth),o=y(e,$(j.DANGER_SECRET_FOLDERS_ONLY_getItem(W))),s=A(),[t,i]=d.useState(o);d.useEffect(()=>{(t<k||t>L(e))&&i(y(e,t))},[e]);function a(c){i(p=>y(e,p+=c.delta.x))}function r(c){i(c),j.DANGER_SECRET_FOLDERS_ONLY_setItem(W,c)}function l(){const c=y(e,void 0);r(c)}const f=`calc(100vw - ${t}px)`;return s?{chatWidth:t,canvasWidth:e-t,canvasWidthCalc:f,viewportWidth:e,handleDrag:a,handleDoubleClick:l,persist:r}:{chatWidth:0,canvasWidth:e,canvasWidthCalc:"100vw",viewportWidth:e,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function A(){return T.useState(e=>T.selectWindowWidth(e)>1e3)}function Se(e,o){let s;return o?.type===g.Textdoc&&(s={type:"canvas_textdoc",id:o.textdocId}),{...e,messageMetadata:{...e.messageMetadata,open_in_canvas_view:s}}}const z=({isFullScreen:e=!1,clientThreadId:o,focusedObject:s,onClose:t,isAnimating:i=!1,width:a})=>{const{setTargetedContent:r}=K(),l=d.useRef(!1);if(d.useEffect(()=>(l.current&&r(void 0),l.current=!0,()=>{l.current=!1}),[s]),s==null)return null;switch(s.type){case g.Textdoc:return n.jsx(xe,{isFullScreen:e,onClose:t,clientThreadId:o,focusedTextdoc:s,isAnimating:i,width:a});case g.ADAVisualization:return null}},Ie=300,Ee=e=>e?.type===g.Textdoc?e.textdocId:null;function Ae(e){const o=ge(e),s=X(o),t=ve(e),i=be(e,t),a=Ce({clientThreadId:e,conversationLeafId:t}),r=ue(),[l,f]=d.useMemo(()=>{let x;return!a&&i&&(x=J(Q(i.messages))),Ne(s,r,x)},[a,i,s,r]),c=f!=null,p=Ee(f);d.useEffect(()=>{if(f&&l&&(Z(f,l),f.type===g.Textdoc)){const{textdocId:x}=f,S=ne(x);ee(document.getElementById(S))}},[c,p])}function Ne(e,o,s){switch(s?.type){case te.Canmore:{const[t,i]=s.messages;if(!se(t?.message))break;const a=ae(e,t.message,i?.message??null),r=a.textdocId??o;if(r&&(a.function===oe.CreateTextdoc?(a.content??"").length>Ie||a.status===_.WAITING:a.status===_.STREAMING))return[a.messageId,{type:g.Textdoc,textdocId:r}];break}}return[void 0,null]}const je=260,w={type:"spring",bounce:.12,duration:.64},_e={type:"spring",bounce:0,duration:.58},Re=({clientThreadId:e,focusedObject:o,onClose:s})=>{const{chatWidth:t,canvasWidthCalc:i,handleDrag:a,handleDoubleClick:r,persist:l}=Te(),[f,c]=d.useState(!0),[p,x]=d.useState(!1),S=F(u=>u.activeSidebar),I=re(({rect:u})=>u),{windowHeight:v,windowWidth:b}=B(u=>u,{windowWidth:0,windowHeight:0});let m=I??{top:0,left:t,width:b-t,height:v},N=!1;if(I&&(m.top<0||m.top+m.height>v)){N=!0;const u={width:(b-t)*.75,height:v*.75};m={top:v/2-u.height/2,left:(b-t-u.width)/2+t,width:u.width,height:u.height}}const C=I?.borderRadius,E=fe(),H=E?.history!=null||E?.showChangesAtVersion!=null,U=F(u=>u.isDesktopNavCollapsed);return n.jsxs(n.Fragment,{children:[H&&n.jsx(le,{onClick:()=>ce(E.textdocId),zIndexKey:"chatOverlay"}),n.jsxs(h.div,{initial:{marginRight:U?0:-je},animate:{marginRight:0},transition:_e,children:[n.jsx(h.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:{...w,delay:.22},className:"pointer-events-none absolute left-0 top-0 z-20 h-full w-full bg-token-main-surface-primary"}),n.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"pointer-events-none absolute left-0 top-0 z-10 h-full w-full bg-black/[0.025] dark:bg-transparent"}),n.jsx(h.div,{className:"relative z-20 h-full",style:{width:i},exit:{width:0},transition:{type:"spring",bounce:0,duration:.1}})]}),n.jsx(h.div,{className:q("absolute z-20 h-full overflow-hidden transition-shadow",S==="debug"?"md:left-[-250px] lg:left-[-300px] xl:left-[-350px] 2xl:left-[-400px]":"left-0"),initial:{opacity:N?0:1,x:m.left,y:m.top,width:m.width,height:m.height,borderRadius:C,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},animate:{opacity:1,x:t,y:0,width:i,height:"100%",borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:{opacity:{duration:.14,bounce:.1}},borderRadius:C,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:p?{duration:0}:w,onAnimationComplete:()=>c(!1),children:n.jsx(h.div,{className:"h-full overflow-hidden border-l border-gray-100 dark:border-token-border-medium",initial:{borderRadius:C},animate:{borderRadius:0},exit:{borderRadius:C},transition:w,children:n.jsxs("div",{className:"h-full",children:[n.jsx(h.div,{drag:"x",className:"absolute left-[-2px] z-10 h-full w-[4px] cursor-ew-resize bg-token-text-quaternary opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onDrag:(u,G)=>{x(!0),a(G)},onDragEnd:()=>{x(!1),l(t)},onDoubleClick:()=>r()}),n.jsx(z,{onClose:s,clientThreadId:e,isAnimating:f,focusedObject:o,width:b-t})]})})})]})},De=d.memo(Re),Fe=({clientThreadId:e,focusedObject:o,onClose:s})=>{const t=A();return n.jsx(P,{children:n.jsx(h.div,{className:"fixed inset-0 z-20 overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},exit:t?void 0:{opacity:0,scale:.98},transition:w,children:n.jsx(z,{isFullScreen:!0,clientThreadId:e,focusedObject:o,onClose:s})})})},Me=({clientThreadId:e})=>{const o=A(),s=he(e);Ae(e);const t=pe(),i=me(),a=d.useMemo(()=>{let c=t;if(t?.type===g.Textdoc){const p=i?.[t.textdocId];p&&(c={...t,textdocId:p})}return c},[t,i]);d.useEffect(()=>{O()},[e]);const r=a&&(o?n.jsx(De,{clientThreadId:e,onClose:D,focusedObject:a},"canvas-sidebar"):n.jsx(Fe,{clientThreadId:e,onClose:D,focusedObject:a},"canvas-modal"));d.useEffect(()=>{if(a)return R(c=>Se(c,a)),()=>R(null)},[a,i]);const l=r!=null;return d.useEffect(()=>(M.setActiveStageSidebar(l),()=>M.setActiveStageSidebar(!1)),[l]),s!==e?null:n.jsx(de,{children:r})},lt=e=>{const o=d.useRef(null);return n.jsx(V,{ref:o,onError:(s,t)=>{O(),setTimeout(()=>{o.current?.resetErrorBoundary()}),ie.logError("Error boundary hit",s,{componentStack:t})},name:"canmore-focused-view",children:n.jsx(Me,{...e})})};export{lt as CanvasFocusedViewManager};
//# sourceMappingURL=jzwrg59z0cx64byg.js.map
