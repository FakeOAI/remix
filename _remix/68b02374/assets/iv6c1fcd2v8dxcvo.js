import{r as s,dY as q,g as JA,J as D,K as be,bx as XA,j as o,b$ as xe,cc as Ce,bE as WA,aF as LA,ak as cA,bA as $,aq as ke,D as Ee,ap as Be,dG as Se,aW as Ie,bH as Me,g3 as ye}from"./ign6lc5qqsbgzj3q.js";import{c as UA,ay as we,a3 as Qe,bL as je,bM as Ve,bN as De,bO as Re,ad as Te,a9 as Ne,a as QA,bP as Ze,as as Oe,bo as Ye,F as Ge,bQ as Fe,n as Je}from"./wrbxtg8dgsjl2z0d.js";import{g5 as Xe,jI as PA,b3 as uA,cn as EA,dk as lA,a6 as G,bd as We,jJ as Le,l2 as Ue,l3 as Pe,a8 as J,l4 as qe,bY as ze}from"./f2jm88xc868xaf4h.js";import{$ as Ke,C as He,_ as Q,R as rA,f as T,M as _e,m as jA,y as $e,W as AA,T as Y,O as qA,N as At,S as nA,n as zA,o as xA,p as CA,q as et,Y as tt,F as ot,x as nt,s as KA,l as HA,a as B,t as _A,v as it,b as st,d as BA,e as SA,w as $A,g as at,V as N,X as VA,z as DA,E as rt,A as ct}from"./e1dqleojipbhaifp.js";import{u as IA,a as lt,V as dt}from"./lv5rnkwvuqu5ggg1.js";import{T as ut,u as mt,s as gt,U as ft,a as ht,b as pt,c as vt,d as bt,G as xt,v as Ct,e as kt,B as Et,n as Bt,V as St}from"./owfcndwx5tjta08p.js";import{M as Ae}from"./byzimb7dnbqgr7gl.js";import{m as M}from"./lc5t42k1qhi0m0nv.js";import{W as It}from"./i0gn4jytsw0nm52b.js";import{_ as Mt}from"./iaw9e1cr35idxqne.js";import"./o294e1kz4er8k7ad.js";import"./eijznwdk1krctgzh.js";import"./j5w4166bn3c02o6l.js";import"./fctryjik2hvcole2.js";import"./hl6f8d7a76kgue4i.js";import"./g1b1ozz3akvltlk6.js";import"./kt14v7cn01nrc14n.js";import"./dseck4fe311mjmeu.js";import"./odhn2e8eru1zj48u.js";import"./flc12uzxj6vdh9bf.js";function ee(A){var e,t,n="";if(typeof A=="string"||typeof A=="number")n+=A;else if(typeof A=="object")if(Array.isArray(A)){var i=A.length;for(e=0;e<i;e++)A[e]&&(t=ee(A[e]))&&(n&&(n+=" "),n+=t)}else for(t in A)A[t]&&(n&&(n+=" "),n+=t);return n}function yt(){for(var A,e,t=0,n="",i=arguments.length;t<i;t++)(A=arguments[t])&&(e=ee(A))&&(n&&(n+=" "),n+=e);return n}function wt(...A){return(...e)=>{for(const t of A)if(typeof t=="function")try{t(...e)}catch(n){console.error(n)}}}function te(...A){const e={...A[0]};for(let t=1;t<A.length;t++){const n=A[t];for(const i in n){const r=e[i],c=n[i];typeof r=="function"&&typeof c=="function"&&i[0]==="o"&&i[1]==="n"&&i.charCodeAt(2)>=65&&i.charCodeAt(2)<=90?e[i]=wt(r,c):(i==="className"||i==="UNSAFE_className")&&typeof r=="string"&&typeof c=="string"?e[i]=yt(r,c):e[i]=c!==void 0?c:r}}return e}const Qt={connect:!0,audio:!1,video:!1};function jt(A){const{token:e,serverUrl:t,options:n,room:i,connectOptions:r,connect:c,audio:a,video:l,screen:d,onConnected:m,onDisconnected:u,onError:g,onMediaDeviceFailure:b,onEncryptionError:f,simulateParticipants:v,...h}={...Qt,...A};n&&i&&Q.warn("when using a manually created room, the options object will be ignored. set the desired options directly when creating the room instead.");const[p,w]=s.useState();s.useEffect(()=>{w(i??new rA(n))},[i]);const S=s.useMemo(()=>{const{className:k}=$e();return te(h,{className:k})},[h]);return s.useEffect(()=>{if(!p)return;const k=()=>{const E=p.localParticipant;Q.debug("trying to publish local tracks"),Promise.all([E.setMicrophoneEnabled(!!a,typeof a!="boolean"?a:void 0),E.setCameraEnabled(!!l,typeof l!="boolean"?l:void 0),E.setScreenShareEnabled(!!d,typeof d!="boolean"?d:void 0)]).catch(I=>{Q.warn(I),g?.(I)})},y=E=>{const I=_e.getFailure(E);b?.(I)},C=E=>{f?.(E)};return p.on(T.SignalConnected,k).on(T.MediaDevicesError,y).on(T.EncryptionError,C),()=>{p.off(T.SignalConnected,k).off(T.MediaDevicesError,y).off(T.EncryptionError,C)}},[p,a,l,d,g,f,b]),s.useEffect(()=>{if(p){if(v){p.simulateParticipants({participants:{count:v},publish:{audio:!0,useRealTracks:!0}});return}if(!e){Q.debug("no token yet");return}if(!t){Q.warn("no livekit url provided"),g?.(Error("no livekit url provided"));return}c?(Q.debug("connecting"),p.connect(t,e,r).catch(k=>{Q.warn(k),g?.(k)})):(Q.debug("disconnecting because connect is false"),p.disconnect())}},[c,e,JSON.stringify(r),p,g,t,v]),s.useEffect(()=>{if(!p)return;const k=y=>{switch(y){case jA.Disconnected:u&&u();break;case jA.Connected:m&&m();break}};return p.on(T.ConnectionStateChanged,k),()=>{p.off(T.ConnectionStateChanged,k)}},[e,m,u,p]),s.useEffect(()=>{if(p)return()=>{Q.info("disconnecting on onmount"),p.disconnect()}},[p]),{room:p,htmlProps:S}}const Vt=s.forwardRef(function(A,e){const{room:t,htmlProps:n}=jt(A);return s.createElement("div",{ref:e,...n},t&&s.createElement(Ke.Provider,{value:t},s.createElement(He.Provider,{value:A.featureFlags},A.children)))});function Dt(A){return A!==void 0}function Rt(...A){return te(...A.filter(Dt))}function oe(A,e={}){const[t,n]=s.useState(et(A)),[i,r]=s.useState(t?.isMuted),[c,a]=s.useState(t?.isSubscribed),[l,d]=s.useState(t?.track),[m,u]=s.useState("landscape"),g=s.useRef(),{className:b,trackObserver:f}=s.useMemo(()=>tt(A),[A.participant.sid??A.participant.identity,A.source,ot(A)&&A.publication.trackSid]);return s.useEffect(()=>{const v=f.subscribe(h=>{Q.debug("update track",h),n(h),r(h?.isMuted),a(h?.isSubscribed),d(h?.track)});return()=>v?.unsubscribe()},[f]),s.useEffect(()=>{var v,h;return l&&(g.current&&l.detach(g.current),(v=e.element)!=null&&v.current&&!(qA(A.participant)&&l?.kind==="audio")&&l.attach(e.element.current)),g.current=(h=e.element)==null?void 0:h.current,()=>{g.current&&l?.detach(g.current)}},[l,e.element]),s.useEffect(()=>{var v,h;if(typeof((v=t?.dimensions)==null?void 0:v.width)=="number"&&typeof((h=t?.dimensions)==null?void 0:h.height)=="number"){const p=t.dimensions.width>t.dimensions.height?"landscape":"portrait";u(p)}},[t]),{publication:t,isMuted:i,isSubscribed:c,track:l,elementProps:Rt(e.props,{className:b,"data-lk-local-participant":A.participant.isLocal,"data-lk-source":t?.source,...t?.kind==="video"&&{"data-lk-orientation":m}})}}var Tt="Expected a function",RA=NaN,Nt="[object Symbol]",Zt=/^\s+|\s+$/g,Ot=/^[-+]0x[0-9a-f]+$/i,Yt=/^0b[01]+$/i,Gt=/^0o[0-7]+$/i,Ft=parseInt,Jt=typeof nA=="object"&&nA&&nA.Object===Object&&nA,Xt=typeof self=="object"&&self&&self.Object===Object&&self,Wt=Jt||Xt||Function("return this")(),Lt=Object.prototype,Ut=Lt.toString,Pt=Math.max,qt=Math.min,hA=function(){return Wt.Date.now()};function zt(A,e,t){var n,i,r,c,a,l,d=0,m=!1,u=!1,g=!0;if(typeof A!="function")throw new TypeError(Tt);e=TA(e)||0,kA(t)&&(m=!!t.leading,u="maxWait"in t,r=u?Pt(TA(t.maxWait)||0,e):r,g="trailing"in t?!!t.trailing:g);function b(C){var E=n,I=i;return n=i=void 0,d=C,c=A.apply(I,E),c}function f(C){return d=C,a=setTimeout(p,e),m?b(C):c}function v(C){var E=C-l,I=C-d,j=e-E;return u?qt(j,r-I):j}function h(C){var E=C-l,I=C-d;return l===void 0||E>=e||E<0||u&&I>=r}function p(){var C=hA();if(h(C))return w(C);a=setTimeout(p,v(C))}function w(C){return a=void 0,g&&n?b(C):(n=i=void 0,c)}function S(){a!==void 0&&clearTimeout(a),d=0,n=l=i=a=void 0}function k(){return a===void 0?c:w(hA())}function y(){var C=hA(),E=h(C);if(n=arguments,i=this,l=C,E){if(a===void 0)return f(l);if(u)return a=setTimeout(p,e),b(l)}return a===void 0&&(a=setTimeout(p,e)),c}return y.cancel=S,y.flush=k,y}function kA(A){var e=typeof A;return!!A&&(e=="object"||e=="function")}function Kt(A){return!!A&&typeof A=="object"}function Ht(A){return typeof A=="symbol"||Kt(A)&&Ut.call(A)==Nt}function TA(A){if(typeof A=="number")return A;if(Ht(A))return RA;if(kA(A)){var e=typeof A.valueOf=="function"?A.valueOf():A;A=kA(e)?e+"":e}if(typeof A!="string")return A===0?A:+A;A=A.replace(Zt,"");var t=Yt.test(A);return t||Gt.test(A)?Ft(A.slice(2),t?2:8):Ot.test(A)?RA:+A}var _t=zt;const NA=nt(_t);function $t(A){const e=s.useRef(A);e.current=A,s.useEffect(()=>()=>{e.current()},[])}function Ao(A,e=500,t){const n=s.useRef();$t(()=>{n.current&&n.current.cancel()});const i=s.useMemo(()=>{const r=NA(A,e,t),c=(...a)=>r(...a);return c.cancel=()=>{r.cancel()},c.isPending=()=>!!n.current,c.flush=()=>r.flush(),c},[A,e,t]);return s.useEffect(()=>{n.current=NA(A,e,t)},[A,e,t]),i}function eo(A,e,t){const n=(d,m)=>d===m,i=A instanceof Function?A():A,[r,c]=s.useState(i),a=s.useRef(i),l=Ao(c,e,t);return n(a.current,i)||(l(i),a.current=i),[r,l]}function to({threshold:A=0,root:e=null,rootMargin:t="0%",freezeOnceVisible:n=!1,initialIsIntersecting:i=!1,onChange:r}={}){var c;const[a,l]=s.useState(null),[d,m]=s.useState(()=>({isIntersecting:i,entry:void 0})),u=s.useRef();u.current=r;const g=((c=d.entry)==null?void 0:c.isIntersecting)&&n;s.useEffect(()=>{if(!a||!("IntersectionObserver"in window)||g)return;let v;const h=new IntersectionObserver(p=>{const w=Array.isArray(h.thresholds)?h.thresholds:[h.thresholds];p.forEach(S=>{const k=S.isIntersecting&&w.some(y=>S.intersectionRatio>=y);m({isIntersecting:k,entry:S}),u.current&&u.current(k,S),k&&n&&v&&(v(),v=void 0)})},{threshold:A,root:e,rootMargin:t});return h.observe(a),()=>{h.disconnect()}},[a,JSON.stringify(A),e,t,g,n]);const b=s.useRef(null);s.useEffect(()=>{var v;!a&&(v=d.entry)!=null&&v.target&&!n&&!g&&b.current!==d.entry.target&&(b.current=d.entry.target,m({isIntersecting:i,entry:void 0}))},[a,d.entry,n,g,i]);const f=[l,!!d.isIntersecting,d.entry];return f.ref=f[0],f.isIntersecting=f[1],f.entry=f[2],f}const ne=s.forwardRef(function({onTrackClick:A,onClick:e,onSubscriptionStatusChanged:t,trackRef:n,manageSubscription:i,...r},c){const a=zA(n),l=s.useRef(null);s.useImperativeHandle(c,()=>l.current);const d=to({root:l.current}),[m]=eo(d,3e3);s.useEffect(()=>{i&&a.publication instanceof xA&&m?.isIntersecting===!1&&d?.isIntersecting===!1&&a.publication.setSubscribed(!1)},[m,a,i]),s.useEffect(()=>{i&&a.publication instanceof xA&&d?.isIntersecting===!0&&a.publication.setSubscribed(!0)},[d,a,i]);const{elementProps:u,publication:g,isSubscribed:b}=oe(a,{element:l,props:r});s.useEffect(()=>{t?.(!!b)},[b,t]);const f=v=>{e?.(v),A?.({participant:a?.participant,track:g})};return s.createElement("video",{ref:l,...u,muted:!0,onClick:f})}),oo=s.forwardRef(function({trackRef:A,onSubscriptionStatusChanged:e,volume:t,muted:n,...i},r){const c=zA(A),a=s.useRef(null);s.useImperativeHandle(r,()=>a.current);const{elementProps:l,isSubscribed:d,track:m,publication:u}=oe(c,{element:a,props:i});return s.useEffect(()=>{e?.(!!d)},[d,e]),s.useEffect(()=>{m===void 0||t===void 0||(m instanceof CA?m.setVolume(t):Q.warn("Volume can only be set on remote audio tracks."))},[t,m]),s.useEffect(()=>{u===void 0||n===void 0||(u instanceof xA?u.setEnabled(!n):Q.warn("Can only call setEnabled on remote track publications."))},[n,u,m]),s.createElement("audio",{ref:a,...l})});function no({volume:A,muted:e}){const t=AA([Y.Source.Microphone,Y.Source.ScreenShareAudio,Y.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0}).filter(n=>!qA(n.participant)&&n.publication.kind===Y.Kind.Audio);return s.createElement("div",{style:{display:"none"}},t.map(n=>s.createElement(oo,{key:At(n),trackRef:n,volume:A,muted:e})))}function ie(){const{shouldDelayDisconnect:A,delayDisconnect:e,immediateDisconnect:t}=IA({refetchLater:!0}),{toggleMute:n}=KA();return s.useCallback(async()=>{q.exitVoiceState.click(),Xe.setState({showVoiceFeedback:!0}),A?(await n(),e()):t()},[e,t,A,n])}var io={webm:"data:video/webm;base64,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",mp4:"data:video/mp4;base64,AAAAHGZ0eXBNNFYgAAACAGlzb21pc28yYXZjMQAAAAhmcmVlAAAGF21kYXTeBAAAbGliZmFhYyAxLjI4AABCAJMgBDIARwAAArEGBf//rdxF6b3m2Ui3lizYINkj7u94MjY0IC0gY29yZSAxNDIgcjIgOTU2YzhkOCAtIEguMjY0L01QRUctNCBBVkMgY29kZWMgLSBDb3B5bGVmdCAyMDAzLTIwMTQgLSBodHRwOi8vd3d3LnZpZGVvbGFuLm9yZy94MjY0Lmh0bWwgLSBvcHRpb25zOiBjYWJhYz0wIHJlZj0zIGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDE6MHgxMTEgbWU9aGV4IHN1Ym1lPTcgcHN5PTEgcHN5X3JkPTEuMDA6MC4wMCBtaXhlZF9yZWY9MSBtZV9yYW5nZT0xNiBjaHJvbWFfbWU9MSB0cmVsbGlzPTEgOHg4ZGN0PTAgY3FtPTAgZGVhZHpvbmU9MjEsMTEgZmFzdF9wc2tpcD0xIGNocm9tYV9xcF9vZmZzZXQ9LTIgdGhyZWFkcz02IGxvb2thaGVhZF90aHJlYWRzPTEgc2xpY2VkX3RocmVhZHM9MCBucj0wIGRlY2ltYXRlPTEgaW50ZXJsYWNlZD0wIGJsdXJheV9jb21wYXQ9MCBjb25zdHJhaW5lZF9pbnRyYT0wIGJmcmFtZXM9MCB3ZWlnaHRwPTAga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCB2YnZfbWF4cmF0ZT03NjggdmJ2X2J1ZnNpemU9MzAwMCBjcmZfbWF4PTAuMCBuYWxfaHJkPW5vbmUgZmlsbGVyPTAgaXBfcmF0aW89MS40MCBhcT0xOjEuMDAAgAAAAFZliIQL8mKAAKvMnJycnJycnJycnXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXiEASZACGQAjgCEASZACGQAjgAAAAAdBmjgX4GSAIQBJkAIZACOAAAAAB0GaVAX4GSAhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGagC/AySEASZACGQAjgAAAAAZBmqAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZrAL8DJIQBJkAIZACOAAAAABkGa4C/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmwAvwMkhAEmQAhkAI4AAAAAGQZsgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGbQC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm2AvwMkhAEmQAhkAI4AAAAAGQZuAL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGboC/AySEASZACGQAjgAAAAAZBm8AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZvgL8DJIQBJkAIZACOAAAAABkGaAC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmiAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpAL8DJIQBJkAIZACOAAAAABkGaYC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmoAvwMkhAEmQAhkAI4AAAAAGQZqgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGawC/AySEASZACGQAjgAAAAAZBmuAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZsAL8DJIQBJkAIZACOAAAAABkGbIC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm0AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZtgL8DJIQBJkAIZACOAAAAABkGbgCvAySEASZACGQAjgCEASZACGQAjgAAAAAZBm6AnwMkhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AAAAhubW9vdgAAAGxtdmhkAAAAAAAAAAAAAAAAAAAD6AAABDcAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAzB0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAABAAAAAAAAA+kAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAALAAAACQAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAPpAAAAAAABAAAAAAKobWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAB1MAAAdU5VxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRlb0hhbmRsZXIAAAACU21pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAhNzdGJsAAAAr3N0c2QAAAAAAAAAAQAAAJ9hdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAALAAkABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAALWF2Y0MBQsAN/+EAFWdCwA3ZAsTsBEAAAPpAADqYA8UKkgEABWjLg8sgAAAAHHV1aWRraEDyXyRPxbo5pRvPAyPzAAAAAAAAABhzdHRzAAAAAAAAAAEAAAAeAAAD6QAAABRzdHNzAAAAAAAAAAEAAAABAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAAIxzdHN6AAAAAAAAAAAAAAAeAAADDwAAAAsAAAALAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAAiHN0Y28AAAAAAAAAHgAAAEYAAANnAAADewAAA5gAAAO0AAADxwAAA+MAAAP2AAAEEgAABCUAAARBAAAEXQAABHAAAASMAAAEnwAABLsAAATOAAAE6gAABQYAAAUZAAAFNQAABUgAAAVkAAAFdwAABZMAAAWmAAAFwgAABd4AAAXxAAAGDQAABGh0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAABDcAAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAQkAAADcAABAAAAAAPgbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAC7gAAAykBVxAAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAADi21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAADT3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAAC7gAAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVBbjYAAu4AAAADcoFgICAAhGQBoCAgAECAAAAIHN0dHMAAAAAAAAAAgAAADIAAAQAAAAAAQAAAkAAAAFUc3RzYwAAAAAAAAAbAAAAAQAAAAEAAAABAAAAAgAAAAIAAAABAAAAAwAAAAEAAAABAAAABAAAAAIAAAABAAAABgAAAAEAAAABAAAABwAAAAIAAAABAAAACAAAAAEAAAABAAAACQAAAAIAAAABAAAACgAAAAEAAAABAAAACwAAAAIAAAABAAAADQAAAAEAAAABAAAADgAAAAIAAAABAAAADwAAAAEAAAABAAAAEAAAAAIAAAABAAAAEQAAAAEAAAABAAAAEgAAAAIAAAABAAAAFAAAAAEAAAABAAAAFQAAAAIAAAABAAAAFgAAAAEAAAABAAAAFwAAAAIAAAABAAAAGAAAAAEAAAABAAAAGQAAAAIAAAABAAAAGgAAAAEAAAABAAAAGwAAAAIAAAABAAAAHQAAAAEAAAABAAAAHgAAAAIAAAABAAAAHwAAAAQAAAABAAAA4HN0c3oAAAAAAAAAAAAAADMAAAAaAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAACMc3RjbwAAAAAAAAAfAAAALAAAA1UAAANyAAADhgAAA6IAAAO+AAAD0QAAA+0AAAQAAAAEHAAABC8AAARLAAAEZwAABHoAAASWAAAEqQAABMUAAATYAAAE9AAABRAAAAUjAAAFPwAABVIAAAVuAAAFgQAABZ0AAAWwAAAFzAAABegAAAX7AAAGFwAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTUuMzMuMTAw"};const{webm:so,mp4:ao}=io,pA=()=>typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,vA=()=>"wakeLock"in navigator;class ro{constructor(){if(this.enabled=!1,vA()){this._wakeLock=null;const e=()=>{this._wakeLock!==null&&document.visibilityState==="visible"&&this.enable()};document.addEventListener("visibilitychange",e),document.addEventListener("fullscreenchange",e)}else pA()?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("title","No Sleep"),this.noSleepVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.noSleepVideo,"webm",so),this._addSourceToVideo(this.noSleepVideo,"mp4",ao),this.noSleepVideo.addEventListener("loadedmetadata",()=>{this.noSleepVideo.duration<=1?this.noSleepVideo.setAttribute("loop",""):this.noSleepVideo.addEventListener("timeupdate",()=>{this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())})}))}_addSourceToVideo(e,t,n){var i=document.createElement("source");i.src=n,i.type=`video/${t}`,e.appendChild(i)}get isEnabled(){return this.enabled}enable(){return vA()?navigator.wakeLock.request("screen").then(e=>{this._wakeLock=e,this.enabled=!0,console.log("Wake Lock active."),this._wakeLock.addEventListener("release",()=>{console.log("Wake Lock released.")})}).catch(e=>{throw this.enabled=!1,console.error(`${e.name}, ${e.message}`),e}):pA()?(this.disable(),console.warn(`
        NoSleep enabled for older iOS devices. This can interrupt
        active or long-running network requests from completing successfully.
        See https://github.com/richtr/NoSleep.js/issues/15 for more details.
      `),this.noSleepTimer=window.setInterval(()=>{document.hidden||(window.location.href=window.location.href.split("#")[0],window.setTimeout(window.stop,0))},15e3),this.enabled=!0,Promise.resolve()):this.noSleepVideo.play().then(t=>(this.enabled=!0,t)).catch(t=>{throw this.enabled=!1,t})}disable(){vA()?(this._wakeLock&&this._wakeLock.release(),this._wakeLock=null):pA()?this.noSleepTimer&&(console.warn(`
          NoSleep now disabled for older iOS devices.
        `),window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause(),this.enabled=!1}}var co=ro;const lo=JA(co);function uo(A){const e=A.default_voice_mode,t=A.modes.find(n=>n.mode===e);if(!t)throw new Error("Voice status returned a default_voice_mode that does not exist in the modes array");return t.default_model_slug}function MA(){const A=D(),e=be(),{startVoiceMode:t,stopVoiceMode:n,isConnected:i,isVoiceModeActive:r}=HA(),c=s.useCallback(async a=>{const l={conversation_id:a.serverThreadId,parent_message_id:a.parentMessageId,model_slug:a.modelSlug,model_slug_advanced:a.isAdvancedMode?a.modelSlug:void 0,voice_mode:a.isAdvancedMode?"advanced":"standard",eventSource:a.eventSource,clientThreadId:a.clientThreadId,gizmo_id:a.gizmoId,voice:a.voice},d=A.formatMessage({id:"useVoiceModeButtonAction.error",defaultMessage:"Failed to start voice mode"});try{await t(l)}catch{if(a.isAdvancedMode&&a.retryWithStandard)try{await t({...l,voice_mode:"standard"})}catch{e.danger(d),q.voiceMode.error({error:d})}else e.danger(d),q.voiceMode.error({error:d})}},[A,t,e]);return{isVoiceModeActive:r,isConnected:i,toggleVoiceMode:c,stopVoiceMode:n}}const se="inline-flex items-center bg-transparent text-token-text-secondary hover:text-token-text-primary",mo=({message:A,onClick:e,type:t})=>{const n=D(),i=PA()&&XA;if(!A)return null;switch(t){case"microphone_denied":return i?o.jsxs("a",{href:"ms-settings:privacy-microphone",className:se,children:[A,o.jsx(UA,{className:"icon-sm ml-1"})]}):o.jsx(ZA,{onClick:e,message:A});case"connection_quality":return o.jsxs("div",{className:"inline-flex items-center",children:[A,o.jsx("button",{onClick:e,className:"ml-1",children:o.jsx("strong",{children:n.formatMessage(ae.retry)})})]});case"normal":return o.jsx(ZA,{onClick:e,message:A})}},ZA=({message:A,onClick:e})=>{const t=D();return o.jsxs("button",{onClick:e,className:se,"aria-label":t.formatMessage(ae.openInfoModal),children:[A,o.jsx(UA,{className:"icon-sm ml-1"})]})},ae={openInfoModal:{id:"hintMessage.openInfoModal",defaultMessage:"Open info modal",description:"Open info modal about voice mode usage"},retry:{id:"hintMessage.retry",defaultMessage:"Retry",description:"Retry text next to lost connection message"}};function go(A){const{button:e,conversationId:t,modelId:n,onClick:i}=A,r=uA(t),c=EA(t),a=e.action==="new_chat"?c:n,{toggleVoiceMode:l}=MA(),d=s.useCallback(()=>{switch(e.action){case"new_chat":{const m=a??lA;We(`/?model=${m}`),l({serverThreadId:void 0,modelSlug:m,isAdvancedMode:!0,eventSource:`modal_${e.action}`,parentMessageId:void 0,retryWithStandard:!1,clientThreadId:xe(),gizmoId:G.getGizmoId(t)});break}case"switch_to_standard":r&&n&&l({serverThreadId:r,modelSlug:a??lA,isAdvancedMode:!1,eventSource:`modal_${e.action}`,parentMessageId:void 0,retryWithStandard:!1,clientThreadId:r,gizmoId:G.getGizmoId(t)});break;case"ok":break;default:return}i?.()},[e.action,t,a,n,i,r,l]);return o.jsx(Ce.Button,{onClick:d,title:e.title,color:A.color})}function re({buttons:A,conversationId:e,modelId:t,onClick:n}){let i,r;return!A||A.length===0?{primary:void 0,secondary:void 0}:(A.forEach(c=>{const a=c.action==="new_chat",l=c.action==="switch_to_standard",d=a&&e,m=l&&e&&t,u=o.jsx(go,{button:c,conversationId:e,modelId:t,onClick:n,color:c.style});(d||m||c.action==="ok")&&(i?r||(r=u):i=u)}),{primary:i,secondary:r})}function fo({conversationId:A,modelId:e,isOpen:t,onClose:n,buttons:i,title:r,description_markdown:c}){const a=re({buttons:i,conversationId:A,modelId:e,onClick:n}),l=o.jsx(Ae,{className:"markdown",urlTransform:d=>d,children:c});return o.jsx(WA,{title:r,isOpen:t,onClose:n,size:"custom",className:"max-w-[550px]",type:"warning",showCloseButton:!0,children:o.jsxs("div",{className:"w-full",children:[o.jsx("p",{className:"mb-6 text-token-text-secondary",children:l}),o.jsx("div",{className:"flex justify-end",children:a.primary})]})})}function ho({conversationId:A,currentModelId:e}){const t=D(),n=ie(),i=B(x=>x.server.usage),r=B(x=>x.server.voiceConnectionQuality),c=x=>x===$A.Lost,a=B(x=>x.server.connectionState),l=_A(),[d,m]=s.useState(!1),u=B(x=>x.server.toolUpdate),[g,b]=s.useState(!1),[f,v]=s.useState(!0),[h,p]=s.useState(null),[w,S]=s.useState(null),[k,y]=s.useState(null),[C,E]=s.useState(!1),[I,j]=s.useState(!1),tA=s.useRef(!1),X=uA(A),{stopVoiceMode:z,toggleVoiceMode:O,isVoiceModeActive:W}=MA(),K=it();s.useEffect(()=>{I||K().then(x=>{E(x)}).finally(()=>{j(!0)})},[K,I]);const mA=PA()&&XA,L=W&&I&&!C,H=W&&C&&!a&&l;s.useEffect(()=>{L&&(p(t.formatMessage(bA.hint)),S({title:t.formatMessage(bA.title),description_markdown:t.formatMessage(bA.description_markdown),buttons:[]}))},[t,mA,L]),s.useEffect(()=>{if(H&&!tA.current){tA.current=!0,p(null),S(null);const x=uo(l),P=G.getCurrentNode(A)?.id,oA={serverThreadId:X,modelSlug:x,parentMessageId:P,isAdvancedMode:l.default_voice_mode==="advanced",retryWithStandard:!0,eventSource:"composer_speech_button",clientThreadId:A,gizmoId:G.getGizmoId(A)};q.voiceSessionStarted.click(),O(oA)}},[A,H,l,X,O]);const{reaching_limit_disclosure:V,exceed_limit_message:R}=i?.rate_limit_message??{},U=l?.modes.find(x=>x.mode===l?.default_voice_mode),gA=U?.disclosure_message,fA=c(r)?"Lost connection.":V?.hint??R?.title??gA?.hint??null;s.useEffect(()=>{U&&p(U.disclosure_message?.hint??null)},[U]),s.useEffect(()=>{const x=u?.text;let P,oA,wA;return x&&(v(!1),P=setTimeout(()=>{b(!0),oA=setTimeout(()=>{b(!1),wA=setTimeout(()=>{v(!0),st.setState(ve=>{ve.server.toolUpdate=null})},750)},3e3)},750)),()=>{clearTimeout(P),clearTimeout(oA),clearTimeout(wA)}},[u]),s.useEffect(()=>{if(fA&&p(fA),R&&W){z();const x={title:R.title,description_markdown:R.description_markdown,buttons:R.buttons};d?y(x):(S(x),m(!0))}else if(!w){const x=V??gA;x&&S({title:x.title,description_markdown:x.message_markdown,buttons:x.buttons})}},[i,gA,z,W,fA,R,V,d,w,r]);const de=s.useCallback(()=>{k&&(S(k),y(null)),m(!0)},[k]),ue=s.useCallback(()=>{m(!1)},[]),{startVoiceMode:me}=HA(),ge=EA(A),fe=B(x=>x.voiceMode),{voiceName:he}=Le(),pe=async()=>{try{p(null),await me({conversation_id:X,model_slug:ge??lA,eventSource:"lost_connection_hint_message",voice_mode:fe,voice:he,clientThreadId:A,gizmo_id:G.getGizmoId(A)})}catch(x){const P=x instanceof Error?x.message:String(x);q.voiceMode.error({error:P,eventSource:"lost_connection_hint_message"})}};let _;return L?_="microphone_denied":c(r)?_="connection_quality":_="normal",o.jsxs("div",{className:"flex w-full flex-col items-center",children:[o.jsxs("div",{className:"relative mb-6 flex min-h-5 w-full items-center justify-center text-xs text-token-text-secondary",children:[u?.text&&o.jsx(M.div,{initial:{opacity:0},animate:{opacity:g?1:0},transition:{duration:.5},style:{position:"absolute",left:"50%",transform:"translateX(-50%)",textAlign:"center"},children:o.jsxs("div",{className:"flex items-center",children:[u?.text&&o.jsx(we,{className:"icon-sm mr-1"}),u?.text]})}),o.jsx(M.div,{initial:{opacity:0},animate:{opacity:f?1:0},transition:{duration:.5},style:{position:"absolute",left:"50%",transform:"translateX(-50%)",textAlign:"center",pointerEvents:u?.text?"none":"auto",cursor:u?.text?"default":"pointer"},children:o.jsx("div",{className:"flex items-center",children:o.jsx(mo,{type:_,message:h,onClick:_==="connection_quality"?pe:de})})})]}),o.jsxs("div",{className:cA("flex flex-row items-center gap-6","rounded-full px-3 py-1","transition-width duration-200 ease-in-out"),children:[o.jsx(OA,{capability:"video",children:o.jsx(po,{})}),o.jsx(bo,{shouldQueryDevices:!!H,hideTooltip:L}),o.jsx(OA,{capability:"screenshare",children:o.jsx(xo,{})}),o.jsx(yA,{onClick:n})]}),o.jsx(fo,{conversationId:A,modelId:e,isOpen:d,onClose:ue,title:w?.title,description_markdown:w?.description_markdown,buttons:w?.buttons??[]})]})}function OA({children:A,capability:e}){const t=lt();return!t.av||!t[e]?null:o.jsx(o.Fragment,{children:A})}function po(){const{isVideoEnabled:A,isStartingVideo:e,toggleVideo:t}=BA();let n=null;e?n=$:n=je;const i=A?"bg-gray-900 hover:bg-gray-800 active:bg-gray-700":"bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10",r=A?"text-token-main-surface-primary":"text-token-main-surface-primary-inverse";return o.jsx(eA,{onClick:()=>t("ControlButton"),disabled:e,icon:n,className:i,iconColor:r})}const vo=async()=>{try{return(await at("audioinput"))?.label??""}catch(A){return console.warn("Error fetching default media device:",A),Ee.addError("Failed to fetch default media device",{error:A}),"Error accessing microphone devices"}};function bo({shouldQueryDevices:A,hideTooltip:e}){const{isMicrophoneEnabled:t,isMuting:n,toggleMute:i}=KA(),r=D(),{disconnectPending:c}=IA(),[a,l]=s.useState(""),d=t?Ve:De,m=t?"bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10":"bg-red-500/10 hover:bg-red-500/15 active:bg-red-500/20 dark:bg-red-500/10 dark:hover:bg-red-500/15 dark:active:bg-red-500/20",u=t?"text-token-main-surface-primary-inverse":"text-danger";s.useEffect(()=>{A&&vo().then(b=>l(b))},[A]);const g=t?r.formatMessage({id:"nbbUMb",defaultMessage:"Turn on microphone"}):r.formatMessage({id:"PJzixV",defaultMessage:"Turn off microphone"});return o.jsx(eA,{"aria-label":g,onClick:i,icon:d,disabled:n||c,className:m,iconColor:u,tooltipPrimaryLabel:!e&&a?g:"",tooltipSecondaryLabel:a})}function xo(){const{isScreenshareEnabled:A,isScreenshareStarting:e,toggleScreenShare:t}=SA();let n=null;e?n=$:n=Re;const i=A?"bg-gray-900 hover:bg-gray-800 active:bg-gray-700":"bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10",r=A?"text-token-main-surface-primary":"text-token-main-surface-primary-inverse";return o.jsx(eA,{onClick:()=>t("ControlButton"),disabled:e,icon:n,className:i,iconColor:r})}function yA({className:A,onClick:e}){const t=D(),{disconnectPending:n}=IA(),i="bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10",r=t.formatMessage({id:"9Mto0a",defaultMessage:"End"});return o.jsx(eA,{disabled:n,onClick:e,icon:n?$:Qe,iconColor:"text-token-main-surface-primary-inverse",className:A??i,"aria-label":t.formatMessage({id:"7/8k4Y",defaultMessage:"End voice mode"}),tooltipPrimaryLabel:r})}function eA(A){const{icon:e,disabled:t,className:n,iconColor:i="text-current",iconSize:r="icon-xl",buttonSize:c="h-16 w-16",tooltipPrimaryLabel:a,tooltipSecondaryLabel:l,...d}=A,[m,u]=s.useState(!1),g=s.useRef(void 0),b=s.useCallback(()=>{const h=window.setTimeout(()=>{u(!0)},ut);g.current=h},[]),f=s.useCallback(()=>{clearTimeout(g.current),u(!1)},[]),v=o.jsx(Co,{className:cA(n,c,"overflow-hidden rounded-full border-none p-0.5 text-token-text-primary transition-colors duration-200 ease-in-out hover:text-token-text-secondary"),disabled:t,...d,children:o.jsx(e,{className:cA(r,i)})});return a?o.jsx(ke,{sideOffset:14,label:a,secondaryLabel:l,contentClassName:"flex flex-col items-center justify-center",className:"flex",open:m,side:"top",children:o.jsx("span",{onPointerEnter:b,onPointerLeave:f,children:v})}):v}const Co=M(LA),bA={hint:{id:"micMessages.hint",defaultMessage:"Enable microphone access in Settings",description:"Hint to the user to manually enable microphone access for voice mode"},title:{id:"micMessages.title",defaultMessage:"Microphone access required",description:"Title for modal that informs the user that microphone access is required for voice mode"},description_markdown:{id:"micMessages.description_markdown",defaultMessage:"To use voice mode, you'll need to enable your microphone and try again.",description:"Description for modal that informs the user that microphone access is required for voice mode"}};var ko=Mt,Eo=Ue,Bo=ko(function(A,e,t){return A+(t?" ":"")+Eo(e)}),So=Bo;const Io=JA(So);function Mo({conversationId:A}){const e=Be("1426009137")?.value,t=uA(A),n=EA(A),i=G.getCurrentNode(A)?.id,r=_A();return!e||!n?null:o.jsx(F,{conversationId:t??A,parentMessageId:i,status:r})}function F(A){const e=A?.status?.modes,[t,n]=s.useState(!1),[i,r]=s.useState(),c=s.useCallback(d=>{r(d),n(!0)},[]),a=D(),l=s.useCallback(()=>n(!1),[]);return o.jsxs(o.Fragment,{children:[o.jsx(Se,{contentAlign:"center",triggerButton:o.jsx(F.Trigger,{}),children:e?e.map(d=>{const m=d.default_model_slug;return s.createElement(F.Item,{...A,modelSlug:m,key:d.mode,voiceStatusMode:d,onShowModal:c})}):o.jsx("div",{role:"progressbar","aria-valuetext":a.formatMessage({defaultMessage:"Loading voice modes",id:"voiceModeButton.loadingModes"}),"aria-busy":"true","aria-live":"assertive","aria-valuemin":0,"aria-valuemax":100,children:o.jsx($,{"aria-hidden":"true",className:"my-4 min-w-full"})})}),o.jsx(F.Modal,{conversationId:A.conversationId,disabledModeMetadata:i,isOpen:t,onClose:l})]})}F.Modal=function(e){const t=e.disabledModeMetadata?.buttons??[],n=re({buttons:t,conversationId:e.conversationId,modelId:lA,onClick:e.onClose}),i=o.jsx(Ae,{children:e.disabledModeMetadata?.description_markdown});return o.jsx(WA,{title:e.disabledModeMetadata?.title,description:i,isOpen:e.isOpen,onClose:e.onClose,type:"success",primaryButton:n.primary,secondaryButton:n.secondary})};F.Trigger=s.forwardRef(function(e,t){const n=B(i=>i.voiceMode);return o.jsxs(Pe,{ref:t,...e,children:[Io(n)??o.jsx($,{}),o.jsx(Te,{className:"icon-md text-token-text-tertiary"})]})});F.Item=function({conversationId:e,modelSlug:t,parentMessageId:n,voiceStatusMode:i,onShowModal:r}){const{disabled_mode_metadata:c,mode:a}=i,{toggleVoiceMode:l}=MA(),d=uA(e),m=s.useCallback(async()=>{c?r(c.disabled_message):l({serverThreadId:d,modelSlug:t,parentMessageId:n,isAdvancedMode:a==="advanced"&&!c,eventSource:"voice_mode_picker",retryWithStandard:!1,clientThreadId:e,gizmoId:G.getGizmoId(e)})},[e,c,a,t,r,n,d,l]);return o.jsx(Ie.Item,{onClick:m,children:o.jsxs("div",{children:[i.display_name,o.jsx("div",{className:"text-xs text-token-text-tertiary",children:i.description})]})})};function yo({conversationId:A}){const e=B(n=>n.server.messages),t=B(n=>n.voiceSessionId);return o.jsx(M.div,{className:"hidden h-full max-w-[400px] overflow-y-auto border-l border-l-token-sidebar-surface-secondary bg-token-main-surface-secondary pt-16 shadow-inner md:block",initial:{opacity:0,x:420,width:"0px"},animate:{opacity:1,x:0,width:"400px"},exit:{opacity:0,x:420,width:"0px"},transition:{type:"tween"},children:o.jsxs(J,{children:[o.jsx(Mo,{conversationId:A}),o.jsxs("div",{className:"p-4 py-2 text-lg font-semibold",children:["Voice Session ID: ",t]}),e.length?o.jsxs(M.div,{className:"flex h-full w-full flex-col",initial:{opacity:0,x:-100},animate:{opacity:1,x:0},exit:{opacity:0,x:-100},children:[o.jsxs("div",{children:[o.jsx("h3",{className:"p-4 py-2 text-lg font-semibold text-token-text-secondary",children:"Room Stats"}),o.jsx(wo,{})]}),o.jsx("h3",{className:"p-4 py-2 text-lg font-semibold text-token-text-secondary",children:"Messages"}),o.jsx("div",{className:"grow overflow-hidden",children:o.jsx(It,{children:o.jsx(M.ul,{className:"pointer-events-none flex w-full flex-col gap-4 pb-24 pt-4",initial:"initial",animate:"animate",exit:"exit",variants:ce,transition:{delayChildren:.25,staggerChildren:.05},children:e.map((n,i)=>o.jsx(Do,{index:i,message:n},i))})})})]}):null]})})}function wo(){const A=B(n=>n.dev.room);if(!A)return null;const e=A.numParticipants,t=A.activeSpeakers;return o.jsx("div",{className:"px-4 pb-8",children:o.jsxs("div",{className:"flex flex-col flex-nowrap gap-2",children:[o.jsx(Qo,{}),o.jsx(dA,{text:"Attendees"}),o.jsx(Z,{name:"Participants",text:e}),o.jsx(Z,{name:"Speakers",text:t.length}),o.jsx(jo,{})]})})}function Qo(){const A=B(r=>r.server.connectionState),e=B(r=>r.dev.room),[t,n]=s.useState("Unknown"),i=e?.localParticipant;return s.useEffect(()=>{if(i){const r=c=>{n(c)};return i.on("connectionQualityChanged",r),()=>{i.off("connectionQualityChanged",r)}}},[i]),o.jsxs(o.Fragment,{children:[o.jsx(dA,{text:"Connection"}),o.jsx(Z,{name:"Quality",text:String(t)}),o.jsx(Z,{name:"State",text:String(A)})]})}function jo(){const A=B(m=>m.dev.room),[e,t]=s.useState(null),[n,i]=s.useState(null),[r,c]=s.useState(null),a=A?.getActiveDevice("audioinput"),l=A?.getActiveDevice("audiooutput"),d=A?.getActiveDevice("videoinput");return s.useEffect(()=>{async function m(){const u=await rA.getLocalDevices("audioinput"),g=await rA.getLocalDevices("audiooutput"),b=await rA.getLocalDevices("videoinput"),f=u.find(p=>p.deviceId===a),v=g.find(p=>p.deviceId===l),h=b.find(p=>p.deviceId===d);t(f?.label??"Unknown"),i(v?.label??"Unknown"),c(h?.label??null)}m()},[a,l,d]),o.jsxs(o.Fragment,{children:[o.jsx(dA,{text:"Devices"}),r?o.jsx(Z,{icon:Ne,name:"Video Input",text:r}):null,o.jsx(Z,{icon:QA,name:"Audio Input",text:e??"Unknown"}),o.jsx(Z,{icon:Ze,name:"Audio Output",text:n??"Unknown"}),o.jsx(dA,{text:"Monitors"}),o.jsx(Z,{name:"Mic level",icon:QA,text:"unknown",content:o.jsx(Vo,{})})]})}function Vo(){const A=B(e=>e.dev.room?.localParticipant.audioLevel);return o.jsx("div",{className:"flex flex-row flex-nowrap items-center gap-1",children:o.jsx("div",{className:"flex flex-row flex-nowrap items-center gap-1",children:Array.from({length:10}).map((e,t)=>o.jsx("div",{className:`h-2 w-2 rounded-full ${(A??0)>t*.1?"bg-gray-500":"bg-token-main-surface-tertiary"}`},t))})})}function dA({text:A}){return o.jsx("h4",{className:"text-md font-semibold",children:A})}function Z(A){return o.jsxs("div",{className:"flex flex-row flex-nowrap items-center gap-2",children:[o.jsx("span",{className:"opacity-85",children:A.icon?o.jsx(A.icon,{className:"h-[0.75rem] w-[0.75rem]"}):`${A.name}:`}),A.content??o.jsx("span",{className:"line-clamp-1 rounded-lg bg-token-main-surface-tertiary p-0.5 px-1 font-mono text-xs",children:A.text})]})}function Do({index:A,message:e}){const[t,n]=s.useState(!1),i=D();let r=null;switch(e.source){case"remote":r=Ge;break;case"local":r=Ye;break}return o.jsx(M.div,{className:"w-full border-t border-token-main-surface-tertiary p-4",variants:ce,children:o.jsxs("div",{className:"flex w-full flex-col gap-2 rounded-lg bg-token-main-surface-secondary",children:[o.jsxs("div",{className:"font-mono text-[0.65rem] font-semibold text-token-text-secondary",children:[o.jsxs("div",{className:"flex w-full flex-row flex-nowrap items-center justify-between",children:[o.jsxs("div",{className:"flex flex-row flex-nowrap items-center gap-1",children:[o.jsx(r,{className:"h-3 w-3 text-token-text-secondary"}),o.jsx("span",{children:` | ${A+1} | ${i.formatDate(e.timestamp,{hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:2})}`})]}),o.jsx("div",{className:"flex flex-row flex-nowrap items-center gap-2",children:o.jsx(LA,{className:"rounded-full p-0.5",color:"ghost",size:"small",onClick:()=>n(c=>!c),children:o.jsx(Oe,{className:`transform transition-transform ${t?"rotate-180":""}`})})})]}),o.jsx("div",{className:"mt-1 text-xs font-bold",children:e.type})]}),o.jsx(J,{children:t?o.jsx(M.pre,{initial:{opacity:0,transform:"blur(4px)"},animate:{opacity:1,transform:"blur(0px)"},exit:{opacity:0,transform:"blur(4px)"},className:"overflow-x-auto rounded-md bg-token-main-surface-tertiary p-2 text-xs text-token-text-secondary",children:JSON.stringify(e.payload,null,2)}):null})]})})}const ce={hidden:{opacity:0,x:100},animate:{opacity:1,x:0},exit:{opacity:0,x:100}};function Ro({children:A}){const{isVideoEnabled:e}=BA(),{isScreenshareEnabled:t}=SA(),n=e||t;return o.jsx(J,{mode:"wait",children:n?o.jsx("div",{className:"flex h-full w-full flex-nowrap items-center",children:e?o.jsx(To,{}):o.jsx(No,{})}):o.jsx(M.div,{className:"flex h-full w-full items-center justify-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:A},"children")})}function To(){const{isVideoEnabled:A,isStartingVideo:e,toggleVideo:t}=BA(),i=AA([Y.Source.Camera]).find(c=>c.participant.isLocal),r=A&&!e&&i;return s.useEffect(()=>{const c=i?.publication?.track;if(c){const a=()=>{t("Browser Video Controls")};return c.on("ended",a),()=>{c.off("ended",a)}}},[i,t]),o.jsx(J,{children:r&&o.jsx(le,{children:o.jsxs("div",{className:"aspect-w-16 aspect-h-9 group relative max-h-[95%] w-fit max-w-[60%] overflow-hidden rounded-3xl shadow-md",children:[o.jsx("div",{className:"absolute right-2 top-2 z-10 opacity-0 transition-opacity group-hover:opacity-90",children:o.jsx(yA,{onClick:()=>t("StopButton"),className:"bg-gray-900 bg-opacity-20 backdrop-blur-lg hover:bg-opacity-30 dark:bg-gray-900 dark:bg-opacity-20 dark:backdrop-blur-lg dark:hover:bg-opacity-30"})}),o.jsx(ne,{className:"h-full w-full object-contain",trackRef:i})]})},"camera-renderer")})}function No(){const{isScreenshareEnabled:A,isScreenshareStarting:e,toggleScreenShare:t}=SA(),i=AA([Y.Source.ScreenShare]).find(c=>c.participant.isLocal),r=A&&!e&&i;return s.useEffect(()=>{const c=i?.publication?.track;if(c){const a=()=>{t("Browser ScreenShare Controls")};return c.on("ended",a),()=>{c.off("ended",a)}}},[i,t]),o.jsx(J,{children:r&&o.jsx(le,{children:o.jsxs("div",{className:"aspect-w-16 aspect-h-9 group relative max-h-[95%] w-fit max-w-[60%] overflow-hidden rounded-3xl shadow-md",children:[o.jsx("div",{className:"absolute right-2 top-2 z-10 opacity-0 transition-opacity group-hover:opacity-90",children:o.jsx(yA,{onClick:()=>t("StopButton"),className:"bg-gray-900 bg-opacity-20 backdrop-blur-lg hover:bg-opacity-30 dark:bg-gray-900 dark:bg-opacity-20 dark:backdrop-blur-lg dark:hover:bg-opacity-30"})}),o.jsx(ne,{className:"h-full w-full object-contain",trackRef:i})]})},"screenshare-renderer")})}function le({children:A,key:e}){return o.jsx(M.div,{className:"flex h-full w-full flex-col items-center justify-center gap-2 bg-token-main-surface-primary",initial:{opacity:0,transform:"blur(12px)",scale:.75},animate:{opacity:1,transform:"blur(0px)",scale:1},exit:{opacity:0,transform:"blur(12px)",scale:.75},transition:{duration:.2},children:A},e)}const iA=(A,e)=>{const[t,n]=s.useState(A===e?performance.now():0),i=s.useRef(e);s.useEffect(()=>{i.current!==e&&A===e&&n(performance.now()),i.current=e},[e,A]);const r=s.useCallback(()=>{n(0)},[]);return[A===e?1:0,t,r]},sA=([A,e,t],n=500)=>{const[i,r]=s.useState(A),c=s.useRef(A),a=s.useRef(void 0),l=s.useCallback((d,m,u)=>{const g=b=>{const f=Math.min((b-d)/n,1),v=m+f*(u-m);r(v),f<1&&(a.current=requestAnimationFrame(g))};a.current=requestAnimationFrame(g)},[n]);return s.useEffect(()=>{if(c.current!==A){c.current=A,a.current&&cancelAnimationFrame(a.current);const d=i,m=A;l(performance.now(),d,m)}},[l,i,A]),[i,e/1e3,t]},YA=A=>{const[e,t]=s.useState({audioData:[0,0,0,0],cumulativeAudioData:[0,0,0,0]}),n=s.useRef([0,0,0,0]),i=s.useRef(void 0),r=s.useRef(performance.now()),{bandMagnitudes:c,cumulativeMagnitude:a}=mt(A,{bands:3,bins:1,gainMultipliers:[10,1,1]});n.current=[...c,a].flat();const l=s.useCallback(()=>{const d=performance.now(),m=(d-r.current)/1e3;r.current=d;const u=n.current,{audioData:g,cumulativeAudioData:b}=e,f=gt({deltaTimeS:m,audioDataRaw:u,prevAudioData:g,prevCumulativeAudioData:b});t(f)},[e]);return s.useEffect(()=>(i.current||(i.current=window.setInterval(l,ft)),()=>{clearInterval(i.current),i.current=void 0}),[l]),e};function GA({className:A}){return o.jsx(Wo,{className:A})}const Zo=1.55,Oo=1.4,Yo="voice-wav",Go="shout",Fo="User",Jo={bands:4,loPass:0,hiPass:400},FA=[300,300];function Xo(){const{resolvedTheme:A}=Me(),e=A==="dark",t=B(f=>f.voiceMode==="advanced"),n=AA([Y.Source.Microphone]),i=n.find(f=>f.publication.trackName===Yo),r=n.find(f=>f.publication.trackName===Go);let c=VA(r?.publication.audioTrack,Jo);c.length===0&&(c=[0,0,0,0]),c.map(f=>f*Oo);let a=YA(r?.publication.audioTrack),l=YA(i?.publication.audioTrack);const d=a.audioData.map((f,v)=>{const h=l.audioData[v];return f>0&&h>0?(f+h)/2:f>0?f:h}),m=a.cumulativeAudioData.map((f,v)=>{const h=l.cumulativeAudioData[v];return f>0&&h>0?(f+h)/2:f>0?f:h}),u=B(f=>f.server.remoteState),g=n.find(f=>f.participant.identity===Fo),b=(VA(g,{bands:1,loPass:0,hiPass:400})[0]??0)*Zo;return{remoteState:u,userVolume:b,isAdvanced:t,avgMag:d,cumulativeAudio:m,isDarkMode:e,standardBloopVolumes:c}}function Wo({className:A}){const{remoteState:e,userVolume:t,isAdvanced:n,avgMag:i,cumulativeAudio:r,isDarkMode:c,standardBloopVolumes:a}=Xo(),[l,d]=s.useState(FA),{canvasSizeRef:m,handleCanvasSizeUpdate:u}=ht(FA),g=s.useCallback(V=>{d([V.width,V.height])},[]),b=s.useRef([0,0,0,0]);s.useEffect(()=>{e===N.Connecting&&(b.current=[0,0,0,0])},[e]);const f=s.useRef(performance.now());s.useEffect(()=>{const V=performance.now();e===N.Speaking&&V-f.current>50&&(f.current=V,b.current=b.current.map((R,U)=>R+i[U]))},[e,i]);const[v,h]=sA(iA(N.Listening,e)),[p,w]=sA(iA(N.Speaking,e)),[S,k]=sA(iA(N.Thinking,e)),[y,C]=sA(iA(N.Halted,e)),[E,I]=s.useState(performance.now()/1e3);s.useEffect(()=>{const V=setInterval(()=>{I(performance.now()/1e3)},50);return()=>clearInterval(V)},[]);const j=s.useMemo(()=>performance.now()/1e3,[]),[tA,X]=s.useState(1e5),z=s.useRef(e);s.useEffect(()=>{e===N.Connecting?X(1e5):z.current===N.Connecting&&X(E),z.current=e},[e,E]);const O=pt(n),W=n?i:a,K=v===1||p===1,mA=vt({viewport:l,canvasSize:m.current,shouldMeasurePerf:K,source:"VoiceMode"}),L=bt({shouldCalibrate:K,viewport:l,initialScale:1}),H={time:E-j,micLevel:t,stateListen:v,listenTimestamp:Math.max(h-j,0),stateThink:S,thinkTimestamp:Math.max(k-j,0),stateSpeak:p,speakTimestamp:Math.max(w-j,0),readyTimestamp:tA-j,stateHalt:y,haltTimestamp:Math.max(C-j,0),touchDownTimestamp:0,touchUpTimestamp:0,stateFailedToConnect:0,failedToConnectTimestamp:0,avgMag:W,cumulativeAudio:r??b.current,isNewBloop:!0,isAdvancedBloop:n,bloopColorMain:Array.from(O.bloopColorMain),bloopColorLow:Array.from(O.bloopColorLow),bloopColorMid:Array.from(O.bloopColorMid),bloopColorHigh:Array.from(O.bloopColorHigh),isDarkMode:c,screenScaleFactor:window.devicePixelRatio,viewport:l,silenceAmount:0,silenceTimestamp:0,fadeBloopWhileListening:!1};return o.jsx(xt,{className:cA("flex items-center justify-center",A),vert:Ct,frag:kt,variables:H,onViewportUpdate:g,GLUniformsSetter:Et,textureImage:Bt,textureName:"uTextureNoise",onGlAvailable:mA,onCanvasSizeUpdate:u,scale:L})}const Lo=({conversationId:A})=>{const e=AA(),[t,n]=s.useState(!1),[i,r]=s.useState(!1),c=s.useCallback(()=>{e&&e.length>0&&e.forEach(m=>{const{publication:u}=m;u.audioTrack instanceof DA?(r(u.audioTrack.isMuted),u.audioTrack.mute()):u.audioTrack instanceof CA&&u.audioTrack.setMuted(!0)})},[e]),a=s.useCallback(()=>{e&&e.length>0&&e.forEach(m=>{const{publication:u}=m;u.audioTrack instanceof DA?i||u.audioTrack.unmute():u.audioTrack instanceof CA&&u.audioTrack.setMuted(!1)})},[e,i]),l=()=>{q.voiceSelectionShown.click(),c(),n(!0)},d=()=>{a(),n(!1)};return o.jsxs(o.Fragment,{children:[o.jsx(eA,{onClick:l,icon:Fe,iconColor:"text-token-text-tertiary",className:"h-[40px] w-[40px] bg-transparent hover:bg-black/10 active:bg-black/20 dark:bg-transparent dark:hover:bg-white/5 dark:active:bg-white/10",iconSize:"icon-md"}),t&&o.jsx(St,{conversationId:A,onClose:d})]})};class Uo extends Worker{constructor(e,t){const n=String(e);super(n.includes("://")&&!n.startsWith(location.origin)?URL.createObjectURL(new Blob([`import("${n}")`],{type:"text/javascript"})):e,t)}}const Po=new Uo(new URL("https://cdn.oaistatic.com/assets/livekit-client.e2ee.worker-DK0iMXIf.js",import.meta.url),{type:"module"}),qo=s.memo(function({children:e}){const t=s.useRef({keyProvider:new rt}).current,[n,i]=s.useState(!1),{token:r,url:c,e2eeKey:a}=B(u=>u.credentials),l=ct(),d=B(u=>u.isVoiceModeActive),m=B(u=>u.audioInputDevice?.deviceId);return s.useEffect(()=>{const u=r&&c&&a;!n&&u?t.keyProvider.setKey(a).then(()=>{i(!0)}):n&&!u&&i(!1)},[r,c,a,n,t]),d?o.jsxs(Vt,{...l,connect:!0,token:r??void 0,serverUrl:c??void 0,audio:{deviceId:{ideal:m,exact:m},noiseSuppression:!0,echoCancellation:!0},options:{e2ee:{keyProvider:t.keyProvider,worker:Po}},children:[e,n&&r&&c&&o.jsx(dt,{}),n&&r&&c&&o.jsx(no,{})]}):null});function hn({conversationId:A,currentModelId:e,isActiveWindow:t}){const[n,i]=s.useState(!1),r=B(g=>g.isVoiceModeActive),c=B(g=>g.server.voiceConnectionQuality),a=qe(),l=B(g=>g.screenshare!=null),d=B(g=>g.video!=null),m=D(),u=ie();return ye(u),s.useEffect(()=>{if(!t)return;const g=new lo;return r?g.enable():g.disable(),()=>{g.disable()}},[r,t]),t&&o.jsxs(qo,{children:[o.jsx(J,{children:r?o.jsx(M.div,{className:"fixed left-0 top-0 z-50 flex h-full w-full flex-col bg-token-main-surface-primary",initial:"hidden",animate:"visible",exit:"hidden",variants:aA,children:o.jsxs(M.div,{className:"relative h-full w-full",variants:aA,children:[o.jsxs(M.div,{variants:aA,className:"flex h-full w-full flex-col justify-between gap-6",children:[o.jsxs(M.div,{className:"relative mt-6 flex w-full justify-center",children:[o.jsx("div",{className:"flex w-full items-center justify-center",children:(l||d)&&o.jsx(GA,{className:"h-16 w-16"})}),o.jsx("div",{className:"mr-4",children:o.jsx(Lo,{conversationId:A})})]}),o.jsxs("div",{className:"flex h-full min-h-0 items-center justify-center",children:[o.jsx(Ro,{children:o.jsx(GA,{className:"h-max min-h-52 w-max min-w-52"})}),o.jsx(J,{children:n?o.jsx(yo,{conversationId:A}):null})]}),o.jsx(M.div,{className:"mb-6 flex justify-center",children:o.jsx(ho,{conversationId:A,currentModelId:e})})]}),o.jsx(M.div,{className:"absolute bottom-0 right-0 flex w-auto items-center justify-end p-4",variants:aA,children:a?o.jsx(ze,{onClick:()=>i(g=>!g),icon:Je}):null})]})}):null}),c===$A.Poor&&o.jsx("div",{className:"absolute left-1/2 top-6 z-50 -translate-x-1/2 transform",children:o.jsx("div",{className:"inline-flex flex-col items-center rounded-full border border-token-border-light bg-token-main-surface-primary px-6 py-3",children:o.jsx("span",{className:"text-token-text-secondary",children:m.formatMessage({id:"YE2Eng",defaultMessage:"Poor connection"})})})})]})}const aA={hidden:{opacity:0,transform:"blur(4px)"},visible:{transform:"blur(0px)",opacity:1},exit:{opacity:0,transform:"blur(4px)"}};export{hn as VoiceModeLayout};
//# sourceMappingURL=iv6c1fcd2v8dxcvo.js.map
