import{e_ as ae,e$ as B,cq as ce,f0 as T,r as y,dl as le,ax as de,f1 as fe,P as W,f2 as ye,u as f,e4 as U,as as Y,aw as A,R as Z,X as me,cN as ge,e8 as pe,bw as he,ag as Me,a7 as O,d5 as X,E as S,F as q,bQ as $}from"./mes9pjafgq4ysvv4.js";import{c7 as J,ad as x,bN as _e,dR as ze,dS as Se,dT as Ge,dU as Ce,dV as V,bU as Pe,dW as qe,dX as E,aK as a,dY as ve,b7 as Fe,b8 as Ee,dZ as Te,d_ as Le}from"./jzd4qawnakryydim.js";import{T as D,r as Re,d as be}from"./fj2c5r0zs89uwg6u.js";function we({clientThreadId:e}){var i;const r=D.getThreadCurrentLeafId(e),n=((i=D.getTree(e).getMessage(r).metadata)==null?void 0:i.model_switcher_deny)??[],s={};n.forEach(u=>{const{slug:d,context:c,reason:l,description:g}=u,m=s[d]??{},h=m[c]??[];h.push({reason:l,description:g}),m[c]=h,s[d]=m});const o=ae();for(const{resets_after:u,model_slug:d}of o)[B.CONVERSATION,B.REGENERATE].forEach(c=>{const l=s[d]??{},g=l[c]??[],m={reason:ce.RATE_LIMIT,resetsAfter:u};g.push(m),l[c]=g,s[d]=l});return s}const Ye="text-davinci-002-render-sha",Ze="gpt-4",Xe="gpt-4o",Je="o1-preview",er="o1-mini",Q=J({slug:x,max_tokens:4097,title:"Default",description:"",tags:[T.GPT_3_5],product_features:{}}),De=({default_model:e,tagline:r,color:t,human_category_name:n,category:s,human_category_short_name:o,human_category_shorter_name:i,subscription_level:u,short_explainer:d,subcategory:c,...l})=>({color:t,tagline:r,defaultModel:e,label:n,shortLabel:o,description:d,shorterLabel:i??o,subscriptionLevel:u,categoryId:s,subcategory:c,...l}),Qe=({icon:e,icon_filled_src:r,icon_outline_src:t})=>({iconName:e,iconFilledSrc:r,iconOutlineSrc:t}),Ae=({group:e,human_group_name:r,human_group_short_name:t,model_ids:n})=>({group:e,label:r,shortLabel:t,modelIds:n});function Ke(){return A({retry:5,queryKey:["modelIcons"],queryFn:async()=>await Z.getModelIcons().then(e=>Object.fromEntries(Object.entries(e).map(([r,t])=>[r,Qe(t)])))})}function Ie(e){return A({retry:5,queryKey:["models",{isHistoryDisabled:e}],queryFn:async()=>await Z.getModels(e).then(r=>{const{models:t,internal_groups:n,categories:s}=r,o=t.map(J);return{categories:s.concat().reverse().map(De),groups:(n==null?void 0:n.map(Ae))??[],modelsList:o,modelsMap:Object.fromEntries(o.map(i=>[i.id,i]))}})})}function v(){const e=ye();return f(Ie(e))}function rr(){return f(Ke())}function Ue({isRegen:e=!1}={}){const{isLoading:r,data:{categories:t=[],groups:n=[]}={}}=v(),s=y.useMemo(()=>e?t.filter(o=>o.is_regenerate_category!==!1):t.filter(o=>!o.is_regenerate_category),[t,e]);return{isLoading:r,categories:s,groups:n??[]}}function tr(){const{categories:e}=Ue();return!!e.find(({categoryId:r})=>r===_e.GPT4o)}function nr(){const{data:e}=v();return y.useMemo(()=>e?new Set(Object.keys(e.modelsMap)):new Set([x]),[e])}const Oe={[x]:Q};function xe(){const{data:e}=v();return(e==null?void 0:e.modelsMap)??Oe}function ee(e,r,t){let n=T.GPT_3_5;return t?n=T.GPT_4:r&&(n=T.GPT_4o),(e==null?void 0:e.modelsList.find(s=>s.tags.includes(n)))??(e==null?void 0:e.modelsList[0])??Q}function sr(e=!1){const r=le(),t=de(),[,n]=fe();return y.useCallback(({location:s,modelId:o})=>{const i=r.pathname.includes("/g/");e||i?(W.logNewChatButtonClicked({location:s}),t({pathname:"/",search:`?model=${encodeURIComponent(o)}`})):(n(u=>(u.set("model",encodeURIComponent(o)),u)),W.logNewChatButtonClicked({location:s}))},[e,r,t,n])}function or(){const{data:{categories:e=[]}={}}=v(),{doesUserHaveAnyAccountsWithPlusFeatures:r}=U();if(r)return null;const t=e.find(ze);return(t==null?void 0:t.defaultModel)??null}function Ne(e){return Re(e)}function re(e){const r=Ne(e),t=xe();return y.useMemo(()=>r==null?Q:t[r]??Q,[r,t])}function ir(e,r){var n;return((n=re(e).enabledTools)==null?void 0:n.includes(r))??!1}function ur(e){const r=Se(),t=re(e),n=y.useMemo(()=>!r.isSuccess||!r.data?[]:r.data,[r.data,r.isSuccess]),s=we({clientThreadId:e});return y.useMemo(()=>{const i=new Set(t.enabledTools||[]);return n.filter(u=>!(!(u.requiredFeatures.length===0||u.requiredFeatures.every(l=>i.has(l)))||!(u.requiredModels.length===0||u.requiredModels.some(l=>!s[l]))))},[n,t,s])}function ar(e){return decodeURIComponent(e.model??"")||null}function cr(){const{data:e}=v(),{doesUserHaveAnyAccountsWithPlusFeatures:r}=U(),t=Y();return ee(e,!!r,!!(t!=null&&t.isEnterprise()))}const te="q",He="m";function lr(e){const{clientThreadId:r,currentLeafId:t,handleRequestCompletion:n}=e,s=y.useRef(!1),{isLoading:o,data:i}=v(),{doesUserHaveAnyAccountsWithPlusFeatures:u,isLoading:d}=U(),c=Y(),l=me(),g=y.useCallback((M,G,_,C)=>{D.updateTree(r,P=>{P.addNode(M,_,G,ge.User,void 0,C)})},[r]),m=y.useCallback(async(M,{content:G,attachments:_},C,P,F,b)=>{const I=t,p=_.length>0?{attachments:_}:{};p.system_hints=P.systemHints,g(M,I,G,p),n({type:pe.Next,promptId:M,requestedModelId:b,eventMetadata:C,cancelActiveRequests:!0,completionMetadata:P,turnTracker:F})},[g,n,t]),h=he(()=>window.location.pathname)??null,N=Ge();let H=!o&&!d&&h!=null;const[K,R]=y.useState(!0);return y.useEffect(()=>{if(!K||s.current)return;const M=be.getConversationMode(r);if(!H||M==null)return;if(!Be(h)||ke(h)&&N===void 0||D.getServerThreadId(r)!=null){R(!1);return}const{[te]:G,[He]:_,[qe]:C,...P}=l.query,F=(typeof G=="string"?G:null)??(typeof _=="string"?_:null);if(!F||!F.trim()){R(!1);return}const b=Ce(C),I=Me();s.current=!0;let p=i==null?void 0:i.modelsList;b.has(V.Search)&&(p=p==null?void 0:p.filter(ue=>{var k;return(k=ue.enabledTools)==null?void 0:k.includes(V.Search)}));const w=i&&ee({...i,modelsList:p??[]},!!u,!!(c!=null&&c.isEnterprise()));if(l.replace({query:P},void 0,{shallow:!0}),w==null){O.warning("No model available for this request"),R(!1);return}const ie=new Pe;m(I,{content:F,attachments:[]},{eventSource:"url"},{conversationMode:M,source:"instant-query",systemHints:C?Array.from(b):void 0},ie,w==null?void 0:w.id),R(!1)},[o,d,H,h,l,i,u,c,m,K,r,N]),K}function ke(e){return ne(e)}function ne(e){return e==null?!1:/^\/g\/[\w-]+$/.test(e)}function Be(e){return e==null?!1:e==="/"||ne(e)}const dr="GPT Builder";function fr(e){if(e)return`ChatGPT - ${e}`}function se(e){return e.gizmo.short_url??e.gizmo.id??"-"}function oe(e){return`/g/${e}`}function yr(e){return`https://chatgpt.com${oe(e)}`}function We(e){return oe(se(e))}function mr(e,r){const t=new URLSearchParams;return r!=null&&t.set(te,r),ve(new URL(`${We(e)}?${t}`,"https://chatgpt.com"))}function gr(e){return`/g/${se(e)}`}function pr(e){return Fe(e)&&e.gizmo.live_version===0||Ee(e)&&e.liveVersion===0}function hr(e,r){return f({queryKey:["gizmos","discovery",{locale:e,isAnon:r}],queryFn:async()=>a.getGizmoDiscovery(e,r)})}function Mr({cutId:e,locale:r,limit:t,cursor:n,enabled:s=!0}){return X({queryKey:["gizmos","discovery",{cutId:e,locale:r,limit:t}],queryFn:async({pageParam:o})=>a.getGizmoDiscoveryCut(e,{locale:r,cursor:o,limit:t}),initialPageParam:n,getNextPageParam:o=>o.list.cursor??void 0,enabled:s})}function _r(){return f({queryKey:["gizmos","pinned"],queryFn:async()=>a.getGizmoPinned()})}function L(){return A({queryKey:["gizmos","bootstrap"],queryFn:async()=>a.getGizmoBootstrap().then(e=>({gizmos:e.gizmos.map(r=>({resource:r.resource,flair:r.flair}))}))})}function zr(){return f(L())}function j(e,r){const t=e.filter(s=>s.resource.gizmo.id!==r.resource.gizmo.id);let n=t.findIndex(s=>s.flair.kind===E.Recent);return n===-1&&(n=t.length),t.splice(n,0,r),t}const Sr={handleGizmoInteracted(e,r){const t=e.getQueryData(z(e,r).queryKey);t!=null&&e.setQueryData(L().queryKey,n=>{if(n==null)return n;const s=n.gizmos.find(o=>o.resource.gizmo.id===r);return(s==null?void 0:s.flair.kind)===E.FirstParty||(s==null?void 0:s.flair.kind)===E.SidebarKeep?n:{gizmos:j(n.gizmos,{resource:t,flair:{kind:E.Recent}})}})},handleGizmoSidebarKeep(e,r){const t=e.getQueryData(z(e,r).queryKey);t!=null&&e.setQueryData(L().queryKey,n=>n==null?n:{gizmos:j(n.gizmos,{resource:t,flair:{kind:E.SidebarKeep}})})},handleGizmoSidebarHide(e,r){e.setQueryData(L().queryKey,t=>t!=null&&t.gizmos.some(n=>n.resource.gizmo.id===r)?{gizmos:t.gizmos.filter(n=>n.resource.gizmo.id!==r)}:t)}};function Gr(e,r=!1){const t=S();return f(z(t,e,r))}function Cr({gizmoId:e,draft:r,version:t}){const n=S(),s=t?{queryKey:["gizmo","version",{gizmoId:e,version:t}],queryFn:async()=>a.getVersion({gizmoId:e,version:t}),enabled:e!=null}:z(n,e,r);return f(s)}function Pr(e,r){return f({queryKey:["gizmo","userActionSettings",{gizmoId:e}],queryFn:async()=>a.getUserActionSettings(e),enabled:e!=null&&r})}function z(e,r,t=!1){return A({queryKey:["gizmo",{gizmoId:r},{draft:t}],queryFn:async()=>a.getGizmo(r,t),enabled:r!=null,initialData:()=>{var o,i;if(t===!0)return;const n=e.getQueryData(L().queryKey);if(n!=null)return(o=n.gizmos.find(u=>u.resource.gizmo.id===r))==null?void 0:o.resource;const s=e.getQueryData(["gizmos","discovery"]);if(s!=null)for(const u of s.cuts){const d=(i=u.list.items.find(c=>c.resource.gizmo.id===r))==null?void 0:i.resource;if(d!=null)return d}}})}function qr(e,r){return e.fetchQuery(z(e,r))}function vr(e){return f({queryKey:["gizmo",{search:e}],queryFn:async()=>a.getGizmoSearch(e),enabled:e.length>0})}function Fr(e,r){return f({queryKey:["gizmo-search-workspace",{search:e}],queryFn:async()=>a.getGizmoSearchForWorkspace(e),enabled:e.length>0&&r})}function Er(e,r=!1,t=!1,n=null){return X({queryKey:[t?"gizmo-search-workspace":"gizmo",{query:e,cursor:n}],queryFn:async({pageParam:s})=>t?a.getGizmoSearchForWorkspace(e,n=s):a.getGizmoSearch(e,n=s),initialPageParam:n,getNextPageParam:s=>s.cursor??void 0,enabled:r})}function Tr(){const e=S();return q({mutationFn:async({gizmoId:r,editorData:t})=>{const{instructions:n,name:s,description:o,profilePictureId:i,profilePictureUrl:u,promptStarters:d,tools:c,files:l,trainingDisabled:g}=t;return a.upsertDraft({instructions:n,display:{name:s,description:o,profile_pic_id:i,profile_picture_url:u,prompt_starters:d},tools:c,files:l.map(m=>({...m,location:Te.FILE_SERVICE})),training_disabled:g},r)},onSettled:r=>{r&&(e.setQueryData(z(e,r.gizmo.id,!0).queryKey,r),e.invalidateQueries({queryKey:["gizmos","mine"],refetchType:"none"}))}})}function Lr(){const e=S();return q({mutationFn:async({gizmoId:r,data:t})=>{const{sharingRecipient:n,categories:s}=t,o=await a.promoteDraft({sharing:t.sharingSubjects&&t.sharingSubjects.length>0?t.sharingSubjects:{recipient:n},categories:s},r);if(o.error)throw new Le(o);return o.resource},onSettled:r=>{e.invalidateQueries({queryKey:["gizmos"],refetchType:"all"}),e.invalidateQueries({queryKey:["gizmos","pinned"],refetchType:"none"}),r&&e.setQueryData(z(e,r.gizmo.id,!1).queryKey,r)}})}function Rr(){const e=S();return q({mutationFn:async({gizmoId:r})=>a.deleteGizmo(r),onSettled:()=>{e.invalidateQueries({queryKey:["gizmos"],refetchType:"all"})}})}function br(){const e=S();return q({mutationFn:async({name:r,hideName:t,websiteUrl:n,willReceiveSupportEmails:s})=>a.updateBuilderProfile({name:r,hide_name:t,website_url:n,will_receive_support_emails:s}),onSuccess:r=>{e.setQueryData(["builderProfile"],r)},onError:r=>{O.warning(r.message)}})}function wr(){return f({queryKey:["builderProfile"],queryFn:async()=>a.getBuilderProfile()})}function Dr(){return q({mutationFn:async({gizmoId:e})=>a.copyGizmo({gizmoId:e})})}function Qr(){return f({queryKey:["gizmoCategories"],queryFn:async()=>a.getCategories()})}function Ar(e,r){return!!(r!=null&&[$.PrimaryAssistant,$.GizmoInteraction].includes(r)&&(e!=null&&e.includes(T.GPT_4)))}function Kr(e,r){const t=S();return q({mutationFn:async({rating:n,message:s,includeFrom:o})=>{await a.upsertUserReview(e,n,s,o)},onSuccess:async()=>{t.invalidateQueries({queryKey:["gizmo","review",{gizmoId:e}]})},onError:n=>{O.danger(n.message)}})}export{we as A,vr as B,Fr as C,Er as D,hr as E,ar as F,Xe as G,xe as H,or as I,ir as J,lr as K,wr as L,br as M,Qr as N,Cr as O,Ze as P,Tr as Q,Lr as R,Ye as S,z as T,qr as U,ur as V,Ar as W,dr as X,Je as Y,er as Z,Ne as a,sr as b,Ue as c,Gr as d,tr as e,oe as f,We as g,Kr as h,Rr as i,gr as j,pr as k,zr as l,Sr as m,Mr as n,_r as o,fr as p,yr as q,mr as r,se as s,Dr as t,cr as u,Pr as v,rr as w,v as x,nr as y,re as z};
//# sourceMappingURL=cn2p9twdfq0duu5j.js.map
