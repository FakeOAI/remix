import{c as f,D as o,f as h}from"./j18nlqm348px4nxa.js";import{d as i,c as p}from"./hc8non16qyh1ycvz.js";function l(r,e){if(Object.is(r,e))return!0;if(typeof r!="object"||r===null||typeof e!="object"||e===null)return!1;if(r instanceof Map&&e instanceof Map){if(r.size!==e.size)return!1;for(const[t,s]of r)if(!Object.is(s,e.get(t)))return!1;return!0}if(r instanceof Set&&e instanceof Set){if(r.size!==e.size)return!1;for(const t of r)if(!e.has(t))return!1;return!0}const n=Object.keys(r);if(n.length!==Object.keys(e).length)return!1;for(const t of n)if(!Object.prototype.hasOwnProperty.call(e,t)||!Object.is(r[t],e[t]))return!1;return!0}class x extends Error{constructor(e){super(e),this.name="WebsocketConnectError"}}class d extends Error{constructor(e){super(e),this.name="TurnError"}}class y extends Error{constructor(e){super(e),this.name="TurnDeltaMessageError"}}function T(r){return r?r.model_response?.text!=null&&r.model_response.text.length>0:!1}function a(r){return r.execution_status==="fatal_system_error"}function g(r){return r.execution_status==="in_progress"||r.execution_status===null}function k(r){return u(e=>e.thread?.turns.map(n=>r.reduce((t,s)=>(t[s]=n[s],t),{}))??[],(e,n)=>{if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(!l(e[t],n[t]))return!1;return!0})}function O(){return u(r=>p(r.thread?.turns.flatMap(e=>e.model_response?.citations)),l)}const c={thread:null,error:void 0},u=f(h(()=>({...c}))),m=i(()=>{o.addError(new d("got updateTurn with no current thread"))},1e3),E=i(r=>{o.addError(new d("turn not found"),{turnIndex:r})},1e3),v={threadId:r=>r.thread?.id??null,turns:r=>r.thread?.turns??[],turnCitations:r=>e=>e.thread?.turns[r].model_response?.citations??[],hasResponse:r=>T(r.thread?.turns[0]),firstTurn:r=>r.thread!=null?r.thread.turns[0]:void 0,lastTurn:r=>r.thread!=null?r.thread.turns[r.thread.turns.length-1]:void 0,numTurns:r=>r.thread?.turns.length??0,isLastTurnStreaming:r=>{const e=r.thread!=null?r.thread.turns[r.thread.turns.length-1]:void 0;return e!=null&&g(e)},hasModelResponseText:r=>r.thread?.turns[0]?.model_response?.text!=null,hasFirstTurnError:r=>{const e=r.thread?.turns[0];return!!e&&a(e)},hasTurnError:r=>r.thread?.turns.some(a)??!1,threadError:r=>r.error,__deprecated_sportsWidget:r=>r.thread?.turns[0]?.sports_widget??null},w={appendTurn(r,e,n){u.setState(t=>{t.thread?.id!==r&&(n?.(r),t.thread={id:r,turns:[]}),t.thread.turns.push(e)})},updateTurn(r,e){u.setState(n=>{const t=n.thread;if(!t){m();return}const s=t.turns[r];if(!s){E(r);return}e(s)})},clearThread(){u.setState(()=>({...c}))},setError(r){u.setState(e=>{e.error=r})},setThread(r,e){u.setState(n=>{n.thread={id:r,turns:e}})}};export{w as T,x as W,v as a,k as b,O as c,a as d,d as e,y as f,g as i,u};
//# sourceMappingURL=le7oo4g1e07b7pk3.js.map
