import{e$ as S,K as N,r as d,l as n,cz as G,f0 as B,m as q,f1 as P}from"./dwkd3b3c7kg0ot7l.js";import{fc as Y,fd as K,ar as g,fe as $,ei as X,ff as Z,fg as J,fh as Q,fi as tt,fj as et,fk as st,fl as at,fm as ot,fn as nt,fo as _,fp as it,fq as O,fr as rt,aD as R,fs as ct,ft as dt,fu as lt,ap as ut,fv as pt,fw as D,Z as M,aj as ft,fx as W}from"./ok65lib68mghk0mk.js";import{u as mt}from"./dadspj7w6s0uxtqd.js";import{T as ht}from"./hkhdxbc62d8gtfme.js";import{w as xt,j as gt,C as vt,D as Ct}from"./lmc4wszvjl4gg292.js";import{m as f}from"./f38uk28ff9agi8mz.js";import"./byou0827mflm7tmy.js";import"./nov0yn9oognrye5r.js";import"./hvq6t2g1yzf639ud.js";import"./lr2e0u44irbds248.js";import"./keqh8ykquezethwp.js";import"./npagvawotm2a2fuv.js";import"./gsrrrfwrll6omvj2.js";import"./jfafu17xv0t0ph5c.js";import"./jgynwps4grrtjuwd.js";import"./crdkvhpm20732qse.js";import"./fu3ryqoahzknp7ja.js";import"./hlvxig13m5klar56.js";import"./f951nj7xj9fa0dur.js";import"./e2314vj44ufzou3t.js";import"./6acrzrf3fj3w2cdj.js";import"./fzrn137102spawew.js";import"./e0jtggszd8qi3wlk.js";import"./fjyai0yj4sjn20md.js";const F="oai/apps/canmoreSidebarWidth",bt=.25,wt=400,k=400;function L(t){return t-wt}function w(t,o){return K(k,L(t),o??bt*t)}function yt(){const t=S.useState(S.selectWindowWidth),o=w(t,Y(N.DANGER_SECRET_FOLDERS_ONLY_getItem(F))),s=A(),[e,i]=d.useState(o);d.useEffect(()=>{(e<k||e>L(t))&&i(w(t,e))},[t]);function a(r){i(m=>w(t,m+=r.delta.x))}function c(r){i(r),N.DANGER_SECRET_FOLDERS_ONLY_setItem(F,r)}function l(){const r=w(t,void 0);c(r)}const p=`calc(100vw - ${e}px)`;return s?{chatWidth:e,canvasWidth:t-e,canvasWidthCalc:p,viewportWidth:t,handleDrag:a,handleDoubleClick:l,persist:c}:{chatWidth:0,canvasWidth:t,canvasWidthCalc:"100vw",viewportWidth:t,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function A(){return S.useState(t=>S.selectWindowWidth(t)>1e3)}function St(t,o){let s;return o?.type===g.Textdoc&&(s={type:"canvas_textdoc",id:o.textdocId}),{...t,messageMetadata:{...t.messageMetadata,open_in_canvas_view:s}}}const z=({isFullScreen:t=!1,clientThreadId:o,focusedObject:s,onClose:e,isAnimating:i=!1,width:a})=>{const{setTargetedContent:c}=$(),l=d.useRef(!1);if(d.useEffect(()=>(l.current&&c(void 0),l.current=!0,()=>{l.current=!1}),[s]),s==null)return null;switch(s.type){case g.Textdoc:return n.jsx(ht,{isFullScreen:t,onClose:e,clientThreadId:o,focusedTextdoc:s,isAnimating:i,width:a});case g.ADAVisualization:return null}},Tt=300,It=t=>t?.type===g.Textdoc?t.textdocId:null;function Et(t){const o=xt(t),s=X(o),e=gt(t),i=vt(t,e),a=Ct({clientThreadId:t,conversationLeafId:e}),c=Z(),[l,p]=d.useMemo(()=>{let x;return!a&&i&&(x=J(Q(i.messages))),At(s,c,x)},[a,i,s,c]),r=p!=null,m=It(p);d.useEffect(()=>{if(p&&l&&(tt(p,l),p.type===g.Textdoc)){const{textdocId:x}=p,T=it(x);et(document.getElementById(T))}},[r,m])}function At(t,o,s){switch(s?.type){case st.Canmore:{const[e,i]=s.messages;if(!at(e?.message))break;const a=ot(t,e.message,i?.message??null),c=a.textdocId??o;if(c&&(a.function===nt.CreateTextdoc?(a.content??"").length>Tt||a.status===_.WAITING:a.status===_.STREAMING))return[a.messageId,{type:g.Textdoc,textdocId:c}];break}}return[void 0,null]}const jt=260,y={type:"spring",bounce:.12,duration:.64},Nt={type:"spring",bounce:0,duration:.58},_t=({clientThreadId:t,focusedObject:o,onClose:s})=>{const{chatWidth:e,canvasWidthCalc:i,handleDrag:a,handleDoubleClick:c,persist:l}=yt(),[p,r]=d.useState(!0),[m,x]=d.useState(!1),T=R(u=>u.activeSidebar),I=ct(({rect:u})=>u),{windowHeight:v,windowWidth:C}=B(u=>u,{windowWidth:0,windowHeight:0});let h=I??{top:0,left:e,width:C-e,height:v},j=!1;if(I&&(h.top<0||h.top+h.height>v)){j=!0;const u={width:(C-e)*.75,height:v*.75};h={top:v/2-u.height/2,left:(C-e-u.width)/2+e,width:u.width,height:u.height}}const b=I?.borderRadius,E=dt(),H=E?.history!=null||E?.showChangesAtVersion!=null,U=R(u=>u.isDesktopNavCollapsed);return n.jsxs(n.Fragment,{children:[H&&n.jsx(f.div,{className:"fixed inset-0 z-20 bg-gray-50/50 dark:bg-black/50",initial:{opacity:0},animate:{opacity:1},onClick:()=>lt(E.textdocId)}),n.jsxs(f.div,{initial:{marginRight:U?0:-jt},animate:{marginRight:0},transition:Nt,children:[n.jsx(f.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:{...y,delay:.22},className:"pointer-events-none absolute left-0 top-0 z-20 h-full w-full bg-token-main-surface-primary"}),n.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"pointer-events-none absolute left-0 top-0 z-10 h-full w-full bg-black/[0.025] dark:bg-transparent"}),n.jsx(f.div,{className:"relative z-20 h-full",style:{width:i},exit:{width:0},transition:{type:"spring",bounce:0,duration:.1}})]}),n.jsx(f.div,{className:q("absolute z-20 h-full overflow-hidden transition-shadow",T==="debug"?"md:left-[-250px] lg:left-[-300px] xl:left-[-350px] 2xl:left-[-400px]":"left-0"),initial:{opacity:j?0:1,x:h.left,y:h.top,width:h.width,height:h.height,borderRadius:b,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},animate:{opacity:1,x:e,y:0,width:i,height:"100%",borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:{opacity:{duration:.14,bounce:.1}},borderRadius:b,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:m?{duration:0}:y,onAnimationComplete:()=>r(!1),children:n.jsx(f.div,{className:"h-full overflow-hidden border-l border-gray-100 dark:border-token-border-medium",initial:{borderRadius:b},animate:{borderRadius:0},exit:{borderRadius:b},transition:y,children:n.jsxs("div",{className:"h-full",children:[n.jsx(f.div,{drag:"x",className:"absolute left-[-2px] z-10 h-full w-[4px] cursor-ew-resize bg-token-text-quaternary opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onDrag:(u,V)=>{x(!0),a(V)},onDragEnd:()=>{x(!1),l(e)},onDoubleClick:()=>c()}),n.jsx(z,{onClose:s,clientThreadId:t,isAnimating:p,focusedObject:o,width:C-e})]})})})]})},Rt=d.memo(_t),Dt=({clientThreadId:t,focusedObject:o,onClose:s})=>{const e=A();return n.jsx(P,{children:n.jsx(f.div,{className:"fixed inset-0 z-20 overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},exit:e?void 0:{opacity:0,scale:.98},transition:y,children:n.jsx(z,{isFullScreen:!0,clientThreadId:t,focusedObject:o,onClose:s})})})},Mt=({clientThreadId:t})=>{const o=A(),s=mt(t);Et(t);const e=ut(),i=pt(({resolveTempTextdocId:r})=>r),a=d.useMemo(()=>{let r=e;if(e?.type===g.Textdoc){const m=i?.[e.textdocId];m&&(r={...e,textdocId:m})}return r},[e,i]);d.useEffect(()=>{O()},[t]);const c=a&&(o?n.jsx(Rt,{clientThreadId:t,onClose:W,focusedObject:a},"canvas-sidebar"):n.jsx(Dt,{clientThreadId:t,onClose:W,focusedObject:a},"canvas-modal"));d.useEffect(()=>{if(a)return D(r=>St(r,a)),()=>D(null)},[a,i]);const l=c!=null;return d.useEffect(()=>(M.setActiveStageSidebar(l),()=>M.setActiveStageSidebar(!1)),[l]),s!==t?null:n.jsx(ft,{children:c})},oe=t=>{const o=d.useRef(null);return n.jsx(G,{ref:o,onError:(s,e)=>{O(),setTimeout(()=>{o.current?.resetErrorBoundary()}),rt.logError("Error boundary hit",s,{componentStack:e})},name:"canmore-focused-view",children:n.jsx(Mt,{...t})})};export{oe as CanvasFocusedViewManager};
//# sourceMappingURL=jgokvtxp0uop9rkt.js.map
