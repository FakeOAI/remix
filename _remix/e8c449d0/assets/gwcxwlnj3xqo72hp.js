import{c as I,f as N,el as D,bw as L,em as _,ab as P,W as x,en as O,j as F,r as d,a5 as H}from"./ocp1psdvo7s079n6.js";import{T as K}from"./oaq3fl6muamktpp2.js";import{cL as $,cM as q,cN as M,cO as w}from"./rdbylepeccge9tbg.js";const h=I(N(()=>({statusMap:{}}))),Z=a=>h(s=>s.statusMap[a]),z=(a,s)=>{h.setState(e=>{e.statusMap[a]=s;const t=K.getServerThreadId(a);t&&(e.statusMap[t]=s)})},p=a=>{h.setState(s=>{for(const{id:e,async_status:t}of a)t!=null&&(s.statusMap[e]={source:D.SERVER,value:t})})},U=28,k="conversationHistory";function J(a={}){const{buckets:s,recentConversationLimit:e}=a,o=L()?.includes(_)??!1,y=P(),l=!o&&!!y?.data,r=x(),{data:i,fetchNextPage:v,hasNextPage:b,isLoading:g,isFetchingNextPage:S,isError:T}=O({queryKey:[k],queryFn:async({pageParam:n})=>{const u=await F.getConversations({offset:n,limit:U});return p(u.items),u},initialPageParam:0,getNextPageParam:n=>{const u=n.offset+n.limit;return u<n.total?u:void 0},enabled:l}),c=d.useMemo(()=>i?.pages.flatMap(u=>u.items)??[],[i,a]);d.useEffect(()=>{p(c)},[c]);const B=d.useMemo(()=>{if(!i||!s)return[];const n=Q(c,r);return[n.recent,n.dynamicMonths,n.dynamicYears].flatMap(f=>Object.entries(f).map(([Y,{items:A,label:C}],R)=>({key:`${Y}-${R}`,label:C,items:A}))).filter(f=>f.items.length>0)},[c,i,r,s]),E=d.useMemo(()=>{const n=c.slice(0,e??5);return{key:"recents",label:r.formatMessage(m.historyBucketRecent),items:n}},[c,e,r]);return{buckets:B,conversations:c,data:i,fetchNextPage:v,hasNextPage:b,recents:E,isLoading:g,isFetchingNextPage:S,isError:T}}function Q(a,s){return a.reduce((e,t)=>{const o=new Date(t.update_time??t.create_time??0),y=$(new Date,o);if(y===0)e.recent.today.items.push(t);else if(y<=1)e.recent.yesterday.items.push(t);else if(y<=7)e.recent.lastSeven.items.push(t);else if(y<=30)e.recent.lastThirty.items.push(t);else if(q(o)){const l=M(o),r=w(o),i=`${l}-${r}`;e.dynamicMonths[i]?e.dynamicMonths[i].items.push(t):e.dynamicMonths[i]={label:s.formatDate(o,{month:"long"}),items:[t]}}else{const r=`${M(o)}-`;e.dynamicYears[r]?e.dynamicYears[r].items.push(t):e.dynamicYears[r]={label:s.formatDate(o,{year:"numeric"}),items:[t]}}return e},{recent:{today:{label:s.formatMessage(m.historyBucketToday),items:[]},yesterday:{label:s.formatMessage(m.historyBucketYesterday),items:[]},lastSeven:{label:s.formatMessage(m.historyBucketLastSeven),items:[]},lastThirty:{label:s.formatMessage(m.historyBucketLastThirty),items:[]}},dynamicMonths:{},dynamicYears:{}})}function X(a){a.invalidateQueries({queryKey:[k]})}const m=H({historyBucketRecent:{id:"history.bucket.recent",defaultMessage:"Recent"},historyBucketToday:{id:"history.bucket.today",defaultMessage:"Today"},historyBucketYesterday:{id:"history.bucket.yesterday",defaultMessage:"Yesterday"},historyBucketLastSeven:{id:"history.bucket.lastSeven",defaultMessage:"Previous 7 Days"},historyBucketLastThirty:{id:"history.bucket.lastThirty",defaultMessage:"Previous 30 Days"}});export{k as C,Z as a,X as r,z as s,J as u};
//# sourceMappingURL=gwcxwlnj3xqo72hp.js.map
