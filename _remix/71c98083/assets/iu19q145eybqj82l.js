import{L as A,t as q,W as E,r as g,O as me,x as B,m as e,bn as w,b6 as d,cI as Z,M as be,aE as $,K as z,a5 as K,w as X,bS as V,co as G,hj as xe,hk as Y}from"./fyh3ezmixterbdxo.js";import{a as je,b as ve,u as ye,f as Ce}from"./nyj09mtkb6v36rtc.js";import{b as ie,g as L,d as U,e as H,f as W,a as we,A as _e}from"./ouo8dlnkj8lvt1hu.js";import{M as Se,im as oe,cX as fe,gp as Ne,gr as ne,go as Ee,jw as le,fK as ke,jx as Ae,cW as x,h3 as De,cs as Te,J as ee,K as y,U as _,fj as ge,i as Ie,bc as Fe}from"./dgl56pidmg3zd9ce.js";import{a as pe}from"./fanrc9to5bx2ox1c.js";import{S as Re}from"./i3uyhr0nxkd2zo6p.js";import{a as Oe,g as ce}from"./bk6my17bygqu87e9.js";import{S as Le}from"./hqhg7gvqlf7nj66j.js";import{S as C}from"./fz4lezp3euptuev5.js";import"./etv99vp064le2wmi.js";import"./nv0crhinl03gbq5e.js";import"./fhn5vanehookzk93.js";import"./f4z61jf1el16npl2.js";import"./kgurztzslyz429wb.js";import"./bhdki2d2ezz3qv15.js";import"./hqe8ypyv0fjdt85m.js";import"./c4bxzbp1808foto4.js";function Pe({feedbackMetadata:s,currentWorkspaceId:t,onClose:o,onFeedbackActionTaken:i}){const a=A(),{data:r,refetch:n,isLoading:p}=q({queryKey:["adminGetCaMessageFeedback",t,s.feedback_id],queryFn:()=>E.adminGetCaMessageFeedback({accountId:t,feedbackId:s.feedback_id})}),[u,c]=g.useState(!0),S=me(),b=B({mutationFn:l=>l.operation==="delete"?E.adminDeleteCaMessageFeedback({accountId:l.workspaceId,feedbackId:l.feedbackId}):E.adminApproveCaMessageFeedback({accountId:l.workspaceId,feedbackId:l.feedbackId,withSources:l.withSources}),onSuccess:(l,v)=>{i(),o(),S.success(v.operation==="approve"?a.formatMessage(M.feedbackApproved):a.formatMessage(M.feedbackDeleted))},onError:(l,v)=>{n(),S.warning(v.operation==="approve"?a.formatMessage(M.errorApprovingFeedback):a.formatMessage(M.errorDeletingFeedback))}}),N=g.useMemo(()=>{const l=s.review_status==="unreviewed",v=s.review_status==="approved_without_sources_data_available",D=s.review_status==="unreviewed";let j;switch(s.review_status){case"creating":{j=a.formatMessage(M.actionMessageFeedbackCreating);break}case"approved_with_sources":case"approved_without_sources_data_expired":{j=a.formatMessage(M.actionMessageNoActionsAvailable);break}case"approved_without_sources_data_available":{j=a.formatMessage(M.actionMessageApprovedWithoutSources);break}case"deleted":{j=a.formatMessage(M.actionMessageFeedbackDeleted);break}}const F={workspaceId:t,feedbackId:s.feedback_id,withSources:u};return e.jsxs("div",{className:"sticky bottom-0 flex w-full flex-col gap-2 rounded-lg bg-token-main-surface-secondary p-4",children:[e.jsxs("div",{children:[l&&e.jsx(Se,{id:"ca-feedback-review-inlude-sources",label:a.formatMessage(M.labelIncludeSources),checked:u,onChange:R=>c(R.currentTarget.checked)}),j&&e.jsx("p",{children:j})]}),e.jsxs("div",{className:"flex flex-row gap-2",children:[l&&e.jsx(w,{color:"primary",icon:oe,onClick:()=>b.mutate({...F,operation:"approve"}),loading:b.isPending,children:e.jsx(d,{id:"Zq8YOH",defaultMessage:"Approve Feedback"})}),v&&e.jsx(w,{color:"primary",icon:oe,onClick:()=>b.mutate({...F,operation:"approve",withSources:!0}),loading:b.isPending,children:e.jsx(d,{id:"dOOGEc",defaultMessage:"Re-Approve With Sources"})}),D&&e.jsx(w,{color:"danger-outline",icon:fe,onClick:()=>b.mutate({...F,operation:"delete"}),loading:b.isPending,children:e.jsx(d,{id:"qeIjD9",defaultMessage:"Delete Feedback"})})]})]})},[s.review_status,s.feedback_id,u,b,t,a]);return e.jsx(Z,{size:"custom",className:"max-w-lg overflow-y-auto text-base",isOpen:!0,icon:Re,onClose:o,showCloseButton:!0,type:"success",title:a.formatMessage(M.modalTitle),children:e.jsx("div",{className:"flex flex-col",children:r&&!p?e.jsxs(e.Fragment,{children:[e.jsx(Ve,{feedbackData:r,feedbackMetadata:s}),e.jsx(ie,{className:"my-4"}),e.jsx(Ke,{fileRefs:r.file_references}),e.jsx(ie,{className:"my-4"}),e.jsx(Ge,{retrievalMessages:r.retrieval_messages,userDisplayName:s.submitter_display_name??s.submitter_email}),N]}):e.jsx(pe,{lines:8})})})}function Ve({feedbackMetadata:s,feedbackData:t}){const o=A(),i=s.submitter_display_name&&s.submitter_email?o.formatMessage(M.userDisplayName,{displayName:s.submitter_display_name,email:s.submitter_email}):s.submitter_id,a=g.useMemo(()=>t.sources_feedback?Object.entries(t.sources_feedback).map(([r,n])=>{if(!n.rating&&!(n.tags&&n.tags.length>0))return null;const p=t.file_references.find(c=>c.document_id===r)?.title,u=n.tags&&n.tags.length===1&&n.tags[0]===Oe;return e.jsxs("li",{className:"flex flex-col break-words p-1 text-sm",children:[e.jsxs("div",{className:"mb-1 flex flex-row items-center gap-2",children:[n.rating==="thumbsUp"?e.jsx(Ne,{className:"icon-sm"}):n.rating==="thumbsDown"?e.jsx(ne,{className:"icon-sm"}):null,e.jsx("a",{href:n.url??void 0,className:"text-sm font-semibold",children:p??n.url??r})]}),e.jsx("div",{className:"flex flex-row flex-wrap gap-1",children:u?e.jsx("span",{className:"italic",children:e.jsx(d,{id:"yNGc6H",defaultMessage:"This source should have been used."})}):n.tags?.map(c=>e.jsx("div",{className:"rounded-lg border border-token-border-light px-3 py-1 text-xs text-token-text-secondary",children:ce(c,o)},c))})]},r)}).filter(r=>!!r):[],[t.file_references,t.sources_feedback,o]);return e.jsxs("div",{children:[e.jsx("div",{className:"mb-2",children:e.jsx(he,{reviewStatus:s.review_status})}),e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[t.rating==="thumbsUp"?e.jsx(Ee,{className:"icon-xl m-2"}):e.jsx(ne,{className:"icon-xl m-2"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("p",{children:i}),e.jsx("p",{className:"text-xs text-token-text-secondary",children:new Date(s.submitted_at).toLocaleString()})]})]}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"mb-2 flex flex-wrap gap-1",children:t.tags?.map(r=>e.jsx("div",{className:"rounded-lg border border-token-border-light px-3 py-1 text-sm text-token-text-secondary",children:ce(r,o)},r))}),e.jsxs("div",{className:"mb-2",children:[e.jsx(L,{className:"mb-1",children:e.jsx(d,{id:"VrPx6x",defaultMessage:"Feedback"})}),e.jsx("p",{className:"break-words rounded border p-2 text-sm",children:t.text?t.text:e.jsx("span",{className:"italic",children:e.jsx(d,{id:"pEEJ/8",defaultMessage:"No written feedback was provided."})})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx(L,{className:"mb-1",children:e.jsx(d,{id:"LUg6Vl",defaultMessage:"Additional Sources"})}),e.jsx("p",{className:"break-words rounded border p-2 text-sm",children:t.additional_sources?t.additional_sources:e.jsx("span",{className:"italic",children:e.jsx(d,{id:"u24Zo5",defaultMessage:"No additional sources were provided."})})})]}),a.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx(L,{className:"mb-1",children:e.jsx(d,{id:"lNSdNZ",defaultMessage:"Sources Feedback"})}),e.jsx("ul",{className:"flex flex-col gap-1",children:a})]})]})}const Be=["citation","context_stuff","search_result"];function de(s){return Array.from(s.map(t=>Ae({type:"file",id:t.document_id,cloud_doc_url:t.external_url??void 0,name:t.title??"",source:"google_drive",extra:{cloud_doc_url:t.external_url??void 0}})).filter(t=>!!t))}function Ke({fileRefs:s}){const[t,o]=g.useMemo(()=>{const i=new Map,a=new Map;return s.forEach(r=>{Be.includes(r.reference_source)&&r.document_id.startsWith("S")&&r.external_url&&!i.has(r.document_id)?i.set(r.document_id,r):r.reference_source==="user_feedback"&&r.external_url&&!a.has(r.document_id)&&a.set(r.document_id,r)}),[de(Array.from(i.values())),de(Array.from(a.values()))]},[s]);return e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx(L,{className:"mb-2",children:e.jsx(d,{id:"FB4YIA",defaultMessage:"Sources In Conversation"})}),t.length>0?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"mb-2 text-xs text-token-text-secondary",children:e.jsx(d,{id:"L0nY9M",defaultMessage:"These sources were considered or cited in the conversation. Snapshots of these sources will be included with the feedback if you choose to approve the feedback with sources."})}),e.jsx("div",{className:"flex flex-col gap-1",children:t.map(i=>e.jsx(le,{compact:!0,citationMetadata:i},i.url))})]}):e.jsx("p",{className:"text-xs text-token-text-secondary",children:e.jsx(d,{id:"QnY3vg",defaultMessage:"No synced sources were considered or cited in the conversation, however there may be other sources present such as user uploaded files. If you choose to approve this feedback with sources, only the snippets of those files that ChatGPT looked at will be shared with this feedback."})})]}),o.length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsx(L,{className:"mb-2",children:e.jsx(d,{id:"SCwQnr",defaultMessage:"Sources From Feedback"})}),e.jsx("p",{className:"mb-2 text-xs text-token-text-secondary",children:e.jsx(d,{id:"Rr+4KZ",defaultMessage:"The feedback submitter mentioned these documents in their feedback. Snapshots of these documents will be included with the feedback if you choose to approve the feedback with sources and the user had access to them."})}),e.jsx("div",{className:"flex flex-col gap-1",children:o.map(i=>e.jsx(le,{compact:!0,citationMetadata:i},i.url))})]})]})}function Ge({retrievalMessages:s,userDisplayName:t}){return e.jsxs("div",{className:"mb-8",children:[e.jsx(L,{className:"mb-4",children:e.jsx(d,{id:"pOb00r",defaultMessage:"Conversation"})}),s.map(o=>e.jsx(Ue,{message:o,userDisplayName:t},o.id))]})}function Ue({message:s,userDisplayName:t}){const o=A();switch(s.type){case"visible_text":{if(s.author==="unknown")return null;const i={nodeId:s.id,parentId:"",canRetry:!1,message:{id:s.id,author:{role:s.author},metadata:{citations:s.citations,attachments:s.attachments,content_references:s.citations.map(a=>a.metadata?.type!=="file"?null:{start_idx:a.start_ix,end_idx:a.end_ix,matched_text:s.text.slice(a.start_ix,a.end_ix),type:"file",source:a.metadata.source,name:a.metadata.name,id:a.metadata.id,cloud_doc_url:a.metadata.cloud_doc_url??a.metadata.extra?.cloud_doc_url}).filter(a=>!!a)},content:{content_type:be.Text,parts:[s.text]}}};return e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:$("mb-1 text-xs text-token-text-secondary",s.author==="user"?"pr-4 text-end":"text-start"),children:s.author==="assistant"?o.formatMessage(M.authorChatGPT):s.author==="user"?t??o.formatMessage(M.authorUser):s.author}),e.jsx(ke,{message:i,isCompletionInProgress:!1,clientThreadId:"--fake-thread-id--",isUserTurn:s.author==="user",turnIndex:0,isFeedbackEnabled:!1,showEditButton:!1,onEnterEdit:()=>null,onRequestMoreCompletions:()=>null})]})}case"query":return e.jsx("div",{className:"my-2 text-xs text-token-text-primary",children:e.jsx(d,{id:"bJ9BXd",defaultMessage:"ChatGPT performed a search."})});case"result":case"fetch":case"generic_file_search_tool":case"system":case void 0:return null}}function he({reviewStatus:s,onClick:t,disabled:o}){let i;const a=A();switch(s){case"unreviewed":i=a.formatMessage(M.reviewStatusUnreviewed);break;case"creating":i=a.formatMessage(M.reviewStatusCreating);break;case"approved_with_sources":i=a.formatMessage(M.reviewStatusApprovedWithSouces);break;case"approved_without_sources_data_available":case"approved_without_sources_data_expired":i=a.formatMessage(M.reviewStatusApprovedWithoutSources);break;case"deleted":i=a.formatMessage(M.reviewStatusDeleted);break}return e.jsx("button",{className:$("rounded-2xl px-3 py-1 text-sm text-token-text-primary",s==="unreviewed"&&"bg-[#e2c541] dark:bg-[#EA8444]"),onClick:t,disabled:!!o||!t,children:i})}const M=z({modalTitle:{id:"zufVun",defaultMessage:"Review Feedback"},feedbackApproved:{id:"DS+YGt",defaultMessage:"Feedback approved."},feedbackDeleted:{id:"Rz/tmW",defaultMessage:"Feedback deleted."},errorApprovingFeedback:{id:"UVsTlf",defaultMessage:"Encountered an error approving this feedback. Please refresh and try again."},errorDeletingFeedback:{id:"cI6gt9",defaultMessage:"Encountered an error deleting this feedback. Please refresh and try again."},actionMessageFeedbackCreating:{id:"urBely",defaultMessage:"You can't take actions on this feedback yet because it's still being processed. Once it's done processing, it will be available for review."},actionMessageNoActionsAvailable:{id:"JGNhjT",defaultMessage:"This feedback has been reviewed."},actionMessageApprovedWithoutSources:{id:"68PAfK",defaultMessage:"This feedback has already been approved without sources, but you can re-approve it with sources."},actionMessageFeedbackDeleted:{id:"Kel9lE",defaultMessage:"This feedback has been deleted."},labelIncludeSources:{id:"8UlZM0",defaultMessage:"Include Sources"},authorChatGPT:{id:"7Fo5p2",defaultMessage:"ChatGPT"},authorUser:{id:"TpT0hg",defaultMessage:"User"},userDisplayName:{id:"3OKTcX",defaultMessage:"{displayName} ({email})"},reviewStatusUnreviewed:{id:"FEHKZj",defaultMessage:"Needs Review"},reviewStatusCreating:{id:"7lVVU7",defaultMessage:"Preparing for Review"},reviewStatusApprovedWithSouces:{id:"kpZ41g",defaultMessage:"Approved With Sources"},reviewStatusApprovedWithoutSources:{id:"Y0lc+p",defaultMessage:"Approved Without Sources"},reviewStatusDeleted:{id:"gKoYhr",defaultMessage:"Deleted"}});function He({currentWorkspaceId:s}){const{data:t,refetch:o,isLoading:i}=q({queryKey:["adminListCaMessageFeedback",s],queryFn:()=>E.adminListCaMessageFeedback({accountId:s})}),[a,r]=g.useState();return e.jsxs(U,{children:[e.jsx(H,{children:e.jsx(d,{id:"sK+hfD",defaultMessage:"Alpha Feedback"})}),e.jsx(W,{className:"text-[var(--Primary-Gray-600,_#565869)]",children:e.jsx(d,{id:"39A5sH",defaultMessage:"Review feedback your workspace users have submitted for the alpha. Feedback is not shared with OpenAI until you approve it."})}),t&&!i?e.jsx(We,{feedbackList:t.feedback,setSelectedFeedback:r}):e.jsx(pe,{lines:12,widthVariance:0}),a&&e.jsx(Pe,{feedbackMetadata:a,currentWorkspaceId:s,onClose:()=>r(void 0),onFeedbackActionTaken:()=>o()})]})}function ue(s){switch(s){case"unreviewed":return 1;case"creating":return 2;case"approved_with_sources":return 3;case"approved_without_sources_data_available":return 4;case"approved_without_sources_data_expired":return 5;case"deleted":return 6}}function We({feedbackList:s,setSelectedFeedback:t}){const o=g.useMemo(()=>[...s].sort((i,a)=>{const r=ue(i.review_status)-ue(a.review_status);return r!==0?r:i.submitted_at>a.submitted_at?-1:i.submitted_at<a.submitted_at?1:0}),[s]);return e.jsxs(x.Root,{size:"normal",children:[e.jsxs(x.Header,{children:[e.jsx(x.HeaderCell,{className:"bg-token-main-surface-primary",children:e.jsx(d,{id:"KcGNl2",defaultMessage:"Review Status"})}),e.jsx(x.HeaderCell,{className:"w-40 bg-token-main-surface-primary",children:e.jsx(d,{id:"joba0B",defaultMessage:"Submitted By"})}),e.jsx(x.HeaderCell,{className:"w-40 bg-token-main-surface-primary",children:e.jsx(d,{id:"yl1cCR",defaultMessage:"Submitted At"})})]}),e.jsx(x.Body,{children:o.length===0?e.jsx(x.Row,{children:e.jsx(x.Cell,{children:e.jsx(d,{id:"AYwCJD",defaultMessage:"No feedback yet."})})}):o.map(i=>{const a=i.review_status==="deleted",r=a?void 0:()=>t(i);return e.jsxs(x.Row,{className:$("my-2",a?"bg-token-main-surface-tertiary":"hover:cursor-pointer hover:bg-token-main-surface-secondary"),onClick:r,children:[e.jsx(x.Cell,{className:"truncate",children:e.jsx(he,{reviewStatus:i.review_status,onClick:r,disabled:a})}),e.jsx(x.Cell,{className:"truncate",children:e.jsx("span",{children:i.submitter_display_name&&i.submitter_email?e.jsx(d,{id:"3OKTcX",defaultMessage:"{displayName} ({email})",values:{displayName:i.submitter_display_name,email:i.submitter_email}}):e.jsx("code",{children:i.submitter_id.split("__")[0]})})}),e.jsx(x.Cell,{className:"truncate",children:e.jsx("span",{children:new Date(i.submitted_at).toLocaleString()})})]},i.feedback_id)})})]})}const se={NAME_KEYWORD:"Name keyword",NAME_SUBSTRING:"Name substring"},T={USERS:"User",GROUPS:"Group",SHARED_DRIVE:"Shared drive",FILE_ID:"File ID",...se},qe={ALL:"All exclusion types",...se},te={ALL:"All exclusion types",...T};var ae=(s=>(s.EXCLUDE="exclude",s.INCLUDE="include",s))(ae||{});const Ye=[["sensitive_object_name_keywords",T.NAME_KEYWORD],["sensitive_object_name_substrings",T.NAME_SUBSTRING],["sensitive_users",T.USERS],["sensitive_groups",T.GROUPS],["sensitive_shared_drive_ids",T.SHARED_DRIVE],["blocked_object_ids",T.FILE_ID]],Me={},re={};Ye.forEach(([s,t])=>{Me[s]=t,re[t]=s});function Ze(s){const t=[];for(const[o,i]of Object.entries(s))for(const[a,r]of Object.entries(i)){const n=Me[a];n&&Array.isArray(r)&&r.forEach((p,u)=>{t.push({id:`${o}_${a}_${u}`,lastModifiedTime:i.last_modified_time,name:p,exclusionType:n,parentId:o,parentType:i.type})})}return t}function ze(s){return Object.values(s)[0]?.last_modified_time}function Xe(s){return Object.keys(s)[0]}function Qe(s){return!!Object.values(s)[0]?.is_oauth}function Je(s){return Object.values(s)[0]?.default_shared_drive_exclusion_selection??null}const J=10;function $e({rowData:s,filterInputValue:t,filterType:o,workspaceId:i}){const[a,r]=g.useState(0);g.useEffect(()=>{r(0)},[t,o]);const n=s.filter(c=>c.name.toLowerCase().includes(t.toLowerCase())&&(o===te.ALL||c.exclusionType.toLowerCase()===o.toLowerCase())),p=n.slice(a*J,(a+1)*J),u=Math.ceil(n.length/J);return e.jsxs("div",{className:"mb-6",children:[e.jsxs(x.Root,{fixed:!0,size:"normal",children:[e.jsxs(x.Header,{children:[e.jsx(x.HeaderCell,{className:"bg-token-main-surface-primary",children:e.jsx(d,{...I.name})}),e.jsx(x.HeaderCell,{className:"w-40 bg-token-main-surface-primary",children:e.jsx(d,{...I.type})}),e.jsx(x.HeaderCell,{className:"w-16 bg-token-main-surface-primary"})]}),e.jsxs(x.Body,{children:[p.map(c=>e.jsx(es,{config:c,workspaceId:i},c.id)),p.length===0&&e.jsx(x.Row,{children:e.jsx(x.Cell,{children:e.jsx("div",{className:"text-token-text-tertiary",children:e.jsx(d,{...I.noResults})})})})]})]}),u>1&&e.jsx("div",{className:"mt-2 flex justify-center",children:e.jsx(De,{currentPage:a,onChangeIndex:r,length:u})})]})}function es({config:s,workspaceId:t}){const o=A(),i=me(),a=K(),r=X(),n=B({mutationFn:u=>{const c={store_id:u.storeId,operations:u.operations,last_modified_time:u.lastModifiedTime};return E.updateKnowledgeStoreExclusionConfig(c,u.accountId)},onSuccess:()=>{r.invalidateQueries({queryKey:["listExclusionConfigs",t,a?.id]}),i.success(o.formatMessage(I.deleteConfigSuccessMessage),{duration:3})},onError:()=>{i.danger(o.formatMessage(I.deleteConfigGenericErrorMessage),{duration:3})}}),p=()=>{if(!s.parentId){i.danger(o.formatMessage(I.deleteConfigGenericErrorMessage),{duration:3});return}if(!a){i.danger(o.formatMessage(I.deleteConfigGenericErrorMessage),{duration:3});return}const u={action:xe.REMOVE,field:re[s.exclusionType],value:s.name};n.mutate({storeId:s.parentId,operations:[u],lastModifiedTime:s.lastModifiedTime,accountId:a.id})};return e.jsxs(x.Row,{children:[e.jsx(x.Cell,{className:"whitespace-normal break-all",children:e.jsx("span",{children:s.name})}),e.jsx(x.Cell,{className:"whitespace-nowrap",children:e.jsx("span",{children:s.exclusionType})}),e.jsx(x.Cell,{children:e.jsx(ss,{onDelete:p})})]})}function ss({onDelete:s}){return e.jsxs(V.Root,{children:[e.jsx(V.Trigger,{children:e.jsx(Te,{className:"icon-sm cursor-pointer"})}),e.jsx(V.Portal,{children:e.jsx(V.Content,{children:e.jsx(V.Item,{className:"cursor-pointer",onClick:s,children:e.jsx(d,{...I.deleteConfig})})})})]})}function ts(){return e.jsx("div",{className:"flex w-full items-center justify-center",children:e.jsx(G,{})})}const I=z({name:{id:"B+5Xa5",defaultMessage:"Name"},type:{id:"DY07PN",defaultMessage:"Type"},deleteConfig:{id:"fB8e41",defaultMessage:"Delete config"},noResults:{id:"x1Ejc3",defaultMessage:"No results"},deleteConfigSuccessMessage:{id:"d60LPO",defaultMessage:"Exclusion deleted successfully."},deleteConfigGenericErrorMessage:{id:"pOww+E",defaultMessage:"Error deleting exclusion."}}),as=s=>g.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},g.createElement("path",{d:"M8.7587 3H15.2413C16.0463 2.99999 16.7106 2.99998 17.2518 3.04419C17.8139 3.09012 18.3306 3.18868 18.816 3.43597C19.5686 3.81947 20.1805 4.43139 20.564 5.18404C20.8113 5.66937 20.9099 6.18608 20.9558 6.74817C21 7.28936 21 7.95372 21 8.75868V15.2413C21 16.0463 21 16.7106 20.9558 17.2518C20.9099 17.8139 20.8113 18.3306 20.564 18.816C20.1805 19.5686 19.5686 20.1805 18.816 20.564C18.3306 20.8113 17.8139 20.9099 17.2518 20.9558C16.7106 21 16.0463 21 15.2413 21H8.75868C7.95372 21 7.28936 21 6.74817 20.9558C6.18608 20.9099 5.66937 20.8113 5.18404 20.564C4.43139 20.1805 3.81947 19.5686 3.43597 18.816C3.18868 18.3306 3.09012 17.8139 3.04419 17.2518C2.99998 16.7106 2.99999 16.0463 3 15.2413V8.7587C2.99999 7.95373 2.99998 7.28937 3.04419 6.74817C3.09012 6.18608 3.18868 5.66937 3.43597 5.18404C3.81947 4.43139 4.43139 3.81947 5.18404 3.43597C5.66937 3.18868 6.18608 3.09012 6.74817 3.04419C7.28937 2.99998 7.95373 2.99999 8.7587 3ZM6.91104 5.03755C6.47262 5.07337 6.24842 5.1383 6.09202 5.21799C5.7157 5.40973 5.40973 5.7157 5.21799 6.09202C5.1383 6.24842 5.07337 6.47262 5.03755 6.91104C5.00078 7.36113 5 7.94342 5 8.8V15.2C5 16.0566 5.00078 16.6389 5.03755 17.089C5.07337 17.5274 5.1383 17.7516 5.21799 17.908C5.40973 18.2843 5.7157 18.5903 6.09202 18.782C6.24842 18.8617 6.47262 18.9266 6.91104 18.9624C7.36113 18.9992 7.94342 19 8.8 19H15.2C16.0566 19 16.6389 18.9992 17.089 18.9624C17.5274 18.9266 17.7516 18.8617 17.908 18.782C18.2843 18.5903 18.5903 18.2843 18.782 17.908C18.8617 17.7516 18.9266 17.5274 18.9624 17.089C18.9992 16.6389 19 16.0566 19 15.2V8.8C19 7.94342 18.9992 7.36113 18.9624 6.91104C18.9266 6.47262 18.8617 6.24842 18.782 6.09202C18.5903 5.7157 18.2843 5.40973 17.908 5.21799C17.7516 5.1383 17.5274 5.07337 17.089 5.03755C16.6389 5.00078 16.0566 5 15.2 5H8.8C7.94342 5 7.36113 5.00078 6.91104 5.03755ZM16.3255 7.93219C16.7772 8.25003 16.8856 8.87383 16.5678 9.32549L11.8178 16.0755C11.6431 16.3237 11.3652 16.4792 11.0623 16.4981C10.7593 16.517 10.4642 16.3973 10.2601 16.1727L7.76006 13.4227C7.38855 13.014 7.41867 12.3816 7.82733 12.0101C8.23599 11.6386 8.86843 11.6687 9.23994 12.0773L10.9004 13.9039L14.9322 8.17451C15.25 7.72285 15.8738 7.61436 16.3255 7.93219Z",fill:"currentColor"}));function rs(){const s=ee(y.AddServiceAccountKey),t=A(),o=K(),i=X(),[a,r]=g.useState(""),[n,p]=g.useState(null),[u,c]=g.useState(null),S=B({mutationFn:async l=>{const D={secret:await is(l.keyFile),admin_email:l.email,secret_type:Y.GOOGLE_DRIVE_DWD};return E.createSecretForWorkspace(D,l.accountId)},onSuccess:()=>{i.invalidateQueries({queryKey:["secretExistsForWorkspace",o?.id]}),r(""),p(null),_.closeModal(y.AddServiceAccountKey)},onError:(l,v)=>{c(h.creationModalGenericErrorMessage),E.deleteSecretForWorkspace(Y.GOOGLE_DRIVE_DWD,v.accountId)}}),b=()=>{if(!a||!n){c(h.creationModalValueErrorMessage);return}if(!o){c(h.creationModalGenericErrorMessage);return}c(null),S.mutate({email:a,keyFile:n,accountId:o.id})},N=l=>{l.target.files&&l.target.files[0]&&p(l.target.files[0])};return e.jsx(Z,{size:"custom",className:"max-w-lg overflow-y-auto text-base",isOpen:s,onClose:()=>{_.closeModal(y.AddServiceAccountKey),c(null),r(""),p(null)},showCloseButton:!0,type:"success",title:t.formatMessage(h.serviceAccountModalTitle),description:"",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"pb-2 text-base",children:t.formatMessage(h.emailLabel)}),e.jsx("input",{type:"email",value:a,onChange:l=>r(l.target.value),placeholder:t.formatMessage(h.emailPlaceholder),className:"mb-4 rounded-lg border border-token-border-light bg-token-main-surface-primary px-3 py-2 text-base placeholder:text-token-text-tertiary"}),e.jsx("label",{className:"pb-2 text-base",children:t.formatMessage(h.keyFileLabel)}),e.jsx("input",{type:"file",accept:".json",onChange:N,className:"mb-4 rounded-lg border border-token-border-light bg-token-main-surface-primary px-3 py-2 text-base"}),n&&e.jsx("p",{className:"text-sm text-token-text-secondary",children:t.formatMessage(h.selectedFile,{fileName:n.name})}),u&&e.jsx("p",{className:"mt-4 text-sm text-red-500",children:t.formatMessage(u)}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(w,{className:"mt-6 w-full max-w-[92px] rounded-lg border text-base",color:"secondary",onClick:()=>{_.closeModal(y.AddServiceAccountKey),c(null),r(""),p(null)},children:t.formatMessage(h.creationModalCancelButton)}),e.jsx(w,{className:"mt-6 w-full max-w-[92px] rounded-lg border text-base",color:"primary",onClick:b,disabled:S.status==="pending",children:S.status==="pending"?e.jsx(G,{}):t.formatMessage(h.creationModalCreateButton)})]})]})})}function is(s){return new Promise((t,o)=>{const i=new FileReader;i.onload=a=>{a.target&&typeof a.target.result=="string"?t(a.target.result):o(new Error("Error reading file."))},i.onerror=()=>{o(new Error("Error reading the file."))},i.readAsText(s)})}function os(){const s=ee(y.DeleteServiceAccountKey),t=A(),o=K(),i=X(),[a,r]=g.useState(null),n=B({mutationFn:()=>o?E.deleteSecretForWorkspace(Y.GOOGLE_DRIVE_DWD,o.id):Promise.reject(new Error("No current account")),onSuccess:()=>{i.invalidateQueries({queryKey:["secretExistsForWorkspace",o?.id]}),_.closeModal(y.DeleteServiceAccountKey)},onError:()=>{r(h.genericErrorMessage)}});return e.jsxs(Z,{size:"custom",type:"success",className:"max-w-lg overflow-y-auto text-base",isOpen:s,onClose:()=>{_.closeModal(y.DeleteServiceAccountKey),r(null)},showCloseButton:!0,title:t.formatMessage(h.deleteModalTitle),children:[e.jsx("p",{children:t.formatMessage(h.deleteModalDescription)}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[a&&e.jsx("p",{className:"mt-4 text-base text-red-500",children:t.formatMessage(a)}),e.jsx(w,{className:"mt-6 w-full max-w-[92px] rounded-lg border text-base",color:"secondary",onClick:()=>{_.closeModal(y.DeleteServiceAccountKey)},children:t.formatMessage(h.deleteModalCancelButton)}),e.jsx(w,{className:"mt-6 w-full max-w-[92px] rounded-lg border text-base",color:"primary",onClick:()=>n.mutate(),disabled:n.status==="pending",children:n.status==="pending"?e.jsx(G,{}):t.formatMessage(h.deleteModalDeleteButton)})]})]})}const ns=({isSecretLoading:s,isSecretError:t,secretExistData:o})=>{const i=A();return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"inline-flex items-center text-base",children:i.formatMessage(h.googleDriveDWDSectionHeader)}),s?e.jsx(G,{}):t?e.jsx("p",{className:"text-red-500",children:i.formatMessage(h.genericErrorMessage)}):o&&o.has_secret?e.jsxs("div",{className:"flex items-center",children:[e.jsx(as,{className:"mr-2 text-green-500"}),e.jsx(w,{className:"max-w-[100px] rounded-lg border text-base",color:"secondary",icon:fe,onClick:()=>{_.openModal(y.DeleteServiceAccountKey)},children:i.formatMessage(h.deleteServiceAccountKeyButton)})]}):e.jsx(w,{className:"max-w-[192px] rounded-lg border text-base",color:"primary",icon:ge,onClick:()=>{_.openModal(y.AddServiceAccountKey)},children:i.formatMessage(h.addServiceAccountKeyButton)})]})},h=z({serviceAccountModalTitle:{id:"ri0otc",defaultMessage:"Service account config"},googleDriveDWDSectionHeader:{id:"pIbDsS",defaultMessage:"Google Drive"},addServiceAccountKeyButton:{id:"dEHoaF",defaultMessage:"Service account"},deleteServiceAccountKeyButton:{id:"n4njrg",defaultMessage:"Delete"},deleteModalTitle:{id:"nhz40y",defaultMessage:"Delete service account"},deleteModalDescription:{id:"cWxpDi",defaultMessage:"Are you sure you want to delete the service account?"},deleteModalCancelButton:{id:"ZXiXY2",defaultMessage:"Cancel"},deleteModalDeleteButton:{id:"6i1l4W",defaultMessage:"Delete"},emailLabel:{id:"O9fBv1",defaultMessage:"Admin email"},emailPlaceholder:{id:"Y32reR",defaultMessage:"Enter admin email"},keyFileLabel:{id:"U2yeNU",defaultMessage:"Service account key"},selectedFile:{id:"8/rZrp",defaultMessage:"Selected file: {fileName}"},creationModalCreateButton:{id:"bCzjac",defaultMessage:"Create"},creationModalCancelButton:{id:"kUO70c",defaultMessage:"Cancel"},creationModalGenericErrorMessage:{id:"l2SCVt",defaultMessage:"Error when saving config."},genericErrorMessage:{id:"nKlawS",defaultMessage:"Error"},creationModalValueErrorMessage:{id:"B1fdKK",defaultMessage:"Please enter all required fields."}});function ls({currentWorkspaceId:s}){const t=A(),o=K(),[i,a]=g.useState(""),{data:r,isLoading:n}=q({queryKey:["listExclusionConfigs",s,o?.id],queryFn:()=>o?E.listExclusionConfigs({workspaceId:s,accountId:o?.id}):Promise.reject(new Error("No current account")),enabled:!!o}),{data:p,isLoading:u,isError:c}=q({queryKey:["secretExistsForWorkspace",o?.id],queryFn:()=>o?E.secretExistForWorkspace(Y.GOOGLE_DRIVE_DWD,o.id):Promise.reject(new Error("No current account")),enabled:!!o}),S=r?Ze(r):[],b=r?Xe(r):null,N=r?ze(r):null,l=r?Qe(r):!1,v=r?Je(r):null,[D,j]=g.useState(te.ALL),[F,R]=g.useState(""),P=g.useCallback(Ie(O=>{R(O)},250),[]);return e.jsxs(e.Fragment,{children:[e.jsx(je,{title:t.formatMessage(m.title)}),e.jsx(ve,{children:e.jsxs(we,{className:"mt-6 gap-6",children:[!l&&e.jsxs(U,{children:[e.jsx(H,{children:t.formatMessage(m.serviceAccountSectionHeader)}),e.jsx(W,{className:"text-[var(--Primary-Gray-600,_#565869)]",children:t.formatMessage(m.serviceAccountConfigSectionDescription)}),e.jsx(_e,{children:e.jsx(ns,{isSecretLoading:u,isSecretError:c,secretExistData:p})})]}),!l&&v&&e.jsxs(U,{children:[e.jsx(H,{children:t.formatMessage(m.sharedDriveSectionHeader)}),e.jsx(W,{className:"text-token-text-secondary",children:v===ae.INCLUDE?t.formatMessage(m.sharedDriveInclusionDefaultSubtitle):t.formatMessage(m.sharedDriveExclusionDefaultSubtitle)})]}),e.jsxs(U,{children:[e.jsx(H,{children:t.formatMessage(m.exclusionsSectionHeader)}),e.jsx(W,{className:"text-[var(--Primary-Gray-600,_#565869)]",children:t.formatMessage(m.exclusionsSectionDescription)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Fe,{className:"icon-sm absolute left-2 top-1/2 -translate-y-1/2 transform text-token-text-tertiary"}),e.jsx("input",{type:"text",value:i,onChange:O=>{a(O.target.value),P(O.target.value)},placeholder:t.formatMessage(m.search),className:"w-48 rounded-lg border border-token-border-light bg-token-main-surface-primary pl-8 text-base placeholder:text-token-text-tertiary"})]}),e.jsx(cs,{filterType:D,setFilterType:j,isOAuth:l})]}),e.jsx(w,{className:"max-w-[192px] rounded-lg border text-base",color:"primary",icon:ge,onClick:()=>{_.openModal(y.CreateExclusion)},children:t.formatMessage(m.createExclusionButton)})]}),n?e.jsx(ts,{}):e.jsx($e,{rowData:S,filterInputValue:F,filterType:D,workspaceId:s}),e.jsx(He,{currentWorkspaceId:s})]})}),e.jsx(ds,{currentWorkspaceId:s,parentId:b,lastModifiedTime:N,isOAuth:l,defaultSharedDrivePolicy:v}),e.jsx(rs,{}),e.jsx(os,{})]})}function cs({filterType:s,setFilterType:t,isOAuth:o}){return e.jsx("div",{className:"max-w-[208px]",children:e.jsxs(C.Root,{value:s,onValueChange:i=>t(i),disabled:!1,children:[e.jsxs(C.Trigger,{className:"rounded-lg border border-token-border-light py-5 text-base",children:[e.jsx(C.Value,{}),e.jsx(C.Icon,{})]}),e.jsx(C.Portal,{children:e.jsx(C.Content,{children:Object.entries(o?qe:te).map(([i,a])=>e.jsx(C.Item,{value:a,className:"text-base",children:a},i))})})]})})}function ds({currentWorkspaceId:s,parentId:t,lastModifiedTime:o,isOAuth:i,defaultSharedDrivePolicy:a}){const r=A(),n=K(),p=X(),u=ee(y.CreateExclusion),[c,S]=g.useState(""),[b,N]=g.useState([]),[l,v]=g.useState(""),[D,j]=g.useState(null),F=f=>{f.key==="Enter"||f.key===","?(f.preventDefault(),l.trim()&&(N([...b,l.trim()]),v(""))):f.key==="Backspace"&&!l&&R(b.length-1)},R=f=>{N(b.filter((k,Q)=>Q!==f))},P=B({mutationFn:f=>{const k={store_id:f.storeId,operations:f.operations,last_modified_time:f.lastModifiedTime};return E.updateKnowledgeStoreExclusionConfig(k,f.accountId)},onSuccess:()=>{p.invalidateQueries({queryKey:["listExclusionConfigs",s,n?.id]}),N([]),S(""),v(""),_.closeModal(y.CreateExclusion)},onError:()=>{j(m.creationModalGenericErrorMessage)}}),O=()=>{const f=[...b];if(l.trim()&&f.push(l.trim()),!t){j(m.creationModalGenericErrorMessage);return}if(!n){j(m.creationModalGenericErrorMessage);return}if(!c){j(m.creationModalValueErrorMessage);return}if(f.length===0){j(m.creationModalValueErrorMessage);return}j(null);const k=f.map(Q=>({action:xe.ADD,field:re[c],value:Q}));P.mutate({storeId:t,operations:k,lastModifiedTime:o,accountId:n.id})};return e.jsx(Z,{size:"custom",className:"max-w-lg overflow-y-auto text-base",isOpen:u,onClose:()=>{_.closeModal(y.CreateExclusion),j(null),N([])},showCloseButton:!0,type:"success",title:r.formatMessage(m.creationModalTitle),description:"",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"inline-flex items-center pb-2 text-base",children:r.formatMessage(m.creationModalExclusionType)}),e.jsxs(C.Root,{value:c,onValueChange:f=>S(f),disabled:!1,children:[e.jsxs(C.Trigger,{className:"justify-between rounded-lg border border-token-border-light py-5 text-base",children:[e.jsx(C.Value,{placeholder:"Select exclusion type"}),e.jsx(C.Icon,{})]}),e.jsx(C.Portal,{children:e.jsx(C.Content,{children:Object.entries(i?se:T).map(([f,k])=>e.jsx(C.Item,{value:k,className:"text-base",children:k},f))})})]}),e.jsx("p",{className:"inline-flex items-center pb-2 pt-6 text-base",children:r.formatMessage(m.creationModalExclusionValue)}),e.jsxs("div",{className:"flex flex-wrap items-center rounded-lg border border-token-border-light bg-token-main-surface-primary text-base",children:[b.map((f,k)=>e.jsxs("div",{className:"mx-1.5 my-2 flex min-w-0 cursor-pointer items-center rounded-full bg-gray-200 px-3.5 py-1 font-medium text-black",children:[e.jsx("span",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:f}),e.jsx(w,{onClick:()=>{R(k)},color:"ghost",className:"ml-2 min-h-0 p-0 text-gray-600 hover:text-red-700",icon:Le})]},k)),e.jsx("input",{type:"text",value:l,onChange:f=>v(f.target.value),onKeyDown:F,placeholder:r.formatMessage(m.creationModalValuePlaceholder),className:"w-full min-w-0 flex-1 overflow-x-auto border-none bg-transparent text-base placeholder:text-token-text-tertiary focus:border-transparent focus:outline-none focus:ring-0"})]}),e.jsx("p",{className:"mt-1 inline-flex items-center text-sm text-token-text-secondary",children:!i&&c===T.SHARED_DRIVE&&a?a===ae.INCLUDE?r.formatMessage(m.creationModalSeparateByCommasAndDefaultIncludeDrives):r.formatMessage(m.creationModalSeparateByCommasAndDefaultExcludeDrives):r.formatMessage(m.creationModalSeparateByCommas)}),D&&e.jsx("p",{className:"mt-4 text-sm text-red-500",children:r.formatMessage(D)}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(w,{className:"mt-6 w-full max-w-[92px] rounded-lg border text-base",color:"secondary",onClick:()=>{_.closeModal(y.CreateExclusion),N([]),j(null)},children:r.formatMessage(m.creationModalCancelButton)}),e.jsx(w,{className:"mt-6 w-full max-w-[92px] rounded-lg border text-base",color:"primary",onClick:O,disabled:P.status==="pending",children:P.status==="pending"?e.jsx(G,{}):r.formatMessage(m.creationModalCreateButton)})]})]})})}const m=z({title:{id:"j2s2hr",defaultMessage:"Google Drive Connection"},search:{id:"NxiatU",defaultMessage:"Search"},sharedDriveSectionHeader:{id:"MoVjjM",defaultMessage:"Shared Drives"},sharedDriveInclusionDefaultSubtitle:{id:"QpN++w",defaultMessage:"Shared drives are included by default. You can set overrides to exclude specific shared drives in the exclusions section."},sharedDriveExclusionDefaultSubtitle:{id:"Id1y2X",defaultMessage:"Shared drives are excluded by default. You can set overrides to include specific shared drives in the exclusions section."},serviceAccountSectionHeader:{id:"KZiaoi",defaultMessage:"Service account config"},serviceAccountConfigSectionDescription:{id:"MaxpKa",defaultMessage:"Manage your service account config for connectors."},exclusionsSectionHeader:{id:"D6JZP8",defaultMessage:"Exclusions"},exclusionsSectionDescription:{id:"UNjawu",defaultMessage:"Manage which files will be excluded from being indexed by ChatGPT. Changes made to exclusions may take time to reflect."},createExclusionButton:{id:"nKYBN7",defaultMessage:"Create exclusion"},creationModalTitle:{id:"ET+VpS",defaultMessage:"New exclusion"},creationModalExclusionType:{id:"I+xnyV",defaultMessage:"Type"},creationModalValuePlaceholder:{id:"hua2tW",defaultMessage:"String"},creationModalExclusionValue:{id:"aAr8X0",defaultMessage:"Value"},creationModalSeparateByCommas:{id:"HQDOHA",defaultMessage:"Separate values by commas"},creationModalSeparateByCommasAndDefaultIncludeDrives:{id:"qXuyO7",defaultMessage:"Separate values by commas. Any shared drive IDs added here will be excluded from indexing."},creationModalSeparateByCommasAndDefaultExcludeDrives:{id:"PQPdqt",defaultMessage:"Separate values by commas. Any shared drive IDs added here will be indexed."},creationModalCreateButton:{id:"GsyTJk",defaultMessage:"Create"},creationModalCancelButton:{id:"kUO70c",defaultMessage:"Cancel"},creationModalGenericErrorMessage:{id:"wUcmIJ",defaultMessage:"Error creating exclusion."},creationModalValueErrorMessage:{id:"+2RviF",defaultMessage:"Please enter all required fields."}});function Es(){const s=ye();return Ce(),e.jsx(ls,{...s})}export{Es as default};
//# sourceMappingURL=iu19q145eybqj82l.js.map
