import{c as R,f as D,en as L,bw as N,eo as _,ab as P,W as x,dl as H,j as F,r as d,a5 as K}from"./om77559u6zbv0nxn.js";import{T as O}from"./i4vaxxauijcymhjm.js";import{cH as $,cI as q,cJ as p,cK as w}from"./gxt05z3vby89tole.js";const h=R(D(()=>({statusMap:{}}))),W=a=>h(s=>s.statusMap[a]),Z=(a,s)=>{h.setState(e=>{e.statusMap[a]=s;const t=O.getServerThreadId(a);t&&(e.statusMap[t]=s)})},M=a=>{h.setState(s=>{for(const{id:e,async_status:t}of a)t!=null&&(s.statusMap[e]={source:L.SERVER,value:t})})},U=28,g="conversationHistory";function z(a={}){const{buckets:s,recentConversationLimit:e}=a,o=N()?.includes(_)??!1,y=P(),l=!o&&!!y?.data,r=x(),{data:i,fetchNextPage:k,hasNextPage:v,isInitialLoading:b,isFetchingNextPage:S,isError:T}=H({queryKey:[g],queryFn:async({pageParam:n})=>{const u=await F.getConversations({offset:n,limit:U});return M(u.items),u},initialPageParam:0,getNextPageParam:n=>{const u=n.offset+n.limit;return u<n.total?u:void 0},enabled:l}),c=d.useMemo(()=>i?.pages.flatMap(u=>u.items)??[],[i,a]);d.useEffect(()=>{M(c)},[c]);const B=d.useMemo(()=>{if(!i||!s)return[];const n=Q(c,r);return[n.recent,n.dynamicMonths,n.dynamicYears].flatMap(f=>Object.entries(f).map(([Y,{items:A,label:C}],I)=>({key:`${Y}-${I}`,label:C,items:A}))).filter(f=>f.items.length>0)},[c,i,r,s]),E=d.useMemo(()=>{const n=c.slice(0,e??5);return{key:"recents",label:r.formatMessage(m.historyBucketRecent),items:n}},[c,e,r]);return{buckets:B,conversations:c,data:i,fetchNextPage:k,hasNextPage:v,recents:E,isLoading:b,isFetchingNextPage:S,isError:T}}function Q(a,s){return a.reduce((e,t)=>{const o=new Date(t.update_time??t.create_time??0),y=$(new Date,o);if(y===0)e.recent.today.items.push(t);else if(y<=1)e.recent.yesterday.items.push(t);else if(y<=7)e.recent.lastSeven.items.push(t);else if(y<=30)e.recent.lastThirty.items.push(t);else if(q(o)){const l=p(o),r=w(o),i=`${l}-${r}`;e.dynamicMonths[i]?e.dynamicMonths[i].items.push(t):e.dynamicMonths[i]={label:s.formatDate(o,{month:"long"}),items:[t]}}else{const r=`${p(o)}-`;e.dynamicYears[r]?e.dynamicYears[r].items.push(t):e.dynamicYears[r]={label:s.formatDate(o,{year:"numeric"}),items:[t]}}return e},{recent:{today:{label:s.formatMessage(m.historyBucketToday),items:[]},yesterday:{label:s.formatMessage(m.historyBucketYesterday),items:[]},lastSeven:{label:s.formatMessage(m.historyBucketLastSeven),items:[]},lastThirty:{label:s.formatMessage(m.historyBucketLastThirty),items:[]}},dynamicMonths:{},dynamicYears:{}})}function X(a){a.invalidateQueries({queryKey:[g]})}const m=K({historyBucketRecent:{id:"history.bucket.recent",defaultMessage:"Recent"},historyBucketToday:{id:"history.bucket.today",defaultMessage:"Today"},historyBucketYesterday:{id:"history.bucket.yesterday",defaultMessage:"Yesterday"},historyBucketLastSeven:{id:"history.bucket.lastSeven",defaultMessage:"Previous 7 Days"},historyBucketLastThirty:{id:"history.bucket.lastThirty",defaultMessage:"Previous 30 Days"}});export{g as C,W as a,X as r,Z as s,z as u};
//# sourceMappingURL=llgltku1zw4z6psq.js.map
