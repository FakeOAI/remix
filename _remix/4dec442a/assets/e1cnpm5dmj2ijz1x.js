import{fl as Pe,fm as te,cH as _e,fn as F,r as m,a8 as Me,bA as ze,fo as ie,P as I,ey as j,aM as ae,dS as Ge,h as g,aQ as O,j as ue,d2 as ve,a as re,fp as Te,l as Ce,aJ as $,R as Ee,eb as we,f2 as De,v as be,fq as Fe,dl as ce,u as _,e as v,aG as se}from"./ce20vh2pwl1h2mrx.js";import{cv as le,cy as W,dk as Le,fF as qe,fG as Re,cB as y,fH as Ue,c2 as He,ej as b,ak as u,fI as Qe,eF as Ae,eB as Ie,fJ as Ke,fK as xe}from"./izfif69im9lzk9q2.js";import{T as G,G as Oe,a as Ne}from"./ivcjr0x9hy2blveg.js";function ke({clientThreadId:e}){const t=G.getThreadCurrentLeafId(e),s=G.getTree(e).getMessage(t).metadata?.model_switcher_deny??[],n={};s.forEach(i=>{const{slug:a,context:l,reason:d,description:c}=i,f=n[a]??{},h=f[l]??[];h.push({reason:d,description:c}),f[l]=h,n[a]=f});const o=Pe();for(const{resets_after:i,model_slug:a}of o)[te.CONVERSATION,te.REGENERATE].forEach(l=>{const d=n[a]??{},c=d[l]??[],f={reason:_e.RATE_LIMIT,resetsAfter:i};c.push(f),d[l]=c,n[a]=d});return n}const dt="text-davinci-002-render-sha",mt="gpt-4",ft="gpt-4o",gt="o1-preview",yt="o1-mini",K=le({slug:W,max_tokens:4097,title:"Default",description:"",tags:[F.GPT_3_5],product_features:{}}),Be=({default_model:e,tagline:t,color:r,human_category_name:s,category:n,human_category_short_name:o,human_category_shorter_name:i,subscription_level:a,short_explainer:l,subcategory:d,is_beta:c,...f})=>({color:r,tagline:t,defaultModel:e,label:s,shortLabel:o,description:l,shorterLabel:i??o,subscriptionLevel:a,categoryId:n,subcategory:d,isBeta:c,...f}),je=({icon:e,icon_filled_src:t,icon_outline_src:r})=>({iconName:e,iconFilledSrc:t,iconOutlineSrc:r}),$e=({group:e,human_group_name:t,human_group_short_name:r,model_ids:s})=>({group:e,label:t,shortLabel:r,modelIds:s});function We(){return O({retry:5,queryKey:["modelIcons"],queryFn:async()=>await ue.getModelIcons().then(e=>Object.fromEntries(Object.entries(e).map(([t,r])=>[t,je(r)])))})}function Ve(e){return O({retry:5,queryKey:["models",{isHistoryDisabled:e}],queryFn:async()=>await ue.getModels(e).then(t=>{const{models:r,internal_groups:s,categories:n}=t,o=r.map(le);return{categories:n.concat().reverse().map(Be),groups:s?.map($e)??[],modelsList:o,modelsMap:Object.fromEntries(o.map(i=>[i.id,i]))}})})}function T(){const e=Ge();return g(Ve(e))}function ht(){return g(We())}function Ye({isRegen:e=!1}={}){const{isLoading:t,data:{categories:r=[],groups:s=[]}={}}=T(),n=m.useMemo(()=>e?r.filter(o=>o.is_regenerate_category!==!1):r.filter(o=>!o.is_regenerate_category),[r,e]);return{isLoading:t,categories:n,groups:s??[]}}function pt(){const{categories:e}=Ye();return!!e.find(({categoryId:t})=>t===Le.GPT4o)}function St(){const{data:e}=T();return m.useMemo(()=>e?new Set(Object.keys(e.modelsMap)):new Set([W]),[e])}const Ze={[W]:K};function Je(){const{data:e}=T();return e?.modelsMap??Ze}function de(e,t,r){let s=F.GPT_3_5;return r?s=F.GPT_4:t&&(s=F.GPT_4o),e?.modelsList.find(n=>n.tags.includes(s))??e?.modelsList[0]??K}function Pt(e=!1){const t=Me(),r=ze(),[,s]=ie();return m.useCallback(({location:n,modelId:o})=>{const i=t.pathname.includes("/g/");e||i?(I.logNewChatButtonClicked({location:n}),r({pathname:"/",search:`?model=${encodeURIComponent(o)}`})):(s(a=>(a.set("model",encodeURIComponent(o)),a)),I.logNewChatButtonClicked({location:n}))},[e,t,r,s])}function _t(){const{data:{categories:e=[]}={}}=T(),{doesUserHaveAnyAccountsWithPlusFeatures:t}=j();return t?null:e.find(qe)?.defaultModel??null}function Xe(e){return Oe(e)}function me(e){const t=Xe(e),r=Je();return m.useMemo(()=>t==null?K:r[t]??K,[t,r])}function et(e,t){return me(e).enabledTools?.includes(t)??!1}function Mt(e){const t=Re(),r=me(e),s=m.useMemo(()=>!t.isSuccess||!t.data?[]:t.data,[t.data,t.isSuccess]),n=ke({clientThreadId:e});return m.useMemo(()=>{const i=new Set(r.enabledTools||[]);return s.filter(a=>!(!(a.requiredFeatures.length===0||a.requiredFeatures.every(c=>i.has(c)))||!(a.requiredModels.length===0||a.requiredModels.some(c=>!n[c]))))},[s,r,n])}function zt(e){return decodeURIComponent(e.model??"")||null}function Gt(){const{data:e}=T(),{doesUserHaveAnyAccountsWithPlusFeatures:t}=j(),r=ae();return de(e,!!t,!!r?.isEnterprisey())}const ne=e=>({turn_index:e.turnIndex,thread_id:e.threadId,conversation_id:e.clientThreadId?G.getServerThreadId(e.clientThreadId):void 0,message_id:e?.messageId}),tt="hints";class x extends ve()(t=>({persistedSystemHints:new Set(t),persistedSystemHintTriggers:{}})){static getPersistedSystemHints=({persistedSystemHints:t})=>t;addPersistedSystemHint=(t,r,s)=>{t===y.Search&&I.logEvent(re.searchModeEngaged,{...ne(r),triggerSource:s}),this.setState(({persistedSystemHints:n,persistedSystemHintTriggers:o})=>({persistedSystemHints:new Set(n).add(t),persistedSystemHintTriggers:{...o,[t]:s}}))};removePersistedSystemHint=(t,r)=>{t===y.Search&&I.logEvent(re.searchModeDisabled,ne(r)),this.setState(({persistedSystemHints:s,persistedSystemHintTriggers:n})=>{const o=new Set(s);o.delete(t);const i={...n};return delete i[t],{persistedSystemHints:o,persistedSystemHintTriggers:i}})};getPersistedSystemHintTrigger=t=>{if(this.getState().persistedSystemHints.has(t))return this.getState().persistedSystemHintTriggers[t]};clearPersistedSystemHintTrigger=t=>{this.setState(({persistedSystemHints:r,persistedSystemHintTriggers:s})=>{const n={...s};return delete n[t],{persistedSystemHints:new Set(r),persistedSystemHintTriggers:n}})}}const vt=()=>x.useState(x.getPersistedSystemHints);function Tt({children:e,clientThreadId:t,currentLeafId:r}){const s=et(t,Te.Search),o=G.getLastMessgageSystemHints(t,r).includes(y.Search)&&s,[i]=m.useState(()=>new x(o?[y.Search]:[]));return m.useEffect(()=>{const a=i.getState().persistedSystemHints;o&&!a.has(y.Search)&&i?.addPersistedSystemHint(y.Search,{clientThreadId:t,turnIndex:0})},[o,i,t]),Ce.jsx(x.Provider,{store:i,children:e})}function rt(e){const t=new Set;if(e){const r=e.split(",");Array.isArray(r)&&r.forEach(s=>{Object.values(y).includes(s)&&t.add(s)})}return t}const A="q",B="m";function Ct(e){const{clientThreadId:t,currentLeafId:r,handleRequestCompletion:s}=e,n=m.useRef(!1),{isLoading:o,data:i}=T(),{doesUserHaveAnyAccountsWithPlusFeatures:a,isLoading:l}=j(),d=ae(),[c,f]=ie(),h=$(),Y=m.useCallback((p,E,M,z)=>{G.updateTree(t,S=>{S.addNode(p,M,E,Ee.User,void 0,z)})},[t]),Z=m.useCallback(async(p,{content:E,attachments:M},z,S,w,D)=>{const U=r,H=M.length>0?{attachments:M}:{};H.system_hints=S.systemHints,Y(p,U,E,H),s({type:we.Next,promptId:p,requestedModelId:D,eventMetadata:z,cancelActiveRequests:!0,completionMetadata:S,turnTracker:w})},[Y,s,r]),q=De(()=>window.location.pathname)??null,J=Ue();let X=!o&&!l&&q!=null;const[R,C]=m.useState(!0);return m.useEffect(()=>{if(!R||n.current)return;const p=Ne.getConversationMode(t);if(!X||p==null)return;if(!nt(q)||st(q)&&J===void 0||G.getServerThreadId(t)!=null){C(!1);return}const E=(()=>{try{return Object.fromEntries(new URLSearchParams(location.hash.slice(1)).entries())}catch{return{}}})(),M={...Object.fromEntries(c),...E},{[A]:z,[B]:S,[tt]:w}=M,D=(typeof z=="string"?z:null)??(typeof S=="string"?S:null);if(!D||!D.trim()){C(!1);return}const U=rt(w),H=be();n.current=!0;let N=i?.modelsList;U.has(y.Search)&&(N=N?.filter(Q=>Q.enabledTools?.includes(y.Search)));const ee=i&&de({...i,modelsList:N??[]},!!a,!!d?.isEnterprisey());if(ee==null){h.warning("No model available for this request"),C(!1);return}const he=new He,pe=w?.includes(y.Search);(e.prefetchSearchPromise??Promise.resolve(null)).then(Q=>{f(Se=>{const k=new URLSearchParams(Se);return k.delete(A),k.delete(B),k}),Z(H,{content:D,attachments:[]},{eventSource:"url"},{conversationMode:p,source:"instant-query",systemHints:w?Array.from(U):void 0,prefetchIds:Q!=null?[Q]:void 0,searchSource:pe?Fe.URL_SEARCH_HINT:void 0},he,ee?.id),C(!1)})},[o,l,X,q,i,a,d,Z,R,t,J,h,e.prefetchSearchPromise,c,f]),R&&(e.prefetchSearchPromise!=null||c.has(A)||c.has(B)?!0:(C(!1),!1))}function st(e){return fe(e)}function fe(e){return e==null?!1:/^\/g\/[\w-]+$/.test(e)}function nt(e){return e==null?!1:e==="/"||fe(e)}const Et="GPT Builder";function wt(e){if(e)return`ChatGPT - ${e}`}function V(e){return e.gizmo.short_url??e.gizmo.id??"-"}function ge(e){return`/g/${e}`}function Dt(e){return`https://chatgpt.com${ge(e)}`}function ot(e){return ge(V(e))}function bt(e,t){const r=new URLSearchParams;return t!=null&&r.set(A,t),Qe(new URL(`${ot(e)}?${r}`,"https://chatgpt.com"))}function Ft(e){return`/g/${V(e)}`}function Lt(e){return Ae(e)&&e.gizmo.live_version===0||Ie(e)&&e.liveVersion===0}function qt(e,t){return g({queryKey:["gizmos","discovery",{locale:e,isAnon:t}],queryFn:async()=>u.getGizmoDiscovery(e,t)})}function Rt({cutId:e,locale:t,limit:r,cursor:s,enabled:n=!0}){return ce({queryKey:["gizmos","discovery",{cutId:e,locale:t,limit:r}],queryFn:async({pageParam:o})=>u.getGizmoDiscoveryCut(e,{locale:t,cursor:o,limit:r}),initialPageParam:s,getNextPageParam:o=>o.list.cursor??void 0,enabled:n})}function Ut(){return g({queryKey:["gizmos","pinned"],queryFn:async()=>u.getGizmoPinned()})}function L(){return O({queryKey:["gizmos","bootstrap"],queryFn:async()=>u.getGizmoBootstrap().then(e=>({gizmos:e.gizmos.map(t=>({resource:t.resource,flair:t.flair}))}))})}function Ht(){return g(L())}function oe(e,t){const r=e.filter(n=>n.resource.gizmo.id!==t.resource.gizmo.id);let s=r.findIndex(n=>n.flair.kind===b.Recent);return s===-1&&(s=r.length),r.splice(s,0,t),r}const Qt={handleGizmoInteracted(e,t){const r=e.getQueryData(P(e,t).queryKey);r!=null&&e.setQueryData(L().queryKey,s=>{if(s==null)return s;const n=s.gizmos.find(o=>o.resource.gizmo.id===t);return n?.flair.kind===b.FirstParty||n?.flair.kind===b.SidebarKeep?s:{gizmos:oe(s.gizmos,{resource:r,flair:{kind:b.Recent}})}})},handleGizmoSidebarKeep(e,t){const r=e.getQueryData(P(e,t).queryKey);r!=null&&e.setQueryData(L().queryKey,s=>s==null?s:{gizmos:oe(s.gizmos,{resource:r,flair:{kind:b.SidebarKeep}})})},handleGizmoSidebarHide(e,t){e.setQueryData(L().queryKey,r=>r?.gizmos.some(s=>s.resource.gizmo.id===t)?{gizmos:r.gizmos.filter(s=>s.resource.gizmo.id!==t)}:r)}};function At(e,t=!1){const r=_();return g(P(r,e,t))}function It({gizmoId:e,draft:t,version:r}){const s=_(),n=r?{queryKey:["gizmo","version",{gizmoId:e,version:r}],queryFn:async()=>u.getVersion({gizmoId:e,version:r}),enabled:e!=null}:P(s,e,t);return g(n)}function Kt(e,t){return g({queryKey:["gizmo","userActionSettings",{gizmoId:e}],queryFn:async()=>u.getUserActionSettings(e),enabled:e!=null&&t})}function P(e,t,r=!1){return O({queryKey:["gizmo",{gizmoId:t},{draft:r}],queryFn:async()=>u.getGizmo(t,r),enabled:t!=null,initialData:()=>{if(r===!0)return;const s=e.getQueryData(L().queryKey);if(s!=null)return s.gizmos.find(o=>o.resource.gizmo.id===t)?.resource;const n=e.getQueryData(["gizmos","discovery"]);if(n!=null)for(const o of n.cuts){const i=o.list.items.find(a=>a.resource.gizmo.id===t)?.resource;if(i!=null)return i}}})}function xt(e,t){return e.fetchQuery(P(e,t))}function Ot(e){return g({queryKey:["gizmo",{search:e}],queryFn:async()=>u.getGizmoSearch(e),enabled:e.length>0})}function Nt(e,t){return g({queryKey:["gizmo-search-workspace",{search:e}],queryFn:async()=>u.getGizmoSearchForWorkspace(e),enabled:e.length>0&&t})}function kt(e,t=!1,r=!1,s=null){return ce({queryKey:[r?"gizmo-search-workspace":"gizmo",{query:e,cursor:s}],queryFn:async({pageParam:n})=>r?u.getGizmoSearchForWorkspace(e,s=n):u.getGizmoSearch(e,s=n),initialPageParam:s,getNextPageParam:n=>n.cursor??void 0,enabled:t})}function Bt(){const e=_();return v({mutationFn:async({gizmoId:t,editorData:r})=>{const{instructions:s,name:n,description:o,profilePictureId:i,profilePictureUrl:a,promptStarters:l,tools:d,files:c,trainingDisabled:f}=r;return u.upsertDraft({instructions:s,display:{name:n,description:o,profile_pic_id:i,profile_picture_url:a,prompt_starters:l},tools:d,files:c.map(h=>({...h,location:Ke.FILE_SERVICE})),training_disabled:f},t)},onSettled:t=>{t&&(e.setQueryData(P(e,t.gizmo.id,!0).queryKey,t),e.invalidateQueries({queryKey:["gizmos","mine"],refetchType:"none"}))}})}function jt(){const e=_();return v({mutationFn:async({gizmoId:t,data:r})=>{const{sharingRecipient:s,categories:n}=r,o=await u.promoteDraft({sharing:r.sharingSubjects&&r.sharingSubjects.length>0?r.sharingSubjects:{recipient:s},categories:n},t);if(o.error)throw new xe(o);return o.resource},onSettled:t=>{e.invalidateQueries({queryKey:["gizmos"],refetchType:"all"}),e.invalidateQueries({queryKey:["gizmos","pinned"],refetchType:"none"}),t&&e.setQueryData(P(e,t.gizmo.id,!1).queryKey,t)}})}function $t(){const e=_();return v({mutationFn:async({gizmoId:t})=>u.deleteGizmo(t),onSettled:()=>{e.invalidateQueries({queryKey:["gizmos"],refetchType:"all"})}})}function Wt(){const e=_(),t=$();return v({mutationFn:async({name:r,hideName:s,websiteUrl:n,willReceiveSupportEmails:o})=>u.updateBuilderProfile({name:r,hide_name:s,website_url:n,will_receive_support_emails:o}),onSuccess:r=>{e.setQueryData(["builderProfile"],r)},onError:r=>{t.warning(r.message)}})}function Vt(){return g({queryKey:["builderProfile"],queryFn:async()=>u.getBuilderProfile()})}function Yt(){return v({mutationFn:async({gizmoId:e})=>u.copyGizmo({gizmoId:e})})}function Zt(){return g({queryKey:["gizmoCategories"],queryFn:async()=>u.getCategories()})}function Jt(e,t){return!!(t!=null&&[se.PrimaryAssistant,se.GizmoInteraction].includes(t)&&e?.includes(F.GPT_4))}function Xt(e,t){const r=_(),s=$();return v({mutationFn:async({rating:n,message:o,includeFrom:i})=>{await u.upsertUserReview(e,n,o,i)},onSuccess:async()=>{r.invalidateQueries({queryKey:["gizmo","review",{gizmoId:e}]})},onError:n=>{s.danger(n.message)}})}function er(e,t){return t?`/g/${V(t)}/c/${e}`:`/c/${e}`}function tr(){return"/gpts"}function rr(){return"/gpts/mine"}function ye(e){return e?`/gpts/editor/${e}`:"/gpts/editor"}function sr(e){const t=it();return e==null?t:ye(e)}function it(e){return ye(e)}function nr(e){try{const t=new URL(e);return t.hostname=t.hostname.replace(/^(www\.|web\.|mbasic\.|mobile\.)(secure\.)?/,""),t.pathname="",[...t.searchParams.keys()].forEach(r=>t.searchParams.delete(r)),t.toString()}catch{return e}}function at(e){if(!e)return null;try{return new URL(e).hostname}catch{return null}}function or(e){const t=at(e);return t?t.replace(/^www\./,""):e}export{Je as $,Ut as A,Dt as B,bt as C,Yt as D,nr as E,Kt as F,ft as G,sr as H,vt as I,me as J,Tt as K,rr as L,Vt as M,Wt as N,xt as O,x as P,St as Q,zt as R,Zt as S,It as T,T as U,mt as V,Bt as W,jt as X,P as Y,et as Z,Mt as _,Xe as a,Jt as a0,Et as a1,gt as a2,yt as a3,ht as a4,ke as a5,_t as a6,dt as a7,Ct as a8,At as b,pt as c,ot as d,Xt as e,$t as f,er as g,Ft as h,Ot as i,Nt as j,Rt as k,kt as l,qt as m,tr as n,ye as o,or as p,Gt as q,ge as r,ne as s,wt as t,Pt as u,Lt as v,it as w,Ye as x,Ht as y,Qt as z};
//# sourceMappingURL=e1cnpm5dmj2ijz1x.js.map
