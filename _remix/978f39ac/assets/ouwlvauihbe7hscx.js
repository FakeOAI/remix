import{l as e,b2 as R,Z as x,r as d,P as p,a as f,V as k,a1 as h,W as M,m as _,bf as E,a0 as T}from"./bkk1etpxp73xgxkk.js";import{A as L,j as A,B as D,a as P,g as F}from"./e2lvmkzz1krdd0vf.js";import{g as w}from"./kqwdyvkaaavvn8k3.js";import{a as N}from"./cfzeniuwphg3p3m9.js";import{s as I}from"./go6iqv7kynl41ls2.js";import{c8 as U,c9 as q,f8 as z,f9 as B,c2 as V,O as G}from"./grdjxd4t00xxfgii.js";import{aT as O}from"./ho6syd1yt6mfjuy1.js";import{S as H,a as Q}from"./bwmsb2pjocc9pa1m.js";import{u as Z,S as c,a as j}from"./okhdof47k0vuhmqv.js";import{m as v}from"./on8dwna7kjymzk0v.js";function C({children:t}){return e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 text-sm font-semibold text-token-text-tertiary",children:[e.jsx(O,{className:"icon-2xl"}),t]})})}const W=({images:t,analyticsMetadata:r})=>{const n=t.map(s=>s.thumbnail_url),a=R({queries:n.map(s=>L(s)),combine:s=>{const o=new Set;return s.forEach((l,i)=>{l.isError&&o.add(n[i])}),o}});return e.jsx(e.Fragment,{children:t?.length>0?e.jsx("div",{className:"columns-1 gap-2 px-6 py-4 xs:columns-2 md:columns-3",children:t.map((s,o)=>!a.has(s.thumbnail_url)&&e.jsx("div",{className:"relative mb-0.5 break-inside-avoid",children:e.jsx(J,{image:s,analyticsMetadata:r})},o))}):e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(C,{children:e.jsx(x,{id:"AbVGAw",defaultMessage:"No Results"})})})})},J=({image:t,analyticsMetadata:r})=>{const n=N(t.url).data??w(t.url,"short"),{isSuccess:a}=A(t?.thumbnail_url),s={...I(r),url:t.url,title:t.title};d.useEffect(()=>{p.logEvent(f.searchSidebarImageShown,s)},[]);const o=U.useStore();return e.jsx("button",{onClick:()=>{p.logEvent(f.searchSidebarImageClicked,s),o.setCurrentImage(t?{image:t,source:q.ImagesTab,turnIndex:r.turnIndex}:void 0)},children:a?e.jsxs("div",{className:"group relative h-full w-full",children:[e.jsx("img",{src:t.thumbnail_url,alt:t.content_url,className:"w-full rounded-lg hover:opacity-100 group-hover:opacity-90"}),e.jsx("div",{className:"absolute bottom-1 left-1 max-w-[75%] truncate rounded-xl bg-black/40 px-2 py-1 text-xs font-medium text-white backdrop-blur-sm",children:n})]}):e.jsx("div",{className:"aspect-square h-full w-full animate-pulse bg-token-main-surface-tertiary"})})};function K({date:t}){const r=k(),n=t instanceof Date?t:new Date(t*1e3),a=z(n,new Date);if(a<4&&a>-4){const s=r.formatRelativeTime(a,"day",{numeric:"auto"});return s.charAt(0).toUpperCase()+s.slice(1)}else return r.formatDate(n,{year:"numeric",month:"long",day:"numeric"})}function X({citations:t,searchResults:r,analyticsMetadata:n}){if(t.length===0&&r.length===0)return e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(C,{children:e.jsx(x,{id:"AbVGAw",defaultMessage:"No Results"})})});const a=B(r,o=>o.entries).toSorted((o,l)=>(l?.pub_date??0)-(o?.pub_date??0)),s=t.toSorted((o,l)=>(l?.pub_date??0)-(o?.pub_date??0));return e.jsxs("div",{className:"mt-[-1px] flex w-full flex-col",children:[e.jsx(y,{title:e.jsx(x,{id:"dlVlo6",defaultMessage:"Citations"}),items:s,analyticsMetadata:n}),e.jsx(y,{title:e.jsx(x,{id:"iUafP7",defaultMessage:"Search Results"}),items:a,analyticsMetadata:n})]})}const Y=h.div`sticky top-[-1px] text-xs font-semibold border-token-border-light text-token-text-secondary border-y py-3 px-6 bg-token-main-surface-primary`;function y({title:t,items:r,analyticsMetadata:n}){return!r||r.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx(Y,{children:t}),e.jsx("div",{className:"flex flex-col gap-6 px-6 py-4",children:r.map((a,s)=>e.jsx($,{item:a,analyticsMetadata:n,index:s},s))})]})}function $({item:t,index:r,analyticsMetadata:n}){const a=N(t.url).data??w(t.url,"short"),s=o=>"ref_id"in o&&"content_type"in o;return e.jsx(ee,{analyticsMetadata:n,href:t.url,position:r,target:"_blank",rel:"noopener",className:"group flex gap-6",children:e.jsxs("div",{children:[e.jsxs("div",{className:"line-clamp-1 flex items-center gap-2 text-sm",children:[e.jsx(V,{url:t.url,className:"icon-sm rounded-full bg-token-main-surface-primary object-cover",size:32,minSize:20,fallback:e.jsx(H,{className:"icon-sm text-token-text-quaternary"})}),a,s(t)&&e.jsx(Q,{searchResult:t,className:"inline h-4 w-4 text-token-text-tertiary"})]}),e.jsx("div",{className:"line-clamp-2 text-sm font-semibold hover:underline",children:t.title}),(t.pub_date??t.snippet)&&e.jsxs("div",{className:"line-clamp-1 text-sm font-normal text-token-text-secondary",children:[t.pub_date&&e.jsx(K,{date:t.pub_date}),t.pub_date&&t.snippet&&" â€” ",t.snippet]})]})})}const ee=d.forwardRef(function(r,n){const{analyticsMetadata:a,position:s,...o}=r;function l(i){r.href&&p.logEvent(i,{...I(a),url:r.href,raw_position:s})}return d.useEffect(()=>{l(f.searchLinkShown)},[]),e.jsx("a",{ref:n,...o,onClick:i=>{r.onClick?.(i),i.stopPropagation(),l(f.searchLinkClicked)}})});function he({clientThreadId:t}){const r=k(),{tab:n,turnIndex:a,messageId:s}=Z(),o=[],l=a?D(t,a):[],i=a?P.getTurnSearchResults(t,a):[],g=a?F(t,a):[];(l.length>0||i.length>0)&&o.push(c.Sources),g.length>0&&o.push(c.Images);const u=d.useMemo(()=>({clientThreadId:t,messageId:s,turnIndex:a}),[t,s,a]),b=d.useCallback(()=>{j.close(n,u)},[n,u]);return!n||!a||o.length===0||!o.includes(n)?null:e.jsx(M,{size:"custom",noPadding:!0,isOpen:!0,onClose:b,type:"success",className:"focus-none max-w-2xl !shadow-none outline-none",children:e.jsxs("div",{className:"focus-none flex h-full flex-col items-center justify-start overflow-hidden rounded-lg outline-none",children:[e.jsxs(te,{children:[e.jsx(se,{children:o.map(m=>e.jsx("button",{onClick:()=>{j.open(m,u)},className:_("mb-[-1px] border-b-2 border-solid border-transparent py-6 text-lg font-medium text-token-text-tertiary hover:text-token-text-secondary",{"!border-token-text-primary font-semibold !text-token-text-primary":n===m}),children:r.formatMessage(ne[m])},m))}),e.jsx(E,{onClick:b})]}),e.jsx(ae,{children:e.jsx(G,{children:n===c.Sources?e.jsx(v.div,{...S,children:e.jsx(X,{citations:l,searchResults:i,analyticsMetadata:u})},"sources"):n===c.Images?e.jsx(v.div,{...S,children:e.jsx(W,{images:g,analyticsMetadata:u})},"images"):null})})]})})}const S={initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},className:"h-full overflow-y-auto relative"},te=h.div`flex w-full flex-row items-center justify-between border-b px-6 dark:border-gray-700`,se=h.span`text-base font-semibold sm:text-base flex gap-4`,ae=h.div`h-[60vh] max-h-[700px] w-full`,ne=T({[c.Images]:{id:"Z0ljgR",defaultMessage:"Images"},[c.Sources]:{id:"MqF7a0",defaultMessage:"Links"}});export{he as SearchResultsModal};
//# sourceMappingURL=ouwlvauihbe7hscx.js.map
