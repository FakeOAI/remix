const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/bqxw8mh7pkm6aahq.js","assets/bkk1etpxp73xgxkk.js","assets/ho6syd1yt6mfjuy1.js","assets/root-i1ttiyod.css","assets/grdjxd4t00xxfgii.js","assets/conversation-small-ni0cc2o5.css","assets/go6iqv7kynl41ls2.js","assets/e2lvmkzz1krdd0vf.js","assets/on8dwna7kjymzk0v.js","assets/e9jy1ikfzj9e62os.js","assets/kef7p4k14zdf1y4l.js","assets/c7q13bl1gi8tl4t7.js","assets/noj1s37nphyqi49g.js","assets/maxaz5tm7wf8nezx.js","assets/d1ew373qviaqzay3.js","assets/vl9odq9d9y6mtwt7.js","assets/bhiswq7l6vnbbd9g.js","assets/dabzk7p57vaeradh.js","assets/ickzndvtcdrritpi.js","assets/cvlbu2zjl8gk4d4y.js","assets/ejywl3vwz3cnyccm.js"])))=>i.map(i=>d[i]);
import{r as u,aD as oe,aE as ie,ao as H,P as N,a as C,V as L,bU as P,f5 as v,em as w,f6 as K,bz as le,l as s,m as S,cj as de,Q as ue,u as U,bB as ce,aK as fe,j as x,Z as I,a0 as me}from"./bkk1etpxp73xgxkk.js";import{ep as he,eq as ye,er as Q,es as ge,aR as G,et as pe,H as be,J as ve,bH as V,c as Se,eu as Te,ev as xe,ew as Ee,ex as q,ey as Ne,G as Ce,ef as we,ed as Ie,a3 as z,ez as Y,ee as ke,eo as Me}from"./grdjxd4t00xxfgii.js";import{u as Re}from"./d6xtt9rkfeozcyvb.js";import{b as je,g as _e}from"./go6iqv7kynl41ls2.js";import{b as De,r as M,s as $}from"./c7q13bl1gi8tl4t7.js";import{f as Oe}from"./kef7p4k14zdf1y4l.js";import{t as Ae,v as X,w as He,s as Le,T as J}from"./e2lvmkzz1krdd0vf.js";import{G as Z}from"./e9jy1ikfzj9e62os.js";import{a7 as Ue}from"./ho6syd1yt6mfjuy1.js";function Ge(e,l,t){const{title:r,titleSource:a}=Ae(e),[n,i]=u.useState(!1),d=r??l,o=u.useRef(d);return u.useEffect(()=>(t&&a===X.Generated&&d!==o.current&&i(!0),()=>{o.current=d}),[t,d,a]),{isTypingEffect:n,resolvedTitle:d}}const Be=oe(()=>ie(()=>import("./bqxw8mh7pkm6aahq.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20])).then(e=>e.GizmoConversationOptionsDropdown)),Fe=new Date(2024,8,24,13);function Pe(e){H.checkGate("3922476776")||he.abortAllRequests(),N.logEvent(C.loadThread,{threadId:e})}function Ve({conversation:e,conversationTitle:l,onOpenChange:t,testId:r}){const a=L(),{isUnauthenticated:n}=ue(),{eligible:i,markAsViewed:d}=be(ve.ArchiveConversationOnboarding),o=Le(e.id),[c,b]=u.useState(!1),y=U(),m=ce(),g=fe();return u.useEffect(()=>K(Z,{deleteChat:({serverThreadId:f})=>{f===e.id&&b(!0)},archiveChat:async({serverThreadId:f})=>{f===e.id&&(await x.patchConversation(e.id,{is_archived:!0}),M(y),H.logEvent("chatgpt_conversation_archived"),N.logEvent(C.conversationArchived),i&&(g.info(a.formatMessage({defaultMessage:"You can view archived chats in Settings",id:"HistoryGizmoItem.archiveChatOnboarding"}),{duration:10,hasCloseButton:!0}),d()),o&&V(m))}}),[m,g,y,i,e.id,a,o,d]),n?null:s.jsxs(s.Fragment,{children:[s.jsx(Se,{label:a.formatMessage({id:"tJPHEQ",defaultMessage:"Options"}),sideOffset:4,side:"top",children:s.jsx(Be,{clientThreadId:e.id,onOpenChange:t,children:s.jsx("button",{className:"flex items-center justify-center text-token-text-secondary transition hover:text-token-text-primary radix-state-open:text-token-text-secondary","data-testid":r,children:s.jsx(Ue,{className:"icon-md"})})})}),c&&s.jsx(Te,{title:l,handleDelete:()=>{x.patchConversation(e.id,{is_visible:!1}).then(()=>{M(y),H.logEvent("chatgpt_conversation_deleted"),N.logEvent(C.conversationDeleted)}),o&&V(m)},onClose:()=>{b(!1)}})]})}function qe({conversation:e,onClose:l}){const[t,r]=u.useState(e.title),a=U();function n(){t!==e.title&&(J.setTitle(e.id,t,X.User),N.logEvent(C.renameThread,{threadId:e.id,content:t}),x.patchConversation(e.id,{title:t}).then(()=>{M(a)}))}return s.jsx("input",{type:"text",value:t,onChange:i=>{r(i.target.value)},onKeyDown:i=>{switch(i.key){case"Escape":l();break;case"Enter":n(),l();break}},onBlur:()=>{n(),l()},autoFocus:!0,className:"w-full border border-token-border-light bg-transparent p-0 text-sm"})}const W=5,ze=3e3;function Ye({threadId:e}){const l=U(),t=u.useRef(!1),r=u.useRef(null);return u.useEffect(()=>{async function a(){t.current=!0;const n=await Oe(e);if(n.async_status===v.UNREAD){M(l),J.initThreadFromServerData(e,n,!0,void 0,!0);return}if(n.async_status!==v.STREAMING)return;const i=n.update_time??0;Q(new Date,new Date(i*1e3))<W?r.current=window.setTimeout(a,ze):x.setConversationStatus(e)}return t.current||a(),()=>{r.current&&window.clearTimeout(r.current)}},[l,e]),null}function $e({conversation:e,className:l,isActive:t,elementRef:r,isPrimaryBackgroundColor:a,testId:n}){const i=L(),[d,o]=u.useState(!1),[c,b]=u.useState(!1),{value:y}=P("3922476776"),{value:m}=P("232791851"),g=De(e.id),{value:f=null,source:T=null}=g??{},R=He(e.id),h=ye(R),E=Q(new Date,new Date(e.update_time??0))<W,j=e.update_time&&ge(new Date(e.update_time),Fe),_=f===v.STREAMING&&E,D=m&&!t&&!h&&j&&f===v.UNREAD,ee=m&&!t&&(h||_),te=m&&f===v.STREAMING&&T===w.SERVER&&!h&&E,O=u.useRef(!1);u.useEffect(()=>{O.current||y&&(async()=>(O.current=!0,t&&T===w.SERVER&&f===v.UNREAD&&(await x.setConversationStatus(e.id),$(e.id,null)),!t&&T===w.CLIENT&&f===v.UNREAD&&(await x.setConversationStatus(e.id,f),$(e.id,{value:v.UNREAD,source:w.SERVER})),O.current=!1))()},[y,t,e.id,f,T,h]),u.useEffect(()=>K(Z,{editTitle:({serverThreadId:p})=>{(p?p===e.id:t)&&o(!0)}}),[e.id,t]);const B=i.formatMessage({id:"mpXAeu",defaultMessage:"New chat"}),{resolvedTitle:A,isTypingEffect:se}=Ge(e.id,e.title,t),ae=le(),re=se&&t&&ae,{data:ne}=je(e.conversation_template_id??void 0),F=G();return s.jsxs("div",{className:S("no-draggable group relative rounded-lg active:opacity-90",l,t?"bg-token-sidebar-surface-secondary":"hover:bg-token-sidebar-surface-secondary",c&&!t&&"bg-token-sidebar-surface-secondary"),children:[te&&s.jsx(Ye,{threadId:e.id}),s.jsx(de,{to:_e(e.id,ne),onClick:p=>{p.metaKey||p.ctrlKey||t||Pe(e.id)},onDoubleClick:()=>{o(!0)},ref:r,className:"flex items-center gap-2 p-2",style:{maskImage:F?"var(--sidebar-mask)":void 0},children:s.jsxs("div",{className:S("relative grow overflow-hidden whitespace-nowrap",ee&&"loading-shimmer"),dir:"auto",children:[re?s.jsx(pe,{text:A||B}):A||B,!F&&s.jsx("div",{className:S("absolute bottom-0 top-0 to-transparent ltr:right-0 ltr:bg-gradient-to-l rtl:left-0 rtl:bg-gradient-to-r",a?t||!t&&c?"from-token-sidebar-surface-secondary":"from-token-main-surface-primary":!1,a?!1:t||!t&&c?"from-token-sidebar-surface-secondary":"from-token-sidebar-surface-primary",{"from-token-main-surface-primary can-hover:group-hover:from-token-sidebar-surface-secondary":a&&!t&&!c,"from-token-sidebar-surface-primary can-hover:group-hover:from-token-sidebar-surface-secondary":!a&&!t&&!c,"w-10 from-60%":t||c,"w-8 from-0% can-hover:group-hover:w-10 can-hover:group-hover:from-60%":!t&&!c})})]})}),d?s.jsx("div",{className:"absolute bottom-0 left-[7px] right-2 top-0 flex items-center bg-token-sidebar-surface-secondary",children:s.jsx(qe,{conversation:e,onClose:()=>{o(!1)}})}):D?s.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:s.jsx("div",{className:"h-2 w-2 rounded-full bg-blue-selection"})}):s.jsx("div",{className:S("absolute bottom-0 top-0 items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",t||c?"flex":"hidden can-hover:group-hover:flex"),children:s.jsx(Ve,{conversation:e,conversationTitle:A??e.title,onOpenChange:p=>{b(p),p&&N.logEvent(C.conversationHistoryItemOpenMenu,{conversationId:e.id})},testId:`${n}-options`})})]})}function Ke({className:e,elementRef:l,item:t,isActive:r,isFirstItem:a,isPrimaryBackgroundColor:n,testId:i}){const d=G();return s.jsx("li",{className:S("relative",a&&!d?"z-[15]":""),"data-testid":i,children:s.jsx($e,{className:e,isPrimaryBackgroundColor:n,conversation:t,isActive:r,elementRef:l,testId:i})})}const k=me({historyBucketToday:{id:"history.bucket.today",defaultMessage:"Today"},historyBucketYesterday:{id:"history.bucket.yesterday",defaultMessage:"Yesterday"},historyBucketLastSeven:{id:"history.bucket.lastSeven",defaultMessage:"Previous 7 Days"},historyBucketLastThirty:{id:"history.bucket.lastThirty",defaultMessage:"Previous 30 Days"}}),Qe=5;function nt(e,l){const t=L();return u.useMemo(()=>e.reduce((r,a)=>{const n=new Date(a.update_time??a.create_time??0),i=xe(new Date,n);if(i===0)r.recent.today.items.push(a);else if(i<=1)r.recent.yesterday.items.push(a);else if(i<=7)r.recent.lastSeven.items.push(a);else if(i<=30)r.recent.lastThirty.items.push(a);else if(Ee(n)){const d=q(n),o=Ne(n),c=`${d}-${o}`;r.dynamicMonths[c]?r.dynamicMonths[c].items.push(a):r.dynamicMonths[c]={label:t.formatDate(n,{month:"long"}),items:[a]}}else{const o=`${q(n)}-`;r.dynamicYears[o]?r.dynamicYears[o].items.push(a):r.dynamicYears[o]={label:t.formatDate(n,{year:"numeric"}),items:[a]}}return r},{recent:{today:{label:s.jsx(I,{...k.historyBucketToday}),items:[]},yesterday:{label:s.jsx(I,{...k.historyBucketYesterday}),items:[]},lastSeven:{label:s.jsx(I,{...k.historyBucketLastSeven}),items:[]},lastThirty:{label:s.jsx(I,{...k.historyBucketLastThirty}),items:[]}},dynamicMonths:{},dynamicYears:{}}),[l,e])}function ot({activeId:e,bucketedItems:l,items:t,hasNextPage:r,isPrimaryBackgroundColor:a,infiniteScrollTriggerElementRef:n}){const{isCollapsible:i}=Re(),d=Ce(we.isHistoryCollapsed),o=G(),[c]=Ie({onChange:b=>{u.startTransition(()=>{z.setHistoryShowMoreVisible(b)})}});return s.jsxs(s.Fragment,{children:[[l.recent,l.dynamicMonths,l.dynamicYears].flatMap((b,y)=>s.jsx(u.Fragment,{children:Object.entries(b).map(([m,{items:g,label:f}],T)=>{if(m!=="today"&&!g.length)return null;const R=!!g.find(h=>t.length>0&&h.id===t[0]?.id);return g.length>0&&s.jsxs("div",{className:S(a&&"first:mt-0",o&&"first:mt-1",!o&&"first:mt-0","relative mt-5 last:mb-5"),children:[s.jsx("div",{className:S("sticky",!o&&"bg-token-sidebar-surface-primary",o&&Y.historyHeading,o?"z-5 top-[--sidebar-sticky-threshold]":"top-0 z-20"),children:s.jsx("span",{className:"flex h-9 items-center",children:s.jsx(ke,{className:o?"pb-1.5 pt-2":void 0,children:f})})}),s.jsx("ol",{className:o?"flex flex-col gap-0.5":void 0,children:g.map((h,E)=>{const j=e===h.id,_=R&&E===0,D=r&&t[t.length-Qe-1]?.id===h.id?n:void 0;return s.jsx(Ke,{className:o?Y.historyItem:void 0,item:h,isActive:j,isFirstItem:_,isPrimaryBackgroundColor:a,elementRef:D,testId:`history-item-${E}`},`history-item-${h.id}-${m}`)})})]},`${m}-${y}-${T}`)})},`category-${y}`)),i&&!d&&s.jsx("div",{ref:c,children:s.jsx(Me,{type:"less",onClick:z.toggleHistoryCollapsed})})]})}export{ot as H,Ke as a,Pe as o,nt as u};
//# sourceMappingURL=2fn0olgj9xj3x0p7.js.map
