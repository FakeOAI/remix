const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/dc7nhzc4bjpnrebm.js","assets/lklglvrzltpv3f05.js","assets/cuau6nn9sjz8q54j.js","assets/root-ksnlquoy.css","assets/ebwx7yj0baonheef.js","assets/conversation-small-fwmnexun.css","assets/ojojmwkrwf2qo5jt.js","assets/iv0pftgeuwfkjcsj.js","assets/od0q70ax7x1slg7q.js","assets/kce41gtfqn7bq1j9.js","assets/lif4od4ycl7gaybt.js","assets/n45otc1227s1uah5.js","assets/k362shm1u5t3zzyg.js","assets/6tiysfziu7tlaxu0.js","assets/dqzga3jv5dl3on3n.js","assets/lmzbjyvjhw1bfge5.js","assets/bpllfnvb96ohwim3.js","assets/nrec8jffighc2o42.js","assets/mdke1pqae4fdutt7.js","assets/klgs6pcuziazspva.js","assets/gohhxhz0b8yog51x.js","assets/c1xhqq4r4ezy9z4y.js","assets/c4bxzbp1808foto4.js","assets/heefrlxlra66lmjs.js","assets/gq1oquoigcb35b69.js","assets/n9ac7jkxrn8rb3u0.js","assets/ckatlww9jl157xyn.js","assets/k6qr2h1jt9fkbk6o.js","assets/d8epg2zruc86plwg.js","assets/n4nvecrtmzmi2mhb.js","assets/ecvymonpk6i3gym8.js","assets/j9308vlrn6tbe0tp.js","assets/ihuvqs8vc6zr8kpb.js","assets/eoh3qcov0jni3wda.js","assets/ewq0jnwu0xqezvkp.js","assets/mbpqs85309a6oba4.js","assets/ci045r97kntz9ank.js","assets/nij922qkvy3j3fyz.js","assets/lr2wtvbk3k0uolp8.js","assets/et8bgtraglvdyxgt.js","assets/h7k9pb8k20kmalm6.js","assets/g6va54f1qx14it8i.js","assets/f3wqh5wbtzeabanv.js","assets/ja5tnxc24ymkpoik.js","assets/fzrn137102spawew.js","assets/e9lafxuzyeh4418f.js","assets/j9pn3dpqp3dnyeg5.js","assets/1lmhhk7yvulb1cj2.js","assets/hadglcpnftnvdlhd.js","assets/j2by1t70zmq6qdp0.js","assets/nsol011ve2gzel2c.js"])))=>i.map(i=>d[i]);
import{av as pe,cF as Ze,P as K,h as X,bB as pa,a$ as Pe,ax as Xt,bo as It,as as P,aq as Ps,ar as rt,gY as to,cL as fa,c as Kr,g as Xr,d4 as Te,bD as on,f as De,aR as Oe,aS as ze,dQ as rn,ao as lt,d6 as kt,v as J,s as Ie,bq as Qr,a7 as Cn,bd as Qt,ek as Zt,a2 as ln,bn as xa,fP as Zr,fN as Jr,em as ei,cy as ti,dV as Le,c9 as si,o as Ds,F as so,aU as no,ak as ct,ea as ni,fL as Mn,ah as Je,eu as ai,q as Vt,cI as oi,cJ as ri,b7 as ii,bp as li,bQ as Ve,u as Cs,gZ as ci,a6 as Nt,g_ as di,S as de,ce as ui,D as cn,fW as ao,ai as oo,dP as ro,f0 as mi,W as hi,a4 as va,dF as Jt,fB as gi,g$ as io,aT as Ls,fA as Bs,bl as qe,al as Tn,ga as _n,w as Fs,a1 as Qe,b8 as Sa,an as _t,J as At,r as Mt,a3 as lo,dW as pi,aW as fi,bb as xi,cz as co,bR as re,cg as vi,fF as Si,h0 as bi,Y as kn,Z as en,e0 as yi,h1 as ba,d3 as wi,a5 as ji,eU as uo,O as Ci,h2 as Mi,eY as Ti,bE as _i,dN as dn,dY as ki,n as Xe,cQ as Ni,dO as Ms,bv as hs,M as mo,ap as Ai,bf as Ei,h3 as ho,cY as Ri,eI as Ii,cE as Pi,be as Di,dG as Li,h4 as go,fJ as Nn,N as An,fK as Bi,h5 as Fi,X as Hi,cX as Ui,ba as Oi,f3 as Ue}from"./cuau6nn9sjz8q54j.js";import{j as e,r as i,M as U,ac as ne,ad as es,c as xe,au as zi,f as po,e as En,a as fo,X as Gi,v as Wi,L as Ts,R as xo,av as Vi,aw as qi,ax as ya}from"./lklglvrzltpv3f05.js";import{aS as Pt,gW as $i,ld as Yi,le as Ki,cV as Et,lf as vo,lg as So,lh as ye,cR as Hs,bJ as $t,li as _s,lj as He,hu as bo,lk as Xi,iX as yo,i_ as wo,eB as Qi,B as Zi,fv as Ji,iW as el,ll as jo,lm as tl,ln as sl,lo as Rt,lp as se,lq as Co,lr as ks,ls as nl,lt as al,lu as ol,lv as rl,eD as il,lw as ll,lx as cl,ly as dl,lz as ul,lA as ml,lB as hl,lC as gl,lD as pl,lE as fl,lF as xl,lG as vl,lH as Sl,lI as bl,lJ as Mo,lK as Rn,fC as In,lL as Pn,hm as Dn,hn as it,ho as Ln,E as yl,lM as To,kV as un,lN as _o,lO as wl,d7 as jl,f6 as Cl,lP as Ml,lQ as Tl,lR as _l,lS as Ns,lT as kl,kU as Nl,lU as ko,lV as Al,H as El,kS as Rl,jY as No,hH as Il,lW as Pl,bv as Bn,bw as Ao,dE as Dl,dh as Ll,dF as Eo,cc as Ro,by as Fn,g$ as ts,lX as wa,lY as Bl,lZ as Fl,bD as ja,bA as Hl,hL as Ul,j4 as Ca,l_ as Ol,l$ as zl,m0 as Gl,m1 as Hn,m2 as Wl,m3 as Vl,bH as Io,gf as Un,fR as On,m4 as Ma,ix as ql,bz as $l,m5 as Yl,hO as Kl,ja as Xl,hP as Ql,hM as Zl,m6 as Jl,bB as mn,m7 as ec,m8 as tc,m9 as sc,ma as nc,cv as ac,be as hn,mb as oc,co as zn,U as As,cQ as Es,bU as Gn,cY as rc,mc as ic,md as lc,me as cc,hp as dc,mf as uc,mg as mc,mh as hc,mi as gc,mj as pc,mk as fc,dv as xc,hG as vc,ke as Sc,ml as bc,mm as yc,mn as wc,cD as Po,mo as jc,fE as Wn,mp as Cc,fD as Mc,mq as Tc,mr as _c,ms as gn,mt as kc,mu as Nc,cT as pn,mv as Ac,mw as Ec,mx as Rc,my as Do,h_ as Vn,cW as Yt,mz as Ic,mA as Pc,mB as Dc,y as Lc,mC as fn,k as Lo,mD as qn,mE as Ta,mF as Bc,mG as Fc,mH as Hc,mI as Uc,mJ as Bo,cP as Oc,mK as zc,mL as Gc,cS as Us,cI as js,i2 as Wc,i3 as Vc,mM as qc,aZ as _a,dM as Fo,ds as $c,e_ as Yc,mN as Kc,Y as $n,mO as Yn,bx as Kn,hw as Xc,cC as Qc,dN as Zc,mP as Jc,mQ as ed,aK as td,mR as Ke,b1 as sd,mS as nd,mT as xn,mU as ad,mV as gs,mW as Ho,mX as od,gJ as rd,mY as id,iy as ps,mZ as ld,a$ as cd,d4 as dd,m_ as ud,fr as md,r as hd,m$ as gd,n0 as pd,fn as fd,n1 as xd,n2 as vd,ch as Sd,n3 as bd,n4 as Uo,n5 as Oo,n6 as zo,n7 as Go,n8 as Tt,f2 as Xn,n9 as yd,jc as wd,na as Wo,nb as jd,gi as Rs,nc as vn,nd as Cd,ne as Md,nf as fs,bV as ka,ca as Vo,cb as qo,gv as $o,gx as Yo,gT as Td,ng as _d,gO as kd,nh as Nd,ni as Ad,nj as Ed,nk as Rd,nl as Id,bu as Pd,du as Dd,gh as Ld,bW as Bd,nm as Fd,gU as xs,gu as Hd,gw as Ud,gF as Od,nn as zd,no as Gd,np as Wd,nq as Vd,nr as qd,ns as $d,nt as Yd,nu as Kd,nv as Xd,nw as Qd,bF as Zd,jS as Jd,jR as eu,nx as tu,h5 as su,ny as nu,nz as au,nA as Ko,A as ou,g5 as ru,he as iu,hf as lu,nB as cu,nC as du,nD as Xo,bI as uu,nE as Qo,nF as mu,nG as hu,nH as gu,cf as pu,cg as fu,ce as xu,cj as vu,nI as Su,cM as Is,ft as bu,bZ as yu,b_ as wu,is as ju,jW as Cu,nJ as Mu,hj as Tu,nK as _u,nL as ku,nM as Nu,nN as Au,nO as Eu,nP as Ru,aM as Iu,fo as Pu,b$ as Du}from"./ebwx7yj0baonheef.js";import{B as Lu}from"./lif4od4ycl7gaybt.js";import{C as Sn,g as Bu}from"./n45otc1227s1uah5.js";import{S as Zo,a as Fu,b as Hu,G as Uu,L as Ou,c as zu}from"./6tiysfziu7tlaxu0.js";import{h as Qn,s as Gu,i as Wu,j as vs,k as Vu,l as qu,m as $u,t as Yu,n as Os,C as Jo,u as er,o as Ku,p as tr,c as sr}from"./dqzga3jv5dl3on3n.js";const Na=pe.div`m-8 flex flex-col items-center`;function Aa(t){return e.jsx(ne.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...t})}function Xu({clientThreadId:t}){const a=Ze(t,o=>o?.promptGptRating)?.gizmoId,{data:n}=Pt(a);return a==null||n==null||!$i(n)?null:e.jsx(Qu,{gizmoId:a})}function Qu({gizmoId:t}){const[s,a]=i.useState(!1),[n,o]=i.useState(!1),r=Yi(t),c=async u=>{a(!0),setTimeout(()=>{o(!0)},5e3),K.logEvent(X.submitInlineRating,{gizmo_id:t,rating:u}),await r.mutateAsync({rating:u})},l=async()=>{o(!0),K.logEvent(X.dismissInlineRating,{gizmo_id:t}),await r.mutateAsync({})};return i.useEffect(()=>{n||K.logEvent(X.showInlineRating,{gizmo_id:t})},[n,t]),n?null:s?e.jsx(Na,{children:e.jsxs(Aa,{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"rounded-lg border border-token-border-heavy p-4",children:e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(U,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),e.jsx(pa,{onClick:()=>{o(!0)}})]})}),e.jsx("div",{className:"text-xs text-token-text-tertiary",children:e.jsx(U,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):e.jsx(Na,{children:e.jsxs(Aa,{className:"flex flex-col items-center gap-4 rounded-lg border border-token-border-heavy p-4",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(U,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),e.jsx(pa,{onClick:l})]}),e.jsx(Ki,{rating:void 0,onRating:c})]})})}const Ss={initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:.1},exit:{opacity:0,scale:.5,transition:{duration:.2}}},Zu=({suggestions:t,onSelectingSuggestedReply:s})=>e.jsx("div",{className:"absolute bottom-full flex w-full max-w-[100vw] grow gap-2 overflow-auto px-1 pb-1 contain-inline-size sm:mb-0 sm:justify-start sm:px-2 sm:pb-0 md:static md:mb-2 md:max-w-none md:justify-center md:overflow-visible",children:t.slice(0,2).map((a,n)=>e.jsx(ne.div,{initial:Ss.initial,animate:Ss.animate,transition:{delay:(n-1)*Ss.transition.delay},exit:Ss.exit,children:e.jsx(It,{as:"button",color:"secondary",size:"small",onClick:()=>{s(a,t,n)},className:"group whitespace-nowrap md:whitespace-normal",children:e.jsx(em,{suggestion:a})},n)},n))});function Ju({suggestions:t,onSelectingSuggestedReply:s,clientThreadId:a}){const n=t?.length>0;i.useEffect(()=>{n&&Et(t,a)},[n,a]);const{isUnauthenticated:o}=Pe();return n?t.every(vo)?e.jsxs(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"flex flex-col items-center",children:[o&&e.jsx(Xt,{className:"mb-6 h-12 w-12 sm:hidden"}),e.jsx(Zo,{starterPrompts:t,onSelectStarterPrompt:s})]}):t.every(So)?e.jsx(Zu,{suggestions:t,onSelectingSuggestedReply:s}):null:null}function em({suggestion:t}){return So(t)?e.jsx(e.Fragment,{children:t.text}):vo(t)?e.jsxs("div",{className:"flex flex-col overflow-hidden",children:[t.title&&e.jsx("div",{className:"truncate font-semibold",children:t.title}),e.jsx("div",{className:P("truncate font-normal",t.title?"opacity-50":""),children:t.body})]}):null}function tm(){const{store:t}=ye(),s=t.useSharedProps();return s?e.jsx(sm,{...s}):null}function sm({clientThreadId:t,suggestions:s}){const a=Hs();return s===void 0||s.length===0?null:e.jsx("div",{children:e.jsx(nm,{children:e.jsx("div",{className:"grow",children:s!==void 0&&e.jsx(Ju,{suggestions:s,onSelectingSuggestedReply:a,clientThreadId:t})})})})}const nm=pe.div`h-full flex ml-1 md:w-full md:m-auto gap-0 md:gap-2 justify-center`,nr=({className:t,children:s})=>e.jsx(ne.div,{className:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:s});function am({currentLeafId:t,canContinue:s,onContinueGenerating:a}){const n=i.useCallback(()=>{const r=new $t;a(t,r),_s()},[a,t]);let o=null;return s&&(o=e.jsx(rm,{onHandleContinueGenerating:n})),o&&e.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:o})}function om({className:t}){return e.jsx(bo,{className:P("-rotate-180",t)})}const rm=({onHandleContinueGenerating:t})=>e.jsx(nr,{children:e.jsx(It,{as:"button",color:"secondary",onClick:t,className:"whitespace-nowrap py-2",icon:om,size:"small",children:e.jsx(U,{...He.continueGenerating})})}),im=({clientThreadId:t})=>{const s=to(),a=Ps(t),n=rt(a);i.useEffect(()=>{n&&fa.dismissBanner()},[n]);const o=s?.is_dismissible?()=>fa.dismissBanner():void 0;return e.jsx(es,{children:s&&e.jsx(ne.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(Xi,{clientThreadId:t,rateLimitInfo:s,onDismiss:o})})})};function lm(t){const s=Ps(t),a=rt(s),n=to();return!a&&n!=null}const bn=window.sessionStorage,yn=Kr(Xr(()=>({memoryFullBannerDismissed:!!bn?.getItem(on.MemoryFullBannerDismissed)}))),ar={dismissBanner(){yn.setState(t=>{t.memoryFullBannerDismissed=!0}),bn?.setItem(on.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){yn.setState(t=>{t.memoryFullBannerDismissed=!1}),bn?.removeItem(on.MemoryFullBannerDismissed)}};function cm(t){const s=Te(t),a=yo(),{data:n}=wo(s,!1,a),o=n!=null,r=o&&n.memoryFullPct>=100,[c,l]=i.useState(!1);i.useEffect(()=>{!r&&o&&(l(!0),ar.clearDismissedBanner())},[r,o]);const u=yn(m=>m.memoryFullBannerDismissed);return r&&c&&!u}function dm(){const t=xe(),{openSettings:s}=Qi();return e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(Zi,{title:t.formatMessage(bs.memoryFullTitle),content:t.formatMessage(bs.memoryFullTooltip,bs.memoryFullTooltip.values),primaryCtaText:t.formatMessage(bs.memoryManageButton),onPrimaryCtaClick:()=>s(Ji.Personalization),onDismiss:()=>ar.dismissBanner()})})}const bs=De({memoryFullTitle:{id:"yRGU2/",defaultMessage:"Memory is full."},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"neUc+N",defaultMessage:"New memories won’t be created until you make space. <a>Learn more</a>",values:{a:t=>e.jsx("a",{href:el,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}}}),um=()=>{const{shouldShowSkipButton:t}=jo();return t?e.jsx(nr,{className:"flex justify-center",children:e.jsx(It,{as:"button",color:"secondary",onClick:()=>tl.skipParagen(),children:e.jsx(U,{...mm.skip})})}):null},mm=De({skip:{id:"dvcUbp",defaultMessage:"Skip"}}),or=i.memo(function({className:s}){const{store:a}=ye(),n=a.useIsHeaderContentAreaPopulated();return e.jsx("div",{className:P(s??"absolute bottom-full left-0 right-0",ks.PromptTextareaHeader),children:e.jsx(sl,{shouldRender:n,contentArea:Rt.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(rr,{}),e.jsx(ir,{})]})})})});function rr(){const{store:t}=ye(),s=t.useSharedProps(o=>o?.clientThreadId),a=t.useContentAreaId(Rt.HeaderTop);let n;switch(a){case se.AdvancedVoiceOnMobileAnnouncement:n=e.jsx(rl,{clientThreadId:s});break;case se.ParagenControls:n=e.jsx(um,{});break;case se.ItemActions:n=e.jsx(tm,{});break;case se.BannerSignup:n=e.jsx(pm,{});break;case se.BannerTermsDisclaimer:n=e.jsx(fm,{});break;case se.PromptTextareaAction:n=e.jsx(xm,{});break;case se.BannersRateLimit:n=e.jsx(vm,{});break;case se.BannerSidekickAnnouncement:n=e.jsx(ol,{});break;case se.SearchBrowserExtensionAnnouncement:n=e.jsx(al,{});break;case se.SearchBrowserExtensionReactiveAnnouncement:n=e.jsx(nl,{});break;case se.BannerMemoryFull:n=e.jsx(dm,{});break;case se.Box:n=e.jsxs("div",{className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;default:n=null;break}return n}function ir(){const{store:t}=ye(),s=t.useContentAreaId(Rt.HeaderBottom);let a;switch(s){case Co.DallePromptControls:a=e.jsx(gm,{});break;default:a=null;break}return a}const hm=Oe(()=>ze(()=>import("./dc7nhzc4bjpnrebm.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.default));function gm(){const{store:t}=ye(),s=t.useSharedProps(a=>a?.composerController);return s?e.jsx(hm,{composerController:s}):null}function pm(){const{store:t}=ye(),s=t.useSharedProps(o=>o?.clientThreadId),a=il(),n=ll();return s?a?e.jsx(cl,{threadId:s,showSignUp:n}):e.jsx(dl,{threadId:s,showLogin:n}):null}function fm(){const{store:t}=ye(),s=t.useSharedProps(a=>a?.clientThreadId);return s?e.jsx(ul,{threadId:s}):null}function xm(){const{store:t}=ye(),s=t.useSharedProps();return s?e.jsx(am,{...s}):null}function vm(){const{store:t}=ye(),s=t.useSharedProps(a=>a?.clientThreadId);return s?e.jsx(im,{clientThreadId:s}):null}const Sm=i.memo(function(s){return bm(s),ym(s),wm(),null});function bm(t){const{store:s}=ye(),a=s.useSetSharedProps();rn(()=>{a(t)},[t,a])}function ym(t){const{clientThreadId:s,canContinue:a}=t,{store:n}=ye(),o=i.useRef({top:n.useContentAreaApi(Rt.HeaderTop),bottom:n.useContentAreaApi(Rt.HeaderBottom)}).current,r=Mm(t),c=ml(s),{shouldShowBannerSignup:l,shouldShowBannerTermsDisclaimer:u}=Tm(s),m=lm(s),d=hl(t),h=gl(t),g=pl(t),v=cm(s),x=fl(),f=xl(t);rn(()=>{f.eligible?o.top.set(se.AdvancedVoiceOnMobileAnnouncement):x?o.top.set(se.ParagenControls):u?o.top.set(se.BannerTermsDisclaimer):m?o.top.set(se.BannersRateLimit):d.eligible?o.top.set(se.BannerSidekickAnnouncement):h?o.top.set(se.SearchBrowserExtensionAnnouncement):g?o.top.set(se.SearchBrowserExtensionReactiveAnnouncement):r?o.top.set(se.ItemActions):a?o.top.set(se.PromptTextareaAction):l?o.top.set(se.BannerSignup):v?o.top.set(se.BannerMemoryFull):o.top.set(null)},[o,r,a,u,l,m,d,v,x,f]),rn(()=>{c&&o.bottom.set(Co.DallePromptControls)},[o,c])}function wm(){const{store:t}=ye();i.useEffect(()=>()=>{t.reset()},[t])}function jm(t){const s=Mo(),a=lt(t),n=J.getTree(t).getLastValidNode(a)?.message?.id;return s?.messageId===n?s.suggestions:[]}function Cm(t){return jm(t).length>0}function Mm(t){const s=vl(t.clientThreadId),a=Cm(t.clientThreadId);return t.isDisabled?!1:t.isNewThread||s||a}function Tm(t){const{isUnauthenticated:s}=Pe(),a=lt(t),{layer:n}=kt("3637408529"),o=n.get("should_show_no_auth_signup_banner",!0),r=Sl(g=>g.bannerDisclaimerClientThreadId),c=bl(),l={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1};if(!t)return l;const u=J.getTree(t),m=u.countMessagesByAuthor(Ie.User),d=u.getNodeByIdOrMessageId(a),h=d?.message?.author.role===Ie.Assistant&&Qr(d.message);return l.shouldShowBannerTermsDisclaimer=h&&s&&m===1&&!c&&(r==null||r===t),l.shouldShowBannerSignup=o&&h&&s&&m>0&&m%5===0,l}function _m({composerController:t,isDisabled:s,highlightTooltip:a,clientThreadId:n}){const{setThreadSearchMode:o}=Rn(),r=In(),c=zi(),[l,u]=i.useState(!1),m=xe(),d={clientThreadId:n};return e.jsx(Nm,{highlightTooltip:a,analyticsMetadata:d,isThreadUsingSearchMode:r,isDisabled:s,children:e.jsxs("button",{className:P("flex h-8 min-w-8 items-center justify-center rounded-lg p-1 text-xs font-semibold",l&&"transition-all duration-150",r||a?"!rounded-2xl bg-blue-250 text-blue-1000 hover:bg-[#BDDCF4] dark:bg-[#2A4A6D] dark:text-[#48AAFF] dark:hover:bg-[#1A416A]":s?"opacity-30":"hover:bg-black/10 focus-visible:outline-black dark:focus-visible:outline-white"),"aria-pressed":r,"aria-label":m.formatMessage({id:"Sl1VH/",defaultMessage:"Search the web"}),disabled:s,onTransitionEnd:()=>u(!1),onClick:h=>{h.stopPropagation(),h.preventDefault(),u(!0),K.logEventWithStatsig(X.composerSearchButtonClicked,"composer_search_button_clicked",d),o(!r,d,Cn.CONVERSATION_COMPOSER_WEB_ICON),/^search\s?$/i.test(t.getCurrentText())&&t.setText(""),t.replaceSlashCommandTokensWithText(),t.focus()},children:[e.jsx(Pn,{}),e.jsx(es,{children:r&&e.jsx(ne.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:c?0:.15},children:e.jsx("div",{className:"whitespace-nowrap pl-1 pr-2",children:e.jsx(U,{id:"TbHx8d",defaultMessage:"Search"})})})})]})})}function km(){const t=Dn(it.hasSeenComposerSearchButtonTooltip);return!t.isLoading&&t.eligible}function Nm({children:t,highlightTooltip:s,analyticsMetadata:a,isThreadUsingSearchMode:n,isDisabled:o}){const r=km()&&!n,c=Dn(it.hasSeenComposerSearchButtonTooltip);return r?e.jsx(Ln,{announcementKey:it.hasSeenComposerSearchButtonTooltip,side:"right",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(U,{id:"Yjduqi",defaultMessage:"Search the web"}),onDismiss:c.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(U,{id:"W51Aei",defaultMessage:"Get fast answers with trusted sources. {learnMore}",values:{learnMore:e.jsx(yl,{href:"https://openai.com/index/introducing-chatgpt-search",className:"underline",children:e.jsx(U,{id:"stA7F4",defaultMessage:"Learn more"})})}}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx(Qt,{sideOffset:0,label:o?e.jsx(U,{id:"GpDAWD",defaultMessage:"Search is unavailable"}):e.jsx(U,{id:"c+4o2s",defaultMessage:"Search the web"}),side:"right",open:s||(n?!1:void 0),onOpenChange:l=>{l&&K.logEventWithStatsig(X.composerSearchButtonHovered,"composer_search_button_hovered",a)},children:t})})}function Am({composerController:t,clientThreadId:s}){const a=Zt(s),{setThreadSearchMode:n}=Rn(),r=To().size>0,c=un(s,ln.Search),l=_o(s),[u,m]=i.useState([]),[d,h]=i.useState(void 0),[g,v]=i.useState(0);i.useEffect(()=>{m(d?l.filter(T=>T.name.toLocaleLowerCase().startsWith(d.text.toLocaleLowerCase())||T.systemHint.toLocaleLowerCase().startsWith(d.text.toLocaleLowerCase())):[])},[d]),i.useEffect(()=>{const T=C=>{h(R=>ti(R,C)?R:C)};t.view.dispatch(Gu(t.view.state.tr,{onHintMatch:T}))},[t]);const x=r||!l.length||!u.length||!d;i.useEffect(()=>{x&&v(0)},[x]);const f=u.length,A=i.useCallback(T=>{v(C=>(T(C)%f+f)%f)},[f]),w=u[g],M=({hintToSave:T=w,expectPerfectMatch:C,appendSpace:R=!0})=>{if(!d||!w||C&&T.name.toLowerCase()!==d.text.toLowerCase())return;K.logEvent(X.systemHintSelected,{system_hint:T.systemHint,conversation_id:a??xa});const E=d.text+T.name.slice(d.text.length),p={clientThreadId:s};Vu(t.view,{id:T.systemHint,hint:E},d.range,R,c,B=>n(B,p,Cn.CONVERSATION_COMPOSER_SLASH_SEARCH)),vs(t.view)},y=i.useRef(M);y.current=M;const S=i.useRef(A);S.current=A;const N=i.useRef(d);N.current=d;const D=t.view;return i.useEffect(()=>(x||Wu(D,T=>{T==="up"?S.current(C=>C-1):T==="down"?S.current(C=>C+1):T==="cancel"?(vs(D),qu(D)):T==="submit"?(y.current({expectPerfectMatch:!1}),vs(D)):T==="checkMatch"&&y.current({expectPerfectMatch:!0,appendSpace:!1})}),()=>vs(D)),[x,D]),i.useEffect(()=>{x||K.logEvent(X.systemHintListOpened,{conversation_id:a??xa})},[x]),x?null:e.jsx(Zr,{className:"max-w-60",onMouseDown:T=>{T.preventDefault()},children:u.map((T,C)=>e.jsx("div",{onMouseOver:()=>v(C),onClick:()=>{M({hintToSave:T,expectPerfectMatch:!1}),t.focus()},children:e.jsx(Jr,{autoFocus:!1,className:"group rounded-lg px-1 py-2 hover:bg-token-hint-text",$spoofHovered:C===g,children:e.jsx(Em,{title:T.name,description:T.description,icon:e.jsx(wl,{svgString:T.logo,className:"icon-lg text-token-text-secondary group-hover:text-white"}),checked:!1})})},T.systemHint))})}function Em({title:t,description:s,icon:a,checked:n}){return e.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-1.5 pl-1.5 pr-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:a}),e.jsxs("div",{className:"shrink grow basis-0",children:[e.jsx("p",{className:"text-sm font-normal leading-tight text-token-text-primary group-hover:text-white",children:t}),!!s&&e.jsx("p",{className:"text-[13px] font-normal leading-[18px] text-token-text-secondary group-hover:text-white",children:s})]}),n&&e.jsx(ei,{className:P("icon-md text-token-text-primary",{"group-hover:hidden":!n})})]})}function Rm({composerController:t,clientThreadId:s}){return t instanceof Qn?e.jsx(Am,{composerController:t,clientThreadId:s}):null}function Im({children:t,className:s,showBackground:a}){return e.jsxs("div",{className:"relative",children:[t,a&&e.jsx(ne.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:P("pointer-events-none absolute bottom-0 top-0 h-8 w-8 rounded-full",s)})]})}function Pm({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:a,modelSupportedImageMimeTypes:n,attachmentsProductFeature:o,getInputProps:r,openFileDialog:c,onOauthRedirect:l,historyDisabled:u,isDisabled:m,highlightTooltip:d}){const h=jl(),{gdriveStatus:g,o365Status:v}=Cl(),x=e.jsx(_l,{className:u?"text-white":d?"text-brand-blue-800":void 0}),f=g!=="false"||v!=="false"||h;return e.jsx("div",{className:"relative",children:e.jsx(Im,{showBackground:d,className:"bg-brand-blue-800/20",children:f?e.jsx(Ml,{clientThreadId:t,icon:x,modelAcceptedMimeTypes:a,modelSupportedImageMimeTypes:n,attachmentsProductFeature:o,onOauthRedirect:l,uploadType:s,openFileDialog:c,getInputProps:r,isDisabled:m,highlightTooltip:d}):e.jsx(Tl,{clientThreadId:t,uploadType:s,openFileDialog:c,getInputProps:r,icon:x,isDisabled:m,highlightTooltip:d})})})}function Dm({suggestions:t,composerController:s,onSelect:a,onChange:n}){const o=Hs(),r=i.useCallback((d,h,g)=>{a?.(d,h,g),o(d,h,g)},[a,o]),[c,l]=i.useState(-1),[u,m]=i.useState(!1);return i.useEffect(()=>{const d=h=>{if(h.key==="ArrowDown"){const g=c===t.length-1?0:c+1;l(g),n?.(g,!0,t[g])}else if(h.key==="ArrowUp"){h.preventDefault();const g=c<=0?t.length-1:c-1;l(g),n?.(g,!0,t[g])}else h.key==="Enter"&&!h.shiftKey&&t[c]&&r(t[c],t,c)};return s.subscribe("keydown",d)},[t,c,n,r,s]),i.useEffect(()=>s.subscribe("blur",()=>{l(-1),n?.(-1,!1)}),[s,n]),i.useEffect(()=>{if(!u){const d=()=>{m(!0),window.removeEventListener("mousemove",d)};return window.addEventListener("mousemove",d),()=>{window.removeEventListener("mousemove",d)}}},[u]),i.useEffect(()=>{l(-1),n?.(-1,!1),m(!1)},[t,n]),e.jsx(ne.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"hidden w-full flex-col p-2.5 group-focus-within:flex group-focus-within:max-lg:flex-col-reverse",children:t.map((d,h)=>e.jsxs(ne.li,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:h*.03},exit:{opacity:0,translateY:4},className:"w-full",children:[h>0&&e.jsx("div",{className:P("h-[1px] opacity-60 max-lg:hidden",c===h||c===h-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")}),e.jsxs("button",{className:P("flex w-full cursor-pointer items-center justify-start whitespace-pre-wrap rounded-lg px-2.5 py-3 text-start",c===h?"bg-token-main-surface-secondary":"bg-token-main-surface-primary"),onClick:g=>{g.preventDefault(),r(d,t,h)},onMouseDown:g=>{g.preventDefault()},onMouseEnter:()=>{u&&(l(h),n?.(h,!1,d))},onMouseLeave:()=>{l(-1),n?.(-1,!1,d)},children:[d.icon?e.jsx("span",{className:"mr-4 h-6 w-6 text-token-text-secondary",children:d.icon}):null,e.jsx("span",{className:"whitespace-pre-wrap",children:d.autocompletionChunks&&d.autocompletionChunks.length>0?e.jsx(e.Fragment,{children:d.autocompletionChunks.map((g,v)=>e.jsx("span",{className:P(g.isMatched?"text-token-text-tertiary":"text-token-text-primary"),children:g.text},v))}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:P(d.type===Ns.Starter?"text-token-text-secondary":"text-token-text-tertiary"),children:d.title}),e.jsx("span",{className:"text-token-text-primary",children:d.body})]})})]}),h>0&&e.jsx("div",{className:P("h-[1px] opacity-60 lg:hidden",c===h||c===h-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")})]},d.id??h))})}function Lm(t,s){t=t.toLocaleLowerCase();const a=s;s=s.toLocaleLowerCase();const n=[];let o=0;for(let l=0;l<s.length&&(o<t.length&&t[o]===s[l]&&(n.push(l),o++),o!==t.length);l++);const r=[];let c=0;if(n.forEach(l=>{if(l>c){const u=a.slice(c,l);u&&r.push({text:u,isMatched:!1})}r.push({text:a[l],isMatched:!0}),c=l+1}),c<s.length){const l=a.slice(c);l&&r.push({text:l,isMatched:!1})}return Bm(r)}function Bm(t){if(t.length===0)return t;let s=[t[0]];for(let n=1;n<t.length;n++){const o=s[s.length-1],r=t[n];o.isMatched===r.isMatched?o.text+=r.text:s.push(r)}const a=s.filter(n=>n.isMatched).reduce((n,o)=>n+o.text.trim().length,0);return s.length<=4&&a>=2?s:[{text:s.map(n=>n.text).join(""),isMatched:!1}]}const Fm=i.forwardRef(function({type:s,placeholder:a,replyRegions:n,state:o,renderFiles:r,leftSideActions:c,topRightAction:l,onSubmit:u,inputState:m,currentLeafId:d,composerController:h,clientThreadId:g,gizmoId:v,disableReason:x},f){const A=Le(),w=kl();let M=null;const{isLoading:y}=w;y||(M=w.modelId),i.useEffect(()=>{y||Nl()||h.focus()},[M,h,y]);const S=N=>{Wm({target:N.target,rootId:"composer-background",additonalInteractiveIds:["reply-regions"]})||h.focus()};return e.jsxs("div",{id:"composer-background",ref:f,className:P("flex w-full cursor-text flex-col rounded-3xl px-2.5 py-1 transition-colors contain-inline-size",A&&"backdrop-blur-2xl no-transparency:backdrop-blur-none",A&&s!=="temporary"&&"bg-token-composer-surface",!A&&s!=="temporary"&&"bg-[#f4f4f4] dark:bg-token-main-surface-secondary",s==="temporary"&&"dark bg-black"),onClick:S,children:[e.jsx(es,{initial:!1,children:n.length>0&&e.jsx(ne.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0,transition:{duration:.06}},transition:{ease:"easeOut",duration:.1},id:"reply-regions",children:e.jsx(Um,{replyRegions:n})})}),e.jsxs(e.Fragment,{children:[r,e.jsxs("div",{className:"flex min-h-[44px] items-start pl-2",children:[e.jsx("div",{className:"min-w-0 max-w-full flex-1",children:h instanceof ko?e.jsx(Hm,{composerController:h,currentLeafId:d,placeholder:a,inputState:m}):e.jsx($u,{composerController:h,placeholder:a})}),e.jsx("div",{className:"w-[32px] pt-1",children:l})]}),e.jsxs("div",{className:"flex h-[44px] items-center justify-between",children:[e.jsx("div",{className:"flex gap-x-1",children:c}),e.jsx(Al,{inputState:m,state:o,onSubmit:u,composerController:h,clientThreadId:g,gizmoId:v,disableReason:x})]})]})]})});function Hm({composerController:t,currentLeafId:s,placeholder:a,inputState:n}){const o=i.useContext(si);return e.jsxs(e.Fragment,{children:[e.jsx(El,{id:Rl,autoFocus:!0,tabIndex:0,"data-id":s,dir:"auto",ref:r=>{if(!(t instanceof ko))throw new Error("Expected TextAreaComposerController");r!=null&&(t.textArea=r,t.logPageMount())},rows:1,placeholder:a,disabled:n!=="default",className:P("m-0 resize-none border-0 bg-transparent px-0 text-token-text-primary focus:ring-0 focus-visible:ring-0",n==="disabled"&&"text-center",["max-h-[25dvh]","max-h-52"])}),e.jsx("script",{nonce:o.cspScriptNonce,suppressHydrationWarning:!0,children:"requestAnimationFrame((function(){window.__oai_logTTI?window.__oai_logTTI():window.__oai_SSR_TTI=window.__oai_SSR_TTI??Date.now()}))"})]})}function Um({replyRegions:t}){return e.jsx("div",{className:"flex cursor-auto flex-col divide-y divide-token-border-light overflow-hidden rounded-b-lg rounded-t-[20px] bg-token-main-surface-primary",children:t.map((s,a)=>{switch(s.type){case"text":return e.jsx(Om,{value:s.value,onRemoveRegion:s.onRemoveRegion},a);case"object":return e.jsx(zm,{value:s.value,onRemoveRegion:s.onRemoveRegion},a);case"mention":case"system_hint":return e.jsx(Gm,{value:s.value,icon:s.icon,onRemoveRegion:s.onRemoveRegion},a)}})})}function Om({value:t,onRemoveRegion:s}){return e.jsxs(Jn,{className:"text-token-text-secondary",children:[e.jsx(ea,{children:e.jsx(No,{className:"icon-lg-heavy"})}),e.jsx(ta,{children:`“${t}”`}),e.jsx(Zn,{onClick:s})]})}function zm({value:t,onRemoveRegion:s}){return e.jsxs(Jn,{className:"text-blue-selection",children:[e.jsx(ea,{children:e.jsx(No,{className:"icon-lg-heavy"})}),e.jsx(ta,{className:"font-semibold",children:t}),e.jsx(Zn,{onClick:s})]})}function Gm({value:t,icon:s,onRemoveRegion:a}){return e.jsxs(Jn,{children:[e.jsx(ea,{className:"mt-0",children:s}),e.jsx(ta,{className:"font-semibold text-token-text-primary",children:t}),e.jsx(Zn,{onClick:a})]})}function Zn({onClick:t}){return e.jsx("button",{onClick:t,type:"button",className:"flex-shrink-0 text-token-text-secondary",children:e.jsx(Il,{className:"icon-lg"})})}const Jn=pe.div`flex items-start py-2.5 gap-3 pl-3 pr-1.5 text-sm`,ea=pe.span`flex-shrink-0 mt-0.5 w-7 h-6 flex justify-center items-center`,ta=pe.span`flex-1 line-clamp-3 py-0.5`;function Wm({target:t,rootId:s,additonalInteractiveIds:a}){let n=t;for(;n&&n!=null;){if(n.tagName==="BUTTON"||n.tagName==="INPUT"||n.tagName==="TEXTAREA"||n.isContentEditable||a.includes(n.id))return!0;if(n.id===s)return!1;n=n.parentElement}return!1}function Vm({composerController:t,isDisabled:s,clientThreadId:a}){const n=xe(),o=Dn(it.hasSeenComposerSystemHintButtonTooltip),c=_o(a).length>0,u=To().size>0,m=s===!0||!c||u;if(!(t instanceof Qn))return null;const d=t,h={clientThreadId:a};function g(){K.logEventWithStatsig(X.composerSystemHintButtonClicked,"composer_system_hint_button_clicked",h),o.markAsViewed(),d.focus(),Yu(d.view)}const v=e.jsx("button",{className:P("flex h-8 min-w-8 items-center justify-center rounded-lg p-1 text-xs font-semibold",m?"opacity-30":"hover:bg-black/10 focus-visible:outline-black dark:focus-visible:outline-white"),"aria-label":n.formatMessage({id:"oDAnGy",defaultMessage:"Use a tool"}),disabled:m,onPointerDown:g,onMouseDown:x=>{x.preventDefault()},onClick:x=>{x.preventDefault(),x.detail===0&&g()},children:e.jsx(Pl,{})});return!o.isLoading&&o.eligible?e.jsx(Ln,{announcementKey:it.hasSeenComposerSystemHintButtonTooltip,show:!0,side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(U,{id:"tTydhk",defaultMessage:"All your tools, in one handy place"}),onDismiss:o.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(U,{id:"S+BFNe",defaultMessage:"Create a canvas, generate a picture, and more."}),children:v}):e.jsx(Qt,{side:"right",sideOffset:0,label:s?e.jsx(U,{id:"uw9x80",defaultMessage:"Tools unavailable"}):e.jsx(U,{id:"mrYNGk",defaultMessage:"View tools"}),onOpenChange:x=>{x&&K.logEventWithStatsig(X.composerSystemHintButtonHovered,"composer_system_hint_button_hovered",h)},children:v})}const qm=1,$m=3e3;function Ym({files:t,className:s}){const a=Es(),n=Ao(),o=pc();return e.jsxs("div",{className:s,children:[o.map(r=>e.jsx(fc,{textdocId:r.tempTextdocId,userCreatedTextdoc:r},r.tempTextdocId)),t.map(r=>e.jsx(xc,{borderRadius:"2xl",useV2Style:!0,width:a?"normal":"wide",onRemoveFileClick:()=>mn.remove(n,r.tempId,"none"),file:r.file,fileId:r.fileId??void 0,contextConnectorInfo:r.contextConnectorInfo,loadingPercentage:r.status===vc.Uploading?r.progress:void 0},r.tempId))]})}function Km({onAbortCompletion:t,onCreateNewCompletion:s,onContinueGenerating:a,currentModelId:n,clientThreadId:o,isNewThread:r,isCompletionInProgress:c,className:l,disabled:u=!1,disabledReason:m,canPause:d=!1,canContinue:h=!1,suggestions:g,isInteractableSharedThread:v,composerContainerRef:x,autocompletions:f,requiresFileUpload:A,onComposerInput:w,onComposerChange:M,onAutocompleteSelect:y,headerClassName:S,hideHeader:N,setComposerBarElement:D,onTaggingDropdownOpen:T,onTaggingDropdownClose:C}){const R=i.useRef(null),E=Sc(R,D),p=Os(),B=Bn(),j=Ds(),{isUnauthenticated:H}=Pe(),G=xe(),_=so(),I=Ao(),b=lt(o),F=Ps(o),[Y]=po(),te=En(),{gizmoEditorData:q,mode:ie,getGizmoId:le}=Dl(),Q=no(),he=Ll(),we=ct(),Be=Eo(),ce=Zt(o),fe=!!ni(),je=!!Mn(),[ve,Ae]=i.useState({}),{setThreadSearchMode:Ee,clearSearchModeTrigger:Fe,getSearchModeTrigger:Ce}=Rn(),O=In(),[L,V]=i.useState(!1),[W,Z]=i.useState(!1),ae=Le(),ge=i.useRef(!1),Se=Ro(),oe=n!==null?Se[n]:void 0,Re=Ze(o,k=>k?.overrideModelId);let $=Fn(o),Me=$&&"gizmo"in $?$.gizmo:void 0;const Ge=ts(Me?.gizmo.id),[ee,dt]=i.useState(null);ee!==null&&($={gizmo:ee,gizmo_id:ee.gizmo.id,kind:Je.GizmoInteraction},Me=ee);const ut=wa(oe,$);let mt=!1;Bl($)&&Me?.gizmo.id===Fl&&(mt=!0);const zs=ai(),Dt=!u&&!mt&&ut!==ja.None&&!H,$e=Hl(oe,$),ht=Ul(oe,$);let _e=Ca(k=>k.files);const[gt]=i.useState(()=>Ol());ie==="magic"?_e=_e.filter(k=>k.gizmoId!=null):_e=_e.filter(k=>k.gizmoId==null);const ss=zl(),pt=_e.length>0||ss,Lt=Ca(bc.hasUploadInProgress),Bt=p.useState(k=>{const me=Gl(k);return typeof oe?.maxTokens=="number"&&me>oe.maxTokens}),Ft=p.useState(k=>!k.isEmpty()),ft=!Bt&&!Lt&&(Ft||pt);Hn(_e.length>0||Lt||Ft);const et=(ut===ja.Multimodal?Wl:Vl)-_e.length,Ht=et<=0,Ye=ft&&!u&&!c&&!je,[tt,Gs]=i.useState(!1),xt=Io(),vt=n||xt.id,St=un(o,ln.Search),bt=!u&&!Me&&Q?.includes(Vt.SearchTool)&&!Q?.includes(Vt.SearchToolHoldout)&&(Q?.includes(Vt.BrowsingAvailable)||!j?.isEnterprisey()),Ut=bt&&St,Ws=Se[vt]?.tags,{targetedContent:Vs,setTargetedContent:st}=Un(),ke=Vs?.isFocusedViewContent&&!Be?void 0:Vs,{rebaseSystemMessageContent:ns}=On();i.useEffect(()=>{if(!B?.id)return;const k=Ma.getAndReset(B?.id,ce);k&&p.setText(k.inputText)},[B?.id,ce,p]),i.useEffect(()=>{tt!==Ye&&(Gs(Ye),Ye&&oi(!0).then(k=>{ql.startEnforcement(k),ri.startEnforcement(k)}))},[Ye,tt,$?.kind,Q]);const yt=$l(oe,$),{handleFileAccepted:na}=Yl(G,wa(oe,$),$e,"mouse",le,yt?.attachments),{getInputProps:qs,open:$s}=Kl({disabled:u||!Dt||Ht,noClick:!0,onDropAccepted:na,onDropRejected:k=>Xl(k,G,_,ut),multiple:!0,maxSize:Ql,maxFiles:et,...Zl(ht)}),as=ii(gt),os=i.useCallback(()=>{p.eraseContent(),as.clearMessages(),p.resize(qm),J.clearOverrideModelId(o),Jl();for(const k of _e)mn.remove(I,k.tempId,"none");ec.markAllAsSent()},[p,as,_e,I,o]),wt=async(k,me)=>{if(k?.preventDefault(),u||!ft&&!me||!$||Nt.isLoading(o)!==!1)return;const Ne=new $t;V(!0);const be=p.getContentToSend(),nt=yc(be.content),Qs=`${b}-nextPrompt`,Gt=new wc(Po.CompletionRequest,{expectedTimingLogs:[{name:"prompt_submitted",expectedInMs:3e3}]}),{content:$r,attachments:da}=jc(I,nt,oe,$),ua=[],Zs=[];ns&&Zs.push(di(ns));const Js={...$};"gizmo"in Js&&delete Js.gizmo;let us=p.getSystemHints();O&&(us=[Wn.Search]);const ma=Ce(),Yr=O?ma??Cn.CONVERSATION_COMPOSER_WEB_ICON:void 0,ha=Cc(),ga=Mc();let Wt={promptId:Qs,content:$r,eventMetadata:{eventSource:k?"mouse":"keyboard"},completionMetadata:{suggestions:g,conversationMode:Js,systemHints:us,searchSource:Yr},messageMetadata:{...da.length>0&&{attachments:da},...ee&&{gizmo_id:ee?.gizmo.id},...ve,...us.length>0&&{system_hints:us},...!!be.metadata&&{serialization_metadata:be.metadata},...ha.length>0&&{canvas:{user_created_textdocs:ha.map(ms=>({user_created_temp_textdoc_id:ms.tempTextdocId,type:ms.type,title:ms.title,content:ms.content}))}},...Object.keys(ga).length>0&&{__internal:{search_settings:ga}}},prependMessages:ua.length>0?ua:void 0,appendMessages:Zs.length>0?Zs:void 0,turnTracker:Ne,profiler:Gt,requestedModelId:Re};Wt=Tc(Wt),ke?.createNewCompletionParams&&(Wt=await ke.createNewCompletionParams(Wt)),Gt.logTiming("request_params_ready"),await s(Wt),ke?.onCreateCompletion?.({serverThreadId:ce,currentLeafId:b}),ke?.shouldPersistAcrossMessages!==!0&&st(void 0),As.hideThreadHeader(),os(),V(!1),Gt.logTiming("prompt_submitted"),g!==void 0&&(de.logEvent("chatgpt_prompt_ignore_suggestions"),K.logEvent(X.promptIgnoreSuggestions)),O&&ma&&Fe()},Ys=i.useRef(wt);i.useEffect(()=>{Ys.current=wt});const Ks=k=>{st(k.targetedReply),k.targetedReply&&(p.focus(),K.logEvent(X.targetedReplyButtonClicked,{conversationId:ce,sourceMessageId:k.messageId}))},rs=i.useCallback(()=>{ke?.onCleared?.({serverThreadId:ce,currentLeafId:b}),st(void 0),p.focus()},[b,ce,ke,st,p]),is={Enter:{validator:k=>{const me=k.isComposing||k.keyCode===229;return!(W&&ge.current)&&(k.metaKey||(he||ui)&&!k.shiftKey&&!me)},handler:k=>{if(!Ye){Bt&&_.danger("The message you submitted was too long, please submit something shorter.",{hasCloseButton:!0});return}k.preventDefault(),wt()}},Escape:{validator:k=>!k.isComposing,handler:k=>{d&&c&&(t("",F),K.logEvent(X.pauseCompletion,{threadId:J.getServerThreadId(o),currentLeafId:J.getTree(o).getMessageId(b),eventSource:"keyboard"})),k.target.value===""&&rs()}}},z=i.useRef(is);z.current=is;const ue=tc(Ws,$?.kind),[We,jt]=i.useState(!1),[Ot,aa]=i.useState(!1),ls=ue&&We&&!Ge,oa=p.isReady();i.useEffect(()=>p.subscribe("keydown",k=>{p.acceptLegacyKeydown()&&z.current[k.key]?.validator(k)&&z.current[k.key].handler(k);const Ne=p.getCurrentText();if(k.key==="@"){const be=p.getSelectionStart(),nt=Ne.substring(0,be);(!nt||/\s$/.test(nt)||be===0)&&setTimeout(()=>jt(!0),10)}else We&&jt(!1);if(k.key==="Escape"&&(dt(null),Z(!1)),Ut&&!O){let be;k.key==="Backspace"?be=Ne.substring(0,Ne.length-1):be=Ne+k.key,/^search\s?$/i.test(be)?aa(!0):Ot&&aa(!1)}O&&k.key==="Escape"&&Ee(!1,{clientThreadId:o})}),[p,oa,We,Ot,Ut,O,Ee,o]),i.useEffect(()=>{const k=Object.fromEntries(Object.keys(z.current).map(me=>[me,be=>{const nt=z.current[me];if(!nt||p.acceptLegacyKeydown())return!1;const{validator:Qs,handler:Gt}=nt;return Qs(be)?(Gt(be),!0):!1}]));p.registerKeyHandlers(k)},[p,oa]),i.useEffect(()=>p.subscribe("paste",k=>{sc({filePickerStore:I,event:k,intl:G,toaster:_,clientThreadId:o,conversationMode:$,currentModelConfig:oe,getEditorGizmoId:le,modelSupportedImageMimeTypes:$e})}),[G,o,$,oe,le,$e,p,_,I]);const jr=k=>{fe||dt(k),p.trimLeadingText("@"),_s(),jt(!1)},Cr=nc(o,gt,$e,yt?.attachments),Mr=i.useCallback(k=>{k?.preventDefault(),t("",F),K.logEvent(X.pauseCompletion,{threadId:J.getServerThreadId(o),currentLeafId:J.getTree(o).getMessageId(b),eventSource:"mouse"}),_s()},[t,o,F,b]),ra=i.useCallback(()=>{Ma.set(B?.id,ce,p.getCurrentText())},[ce,B?.id,p]);i.useEffect(()=>{q||!L&&!ac()&&p.focus()},[L,p]),i.useEffect(()=>{q||mn.reset(I)},[n,I,q]),i.useEffect(()=>{(!ue&&ee||fe)&&dt(null)},[ue,ee,fe]);const[Tr,_r]=(()=>{switch(m){case"workspaceDisallowsGizmo":return[He.disallowedByWorkspacePlaceholder,!0];case"feedbackRequired":return[He.disabledFeedbackPlaceholder,!0];case"noModelsAvailable":return[He.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[He.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[He.loading,!0];case"noTestGizmoId":return[He.noTestGizmoId,!0];default:return v?[He.placeholderWithName,!1]:ke?.placeholderTextOverride!=null?[ke.placeholderTextOverride,!1]:[He.placeholderWithName,!1]}})(),kr=Ge&&r?G.formatMessage(hn.newChatInProject):G.formatMessage(Tr,{name:q!=null?ie==="magic"?oc:q.name||"GPT":Me?.gizmo.display.name??"ChatGPT"});i.useEffect(()=>p.subscribe("input",()=>{zn.getState().isThreadHeaderVisible&&As.hideThreadHeader(),Z(!0)}),[p]),i.useEffect(()=>{if(w)return p.subscribe("input",()=>{w?.()})},[p,w]),i.useEffect(()=>{if(M)return p.subscribe("change",()=>{M?.()})},[p,M]),i.useEffect(()=>p.subscribe("focus",()=>{Z(!0)}),[p]);const ia=$?.kind===Je.PrimaryAssistant&&!O,Nr=li(Vt.CanvasOptIn),{layer:Ar}=Ve("4211831761"),{value:Er}=Cs("3131522605"),Rr=!Es()&&(Er||Ar.get("enable",!1)||Nr),Ir={clientThreadId:o,uploadType:ut,modelAcceptedMimeTypes:ht,modelSupportedImageMimeTypes:$e,attachmentsProductFeature:yt?.attachments,getInputProps:qs,openFileDialog:$s,historyDisabled:we,onOauthRedirect:ra,highlightTooltip:A&&!pt},cs=[],Pr=!u&&!Ht&&(Dt||zs!=null)&&!O;cs.push(e.jsx(Pm,{...Ir,isDisabled:!Pr},"file-upload-button")),Rr&&cs.push(e.jsx(Vm,{composerController:p,clientThreadId:o,isDisabled:!ia},"system-hint-button")),bt&&cs.push(e.jsx(_m,{composerController:p,highlightTooltip:Ot,clientThreadId:o,isDisabled:!Ut||pt},"search-button"));const Dr=pt&&e.jsxs(e.Fragment,{children:[ie==="magic"&&e.jsx("div",{className:"m-2 mb-0 rounded-lg bg-token-main-surface-secondary p-2 text-xs text-token-text-secondary",children:e.jsx(U,{...He.gizmoKnowledgeWarning})}),e.jsx(Ym,{files:_e,className:"flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),Lr=_r?"disabled":"default",Br=c&&d,Fr=ci(),Hr=!Ye||L||Fr,Ur=_c(Lt,Ft,Bt),ds=Br?"streaming":Hr?"disabled":"idle",zt=i.useRef(null),Ct=i.useRef(null),Or=n&&n.startsWith("o1");i.useEffect(()=>{const k=()=>{zt.current!=null&&cn.addAction("composer_state_disabled",{threadId:J.getServerThreadId(o),disabledReason:zt.current})};if(ft&&ds==="disabled"){let me="unknown";u?me=m??"component_disabled_unknown":c?me="completion_in_progress":je?me="thread_hard_blocked":L&&(me="starting_new_completion_request"),zt.current!==me&&(Ct.current&&clearTimeout(Ct.current),Ct.current=setTimeout(k,$m)),zt.current=me}else zt.current=null;return()=>{Ct.current&&(clearTimeout(Ct.current),Ct.current=null)}},[o,ft,ds,u,m,c,je,L]);const Xs=[];if(ke?.label&&Xs.push({type:ke.type,value:ke.label,onRemoveRegion:rs}),ee!==null){const k=!!ee.gizmo.tags?.includes(Gn.FirstParty);Xs.push({type:"mention",value:ee.gizmo.display.name,icon:e.jsx(rc,{isFirstParty:k,src:ee.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{dt(null),p.focus()}})}i.useEffect(()=>{(!f||f.length===0||!W)&&(ge.current=!1)},[f,W]);const zr=(k,me,Ne)=>{ge.current=k>=0,me&&p.setText(Ne?`${Ne.title}${Ne.body}`:"")},la=W&&f&&f.length>0&&!ls&&!p.hasMultipleLines()&&p.canShowAutocompletion();i.useEffect(()=>{ls?T?.():C?.()},[ls,T,C]);const ca=ds==="streaming"?Mr:wt,Gr=un(o,ln.Canvas),{value:Wr}=Cs("61299031"),Vr=Es(),qr=Gr&&Wr&&!ss&&!Vr;return e.jsxs(ic.Provider,{value:gt,children:[e.jsx(lc,{onOauthRedirect:ra,children:e.jsx("form",{className:l,onSubmit:ca,children:e.jsxs("div",{className:"relative flex h-full max-w-full flex-1 flex-col",children:[!N&&!ae&&e.jsx(or,{className:S}),ls&&e.jsx("div",{className:P("absolute bottom-full my-3",r&&"lg:top-full",ks.TagGpt),children:e.jsx(cc,{onClick:k=>jr(k),onClose:()=>{jt(!1),p.focus()}})}),ia&&e.jsx("div",{className:P("absolute bottom-full my-3",r&&"lg:top-full",ks.TagGpt),children:e.jsx(Rm,{composerController:p,clientThreadId:o})}),e.jsxs("div",{ref:x,className:"group relative flex w-full items-center",children:[r&&Y.has("from_template_row")&&e.jsx("button",{type:"button",onClick:()=>{te("/")},className:"mr-2 flex h-8 w-8 items-center justify-center text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(dc,{className:"icon-lg"})}),e.jsx(Fm,{type:we?"temporary":"default",ref:E,replyRegions:Xs,placeholder:kr,inputState:Lr,composerController:p,leftSideActions:cs,topRightAction:qr&&e.jsx(uc,{composerRef:R,composerController:p,clientThreadId:o}),state:ds,onSubmit:ca,renderFiles:Dr,currentLeafId:b,clientThreadId:o,gizmoId:Me?.gizmo.id,disableReason:Ur,modelId:vt}),la&&e.jsx("div",{className:"absolute left-0 z-10 box-border w-full bg-token-main-surface-primary pl-0 max-lg:bottom-full lg:top-full",children:e.jsx(Dm,{suggestions:f,composerController:p,onSelect:y,onChange:zr})})]}),e.jsx(mc,{composerController:p,parsedDocumentHandler:Cr})]})})}),e.jsx(Sm,{canUseInlineTagging:ue,isDisabled:u,clientThreadId:o,currentLeafId:b,currentRequestId:F,canContinue:h,composerController:p,setPromptInputMetadata:Ae,suggestions:g,isNewThread:r,onCreateNewCompletion:s,onContinueGenerating:a,onResetState:os,conversationMode:$,isShowingAutocomplete:!!la}),$!=null&&!Or&&hc.includes($.kind)&&e.jsx(gc,{clientThreadId:o,onTargetedReply:Ks})]})}function Xm(t){const s=t.message?.author.role===Ie.User,a=t.metadata?.err!=null&&t.metadata?.errCode!==Sa.ContentPolicy,n=t.metadata?.errCode===Sa.ModelIncompatibility;return t.metadata?.canRetry===!1||n?!1:s||a}function Qm(t){return e.jsx(Jo,{clientThreadId:t.clientThreadId,children:e.jsx(Zm,{...t})})}function Zm({clientThreadId:t,isNewThread:s,currentModelId:a,showPromptStarters:n,noWrap:o,onRequestCompletion:r,composerContainerRef:c}){const l=Os(),u=Tn(),m=_n(),d=Fs(g=>{const v=Nt.getCurrentNode(t,g);return Xm(v)});if(Do(l),!m&&d)return e.jsx(Jm,{clientThreadId:t});const h=e.jsx(e.Fragment,{children:e.jsx(lr,{composerContainerRef:c,clientThreadId:t,currentModelId:a,isNewThread:s,showPromptStarters:n,onRequestCompletion:r})});return o?h:e.jsxs(e.Fragment,{children:[e.jsx(Xu,{clientThreadId:t}),e.jsx(Vn,{clientThreadId:t,isStaticSharedThread:u,withVerticalPadding:!1,withHorizontalPadding:!0,children:e.jsx(Yt,{children:h})})]})}function Jm({clientThreadId:t}){const s=Ic(t),a=Fs(r=>Nt.getCurrentNode(t,r).metadata?.errCode===Pc),n=Dc(r=>r.isoDate),o=lt(t);return a&&n!=null&&n!==""?null:e.jsxs("div",{children:[e.jsx("div",{className:"mb-3 text-center text-xs",children:e.jsx(U,{...Ea.errorGeneratingResponse})}),e.jsx("div",{className:"flex items-center md:mb-4",children:e.jsx(It,{as:"button",color:"primary",onClick:()=>{const r=new $t;de.logEvent("chatgpt_regenerate_due_to_error_button_clicked",void 0,Qe({clientThreadId:t})),s({id:o,eventMetadata:{eventSource:"mouse"},conversationMode:Nt.getConversationMode(t),turnTracker:r})},className:"m-auto",icon:bo,"data-testid":"regenerate-thread-error-button",children:e.jsx(U,{...Ea.regenerateResponse})})})]})}function lr({clientThreadId:t,currentModelId:s,isNewThread:a,onRequestCompletion:n,showPromptStarters:o,composerContainerRef:r,autocompletions:c,requiresFileUpload:l,onComposerInput:u,onComposerChange:m,onAutocompleteSelect:d,headerClassName:h,hideHeader:g,onTaggingDropdownClose:v,onTaggingDropdownOpen:x}){const f=lt(t),A=Ps(t),w=gn(),{isUnauthenticated:M}=Pe(),S=ao(t)===oo.STREAMING,N=ro({clientThreadId:t,conversationLeafId:f}),D=rt(A),T=mi({clientThreadId:t}),C=!M,R=hi(),{isOpen:E,onClose:p}=kc({type:"just-hit-rate-limit"}),B=i.useCallback((L,V)=>{K.logEvent(X.continueCompletion),n({type:va.Continue,promptId:L,eventMetadata:{eventSource:"mouse"},cancelActiveRequests:!1,completionMetadata:{conversationMode:Nt.getConversationMode(t)},turnTracker:V})},[n,t]),j=fo(),H=i.useCallback(async(L,V)=>Nc({clientThreadId:t,currentRequestId:V,isHistoryAndTrainingDisabled:R,queryClient:j}),[t,R,j]),G=i.useCallback(async({promptId:L,content:V,eventMetadata:W,completionMetadata:Z,messageMetadata:ae,prependMessages:ge,appendMessages:Se,turnTracker:oe,profiler:Re,requestedModelId:$})=>{const Me=J.getThreadCurrentLeafId(t);J.updateTree(t,Ge=>{Ge.addNode(L,V,Me,Ie.User,void 0,ae)}),await n({type:va.Next,promptId:L,eventMetadata:W,cancelActiveRequests:!0,completionMetadata:Z,prependMessages:ge,appendMessages:Se,turnTracker:oe,profiler:Re,...$?{requestedModelId:$}:{}})},[t,n]),_=Ze(t,L=>L?.tree.getHasErrorFromNode(f)??!1),I=Ze(t,L=>L?.tree.isMessageIncomplete(f)??!1),b=!N&&(D||S),F=i.useMemo(()=>b?!1:!_&&I,[_,I,b]),Y=b,te=Jt(t),q=Te(t),ie=Pt(q).data,{promptStarters:le,isSuccess:Q}=pn(a&&!te,t,4),he=Mo(),we=(()=>{if(he?.messageId===J.getTree(t).getLastValidNode(f)?.message?.id)return he?.suggestions;if(o&&!te&&Q&&!C)return le})(),Be=Ac(),ce=gi(),fe=(()=>{if(ie?.gizmo.tags?.includes(Gn.WorkspaceDisabled)&&!ce)return"workspaceDisallowsGizmo";if(Be.size){if(w.displayingSideBySideFeedback&&w.unskippable)return"feedbackRequired"}else return"noModelsAvailable";const V=Nt.getConversationMode(t);return V?.kind===Je.GizmoTest&&V.gizmo_id==null?"noTestGizmoId":null})(),je=io(t),ve=Ls(t),Ae=Cs("15117983")?.value,Ee=Gi(),Fe=Bs(),Ce=Ee.action==="moderate",{value:O}=qe("1860647109");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center",children:Fe&&Ce&&O?e.jsx(Ec,{}):null}),E?e.jsx(Rc,{onClose:p}):null,Ae&&ve&&ve.kind===Je.PrimaryAssistant&&ve.plugin_ids&&ve.plugin_ids.length>0?e.jsx(eh,{}):e.jsx(Km,{composerContainerRef:r,clientThreadId:t,onCreateNewCompletion:G,onAbortCompletion:H,onContinueGenerating:B,currentModelId:s,isNewThread:a,isCompletionInProgress:T,className:"w-full",canContinue:F,suggestions:we??[],disabled:!!fe,disabledReason:fe??void 0,canPause:Y,isInteractableSharedThread:je,autocompletions:c,requiresFileUpload:l,onComposerInput:u,onComposerChange:m,onAutocompleteSelect:d,headerClassName:h,hideHeader:g,onTaggingDropdownClose:v,onTaggingDropdownOpen:x},t)]})}function eh(){return e.jsxs("div",{className:"mx-auto flex max-w-md flex-col items-center justify-center gap-2 rounded-xl border border-token-border-light bg-token-main-surface-primary p-6 shadow-lg",children:[e.jsx("span",{className:"text-token-text-primary",children:e.jsx(U,{id:"PluginsDecrepatedNotice.pluginsDeprecationTitle",defaultMessage:"Conversations with plugins are archived"})}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(U,{id:"PluginsDecrepatedNotice.pluginsDeprecationSubtitle",defaultMessage:"Explore GPT Store to find a replacement"})}),e.jsxs("a",{href:"https://chat.openai.com/gpts",className:"text-green-500 hover:cursor-pointer dark:text-green-400",children:[e.jsx(U,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLink",defaultMessage:"Explore GPTs"}),e.jsx("span",{className:"ml-2",children:e.jsx(U,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLinkArrow",defaultMessage:"→"})})]})]})}const Ea=De({errorGeneratingResponse:{id:"PromptTextarea.errorGeneratingResponse",defaultMessage:"There was an error generating a response"},regenerateResponse:{id:"PromptTextarea.regenerateResponse",defaultMessage:"Regenerate"}}),cr=i.memo(function(){return e.jsxs("div",{className:`mb-2 flex flex-col gap-2 empty:hidden ${ks.PromptTextareaHeader}`,children:[e.jsx(rr,{}),e.jsx(ir,{})]})}),fg=Object.freeze(Object.defineProperty({__proto__:null,ChatScreenComposerAlerts:cr},Symbol.toStringTag,{value:"Module"})),Ra=Oe(()=>ze(()=>import("./iv0pftgeuwfkjcsj.js"),__vite__mapDeps([7,1,4,2,3,5,8,9,10,11,12,13,14])).then(t=>t.SnorlaxSplashScreen)),tn=4;function th(t){const{layer:s}=Ve("3533083032"),{layer:a}=kt("3533083032"),{value:n,isLoading:o}=qe("3006519778");return o||!n?!1:t?s.get("enable_new_homepage_anon",!1):a.get("enable_new_homepage_anon",!1)}function sh(){const{layer:t}=kt("4031588851"),s=t.get("autocomplete_qualified_start_date","2099-09-13T00:00:00Z"),a=Bn();return!!a&&a.created*1e3>=new Date(s).getTime()}function nh(t){const{layer:s}=Ve("4031588851"),{layer:a}=kt("4031588851"),{value:n,isLoading:o}=qe("633009675");return o||!n?!1:t?s.get("enable_new_autocomplete_homepage",!1):a.get("enable_new_autocomplete_homepage",!1)}const sn=t=>`${t.title}${t.body}`.toLocaleLowerCase();function dr(t){const s=Te(t.clientThreadId),a=ts(s);return e.jsx(Jo,{clientThreadId:t.clientThreadId,children:a&&s&&Ra?e.jsx(Ra,{clientThreadId:t.clientThreadId,gizmoId:s,currentModelId:t.currentModelId,onRequestCompletion:t.onRequestCompletion}):e.jsx(lh,{...t})})}function ah({children:t}){const{store:s}=ye(),[a,n]=i.useState(!1),o=Os();i.useEffect(()=>o.subscribe("focus",()=>{n(!0)}),[o]),i.useEffect(()=>o.subscribe("blur",()=>{n(!1)}),[o]);const c=!!s.useSharedProps()?.isShowingAutocomplete;return t(c&&a)}function oh({isUnauthenticated:t,shouldShowLegacyStarterPrompts:s,legacyPromptStarters:a,isSendBlocked:n,clientThreadId:o}){return e.jsxs("div",{className:P(t?"justify-end lg:justify-center":"justify-center","flex h-full flex-shrink flex-col items-center overflow-y-hidden text-token-text-primary lg:hidden"),children:[e.jsx("div",{className:P(t&&"flex sm:items-center md:flex-1","flex-shrink-0"),children:e.jsx(Xt,{className:"mb-6 h-12 w-12"})}),s&&(a&&a.length>0?e.jsx(mh,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},promptStarters:a,isSendBlocked:n,clientThreadId:o,isSquare:t}):e.jsx(Fu,{}))]})}function rh({isSendBlocked:t,clientThreadId:s,headlineOption:a,enableNewMobileDesign:n,shouldShowStarterPrompts:o,promptChips:r,onSelectStarterPrompt:c,starterPromptExpanded:l,setStarterPromptExpanded:u}){const m=qn();return e.jsx(ah,{children:d=>e.jsxs(ne.div,{initial:{opacity:0},animate:{opacity:d?0:1},exit:{opacity:0},transition:{duration:.1},className:P("justify-center",d?"pointer-events-none":"","mt-[var(--screen-optical-compact-offset-amount)] flex h-full flex-shrink flex-col items-center overflow-hidden text-token-text-primary",m?"@lg/thread:hidden":"lg:hidden"),children:[a==="CHATGPT_LOGO"?e.jsx(Xt,{className:"inline-block h-12 w-12"}):e.jsx(ur,{headlineOption:a}),e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:P(!n&&(m?"@lg/thread:hidden":"lg:hidden"),!l&&"h-[116px]"),children:o&&e.jsx(mr,{starterPrompts:r,onSelectStarterPrompt:c,disabled:t,clientThreadId:s,onExpand:()=>u(!0),mobileLayout:!0})})]})})}function ih(t,s,a){const n=qe("1468311859").value,o=qe("3664702598").value,{layer:r}=Ve("4031588851"),c=sh(),l=t||s,u=l&&n,m=l&&o&&c;let d="HARDCODED";if(l)if(a){const h=r.get("search_autocomplete_mode","");u&&h&&(d=h)}else m&&(d=r.get("autocomplete_mode","HARDCODED"));return d}function lh({clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:n,v2HomepageDisclaimer:o}){const r=Os(),c=_t(t),l=Jt(t),u=Mn(),[m,d]=i.useState([]),{trendingSuggestions:h,fetchTrendingSuggestions:g}=hh(tn),v=i.useRef(!1),{isUnauthenticated:x}=Pe(),f=Lc(),[A,w]=i.useState(!1),M=In(),y=Le();Do(r);const S=qe("589604007").value,{layer:N}=kt("4031588851"),{layer:D}=Ve("4031588851"),{layer:T}=kt("3533083032"),{layer:C}=Ve("3533083032"),{promptStarters:R,isSuccess:E}=pn(c&&!l&&a,t,8,S,!0,s??void 0),{promptStarters:p,isSuccess:B,isError:j}=pn(c&&!l&&a,t,4,void 0,void 0,s??void 0),H=f&&!!m.find(O=>!!O.requires_file_upload),G=i.useCallback(O=>{const L=r.getCurrentText();return L&&sn(O).startsWith(L.toLocaleLowerCase())},[r]),_=i.useCallback(O=>{const L=r.getCurrentText(),V=O.title+O.body;return G(O)?{...O,title:L,body:V.slice(L.length)}:{...O,title:V,body:""}},[r,G]),I=i.useCallback((O=!1)=>{d(L=>!L.some(G)&&L.length>0?[]:O?L:L.map(_))},[G,_]),b=(O,L,V)=>{const W=O.title;d([]),r.focus(),r.setText(W),requestAnimationFrame(()=>{const Z=(R?.filter(ae=>ae.theme===O.theme)??[]).map(ae=>{const ge=Mt(ae.oneliner),Se=ge.startsWith(ae.title);return{...ae,title:Se?`${ae.title} `:"",body:Se?ae.body:ge,autocompletionChunks:Lm(W,ge),type:Ns.Autocomplete}});d(Z),Z.length>0&&Et(Z,t),Hc(O,V,t)})};i.useEffect(()=>{const O=m.some(L=>L.theme===fn.Search);M&&r.getCurrentText()===""?h.length>0?d(h):g():O&&!M&&d(L=>L.filter(V=>V.theme!==fn.Search))},[m,M,h,g,r]);const F=R?.reduce((O,L)=>(L.theme&&!O[L.theme]&&(O[L.theme]=L),O),{}),Y=[];if(F)for(const O in F)Y.push(F[O]);const te=Y&&Y.length>0,q=!!(E&&te&&a),ie=!!((B||j)&&a),le=tn-m.filter(G).length,Q=x?C.get("enable_new_mobile",!1):D.get("enable_new_mobile",!1),he=ih(Q,f,M),we=x?T.get("headline_option","HELP_WITH"):N.get("headline_option","HELP_WITH"),Be=N.get("autocomplete_min_char",4),ce=N.get("autocomplete_fetch_interval",200),fe=i.useRef(null),je=i.useCallback(Lo(async O=>{const L=r.getCurrentText();if(!L||L.length<Be||L.length>80||r.hasMultipleLines()){d([]);return}if(!v.current&&!(fe.current&&fe.current.length>Be&&L.startsWith(fe.current)))try{const V=await At.generateAutocompletions(L,O,M);if(V.completions.length===0){fe.current=L;return}const W=V.completions.map(Z=>({id:Wi(),type:Ns.Autocomplete,title:Z.slice(0,L.length),body:Z.slice(L.length),oneliner:Z,prompt:Z,source:he})).filter(G).map(_);d(Z=>{const ae=Z.filter(G),ge=W.filter(Se=>{const oe=sn(Se);return!ae.some(Re=>{const $=sn(Re);if(oe===$)return!0;const Me=/[\p{P}\p{S}]$/u,Ge=oe.replace(Me,""),ee=$.replace(Me,"");return Ge===$||oe===ee||Ge===ee})}).slice(0,tn-ae.length);return[...ae,...ge]}),W.length>0&&Et(W,t)}catch{}},he==="BING"?150:ce),[r,he,_,ce]),ve=i.useCallback(()=>{I(),le>0&&je(le)},[je,I,le]);i.useEffect(()=>{v.current&&d([])},[v]);const Ae=i.useMemo(()=>he==="HARDCODED"?I:ve,[he,ve,I]),Ee=i.useCallback(()=>{r instanceof Qn&&I(!0),r.getCurrentText().indexOf(`
`)>0&&d([])},[r,I]),Fe=i.useCallback((O,L,V)=>{L.forEach(W=>{W.id===O.id&&(W.userInput=r.getCurrentText())}),d([L[V]])},[r]),Ce=qn();return e.jsx(e.Fragment,{children:e.jsx(es,{children:e.jsx("div",{className:P("h-full w-full",Ce?"@lg/thread:py-[18px]":"lg:py-[18px]"),children:e.jsx(Vn,{isStaticSharedThread:!1,withVerticalPadding:!1,withHorizontalPadding:!0,clientThreadId:t,fullHeight:!0,children:e.jsxs(Ta,{children:[e.jsx("div",{className:P("mb-7 hidden text-center",Ce?"@lg/thread:block":"lg:block"),children:we==="CHATGPT_LOGO"?e.jsx(Xt,{className:"inline-block h-12 w-12"}):e.jsx(ur,{headlineOption:we})}),!Q&&e.jsx(oh,{isUnauthenticated:x,shouldShowLegacyStarterPrompts:ie,legacyPromptStarters:p,isSendBlocked:u,clientThreadId:t}),Q&&e.jsx(rh,{headlineOption:we,enableNewMobileDesign:Q,shouldShowStarterPrompts:q,promptChips:Y,onSelectStarterPrompt:b,starterPromptExpanded:A,setStarterPromptExpanded:w,isSendBlocked:u,clientThreadId:t}),e.jsx("div",{className:P(Ce?"@lg/thread:absolute @lg/thread:bottom-8 @lg/thread:left-0 @lg/thread:w-full":"lg:absolute lg:bottom-8 lg:left-0 lg:w-full"),children:e.jsx(Ta,{children:y?e.jsx(cr,{}):e.jsx(or,{className:"block"})})}),e.jsx("div",{className:"w-full",children:e.jsx(lr,{clientThreadId:t,isNewThread:c,currentModelId:s,onRequestCompletion:n,showPromptStarters:!1,autocompletions:m,requiresFileUpload:H,onComposerInput:Ae,onComposerChange:Ee,onAutocompleteSelect:Fe,onTaggingDropdownClose:()=>{v.current=!1},onTaggingDropdownOpen:()=>{v.current=!0},hideHeader:!0})}),e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:P("hidden",Ce?"@lg/thread:block":"lg:block",o&&x&&A?"":"h-[70px]"),children:q&&e.jsx(mr,{starterPrompts:Y,onSelectStarterPrompt:b,disabled:u,clientThreadId:t,onExpand:()=>w(!0)})}),o&&e.jsx("div",{className:P("w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",Ce?"@lg/thread:absolute @lg/thread:bottom-0 @lg/thread:left-0":"lg:absolute lg:bottom-0 lg:left-0"),children:e.jsx("div",{className:"min-h-4",children:o})})]})})})})})}function ur({headlineOption:t}){const a=xe().formatMessage(gh[t]||qt.whatCanIHelpWith);return e.jsx("div",{className:"relative inline-flex justify-center text-center text-2xl font-semibold leading-9",children:e.jsx("h1",{children:a})})}function ch({starterPrompt:t,starterPrompts:s,index:a,disabled:n,onSelectStarterPrompt:o}){const r=t.theme??t.title,c=Hs(),{mutate:l}=Uc(),u=t.category==="onboarding"?()=>{l({key:it.hasUsedConversationalOnboardingStarterPrompt}),c(t,s,a)}:()=>o(t,s,a);return e.jsx(Bo,{disabled:n,onClick:u,icon:e.jsx(Oc,{starterPrompt:t,useV2Colors:!0}),label:r})}function Ia({clientThreadId:t,onClick:s}){i.useEffect(()=>{zc(t)},[t]);const a=xe();return e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(Bo,{onClick:()=>{Gc(t),s()},label:a.formatMessage(qt.moreStarterPrompts)})})}const dh=5,uh=3;function mr({starterPrompts:t,onSelectStarterPrompt:s,disabled:a,clientThreadId:n,onExpand:o,mobileLayout:r=!1}){const c=r?uh:dh,[l,u]=i.useState(c),[m,d]=i.useState(!1),h=i.useRef(null),g=t.length<=l;i.useEffect(()=>{Et(t.slice(0,c),n)},[n]),i.useEffect(()=>{if(!m&&!g&&h.current){const x=h.current,f=x.getBoundingClientRect(),A=f.width,w=Array.from(x.children);let M=0;for(let y=0;y<w.length&&w[y].getBoundingClientRect().right-f.left<=A;y++)M++;u(M),d(!0)}},[t,g,m]);const v=()=>{const x=t.slice(l,t.length).map(f=>({...f,isAdditional:!0}));x.length>0&&Et(x,n),u(t.length),o()};return e.jsxs("div",{className:P("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",m&&t.length>0?"opacity-100":"opacity-[0.01]",r?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:P("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",g||r?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:h,children:[t.slice(0,l).map((x,f)=>e.jsx(ne.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:e.jsx(ch,{starterPrompt:x,starterPrompts:t,index:f,disabled:a,onSelectStarterPrompt:s})},x.id??f)),r&&t.length>l&&e.jsx(Ia,{clientThreadId:n,onClick:v})]}),!r&&t.length>l&&e.jsx(Ia,{clientThreadId:n,onClick:v})]})}function mh({promptStarters:t,isSendBlocked:s,clientThreadId:a,isSquare:n,...o}){i.useEffect(()=>{Et(t,a)},[a]);const r=Hs(),c=qn();return e.jsx(e.Fragment,{children:n?e.jsx(ne.div,{...o,className:"mb-2 w-full flex-shrink overflow-y-hidden",children:e.jsx(Yt,{children:e.jsx(Zo,{starterPrompts:t,onSelectStarterPrompt:r,disabled:s})})}):e.jsx(ne.div,{...o,className:"flex-shrink overflow-y-hidden",children:e.jsx(Hu,{starterPrompts:t,onSelectStarterPrompt:r,disabled:s,cssMobileDisplayLimit:2,marginOverride:P("mt-6",c?"@lg/thread:mt-12":"lg:mt-12")})})})}const hh=t=>{const[s,a]=i.useState([]),n=i.useCallback(async()=>{const r=(await At.generateTrendingSuggestions(t)).suggestions.map((c,l)=>({type:Ns.Starter,title:Pa(c),body:"",icon:e.jsx(Bc,{}),prompt:Pa(c),id:`starter-${l}`,theme:fn.Search}));a(r)},[t]);return{trendingSuggestions:s,fetchTrendingSuggestions:n}};function Pa(t){return t.split(" ").map(Fc).join(" ")}const qt=De({whatCanIHelpWith:{id:"SplashScreenV2.whatCanIHelpWith",defaultMessage:"What can I help with?"},whereShouldWeStart:{id:"SplashScreenV2.whereShouldWeStart",defaultMessage:"Where should we start?"},askChatgptAnything:{id:"SplashScreenV2.askChatgptAnything",defaultMessage:"Ask ChatGPT anything"},moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),gh={HELP_WITH:qt.whatCanIHelpWith,WHERE_TO_START:qt.whereShouldWeStart,ASK_CHATGPT:qt.askChatgptAnything};function hr({clientThreadId:t,currentLeafId:s}){const{currentModelId:a}=er(),n=Fn(t),o=lo(t,s),r=Te(t),c=ct(),l=Us(a),u=_t(t)&&!o&&(js(n)||n?.kind===Je.GizmoTest),m=ts(r);return{showEmptyState:u,canUseNewHomepage:u&&m||u&&!r&&!l&&!c}}const Da=pe.button`max-w-28 xs:max-w-40 sm:max-w-60 md:max-w-none group flex cursor-pointer items-center gap-1 rounded-lg py-1.5 ${({$shimmer:t})=>t?"loading-shimmer":""} ${({$isScreenArch:t})=>t?"text-md px-1":"px-1 text-lg"} hover:bg-token-main-surface-secondary radix-state-open:bg-token-main-surface-secondary font-semibold text-token-text-secondary overflow-hidden whitespace-nowrap`;function ph({conversation:t,gizmoResource:s,elementRef:a}){const n=Si(t.id)??t.title;return e.jsx(Ts,{to:$c(t.id,s),children:e.jsx(re.Item,{icon:Yc,children:e.jsx("div",{ref:a,children:n})},t.id)})}function fh({gizmoId:t,clientThreadId:s,inMobileHeader:a}){const n=xe(),{data:o}=Pt(t),{items:r,hasNextPage:c,fetchNextPage:l,isLoading:u,isFetchingNextPage:m}=Wc(t),d=i.useRef(null),h=i.useCallback(R=>{u||R==null||(d.current?.disconnect(),d.current=new IntersectionObserver(E=>{E[0].isIntersecting&&c&&l()}),d.current.observe(R))},[u,c,l]);i.useEffect(()=>()=>{d.current?.disconnect()},[]);const{title:g,titleSource:v}=pi(s),x=Le(),{conversationLeafId:f}=er(),{showEmptyState:A}=hr({clientThreadId:s,currentLeafId:f}),w=Jt(s),M=Vc(),y=n.formatMessage(hn.newChatTitle),{resolvedTitle:S,isTypingEffect:N}=qc(s,g??null,!0);if(!o||A)return null;const D=S==null&&(_t(s)||v===fi.NewChat),T=w?e.jsx(e.Fragment,{}):e.jsxs(Da,{$isScreenArch:x,$shimmer:D,children:[e.jsx("div",{className:"truncate",children:N?e.jsx(Kc,{text:S??""}):S??y}),e.jsx($n,{className:"icon-md text-token-text-tertiary"})]}),C=M&&o.gizmo.display.emoji?e.jsxs(e.Fragment,{children:[o.gizmo.display.emoji," ",o.gizmo.display.name]}):o.gizmo.display.name;return e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden whitespace-nowrap px-2 py-1.5",children:[e.jsx(Da,{$isScreenArch:x,children:e.jsx(Ts,{className:"truncate",to:_a(o),children:C})}),e.jsxs(e.Fragment,{children:[e.jsx(xi,{className:"icon-md text-token-text-tertiary"}),e.jsxs(co,{contentAlign:a?"center":"start",size:"small",triggerButton:T,contentClassName:"max-h-[50dvh] overflow-y-scroll",children:[e.jsx(Ts,{to:_a(o),children:e.jsx(re.Item,{icon:Fo,children:e.jsx(U,{...hn.newChatProjectDropdownItem,values:{name:`"${o.gizmo.display.name}"`}})},"new-chat")}),r.filter(R=>R.id!==s).map((R,E)=>{const p=c&&E===r.length-4?h:void 0;return e.jsx(ph,{elementRef:p,conversation:R,gizmoResource:o},R.id)}),m&&e.jsx("div",{className:"m-4 mb-5 flex justify-center",children:e.jsx(vi,{})})]})]})]})}const xh=Oe(()=>ze(()=>import("./lmzbjyvjhw1bfge5.js"),__vite__mapDeps([15,2,1,3,4,5,16])).then(t=>t.ThreadHeaderGizmoDropdown)),La=pe.button`group flex cursor-pointer items-center gap-1 rounded-lg py-1.5 ${({$isScreenArch:t})=>t?"h-[44px] @lg/screen-composer:pl-3 [line-height:26px] [font-size:17px] pl-1 pr-3":"px-3 text-lg"} hover:bg-token-main-surface-secondary radix-state-open:bg-token-main-surface-secondary font-semibold text-token-text-secondary overflow-hidden whitespace-nowrap`;function vh({clientThreadId:t}){const s=xe(),a=ct(),n=yi(t),o=En(),[,r]=po(),c=()=>{!n&&!a?o({pathname:"/",search:new URLSearchParams({[ps]:"true"}).toString()}):r(l=>(l.get(ps)==="true"?l.delete(ps):l.set(ps,"true"),l),{replace:n,state:ld()})};return e.jsx(re.Item,{size:"large",className:"!pr-3",onClick:c,icon:od,children:e.jsxs("div",{className:"flex grow items-center justify-between gap-2",children:[e.jsx("div",{className:"flex flex-1 items-center gap-3",children:e.jsx(U,{...xr.temporaryChat})}),e.jsx(rd,{enabled:a,label:s.formatMessage({defaultMessage:"Temporary",id:"temporaryChatToggleLabel"}),testId:"temporary-chat-toggle"})]})})}function gr(t,s,a){let n=t;if(t===ba.AUTO){const c=s.filter(({defaultModel:l})=>l!==ba.AUTO);c.length===1&&(n=c[0].defaultModel)}const o=s.find(({defaultModel:c})=>c===n);if(o){const{categoryId:c,shortLabel:l}=o;return{selectedCategory:c,modelLabel:l}}const r=a.find(({modelIds:c})=>c.includes(n));if(r){const{group:c,shortLabel:l}=r;return{selectedCategory:c,modelLabel:l}}return{selectedCategory:null,modelLabel:null}}function Sh({modelLabel:t}){return e.jsx("span",{className:"overflow-x-clip text-ellipsis text-token-text-secondary",children:t})}function bh({clientThreadId:t,inMobileHeader:s}){const{isLoading:a,categories:n,groups:o}=Yn(),r=bi(),l=Kn(t).id,u=Xc(),{modelLabel:m}=gr(l,n,o),d=wh(t,u),h=xe(),{isUnauthenticated:g}=Pe(),v=pr(),x=(!g||!v)&&!r;i.useEffect(()=>{a||Qc({namespace:Po.ChatPageLoad})?.logTiming("render_model_switcher")},[a]);const f=Le(),A=e.jsxs("div",{className:P(f?"overflow-x-hidden text-ellipsis":"text-token-text-secondary"),children:[Zc," ",x?e.jsx("span",{className:"text-token-text-secondary",children:m}):g&&m?e.jsx(Sh,{modelLabel:m}):null]});return d.length?a?null:e.jsx(co,{sideOffset:8,size:"large",triggerButton:e.jsxs(La,{$isScreenArch:f,"aria-label":m?h.formatMessage({id:"JrtGPQ",defaultMessage:"Model selector, current model is {modelLabel}"},{modelLabel:m}):"",children:[A,f?e.jsx(Jc,{className:"icon-md text-token-text-tertiary"}):e.jsx($n,{className:"icon-md text-token-text-tertiary"})]}),onOpenChange:w=>{K.logEvent(X.toggleModelSwitcher,{isOpen:w}),de.logEvent("toggle_model_switcher",null,{isOpen:String(w)})},contentAlign:s?"center":"start",testId:"model-switcher-dropdown",children:e.jsx(Ch,{sections:d})}):e.jsx(La,{className:"cursor-default",children:A})}function pr(){return qe("462735957").value}function yh({category:t,modelSwitcherDenialsBySlug:s,currentGizmoId:a,currentModelId:n,omitIcon:o,testId:r}){const{defaultModel:c,label:l,categoryId:u,description:m,isBeta:d}=t;return e.jsx(xn,{value:c,currentModelId:n,modelSwitcherDenialsBySlug:s,renderName:h=>e.jsx(wn,{categoryId:u,name:l,description:m,isDisabled:h,omitIcon:o,isBeta:d}),isSelected:!a&&n===c,testId:r},c)}function wh(t,s){const a=Kn(t),n=a.id,o=Te(t),{categories:r,groups:c}=Yn(),{doesUserHaveAnyAccountsWithPlusFeatures:l}=kn(),u=J.getServerThreadId(t),m=ed({clientThreadId:t}),d=xe(),h=!u,{isUnauthenticated:g}=Pe(),v=td(),{layer:x}=Ve("2723963139"),f=x.get("is_dynamic_model_enabled",!1),A=pr(),w=s.find(({categoryId:I})=>I===Ke.ALPHA),M=s.find(({categoryId:I})=>I===Ke.DATA_CAMPAIGNS),y=s.find(({categoryId:I})=>I===Ke.EXPERIMENTS),S=s.find(({categoryId:I})=>I===Ke.MAINLINE),N=!0,D=!!w?.options?.length,T=!!M?.options?.length,C=!!y?.options?.length,R=!!S?.options?.length,E=En(),p=i.useCallback(()=>{K.logEvent(X.openModalAccountPaymentfromModelPicker,{content:"gizmo-button"}),sd(E,"Thread header dropdown")},[E]),B=()=>{de.logEvent("chatgpt_model_switcher_plus_upgrade_button_clicked"),K.logEvent(X.modelSwitcherPlusUpgradeButtonClicked),g?v({shouldOpenPaymentModalOnAuth:!0,callback:I=>{K.logSignUpButtonClicked({location:"Model switcher GPT-4 upsell",provider:I})}}):p()},j=[],H=e.jsxs("div",{className:"mb-1 flex items-center justify-between px-5 pt-2",children:[e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(U,{id:"ilkdMh",defaultMessage:"Model"})}),e.jsx("a",{href:f?"https://help.openai.com/en/articles/9155758-what-is-the-chatgpt-plus-model-selector":"https://help.openai.com/en/articles/7102672-how-can-i-access-gpt-4",target:"_blank",rel:"noreferrer",children:e.jsx(cd,{className:"icon-md h-5 w-5 pl-0.5 text-token-text-tertiary"})})]},"header");if(A&&g){const I={id:"modelSection",content:[]};I.content.push(e.jsx(nd,{},"noAuthUpsell")),j.push(I)}else if(l){const I={id:"modelSection",content:[]};r.length&&I.content.push(H);const b=new Map;r.forEach(F=>{const Y=e.jsx(yh,{category:F,currentGizmoId:o,currentModelId:n,modelSwitcherDenialsBySlug:m,omitIcon:N,testId:`model-switcher-${F.defaultModel}`},F.categoryId);F.subcategory?(b.has(F.subcategory)||b.set(F.subcategory,[]),b.get(F.subcategory)?.push(Y)):I.content.push(Y)}),b.forEach((F,Y)=>{const te=r.find(q=>q.subcategory===Y&&q.defaultModel===a.id);I.content.push(e.jsxs(re.Sub,{children:[e.jsx(re.SubMenuTrigger,{"data-testid":Y==="More models"?"more-models-submenu":void 0,children:e.jsxs("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:[Y,!!te&&e.jsx("div",{className:"truncate text-token-text-tertiary",children:te.label})]})}),e.jsx(re.Portal,{children:e.jsx(re.SubContent,{className:"min-w-72",children:F})})]},Y))}),j.push(I)}else{const I={id:"modelSection",content:[]};I.content.push(e.jsx(xn,{value:"",currentModelId:n,onClick:B,modelSwitcherDenialsBySlug:m,isUpgradeUpsell:!0,renderName:b=>e.jsx(wn,{icon:id,isDisabled:b,name:d.formatMessage({id:"mzDzkX",defaultMessage:"ChatGPT Plus"}),description:d.formatMessage({id:"bqTHri",defaultMessage:"Our smartest model & more"}),omitIcon:!1}),isSelected:!1,showNewChatHint:!1},"plusUpgrade")),I.content.push(e.jsx(xn,{value:en.AUTO,currentModelId:n,modelSwitcherDenialsBySlug:m,renderName:b=>e.jsx(wn,{icon:ad,name:d.formatMessage({id:"U9E7Rx",defaultMessage:"ChatGPT"}),description:d.formatMessage({id:"n96qML",defaultMessage:"Great for everyday tasks"}),isDisabled:b,omitIcon:!1}),isSelected:!o&&n===en.AUTO,showNewChatHint:!0},en.AUTO)),j.push(I)}const G={id:"otherOptionsSection",content:[]},{selectedCategory:_}=gr(n,r,c);return h&&(D&&G.content.push(e.jsx(gs,{isSelected:_===Ke.ALPHA,currentModel:a,option:w,modelSwitcherDenialsBySlug:m,displayInFull_INTERNAL_USE_ONLY:!0},w.value)),T&&G.content.push(e.jsx(gs,{isSelected:_===Ke.DATA_CAMPAIGNS,currentModel:a,option:M,modelSwitcherDenialsBySlug:m,displayInFull_INTERNAL_USE_ONLY:!0},M.value)),C&&G.content.push(e.jsx(gs,{currentModel:a,isSelected:_===Ke.EXPERIMENTS,option:y,modelSwitcherDenialsBySlug:m,displayInFull_INTERNAL_USE_ONLY:!0},y.value)),R&&G.content.push(e.jsx(gs,{isSelected:_===Ke.MAINLINE,currentModel:a,option:S,modelSwitcherDenialsBySlug:m,displayInFull_INTERNAL_USE_ONLY:!0},S.value))),G.content.length&&j.push(G),g||j.push({id:"temporaryChatSection",content:[e.jsx(vh,{clientThreadId:t},"tempChat")]}),j}function jh(){const t=xe();return e.jsx("div",{className:"border-token-text-quartenary items-center rounded-full border px-1 py-0.5 text-[8px] font-semibold uppercase leading-3 text-token-text-secondary dark:border-token-border-heavy dark:text-token-text-tertiary",children:t.formatMessage(xr.beta)})}function wn({isDisabled:t,name:s,icon:a,categoryId:n,description:o,extra:r,omitIcon:c,isBeta:l=!1}){let u=s;return l&&(u=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),e.jsx(jh,{})]})),e.jsxs("div",{className:"flex items-center gap-3",children:[!c&&e.jsx("span",{className:"flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-full bg-token-main-surface-secondary",children:a?e.jsx(a,{className:"h-4 w-4 text-token-text-primary"}):n&&e.jsx(Ho,{type:"filled",className:P("h-4 w-4",t&&"text-gray-300",!t&&"text-token-text-primary"),categoryId:n})}),e.jsxs("div",{children:[u,e.jsxs("div",{className:P(!t&&"text-token-text-secondary","text-xs"),children:[o,r]})]})]})}function Ch({sections:t}){return e.jsx(e.Fragment,{children:t.map((s,a)=>e.jsxs(xo.Fragment,{children:[a!==0?e.jsx(re.Separator,{}):null,s.content]},s.id))})}function fr({clientThreadId:t,inMobileHeader:s=!1}){const a=Te(t),n=ts(a);return a==null?e.jsx(bh,{clientThreadId:t,inMobileHeader:s}):n?e.jsx(fh,{gizmoId:a,clientThreadId:t,inMobileHeader:s}):e.jsx(xh,{clientThreadId:t,gizmoId:a,inMobileHeader:s})}const xr=De({beta:{id:"XZwFET",defaultMessage:"Beta"},gpt35ShortExplainer:{defaultMessage:"Great for everyday tasks",id:"ModelSwitcher.gpt35ShortExplainer"},modelTunerSmartSelectionTitle:{id:"czjW8I",defaultMessage:"Dynamic"},modelTunerSmartSelectionExplainer:{id:"gp/YH1",defaultMessage:"Optimized for speed and intelligence"},gpt4ShortExplainer:{defaultMessage:"With DALL·E, browsing and analysis",id:"ModelSwitcher.gpt4ShortExplainer"},gpt4ShortExplainerWithoutBrowse:{defaultMessage:"With DALL·E and analysis",id:"ModelSwitcher.gpt4ShortExplainerWithoutBrowse"},gpt4UpsellExplainer:{id:"ModelSwitcher.gpt4Upsell",defaultMessage:"Our smartest and most capable model. Includes DALL·E, browsing and more."},userUpgrade:{id:"ModelSwithcer.upgradeButton",defaultMessage:"Upgrade to Plus"},userUpgradeSignup:{id:"ModelSwitcher.signupUpgradeButton",defaultMessage:"Sign up for ChatGPT Plus"},temporaryChat:{id:"ModelSwitcher.temporaryChat",defaultMessage:"Temporary chat"},shareChat:{id:"ModelSwitcher.shareChat",defaultMessage:"Share chat"}}),Mh=Oe(()=>ze(()=>import("./nrec8jffighc2o42.js"),__vite__mapDeps([17,1,2,3,18,19,4,5,20,21,22,23,24,25,26,14,27,28,29,30,13,16,31,32,33,34])).then(t=>t.GizmoUsingAsOwnerNotice)),vr=({clientThreadId:t})=>{const s=zn(m=>m.activeStageSidebar),a=J.getServerThreadId(t),n=dd(Vt.WorkspaceShareLinks),{isUnauthenticated:o}=Pe(),r=ct(),c=n&&a&&!o&&!r,l=Le(),u=!s&&!(l&&!o);return e.jsx("div",{className:P(!l&&"gap-2",l&&"@lg/screen-composer:gap-2","flex items-center pr-1 leading-[0]"),children:e.jsx(Ku,{showShareButton:c,showProfileDropdown:u,clientThreadId:t})})};function Th({clientThreadId:t,gizmoId:s}){const a=ud(),{data:n}=Pt(s),o=Ds();return e.jsxs(e.Fragment,{children:[e.jsxs(md,{className:"max-md:hidden",children:[e.jsxs("div",{className:"absolute start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2",children:[n!=null&&o?.isWorkspaceAccount()&&n.gizmo.tags?.includes(Gn.WorkspaceDisabled)&&e.jsx(Mh,{gizmo:n}),e.jsx(hd,{gizmoId:s,clientThreadId:t})]}),e.jsx(gd,{children:e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden",children:[e.jsx(tr,{clientThreadId:t}),e.jsx(fr,{clientThreadId:t})]})}),e.jsx(vr,{clientThreadId:t})]}),a&&e.jsx(pd,{})]})}function Sr({clientThreadId:t}){const s=Te(t),a=Tn(),n=Le();return a||n?null:e.jsx(Th,{gizmoId:s,clientThreadId:t})}function _h({clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:n,enableV2Homepage:o,v2HomepageDisclaimer:r}){const c=ct();let l=e.jsx(Ou,{}),u;return c?(u=e.jsx(kh,{}),l=e.jsx(Xt,{className:"mb-6 h-12 w-12"})):t!=null?(u=o?e.jsx(dr,{clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:n,v2HomepageDisclaimer:r}):e.jsx(zu,{clientThreadId:t}),l=null):u=e.jsx(Nh,{}),e.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-token-text-primary",children:[l,u]})}function kh({gizmo:t}){const s=xd(),a=t?vd(t.tools):!1,n=Ds();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-5 text-2xl font-semibold","data-testid":"temporary-chat-label",children:[e.jsx(Sd,{id:"temporary-chat-checkbox",name:"temporary-chat-checkbox",checked:!0}),e.jsx(U,{...ot.temporaryChat})]}),e.jsxs("div",{className:"max-w-sm text-center text-sm font-normal text-token-text-tertiary",children:[e.jsx(U,{...n?.isWorkspaceAccount()?s?ot.temporaryChatBizMemoryAvailable:ot.temporaryChatBizMemoryUnavailable:s?ot.temporaryChatDescriptionMemoryAvailable:ot.temporaryChatDescriptionMemoryUnavailable}),a&&e.jsx("div",{className:"mt-3",children:e.jsx(U,{...ot.temporaryChatDescriptionGptActions,values:{link:o=>e.jsx("a",{href:"https://help.openai.com/en/articles/8914046-temporary-chat-faq",target:"_blank",className:"underline",rel:"noreferrer",children:o})}})})]})]})}function Nh(){return e.jsx("div",{className:"mb-5 text-2xl font-semibold",children:e.jsx(U,{...ot.howCanIHelpYouToday})})}function br({clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:n,enableV2Homepage:o,v2HomepageDisclaimer:r}){const c=Te(t),l=wi(),u=Mn(),{data:m}=Pt(c),d=fd(),h=ji(()=>navigator.windowControlsOverlay);return(l!=null||c!=null)&&m==null?null:e.jsxs("div",{className:"relative h-full",children:[e.jsx("div",{className:h?.visible?P("absolute right-[calc(100dvw-env(titlebar-area-width,100dvw)-env(titlebar-area-x,0))]",d?"left-[env(titlebar-area-x,0)]":"left-0"):"absolute left-0 right-0",children:e.jsx(Sr,{clientThreadId:t})}),m!=null?e.jsx(Uu,{gizmo:m,showStarterPrompts:!0,disableStarterPrompts:u}):e.jsx(_h,{clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:n,enableV2Homepage:o,v2HomepageDisclaimer:r})]})}const ot=De({temporaryChat:{id:"GizmoLanding.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatBizMemoryAvailable:{id:"g1opBW",defaultMessage:"This chat won't appear in your history and won't use or create memories."},temporaryChatBizMemoryUnavailable:{id:"fQmbtG",defaultMessage:"This chat won't appear your conversation history."},temporaryChatDescriptionMemoryAvailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryAvailable",defaultMessage:"This chat won't appear in history, use or create memories, or be used to train our models. For safety purposes, we may keep a copy for up to 30 days."},temporaryChatDescriptionMemoryUnavailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryUnavailable",defaultMessage:"This chat won't appear in history or be used to train our models. For safety purposes, we may keep a copy of this chat for up to 30 days."},temporaryChatDescriptionGptActions:{id:"GizmoLanding.temporaryChatDescriptionGptActions",defaultMessage:"Any data shared with a third party through GPT actions are subject to the third party's privacy policy. <link>Learn more</link>"},howCanIHelpYouToday:{id:"GizmoLanding.howCanIHelpYouToday",defaultMessage:"How can I help you today?"}});function Ah({className:t,clientThreadId:s,message:a,onModelSelect:n,onDropdownChange:o}){const r=xe(),[c,l]=i.useState(null),[u,m]=i.useState(!1),[d,h]=i.useState(!1),g=bd(),v=Uo(s),x=Te(s),f=Oo({clientThreadId:s,message:a}),A=a.message.metadata?.model_slug,{modelOptions:w,modelSlug:M,animateModelLabelOnRender:y,nuxProps:S,messageModelEnabledTools:N}=f,D=zo(a.message),T=N.includes(Wn.Search),C=i.useMemo(()=>w.find(_=>_.value==A),[w,A]),{doesUserHaveAnyAccountsWithPlusFeatures:R}=kn(),E=i.useRef(null),p=_=>{_||setTimeout(()=>{E.current&&E.current.blur()},10)};if(i.useEffect(()=>{p(u)},[u]),!g||x)return null;const B=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:r.formatMessage(Ba.search),icon:e.jsx(Pn,{className:"icon-sm"}),condition:T&&!D,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:r.formatMessage(Ba.nosearch),icon:e.jsx(Go,{className:"icon-sm"}),condition:T&&D,eventName:"chatgpt_regenerate_without_search_button_clicked"}];let j,H;S.shouldRenderNux?(j=Rh,H={title:e.jsx(U,{id:"g/+2Hh",defaultMessage:"Optimized your response"}),description:e.jsx(U,{id:"H0Flqm",defaultMessage:"Used {usedModelName} for a faster response that saves your limited {largestModelName} messages",values:{usedModelName:S.usedModelName,largestModelName:S.largestModelName}}),markAsViewed:S.announcement.markAsViewed}):(j=Eh,H={label:v?e.jsx(U,{id:"LBYK9a",defaultMessage:"Change model"}):e.jsx(U,{id:"nygjPN",defaultMessage:"Used {modelName}",values:{modelName:S.usedModelName}})});const G=v&&w.some(_=>Kt(_,R));return e.jsxs(re.Root,{onOpenChange:_=>{v&&(m(_),o(_),p(_)),_&&K.logEvent(X.conversationOpenMessageModelSelector,{has_get_plus_button:G})},children:[e.jsx(j,{...H,children:e.jsx(uo,{ref:E,className:P("cursor-pointer",t),onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),children:e.jsx(yr,{modelSlug:M,animateModelLabelOnRender:y,isDropdownOpen:u,isRegenerateEnabled:v,isHovered:d})})}),v&&e.jsxs(re.Content,{className:"z-30 origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[w.map(_=>{const I=Kt(_,R),{value:b,...F}=_;return e.jsx(Tt,{value:b,onSelect:()=>{de.logEvent("chatgpt_regenerate_switch_model_button_clicked",b,{requestedModelId:b,...Qe({clientThreadId:s})}),n({requestedModelId:b})},onMouseEnter:()=>l(b),onMouseLeave:()=>l(null),isHovered:c===b,messageModelSlug:a.message.metadata?.model_slug,shouldShowUpsell:I,...F},b)}),!!C&&e.jsxs(e.Fragment,{children:[e.jsx(re.Separator,{}),B.filter(_=>_.condition).map(_=>e.jsx(Tt,{onSelect:()=>{de.logEvent(_.eventName,C.value,{requestedModelId:C.value,...Qe({clientThreadId:s})}),n({requestedModelId:C.value,extraStreamParams:_.extraStreamParams})},includeRegenerate:!0,onMouseEnter:()=>l(_.key),onMouseLeave:()=>l(null),isHovered:c===_.key,messageModelSlug:A,includeCheck:!1,...C,label:_.label,subtitle:"",icon:_.icon},_.key))]})]})]})}function yr({modelSlug:t,animateModelLabelOnRender:s,isDropdownOpen:a,isRegenerateEnabled:n,isHovered:o,isRegenLabel:r=!1,animateShortLabel:c,omitIcon:l}){const[u,m]=i.useState("initial"),{categories:d}=Yn({isRegen:!!r});i.useEffect(()=>{if(s){const w=setTimeout(()=>m("show"),500),M=setTimeout(()=>m("initial"),2e3);return()=>{clearTimeout(w),clearTimeout(M)}}m("initial")},[s]);const h=d.find(({defaultModel:w})=>w===t),g=t===yd?{categoryId:"gpt_3.5",shorterLabel:"3.5"}:{},{categoryId:v,shorterLabel:x}=h??g,f={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},A=a?"visible":o?"show":u;return e.jsxs(ne.div,{initial:"initial",animate:A,className:"flex items-center pb-0",children:[!l&&(r?e.jsx(Xn,{className:"icon-md"}):v&&e.jsx(Ho,{type:"outline",categoryId:v,className:"icon-md h-4 w-4"})),(n||c)&&e.jsx(ne.span,{className:"overflow-hidden text-clip whitespace-nowrap text-sm",variants:f,transition:{type:"tween",duration:.18},children:x}),n&&e.jsx($n,{className:P("icon-sm",{"text-token-text-quaternary":!o&&!r},{"text-token-text-secondary":o&&!r})})]})}function Eh({children:t,label:s}){return e.jsx(Qt,{label:s,sideOffset:0,children:t})}function Rh({children:t,title:s,description:a,markAsViewed:n}){return e.jsx(Ln,{announcementKey:it.ModelSwitcherAutoDowngrade,show:!0,side:"bottom",sideOffset:-4,title:s,description:a,badge:"beta",onDismiss:n,dismissOnOutsideClick:!0,children:t})}function Kt(t,s){const{modelSwitcherDeny:a,subscriptionLevel:n}=t;return!!a&&a.reason===Ci.RATE_LIMIT&&n===Mi.PLUS&&!s}const Ba=De({search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Ih=i.memo(Ah),ys="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function Ph({className:t,clientThreadId:s,message:a,onModelSelect:n,onDropdownChange:o,canRegenerateResponse:r}){const[l,u]=i.useState(null),[m,d]=i.useState(!1),[h,g]=i.useState(!1),v=Te(s),x=Oo({clientThreadId:s,message:a}),f=a.message.metadata?.model_slug,A=a.message.id,{modelOptions:w,modelSlug:M,animateModelLabelOnRender:y,messageModelEnabledTools:S}=x,N=zo(a.message),D=S.includes(Wn.Search),T=i.useMemo(()=>w.find(j=>j.value===f),[w,f]),C=i.useRef(null),{doesUserHaveAnyAccountsWithPlusFeatures:R}=kn(),E=j=>{j||setTimeout(()=>{C.current&&C.current.blur()},10)};if(i.useEffect(()=>{E(m)},[m]),Ti(s))return null;const B=r&&w.some(j=>Kt(j,R));return v?null:e.jsxs(re.Root,{onOpenChange:j=>{r&&(d(j),o(j),E(j)),j&&K.logEvent(X.conversationOpenMessageModelSelector,{has_get_plus_button:B,is_new_regen_dropdown:!0})},children:[r?e.jsx(Lh,{label:e.jsx(U,{id:"wDs5sz",defaultMessage:"Switch model"}),children:e.jsx(uo,{ref:C,className:P("cursor-pointer",t),onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:e.jsx(yr,{modelSlug:M,animateModelLabelOnRender:y,isDropdownOpen:m,isRegenerateEnabled:r,isHovered:h,isRegenLabel:!0,omitIcon:!1})})}):null,r&&e.jsx(re.Portal,{children:e.jsxs(re.Content,{className:"z-30 min-w-fit origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[e.jsx(re.Item,{disabled:!0,className:"pb-0 pt-2",children:e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(U,{id:"bFLh5u",defaultMessage:"Switch model"})})}),e.jsx(Dh,{clientThreadId:s,messageId:A,onModelSelect:n,messageModelSlug:f,omitModelIcons:!0,modelOptions:w,setHoveredOption:u,hoveredOption:l,retryOption:T,lastResponseUsedSearch:N,modelSupportsSearch:D,doesUserHaveAnyAccountsWithPlusFeatures:R})]})})]})}function Dh({clientThreadId:t,messageId:s,modelOptions:a,messageModelSlug:n,onModelSelect:o,omitModelIcons:r,setHoveredOption:c,hoveredOption:l,retryOption:u,lastResponseUsedSearch:m,modelSupportsSearch:d,doesUserHaveAnyAccountsWithPlusFeatures:h}){const g=xe(),[v,x]=i.useMemo(()=>wd(a,y=>y.subcategory),[a]),f=i.useMemo(()=>{const y=new Map;return v.forEach(S=>{const N=S.subcategory;N&&(y.has(N)||y.set(N,[]),y.get(N)?.push(S))}),y},[v]),A=P("icon-sm",r&&"order-10 ml-auto text-token-text-tertiary icon-md"),w=r?"right":"left",M=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:g.formatMessage(nn.search),icon:e.jsx(Pn,{className:A}),condition:d&&!m,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:g.formatMessage(nn.nosearch),icon:e.jsx(Go,{className:A}),condition:d&&m,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return e.jsxs(e.Fragment,{children:[x.map(y=>{const{value:S,...N}=y;return e.jsx(Tt,{value:S,onSelect:()=>{de.logEvent("chatgpt_regenerate_switch_model_button_clicked",S,{requestedModelId:S,...Qe({clientThreadId:t,messageId:s})}),o({requestedModelId:S})},includeRegenerate:!1,onMouseEnter:()=>c(S),onMouseLeave:()=>c(null),isHovered:l===S,messageModelSlug:n,includeCheck:!1,shouldShowUpsell:Kt(y,h),className:ys,...N,icon:r?e.jsx("span",{className:A}):N.icon,justifyIcon:w,wrapIcon:!r},S)}),[...f.entries()].map(([y,S])=>e.jsxs(re.Sub,{children:[e.jsx(re.SubMenuTrigger,{children:e.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:y})}),e.jsx(re.Portal,{children:e.jsx(re.SubContent,{className:"min-w-fit",children:S.map(N=>{const{value:D,...T}=N;return e.jsx(Tt,{value:D,onSelect:()=>{de.logEvent("chatgpt_regenerate_switch_model_button_clicked",D,{requestedModelId:D,...Qe({clientThreadId:t,messageId:s})}),o({requestedModelId:D})},includeRegenerate:!1,onMouseEnter:()=>c(D),onMouseLeave:()=>c(null),isHovered:l===D,messageModelSlug:n,includeCheck:!1,className:ys,...T,icon:null,justifyIcon:w,wrapIcon:!r,shouldShowUpsell:Kt(N,h)},y+"-"+D)})})})]},y)),!!u&&e.jsxs(e.Fragment,{children:[e.jsx(re.Separator,{}),e.jsx(Tt,{onSelect:()=>{de.logEvent("chatgpt_regenerate_try_again_button_clicked",u.value,{requestedModelId:u.value,...Qe({clientThreadId:t,messageId:s})}),o({requestedModelId:u.value})},includeRegenerate:!0,onMouseEnter:()=>c(u.value),onMouseLeave:()=>c(null),messageModelSlug:n,includeCheck:!1,className:ys,...u,label:g.formatMessage(nn.tryAgain),subtitle:u.label,icon:e.jsx(Xn,{className:A}),justifyIcon:w,wrapIcon:!r},u.value),M.filter(y=>y.condition).map(y=>e.jsx(Tt,{onSelect:()=>{de.logEvent(y.eventName,u.value,{requestedModelId:u.value,...Qe({clientThreadId:t,messageId:s})}),o({requestedModelId:u.value,extraStreamParams:y.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>c(y.key),onMouseLeave:()=>c(null),isHovered:l===y.key,messageModelSlug:n,includeCheck:!1,className:ys,...u,label:y.label,subtitle:"",icon:y.icon,justifyIcon:w,wrapIcon:!r},y.key))]})]})}function Lh({children:t,label:s}){return e.jsx(Qt,{label:s,sideOffset:0,children:t})}const nn=De({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Bh=i.memo(Ph),Fa=Oe(()=>ze(()=>import("./ebwx7yj0baonheef.js").then(t=>t.qg),__vite__mapDeps([4,2,1,3,5])).then(t=>t.MemoryActionResult));function Ha(t,s,a){J.updateTree(t,n=>{n.updateNodeMetadata(s,{inlineComparisonRating:a})})}function Ua(t){return{is_dark_mode:t,time_since_loaded:Math.floor(performance.now()/1e3),page_height:window?.innerHeight,page_width:window?.innerWidth,pixel_ratio:window?.devicePixelRatio,screen_height:window?.screen?.height,screen_width:window?.screen?.width}}const Oa=({messages:t})=>{for(const{message:{metadata:s}}of t){const{augmented_paragen_prompt_label:a}=s??{};if(a)return a}};function Fh(t){const s=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),a=i.useRef({left:null,right:null});return t.stubSideBySideFeedback?e.jsx(wr,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:s,firstVisibleTokenTimestampsRef:a,...t}):e.jsx(Hh,{...t,visibilityStateRef:s,firstVisibleTokenTimestampsRef:a})}function Hh(t){const{clientThreadId:s,variantIds:a,variantsInStreamInfo:n,turnIndex:o,firstVisibleTokenTimestampsRef:r}=t;if(a.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const c=sa(),l=Oh(),u=_n(),m=_i(),[d,h]=i.useMemo(()=>Wo(a.join(""))()<.5?[0,1]:[1,0],[a[0],a[1]]),g=d<h?"left":"right",v=g==="left"?"right":"left",x=a[d],f=a[h],A=Mt(Ze(s,E=>E?.tree.getLeafFromNode(x))).id,w=Mt(Ze(s,E=>E?.tree.getLeafFromNode(f))).id,M=Mt(dn(s,o,A)),y=Mt(dn(s,o,w)),S=g==="left"?M:y,N=g==="left"?y:M,D=n.display_treatment==="unskippable",T=c?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";i.useEffect(()=>(gn.setState({displayingSideBySideFeedback:!0,unskippable:D}),()=>{gn.setState({displayingSideBySideFeedback:!1,unskippable:!1})}),[D]),jd();const C=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});i.useEffect(()=>ki(Ni,{requestCompletion:()=>{const E=Xe(S.messages)?.completionSampleFinishTime,p=Xe(N.messages)?.completionSampleFinishTime,B=J.getServerThreadId(s);if(l){const H=J.getTree(s).getParentPromptNode(A),G=[M,y].map((b,F)=>({messageId:b.messages[b.messages.length-1].message.id,loadFirstTokenTime:F===0?r.current.left:r.current.right,loadEndTime:Xe(b.messages)?.completionSampleFinishTime})),_={},I=H.metadata?.variantsInStreamInfo==null&&H.message.metadata?.paragen_variants_info!=null;for(const b of G)_[b.messageId]=I?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:b.loadFirstTokenTime,load_end_time:b.loadEndTime};ws({shouldUseNewParagenEndpoint:l,params:{conversation_id:B,displayed_message_ids:G.map(b=>b.messageId),message_metadatas:_,rating:"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:c?2:1,user_prompt_message_id:H.message.id}})}else ws({shouldUseNewParagenEndpoint:l,params:{feedback_version:T,original_message_id:S.messages[S.messages.length-1]?.message.id,new_message_id:N.messages[N.messages.length-1]?.message.id,conversation_id:B,completion_comparison_rating:"skip",new_completion_placement:v,feedback_start_time:t.conversationTurnMountTime,compare_step_start_time:t.conversationTurnMountTime,original_completion_load_start_time:t.conversationTurnMountTime,original_completion_load_end_time:E??0,new_completion_load_start_time:t.conversationTurnMountTime,new_completion_load_end_time:p??0,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:Ua(m),...C.current}})}}),[M,y,A,s,t.conversationTurnMountTime,T,v,S?.messages,N?.messages,m,l,c,r]);const R=E=>{const B=J.getTree(s).getLeafFromNode(E);J.setThreadCurrentLeafId(s,B.id);const j=E===x,H=j===(g==="left"),G=Xe(S.messages)?.completionSampleFinishTime,_=Xe(N.messages)?.completionSampleFinishTime;S.messages.length>0&&Ha(s,S.messages[S.messages.length-1].nodeId,H?"original":"new"),N.messages.length>0&&Ha(s,N.messages[N.messages.length-1].nodeId,H?"original":"new");let I;G==null||_==null?I=H?"partial_load_comparison_original":"partial_load_comparison_new":I=H?"original":"new";const b=J.getServerThreadId(s);if(l){const F=[M,y].map((Q,he)=>({messageId:Q.messages[Q.messages.length-1].message.id,loadFirstTokenTime:he===0?r.current.left:r.current.right,loadEndTime:Xe(Q.messages)?.completionSampleFinishTime})),Y=j?F[0].messageId:F[1].messageId,q=J.getTree(s).getParentPromptNode(A),ie={},le=q.metadata?.variantsInStreamInfo==null&&q.message.metadata?.paragen_variants_info!=null;for(const Q of F)ie[Q.messageId]=le?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:Q.loadFirstTokenTime,load_end_time:Q.loadEndTime};ws({shouldUseNewParagenEndpoint:l,params:{conversation_id:b,displayed_message_ids:F.map(Q=>Q.messageId),message_metadatas:ie,rating:"selected",selected_message_id:Y,source_timestamp:Date.now(),ui_variant:c?2:1,user_prompt_message_id:q.message.id}})}else ws({shouldUseNewParagenEndpoint:l,params:{feedback_version:T,original_message_id:S.messages[S.messages.length-1]?.message.id,new_message_id:N.messages[N.messages.length-1]?.message.id,conversation_id:b,completion_comparison_rating:I,new_completion_placement:v,feedback_start_time:t.conversationTurnMountTime,compare_step_start_time:t.conversationTurnMountTime,original_completion_load_start_time:t.conversationTurnMountTime,original_completion_load_end_time:G??null,new_completion_load_start_time:t.conversationTurnMountTime,new_completion_load_end_time:_??null,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:Ua(m),...C.current}})};return e.jsx(wr,{...t,setPreferredFeedback:R,leftVariantId:x,rightVariantId:f,leftTurn:M,rightTurn:y,hasActiveRequest:u,originalTurn:S,visibilityStateRef:C})}function Uh(t){if(!t.length)return!1;const s=t.filter(a=>a.type===ka.Text||a.type===ka.MultiText).filter(a=>a.message.message.status!=="finished_successfully"&&a.message.message.metadata?.snorkle_status!==void 0);return s.length>0&&s.every(a=>{const n=a.message.message.content;return n?.content_type===mo.Text&&n.parts.join("")===""})}function wr({setPreferredFeedback:t,leftVariantId:s,rightVariantId:a,leftTurn:n,rightTurn:o,hasActiveRequest:r,originalTurn:c,visibilityStateRef:l,...u}){const{defaultParagenLabel:m,shouldShowParagenLabels:d=!1}=jo(),h=n&&Oa(n)||m,g=o&&Oa(o)||m,v=i.useMemo(()=>n?.messages??[],[n?.messages]),x=i.useMemo(()=>o?.messages??[],[o?.messages]),{avatarClassName:f,firstVisibleTokenTimestampsRef:A}=u,w=i.useMemo(()=>Rs(v),[v]),M=i.useMemo(()=>Rs(x),[x]),y=yo(),[S,N]=i.useMemo(()=>[w,M].map(F=>Uh(F)),[w,M]),D=rt(n?Ms.getRequestIdFromConversationTurn(n):"")||S,T=rt(o?Ms.getRequestIdFromConversationTurn(o):"")||N,C=n?.role===Ie.User,R=o?.role===Ie.User,E=i.useRef(null),p=i.useRef(null),B=i.useRef(null),j=u.stubSideBySideFeedback||S,H=u.stubSideBySideFeedback||N;!j&&A.current.left==null&&(A.current.left=Date.now()),!H&&A.current.right==null&&(A.current.right=Date.now()),i.useEffect(()=>{if(E.current&&p.current&&B.current){const F=Array(11).fill(0).map((te,q)=>q/10),Y=new IntersectionObserver(te=>te.forEach(q=>{q.target===p.current?(l.current.left_visibility_initial==null&&(l.current.left_visibility_initial=q.intersectionRatio),l.current.left_visibility_max=Math.max(l.current.left_visibility_max??0,q.intersectionRatio)):q.target===B.current&&(l.current.right_visibility_initial==null&&(l.current.right_visibility_initial=q.intersectionRatio),l.current.right_visibility_max=Math.max(l.current.right_visibility_max??0,q.intersectionRatio))}),{root:E.current,threshold:F});return Y.observe(p.current),Y.observe(B.current),()=>Y.disconnect()}},[l]);const{data:G}=wo(void 0,!1,y),_=sa(),I=e.jsx("div",{className:"text-pretty px-6 pb-5 pt-1 text-center text-sm text-token-text-secondary",children:e.jsx(U,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),b=Le();return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:P("sticky z-[1] text-pretty bg-token-main-surface-primary px-6 text-center text-lg",b&&"top-[var(--thread-leading-height)] pt-3",!b&&"top-[-1px]",_&&!b?"md:top-header-height":b?"":"md:static"),"data-testid":"paragen-feedback-title",children:[e.jsx(U,{id:"JgCHDY",defaultMessage:"You’re giving feedback on a new version of ChatGPT."}),_?I:null]}),_?null:I,e.jsx("div",{className:"relative -mb-2 snap-x snap-mandatory overflow-x-auto px-3 pb-4 md:px-5 lg:px-10",ref:E,children:e.jsx("div",{className:P(!b&&"min-w-fit"),children:e.jsxs("div",{className:P("mx-auto flex max-w-6xl items-start",_&&!b&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",!_&&!b&&"gap-4 sm:gap-6",_&&b&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",b&&!_&&"gap-4 sm:gap-6"),children:[e.jsxs(za,{horizontalScrollContainerRef:E,rootElementRef:p,onClick:()=>{t(s)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:j,children:[e.jsxs(Va,{children:[e.jsx(vn,{messages:v,isUserTurn:C,avatarClassName:f}),e.jsx(Wa,{children:d?e.jsx("span",{className:"font-bold text-token-text-primary",children:h}):e.jsx(U,{...$a.responseNumber,values:{responseIndex:1}})})]}),_&&j?e.jsx(Ga,{}):e.jsxs(e.Fragment,{children:[G!=null&&!C&&e.jsx(Fa,{clientThreadId:u.clientThreadId,messages:v,isParagen:!0}),e.jsx(Sn,{...u,groupedMessagesToRender:w,allGroupedMessages:w,isEditing:!1,isUserTurn:C,isCompletionRequestInProgress:D,hasActiveRequest:r,handleEnterEdit:hs,handleExitEdit:hs,shouldGrowContainer:!1}),e.jsx(qa,{clientThreadId:u.clientThreadId,conversationTurnMountTime:u.conversationTurnMountTime,turn:n,originalTurn:c})]})]}),e.jsxs(za,{horizontalScrollContainerRef:E,rootElementRef:B,onClick:()=>{t(a)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:H,children:[e.jsxs(Va,{children:[e.jsx(vn,{messages:x,isUserTurn:R,avatarClassName:f}),e.jsx(Wa,{children:d?e.jsx("span",{className:"font-bold text-token-text-primary",children:g}):e.jsx(U,{...$a.responseNumber,values:{responseIndex:2}})})]}),_&&H?e.jsx(Ga,{}):e.jsxs(e.Fragment,{children:[G!=null&&!R&&e.jsx(Fa,{clientThreadId:u.clientThreadId,messages:x,isParagen:!0}),e.jsx(Sn,{...u,groupedMessagesToRender:M,allGroupedMessages:M,isEditing:!1,isUserTurn:R,isCompletionRequestInProgress:T,hasActiveRequest:r,handleEnterEdit:hs,handleExitEdit:hs,shouldGrowContainer:!1}),e.jsx(qa,{clientThreadId:u.clientThreadId,conversationTurnMountTime:u.conversationTurnMountTime,turn:o,originalTurn:c})]})]})]})})})]})}function za({horizontalScrollContainerRef:t,rootElementRef:s,onClick:a,children:n,hasActiveRequest:o,isWaitingOnFirstUserVisibleToken:r}){const c=sa(),l=Le(),{scrollX:u}=Vi({layoutEffect:!1,container:t,target:s}),m=Cd(),d=Md(),h=i.useRef(null),g=i.useRef(null),v=i.useRef(null),[x,f]=i.useState(!1),[A,w]=i.useState(!1),[M,y]=i.useState(!1),[S,N]=i.useState(0);i.useEffect(()=>{if(!c)return;const B=new IntersectionObserver(j=>{for(const H of j)H.target===h.current?f(H.isIntersecting):H.target===v.current?y(H.isIntersecting):H.target===g.current&&w(H.isIntersecting)},{root:m?.current,rootMargin:l?`0px 0px -${S}px 0px`:void 0});return h.current&&g.current&&v.current&&(B.observe(h.current),B.observe(g.current),B.observe(v.current)),()=>{B.disconnect()}},[S,c,l,m]);const D=!M&&(A||x),T=qi(u,B=>D?-1*B:0),C=ya(0);i.useEffect(()=>{if(!c)return;const B=new ResizeObserver(j=>{fs(j.length===1,"entryList.length === 1");const H=j[0];fs(H.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),C.set(H.contentBoxSize[0].inlineSize)});return s.current&&B.observe(s.current),()=>{B.disconnect()}},[c,C,s]);const R=ya(0);i.useEffect(()=>{if(!c)return;const B=new ResizeObserver(j=>{fs(j.length===1,"entryList.length === 1");const H=j[0];fs(H.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),R.set(H.contentBoxSize[0].blockSize+16),N(H.contentBoxSize[0].blockSize)});return d.current&&B.observe(d.current),()=>{B.disconnect()}},[c,R,d]);const E=e.jsx(It,{className:c?"px-5":"mt-4 self-start",onClick:a,"data-testid":"paragen-prefer-response-button",children:e.jsx(U,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),p=r;return e.jsxs("div",{"data-paragen-root":!0,className:P("relative flex w-full min-w-[min(450px,80vw)] snap-center flex-col gap-1 text-left",l&&c&&"pl-3 pr-5 sm:w-[calc(100cqw-62px)] sm:pl-3 sm:pr-5 md:px-10",!l&&c&&"px-10",c?"min-h-60 py-4":"rounded-2xl border border-token-main-surface-tertiary bg-white p-5 dark:bg-gray-700"),ref:s,children:[e.jsx("div",{className:P("absolute left-0 right-0 top-48 h-px","invisible"),ref:h}),e.jsx("div",{className:P("absolute bottom-0 left-0 right-0 top-48","invisible"),ref:g}),e.jsx("div",{className:P("absolute bottom-0 left-0 right-0 h-px","invisible"),ref:v}),n,c?e.jsx("div",{className:"flex-1"}):null,c?e.jsx("div",{className:"mt-4 min-h-10",children:p?null:e.jsx(ne.div,{style:{translateX:T,width:C,bottom:R},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:P({fixed:D,"z-20 flex w-full justify-center":!0}),children:E})}):o?null:E]})}function Ga(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pb-5 pt-3",children:[e.jsx(at,{className:"h-4 w-[75%]"}),e.jsx(at,{className:"h-4 w-[50%]"}),e.jsx(at,{className:"h-4 w-[80%]"}),e.jsx(at,{className:"h-4 w-[55%]"}),e.jsx(at,{className:"h-4 w-[66%]"}),e.jsx(at,{className:"h-4 w-[64%]"}),e.jsx(at,{className:"h-4 w-[48%]"})]})}function sa(){const{layer:t}=Ve("3119715334");return t.get("should-enable-hojicha",!1)}const Wa=pe.div`text-sm text-token-text-secondary font-semibold`,Va=pe.div`flex gap-4 items-center mb-1`,at=pe.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function qa({clientThreadId:t,conversationTurnMountTime:s,turn:a,originalTurn:n}){const o=On();if(!o.showParagenMetadata||!o.showDebugConversationTurns&&!o.forceParagen||a==null)return null;let r=a===n?"ORIGINAL":"NEW";const c=a.messages[a.messages.length-1],l=c?.message?.metadata?.__internal;if(l){const{model_id:h,model_definition_slug:g,model_definition_virtual_model_id:v,alternative_model_selection_rule:x,augmented_paragen_prompt_group_id:f,augmented_paragen_prompt_id:A,augmented_paragen_prompt:w}=l;h&&(r+=`
Model ID: ${h}`),g&&(r+=`
Model Slug: ${g}`),v&&(r+=`
Virtual Model ID: ${v}`),x&&(r+=`
Alternative Model Rule: ${x}`),f&&(r+=`
Prompt Group ID: ${f}`),A&&(r+=`
Prompt ID: ${A}`),w&&(r+=`
Prompt: ${w}`)}r+=`
Message ID: ${c.message.id}`;const m=J.getTree(t).getParentPromptNode(a.variantIds[0]),d=m.metadata?.variantsInStreamInfo==null&&m.message.metadata?.paragen_variants_info!=null;return r+=`
User prompt message ID: ${m.message.id}`,r+=`
Is Persisted Paragen? ${d}`,r+=`
Completion Sample Finish Time: ${d?`${s} (persisted)`:Xe(a.messages)?.completionSampleFinishTime}`,e.jsx("div",{className:"whitespace-pre-wrap text-sm text-red-500",children:r})}async function ws({shouldUseNewParagenEndpoint:t,params:s}){t?await At.submitParagenSelectionV2(s):await At.submitMessageComparisonFeedback(s)}function Oh(){const{value:t}=qe("3894844102");return t}const $a=De({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}"}}),Ya=[1,2,3,4,10,20,30],zh=.5;function Gh({clientThreadId:t,conversationLeafId:s}){const a=Vo(qo.isBusinessWorkspace),n=i.useRef(!1),o=Zt(t),r=Ls(t),{isUnauthenticated:c}=Pe(),l=i.useMemo(()=>{if(!o)return-1;const R=Wo(o);return R()>zh?-1:Ya[Math.floor(R()*Ya.length)]},[o]),u=Ai(t,s),m=u[u.length-1],d=i.useMemo(()=>Ms.getRequestIdFromConversationTurn(m),[m]),h=rt(d),[g,v]=i.useState(null),[x,f]=i.useState(!1),[A,w]=i.useState(!1),[M,y]=i.useState(!1),S=R=>{const E=Xe(u)?.messages[0]?.message.id;v(R),T(E,R)},N=u.filter(R=>R.role===Ie.Assistant).length,D=m?.role===Ie.Assistant,T=i.useMemo(()=>Lo((R,E)=>{o&&R&&At.submitConversationRating({conversation_id:o,message_id:R,rating:E,shown_at_assistant_turn:l}),K.logEvent(X.conversationRatingSubmitted,{rating:E,showAtAssistantTurn:l,conversationId:o}),f(!0),setTimeout(()=>{w(!0)},1500)},2e3),[o,l]),C=N!==l||h||!D||!!a||r?.kind!==Je.PrimaryAssistant||M||c;return i.useEffect(()=>{!C&&!n.current&&(K.logEvent(X.conversationRatingShown,{showAtAssistantTurn:l,conversationId:o}),n.current=!0)},[C]),M||C?null:e.jsxs("div",{className:"mx-auto",children:[e.jsx(es,{children:x&&!A&&e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(Ka,{$padded:!0,children:e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(U,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!x&&e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:e.jsxs(Ka,{$padded:!1,children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-secondary",children:[e.jsx(U,{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(an,{$selected:g==="thumbsUp",onClick:()=>S("thumbsUp"),children:e.jsx($o,{className:"icon-md"})}),e.jsx(an,{$selected:g==="thumbsDown",onClick:()=>S("thumbsDown"),children:e.jsx(Yo,{className:"icon-md"})})]})]}),e.jsx("div",{className:"w-px flex-1 self-stretch bg-token-main-surface-tertiary"}),e.jsx(an,{className:"p-3",$selected:!1,onClick:()=>y(!0),children:e.jsx(Ei,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const an=pe.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,Ka=pe.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`,Wh=Oe(()=>ze(()=>import("./mbpqs85309a6oba4.js"),__vite__mapDeps([35,1,2,3,4,5,36])));function Vh({clientThreadId:t,conversationLeafId:s,canShowInlineMessageFeedback:a,messageForRating:n,allGroupedMessages:o,currentModelId:r}){let c=null;const l=Fs(g=>{const v=ho.getCacheAwareConversationTurns(Ri(t,g),s);let x=0;for(let f=v.length-1;f>=0;f--){const A=v[f];if(A.messages.some(w=>w.message.metadata?.is_indepth_feedback))return!0;if(A.messages.some(w=>w.message.author.role===Ie.Assistant)&&x++,x>=3)break}return!1}),u=Zt(t),m=zn(g=>g.voiceFeedbackThread),d=u===m,{voiceName:h}=Td();return l?null:(d&&u?(Ii.feedbackShown.success({voice:h}),c=e.jsx("div",{className:"text-center",children:e.jsx(_d,{serverThreadId:u})})):n.rating&&a?c=e.jsx(Wh,{clientThreadId:t,conversationMessage:n,allGroupedMessages:o,currentModelId:r}):c=e.jsx("div",{className:"text-center",children:e.jsx(Gh,{clientThreadId:t,conversationLeafId:s})}),e.jsx("div",{className:"mt-3 w-full empty:hidden",children:c}))}const qh=Oe(()=>ze(()=>import("./nij922qkvy3j3fyz.js"),__vite__mapDeps([37,1,2,3,38,39,4,5,40])).then(t=>t.VoicePlayButton)),Xa=128,Qa={minHeight:"calc(100cqh - var(--thread-leading-height) - var(--thread-trailing-height) - var(--previous-turn-min-height))"};function $h(t){const{turnIndex:s,conversationLeafId:a,isFinalTurn:n,clientThreadId:o,onChangeItemInView:r,onChangeRating:c,currentModelId:l,avatarClassName:u,showAvatar:m=!0,scrollToMessageId:d,shouldShowDateHeader:h}=t,g=xe(),v=Bn(),x=!!v&&Pi(v),f=Tn(),A=Vo(qo.isBusinessWorkspace),w=so(),{value:M}=qe("2848981774"),y=J.getServerThreadId(o),S=Mt(dn(o,s,a)),{messages:N,variantIds:D,variantsInStreamInfo:T}=S,C=Rs(N),R=kd();let E=N[N.length-1];for(const z of C){const ue=Bu(z);if(ue.some(We=>R.has(We.message.id))){E=ue[ue.length-1];break}}const p=N.slice(0,N.indexOf(E)+1),B=Es(),[j,H]=i.useState(!1),[G,_]=i.useState(!1),I=D.findIndex(z=>p.some(ue=>ue.nodeId===z)),b=S.role===Ie.User,F=ct(),Y=Te(o),te=Pt(S.gizmoId??Y)?.data,q=Us(l),ie=Nd(l),le=Le(),Q=Ls(o,te?.gizmo.id),we=ao(o)===oo.STREAMING,Be=!1,{value:ce}=Cs("2291672486"),fe=p.some(z=>z.message.content.content_type===mo.MultimodalText),{layer:je}=Ve("1547743984"),ve=y&&B&&je.get("show_share_button_inline",!1),{isUnauthenticated:Ae}=Pe(),[Ee,Fe]=i.useState(!1),[Ce,O]=i.useState(!1),L=S.messages.map(z=>z.message.id),V=i.useRef(null),W=N[N.length-1],Z=W.rating,ae=(d?.length??0)>2&&d!=="finalAgentTurn"&&n&&M&&le,ge=()=>{p.length===1&&(K.logEvent(X.editPrompt,{id:p[0].message.id,threadId:J.getServerThreadId(o)}),de.logEvent("chatgpt_edit_prompt"),H(!0))},Se=i.useCallback(()=>{H(!1)},[]),oe=i.useCallback(z=>{Ad(o,s,w,z)},[o,s,w]),Re=z=>{c({nodeId:W.nodeId,messageId:W.message.id,rating:z}),K.logEvent(z==="thumbsDown"?X.messageFeedbackThumbsDownClicked:X.messageFeedbackThumbsUpClicked,{id:W.message.id,threadId:J.getServerThreadId(o),model:l,rating:z}),_(!0)},[$]=i.useState(()=>Date.now()),Me=i.useMemo(()=>Ms.getRequestIdFromConversationTurn(S),[S]),Ge=ro({clientThreadId:o,conversationLeafId:a}),ee=rt(Me)&&!Ge,dt=_n(),ut=Rs(p),mt=i.useRef(!1);i.useEffect(()=>{if(mt.current||d===void 0||!M||!le||!V.current){d==="finalAgentTurn"&&n&&mt.current&&J.updateScrollToMessageId(o,void 0);return}(L.includes(d)||d==="finalAgentTurn"&&n)&&(mt.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(V.current)if(d==="finalAgentTurn"&&n)V.current.scrollIntoView({behavior:"instant",block:"end"}),J.updateScrollToMessageId(o,void 0);else{const z=V.current.offsetHeight;let ue;z>Xa?ue=Xa-z:ue=0,V.current.style.scrollMarginTop=`calc(${ue}px + 2px + var(--thread-leading-height))`,V.current.scrollIntoView({behavior:"smooth"})}})}))},[d,V.current]);const{showDebugConversationTurns:zs}=On(),Dt=io(o),$e=Uo(o),ht=Ed({clientThreadId:o,conversationMode:Q}),_e=lt(o),gt=i.useCallback(({requestedModelId:z,systemMessage:ue,juice:We,extraStreamParams:jt})=>{const Ot=new $t;ht({id:W.nodeId,eventMetadata:{eventSource:"mouse"},turnTracker:Ot,requestedModelId:z,systemMessage:ue,juice:We,extraStreamParams:jt})},[W,ht]),ss=Be,pt=!f&&!Dt&&!F&&!b,Lt=Rd(),Bt=E.message.author.role===Ie.Assistant?E.message:null;Id({isCompletionRequestInProgress:ee,isUserTurn:b,message:Bt});const Ft=Ze(o,z=>z?.tree!=null&&D.some(ue=>{const We=z.tree.getLeafFromNode(ue);return z.tree.getHasErrorFromNode(We.id)})),{isOpen:ft}=Pd(),et=Dd(Q),Ht=!Lt&&!et&&pt&&n&&T?.num_variants_in_stream===2&&!W.inlineComparisonRating&&!Ft,Ye=Ld(S),tt=Ht,Gs=Ht&&!Ye,xt=!b&&!f&&!Dt&&!et&&!we&&!ee&&!ft,vt=xt&&(!A||ss||ie||x)&&!et&&!Ae&&!F,St=!f&&!((ee||we)&&n)&&D.length>1&&!j&&!tt;let bt=!1;if(b&&p.length===1){const{shouldHideContent:z}=Bd(p[0]);z&&(bt=!0)}const Ut=b&&!et&&!f&&!fe&&p.length===1&&!bt&&!j&&!Ae,Ws=z=>{r(D[z]),K.logEvent(X.changeNode,{intent:"toggle_between"})};if(!Fd(S,p,zs)&&!tt)return ae?e.jsx("div",{style:Qa}):null;const st=p.some(({message:z})=>Di.getAssetPointers(z).length>0),ns=!st&&n&&$e&&!ce?e.jsx(xs,{onClick:()=>{de.logEvent("chatgpt_regenerate_try_again_button_clicked",l,{requestedModelId:l,...Qe({clientThreadId:o,turnIndex:s})});const z=new $t;ht({id:_e,eventMetadata:{eventSource:"mouse"},turnTracker:z}),_s()},icon:Xn,label:g.formatMessage({id:"ConversationTurn.regenerateTooltip",defaultMessage:"Regenerate"}),testId:"regenerate-turn-action-button"}):null,yt="h-[30px] rounded-md px-1 text-token-text-secondary hover:bg-token-main-surface-secondary",qs=!st&&ce?e.jsx(Bh,{className:yt,clientThreadId:o,message:W,onModelSelect:gt,onDropdownChange:Fe,canRegenerateResponse:$e}):null,$s=!b&&!bt&&(!n||!ee)?e.jsx(Xd,{onClick:oe}):null,as=!b&&(!n||!ee)&&(W.disclaimers??[]).length===0&&W.nodeId?e.jsx(qh,{conversationId:o,message:W,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-xs text-token-text-tertiary hover:text-token-text-primary"}):null,os=!b&&W&&(!n||!ee)?e.jsx(Qd,{message:W,isFinalTurn:n,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-token-text-tertiary hover:text-token-text-primary"}):null,wt=vt&&!ee?e.jsxs("div",{className:"flex",children:[Z!=="thumbsDown"&&e.jsx(xs,{onClick:()=>Re("thumbsUp"),disabled:Z==="thumbsUp",icon:Z==="thumbsUp"?Hd:$o,label:g.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"},`thumbsUp:${W.nodeId}`),Z!=="thumbsUp"&&e.jsx(xs,{onClick:()=>Re("thumbsDown"),disabled:Z==="thumbsDown",icon:Z==="thumbsDown"?Ud:Yo,label:g.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"},`thumbsDown:${W.nodeId}`)]}):null,Ys=ve&&e.jsx(xs,{onClick:()=>{As.openSharingModal(y)},label:g.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:Od}),Ks=!ce&&e.jsx(Ih,{className:yt,clientThreadId:o,message:W,onModelSelect:gt,onDropdownChange:Fe});function rs(z){return le?z:e.jsx(Vn,{clientThreadId:o,isStaticSharedThread:f,withVerticalPadding:!0,withHorizontalPadding:!tt,children:z})}function is(z){return le?z:e.jsx(Yt,{children:z})}return e.jsxs(e.Fragment,{children:[h&&e.jsx(zd,{turn:S}),e.jsxs("article",{className:P("w-full scroll-mb-[var(--thread-trailing-height,150px)] text-token-text-primary focus-visible:outline-2 focus-visible:outline-offset-[-4px]",d==="finalAgentTurn"&&M&&le?"opacity-0":""),style:ae?Qa:void 0,ref:V,dir:"auto","data-testid":`conversation-turn-${s}`,"data-scroll-anchor":n,onMouseEnter:()=>O(!0),onMouseLeave:()=>O(!1),children:[e.jsx(Gd,{role:S.role}),rs(e.jsx(e.Fragment,{children:tt?e.jsx(Fh,{isFeedbackEnabled:vt,variantIds:D,variantsInStreamInfo:T,conversationTurnMountTime:$,stubSideBySideFeedback:Gs,...t}):is(e.jsxs(e.Fragment,{children:[!b&&m&&e.jsx(Yh,{children:e.jsx(vn,{messages:p,isUserTurn:b,avatarClassName:u,gizmo:te})}),e.jsx("div",{className:P("group/conversation-turn relative flex w-full min-w-0 flex-col",!b&&Wd),children:e.jsx("div",{className:"flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[!b&&!f&&e.jsx(Vd,{messages:p,clientThreadId:o,gizmoId:te?.gizmo.id}),!1,e.jsx(Sn,{groupedMessagesToRender:ut,allGroupedMessages:C,...t,isEditing:j,isUserTurn:b,isCompletionRequestInProgress:ee,isFeedbackEnabled:vt,isFinalTurn:n,hasActiveRequest:dt,showEditButton:Ut,handleEnterEdit:ge,handleExitEdit:Se}),q&&e.jsx("div",{className:"mb-4",children:e.jsx(qd,{messages:p})}),(xt||St)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:P("mb-2 flex gap-3 empty:hidden",b?"mr-1 flex-row-reverse":"-ml-2"),children:e.jsx($d,{alwaysShow:n,showInline:n||St,isHovered:Ce||Ee,pagination:St&&e.jsx(Yd,{showInline:n||St,currentPage:I,onChangeIndex:Ws,length:D.length,className:P("self-center",D.length>1?"visible":"!invisible")}),actions:xt&&e.jsxs(e.Fragment,{children:[as,$s,ns,wt,os,Ks,Ys,qs]})})}),xt&&!ee?e.jsx("div",{className:"pr-2 lg:pr-0",children:e.jsx(Kd,{message:W,isFinalTurn:n})}):null,n&&!ee&&e.jsx(Vh,{canShowInlineMessageFeedback:G,clientThreadId:o,conversationLeafId:a,messageForRating:W,allGroupedMessages:C,currentModelId:l})]})]})})})]}))}))]})]})}const jn=xo.memo($h),Yh=pe.div`flex-shrink-0 flex flex-col relative items-end`;function Kh({onChangeItemInView:t,onRequestMoreCompletions:s,onChangeRating:a,onRequestCompletion:n,clientThreadId:o,conversationLeafId:r,hideHeader:c}){const l=ye(),u=Bs(),m=Zd(),[d]=Jd(),h=eu(),[g]=tu(),v=Ls(o),x=Ds(),f=Kn(o),w=J.getConversationOrigin(o)===Li.APPLE,M=l.store.useContentAreaDimensions(Rt.Header,F=>F?.height?F.height:void 0),y=l.store.useIsHeaderContentAreaPopulated(),S=go(o),{isArchived:N}=S,D=su(f.id),T=v?.kind===Je.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":D,C=Nn(o,r),R=nu(),[E,p]=i.useState(0),[B,j]=i.useState(!1);i.useEffect(()=>{u&&(E===0?p(C):!B&&C>E&&(j(!0),de.logEvent("chatgpt_continue_conversation_first_message_sent"),K.logEvent(X.continueConversationFirstMessageSent),de.logEvent("chatgpt_conversation_share_page_loaded"),K.logEvent(X.sharedConversationPageLoaded)))},[C,E,B,u]),i.useEffect(()=>{u&&(de.logEvent("chatgpt_continue_conversation_page_loaded"),K.logEvent(X.continueConversationPageLoaded))},[u]);const H=i.useCallback(()=>{m({behavior:"smooth"})},[m]),G=au(o),_=R&&!N,I=Ko(o,r),b=(F,Y,te)=>[...new Array(Y-F).keys()].map(q=>{const ie=q+F;return e.jsx(jn,{isFinalTurn:te(ie),turnIndex:ie,clientThreadId:o,conversationLeafId:r,onChangeItemInView:t,onChangeRating:a,onRequestMoreCompletions:s,onRequestCompletion:n,currentModelId:f.id,avatarClassName:T,scrollToBottom:H,shouldShowDateHeader:I(ie)},ie)});return e.jsxs("div",{onCopy:G,className:P("flex flex-col text-sm",_&&"pb-[120px]",M||_?null:"md:pb-9"),style:{paddingBottom:_?void 0:M},children:[!c&&x?.data&&e.jsx(Sr,{clientThreadId:o}),u&&e.jsxs(e.Fragment,{children:[e.jsx(Yt,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(U,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),C-E===0&&e.jsx("div",{className:"text-center text-xs font-semibold text-token-text-primary",children:e.jsx("button",{onClick:()=>{As.openModal(ou.ReportConversation),de.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),K.logEvent(X.sharedConversationReportContentClicked,{location:"Dynamic Shared Thread Page"})},children:e.jsx(U,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})}),b(0,E,F=>F===E-1),e.jsx(Yt,{children:e.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(ru,{className:"icon-xs mr-2"}),e.jsx(U,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})}),b(E,C,F=>F===C-1)]}),!u&&b(0,C,F=>F===C-1),w&&d&&!g&&e.jsx(Za,{className:P("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{de.logEvent("chatgpt_thread_scroll_to_top"),h({behavior:"smooth"})},children:e.jsx(iu,{className:"icon-md text-token-text-primary"})}),!d&&e.jsx(Za,{className:P(M?null:"bottom-5",_?y?"translate-y-[-50px]":"translate-y-[-10px]":""),style:{bottom:R?"calc(var(--composer-bar_footer-current-height) + var(--composer-bar_current-height))":M},onClick:()=>{de.logEvent("chatgpt_thread_scroll_to_bottom"),m({behavior:"smooth"})},children:e.jsx(lu,{className:"icon-md text-token-text-primary"})})]})}const Za=pe.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-light right-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`,Xh=60,Qh=({children:t,scrollViewClassName:s,scrollAnchorTopOffset:a=0})=>{const n=i.useRef(null);return e.jsx("div",{className:"h-full",ref:n,children:e.jsx(An,{children:e.jsx(Lu,{className:"h-full",followButtonClassName:"hidden",initialScrollBehavior:"auto",scrollViewClassName:s,scroller:()=>Zh(n,a)?0:1/0,children:t})})})},Zh=(t,s)=>{const a=Jh(t.current);if(a==null)return!1;const n=a>s,o=a<s-Xh;return!n&&!o};function Jh(t){if(!t)return null;const s=t.querySelector('[data-scroll-anchor="true"]');if(!s)return null;const a=s.getBoundingClientRect().top,n=t.getBoundingClientRect().top;return a-n}const eg=Oe(()=>ze(()=>import("./g6va54f1qx14it8i.js"),__vite__mapDeps([41,2,1,3,4,5,42,43,44,45,46,40,47])).then(t=>t.OpenDebugSidebarButton)),tg=Oe(()=>ze(()=>import("./hadglcpnftnvdlhd.js"),__vite__mapDeps([48,1,4,2,3,5]))),Ja=De({doNotShareSensitive:{id:"thread.modal.onboarding.title",defaultMessage:"Do not share sensitive materials with this application"},somethingWentWrong:{id:"thread.modal.unrecoverableError.title",defaultMessage:"Something went wrong"},tryAgainLater:{id:"thread.modal.unrecoverableError.description",defaultMessage:"We're sorry, but something went wrong. Please try again later."},resetThread:{id:"thread.modal.unrecoverableError.resetThread",defaultMessage:"Reset thread"},sharedConversationReportConversation:{id:"thread.sharedConversation.report",defaultMessage:"Report conversation"},latencyButton:{id:"thread.latencyButton",defaultMessage:"Latency"},archivedConversationDescription:{id:"thread.archivedConversationDescription",defaultMessage:"This conversation is archived. To continue, please unarchive it first."},unarchiveButton:{id:"thread.unarchiveButton",defaultMessage:"Unarchive"}});function sg({clientThreadId:t}){const s=fo(),a=Zt(t),n=async()=>{a&&(await At.patchConversation(a,{is_archived:!1}),s.invalidateQueries({queryKey:["conversation",t]}),Fs.setState(o=>{const r=o.threads[a];r!=null&&(r.initialThreadData.isArchived=!1)}),Tu(s))};return e.jsxs("div",{className:"my-6 flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"px-3 text-center text-sm text-token-text-secondary",children:e.jsx(U,{...Ja.archivedConversationDescription})}),e.jsx("div",{children:e.jsx(It,{disabled:!a,onClick:n,icon:Cu,children:e.jsx(U,{...Ja.unarchiveButton})})})]})}const xg=function({clientThreadId:t,onCompletionFinished:s,onCreate:a,preRequestCompletion:n,hideHeader:o,hideMessages:r,hideFooter:c,hideToolsOverlay:l,messagesVerticalAlign:u="top",prependThreadChildren:m,renderEmptyState:d,prefetchSearch:h}){const g=no(),v=Fn(t),x=Jt(t),f=lt(t),w=go(t).isArchived;Bi(t),i.useEffect(()=>{x||(_t(t)?cn.addTiming("chatgpt.web.chatPage.renderNewConversation"):cn.addTiming("chatgpt.web.chatPage.renderExistingConversation"))},[t,x]);const M=lo(t,f),y=Nn(t,f),{setTargetedContent:S}=Un(),N=g?.includes(Fi),D=cu(),T=y>=2;Hn(T);const C=_t(t)&&!T&&js(v),R=_t(t)&&!M&&(js(v)||v?.kind===Je.GizmoTest),p=Io().id,B=Hi(t),j=B??p,H=!!B,G=Us(j),I=Ro()[j],b=du(t,v),F=Eo();Xo(y,t,f),i.useEffect(()=>{F||S(void 0)},[t,S,F,f]);const{caModal:Y,onRequestCompletion:te,onChangeItemInView:q,onChangeRating:ie,onRequestMoreCompletions:le}=uu({clientThreadId:t,currentModelId:j,defaultModelId:p,onCompletionFinished:s,onThreadCreated:a,preRequestCompletion:n}),{isUnauthenticated:Q,isLoading:he}=Pe(),we=Qo({clientThreadId:t,currentLeafId:f,handleRequestCompletion:te,prefetchSearchPromise:h});mu({clientThreadId:t,currentModelId:j});const Be=Re=>e.jsx(Qh,{scrollAnchorTopOffset:o?0:Mu,children:u==="bottom"?e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex-1"}),Re]}):Re});i.useEffect(()=>{document.title=b??"ChatGPT"},[b]);const ce=Te(t),fe=ct(),je=Ui(),ve=R&&!je&&!d&&!ce&&!G&&!fe,Ae=ve&&!he&&Q,Ee=ve&&!he&&!Q,Fe=th(Ae),Ce=nh(Ee),O=Ae&&Fe||Ee&&Ce,L=Bs(),V=hu(),{reset:W,streamingContext:Z,StreamingProvider:ae}=gu();i.useEffect(()=>{V&&(Z.setOnResetContext=()=>{W()})},[V,W,Z]);const ge=i.useRef(null),Se=i.useRef(null),oe=i.useMemo(()=>({threadContentScrollContainerElementRef:ge,footerRootContainerElementRef:Se}),[]);return e.jsx(pu,{clientThreadId:t,currentLeafId:f,children:e.jsxs(ae,{value:Z,children:[N&&e.jsx(tg,{}),e.jsx(fu,{children:b!=null&&e.jsx("title",{children:b})}),e.jsx(Oi.Provider,{value:te,children:e.jsxs(xu,{children:[e.jsxs(vu,{clientThreadId:t,currentModelConfig:I,className:"composer-parent flex h-full flex-col focus-visible:outline-0",children:[!r&&e.jsx(Su,{value:oe,children:e.jsx(ng,{ref:ge,children:!x&&!we?R?d??e.jsx(br,{clientThreadId:t,currentModelId:j,isModelLoaded:H,onRequestCompletion:te,enableV2Homepage:O,v2HomepageDisclaimer:O&&e.jsx(Is,{clientThreadId:t})}):T?Be(e.jsxs(e.Fragment,{children:[m,e.jsx(Kh,{onChangeItemInView:q,onRequestMoreCompletions:le,onChangeRating:ie,onRequestCompletion:te,clientThreadId:t,conversationLeafId:f,hideHeader:o},t)]})):null:null})}),e.jsx(ag,{ref:Se,children:w?e.jsx(sg,{clientThreadId:t}):e.jsxs("div",{children:[!O&&e.jsx(Qm,{clientThreadId:t,isNewThread:C,showPromptStarters:C||!M,currentModelId:j,onRequestCompletion:te}),!c&&e.jsx("div",{className:"relative w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",children:js(v)&&!O&&e.jsx("div",{className:"min-h-4",children:e.jsx(Is,{clientThreadId:t})})})]})})]}),!l&&e.jsxs("div",{className:"group absolute bottom-2 end-2 z-20 flex flex-col gap-1 md:flex lg:bottom-3 lg:end-3",children:[D?e.jsxs(e.Fragment,{children:[e.jsx(eg,{}),!1]}):null,e.jsx(bu,{})]}),Y,e.jsx(yu,{clientThreadId:t,isStaticSharedThread:!1,isDynamicSharedThread:L}),e.jsx(wu,{}),e.jsx(ju,{conversationId:t,currentModelId:j,isActiveWindow:!je})]})})]})})},ng=pe.div`grow flex-1 overflow-hidden @container/thread`,ag=pe.div`md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent w-full`;function og({clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:n,v2HomepageDisclaimer:o}){return e.jsx(dr,{clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:n,v2HomepageDisclaimer:o})}const rg=Oe(()=>ze(()=>import("./j2by1t70zmq6qdp0.js"),__vite__mapDeps([49,1,50,4,2,3,5,14])).then(t=>t.ChatScreenContentModals));function ig({disableEmptyState:t,fullWidth:s,renderEmptyState:a}){const{clientThreadId:n,currentModelId:o,conversationLeafId:r,isCompanionWindow:c,isEmbeddedInFocusedView:l,onChangeItemInView:u,onChangeRating:m,onRequestCompletion:d,onRequestMoreCompletions:h,isModelLoaded:g,prefetchSearch:v}=i.useContext(sr),x=Nn(n,r),f=Ze(n,ho.getScrollToMessageId),A={clientThreadId:n,conversationLeafId:r,currentModelId:o,onChangeItemInView:u,onChangeRating:m,onRequestMoreCompletions:h,onRequestCompletion:d,showAvatar:!1},w=Jt(n),M=Qo({clientThreadId:n,currentLeafId:r,handleRequestCompletion:d,prefetchSearchPromise:v}),y=w||M||t,S=Bs(),{initialConversationTurns:N,continuedConversationTurns:D}=_u(x,S),{canUseNewHomepage:T,showEmptyState:C}=hr({clientThreadId:n,currentLeafId:r}),R=x>=2;Hn(R);const{setTargetedContent:E}=Un(),p=Us(o);Xo(x,n,r),i.useEffect(()=>{l||E(void 0)},[n,E,l]);const B=Ko(n,r);if(C){if(a!=null)return a();if(T&&!y){const j=c?null:e.jsx("div",{className:"text-center text-xs text-token-text-secondary",children:e.jsx(Is,{clientThreadId:n})});return e.jsx(og,{clientThreadId:n,currentModelId:o,isModelLoaded:g,onRequestCompletion:d,v2HomepageDisclaimer:j})}else if(!T&&!y)return e.jsx(br,{clientThreadId:n,currentModelId:o,isModelLoaded:g,onRequestCompletion:d,enableV2Homepage:!p,v2HomepageDisclaimer:e.jsx(Is,{clientThreadId:n})})}return e.jsxs(e.Fragment,{children:[S&&e.jsx(ku,{}),S&&D.length===0&&e.jsx(Nu,{}),e.jsx(An,{children:e.jsxs(i.Suspense,{fallback:null,children:[e.jsx(Au,{}),N.length>0&&e.jsx("ol",{className:Ue.conversationTurnList,children:N.map(({turnIndex:j,isFinalTurn:H})=>e.jsx("li",{className:P(Ue.conversationTurnWrapper,s&&"w-full"),children:i.createElement(jn,{...A,key:`${n}-${j}`,turnIndex:j,isFinalTurn:H,scrollToMessageId:f,shouldShowDateHeader:B(j)})},j))}),S&&e.jsx(Eu,{}),e.jsx("ol",{className:Ue.conversationTurnList,children:D.map(({turnIndex:j,isFinalTurn:H})=>e.jsx("li",{className:P(Ue.conversationTurnWrapper,s&&"w-full"),children:i.createElement(jn,{...A,key:`${n}-${j}`,turnIndex:j,isFinalTurn:H,scrollToMessageId:f,shouldShowDateHeader:B(j)})},j))})]})}),e.jsx(rg,{}),x>0&&e.jsx(Ru,{})]})}function vg({renderEmptyState:t}){return e.jsx(ig,{renderEmptyState:t})}function Sg(){const t=xe(),{clientThreadId:s,isLoggedInUser:a,onNewThread:n}=i.useContext(sr),o=Te(s),r=ts(o),c=Le();return e.jsxs(Iu,{leading:!0,type:"primary",className:Ue.header,children:[e.jsxs("div",{className:Ue.headerLeading,children:[!c&&r&&e.jsx(tr,{clientThreadId:s,hideNewChat:!0}),a&&e.jsx(Pu,{}),!r&&e.jsx(Qt,{label:t.formatMessage(eo.newChat),className:"hidden @lg/thread:inline-flex",children:e.jsx(Ts,{to:"/",className:Ue.newThread,onClick:l=>{n?(l.preventDefault(),n()):de.logEvent("chatgpt_web_thread_tap_new_thread")},tabIndex:0,children:e.jsx(Du,{className:P(Ue.sidebarIcon),icon:e.jsx(Fo,{}),tabIndex:-1,label:t.formatMessage(eo.newChat),style:{viewTransitionName:"var(--vt_new_chat_thread)"}})})}),e.jsx("div",{className:Ue.threadDropdown,children:e.jsx(fr,{clientThreadId:s})})]}),e.jsx("div",{className:Ue.headerTrailing,children:e.jsx(An,{children:e.jsx(vr,{clientThreadId:s})})})]})}const eo=De({newChat:{id:"rnCpM4",defaultMessage:"New Chat"}});export{Sg as C,La as G,lr as P,fr as T,Qh as W,xg as a,Sr as b,vg as c,Qm as d,jn as e,fg as f,hr as u};
//# sourceMappingURL=dy5wvkz47nxj2h1d.js.map
