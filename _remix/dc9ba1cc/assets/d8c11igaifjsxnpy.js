const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/g6va54f1qx14it8i.js","assets/cuau6nn9sjz8q54j.js","assets/lklglvrzltpv3f05.js","assets/root-ksnlquoy.css","assets/ebwx7yj0baonheef.js","assets/conversation-small-fwmnexun.css","assets/f3wqh5wbtzeabanv.js","assets/ja5tnxc24ymkpoik.js","assets/fzrn137102spawew.js","assets/e9lafxuzyeh4418f.js","assets/j9pn3dpqp3dnyeg5.js","assets/h7k9pb8k20kmalm6.js","assets/1lmhhk7yvulb1cj2.js","assets/obp2l1zwhgkyczrv.js","assets/f53shbhh201ss69o.js","assets/mzkxlhrlmxhntkvn.js","assets/kce41gtfqn7bq1j9.js","assets/hj5c18xh6xkz43e7.js","assets/eoh3qcov0jni3wda.js","assets/gq1oquoigcb35b69.js","assets/c1xhqq4r4ezy9z4y.js","assets/c4bxzbp1808foto4.js","assets/dqzga3jv5dl3on3n.js","assets/ewq0jnwu0xqezvkp.js","assets/dy5wvkz47nxj2h1d.js","assets/lif4od4ycl7gaybt.js","assets/n45otc1227s1uah5.js","assets/k362shm1u5t3zzyg.js","assets/6tiysfziu7tlaxu0.js","assets/cy4w1u60daz8y90f.js","assets/ckatlww9jl157xyn.js","assets/kenkl4u1bw5u6v18.js","assets/gttzahksaywpss4n.js","assets/o95fbtn2np60y8bb.js","assets/dzxrw741owgjo6eg.js","assets/cyqh5pewhk34cwzb.js","assets/ijwsqx5b9y4rlvqu.js","assets/d197qvlrpr6mqktk.js","assets/bs35jqbzk0kwq9tl.js","assets/lr2wtvbk3k0uolp8.js","assets/cfzpgcozwwb8egba.js","assets/k3hicc8rbwef28my.js","assets/n4nvecrtmzmi2mhb.js","assets/n9ttxlghns6x1lpo.js","assets/bhwe5u1k8dt5i1uc.js","assets/d8epg2zruc86plwg.js","assets/iz4zm46l9uhis5vi.js","assets/btagl6w1gub4aw61.js"])))=>i.map(i=>d[i]);
import{v as ce,R as hs,r as u,j as e,c as $,a as xs,M as g,e as fe,ad as tt,ac as vs,X as it,f as at}from"./lklglvrzltpv3f05.js";import{bH as nt,bG as rt,j3 as js,bJ as ys,ix as Be,ba as ot,j4 as lt,hW as bs,j5 as Ms,co as ws,j6 as Ts,U as me,hG as B,b as Ps,ca as Me,cb as Ss,g1 as De,eS as ct,eH as dt,d6 as ut,dt as Re,aW as A,eI as we,eJ as ie,eU as xe,eQ as ve,eL as We,ii as ks,j7 as mt,b7 as Cs,ij as Is,ik as ft,j8 as gt,f4 as ae,eK as pt,j9 as Ue,cy as ht,f2 as xt,d1 as vt,cY as Ns,eZ as jt,eY as yt,g5 as bt,hO as _s,ja as Mt,bD as wt,hP as Gs,hM as As,iO as Tt,jb as Pt,fI as St,fs as kt,iP as Ct,bC as Ee,iQ as It,hL as Nt,jc as as,hU as Ie,hV as _t,dv as ns,d4 as Ls,jd as Gt,je as At,dA as Lt,hR as zt,d5 as Rt,f8 as Ut,jf as rs,a$ as Et,T as Ft,hu as Ot,jg as Bt,o as Dt,f5 as Wt,jh as Ht,bv as $t,g0 as qt,hg as os,hJ as Vt,hK as Qt,aS as Kt,ji as Yt,jj as Jt,k as Xt,h2 as ls,jk as cs,jl as Zt,jm as ei,fU as ds,cl as si}from"./ebwx7yj0baonheef.js";import{cy as He,dO as oe,s as H,v as I,ah as ne,J as $e,b0 as qe,D as Fe,eo as ti,cI as Ve,cJ as Qe,a4 as zs,be as ii,aR as Ke,aS as Ye,bh as Je,dV as Rs,F as re,bc as W,aU as Xe,u as Te,bL as Ze,bo as je,f as de,e1 as ai,em as ni,av as Us,as as le,gA as ri,o as Pe,cz as Es,bR as K,cg as es,b2 as Fs,aZ as Ne,P as Os,h as Bs,q as ye,bf as oi,bd as Ds,b3 as li,d_ as Ws,dR as ci,d5 as be,dY as di,M as ui,V as mi,bC as us,bD as ms,gd as fi,dl as gi,dm as pi,fG as hi,fl as xi}from"./cuau6nn9sjz8q54j.js";import{i as vi,M as Hs,A as ue,G as ji,a as yi,b as fs,s as bi,S as Mi,c as wi,g as Ti,d as Pi}from"./hj5c18xh6xkz43e7.js";import{a as $s}from"./dy5wvkz47nxj2h1d.js";import{a as qs}from"./dqzga3jv5dl3on3n.js";import{C as Vs}from"./cy4w1u60daz8y90f.js";import{i as Oe}from"./kenkl4u1bw5u6v18.js";import{x as Si}from"./gttzahksaywpss4n.js";import{S as Qs}from"./eoh3qcov0jni3wda.js";import{S as ki}from"./f3wqh5wbtzeabanv.js";import{G as Ci}from"./n4nvecrtmzmi2mhb.js";import{F as X,a as Z,b as _e,c as Ii,G as Ni}from"./kce41gtfqn7bq1j9.js";import{G as _i}from"./n9ttxlghns6x1lpo.js";import{S as Gi}from"./bhwe5u1k8dt5i1uc.js";import{CanvasFocusedViewManager as Ai}from"./iz4zm46l9uhis5vi.js";import{G as Li}from"./6tiysfziu7tlaxu0.js";function zi(s,t){const i=I.getThreadCurrentLeafId(s),n=I.getTree(s),a=[];let r=n.getNodeByIdOrMessageId(i);for(;r!=null&&(t==null||r.id!==t);)a.unshift(r.message),r=r.parentId!==""?n.getNodeByIdOrMessageId(r.parentId):void 0;return a}function Ri(s){return s.filter(n=>n.recipient==="gizmo_editor.update_behavior").flatMap(n=>n.content.content_type==="text"?n.content.parts:n.content.content_type==="code"?[n.content.text]:[]).map(n=>JSON.parse(n)).reduce((n,a)=>({...n,...a}),{})}async function Ui(s){let t;for(const i of s)if(i.author.name==="gizmo_editor.generate_profile_pic"){const n=ii.getImageAssetPointers(i);n.length>0&&(t=n.at(-1))}if(t!=null){const i=ot(t.asset_pointer),n=await $e.getFileDownloadLink(i);if(n.status===qe.Success)return{id:i,permalink:n.download_url}}}async function Ei(s,t,i,n){const a=zi(t,n),r=Ri(a);let o=await Ui(a);if(Oe(r)&&o==null)return;const{name:d,context:f,description:l,profile_pic_file_id:w,prompt_starters:T}=r;if(w!=null)try{const m=await $e.getFileDownloadLink(w,s.id);m.status===qe.Success&&(o={id:w,permalink:m.download_url})}catch(m){Fe.addError(new Error("Error while retrieving profile pic in update",{cause:m})),i.warning("Something went wrong updating your GPT's profile picture.",{duration:3})}const c={name:typeof d=="string"?d:void 0,description:typeof l=="string"?l:void 0,instructions:typeof f=="string"?f:void 0,promptStarters:Array.isArray(T)?T:void 0,profilePictureId:o?.id,profilePictureUrl:o?.permalink};return ti(c,m=>m!=null)}function Fi(s){const t=new Set;for(const f of s.tools)t.add(f.type);const i=s.name??"",n=s.description??"",a=s.instructions??"",r=Array.from(t).join(","),o=i===""&&n===""&&a==="",d=s.profilePictureUrl!=null;return o?`The GPT you are about to has the following abilities: ${r}.`:`This is the GPT's current set of fields:

name: ${i}

description: ${n}

context: ${a}

abilities: ${r}

${d?"The GPT has a profile picture.":"This GPT does not have a profile picture. You must generate a profile picture when you next update your behavior."}
`}function Ks(s,t,i,n){const a=i.current,r=n.current;if(He(a,r))return;const o={};a.name!==r?.name&&(o.name=a.name),(a.description??"")!==(r?.description??"")&&(o.description=a.description??""),a.instructions!==(r?.instructions??"")&&(o.context=a.instructions??"");const d=new Set(r?.files?.map(c=>c.file_id)??[]),f=new Set(a.files?.map(c=>c.file_id)??[]),l=(a.files??[]).filter(c=>!d.has(c.file_id)),w=(r?.files??[]).filter(c=>!f.has(c.file_id));if(Oe(o)&&l.length===0&&w.length===0)return;const T=[];if(!Oe(o)){const c=`Explicitly update the GPT's behavior to the following exact fields:

    ${JSON.stringify(o,null,2)}

    "Do not call update_behavior yet. Instead, use these updated fields as the GPT's current behavior, and in the next call to update_behavior, incorporate these changes."
    `;T.push(oe.getTextAsMessage(c,H.System))}w.length>0&&T.push(oe.getTextAsMessage(`The user has removed the following files from the GPT. You can no longer reference these files: ${w.map(c=>c.file_id).join(", ")}`,H.System)),l.length>0&&T.push(oe.getTextAsMessage(`The user is adding these files to the GPT. The GPT may reference these files. The file IDs are: ${l.map(c=>c.file_id).join(", ")}`,H.System,{attachments:l.map(c=>({id:c.file_id,name:c.name,size:c.size}))})),T.length>0&&I.updateTree(s,c=>{let m=c.getNodeByIdOrMessageId(t).parentId;for(const x of T){const h=ce();c.insertNodeBefore(t,{id:h,children:[],parentId:m,message:x,metadata:{isClientCreatedSystemMessage:!0}}),m=h}})}function Oi(s,t,i){if(i.length===0)return;const n=ce(),a=`The user is uploading files in their next message. If you need to reference these in calls to update_behavior, you will use the following File ID(s), in order: ${i.map(r=>`"${r.fileId}"`).join(", ")}`;I.updateTree(s,r=>{const o=r.getNodeByIdOrMessageId(t).parentId;r.insertNodeBefore(t,{id:n,children:[],parentId:o,message:oe.getTextAsMessage(a,H.System),metadata:{isClientCreatedSystemMessage:!0}})})}function Bi(s,t){const i="Remember, you should be calling either update_behavior or generate_profile_pic after most messages from the user. Your personality should be neutral and separate from the GPT you are creating.",n=I.getThreadCurrentLeafId(s),a=I.getTree(s);let r=a.getNodeByIdOrMessageId(n);for(;r!=null&&r.message.author.role!==H.User;){if(r.message.content.content_type==="text"&&r.message.content.parts[0]===i)return;r=r.parentId!==""?a.getNodeByIdOrMessageId(r.parentId):void 0}I.updateTree(s,o=>{const d=o.getNodeByIdOrMessageId(t).parentId;o.insertNodeBefore(t,{id:ce(),children:[],parentId:d,message:oe.getTextAsMessage(i,H.System,{exclude_after_next_user_message:!0}),metadata:{isClientCreatedSystemMessage:!0}})})}function Di(s,t,i){I.initThread(s,{kind:ne.GizmoMagicCreate,gizmo_id:void 0,behavior_overrides:i});const a=nt().id,r=rt(s)??a,o=js({clientThreadId:s,onCompletionFinished:t});return async(f,l,w)=>{if(w.length===0)return;const T=new ys;let c=I.getThreadCurrentLeafId(s);for(const S of w){const j=ce();I.updateTree(s,N=>{N.addNodeToEnd(c,{id:j,children:[],parentId:c,message:oe.getTextAsMessage(S,H.System),metadata:{isClientCreatedSystemMessage:!0}})}),I.setThreadCurrentLeafId(s,j),c=j}const m=c;Ks(s,m,f,l);const x={conversationMode:{kind:ne.GizmoMagicCreate,gizmo_id:f.current.id,behavior_overrides:i}},h=await Ve(),[b,k]=await Promise.all([Be.getEnforcementToken(h),Qe.getEnforcementToken(h)]);o({model:r,completionType:zs.Next,parentNodeId:m,metadata:{},focusOnNewCompletion:!0,chatReq:h,turnstileToken:b,proofToken:k,preflightTime:0,completionMetadata:x,turnTracker:T})}}const Wi="Generate a new profile picture for this GPT using gizmo_editor generate_profile_pic. Do not prompt the user for any clarification. Do not send extra text outside of the tool function call. DO NOT CALL update_behavior or otherwise update GPT behavior in your response.",Hi=Ke(()=>Ye(()=>import("./g6va54f1qx14it8i.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])).then(s=>s.DebugConversationSidebar));function $i(s,t){u.useEffect(()=>{const i=I.getTree(s);if(i.findNode(o=>o.message.author.role===H.User||o.metadata?.isClientCreatedSystemMessage===!0)||(I.deleteNodesByFilter(s,o=>o.metadata?.isPlaceholderTemplateAssistantWelcomeMessage===!0),t==null||t.length===0))return;const a=I.getThreadCurrentLeafId(s);if(!i.hasNodeOrMessageId(a))return;const r=ce();I.updateTree(s,o=>{o.addNode(r,t,a,H.Assistant,{isPlaceholderTemplateAssistantWelcomeMessage:!0})}),I.setThreadCurrentLeafId(s,r)},[s,t])}function qi(s,t,i){Ps(s,{kind:ne.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:i}),u.useEffect(()=>{I.updateConversationMode(s,{kind:ne.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:i})},[s,t.id,i]);const[n]=u.useState(()=>{const a=t.id==null,r=t.id!=null&&t.name!==""&&t.description!=null&&t.instructions!==""&&t.profilePictureUrl!=null;return a?`Hi! I'll help you build a new GPT. You can say something like, "make a creative who helps generate visuals for new products" or "make a software engineer who helps format my code."

What would you like to make?`:r?`Welcome back! Is there anything ${t.name} should be doing better? Anything you'd like to change?`:"You're back! Let's continue where we left off..."});$i(s,n)}function Vi({gizmoEditorData:s,updateGizmo:t,clientThreadId:i,completionCallbackResponse:n,gizmoEditorDataRef:a,magicMakerBehaviorOverrides:r,magicMakerConversationGizmoEditorDataRef:o,requireGizmoId:d}){const f=u.useMemo(()=>({gizmoEditorData:s,gizmoId:s.id,mode:"magic",behaviorOverrides:r,getGizmoId:d}),[d,s,r]),l=lt(m=>m.files.filter(x=>x.status===B.Ready&&x.gizmoId!=null)),w=u.useCallback((m,x)=>{Oi(m,x,l),Ks(m,x,a,o),Bi(m,x),t(h=>({...h,files:[...h.files??[],...Je(l.map(b=>b.fileId!=null&&{file_id:b.fileId,name:b.file.name,size:b.file.size,type:bs(b.file),last_modified:b.file.lastModified,file_size_tokens:b.fileSpec?.fileTokenSize}))]})),o.current=Ms(a.current)},[a,o,l,t]),T=ws(m=>m.activeSidebar),c=Rs();return e.jsx(Ts.Provider,{value:f,children:e.jsxs("div",{className:"relative flex h-full grow overflow-auto",children:[e.jsx("div",{className:"grow",children:c?e.jsx("div",{className:"contents",style:{"--screen-height-override":"100%"},children:e.jsx(qs,{clientThreadId:i,preRequestCompletion:w,onCompletionFinished:n,children:e.jsx(Vs,{hideHeader:!0,embedded:!0})})}):e.jsx($s,{clientThreadId:i,onCompletionFinished:n,preRequestCompletion:w,hideHeader:!0,prependThreadChildren:e.jsx("div",{className:"h-8"})})}),T==="debug"&&e.jsx(Hi,{clientThreadId:i,slideOver:!1,onClose:()=>me.toggleActiveSidebar("debug"),isOpen:!0})]})})}const Qi=hs.memo(Vi);function Ki({gizmo:s,updateGizmo:t,publishedGizmo:i,promoteGizmo:n,appealGizmo:a,setAppealState:r,showActionsModal:o,shareOnly:d,onClose:f}){const[l,w]=u.useState({type:"privacy"});return l.type==="privacy"?e.jsx(Ji,{gizmo:s,updateGizmo:t,publishedGizmo:i,promoteGizmo:n,appealGizmo:a,setAppealState:r,setStep:w,showActionsModal:o,shareOnly:d,onClose:f}):e.jsx(Xi,{publishedGizmo:l.publishedGizmo,onClose:f})}function Yi(s){return s?A.Workspace:A.Link}function Ji({gizmo:s,publishedGizmo:t,updateGizmo:i,promoteGizmo:n,appealGizmo:a,setAppealState:r,setStep:o,showActionsModal:d,shareOnly:f,onClose:l}){const[w,T]=u.useState(!1),c=Me(Ss.isBusinessWorkspace),m=$(),x=re(),[h,b]=u.useState(De(s)?Yi(!!c):s.sharingRecipient),k=xs(),S=vi(h,s.sharingTargets),{data:j,isLoading:N}=ct(),y=dt(),[p,C]=u.useState(t!=null&&t.gizmo.display.categories.length>0?y.data?.categories.find(M=>M.id===t.gizmo.display.categories[0])?.id:void 0);u.useEffect(()=>{C(t?.gizmo.display.categories[0])},[t?.gizmo.display.categories]);const[_,U]=u.useState(void 0),G=u.useRef(ut((M,E)=>Re.generateCategory(M,E),1e3)),F=j?.is_verified?void 0:m.formatMessage({id:"qUMu4e",defaultMessage:"To publish your GPTs to the Explore GPTs page, set up your builder profile in the user settings page."});h===A.Marketplace&&F!=null&&!N&&b(A.Link);const q=c&&!s.sharingTargets?.some(M=>M.recipient===A.Link),R=we(s,h,p),O=R.includes(ie.MissingPublicActionPrivacyPolicyURL),V=s.tools.find(M=>M.type===W.JIT_PLUGIN&&!M.metadata.privacy_policy_url),ge=Me(M=>M.currentWorkspace),Y=Xe();u.useEffect(()=>{let M=!0;return(async()=>{try{if(p!=null)return;const E=await G.current(s.name,s.instructions);M&&p==null&&(E?C(E.id):U(!0))}catch{M&&p==null&&U(!0)}})(),()=>{M=!1}},[s.instructions,s.name,Y,p]);const{value:Q}=Te("4226692983");return e.jsx(Ze,{type:"success",isOpen:!0,onClose:l,title:e.jsx(g,{id:"9viumf",defaultMessage:"Share GPT"}),showCloseButton:!0,primaryButton:S?e.jsx(je,{color:"primary",disabled:R.length>0,loading:w,onClick:async()=>{try{if(T(!0),f){if(!t?.gizmo.id){x.danger(m.formatMessage({id:"QYVEx8",defaultMessage:"Error sharing GPT"}));return}const M=await Re.shareGizmo(t.gizmo.id,p?{sharing:xe(h,[],ve),categories:[p]}:{sharing:xe(h,[],ve)});M.error?(x.warning(m.formatMessage({id:"tmIKmp",defaultMessage:"Unable to share GPT"})),i({sharingTargets:M.sharing_targets}),r({gizmoId:t.gizmo.id,sharingRecipient:h,categories:t.gizmo.display.categories,moderationType:Hs.PublishBlocked,sharingTargets:M.sharing_targets,showModal:ue.AppealAvailable})):(k.setQueryData(["gizmo",{gizmoId:t.gizmo.id},{draft:!1}],E=>M.resource),i(E=>({...E,sharingRecipient:h})),x.success(m.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),l())}else{const M=await n({recipient:h,subjects:xe(h,[],ve)},p);M?(o({type:"published",publishedGizmo:M}),i(E=>({...E,id:M.gizmo.id,sharingRecipient:h})),M.gizmo.live_version!=null&&i({liveVersion:M.gizmo.live_version}),x.success(m.formatMessage({id:"R5zko1",defaultMessage:"GPT published"}),{testId:"gpt-published-toast"})):(x.warning(m.formatMessage({id:"uf7WYw",defaultMessage:"Unable to publish GPT"})),l())}}finally{T(!1)}},"data-testid":"save-gizmo-button",children:e.jsx(g,{id:"SW4DG4",defaultMessage:"Save"})}):Q?e.jsx(e.Fragment,{children:e.jsx(je,{color:"primary",onClick:async()=>{await a(h,p)},children:e.jsx(g,{id:"bBmLUr",defaultMessage:"Appeal"})})}):null,secondaryButton:t?e.jsx(je,{color:"secondary",onClick:M=>We(t,x,M,m.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:e.jsx(g,{id:"wvL15a",defaultMessage:"Copy link"})}):null,children:e.jsxs("div",{className:"mx-[-16px] flex flex-col gap-3 text-sm",children:[e.jsx("div",{className:"space-y-1.5",children:e.jsxs(ks,{value:h,onValueChange:M=>b(M),children:[s.sharingTargets&&s.sharingTargets.map((M,E)=>e.jsx(Ge,{value:M.recipient,disabled:M.recipient===A.Marketplace&&F!=null,tooltipText:M.recipient===A.Marketplace?F??m.formatMessage({id:"0Rcb4e",defaultMessage:"Your GPT will appear in the Explore GPTs page"}):void 0,shareLevel:M.recipient},E)),q&&e.jsxs(e.Fragment,{children:[e.jsx(Ge,{value:A.Link,disabled:!0,tooltipText:m.formatMessage(gs.workspaceDisabledHint),shareLevel:A.Link,workspaceName:ge?.name}),e.jsx(Ge,{value:A.Link,disabled:!0,tooltipText:m.formatMessage(gs.workspaceDisabledHint),shareLevel:A.Marketplace,workspaceName:ge?.name})]})]})}),O&&e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(g,{id:"/iw1Iv",defaultMessage:"Public actions require valid privacy policy URLs. Click <fixlink>here</fixlink> to update.",values:{fixlink:M=>e.jsx("button",{onClick:()=>{d(V?.metadata.action_id)},className:"underline",children:M})}})}),h!==A.Private&&e.jsx(ji,{gizmo:s,category:p,categories:h===A.Marketplace?y.data?.categories??[]:void 0,onCategoryChange:h===A.Marketplace?M=>C(M.id):void 0}),h===A.Marketplace&&(_?e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(g,{id:"tpC3ui",defaultMessage:"There was an error updating the list of categories"})}):null),!S&&Q&&e.jsx("div",{className:"flex items-center justify-between text-sm text-token-text-secondary",children:e.jsx(g,{id:"jLCMMV",defaultMessage:"Because this GPT previously may have violated our policies, you will have to submit an appeal to make it available at this level."})})]})})}function Xi({publishedGizmo:s,onClose:t}){const i=mt(s),n=$(),a=re();return e.jsx(Ze,{type:"success",isOpen:!0,onClose:t,title:e.jsx(g,{id:"rCRRmx",defaultMessage:"Settings Saved"}),showCloseButton:!0,primaryButton:e.jsx(je,{color:"primary",as:"link",to:i,children:e.jsx(g,{id:"lyZz44",defaultMessage:"View GPT"})}),children:e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex gap-1 rounded bg-token-main-surface-secondary px-2 py-1",children:[e.jsx("div",{className:"line-clamp-1 text-ellipsis break-all",children:i}),e.jsx("button",{onClick:r=>{We(s,a,r,n.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"}))},className:"text-token-text-secondary transition hover:text-token-text-primary","data-testid":"copy-saved-gpt-url-button",children:e.jsx(Cs,{className:"icon-sm"})})]})})})}const gs=de({workspaceDisabledHint:{id:"gizmo.workspaceDisabledHint",defaultMessage:"Your workspace administrator has disabled this setting"}});function Ge({shareLevel:s,workspaceName:t,value:i,disabled:n=!1,tooltipText:a}){const r=u.useId();return e.jsx(ai,{disabled:a==null,label:a,side:"top",children:e.jsxs(Is,{id:r,value:i,disabled:n,className:"flex h-14 w-full cursor-pointer flex-row items-center justify-between gap-2 rounded-md px-3 py-4 font-semibold hover:bg-token-main-surface-secondary",children:[e.jsx("label",{htmlFor:r,className:"flex cursor-pointer items-center gap-1",children:e.jsx(yi,{shareLevel:s,workspaceName:t??"",hasInviteSharing:!1})}),e.jsx(ft,{children:e.jsx(ni,{className:"icon-lg mr-1"})})]})})}function Ys(s){window.history.length>1?s(-1):s(gt())}function Zi({gizmo:s,publishedGizmo:t,isUpsertLoading:i,isPromoteLoading:n,isUploadingProfilePic:a,isGeneratingProfilePic:r,updateGizmo:o,promoteGizmo:d,appealGizmo:f,setAppealState:l,showActionsModal:w}){const T=Pe(),c=s!=null?we(s):[];(s==null||n||i)&&c.push(ie.Loading),a&&c.push(ie.UploadingProfilePic),r&&c.push(ie.GeneratingProfilePic);const m=De(s),[x,h]=u.useState(!1),[b,k]=u.useState(!1),S=s.sharingRecipient?fs[s.sharingRecipient]:fs.private,j=n||i;return e.jsxs(e.Fragment,{children:[m?e.jsx(ae,{color:"primary",onClick:()=>h("promote"),loading:i,disabled:j||s.id===void 0||c.length>0,tooltip:c.length>0?c.map(Ue).join(`
`):void 0,testId:"gizmo-editor-create-gpt-button",children:e.jsx(g,{id:"svUGIb",defaultMessage:"Create"})}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{color:"secondary",loading:n||!t,disabled:j,icon:S,onClick:()=>h("share"),children:e.jsx(g,{id:"aXKW4G",defaultMessage:"Share"})}),e.jsx(ae,{color:"primary",onClick:async()=>{let N=s.sharing.subjects.map(bi);const y=pt(s.sharing.subjects);N=xe(s.sharing.recipient,N,y?.capabilities??ve),await d({recipient:s.sharing.recipient,subjects:N},t?.gizmo.display.categories[0])&&k(!0)},loading:i||!t,disabled:j||c.length>0,tooltip:c.length>0?c.map(Ue).join(`
`):void 0,children:e.jsx(g,{id:"84QVoj",defaultMessage:"Update"})})]}),x&&(T?.getWorkspaceId()==null?e.jsx(Ki,{gizmo:s,publishedGizmo:t,promoteGizmo:d,appealGizmo:f,setAppealState:l,showActionsModal:w,updateGizmo:o,shareOnly:x==="share",onClose:()=>h(!1)}):e.jsx(Mi,{gizmo:s,publishedGizmo:t,promoteGizmo:d,appealGizmo:f,setAppealState:l,showActionsModal:w,updateGizmo:o,onClose:()=>h(!1),shareOnly:x==="share"})),b&&e.jsx(wi,{publishedGizmo:t,sharing:t.gizmo.sharing,onClose:()=>k(!1),workspaceName:T?.data.name??""})]})}function ea({gizmoEditorData:s,publishedGizmo:t,revertDraft:i}){const n=$(),a=re(),r=fe(),[o,d]=u.useState(!1),f=Xe(),{value:l}=Te("3645668434");return!f?.includes("debug")&&s?.id==null?null:e.jsxs(e.Fragment,{children:[e.jsxs(Es,{side:"top",contentAlign:"end",sideOffset:8,triggerButton:e.jsx(ae,{color:"ghost",icon:ht}),children:[t!=null&&e.jsxs(K.Item,{onClick:w=>{We(t,a,w)},children:[e.jsx(Qs,{className:"icon-sm"}),e.jsx(g,{...ee.copyLink})]}),i!=null&&e.jsxs(K.Item,{onClick:()=>{window.confirm(n.formatMessage(ee.revertConfirm))&&i()},children:[e.jsx(xt,{className:"icon-sm"}),e.jsx(g,{id:"W2blnV",defaultMessage:"Revert..."})]}),s?.id!=null&&l&&s.liveVersion>0&&e.jsxs(e.Fragment,{children:[e.jsxs(K.Item,{onClick:()=>{r(`/g/${s.id}/view`)},children:[e.jsx(Si,{className:"icon-sm"}),e.jsx(g,{id:"gizmo.versionHistory",defaultMessage:"Version History"})]}),e.jsxs(K.Item,{onClick:async()=>{const w=await Re.copyGizmo({gizmoId:s.id});w.gizmo.id&&r(`/gpts/editor/${w.gizmo.id}`)},children:[e.jsx(Cs,{className:"icon-sm"}),e.jsx(g,{id:"GizmoInformation.copyGizmoLabel",defaultMessage:"Duplicate GPT"})]})]}),s?.id!=null&&e.jsxs(K.Item,{color:"danger",onClick:()=>{d(!0)},children:[e.jsx(vt,{className:"icon-sm"}),e.jsx(g,{id:"tNrOLG",defaultMessage:"Delete GPT"})]}),f?.includes("debug")&&e.jsxs(e.Fragment,{children:[e.jsx(K.Separator,{}),e.jsxs(K.Item,{onClick:()=>{me.toggleActiveSidebar("debug")},children:[e.jsx(ki,{className:"icon-sm"}),"Debug (Internal only)"]})]})]}),o&&e.jsx(Ci,{gizmoId:s.id,onSuccess:()=>Ys(r),onClose:()=>{d(!1)}})]})}const he=Us.div`flex items-center gap-1`;function sa({gizmoEditorData:s}){const t=Me(i=>i.currentWorkspace?.name);switch(s.sharingRecipient){case A.Private:return e.jsxs(he,{children:[e.jsx(bt,{className:"icon-xs"}),e.jsx(g,{...ee.onlyMe})]});case A.Link:return e.jsxs(he,{children:[e.jsx(Qs,{className:"icon-xs"}),e.jsx(g,{...ee.anyoneWithLink})]});case A.Workspace:return e.jsxs(he,{children:[e.jsx(yt,{className:"icon-xs"}),t]});case A.Marketplace:return e.jsxs(he,{children:[e.jsx(jt,{className:"icon-xs"}),e.jsx(g,{...ee.public})]});default:return e.jsx("div",{})}}function ta({gizmoEditorData:s}){return e.jsxs("div",{className:"flex items-center gap-2",children:[s.profilePictureUrl!=null?e.jsx(Ns,{isFirstParty:!1,src:s.profilePictureUrl,className:"h-8 w-8"}):e.jsx("div",{className:"h-8 w-8 rounded-full border-2 border-dashed border-token-border-medium"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:s.name||e.jsx(g,{...ee.newGPT})}),e.jsx("div",{className:"text-xs text-token-text-secondary",children:De(s)?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-token-text-tertiary"}),e.jsx(g,{...ee.draft})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-brand-green"}),s.sharingRecipient===A.Marketplace?e.jsx(g,{...ee.published}):e.jsx(g,{id:"gizmoEditorHeader.live",defaultMessage:"Live"})," · ",e.jsx(sa,{gizmoEditorData:s})]})})]})]})}function ia({gizmoEditorData:s,isUpsertLoading:t,isPromoteLoading:i,isUploadingProfilePic:n,isGeneratingProfilePic:a,publishedGizmo:r,updateGizmo:o,promoteGizmo:d,appealGizmo:f,setAppealState:l,revertDraft:w,draftMessage:T,className:c,hasUnpublishedChanges:m,showActionsModal:x}){const h=fe();return e.jsxs("div",{className:le("relative flex h-14 w-full items-center justify-between gap-2 border-b border-token-border-medium px-3",c),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{className:"cursor-pointer text-token-text-primary",onClick:()=>Ys(h),children:e.jsx(ri,{className:"icon-lg"})}),e.jsx(ta,{gizmoEditorData:s})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[T,e.jsx(ea,{gizmoEditorData:s,publishedGizmo:r,revertDraft:w}),e.jsx(Zi,{gizmo:s,publishedGizmo:r,isUpsertLoading:t,isPromoteLoading:i,isUploadingProfilePic:n,isGeneratingProfilePic:a,updateGizmo:o,promoteGizmo:d,appealGizmo:f,setAppealState:l,hasUnpublishedChanges:m,showActionsModal:x})]})]})}const ee=de({onlyMe:{id:"gizmo.onlyMe",defaultMessage:"Only me"},anyoneWithLink:{id:"gizmo.anyoneWithLink",defaultMessage:"Anyone with a link"},public:{id:"gizmo.public",defaultMessage:"Everyone"},newGPT:{id:"gizmo.newGPT",defaultMessage:"New GPT"},draft:{id:"gizmo.draft",defaultMessage:"Draft"},published:{id:"gizmo.published",defaultMessage:"Published"},revertConfirm:{id:"gizmo.revertConfirm",defaultMessage:"Are you sure you want to revert to the last saved version?"},copyLink:{id:"gizmo.copyLink",defaultMessage:"Copy link"}}),aa=512;function na(){return e.jsx("div",{className:"relative flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-token-border-medium",children:e.jsx(es,{className:"h-1/4 w-1/4"})})}function ra({gizmoEditorData:s,onFileChange:t,generateProfilePic:i,isGeneratingProfilePic:n,setIsGeneratingProfilePic:a}){const r=$(),o=re(),[d,f]=u.useState(void 0),l=u.useRef(t);u.useEffect(()=>{l.current=t});async function w(m){if(m.length>0){a(!1);const x=await Ct(m[0],aa),h=Ee(x);f({tempId:h,file:x,status:B.Uploading,progress:1,fileId:null,cdnUrl:null}),l.current("uploading"),It(h,x,r,o,Fs.ProfilePicture,{onFileCreated(b,k,S){f(j=>j!=="initial"&&j?.tempId===b&&j.status===B.Uploading?{...j,progress:10,fileId:k,cdnUrl:S}:j)},onFileUploadProgress(b,k){f(S=>S!=="initial"&&S?.tempId===b&&S.status===B.Uploading?{...S,progress:k}:S)},onFileUploaded(b,k,S){f(j=>j!=="initial"&&j?.tempId===b?(l.current(j),{...j,status:B.Ready,progress:100,fileSpec:{name:j.file.name,id:j.fileId,size:j.file.size,...S??{}}}):j)},onError(b){f(k=>{if(k!=="initial"&&k?.tempId===b){l.current(void 0);return}return k})}})}}const{open:T,getInputProps:c}=_s({disabled:!1,noClick:!0,onDropAccepted:w,onDropRejected:m=>Mt(m,r,o,wt.ProfilePicture),multiple:!0,maxSize:Gs,...As(Tt)});return e.jsxs("div",{className:"flex w-full items-center justify-center gap-4",children:[e.jsxs(Es,{sideOffset:8,triggerButton:e.jsx("button",{className:"h-20 w-20",children:n?e.jsx(na,{}):d!=null&&d!="initial"&&d.status!=B.Ready?e.jsxs("div",{className:"relative h-full w-full overflow-hidden rounded-full",children:[e.jsx(Pt,{file:d.file}),d.status===B.Uploading&&d.progress<90?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:e.jsx(St,{percentage:d.progress,className:"h-6 w-6"})}):null]}):s?.profilePictureUrl!=null&&s?.profilePictureUrl!==""?e.jsx(Ns,{isFirstParty:!1,src:s.profilePictureUrl}):e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-token-border-medium",children:e.jsx(kt,{className:"text-4xl"})})}),children:[e.jsx(K.Item,{onClick:T,children:e.jsx(g,{id:"ERQwXg",defaultMessage:"Upload Photo"})}),e.jsx(K.Item,{onClick:i,children:e.jsx(g,{id:"NXAog/",defaultMessage:"Use DALL·E"})})]}),e.jsx("input",{...c()})]})}function oa({gizmoEditorData:s,requireGizmoId:t,currentModelConfig:i,updateGizmo:n}){const a=$(),r=re(),[o,d]=u.useState(0),f=u.useRef(new Map),l=Nt(i,void 0),w=async p=>{Os.logEvent(Bs.uploadFile,{client:"web",eventSource:"mouse",intent:"gizmo"});const C=await t();p.length>0&&await Promise.all(p.map(_=>{const U=Ee(_);f.current.set(U,{tempId:U,gizmoId:C,file:_,status:B.Uploading,progress:1,fileId:null,cdnUrl:null}),_t(Ee(_),_,a,r,{kind:Fs.Gizmo,gizmoId:C},{onFileUploaded:(G,F,q,R)=>{const O=f.current.get(G);O==null||O.fileId==null||(n(V=>({...V,files:[...V.files??[],{file_id:O.fileId,name:O.file.name,size:O.file.size,type:R?.mimeType??bs(_),last_modified:O.file.lastModified,file_size_tokens:R?.fileTokenSize}]})),f.current.delete(G),d(V=>V+1))},onFileCreated:(G,F,q)=>{f.current.set(G,{tempId:G,gizmoId:C,file:_,status:B.Uploading,progress:1,...f.current.get(G),fileId:F,cdnUrl:q}),d(R=>R+1)},onFileUploadProgress:(G,F)=>{const q=f.current.get(G);q?.status===B.Uploading&&f.current.set(G,{...q,progress:F}),d(R=>R+1)},onError:G=>{f.current.delete(G)}},{usesRetrievalIndex:i!=null&&Ie(i,_.type,_.name)===Ne.Retrieval})}))},{getInputProps:T,open:c}=_s({disabled:!1,noClick:!0,onDropAccepted:w,multiple:!0,maxSize:Gs,maxFiles:10,...As(l)}),m=s?.files??[];function x(p){return e.jsx(ns,{onRemoveFileClick:()=>{f.current.delete(p.tempId),d(C=>C+1)},file:p.file,loadingPercentage:p.status===B.Uploading?p.progress:void 0},p.tempId)}function h(p){return e.jsx(ns,{file:p.name,fileId:p.file_id,onRemoveFileClick:()=>n(C=>({...C,files:C?.files?.filter(_=>_.file_id!==p.file_id)})),gizmoId:s?.id},p.file_id)}const b=Array.from(f.current.values()).filter(p=>m.every(C=>C.file_id!==p.fileId)),[k,S]=as(b,p=>i!=null&&Ie(i,p.file.type,p.file.name)===Ne.CodeInterpreter),[j,N]=as(m,p=>i!=null&&p.type!=null&&Ie(i,p.type,p.name)===Ne.CodeInterpreter),y=u.useRef(j.length);return u.useEffect(()=>{j.length>y.current&&n(p=>p.tools?.some(C=>C.type===W.PYTHON)?p:{...p,tools:[...p.tools??[],{type:W.PYTHON}]}),y.current=j.length},[j.length]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"rounded-lg text-token-text-tertiary",children:e.jsx(g,{...la.knowledgeWarning})}),S.length>0||N.length>0?e.jsxs("div",{className:"flex flex-wrap gap-2",children:[S.map(x),N.map(h)]}):null,k.length>0||j.length>0?e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs text-token-text-tertiary",children:e.jsx(g,{id:"i/QurZ",defaultMessage:"The following files are only available for Code Interpreter:"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[k.map(x),j.map(h)]})]}):null,e.jsx("div",{children:e.jsxs(ae,{onClick:c,children:[e.jsx("input",{...T()}),e.jsx(g,{id:"sr8Qp/",defaultMessage:"Upload files"})]})})]})}const la=de({knowledgeWarning:{id:"gizmo.knowledgeWarning",defaultMessage:"If you upload files under Knowledge, conversations with your GPT may include file contents. Files can be downloaded when Code Interpreter is enabled"}});function ca({placeholder:s,text:t,onChange:i,onClose:n}){return e.jsx(Ze,{className:"!max-h-[100vh] !max-w-[80vw]",type:"success",isOpen:!0,onClose:n,primaryButton:e.jsx(ae,{onClick:n,children:e.jsx(g,{id:"FeFVdS",defaultMessage:"Close"})}),children:e.jsx("textarea",{className:"h-[70vh] w-full resize-none rounded-lg bg-token-main-surface-primary dark:border-gray-700",value:t,onChange:a=>{i(a.target.value)},placeholder:s})})}const Ae=Us.div`text-sm text-red-500`;function da({children:s,collapsed:t,initial:i}){return e.jsx(tt,{initial:i,children:!t&&e.jsx(vs.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:s})})}function ua({gizmo:s,onShowActionsEditor:t,isDisabled:i}){const n=$(),a=re(),r=e.jsxs("div",{className:"space-y-1",children:[s?.tools?.map((o,d)=>o.type!==W.JIT_PLUGIN?null:e.jsxs("div",{children:[e.jsx(Ni,{isDisabled:i,actionTool:o,onShowActionsEditor:()=>t(o.metadata.domain)}),o.metadata.auth?.type==="oauth"&&e.jsx(Ut,{label:n.formatMessage(z.callbackUrlLabel),value:`https://chat.openai.com/aip/${o.metadata.action_id}/oauth/callback`,onCopied:()=>{a.success("Copied to clipboard",{duration:3})}})]},d)),(s?.tools?.filter(o=>o.type===W.JIT_PLUGIN)??[]).length>=rs?e.jsx("div",{children:n.formatMessage(z.maxActionsReached,{number:rs})}):e.jsx(ae,{disabled:i,onClick:()=>{t("Unknown domain")},className:"mt-2",children:e.jsx(g,{...z.createActionLabel})})]});return i?e.jsx(Ds,{side:"top",label:n.formatMessage(z.disabledCustomActionsTooltip),children:r}):r}function ma(s){return(s.files?.length??0)>0||s?.tools?.some(t=>t.type===W.JIT_PLUGIN)}const fa=12;function ga({gizmoEditorData:s,updateGizmo:t,currentModelConfig:i,generateProfilePic:n,setIsUploadingProfilePic:a,isGeneratingProfilePic:r,setIsGeneratingProfilePic:o,requireGizmoId:d,onShowActionsEditor:f}){const l=s?.tools??[],[w,T]=u.useState(!1),[c,m]=u.useState(!0),x=s?.promptStarters??[],h=[...x,...x.length<fa?[""]:[]],b=we(s),S=Pe()?.isWorkspaceAccount(),j=Ls(ye.WorkspaceGPTCustomActions),N=$();return e.jsxs("div",{className:"flex h-full grow flex-col overflow-y-auto px-2 pt-6 text-sm",children:[e.jsxs("div",{className:"grow",children:[e.jsxs(X,{children:[e.jsx(ra,{gizmoEditorData:s,generateProfilePic:n,isGeneratingProfilePic:r,setIsGeneratingProfilePic:o,onFileChange:async y=>{if(y!=null&&y!=="uploading"&&y.fileId!=null){const p=await $e.getFileDownloadLink(y.fileId);p.status===qe.Success&&t({profilePictureId:y.fileId!=null?y.fileId:void 0,profilePictureUrl:p.download_url})}else t({profilePictureId:void 0,profilePictureUrl:void 0});a(y==="uploading")}}),e.jsx(Z,{label:e.jsx(g,{id:"M4dZms",defaultMessage:"Name"}),description:e.jsx(g,{id:"+Gkni2",defaultMessage:"The name of your GPT"})}),e.jsx(_e,{type:"text",placeholder:N.formatMessage(z.gptNamePlaceholder),value:s?.name??"",onChange:y=>{t({name:y.target.value})},onBlurCapture:()=>t(y=>({...y,name:y.name.trim()})),"data-testid":"gizmo-name-input"}),b.includes(ie.GizmoNameTooLong)?e.jsx(Ae,{className:"mt-1",children:e.jsx(g,{...z.nameTooLong,values:{length:Gt}})}):null]}),e.jsxs(X,{className:"mt-4",children:[e.jsx(Z,{label:e.jsx(g,{id:"YDzNvf",defaultMessage:"Description"}),description:e.jsx(g,{id:"dpxCw8",defaultMessage:"Short description of what this GPT does"})}),e.jsx(_e,{type:"text",placeholder:N.formatMessage(z.descriptionPlaceholder),value:s?.description??"",onChange:y=>t({description:y.target.value}),onBlurCapture:()=>t(y=>({...y,description:y.description?.trim()??""})),"data-testid":"gizmo-description-input"}),b.includes(ie.GizmoDescriptionTooLong)?e.jsx(Ae,{className:"mt-1",children:e.jsx(g,{...z.descriptionTooLong,values:{length:At}})}):null]}),e.jsxs(X,{children:[e.jsx(Z,{label:e.jsx(g,{id:"2SO0RJ",defaultMessage:"Instructions"}),description:N.formatMessage(z.instructionsSubtitle)}),e.jsxs("div",{className:"relative",children:[e.jsx(Ii,{className:"resize-none",rows:8,value:s?.instructions,onChange:y=>t({instructions:y.target.value}),onBlurCapture:()=>t(y=>({...y,instructions:y.instructions.trim()})),placeholder:N.formatMessage(z.instructionsSubtitle),"data-testid":"gizmo-instructions-input"}),e.jsx("button",{className:"absolute bottom-3 right-2 text-token-text-tertiary",onClick:()=>T(!0),children:e.jsx(Lt,{className:"icon-sm"})})]}),b.includes(ie.GizmoInstructionsTooLong)?e.jsx(Ae,{className:"mt-1",children:e.jsx(g,{...z.instructionsTooLong,values:{length:zt}})}):null]}),e.jsxs(X,{children:[e.jsx(Z,{label:e.jsx(g,{id:"6rfYOX",defaultMessage:"Conversation starters"}),description:e.jsx(g,{id:"OSOIpd",defaultMessage:"Examples for the user to start the conversation"})}),e.jsx("div",{className:"flex flex-col gap-1",children:h.map((y,p)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(_e,{className:"rounded-r-none",value:y,type:"text",onChange:C=>{const _=C.target.value;t(U=>({...U,promptStarters:Je(p>=(x.length??0)?[...x??[],_]:x.map((G,F)=>F===p?_===""?void 0:_:G))}))}}),e.jsx("button",{className:"flex h-9 w-9 items-center justify-center rounded-lg rounded-l-none border border-l-0 border-token-border-medium",onClick:()=>t(C=>({...C,promptStarters:x.filter((_,U)=>U!==p)})),children:e.jsx(oi,{className:"icon-sm"})})]},p))})]}),e.jsxs(X,{children:[e.jsx(Z,{label:e.jsx(g,{id:"bwXSkU",defaultMessage:"Knowledge"}),description:N.formatMessage(z.knowledgeExplanation)}),e.jsx(oa,{gizmoEditorData:s,requireGizmoId:d,currentModelConfig:i,updateGizmo:t})]}),e.jsxs(X,{children:[e.jsx(Z,{label:e.jsx(g,{id:"mcAwDU",defaultMessage:"Capabilities"}),description:e.jsx(g,{id:"2exQT6",defaultMessage:"Functionality this GPT can use"})}),e.jsx(_i,{enabledTools:l,onEnabledToolsChange:y=>t({tools:y})})]}),e.jsxs(X,{children:[e.jsx(Z,{label:e.jsx(g,{id:"7r7v+u",defaultMessage:"Actions"}),description:e.jsx(g,{id:"fBln7I",defaultMessage:"APIs this GPT can use"})}),e.jsx(ua,{isDisabled:!!(S&&!j),gizmo:s,onShowActionsEditor:f})]}),!S&&ma(s)&&e.jsxs(X,{children:[e.jsx(Z,{label:e.jsx(g,{id:"R3KeU7",defaultMessage:"Additional Settings"}),collapsed:!!c,onClick:()=>{m(y=>!y)}}),e.jsx(da,{collapsed:c,initial:!1,children:e.jsx(Rt,{className:"mx-3 my-1",labelClassName:"w-full cursor-pointer",label:e.jsx(g,{id:"tZgwFW",defaultMessage:"Use conversation data in your GPT to improve our models"}),id:"improve-chatgpt",checked:!s.trainingDisabled,onChange:()=>{t({trainingDisabled:!s.trainingDisabled})}})})]})]}),w&&e.jsx(ca,{text:s.instructions??"",onChange:y=>{t({instructions:y})},onClose:()=>T(!1),placeholder:N.formatMessage(z.instructionsSubtitle)})]})}const z=de({nameTooLong:{id:"gizmo.nameTooLong",defaultMessage:"GPT names cannot be longer than {length} characters."},knowledgeExplanation:{id:"gizmo.knowledgeExplanation",defaultMessage:"Additional files for this GPT to reference."},descriptionTooLong:{id:"gizmo.descriptionTooLong",defaultMessage:"GPT descriptions cannot be longer than {length} characters."},instructionsTooLong:{id:"gizmo.instructionsTooLong",defaultMessage:"GPT instructions cannot be longer than {length} characters."},disabledCustomActionsTooltip:{id:"gizmo.disabledCustomActionsTooltip",defaultMessage:"Custom actions are disabled for your workspace. Contact your admin to enable them."},createActionLabel:{id:"gizmo.createActionLabel",defaultMessage:"Create new action"},maxActionsReached:{id:"gizmo.maxActionsReached",defaultMessage:"GPTs can have a maximum of {number} actions"},descriptionPlaceholder:{id:"gizmo.descriptionPlaceholder",defaultMessage:"Add a short description about what this GPT does"},instructionsSubtitle:{id:"gizmo.instructionsSubtitle",defaultMessage:"What does this GPT do? How does it behave? What should it avoid doing?"},gptNamePlaceholder:{id:"gizmo.gptNamePlaceholder",defaultMessage:"Name your GPT"},callbackUrlLabel:{id:"gizmo.callbackUrlLabel",defaultMessage:"Callback URL"}});function pa(s,t){const i=Ws(s);if(!Array.isArray(s.detail))return i;const n=Je(s.detail.map(a=>{if(a.type==="value_error.any_str.max_length")switch(a.loc[1]){case"display":{switch(a.loc[2]){case"name":return t.formatMessage(z.nameTooLong,{length:a.ctx.limit_value});case"description":return t.formatMessage(z.descriptionTooLong,{length:a.ctx.limit_value})}break}case"instructions":return t.formatMessage(z.instructionsTooLong,{length:a.ctx.limit_value})}if(typeof a.msg=="string")return a.msg}));return n.length>0?n.join(`
`):i}function ha({upsertDraftError:s}){const t=$(),i=pa(s,t);return e.jsxs("div",{className:"flex items-center gap-2 text-red-500",children:[e.jsx("div",{children:e.jsx(g,{...Js.errorSavingDraft})}),i!=null&&e.jsx(Ds,{label:i,children:e.jsx(Et,{className:"icon-sm"})})]})}function xa({isPublished:s,isSavingDraft:t,hasUnpublishedChanges:i,upsertDraftError:n,className:a}){return n instanceof li?e.jsx(ha,{upsertDraftError:n}):i?e.jsxs("div",{className:le("flex items-center gap-2",a),children:[e.jsx("span",{className:"text-token-text-secondary",children:s?e.jsx(g,{id:"gizmoEditor.draftUnpublished",defaultMessage:"Unpublished changes"}):e.jsx(g,{id:"gizmoEditor.draftPending",defaultMessage:"Updates pending"})}),e.jsx("div",{className:"w-4 text-token-text-tertiary",children:t&&e.jsx(es,{})})]}):null}const Js=de({errorSavingDraft:{id:"gizmo.errorSavingDraft",defaultMessage:"Error saving draft"}}),va=Ke(()=>Ye(()=>import("./g6va54f1qx14it8i.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])).then(s=>s.DebugConversationSidebar));var ja=(s=>(s.TestGizmoAction="test_gizmo_action",s))(ja||{});const ya=new ci;function ba({gizmoEditorData:s,isSavingDraft:t,currentModelConfig:i,showTitle:n=!0}){const[a,r]=u.useState(()=>be());Ps(a,{kind:ne.GizmoTest,gizmo_id:s.id}),u.useEffect(()=>{I.updateConversationMode(a,{kind:ne.GizmoTest,gizmo_id:s.id})},[a,s.id]);const o=s.files?.map(b=>b.file_id).join();u.useEffect(()=>{I.getServerThreadId(a)!=null&&r(be())},[s.id,s.instructions,s.tools,o,a]);const d=ws(b=>b.activeSidebar),f=u.useMemo(()=>({gizmoEditorData:s,mode:"test"}),[s]),[l,w]=u.useState(0),T=()=>{w(b=>b-360)},c=s.id,m=Ma(a,i);u.useEffect(()=>di(ya,{test_gizmo_action:({rootDomain:b,operationName:k})=>{c&&m(c,b,k)}}),[m,c]);const x=Rs(),h=u.useCallback(()=>e.jsx("div",{className:"h-full w-full",children:e.jsx(Li,{gizmo:s,hideOwner:!0,showStarterPrompts:!0})}),[s]);return e.jsx(Ts.Provider,{value:f,children:e.jsx(Ft,{enableSandbox:!1,clientThreadId:a,children:e.jsxs("div",{className:le("flex h-full w-full",t&&"cursor-wait opacity-80 transition"),children:[e.jsxs("div",{className:"flex grow flex-col",children:[e.jsx("div",{className:"relative mb-2 flex-shrink-0",children:e.jsx("div",{className:"flex justify-center py-1",children:n&&e.jsxs("div",{className:"group flex items-center gap-2 text-lg font-semibold",children:[e.jsx("div",{className:"icon-md"}),e.jsxs("button",{onClick:()=>{T(),r(be())},className:"flex items-center gap-2",children:[e.jsx(g,{id:"2u/6Ja",defaultMessage:"Preview"}),e.jsx(vs.div,{className:"text-token-text-primary",animate:{rotate:l},transition:{duration:.3},children:e.jsx(Ot,{className:"icon-md invisible group-hover:visible"})})]})]})})}),e.jsxs("div",{className:le("relative grow overflow-auto px-2",t&&"pointer-events-none"),children:[x?e.jsx("div",{className:"contents",style:{"--screen-height-override":"100%","--chat-screen-thread-parent-background":"var(--main-surface-secondary)"},children:e.jsx(qs,{clientThreadId:a,children:e.jsx(Vs,{hideHeader:!0,embedded:!0,renderEmptyState:h})})}):e.jsx($s,{clientThreadId:a,hideHeader:!0,renderEmptyState:h()}),e.jsx(Gi.Sidebars,{children:e.jsx(Ai,{clientThreadId:a,overrideWidth:0,isAutoFocusDisabled:!0})})]})]}),d==="debug"&&e.jsx(va,{clientThreadId:a,slideOver:!1,onClose:()=>me.toggleActiveSidebar("debug"),isOpen:!0})]})})})}const ps=hs.memo(ba);function Ma(s,t){const i=js({clientThreadId:s});return u.useCallback(async(a,r,o)=>{if(!t)return;const d=new ys,f=I.getThreadCurrentLeafId(s),l=ce(),w=Bt(r);I.updateTree(s,h=>{h.addNodeToEnd(f,{id:l,children:[],parentId:f,message:{id:l,author:{role:H.User},content:{content_type:ui.Text,parts:[`Call the ${r} API with the ${o} operation`]},recipient:"all",metadata:{jit_plugin_data:{from_client:{type:"test",operation:o,tool_name:w}}}}})});const T={conversationMode:{kind:ne.GizmoTest,gizmo_id:a}},c=await Ve(),[m,x]=await Promise.all([Be.getEnforcementToken(c),Qe.getEnforcementToken(c)]);i({model:t.id,completionType:zs.Next,parentNodeId:l,metadata:{},focusOnNewCompletion:!0,chatReq:c,turnstileToken:m,proofToken:x,preflightTime:0,completionMetadata:T,turnTracker:d})},[s,i,t])}const wa=Ke(()=>Ye(()=>import("./obp2l1zwhgkyczrv.js"),__vite__mapDeps([13,2,1,3,14,4,5,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,8,10,39,40,41,6,42,43,44,45,46,47])).then(s=>s.GizmoActionsEditor));var Xs=(s=>(s.MAGIC_MAKER="magic",s.ADVANCED="advanced",s.PREVIEW="preview",s))(Xs||{});function Le({value:s,label:t,testId:i}){return e.jsx(Is,{value:s,className:"text-md w-1/3 flex-grow rounded-lg border-token-border-light p-1.5 font-semibold text-token-text-tertiary transition hover:text-token-text-primary radix-state-checked:border radix-state-checked:bg-token-main-surface-primary radix-state-checked:text-token-text-primary radix-state-checked:shadow-[0_0_2px_rgba(0,0,0,.03)] md:w-1/2","data-testid":i,children:t})}function Ta({className:s,editorTab:t,setEditorTab:i}){const n=$(),{value:a}=Te("1393076427");return e.jsxs(ks,{className:le("flex w-full overflow-hidden rounded-xl bg-token-main-surface-secondary p-1.5 md:w-1/2",s),value:t,onValueChange:r=>{i(r)},children:[a&&e.jsx(Le,{value:"magic",label:n.formatMessage(ze.magicMakerLabel)}),e.jsx(Le,{value:"advanced",label:n.formatMessage(ze.configureLabel),testId:"gizmo-editor-configure-button"}),e.jsx("div",{className:"flex w-1/3 md:hidden",children:e.jsx(Le,{value:"preview",label:n.formatMessage(ze.previewLabel)})})]})}function Pa(s,t){return s.length!==t.length?!1:s.every(i=>t.some(n=>n.type===i.type))}function Sa(s,t){return s.name===t.gizmo.display.name&&s.description===t.gizmo.display.description&&s.instructions===t.gizmo.instructions&&Pa(s.tools,t.tools)&&He(s.files?.map(i=>i.file_id)??[],t.files?.map(i=>i.file_id)??[])&&s.profilePictureUrl==t.gizmo.display.profile_picture_url&&s.profilePictureId==t.gizmo.display.profile_pic_id}const Zs=({gizmo:s,onNewGizmoId:t})=>{const i=xs(),n=Xe(),a=Ls(ye.BrowsingAvailable),r=n?.includes(ye.GizmoCanvasToggle)&&n?.includes(ye.Canvas),o=$(),d=re(),f=()=>{const v=[];return a&&v.push({type:W.BROWSER}),r&&v.push({type:W.CANVAS}),{...cs,tools:[...cs.tools,...v]}},l=u.useRef(s!=null?os(s):f()),w=u.useRef(s),T=u.useRef(l.current),[c,m]=u.useState(()=>l.current),[x,h]=u.useState(()=>be()),[b]=u.useState(()=>({context_message:Fi(l.current),model_slug:"unused",enabled_tools:[{tool_id:s!=null?"gizmo_editor":"gizmo_creator"}]}));qi(x,T.current,b);const{data:k}=Vt(),S=k?.modelsList.find(v=>v.tags.includes(mi.GPT_4))??k?.modelsList.find(v=>v.id===Qt),{data:j}=Kt(l.current.id),N=Yt(),{isPending:y,error:p}=N,C=Jt(),_=u.useMemo(()=>j!=null&&!Sa(c,j),[c,j]),U=async()=>{const v=l.current;try{const P=await N.mutateAsync({editorData:v,gizmoId:v.id});if(w.current=P,l.current.id==null){const L=P.gizmo.id;l.current={...l.current,id:L,sharingTargets:P.gizmo.sharing_targets},m(l.current),t?.(L)}for(const L of P.tools.filter(D=>D.type===W.JIT_PLUGIN)){const D=l.current.tools.find(se=>se.type===W.JIT_PLUGIN&&se.metadata.domain===L.metadata.domain);D&&D.metadata.action_id!==L.metadata.action_id&&(D.metadata={...D.metadata,action_id:L.metadata.action_id},m(l.current))}return P}catch(P){const L=Ws(P)??o.formatMessage(Js.errorSavingDraft);throw d.warning(L,{duration:2}),P}},G=u.useRef(void 0),F=async()=>l.current.id!=null?l.current.id:(G.current==null&&(G.current=U().then(v=>v.gizmo.id).catch(v=>{throw G.current=void 0,v})),G.current),[q]=u.useState(()=>Xt(()=>U(),2e3,{trailing:!0}));function R(v,P=!0){const L=typeof v=="function"?v(l.current):Zt(l.current,v);He(L,l.current)||(l.current=L,m(l.current),P&&q())}const O=u.useRef(void 0),V=async v=>{if(v==null){pe(!1);return}try{const P=await Ei(l.current,v,d,O.current);P!=null&&(R(P),T.current=Ms(l.current))}catch(P){Fe.addError(P),d.warning("Something went wrong generating your GPT",{duration:3})}finally{O.current=I.getThreadCurrentLeafId(v),pe(!1)}},ge=Di(x,V,b),[Y,Q]=u.useState(void 0);u.useEffect(()=>{Q(Ti(s))},[s?.gizmo.id]);const M=async(v,P)=>{const L=we(l.current,v.recipient,P);if(L.length>0){d.warning(`Could not save GPT:

${L.map(te=>`- ${Ue(te)}`).join(`
`)}`,{duration:3});return}const D=await U(),se=D.gizmo.id;try{return Os.logEvent(Bs.promoteGizmo,{gizmo_id:D.gizmo.id,sharing_recipient:v.recipient,editor_tab:J}),await C.mutateAsync({gizmoId:D.gizmo.id,data:{sharingSubjects:v.subjects,sharingRecipient:v.recipient,categories:P==null?void 0:[P]}},{onSuccess(Ce){i.setQueryData(ls(i,se).queryKey,Ce),i.invalidateQueries({queryKey:["gizmos"]}),i.invalidateQueries({queryKey:["gizmo",{gizmoId:se}]}),i.invalidateQueries({queryKey:["gizmo","userActionSettings",{gizmoId:se}]})}})}catch(te){if(te instanceof ei)Q({gizmoId:se,sharingRecipient:v.recipient,moderationType:Hs.PublishBlocked,sharingTargets:te.response?.sharing_targets,showModal:ue.AppealAvailable});else{Fe.addError(te);const Ce=te.detail??"An unknown error occurred";d.warning("Error saving GPT - "+Ce,{duration:6})}}},{value:E}=Te("1393076427"),[J,ss]=u.useState(()=>{if(!E)return"advanced";const v=us.getItem(ms.GizmoEditorTab);return Object.values(Xs).includes(v)?v:"magic"}),Se=fi.useState(({windowWidth:v})=>v);u.useEffect(()=>{Se!=null&&Se>=768&&J==="preview"&&ss("magic")},[Se,J]);const[et,st]=u.useState(!1),[ts,pe]=u.useState(!1),[is,ke]=u.useState(void 0);return e.jsxs("div",{className:"flex h-screen w-full flex-col items-center",children:[e.jsx(ia,{gizmoEditorData:c,isUpsertLoading:N.isPending,isPromoteLoading:C.isPending,hasUnpublishedChanges:_,isUploadingProfilePic:et,isGeneratingProfilePic:ts,publishedGizmo:j,updateGizmo:R,promoteGizmo:async(v,P)=>{const L=await M(v,P);return l.current={...l.current,sharingRecipient:v.recipient},m(l.current),us.setItem(ms.GizmoEditorTab,J),L},appealGizmo:async(v,P)=>{Y!=null&&Q({...Y,sharingRecipient:v,categories:P==null?void 0:[P],showModal:ue.AppealAvailable})},setAppealState:Q,revertDraft:j!=null&&_?()=>{const v=i.getQueryData(ls(i,l.current.id).queryKey);if(v!=null){const P=os(v);l.current=P,m(P),U()}}:void 0,draftMessage:e.jsx(xa,{isPublished:j!=null&&(j.gizmo.share_recipient==="marketplace"||j.gizmo.share_recipient==="workspace"),hasUnpublishedChanges:_,isSavingDraft:y,upsertDraftError:p,className:"text-sm"}),showActionsModal:v=>{ke(v)},className:"flex-shrink-0"}),Y&&e.jsx(Pi,{appealState:Y,onAppealClose:()=>Q({...Y,showModal:ue.None}),onAppealSubmitted:()=>Q({...Y,showModal:ue.AppealSent})}),e.jsxs("div",{className:"relative flex w-full grow overflow-hidden",children:[e.jsx("div",{className:"flex w-full justify-center md:w-1/2",children:e.jsx("div",{className:"h-full grow overflow-hidden",children:is!==void 0?e.jsx(wa,{currentlyEditingActionDomain:is,gizmoEditorData:c,updateGizmo:R,onClose:()=>{ke(void 0)}}):e.jsxs("div",{className:"flex h-full flex-col px-2 pt-2",children:[e.jsx("div",{className:"flex w-full flex-row justify-center",children:e.jsx(Ta,{editorTab:J,setEditorTab:ss,className:"mb-2 flex-shrink-0 self-center"})}),e.jsx("div",{className:"grow overflow-hidden",children:J==="magic"?e.jsx("div",{className:"h-full w-full pb-5",children:e.jsx(Qi,{gizmoEditorData:c,updateGizmo:R,completionCallbackResponse:V,clientThreadId:x,gizmoEditorDataRef:l,magicMakerBehaviorOverrides:b,magicMakerConversationGizmoEditorDataRef:T,requireGizmoId:F},x)}):J==="advanced"?e.jsx(ga,{gizmoEditorData:c,updateGizmo:R,currentModelConfig:S,generateProfilePic:()=>{pe(!0),ge(l,T,[Wi])},setIsUploadingProfilePic:st,isGeneratingProfilePic:ts,setIsGeneratingProfilePic:pe,requireGizmoId:F,onShowActionsEditor:v=>{ke(v)}}):e.jsx(ps,{gizmoEditorData:c,currentModelConfig:S,isSavingDraft:y,showTitle:!1})})]})})}),e.jsx("div",{className:le("hidden w-1/2 justify-center border-l border-token-border-medium bg-token-main-surface-secondary pt-4",J!=="preview"&&"md:flex"),children:e.jsx("div",{className:"flex-grow pb-5",children:e.jsx("div",{className:"h-full",children:e.jsx(ps,{gizmoEditorData:c,currentModelConfig:S,isSavingDraft:y})})})})]})]})};function ka({gizmoId:s,version:t}){const{data:i}=Ht({gizmoId:s,draft:!0,version:t}),n=Me(Ss.accountUserId),r=$t()?.id,o=i!=null&&n!=null&&r!=null&&qt(i);return i==null||!o?null:e.jsx(Zs,{gizmo:i})}function Ca({onNewGizmoId:s}){return e.jsx(Zs,{onNewGizmoId:s})}const Ia=({gizmoId:s,remixSourceId:t,version:i})=>{const n=fe(),a=Pe(),r=u.useRef(void 0);u.useEffect(()=>(me.enterGizmoEditor(),()=>{me.exitGizmoEditor()}),[]);let o=s;return s!=null&&r.current===s&&(o=void 0),Dt({resetThreadAction:()=>{n("/")}}),a?.data?o!==void 0?e.jsx(ka,{gizmoId:o,version:i},o):e.jsx(Ca,{remixSourceId:t,onNewGizmoId:d=>{r.current=d,window.history.replaceState(window.history.state,"",Wt(d))}}):e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx(es,{})})},ze=de({magicMakerLabel:{id:"gizmo.magicMakerLabel",defaultMessage:"Create"},configureLabel:{id:"gizmo.advancedLabel",defaultMessage:"Configure"},previewLabel:{id:"gizmo.previewLabel",defaultMessage:"Preview"}});function Na(s){const t=fe();u.useEffect(()=>{s||t(gi(pi.NO_ACCESS))},[s,t])}const Qa=()=>(xi(),null);function Ka(){const s=Pe();Na(s==null||s.canCreateGizmos());const t=it(),[i]=at(),n=fe(),a=t.slug,r=i.get("version"),o=a?hi(a):void 0,d=i.get("remixFrom");return u.useEffect(()=>{Ve(!0).then(f=>{Be.initializeAndGatherData(f),Qe.initializeAndGatherData(f)})},[]),u.useEffect(()=>{s!=null&&!s.canCreateGizmos()&&n("/")},[s,n]),u.useEffect(()=>{o&&ds(o)&&n(`/g/${a}/project`)},[o,n,a]),!s?.canCreateGizmos()||o&&ds(o)?null:e.jsx(si,{children:e.jsx(Ia,{gizmoId:o,remixSourceId:d??void 0,version:r!=null?Number(r):void 0})})}export{ya as G,ja as a,Ka as b,Qa as c};
//# sourceMappingURL=d8c11igaifjsxnpy.js.map
