const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/lp76htdmp7dy3ofp.js","assets/ldmgmrz4k1q6ed5n.js","assets/nfw6qo5mkhpyk7ym.js","assets/root-3maajqpm.css","assets/il8crxbwclaclc75.js","assets/conversation-small-cdg3w5lg.css","assets/idw7sys1c2oa2i6c.js","assets/cbyvodb06ds84vgq.js","assets/g93qmzmxf1wr9awg.js","assets/deod98p42ilzt8gy.js","assets/biot7k05ldcinew6.js","assets/fom4zt3cusewtt6o.js","assets/h92f3ayftmoyqxjv.js","assets/hl80s4b9yvozzdb0.js","assets/ek18f4o0gb6hv959.js","assets/feqflnrjxiq8ko5x.js","assets/nkg4l2za6ncjgmyx.js","assets/d41reewaqg3k8vdv.js","assets/jfq8gse5yfdt1bqf.js","assets/miqdu419nfq6dj62.js","assets/e19oyuodg5cwjaak.js"])))=>i.map(i=>d[i]);
import{r as u,aD as re,aE as ne,ao as H,P as x,a as C,V as L,bU as P,f3 as S,ek as w,f4 as z,bA as oe,l as s,m as v,cj as ie,Q as le,u as U,bp as de,aK as ue,j as E,Z as I,a0 as ce}from"./ldmgmrz4k1q6ed5n.js";import{dT as fe,dU as me,dV as K,dW as he,aR as G,dX as ye,H as ge,J as pe,bH as B,c as be,dY as Se,dZ as ve,d_ as Te,d$ as Y,e0 as Ee,G as xe,dJ as Ce,dH as Ne,a3 as q,dI as we,dS as Ie}from"./il8crxbwclaclc75.js";import{u as ke}from"./fb9zxvsrbhyl075h.js";import{b as Me,g as Re}from"./idw7sys1c2oa2i6c.js";import{b as je,r as M,s as $}from"./fom4zt3cusewtt6o.js";import{f as _e}from"./biot7k05ldcinew6.js";import{t as De,v as X,w as Oe,s as Ae,T as Q}from"./cbyvodb06ds84vgq.js";import{G as J}from"./deod98p42ilzt8gy.js";import{a7 as He}from"./nfw6qo5mkhpyk7ym.js";function Le(e,t,o){const{title:a,titleSource:r}=De(e),[n,l]=u.useState(!1),d=a??t,i=u.useRef(d);return u.useEffect(()=>(o&&r===X.Generated&&d!==i.current&&l(!0),()=>{i.current=d}),[o,d,r]),{isTypingEffect:n,resolvedTitle:d}}const Ue=re(()=>ne(()=>import("./lp76htdmp7dy3ofp.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20])).then(e=>e.GizmoConversationOptionsDropdown)),Ge=new Date(2024,8,24,13);function Ve(e){H.checkGate("3922476776")||fe.abortAllRequests(),x.logEvent(C.loadThread,{threadId:e})}function Fe({conversation:e,conversationTitle:t,onOpenChange:o,testId:a}){const r=L(),{isUnauthenticated:n}=le(),{eligible:l,markAsViewed:d}=ge(pe.ArchiveConversationOnboarding),i=Ae(e.id),[h,y]=u.useState(!1),f=U(),g=de(),c=ue();return u.useEffect(()=>z(J,{deleteChat:({serverThreadId:m})=>{m===e.id&&y(!0)},archiveChat:async({serverThreadId:m})=>{m===e.id&&(await E.patchConversation(e.id,{is_archived:!0}),M(f),H.logEvent("chatgpt_conversation_archived"),x.logEvent(C.conversationArchived),l&&(c.info(r.formatMessage({defaultMessage:"You can view archived chats in Settings",id:"HistoryGizmoItem.archiveChatOnboarding"}),{duration:10,hasCloseButton:!0}),d()),i&&B(g))}}),[g,c,f,l,e.id,r,i,d]),n?null:s.jsxs(s.Fragment,{children:[s.jsx(be,{label:r.formatMessage({id:"tJPHEQ",defaultMessage:"Options"}),sideOffset:4,side:"top",children:s.jsx(Ue,{clientThreadId:e.id,onOpenChange:o,children:s.jsx("button",{className:"flex items-center justify-center text-token-text-secondary transition hover:text-token-text-primary radix-state-open:text-token-text-secondary","data-testid":a,children:s.jsx(He,{className:"icon-md"})})})}),h&&s.jsx(Se,{title:t,handleDelete:()=>{E.patchConversation(e.id,{is_visible:!1}).then(()=>{M(f),H.logEvent("chatgpt_conversation_deleted"),x.logEvent(C.conversationDeleted)}),i&&B(g)},onClose:()=>{y(!1)}})]})}function Pe({conversation:e,onClose:t}){const[o,a]=u.useState(e.title),r=U();function n(){o!==e.title&&(Q.setTitle(e.id,o,X.User),x.logEvent(C.renameThread,{threadId:e.id,content:o}),E.patchConversation(e.id,{title:o}).then(()=>{M(r)}))}return s.jsx("input",{type:"text",value:o,onChange:l=>{a(l.target.value)},onKeyDown:l=>{switch(l.key){case"Escape":t();break;case"Enter":n(),t();break}},onBlur:()=>{n(),t()},autoFocus:!0,className:"w-full border border-token-border-light bg-transparent p-0 text-sm"})}const Z=5,Be=3e3;function Ye({threadId:e}){const t=U(),o=u.useRef(!1),a=u.useRef(null);return u.useEffect(()=>{async function r(){o.current=!0;const n=await _e(e);if(n.async_status===S.UNREAD){M(t),Q.initThreadFromServerData(e,n,!0,void 0,!0);return}if(n.async_status!==S.STREAMING)return;const l=n.update_time??0;K(new Date,new Date(l*1e3))<Z?a.current=window.setTimeout(r,Be):E.setConversationStatus(e)}return o.current||r(),()=>{a.current&&window.clearTimeout(a.current)}},[t,e]),null}function qe({conversation:e,isActive:t,elementRef:o,isPrimaryBackgroundColor:a,testId:r}){const n=L(),[l,d]=u.useState(!1),[i,h]=u.useState(!1),{value:y}=P("3922476776"),{value:f}=P("232791851"),g=je(e.id),{value:c=null,source:m=null}=g??{},R=Oe(e.id),T=me(R),p=K(new Date,new Date(e.update_time??0))<Z,N=e.update_time&&he(new Date(e.update_time),Ge),j=c===S.STREAMING&&p,_=f&&!t&&!T&&N&&c===S.UNREAD,D=f&&!t&&(T||j),W=f&&c===S.STREAMING&&m===w.SERVER&&!T&&p,O=u.useRef(!1);u.useEffect(()=>{O.current||y&&(async()=>(O.current=!0,t&&m===w.SERVER&&c===S.UNREAD&&(await E.setConversationStatus(e.id),$(e.id,null)),!t&&m===w.CLIENT&&c===S.UNREAD&&(await E.setConversationStatus(e.id,c),$(e.id,{value:S.UNREAD,source:w.SERVER})),O.current=!1))()},[y,t,e.id,c,m,T]),u.useEffect(()=>z(J,{editTitle:({serverThreadId:b})=>{(b?b===e.id:t)&&d(!0)}}),[e.id,t]);const V=n.formatMessage({id:"mpXAeu",defaultMessage:"New chat"}),{resolvedTitle:A,isTypingEffect:ee}=Le(e.id,e.title,t),te=oe(),se=ee&&t&&te,{data:ae}=Me(e.conversation_template_id??void 0),F=G();return s.jsxs("div",{className:v("no-draggable group relative rounded-lg active:opacity-90",t?"bg-token-sidebar-surface-secondary":"hover:bg-token-sidebar-surface-secondary",i&&!t&&"bg-token-sidebar-surface-secondary"),children:[W&&s.jsx(Ye,{threadId:e.id}),s.jsx(ie,{to:Re(e.id,ae),onClick:b=>{b.metaKey||b.ctrlKey||t||Ve(e.id)},onDoubleClick:()=>{d(!0)},ref:o,className:"flex items-center gap-2 p-2",style:{maskImage:F?"var(--sidebar-mask":void 0},children:s.jsxs("div",{className:v("relative grow overflow-hidden whitespace-nowrap",D&&"loading-shimmer"),dir:"auto",children:[se?s.jsx(ye,{text:A||V}):A||V,!F&&s.jsx("div",{className:v("absolute bottom-0 top-0 to-transparent ltr:right-0 ltr:bg-gradient-to-l rtl:left-0 rtl:bg-gradient-to-r",a?t||!t&&i?"from-token-sidebar-surface-secondary":"from-token-main-surface-primary":!1,a?!1:t||!t&&i?"from-token-sidebar-surface-secondary":"from-token-sidebar-surface-primary",{"from-token-main-surface-primary can-hover:group-hover:from-token-sidebar-surface-secondary":a&&!t&&!i,"from-token-sidebar-surface-primary can-hover:group-hover:from-token-sidebar-surface-secondary":!a&&!t&&!i,"w-10 from-60%":t||i,"w-8 from-0% can-hover:group-hover:w-10 can-hover:group-hover:from-60%":!t&&!i})})]})}),l?s.jsx("div",{className:"absolute bottom-0 left-[7px] right-2 top-0 flex items-center bg-token-sidebar-surface-secondary",children:s.jsx(Pe,{conversation:e,onClose:()=>{d(!1)}})}):_?s.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:s.jsx("div",{className:"h-2 w-2 rounded-full bg-blue-selection"})}):s.jsx("div",{className:v("absolute bottom-0 top-0 items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",t||i?"flex":"hidden can-hover:group-hover:flex"),children:s.jsx(Fe,{conversation:e,conversationTitle:A??e.title,onOpenChange:b=>{h(b),b&&x.logEvent(C.conversationHistoryItemOpenMenu,{conversationId:e.id})},testId:`${r}-options`})})]})}function $e({elementRef:e,item:t,isActive:o,isFirstItem:a,isPrimaryBackgroundColor:r,testId:n}){const l=G();return s.jsx("li",{className:v("relative",a&&!l?"z-[15]":""),"data-testid":n,children:s.jsx(qe,{isPrimaryBackgroundColor:r,conversation:t,isActive:o,elementRef:e,testId:n})})}const k=ce({historyBucketToday:{id:"history.bucket.today",defaultMessage:"Today"},historyBucketYesterday:{id:"history.bucket.yesterday",defaultMessage:"Yesterday"},historyBucketLastSeven:{id:"history.bucket.lastSeven",defaultMessage:"Previous 7 Days"},historyBucketLastThirty:{id:"history.bucket.lastThirty",defaultMessage:"Previous 30 Days"}}),ze=5;function at(e,t){const o=L();return u.useMemo(()=>e.reduce((a,r)=>{const n=new Date(r.update_time??r.create_time??0),l=ve(new Date,n);if(l===0)a.recent.today.items.push(r);else if(l<=1)a.recent.yesterday.items.push(r);else if(l<=7)a.recent.lastSeven.items.push(r);else if(l<=30)a.recent.lastThirty.items.push(r);else if(Te(n)){const d=Y(n),i=Ee(n),h=`${d}-${i}`;a.dynamicMonths[h]?a.dynamicMonths[h].items.push(r):a.dynamicMonths[h]={label:o.formatDate(n,{month:"long"}),items:[r]}}else{const i=`${Y(n)}-`;a.dynamicYears[i]?a.dynamicYears[i].items.push(r):a.dynamicYears[i]={label:o.formatDate(n,{year:"numeric"}),items:[r]}}return a},{recent:{today:{label:s.jsx(I,{...k.historyBucketToday}),items:[]},yesterday:{label:s.jsx(I,{...k.historyBucketYesterday}),items:[]},lastSeven:{label:s.jsx(I,{...k.historyBucketLastSeven}),items:[]},lastThirty:{label:s.jsx(I,{...k.historyBucketLastThirty}),items:[]}},dynamicMonths:{},dynamicYears:{}}),[t,e])}function rt({activeId:e,bucketedItems:t,items:o,hasNextPage:a,isPrimaryBackgroundColor:r,infiniteScrollTriggerElementRef:n}){const{isCollapsible:l}=ke(),d=xe(Ce.isHistoryCollapsed),i=G(),[h]=Ne({onChange:y=>{u.startTransition(()=>{q.setHistoryShowMoreVisible(y)})}});return s.jsxs(s.Fragment,{children:[[t.recent,t.dynamicMonths,t.dynamicYears].flatMap((y,f)=>s.jsx(u.Fragment,{children:Object.entries(y).map(([g,{items:c,label:m}],R)=>{if(g!=="today"&&!c.length)return null;const T=!!c.find(p=>o.length>0&&p.id===o[0]?.id);return c.length>0&&s.jsxs("div",{className:v(r&&"first:mt-0","relative mt-5 first:mt-0 last:mb-5"),children:[s.jsx("div",{className:v("sticky z-20",!i&&"bg-token-sidebar-surface-primary",i?"top-[--sidebar-sticky-threshold] mb-2":"top-0"),children:s.jsx("span",{className:"flex h-9 items-center",children:s.jsx(we,{children:m})})}),s.jsx("ol",{children:c.map((p,N)=>{const j=e===p.id,_=T&&N===0,D=a&&o[o.length-ze-1]?.id===p.id?n:void 0;return s.jsx($e,{item:p,isActive:j,isFirstItem:_,isPrimaryBackgroundColor:r,elementRef:D,testId:`history-item-${N}`},`history-item-${p.id}-${g}`)})})]},`${g}-${f}-${R}`)})},`category-${f}`)),l&&!d&&s.jsx("div",{ref:h,children:s.jsx(Ie,{type:"less",onClick:q.toggleHistoryCollapsed})})]})}export{rt as H,$e as a,Ve as o,at as u};
//# sourceMappingURL=e6gjhh4y6tgcyu2s.js.map
