import{c as I,f as N,ej as D,bv as _,ek as L,af as P,W as x,el as O,j as F,r as f,a5 as H}from"./e9n3rg14pzg374g3.js";import{T as K}from"./h0laljsy4ysc90hu.js";import{cN as $,cO as q,cP as k,cQ as Q}from"./grb1rrh8esowjpbm.js";const h=I(N(()=>({statusMap:{}}))),Z=a=>h(s=>s.statusMap[a]),z=(a,s)=>{h.setState(e=>{e.statusMap[a]=s;const t=K.getServerThreadId(a);t&&(e.statusMap[t]=s)})},p=a=>{h.setState(s=>{for(const{id:e,async_status:t}of a)t!=null&&(s.statusMap[e]={source:D.SERVER,value:t})})},U=28,v="conversationHistory";function J(a={}){const{buckets:s,recentConversationLimit:e}=a,o=_()?.includes(L)??!1,y=P(),l=!o&&!!y?.data,r=x(),{data:i,fetchNextPage:M,hasNextPage:g,isLoading:b,isFetchingNextPage:S,isError:T}=O({queryKey:[v],queryFn:async({pageParam:n})=>{const u=await F.getConversations({offset:n,limit:U});return p(u.items),u},initialPageParam:0,getNextPageParam:n=>{const u=n.offset+n.limit;return u<n.total?u:void 0},enabled:l}),c=f.useMemo(()=>i?.pages.flatMap(u=>u.items)??[],[i,a]);f.useEffect(()=>{p(c)},[c]);const B=f.useMemo(()=>{if(!i||!s)return[];const n=j(c,r);return[n.recent,n.dynamicMonths,n.dynamicYears].flatMap(d=>Object.entries(d).map(([Y,{items:A,label:C}],R)=>({key:`${Y}-${R}`,label:C,items:A}))).filter(d=>d.items.length>0)},[c,i,r,s]),E=f.useMemo(()=>{const n=c.slice(0,e??5);return{key:"recents",label:r.formatMessage(m.historyBucketRecent),items:n}},[c,e,r]);return{buckets:B,conversations:c,data:i,fetchNextPage:M,hasNextPage:g,recents:E,isLoading:b,isFetchingNextPage:S,isError:T}}function j(a,s){return a.reduce((e,t)=>{const o=new Date(t.update_time??t.create_time??0),y=$(new Date,o);if(y===0)e.recent.today.items.push(t);else if(y<=1)e.recent.yesterday.items.push(t);else if(y<=7)e.recent.lastSeven.items.push(t);else if(y<=30)e.recent.lastThirty.items.push(t);else if(q(o)){const l=k(o),r=Q(o),i=`${l}-${r}`;e.dynamicMonths[i]?e.dynamicMonths[i].items.push(t):e.dynamicMonths[i]={label:s.formatDate(o,{month:"long"}),items:[t]}}else{const r=`${k(o)}-`;e.dynamicYears[r]?e.dynamicYears[r].items.push(t):e.dynamicYears[r]={label:s.formatDate(o,{year:"numeric"}),items:[t]}}return e},{recent:{today:{label:s.formatMessage(m.historyBucketToday),items:[]},yesterday:{label:s.formatMessage(m.historyBucketYesterday),items:[]},lastSeven:{label:s.formatMessage(m.historyBucketLastSeven),items:[]},lastThirty:{label:s.formatMessage(m.historyBucketLastThirty),items:[]}},dynamicMonths:{},dynamicYears:{}})}function X(a){a.invalidateQueries({queryKey:[v]})}const m=H({historyBucketRecent:{id:"history.bucket.recent",defaultMessage:"Recent"},historyBucketToday:{id:"history.bucket.today",defaultMessage:"Today"},historyBucketYesterday:{id:"history.bucket.yesterday",defaultMessage:"Yesterday"},historyBucketLastSeven:{id:"history.bucket.lastSeven",defaultMessage:"Previous 7 Days"},historyBucketLastThirty:{id:"history.bucket.lastThirty",defaultMessage:"Previous 30 Days"}});export{v as C,Z as a,X as r,z as s,J as u};
//# sourceMappingURL=bqf1l5j120frre28.js.map
