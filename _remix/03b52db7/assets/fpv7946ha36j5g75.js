const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ekcm3md8pr3dqmoy.js","assets/fv8eat2vy34xk6oz.js","assets/howa76dydrhhoa6x.js","assets/kofmwj6l4z0fg93q.js","assets/grb1rrh8esowjpbm.js","assets/e9n3rg14pzg374g3.js","assets/j1qap0bw36lespl9.js","assets/root-iykz99hp.css","assets/conversation-small-cll5buey.css","assets/h68ell45soz3e4yi.js","assets/bi0vifd8jvbk6z3i.js","assets/ewtqk0n3851lyzho.js","assets/h0laljsy4ysc90hu.js","assets/ix76sg32fmcx0j55.js","assets/j1bsva8oa7k0vwf4.js","assets/m9q3yr3sdo39re1m.js","assets/dhbxzszbcrs3lysw.js","assets/gr6pgpwa3sv1aeh2.js","assets/bc6hp4wq8gowa771.js","assets/ioz8cfcg5s4hqq33.js","assets/dtze00xaierjxot3.js","assets/k1gn41i4gray7fmh.js","assets/brcdrne8zkhspau9.js","assets/zct6hi1cd1uetz17.js","assets/bqf1l5j120frre28.js","assets/osp358f6hr0hdw9m.js","assets/c176p1tvb72ey8bx.js","assets/b7bs1z139odvm6h9.js","assets/bmxfjctvf6dy0vtx.js","assets/lnoqovenqntluoyg.js","assets/ciurqnnwme4wfaw0.js","assets/l61slgylu3wa7sd7.js","assets/md43qqd0ctk8xrhi.js","assets/e3ezbm8zkxbidjx5.js","assets/fxwbmiobmj26qalw.js","assets/lk3pp2vw3m7l4e9y.js","assets/l1585lj0to0ompoy.js","assets/ed1h1x58zy8697sv.js","assets/k2p17ikbt9ujlss7.js","assets/bn0hs37o9gpo5skb.js"])))=>i.map(i=>d[i]);
import{d as nt,lZ as y,l_ as Zt,l$ as se,ik as B,m0 as rt,m1 as st,ij as fe,aa as X,fu as D,bO as Jt,em as Qt,cr as eo,m2 as j,iV as W,jq as Ne,m3 as to,m4 as oo,m5 as no,j_ as Fe,fj as Te,ip as He,im as $e,$ as ro,e as so,f as ao,h as io}from"./grb1rrh8esowjpbm.js";import{a5 as co,Z as N,aD as at,i as lo,g as uo,fn as fo,x as c,N as O,n as ie,r as g,W as Oe,f6 as mo,d5 as it,au as po,c1 as ct,Q as R,bb as go,V as lt}from"./e9n3rg14pzg374g3.js";import{c as ho,S as vo,H as xo,x as Co,t as d}from"./howa76dydrhhoa6x.js";import{E as Eo,a3 as me,a2 as Y,C as w,a4 as pe,a5 as _o,a6 as ge,a7 as bo,b as yo,u as No,e as To,a8 as So,$ as V,a9 as ut,S as dt,B as Po}from"./kofmwj6l4z0fg93q.js";import{m as k}from"./ix76sg32fmcx0j55.js";import{c6 as Ao,c7 as Mo,bU as Io,S as Oo,c8 as Ro}from"./j1qap0bw36lespl9.js";import{b as Lo}from"./lddyb24kbmn3w60d.js";import{d as wo,P as ft,f as ko,c as Do,G as jo,q as Bo,D as Ye,p as mt}from"./h68ell45soz3e4yi.js";import{i as Go}from"./mqm40o7gy6m2upxh.js";const hs=4e4,Vo="max-length-toast",Fo=nt((e,o)=>e.info(o,{duration:1.5,id:Vo}),500,{leading:!0,trailing:!1});function vs(e,o,t){Fo(e,o.formatMessage(Ho.exceededMaxLength,{maxLength:t}))}const Ho=co({exceededMaxLength:{id:"cJ/Ddq",defaultMessage:"This document is longer than a canvas can currently handle. To edit, please reduce the length."}}),$o="_modelCursor_1mtn0_1",xs={modelCursor:$o},Yo=(...e)=>o=>{e.forEach(t=>{if(typeof t=="function")t(o);else if(t){const n=t;n.current=o}})};function M(e){return new ho(vo.define(e))}const Ue=()=>N(()=>import("./pbl95wx6493wq92j.js"),[]).then(e=>M(e.shell)),pt={[y.bash]:Ue,[y.zsh]:Ue,[y.swift]:()=>N(()=>import("./pijqfo56g5y7ss6b.js"),[]).then(e=>M(e.swift)),[y.css]:()=>N(()=>import("./ekcm3md8pr3dqmoy.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26])).then(e=>e.css()),[y.html]:()=>N(()=>import("./b7bs1z139odvm6h9.js"),__vite__mapDeps([27,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,0,28])).then(e=>e.html()),[y.javascript]:()=>N(()=>import("./bmxfjctvf6dy0vtx.js"),__vite__mapDeps([28,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26])).then(e=>e.javascript({jsx:!0,typescript:!1})),[y.typescript]:()=>N(()=>import("./bmxfjctvf6dy0vtx.js"),__vite__mapDeps([28,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26])).then(e=>e.javascript({jsx:!0,typescript:!0})),[y.json]:()=>N(()=>import("./lnoqovenqntluoyg.js"),__vite__mapDeps([29,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26])).then(e=>e.json()),[y.python]:()=>N(()=>import("./ciurqnnwme4wfaw0.js"),__vite__mapDeps([30,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26])).then(e=>e.python()),[y.sql]:()=>N(()=>import("./l61slgylu3wa7sd7.js"),__vite__mapDeps([31,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,1])).then(e=>e.sql()),[y.go]:()=>N(()=>import("./md43qqd0ctk8xrhi.js"),__vite__mapDeps([32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26])).then(e=>e.go()),[y.yaml]:()=>N(()=>import("./e3ezbm8zkxbidjx5.js"),__vite__mapDeps([33,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26])).then(e=>e.yaml()),[y.java]:()=>N(()=>import("./fxwbmiobmj26qalw.js"),__vite__mapDeps([34,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26])).then(e=>e.java()),[y.rust]:()=>N(()=>import("./lk3pp2vw3m7l4e9y.js"),__vite__mapDeps([35,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26])).then(e=>e.rust()),[y.cpp]:()=>N(()=>import("./l1585lj0to0ompoy.js"),__vite__mapDeps([36,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26])).then(e=>e.cpp()),[y.php]:()=>N(()=>import("./ed1h1x58zy8697sv.js"),__vite__mapDeps([37,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,0,28])).then(e=>e.php()),[y.xml]:()=>N(()=>import("./k2p17ikbt9ujlss7.js"),__vite__mapDeps([38,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26])).then(e=>e.xml()),[y.vue]:()=>N(()=>import("./bn0hs37o9gpo5skb.js"),__vite__mapDeps([39,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,1,0,28])).then(e=>e.vue()),[y.ruby]:()=>N(()=>import("./e4lhyu305wu0fcut.js"),[]).then(e=>M(e.ruby)),[y.haskell]:()=>N(()=>import("./bf6r3t2rw7f01so5.js"),[]).then(e=>M(e.haskell)),[y.kotlin]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>M(e.kotlin)),[y.csharp]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>M(e.csharp)),[y.c]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>M(e.c)),[y.objectivec]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>M(e.objectiveC)),[y.r]:()=>N(()=>import("./n0t2rpizlasjzcxa.js"),[]).then(e=>M(e.r)),[y.lua]:()=>N(()=>import("./harowmpdmpnd9wki.js"),[]).then(e=>M(e.lua)),[y.dart]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>M(e.dart)),[y.scala]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>M(e.scala)),[y.perl]:()=>N(()=>import("./gq1ss5v2zpbborxl.js"),[]).then(e=>M(e.perl)),[y.commonlisp]:()=>N(()=>import("./jr6cjysmysifr6mr.js"),[]).then(e=>M(e.commonLisp)),[y.clojure]:()=>N(()=>import("./gf1tfl9d2himhfic.js"),[]).then(e=>M(e.clojure)),[y.ocaml]:()=>N(()=>import("./khji33iw1sxityyt.js"),[]).then(e=>M(e.oCaml)),[y.powershell]:()=>N(()=>import("./i9u5kd7kvamutmln.js"),[]).then(e=>M(e.powerShell)),[y.verilog]:()=>N(()=>import("./fix340p09fldyqxz.js"),[]).then(e=>M(e.verilog)),[y.dockerfile]:()=>N(()=>import("./cgm5tyzi32u32j10.js"),[]).then(e=>M(e.dockerFile)),[y.other]:()=>null},Uo=e=>e in pt,ae={},Cs=async e=>{if(ae[e]!=null)return ae[e];if(Uo(e)){const o=await pt[e]();return ae[e]=o,o}return null},Es=e=>ae[e]??null;var gt=e=>{var{theme:o,settings:t={},styles:n=[]}=e,r={".cm-gutters":{}},s={};t.background&&(s.backgroundColor=t.background),t.backgroundImage&&(s.backgroundImage=t.backgroundImage),t.foreground&&(s.color=t.foreground),t.fontSize&&(s.fontSize=t.fontSize),(t.background||t.foreground)&&(r["&"]=s),t.fontFamily&&(r["&.cm-editor .cm-scroller"]={fontFamily:t.fontFamily}),t.gutterBackground&&(r[".cm-gutters"].backgroundColor=t.gutterBackground),t.gutterForeground&&(r[".cm-gutters"].color=t.gutterForeground),t.gutterBorder&&(r[".cm-gutters"].borderRightColor=t.gutterBorder),t.caret&&(r[".cm-content"]={caretColor:t.caret},r[".cm-cursor, .cm-dropCursor"]={borderLeftColor:t.caret});var a={};t.gutterActiveForeground&&(a.color=t.gutterActiveForeground),t.lineHighlight&&(r[".cm-activeLine"]={backgroundColor:t.lineHighlight},a.backgroundColor=t.lineHighlight),r[".cm-activeLineGutter"]=a,t.selection&&(r["&.cm-focused .cm-selectionBackground, & .cm-line::selection, & .cm-selectionLayer .cm-selectionBackground, .cm-content ::selection"]={background:t.selection+" !important"}),t.selectionMatch&&(r["& .cm-selectionMatch"]={backgroundColor:t.selectionMatch});var i=Eo.theme(r,{dark:o==="dark"}),l=xo.define(n),u=[i,Co(l)];return u},Ko={background:"#ffffff",foreground:"#383a42",caret:"#000",selection:"#add6ff",selectionMatch:"#a8ac94",lineHighlight:"#f0f0f0",gutterBackground:"#fff",gutterForeground:"#237893",gutterActiveForeground:"#0b216f",fontFamily:'Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace'},zo=[{tag:[d.keyword,d.operatorKeyword,d.modifier,d.color,d.constant(d.name),d.standard(d.name),d.standard(d.tagName),d.special(d.brace),d.atom,d.bool,d.special(d.variableName)],color:"#0000ff"},{tag:[d.moduleKeyword,d.controlKeyword],color:"#af00db"},{tag:[d.name,d.deleted,d.character,d.macroName,d.propertyName,d.variableName,d.labelName,d.definition(d.name)],color:"#0070c1"},{tag:d.heading,fontWeight:"bold",color:"#0070c1"},{tag:[d.typeName,d.className,d.tagName,d.number,d.changed,d.annotation,d.self,d.namespace],color:"#267f99"},{tag:[d.function(d.variableName),d.function(d.propertyName)],color:"#795e26"},{tag:[d.number],color:"#098658"},{tag:[d.operator,d.punctuation,d.separator,d.url,d.escape,d.regexp],color:"#383a42"},{tag:[d.regexp],color:"#af00db"},{tag:[d.special(d.string),d.processingInstruction,d.string,d.inserted],color:"#a31515"},{tag:[d.angleBracket],color:"#383a42"},{tag:d.strong,fontWeight:"bold"},{tag:d.emphasis,fontStyle:"italic"},{tag:d.strikethrough,textDecoration:"line-through"},{tag:[d.meta,d.comment],color:"#008000"},{tag:d.link,color:"#4078f2",textDecoration:"underline"},{tag:d.invalid,color:"#e45649"}];function Xo(e){var{theme:o="dark",settings:t={},styles:n=[]}=e||{};return gt({theme:o,settings:at({},Ko,t),styles:[...zo,...n]})}var _s=Xo(),Wo={background:"#1e1e1e",foreground:"#9cdcfe",caret:"#c6c6c6",selection:"#6199ff2f",selectionMatch:"#72a1ff59",lineHighlight:"#ffffff0f",gutterBackground:"#1e1e1e",gutterForeground:"#838383",gutterActiveForeground:"#fff",fontFamily:'Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace'},qo=[{tag:[d.keyword,d.operatorKeyword,d.modifier,d.color,d.constant(d.name),d.standard(d.name),d.standard(d.tagName),d.special(d.brace),d.atom,d.bool,d.special(d.variableName)],color:"#569cd6"},{tag:[d.controlKeyword,d.moduleKeyword],color:"#c586c0"},{tag:[d.name,d.deleted,d.character,d.macroName,d.propertyName,d.variableName,d.labelName,d.definition(d.name)],color:"#9cdcfe"},{tag:d.heading,fontWeight:"bold",color:"#9cdcfe"},{tag:[d.typeName,d.className,d.tagName,d.number,d.changed,d.annotation,d.self,d.namespace],color:"#4ec9b0"},{tag:[d.function(d.variableName),d.function(d.propertyName)],color:"#dcdcaa"},{tag:[d.number],color:"#b5cea8"},{tag:[d.operator,d.punctuation,d.separator,d.url,d.escape,d.regexp],color:"#d4d4d4"},{tag:[d.regexp],color:"#d16969"},{tag:[d.special(d.string),d.processingInstruction,d.string,d.inserted],color:"#ce9178"},{tag:[d.angleBracket],color:"#808080"},{tag:d.strong,fontWeight:"bold"},{tag:d.emphasis,fontStyle:"italic"},{tag:d.strikethrough,textDecoration:"line-through"},{tag:[d.meta,d.comment],color:"#6a9955"},{tag:d.link,color:"#6a9955",textDecoration:"underline"},{tag:d.invalid,color:"#ff0000"}];function Zo(e){var{theme:o="dark",settings:t={},styles:n=[]}=e||{};return gt({theme:o,settings:at({},Wo,t),styles:[...qo,...n]})}var bs=Zo(),Jo=lo;function Qo(e){return typeof e=="function"?e:Jo}var en=Qo,tn=fo,on=en,nn=Zt,rn=9007199254740991,_e=4294967295,sn=Math.min;function an(e,o){if(e=nn(e),e<1||e>rn)return[];var t=_e,n=sn(e,_e);o=on(o),e-=_e;for(var r=tn(n,o);++t<e;)o(t);return r}var cn=an;const ln=uo(cn),un=e=>c.jsx(k.div,{className:"dark:bg-white-400 aspect-square rounded-full bg-gray-400",animate:{translateY:["0%","-50%","0%","0%","0%"]},style:{translateX:.5,width:3,height:3},transition:{repeat:1/0,type:"keyframes",delay:e/10,duration:.7}},e),dn=()=>c.jsx(k.div,{className:"grid h-full max-w-full flex-1 grid-cols-3 items-center gap-[0.4] p-1",children:ln(3,e=>un(e))});function fn(e){switch(e){case"dark_gray":return{normal:"text-token-text-secondary dark:text-white-400",hover:"cursor-pointer hover:text-token-text-primary group-hover:text-token-text-primary"};case"light_gray":return{normal:"text-gray-400",hover:"cursor-pointer hover:text-token-text-secondary group-hover:text-token-text-secondary"}}}function Re({children:e,className:o,onClick:t,isClickable:n=!1,theme:r="dark_gray"}){const s=fn(r),a=(t!=null||n)&&s.hover;return c.jsxs("div",{className:O("relative inline-block h-[20px] w-[20px] shrink-0 transition-opacity",o,a,s.normal),onClick:t,children:[e?c.jsx(Ao,{className:"h-[20px] w-[20px] shrink-0"}):c.jsx(Mo,{className:"h-[20px] w-[20px] shrink-0"}),c.jsx("span",{className:O("absolute inset-0 flex items-center justify-center text-[8px] font-black",a,s.normal),children:e})]})}function he(){return c.jsx(Re,{theme:"light_gray",children:c.jsx(dn,{})})}function mn({count:e,isLoading:o,onClick:t}){return o?c.jsx(he,{}):c.jsx(Re,{onClick:t,theme:"dark_gray",children:e})}function pn({isLoading:e=!1,onClick:o}){return e?c.jsx(he,{}):c.jsx(Re,{isClickable:!0,onClick:o,theme:"light_gray"})}var H=(e=>(e[e.up=-1]="up",e[e.down=1]="down",e))(H||{}),ce=(e=>(e.COMMENT="comment",e.COMPOSER="composer",e))(ce||{}),L=(e=>(e.COLLAPSED="collapsed",e.EXPANDED="expanded",e))(L||{});const ht=([e,o],[t,n])=>{const r=e+o,s=t+n;return e<s&&t<r},Se=([e,o])=>e+o,Z=e=>{if(e.type===L.COLLAPSED)return[e.offsetY??0,0];const{offsetY:o,shiftY:t=0,height:n=0}=e,r=o+t;return t<0?[r,n+Math.abs(t)]:[r,n]},gn=(e,o,t)=>{if(!ht(e,o))return null;const[n,r]=e,s=n+r,[a,i]=o,l=a+i,u=a-s,f=l-n;return t===H.up?u:f};var vt=(e=>(e.ABOVE="above",e.BELOW="below",e))(vt||{});function ee(e,o){return ie(e.coordsAtPos(o))}const Ke=360,hn=250,xt=44,ze=.5,Xe=[.5,.9,1],vn=[1,.75,.2],xn=({onClose:e,onSubmit:o,opensOverDocument:t=!1,opensFromGutter:n=!1,gutterHasComments:r=!1},s)=>{const a=Oe(),i=g.useRef(null),l=g.useRef(!1),[u,f]=g.useState(""),[m,p]=g.useState(!0),h=()=>{f(""),e?.(l.current)},v=(T=u)=>{l.current=!0,o?.(T),f("")},C=mo(({windowWidth:T})=>t?T<Ke+100?hn:Ke:se,0),x={};n&&(x.top=-12),t&&n?x.right=0:x.left=0;let E="";n&&!t?E="8px 50%":n&&t?E="calc(100% + 8px) 50%":t&&(E="center left");let _=0;n&&!t&&r&&(_=st);const A=T=>{const{metaKey:S,shiftKey:P,key:I}=T;I==="Enter"&&u&&!(P||S)?(v(),T.preventDefault()):I==="Escape"&&(f(""),e?.(!1))},b=a.formatMessage({id:"VvfbvY",defaultMessage:"Edit or explain..."});return c.jsx(k.div,{ref:Yo(i,s),className:O("absolute flex items-center",B.commentComposer),style:{...x,minHeight:xt},transition:{type:"spring",bounce:.18,duration:.48},initial:{translateX:0},animate:{translateX:_},exit:{translateX:0},children:c.jsx(k.div,{className:O("no-scrollbar relative z-10 flex items-center overflow-x-hidden border border-token-border-light",rt,{"rounded-full":m,"rounded-2xl":!m}),initial:{width:t?se:24,scaleX:t?ze:void 0,scale:t?void 0:ze},animate:{width:C,scaleX:t?Xe:void 0,scale:t?void 0:Xe},exit:{filter:"blur(16px)",scale:t?void 0:vn,width:t?se:24,opacity:t?0:[1,1,0]},transition:{type:"spring",bounce:t?.14:0,duration:.28,scale:{type:"tween",duration:.2},opacity:{type:"tween",time:[0,.95,1]}},style:{transformOrigin:E},children:c.jsxs(k.div,{className:"relative z-0 flex w-full items-center bg-token-main-surface-primary px-4 py-2.5",children:[c.jsx(k.div,{className:"backdrop-saturate-25 absolute inset-0 z-[-1] bg-gray-50/75 backdrop-blur-3xl dark:bg-gray-700/75",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.2}}),c.jsx(Go,{"aria-placeholder":b,value:u,className:"w-full resize-none border-0 bg-transparent px-1 py-0 pr-2 text-token-text-primary outline-0 placeholder:text-token-text-secondary focus:ring-0 focus-visible:ring-0",autoFocus:!0,maxRows:4,onBlur:h,onHeightChange:(T,{rowHeight:S})=>{p(Math.floor(T/S)<=1)},onChange:({target:{value:T}})=>f(T),onKeyDown:A}),!u&&c.jsx("span",{"aria-hidden":!0,className:"absolute inline-block text-nowrap pl-1 text-token-text-secondary",children:b}),c.jsx(k.button,{className:O("-mr-1.5 h-6 w-6 rounded-full bg-black text-center dark:bg-white",{"self-end":!m}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:()=>v(),children:c.jsx(Io,{className:"h-6 w-6 text-white dark:text-black"})})]})})})},Ct=g.forwardRef(xn),Cn=(e,o)=>{if(o?.type!==Y.SELECTION)return null;try{const{from:t,to:n}=o,{top:r}=e.dom.getBoundingClientRect(),{bottom:s,top:a}=ee(e,t),{bottom:i}=ee(e,n),l=pe(e)?-30:-24;let u=s-r+l;const f=a-r;return u=i-r+8,{composerTop:u,loadingTop:f}}catch(t){return D.logError("Invalid position in SelectionCommentComposer",t),null}},En=({toolbarPosition:e,composerRect:o,view:t})=>{let{width:n,height:r}=o;if(r||=xt,t==null||e==null)return null;const{right:s,left:a}=t.dom.getBoundingClientRect(),{left:i,top:l,aboveOrBelow:u,toolbarSize:f}=e,m=l-(u===vt.ABOVE&&r!==0?r-f.height:0),p=_o(t)?12:0;return{left:Math.min(i,s-a-n-p),composerTop:m,aboveOrBelow:u}},_n=({toolbarPosition:e,commentingOn:o,isWaitingForCommentResponse:t=!1,onAddComment:n})=>{const r=me()(),[s,a]=fe(),i=En({view:r,toolbarPosition:e,composerRect:s});if(r==null||i==null)return null;const{left:l,composerTop:u}=i,f=m=>{if(o?.type!==Y.SELECTION)return;const{action:p,sourceRange:h}=o;n?.(m,p,h,o.type)};return c.jsx(X,{children:o?.type===Y.SELECTION&&!t&&c.jsx("div",{className:O("absolute",B.commentComposer),style:{left:l,top:u},children:c.jsx(Ct,{opensOverDocument:!0,onClose:m=>{m||(w.cancelCommentingOn(),r&&pe(r)&&!r.state.selection.empty&&r.dispatch(r.state.tr.setSelection(new wo(r.state.selection.$from))),document.getSelection()?.removeAllRanges())},onSubmit:f,ref:a})},"composer")})};function Et(e,o){return o?e.getState(o)??null:null}function bn(e){return e.nodeSize-2}function yn(e,o){return o>=0&&o<=bn(e)}class U{constructor(o,t,n={}){this.match=o,this.match=o,this.handler=typeof t=="string"?Nn(t):t,this.undoable=n.undoable!==!1,this.inCode=n.inCode||!1}}function Nn(e){return function(o,t,n,r){let s=e;if(t[1]){let a=t[0].lastIndexOf(t[1]);s+=t[0].slice(a+t[1].length),n+=a;let i=n-r;i>0&&(s=t[0].slice(a-i,a)+s,n=r)}return o.tr.insertText(s,n,r)}}const Tn=500;function ys({rules:e}){let o=new ft({state:{init(){return null},apply(t,n){let r=t.getMeta(this);return r||(t.selectionSet||t.docChanged?null:n)}},props:{handleTextInput(t,n,r,s){return We(t,n,r,s,e,o)},handleDOMEvents:{compositionend:t=>{setTimeout(()=>{let{$cursor:n}=t.state.selection;n&&We(t,n.pos,n.pos,"",e,o)})}}},isInputRules:!0});return o}function We(e,o,t,n,r,s){if(e.composing)return!1;let a=e.state,i=a.doc.resolve(o),l=i.parent.textBetween(Math.max(0,i.parentOffset-Tn),i.parentOffset,null,"￼")+n;for(let u=0;u<r.length;u++){let f=r[u];if(i.parent.type.spec.code){if(!f.inCode)continue}else if(f.inCode==="only")continue;let m=f.match.exec(l),p=m&&f.handler(a,m,o-(m[0].length-n.length),t);if(p)return f.undoable&&p.setMeta(s,{transform:p,from:o,to:t,text:n}),e.dispatch(p),!0}return!1}new U(/--$/,"—");new U(/\.\.\.$/,"…");new U(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"“");new U(/"$/,"”");new U(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"‘");new U(/'$/,"’");function Ns(e,o,t=null,n){return new U(e,(r,s,a,i)=>{let l=t instanceof Function?t(s):t,u=r.tr.delete(a,i),f=u.doc.resolve(a),m=f.blockRange(),p=m&&ko(m,o,l);if(!p)return null;u.wrap(m,p);let h=u.doc.resolve(a-1).nodeBefore;return h&&h.type==o&&Do(u.doc,a-1)&&(!n||n(s,h))&&u.join(a-1),u})}function Sn(e,o,t=null){return new U(e,(n,r,s,a)=>{let i=n.doc.resolve(s),l=t instanceof Function?t(r):t;return i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),o)?n.tr.delete(s,a).setBlockType(s,s,o,l):null})}function Le(e,o,t,n={}){if(e==null)return null;const r=(Array.isArray(t)?t:[t]).filter(Jt),s=o.nodes[e].createAndFill(n,r);return s??null}const Pn={content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM(){return["p",0]}},An="paragraph";class _t extends ge{unistNodeName(){return An}static proseMirrorNodeName(){return"paragraph"}proseMirrorNodeSpec(){return Pn}unistNodeToProseMirrorNodes({schema:o,convertedChildren:t,attrs:n}){return Le(this.proseMirrorNodeName(),o,t,n)}proseMirrorNodeToUnistNodes(o,t){return[{type:this.unistNodeName(),children:t}]}}const Mn=(e,o,t,n)=>e.value?o.text(e.value,[o.marks.startend.create(t),...n??[]]):null;class In extends ge{unistNodeName(){return"text"}static proseMirrorNodeName(){return"text"}proseMirrorNodeSpec(){return{group:"inline"}}unistNodeToProseMirrorNodes({node:o,schema:t,attrs:n}){return Mn(o,t,n)}proseMirrorNodeToUnistNodes(o){return[{type:this.unistNodeName(),value:o.text??""}]}}class q extends ge{static isAtStart(o,t){return o.selection.empty?t!==void 0?t.endOfTextblock("backward",o):o.selection.$anchor.parentOffset>0:!1}static headingLevelCommandBuilder(o,t,n){return(r,s,a)=>{if(n&&!q.isAtStart(r,a))return!1;const{$anchor:i}=r.selection,l=i.parent;if(l.type.name!=="heading")return!1;const u=l.attrs.level+t;if(u<0||u>6)return!1;if(s===void 0)return!0;const f=i.before(i.depth);return u>0?s(r.tr.setNodeMarkup(f,void 0,{level:u})):s(r.tr.setNodeMarkup(f,o.nodes.paragraph)),!0}}dependencies(){return[new _t,new In]}unistNodeName(){return"heading"}static proseMirrorNodeName(){return"heading"}proseMirrorNodeSpec(){return{attrs:{level:{default:1}},content:"text*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM(o){return["h"+o.attrs.level.toString(),0]}}}proseMirrorInputRules(o){return[Sn(/^\s{0,3}(#{1,6})\s$/,o.nodes[this.proseMirrorNodeName()],t=>({level:t[1].length}))]}proseMirrorKeymap(o){const t={Tab:q.headingLevelCommandBuilder(o,1,!1),"#":q.headingLevelCommandBuilder(o,1,!0),"Shift-Tab":q.headingLevelCommandBuilder(o,-1,!1)};for(let n=1;n<=6;n++)t[`Shift-Mod-${n.toString()}`]=Lo(o.nodes[this.proseMirrorNodeName()],{level:n});return t}unistNodeToProseMirrorNodes({node:o,schema:t,convertedChildren:n,attrs:r}){const{depth:s}=o;return Le(this.proseMirrorNodeName(),t,n,{...r,level:s})}proseMirrorNodeToUnistNodes(o,t){return[{type:this.unistNodeName(),depth:o.attrs.level,children:t}]}}class On extends ge{unistNodeName(){return"root"}static proseMirrorNodeName(){return"doc"}proseMirrorNodeSpec(){return{content:"block+"}}unistNodeToProseMirrorNodes({schema:o,convertedChildren:t,attrs:n}){return Le(this.proseMirrorNodeName(),o,t,n)}proseMirrorNodeToUnistNodes(o,t){return[{type:this.unistNodeName(),children:t}]}}function Pe(e,o,t=0,n=null){let r=!1;return e.forEach((s,a)=>{Pe(s,o,t+a+(e.type.name===On.proseMirrorNodeName()?0:1),e)===!1&&(r=!0)}),r?r?!1:void 0:o(e,t,n)}function Rn(e,o){const t=new Array(o.length).fill(-1),n=()=>!t.includes(-1);let r=!1;const s=(a,i)=>{const l=bo(a);if(l==null)return;const{start:u,end:f}=l;for(let m=0;m<o.length;m++){const p=o[m];t[m]===-1&&(p>=u&&p<f&&(a.type.name!=="doc"||r)||p==f&&r||p<u&&p<f&&r&&p>=0)&&(p===f&&(t[m]=i+a.nodeSize),a.content.size===0&&(a.text?.length??0)===0?t[m]=i:t[m]=Math.min(i+Math.max(p-u,0),i+a.nodeSize))}if(n())return!1};Pe(e,s),r=!0,n()||Pe(e,s);for(let a=0;a<t.length;a++)t[a]===-1&&(o[a]<=0?t[a]=0:t[a]=e.nodeSize-2);return t}function Ln(e,o){const t=Dn(e);if(t.length===0)return o;let n=o;return t.forEach(r=>{n=wn(r,n)}),n}function wn(e,o){return yo(o,{start:e.from,end:e.to},kn(e))}function kn(e){return e.slice.size-(e.to-e.from)}function Dn(e){return e.steps.filter(o=>o instanceof jo)}const le=new Bo("comments");function qe(e,o){const t=o.map(s=>s.at.start),n=o.map(s=>s.at.end),r=Rn(e,[...t,...n]);return new Map(o.map((s,a)=>[s.id,{start:r[a],end:r[a+o.length]}]))}function jn(e,o){const{type:t}=o;if(t===Y.SELECTION){const{from:s,to:a}=o;return[s,a]}const{pos:n}=o,r=n+(e.nodeAt(n)?.nodeSize??0);return[n,r]}const Ze=(e,o,t=null,n=null)=>{const r=[],s=Array.from(o.entries()).reverse(),a=new Map(e.map(i=>[i.id,i]));for(const[i,l]of s){const u=a.get(i),p=To({isHovered:t===i,isFocused:n===i,isCode:!1,diffStatus:u?.diffStatus});r.push(mt.inline(l.start,l.end,{class:p,"data-comment-id":i,nodeName:"span"}))}return r},Ts=e=>new ft({key:le,state:{init:(o,{doc:t})=>{const n=qe(t,e);return{comments:e,commentingOn:null,hoveredOnBlock:null,hoveredCommentId:null,focusedCommentId:null,decorations:Ze(e,n),positions:n}},apply:(o,t)=>{const n=o.getMeta(le)??{},r=n.comments,s=r??t.comments,a=r!=null?qe(o.doc,s):t.positions;let i=n.commentingOn;i===void 0&&(i=t.commentingOn);let l=n.hoveredCommentId;l===void 0&&(l=t.hoveredCommentId);let u=n.focusedCommentId;u===void 0&&(u=t.focusedCommentId);const f=Ln(o,a),m=No(s,f);return{comments:m,commentingOn:i,hoveredCommentId:l,focusedCommentId:u,decorations:Ze(m,f,l,u),positions:f}}},props:{handleClickOn:(o,t,n,r,s)=>{const{target:a}=s;if(a instanceof HTMLElement){const{commentId:i}=a.dataset;if(!i)return;w.focusComment(i)}},handleDOMEvents:{mouseover(o,t){const{target:n}=t;if(n instanceof HTMLElement){const{commentId:r}=n.dataset;r?w.mouseEnterComment(r):w.mouseLeaveComment()}}},decorations(o){const t=this.getState(o);if(!t)return Ye.empty;const{commentingOn:n,decorations:r}=t,{doc:s}=o;if(n){const[a,i]=jn(s,n);a!=null&&i!=null&&r.push(mt.inline(a,i,{class:Qt.document},{comment:{pattern:n}}))}return Ye.create(s,r.concat())}}});function Bn(e,o,t){const n=e+o;for(const r of t.values()){const s=r.start,a=r.end;if(e<a&&s<n)return!0}return!1}const Gn=50,Vn=200,Fn=[_t.proseMirrorNodeName(),q.proseMirrorNodeName()],Hn=e=>e?e.isBlock:!1,$n=e=>{if(!e)return!1;const{isBlock:o,type:{name:t}}=e;return o&&Fn.includes(t)},Yn=(e,o,t,n)=>{const r=e.posAtCoords({left:o,top:t});if(r==null)return;const{pos:s,inside:a}=r;if(a===-1)return;const{state:i}=e;let l=s,u=i.doc.nodeAt(l);for(;!Hn(u)&&l>=0;)l--,u=i.doc.nodeAt(l);if(!u||!$n(u))return;const f=n!=null&&Bn(l,u.nodeSize,n);return{node:u,nodeHasComment:f,pos:l}};function Un(e,o,t){const n=Yn(e,o.x,o.y,t);if(n==null)return null;const{node:r,pos:s,nodeHasComment:a}=n,{top:i}=e.coordsAtPos(0);function l(){const h=s+1;return yn(e.state.doc,h)&&e.state.doc.nodeAt(h)?.isText?e.coordsAtPos(h).top:e.coordsAtPos(s).top}const u=l(),f=u-i;return{height:e.coordsAtPos(s+r.nodeSize-1).bottom-u,nodeHasComment:a,mouseEnteredAt:Date.now(),yOffset:f,pos:s}}function Kn(e){const o=g.useRef(!1),t=g.useRef(!1),[n,r]=g.useState(null),s=So(),a=s()?.dom,i=g.useRef(!1),l=V(({visibleBlockCommentLauncher_DEBUG_ONLY:m})=>m),u=g.useCallback(eo(m=>{o.current=!0;const{commentingOn:p}=V.getState();if(t.current||p!=null)return;const h=s();if(h==null||!o.current)return r(null);const{dom:v,state:C}=h,x=Et(le,C)?.positions;if(x==null)return r(null);const E=Un(h,m,x);if(E==null||E.nodeHasComment&&e===j.COLLAPSED){r(null);return}if(i.current&&E.yOffset!==n?.yOffset){r(null);return}const _=h.coordsAtPos(0),A=v.getBoundingClientRect().width,T=(m.x-_.left)/A>=Gn/100;r(T?E:null)},Vn),[s,i,n]);g.useEffect(()=>{if(a!=null)return it(a,{mouseenter:()=>{o.current=!0,t.current=!1},mouseleave:({relatedTarget:m})=>{if(u.cancel(),m instanceof HTMLElement&&m.closest("[data-block-comment-launcher]")){t.current=!0;return}t.current=!1,o.current=!1,V.getState().commentingOn==null&&r(null)},mousemove:u})},[s,a,e,u]);const f=g.useCallback(({relatedTarget:m})=>{const{commentingOn:p}=V.getState();p==null&&m!==a&&(t.current=!1,r(null))},[a]);return{visibleBlockComment:l??n,handleMouseLeave:f,onComposerVisibleChange:m=>{i.current=m}}}const zn=({isWaitingForCommentResponse:e=!1,opensOverDocument:o=!1,hasComments:t=!1,activeBlockComment:n,composerRef:r,onLaunchComposer:s,onMouseLeave:a,onSubmit:i})=>{const[l,u]=g.useState(!1),{yOffset:f,height:m,pos:p}=n,h=()=>{u(!0),s?.(),D.logButtonClick(W.BLOCK_COMMENT_LAUNCHER),w.startCommentingOn({type:Y.BLOCK,pos:p})},v=E=>{E||(u(!1),w.cancelCommentingOn())},C=E=>{u(!1),i?.(E)};g.useEffect(()=>()=>{w.mouseLeaveBlock()},[]);const x=t&&l?o?-88:88:0;return c.jsx(k.div,{className:O("pointer-events-auto absolute flex h-6 w-5 origin-[14px_50%] items-start after:absolute after:-inset-4 after:content-['']",B.commentComposer),initial:!1,animate:{opacity:1},exit:{opacity:0},transition:{type:"spring",duration:.2,bounce:.1},style:{top:0,height:m,translateY:f},onMouseLeave:a,"data-block-comment-launcher":!0,children:c.jsxs(X,{children:[l?c.jsx(Ct,{ref:r,opensFromGutter:!0,onClose:v,onSubmit:C,gutterHasComments:t,opensOverDocument:o},"composer"):null,c.jsx(k.button,{initial:{opacity:0},animate:{opacity:l?0:1,translateX:x},transition:{duration:.15,translateX:{type:"spring",bounce:.18,duration:.48}},className:"group absolute z-10 flex h-6 gap-1 bg-transparent after:absolute after:-inset-y-4 after:-left-1 after:-right-4 after:content-['']",onClick:h,onMouseEnter:()=>w.mouseEnterBlock(p),onMouseLeave:()=>w.mouseLeaveBlock(),disabled:l||e,children:c.jsx(pn,{isLoading:e})},"launcer")]})})},Xn=({isWaitingForCommentResponse:e=!1,isRequestActive:o=!1,hasComments:t=!1,composerRef:n,gutterMode:r,onAddComment:s})=>{const a=ut(),{visibleBlockComment:i,handleMouseLeave:l,onComposerVisibleChange:u}=Kn(r),f=m=>{if(!i||!a)return;const{doc:p}=a,{pos:h}=i,v=p.nodeAt(h);if(!v)return;const{attrs:{start:C,end:x}}=v;s?.(m,dt.ASK,{start:C,end:x},Y.BLOCK)};return c.jsx(X,{onExitComplete:()=>u(!1),children:i&&a&&(e||!o)&&c.jsx(zn,{composerRef:n,isWaitingForCommentResponse:e,opensOverDocument:r===j.COLLAPSED,activeBlockComment:i,hasComments:t,onSubmit:f,onMouseLeave:l,onLaunchComposer:()=>u(!0)},"launcher")})},bt={type:"spring",bounce:.12,duration:.5},yt="opacity-50",Wn=({count:e,offsetY:o,isLoading:t=!1,onClick:n})=>c.jsx(k.div,{className:O("absolute",B.collapsedComment),initial:{opacity:0},animate:{opacity:1},style:{translateY:o},transition:bt,exit:{opacity:0},children:c.jsx(mn,{count:e,isLoading:t,onClick:n})}),qn=({isFocused:e,isHovered:o})=>{const t=e||o?"grow font-medium text-token-text-primary transition-colors":"grow font-medium text-token-text-secondary transition-colors",n=e||o?"opacity-100 transition":"opacity-75 transition";return c.jsxs(c.Fragment,{children:[c.jsx("div",{className:n,children:c.jsx("div",{className:"gizmo-bot-avatar rounded-full",children:c.jsx(to,{size:"gizmoConversation",iconName:"openai"})})}),c.jsx("span",{className:t,children:"ChatGPT"})]})},Zn=({comment:e,isFocused:o,isSomeCommentFocused:t,isHovered:n})=>{const r=e.diffStatus===Ne.REMOVED;return c.jsx("div",{className:O("mt-2 text-token-text-primary transition-all",{"opacity-80":!o&&!t&&!n&&!r,"opacity-40":!o&&t&&!n&&!r,[yt]:r}),children:e.content})},Jn=({left:e,right:o,comment:t,disableAnimations:n=!1,onClick:r,onMouseEnter:s,onMouseLeave:a,onAccept:i,onDismiss:l,translateY:u,isFocused:f=!1,isSomeCommentFocused:m=!1,disableActions:p=!1,isHovered:h=!1},v)=>{const[C,x]=g.useState(!1),E=t.diffStatus===Ne.ADDED,_=t.diffStatus===Ne.REMOVED,A=t.diffStatus!=null,b=()=>{x(!0),s?.()},T=()=>{x(!1),a?.()},S=Oe(),P=f||C&&!m;return c.jsx(k.div,{ref:v,className:O("absolute",B.expandedComment,{"cursor-default":f,"cursor-pointer":!f,[B.expandedCommentFocused]:f,[B.expandedCommentHovered]:h}),style:{left:e,right:o},initial:n?!1:{translateY:u,scale:.85,opacity:0},animate:n?void 0:{translateY:u,scale:f?1:.97,opacity:1},exit:n?void 0:{scale:.85,opacity:0,filter:"blur(16px)"},transition:bt,onClick:r,onMouseEnter:p?void 0:b,onMouseLeave:p?void 0:T,"data-comment-id":t.id,children:c.jsxs("div",{className:O("flex min-h-8 flex-col overflow-hidden rounded-2xl border p-4 pt-2 text-left text-sm transition-all",{"border-transparent bg-gray-50 dark:bg-gray-800":!f&&!h,"border-token-border-light bg-token-main-surface-primary":h&&!f,"border-token-border-light bg-token-main-surface-primary shadow-xl":f||C&&!m,"relative after:absolute after:bottom-0 after:left-0 after:top-0 after:w-1":A,"after:bg-green-500":E,"after:bg-red-500":_}),style:{width:se},children:[c.jsxs("div",{className:O("flex h-8 flex-row items-center gap-2.5",{[yt]:_}),children:[c.jsx(qn,{isFocused:f,isHovered:h}),c.jsx("button",{className:O("-mr-1 rounded-full bg-transparent p-1 text-token-text-secondary",{"cursor-pointer hover:bg-gray-100 hover:text-token-text-primary dark:hover:bg-gray-700":!p,"cursor-not-allowed":p}),onClick:l,disabled:p,"aria-label":S.formatMessage({id:"fYDa3C",defaultMessage:"Dismiss comment"}),children:c.jsx(Oo,{className:"icon-sm"})})]}),c.jsx(Zn,{comment:t,isFocused:f,isHovered:h,isSomeCommentFocused:m}),c.jsx(X,{initial:!1,children:P&&c.jsx(k.div,{initial:n?!1:{opacity:0,height:0},animate:{opacity:1,height:"auto",transition:{opacity:{delay:.14,duration:.2},height:{bounce:0,duration:.2}}},exit:n?void 0:{opacity:0,height:0,transition:{opacity:{duration:.08},height:{bounce:0,duration:.2}}},className:"flex items-center justify-start",children:c.jsx("div",{className:"mt-2.5",children:c.jsx(po,{color:"secondary",onClick:i,disabled:p,children:S.formatMessage({id:"WIW5OL",defaultMessage:"Apply"})})})})})]})})},Nt=g.forwardRef(Jn),Qn=({offsetY:e,opensOverDocument:o=!1,disableActions:t=!1,isFocused:n=!1,isSomeCommentFocused:r=!1,onAccept:s,onClick:a,onDismiss:i,onMouseEnter:l,onMouseLeave:u,comment:f,isHovered:m=!1})=>{const p=g.useRef(null);return g.useEffect(()=>it(document,{mousedown:({target:h})=>{h instanceof HTMLElement&&!h.closest("[data-comment-id]")&&!p.current?.contains(h)&&w.blurComment()}})),c.jsx(Nt,{ref:p,comment:f,disableActions:t,onAccept:s,onDismiss:i,onMouseEnter:l,onMouseLeave:u,isSomeCommentFocused:r,isHovered:m,onClick:a,translateY:e,isFocused:n,left:o?void 0:st,right:o?oo:void 0})},er=({onAcceptComment:e,onDismissComment:o,disableActions:t=!1,entry:n,isGutterCollapsed:r=!1,isHovered:s=!1,isFocused:a=!1,isSomeCommentFocused:i=!1})=>{const{offsetY:l,type:u}=n,[f,m]=no();let p=null;if(u===L.COLLAPSED)p=!a&&c.jsx(Wn,{offsetY:l,count:n.count,onClick:()=>{D.logButtonClick(W.COLLAPSED_COMMENT),w.focusComment(n.children[0])}},"collapsed");else{const{comment:h}=n;if(h==null||h.content===""||h.status===Fe.DISMISSED)p=null;else if(h.status===Fe.ACCEPT_INITIATED)p=c.jsx("div",{className:"absolute",style:{top:l},children:c.jsx(he,{})},"loading");else{const{id:v}=h;p=c.jsx(Qn,{isSomeCommentFocused:i,isHovered:s,isFocused:a,offsetY:l,disableActions:t,onClick:()=>{D.logButtonClick(W.EXPANDED_COMMENT),w.focusComment(v)},onMouseEnter:()=>w.mouseEnterComment(v),onMouseLeave:()=>w.mouseLeaveComment(),comment:h,onAccept:()=>{D.logButtonClick(W.COMMENT_ACCEPT,{commentId:v}),e?.(v)},onDismiss:()=>{D.logButtonClick(W.COMMENT_DISMISS,{commentId:v}),o?.(v)},opensOverDocument:r},"expanded")}}return c.jsx(X,{onExitComplete:()=>m?.(),children:f&&p})},Je=({onMeasureHeight:e,comment:o,isFocused:t=!1})=>{const[{height:n},r]=fe();return ct(()=>{e?.(n)},[n]),c.jsx(Nt,{ref:r,comment:o,isFocused:t,disableAnimations:!0})},tr=({comments:e,onMeasure:o,getStableCommentId:t})=>{const n=g.useRef(new Map),r=g.useRef(new Map),s=g.useRef(null),a=(i,l,u=!1)=>{l&&(u?r.current.set(t(i),l):n.current.set(t(i),l),s.current&&cancelAnimationFrame(s.current),s.current=requestAnimationFrame(()=>{o?.({focusedHeights:new Map(r.current),heights:new Map(n.current)}),s.current=null}))};return e?.length?c.jsxs("div",{className:"pointer-events-none invisible fixed left-0 top-0 overflow-clip","aria-hidden":"true",children:[e.map(i=>c.jsx(Je,{comment:i,onMeasureHeight:l=>a(i.id,l)},t(i.id))),e.map(i=>c.jsx(Je,{isFocused:!0,comment:i,onMeasureHeight:l=>a(i.id,l,!0)},`${t(i.id)}-focused`))]}):null},Qe=(e,o,t)=>{let n=t+o;for(;o===H.down?n<e.length:n>-1;){const r=e[n],s=e[n-o],a=gn(Z(r),Z(s),o);if(a!=null&&r.type!==L.COLLAPSED)r.shiftY+=a;else break;n+=o}},et=(e,o)=>{for(const t of o){const{index:n,amount:r}=t,s=e[n];s.type===L.EXPANDED&&(s.shiftY+=r),Qe(e,H.down,n),Qe(e,H.up,n);for(const a of e)a.type!==L.COLLAPSED&&(a.offsetY+=a.shiftY,a.shiftY=0)}},or=(e,o)=>{const t=[],[n,r]=o,s=n+r;for(let a=0;a<e.length;a++){const i=e[a],[l]=Z(i),u=[l,i.type===L.EXPANDED?i.height:0],[f,m]=u;if(ht(u,o)){const p=f+m,h=n-p,v=s-f,x=(Math.abs(h)<Math.abs(v)?H.up:H.down)===H.up?h:v;t.push({index:a,amount:x})}}return t},nr=({gutterMode:e,focusedCommentId:o,gutterPositions:t,getCommentKey:n,getComment:r})=>{if(!t?.size)return[];const s=new Map,a=[];let i=null,l=-1;for(const f of t.values()){if(f.type===ce.COMPOSER){i=[f.offsetY,f.height];continue}const{commentId:m,height:p,collapsedOffsetY:h,offsetY:v}=f;if(e===j.EXPANDED){const E=Te(a),_=E?Se(Z(E)):0;let A=v;E&&A<=_&&(A=_),s.set(m,{originalOffsetY:v,offsetY:A}),o===m&&(l=a.length),a.push({key:n(m),comment:r(m),type:L.EXPANDED,height:p,offsetY:A,shiftY:0});continue}let C=a.findIndex(({offsetY:E,type:_})=>_===L.COLLAPSED&&E===h),x=a[C]??null;if(!x)x={key:a.length,type:L.COLLAPSED,offsetY:v,count:1,children:[m]},C=a.length,a.push(x);else{if(x.type!==L.COLLAPSED)throw new Error("Collapsed parent type expected to be collapsed");x.count+=1,x.children.push(m),x.offsetY=h}o===m&&(l=C)}const u=a[l];if(e===j.COLLAPSED&&u?.type===L.COLLAPSED){const f=[];for(let m=0;m<u.children.length;m++){const p=u.children[m];p===o&&(l+=m+1);const h=Te(f),v=h?Se(Z(h)):0,C=t.get(p)?.offsetY??0,x=Math.max(v,C);s.set(p,{originalOffsetY:C,offsetY:x}),f.push({type:L.EXPANDED,key:n(p),comment:r(p),offsetY:x,height:t.get(p)?.height??0,shiftY:0})}a.splice(l,0,...f)}if(o){const f=s.get(o);if(!f)return a;const{offsetY:m,originalOffsetY:p}=f,h=p-m,v=[{amount:h,index:l}];let C=l+1;for(;C<a.length;){const x=a[C],{type:E}=x;let _=h;if(E===L.EXPANDED&&x.comment?.id){const{offsetY:A,originalOffsetY:b}=ie(s.get(x.comment.id));if(A===b)break;_=Math.max(b-A,h)}else break;v.push({amount:_,index:C}),C++}v.length&&et(a,v)}else if(e!==j.COLLAPSED&&i){const f=or(a,i);et(a,f)}return a},rr=e=>{try{return nr(e)}catch(o){return D.logError("Generating comment gutter entries",o),[]}},sr=e=>"length"in e?e.length===0:e.nodeSize===0,be=12,ar=({composerHeight:e,getCommentHeight:o,getCollapsedStartPos:t,commentingOn:n,commentPositions:r,view:s})=>{if(!r||!s||sr(s.state.doc))return null;const{top:a}=s.dom.getBoundingClientRect(),i=Array.from(r.entries()).sort(([u,f],[m,p])=>f.start-p.start),l=new Map;for(const[u,{start:f}]of i)try{const m=t?.(f)??f,{top:p}=ee(s,m),{top:h}=ee(s,f),v=h-a,C=p-a,x=(o(u)??0)+be;l.set(u,{commentId:u,height:x,collapsedOffsetY:C,offsetY:v,type:ce.COMMENT})}catch{continue}if(n?.type===Y.BLOCK){const{pos:u}=n;try{const{top:f}=ee(s,u),p=f-a-be;l.set("block-composer",{type:ce.COMPOSER,height:(e??0)+be,offsetY:p})}catch{}}return l},Tt=(e,o)=>o.nodeAt(e)?.isBlock?e+1:Tt(e-1,o);function ir(e){const o=ut(),n=me()?.();if(!n)return null;if(pe(n)){if(!o)return null;const r=Et(le,o);return r?r.positions:null}return new Map(e.map(r=>[r.id,r.at]))}const cr=({gutterMode:e,focusedCommentId:o,commentingOn:t,comments:n,getStableId:r})=>{const[{height:s},a]=fe(),i=me(),[l,u]=g.useState(()=>new Map),[f,m]=g.useState(()=>new Map),p=g.useCallback(({focusedHeights:b,heights:T})=>{u(b),m(T)},[]),h=b=>{const T=r(b);return b===o?l.get(T)??0:f.get(T)??0},v=i(),C=v!=null&&pe(v)?b=>Tt(b,v.state.doc):void 0,x=new Map(n?.map(b=>[r(b.id),b])),E=ir(n),_=ar({composerHeight:s,commentingOn:t,getCommentHeight:h,getCollapsedStartPos:C,commentPositions:E,view:v}),A=rr({gutterMode:e,gutterPositions:_,focusedCommentId:o,getComment:b=>x.get(r(b))??null,getCommentKey:r});return{blockComposerRef:a,onMeasureComments:p,gutterEntries:A}};function lr(){const o=me()(),t=V(({commentingOn:s})=>s),r=o==null?null:Cn(o,t);return r==null?null:c.jsx(k.div,{className:"absolute",style:{top:r.loadingTop},initial:!1,animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},transition:{delay:.2},children:c.jsx(he,{})},"selection-loading")}const ur=e=>c.jsx("div",{className:"absolute",style:{top:Se(Z(e))},children:c.jsx("div",{className:"h-[max(3rem,18vh)] w-1"})}),Ss=({availableWidth:e,comments:o,commentsMode:t,disableBlockComments:n=!1,isRequestActive:r=!1,isWaitingForCommentResponse:s=!1,onAddComment:a,onAcceptComment:i,onDismissComment:l,getStableCommentId:u})=>{const f=V(({focusedCommentId:P})=>P),m=V(({hoveredCommentId:P})=>P),p=V(({commentingOn:P})=>P),h=e<He?j.COLLAPSED:j.EXPANDED,{onMeasureComments:v,blockComposerRef:C,gutterEntries:x}=cr({comments:o,getStableId:u,gutterMode:h,focusedCommentId:f,commentingOn:p}),E=x.length>0,_=p!=null&&!s&&p.type!=="selection"||E,b=(()=>{if(!_)return 0;switch(h){case j.COLLAPSED:return 0;case j.EXPANDED:return He}})(),T=p?.type==="selection",S=Te(x);return c.jsxs(k.div,{className:O("pointer-events-none relative flex h-full flex-shrink-0",B.commentGutter,h===j.COLLAPSED&&b?"basis-[32px]":"basis-0"),initial:{width:0,opacity:0},animate:{width:b,opacity:1},exit:{width:0,opacity:0},children:[c.jsx(tr,{getStableCommentId:u,comments:o,onMeasure:v}),c.jsxs("div",{className:O("pointer-events-auto absolute bottom-0 left-0 top-0 w-0 overflow-visible",{"pl-2":_||!n}),children:[c.jsx(X,{children:x.map(P=>{const{key:I,type:oe}=P,ne=!!f&&oe===L.EXPANDED&&P.comment?.id===f,Q=!!f&&P.type===L.COLLAPSED&&P.children.includes(f);return c.jsx(er,{isGutterCollapsed:h===j.COLLAPSED,isSomeCommentFocused:!!p||!!f,isHovered:oe===L.EXPANDED&&P.comment?.id===m,isFocused:ne||Q,entry:P,disableActions:r||s||t===$e.COMMENTS_READONLY,onAcceptComment:K=>{try{i?.(ie(o?.find(G=>G.id===K)))}catch(G){D.logError(`Comment ${K} not found`,G)}},onDismissComment:K=>{try{l?.(ie(o?.find(G=>G.id===K)))}catch(G){D.logError(`Comment ${K} not found`,G)}}},I)})}),E&&S&&c.jsx(ur,{...S}),t===$e.ENABLED&&!T&&!n&&c.jsx(Xn,{composerRef:C,gutterMode:h,onAddComment:a,isWaitingForCommentResponse:s,isRequestActive:r,hasComments:E}),s&&T&&c.jsx(lr,{})]})]})};function $(e,o,{checkForDefaultPrevented:t=!0}={}){return function(r){if(e?.(r),t===!1||!r.defaultPrevented)return o?.(r)}}function ve(e,o=[]){let t=[];function n(s,a){const i=g.createContext(a),l=t.length;t=[...t,a];function u(m){const{scope:p,children:h,...v}=m,C=p?.[e][l]||i,x=g.useMemo(()=>v,Object.values(v));return c.jsx(C.Provider,{value:x,children:h})}function f(m,p){const h=p?.[e][l]||i,v=g.useContext(h);if(v)return v;if(a!==void 0)return a;throw new Error(`\`${m}\` must be used within \`${s}\``)}return u.displayName=s+"Provider",[u,f]}const r=()=>{const s=t.map(a=>g.createContext(a));return function(i){const l=i?.[e]||s;return g.useMemo(()=>({[`__scope${e}`]:{...i,[e]:l}}),[i,l])}};return r.scopeName=e,[n,dr(r,...o)]}function dr(...e){const o=e[0];if(e.length===1)return o;const t=()=>{const n=e.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(s){const a=n.reduce((i,{useScope:l,scopeName:u})=>{const m=l(s)[`__scope${u}`];return{...i,...m}},{});return g.useMemo(()=>({[`__scope${o.scopeName}`]:a}),[a])}};return t.scopeName=o.scopeName,t}function fr(e,o){typeof e=="function"?e(o):e!=null&&(e.current=o)}function St(...e){return o=>e.forEach(t=>fr(t,o))}function Ae(...e){return g.useCallback(St(...e),e)}var ue=g.forwardRef((e,o)=>{const{children:t,...n}=e,r=g.Children.toArray(t),s=r.find(pr);if(s){const a=s.props.children,i=r.map(l=>l===s?g.Children.count(a)>1?g.Children.only(null):g.isValidElement(a)?a.props.children:null:l);return c.jsx(Me,{...n,ref:o,children:g.isValidElement(a)?g.cloneElement(a,void 0,i):null})}return c.jsx(Me,{...n,ref:o,children:t})});ue.displayName="Slot";var Me=g.forwardRef((e,o)=>{const{children:t,...n}=e;if(g.isValidElement(t)){const r=hr(t);return g.cloneElement(t,{...gr(n,t.props),ref:o?St(o,r):r})}return g.Children.count(t)>1?g.Children.only(null):null});Me.displayName="SlotClone";var mr=({children:e})=>c.jsx(c.Fragment,{children:e});function pr(e){return g.isValidElement(e)&&e.type===mr}function gr(e,o){const t={...o};for(const n in o){const r=e[n],s=o[n];/^on[A-Z]/.test(n)?r&&s?t[n]=(...i)=>{s(...i),r(...i)}:r&&(t[n]=r):n==="style"?t[n]={...r,...s}:n==="className"&&(t[n]=[r,s].filter(Boolean).join(" "))}return{...e,...t}}function hr(e){let o=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,t=o&&"isReactWarning"in o&&o.isReactWarning;return t?e.ref:(o=Object.getOwnPropertyDescriptor(e,"ref")?.get,t=o&&"isReactWarning"in o&&o.isReactWarning,t?e.props.ref:e.props.ref||e.ref)}function vr(e){const o=e+"CollectionProvider",[t,n]=ve(o),[r,s]=t(o,{collectionRef:{current:null},itemMap:new Map}),a=h=>{const{scope:v,children:C}=h,x=R.useRef(null),E=R.useRef(new Map).current;return c.jsx(r,{scope:v,itemMap:E,collectionRef:x,children:C})};a.displayName=o;const i=e+"CollectionSlot",l=R.forwardRef((h,v)=>{const{scope:C,children:x}=h,E=s(i,C),_=Ae(v,E.collectionRef);return c.jsx(ue,{ref:_,children:x})});l.displayName=i;const u=e+"CollectionItemSlot",f="data-radix-collection-item",m=R.forwardRef((h,v)=>{const{scope:C,children:x,...E}=h,_=R.useRef(null),A=Ae(v,_),b=s(u,C);return R.useEffect(()=>(b.itemMap.set(_,{ref:_,...E}),()=>void b.itemMap.delete(_))),c.jsx(ue,{[f]:"",ref:A,children:x})});m.displayName=u;function p(h){const v=s(e+"CollectionConsumer",h);return R.useCallback(()=>{const x=v.collectionRef.current;if(!x)return[];const E=Array.from(x.querySelectorAll(`[${f}]`));return Array.from(v.itemMap.values()).sort((b,T)=>E.indexOf(b.ref.current)-E.indexOf(T.ref.current))},[v.collectionRef,v.itemMap])}return[{Provider:a,Slot:l,ItemSlot:m},p,n]}var xr=globalThis?.document?g.useLayoutEffect:()=>{},Cr=go.useId||(()=>{}),Er=0;function _r(e){const[o,t]=g.useState(Cr());return xr(()=>{t(n=>n??String(Er++))},[e]),o?`radix-${o}`:""}var br=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],F=br.reduce((e,o)=>{const t=g.forwardRef((n,r)=>{const{asChild:s,...a}=n,i=s?ue:o;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),c.jsx(i,{...a,ref:r})});return t.displayName=`Primitive.${o}`,{...e,[o]:t}},{});function we(e){const o=g.useRef(e);return g.useEffect(()=>{o.current=e}),g.useMemo(()=>(...t)=>o.current?.(...t),[])}function xe({prop:e,defaultProp:o,onChange:t=()=>{}}){const[n,r]=yr({defaultProp:o,onChange:t}),s=e!==void 0,a=s?e:n,i=we(t),l=g.useCallback(u=>{if(s){const m=typeof u=="function"?u(e):u;m!==e&&i(m)}else r(u)},[s,e,r,i]);return[a,l]}function yr({defaultProp:e,onChange:o}){const t=g.useState(e),[n]=t,r=g.useRef(n),s=we(o);return g.useEffect(()=>{r.current!==n&&(s(n),r.current=n)},[n,r,s]),t}var Nr=g.createContext(void 0);function ke(e){const o=g.useContext(Nr);return e||o||"ltr"}var ye="rovingFocusGroup.onEntryFocus",Tr={bubbles:!1,cancelable:!0},Ce="RovingFocusGroup",[Ie,Pt,Sr]=vr(Ce),[Pr,Ee]=ve(Ce,[Sr]),[Ar,Mr]=Pr(Ce),At=g.forwardRef((e,o)=>c.jsx(Ie.Provider,{scope:e.__scopeRovingFocusGroup,children:c.jsx(Ie.Slot,{scope:e.__scopeRovingFocusGroup,children:c.jsx(Ir,{...e,ref:o})})}));At.displayName=Ce;var Ir=g.forwardRef((e,o)=>{const{__scopeRovingFocusGroup:t,orientation:n,loop:r=!1,dir:s,currentTabStopId:a,defaultCurrentTabStopId:i,onCurrentTabStopIdChange:l,onEntryFocus:u,preventScrollOnEntryFocus:f=!1,...m}=e,p=g.useRef(null),h=Ae(o,p),v=ke(s),[C=null,x]=xe({prop:a,defaultProp:i,onChange:l}),[E,_]=g.useState(!1),A=we(u),b=Pt(t),T=g.useRef(!1),[S,P]=g.useState(0);return g.useEffect(()=>{const I=p.current;if(I)return I.addEventListener(ye,A),()=>I.removeEventListener(ye,A)},[A]),c.jsx(Ar,{scope:t,orientation:n,dir:v,loop:r,currentTabStopId:C,onItemFocus:g.useCallback(I=>x(I),[x]),onItemShiftTab:g.useCallback(()=>_(!0),[]),onFocusableItemAdd:g.useCallback(()=>P(I=>I+1),[]),onFocusableItemRemove:g.useCallback(()=>P(I=>I-1),[]),children:c.jsx(F.div,{tabIndex:E||S===0?-1:0,"data-orientation":n,...m,ref:h,style:{outline:"none",...e.style},onMouseDown:$(e.onMouseDown,()=>{T.current=!0}),onFocus:$(e.onFocus,I=>{const oe=!T.current;if(I.target===I.currentTarget&&oe&&!E){const ne=new CustomEvent(ye,Tr);if(I.currentTarget.dispatchEvent(ne),!ne.defaultPrevented){const Q=b().filter(z=>z.focusable),K=Q.find(z=>z.active),G=Q.find(z=>z.id===C),qt=[K,G,...Q].filter(Boolean).map(z=>z.ref.current);Ot(qt,f)}}T.current=!1}),onBlur:$(e.onBlur,()=>_(!1))})})}),Mt="RovingFocusGroupItem",It=g.forwardRef((e,o)=>{const{__scopeRovingFocusGroup:t,focusable:n=!0,active:r=!1,tabStopId:s,...a}=e,i=_r(),l=s||i,u=Mr(Mt,t),f=u.currentTabStopId===l,m=Pt(t),{onFocusableItemAdd:p,onFocusableItemRemove:h}=u;return g.useEffect(()=>{if(n)return p(),()=>h()},[n,p,h]),c.jsx(Ie.ItemSlot,{scope:t,id:l,focusable:n,active:r,children:c.jsx(F.span,{tabIndex:f?0:-1,"data-orientation":u.orientation,...a,ref:o,onMouseDown:$(e.onMouseDown,v=>{n?u.onItemFocus(l):v.preventDefault()}),onFocus:$(e.onFocus,()=>u.onItemFocus(l)),onKeyDown:$(e.onKeyDown,v=>{if(v.key==="Tab"&&v.shiftKey){u.onItemShiftTab();return}if(v.target!==v.currentTarget)return;const C=Lr(v,u.orientation,u.dir);if(C!==void 0){if(v.metaKey||v.ctrlKey||v.altKey||v.shiftKey)return;v.preventDefault();let E=m().filter(_=>_.focusable).map(_=>_.ref.current);if(C==="last")E.reverse();else if(C==="prev"||C==="next"){C==="prev"&&E.reverse();const _=E.indexOf(v.currentTarget);E=u.loop?wr(E,_+1):E.slice(_+1)}setTimeout(()=>Ot(E))}})})})});It.displayName=Mt;var Or={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Rr(e,o){return o!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function Lr(e,o,t){const n=Rr(e.key,t);if(!(o==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(o==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return Or[n]}function Ot(e,o=!1){const t=document.activeElement;for(const n of e)if(n===t||(n.focus({preventScroll:o}),document.activeElement!==t))return}function wr(e,o){return e.map((t,n)=>e[(o+n)%e.length])}var Rt=At,De=It,kr="Separator",tt="horizontal",Dr=["horizontal","vertical"],Lt=g.forwardRef((e,o)=>{const{decorative:t,orientation:n=tt,...r}=e,s=jr(n)?n:tt,i=t?{role:"none"}:{"aria-orientation":s==="vertical"?s:void 0,role:"separator"};return c.jsx(F.div,{"data-orientation":s,...i,...r,ref:o})});Lt.displayName=kr;function jr(e){return Dr.includes(e)}var Br=Lt,Gr="Toggle",wt=g.forwardRef((e,o)=>{const{pressed:t,defaultPressed:n=!1,onPressedChange:r,...s}=e,[a=!1,i]=xe({prop:t,onChange:r,defaultProp:n});return c.jsx(F.button,{type:"button","aria-pressed":a,"data-state":a?"on":"off","data-disabled":e.disabled?"":void 0,...s,ref:o,onClick:$(e.onClick,()=>{e.disabled||i(!a)})})});wt.displayName=Gr;var J="ToggleGroup",[kt,Dt]=ve(J,[Ee]),jt=Ee(),je=R.forwardRef((e,o)=>{const{type:t,...n}=e;if(t==="single"){const r=n;return c.jsx(Vr,{...r,ref:o})}if(t==="multiple"){const r=n;return c.jsx(Fr,{...r,ref:o})}throw new Error(`Missing prop \`type\` expected on \`${J}\``)});je.displayName=J;var[Bt,Gt]=kt(J),Vr=R.forwardRef((e,o)=>{const{value:t,defaultValue:n,onValueChange:r=()=>{},...s}=e,[a,i]=xe({prop:t,defaultProp:n,onChange:r});return c.jsx(Bt,{scope:e.__scopeToggleGroup,type:"single",value:a?[a]:[],onItemActivate:i,onItemDeactivate:R.useCallback(()=>i(""),[i]),children:c.jsx(Vt,{...s,ref:o})})}),Fr=R.forwardRef((e,o)=>{const{value:t,defaultValue:n,onValueChange:r=()=>{},...s}=e,[a=[],i]=xe({prop:t,defaultProp:n,onChange:r}),l=R.useCallback(f=>i((m=[])=>[...m,f]),[i]),u=R.useCallback(f=>i((m=[])=>m.filter(p=>p!==f)),[i]);return c.jsx(Bt,{scope:e.__scopeToggleGroup,type:"multiple",value:a,onItemActivate:l,onItemDeactivate:u,children:c.jsx(Vt,{...s,ref:o})})});je.displayName=J;var[Hr,$r]=kt(J),Vt=R.forwardRef((e,o)=>{const{__scopeToggleGroup:t,disabled:n=!1,rovingFocus:r=!0,orientation:s,dir:a,loop:i=!0,...l}=e,u=jt(t),f=ke(a),m={role:"group",dir:f,...l};return c.jsx(Hr,{scope:t,rovingFocus:r,disabled:n,children:r?c.jsx(Rt,{asChild:!0,...u,orientation:s,dir:f,loop:i,children:c.jsx(F.div,{...m,ref:o})}):c.jsx(F.div,{...m,ref:o})})}),de="ToggleGroupItem",Ft=R.forwardRef((e,o)=>{const t=Gt(de,e.__scopeToggleGroup),n=$r(de,e.__scopeToggleGroup),r=jt(e.__scopeToggleGroup),s=t.value.includes(e.value),a=n.disabled||e.disabled,i={...e,pressed:s,disabled:a},l=R.useRef(null);return n.rovingFocus?c.jsx(De,{asChild:!0,...r,focusable:!a,active:s,ref:l,children:c.jsx(ot,{...i,ref:o})}):c.jsx(ot,{...i,ref:o})});Ft.displayName=de;var ot=R.forwardRef((e,o)=>{const{__scopeToggleGroup:t,value:n,...r}=e,s=Gt(de,t),a={role:"radio","aria-checked":e.pressed,"aria-pressed":void 0},i=s.type==="single"?a:void 0;return c.jsx(wt,{...i,...r,ref:o,onPressedChange:l=>{l?s.onItemActivate(n):s.onItemDeactivate(n)}})}),Yr=je,Ur=Ft,Be="Toolbar",[Kr,Ps]=ve(Be,[Ee,Dt]),Ge=Ee(),Ht=Dt(),[zr,$t]=Kr(Be),Yt=g.forwardRef((e,o)=>{const{__scopeToolbar:t,orientation:n="horizontal",dir:r,loop:s=!0,...a}=e,i=Ge(t),l=ke(r);return c.jsx(zr,{scope:t,orientation:n,dir:l,children:c.jsx(Rt,{asChild:!0,...i,orientation:n,dir:l,loop:s,children:c.jsx(F.div,{role:"toolbar","aria-orientation":n,dir:l,...a,ref:o})})})});Yt.displayName=Be;var Ut="ToolbarSeparator",Kt=g.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=$t(Ut,t);return c.jsx(Br,{orientation:r.orientation==="horizontal"?"vertical":"horizontal",...n,ref:o})});Kt.displayName=Ut;var Xr="ToolbarButton",Ve=g.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=Ge(t);return c.jsx(De,{asChild:!0,...r,focusable:!e.disabled,children:c.jsx(F.button,{type:"button",...n,ref:o})})});Ve.displayName=Xr;var Wr="ToolbarLink",qr=g.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=Ge(t);return c.jsx(De,{asChild:!0,...r,focusable:!0,children:c.jsx(F.a,{...n,ref:o,onKeyDown:$(e.onKeyDown,s=>{s.key===" "&&s.currentTarget.click()})})})});qr.displayName=Wr;var zt="ToolbarToggleGroup",Zr=g.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=$t(zt,t),s=Ht(t);return c.jsx(Yr,{"data-orientation":r.orientation,dir:r.dir,...s,...n,ref:o,rovingFocus:!1})});Zr.displayName=zt;var Jr="ToolbarToggleItem",Qr=g.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=Ht(t),s={__scopeToolbar:e.__scopeToolbar};return c.jsx(Ve,{asChild:!0,...s,children:c.jsx(Ur,{...r,...n,ref:o})})});Qr.displayName=Jr;var es=Yt,ts=Kt,os=(e=>(e.CODE="code",e.WRITING="writing",e))(os||{});const te=({children:e,toolbarType:o})=>c.jsx(es,{className:O("m-0 flex h-10 w-fit min-w-0 flex-shrink items-center overflow-hidden rounded-xl border border-token-border-light bg-token-main-surface-primary",rt,o==="code"?"p-0":"p-1"),children:e}),Xt=({icon:e,hideLabel:o,label:t})=>c.jsxs(c.Fragment,{children:[c.jsx(e,{className:O("icon-sm",{"mr-0.5 text-token-text-tertiary":!o,"text-token-text-primary":o})}),!o&&c.jsx("span",{className:"truncate text-sm text-token-text-primary",children:t})]}),Wt=lt(Ve)`flex h-full items-center gap-1 rounded-lg px-2.5 hover:bg-[#f5f5f5] dark:hover:bg-token-main-surface-secondary`,ns=({label:e,icon:o,hideLabel:t=!1,onClick:n,onMouseDown:r})=>c.jsx(Wt,{onClick:n,"aria-label":t?e:void 0,onMouseDown:r,children:c.jsx(Xt,{icon:o,hideLabel:t,label:e})}),rs=({icon:e,hideLabel:o,label:t,children:n})=>c.jsxs(ro,{children:[c.jsx(so,{asChild:!0,children:c.jsx(Wt,{"aria-label":o?t:void 0,children:c.jsx(Xt,{icon:e,hideLabel:o,label:t})})}),c.jsx(ao,{children:c.jsx(io,{align:"end",className:B.toolbar,sideOffset:8,children:n})})]});te.Separator=lt(ts)`mx-1 p-0 list-none h-full w-[1px] bg-token-border-light`;te.Action=ns;te.Popover=rs;const ss=({getSelectionRange:e})=>{const o=Oe(),t=()=>{const n=e();if(n==null)return;const{from:r,to:s,sourceFrom:a,sourceTo:i}=n;if(r==null||s==null||a==null||i==null){D.logError("Missing selection range on targeted edit",n);return}const l=dt.ASK;D.logButtonClick(W.TOOLBAR_ASK_CHATGPT,{action:l,sourceFrom:a,sourceTo:i}),w.startCommentingOn({type:Y.SELECTION,from:r,to:s,sourceRange:{start:a,end:i},action:l})};return c.jsx(te.Action,{label:o.formatMessage({id:"wOaJUU",defaultMessage:"Ask ChatGPT"}),onClick:t,icon:Ro})},As=({getEditorDom:e,getToolbarPosition:o,getSelectionRange:t,toolbarType:n,children:r,onAddComment:s,isWaitingForCommentResponse:a=!1})=>{const[{height:i,width:l},u]=fe(),[f,m]=g.useState(!0),[p,h]=g.useState(!1),v=e(),C=V(({commentingOn:S})=>S),[x,E]=g.useState(null),_=g.useCallback(()=>{const S=e(),P=document.getSelection();return!P||P.type!=="Range"||P.isCollapsed||!S?.contains(P.anchorNode)},[e]);g.useEffect(()=>{const S=nt(()=>{h(!0)},200,{leading:!0}),P=()=>{S.cancel(),h(!1)};return v?.addEventListener("pointerdown",S,{passive:!0}),document.addEventListener("pointerup",P,{passive:!0}),()=>{v?.removeEventListener("pointerdown",S),document.removeEventListener("pointerup",P)}},[v]),g.useEffect(()=>{const S=()=>{m(_())};return document.addEventListener("selectionchange",S,{passive:!0}),()=>{document.removeEventListener("selectionchange",S)}},[_]),ct(()=>{if(f||_())return m(!0);try{const S=o({width:l,height:i});S!=null&&E(S)}catch(S){D.logError("Invalid position in getToolbarPosition",S)}},[i,l,f,_,o]);const A=c.jsxs(te,{toolbarType:n,children:[c.jsx(ss,{getSelectionRange:t}),r]}),b=!f&&!C&&x!=null,T=Po(b);return g.useEffect(()=>{!b&&T&&!C&&v?.focus()},[v,T,b,C]),c.jsxs(c.Fragment,{children:[c.jsx("div",{"aria-hidden":"true",className:"pointer-events-none invisible fixed left-0 top-0 h-0 overflow-clip",children:c.jsx("div",{ref:u,children:A})}),c.jsx(X,{children:b&&c.jsx(k.div,{initial:{opacity:0,scale:.95},animate:{opacity:p?0:1,scale:p?.95:1},style:{top:x.top,left:x.left},exit:{opacity:0,scale:.95},transition:{type:"spring",bounce:.1,duration:.1,delay:p?0:.1},className:O("absolute",B.toolbar,p?"pointer-events-none":"pointer-events-auto"),children:A})}),c.jsx(_n,{toolbarPosition:x,commentingOn:C,isWaitingForCommentResponse:a,onAddComment:s})]})};let re=null;function Ms(){if(re!=null)return re;if(typeof window>"u")return 0;const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.overflow="scroll",e.style.position="absolute",e.style.top="-9999px",document.body.appendChild(e);try{re=e.offsetWidth-e.clientWidth}finally{document.body.removeChild(e)}return re}function Is(e){return e==null?null:e.scrollHeight>e.clientHeight}export{vt as A,sr as B,Ss as C,hs as D,te as E,q as H,U as I,Pn as P,On as R,As as T,_s as a,Yo as b,Es as c,os as d,Ms as e,In as f,Cs as g,Xo as h,Is as i,bs as j,Le as k,Mn as l,vs as m,An as n,_t as o,ys as p,Rn as q,yn as r,xs as s,Sn as t,Ts as u,Zo as v,Ns as w,Et as x,le as y,bn as z};
//# sourceMappingURL=fpv7946ha36j5g75.js.map
