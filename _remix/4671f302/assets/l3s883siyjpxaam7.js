import{r as i,ag as GA,bo as FA,a as JA,ab as pe,cQ as J,g as XA,bk as IA,fz as fe,bH as U,a3 as D,t,dO as ve,bJ as Ce,bx as LA,aV as WA,T as iA,ax as _,D as xe,aB as be}from"./cya1ek7zbsww3e8p.js";import{a as PA,bM as ke,n as Ie,bN as Se,bO as Ee,bP as Be,bQ as we,ac as Me,bR as ye,c as QA,bS as Qe,W as Ve,bj as De,Q as je,bT as Te,y as Re}from"./m1h3d66e9x9d8av7.js";import{au as UA,j_ as SA,j$ as qA,k0 as Ze,c as Ne,k1 as Ye,af as Y,ep as Oe,N as Ge}from"./o02kugc5eyp7bzuk.js";import{d as V,e as lA,f as dA,R as sA,g as q,b as C,h as y,c as I,I as Fe,i as R,j as P,r as Je,L as Xe,k as Le,l as Q,m as _A,n as HA,a as KA,C as zA,u as We,o as uA,T as EA,p as $A,q as Pe,s as Ue,U as qe,t as _e,v as He,w as Ke,x as ze,y as $e,z as VA,A as DA,B as jA,V as At,E as et,D as tt,F as ot,G as nt}from"./nkdjm34ba9ti9kp3.js";import{q as Ae}from"./h2x37ub1souzo3by.js";import{r as at}from"./gq7tdevv4xdhasrb.js";import{f as st}from"./beqhh5k54ufxbjqa.js";import{l as ee,d as H,T as TA,a as te,m as it}from"./cnkyxf781f12fdb9.js";import{u as RA}from"./n0s5m6clrqpu2fmq.js";import{r as BA,z as cA}from"./ji313uzrpltya54g.js";import{m as S}from"./cnlquey73j7uw8fu.js";import{G as ct,W as rt}from"./bsu2bl74d8hvnjqn.js";import{B as lt,D as dt}from"./gqzdg6plr3pmj597.js";import{_ as ut}from"./pcjzq5zspamo9j8w.js";import"./m0ufyovf28ile0yl.js";import"./ck6f40emr7l3i0b3.js";import"./dg59tnhw4y7axib5.js";import"./cd3lr7lq8spr3x1m.js";import"./lrlzvgtohqckew7u.js";import"./clvle6hjcebazwfi.js";import"./dt5uqt2zhmlrp895.js";import"./lptuk0q8xn5ezb1r.js";import"./eqdwfm1ss7l1qetb.js";import"./lxcl4lkoqrle7fky.js";import"./br9sj6yk029klw3b.js";import"./md510keitf2ivqa8.js";import"./j7pqhf0z6hzxyx3a.js";import"./gphz2kh56z3x1ky9.js";import"./igb9dmr373qfmqoq.js";import"./hirsm9330k9ce9fk.js";import"./k7gblveuiw9977ct.js";import"./jci37cw2gaa1mzk1.js";import"./b0g5goygjlgrn1vt.js";import"./t9hafwtdc4pa0i6h.js";import"./mbtmeqavw326paga.js";import"./moe68hd05fytpaqp.js";import"./nbgv50evg19shp1b.js";import"./m6ckmcg5tc6lq0tg.js";import"./idzy572xfl7a5o6a.js";function mt(){ht(),pt(),ft(),gt()}function gt(){const{room:e,debug:A}=V();i.useEffect(()=>{async function o(){Promise.all(["audioinput","audiooutput","videoinput"].map(async n=>{const a=await sA.getLocalDevices(n),s=e?.getActiveDevice(n);if(!a.find(r=>r.deviceId===s)){const r=await q(n);let d=null;r?d=r.deviceId:a[0]&&(d=a[0].deviceId),A(`switching ${n} to ${d}`),d&&await e?.switchActiveDevice(n,d)}}))}if(navigator)return navigator.mediaDevices.addEventListener("devicechange",o),()=>{navigator.mediaDevices.removeEventListener("devicechange",o)}},[e,A])}function ht(){const{room:e,debug:A}=V(),o=e?.getActiveDevice("audioinput"),n=e?.getActiveDevice("audiooutput");i.useEffect(()=>{async function a(){const s=(await q("audioinput"))?.deviceId,c=(await q("audiooutput"))?.deviceId,r=async()=>{s&&o!==s&&(A("switching audio input to default"),await e?.switchActiveDevice("audioinput",s))},d=async()=>{if(c&&n!==c){A("switching audio output to default");try{await e?.switchActiveDevice("audiooutput",c)}catch(u){A("failed to switch audio output",u)}}};await Promise.all([r(),d()])}a()},[o,n,A,e])}function pt(){const{isVideoEnabled:e,endStartingVideo:A}=lA(),{room:o,debug:n}=V(),a=o?.getActiveDevice("videoinput");i.useEffect(()=>{async function s(){if(e)try{await o?.localParticipant.setCameraEnabled(!0),A(!0)}catch{A(!1)}else await o?.localParticipant.setCameraEnabled(!1)}o&&s()},[e,A,o]),i.useEffect(()=>{async function s(){const c=(await q("videoinput"))?.deviceId;await(async()=>{c&&a!==c&&(n("switching video input to default"),await o?.switchActiveDevice("videoinput",c))})()}s()},[a,n,o])}function ft(){const{room:e}=V(),{isScreenshareEnabled:A,endStartingScreenshare:o}=dA();i.useEffect(()=>{async function n(){if(A)try{await e?.localParticipant.setScreenShareEnabled(!0,{video:{displaySurface:"monitor"}}),o(!0)}catch{o(!1)}else await e?.localParticipant.setScreenShareEnabled(!1)}e&&n()},[e,A,o])}function oe(){const{debug:e}=V(),A=C(n=>n.conversationId),o=GA();return i.useCallback(async n=>{const a=n,s=A&&!ee(A)?A:void 0,c=a??s;if(c){e(`refetch conversationId ${c}`);try{await st(c,!0)}catch(r){const d="Failed to update conversation";e(d,r),o.danger(d)}}},[A,e,o])}const vt=5e3,Ct=2e3,mA=e=>{const{room:A}=V(),o=C(f=>f.disconnectPending),n=C(f=>f.server.remoteState===y.Speaking),a=C(f=>f.conversationId)??void 0,s=H(a),c=i.useRef(!1),r=oe(),d=FA(),u=JA();c.current=n||c.current;const m=i.useCallback(async f=>{clearTimeout(o),I.setState(k=>{k.disconnectPending=void 0}),A?.disconnect(),await r(s),I.setState(Fe);const g=s??f;g&&Ae(d,u,g),e?.refetchLater&&window.setTimeout(()=>{r(s)},Ct)},[o,A,r,s,e?.refetchLater,d,u]),l=c.current&&!s,x=i.useCallback(()=>{I.setState(f=>{f.disconnectPending=window.setTimeout(m,vt)})},[m]);return{disconnectPending:o!==void 0,shouldDelayDisconnect:l,delayDisconnect:x,immediateDisconnect:m}};function xt(){const e=JA(),{room:A,debug:o,decoder:n}=V(),{disconnectPending:a,immediateDisconnect:s}=mA(),c=oe(),r=FA(),d=i.useRef(!1);i.useEffect(()=>{const u=async v=>{const{new_state:h}=v;I.setState(b=>{b.server.remoteState=h})},m=async v=>{I.setState(h=>{h.server.usage=v})},l=async v=>{I.setState(h=>{h.server.toolUpdate={...v}})},x=async v=>{let h;try{h=JSON.parse(n.decode(v)),o("data recevied",h)}catch(b){o("error parsing data",b);return}switch(I.setState(b=>(b.server.messages.push({...h,timestamp:new Date,source:"remote"}),b)),h.type){case P.StateUpdate:o("state update",h.payload);const{new_state:b,delay_s:B}=h.payload;if(b===y.Listening&&!d.current){d.current=!0,performance.mark("voice_mode.end");const E=performance.measure("voice_mode","voice_mode.start","voice_mode.end").duration.toFixed(0);J.voiceMode.connect({durationMs:E})}b===y.Thinking&&B&&(o(`${A?.name} delay thinking state by ${B} seconds`),u({new_state:y.ListeningIntently,delay_s:B}),await new Promise(E=>setTimeout(E,B*1e3))),u(h.payload);break;case P.ConversationUpdate:{o("conversation update",h.payload);const E=I.getState().conversationId,{conversation_id:w}=h.payload;E&&ee(E)&&(TA.initThread(E,{kind:pe.PrimaryAssistant}),TA.setServerIdForNewThread(E,w),I.setState(O=>{O.conversationId=w}),Ae(UA,e,w),at(e)),await c(w),a&&s(w);break}case P.UsageUpdate:m(h.payload);break;case P.ToolUpdate:l(h.payload);break}},f=(v,h)=>{o("track published",v,h)},g=()=>{o("disconnected"),Je()},k=(v,h)=>{h instanceof Xe&&(o(`Connection quality changed for participant ${h.identity}: ${v}`),I.setState(b=>{b.server.voiceConnectionQuality=v}))};return A?.on(R.DataReceived,x),A?.on(R.TrackPublished,f),A?.on(R.ConnectionQualityChanged,k),A?.on(R.Disconnected,g),()=>{A?.off(R.DataReceived,x),A?.off(R.TrackPublished,f),A?.off(R.ConnectionQualityChanged,k),A?.off(R.Disconnected,g)}},[e,A,c,o,n,r,a,s])}function bt(){kt(),It(),St(),Et()}function kt(){const{room:e}=V();i.useEffect(()=>{I.setState(A=>{A.dev.room=e})},[e])}function It(){const{room:e}=V(),A=Le(e);i.useEffect(()=>{I.setState(o=>{o.server.connectionState=A})},[A])}function St(){const{room:e,debug:A,encoder:o}=V();i.useEffect(()=>{const n=!!I.getState().server.actions;if(e&&!n){const a=async s=>{A("publishing action",s);const c={type:P.ActionRequest,payload:{action:s}};await e.localParticipant.publishData(o.encode(JSON.stringify(c)),{reliable:!0}),I.setState(r=>{r.server.messages.push({...c,timestamp:new Date,source:"local"})})};I.setState(s=>{s.server.actions={[Q.StartListeningIntently]:()=>a(Q.StartListeningIntently),[Q.StopListeningIntently]:()=>a(Q.StopListeningIntently),[Q.HaltAllActivity]:()=>a(Q.HaltAllActivity),[Q.ResumeListening]:()=>a(Q.ResumeListening),[Q.RelayMessage]:()=>a(Q.RelayMessage)}})}},[e,A,o])}function Et(){const e=I(A=>A.isVoiceModeActive);i.useEffect(()=>(RA.setState({isVoiceActive:e}),()=>{RA.setState({isVoiceActive:!1})}),[e])}const Bt=i.memo(function(){return xt(),bt(),mt(),null});var wt={webm:"data:video/webm;base64,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",mp4:"data:video/mp4;base64,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"};const{webm:Mt,mp4:yt}=wt,xA=()=>typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,bA=()=>"wakeLock"in navigator;class Qt{constructor(){if(this.enabled=!1,bA()){this._wakeLock=null;const A=()=>{this._wakeLock!==null&&document.visibilityState==="visible"&&this.enable()};document.addEventListener("visibilitychange",A),document.addEventListener("fullscreenchange",A)}else xA()?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("title","No Sleep"),this.noSleepVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.noSleepVideo,"webm",Mt),this._addSourceToVideo(this.noSleepVideo,"mp4",yt),this.noSleepVideo.addEventListener("loadedmetadata",()=>{this.noSleepVideo.duration<=1?this.noSleepVideo.setAttribute("loop",""):this.noSleepVideo.addEventListener("timeupdate",()=>{this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())})}))}_addSourceToVideo(A,o,n){var a=document.createElement("source");a.src=n,a.type=`video/${o}`,A.appendChild(a)}get isEnabled(){return this.enabled}enable(){return bA()?navigator.wakeLock.request("screen").then(A=>{this._wakeLock=A,this.enabled=!0,console.log("Wake Lock active."),this._wakeLock.addEventListener("release",()=>{console.log("Wake Lock released.")})}).catch(A=>{throw this.enabled=!1,console.error(`${A.name}, ${A.message}`),A}):xA()?(this.disable(),console.warn(`
        NoSleep enabled for older iOS devices. This can interrupt
        active or long-running network requests from completing successfully.
        See https://github.com/richtr/NoSleep.js/issues/15 for more details.
      `),this.noSleepTimer=window.setInterval(()=>{document.hidden||(window.location.href=window.location.href.split("#")[0],window.setTimeout(window.stop,0))},15e3),this.enabled=!0,Promise.resolve()):this.noSleepVideo.play().then(o=>(this.enabled=!0,o)).catch(o=>{throw this.enabled=!1,o})}disable(){bA()?(this._wakeLock&&this._wakeLock.release(),this._wakeLock=null):xA()?this.noSleepTimer&&(console.warn(`
          NoSleep now disabled for older iOS devices.
        `),window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause(),this.enabled=!1}}var Vt=Qt;const Dt=XA(Vt);function jt(){const{shouldDelayDisconnect:e,delayDisconnect:A,immediateDisconnect:o}=mA({refetchLater:!0}),{toggleMute:n}=_A();return i.useCallback(async()=>{J.exitVoiceState.click(),e?(await n(),A()):o()},[A,o,e,n])}const Tt=()=>{const e=SA()&&IA,A=U("1359128927")?.value;return async()=>{if(e&&A)return await fe();{const o=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),n=await navigator.mediaDevices.enumerateDevices();return o.getTracks().forEach(s=>s.stop()),n.some(s=>s.kind==="audioinput"&&s.label!=="")}}};function Rt(e){const A=e.default_voice_mode,o=e.modes.find(n=>n.mode===A);if(!o)throw new Error("Voice status returned a default_voice_mode that does not exist in the modes array");return o.default_model_slug}function wA(){const e=D(),A=GA(),{startVoiceMode:o,stopVoiceMode:n,isConnected:a,isVoiceModeActive:s}=HA(),c=i.useCallback(async r=>{const d={conversation_id:r.serverThreadId,parent_message_id:r.parentMessageId,model_slug:r.modelSlug,model_slug_advanced:r.isAdvancedMode?r.modelSlug:void 0,voice_mode:r.isAdvancedMode?"advanced":"standard",eventSource:r.eventSource,clientThreadId:r.clientThreadId},u=e.formatMessage({id:"useVoiceModeButtonAction.error",defaultMessage:"Failed to start voice mode"});try{await o(d)}catch{if(r.isAdvancedMode&&r.retryWithStandard)try{await o({...d,voice_mode:"standard"})}catch{A.danger(u),J.voiceMode.error({error:u})}else A.danger(u),J.voiceMode.error({error:u})}},[e,o,A]);return{isVoiceModeActive:s,isConnected:a,toggleVoiceMode:c,stopVoiceMode:n}}const ne="inline-flex items-center bg-transparent text-token-text-secondary hover:text-token-text-primary",Zt=({message:e,onClick:A,type:o})=>{const n=D(),a=SA()&&IA;if(!e)return null;switch(o){case"microphone_denied":return a?t.jsxs("a",{href:"ms-settings:privacy-microphone",className:ne,children:[e,t.jsx(PA,{className:"icon-sm ml-1"})]}):t.jsx(ZA,{onClick:A,message:e});case"connection_quality":return t.jsxs("div",{className:"inline-flex items-center",children:[e,t.jsx("button",{onClick:A,className:"ml-1",children:t.jsx("strong",{children:n.formatMessage(ae.retry)})})]});case"normal":return t.jsx(ZA,{onClick:A,message:e})}},ZA=({message:e,onClick:A})=>{const o=D();return t.jsxs("button",{onClick:A,className:ne,"aria-label":o.formatMessage(ae.openInfoModal),children:[e,t.jsx(PA,{className:"icon-sm ml-1"})]})},ae={openInfoModal:{id:"hintMessage.openInfoModal",defaultMessage:"Open info modal",description:"Open info modal about voice mode usage"},retry:{id:"hintMessage.retry",defaultMessage:"Retry",description:"Retry text next to lost connection message"}};function Nt(e){const{button:A,conversationId:o,modelId:n,onClick:a}=e,s=H(o),c=BA(o),r=A.action==="new_chat"?c:n,{toggleVoiceMode:d}=wA(),u=i.useCallback(()=>{switch(A.action){case"new_chat":{const m=r??cA;UA(`/?model=${m}`),d({serverThreadId:void 0,modelSlug:m,isAdvancedMode:!0,eventSource:`modal_${A.action}`,parentMessageId:void 0,retryWithStandard:!1,clientThreadId:ve()});break}case"switch_to_standard":s&&n&&d({serverThreadId:s,modelSlug:r??cA,isAdvancedMode:!1,eventSource:`modal_${A.action}`,parentMessageId:void 0,retryWithStandard:!1,clientThreadId:s});break;case"ok":break;default:return}a?.()},[A.action,r,n,a,s,d]);return t.jsx(Ce.Button,{onClick:u,title:A.title,color:e.color})}function se({buttons:e,conversationId:A,modelId:o,onClick:n}){let a,s;return!e||e.length===0?{primary:void 0,secondary:void 0}:(e.forEach(c=>{const r=c.action==="new_chat",d=c.action==="switch_to_standard",u=r&&A,m=d&&A&&o,l=t.jsx(Nt,{button:c,conversationId:A,modelId:o,onClick:n,color:c.style});(u||m||c.action==="ok")&&(a?s||(s=l):a=l)}),{primary:a,secondary:s})}function Yt({conversationId:e,modelId:A,isOpen:o,onClose:n,buttons:a,title:s,description_markdown:c}){const r=se({buttons:a,conversationId:e,modelId:A,onClick:n}),d=t.jsx(qA,{className:"markdown",urlTransform:u=>u,children:c});return t.jsx(LA,{title:s,isOpen:o,onClose:n,size:"custom",className:"max-w-[550px]",type:"warning",showCloseButton:!0,children:t.jsxs("div",{className:"w-full",children:[t.jsx("p",{className:"mb-6 text-token-text-secondary",children:d}),t.jsx("div",{className:"flex justify-end",children:r.primary})]})})}function Ot({conversationId:e,currentModelId:A}){const o=D(),n=jt(),a=C(p=>p.server.usage),s=C(p=>p.server.voiceConnectionQuality),c=p=>p===zA.Lost,r=C(p=>p.server.connectionState),d=KA(),[u,m]=i.useState(!1),l=C(p=>p.server.toolUpdate),[x,f]=i.useState(!1),[g,k]=i.useState(!0),[v,h]=i.useState(null),[b,B]=i.useState(null),[E,w]=i.useState(null),[O,j]=i.useState(!1),[X,z]=i.useState(!1),L=i.useRef(!1),T=H(e),{stopVoiceMode:$,toggleVoiceMode:AA,isVoiceModeActive:M}=wA(),eA=Tt();i.useEffect(()=>{X||eA().then(p=>{j(p)}).finally(()=>{z(!0)})},[eA,X]);const gA=SA()&&IA,hA=M&&X&&!O,pA=M&&O&&!r&&d;i.useEffect(()=>{hA&&(h(o.formatMessage(kA.hint)),B({title:o.formatMessage(kA.title),description_markdown:o.formatMessage(kA.description_markdown),buttons:[]}))},[o,gA,hA]),i.useEffect(()=>{if(pA&&!L.current){L.current=!0,h(null),B(null);const p=Rt(d),F=te.getCurrentNode(e)?.parentId,tA={serverThreadId:T,modelSlug:p,parentMessageId:F,isAdvancedMode:d.default_voice_mode==="advanced",retryWithStandard:!0,eventSource:"composer_speech_button",clientThreadId:e};J.voiceSessionStarted.click(),AA(tA)}},[e,pA,d,T,AA]);const{reaching_limit_disclosure:fA,exceed_limit_message:G}=a?.rate_limit_message??{},vA=d?.modes.find(p=>p.mode===d?.default_voice_mode)?.disclosure_message,CA=c(s)?"Lost connection.":fA?.hint??G?.title??vA?.hint??null;i.useEffect(()=>{const p=l?.text;let F,tA,yA;return p&&(k(!1),F=setTimeout(()=>{f(!0),tA=setTimeout(()=>{f(!1),yA=setTimeout(()=>{k(!0)},750)},3e3)},750)),()=>{clearTimeout(F),clearTimeout(tA),clearTimeout(yA)}},[l]),i.useEffect(()=>{if(CA&&h(CA),G&&M){$();const p={title:G.title,description_markdown:G.description_markdown,buttons:G.buttons};u?w(p):(B(p),m(!0))}else if(!b){const p=fA??vA;p&&B({title:p.title,description_markdown:p.message_markdown,buttons:p.buttons})}},[a,vA,$,M,CA,G,fA,u,b,s]);const re=i.useCallback(()=>{E&&(B(E),w(null)),m(!0)},[E]),le=i.useCallback(()=>{m(!1)},[]),{startVoiceMode:de}=HA(),ue=BA(e),me=C(p=>p.voiceMode),{voiceName:ge}=Ze(),he=async()=>{try{h(null),await de({conversation_id:T,model_slug:ue??cA,eventSource:"lost_connection_hint_message",voice_mode:me,voice:ge,clientThreadId:e})}catch(p){const F=p instanceof Error?p.message:String(p);J.voiceMode.error({error:F,eventSource:"lost_connection_hint_message"})}};let W;return hA?W="microphone_denied":c(s)?W="connection_quality":W="normal",t.jsxs("div",{className:"flex w-full flex-col items-center",children:[t.jsxs("div",{className:"relative mb-6 flex min-h-5 w-full items-center justify-center text-xs text-token-text-secondary",children:[l?.text&&t.jsx(S.div,{initial:{opacity:0},animate:{opacity:x?1:0},transition:{duration:.5},style:{position:"absolute",left:"50%",transform:"translateX(-50%)",textAlign:"center"},children:t.jsxs("div",{className:"flex items-center",children:[l?.text&&t.jsx(ke,{className:"icon-sm mr-1"}),l?.text]})}),t.jsx(S.div,{initial:{opacity:0},animate:{opacity:g?1:0},transition:{duration:.5},style:{position:"absolute",left:"50%",transform:"translateX(-50%)",textAlign:"center"},children:t.jsx("div",{className:"flex items-center",children:t.jsx(Zt,{type:W,message:v,onClick:W==="connection_quality"?he:re})})})]}),t.jsxs("div",{className:iA("flex flex-row items-center gap-6","rounded-full px-3 py-1","transition-width duration-200 ease-in-out"),children:[t.jsx(NA,{capability:"video",children:t.jsx(Ft,{})}),t.jsx(Xt,{shouldQueryDevices:!!pA}),t.jsx(NA,{capability:"screenshare",children:t.jsx(Lt,{})}),t.jsx(MA,{onClick:n})]}),t.jsx(Yt,{conversationId:e,modelId:A,isOpen:u,onClose:le,title:b?.title,description_markdown:b?.description_markdown,buttons:b?.buttons??[]})]})}function Gt(){const e=U("716722001")?.value??!1,A=U("2436427643")?.value??!1,o=U("1413999995")?.value??!1;return{av:e,video:A,screenshare:o}}function NA({children:e,capability:A}){const o=Gt();return!o.av||!o[A]?null:t.jsx(t.Fragment,{children:e})}function Ft(){const{isVideoEnabled:e,isStartingVideo:A,toggleVideo:o}=lA();let n=null;A?n=_:n=Se;const a=e?"bg-gray-900 hover:bg-gray-800 active:bg-gray-700":"bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10",s=e?"text-white dark:text-black":"text-black dark:text-white";return t.jsx(K,{onClick:()=>o("ControlButton"),disabled:A,icon:n,className:a,iconColor:s})}const Jt=async()=>{try{const e=await q("audioinput");return e?e.label||"Unknown microphone":"No microphone found"}catch(e){return console.warn("Error fetching default media device:",e),xe.addError("Failed to fetch default media device",{error:e}),"Error accessing microphone devices"}};function Xt({shouldQueryDevices:e}){const{isMicrophoneEnabled:A,isMuting:o,toggleMute:n}=_A(),a=D(),{disconnectPending:s}=mA(),[c,r]=i.useState(""),d=A?Ee:Be,u=A?"bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10":"bg-red-500/10 hover:bg-red-500/15 active:bg-red-500/20 dark:bg-red-500/10 dark:hover:bg-red-500/15 dark:active:bg-red-500/20",m=A?"text-black dark:text-white":"text-red-500";i.useEffect(()=>{e&&Jt().then(x=>r(x))},[e]);const l=A?a.formatMessage({id:"nbbUMb",defaultMessage:"Turn on microphone"}):a.formatMessage({id:"PJzixV",defaultMessage:"Turn off microphone"});return t.jsx(K,{"aria-label":l,onClick:n,icon:d,disabled:o||s,className:u,iconColor:m,tooltipPrimaryLabel:l,tooltipSecondaryLabel:c})}function Lt(){const{isScreenshareEnabled:e,isScreenshareStarting:A,toggleScreenShare:o}=dA();let n=null;A?n=_:n=we;const a=e?"bg-gray-900 hover:bg-gray-800 active:bg-gray-700":"bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10",s=e?"text-white dark:text-black":"text-black dark:text-white";return t.jsx(K,{onClick:()=>o("ControlButton"),disabled:A,icon:n,className:a,iconColor:s})}function MA({className:e,onClick:A}){const o=D(),{disconnectPending:n}=mA(),a="bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10",s=o.formatMessage({id:"9Mto0a",defaultMessage:"End"});return t.jsx(K,{disabled:n,onClick:A,icon:n?_:Ie,iconColor:"text-black dark:text-white",className:e??a,"aria-label":o.formatMessage({id:"7/8k4Y",defaultMessage:"End voice mode"}),tooltipPrimaryLabel:s})}function K(e){const{icon:A,disabled:o,className:n,iconColor:a="text-current",iconSize:s="icon-xl",buttonSize:c="h-16 w-16",tooltipPrimaryLabel:r,tooltipSecondaryLabel:d,...u}=e,[m,l]=i.useState(!1),x=i.useCallback(()=>{l(!0)},[]),f=i.useCallback(()=>{l(!1)},[]),g=t.jsx(Wt,{className:iA(n,c,"overflow-hidden rounded-full border-none p-0.5 text-token-text-primary transition-colors duration-200 ease-in-out hover:text-token-text-secondary"),disabled:o,...u,children:t.jsx(A,{className:iA(s,a)})});return r?t.jsx(Ne,{sideOffset:14,label:r,secondaryLabel:d,contentClassName:"flex flex-col items-center justify-center",className:"flex",open:m,side:"top",children:t.jsx("span",{onPointerEnter:x,onPointerLeave:f,children:g})}):g}const Wt=S(WA),kA={hint:{id:"micMessages.hint",defaultMessage:"Enable microphone access in Settings",description:"Hint to the user to manually enable microphone access for voice mode"},title:{id:"micMessages.title",defaultMessage:"Microphone access required",description:"Title for modal that informs the user that microphone access is required for voice mode"},description_markdown:{id:"micMessages.description_markdown",defaultMessage:"To use voice mode, you'll need to enable your microphone and try again.",description:"Description for modal that informs the user that microphone access is required for voice mode"}};var Pt=ut,Ut=Ye,qt=Pt(function(e,A,o){return e+(o?" ":"")+Ut(A)}),_t=qt;const Ht=XA(_t);function Kt({conversationId:e}){const A=U("1426009137")?.value,o=H(e),n=it(e),a=BA(e),s=te.getCurrentNode(e)?.parentId;We({conversationId:o??null,requestedVoiceMode:null,gizmoId:n,eventSource:"voice_mode_picker"});const c=KA();return!A||!a?null:t.jsx(N,{conversationId:o??e,parentMessageId:s,status:c})}function N(e){const A=e?.status?.modes,[o,n]=i.useState(!1),[a,s]=i.useState(),c=i.useCallback(u=>{s(u),n(!0)},[]),r=D(),d=i.useCallback(()=>n(!1),[]);return t.jsxs(t.Fragment,{children:[t.jsx(lt,{contentAlign:"center",triggerButton:t.jsx(N.Trigger,{}),children:A?A.map(u=>{const m=u.default_model_slug;return i.createElement(N.Item,{...e,modelSlug:m,key:u.mode,voiceStatusMode:u,onShowModal:c})}):t.jsx("div",{role:"progressbar","aria-valuetext":r.formatMessage({defaultMessage:"Loading voice modes",id:"voiceModeButton.loadingModes"}),"aria-busy":"true","aria-live":"assertive","aria-valuemin":0,"aria-valuemax":100,children:t.jsx(_,{"aria-hidden":"true",className:"my-4 min-w-full"})})}),t.jsx(N.Modal,{conversationId:e.conversationId,disabledModeMetadata:a,isOpen:o,onClose:d})]})}N.Modal=function(A){const o=A.disabledModeMetadata?.buttons??[],n=se({buttons:o,conversationId:A.conversationId,modelId:cA,onClick:A.onClose}),a=t.jsx(qA,{children:A.disabledModeMetadata?.description_markdown});return t.jsx(LA,{title:A.disabledModeMetadata?.title,description:a,isOpen:A.isOpen,onClose:A.onClose,type:"success",primaryButton:n.primary,secondaryButton:n.secondary})};N.Trigger=i.forwardRef(function(A,o){const n=C(a=>a.voiceMode);return t.jsxs(ct,{ref:o,...A,children:[Ht(n)??t.jsx(_,{}),t.jsx(Me,{className:"icon-md text-token-text-tertiary"})]})});N.Item=function({conversationId:A,modelSlug:o,parentMessageId:n,voiceStatusMode:a,onShowModal:s}){const{disabled_mode_metadata:c,mode:r}=a,{toggleVoiceMode:d}=wA(),u=H(A),m=i.useCallback(async()=>{c?s(c.disabled_message):d({serverThreadId:u,modelSlug:o,parentMessageId:n,isAdvancedMode:r==="advanced"&&!c,eventSource:"voice_mode_picker",retryWithStandard:!1,clientThreadId:A})},[A,c,r,o,s,n,u,d]);return t.jsx(dt.Item,{onClick:m,children:t.jsxs("div",{children:[a.display_name,t.jsx("div",{className:"text-xs text-token-text-tertiary",children:a.description})]})})};function zt({conversationId:e}){const A=C(n=>n.server.messages),o=C(n=>n.voiceSessionId);return t.jsx(S.div,{className:"hidden h-full max-w-[400px] overflow-y-auto border-l border-l-token-sidebar-surface-secondary bg-token-main-surface-secondary pt-16 shadow-inner md:block",initial:{opacity:0,x:420,width:"0px"},animate:{opacity:1,x:0,width:"400px"},exit:{opacity:0,x:420,width:"0px"},transition:{type:"tween"},children:t.jsxs(Y,{children:[t.jsx(Kt,{conversationId:e}),t.jsxs("div",{className:"p-4 py-2 text-lg font-semibold",children:["Voice Session ID: ",o]}),A.length?t.jsxs(S.div,{className:"flex h-full w-full flex-col",initial:{opacity:0,x:-100},animate:{opacity:1,x:0},exit:{opacity:0,x:-100},children:[t.jsxs("div",{children:[t.jsx("h3",{className:"p-4 py-2 text-lg font-semibold text-token-text-secondary",children:"Room Stats"}),t.jsx($t,{})]}),t.jsx("h3",{className:"p-4 py-2 text-lg font-semibold text-token-text-secondary",children:"Messages"}),t.jsx("div",{className:"grow overflow-hidden",children:t.jsx(rt,{children:t.jsx(S.ul,{className:"pointer-events-none flex w-full flex-col gap-4 pb-24 pt-4",initial:"initial",animate:"animate",exit:"exit",variants:ie,transition:{delayChildren:.25,staggerChildren:.05},children:A.map((n,a)=>t.jsx(oo,{index:a,message:n},a))})})})]}):null]})})}function $t(){const e=C(n=>n.dev.room);if(!e)return null;const A=e.numParticipants,o=e.activeSpeakers;return t.jsx("div",{className:"px-4 pb-8",children:t.jsxs("div",{className:"flex flex-col flex-nowrap gap-2",children:[t.jsx(Ao,{}),t.jsx(rA,{text:"Attendees"}),t.jsx(Z,{name:"Participants",text:A}),t.jsx(Z,{name:"Speakers",text:o.length}),t.jsx(eo,{})]})})}function Ao(){const e=C(s=>s.server.connectionState),A=C(s=>s.dev.room),[o,n]=i.useState("Unknown"),a=A?.localParticipant;return i.useEffect(()=>{if(a){const s=c=>{n(c)};return a.on("connectionQualityChanged",s),()=>{a.off("connectionQualityChanged",s)}}},[a]),t.jsxs(t.Fragment,{children:[t.jsx(rA,{text:"Connection"}),t.jsx(Z,{name:"Quality",text:String(o)}),t.jsx(Z,{name:"State",text:String(e)})]})}function eo(){const e=C(m=>m.dev.room),[A,o]=i.useState(null),[n,a]=i.useState(null),[s,c]=i.useState(null),r=e?.getActiveDevice("audioinput"),d=e?.getActiveDevice("audiooutput"),u=e?.getActiveDevice("videoinput");return i.useEffect(()=>{async function m(){const l=await sA.getLocalDevices("audioinput"),x=await sA.getLocalDevices("audiooutput"),f=await sA.getLocalDevices("videoinput"),g=l.find(h=>h.deviceId===r),k=x.find(h=>h.deviceId===d),v=f.find(h=>h.deviceId===u);o(g?.label??"Unknown"),a(k?.label??"Unknown"),c(v?.label??null)}m()},[r,d,u]),t.jsxs(t.Fragment,{children:[t.jsx(rA,{text:"Devices"}),s?t.jsx(Z,{icon:ye,name:"Video Input",text:s}):null,t.jsx(Z,{icon:QA,name:"Audio Input",text:A??"Unknown"}),t.jsx(Z,{icon:Qe,name:"Audio Output",text:n??"Unknown"}),t.jsx(rA,{text:"Monitors"}),t.jsx(Z,{name:"Mic level",icon:QA,text:"unknown",content:t.jsx(to,{})})]})}function to(){const e=C(A=>A.dev.room?.localParticipant.audioLevel);return t.jsx("div",{className:"flex flex-row flex-nowrap items-center gap-1",children:t.jsx("div",{className:"flex flex-row flex-nowrap items-center gap-1",children:Array.from({length:10}).map((A,o)=>t.jsx("div",{className:`h-2 w-2 rounded-full ${(e??0)>o*.1?"bg-gray-500":"bg-token-main-surface-tertiary"}`},o))})})}function rA({text:e}){return t.jsx("h4",{className:"text-md font-semibold",children:e})}function Z(e){return t.jsxs("div",{className:"flex flex-row flex-nowrap items-center gap-2",children:[t.jsx("span",{className:"opacity-85",children:e.icon?t.jsx(e.icon,{className:"h-[0.75rem] w-[0.75rem]"}):`${e.name}:`}),e.content??t.jsx("span",{className:"line-clamp-1 rounded-lg bg-token-main-surface-tertiary p-0.5 px-1 font-mono text-xs",children:e.text})]})}function oo({index:e,message:A}){const[o,n]=i.useState(!1),a=D();let s=null;switch(A.source){case"remote":s=je;break;case"local":s=De;break}return t.jsx(S.div,{className:"w-full border-t border-token-main-surface-tertiary p-4",variants:ie,children:t.jsxs("div",{className:"flex w-full flex-col gap-2 rounded-lg bg-token-main-surface-secondary",children:[t.jsxs("div",{className:"font-mono text-[0.65rem] font-semibold text-token-text-secondary",children:[t.jsxs("div",{className:"flex w-full flex-row flex-nowrap items-center justify-between",children:[t.jsxs("div",{className:"flex flex-row flex-nowrap items-center gap-1",children:[t.jsx(s,{className:"h-3 w-3 text-token-text-secondary"}),t.jsx("span",{children:` | ${e+1} | ${a.formatDate(A.timestamp,{hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:2})}`})]}),t.jsx("div",{className:"flex flex-row flex-nowrap items-center gap-2",children:t.jsx(WA,{className:"rounded-full p-0.5",color:"ghost",size:"small",onClick:()=>n(c=>!c),children:t.jsx(Ve,{className:`transform transition-transform ${o?"rotate-180":""}`})})})]}),t.jsx("div",{className:"mt-1 text-xs font-bold",children:A.type})]}),t.jsx(Y,{children:o?t.jsx(S.pre,{initial:{opacity:0,transform:"blur(4px)"},animate:{opacity:1,transform:"blur(0px)"},exit:{opacity:0,transform:"blur(4px)"},className:"overflow-x-auto rounded-md bg-token-main-surface-tertiary p-2 text-xs text-token-text-secondary",children:JSON.stringify(A.payload,null,2)}):null})]})})}const ie={hidden:{opacity:0,x:100},animate:{opacity:1,x:0},exit:{opacity:0,x:100}};function no({children:e}){const{isVideoEnabled:A}=lA(),{isScreenshareEnabled:o}=dA(),n=A||o;return t.jsx(Y,{mode:"wait",children:n?t.jsx("div",{className:"flex h-full w-full flex-nowrap items-center",children:A?t.jsx(ao,{}):t.jsx(so,{})}):t.jsx(S.div,{className:"flex h-full w-full items-center justify-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e},"children")})}function ao(){const{isVideoEnabled:e,isStartingVideo:A,toggleVideo:o}=lA(),a=uA([EA.Source.Camera]).find(c=>c.participant.isLocal),s=e&&!A&&a;return i.useEffect(()=>{const c=a?.publication?.track;if(c){const r=()=>{o("Browser Video Controls")};return c.on("ended",r),()=>{c.off("ended",r)}}},[a,o]),t.jsx(Y,{children:s&&t.jsx(ce,{children:t.jsxs("div",{className:"aspect-w-16 aspect-h-9 group relative max-h-[95%] w-fit max-w-[60%] overflow-hidden rounded-3xl shadow-md",children:[t.jsx("div",{className:"absolute right-2 top-2 z-10 opacity-0 transition-opacity group-hover:opacity-90",children:t.jsx(MA,{onClick:()=>o("StopButton"),className:"bg-gray-900 bg-opacity-20 backdrop-blur-lg hover:bg-opacity-30 dark:bg-gray-900 dark:bg-opacity-20 dark:backdrop-blur-lg dark:hover:bg-opacity-30"})}),t.jsx($A,{className:"h-full w-full object-contain",trackRef:a})]})},"camera-renderer")})}function so(){const{isScreenshareEnabled:e,isScreenshareStarting:A,toggleScreenShare:o}=dA(),a=uA([EA.Source.ScreenShare]).find(c=>c.participant.isLocal),s=e&&!A&&a;return i.useEffect(()=>{const c=a?.publication?.track;if(c){const r=()=>{o("Browser ScreenShare Controls")};return c.on("ended",r),()=>{c.off("ended",r)}}},[a,o]),t.jsx(Y,{children:s&&t.jsx(ce,{children:t.jsxs("div",{className:"aspect-w-16 aspect-h-9 group relative max-h-[95%] w-fit max-w-[60%] overflow-hidden rounded-3xl shadow-md",children:[t.jsx("div",{className:"absolute right-2 top-2 z-10 opacity-0 transition-opacity group-hover:opacity-90",children:t.jsx(MA,{onClick:()=>o("StopButton"),className:"bg-gray-900 bg-opacity-20 backdrop-blur-lg hover:bg-opacity-30 dark:bg-gray-900 dark:bg-opacity-20 dark:backdrop-blur-lg dark:hover:bg-opacity-30"})}),t.jsx($A,{className:"h-full w-full object-contain",trackRef:a})]})},"screenshare-renderer")})}function ce({children:e,key:A}){return t.jsx(S.div,{className:"flex h-full w-full flex-col items-center justify-center gap-2 bg-token-main-surface-primary",initial:{opacity:0,transform:"blur(12px)",scale:.75},animate:{opacity:1,transform:"blur(0px)",scale:1},exit:{opacity:0,transform:"blur(12px)",scale:.75},transition:{duration:.2},children:e},A)}const oA=(e,A)=>{const[o,n]=i.useState(e===A?performance.now():0),a=i.useRef(A);i.useEffect(()=>{a.current!==A&&e===A&&n(performance.now()),a.current=A},[A,e]);const s=i.useCallback(()=>{n(0)},[]);return[e===A?1:0,o,s]},nA=([e,A,o],n=500)=>{const[a,s]=i.useState(e),c=i.useRef(e),r=i.useRef(void 0),d=i.useCallback((u,m,l)=>{const x=f=>{const g=Math.min((f-u)/n,1),k=m+g*(l-m);s(k),g<1&&(r.current=requestAnimationFrame(x))};r.current=requestAnimationFrame(x)},[n]);return i.useEffect(()=>{if(c.current!==e){c.current=e,r.current&&cancelAnimationFrame(r.current);const u=a,m=e;d(performance.now(),u,m)}},[d,a,e]),[a,A/1e3,o]},YA=e=>{const[A,o]=i.useState({audioData:[0,0,0,0],cumulativeAudioData:[0,0,0,0]}),n=i.useRef([0,0,0,0]),a=i.useRef(void 0),s=i.useRef(performance.now()),{bandMagnitudes:c,cumulativeMagnitude:r}=Pe(e,{bands:3,bins:1,gainMultipliers:[10,1,1]});n.current=[...c,r].flat();const d=i.useCallback(()=>{const u=performance.now(),m=(u-s.current)/1e3;s.current=u;const l=n.current,{audioData:x,cumulativeAudioData:f}=A,g=Ue({deltaTimeS:m,audioDataRaw:l,prevAudioData:x,prevCumulativeAudioData:f});o(g)},[A]);return i.useEffect(()=>(a.current||(a.current=window.setInterval(d,qe)),()=>{clearInterval(a.current),a.current=void 0}),[d]),A},io="webp",co=512,ro=512,lo="srgb",uo=3,mo="uchar",go=72,ho=!1,po=8,fo=!1,vo=!1,Co="https://cdn.oaistatic.com/assets/noise-watercolor-m3j88gni.webp",xo={format:io,width:co,height:ro,space:lo,channels:uo,depth:mo,density:go,isProgressive:ho,paletteBitDepth:po,hasProfile:fo,hasAlpha:vo,src:Co};if(typeof window<"u"){const e=new window.Image;e.crossOrigin="anonymous",e.src=xo.src,e.onload=()=>{}}function OA({className:e}){return t.jsx(yo,{className:e})}const bo=1.55,ko=1.4,Io="voice-wav",So="shout",Eo="User",Bo={bands:4,loPass:0,hiPass:400},wo=[300,300];function Mo(){const{resolvedTheme:e}=be(),A=e==="dark",o=C(g=>g.voiceMode==="advanced"),n=uA([EA.Source.Microphone]),a=n.find(g=>g.publication.trackName===Io),s=n.find(g=>g.publication.trackName===So);let c=VA(s?.publication.audioTrack,Bo);c.length===0&&(c=[0,0,0,0]),c.map(g=>g*ko);let r=YA(s?.publication.audioTrack),d=YA(a?.publication.audioTrack);const u=r.audioData.map((g,k)=>{const v=d.audioData[k];return g>0&&v>0?(g+v)/2:g>0?g:v}),m=r.cumulativeAudioData.map((g,k)=>{const v=d.cumulativeAudioData[k];return g>0&&v>0?(g+v)/2:g>0?g:v}),l=C(g=>g.server.remoteState),x=n.find(g=>g.participant.identity===Eo),f=(VA(x,{bands:1,loPass:0,hiPass:400})[0]??0)*bo;return{remoteState:l,userVolume:f,isAdvanced:o,avgMag:u,cumulativeAudio:m,isDarkMode:A,standardBloopVolumes:c}}function yo({className:e}){const{remoteState:A,userVolume:o,isAdvanced:n,avgMag:a,cumulativeAudio:s,isDarkMode:c,standardBloopVolumes:r}=Mo(),[d,u]=i.useState(wo),m=i.useCallback(M=>{u([M.width,M.height])},[]),l=i.useRef([0,0,0,0]);i.useEffect(()=>{A===y.Connecting&&(l.current=[0,0,0,0])},[A]);const x=i.useRef(performance.now());i.useEffect(()=>{const M=performance.now();A===y.Speaking&&M-x.current>50&&(x.current=M,l.current=l.current.map((eA,gA)=>eA+a[gA]))},[A,a]);const[f,g]=nA(oA(y.Listening,A)),[k,v]=nA(oA(y.Speaking,A)),[h,b]=nA(oA(y.Thinking,A)),[B,E]=nA(oA(y.Halted,A)),[w,O]=i.useState(performance.now()/1e3);i.useEffect(()=>{const M=setInterval(()=>{O(performance.now()/1e3)},50);return()=>clearInterval(M)},[]);const j=i.useMemo(()=>performance.now()/1e3,[]),[X,z]=i.useState(1e5),L=i.useRef(A);i.useEffect(()=>{A===y.Connecting?z(1e5):L.current===y.Connecting&&z(w),L.current=A},[A,f,w]);const T=_e(n),$=n?a:r,AA={time:w-j,micLevel:o,stateListen:f,listenTimestamp:Math.max(g-j,0),stateThink:h,thinkTimestamp:Math.max(b-j,0),stateSpeak:k,speakTimestamp:Math.max(v-j,0),readyTimestamp:X-j,stateHalt:B,haltTimestamp:Math.max(E-j,0),touchDownTimestamp:0,touchUpTimestamp:0,stateFailedToConnect:0,failedToConnectTimestamp:0,avgMag:$,cumulativeAudio:s??l.current,isNewBloop:!0,isAdvancedBloop:n,bloopColorMain:Array.from(T.bloopColorMain),bloopColorLow:Array.from(T.bloopColorLow),bloopColorMid:Array.from(T.bloopColorMid),bloopColorHigh:Array.from(T.bloopColorHigh),isDarkMode:c,screenScaleFactor:window.devicePixelRatio,viewport:d,silenceAmount:0,silenceTimestamp:0,fadeBloopWhileListening:!1};return t.jsx(He,{className:iA("flex items-center justify-center",e),vert:Ke,frag:ze,variables:AA,onViewportUpdate:m,ManagerClass:$e})}const Qo=({conversationId:e})=>{const A=uA(),[o,n]=i.useState(!1),[a,s]=i.useState(!1),c=i.useCallback(()=>{A&&A.length>0&&A.forEach(m=>{const{publication:l}=m;l.audioTrack instanceof DA?(s(l.audioTrack.isMuted),l.audioTrack.mute()):l.audioTrack instanceof jA&&l.audioTrack.setMuted(!0)})},[A]),r=i.useCallback(()=>{A&&A.length>0&&A.forEach(m=>{const{publication:l}=m;l.audioTrack instanceof DA?a||l.audioTrack.unmute():l.audioTrack instanceof jA&&l.audioTrack.setMuted(!1)})},[A,a]),d=()=>{c(),n(!0)},u=()=>{r(),n(!1)};return t.jsxs(t.Fragment,{children:[t.jsx(K,{onClick:d,icon:Te,iconColor:"text-[#A4A4A4] dark:text-[#858585]",className:"bg-transparent hover:bg-black/10 active:bg-black/20 dark:bg-transparent dark:hover:bg-white/5 dark:active:bg-white/10",iconSize:"icon-md",buttonSize:"h-10 w-10"}),o&&t.jsx(At,{conversationId:e,onClose:u})]})};class Vo extends Worker{constructor(A,o){const n=String(A);super(n.includes("://")&&!n.startsWith(location.origin)?URL.createObjectURL(new Blob([`import("${n}")`],{type:"text/javascript"})):A,o)}}const Do=new Vo(new URL("https://cdn.oaistatic.com/assets/livekit-client.e2ee.worker-DCt9knlM.js",import.meta.url),{type:"module"}),jo=i.memo(function({children:A}){const o=i.useRef({keyProvider:new et}).current,[n,a]=i.useState(!1),{token:s,url:c,e2eeKey:r}=C(l=>l.credentials),d=tt(),u=C(l=>l.isVoiceModeActive),m=C(l=>l.audioInputDevice?.deviceId);return i.useEffect(()=>{const l=s&&c&&r;!n&&l?o.keyProvider.setKey(r).then(()=>{a(!0)}):n&&!l&&a(!1)},[s,c,r,n,o]),u?t.jsxs(ot,{...d,connect:!0,token:s??void 0,serverUrl:c??void 0,audio:{deviceId:{ideal:m,exact:m},noiseSuppression:!0,echoCancellation:!0},options:{e2ee:{keyProvider:o.keyProvider,worker:Do}},children:[A,n&&s&&c&&t.jsx(Bt,{}),n&&s&&c&&t.jsx(nt,{})]}):null});function bn({conversationId:e,currentModelId:A,isActiveWindow:o}){const[n,a]=i.useState(!1),s=C(l=>l.isVoiceModeActive),c=C(l=>l.server.voiceConnectionQuality),r=Oe(),d=C(l=>l.screenshare!=null),u=C(l=>l.video!=null),m=D();return i.useEffect(()=>{if(!o)return;const l=new Dt;return s?l.enable():l.disable(),()=>{l.disable()}},[s,o]),o&&t.jsxs(jo,{children:[t.jsx(Y,{children:s?t.jsx(S.div,{className:"fixed left-0 top-0 z-50 flex h-full w-full flex-col bg-token-main-surface-primary",initial:"hidden",animate:"visible",exit:"hidden",variants:aA,children:t.jsxs(S.div,{className:"relative h-full w-full",variants:aA,children:[t.jsxs(S.div,{variants:aA,className:"flex h-full w-full flex-col justify-between gap-6",children:[t.jsxs(S.div,{className:"relative mt-6 flex w-full justify-center",children:[t.jsx("div",{className:"flex w-full items-center justify-center",children:(d||u)&&t.jsx(OA,{className:"h-16 w-16"})}),t.jsx("div",{className:"mr-4",children:t.jsx(Qo,{conversationId:e})})]}),t.jsxs("div",{className:"flex h-full min-h-0 items-center justify-center",children:[t.jsx(no,{children:t.jsx(OA,{className:"h-max min-h-52 w-max min-w-52"})}),t.jsx(Y,{children:n?t.jsx(zt,{conversationId:e}):null})]}),t.jsx(S.div,{className:"mb-6 flex justify-center",children:t.jsx(Ot,{conversationId:e,currentModelId:A})})]}),t.jsx(S.div,{className:"absolute bottom-0 right-0 flex w-auto items-center justify-end p-4",variants:aA,children:r?t.jsx(Ge,{onClick:()=>a(l=>!l),icon:Re}):null})]})}):null}),c===zA.Poor&&t.jsx("div",{className:"absolute left-1/2 top-6 z-50 -translate-x-1/2 transform",children:t.jsx("div",{className:"inline-flex flex-col items-center rounded-full border border-token-border-light bg-token-main-surface-primary px-6 py-3",children:t.jsx("span",{className:"text-token-text-secondary",children:m.formatMessage({id:"YE2Eng",defaultMessage:"Poor connection"})})})})]})}const aA={hidden:{opacity:0,transform:"blur(4px)"},visible:{transform:"blur(0px)",opacity:1},exit:{opacity:0,transform:"blur(4px)"}};export{bn as VoiceModeLayout};
//# sourceMappingURL=l3s883siyjpxaam7.js.map
