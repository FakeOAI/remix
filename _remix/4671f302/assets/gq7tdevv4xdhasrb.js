import{c as R,f as D,em as L,bD as N,en as _,aj as P,a3 as x,dk as F,j as H,r as l,ad as K}from"./cya1ek7zbsww3e8p.js";import{T as O}from"./cnkyxf781f12fdb9.js";import{cI as $,cJ as q,cK as k,cL as U}from"./o02kugc5eyp7bzuk.js";const h=R(D(()=>({statusMap:{}}))),Z=a=>h(s=>s.statusMap[a]),z=(a,s)=>{h.setState(e=>{e.statusMap[a]=s;const t=O.getServerThreadId(a);t&&(e.statusMap[t]=s)})},p=a=>{h.setState(s=>{for(const{id:e,async_status:t}of a)t!=null&&(s.statusMap[e]={source:L.SERVER,value:t})})},j=28,M="conversationHistory";function W(a={}){const{buckets:s,recentConversationLimit:e}=a,o=N()?.includes(_)??!1,y=P(),d=!o&&!!y?.data,r=x(),{data:i,fetchNextPage:g,hasNextPage:v,isInitialLoading:b,isFetchingNextPage:S,isError:T}=F({queryKey:[M],queryFn:async({pageParam:n})=>{const u=await H.getConversations({offset:n,limit:j});return p(u.items),u},initialPageParam:0,getNextPageParam:n=>{const u=n.offset+n.limit;return u<n.total?u:void 0},enabled:d}),c=l.useMemo(()=>i?.pages.flatMap(u=>u.items)??[],[i,a]);l.useEffect(()=>{p(c)},[c]);const B=l.useMemo(()=>{if(!i||!s)return[];const n=w(c,r);return[n.recent,n.dynamicMonths,n.dynamicYears].flatMap(f=>Object.entries(f).map(([Y,{items:A,label:C}],I)=>({key:`${Y}-${I}`,label:C,items:A}))).filter(f=>f.items.length>0)},[c,i,r,s]),E=l.useMemo(()=>{const n=c.slice(0,e??5);return{key:"recents",label:r.formatMessage(m.historyBucketRecent),items:n}},[c,e,r]);return{buckets:B,conversations:c,data:i,fetchNextPage:g,hasNextPage:v,recents:E,isLoading:b,isFetchingNextPage:S,isError:T}}function w(a,s){return a.reduce((e,t)=>{const o=new Date(t.update_time??t.create_time??0),y=$(new Date,o);if(y===0)e.recent.today.items.push(t);else if(y<=1)e.recent.yesterday.items.push(t);else if(y<=7)e.recent.lastSeven.items.push(t);else if(y<=30)e.recent.lastThirty.items.push(t);else if(q(o)){const d=k(o),r=U(o),i=`${d}-${r}`;e.dynamicMonths[i]?e.dynamicMonths[i].items.push(t):e.dynamicMonths[i]={label:s.formatDate(o,{month:"long"}),items:[t]}}else{const r=`${k(o)}-`;e.dynamicYears[r]?e.dynamicYears[r].items.push(t):e.dynamicYears[r]={label:s.formatDate(o,{year:"numeric"}),items:[t]}}return e},{recent:{today:{label:s.formatMessage(m.historyBucketToday),items:[]},yesterday:{label:s.formatMessage(m.historyBucketYesterday),items:[]},lastSeven:{label:s.formatMessage(m.historyBucketLastSeven),items:[]},lastThirty:{label:s.formatMessage(m.historyBucketLastThirty),items:[]}},dynamicMonths:{},dynamicYears:{}})}function X(a){a.invalidateQueries({queryKey:[M]})}const m=K({historyBucketRecent:{id:"history.bucket.recent",defaultMessage:"Recent"},historyBucketToday:{id:"history.bucket.today",defaultMessage:"Today"},historyBucketYesterday:{id:"history.bucket.yesterday",defaultMessage:"Yesterday"},historyBucketLastSeven:{id:"history.bucket.lastSeven",defaultMessage:"Previous 7 Days"},historyBucketLastThirty:{id:"history.bucket.lastThirty",defaultMessage:"Previous 30 Days"}});export{M as C,Z as a,X as r,z as s,W as u};
//# sourceMappingURL=gq7tdevv4xdhasrb.js.map
