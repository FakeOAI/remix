const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/sso-oqylhbcvl45iyt6z.js","assets/n6pd72le962cb7i2.js","assets/b84o1u0lhllftt1g.js","assets/root-k8lflb3j.css","assets/jz3yie9s5yhl0osu.js","assets/conversation-small-ict01xsi.css","assets/oj2veiwipsmw7uuk.js","assets/gig7dd13aioyin14.js","assets/4chk33l3szqq2hql.js","assets/iimzyot6hhcmz5qa.js","assets/k34nwqibnbti3wva.js","assets/j8qj2mi7846az0e7.js","assets/ie547sv5ox2nkp3n.js","assets/f0tq8leeyal5vk7s.js","assets/bckgb13tekr216h4.js","assets/hqh4x8749n2kj7ge.js","assets/filbl5aieb5bkhmw.js","assets/fx3mce06d5u56khw.js","assets/lfd7q1temspxd4jw.js","assets/itghwucfyv5ciib7.js","assets/zb5ak5e0r6rar6e9.js","assets/bbgivoato1fyznqa.js","assets/kk96b70qyksdg7et.js","assets/kql6flvvdpy5h8bt.js","assets/nzqt7inyyq32cen4.js","assets/983a0dy92b3ronpv.js","assets/fus06byhc4p20wb1.js","assets/kqwdyvkaaavvn8k3.js","assets/hsh822269qp8bzmy.js","assets/heu9be81ww1kispb.js","assets/botls2etwxio3srn.js","assets/jqdkr8jb3ji5agov.js","assets/e9lafxuzyeh4418f.js","assets/km3vamldayfrr3no.js","assets/kl3jr1tf2vy24qaj.js","assets/kw36kzuk49u3f1ak.js","assets/yv0ocr6xjzwc4k2s.js","assets/kgsoo4cr452bb370.js","assets/edgqdrehlp0o9wbk.js","assets/iej0cupg2dqkmejt.js","assets/ohiikrhvx7p81wqk.js","assets/hy21uuzjkoi9r4jc.js","assets/jk8w36bsokizpx57.js","assets/novzfx48sevom88u.js","assets/lqk3sweiitsdlxwj.js","assets/lx9v7qj0bs8u7xvf.js","assets/jrdlv1b5mzcvy6gz.js","assets/bqdxidyajbknrhxp.js","assets/j58s13k7ztu1fkyt.js","assets/i46e13cuhruk59si.js","assets/ikzl4tacsl5ueo0n.js","assets/bpydkge43tqkq5ul.js","assets/jb66fqbl8jx6hoxb.js","assets/c7cp1cc7b161qvoe.js","assets/f4xnb11wh0qh5f0h.js","assets/mcsgtwf5b1yx6p74.js","assets/fneqbskgc01naoiq.js"])))=>i.map(i=>d[i]);
import{r as d,aw as Ce,a6 as e,P as V,d as G,aG as P,b3 as Fa,g8 as Oo,bU as La,c as $r,f as Kr,ax as Nn,aj as te,ak as ye,cB as Rn,aB as Ue,c2 as _t,R as be,ar as T,aZ as De,da as Bo,bF as zo,U as Tt,g9 as Yr,ga as Xr,a7 as Pt,dD as Qr,c_ as Oa,b0 as Uo,bY as Ho,aE as It,aF as Dt,w as Re,a2 as Zs,S as ce,aY as Ft,b7 as ms,aK as Ve,aa as Js,a5 as Go,aJ as Ba,a3 as Lt,$ as Wo,Z as en,bR as tn,an as Ot,cX as Zr,eL as Zn,I as et,aR as mt,bO as Jr,bP as el,bQ as tl,s as sl,bs as Fe,D as Pn,O as Vo,a0 as nl,a8 as za,j as qo,eH as al,K as Ke,v as $o,n as wt,gb as ol,at as Ko,gc as Ua,a9 as il,X as Jn,gd as rl,dx as ll,dy as cl,dB as as,dz as Ha,dA as dl,c1 as jt,ge as ul,M as At,aO as hl,cQ as ml,a_ as ge,aP as fl,b6 as gl,gf as pl,di as xl}from"./n6pd72le962cb7i2.js";import{ml as sn,nE as Sl,nF as vl,bh as fs,e6 as bl,nG as yl,nH as wl,fU as nn,fV as ft,bA as gs,nI as jl,ds as He,cM as Yo,cP as Xo,aj as Ml,a2 as Cl,db as kl,cL as _l,nJ as Pe,nK as Et,nL as Tl,nM as Al,nN as El,nO as Nl,nP as Rl,nQ as Pl,mp as Il,d$ as gt,nR as Dl,nS as Fl,v as Z,nT as Ll,nU as le,nV as Qo,nW as Zo,nX as ea,nY as Ol,nZ as Jo,ng as ta,n_ as sa,n$ as Bl,o0 as zl,o1 as an,o2 as Jt,iL as In,cw as on,dB as na,F as rn,o3 as ei,o4 as Ul,o5 as Hl,o6 as Gl,mU as is,s as ti,o7 as Wl,o8 as Vl,o9 as ql,d7 as si,cX as $l,oa as Kl,jC as Yl,fG as Xl,ob as Ql,oc as Zl,od as ni,oe as Jl,b7 as Ye,of as ec,og as Gs,r as Ga,gL as tc,i6 as sc,gD as nc,oh as ai,ie as ac,km as oc,oi,oj as ic,d6 as rc,hL as aa,fM as oa,ok as lc,ol as ii,dF as rs,cC as Nt,om as ri,on as li,cx as ln,dy as ls,oo as We,op as ci,oq as cc,or as dc,os as Ws,ot as uc,ou as hc,ov as mc,ow as fc,n as gc,ox as pc,oy as xc,oz as Sc,oA as vc,oB as cn,oC as ia,oD as bc,dG as di,oE as yc,bc as Bt,oF as wc,mw as ui,oG as jc,cs as Mc,cq as Cc,oH as kc,mb as Vs,aa as ra,p as _c,gA as hi,t as Tc,fK as mi,iJ as Wa,oI as Ac,oJ as Ec,iK as Nc,mT as Rc,n0 as Va,oK as Pc,oL as Ic,iI as Dc,oM as Fc,gp as fi,oN as Lc,oO as Oc,ks as gi,fT as pi,A as la,oP as qa,cl as Bc,oQ as zc,oR as Uc,fu as Hc,mR as Gc,fv as Wc,fw as Vc,oS as xi,oT as Dn,oU as qc,oV as $c,oW as Kc,oX as Yc,oY as Xc,bZ as Si,U as cs,bV as ca,bY as Qc,oZ as Zc,o_ as Jc,o$ as ed,p0 as td,p1 as sd,p2 as nd,p3 as ad,p4 as od,dw as id,fx as rd,a8 as Rt,p5 as ld,p6 as cd,b$ as vi,p7 as dd,p8 as ud,p9 as hd,pa as md,pb as fd,pc as gd,dr as da,e0 as ua,a7 as ha,pd as bi,pe as ma,cD as ds,pf as pd,pg as xd,ph as Sd,fi as Je,iF as qs,mq as Fn,iB as yi,fX as wi,pi as ji,pj as vd,pk as bd,pl as yd,cv as fa,cA as Ln,pm as wd,pn as Mi,dt as dn,po as jd,cu as Bs,pp as On,d as Ci,pq as $a,pr as Md,ps as Cd,pt as kd,ct as _d,pu as Td,pv as Ad,u as Ed,dC as Nd,pw as ki,dD as ga,kr as pa,fp as Rd,b_ as Pd,c5 as Id,px as Dd,m as Fd,py as Qe,q as _i,pz as Ld,dE as Cn,pA as Ti,l as Od,i as Bd,i$ as Is,pB as zd,dP as Ud,pC as Hd,dY as Gd,iR as Wd,pD as Vd,pE as qd,pF as $d,f2 as Kd,nw as Yd,pG as Xd,gI as Qd,pH as Zd,pI as Ai,pJ as Ei,lj as Ni,pK as Jd,jQ as eu,l7 as xa,dk as Ri,pL as tu,pM as es,pN as su,bw as Pi,pO as nu,ae as Ii,h_ as au,pP as Di,pQ as Ka,pR as Bn,pS as ou,f_ as ts,eS as iu,f$ as $s,m$ as Ks,pT as zn,pU as ru,pV as lu,pW as cu,pX as du,k6 as Ya,pY as Ds,g2 as $e,pZ as uu,ch as Fi,ci as Li,e2 as hu,p_ as mu,fI as fu,lh as gu,cz as Oi,mr as pu,p$ as xu,q0 as Su,q1 as vu,q2 as bu,du as yu,fZ as wu,q3 as ju,q4 as Mu,q5 as Cu,q6 as ku,q7 as _u,q8 as Tu,q9 as Au,qa as Eu,qb as Nu,c7 as Bi,jO as Ru,kZ as Pu,kY as Iu,qc as Du,qd as Fu,qe as zi,gP as Lu,gl as Ui,qf as Ou,gj as Bu,k0 as zu,gk as kn,qg as Uu,qh as Hu,gw as Gu,gn as Wu,qi as Vu,lf as qu,lg as $u,gG as Ku,cW as Yu,b6 as Xu,gE as Qu,gF as Zu,gH as Ju,qj as eh,gq as Xa,c8 as th,c9 as sh,iV as nh,qk as ah,hW as oh}from"./jz3yie9s5yhl0osu.js";import{e as ps,P as xs,d as ih,D as rh,T as Un,g as lh,E as ch,h as dh}from"./iru59s8gwospk9or.js";import{p as uh,k as Hn,c as Qa,h as hh,u as mh,r as Za,g as fh,i as gh,n as ph}from"./lmpk05ol2n0ddicc.js";import{g as xh,c as Sh,C as Gn,d as vh}from"./jhq6ksntpzj6xwb1.js";import{b$ as bh,aa as yh,c0 as wh,bO as jh,ad as Mh,c1 as Ch,d as Hi,bI as kh,p as _h,ar as Sa,bm as Th,ap as Gi,c2 as Ss,ae as Wi,H as Ah,c3 as Eh,bA as Vi,au as Nh,bQ as Rh,c4 as Ph,a1 as Ih,c5 as Dh,c as qi,aJ as un,a4 as Fh,c6 as $i,aV as Lh,c7 as Oh,aU as Bh,bJ as zh,E as Uh,bj as Ki,bk as Yi,b as Hh,al as Gh,ak as Wh,b4 as Vh,P as qh,bo as $h,X as Kh,bD as Yh}from"./b84o1u0lhllftt1g.js";import{m as ae}from"./j8qj2mi7846az0e7.js";import{n as Xh,w as zs,o as Qh,p as Zh,q as Jh}from"./oj2veiwipsmw7uuk.js";import{D as B,B as em,$ as Xi}from"./gig7dd13aioyin14.js";import{b as tm}from"./ije91uudligorr9i.js";import{S as Qi,a as sm,b as nm,G as am,L as om,c as im}from"./jb66fqbl8jx6hoxb.js";import rm from"./d0ko5mmj5nikcf3o.js";import{I as lm,B as cm}from"./k34nwqibnbti3wva.js";import{a as dm}from"./lqk3sweiitsdlxwj.js";const Zi=new ps("transactionEventPlugin"),Wn="prosemirrorDispatchTransaction";function Ja(t,s){const{eventTarget:n}=Zi.getState(t.state);return n.addEventListener(Wn,s),()=>{n.removeEventListener(Wn,s)}}function um(t){return new xs({key:Zi,state:{init(){return{eventTarget:t}},apply(s,n){return n}}})}const Us=new ps("customKeymapPlugin");function hm(t,s){t.dispatch(t.state.tr.setMeta(Us,{handlers:s}))}function mm(t={handlers:{}}){return new xs({key:Us,state:{init(){return{...t}},apply(s,n){const a=s.getMeta(Us);return a?{...n,...a}:n}},props:{handleKeyDown(s,n){const o=Us.getState(s.state).handlers[n.key];return o?o(n):!1}}})}const ht=new ps("menuSelectorPlugin");function Mt(t){t.dispatch(t.state.tr.setMeta(ht,{active:!1,onMenuAction:void 0}))}function fm(t,s){t.dispatch(t.state.tr.setMeta(ht,{active:!0,onMenuAction:s}))}function gm(t={submitKeys:["Enter","Tab"],cancelKeys:["Escape"],checkStrictMatchKeys:[]}){return new xs({key:ht,state:{init(){return{...t,active:!1}},apply(s,n){const a=s.getMeta(ht);return a?{...n,...a}:n}},props:{handleKeyDown(s,n){const a=ht.getState(s.state);return a.active?a.submitKeys.includes(n.key)?(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),a.onMenuAction?.("submit"),Mt(s),!0):a.cancelKeys.includes(n.key)?(n.preventDefault(),a.onMenuAction?.("cancel"),Mt(s),!0):n.key==="ArrowUp"?(n.preventDefault(),a.onMenuAction?.("up"),!0):n.key==="ArrowDown"?(n.preventDefault(),a.onMenuAction?.("down"),!0):(a.checkStrictMatchKeys.includes(n.key)&&a.onMenuAction?.("checkMatch"),!1):!1},handleDOMEvents:{blur:s=>{ht.getState(s.state).onMenuAction?.("cancel")}}}})}const ss=new ps("placeholderPlugin");function pm(t){return new xs({key:ss,state:{init(){return{placeholder:t}},apply(s,n){return s.getMeta(ss)?{placeholder:s.getMeta(ss).placeholder}:n}},props:{decorations(s){const{doc:n}=s;if(n.childCount===1&&n.firstChild?.isTextblock&&n.firstChild.content.size===0){const o=[],{placeholder:i}=ss.getState(s);return s.doc.descendants((r,l)=>{const c=ih.node(l,l+r.nodeSize,{class:"placeholder","data-placeholder":i});o.push(c)}),rh.create(n,o)}}}})}const hn="command_token",xm={group:"inline",inline:!0,atom:!0,content:"text*",attrs:{id:"",hint:""},selectable:!1,draggable:!1,toDOM:t=>["span",{"data-mention-id":t.attrs.id,"data-mention-hint":t.attrs.hint,class:"hint-pill"},t.attrs.hint],parseDOM:[{tag:"span[data-mention-id][data-mention-hint]",getAttrs:t=>{const s=t.getAttribute("data-mention-id"),n=t.getAttribute("data-mention-hint");return{id:s,hint:n}}}]};function Ji(t,s){if(t.depth===0)return;const n=t.before(),o=t.doc.textBetween(n,t.pos,`
`,"\0").match(new RegExp(/(^|\s)\/(\w*)$/));if(o&&o.index!==void 0){const i=o[0].startsWith(" ")?o.index+1:o.index,r=o[0].startsWith(" ")?o[0].length-1:o[0].length,l=t.start()+i,c=l+r,h=l===s?.from;return{range:{from:l,to:c},queryText:o[2],isDismissed:h}}}const us=new ps("slashCommandPlugin");function Sm(t){const n=t.state.selection.$from,a=Ji(n,void 0);if(!a)return;const o=t.state.tr;t.dispatch(o.setMeta(us,{...o.getMeta(us),dismissedRange:a.range}))}function eo(){return{queryText:"",active:!1,range:void 0}}function vm(t,s,n,a,o,i){let r;if(s.id===sn.Search&&o)r=t.state.tr.delete(n.from,n.to),i(!0);else{const l=t.state.schema.nodes[hn].create({...s},t.state.schema.text(s.hint));r=t.state.tr.replaceWith(n.from,n.to,l),a&&r.insertText(" ",n.from+l.nodeSize)}t.dispatch(r)}function to(t){const{active:s,range:n,queryText:a,onHintMatch:o,dismissedRange:i}=t;if(o)return!s||!n||i?.from===n.from?o(void 0):o({text:a,range:n})}function bm(t){const s=[];return t.descendants(n=>{n.type.name===hn&&typeof n.attrs?.id=="string"&&s.push(n.attrs.id)}),s}function ym(t){const s=t.state.tr;s.doc.descendants((n,a)=>{n.type.name===hn&&s.insertText(n.textContent,a,a+n.nodeSize)}),s.steps.length>0&&t.dispatch(s)}function wm(){return new xs({key:us,state:{init(){return eo()},apply(t,s){const n=t.getMeta(us),a=t.selection,o=a.$from,i=Ji(o,s.dismissedRange),r={...eo(),...s,...n};return a.from!==a.to?(to(r),r):(r.active=!!i,i&&(r.queryText=i.queryText,r.range=i.range,i.isDismissed&&(i.queryText===""&&s.queryText!==""?r.dismissedRange=void 0:r.dismissedRange=i.range)),to(r),r)}}})}class mn extends Sl{constructor(s){super(),this.view=s}get document(){return this.view.dom.ownerDocument}isEmpty(){return this.view.state.doc.textContent.trim().length===0}trimLeadingText(s){const a=this.view.state.tr;let o=!1,i=!1;return a.doc.descendants((r,l)=>{o||!r.isText||(o=!0,r.text?.startsWith(s)&&(i=!0,a.insertText(r.text.replace(s,""),l,l+r.text.length)))}),i&&this.view.dispatch(a),i}replaceAll(s,n){const o=this.view.state.tr,i=[];o.doc.descendants((r,l)=>{!r.isText||r.text===void 0||i.push({node:r,pos:l})}),i.reverse(),i.forEach(({node:r,pos:l})=>{!r.isText||r.text===void 0||r.text.includes(s)&&o.insertText(r.text.replaceAll(s,n),l,l+r.text.length)}),this.view.dispatch(o)}appendText(s){this.view.dispatch(this.view.state.tr.insertText(s))}focus(){this.view.focus(),this.view.dispatch(this.view.state.tr.setSelection(Un.atEnd(this.view.state.doc)))}setText(s){const{tr:n,schema:a}=this.view.state,o=s?a.nodes.paragraph.create(null,a.text(s)):a.nodes.paragraph.create();this.view.dispatch(n.replaceWith(0,this.view.state.doc.content.size,o)),this.view.hasFocus()&&this.view.dispatch(this.view.state.tr.setSelection(Un.atEnd(this.view.state.doc)))}getCurrentText(){return this.view.state.doc.textContent}hasMultipleLines(){let s=0;return this.view.state.doc.descendants(n=>{n.isBlock&&s++}),s>1}getContentToSend(){return uh(this.view)}resize(){}isReady(){return!!this.view.state.doc}setPlaceholder(s){this.view.dispatch(this.view.state.tr.setMeta(ss,{placeholder:s}))}getSelectionStart(){return this.view.state.selection.ranges[0].$from.pos}isMenuSelectorActive(){return ht.getState(this.view.state).active}registerKeyHandlers(s){hm(this.view,s)}acceptLegacyKeydown(){return!1}subscribe(s,n){if(s==="change"){const a=()=>n(void 0);return Ja(this.view,a)}return this.view.dom?.addEventListener(s,n),()=>{this.view.dom?.removeEventListener(s,n)}}useState(s){return d.useSyncExternalStore(n=>Ja(this.view,n),()=>s(this),()=>s(this))}getSystemHintsFromDoc(){return bm(this.view.state.tr.doc)}getSystemHints(){const s=this.getSystemHintsFromDoc();return s.length?[s[0]]:[]}replaceSlashCommandTokensWithText(){ym(this.view)}canShowAutocompletion(){return!this.isMenuSelectorActive()&&!this.getSystemHintsFromDoc().length}}const so=Ce.div`m-8 flex flex-col items-center`;function no(t){return e.jsx(ae.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...t})}function jm({clientThreadId:t}){const n=vl(t)?.gizmoId,{data:a}=fs(n);return n==null||a==null||!bl(a)?null:e.jsx(Mm,{gizmoId:n})}function Mm({gizmoId:t}){const[s,n]=d.useState(!1),[a,o]=d.useState(!1),i=yl(t),r=async c=>{n(!0),setTimeout(()=>{o(!0)},5e3),V.logEvent(G.submitInlineRating,{gizmo_id:t,rating:c}),await i.mutateAsync({rating:c})},l=async()=>{o(!0),V.logEvent(G.dismissInlineRating,{gizmo_id:t}),await i.mutateAsync({})};return d.useEffect(()=>{a||V.logEvent(G.showInlineRating,{gizmo_id:t})},[a,t]),a?null:s?e.jsx(so,{children:e.jsxs(no,{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"rounded-lg border border-token-border-heavy p-4",children:e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(P,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),e.jsx(Fa,{onClick:()=>{o(!0)}})]})}),e.jsx("div",{className:"text-xs text-token-text-tertiary",children:e.jsx(P,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):e.jsx(so,{children:e.jsxs(no,{className:"flex flex-col items-center gap-4 rounded-lg border border-token-border-heavy p-4",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(P,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),e.jsx(Fa,{onClick:l})]}),e.jsx(wl,{rating:void 0,onRating:r})]})})}const Cm=({clientThreadId:t})=>{const s=Oo(),n=nn(t),a=ft(n);d.useEffect(()=>{a&&La.dismissBanner()},[a]);const o=s?.is_dismissible?()=>La.dismissBanner():void 0;return e.jsx(gs,{children:s&&e.jsx(ae.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(jl,{clientThreadId:t,rateLimitInfo:s,onDismiss:o})})})};function km(t){const s=nn(t),n=ft(s),a=Oo();return!n&&a!=null}const Vn=window.sessionStorage,qn=$r(Kr(()=>({memoryFullBannerDismissed:!!Vn?.getItem(Nn.MemoryFullBannerDismissed)}))),er={dismissBanner(){qn.setState(t=>{t.memoryFullBannerDismissed=!0}),Vn?.setItem(Nn.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){qn.setState(t=>{t.memoryFullBannerDismissed=!1}),Vn?.removeItem(Nn.MemoryFullBannerDismissed)}};function _m(t){const s=He(t),n=Yo(),{data:a}=Xo(s,!1,n),o=a!=null,i=o&&a.memoryFullPct>=100,[r,l]=d.useState(!1);d.useEffect(()=>{!i&&o&&(l(!0),er.clearDismissedBanner())},[i,o]);const c=qn(h=>h.memoryFullBannerDismissed);return i&&r&&!c}function Tm(){const t=te(),{openSettings:s}=Ml();return e.jsx(ae.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(Cl,{title:t.formatMessage(Fs.memoryFullTitle),content:t.formatMessage(Fs.memoryFullTooltip,Fs.memoryFullTooltip.values),primaryCtaText:t.formatMessage(Fs.memoryManageButton),onPrimaryCtaClick:()=>s(kl.Personalization),onDismiss:()=>er.dismissBanner()})})}const Fs=ye({memoryFullTitle:{id:"yRGU2/",defaultMessage:"Memory is full."},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"neUc+N",defaultMessage:"New memories won’t be created until you make space. <a>Learn more</a>",values:{a:t=>e.jsx("a",{href:_l,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}}}),Am=d.memo(function(s){return Em(s),Nm(s),Rm(),null});function Em(t){const{store:s}=Pe(),n=s.useSetSharedProps();Rn(()=>{n(t)},[t,n])}function Nm(t){const{clientThreadId:s,canContinue:n}=t,{store:a}=Pe(),o=d.useRef({top:a.useContentAreaApi(Et.HeaderTop),bottom:a.useContentAreaApi(Et.HeaderBottom)}).current,i=Dm(t),r=Tl(s),{shouldShowBannerSignup:l,shouldShowBannerTermsDisclaimer:c}=Fm(s),h=km(s),u=Al(t),m=El(t),g=Nl(t),p=_m(s),y=Rl(),f=Pl(t);Rn(()=>{f.eligible?o.top.set(le.AdvancedVoiceOnMobileAnnouncement):y?o.top.set(le.ParagenControls):c?o.top.set(le.BannerTermsDisclaimer):h?o.top.set(le.BannersRateLimit):u.eligible?o.top.set(le.BannerSidekickAnnouncement):m?o.top.set(le.SearchBrowserExtensionAnnouncement):g?o.top.set(le.SearchBrowserExtensionReactiveAnnouncement):i?o.top.set(le.ItemActions):n?o.top.set(le.PromptTextareaAction):l?o.top.set(le.BannerSignup):p?o.top.set(le.BannerMemoryFull):o.top.set(null)},[o,i,n,c,l,h,u,p,y,f]),Rn(()=>{r&&o.bottom.set(Qo.DallePromptControls)},[o,r])}function Rm(){const{store:t}=Pe();d.useEffect(()=>()=>{t.reset()},[t])}function Pm(t){const s=Zo(),n=gt(t),a=Z.getTree(t).getLastValidNode(n)?.message?.id;return s?.messageId===a?s.suggestions:[]}function Im(t){return Pm(t).length>0}function Dm(t){const s=Il(t.clientThreadId),n=Im(t.clientThreadId);return t.isDisabled?!1:t.isNewThread||s||n}function Fm(t){const{isUnauthenticated:s}=Ue(),n=gt(t),{layer:a}=_t("3637408529"),o=a.get("should_show_no_auth_signup_banner",!0),i=Dl(g=>g.bannerDisclaimerClientThreadId),r=Fl(),l={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1};if(!t)return l;const c=Z.getTree(t),h=c.countMessagesByAuthor(be.User),u=c.getNodeByIdOrMessageId(n),m=u?.message?.author.role===be.Assistant&&Ll(u.message);return l.shouldShowBannerTermsDisclaimer=m&&s&&h===1&&!r&&(i==null||i===t),l.shouldShowBannerSignup=o&&m&&s&&h>0&&h%5===0,l}function tr({children:t,className:s,showBackground:n}){return e.jsxs("div",{className:"relative",children:[t,n&&e.jsx(ae.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:T("pointer-events-none absolute bottom-0 top-0 h-8 w-8 rounded-full",s)})]})}function ao({entry:t,onClick:s}){const{connectorConfig:n}=ea();d.useEffect(()=>{if(!open||t.type!==De.GDRIVE)return;const l=n.get(De.GDRIVE)?.access_token;l&&Ol(l)},[n,t.type]);const a=Jo(t.type),o=te(),i=t.access_token?oo.uploadFromMessage:oo.signinWithMessage;return e.jsx(B.Item,{onClick:s,icon:a,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx(P,{...i,values:{connectorName:ta(t.type,o)}}),t.type===De.O365_BUSINESS&&e.jsx("div",{className:"text-s text-token-text-tertiary",children:e.jsx(P,{...sa.includesSharePoint})})]})},t.id)}const oo=ye({signinWithMessage:{id:"ContextConnectorPickerDropdownItem.signInWithMessage",defaultMessage:"Connect to {connectorName}"},uploadFromMessage:{id:"ContextConnectorPickerDropdownItem.uploadWithMessage",defaultMessage:"Add from {connectorName}"}});function Lm({clientThreadId:t,icon:s,setOpen:n,isDisabled:a=!1,highlightTooltip:o=!1}){const i=Bo(),r=te();return a=a||!!i,e.jsxs(e.Fragment,{children:[e.jsx(B.Trigger,{className:"m-0 h-0 w-0 border-none bg-transparent p-0"}),e.jsx(Bl,{clientThreadId:t,rateLimitPopup:i,highlightTooltip:o,children:e.jsx(zl,{disabled:a,"aria-disabled":a,"aria-label":r.formatMessage({id:"tA7CXR",defaultMessage:"Attach files"}),onClick:l=>{l.preventDefault(),n(!0)},children:s})})]})}function Om({connectorEntries:t,onOauthRedirect:s}){const n=te();return e.jsxs(B.Sub,{children:[e.jsx(B.SubMenuTrigger,{icon:bh,children:e.jsx("div",{className:"line-clamp-1 text-ellipsis",children:e.jsx(P,{...Bm.connectApps})})}),e.jsx(B.Portal,{children:e.jsx(B.SubContent,{children:t.map(a=>e.jsx(B.Item,{onClick:()=>s(a),icon:Jo(a.type),children:e.jsxs("div",{className:"flex flex-col",children:[ta(a.type,n),a.type===De.O365_BUSINESS&&e.jsx("div",{className:"text-s text-token-text-tertiary",children:e.jsx(P,{...sa.includesSharePoint})})]})},a.id))})})]})}const Bm=ye({connectApps:{id:"ContextConnectorPicker.connectApps",defaultMessage:"Connect apps"}});function zm({onOauthRedirect:t,connectors:s}){const n=te();return e.jsxs(B.Sub,{children:[e.jsx(B.SubMenuTrigger,{icon:yh,children:e.jsx(P,{...Um.oneDriveSubmenuName})}),e.jsx(B.Portal,{children:e.jsx(B.SubContent,{children:s.map(a=>a?e.jsx(B.Item,{onClick:()=>t(a),children:e.jsxs("div",{className:"flex flex-col",children:[ta(a.type,n),a.type===De.O365_BUSINESS&&e.jsx("div",{className:"text-s text-token-text-tertiary",children:e.jsx(P,{...sa.includesSharePoint})})]})},a.id):null)})})]})}const Um=ye({oneDriveSubmenuName:{id:"ContextConnectorPickerOneDriveSubmenu.oneDriveSubmenuName",defaultMessage:"Connect to Microsoft OneDrive"}}),Hm={"image/jpeg":".jpg","image/png":".png"};function Gm({entry:t}){return e.jsx(B.Item,{onClick:t.onClick,icon:t.icon,children:e.jsx(P,{...t.label})},t.key)}function Wm(t){const s=te(),n=Pt(),a=an();return d.useCallback(async i=>{const r=`${new Date().toISOString().replaceAll(":","-")}${Hm[i.mimeType]}`;Jt.uploadFile(a,new File([i.data],r,{type:i.mimeType}),t,s,n,void 0,void 0,In.Multimodal)},[a,s,n,t])}function Vm(t){const s=Wm(t),n=qm(s),a=$m(s);return{desktopConnectors:d.useMemo(()=>zo?[n,a].filter(i=>i!==void 0):[],[n,a])}}function qm(t){const{value:s}=Tt("4204519260");return d.useMemo(()=>{if(s)return{key:"takeScreenshot",label:sr.takeScreenshot,icon:wh,onClick:async()=>{const n=await Yr();n&&(V.logEvent(G.sidetronScreenshotAttached),await t(n))}}},[s,t])}function $m(t){const{value:s}=Tt("239993468");return d.useMemo(()=>{if(s)return{key:"takePhoto",label:sr.takePhoto,icon:jh,onClick:async()=>{const n=await Xr();n&&(V.logEvent(G.sidetronPhotoAttached),await t(n))}}},[s,t])}const sr=ye({takeScreenshot:{id:"ContextConnectorPickerDropdownItem.takeScreenshotDesktop",defaultMessage:"Take screenshot"},takePhoto:{id:"ContextConnectorPickerDropdownItem.takePhotoDesktop",defaultMessage:"Take photo"}});function Km(){const{connectorConfig:t}=ea(),s=on(),n=si(),[a,o]=is(ti([...t.values()],u=>!!u.access_token),u=>!!u.access_token),[i,r]=is(o,u=>u.type===De.O365_PERSONAL||u.type===De.O365_BUSINESS),l=!s&&!n&&a.length>0,c=!s&&!n&&!l&&i.length>1;return{unconnectedConnectors:n?[]:c?r:o,showUnconnectedInSubmenu:l,showOneDriveInSubmenu:c}}function Ym({clientThreadId:t,icon:s,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:a,attachmentsProductFeature:o,onOauthRedirect:i,uploadType:r,getInputProps:l,openFileDialog:c,isDisabled:h=!1,highlightTooltip:u=!1}){const{currentLocale:m}=Qr(),g=te(),p=Pt(),y=an(),f=on(),{connectorConfig:v,isLoading:x}=ea(),M=na(rn.ContextConnectors),{getGizmoId:S}=ei(),[b,C]=d.useState();d.useEffect(()=>{S?S().then(I=>C(I)):C(void 0)},[S]);const F=d.useRef(null),[N,j]=d.useState(!1),w=d.useRef(!1),k=d.useCallback(()=>{const I=F.current?.files;Array.from(I??[]).forEach(de=>Jt.uploadFile(y,de,a,g,p,o))},[y,a,g,p,o]),[X,U]=d.useState(null),R=d.useCallback(()=>U(null),[U]),O=d.useCallback((I,de)=>Jt.uploadPickedFile(y,I,de,a,n,o,b,g,p),[y,a,n,o,b,g,p]),{openMenu:L,confirmMenuOpened:E}=Ul();d.useEffect(()=>{L&&(j(!0),E())},[L,E,j]);const _=d.useCallback(I=>{Jt.doContextConnectorOauthRedirect(location.pathname+location.search+location.hash,I,i,Oa.Picker),i()},[i]),q=d.useCallback(I=>{Jt.uploadPickedFile(y,I,De.GDRIVE,a,n,o,b,g,p)},[y,a,n,o,b,g,p]),$=d.useCallback(async I=>{const{access_token:de}=I;if(!de){_(I);return}switch(Hl(I,Oa.Picker),I.type){case De.GDRIVE:Gl(m,I.type,de,Le=>Le.forEach(q));break;case De.O365_PERSONAL:case De.O365_BUSINESS:U(I.type);break}},[q,_,U,m]),K=()=>{V.logEvent(G.openFileViewer,{intent:r.toString()}),c()},H=I=>{if(!I&&w.current&&!x)K();else if(I&&je&&!x){K();return}j(I),I&&(M.eligible&&M.markAsViewed(),V.logEvent(G.composerOpenContextConnectorPicker),w.current=!0,setTimeout(()=>{w.current=!1},250))},[J,we]=is(ti([...v.values()],I=>!!I.access_token),I=>!!I.access_token);Xm(J,$);const[me]=is(we,I=>I.type===De.O365_PERSONAL||I.type===De.O365_BUSINESS),{unconnectedConnectors:oe,showUnconnectedInSubmenu:ie,showOneDriveInSubmenu:Ae}=Km(),{desktopConnectors:se}=Vm(a),je=!J.length&&!oe.length&&!se.length,Se=e.jsxs(e.Fragment,{children:[ie&&oe.length>0&&e.jsx(Om,{connectorEntries:oe,onOauthRedirect:I=>_(I)}),!ie&&oe.map(I=>e.jsx(ao,{entry:I,onClick:()=>$(I)},I.id)),Ae&&e.jsx(zm,{connectors:me,onOauthRedirect:_}),x&&e.jsx(B.Item,{icon:e.jsx(Uo,{className:"text-token-text-secondary"})}),(oe.length>0||x)&&e.jsx(B.Separator,{}),J.map(I=>e.jsx(ao,{entry:I,onClick:()=>$(I)},I.id)),se.map(I=>e.jsx(Gm,{entry:I},I.key)),e.jsx(B.Item,{onClick:K,icon:Mh,children:e.jsx(P,{...f?io.uploadFileMobile:io.uploadFile})},"upload")]}),ke=e.jsxs("div",{className:"flex flex-col",children:[e.jsx(Wl,{type:X,onClose:R,uploadPickedFile:O}),e.jsx("input",{onChange:k,...l({className:"hidden"})}),e.jsxs(B.Root,{open:N,onOpenChange:H,children:[e.jsx(Lm,{clientThreadId:t,icon:s,setOpen:H,isDisabled:h,highlightTooltip:u}),e.jsx(B.Portal,{children:e.jsx(B.Content,{size:"large",children:Se})})]}),e.jsx(Vl,{hasConnectors:!x&&!je})]});return{dropdownItems:Se,mainComponent:ke}}function Xm(t,s){const{connector:n,clearParam:a}=ql(),o=t.find(i=>i.type===n&&!!i.access_token);d.useEffect(()=>{o&&(s(o),a())},[o,s,a])}function Qm(t){const{mainComponent:s}=Ym(t);return s}const io=ye({attachFiles:{id:"ContextConnectorPicker.attachFiles",defaultMessage:"Attach files"},uploadFile:{id:"LocalFileDropdownItem.uploadFile",defaultMessage:"Upload from computer"},uploadFileMobile:{id:"LocalFileDropdownItem.uploadFileMobile",defaultMessage:"Upload file"}});function Zm({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:a,attachmentsProductFeature:o,getInputProps:i,openFileDialog:r,onOauthRedirect:l,historyDisabled:c,isDisabled:h,highlightTooltip:u}){const m=si(),{gdriveStatus:g,o365Status:p}=$l(),y=e.jsx(Ch,{className:c?"text-white":u?"text-brand-blue-800":void 0}),f=g!=="false"||p!=="false"||m;return e.jsx("div",{className:T("relative",h&&"pointer-events-none opacity-30"),children:e.jsx(tr,{showBackground:u,className:"bg-brand-blue-800/20",children:f?e.jsx(Qm,{clientThreadId:t,icon:y,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:a,attachmentsProductFeature:o,onOauthRedirect:l,uploadType:s,openFileDialog:r,getInputProps:i,isDisabled:h,highlightTooltip:u}):e.jsx(Kl,{clientThreadId:t,uploadType:s,openFileDialog:r,getInputProps:i,icon:y,isDisabled:h,highlightTooltip:u})})})}function Jm(){return Hn({"Shift-Enter":(t,s)=>Qa(t,s),Enter:(t,s)=>window.innerWidth>Yl[Xl.Medium]?!1:Qa(t,s)})}const ef=["p",0],tf=["br"],sf=new lh({nodes:{paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p",preserveWhitespace:"full"}],toDOM(){return ef}},text:{group:"inline"},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM(){return tf}},[hn]:xm,doc:{content:"block+"}},marks:{}});function nf(){const t=new EventTarget,s=new ch(null,{state:dh.create({schema:sf,plugins:[hh(),gm({submitKeys:["Enter","Tab"],cancelKeys:["Escape"],checkStrictMatchKeys:[" "]}),pm(""),wm(),Jm(),Hn({"Mod-z":mh,"Mod-y":Za,"Mod-Shift-z":Za}),mm(),Hn(tm),um(t),fh()]}),dispatchTransaction(n){const a=s.state.apply(n);s.updateState(a),n.docChanged&&t.dispatchEvent(new Event(Wn))},handlePaste(n,a){const o=a.clipboardData?.getData("text/plain");return o===void 0?!1:(Ql(o)||gh(n,o),!0)},clipboardTextSerializer(n){return ph(n.content).content}});return s}function af(){try{return navigator.userAgent.toLocaleLowerCase().includes("firefox")}catch{return!1}}const of=[T([Zl["prosemirror-parent"],"text-token-text-primary","max-h-[25dvh]","max-h-52","overflow-auto",af()?"firefox":"default-browser"])],rf=({children:t})=>{const[s]=d.useState(()=>new mn(nf()));return t(s)},ro=({composerController:t,placeholder:s})=>{const n=d.useContext(Ho),a=d.useRef(null),o=d.useRef(null),i=d.useRef(!1);return d.useEffect(()=>{if(i.current)return;if(!(t instanceof mn))throw new Error(`Expected instance of ProseMirrorComposerController but got ${t.constructor.name}`);i.current=!0;const r=o.current;if(r!=null){const{value:l,selectionStart:c,selectionEnd:h}=r;t.view.dispatch(t.view.state.tr.insertText(l)),t.view.dispatch(t.view.state.tr.setSelection(Un.create(t.view.state.doc,c+1,h+1))),r.style.display="none",r.value=""}a.current.appendChild(t.view.dom),t.view.dom.id=ni,Jl(t.view.dom),t.view.focus()},[t]),d.useEffect(()=>{t.setPlaceholder(s)},[s,t]),d.useEffect(()=>{t.logPageMount()},[]),e.jsxs("div",{ref:a,className:T(of),children:[e.jsx("textarea",{className:"block h-10 w-full resize-none border-0 bg-transparent px-0 py-2 text-token-text-primary placeholder:text-token-text-secondary",autoFocus:!0,placeholder:s,ref:o}),e.jsx("script",{nonce:n.cspScriptNonce,suppressHydrationWarning:!0,children:"window.__oai_logHTML?window.__oai_logHTML():window.__oai_SSR_HTML=window.__oai_SSR_HTML||Date.now();requestAnimationFrame((function(){window.__oai_logTTI?window.__oai_logTTI():window.__oai_SSR_TTI=window.__oai_SSR_TTI||Date.now()}))"})]})},lf=It(()=>Dt(()=>import("./sso-oqylhbcvl45iyt6z.js").then(t=>t.b),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44])).then(t=>({default:t.ComposerRightActions}))),cf=d.forwardRef(function({type:s,placeholder:n,replyRegions:a,state:o,renderFiles:i,leftSideActions:r,onSubmit:l,inputState:c,currentLeafId:h,composerController:u,clientThreadId:m,gizmoId:g,disableReason:p,modelId:y},f){const v=Ye(),x=ec(),{value:M}=Re("1567586774"),{value:S}=Re("1028682714");d.useEffect(()=>{u.focus()},[x?.modelId,u]);const b=C=>{ff({target:C.target,rootId:"composer-background",additonalInteractiveIds:["reply-regions"]})||u.focus()};return e.jsxs("div",{id:"composer-background",ref:f,className:T("flex w-full flex-col transition-colors contain-inline-size",v&&"backdrop-blur-2xl no-transparency:backdrop-blur-none",v&&s!=="temporary"&&"bg-token-composer-surface",M?"cursor-text rounded-3xl px-2.5 py-1":"gap-1.5 rounded-[26px] px-2.5 py-1.5",!v&&s!=="temporary"&&"bg-[#f4f4f4] dark:bg-token-main-surface-secondary",s==="temporary"&&"dark bg-black"),onClick:b,children:[e.jsx(gs,{initial:!1,children:a.length>0&&e.jsx(ae.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0,transition:{duration:.06}},transition:{ease:"easeOut",duration:.1},id:"reply-regions",children:e.jsx(df,{replyRegions:a})})}),M?e.jsxs(e.Fragment,{children:[i,e.jsx("div",{className:"flex min-h-[44px] items-center px-2",children:e.jsx("div",{className:"max-w-full flex-1",children:u instanceof Gs?e.jsx(lo,{composerController:u,currentLeafId:h,placeholder:n,inputState:c}):e.jsx(ro,{composerController:u,placeholder:n})})}),e.jsxs("div",{className:"flex h-[44px] items-center justify-between",children:[e.jsx("div",{className:"flex gap-x-1",children:r}),S?e.jsx(lf,{inputState:c,state:o,onSubmit:l,composerController:u,clientThreadId:m,gizmoId:g,disableReason:p,modelId:y}):e.jsx(Ga,{inputState:c,state:o,onSubmit:l,composerController:u,clientThreadId:m,gizmoId:g,disableReason:p})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-end gap-1.5 pl-4 md:gap-2",children:[!!r?.length&&e.jsx(ae.div,{initial:{opacity:0},animate:{opacity:1},transition:{ease:"easeOut",duration:.06},className:"-ml-2.5 mb-1 flex",children:r},"leftSideActions"),e.jsxs(ae.div,{layout:!0,transition:{duration:.1},className:T("flex min-w-0 flex-1 flex-col"),children:[i,u instanceof Gs?e.jsx(lo,{composerController:u,currentLeafId:h,placeholder:n,inputState:c}):e.jsx(ro,{composerController:u,placeholder:n})]}),e.jsx("div",{className:"mb-1 me-1",children:e.jsx(Ga,{inputState:c,state:o,onSubmit:l,composerController:u,clientThreadId:m,gizmoId:g,disableReason:p})})]})})]})});function lo({composerController:t,currentLeafId:s,placeholder:n,inputState:a}){const o=d.useContext(Ho);return e.jsxs(e.Fragment,{children:[e.jsx(tc,{id:ni,autoFocus:!0,tabIndex:0,"data-id":s,dir:"auto",ref:i=>{if(!(t instanceof Gs))throw new Error("Expected TextAreaComposerController");i!=null&&(t.textArea=i,t.logPageMount())},rows:1,placeholder:n,disabled:a!=="default",className:T("m-0 resize-none border-0 bg-transparent px-0 text-token-text-primary focus:ring-0 focus-visible:ring-0",a==="disabled"&&"text-center",["max-h-[25dvh]","max-h-52"])}),e.jsx("script",{nonce:o.cspScriptNonce,suppressHydrationWarning:!0,children:"requestAnimationFrame((function(){window.__oai_logTTI?window.__oai_logTTI():window.__oai_SSR_TTI=window.__oai_SSR_TTI??Date.now()}))"})]})}function df({replyRegions:t}){return e.jsx("div",{className:"flex cursor-auto flex-col divide-y divide-token-border-light overflow-hidden rounded-b-lg rounded-t-[20px] bg-token-main-surface-primary",children:t.map((s,n)=>{switch(s.type){case"text":return e.jsx(uf,{value:s.value,onRemoveRegion:s.onRemoveRegion},n);case"object":return e.jsx(hf,{value:s.value,onRemoveRegion:s.onRemoveRegion},n);case"mention":case"system_hint":return e.jsx(mf,{value:s.value,icon:s.icon,onRemoveRegion:s.onRemoveRegion},n)}})})}function uf({value:t,onRemoveRegion:s}){return e.jsxs(ba,{className:"text-token-text-secondary",children:[e.jsx(ya,{children:e.jsx(Hi,{className:"icon-lg-heavy"})}),e.jsx(wa,{children:`“${t}”`}),e.jsx(va,{onClick:s})]})}function hf({value:t,onRemoveRegion:s}){return e.jsxs(ba,{className:"text-blue-selection",children:[e.jsx(ya,{children:e.jsx(Hi,{className:"icon-lg-heavy"})}),e.jsx(wa,{className:"font-semibold",children:t}),e.jsx(va,{onClick:s})]})}function mf({value:t,icon:s,onRemoveRegion:n}){return e.jsxs(ba,{children:[e.jsx(ya,{className:"mt-0",children:s}),e.jsx(wa,{className:"font-semibold text-token-text-primary",children:t}),e.jsx(va,{onClick:n})]})}function va({onClick:t}){return e.jsx("button",{onClick:t,type:"button",className:"flex-shrink-0 text-token-text-secondary",children:e.jsx(kh,{className:"icon-lg"})})}const ba=Ce.div`flex items-start py-2.5 gap-3 pl-3 pr-1.5 text-sm`,ya=Ce.span`flex-shrink-0 mt-0.5 w-7 h-6 flex justify-center items-center`,wa=Ce.span`flex-1 line-clamp-3 py-0.5`;function ff({target:t,rootId:s,additonalInteractiveIds:n}){let a=t;for(;a&&a!=null;){if(a.tagName==="BUTTON"||a.tagName==="INPUT"||a.tagName==="TEXTAREA"||a.isContentEditable||n.includes(a.id))return!0;if(a.id===s)return!1;a=a.parentElement}return!1}const gf=t=>{const{metadata:s}=t;return s?.type?oc(s.type):!1},pf=({textdocId:t,pastedTextdoc:s,isCanvasOpen:n=!1,isFocused:a=!1})=>{const{content:o,metadata:i}=s;return e.jsxs("div",{className:"group/file-tile relative",children:[e.jsx("button",{onClick:()=>ai.removePastedContent(t),className:"absolute -left-1 -top-1 z-10 hidden rounded-full border-[3px] border-[#f4f4f4] bg-black p-[2px] text-white group-hover/file-tile:block dark:border-token-main-surface-secondary dark:bg-white dark:text-black",children:e.jsx(_h,{className:"icon-xs"})}),e.jsx(Xh,{isInlinePreview:!0,isCanvasOpen:n,isFocused:a,textdocId:t,name:i?.title??null,type:i?.type??null,size:"small",onClick:()=>ac(t),children:e.jsx("div",{className:T("whitespace-pre px-4",gf(s)&&"font-mono"),children:o})})]})},xf=({textdocId:t,pastedTextdoc:s})=>{const n=sc(t),a=nc();return e.jsx(pf,{isFocused:n,isCanvasOpen:a,pastedTextdoc:s,textdocId:t})};function Sf({composerController:t}){const{doesUserHaveAnyAccountsWithPlusFeatures:s}=Zs(),n=te(),a=oi();return e.jsxs("div",{className:T("flex justify-between",!a&&"bg-gradient-to-t from-token-main-surface-primary to-transparent px-4"),children:[e.jsx("div",{className:"flex gap-2",children:e.jsx(bf,{onClickStyle:o=>{uo(n.formatMessage(o.expandedName??o.name),t)}})}),s&&e.jsx("div",{className:"flex gap-2",children:e.jsx(vf,{onClickAspectRatio:o=>uo(n.formatMessage(o.expandedName),t)})})]})}function vf({onClickAspectRatio:t}){const s=te();return e.jsxs(B.Root,{onOpenChange:n=>{n&&(ce.logEvent(G.dalleOpenAspectRatioDropdown),V.logEvent(G.dalleOpenAspectRatioDropdown))},children:[e.jsxs($n,{$as:B.Trigger,className:"pr-1.5",children:[e.jsx(P,{id:"dalleControls.aspectRatio",defaultMessage:"Aspect Ratio"}),e.jsx(Sa,{className:"icon-md"})]}),e.jsx(B.Portal,{children:e.jsx(B.Content,{children:ic.map(n=>e.jsx(B.Item,{onClick:()=>{t(n),ce.logEvent(G.dalleClickAspectRatio,n.name.defaultMessage?.toString()),V.logEvent(G.dalleClickAspectRatio,{aspectRatio:n.name.defaultMessage})},icon:n.icon,children:s.formatMessage(n.name)},n.name.id))})})]})}function bf({onClickStyle:t}){const[s,n]=d.useState(co()),a=rc(),o=aa(),i=oa(),r=te();let l=2;return i||(o?l=5:a&&(l=3)),e.jsxs(e.Fragment,{children:[s.slice(0,l).map(c=>e.jsx(Ft,{label:e.jsx(yf,{style:c}),side:"top",sideOffset:4,customPaddingClassName:"p-1",children:e.jsxs($n,{$as:"button",type:"button",onClick:()=>{t(c),ce.logEvent(G.dalleClickStyle,c.name.defaultMessage?.toString()),V.logEvent(G.dalleClickStyle,{style:c.name.defaultMessage})},children:[e.jsx(Th,{className:"h-4 w-4 text-token-text-tertiary"}),r.formatMessage(c.name)]})},c.name.id)),e.jsx($n,{$as:"button",type:"button",onClick:()=>{n(co()),ce.logEvent(G.dalleShuffleStyles),V.logEvent(G.dalleShuffleStyles)},children:e.jsx(lc,{className:"icon-sm text-token-text-tertiary"})}),ii.map(c=>e.jsx("img",{src:c.image.src,alt:r.formatMessage(c.name),width:100,height:100,className:"invisible fixed -left-96 -top-96"},c.name.id))]})}function yf({style:t}){const s=te();return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("img",{src:t.image.src,alt:s.formatMessage(t.name),width:100,height:100,className:"rounded-md"}),e.jsx("div",{className:"text-xs font-medium",children:s.formatMessage(t.name)})]})}function co(){return[...ii].sort(()=>Math.random()-.5)}function wf(t,s){const n=s.getCurrentText();return n.trim()===""?t:n.endsWith(",")?` ${t.toLocaleLowerCase()}`:n.endsWith(", ")?t.toLocaleLowerCase():`, ${t.toLocaleLowerCase()}`}function uo(t,s){const n=wf(t,s);s.appendText(n),rs()}const $n=Ce.div`h-7 bg-token-main-surface-primary border border-token-border-light text-xs hover:bg-token-main-surface-secondary hover:text-token-text-primary px-2.5 radix-state-open:bg-token-main-surface-secondary radix-state-open:text-token-text-primary rounded-full flex flex-nowrap gap-0.5 items-center text-token-text-secondary font-normal`,Ls={initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:.1},exit:{opacity:0,scale:.5,transition:{duration:.2}}},jf=({suggestions:t,onSelectingSuggestedReply:s})=>e.jsx("div",{className:"absolute bottom-full flex w-full max-w-[100vw] grow gap-2 overflow-auto px-1 pb-1 contain-inline-size sm:mb-0 sm:justify-start sm:px-2 sm:pb-0 md:static md:mb-2 md:max-w-none md:justify-center md:overflow-visible",children:t.slice(0,2).map((n,a)=>e.jsx(ae.div,{initial:Ls.initial,animate:Ls.animate,transition:{delay:(a-1)*Ls.transition.delay},exit:Ls.exit,children:e.jsx(Ve,{as:"button",color:"secondary",size:"small",onClick:()=>{s(n,t,a)},className:"group whitespace-nowrap md:whitespace-normal",children:e.jsx(Cf,{suggestion:n})},a)},a))});function Mf({suggestions:t,onSelectingSuggestedReply:s,clientThreadId:n}){const a=t?.length>0;d.useEffect(()=>{a&&Nt(t,n)},[a,n]);const{isUnauthenticated:o}=Ue();return a?t.every(ri)?e.jsxs(ae.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"flex flex-col items-center",children:[o&&e.jsx(ms,{className:"mb-6 h-12 w-12 sm:hidden"}),e.jsx(Qi,{starterPrompts:t,onSelectStarterPrompt:s})]}):t.every(li)?e.jsx(jf,{suggestions:t,onSelectingSuggestedReply:s}):null:null}function Cf({suggestion:t}){return li(t)?e.jsx(e.Fragment,{children:t.text}):ri(t)?e.jsxs("div",{className:"flex flex-col overflow-hidden",children:[t.title&&e.jsx("div",{className:"truncate font-semibold",children:t.title}),e.jsx("div",{className:T("truncate font-normal",t.title?"opacity-50":""),children:t.body})]}):null}function kf(){const{store:t}=Pe(),s=t.useSharedProps();return s?e.jsx(_f,{...s}):null}function _f({clientThreadId:t,suggestions:s}){const n=ln();return s===void 0||s.length===0?null:e.jsx("div",{children:e.jsx(Tf,{children:e.jsx("div",{className:"grow",children:s!==void 0&&e.jsx(Mf,{suggestions:s,onSelectingSuggestedReply:n,clientThreadId:t})})})})}const Tf=Ce.div`h-full flex ml-1 md:w-full md:m-auto gap-0 md:gap-2 justify-center`,nr=({className:t,children:s})=>e.jsx(ae.div,{className:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:s});function Af({currentLeafId:t,canContinue:s,onContinueGenerating:n}){const a=d.useCallback(()=>{const i=new ls;n(t,i),rs()},[n,t]);let o=null;return s&&(o=e.jsx(Nf,{onHandleContinueGenerating:a})),o&&e.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:o})}function Ef({className:t}){return e.jsx(Gi,{className:T("-rotate-180",t)})}const Nf=({onHandleContinueGenerating:t})=>e.jsx(nr,{children:e.jsx(Ve,{as:"button",color:"secondary",onClick:t,className:"whitespace-nowrap py-2",icon:Ef,size:"small",children:e.jsx(P,{...We.continueGenerating})})}),Rf=()=>{const{shouldShowSkipButton:t}=ci();return t?e.jsx(nr,{className:"flex justify-center",children:e.jsx(Ve,{as:"button",color:"secondary",onClick:()=>cc.skipParagen(),children:e.jsx(P,{...Pf.skip})})}):null},Pf=ye({skip:{id:"dvcUbp",defaultMessage:"Skip"}}),ar=d.memo(function({className:s}){const{store:n}=Pe(),a=n.useIsHeaderContentAreaPopulated();return e.jsx("div",{className:T(s??"absolute bottom-full left-0 right-0",Ws.PromptTextareaHeader),children:e.jsx(dc,{shouldRender:a,contentArea:Et.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(or,{}),e.jsx(ir,{})]})})})});function or(){const{store:t}=Pe(),s=t.useSharedProps(o=>o?.clientThreadId),n=t.useContentAreaId(Et.HeaderTop);let a;switch(n){case le.AdvancedVoiceOnMobileAnnouncement:a=e.jsx(fc,{clientThreadId:s});break;case le.ParagenControls:a=e.jsx(Rf,{});break;case le.ItemActions:a=e.jsx(kf,{});break;case le.BannerSignup:a=e.jsx(Df,{});break;case le.BannerTermsDisclaimer:a=e.jsx(Ff,{});break;case le.PromptTextareaAction:a=e.jsx(Lf,{});break;case le.BannersRateLimit:a=e.jsx(Of,{});break;case le.BannerSidekickAnnouncement:a=e.jsx(mc,{});break;case le.SearchBrowserExtensionAnnouncement:a=e.jsx(hc,{});break;case le.SearchBrowserExtensionReactiveAnnouncement:a=e.jsx(uc,{});break;case le.BannerMemoryFull:a=e.jsx(Tm,{});break;case le.Box:a=e.jsxs("div",{className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;default:a=null;break}return a}function ir(){const{store:t}=Pe(),s=t.useContentAreaId(Et.HeaderBottom);let n;switch(s){case Qo.DallePromptControls:n=e.jsx(If,{});break;default:n=null;break}return n}function If(){const{store:t}=Pe(),s=t.useSharedProps(n=>n?.composerController);return s?e.jsx(Sf,{composerController:s}):null}function Df(){const{store:t}=Pe(),s=t.useSharedProps(o=>o?.clientThreadId),n=gc(),a=pc();return s?n?e.jsx(xc,{threadId:s,showSignUp:a}):e.jsx(Sc,{threadId:s,showLogin:a}):null}function Ff(){const{store:t}=Pe(),s=t.useSharedProps(n=>n?.clientThreadId);return s?e.jsx(vc,{threadId:s}):null}function Lf(){const{store:t}=Pe(),s=t.useSharedProps();return s?e.jsx(Af,{...s}):null}function Of(){const{store:t}=Pe(),s=t.useSharedProps(n=>n?.clientThreadId);return s?e.jsx(Cm,{clientThreadId:s}):null}function Bf(t){const{value:s}=Re("1567586774");return s?e.jsx(zf,{...t}):e.jsx(Uf,{...t})}function zf({composerController:t,isDisabled:s,highlightTooltip:n,clientThreadId:a}){const{setThreadSearchMode:o}=cn(),i=ia(),r=bc(),[l,c]=d.useState(!1),h=te(),u={clientThreadId:a};return e.jsx(rr,{highlightTooltip:n,analyticsMetadata:u,isThreadUsingSearchMode:i,isDisabled:s,children:e.jsxs("button",{className:T("flex h-8 min-w-8 items-center justify-center rounded-lg p-1 text-xs font-semibold disabled:opacity-30",l&&"transition-all duration-150",i||n?"!rounded-2xl bg-blue-250 text-blue-1000 hover:bg-[#BDDCF4] dark:bg-[#2A4A6D] dark:text-[#48AAFF] dark:hover:bg-[#1A416A]":"hover:bg-black/10 focus-visible:outline-black dark:focus-visible:outline-white"),"aria-pressed":i,"aria-label":h.formatMessage({id:"Sl1VH/",defaultMessage:"Search the web"}),disabled:s,onTransitionEnd:()=>c(!1),onClick:m=>{m.stopPropagation(),m.preventDefault(),c(!0),V.logEventWithStatsig(G.composerSearchButtonClicked,"composer_search_button_clicked",u),o(!i,u,Js.CONVERSATION_COMPOSER_WEB_ICON),/^search\s?$/i.test(t.getCurrentText())&&t.setText(""),t.replaceSlashCommandTokensWithText(),t.focus()},children:[e.jsx(Ss,{}),e.jsx(gs,{children:i&&e.jsx(ae.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:r?0:.15},children:e.jsx("div",{className:"pl-1 pr-2",children:e.jsx(P,{id:"TbHx8d",defaultMessage:"Search"})})})})]})})}function Uf({composerController:t,highlightTooltip:s,clientThreadId:n,isDisabled:a}){const{setThreadSearchMode:o}=cn(),i={clientThreadId:n};return e.jsx(rr,{highlightTooltip:s,analyticsMetadata:i,isThreadUsingSearchMode:!1,isDisabled:a,children:e.jsx(tr,{showBackground:s,className:"bg-brand-purple/20",children:e.jsx("button",{className:"flex h-8 w-8 items-center justify-center text-token-text-primary disabled:opacity-30",disabled:a,onClick:()=>{V.logEventWithStatsig(G.composerSearchButtonClicked,"composer_search_button_clicked",i),o(!0,i,Js.CONVERSATION_COMPOSER_WEB_ICON),/^search\s?$/i.test(t.getCurrentText())&&t.setText(""),t.replaceSlashCommandTokensWithText(),t.focus()},children:e.jsx(Ss,{className:T(s&&"text-brand-purple-800 dark:text-brand-purple-600")})})})})}function Hf(){const t=na(rn.hasSeenComposerSearchButtonTooltip);return!t.isLoading&&t.eligible}function rr({children:t,highlightTooltip:s,analyticsMetadata:n,isThreadUsingSearchMode:a,isDisabled:o}){const i=Hf()&&!a,r=na(rn.hasSeenComposerSearchButtonTooltip);return o?e.jsx("div",{children:t}):i?e.jsx(di,{side:"right",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(P,{id:"Yjduqi",defaultMessage:"Search the web"}),onDismiss:r.markAsViewed,sideOffset:0,className:"!max-w-sm",description:e.jsx(P,{id:"W51Aei",defaultMessage:"Get fast answers with trusted sources. {learnMore}",values:{learnMore:e.jsx(yc,{href:"https://openai.com/index/introducing-chatgpt-search",className:"underline",children:e.jsx(P,{id:"stA7F4",defaultMessage:"Learn more"})})}}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx(Ft,{sideOffset:0,label:e.jsx(P,{id:"c+4o2s",defaultMessage:"Search the web"}),side:"right",open:s||(a?!1:void 0),onOpenChange:l=>{l&&V.logEventWithStatsig(G.composerSearchButtonHovered,"composer_search_button_hovered",n)},children:t})})}function Gf({composerController:t,clientThreadId:s}){const n=Bt(s),{setThreadSearchMode:a}=cn(),i=wc().size>0,r=ui(s,Go.Search),l=jc(s),[c,h]=d.useState([]),[u,m]=d.useState(void 0),[g,p]=d.useState(0);d.useEffect(()=>{h(u?l.filter(j=>j.name.toLocaleLowerCase().startsWith(u.text.toLocaleLowerCase())||j.systemHint.toLocaleLowerCase().startsWith(u.text.toLocaleLowerCase())):[])},[u]);const y=t.useState(j=>j.getSystemHints().length>0);d.useEffect(()=>{const j=w=>{m(k=>!k||!w?w:k.text===w.text&&k.range.from===w.range.to&&k.range.to?k:w)};t.view.dispatch(t.view.state.tr.setMeta(us,{onHintMatch:j}))},[t]);const f=i||y||!l.length||!c.length||!u;d.useEffect(()=>{f&&p(0)},[f]);const v=c.length,x=d.useCallback(j=>{p(w=>(j(w)%v+v)%v)},[v]),M=c[g],S=({hintToSave:j=M,expectPerfectMatch:w,appendSpace:k=!0})=>{if(!u||!M||w&&j.name.toLowerCase()!==u.text.toLowerCase())return;V.logEvent(G.systemHintSelected,{system_hint:j.systemHint,conversation_id:n??Ba});const X=u.text+j.name.slice(u.text.length),U={clientThreadId:s};vm(t.view,{id:j.systemHint,hint:X},u.range,k,r,R=>a(R,U,Js.CONVERSATION_COMPOSER_SLASH_SEARCH)),Mt(t.view)},b=d.useRef(S);b.current=S;const C=d.useRef(x);C.current=x;const F=d.useRef(u);F.current=u;const N=t.view;return d.useEffect(()=>(f||fm(N,j=>{j==="up"?C.current(w=>w-1):j==="down"?C.current(w=>w+1):j==="cancel"?(Mt(N),Sm(N)):j==="submit"?(b.current({expectPerfectMatch:!1}),Mt(N)):j==="checkMatch"&&b.current({expectPerfectMatch:!0,appendSpace:!1})}),()=>Mt(N)),[f,N]),d.useEffect(()=>{f||V.logEvent(G.systemHintListOpened,{conversation_id:n??Ba})},[f]),f?null:e.jsx(Mc,{className:"max-w-60",onMouseDown:j=>{j.preventDefault()},children:c.map((j,w)=>e.jsx("div",{onMouseOver:()=>p(w),onClick:()=>{S({hintToSave:j,expectPerfectMatch:!1}),t.focus()},children:e.jsx(Cc,{autoFocus:!1,className:"group rounded-lg px-1 py-2 hover:bg-token-hint-text",spoofHovered:w===g,children:e.jsx(Wf,{title:j.name,description:j.description,icon:e.jsx(kc,{svgString:j.logo,className:"icon-lg text-token-text-secondary group-hover:text-white"}),checked:!1})})},j.systemHint))})}function Wf({title:t,description:s,icon:n,checked:a}){return e.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-1.5 pl-1.5 pr-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:n}),e.jsxs("div",{className:"shrink grow basis-0",children:[e.jsx("p",{className:"text-sm font-normal leading-tight text-token-text-primary group-hover:text-white",children:t}),!!s&&e.jsx("p",{className:"text-[13px] font-normal leading-[18px] text-token-text-secondary group-hover:text-white",children:s})]}),a&&e.jsx(Wi,{className:T("icon-md text-token-text-primary",{"group-hover:hidden":!a})})]})}function Vf({composerController:t,clientThreadId:s}){return t instanceof mn?e.jsx(Gf,{composerController:t,clientThreadId:s}):null}function qf({suggestions:t,composerController:s,onSelect:n,onChange:a}){const o=ln(),i=d.useCallback((u,m,g)=>{n?.(u,m,g),o(u,m,g)},[n,o]),[r,l]=d.useState(-1),[c,h]=d.useState(!1);return d.useEffect(()=>{const u=m=>{if(m.key==="ArrowDown"){const g=r===t.length-1?0:r+1;l(g),a?.(g,!0,t[g])}else if(m.key==="ArrowUp"){m.preventDefault();const g=r<=0?t.length-1:r-1;l(g),a?.(g,!0,t[g])}else m.key==="Enter"&&!m.shiftKey&&t[r]&&i(t[r],t,r)};return s.subscribe("keydown",u)},[t,r,a,i,s]),d.useEffect(()=>s.subscribe("blur",()=>{l(-1),a?.(-1,!1)}),[s,a]),d.useEffect(()=>{if(!c){const u=()=>{h(!0),window.removeEventListener("mousemove",u)};return window.addEventListener("mousemove",u),()=>{window.removeEventListener("mousemove",u)}}},[c]),d.useEffect(()=>{l(-1),a?.(-1,!1),h(!1)},[t,a]),e.jsx(ae.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"hidden w-full flex-col p-2.5 group-focus-within:flex group-focus-within:max-lg:flex-col-reverse",children:t.map((u,m)=>e.jsxs(ae.li,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:m*.03},exit:{opacity:0,translateY:4},className:"w-full",children:[m>0&&e.jsx("div",{className:T("h-[1px] opacity-60 max-lg:hidden",r===m||r===m-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")}),e.jsxs("button",{className:T("flex w-full cursor-pointer items-center justify-start whitespace-pre-wrap rounded-lg px-2.5 py-3 text-start",r===m?"bg-token-main-surface-secondary":"bg-token-main-surface-primary"),onClick:g=>{g.preventDefault(),i(u,t,m)},onMouseDown:g=>{g.preventDefault()},onMouseEnter:()=>{c&&(l(m),a?.(m,!1,u))},onMouseLeave:()=>{l(-1),a?.(-1,!1,u)},children:[u.icon?e.jsx("span",{className:"mr-4 h-6 w-6 text-token-text-secondary",children:u.icon}):null,e.jsx("span",{className:"whitespace-pre-wrap",children:u.autocompletionChunks&&u.autocompletionChunks.length>0?e.jsx(e.Fragment,{children:u.autocompletionChunks.map((g,p)=>e.jsx("span",{className:T(g.isMatched?"text-token-text-tertiary":"text-token-text-primary"),children:g.text},p))}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:T(u.type===Vs.Starter?"text-token-text-secondary":"text-token-text-tertiary"),children:u.title}),e.jsx("span",{className:"text-token-text-primary",children:u.body})]})})]}),m>0&&e.jsx("div",{className:T("h-[1px] opacity-60 lg:hidden",r===m||r===m-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")})]},u.id??m))})}function $f(t,s){t=t.toLocaleLowerCase();const n=s;s=s.toLocaleLowerCase();const a=[];let o=0;for(let l=0;l<s.length&&(o<t.length&&t[o]===s[l]&&(a.push(l),o++),o!==t.length);l++);const i=[];let r=0;if(a.forEach(l=>{if(l>r){const c=n.slice(r,l);c&&i.push({text:c,isMatched:!1})}i.push({text:n[l],isMatched:!0}),r=l+1}),r<s.length){const l=n.slice(r);l&&i.push({text:l,isMatched:!1})}return Kf(i)}function Kf(t){if(t.length===0)return t;let s=[t[0]];for(let a=1;a<t.length;a++){const o=s[s.length-1],i=t[a];o.isMatched===i.isMatched?o.text+=i.text:s.push(i)}const n=s.filter(a=>a.isMatched).reduce((a,o)=>a+o.text.trim().length,0);return s.length<=4&&n>=2?s:[{text:s.map(a=>a.text).join(""),isMatched:!1}]}const Yf=1,Xf=3e3;function Qf({files:t,className:s}){const n=on(),a=an(),{value:o}=Re("1567586774"),i=od();return e.jsxs("div",{className:s,children:[i.map(r=>e.jsx(xf,{pastedTextdoc:r,textdocId:r.tempId},r.tempId)),t.map(r=>e.jsx(id,{borderRadius:o?"2xl":"xl",useV2Style:o,width:n?"normal":"wide",onRemoveFileClick:()=>Dn.remove(a,r.tempId,"none"),file:r.file,fileId:r.fileId??void 0,contextConnectorInfo:r.contextConnectorInfo,loadingPercentage:r.status===rd.Uploading?r.progress:void 0},r.tempId))]})}function Zf({onAbortCompletion:t,onCreateNewCompletion:s,onContinueGenerating:n,currentModelId:a,clientThreadId:o,isNewThread:i,isCompletionInProgress:r,className:l,disabled:c=!1,disabledReason:h,canPause:u=!1,canContinue:m=!1,suggestions:g,isInteractableSharedThread:p,composerContainerRef:y,composerController:f,autocompletions:v,requiresFileUpload:x,onComposerInput:M,onComposerChange:S,onAutocompleteSelect:b,headerClassName:C,hideHeader:F,setComposerBarElement:N,onTaggingDropdownOpen:j,onTaggingDropdownClose:w}){const k=ra(),X=Lt(),{isUnauthenticated:U}=Ue(),R=te(),O=Pt(),L=an(),E=gt(o),_=nn(o),[q]=Wo(),$=en(),K=aa(),{gizmoEditorData:H,mode:J,getGizmoId:we}=ei(),me=tn(),oe=_c(),ie=Ot(),Ae=oa(),se=Bt(o),je=!!Zr(),Se=!!Zn(),[ke,I]=d.useState({}),{setThreadSearchMode:de,clearSearchModeTrigger:Le,getSearchModeTrigger:Me}=cn(),D=ia(),[z,ue]=d.useState(!1),[he,re]=d.useState(!1),ne=Ye(),Y=d.useRef(!1),fe=hi(),{value:ve}=Re("1567586774"),pe=a!==null?fe[a]:void 0,Ge=Tc(o);let Q=mi(o),Oe=Q&&"gizmo"in Q?Q.gizmo:void 0;const[ee,pt]=d.useState(null);ee!==null&&(Q={gizmo:ee,gizmo_id:ee.gizmo.id,kind:et.GizmoInteraction},Oe=ee);const _e=Wa(pe,Q);let vs=!1;Ac(Q)&&Oe?.gizmo.id===Ec&&(vs=!0);const fn=Bo(),zt=!c&&!vs&&_e!==In.None&&!U,tt=Nc(pe,Q),Ut=Rc(pe,Q);let Ie=Va(A=>A.files);const[st]=d.useState(()=>Pc());J==="magic"?Ie=Ie.filter(A=>A.gizmoId!=null):Ie=Ie.filter(A=>A.gizmoId==null);const gn=Ic(),nt=Ie.length>0||gn,Ht=Va(Dc.hasUploadInProgress),Gt=f.useState(A=>{const xe=Fc(A);return typeof pe?.maxTokens=="number"&&xe>pe.maxTokens}),Wt=f.useState(A=>!A.isEmpty()),xt=!Gt&&!Ht&&(Wt||nt);fi(Ie.length>0||Ht||Wt);const bs=(_e===In.Multimodal?Lc:Oc)-Ie.length,at=bs<=0,qe=xt&&!c&&!r&&!Se,[ys,St]=d.useState(!1),pn=gi(),ot=a||pn.id,Vt=ui(o,Go.Search),it=!c&&!Oe&&me?.includes(mt.SearchTool)&&(me?.includes(mt.BrowsingAvailable)||!X?.isEnterprisey()),rt=it&&Vt,xn=fe[ot]?.tags,{targetedContent:ws,setTargetedContent:qt}=pi(),Ee=ws?.isFocusedViewContent&&!Ae?void 0:ws,{rebaseSystemMessageContent:Sn}=la();d.useEffect(()=>{if(!k?.id)return;const A=qa.getAndReset(k?.id,se);A&&f.setText(A.inputText)},[k?.id,se,f]),d.useEffect(()=>{ys!==qe&&(St(qe),qe&&(Jr(!0).then(A=>{el.startEnforcement(A),Bc.startEnforcement(A),tl.startEnforcement(A)}),me?.includes(mt.SharedWebsocket)&&zs.registerIfNotConnected()))},[qe,ys,Q?.kind,me]);const $t=zc(pe,Q),{handleFileAccepted:js}=Uc(R,Wa(pe,Q),tt,"mouse",we,$t?.attachments),{getInputProps:_a,open:vn}=Hc({disabled:c||!zt||at,noClick:!0,onDropAccepted:js,onDropRejected:A=>Gc(A,R,O,_e),multiple:!0,maxSize:Wc,maxFiles:bs,...Vc(Ut)}),Ms=sl(st),Cs=d.useCallback(()=>{f.eraseContent(),Ms.clearMessages(),f.resize(Yf),Z.clearOverrideModelId(o),xi();for(const A of Ie)Dn.remove(L,A.tempId,"none");ai.markAllAsSent()},[f,Ms,Ie,L,o]),vt=async(A,xe)=>{if(A?.preventDefault(),c||!xt&&!xe||!Q||Rt.isLoading(o)!==!1)return;const Be=new ls;ue(!0);const Ne=f.getContentToSend(),ct=ld(Ne.content),wn=`${E}-nextPrompt`,Qt=new cd(vi.CompletionRequest,{expectedTimingLogs:[{name:"prompt_submitted",expectedInMs:3e3}]}),{content:Vr,attachments:Pa}=xh(L,ct,pe,Q),jn=[];Sn&&jn.push(dd(Sn));const Mn={...Q};"gizmo"in Mn&&delete Mn.gizmo;let Ps=f.getSystemHints();D&&(Ps=[sn.Search]);const Ia=Me(),qr=D?Ia??Js.CONVERSATION_COMPOSER_WEB_ICON:void 0,Da=ud();let Zt={promptId:wn,content:Vr,eventMetadata:{eventSource:A?"mouse":"keyboard"},completionMetadata:{suggestions:g,conversationMode:Mn,systemHints:Ps,searchSource:qr},messageMetadata:{...Pa.length>0&&{attachments:Pa},...ee&&{gizmo_id:ee?.gizmo.id},...ke,...Ps.length>0&&{system_hints:Ps},...!!Ne.metadata&&{serialization_metadata:Ne.metadata},...Da.length>0&&{canvas:{pasted_textdocs:Da}}},appendMessages:jn.length>0?jn:void 0,turnTracker:Be,profiler:Qt,requestedModelId:Ge};Zt=hd(Zt),Ee?.createNewCompletionParams&&(Zt=await Ee.createNewCompletionParams(Zt)),Qt.logTiming("request_params_ready"),await s(Zt),Ee?.onCreateCompletion?.({serverThreadId:se,currentLeafId:E}),Ee?.shouldPersistAcrossMessages!==!0&&qt(void 0),cs.hideThreadHeader(),Cs(),ue(!1),Qt.logTiming("prompt_submitted"),g!==void 0&&(ce.logEvent("chatgpt_prompt_ignore_suggestions"),V.logEvent(G.promptIgnoreSuggestions)),D&&Ia&&Le()},bn=d.useRef(vt);d.useEffect(()=>{bn.current=vt});const yn=A=>{qt(A.targetedReply),A.targetedReply&&(f.focus(),V.logEvent(G.targetedReplyButtonClicked,{conversationId:se,sourceMessageId:A.messageId}))},ks=d.useCallback(()=>{Ee?.onCleared?.({serverThreadId:se,currentLeafId:E}),qt(void 0),f.focus()},[E,se,Ee,qt,f]),_s={Enter:{validator:A=>{const xe=A.isComposing||A.keyCode===229;return!(he&&Y.current)&&(A.metaKey||(oe||zo)&&!A.shiftKey&&!xe)},handler:A=>{if(!qe){Gt&&O.danger("The message you submitted was too long, please submit something shorter.",{hasCloseButton:!0});return}A.preventDefault(),vt()}},Escape:{validator:A=>!A.isComposing,handler:A=>{u&&r&&(t("",_),V.logEvent(G.pauseCompletion,{threadId:Z.getServerThreadId(o),currentLeafId:Z.getTree(o).getMessageId(E),eventSource:"keyboard"})),A.target.value===""&&ks()}}},lt=d.useRef(_s);lt.current=_s;const Ts=d.useRef(null),W=qc(xn,Q?.kind),[Te,Xe]=d.useState(!1),[Kt,As]=d.useState(!1),Es=W&&Te,Ta=f.isReady();d.useEffect(()=>f.subscribe("keydown",A=>{f.acceptLegacyKeydown()&&lt.current[A.key]?.validator(A)&&lt.current[A.key].handler(A);const Be=f.getCurrentText();if(A.key==="@"){const Ne=f.getSelectionStart(),ct=Be.substring(0,Ne);(!ct||/\s$/.test(ct)||Ne===0)&&(Ts.current?.handleClose(),setTimeout(()=>Xe(!0),10))}else Te&&Xe(!1);if(A.key==="Escape"&&(pt(null),re(!1)),rt&&!D){let Ne;A.key==="Backspace"?Ne=Be.substring(0,Be.length-1):Ne=Be+A.key,/^search\s?$/i.test(Ne)?As(!0):Kt&&As(!1)}D&&A.key==="Escape"&&de(!1,{clientThreadId:o})}),[f,Ta,Te,Kt,rt,D,de,o]),d.useEffect(()=>{const A=Object.fromEntries(Object.keys(lt.current).map(xe=>[xe,Ne=>{const ct=lt.current[xe];if(!ct||f.acceptLegacyKeydown())return!1;const{validator:wn,handler:Qt}=ct;return wn(Ne)?(Qt(Ne),!0):!1}]));f.registerKeyHandlers(A)},[f,Ta]),d.useEffect(()=>f.subscribe("paste",A=>{$c({filePickerStore:L,event:A,intl:R,toaster:O,clientThreadId:o,conversationMode:Q,currentModelConfig:pe,getEditorGizmoId:we,modelSupportedImageMimeTypes:tt})}),[R,o,Q,pe,we,tt,f,O,L]);const _r=A=>{je||pt(A),f.trimLeadingText("@"),rs(),Xe(!1)},Tr=Kc(o,st,R,tt,$t?.attachments),Ar=d.useCallback(A=>{A?.preventDefault(),t("",_),V.logEvent(G.pauseCompletion,{threadId:Z.getServerThreadId(o),currentLeafId:Z.getTree(o).getMessageId(E),eventSource:"mouse"}),rs()},[t,o,_,E]),Aa=d.useCallback(()=>{qa.set(k?.id,se,f.getCurrentText())},[se,k?.id,f]);d.useEffect(()=>{H||!z&&!Yc()&&f.focus()},[z,f]),d.useEffect(()=>{H||Dn.reset(L)},[a,L,H]),d.useEffect(()=>{(!W&&ee||je)&&pt(null)},[W,ee,je]);const[Er,Nr]=(()=>{switch(h){case"workspaceDisallowsGizmo":return[We.disallowedByWorkspacePlaceholder,!0];case"feedbackRequired":return[We.disabledFeedbackPlaceholder,!0];case"noModelsAvailable":return[We.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[We.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[We.loading,!0];case"noTestGizmoId":return[We.noTestGizmoId,!0];default:return p?[We.placeholderWithName,!1]:Ee?.placeholderTextOverride!=null?[Ee.placeholderTextOverride,!1]:[We.placeholderWithName,!1]}})(),Rr=R.formatMessage(Er,{name:H!=null?J==="magic"?Xc:H.name||"GPT":Oe?.gizmo.display.name??"ChatGPT"});d.useEffect(()=>f.subscribe("input",()=>{Si.getState().isThreadHeaderVisible&&cs.hideThreadHeader(),re(!0)}),[f]),d.useEffect(()=>{if(M)return f.subscribe("input",()=>{M?.()})},[f,M]),d.useEffect(()=>{if(S)return f.subscribe("change",()=>{S?.()})},[f,S]),d.useEffect(()=>f.subscribe("focus",()=>{re(!0)}),[f]);const Pr={clientThreadId:o,uploadType:_e,modelAcceptedMimeTypes:Ut,modelSupportedImageMimeTypes:tt,attachmentsProductFeature:$t?.attachments,getInputProps:_a,openFileDialog:vn,historyDisabled:ie,onOauthRedirect:Aa,highlightTooltip:x&&!nt},Yt=[],Ea=!c&&!at&&(zt||fn!=null)&&!D;(ve||Ea)&&Yt.push(e.jsx(Zm,{...Pr,isDisabled:!Ea},"file-upload-button")),it&&(!D||ve)&&Yt.push(e.jsx(Bf,{composerController:f,highlightTooltip:Kt,clientThreadId:o,isDisabled:!rt||nt},"search-button"));const Ir=nt&&e.jsxs(e.Fragment,{children:[J==="magic"&&e.jsx("div",{className:"m-2 mb-0 rounded-lg bg-token-main-surface-secondary p-2 text-xs text-token-text-secondary",children:e.jsx(P,{...We.gizmoKnowledgeWarning})}),e.jsx(Qf,{files:Ie,className:T("flex flex-nowrap gap-2 overflow-x-auto",ve?"p-1.5":"pb-1.5 pt-[7px]")})]}),Dr=Nr?"disabled":"default",Fr=r&&u,Lr=!qe||z,Or=md(Ht,Wt,Gt),Ns=Fr?"streaming":Lr?"disabled":"idle",Xt=d.useRef(null),bt=d.useRef(null),{layer:Br}=Fe("387752763"),{layer:zr}=Fe("51287004"),Ur=Br.get("enable_slash_commands",!1)&&(U||!X?.isFree()||zr.get("enable",!1)),Hr=a&&[fd,gd].includes(a),Gr=Ur&&Q?.kind===et.PrimaryAssistant&&!D;d.useEffect(()=>{const A=()=>{Xt.current!=null&&Pn.addAction("composer_state_disabled",{threadId:Z.getServerThreadId(o),disabledReason:Xt.current})};if(xt&&Ns==="disabled"){let xe="unknown";c?xe=h??"component_disabled_unknown":r?xe="completion_in_progress":Se?xe="thread_hard_blocked":z&&(xe="starting_new_completion_request"),Xt.current!==xe&&(bt.current&&clearTimeout(bt.current),bt.current=setTimeout(A,Xf)),Xt.current=xe}else Xt.current=null;return()=>{bt.current&&(clearTimeout(bt.current),bt.current=null)}},[o,xt,Ns,c,h,r,Se,z]);const Rs=[];if(D&&!ve&&Rs.push({type:"system_hint",value:R.formatMessage(Jf.searchMode),icon:e.jsx("span",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-brand-purple/15",children:e.jsx(Ss,{className:"h-[20px] w-[20px] shrink-0 text-[#814CFF]"})}),onRemoveRegion:()=>{de(!1,{clientThreadId:o}),f.focus()}}),Ee?.label&&Rs.push({type:Ee.type,value:Ee.label,onRemoveRegion:ks}),ee!==null){const A=!!ee.gizmo.tags?.includes(ca.FirstParty);Rs.push({type:"mention",value:ee.gizmo.display.name,icon:e.jsx(Qc,{isFirstParty:A,src:ee.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{pt(null),f.focus()}})}d.useEffect(()=>{(!v||v.length===0||!he)&&(Y.current=!1)},[v,he]);const Wr=(A,xe,Be)=>{Y.current=A>=0,xe&&f.setText(Be?`${Be.title}${Be.body}`:"")},Na=he&&v&&v.length>0&&!Es&&!f.hasMultipleLines()&&f.canShowAutocompletion();d.useEffect(()=>{Es?j?.():w?.()},[Es,j,w]);const Ra=Ns==="streaming"?Ar:vt;return e.jsxs(Zc.Provider,{value:st,children:[e.jsx(Jc,{onOauthRedirect:Aa,children:e.jsx("form",{className:l,onSubmit:Ra,children:e.jsxs("div",{className:"relative flex h-full max-w-full flex-1 flex-col",children:[!F&&!ne&&e.jsx(ar,{className:C}),e.jsxs("div",{className:"relative h-0",children:[Es&&e.jsx("div",{className:T("absolute bottom-3 w-full space-y-2",Ws.TagGpt),children:e.jsx(ed,{onClick:A=>_r(A),onClose:()=>{Xe(!1),f.focus()}})}),Gr&&e.jsx("div",{className:T("absolute bottom-3 space-y-2",Ws.TagGpt),children:e.jsx(Vf,{composerController:f,clientThreadId:o})})]}),e.jsxs("div",{ref:y,className:"group relative flex w-full items-center",children:[i&&q.has("from_template_row")&&e.jsx("button",{type:"button",onClick:()=>{$("/")},className:"mr-2 flex h-8 w-8 items-center justify-center text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(Ah,{className:"icon-lg"})}),W&&!!se&&e.jsx(td,{ref:Ts}),e.jsx(cf,{type:ie?"temporary":"default",ref:N,replyRegions:Rs,placeholder:Rr,inputState:Dr,composerController:f,leftSideActions:Yt,state:Ns,onSubmit:Ra,renderFiles:Ir,currentLeafId:E,clientThreadId:o,gizmoId:Oe?.gizmo.id,disableReason:Or,modelId:ot}),Na&&e.jsx("div",{className:T("absolute left-0 z-10 box-border w-full bg-token-main-surface-primary max-lg:bottom-full lg:top-full",Yt?.length>0&&K&&!ve?`px-${Yt.length*8}`:"pl-0"),children:e.jsx(qf,{suggestions:v,composerController:f,onSelect:b,onChange:Wr})})]}),e.jsx(sd,{composerController:f,parsedDocumentHandler:Tr})]})})}),e.jsx(Am,{canUseInlineTagging:W,isDisabled:c,clientThreadId:o,currentLeafId:E,currentRequestId:_,canContinue:m,composerController:f,setPromptInputMetadata:I,suggestions:g,isNewThread:i,onCreateNewCompletion:s,onContinueGenerating:n,onResetState:Cs,conversationMode:Q,isShowingAutocomplete:!!Na}),Q!=null&&!Hr&&nd.includes(Q.kind)&&e.jsx(ad,{onTargetedReply:yn})]})}const Jf=ye({searchMode:{id:"LSO1pB",defaultMessage:"Search the web"}}),eg=({children:t})=>{const[s]=d.useState(()=>new Gs);return t(s)},lr=({children:t})=>{const{layer:s}=Fe("387752763");return s.get("enable_rich_text_composer",!1)?e.jsx(rf,{children:t}):e.jsx(eg,{children:t})};function tg(t){const s=t.message?.author.role===be.User,n=t.metadata?.err!=null&&t.metadata?.errCode!==qs.ContentPolicy,a=t.metadata?.errCode===qs.ModelIncompatibility;return t.metadata?.canRetry===!1||a?!1:s||n}function sg(t){return t.composerController?e.jsx(ho,{...t,composerController:t.composerController}):e.jsx(lr,{children:s=>e.jsx(ho,{...t,composerController:s})})}function ho({clientThreadId:t,isNewThread:s,currentModelId:n,showPromptStarters:a,noWrap:o,onRequestCompletion:i,composerContainerRef:r,composerController:l}){const c=da(),h=ua(),u=ha(g=>{const p=Rt.getCurrentNode(t,g);return tg(p)});if(bi(l),!h&&u)return e.jsx(ng,{clientThreadId:t});const m=e.jsx(e.Fragment,{children:e.jsx(cr,{composerContainerRef:r,composerController:l,clientThreadId:t,currentModelId:n,isNewThread:s,showPromptStarters:a,onRequestCompletion:i})});return o?m:e.jsxs(e.Fragment,{children:[e.jsx(jm,{clientThreadId:t}),e.jsx(ma,{clientThreadId:t,isStaticSharedThread:c,withVerticalPadding:!1,withHorizontalPadding:!0,children:e.jsx(ds,{children:m})})]})}function ng({clientThreadId:t}){const s=pd(t),n=ha(i=>Rt.getCurrentNode(t,i).metadata?.errCode===xd),a=Sd(i=>i.isoDate),o=gt(t);return n&&a!=null&&a!==""?null:e.jsxs("div",{children:[e.jsx("div",{className:"mb-3 text-center text-xs",children:e.jsx(P,{...mo.errorGeneratingResponse})}),e.jsx("div",{className:"flex items-center md:mb-4",children:e.jsx(Ve,{as:"button",color:"primary",onClick:()=>{const i=new ls;ce.logEvent("chatgpt_regenerate_due_to_error_button_clicked",void 0,Je({clientThreadId:t})),s({id:o,eventMetadata:{eventSource:"mouse"},conversationMode:Rt.getConversationMode(t),turnTracker:i})},className:"m-auto",icon:Gi,"data-testid":"regenerate-thread-error-button",children:e.jsx(P,{...mo.regenerateResponse})})})]})}function cr({clientThreadId:t,currentModelId:s,isNewThread:n,onRequestCompletion:a,showPromptStarters:o,composerContainerRef:i,composerController:r,autocompletions:l,requiresFileUpload:c,onComposerInput:h,onComposerChange:u,onAutocompleteSelect:m,headerClassName:g,hideHeader:p,onTaggingDropdownClose:y,onTaggingDropdownOpen:f}){const v=gt(t),x=nn(t),M=Fn(),{isUnauthenticated:S}=Ue(),C=yi(t)===Vo.STREAMING,F=wi({clientThreadId:t,conversationLeafId:v}),N=ft(x),j=ji({clientThreadId:t}),w=!S,k=nl(),{isOpen:X,onClose:U}=vd({type:"just-hit-rate-limit"}),R=d.useCallback((Me,D)=>{V.logEvent(G.continueCompletion),a({type:za.Continue,promptId:Me,eventMetadata:{eventSource:"mouse"},cancelActiveRequests:!1,completionMetadata:{conversationMode:Rt.getConversationMode(t)},turnTracker:D})},[a,t]),O=qo(),L=d.useCallback(async(Me,D)=>Sh({clientThreadId:t,currentRequestId:D,isHistoryAndTrainingDisabled:k,queryClient:O}),[t,k,O]),E=d.useCallback(async({promptId:Me,content:D,eventMetadata:z,completionMetadata:ue,messageMetadata:he,appendMessages:re,turnTracker:ne,profiler:Y,requestedModelId:fe})=>{const ve=Z.getThreadCurrentLeafId(t);Z.updateTree(t,pe=>{pe.addNode(Me,D,ve,be.User,void 0,he)}),await a({type:za.Next,promptId:Me,eventMetadata:z,cancelActiveRequests:!0,completionMetadata:ue,appendMessages:re,turnTracker:ne,profiler:Y,...fe?{requestedModelId:fe}:{}})},[t,a]),_=bd(t,v),q=yd(t,v),$=!F&&(N||C),K=d.useMemo(()=>$?!1:!_&&q,[_,q,$]),H=$&&s!=="gpt-4-pbrowse",J=fa(t),we=He(t),me=fs(we).data,{promptStarters:oe,isSuccess:ie}=Ln(n&&!J,t,4),Ae=Zo(),se=(()=>{if(Ae?.messageId===Z.getTree(t).getLastValidNode(v)?.message?.id)return Ae?.suggestions;if(o&&!J&&ie&&!w)return oe})(),je=wd(),Se=al(),ke=(()=>{if(me?.gizmo.tags?.includes(ca.WorkspaceDisabled)&&!Se)return"workspaceDisallowsGizmo";if(je.size){if(M.displayingSideBySideFeedback&&M.unskippable)return"feedbackRequired"}else return"noModelsAvailable";const D=Rt.getConversationMode(t);return D?.kind===et.GizmoTest&&D.gizmo_id==null?"noTestGizmoId":null})(),I=Mi(t),de=dn(t),Le=Tt("15117983")?.value;return e.jsxs(e.Fragment,{children:[X?e.jsx(jd,{onClose:U}):null,Le&&de&&de.kind===et.PrimaryAssistant&&de.plugin_ids&&de.plugin_ids.length>0?e.jsx(ag,{}):e.jsx(Zf,{composerContainerRef:i,composerController:r,clientThreadId:t,onCreateNewCompletion:E,onAbortCompletion:L,onContinueGenerating:R,currentModelId:s,isNewThread:n,isCompletionInProgress:j,className:"w-full",canContinue:K,suggestions:se??[],disabled:!!ke,disabledReason:ke??void 0,canPause:H,isInteractableSharedThread:I,autocompletions:l,requiresFileUpload:c,onComposerInput:h,onComposerChange:u,onAutocompleteSelect:m,headerClassName:g,hideHeader:p,onTaggingDropdownClose:y,onTaggingDropdownOpen:f},t)]})}function ag(){return e.jsxs("div",{className:"mx-auto flex max-w-md flex-col items-center justify-center gap-2 rounded-xl border border-token-border-light bg-token-main-surface-primary p-6 shadow-lg",children:[e.jsx("span",{className:"text-token-text-primary",children:e.jsx(P,{id:"PluginsDecrepatedNotice.pluginsDeprecationTitle",defaultMessage:"Conversations with plugins are archived"})}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(P,{id:"PluginsDecrepatedNotice.pluginsDeprecationSubtitle",defaultMessage:"Explore GPT Store to find a replacement"})}),e.jsxs("a",{href:"https://chat.openai.com/gpts",className:"text-green-500 hover:cursor-pointer dark:text-green-400",children:[e.jsx(P,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLink",defaultMessage:"Explore GPTs"}),e.jsx("span",{className:"ml-2",children:e.jsx(P,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLinkArrow",defaultMessage:"→"})})]})]})}const mo=ye({errorGeneratingResponse:{id:"PromptTextarea.errorGeneratingResponse",defaultMessage:"There was an error generating a response"},regenerateResponse:{id:"PromptTextarea.regenerateResponse",defaultMessage:"Regenerate"}}),dr=d.memo(function(){return e.jsxs("div",{className:`flex flex-col gap-2 ${Ws.PromptTextareaHeader}`,children:[e.jsx(or,{}),e.jsx(ir,{})]})}),Qp=Object.freeze(Object.defineProperty({__proto__:null,ChatScreenComposerAlerts:dr},Symbol.toStringTag,{value:"Module"})),_n=4;function og(t){const{layer:s}=Fe("3533083032"),{layer:n}=_t("3533083032"),{value:a,isLoading:o}=Re("3006519778");return o||!a?!1:t?s.get("enable_new_homepage_anon",!1):n.get("enable_new_homepage_anon",!1)}function ig(){const{layer:t}=_t("4031588851"),s=t.get("autocomplete_qualified_start_date","2099-09-13T00:00:00Z"),n=ra();return!!n&&n.created*1e3>=new Date(s).getTime()}function rg(t){const{layer:s}=Fe("4031588851"),{layer:n}=_t("4031588851"),{value:a,isLoading:o}=Re("633009675");return o||!a?!1:t?s.get("enable_new_autocomplete_homepage",!1):n.get("enable_new_autocomplete_homepage",!1)}const Tn=t=>`${t.title}${t.body}`.toLocaleLowerCase();function lg(t){return He(t.clientThreadId),e.jsx(lr,{children:s=>e.jsx(mg,{...t,composerController:s})})}function cg({children:t,composerController:s}){const{store:n}=Pe(),[a,o]=d.useState(!1);d.useEffect(()=>s.subscribe("focus",()=>{o(!0)}),[s]),d.useEffect(()=>s.subscribe("blur",()=>{o(!1)}),[s]);const r=!!n.useSharedProps()?.isShowingAutocomplete;return t(r&&a)}function dg({isUnauthenticated:t,shouldShowLegacyStarterPrompts:s,legacyPromptStarters:n,isSendBlocked:a,clientThreadId:o}){return e.jsxs("div",{className:T(t?"justify-end lg:justify-center":"justify-center","flex h-full flex-shrink flex-col items-center overflow-y-hidden text-token-text-primary lg:hidden"),children:[e.jsx("div",{className:T(t&&"flex sm:items-center md:flex-1","flex-shrink-0"),children:e.jsx(ms,{className:"mb-6 h-12 w-12"})}),s&&(n&&n.length>0?e.jsx(xg,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},promptStarters:n,isSendBlocked:a,clientThreadId:o,isSquare:t}):e.jsx(sm,{}))]})}function ug({composerController:t,isSendBlocked:s,clientThreadId:n,isModelLoaded:a,headlineOption:o,enableNewMobileDesign:i,shouldShowStarterPrompts:r,promptChips:l,onSelectStarterPrompt:c,starterPromptExpanded:h,setStarterPromptExpanded:u}){return e.jsx(cg,{composerController:t,children:m=>e.jsxs(ae.div,{initial:{opacity:0},animate:{opacity:m?0:1},exit:{opacity:0},transition:{duration:.1},className:T("justify-center",m?"pointer-events-none":"","mt-[var(--screen-optical-compact-offset-amount)] flex h-full flex-shrink flex-col items-center overflow-hidden text-token-text-primary lg:hidden"),children:[o==="CHATGPT_LOGO"?e.jsx(ms,{className:"inline-block h-12 w-12"}):e.jsx(ur,{headlineOption:o,isModelLoaded:a}),e.jsx(ae.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:T(!i&&"lg:hidden",!h&&"h-[116px]"),children:r&&e.jsx(mr,{starterPrompts:l,onSelectStarterPrompt:c,disabled:s,clientThreadId:n,onExpand:()=>u(!0),mobileLayout:!0})})]})})}function hg(t,s,n){const a=Re("1468311859").value,o=Re("3664702598").value,{layer:i}=Fe("4031588851"),r=ig(),l=t||s,c=l&&a,h=l&&o&&r;let u="HARDCODED";if(l)if(n){const m=i.get("search_autocomplete_mode","");c&&m&&(u=m)}else h&&(u=i.get("autocomplete_mode","HARDCODED"));return u}function mg({clientThreadId:t,currentModelId:s,isModelLoaded:n,onRequestCompletion:a,composerController:o,v2HomepageDisclaimer:i}){const r=Bs(t),l=fa(t),c=Zn(),[h,u]=d.useState([]),{trendingSuggestions:m,fetchTrendingSuggestions:g}=Sg(_n),p=d.useRef(!1),{isUnauthenticated:y}=Ue(),f=aa(),[v,x]=d.useState(!1),M=ia(),S=Ye();bi(o);const b=Re("589604007").value,{layer:C}=_t("4031588851"),{layer:F}=Fe("4031588851"),{layer:N}=_t("3533083032"),{layer:j}=Fe("3533083032"),{promptStarters:w,isSuccess:k}=Ln(r&&!l&&n,t,8,b,!0,s??void 0),{promptStarters:X,isSuccess:U,isError:R}=Ln(r&&!l&&n,t,4,void 0,void 0,s??void 0),O=f&&!!h.find(D=>!!D.requires_file_upload),L=d.useCallback(D=>{const z=o.getCurrentText();return z&&Tn(D).startsWith(z.toLocaleLowerCase())},[o]),E=d.useCallback(D=>{const z=o.getCurrentText(),ue=D.title+D.body;return L(D)?{...D,title:z,body:ue.slice(z.length)}:{...D,title:ue,body:""}},[o,L]),_=d.useCallback((D=!1)=>{u(z=>!z.some(L)&&z.length>0?[]:D?z:z.map(E))},[L,E]),q=(D,z,ue)=>{const he=D.title;u([]),o.focus(),o.setText(he),requestAnimationFrame(()=>{const re=(w?.filter(ne=>ne.theme===D.theme)??[]).map(ne=>{const Y=wt(ne.oneliner),fe=Y.startsWith(ne.title);return{...ne,title:fe?`${ne.title} `:"",body:fe?ne.body:Y,autocompletionChunks:$f(he,Y),type:Vs.Autocomplete}});u(re),re.length>0&&Nt(re,t),Cd(D,ue,t)})};d.useEffect(()=>{const D=h.some(z=>z.theme===On.Search);M&&o.getCurrentText()===""?m.length>0?u(m):g():D&&!M&&u(z=>z.filter(ue=>ue.theme!==On.Search))},[h,M,m,g,o]);const $=w?.reduce((D,z)=>(z.theme&&!D[z.theme]&&(D[z.theme]=z),D),{}),K=[];if($)for(const D in $)K.push($[D]);const H=K&&K.length>0,J=!!(k&&H&&n),we=!!((U||R)&&n),me=_n-h.filter(L).length,oe=y?j.get("enable_new_mobile",!1):F.get("enable_new_mobile",!1),ie=hg(oe,f,M),Ae=y?N.get("headline_option","HELP_WITH"):C.get("headline_option","HELP_WITH"),se=C.get("autocomplete_min_char",4),je=C.get("autocomplete_fetch_interval",200),Se=d.useRef(null),ke=d.useCallback(Ci(async D=>{const z=o.getCurrentText();if(!z||z.length<se||z.length>80||o.hasMultipleLines()){u([]);return}if(!p.current&&!(Se.current&&Se.current.length>se&&z.startsWith(Se.current)))try{const ue=await Ke.generateAutocompletions(z,D,M);if(ue.completions.length===0){Se.current=z;return}const he=ue.completions.map(re=>({id:$o(),type:Vs.Autocomplete,title:re.slice(0,z.length),body:re.slice(z.length),oneliner:re,prompt:re,source:ie})).filter(L).map(E);u(re=>{const ne=re.filter(L),Y=he.filter(fe=>{const ve=Tn(fe);return!ne.some(pe=>{const Ge=Tn(pe);if(ve===Ge)return!0;const Q=/[\p{P}\p{S}]$/u,Oe=ve.replace(Q,""),ee=Ge.replace(Q,"");return Oe===Ge||ve===ee||Oe===ee})}).slice(0,_n-ne.length);return[...ne,...Y]}),he.length>0&&Nt(he,t)}catch{}},ie==="BING"?150:je),[o,ie,E,je]),I=d.useCallback(()=>{_(),me>0&&ke(me)},[ke,_,me]);d.useEffect(()=>{p.current&&u([])},[p]);const de=d.useMemo(()=>ie==="HARDCODED"?_:I,[ie,I,_]),Le=d.useCallback(()=>{o instanceof mn&&_(!0),o.getCurrentText().indexOf(`
`)>0&&u([])},[o,_]),Me=d.useCallback((D,z,ue)=>{z.forEach(he=>{he.id===D.id&&(he.userInput=o.getCurrentText())}),u([z[ue]])},[o]);return e.jsx(e.Fragment,{children:e.jsx(gs,{children:e.jsx("div",{className:"h-full w-full lg:py-[18px]",children:e.jsx(ma,{isStaticSharedThread:!1,withVerticalPadding:!1,withHorizontalPadding:!0,clientThreadId:t,fullHeight:!0,children:e.jsxs($a,{children:[e.jsx("div",{className:"mb-7 hidden text-center lg:block",children:Ae==="CHATGPT_LOGO"?e.jsx(ms,{className:"inline-block h-12 w-12"}):e.jsx(ur,{headlineOption:Ae,isModelLoaded:n})}),!oe&&e.jsx(dg,{isUnauthenticated:y,shouldShowLegacyStarterPrompts:we,legacyPromptStarters:X,isSendBlocked:c,clientThreadId:t}),oe&&e.jsx(ug,{composerController:o,isModelLoaded:n,headlineOption:Ae,enableNewMobileDesign:oe,shouldShowStarterPrompts:J,promptChips:K,onSelectStarterPrompt:q,starterPromptExpanded:v,setStarterPromptExpanded:x,isSendBlocked:c,clientThreadId:t}),e.jsx("div",{className:T("lg:w-full","lg:absolute lg:bottom-8 lg:left-0"),children:e.jsx($a,{children:S?e.jsx(dr,{}):e.jsx(ar,{className:"block"})})}),e.jsx("div",{className:"w-full",children:e.jsx(cr,{clientThreadId:t,isNewThread:r,currentModelId:s,onRequestCompletion:a,showPromptStarters:!1,composerController:o,autocompletions:h,requiresFileUpload:O,onComposerInput:de,onComposerChange:Le,onAutocompleteSelect:Me,onTaggingDropdownClose:()=>{p.current=!1},onTaggingDropdownOpen:()=>{p.current=!0},hideHeader:!0})}),e.jsx(ae.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:T("hidden lg:block",i&&y&&v?"":"h-[70px]"),children:J&&e.jsx(mr,{starterPrompts:K,onSelectStarterPrompt:q,disabled:c,clientThreadId:t,onExpand:()=>x(!0)})}),i&&e.jsx("div",{className:"w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px] lg:absolute lg:bottom-0 lg:left-0",children:e.jsx("div",{className:"min-h-4",children:i})})]})})})})})}function ur({headlineOption:t,isModelLoaded:s}){const n=te(),[a,o]=d.useState(0),[i,r]=d.useState(!0),l=20,c=n.formatMessage(vg[t]||os.whatCanIHelpWith);return d.useEffect(()=>{if(!s)return;let h;return a<c.length?h=setTimeout(()=>{o(a+1)},l):i&&(h=setTimeout(()=>{r(!1)},500)),()=>clearTimeout(h)},[c,a,i,s]),e.jsxs("div",{className:"relative inline-flex justify-center text-center text-2xl font-semibold leading-9",children:[e.jsx("h1",{children:c.substring(0,a)||"​"}),e.jsx("h1",{className:"result-streaming absolute left-full transition-opacity",style:{opacity:i?1:0},children:e.jsx("span",{})})]})}function hr({label:t,onClick:s,disabled:n=!1,icon:a}){return e.jsxs("button",{className:"group relative flex h-[42px] items-center gap-1.5 rounded-full border border-token-border-light px-3 py-2 text-start text-[13px] shadow-xxs transition enabled:hover:bg-token-main-surface-secondary disabled:cursor-not-allowed xl:gap-2 xl:text-[14px]",disabled:n,onClick:s,children:[a,e.jsx("span",{className:"max-w-full select-none whitespace-nowrap text-gray-600 transition group-hover:text-token-text-primary dark:text-gray-500",children:t})]})}function fg({starterPrompt:t,starterPrompts:s,index:n,disabled:a,onSelectStarterPrompt:o}){const i=t.theme??t.title,r=ln(),{mutate:l}=kd(),c=t.category==="onboarding"?()=>{l({key:rn.hasUsedConversationalOnboardingStarterPrompt}),r(t,s,n)}:()=>o(t,s,n);return e.jsx(hr,{disabled:a,onClick:c,icon:e.jsx(_d,{starterPrompt:t,useV2Colors:!0}),label:i})}function fo({clientThreadId:t,onClick:s}){d.useEffect(()=>{Td(t)},[t]);const n=te();return e.jsx(ae.div,{initial:{opacity:0,translateY:5},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:5},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(hr,{onClick:()=>{Ad(t),s()},label:n.formatMessage(os.moreStarterPrompts)})})}const gg=5,pg=3;function mr({starterPrompts:t,onSelectStarterPrompt:s,disabled:n,clientThreadId:a,onExpand:o,mobileLayout:i=!1}){const r=i?pg:gg,[l,c]=d.useState(r),[h,u]=d.useState(r),[m,g]=d.useState(!1),p=d.useRef(null),y=t.length<=l;d.useEffect(()=>{Nt(t.slice(0,r),a)},[a]),d.useEffect(()=>{if(!m&&!y&&p.current){const v=p.current,x=v.getBoundingClientRect(),M=x.width,S=Array.from(v.children);let b=0;for(let C=0;C<S.length&&S[C].getBoundingClientRect().right-x.left<=M;C++)b++;c(b),u(b),g(!0)}},[t,y,m]);const f=()=>{const v=t.slice(l,t.length).map(x=>({...x,isAdditional:!0}));v.length>0&&Nt(v,a),c(t.length),o()};return e.jsxs("div",{className:T("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",m&&t.length>0?"opacity-100":"opacity-[0.01]",i?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:T("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",y||i?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:p,children:[t.slice(0,l).map((v,x)=>e.jsx(ae.li,{initial:{opacity:0,...x<h?{translateY:5}:{}},animate:{opacity:1,...x<h?{translateY:0}:{}},exit:{opacity:0,...x<h?{translateY:5}:{}},transition:{duration:.3,delay:x>=h?(x-h)*.06:0,ease:"easeOut"},children:e.jsx(fg,{starterPrompt:v,starterPrompts:t,index:x,disabled:n,onSelectStarterPrompt:s})},v.id??x)),i&&t.length>l&&e.jsx(fo,{clientThreadId:a,onClick:f})]}),!i&&t.length>l&&e.jsx(fo,{clientThreadId:a,onClick:f})]})}function xg({promptStarters:t,isSendBlocked:s,clientThreadId:n,isSquare:a,...o}){d.useEffect(()=>{Nt(t,n)},[n]);const i=ln();return e.jsx(e.Fragment,{children:a?e.jsx(ae.div,{...o,className:"mb-2 w-full flex-shrink overflow-y-hidden",children:e.jsx(ds,{children:e.jsx(Qi,{starterPrompts:t,onSelectStarterPrompt:i,disabled:s})})}):e.jsx(ae.div,{...o,className:"flex-shrink overflow-y-hidden",children:e.jsx(nm,{starterPrompts:t,onSelectStarterPrompt:i,disabled:s,cssMobileDisplayLimit:2,marginOverride:"mt-6 lg:mt-12"})})})}const Sg=t=>{const[s,n]=d.useState([]),a=d.useCallback(async()=>{const i=(await Ke.generateTrendingSuggestions(t)).suggestions.map((r,l)=>({type:Vs.Starter,title:go(r),body:"",icon:e.jsx(Eh,{}),prompt:go(r),id:`starter-${l}`,theme:On.Search}));n(i)},[t]);return{trendingSuggestions:s,fetchTrendingSuggestions:a}};function go(t){return t.split(" ").map(Md).join(" ")}const os=ye({whatCanIHelpWith:{id:"SplashScreenV2.whatCanIHelpWith",defaultMessage:"What can I help with?"},whereShouldWeStart:{id:"SplashScreenV2.whereShouldWeStart",defaultMessage:"Where should we start?"},askChatgptAnything:{id:"SplashScreenV2.askChatgptAnything",defaultMessage:"Ask ChatGPT anything"},moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),vg={HELP_WITH:os.whatCanIHelpWith,WHERE_TO_START:os.whereShouldWeStart,ASK_CHATGPT:os.askChatgptAnything};function bg({currentModel:t,categoryOptions:s,className:n,modelSwitcherDenialsBySlug:a,displayInFull_INTERNAL_USE_ONLY:o=!1}){const i=t?.id;return e.jsx(B.Portal,{children:e.jsx(B.SubContent,{className:n,children:s.map(r=>{const{value:l}=r;return"options"in r?e.jsx(ns,{currentModel:t,isSelected:i.startsWith(l),option:r,modelSwitcherDenialsBySlug:a,displayInFull_INTERNAL_USE_ONLY:o},l):e.jsx(Ys,{isSelected:i===l,value:l,renderName:()=>r.name,modelSwitcherDenialsBySlug:a,showNewChatHint:!1,displayInFull_INTERNAL_USE_ONLY:o},l)})})})}function ns({currentModel:t,option:s,isSelected:n=!1,modelSwitcherDenialsBySlug:a,displayInFull_INTERNAL_USE_ONLY:o=!1}){const{name:i,options:r,categoryId:l}=s,c=`${i} Models`,h=()=>e.jsx("div",{className:"flex shrink-0 grow justify-between gap-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Nh,{className:"icon-md w-7 text-token-text-secondary"}),c]})});let u;return o&&n&&(u=s.options.find(m=>m.value===t.id)?.name),e.jsxs(B.Sub,{children:[e.jsx(B.SubMenuTrigger,{children:e.jsxs("div",{className:T("flex grow justify-between gap-2 overflow-hidden",o?"items-center break-all":""),children:[l?h():i,n&&e.jsx("div",{className:"truncate text-token-text-tertiary",children:u??t.title})]})}),e.jsx(bg,{currentModel:t,categoryOptions:r,modelSwitcherDenialsBySlug:a,displayInFull_INTERNAL_USE_ONLY:o})]})}function Ys({value:t,renderName:s,isSelected:n,showNewChatHint:a=!0,onClick:o,modelSwitcherDenialsBySlug:i,isUpgradeUpsell:r=!1,testId:l,displayInFull_INTERNAL_USE_ONLY:c=!1}){const h=Ed(),u=Nd(),m=t?i[t]?.conversation?.[0]:null,{layer:g}=Fe("1846737571"),p=e.jsx(B.Item,{onClick:()=>{if(o)o();else if(t){const y=t;h({modelId:y,location:"Model switcher menu item"}),u(y)}},className:T("!pr-3",n&&"!opacity-100",m&&"pointer-events-none text-token-text-quaternary"),"data-testid":l,children:e.jsxs("div",{className:"flex grow items-center justify-between gap-2",children:[e.jsx("div",{className:c?"break-all":"",children:s(m!=null)}),r&&e.jsx(Ve,{color:"secondary",size:"small",className:g.get("is_upgrade_button_blue",!1)?"border-none bg-blue-600 text-white hover:bg-blue-800":"",children:e.jsx(P,{id:"oKo8wt",defaultMessage:"Upgrade"})}),r?e.jsx(e.Fragment,{children:n&&e.jsx(Vi,{className:T("icon-md group-hover:invisible",!a&&"block group-hover:hidden")})}):n&&e.jsx(Wi,{className:"icon-md"})]})},t);return m?e.jsx(Ft,{isLeftArrow:!0,sideOffset:-10,label:e.jsx(ki,{modelSwitcherDeny:m}),children:p}):p}const yg=It(()=>Dt(()=>import("./lx9v7qj0bs8u7xvf.js"),__vite__mapDeps([45,1,2,3,4,5,46])).then(t=>t.ThreadHeaderGizmoDropdown)),po=Ce.button`group flex cursor-pointer items-center gap-1 rounded-lg py-1.5 ${({$isScreenArch:t})=>t?"text-md px-2 ml-1.5 translate-x-[-0.4rem]":"px-3 text-lg"} hover:bg-token-main-surface-secondary radix-state-open:bg-token-main-surface-secondary font-semibold text-token-text-secondary overflow-hidden whitespace-nowrap`;function wg({clientThreadId:t}){const s=te(),n=Ot(),a=Od(t),o=en(),[,i]=Wo(),r=()=>{!a&&!n?o({pathname:"/",search:new URLSearchParams({[Is]:"true"}).toString()}):i(l=>(l.get(Is)==="true"?l.delete(Is):l.set(Is,"true"),l),{replace:a,state:zd()})};return e.jsx(B.Item,{size:"large",className:"!pr-3",onClick:r,icon:Ih,children:e.jsxs("div",{className:"flex grow items-center justify-between gap-2",children:[e.jsx("div",{className:"flex flex-1 items-center gap-3",children:e.jsx(P,{...pr.temporaryChat})}),e.jsx(Bd,{enabled:n,label:s.formatMessage({defaultMessage:"Temporary",id:"temporaryChatToggleLabel"}),testId:"temporary-chat-toggle"})]})})}function fr(t,s,n){let a=t;if(t===Ua.AUTO){const r=s.filter(({defaultModel:l})=>l!==Ua.AUTO);r.length===1&&(a=r[0].defaultModel)}const o=s.find(({defaultModel:r})=>r===a);if(o){const{categoryId:r,shortLabel:l}=o;return{selectedCategory:r,modelLabel:l}}const i=n.find(({modelIds:r})=>r.includes(a));if(i){const{group:r,shortLabel:l}=i;return{selectedCategory:r,modelLabel:l}}return{selectedCategory:null,modelLabel:null}}function jg({modelLabel:t}){return e.jsx("span",{className:"text-token-text-secondary",children:t})}function Mg({clientThreadId:t,inMobileHeader:s}){const{isLoading:n,categories:a,groups:o}=ga(),i=ol(),l=pa(t).id,c=Rd(),{modelLabel:h}=fr(l,a,o),u=kg(t,c),m=te(),{isUnauthenticated:g}=Ue(),p=gr(),y=(!g||!p)&&!i;d.useEffect(()=>{n||Pd({namespace:vi.ChatPageLoad})?.logTiming("render_model_switcher")},[n]);const f=Ye(),v=e.jsxs("div",{className:T(!f&&"text-token-text-secondary"),children:[Id," ",y?e.jsx("span",{className:"text-token-text-secondary",children:h}):g&&h?e.jsx(jg,{modelLabel:h}):null]});return u.length?n?null:e.jsx(em,{sideOffset:8,size:"large",triggerButton:e.jsxs(po,{$isScreenArch:f,"aria-label":h?m.formatMessage({id:"JrtGPQ",defaultMessage:"Model selector, current model is {modelLabel}"},{modelLabel:h}):"",children:[v,f?e.jsx(Rh,{className:"icon-md text-token-text-tertiary"}):e.jsx(Sa,{className:"icon-md text-token-text-tertiary"})]}),onOpenChange:x=>{V.logEvent(G.toggleModelSwitcher,{isOpen:x}),ce.logEvent("toggle_model_switcher",null,{isOpen:String(x)})},contentAlign:s?"center":"start",testId:"model-switcher-dropdown",children:e.jsx(Tg,{sections:u})}):e.jsx(po,{className:"cursor-default",children:v})}function gr(){return Re("462735957").value}function Cg({category:t,modelSwitcherDenialsBySlug:s,currentGizmoId:n,currentModelId:a,omitIcon:o,testId:i}){const{defaultModel:r,label:l,categoryId:c,description:h,isBeta:u}=t;return e.jsx(Ys,{value:r,modelSwitcherDenialsBySlug:s,renderName:m=>e.jsx(Kn,{categoryId:c,name:l,description:h,isDisabled:m,omitIcon:o,isBeta:u}),isSelected:!n&&a===r,testId:i},r)}function kg(t,s){const n=pa(t),a=n.id,o=He(t),{categories:i,groups:r}=ga(),{doesUserHaveAnyAccountsWithPlusFeatures:l}=Zs(),c=Z.getServerThreadId(t),h=Dd({clientThreadId:t}),u=te(),m=!c,{isUnauthenticated:g}=Ue(),p=Fd(),{layer:y}=Fe("2723963139"),f=y.get("is_dynamic_model_enabled",!1),v=gr(),x=s.find(({categoryId:_})=>_===Qe.ALPHA),M=s.find(({categoryId:_})=>_===Qe.DATA_CAMPAIGNS),S=s.find(({categoryId:_})=>_===Qe.EXPERIMENTS),b=s.find(({categoryId:_})=>_===Qe.MAINLINE),C=Re("566128514").value,F=!!x?.options?.length,N=!!M?.options?.length,j=!!S?.options?.length,w=!!b?.options?.length,k=en(),X=d.useCallback(()=>{V.logEvent(G.openModalAccountPaymentfromModelPicker,{content:"gizmo-button"}),_i(k,"Thread header dropdown")},[k]),U=()=>{ce.logEvent("chatgpt_model_switcher_plus_upgrade_button_clicked"),V.logEvent(G.modelSwitcherPlusUpgradeButtonClicked),g?p({shouldOpenPaymentModalOnAuth:!0,callback:_=>{V.logSignUpButtonClicked({location:"Model switcher GPT-4 upsell",provider:_})}}):X()},R=[],O=e.jsxs("div",{className:"mb-1 flex items-center justify-between px-5 pt-2",children:[e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(P,{id:"ilkdMh",defaultMessage:"Model"})}),e.jsx("a",{href:f?"https://help.openai.com/en/articles/9155758-what-is-the-chatgpt-plus-model-selector":"https://help.openai.com/en/articles/7102672-how-can-i-access-gpt-4",target:"_blank",rel:"noreferrer",children:e.jsx(qi,{className:"icon-md h-5 w-5 pl-0.5 text-token-text-tertiary"})})]},"header");if(v&&g){const _={id:"modelSection",content:[]};_.content.push(e.jsx(Ld,{},"noAuthUpsell")),R.push(_)}else if(l){const _={id:"modelSection",content:[]};i.length&&_.content.push(O);const q=new Map;i.forEach($=>{const K=e.jsx(Cg,{category:$,currentGizmoId:o,currentModelId:a,modelSwitcherDenialsBySlug:h,omitIcon:C,testId:`model-switcher-${$.defaultModel}`},$.categoryId);$.subcategory?(q.has($.subcategory)||q.set($.subcategory,[]),q.get($.subcategory)?.push(K)):_.content.push(K)}),q.forEach(($,K)=>{const H=i.find(J=>J.subcategory===K&&J.defaultModel===n.id);_.content.push(e.jsxs(B.Sub,{children:[e.jsx(B.SubMenuTrigger,{"data-testid":K==="More models"?"more-models-submenu":void 0,children:e.jsxs("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:[K,!!H&&e.jsx("div",{className:"truncate text-token-text-tertiary",children:H.label})]})}),e.jsx(B.Portal,{children:e.jsx(B.SubContent,{className:"min-w-72",children:$})})]},K))}),R.push(_)}else{const _={id:"modelSection",content:[]};_.content.push(e.jsx(Ys,{value:"",onClick:U,modelSwitcherDenialsBySlug:h,isUpgradeUpsell:!0,renderName:q=>e.jsx(Kn,{icon:Dh,isDisabled:q,name:u.formatMessage({id:"mzDzkX",defaultMessage:"ChatGPT Plus"}),description:u.formatMessage({id:"bqTHri",defaultMessage:"Our smartest model & more"}),omitIcon:!1}),isSelected:!1,showNewChatHint:!1},"plusUpgrade")),_.content.push(e.jsx(Ys,{value:Cn.AUTO,modelSwitcherDenialsBySlug:h,renderName:q=>e.jsx(Kn,{icon:Ph,name:u.formatMessage({id:"U9E7Rx",defaultMessage:"ChatGPT"}),description:u.formatMessage({id:"n96qML",defaultMessage:"Great for everyday tasks"}),isDisabled:q,omitIcon:!1}),isSelected:!o&&a===Cn.AUTO,showNewChatHint:!0},Cn.AUTO)),R.push(_)}const L={id:"otherOptionsSection",content:[]},{selectedCategory:E}=fr(a,i,r);return m&&(F&&L.content.push(e.jsx(ns,{isSelected:E===Qe.ALPHA,currentModel:n,option:x,modelSwitcherDenialsBySlug:h,displayInFull_INTERNAL_USE_ONLY:!0},x.value)),N&&L.content.push(e.jsx(ns,{isSelected:E===Qe.DATA_CAMPAIGNS,currentModel:n,option:M,modelSwitcherDenialsBySlug:h,displayInFull_INTERNAL_USE_ONLY:!0},M.value)),j&&L.content.push(e.jsx(ns,{currentModel:n,isSelected:E===Qe.EXPERIMENTS,option:S,modelSwitcherDenialsBySlug:h,displayInFull_INTERNAL_USE_ONLY:!0},S.value)),w&&L.content.push(e.jsx(ns,{isSelected:E===Qe.MAINLINE,currentModel:n,option:b,modelSwitcherDenialsBySlug:h,displayInFull_INTERNAL_USE_ONLY:!0},b.value))),L.content.length&&R.push(L),g||R.push({id:"temporaryChatSection",content:[e.jsx(wg,{clientThreadId:t},"tempChat")]}),R}function _g(){const t=te();return e.jsx("div",{className:"border-token-text-quartenary items-center rounded-full border px-1 py-0.5 text-[8px] font-semibold uppercase leading-3 text-token-text-secondary dark:border-token-border-heavy dark:text-token-text-tertiary",children:t.formatMessage(pr.beta)})}function Kn({isDisabled:t,name:s,icon:n,categoryId:a,description:o,extra:i,omitIcon:r,isBeta:l=!1}){let c=s;return l&&(c=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),e.jsx(_g,{})]})),e.jsxs("div",{className:"flex items-center gap-3",children:[!r&&e.jsx("span",{className:"flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-full bg-token-main-surface-secondary",children:n?e.jsx(n,{className:"h-4 w-4 text-token-text-primary"}):a&&e.jsx(Ti,{type:"filled",className:T("h-4 w-4",t&&"text-gray-300",!t&&"text-token-text-primary"),categoryId:a})}),e.jsxs("div",{children:[c,e.jsxs("div",{className:T(!t&&"text-token-text-secondary","text-xs"),children:[o,i]})]})]})}function Tg({sections:t}){return e.jsx(e.Fragment,{children:t.map((s,n)=>e.jsxs(Ko.Fragment,{children:[n!==0?e.jsx(B.Separator,{}):null,s.content]},s.id))})}function Ag({clientThreadId:t,inMobileHeader:s=!1}){const n=He(t);return n==null?e.jsx(Mg,{clientThreadId:t,inMobileHeader:s}):e.jsx(yg,{clientThreadId:t,gizmoId:n,inMobileHeader:s})}const pr=ye({beta:{id:"XZwFET",defaultMessage:"Beta"},gpt35ShortExplainer:{defaultMessage:"Great for everyday tasks",id:"ModelSwitcher.gpt35ShortExplainer"},modelTunerSmartSelectionTitle:{id:"czjW8I",defaultMessage:"Dynamic"},modelTunerSmartSelectionExplainer:{id:"gp/YH1",defaultMessage:"Optimized for speed and intelligence"},gpt4ShortExplainer:{defaultMessage:"With DALL·E, browsing and analysis",id:"ModelSwitcher.gpt4ShortExplainer"},gpt4ShortExplainerWithoutBrowse:{defaultMessage:"With DALL·E and analysis",id:"ModelSwitcher.gpt4ShortExplainerWithoutBrowse"},gpt4UpsellExplainer:{id:"ModelSwitcher.gpt4Upsell",defaultMessage:"Our smartest and most capable model. Includes DALL·E, browsing and more."},userUpgrade:{id:"ModelSwithcer.upgradeButton",defaultMessage:"Upgrade to Plus"},userUpgradeSignup:{id:"ModelSwitcher.signupUpgradeButton",defaultMessage:"Sign up for ChatGPT Plus"},temporaryChat:{id:"ModelSwitcher.temporaryChat",defaultMessage:"Temporary chat"},shareChat:{id:"ModelSwitcher.shareChat",defaultMessage:"Share chat"}}),Eg=It(()=>Dt(()=>import("./bqdxidyajbknrhxp.js"),__vite__mapDeps([47,1,2,3,48,49,4,5,50,51,7,43,52,11,6,8,9,10,12,53])).then(t=>t.GizmoUsingAsOwnerNotice)),Ng=({clientThreadId:t})=>{const s=Si(h=>h.activeStageSidebar),n=Z.getServerThreadId(t),a=Ud(mt.WorkspaceShareLinks),{isUnauthenticated:o}=Ue(),i=Ot(),r=a&&n&&!o&&!i,l=Ye(),c=!s&&!l;return e.jsx("div",{className:"flex items-center gap-2 pr-1 leading-[0]",children:e.jsx(Qh,{showShareButton:r,showProfileDropdown:c,clientThreadId:t})})};function Rg({clientThreadId:t,gizmoId:s}){const n=Hd(),{data:a}=fs(s),o=Lt();return e.jsxs(e.Fragment,{children:[e.jsxs(Gd,{className:"max-md:hidden",children:[e.jsxs("div",{className:"absolute start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2",children:[a!=null&&o?.isWorkspaceAccount()&&a.gizmo.tags?.includes(ca.WorkspaceDisabled)&&e.jsx(Eg,{gizmo:a}),e.jsx(Wd,{gizmoId:s,clientThreadId:t})]}),e.jsx(Vd,{children:e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden",children:[e.jsx(Zh,{clientThreadId:t}),e.jsx(Ag,{clientThreadId:t})]})}),e.jsx(Ng,{clientThreadId:t})]}),n&&e.jsx(qd,{})]})}function xr({clientThreadId:t}){const s=He(t),n=da(),a=Ye();return n||a?null:e.jsx(Rg,{gizmoId:s,clientThreadId:t})}function Pg({clientThreadId:t,currentModelId:s,isModelLoaded:n,onRequestCompletion:a,enableV2Homepage:o,v2HomepageDisclaimer:i}){const r=Ot();let l=e.jsx(om,{}),c;return r?(c=e.jsx(Ig,{}),l=e.jsx(ms,{className:"mb-6 h-12 w-12"})):t!=null?(c=o?e.jsx(lg,{clientThreadId:t,currentModelId:s,isModelLoaded:n,onRequestCompletion:a,v2HomepageDisclaimer:i}):e.jsx(im,{clientThreadId:t}),l=null):c=e.jsx(Dg,{}),e.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-token-text-primary",children:[l,c]})}function Ig({gizmo:t}){const s=Yd(),n=t?Xd(t.tools):!1,a=Lt();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-5 text-2xl font-semibold","data-testid":"temporary-chat-label",children:[e.jsx(Qd,{id:"temporary-chat-checkbox",name:"temporary-chat-checkbox",checked:!0}),e.jsx(P,{...ut.temporaryChat})]}),e.jsxs("div",{className:"max-w-sm text-center text-sm font-normal text-token-text-tertiary",children:[e.jsx(P,{...a?.isWorkspaceAccount()?s?ut.temporaryChatBizMemoryAvailable:ut.temporaryChatBizMemoryUnavailable:s?ut.temporaryChatDescriptionMemoryAvailable:ut.temporaryChatDescriptionMemoryUnavailable}),n&&e.jsx("div",{className:"mt-3",children:e.jsx(P,{...ut.temporaryChatDescriptionGptActions,values:{link:o=>e.jsx("a",{href:"https://help.openai.com/en/articles/8914046-temporary-chat-faq",target:"_blank",className:"underline",rel:"noreferrer",children:o})}})})]})]})}function Dg(){return e.jsx("div",{className:"mb-5 text-2xl font-semibold",children:e.jsx(P,{...ut.howCanIHelpYouToday})})}function Fg({clientThreadId:t,currentModelId:s,isModelLoaded:n,onRequestCompletion:a,enableV2Homepage:o,v2HomepageDisclaimer:i}){const r=He(t),l=$d(),c=Zn(),{data:h}=fs(r),u=Kd(),m=il(()=>navigator.windowControlsOverlay);return(l!=null||r!=null)&&h==null?null:e.jsxs("div",{className:"relative h-full",children:[e.jsx("div",{className:m?.visible?T("absolute right-[calc(100dvw-env(titlebar-area-width,100dvw)-env(titlebar-area-x,0))]",u?"left-[env(titlebar-area-x,0)]":"left-0"):"absolute left-0 right-0",children:e.jsx(xr,{clientThreadId:t})}),h!=null?e.jsx(am,{gizmo:h,showStarterPrompts:!0,disableStarterPrompts:c}):e.jsx(Pg,{clientThreadId:t,currentModelId:s,isModelLoaded:n,onRequestCompletion:a,enableV2Homepage:o,v2HomepageDisclaimer:i})]})}const ut=ye({temporaryChat:{id:"GizmoLanding.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatBizMemoryAvailable:{id:"g1opBW",defaultMessage:"This chat won't appear in your history and won't use or create memories."},temporaryChatBizMemoryUnavailable:{id:"fQmbtG",defaultMessage:"This chat won't appear your conversation history."},temporaryChatDescriptionMemoryAvailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryAvailable",defaultMessage:"This chat won't appear in history, use or create memories, or be used to train our models. For safety purposes, we may keep a copy for up to 30 days."},temporaryChatDescriptionMemoryUnavailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryUnavailable",defaultMessage:"This chat won't appear in history or be used to train our models. For safety purposes, we may keep a copy of this chat for up to 30 days."},temporaryChatDescriptionGptActions:{id:"GizmoLanding.temporaryChatDescriptionGptActions",defaultMessage:"Any data shared with a third party through GPT actions are subject to the third party's privacy policy. <link>Learn more</link>"},howCanIHelpYouToday:{id:"GizmoLanding.howCanIHelpYouToday",defaultMessage:"How can I help you today?"}}),Ct=({modelSwitcherDeny:t,value:s,label:n,subtitle:a,icon:o,onMouseEnter:i,onMouseLeave:r,onSelect:l,messageModelSlug:c,isHovered:h=!1,shouldShowUpsell:u=!1,className:m,includeCheck:g,includeRegenerate:p,justifyIcon:y,wrapIcon:f=!0})=>{const v=Lt(),x=!t,M=!x&&!u,S=en(),b=()=>{if(!u){l?.();return}V.logEvent(G.openModalAccountPaymentfromMessageModelPicker),V.logRateLimitGetPlusButtonClicked({type:Jn.RATE_LIMIT,location:"message_model_switcher_dropdown",plan_type:v?.planType??"unknown",is_hard_block:!1,hard_block_reason:"",is_new_conversation:!1}),_i(S,"Message model switcher dropdown")};return e.jsx(B.Item,{onSelect:b,onMouseEnter:()=>x&&i?.(),onMouseLeave:()=>x&&r?.(),disabled:M,className:m??"radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed radix-disabled:hover:bg-transparent",children:e.jsxs(Ft,{label:t&&e.jsx(ki,{modelSwitcherDeny:t}),className:"flex w-full items-center justify-between gap-2",sideOffset:0,children:[e.jsxs("div",{className:T("flex items-center gap-3",y==="right"&&"w-full"),children:[!!o&&(f?e.jsx("span",{className:T("flex h-7 w-7 items-center justify-center rounded-full bg-token-main-surface-secondary",y==="right"&&"order-10 ml-auto"),children:o}):o),e.jsxs("div",{children:[e.jsx("div",{children:n}),e.jsx("div",{className:T({"text-sm text-token-text-secondary":!M},{"text-sm text-token-text-quaternary":M}),children:a})]})]}),u?e.jsx(Ve,{color:"secondary",size:"small",children:e.jsx(P,{id:"54fmrA",defaultMessage:"Get Plus"})}):e.jsx(Lg,{messageModelSlug:c,isHovered:h,modelSwitcherDeny:t,optionModelSlug:s,includeCheck:g,includeRegenerate:p})]})})},Lg=({modelSwitcherDeny:t,optionModelSlug:s,isHovered:n,messageModelSlug:a,includeRegenerate:o=!0,includeCheck:i=!0})=>{let r=null;if(t)switch(t.reason){case Jn.RATE_LIMIT:r=Fh;break;default:r=qi;break}if(t)return e.jsx(r,{className:"icon-md"});const l=!!o&&e.jsx(un,{className:T("icon-md hidden text-token-text-tertiary",{"group-hover:block":n})});return a===s&&i?e.jsxs(e.Fragment,{children:[e.jsx(Vi,{className:T("icon-md text-token-text-primary",{"group-hover:hidden":n})}),l]}):l};function Og({className:t,clientThreadId:s,message:n,onModelSelect:a,onDropdownChange:o}){const i=te(),[r,l]=d.useState(null),[c,h]=d.useState(!1),[u,m]=d.useState(!1),g=Zd(),p=Ai(s),y=He(s),f=Ei({clientThreadId:s,message:n}),v=n.message.metadata?.model_slug,{modelOptions:x,modelSlug:M,animateModelLabelOnRender:S,nuxProps:b,messageModelEnabledTools:C}=f,F=Ni(n.message),N=C.includes(sn.Search),j=d.useMemo(()=>x.find(E=>E.value==v),[x,v]),{doesUserHaveAnyAccountsWithPlusFeatures:w}=Zs(),k=d.useRef(null),X=E=>{E||setTimeout(()=>{k.current&&k.current.blur()},10)};if(d.useEffect(()=>{X(c)},[c]),!g||y)return null;const U=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:i.formatMessage(xo.search),icon:e.jsx(Ss,{className:"icon-sm"}),condition:N&&!F,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:i.formatMessage(xo.nosearch),icon:e.jsx($i,{className:"icon-sm"}),condition:N&&F,eventName:"chatgpt_regenerate_without_search_button_clicked"}];let R,O;b.shouldRenderNux?(R=zg,O={title:e.jsx(P,{id:"g/+2Hh",defaultMessage:"Optimized your response"}),description:e.jsx(P,{id:"H0Flqm",defaultMessage:"Used {usedModelName} for a faster response that saves your limited {largestModelName} messages",values:{usedModelName:b.usedModelName,largestModelName:b.largestModelName}}),markAsViewed:b.announcement.markAsViewed}):(R=Bg,O={label:p?e.jsx(P,{id:"LBYK9a",defaultMessage:"Change model"}):e.jsx(P,{id:"nygjPN",defaultMessage:"Used {modelName}",values:{modelName:b.usedModelName}})});const L=p&&x.some(E=>hs(E,w));return e.jsxs(B.Root,{onOpenChange:E=>{p&&(h(E),o(E),X(E)),E&&V.logEvent(G.conversationOpenMessageModelSelector,{has_get_plus_button:L})},children:[e.jsx(R,{...O,children:e.jsx(Xi,{ref:k,className:T("cursor-pointer",t),onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),children:e.jsx(Yn,{modelSlug:M,animateModelLabelOnRender:S,isDropdownOpen:c,isRegenerateEnabled:p,isHovered:u})})}),p&&e.jsxs(B.Content,{className:"z-30 origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[x.map(E=>{const _=hs(E,w),{value:q,...$}=E;return e.jsx(Ct,{value:q,onSelect:()=>{ce.logEvent("chatgpt_regenerate_switch_model_button_clicked",q,{requestedModelId:q,...Je({clientThreadId:s})}),a({requestedModelId:q})},onMouseEnter:()=>l(q),onMouseLeave:()=>l(null),isHovered:r===q,messageModelSlug:n.message.metadata?.model_slug,shouldShowUpsell:_,...$},q)}),!!j&&e.jsxs(e.Fragment,{children:[e.jsx(B.Separator,{}),U.filter(E=>E.condition).map(E=>e.jsx(Ct,{onSelect:()=>{ce.logEvent(E.eventName,j.value,{requestedModelId:j.value,...Je({clientThreadId:s})}),a({requestedModelId:j.value,extraStreamParams:E.extraStreamParams})},includeRegenerate:!0,onMouseEnter:()=>l(E.key),onMouseLeave:()=>l(null),isHovered:r===E.key,messageModelSlug:v,includeCheck:!1,...j,label:E.label,subtitle:"",icon:E.icon},E.key))]})]})]})}function Yn({modelSlug:t,animateModelLabelOnRender:s,isDropdownOpen:n,isRegenerateEnabled:a,isHovered:o,isRegenLabel:i=!1,animateShortLabel:r,omitIcon:l}){const[c,h]=d.useState("initial"),{categories:u}=ga({isRegen:!!i});d.useEffect(()=>{if(s){const x=setTimeout(()=>h("show"),500),M=setTimeout(()=>h("initial"),2e3);return()=>{clearTimeout(x),clearTimeout(M)}}h("initial")},[s]);const m=u.find(({defaultModel:x})=>x===t),g=t===Jd?{categoryId:"gpt_3.5",shorterLabel:"3.5"}:{},{categoryId:p,shorterLabel:y}=m??g,f={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},v=n?"visible":o?"show":c;return e.jsxs(ae.div,{initial:"initial",animate:v,className:"flex items-center pb-0",children:[!l&&(i?e.jsx(un,{className:"icon-md"}):p&&e.jsx(Ti,{type:"outline",categoryId:p,className:"icon-md h-4 w-4"})),(a||r)&&e.jsx(ae.span,{className:"overflow-hidden text-clip whitespace-nowrap text-sm",variants:f,transition:{type:"tween",duration:.18},children:y}),a&&e.jsx(Sa,{className:T("icon-sm",{"text-token-text-quaternary":!o&&!i},{"text-token-text-secondary":o&&!i})})]})}function Bg({children:t,label:s}){return e.jsx(Ft,{label:s,sideOffset:0,children:t})}function zg({children:t,title:s,description:n,markAsViewed:a}){return e.jsx(di,{show:!0,side:"bottom",sideOffset:-4,title:s,description:n,badge:"beta",onDismiss:a,dismissOnOutsideClick:!0,children:t})}function hs(t,s){const{modelSwitcherDeny:n,subscriptionLevel:a}=t;return!!n&&n.reason===Jn.RATE_LIMIT&&a===rl.PLUS&&!s}const xo=ye({search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Ug=d.memo(Og),yt=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,Sr=new Set,Xn=typeof process=="object"&&process?process:{},vr=(t,s,n,a)=>{typeof Xn.emitWarning=="function"?Xn.emitWarning(t,s,n,a):console.error(`[${n}] ${s}: ${t}`)};let Xs=globalThis.AbortController,So=globalThis.AbortSignal;if(typeof Xs>"u"){So=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(a,o){this._onabort.push(o)}},Xs=class{constructor(){s()}signal=new So;abort(a){if(!this.signal.aborted){this.signal.reason=a,this.signal.aborted=!0;for(const o of this.signal._onabort)o(a);this.signal.onabort?.(a)}}};let t=Xn.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1";const s=()=>{t&&(t=!1,vr("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",s))}}const Hg=t=>!Sr.has(t),Ze=t=>t&&t===Math.floor(t)&&t>0&&isFinite(t),br=t=>Ze(t)?t<=Math.pow(2,8)?Uint8Array:t<=Math.pow(2,16)?Uint16Array:t<=Math.pow(2,32)?Uint32Array:t<=Number.MAX_SAFE_INTEGER?Hs:null:null;class Hs extends Array{constructor(s){super(s),this.fill(0)}}class kt{heap;length;static#l=!1;static create(s){const n=br(s);if(!n)return[];kt.#l=!0;const a=new kt(s,n);return kt.#l=!1,a}constructor(s,n){if(!kt.#l)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new n(s),this.length=0}push(s){this.heap[this.length++]=s}pop(){return this.heap[--this.length]}}class ja{#l;#u;#g;#p;#A;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#a;#x;#n;#s;#e;#c;#h;#r;#o;#S;#i;#v;#b;#m;#y;#C;#d;static unsafeExposeInternals(s){return{starts:s.#b,ttls:s.#m,sizes:s.#v,keyMap:s.#n,keyList:s.#s,valList:s.#e,next:s.#c,prev:s.#h,get head(){return s.#r},get tail(){return s.#o},free:s.#S,isBackgroundFetch:n=>s.#t(n),backgroundFetch:(n,a,o,i)=>s.#R(n,a,o,i),moveToTail:n=>s.#T(n),indexes:n=>s.#w(n),rindexes:n=>s.#j(n),isStale:n=>s.#f(n)}}get max(){return this.#l}get maxSize(){return this.#u}get calculatedSize(){return this.#x}get size(){return this.#a}get fetchMethod(){return this.#A}get dispose(){return this.#g}get disposeAfter(){return this.#p}constructor(s){const{max:n=0,ttl:a,ttlResolution:o=1,ttlAutopurge:i,updateAgeOnGet:r,updateAgeOnHas:l,allowStale:c,dispose:h,disposeAfter:u,noDisposeOnSet:m,noUpdateTTL:g,maxSize:p=0,maxEntrySize:y=0,sizeCalculation:f,fetchMethod:v,noDeleteOnFetchRejection:x,noDeleteOnStaleGet:M,allowStaleOnFetchRejection:S,allowStaleOnFetchAbort:b,ignoreFetchAbort:C}=s;if(n!==0&&!Ze(n))throw new TypeError("max option must be a nonnegative integer");const F=n?br(n):Array;if(!F)throw new Error("invalid max value: "+n);if(this.#l=n,this.#u=p,this.maxEntrySize=y||this.#u,this.sizeCalculation=f,this.sizeCalculation){if(!this.#u&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(v!==void 0&&typeof v!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#A=v,this.#C=!!v,this.#n=new Map,this.#s=new Array(n).fill(void 0),this.#e=new Array(n).fill(void 0),this.#c=new F(n),this.#h=new F(n),this.#r=0,this.#o=0,this.#S=kt.create(n),this.#a=0,this.#x=0,typeof h=="function"&&(this.#g=h),typeof u=="function"?(this.#p=u,this.#i=[]):(this.#p=void 0,this.#i=void 0),this.#y=!!this.#g,this.#d=!!this.#p,this.noDisposeOnSet=!!m,this.noUpdateTTL=!!g,this.noDeleteOnFetchRejection=!!x,this.allowStaleOnFetchRejection=!!S,this.allowStaleOnFetchAbort=!!b,this.ignoreFetchAbort=!!C,this.maxEntrySize!==0){if(this.#u!==0&&!Ze(this.#u))throw new TypeError("maxSize must be a positive integer if specified");if(!Ze(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#O()}if(this.allowStale=!!c,this.noDeleteOnStaleGet=!!M,this.updateAgeOnGet=!!r,this.updateAgeOnHas=!!l,this.ttlResolution=Ze(o)||o===0?o:1,this.ttlAutopurge=!!i,this.ttl=a||0,this.ttl){if(!Ze(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#P()}if(this.#l===0&&this.ttl===0&&this.#u===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#l&&!this.#u){const N="LRU_CACHE_UNBOUNDED";Hg(N)&&(Sr.add(N),vr("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",N,ja))}}getRemainingTTL(s){return this.#n.has(s)?1/0:0}#P(){const s=new Hs(this.#l),n=new Hs(this.#l);this.#m=s,this.#b=n,this.#I=(i,r,l=yt.now())=>{if(n[i]=r!==0?l:0,s[i]=r,r!==0&&this.ttlAutopurge){const c=setTimeout(()=>{this.#f(i)&&this.delete(this.#s[i])},r+1);c.unref&&c.unref()}},this.#k=i=>{n[i]=s[i]!==0?yt.now():0},this.#M=(i,r)=>{if(s[r]){const l=s[r],c=n[r];if(!l||!c)return;i.ttl=l,i.start=c,i.now=a||o();const h=i.now-c;i.remainingTTL=l-h}};let a=0;const o=()=>{const i=yt.now();if(this.ttlResolution>0){a=i;const r=setTimeout(()=>a=0,this.ttlResolution);r.unref&&r.unref()}return i};this.getRemainingTTL=i=>{const r=this.#n.get(i);if(r===void 0)return 0;const l=s[r],c=n[r];if(!l||!c)return 1/0;const h=(a||o())-c;return l-h},this.#f=i=>{const r=n[i],l=s[i];return!!l&&!!r&&(a||o())-r>l}}#k=()=>{};#M=()=>{};#I=()=>{};#f=()=>!1;#O(){const s=new Hs(this.#l);this.#x=0,this.#v=s,this.#_=n=>{this.#x-=s[n],s[n]=0},this.#D=(n,a,o,i)=>{if(this.#t(a))return 0;if(!Ze(o))if(i){if(typeof i!="function")throw new TypeError("sizeCalculation must be a function");if(o=i(a,n),!Ze(o))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return o},this.#E=(n,a,o)=>{if(s[n]=a,this.#u){const i=this.#u-s[n];for(;this.#x>i;)this.#N(!0)}this.#x+=s[n],o&&(o.entrySize=a,o.totalCalculatedSize=this.#x)}}#_=s=>{};#E=(s,n,a)=>{};#D=(s,n,a,o)=>{if(a||o)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#w({allowStale:s=this.allowStale}={}){if(this.#a)for(let n=this.#o;!(!this.#F(n)||((s||!this.#f(n))&&(yield n),n===this.#r));)n=this.#h[n]}*#j({allowStale:s=this.allowStale}={}){if(this.#a)for(let n=this.#r;!(!this.#F(n)||((s||!this.#f(n))&&(yield n),n===this.#o));)n=this.#c[n]}#F(s){return s!==void 0&&this.#n.get(this.#s[s])===s}*entries(){for(const s of this.#w())this.#e[s]!==void 0&&this.#s[s]!==void 0&&!this.#t(this.#e[s])&&(yield[this.#s[s],this.#e[s]])}*rentries(){for(const s of this.#j())this.#e[s]!==void 0&&this.#s[s]!==void 0&&!this.#t(this.#e[s])&&(yield[this.#s[s],this.#e[s]])}*keys(){for(const s of this.#w()){const n=this.#s[s];n!==void 0&&!this.#t(this.#e[s])&&(yield n)}}*rkeys(){for(const s of this.#j()){const n=this.#s[s];n!==void 0&&!this.#t(this.#e[s])&&(yield n)}}*values(){for(const s of this.#w())this.#e[s]!==void 0&&!this.#t(this.#e[s])&&(yield this.#e[s])}*rvalues(){for(const s of this.#j())this.#e[s]!==void 0&&!this.#t(this.#e[s])&&(yield this.#e[s])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(s,n={}){for(const a of this.#w()){const o=this.#e[a],i=this.#t(o)?o.__staleWhileFetching:o;if(i!==void 0&&s(i,this.#s[a],this))return this.get(this.#s[a],n)}}forEach(s,n=this){for(const a of this.#w()){const o=this.#e[a],i=this.#t(o)?o.__staleWhileFetching:o;i!==void 0&&s.call(n,i,this.#s[a],this)}}rforEach(s,n=this){for(const a of this.#j()){const o=this.#e[a],i=this.#t(o)?o.__staleWhileFetching:o;i!==void 0&&s.call(n,i,this.#s[a],this)}}purgeStale(){let s=!1;for(const n of this.#j({allowStale:!0}))this.#f(n)&&(this.delete(this.#s[n]),s=!0);return s}info(s){const n=this.#n.get(s);if(n===void 0)return;const a=this.#e[n],o=this.#t(a)?a.__staleWhileFetching:a;if(o===void 0)return;const i={value:o};if(this.#m&&this.#b){const r=this.#m[n],l=this.#b[n];if(r&&l){const c=r-(yt.now()-l);i.ttl=c,i.start=Date.now()}}return this.#v&&(i.size=this.#v[n]),i}dump(){const s=[];for(const n of this.#w({allowStale:!0})){const a=this.#s[n],o=this.#e[n],i=this.#t(o)?o.__staleWhileFetching:o;if(i===void 0||a===void 0)continue;const r={value:i};if(this.#m&&this.#b){r.ttl=this.#m[n];const l=yt.now()-this.#b[n];r.start=Math.floor(Date.now()-l)}this.#v&&(r.size=this.#v[n]),s.unshift([a,r])}return s}load(s){this.clear();for(const[n,a]of s){if(a.start){const o=Date.now()-a.start;a.start=yt.now()-o}this.set(n,a.value,a)}}set(s,n,a={}){if(n===void 0)return this.delete(s),this;const{ttl:o=this.ttl,start:i,noDisposeOnSet:r=this.noDisposeOnSet,sizeCalculation:l=this.sizeCalculation,status:c}=a;let{noUpdateTTL:h=this.noUpdateTTL}=a;const u=this.#D(s,n,a.size||0,l);if(this.maxEntrySize&&u>this.maxEntrySize)return c&&(c.set="miss",c.maxEntrySizeExceeded=!0),this.delete(s),this;let m=this.#a===0?void 0:this.#n.get(s);if(m===void 0)m=this.#a===0?this.#o:this.#S.length!==0?this.#S.pop():this.#a===this.#l?this.#N(!1):this.#a,this.#s[m]=s,this.#e[m]=n,this.#n.set(s,m),this.#c[this.#o]=m,this.#h[m]=this.#o,this.#o=m,this.#a++,this.#E(m,u,c),c&&(c.set="add"),h=!1;else{this.#T(m);const g=this.#e[m];if(n!==g){if(this.#C&&this.#t(g)){g.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:p}=g;p!==void 0&&!r&&(this.#y&&this.#g?.(p,s,"set"),this.#d&&this.#i?.push([p,s,"set"]))}else r||(this.#y&&this.#g?.(g,s,"set"),this.#d&&this.#i?.push([g,s,"set"]));if(this.#_(m),this.#E(m,u,c),this.#e[m]=n,c){c.set="replace";const p=g&&this.#t(g)?g.__staleWhileFetching:g;p!==void 0&&(c.oldValue=p)}}else c&&(c.set="update")}if(o!==0&&!this.#m&&this.#P(),this.#m&&(h||this.#I(m,o,i),c&&this.#M(c,m)),!r&&this.#d&&this.#i){const g=this.#i;let p;for(;p=g?.shift();)this.#p?.(...p)}return this}pop(){try{for(;this.#a;){const s=this.#e[this.#r];if(this.#N(!0),this.#t(s)){if(s.__staleWhileFetching)return s.__staleWhileFetching}else if(s!==void 0)return s}}finally{if(this.#d&&this.#i){const s=this.#i;let n;for(;n=s?.shift();)this.#p?.(...n)}}}#N(s){const n=this.#r,a=this.#s[n],o=this.#e[n];return this.#C&&this.#t(o)?o.__abortController.abort(new Error("evicted")):(this.#y||this.#d)&&(this.#y&&this.#g?.(o,a,"evict"),this.#d&&this.#i?.push([o,a,"evict"])),this.#_(n),s&&(this.#s[n]=void 0,this.#e[n]=void 0,this.#S.push(n)),this.#a===1?(this.#r=this.#o=0,this.#S.length=0):this.#r=this.#c[n],this.#n.delete(a),this.#a--,n}has(s,n={}){const{updateAgeOnHas:a=this.updateAgeOnHas,status:o}=n,i=this.#n.get(s);if(i!==void 0){const r=this.#e[i];if(this.#t(r)&&r.__staleWhileFetching===void 0)return!1;if(this.#f(i))o&&(o.has="stale",this.#M(o,i));else return a&&this.#k(i),o&&(o.has="hit",this.#M(o,i)),!0}else o&&(o.has="miss");return!1}peek(s,n={}){const{allowStale:a=this.allowStale}=n,o=this.#n.get(s);if(o===void 0||!a&&this.#f(o))return;const i=this.#e[o];return this.#t(i)?i.__staleWhileFetching:i}#R(s,n,a,o){const i=n===void 0?void 0:this.#e[n];if(this.#t(i))return i;const r=new Xs,{signal:l}=a;l?.addEventListener("abort",()=>r.abort(l.reason),{signal:r.signal});const c={signal:r.signal,options:a,context:o},h=(f,v=!1)=>{const{aborted:x}=r.signal,M=a.ignoreFetchAbort&&f!==void 0;if(a.status&&(x&&!v?(a.status.fetchAborted=!0,a.status.fetchError=r.signal.reason,M&&(a.status.fetchAbortIgnored=!0)):a.status.fetchResolved=!0),x&&!M&&!v)return m(r.signal.reason);const S=p;return this.#e[n]===p&&(f===void 0?S.__staleWhileFetching?this.#e[n]=S.__staleWhileFetching:this.delete(s):(a.status&&(a.status.fetchUpdated=!0),this.set(s,f,c.options))),f},u=f=>(a.status&&(a.status.fetchRejected=!0,a.status.fetchError=f),m(f)),m=f=>{const{aborted:v}=r.signal,x=v&&a.allowStaleOnFetchAbort,M=x||a.allowStaleOnFetchRejection,S=M||a.noDeleteOnFetchRejection,b=p;if(this.#e[n]===p&&(!S||b.__staleWhileFetching===void 0?this.delete(s):x||(this.#e[n]=b.__staleWhileFetching)),M)return a.status&&b.__staleWhileFetching!==void 0&&(a.status.returnedStale=!0),b.__staleWhileFetching;if(b.__returned===b)throw f},g=(f,v)=>{const x=this.#A?.(s,i,c);x&&x instanceof Promise&&x.then(M=>f(M===void 0?void 0:M),v),r.signal.addEventListener("abort",()=>{(!a.ignoreFetchAbort||a.allowStaleOnFetchAbort)&&(f(void 0),a.allowStaleOnFetchAbort&&(f=M=>h(M,!0)))})};a.status&&(a.status.fetchDispatched=!0);const p=new Promise(g).then(h,u),y=Object.assign(p,{__abortController:r,__staleWhileFetching:i,__returned:void 0});return n===void 0?(this.set(s,y,{...c.options,status:void 0}),n=this.#n.get(s)):this.#e[n]=y,y}#t(s){if(!this.#C)return!1;const n=s;return!!n&&n instanceof Promise&&n.hasOwnProperty("__staleWhileFetching")&&n.__abortController instanceof Xs}async fetch(s,n={}){const{allowStale:a=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,ttl:r=this.ttl,noDisposeOnSet:l=this.noDisposeOnSet,size:c=0,sizeCalculation:h=this.sizeCalculation,noUpdateTTL:u=this.noUpdateTTL,noDeleteOnFetchRejection:m=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:g=this.allowStaleOnFetchRejection,ignoreFetchAbort:p=this.ignoreFetchAbort,allowStaleOnFetchAbort:y=this.allowStaleOnFetchAbort,context:f,forceRefresh:v=!1,status:x,signal:M}=n;if(!this.#C)return x&&(x.fetch="get"),this.get(s,{allowStale:a,updateAgeOnGet:o,noDeleteOnStaleGet:i,status:x});const S={allowStale:a,updateAgeOnGet:o,noDeleteOnStaleGet:i,ttl:r,noDisposeOnSet:l,size:c,sizeCalculation:h,noUpdateTTL:u,noDeleteOnFetchRejection:m,allowStaleOnFetchRejection:g,allowStaleOnFetchAbort:y,ignoreFetchAbort:p,status:x,signal:M};let b=this.#n.get(s);if(b===void 0){x&&(x.fetch="miss");const C=this.#R(s,b,S,f);return C.__returned=C}else{const C=this.#e[b];if(this.#t(C)){const k=a&&C.__staleWhileFetching!==void 0;return x&&(x.fetch="inflight",k&&(x.returnedStale=!0)),k?C.__staleWhileFetching:C.__returned=C}const F=this.#f(b);if(!v&&!F)return x&&(x.fetch="hit"),this.#T(b),o&&this.#k(b),x&&this.#M(x,b),C;const N=this.#R(s,b,S,f),w=N.__staleWhileFetching!==void 0&&a;return x&&(x.fetch=F?"stale":"refresh",w&&F&&(x.returnedStale=!0)),w?N.__staleWhileFetching:N.__returned=N}}get(s,n={}){const{allowStale:a=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,status:r}=n,l=this.#n.get(s);if(l!==void 0){const c=this.#e[l],h=this.#t(c);return r&&this.#M(r,l),this.#f(l)?(r&&(r.get="stale"),h?(r&&a&&c.__staleWhileFetching!==void 0&&(r.returnedStale=!0),a?c.__staleWhileFetching:void 0):(i||this.delete(s),r&&a&&(r.returnedStale=!0),a?c:void 0)):(r&&(r.get="hit"),h?c.__staleWhileFetching:(this.#T(l),o&&this.#k(l),c))}else r&&(r.get="miss")}#L(s,n){this.#h[n]=s,this.#c[s]=n}#T(s){s!==this.#o&&(s===this.#r?this.#r=this.#c[s]:this.#L(this.#h[s],this.#c[s]),this.#L(this.#o,s),this.#o=s)}delete(s){let n=!1;if(this.#a!==0){const a=this.#n.get(s);if(a!==void 0)if(n=!0,this.#a===1)this.clear();else{this.#_(a);const o=this.#e[a];if(this.#t(o)?o.__abortController.abort(new Error("deleted")):(this.#y||this.#d)&&(this.#y&&this.#g?.(o,s,"delete"),this.#d&&this.#i?.push([o,s,"delete"])),this.#n.delete(s),this.#s[a]=void 0,this.#e[a]=void 0,a===this.#o)this.#o=this.#h[a];else if(a===this.#r)this.#r=this.#c[a];else{const i=this.#h[a];this.#c[i]=this.#c[a];const r=this.#c[a];this.#h[r]=this.#h[a]}this.#a--,this.#S.push(a)}}if(this.#d&&this.#i?.length){const a=this.#i;let o;for(;o=a?.shift();)this.#p?.(...o)}return n}clear(){for(const s of this.#j({allowStale:!0})){const n=this.#e[s];if(this.#t(n))n.__abortController.abort(new Error("deleted"));else{const a=this.#s[s];this.#y&&this.#g?.(n,a,"delete"),this.#d&&this.#i?.push([n,a,"delete"])}}if(this.#n.clear(),this.#e.fill(void 0),this.#s.fill(void 0),this.#m&&this.#b&&(this.#m.fill(0),this.#b.fill(0)),this.#v&&this.#v.fill(0),this.#r=0,this.#o=0,this.#S.length=0,this.#x=0,this.#a=0,this.#d&&this.#i){const s=this.#i;let n;for(;n=s?.shift();)this.#p?.(...n)}}}function Gg({conversationId:t,messageId:s}){const[n,a]=d.useState(!1),o=d.useRef({isMediaSourceAvailable:Ma(),mediaSourceFormat:Ca()??"n/a",playPromise:null,shouldAbortQueuedPlayback:!1}).current,i=te(),r=Pt(),{voiceName:l}=eu(),c=`${t}.${s}.${l}`,h=ll(),u=cl(f=>f.isPlaying&&f.sourceUrl===ze.get(c)?.src),m=d.useCallback(async()=>{if(!h)return;a(!0);const f={isMediaSourceAvailable:o.isMediaSourceAvailable,format:o.mediaSourceFormat};try{const v=await Wg({key:c,message_id:s,conversation_id:t,voice:l,onStreamingError:x=>{as.readAloud.error(x,f),a(!1),r.danger(i.formatMessage(vo.playbackError,{error:x.message}))},onStreamingStart:()=>{a(!1)}});if(o.shouldAbortQueuedPlayback){o.shouldAbortQueuedPlayback=!1;return}h.changeSource(v),o.playPromise=h.play()}catch(v){as.readAloud.error(v,f),a(!1),r.danger(i.formatMessage(vo.playbackError,{error:v.message}))}},[h,o,c,s,t,l,r,i]),g=d.useCallback(()=>{const f=Ha();f&&(o.playPromise?o.playPromise.then(()=>{f.stop(),o.playPromise=null}):f.stop())},[o]),p=d.useCallback(()=>{const f=Ha();f&&(f.state.isPlaying&&f.state.sourceUrl===ze.get(c)?.src?g():(as.readAloud.click({isMediaSourceAvailable:o.isMediaSourceAvailable,format:o.mediaSourceFormat}),m()))},[c,o,m,g]);d.useEffect(()=>{n&&u&&a(!1)},[n,u]);const y=d.useRef(c);return d.useEffect(()=>{y.current=c}),d.useEffect(()=>(o.shouldAbortQueuedPlayback=!1,()=>{const f=dl();f.isPlaying&&f.sourceUrl===ze.get(y.current)?.src?g():o.shouldAbortQueuedPlayback=!0}),[o,g]),{togglePlayback:p,isPlaying:u,isLoading:n}}async function yr({message_id:t,conversation_id:s,voice:n}){const a=await Ke.synthesize({message_id:t,conversation_id:s,voice:n,format:Ca()}),o=a.headers.get("content-type")??"audio/aac";return{response:a,format:o}}async function Wg(t){return Ma()?qg(t):Vg(t)}async function Vg({key:t,...s}){const n=ze.get(t);if(n?.blob)return n.src;const{response:a,format:o}=await yr(s),i=await a.arrayBuffer(),r=new Blob([i],{type:o}),l=wr({key:t,src:URL.createObjectURL(r),format:o,blob:r});return ze.set(t,l),l.src}async function qg({key:t,onStreamingError:s,onStreamingStart:n,...a}){let o=ze.get(t);o?.streaming&&(ze.delete(t),o=void 0);let i,r;const l=Kg(),c=new l;if(o)i=o,i.src=URL.createObjectURL(c);else{const{format:m,response:g}=await yr(a);r=g,i=wr({key:t,src:URL.createObjectURL(c),format:m})}const h=$g(i.id),u={sourceopen:async()=>{h("sourceopen");const m=c.addSourceBuffer(i.format),g=async()=>{m.updating&&await new Promise(p=>m.addEventListener("updateend",p,{once:!0}))};if(i.segments.length&&!i.streaming){h("streaming from cache"),i.streaming=!0,n();for(const p of i.segments)m.appendBuffer(p),await g();c.readyState==="open"&&c.endOfStream(),i.streaming=!1,h("done streaming from cache");return}if(r){h("fetching audio");try{const p=r.body?.getReader();if(!p)return;for(;ze.get(t)?.id===i.id;){const{done:y,value:f}=await p.read();if(y){h("done streaming"),i.streaming=!1,c.readyState==="open"&&c.endOfStream();break}if(!Array.from(c.sourceBuffers).includes(m)){h("stop streaming, source buffer removed"),i.streaming=!1;break}i.streaming||(h("start streaming"),i.streaming=!0,n()),m.appendBuffer(f),i.segments.push(f),await g()}}catch(p){if(h("error while streaming",p),i.streaming=!1,c.readyState==="open")try{c.endOfStream("network")}catch(y){as.readAloud.error(y)}ze.delete(t),s(p)}}},sourceclose:()=>{h("sourceclose"),i.streaming&&(i.streaming=!1,ze.get(t)?.id===i.id&&(h("sourceclosed while streaming, cleaning up cache"),ze.delete(t)))},sourceended:jt};for(const[m,g]of Object.entries(u))c.addEventListener(m,()=>{try{return g()}catch(p){as.readAloud.error(p)}});return ze.set(t,i),i.src}const vo=ye({playbackError:{id:"useVoiceReadAloudAudio.playbackError",defaultMessage:"Failed to play message"}}),$g=t=>jt;function Kg(){return Ma()?window.MediaSource:null}function Ma(){return!!Ca()}function Ca(){if("MediaSource"in window){const t=s=>ul(s)&&MediaSource.isTypeSupported(s);if(t("audio/aac"))return"aac";if(t("audio/mpeg"))return"mp3";if(t("audio/ogg"))return"ogg"}}const wr=t=>({id:$o(),segments:[],streaming:!1,...t}),ze=new ja({max:50,dispose:t=>{URL.revokeObjectURL(t.src)}}),Yg=d.memo(function(s){const n=Tt("1923022511")?.value,a=Bt(s.conversationId),{errCode:o}=xa(s.message);if(!n||!a||o)return null;const i=Ri.getAudioAssetPointers(s.message.message)[0];return i?e.jsx(Xg,{audioAssetPointer:i,conversationId:a}):e.jsx(Qg,{...s,conversationId:a})});function Xg({audioAssetPointer:t,conversationId:s}){const{isLoading:n,isPlaying:a,togglePlayback:o}=tu({audioAssetPointer:t,conversationId:s});return e.jsx(jr,{onClick:o,isPlaying:a,isLoading:n,playText:Qs.replay,playIcon:Lh})}function Qg({conversationId:t,message:s}){const{isLoading:n,isPlaying:a,togglePlayback:o}=Gg({conversationId:t,messageId:s.message.id});return e.jsx(jr,{onClick:o,isPlaying:a,isLoading:n,playText:Qs.play,playIcon:Oh})}function jr({onClick:t,isPlaying:s,isLoading:n,playText:a,playIcon:o}){let i,r;const l=te();return n?(i=Uo,r=Qs.loading):s?(i=Bh,r=Qs.stop):(i=o,r=a),e.jsx(es,{icon:i,label:r?l.formatMessage(r):void 0,disabled:n,onClick:t,style:s||n?{visibility:"visible"}:void 0,testId:"voice-play-turn-action-button"})}const Qs={replay:{id:"VoiceReadOutLoudButton.replay",defaultMessage:"Replay",description:"The tooltip for the replay button"},play:{id:"VoiceReadOutLoudButton.play",defaultMessage:"Read aloud",description:"The tooltip for the read aloud button"},stop:{id:"VoiceReadOutLoudButton.stop",defaultMessage:"Stop",description:"The tooltip for the stop button"},loading:{id:"VoiceReadOutLoudButton.loading",defaultMessage:"Loading",description:"The tooltip for the spinner"}},Os="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function Zg({className:t,clientThreadId:s,message:n,onModelSelect:a,onDropdownChange:o,canRegenerateResponse:i}){const r=Re("566128514").value,[l,c]=d.useState(null),[h,u]=d.useState(!1),[m,g]=d.useState(!1),p=He(s),y=Ei({clientThreadId:s,message:n}),f=n.message.metadata?.model_slug,v=n.message.id,{modelOptions:x,modelSlug:M,animateModelLabelOnRender:S,messageModelEnabledTools:b}=y,C=Ni(n.message),F=b.includes(sn.Search),N=d.useMemo(()=>x.find(R=>R.value===f),[x,f]),j=d.useRef(null),{doesUserHaveAnyAccountsWithPlusFeatures:w}=Zs(),k=R=>{R||setTimeout(()=>{j.current&&j.current.blur()},10)};if(d.useEffect(()=>{k(h)},[h]),su(s))return null;const U=i&&x.some(R=>hs(R,w));return p?null:e.jsxs(B.Root,{onOpenChange:R=>{i&&(u(R),o(R),k(R)),R&&V.logEvent(G.conversationOpenMessageModelSelector,{has_get_plus_button:U,is_new_regen_dropdown:!0})},children:[i?e.jsx(ep,{label:e.jsx(P,{id:"wDs5sz",defaultMessage:"Switch model"}),children:e.jsx(Xi,{ref:j,className:T("cursor-pointer",t),onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:e.jsx(Yn,{modelSlug:M,animateModelLabelOnRender:S,isDropdownOpen:h,isRegenerateEnabled:i,isHovered:m,isRegenLabel:!0,omitIcon:!1})})}):e.jsx("button",{className:T("cursor-pointer",t),onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:e.jsx(Yn,{modelSlug:M,animateModelLabelOnRender:S,isDropdownOpen:!1,isRegenerateEnabled:!1,isHovered:m,omitIcon:r,animateShortLabel:!0})}),i&&e.jsx(B.Portal,{children:e.jsxs(B.Content,{className:"z-30 min-w-fit origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[e.jsx(B.Item,{disabled:!0,className:"pb-0 pt-2",children:e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(P,{id:"bFLh5u",defaultMessage:"Switch model"})})}),e.jsx(Jg,{clientThreadId:s,messageId:v,onModelSelect:a,messageModelSlug:f,omitModelIcons:r,modelOptions:x,setHoveredOption:c,hoveredOption:l,retryOption:N,lastResponseUsedSearch:C,modelSupportsSearch:F,doesUserHaveAnyAccountsWithPlusFeatures:w})]})})]})}function Jg({clientThreadId:t,messageId:s,modelOptions:n,messageModelSlug:a,onModelSelect:o,omitModelIcons:i,setHoveredOption:r,hoveredOption:l,retryOption:c,lastResponseUsedSearch:h,modelSupportsSearch:u,doesUserHaveAnyAccountsWithPlusFeatures:m}){const g=te(),[p,y]=d.useMemo(()=>is(n,S=>S.subcategory),[n]),f=d.useMemo(()=>{const S=new Map;return p.forEach(b=>{const C=b.subcategory;C&&(S.has(C)||S.set(C,[]),S.get(C)?.push(b))}),S},[p]),v=T("icon-sm",i&&"order-10 ml-auto text-token-text-tertiary icon-md"),x=i?"right":"left",M=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:g.formatMessage(An.search),icon:e.jsx(Ss,{className:v}),condition:u&&!h,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:g.formatMessage(An.nosearch),icon:e.jsx($i,{className:v}),condition:u&&h,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return e.jsxs(e.Fragment,{children:[y.map(S=>{const{value:b,...C}=S;return e.jsx(Ct,{value:b,onSelect:()=>{ce.logEvent("chatgpt_regenerate_switch_model_button_clicked",b,{requestedModelId:b,...Je({clientThreadId:t,messageId:s})}),o({requestedModelId:b})},includeRegenerate:!1,onMouseEnter:()=>r(b),onMouseLeave:()=>r(null),isHovered:l===b,messageModelSlug:a,includeCheck:!1,shouldShowUpsell:hs(S,m),className:Os,...C,icon:i?e.jsx("span",{className:v}):C.icon,justifyIcon:x,wrapIcon:!i},b)}),[...f.entries()].map(([S,b])=>e.jsxs(B.Sub,{children:[e.jsx(B.SubMenuTrigger,{children:e.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:S})}),e.jsx(B.Portal,{children:e.jsx(B.SubContent,{className:"min-w-fit",children:b.map(C=>{const{value:F,...N}=C;return e.jsx(Ct,{value:F,onSelect:()=>{ce.logEvent("chatgpt_regenerate_switch_model_button_clicked",F,{requestedModelId:F,...Je({clientThreadId:t,messageId:s})}),o({requestedModelId:F})},includeRegenerate:!1,onMouseEnter:()=>r(F),onMouseLeave:()=>r(null),isHovered:l===F,messageModelSlug:a,includeCheck:!1,className:Os,...N,icon:null,justifyIcon:x,wrapIcon:!i,shouldShowUpsell:hs(C,m)},S+"-"+F)})})})]},S)),!!c&&e.jsxs(e.Fragment,{children:[e.jsx(B.Separator,{}),e.jsx(Ct,{onSelect:()=>{ce.logEvent("chatgpt_regenerate_try_again_button_clicked",c.value,{requestedModelId:c.value,...Je({clientThreadId:t,messageId:s})}),o({requestedModelId:c.value})},includeRegenerate:!0,onMouseEnter:()=>r(c.value),onMouseLeave:()=>r(null),messageModelSlug:a,includeCheck:!1,className:Os,...c,label:g.formatMessage(An.tryAgain),subtitle:c.label,icon:e.jsx(un,{className:v}),justifyIcon:x,wrapIcon:!i},c.value),M.filter(S=>S.condition).map(S=>e.jsx(Ct,{onSelect:()=>{ce.logEvent(S.eventName,c.value,{requestedModelId:c.value,...Je({clientThreadId:t,messageId:s})}),o({requestedModelId:c.value,extraStreamParams:S.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>r(S.key),onMouseLeave:()=>r(null),isHovered:l===S.key,messageModelSlug:a,includeCheck:!1,className:Os,...c,label:S.label,subtitle:"",icon:S.icon,justifyIcon:x,wrapIcon:!i},S.key))]})]})}function ep({children:t,label:s}){return e.jsx(Ft,{label:s,sideOffset:0,children:t})}const An=ye({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),tp=d.memo(Zg);function Mr(t){return t.find(s=>s.message.author.role===be.Tool&&s.message.metadata?.pending_memory_info)}function sp(t){return t.filter((s,n)=>{const a=t[n+1],i=a?.message.recipient==="assistant"&&a?.message.author.role===be.Tool&&a?.message.author.name==="bio"&&Pi(a.message).startsWith("Model set context");return s.message.author.role===be.Assistant&&s.message.recipient==="bio"&&i}).flatMap(s=>{const n=s.message.content.content_type;return n===At.Text?s.message.content.parts:n===At.Code?[s.message.content.text]:[]}).map(cp)}function np(t){return t.some(s=>s.message.author.role===be.Assistant&&s.message.recipient==="bio"&&s.message.status==="in_progress")}function ap(t){const{eligible:s,isLoading:n}=nu(),a=d.useMemo(()=>t.length>0,[t]);d.useEffect(()=>{a&&s&&!n&&cs.openModal(Ii.GlobalMemoryOnboarding)},[a,s,n])}function op(t){const[s,n]=d.useState(!1);return{isPopoverOpen:s,setIsPopoverOpen:n,handleTogglePopover:o=>{const i=o??!s;n(i),i&&V.logEvent(G.memoryUpdatePopoverShown,{updateCount:t.length})}}}function Cr({memoryWrites:t,popoverState:s,triggerButton:n,isParagen:a,setShowMemoriesModal:o}){return e.jsxs(au,{open:s.isPopoverOpen,sideOffset:4,side:"bottom",alignAgainstAnchor:"start",size:"none",className:"z-10 min-w-60 max-w-96 text-sm",onOpenChange:i=>s.handleTogglePopover(i),disableAutofocus:!0,triggerButton:n,children:[e.jsx("div",{className:"mb-2 rounded border border-token-border-light bg-token-main-surface-secondary",children:t.map((i,r)=>e.jsx("div",{className:"border-b border-token-border-light px-3 py-2 first-letter:uppercase last:border-b-0",children:i},r))}),a?e.jsx("div",{className:"text-xs text-token-text-tertiary",children:e.jsx(P,{id:"MemoryActionResult.paragenMessage",defaultMessage:"This memory will be saved if you choose this response."})}):e.jsxs("button",{className:"flex w-full items-center justify-between rounded px-3 py-2 font-semibold hover:bg-token-main-surface-secondary",onClick:()=>{o(!0),V.logEvent(G.memoryUpdatePopoverManageButtonClicked,{updateCount:t.length})},children:[e.jsx(P,{id:"MemoryActionResult.manageMemories",defaultMessage:"Manage memories"}),e.jsx(Uh,{className:"icon-md -mr-1 text-token-text-tertiary"})]})]})}function ip({clientThreadId:t,pendingMessage:s,memoryWrites:n,popoverState:a,setShowMemoriesModal:o}){const i=Pt(),r=te(),l=Z.getServerThreadId(t),c=ji({clientThreadId:t}),h=n.join(" ");let u=h.slice(0,50).replace(new RegExp("^\\p{L}","u"),g=>g.toLocaleUpperCase()).replace(/\.$/,"");h.length>50&&(u+="...");const m=async g=>{if(!l)throw new Error("Failed to confirm or reject memory update: serverThreadId is not found");const p=s.message.metadata?.pending_memory_info;Z.updateTree(t,y=>{y.updateNodeMessageMetadata(s.nodeId,{pending_memory_info:{...p,is_pending:!1,confirm_result:g}})});try{await Ke.confirmOrRejectMemory(s.message.id,l,g)}catch{i.danger(r.formatMessage({id:"memory.confirmOrDenyFail",defaultMessage:"Failed to confirm or reject memory update"})),Z.updateTree(t,f=>{f.updateNodeMessageMetadata(s.nodeId,{pending_memory_info:p})})}};return e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"inline-block text-sm font-semibold text-token-text-tertiary outline-none",children:e.jsx(P,{id:"MemoryActionResult.memoryConfirmation",defaultMessage:"Remember this? {memoryText}",values:{memoryText:e.jsx("div",{className:"inline-block py-1",onMouseOver:()=>a.handleTogglePopover(!0),onMouseOut:()=>a.handleTogglePopover(!1),children:e.jsx(Cr,{memoryWrites:n,popoverState:a,triggerButton:e.jsx("button",{className:T("text-left font-normal",a.isPopoverOpen?"text-token-text-secondary":"text-token-text-tertiary"),children:e.jsx(P,{id:"MemoryActionResult.memoryWrapper",defaultMessage:"“{memoryWrites}”",values:{memoryWrites:u}})}),setShowMemoriesModal:o})})}})}),e.jsx(Ve,{className:"ml-3 text-token-text-tertiary hover:text-token-text-primary",size:"xs",color:"secondary",disabled:c,onClick:()=>{m(!0)},children:e.jsx(P,{id:"MemoryActionResult.confirm",defaultMessage:"Yes"})}),e.jsx(Ve,{className:"ml-2 text-token-text-tertiary hover:text-token-text-primary",size:"xs",color:"secondary",disabled:c,onClick:()=>{m(!1)},children:e.jsx(P,{id:"MemoryActionResult.deny",defaultMessage:"No"})})]})}function rp({memoryWrites:t,popoverState:s,isParagen:n,setShowMemoriesModal:a}){return t.length===0?null:e.jsx(e.Fragment,{children:e.jsx("div",{className:"inline-block",onMouseOver:()=>s.handleTogglePopover(!0),onMouseOut:()=>s.handleTogglePopover(!1),children:e.jsx(Cr,{memoryWrites:t,popoverState:s,isParagen:n,triggerButton:e.jsxs("button",{className:T("my-1 flex items-center gap-1 text-sm font-semibold outline-none",s.isPopoverOpen?"text-token-text-secondary":"text-token-text-tertiary"),children:[e.jsx(zh,{className:"mb-[-1px]"}),t.length===1?e.jsx(P,{id:"MemoryActionResult.memoryWriteSingular.1",defaultMessage:"Memory updated"}):e.jsx(P,{id:"MemoryActionResult.memoryWritePlural.1",defaultMessage:"Memories updated"})]}),setShowMemoriesModal:a})})})}function lp(t){const s=Mr(t),n=s?.message.metadata?.pending_memory_info?.confirm_result;return s==null?null:n===!0?"confirmed":n===!1?"denied":"pending"}function Qn({messages:t,clientThreadId:s,gizmoId:n,isParagen:a}){const o=sp(t),i=op(o),r=np(t);ap(o);const[l,c]=d.useState(!1),h=Mr(t),u=lp(t);return u==="denied"?null:r?e.jsx("div",{className:"result-streaming",children:e.jsx("span",{children:e.jsx("pre",{})})}):e.jsxs(e.Fragment,{children:[u==="pending"?e.jsx(ip,{clientThreadId:s,memoryWrites:o,popoverState:i,setShowMemoriesModal:c,pendingMessage:h}):e.jsx(rp,{memoryWrites:o,popoverState:i,isParagen:a,setShowMemoriesModal:c}),l&&e.jsx(dm,{initialGizmoId:n,onClose:()=>c(!1)})]})}function cp(t){const s=["The user ","The user's ","User ","User's "];for(const n of s)if(t.startsWith(n))return t.slice(n.length);return t}function bo(t,s,n){Z.updateTree(t,a=>{a.updateNodeMetadata(s,{inlineComparisonRating:n})})}function yo(t){return{is_dark_mode:t==="dark",time_since_loaded:Math.floor(performance.now()/1e3),page_height:window?.innerHeight,page_width:window?.innerWidth,pixel_ratio:window?.devicePixelRatio,screen_height:window?.screen?.height,screen_width:window?.screen?.width}}const wo=({messages:t})=>{for(const{message:{metadata:s}}of t){const{augmented_paragen_prompt_label:n}=s??{};if(n)return n}};function dp(t){const s=d.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});return t.stubSideBySideFeedback?e.jsx(kr,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:s,...t}):e.jsx(up,{...t,visibilityStateRef:s})}function up(t){const{clientThreadId:s,variantIds:n,variantsInStreamInfo:a,turnIndex:o}=t;if(n.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const i=ka(),[r]=d.useState(()=>Date.now()),l=ua(),{resolvedTheme:c}=hl(),[h,u]=d.useMemo(()=>Di(n.join(""))()<.5?[0,1]:[1,0],[n[0],n[1]]),m=h<u?"left":"right",g=m==="left"?"right":"left",p=n[h],y=n[u],f=Ka(s,p),v=Ka(s,y),x=wt(Bn(s,o,wt(f).id)),M=wt(Bn(s,o,wt(v).id)),S=m==="left"?x:M,b=m==="left"?M:x,C=a.display_treatment==="unskippable",F=i?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";d.useEffect(()=>(Fn.setState({displayingSideBySideFeedback:!0,unskippable:C}),()=>{Fn.setState({displayingSideBySideFeedback:!1,unskippable:!1})}),[C]),ou();const N=d.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});d.useEffect(()=>ml(iu,{requestCompletion:()=>{const w=ts(S.messages)?.completionSampleFinishTime,k=ts(b.messages)?.completionSampleFinishTime;Ke.submitMessageComparisonFeedback({feedback_version:F,original_message_id:S.messages[S.messages.length-1]?.message.id,new_message_id:b.messages[b.messages.length-1]?.message.id,conversation_id:Z.getServerThreadId(s),completion_comparison_rating:"skip",new_completion_placement:g,feedback_start_time:r,compare_step_start_time:r,original_completion_load_start_time:r,original_completion_load_end_time:w??0,new_completion_load_start_time:r,new_completion_load_end_time:k??0,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:yo(c),...N.current})}}),[x,M,s,r,F,g,S?.messages,b?.messages,c]);const j=w=>{const X=Z.getTree(s).getLeafFromNode(w);Z.setThreadCurrentLeafId(s,X.id);const R=w===p===(m==="left"),O=ts(S.messages)?.completionSampleFinishTime,L=ts(b.messages)?.completionSampleFinishTime;S.messages.length>0&&bo(s,S.messages[S.messages.length-1].nodeId,R?"original":"new"),b.messages.length>0&&bo(s,b.messages[b.messages.length-1].nodeId,R?"original":"new");let E;O==null||L==null?E=R?"partial_load_comparison_original":"partial_load_comparison_new":E=R?"original":"new",Ke.submitMessageComparisonFeedback({feedback_version:F,original_message_id:S.messages[S.messages.length-1]?.message.id,new_message_id:b.messages[b.messages.length-1]?.message.id,conversation_id:Z.getServerThreadId(s),completion_comparison_rating:E,new_completion_placement:g,feedback_start_time:r,compare_step_start_time:r,original_completion_load_start_time:r,original_completion_load_end_time:O??null,new_completion_load_start_time:r,new_completion_load_end_time:L??null,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:yo(c),...N.current})};return e.jsx(kr,{...t,setPreferredFeedback:j,leftVariantId:p,rightVariantId:y,leftTurn:x,rightTurn:M,hasActiveRequest:l,originalTurn:S,visibilityStateRef:N})}function hp(t){if(!t.length)return!1;const s=t.filter(n=>n.type===$e.Text||n.type===$e.MultiText).filter(n=>n.message.message.status!=="finished_successfully"&&n.message.message.metadata?.snorkle_status!==void 0);return s.length>0&&s.every(n=>{const a=n.message.message.content;return a?.content_type===At.Text&&a.parts.join("")===""})}function kr({setPreferredFeedback:t,leftVariantId:s,rightVariantId:n,leftTurn:a,rightTurn:o,hasActiveRequest:i,originalTurn:r,visibilityStateRef:l,...c}){const{defaultParagenLabel:h,shouldShowParagenLabels:u=!1}=ci(),m=a&&wo(a)||h,g=o&&wo(o)||h,p=d.useMemo(()=>a?.messages??[],[a?.messages]),y=d.useMemo(()=>o?.messages??[],[o?.messages]),{avatarClassName:f}=c,v=d.useMemo(()=>$s(p),[p]),x=d.useMemo(()=>$s(y),[y]),M=Yo(),[S,b]=d.useMemo(()=>[v,x].map(q=>hp(q)),[v,x]),C=ft(a?Ks.getRequestIdFromConversationTurn(a):"")||S,F=ft(o?Ks.getRequestIdFromConversationTurn(o):"")||b,N=a?.role===be.User,j=o?.role===be.User,w=d.useRef(null),k=d.useRef(null),X=d.useRef(null),U=c.stubSideBySideFeedback||S,R=c.stubSideBySideFeedback||b;d.useEffect(()=>{if(w.current&&k.current&&X.current){const q=Array(11).fill(0).map((K,H)=>H/10),$=new IntersectionObserver(K=>K.forEach(H=>{H.target===k.current?(l.current.left_visibility_initial==null&&(l.current.left_visibility_initial=H.intersectionRatio),l.current.left_visibility_max=Math.max(l.current.left_visibility_max??0,H.intersectionRatio)):H.target===X.current&&(l.current.right_visibility_initial==null&&(l.current.right_visibility_initial=H.intersectionRatio),l.current.right_visibility_max=Math.max(l.current.right_visibility_max??0,H.intersectionRatio))}),{root:w.current,threshold:q});return $.observe(k.current),$.observe(X.current),()=>$.disconnect()}},[l]);const{data:O}=Xo(void 0,!1,M),L=ka(),E=e.jsx("div",{className:"text-pretty px-6 pb-5 pt-1 text-center text-sm text-token-text-secondary",children:e.jsx(P,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),_=Ye();return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:T("sticky z-[1] text-pretty bg-token-main-surface-primary px-6 text-center text-lg",_&&"top-[var(--thread-leading-height)] pt-3",!_&&"top-[-1px]",L&&!_?"md:top-header-height":_?"":"md:static"),children:[e.jsx(P,{id:"JgCHDY",defaultMessage:"You’re giving feedback on a new version of ChatGPT."}),L?E:null]}),L?null:E,e.jsx("div",{className:"relative -mb-2 snap-x snap-mandatory overflow-x-auto px-3 pb-4 md:px-5 lg:px-10",ref:w,children:e.jsx("div",{className:T(!_&&"min-w-fit"),children:e.jsxs("div",{className:T("mx-auto flex max-w-6xl items-start",L&&!_&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",!L&&!_&&"gap-4 sm:gap-6",L&&_&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",_&&!L&&"gap-4 sm:gap-6"),children:[e.jsxs(jo,{horizontalScrollContainerRef:w,rootElementRef:k,onClick:()=>{t(s)},hasActiveRequest:i,isWaitingOnFirstUserVisibleToken:U,children:[e.jsxs(ko,{children:[e.jsx(zn,{messages:p,isUserTurn:N,avatarClassName:f}),e.jsx(Co,{children:u?e.jsx("span",{className:"font-bold text-token-text-primary",children:m}):e.jsx(P,{...To.responseNumber,values:{responseIndex:1}})})]}),L&&U?e.jsx(Mo,{}):e.jsxs(e.Fragment,{children:[O!=null&&!N&&e.jsx(Qn,{clientThreadId:c.clientThreadId,messages:p,isParagen:!0}),e.jsx(Gn,{...c,groupedMessagesToRender:v,allGroupedMessages:v,isEditing:!1,isUserTurn:N,isCompletionRequestInProgress:C,hasActiveRequest:i,handleEnterEdit:jt,handleExitEdit:jt,shouldGrowContainer:!1}),e.jsx(_o,{turn:a,originalTurn:r})]})]}),e.jsxs(jo,{horizontalScrollContainerRef:w,rootElementRef:X,onClick:()=>{t(n)},hasActiveRequest:i,isWaitingOnFirstUserVisibleToken:R,children:[e.jsxs(ko,{children:[e.jsx(zn,{messages:y,isUserTurn:j,avatarClassName:f}),e.jsx(Co,{children:u?e.jsx("span",{className:"font-bold text-token-text-primary",children:g}):e.jsx(P,{...To.responseNumber,values:{responseIndex:2}})})]}),L&&R?e.jsx(Mo,{}):e.jsxs(e.Fragment,{children:[O!=null&&!j&&e.jsx(Qn,{clientThreadId:c.clientThreadId,messages:y,isParagen:!0}),e.jsx(Gn,{...c,groupedMessagesToRender:x,allGroupedMessages:x,isEditing:!1,isUserTurn:j,isCompletionRequestInProgress:F,hasActiveRequest:i,handleEnterEdit:jt,handleExitEdit:jt,shouldGrowContainer:!1}),e.jsx(_o,{turn:o,originalTurn:r})]})]})]})})})]})}function jo({horizontalScrollContainerRef:t,rootElementRef:s,onClick:n,children:a,hasActiveRequest:o,isWaitingOnFirstUserVisibleToken:i}){const r=ka(),l=Ye(),{scrollX:c}=ru({layoutEffect:!1,container:t,target:s}),h=lu(),u=cu(),m=d.useRef(null),g=d.useRef(null),p=d.useRef(null),[y,f]=d.useState(!1),[v,x]=d.useState(!1),[M,S]=d.useState(!1),[b,C]=d.useState(0);d.useEffect(()=>{if(!r)return;const U=new IntersectionObserver(R=>{for(const O of R)O.target===m.current?f(O.isIntersecting):O.target===p.current?S(O.isIntersecting):O.target===g.current&&x(O.isIntersecting)},{root:h?.current,rootMargin:l?`0px 0px -${b}px 0px`:void 0});return m.current&&g.current&&p.current&&(U.observe(m.current),U.observe(g.current),U.observe(p.current)),()=>{U.disconnect()}},[b,r,l,h]);const F=!M&&(v||y),N=du(c,U=>F?-1*U:0),j=Ya(0);d.useEffect(()=>{if(!r)return;const U=new ResizeObserver(R=>{Ds(R.length===1,"entryList.length === 1");const O=R[0];Ds(O.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),j.set(O.contentBoxSize[0].inlineSize)});return s.current&&U.observe(s.current),()=>{U.disconnect()}},[r,j,s]);const w=Ya(0);d.useEffect(()=>{if(!r)return;const U=new ResizeObserver(R=>{Ds(R.length===1,"entryList.length === 1");const O=R[0];Ds(O.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),w.set(O.contentBoxSize[0].blockSize+16),C(O.contentBoxSize[0].blockSize)});return u.current&&U.observe(u.current),()=>{U.disconnect()}},[r,w,u]);const k=e.jsx(Ve,{className:r?"px-5":"mt-4 self-start",onClick:n,children:e.jsx(P,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),X=i;return e.jsxs("div",{"data-paragen-root":!0,className:T("relative flex w-full min-w-[min(450px,80vw)] snap-center flex-col gap-1 text-left",l&&r&&"pl-3 pr-5 sm:w-[calc(100cqw-62px)] sm:pl-3 sm:pr-5 md:px-10",!l&&r&&"px-10",r?"min-h-60 py-4":"rounded-2xl border border-token-main-surface-tertiary bg-white p-5 dark:bg-gray-700"),ref:s,children:[e.jsx("div",{className:T("absolute left-0 right-0 top-48 h-px","invisible"),ref:m}),e.jsx("div",{className:T("absolute bottom-0 left-0 right-0 top-48","invisible"),ref:g}),e.jsx("div",{className:T("absolute bottom-0 left-0 right-0 h-px","invisible"),ref:p}),a,r?e.jsx("div",{className:"flex-1"}):null,r?e.jsx("div",{className:"mt-4 min-h-10",children:X?null:e.jsx(ae.div,{style:{translateX:N,width:j,bottom:w},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:T({fixed:F,"z-20 flex w-full justify-center":!0}),children:k})}):o?null:k]})}function Mo(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pb-5 pt-3",children:[e.jsx(dt,{className:"h-4 w-[75%]"}),e.jsx(dt,{className:"h-4 w-[50%]"}),e.jsx(dt,{className:"h-4 w-[80%]"}),e.jsx(dt,{className:"h-4 w-[55%]"}),e.jsx(dt,{className:"h-4 w-[66%]"}),e.jsx(dt,{className:"h-4 w-[64%]"}),e.jsx(dt,{className:"h-4 w-[48%]"})]})}function ka(){const{layer:t}=Fe("3119715334");return t.get("should-enable-hojicha",!1)}const Co=Ce.div`text-sm text-token-text-secondary font-semibold`,ko=Ce.div`flex gap-4 items-center mb-1`,dt=Ce.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function _o({turn:t,originalTurn:s}){const n=la();if(!n.showParagenMetadata||!n.showDebugConversationTurns&&!n.forceParagen||t==null)return null;let a=t===s?"ORIGINAL":"NEW";const i=t.messages[t.messages.length-1]?.message?.metadata?.__internal;if(i){const{model_id:r,model_definition_slug:l,model_definition_virtual_model_id:c,alternative_model_selection_rule:h,augmented_paragen_prompt_group_id:u,augmented_paragen_prompt_id:m,augmented_paragen_prompt:g}=i;r&&(a+=`
Model ID: ${r}`),l&&(a+=`
Model Slug: ${l}`),c&&(a+=`
Virtual Model ID: ${c}`),h&&(a+=`
Alternative Model Rule: ${h}`),u&&(a+=`
Prompt Group ID: ${u}`),m&&(a+=`
Prompt ID: ${m}`),g&&(a+=`
Prompt: ${g}`)}return e.jsx("div",{className:"whitespace-pre-wrap text-sm text-red-500",children:a})}const To=ye({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}"}}),Ao=(...t)=>s=>t.some(n=>n(s)),Eo=({allGroupedMessages:t})=>t.some(s=>[$e.Browsing,$e.RetrievalBrowsing,$e.ParallelBrowsing].includes(s.type)),No=({allGroupedMessages:t})=>t.some(s=>s.type===$e.SearchGPTQuery),Ro=({allGroupedMessages:t})=>t.some(s=>s.type===$e.CodeInterpreter);function mp(t){return!t||!t.instructions?"":typeof t.instructions=="string"?t.instructions:t.instructions.filter(s=>typeof s=="string").join("")}const fp=[{match:Ao(Eo,No),tag:"Shouldn't have searched the web",label:ge({id:"kL047b",defaultMessage:"Shouldn't have searched the web"})},{match:Ao(Eo,No),tag:"Don't like the source it cited",label:ge({id:"OWjzGX",defaultMessage:"Don't like the sources it cited"})},{match:Ro,tag:"Shouldn't have run code",label:ge({id:"53w4ay",defaultMessage:"Shouldn't have run code"})},{match:Ro,tag:"Couldn't handle my file",label:ge({id:"EkFTQ5",defaultMessage:"Couldn't handle my file"})},{match:({allGroupedMessages:t})=>t.some(s=>s.type===$e.Dalle),tag:"Shouldn't have created an image",label:ge({id:"S8FRsr",defaultMessage:"Shouldn't have created an image"})},{match:({allGroupedMessages:t})=>t.some(s=>{if(s.type!==$e.Text)return!1;const{message:n}=s.message,{content:a}=n;return a.content_type===At.Text&&Pi(n).match(/^```[\S]+\n/gm)}),tag:"Code was incorrect",label:ge({id:"4EBdQk",defaultMessage:"Code was incorrect"})},{match:({systemContent:t})=>mp(t).includes("Personality")??!1,tag:"Too chatty or casual",label:ge({id:"ATzJKW",defaultMessage:"Too chatty or casual"})},{match:({features:t})=>t.includes(mt.Sunshine),tag:"Shouldn't have used Memory",label:ge({id:"yfUEiz",defaultMessage:"Shouldn't have used Memory"})},{tag:"Don't like the style",label:ge({id:"nGxjdj",defaultMessage:"Don't like the style"})},{tag:"Not factually correct",label:ge({id:"Ke7JtQ",defaultMessage:"Not factually correct"})},{tag:"Didn't fully follow instructions",label:ge({id:"Rdlt9V",defaultMessage:"Didn't fully follow instructions"})},{tag:"Refused when it shouldn't have",label:ge({id:"2yRS/Q",defaultMessage:"Refused when it shouldn't have"})},{tag:"Being lazy",label:ge({id:"14MPmT",defaultMessage:"Being lazy"})},{tag:"Unsafe or problematic",label:ge({id:"02pXBl",defaultMessage:"Unsafe or problematic"})},{tag:"Other",label:ge({id:"WiIGE+",defaultMessage:"Other"})}],gp=[{tag:"I disagree with the policy",label:ge({id:"oKyDLz",defaultMessage:"I disagree with the policy"})},{tag:"This didn't violate the policy",label:ge({id:"7fUkVF",defaultMessage:"This didn't violate the policy"})},{tag:"I don't understand the policy",label:ge({id:"4Cdp6N",defaultMessage:"I don't understand the policy"})},{tag:"This didn't take the full context",label:ge({id:"vnZJDP",defaultMessage:"This didn't take the full context"})}];function pp(t,s,n){return s.filter(a=>!a.match||a.match(n)).map(a=>({value:a.tag,label:t.formatMessage(a.label)}))}function xp(t){const s=t[t.length-1];if(!s)return!1;const n="message"in s?s.message:null;if(n){const{errCode:a}=xa(n);return[qs.ContentPolicy,qs.ContentOrTos].includes(a)}else return!1}function Sp({clientThreadId:t,conversationMessage:s,currentModelId:n,allGroupedMessages:a}){const o=te(),i=tn()??[],r=s.rating,l=uu(t,s.message.id),c=l?.message.content.content_type===At.SystemContent?l?.message.content:null,h=d.useCallback(g=>{const p=Z.getServerThreadId(t);p&&(g.tags.length===0&&!g.textFeedback||(V.logEvent(g.source==="inline"?G.messageFeedbackInlineSubmitted:G.messageFeedbackDialogSubmitted,{id:s.message.id,threadId:p,tags:g.tags,content:g.textFeedback,model:n,rating:r}),ce.logEvent(g.source==="inline"?"chatgpt_feedback_inline_submitted":"chatgpt_feedback_dialog_submitted",g.tags?.[0]??null,{id:s.message.id,threadId:p,tag:g.tags?.[0]??"",content:g.textFeedback??"",model:n,rating:r??""}),r&&Ke.submitMessageFeedback({message_id:s.message.id,conversation_id:p,rating:r,text:g.textFeedback,tags:g.tags,tag_choices:g.tagChoices})))},[t,s.message,n,r]),u=()=>{V.logEvent(G.messageFeedbackMoreOptionsClicked,{id:s.message.id,threadId:Z.getServerThreadId(t),model:n,rating:r})},m=pp(o,xp(a)?gp:fp,{allGroupedMessages:a,features:i,currentModelId:n,systemContent:c});return r==="thumbsUp"?null:e.jsx(lm,{tagOptions:m,onSubmit:h,onMoreClicked:u})}const Po=[1,2,3,4,10,20,30],vp=.5;function bp({clientThreadId:t,conversationLeafId:s}){const n=Fi(Li.isBusinessWorkspace),a=d.useRef(!1),o=Bt(t),i=dn(t),{isUnauthenticated:r}=Ue(),l=d.useMemo(()=>{if(!o)return-1;const w=Di(o);return w()>vp?-1:Po[Math.floor(w()*Po.length)]},[o]),c=hu(t,s),h=c[c.length-1],u=d.useMemo(()=>Ks.getRequestIdFromConversationTurn(h),[h]),m=ft(u),[g,p]=d.useState(null),[y,f]=d.useState(!1),[v,x]=d.useState(!1),[M,S]=d.useState(!1),b=w=>{const k=ts(c)?.messages[0]?.message.id;p(w),N(k,w)},C=c.filter(w=>w.role===be.Assistant).length,F=h?.role===be.Assistant,N=d.useMemo(()=>Ci((w,k)=>{o&&w&&Ke.submitConversationRating({conversation_id:o,message_id:w,rating:k,shown_at_assistant_turn:l}),V.logEvent(G.conversationRatingSubmitted,{rating:k,showAtAssistantTurn:l,conversationId:o}),f(!0),setTimeout(()=>{x(!0)},1500)},2e3),[o,l]),j=C!==l||m||!F||!!n||i?.kind!==et.PrimaryAssistant||M||r;return d.useEffect(()=>{!j&&!a.current&&(V.logEvent(G.conversationRatingShown,{showAtAssistantTurn:l,conversationId:o}),a.current=!0)},[j]),M||j?null:e.jsxs("div",{className:"mx-auto",children:[e.jsx(gs,{children:y&&!v&&e.jsx(ae.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(Io,{$padded:!0,children:e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(P,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!y&&e.jsx(ae.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:e.jsxs(Io,{$padded:!1,children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-secondary",children:[e.jsx(P,{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(En,{$selected:g==="thumbsUp",onClick:()=>b("thumbsUp"),children:e.jsx(Ki,{className:"icon-md"})}),e.jsx(En,{$selected:g==="thumbsDown",onClick:()=>b("thumbsDown"),children:e.jsx(Yi,{className:"icon-md"})})]})]}),e.jsx("div",{className:"w-px flex-1 self-stretch bg-token-main-surface-tertiary"}),e.jsx(En,{className:"p-3",$selected:!1,onClick:()=>S(!0),children:e.jsx(Hh,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const En=Ce.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,Io=Ce.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`;function yp({clientThreadId:t,conversationLeafId:s,canShowInlineMessageFeedback:n,messageForRating:a,allGroupedMessages:o,currentModelId:i}){let r=null;return mu(t,s)?null:(a.rating&&n?r=e.jsx(Sp,{clientThreadId:t,conversationMessage:a,allGroupedMessages:o,currentModelId:i}):r=e.jsx("div",{className:"text-center",children:e.jsx(bp,{clientThreadId:t,conversationLeafId:s})}),e.jsx("div",{className:"mt-3 w-full empty:hidden",children:r}))}const Do=128;function wp(t){const{turnIndex:s,conversationLeafId:n,isFinalTurn:a,clientThreadId:o,onChangeItemInView:i,onChangeRating:r,currentModelId:l,avatarClassName:c,showAvatar:h=!0,scrollToMessageId:u}=t,m=te(),g=ra(),p=!!g&&fl(g),y=da(),f=Fi(Li.isBusinessWorkspace),v=Pt(),{value:x}=Re("2848981774"),M=Z.getServerThreadId(o),S=wt(Bn(o,s,n)),{messages:b,variantIds:C,variantsInStreamInfo:F}=S,N=$s(b),j=fu();let w=b[b.length-1];for(const W of N){const Te=vh(W);if(Te.some(Xe=>j.has(Xe.message.id))){w=Te[Te.length-1];break}}const k=b.slice(0,b.indexOf(w)+1),X=on(),[U,R]=d.useState(!1),[O,L]=d.useState(!1),E=C.findIndex(W=>k.some(Te=>Te.nodeId===W)),_=S.role===be.User,q=Ot(),$=He(o),K=fs(S.gizmoId??$)?.data,H=gu(),J=K&&H.includes(K.gizmo.id),we=Oi(l),me=pu(l),oe=Ye(),ie=dn(o,K?.gizmo.id),se=yi(o)===Vo.STREAMING,je=tn(),{value:Se}=Tt("1410082514"),{value:ke}=Tt("2291672486"),I=k.some(W=>W.message.content.content_type===At.MultimodalText),{layer:de}=Fe("1547743984"),Le=M&&X&&de.get("show_share_button_inline",!1),{isUnauthenticated:Me}=Ue(),[D,z]=d.useState(!1),[ue,he]=d.useState(!1),re=S.messages.map(W=>W.message.id),ne=d.useRef(null),Y=b[b.length-1],fe=Y.rating,ve=()=>{k.length===1&&(V.logEvent(G.editPrompt,{id:k[0].message.id,threadId:Z.getServerThreadId(o)}),ce.logEvent("chatgpt_edit_prompt"),R(!0))},pe=d.useCallback(()=>{R(!1)},[]),Ge=d.useCallback(W=>{Z.copyMessageToClipboard(o,s,v,W)},[o,s,v]),Q=W=>{r({nodeId:Y.nodeId,messageId:Y.message.id,rating:W}),V.logEvent(W==="thumbsDown"?G.messageFeedbackThumbsDownClicked:G.messageFeedbackThumbsUpClicked,{id:Y.message.id,threadId:Z.getServerThreadId(o),model:l,rating:W}),L(!0)},[Oe]=d.useState(()=>Date.now()),ee=d.useMemo(()=>Ks.getRequestIdFromConversationTurn(S),[S]),pt=wi({clientThreadId:o,conversationLeafId:n}),_e=ft(ee)&&!pt,vs=ua(),fn=$s(k),zt=d.useRef(!1);d.useEffect(()=>{if(!(zt.current||u==null||!x||!oe||!ne.current)&&(re.includes(u)||u==="finalAgentTurn"&&a)){if(zt.current=!0,u==="finalAgentTurn"&&a)ne.current.scrollIntoView({behavior:"instant",block:"end"});else{const W=ne.current.offsetHeight;let Te;W>Do?Te=Do-W:Te=0,ne.current.style.scrollMarginTop=`calc(${Te}px + 2px + var(--thread-leading-height))`,ne.current.scrollIntoView({behavior:"smooth"})}Z.updateScrollToMessageId(o,void 0)}},[u,ne.current]);const{showDebugConversationTurns:tt}=la(),Ut=Mi(o),Ie=Ai(o),st=xu({clientThreadId:o,conversationMode:ie}),gn=gt(o),nt=d.useCallback(({requestedModelId:W,systemMessage:Te,juice:Xe,extraStreamParams:Kt})=>{const As=new ls;st({id:Y.nodeId,eventMetadata:{eventSource:"mouse"},turnTracker:As,requestedModelId:W,systemMessage:Te,juice:Xe,extraStreamParams:Kt})},[Y,st]),Ht=Se&&k.some(W=>W.message.metadata?.snorkle_status!=null),Gt=!y&&!Ut&&!q&&!_,Wt=Su(),xt=w.message.author.role===be.Assistant?w.message:null;vu({isCompletionRequestInProgress:_e,isUserTurn:_,message:xt});const bs=bu(o,C),at=yu(ie),qe=!Wt&&!at&&Gt&&a&&F?.num_variants_in_stream===2&&!Y.inlineComparisonRating&&!bs,ys=wu(S),St=qe,pn=qe&&!ys,ot=!_&&!y&&!Ut&&!at&&!se&&!_e,Vt=ot&&(!f||Ht||me||p)&&!at&&!Me&&!q,it=!y&&!((_e||se)&&a)&&C.length>1&&!U&&!St;let rt=!1;if(_&&k.length===1){const{shouldHideContent:W}=xa(k[0]);W&&(rt=!0)}const xn=_&&!at&&!y&&!I&&k.length===1&&!rt&&!U&&!Me,ws=W=>{i(C[W]),V.logEvent(G.changeNode,{intent:"toggle_between"})};if(!(S.role===be.Root?!1:S.role===be.System||S.role===be.Developer||k.every(W=>W.message.metadata?.is_visually_hidden_from_conversation)?tt:!0)&&!St)return null;const Ee=k.some(({message:W})=>Ri.getAssetPointers(W).length>0),$t=!Ee&&a&&Ie&&!ke?e.jsx(es,{onClick:()=>{ce.logEvent("chatgpt_regenerate_try_again_button_clicked",l,{requestedModelId:l,...Je({clientThreadId:o,turnIndex:s})});const W=new ls;st({id:gn,eventMetadata:{eventSource:"mouse"},turnTracker:W}),rs()},icon:un,label:m.formatMessage({id:"ConversationTurn.regenerateTooltip",defaultMessage:"Regenerate"}),testId:"regenerate-turn-action-button"}):null,js="h-[30px] rounded-md px-1 text-token-text-secondary hover:bg-token-main-surface-secondary",vn=!Ee&&ke?e.jsx(tp,{className:js,clientThreadId:o,message:Y,onModelSelect:nt,onDropdownChange:z,canRegenerateResponse:Ie}):null,Ms=!_&&!rt&&(!a||!_e)?e.jsx(Eu,{onClick:Ge}):null,Cs=!_&&(!a||!_e)&&(Y.disclaimers??[]).length===0&&Y.nodeId?e.jsx(Yg,{conversationId:o,message:Y,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-xs text-token-text-tertiary hover:text-token-text-primary"}):null,vt=!_&&Y&&(!a||!_e)?e.jsx(Nu,{message:Y,isFinalTurn:a,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-token-text-tertiary hover:text-token-text-primary"}):null,bn=Vt&&!_e?e.jsxs("div",{className:"flex",children:[!je?.includes(mt.ThumbsDownOnly)&&fe!=="thumbsDown"&&e.jsx(es,{onClick:()=>Q("thumbsUp"),disabled:fe==="thumbsUp",icon:fe==="thumbsUp"?Gh:Ki,label:m.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"},`thumbsUp:${Y.nodeId}`),fe!=="thumbsUp"&&e.jsx(es,{onClick:()=>Q("thumbsDown"),disabled:fe==="thumbsDown",icon:fe==="thumbsDown"?Wh:Yi,label:m.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"},`thumbsDown:${Y.nodeId}`)]}):null,yn=Le&&e.jsx(es,{onClick:()=>{cs.openSharingModal(M)},label:m.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:Vh}),ks=!ke&&e.jsx(Ug,{className:js,clientThreadId:o,message:Y,onModelSelect:nt,onDropdownChange:z});function _s(W){return oe?W:e.jsx(ma,{clientThreadId:o,isStaticSharedThread:y,withVerticalPadding:!0,withHorizontalPadding:!St,children:W})}function lt(W){return oe?W:e.jsx(ds,{children:W})}const Ts=u!=="finalAgentTurn"&&a&&x&&oe;return e.jsxs("article",{className:T("w-full scroll-mb-[var(--thread-trailing-height)] text-token-text-primary focus-visible:outline-2 focus-visible:outline-offset-[-4px]",Ts?"min-h-[calc(100cqh-var(--thread-leading-height)-var(--thread-trailing-height)-100px)]":""),ref:ne,dir:"auto","data-testid":`conversation-turn-${s}`,"data-scroll-anchor":a,onMouseEnter:()=>he(!0),onMouseLeave:()=>he(!1),children:[e.jsx(ju,{role:S.role}),_s(e.jsx(e.Fragment,{children:St?e.jsx(dp,{isFeedbackEnabled:Vt,variantIds:C,variantsInStreamInfo:F,conversationTurnMountTime:Oe,stubSideBySideFeedback:pn,...t}):lt(e.jsxs(e.Fragment,{children:[!_&&h&&e.jsx(Mp,{children:e.jsx(zn,{messages:k,isUserTurn:_,avatarClassName:c,gizmo:K})}),e.jsx("div",{className:T("group/conversation-turn relative flex w-full min-w-0 flex-col",!_&&Mu),children:e.jsx("div",{className:"flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[!_&&!y&&e.jsx(Qn,{messages:k,clientThreadId:o,gizmoId:K?.gizmo.id}),e.jsx(Gn,{groupedMessagesToRender:fn,allGroupedMessages:N,...t,isEditing:U,isUserTurn:_,isCompletionRequestInProgress:_e,isFeedbackEnabled:Vt,isFinalTurn:a,hasActiveRequest:vs,showEditButton:xn,handleEnterEdit:ve,handleExitEdit:pe}),J&&e.jsx("div",{className:"mb-4",children:e.jsx(Cu,{messages:k})}),we&&e.jsx("div",{className:"mb-4",children:e.jsx(ku,{messages:k})}),(ot||it)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:T("mb-2 flex gap-3 empty:hidden",_?"mr-1 flex-row-reverse":"-ml-2"),children:e.jsx(_u,{alwaysShow:a,showInline:a||it,isHovered:ue||D,pagination:it&&e.jsx(Tu,{showInline:a||it,currentPage:E,onChangeIndex:ws,length:C.length,className:T("self-center",C.length>1?"visible":"!invisible")}),actions:ot&&e.jsxs(e.Fragment,{children:[Cs,Ms,$t,bn,vt,ks,yn,vn]})})}),ot&&!_e?e.jsx("div",{className:"pr-2 lg:pr-0",children:e.jsx(Au,{message:Y,isFinalTurn:a})}):null,a&&!_e&&e.jsx(yp,{canShowInlineMessageFeedback:O,clientThreadId:o,conversationLeafId:n,messageForRating:Y,allGroupedMessages:N,currentModelId:l})]})]})})})]}))}))]})}const jp=Ko.memo(wp),Mp=Ce.div`flex-shrink-0 flex flex-col relative items-end`,Cp=3;function kp({onChangeItemInView:t,onRequestMoreCompletions:s,onChangeRating:n,onRequestCompletion:a,clientThreadId:o,conversationLeafId:i,hideHeader:r}){const l=Pe(),c=Bi(),h=Ru(),[u]=Pu(),m=Iu(),[g]=Du(),p=dn(o),y=Lt(),f=pa(o),v=Fu(o),x=l.store.useContentAreaDimensions(Et.Header,H=>H?.height?H.height:void 0),M=l.store.useIsHeaderContentAreaPopulated(),S=zi(o),{isArchived:b}=S,C=Lu(f.id),F=p?.kind===et.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":C,N=Ui(o,i),j=oi(),[w,k]=d.useState(0),[X,U]=d.useState(!1);d.useEffect(()=>{c&&(w===0?k(N):!X&&N>w&&(U(!0),ce.logEvent("chatgpt_continue_conversation_first_message_sent"),V.logEvent(G.continueConversationFirstMessageSent)))},[N,w,X,c]),c&&(ce.logEvent("chatgpt_continue_conversation_page_loaded"),V.logEvent(G.continueConversationPageLoaded));const R=d.useCallback(()=>{h({behavior:"smooth"})},[h]),O=Ou(o),L=j&&!b,E=(H,J,we,me)=>(me&&(H=H+Cp),[...new Array(J-H).keys()].map(oe=>{const ie=oe+H;return e.jsx(jp,{isFinalTurn:we(ie),turnIndex:ie,clientThreadId:o,conversationLeafId:i,onChangeItemInView:t,onChangeRating:n,onRequestMoreCompletions:s,onRequestCompletion:a,currentModelId:f.id,avatarClassName:F,scrollToBottom:R},ie)})),{layer:_}=Fe("4031588851"),q=_.get("enable_hardcoded_onboarding_prompt",!1),[$,K]=d.useState(!1);return d.useEffect(()=>{if(!q)return;const H=Z.getTree(o),J=H.getChildrenFromNode("root")[0],me=H.getChildrenFromNode(J.id)[0].message.author.metadata?.is_system_initiated_conversation===!0;K(me)},[i,N,a,o,q]),e.jsxs("div",{onCopy:O,className:T("flex flex-col text-sm",L&&"pb-[120px]",x||L?null:"md:pb-9"),style:{paddingBottom:L?void 0:x},children:[!r&&y?.data&&e.jsx(xr,{clientThreadId:o}),c&&e.jsxs(e.Fragment,{children:[e.jsx(ds,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(P,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),N-w===0&&e.jsx("div",{className:"text-center text-xs font-semibold text-token-text-primary",children:e.jsx("button",{onClick:()=>{cs.openModal(Ii.ReportConversation),ce.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),V.logEvent(G.sharedConversationReportContentClicked,{location:"Dynamic Shared Thread Page"})},children:e.jsx(P,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})}),E(0,w,H=>H===w-1),e.jsx(ds,{children:e.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(qh,{className:"icon-xs mr-2"}),e.jsx(P,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})}),E(w,N,H=>H===N-1)]}),!c&&E(0,N,H=>H===N-1,$),v&&u&&!g&&e.jsx(Fo,{className:T("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{ce.logEvent("chatgpt_thread_scroll_to_top"),m({behavior:"smooth"})},children:e.jsx($h,{className:"icon-md text-token-text-primary"})}),!u&&e.jsx(Fo,{className:T(x?null:"bottom-5",L?M?"translate-y-[-50px]":"translate-y-[-10px]":""),style:{bottom:j?"calc(var(--composer-bar_footer-current-height) + var(--composer-bar_current-height))":x},onClick:()=>{ce.logEvent("chatgpt_thread_scroll_to_bottom"),h({behavior:"smooth"})},children:e.jsx(Kh,{className:"icon-md text-token-text-primary"})})]})}const Fo=Ce.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-light right-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`,_p=60,Tp=({children:t,scrollViewClassName:s,scrollAnchorTopOffset:n=0})=>{const a=d.useRef(null);return e.jsx("div",{className:"h-full",ref:a,children:e.jsx(gl,{children:e.jsx(cm,{className:"h-full",followButtonClassName:"hidden",initialScrollBehavior:"auto",scrollViewClassName:s,scroller:()=>Ap(a,n)?0:1/0,children:t})})})},Ap=(t,s)=>{const n=Ep(t.current);if(n==null)return!1;const a=n>s,o=n<s-_p;return!a&&!o};function Ep(t){if(!t)return null;const s=t.querySelector('[data-scroll-anchor="true"]');if(!s)return null;const n=s.getBoundingClientRect().top,a=t.getBoundingClientRect().top;return n-a}const Np=It(()=>Dt(()=>import("./f4xnb11wh0qh5f0h.js"),__vite__mapDeps([54,1,2,3,4,5,31,32,33,34,55])).then(t=>t.OpenDebugSidebarButton)),Rp=It(()=>Dt(()=>import("./fneqbskgc01naoiq.js"),__vite__mapDeps([56,1,2,3,4,5,11]))),Pp=It(()=>Dt(()=>import("./sso-oqylhbcvl45iyt6z.js").then(t=>t.e),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44])).catch(()=>()=>null)),Lo=ye({doNotShareSensitive:{id:"thread.modal.onboarding.title",defaultMessage:"Do not share sensitive materials with this application"},somethingWentWrong:{id:"thread.modal.unrecoverableError.title",defaultMessage:"Something went wrong"},tryAgainLater:{id:"thread.modal.unrecoverableError.description",defaultMessage:"We're sorry, but something went wrong. Please try again later."},resetThread:{id:"thread.modal.unrecoverableError.resetThread",defaultMessage:"Reset thread"},sharedConversationReportConversation:{id:"thread.sharedConversation.report",defaultMessage:"Report conversation"},latencyButton:{id:"thread.latencyButton",defaultMessage:"Latency"},archivedConversationDescription:{id:"thread.archivedConversationDescription",defaultMessage:"This conversation is archived. To continue, please unarchive it first."},unarchiveButton:{id:"thread.unarchiveButton",defaultMessage:"Unarchive"}});function Ip({clientThreadId:t}){const s=qo(),n=Bt(t),a=async()=>{n&&(await Ke.patchConversation(n,{is_archived:!1}),s.invalidateQueries({queryKey:["conversation",t]}),ha.setState(o=>{const i=o.threads[n];i!=null&&(i.initialThreadData.isArchived=!1)}),oh(s))};return e.jsxs("div",{className:"my-6 flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"px-3 text-center text-sm text-token-text-secondary",children:e.jsx(P,{...Lo.archivedConversationDescription})}),e.jsx("div",{children:e.jsx(Ve,{disabled:!n,onClick:a,icon:Yh,children:e.jsx(P,{...Lo.unarchiveButton})})})]})}const ex=function({clientThreadId:t,onCompletionFinished:s,onCreate:n,preRequestCompletion:a,hideHeader:o,hideMessages:i,hideFooter:r,hideToolsOverlay:l,messagesVerticalAlign:c="top",prependThreadChildren:h,renderEmptyState:u,prefetchSearch:m}){const g=Lt(),p=tn(),y=mi(t),f=fa(t),v=gt(t),M=zi(t).isArchived;d.useEffect(()=>{f||(Bs(t)?Pn.addTiming("chatgpt.web.chatPage.renderNewConversation"):Pn.addTiming("chatgpt.web.chatPage.renderExistingConversation"))},[t,f]);const S=Bu(t,v),b=Ui(t,v),{setTargetedContent:C}=pi(),F=p?.includes(pl),N=zu(),j=b>=2;fi(j);const w=Bs(t)&&!j&&kn(y),k=Bs(t)&&!S&&(kn(y)||y?.kind===et.GizmoTest),U=gi().id,R=Uu(t),O=R??U,L=!!R,E=Oi(O),q=hi()[O],$=Hu(t,y),K=oa();Gu(b,t,v,w),d.useEffect(()=>{xi()},[]),d.useEffect(()=>{K||C(void 0)},[t,C,K,v]);const{caModal:H,onRequestCompletion:J,onChangeItemInView:we,onChangeRating:me,onRequestMoreCompletions:oe}=Jh({clientThreadId:t,currentModelId:O,defaultModelId:U,onCompletionFinished:s,onThreadCreated:n,preRequestCompletion:a}),{isUnauthenticated:ie,isLoading:Ae}=Ue(),se=!!g?.features.includes(mt.SharedWebsocket);d.useEffect(()=>{se&&zs.registerIfNotConnected()},[se]),d.useEffect(()=>{const ee=()=>{if(document.visibilityState==="visible"){if(!se)return;zs.registerIfNotConnected()}};return document.addEventListener("visibilitychange",ee),()=>{document.removeEventListener("visibilitychange",ee)}},[se]);const je=Bt(t);d.useEffect(()=>{const ee=()=>{zs.stopConversation(je)};return window.addEventListener("beforeunload",ee),()=>{window.removeEventListener("beforeunload",ee)}},[je]);const Se=Wu({clientThreadId:t,currentLeafId:v,handleRequestCompletion:J,prefetchSearchPromise:m});Vu({clientThreadId:t,currentModelId:O});const ke=ee=>e.jsx(Tp,{scrollAnchorTopOffset:o?0:ah,children:c==="bottom"?e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex-1"}),ee]}):ee});d.useEffect(()=>{document.title=$??"ChatGPT"},[$]);const I=He(t),de=Ot(),Le=xl(),Me=k&&!Le&&!u&&!I&&!E&&!de,D=Me&&!Ae&&ie,z=Me&&!Ae&&!ie,ue=og(D),he=rg(z),re=D&&ue||z&&he,ne=Bi(),Y=qu(),{reset:fe,streamingContext:ve,StreamingProvider:pe}=$u();d.useEffect(()=>{Y&&(ve.setOnResetContext=()=>{fe()})},[Y,fe,ve]);const Ge=d.useRef(null),Q=d.useRef(null),Oe=d.useMemo(()=>({threadContentScrollContainerElementRef:Ge,footerRootContainerElementRef:Q}),[]);return e.jsx(Ku,{clientThreadId:t,currentLeafId:v,children:e.jsxs(pe,{value:ve,children:[F&&e.jsx(Rp,{}),e.jsx(Yu,{children:$!=null&&e.jsx("title",{children:$})}),y?.kind===et.GizmoInteraction&&y.gizmo&&e.jsx(Xu,{gizmo:y.gizmo}),e.jsx(Qu.Provider,{value:J,children:e.jsxs(Zu,{children:[e.jsxs(Ju,{clientThreadId:t,currentModelConfig:q,className:"composer-parent flex h-full flex-col focus-visible:outline-0",children:[!i&&e.jsx(eh,{value:Oe,children:e.jsx(Dp,{ref:Ge,children:!f&&!Se?k?u??e.jsx(Fg,{clientThreadId:t,currentModelId:O,isModelLoaded:L,onRequestCompletion:J,enableV2Homepage:re,v2HomepageDisclaimer:re&&e.jsx(Xa,{clientThreadId:t})}):j?ke(e.jsxs(e.Fragment,{children:[h,e.jsx(kp,{onChangeItemInView:we,onRequestMoreCompletions:oe,onChangeRating:me,onRequestCompletion:J,clientThreadId:t,conversationLeafId:v,hideHeader:o},t)]})):null:null})}),e.jsx(Fp,{ref:Q,children:M?e.jsx(Ip,{clientThreadId:t}):e.jsxs("div",{children:[!re&&e.jsx(sg,{clientThreadId:t,isNewThread:w,showPromptStarters:w||!S,currentModelId:O,onRequestCompletion:J}),!r&&e.jsx("div",{className:"relative w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",children:kn(y)&&!re&&e.jsx("div",{className:"min-h-4",children:e.jsx(Xa,{clientThreadId:t})})})]})})]}),!l&&e.jsxs("div",{className:"group absolute bottom-2 end-2 z-20 hidden gap-1 md:flex lg:bottom-3 lg:end-3",children:[N?e.jsxs(e.Fragment,{children:[e.jsx(Np,{}),e.jsx(Pp,{})]}):null,e.jsx(rm,{})]}),H,e.jsx(th,{clientThreadId:t,isStaticSharedThread:!1,isDynamicSharedThread:ne}),e.jsx(sh,{}),e.jsx(nh,{conversationId:t,currentModelId:O,isActiveWindow:!Le})]})})]})})},Dp=Ce.div`grow flex-1 overflow-hidden`,Fp=Ce.div`md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent w-full`;export{jp as C,Fg as E,po as G,lg as S,ex as T,Tp as W,sg as a,Ag as b,Ng as c,Qp as d};
//# sourceMappingURL=lpjpyyuiyqso3n9d.js.map
