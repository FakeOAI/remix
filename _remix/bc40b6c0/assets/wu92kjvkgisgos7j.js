import{H as C,j as e,K as l,r as y,bt as p,a2 as u,ay as K,a7 as D,c as T,I as Q,aQ as b,u as E,E as g,F as j,a_ as $}from"./cq30atfn4hkan4n6.js";import{L as O,be as i,aM as z,aw as S}from"./kuzyui3g7be29dp4.js";import{$ as I}from"./es6nenweunimzkf7.js";import{g as Y,f as W,d as J,e as V}from"./makqaeb48udiz0p1.js";import{F as X}from"./lbhbqlrnc8bwcq3y.js";function Z({setEnabled:t,isLoading:n,isEnabled:c}){const s=C();return e.jsxs("div",{className:"flex flex-row content-center items-center justify-items-center",children:[e.jsx(O,{disabled:n,enabled:c,onChange:t,label:s.formatMessage(i.sendInviteEmailsLabel)}),e.jsx(I,{className:"ml-2",children:e.jsx(l,{...i.sendInviteEmailsLabel})})]})}function ee({setEnabled:t,isLoading:n,isEnabled:c}){const s=C(),[a,r]=y.useState(!1),o=()=>{r(!0)},d=v=>{r(!1),v&&t(!1)};return e.jsx("div",{className:"pt-1.5",children:c?e.jsxs(e.Fragment,{children:[e.jsx(p,{disabled:n,color:"danger",onClick:()=>{n||o()},children:e.jsx(l,{...i.deleteDirectorySyncConnectionButton})}),e.jsx(z,{title:s.formatMessage(i.deleteDirectorySyncConnectionModalHeader),description:s.formatMessage(i.deleteDirectorySyncConnectionModalExplanation),confirmText:s.formatMessage(i.deleteDirectorySyncConnectionModalConfirmButton),cancelText:s.formatMessage(i.deleteDirectorySyncConnectionModalCancelButton),isOpen:a,primaryButtonColor:"danger",onClose:()=>d(!1),onConfirm:()=>d(!0)})]}):e.jsx(e.Fragment,{children:e.jsx(p,{disabled:n,color:"primary",onClick:()=>{n||t(!0)},children:e.jsx(l,{...i.enableDirectorySyncButton})})})})}class m{static async getWorkspaceDirectorySyncSettings(n){return u.safeGet("/accounts/{account_id}/scim",{parameters:{path:{account_id:n}}})}static async setWorkspaceDirectorySyncEnabled(n,c){return u.safePost("/accounts/{account_id}/scim/set_enabled",{parameters:{path:{account_id:n}},requestBody:{enabled:c}})}static async setWorkspaceDirectorySyncEmailInvitesEnabled(n,c){return u.safePost("/accounts/{account_id}/scim/set_email_invites_enabled",{parameters:{path:{account_id:n}},requestBody:{enabled:c}})}static async getWorkspaceDirectorySyncPortalUrl(n){return u.safeGet("/accounts/{account_id}/scim/portal_link",{parameters:{path:{account_id:n}}})}static async getWorkspaceDirectorySyncFailedEvents(n){return u.safeGet("/accounts/{account_id}/scim/failed_events",{parameters:{path:{account_id:n}}})}static async retryWorkspaceDirectorySyncFailedEvent(n,c){return u.safePost("/accounts/{account_id}/scim/failed_events/{event_id}/retry",{parameters:{path:{account_id:n,event_id:c}},requestBody:{}})}static async retryAllWorkspaceDirectorySyncFailedEvents(n){return u.safePost("/accounts/{account_id}/scim/failed_events/retry_all",{parameters:{path:{account_id:n}},requestBody:{}})}static async discardWorkspaceDirectorySyncFailedEvent(n,c){return u.delete(`${K}/accounts/${n}/scim/failed_events/${c}`)}static async getWorkspaceDirectorySyncProgressUsers(n){return u.safeGet("/accounts/{account_id}/scim/sync_progress_users",{parameters:{path:{account_id:n}}})}static async getWorkspaceDirectorySyncProgressGroups(n){return u.safeGet("/accounts/{account_id}/scim/sync_progress_groups",{parameters:{path:{account_id:n}}})}}function te({isLoading:t,workspaceId:n,isDirectoryConnectionConfigured:c}){const[s,a]=y.useState(!1),r=async()=>{try{a(!0);const o=await m.getWorkspaceDirectorySyncPortalUrl(n);a(!1),o!=null&&o.portal_link?window.open(o.portal_link,"_blank"):D.danger("Portal link not found.")}catch(o){o instanceof Error?D.danger(o.message):D.danger("An unexpected error occurred.")}};return e.jsxs(p,{disabled:t||s,color:"secondary",className:"mt-3",onClick:r,children:[c?e.jsx(l,{...i.launchDirectorySyncManagementPortalText}):e.jsx(l,{...i.launchDirectorySyncSetupPortalText}),e.jsx(X,{className:"icon-sm ml-1"})]})}function N({percentage:t,height:n=10,className:c,backgroundClassName:s="bg-gray-400",transitionDuration:a,transitionTimingFunction:r,onTransitionEnd:o}){return e.jsxs("div",{className:T("relative w-full",c),style:{height:n},children:[e.jsx("div",{className:T("absolute left-0 top-0 h-full w-full",s)}),e.jsx("div",{className:"absolute left-0 top-0 h-full bg-current transition-[width]",style:{width:`${Math.max(Math.min(t,100),0)}%`,transitionDuration:a,transitionTimingFunction:r},onTransitionEnd:o})]})}function q(t){switch(t){case"dsync.user.created":return i.directorySyncEventTypeUserCreated;case"dsync.user.updated":return i.directorySyncEventTypeUserUpdated;case"dsync.user.deleted":return i.directorySyncEventTypeUserDeleted;case"dsync.group.created":return i.directorySyncEventTypeGroupCreated;case"dsync.group.updated":return i.directorySyncEventTypeGroupUpdated;case"dsync.group.deleted":return i.directorySyncEventTypeGroupDeleted;case"dsync.group.user_added":return i.directorySyncEventTypeGroupUserAdded;case"dsync.group.user_removed":return i.directorySyncEventTypeGroupUserRemoved;case"dsync.activated":return i.directorySyncEventTypeActivated;case"dsync.deleted":return i.directorySyncEventTypeDeleted;case"dsync.deactivated":return i.directorySyncEventTypeDeleted}}function ne({isLoading:t,failedEvents:n,retryEventWithId:c,retryAllFailedEvents:s,discardFailedEventWithId:a}){const[r,o]=y.useState(!1),[d,v]=y.useState(),h=C();return e.jsxs(e.Fragment,{children:[d&&e.jsx(Q,{isOpen:r,onClose:o,title:h.formatMessage(q(d.event.event)),description:d.failure_reason,type:"success",showCloseButton:!0,isScrollable:!0,children:e.jsx("pre",{children:JSON.stringify(d.event,null,2)})}),n.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(Y,{className:"flex items-center space-x-4",children:[e.jsx(l,{...i.failedDirectorySyncEventsTableHeader}),e.jsx(p,{disabled:t,color:"secondary",size:"small",className:"ml-auto",onClick:()=>{s()},children:e.jsx(l,{...i.retryAllFailedDirectorySyncEventsButton})})]}),e.jsxs(S.Root,{className:"w-full table-auto",children:[e.jsxs(S.Header,{children:[e.jsx(S.HeaderCell,{className:"bg-token-main-surface-primary",children:e.jsx(l,{...i.directorySyncEventsTableFailureEventTypeColumnHeader})}),e.jsx(S.HeaderCell,{className:"bg-token-main-surface-primary",children:e.jsx(l,{...i.directorySyncEventsTableFailureReasonColumnHeader})}),e.jsx(S.HeaderCell,{className:"bg-token-main-surface-primary",children:e.jsx(l,{...i.directorySyncEventsTableActionsColumnHeader})})]}),e.jsx(S.Body,{children:n.map((f,k)=>e.jsxs("tr",{children:[e.jsx(S.Cell,{children:e.jsx(l,{...q(f.event.event)})}),e.jsx(S.Cell,{children:f.failure_reason}),e.jsxs(S.Cell,{children:[e.jsx("div",{children:e.jsx(p,{disabled:t,color:"secondary",size:"small",onClick:()=>{v(f),o(!0)},children:e.jsx(l,{...i.showEventDirectorySyncEventButton})})}),e.jsx("div",{className:"ml-2",children:e.jsx(p,{disabled:t,color:"secondary",size:"small",onClick:()=>{c(f.event.id)},children:e.jsx(l,{...i.retryDirectorySyncEventButton})})}),e.jsx("div",{className:"ml-2",children:a&&e.jsx(p,{disabled:t,color:"secondary",size:"small",onClick:()=>{a(f.event.id)},children:e.jsx(l,{...i.discardDirectorySyncEventButton})})})]})]},f.event.id))})]})]})]})}function se({isLoading:t,numUsersSynced:n,numUsersInDirectory:c,numGroupsSynced:s,numGroupsInDirectory:a,failedEvents:r,retryEventWithId:o,retryAllFailedEvents:d,discardFailedEventWithId:v}){const{value:h}=b("2091463435");return e.jsxs(e.Fragment,{children:[e.jsxs(W,{className:"my-2",children:[e.jsxs("div",{children:[e.jsx(l,{...i.directorySyncUserSyncStatus,values:{numUsersSynced:n,numUsersInDirectory:c}}),e.jsx(N,{percentage:n/(c||1)*100})]}),e.jsx("div",{className:"mt-4",children:h&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx(l,{...i.directorySyncGroupSyncStatus,values:{numGroupsSynced:s,numGroupsInDirectory:a}})}),e.jsx(N,{percentage:s/(a||1)*100})]})})]}),e.jsx("div",{className:"mt-4",children:e.jsx(ne,{isLoading:t,failedEvents:r,retryEventWithId:o,retryAllFailedEvents:d,discardFailedEventWithId:v})})]})}const _=2e3;function F(t,n){const[c,s]=y.useState(!1),{data:a,...r}=E({queryKey:["workspace/directorySync",t],queryFn:async()=>{if(t!==void 0)return await m.getWorkspaceDirectorySyncSettings(t)},enabled:!!t,refetchInterval:n&&c?_:!1});return y.useEffect(()=>{a!=null&&a.enabled&&(a==null?void 0:a.directory_connection)==null?s(!0):s(!1)},[a]),{data:a,...r}}function M(t,n){const[c,s]=y.useState(!1),{data:a}=F(t,n),{data:r,...o}=E({queryKey:["workspace/directorySyncStatus/progressUsers","workspace/directorySync",t],queryFn:async()=>{if(t!==void 0)return await m.getWorkspaceDirectorySyncProgressUsers(t)},enabled:!!t&&!!(a!=null&&a.directory_connection),refetchInterval:c?_:!1});return y.useEffect(()=>{(r==null?void 0:r.synced_scim_users)===0||(r==null?void 0:r.synced_scim_users)!==(r==null?void 0:r.total_scim_users)?s(!0):s(!1)},[r,a==null?void 0:a.directory_connection]),{isLoadingUsers:c,data:r,...o}}function re(t,n){const[c,s]=y.useState(!1),{data:a}=F(t,n),{data:r,...o}=E({queryKey:["workspace/directorySyncStatus/progressGroups","workspace/directorySync",t],queryFn:async()=>{if(t!==void 0)return await m.getWorkspaceDirectorySyncProgressGroups(t)},enabled:!!t&&!!(a!=null&&a.directory_connection),refetchInterval:n&&c?_:!1});return y.useEffect(()=>{(r==null?void 0:r.synced_scim_groups)===0||(r==null?void 0:r.synced_scim_groups)!==(r==null?void 0:r.total_scim_groups)?s(!0):s(!1)},[r,a==null?void 0:a.directory_connection]),{isLoadingGroups:c,data:r,...o}}function ce(t,n){const{isLoadingUsers:c}=M(t,n);return E({queryKey:["workspace/directorySyncStatus/failedEvents","workspace/directorySync",t],queryFn:async()=>{if(t!==void 0)return await m.getWorkspaceDirectorySyncFailedEvents(t)},enabled:!!t,refetchInterval:c?_:!1})}function ae(t){const n=g();return j({mutationFn:c=>m.retryWorkspaceDirectorySyncFailedEvent(t,c),onSuccess:()=>{n.refetchQueries({queryKey:["workspace/directorySyncStatus/failedEvents","workspace/directorySyncStatus/progressUsers","workspace/directorySyncStatus/progressGroups"]})}})}function ie(t){const n=g();return j({mutationFn:()=>m.retryAllWorkspaceDirectorySyncFailedEvents(t),onSuccess:()=>{n.refetchQueries({queryKey:["workspace/directorySyncStatus/failedEvents","workspace/directorySyncStatus/progressUsers","workspace/directorySyncStatus/progressGroups"]})}})}function oe(t){const n=g();return j({mutationFn:c=>m.discardWorkspaceDirectorySyncFailedEvent(t,c),onSuccess:()=>{n.refetchQueries({queryKey:["workspace/directorySyncStatus/failedEvents"]})}})}function le(t){const n=g();return j({mutationFn:c=>m.setWorkspaceDirectorySyncEnabled(t,c),onSuccess:()=>{n.refetchQueries({queryKey:["workspace/directorySync",t]})}})}function de(t){const n=g();return j({mutationFn:c=>m.setWorkspaceDirectorySyncEmailInvitesEnabled(t,c),onSuccess:()=>{n.refetchQueries({queryKey:["workspace/directorySync",t]})}})}function ve({workspaceId:t}){const{value:n}=b("2091463435"),{value:c}=b("2494375100"),{data:s,isLoading:a}=F(t,!0),{data:r,isLoading:o}=M(t,!0),{data:d,isLoading:v}=re(t,n),{data:h,isLoading:f}=ce(t,!0),{mutateAsync:k,status:A}=le(t),{mutateAsync:P,status:B}=ae(t),{mutateAsync:L,status:G}=ie(t),{mutateAsync:R,status:H}=oe(t),{mutateAsync:U,status:w}=de(t),x=A==="pending"||B==="pending"||G==="pending"||H==="pending"||w=="pending"||a||o||v||f;return e.jsxs(J,{className:`${x?"text-token-text-secondary":""}`,children:[e.jsx(V,{children:e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{children:e.jsx(l,{...i.directorySyncTitle})}),e.jsx("div",{className:"ml-2 mt-1",children:x&&e.jsx($,{})})]})}),e.jsx(W,{children:e.jsx(l,{...i.directorySyncInfoText})}),(s==null?void 0:s.directory_connection)&&e.jsx("div",{children:e.jsx(se,{isLoading:x,numUsersSynced:(r==null?void 0:r.synced_scim_users)??0,numUsersInDirectory:(r==null?void 0:r.total_scim_users)??0,numGroupsSynced:(d==null?void 0:d.synced_scim_groups)??0,numGroupsInDirectory:(d==null?void 0:d.total_scim_groups)??0,failedEvents:h??[],retryEventWithId:P,retryAllFailedEvents:L,discardFailedEventWithId:R})}),c&&(s==null?void 0:s.enabled)&&e.jsx("div",{children:e.jsx(Z,{setEnabled:U,isLoading:x,isEnabled:(s==null?void 0:s.send_user_invite_emails)??!1})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(ee,{setEnabled:k,isLoading:x,isEnabled:(s==null?void 0:s.enabled)??!0}),(s==null?void 0:s.enabled)&&e.jsx(e.Fragment,{children:e.jsx(te,{isLoading:x,workspaceId:t,isDirectoryConnectionConfigured:!!(s!=null&&s.directory_connection)})})]})]})}export{ve as DirectorySyncSection};
//# sourceMappingURL=wu92kjvkgisgos7j.js.map
