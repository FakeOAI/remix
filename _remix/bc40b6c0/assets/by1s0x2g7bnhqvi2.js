import{j as e,cM as C,K as x,r as d,P as p,A as f,H as k,a8 as R,cf as _,bE as E,Y as A,O as h,I as T,c as F,bz as L,N as D}from"./cq30atfn4hkan4n6.js";import{E as P,p as U,F as z,d as q,m as G}from"./9wq3vd0xhzl7ebfo.js";import{g as w}from"./kqwdyvkaaavvn8k3.js";import{u as N}from"./jfo3qlqw9djlk9p8.js";import{b as I}from"./dcxduu1ov9wrqx9z.js";import{bH as H,bG as B,gl as O,gm as V,bE as Q,bJ as Y,gn as $,go as c,gp as j,A as J}from"./kuzyui3g7be29dp4.js";import{aY as K}from"./lbhbqlrnc8bwcq3y.js";import{S as Z,a as W}from"./k2ik9pc6spo439r1.js";import{m as v}from"./irpjl7r7vpd0tpvx.js";import"./m9u9x9zfxse2n76r.js";import"./kxnoie2q7a08rba4.js";function M({children:t}){return e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 text-sm font-semibold text-token-text-tertiary",children:[e.jsx(K,{className:"icon-2xl"}),t]})})}const X=({images:t,analyticsMetadata:s})=>{const r=t.map(a=>a.thumbnail_url),n=C({queries:r.map(a=>P(a)),combine:a=>{const o=new Set;return a.forEach((l,i)=>{l.isError&&o.add(r[i])}),o}});return e.jsx(e.Fragment,{children:(t==null?void 0:t.length)>0?e.jsx("div",{className:"columns-1 gap-2 px-6 py-4 xs:columns-2 md:columns-3",children:t.map((a,o)=>!n.has(a.thumbnail_url)&&e.jsx("div",{className:"relative mb-0.5 break-inside-avoid",children:e.jsx(ee,{image:a,analyticsMetadata:s})},o))}):e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(M,{children:e.jsx(x,{id:"AbVGAw",defaultMessage:"No Results"})})})})},ee=({image:t,analyticsMetadata:s})=>{const r=N(t.url).data??w(t.url,"short"),{isSuccess:n}=U(t==null?void 0:t.thumbnail_url),a={...I(s),url:t.url,title:t.title};return d.useEffect(()=>{p.logEvent(f.searchSidebarImageShown,a)},[]),e.jsx("button",{onClick:()=>{p.logEvent(f.searchSidebarImageClicked,a),H.setCurrentImage(t?{image:t,source:B.ImagesTab,turnIndex:s.turnIndex}:void 0)},children:n?e.jsxs("div",{className:"group relative h-full w-full",children:[e.jsx("img",{src:t.thumbnail_url,alt:t.content_url,className:"w-full rounded-lg hover:opacity-100 group-hover:opacity-90"}),e.jsx("div",{className:"absolute bottom-1 left-1 max-w-[75%] truncate rounded-xl bg-black/40 px-2 py-1 text-xs font-medium text-white backdrop-blur-sm",children:r})]}):e.jsx("div",{className:"aspect-square h-full w-full animate-pulse bg-token-main-surface-tertiary"})})};function te({date:t}){const s=k(),r=t instanceof Date?t:new Date(t*1e3),n=O(r,new Date);if(n<4&&n>-4){const a=s.formatRelativeTime(n,"day",{numeric:"auto"});return a.charAt(0).toUpperCase()+a.slice(1)}else return s.formatDate(r,{year:"numeric",month:"long",day:"numeric"})}var se=_,ae=R,re=V,ne=E;function oe(t,s){var r=ne(t)?se:re;return r(t,ae(s))}var le=oe,ie=Q,ce=le;function ue(t,s){return ie(ce(t,s),1)}var de=ue;const me=A(de);function xe({citations:t,searchResults:s,analyticsMetadata:r}){if(t.length===0&&s.length===0)return e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(M,{children:e.jsx(x,{id:"AbVGAw",defaultMessage:"No Results"})})});const n=me(s,o=>o.entries).toSorted((o,l)=>((l==null?void 0:l.pub_date)??0)-((o==null?void 0:o.pub_date)??0)),a=t.toSorted((o,l)=>((l==null?void 0:l.pub_date)??0)-((o==null?void 0:o.pub_date)??0));return e.jsxs("div",{className:"mt-[-1px] flex w-full flex-col",children:[e.jsx(y,{title:e.jsx(x,{id:"dlVlo6",defaultMessage:"Citations"}),items:a,analyticsMetadata:r}),e.jsx(y,{title:e.jsx(x,{id:"iUafP7",defaultMessage:"Search Results"}),items:n,analyticsMetadata:r})]})}const fe=h.div`sticky top-[-1px] text-xs font-semibold border-token-border-light text-token-text-secondary border-y py-3 px-6 bg-token-main-surface-primary`;function y({title:t,items:s,analyticsMetadata:r}){return!s||s.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx(fe,{children:t}),e.jsx("div",{className:"flex flex-col gap-6 px-6 py-4",children:s.map((n,a)=>e.jsx(he,{item:n,analyticsMetadata:r,index:a},a))})]})}function he({item:t,index:s,analyticsMetadata:r}){const n=N(t.url).data??w(t.url,"short"),a=o=>"ref_id"in o&&"content_type"in o;return e.jsx(pe,{analyticsMetadata:r,href:t.url,position:s,target:"_blank",rel:"noopener",className:"group flex gap-6",children:e.jsxs("div",{children:[e.jsxs("div",{className:"line-clamp-1 flex items-center gap-2 text-sm",children:[e.jsx(Y,{url:t.url,className:"icon-sm rounded bg-token-main-surface-primary object-cover",size:32,minSize:20,fallback:e.jsx(Z,{className:"icon-sm text-token-text-quaternary"})}),n,a(t)&&e.jsx(W,{searchResult:t,className:"inline h-4 w-4 text-token-text-tertiary"})]}),e.jsx("div",{className:"line-clamp-2 text-sm font-semibold hover:underline",children:t.title}),t.pub_date&&e.jsx("div",{className:"text-sm text-token-text-secondary",children:e.jsx(te,{date:t.pub_date})})]})})}const pe=d.forwardRef(function(s,r){const{analyticsMetadata:n,position:a,...o}=s;function l(i){s.href&&p.logEvent(i,{...I(n),url:s.href,raw_position:a})}return d.useEffect(()=>{l(f.searchLinkShown)},[]),e.jsx("a",{ref:r,...o,onClick:i=>{var u;(u=s.onClick)==null||u.call(s,i),i.stopPropagation(),l(f.searchLinkClicked)}})});function Ae({clientThreadId:t}){const s=k(),{tab:r,turnIndex:n,messageId:a}=$(),o=[],l=n?z(t,n):[],i=n?q.getTurnSearchResults(t,n):[],u=n?G(t,n):[];(l.length>0||i.length>0)&&o.push(c.Sources),u.length>0&&o.push(c.Images);const b=d.useCallback(()=>{j.close(r)},[r]),g=d.useMemo(()=>({clientThreadId:t,messageId:a,turnIndex:n}),[t,a,n]);return!r||!n||o.length===0||!o.includes(r)?null:e.jsx(T,{size:"custom",noPadding:!0,isOpen:!0,onClose:b,type:"success",className:"focus-none max-w-2xl !shadow-none outline-none",children:e.jsxs("div",{className:"focus-none flex h-full flex-col items-center justify-start overflow-hidden rounded-lg outline-none",children:[e.jsxs(be,{children:[e.jsx(ge,{children:o.map(m=>e.jsx("button",{onClick:()=>{j.open(m,n,a)},className:F("mb-[-1px] border-b-2 border-solid border-transparent py-6 text-lg font-medium text-token-text-tertiary hover:text-token-text-secondary",{"!border-token-text-primary font-semibold !text-token-text-primary":r===m}),children:s.formatMessage(ve[m])},m))}),e.jsx(L,{onClick:b})]}),e.jsx(je,{children:e.jsx(J,{children:r===c.Sources?e.jsx(v.div,{...S,children:e.jsx(xe,{citations:l,searchResults:i,analyticsMetadata:g})},"sources"):r===c.Images?e.jsx(v.div,{...S,children:e.jsx(X,{images:u,analyticsMetadata:g})},"images"):null})})]})})}const S={initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},className:"h-full overflow-y-auto relative"},be=h.div`flex w-full flex-row items-center justify-between border-b px-6 dark:border-gray-700`,ge=h.span`text-base font-semibold sm:text-base flex gap-4`,je=h.div`h-[60vh] max-h-[700px] w-full`,ve=D({[c.Images]:{id:"Z0ljgR",defaultMessage:"Images"},[c.Sources]:{id:"MqF7a0",defaultMessage:"Links"}});export{Ae as SearchResultsModal};
//# sourceMappingURL=by1s0x2g7bnhqvi2.js.map
