import{m as e,r as c,gA as O,at as R,o as F,e as K,ba as U,P as M,d as _,aD as j,a_ as B,aU as L}from"./jof5w6fcuovfw2f6.js";import{cS as W,b3 as X,cT as H}from"./kmoqtqt6p506agf3.js";import{u as D}from"./k1hllnzy6h9kowby.js";import{e as Q,d as E}from"./jd1a7zinwtard1ar.js";import{P as V}from"./etxyd5b8tnrujj31.js";import{aR as Y}from"./lb45hkrxnjv7cybt.js";import"./dgilq6jvxf40af3o.js";function T({title:n,content:t,buttons:s,time:a,icon:r,size:o="default",progressBar:d,disabled:i=!1,onClick:m}){const y=i?"border-token-dot-color border-opacity-10":"border-token-main-surface-secondary shadow",f=o==="small"?`w-2/3 px-[20px] py-[16px] ${i?"":"gap-4"}`:"w-full gap-4 px-[22px] pb-[22px] pt-[18px]",g=m?"cursor-pointer":"";return e.jsxs("div",{className:`inline-flex flex-col items-start justify-start rounded-2xl border ${y} bg-token-main-surface-primary dark:bg-token-main-surface-secondary ${f} ${g}`,onClick:m,children:[e.jsxs("div",{className:`flex flex-col items-start justify-start self-stretch ${o==="small"?"":"gap-1.5"}`,children:[e.jsxs("div",{className:`inline-flex items-start justify-start self-stretch ${o==="small"?"":"gap-2"}`,children:[e.jsx("div",{className:`shrink grow basis-0 text-base font-semibold leading-normal ${i?"text-token-text-secondary":"text-token-text-primary"}`,children:n}),e.jsx("div",{className:"relative h-6 w-6"}),!i&&(r||e.jsx(Y,{className:"relative h-6 w-6"}))]}),e.jsx("div",{className:"flex w-full flex-col items-start justify-start",children:e.jsx("div",{className:`inline-flex w-full items-start justify-start self-stretch rounded ${o==="small"?"gap-1":"gap-2.5 py-1"}`,children:e.jsx("div",{className:`w-full text-base font-normal leading-relaxed ${i?"text-token-text-tertiary":"text-token-text-secondary"}`,children:t})})})]}),d?e.jsxs("div",{className:`${s&&s.length>0?"-mt-2":""} mb-2 inline-flex items-center justify-between self-stretch`,children:[d,s]}):e.jsxs("div",{className:"inline-flex items-center justify-end self-stretch",children:[a&&e.jsx("div",{className:"shrink grow basis-0 text-[15px] font-normal leading-normal text-token-text-tertiary",children:a}),e.jsx("div",{className:"flex gap-2",children:s})]})]})}const q={strong:n=>{const{node:t,children:s,...a}=n;return e.jsx("strong",{...a,className:j(a.className,"font-semibold text-token-text-primary"),children:s})},p:n=>{const{node:t,children:s,...a}=n;return e.jsx("p",{...a,className:j(a.className,"text-base","has-[strong]:mb-1 [&:not(:first-child)]:has-[strong]:mt-3 [&:not(:has(strong))]:mb-3"),children:s})}};function G({message:n,isExpandable:t}){const a=n.create_time?new Date(n.create_time*1e3):Date.now(),r=D(+a,48e4);return e.jsx(V,{percentage:r,className:j("mr-4",t?"!w-3/4":"!w-full"),backgroundClassName:"bg-token-sidebar-surface-secondary rounded-full",barClassName:"bg-token-text-primary rounded-full",transitionDuration:`${(100-r)/100*.2}s`,transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"})}function J({headline:n,message:t}){const a=t.create_time?new Date(t.create_time*1e3):Date.now(),r=D(+a,48e4);return e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx(H,{percentage:r,thickness:1/8,className:"h-5 w-5 text-token-text-primary",backgroundStrokeClassName:"stroke-token-main-surface-tertiary",transitionDuration:`${(100-r)/100*.2}s`,transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"}),n]})}function Z({isExpandable:n,handleOpenSidebarSummarizer:t,summarizationHeadline:s,latestTitle:a,message:r}){return e.jsx("div",{className:"py-2",children:e.jsx(T,{buttons:[e.jsx(B,{onClick:t,color:"secondary",className:"text-base font-normal text-token-text-secondary",children:e.jsx("div",{className:"px-1",children:e.jsx(L,{id:"wQcuK8",defaultMessage:"Details"})})},"Details")],title:s,time:null,icon:e.jsx("div",{className:""}),content:`${a}...`,size:"small",progressBar:e.jsx(G,{message:r,isExpandable:n})})})}function I({handleOpenSidebarSummarizer:n,summarizationHeadline:t,message:s}){return e.jsx("div",{className:"py-2",children:e.jsx(T,{buttons:[],title:t,time:null,content:s.metadata?.finished_text??"",size:"small",disabled:!0,onClick:n})})}function C({completionInProgress:n,summarizationHeadline:t,latestTitle:s,message:a,summaryText:r,isExpandable:o,disableExpansion:d,onOpenAnalytics:i,handleOpenSidebarSummarizer:m}){return e.jsx(Q,{status:n?E.Running:E.Finished,highlightedCommand:n?t==null?s:e.jsx(J,{headline:t,message:a}):a.metadata?.finished_text??"",onOpenAnalytics:i,onClick:m,children:r&&o&&!d?e.jsx("div",{className:"mb-4 border-l-2 pl-4 dark:border-token-text-secondary",children:e.jsx(X,{componentOverrides:q,className:"not-prose leading-6",children:r})}):null})}function oe({messages:n,isStreaming:t,clientThreadId:s,currentGroupedMessageIndex:a,turnIndex:r}){const[o,d]=c.useState(""),[i,m]=c.useState(!1),f=O(s)===R.STREAMING,g=f||t,l=n[0].message,N=l.id,v=F.getServerThreadId(s),x=K(l),u=l.metadata?.summarization_headline,P=t&&u!=null,{toggleThreadSidebar:k}=U(),$=u!=null,A=W(),p=c.useCallback(()=>{k({type:"summarizer",clientThreadId:s,currentGroupedMessageIndex:a,turnIndex:r})},[k,s,a,r]);c.useEffect(()=>{const z=/\*\*(.*?)(?:\*\*|\n|$)/g;let w,b="";for(;(w=z.exec(x))!=null;)b=w[1].trim();b?d(b):l.metadata?.initial_text!=null&&d(l.metadata.initial_text)},[x,l.metadata?.initial_text]),c.useEffect(()=>{x.length>0&&m(!0)},[x]);const h=c.useMemo(()=>({client_thread_id:s,message_id:N,conversationId:v}),[s,N,v]);c.useEffect(()=>{i&&M.logEvent(_.receivedA8KM123Message,h)},[i]);const S=c.useCallback(()=>{M.logEvent(_.openedA8KM123Message,{...h,isStreaming:t})},[h,t]);return A?$?f||t?e.jsx(Z,{isExpandable:i,handleOpenSidebarSummarizer:p,summarizationHeadline:u,latestTitle:o,message:l}):e.jsx(I,{handleOpenSidebarSummarizer:p,summarizationHeadline:u,message:l}):e.jsx(C,{completionInProgress:g,summarizationHeadline:u,latestTitle:o,message:l,onOpenAnalytics:S,handleOpenSidebarSummarizer:i||!t?p:void 0}):e.jsx(C,{completionInProgress:g,summarizationHeadline:u,latestTitle:o,message:l,onOpenAnalytics:S,summaryText:x,isExpandable:i,disableExpansion:P})}export{q as SUMMARY_MARKDOWN_COMPONENT_OVERRIDES,oe as default};
//# sourceMappingURL=d47ui4qliqic83em.js.map
