import{r as i,u as d,C as s,E as r,j as y}from"./hloj85fregi26ji6.js";import{b as S}from"./cfoc0xkgt0nhci6c.js";import{bH as L}from"./g7w33hsyqmw6f524.js";const c="last_checked_loc",A=24*60*60*1e3,u="last_denied_loc",C=60*60*1e3;function x(){const[o]=S(),{data:e}=d({queryKey:["userLocation",o.useLocation],queryFn:({queryKey:[n,t]})=>E({enabled:t}),initialData:_(o.useLocation),networkMode:"always",refetchOnMount:"always",refetchOnWindowFocus:"always",staleTime:0});return e}function _(o){if(o){const e=s.getCookie(r.LastLocation);if(e)try{return JSON.parse(e)}catch{return l(),null}}return null}async function E({enabled:o}){var n;if(!o)return l();if(((n=await m())==null?void 0:n.state)!=="granted"){const t=localStorage.getItem(c);if(t){const a=Number(t);if(Date.now()-A<a)try{return JSON.parse(s.getCookie(r.LastLocation))}catch{}}}const e=localStorage.getItem(u);if(e){const t=Number(e);if(Date.now()-C<t)return null}return await new Promise(t=>{navigator.geolocation.getCurrentPosition(a=>{const g={latitude:a.coords.latitude,longitude:a.coords.longitude,locationAccuracy:a.coords.accuracy};s.setCookie(r.LastLocation,JSON.stringify(g),{maxAge:L}),localStorage.setItem(c,Date.now().toString()),t(g)},()=>{localStorage.setItem(u,Date.now().toString()),t(l())},{enableHighAccuracy:!0,maximumAge:0})})}async function m(){return navigator!=null&&navigator.permissions?await navigator.permissions.query({name:"geolocation"}):null}const I={latitude:null,longitude:null,locationAccuracy:null};function l(){return s.setCookie(r.LastLocation,JSON.stringify(I),{maxAge:L}),localStorage.removeItem(c),localStorage.removeItem(u),null}const f=i.createContext(null),P=({children:o})=>{const[e,n]=i.useState(null);return i.useEffect(()=>{m().then(t=>{t!=null&&(n(t.state),t.onchange=()=>{n(t.state)})})},[]),y.jsx(f.Provider,{value:e,children:o})};function N(){return i.useContext(f)}export{P as L,N as a,x as u};
//# sourceMappingURL=iptnb699ml9qt2uj.js.map
