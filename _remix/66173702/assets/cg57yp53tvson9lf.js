const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jh99ko0kocqsf3o2.js","assets/hloj85fregi26ji6.js","assets/g65last9w3zpj4e1.js","assets/root-g1ux4bkd.css"])))=>i.map(i=>d[i]);
import{N as G,bP as fe,f5 as xe,f6 as Q,r as p,j as t,bn as he,cg as pe,bo as Ie,bp as be,br as we,c as E,bv as ve,aQ as L,V as oe,bH as ye,bI as je,aA as Me,el as Ce,M as Se,em as ke,en as Ee,aS as _e,aW as Ne,aP as Ve,aT as Y,bT as Ae,W as le,an as J,F as W,P as Z,bc as Te}from"./hloj85fregi26ji6.js";import{a as De,b as Pe,x as Fe,b4 as Le,bz as $e,aH as de,aI as ce,P as me,T as Re}from"./g65last9w3zpj4e1.js";import{A as Oe,fc as Ge,ea as Be,fd as ze,cV as ee,cW as We,bT as q,bS as He,bq as Ue,bD as qe,bp as Xe,d0 as Ke,cX as Qe,fe as Ye,br as te,c6 as Je,r as Ze}from"./g7w33hsyqmw6f524.js";import{m as O}from"./g0f573poiara0btd.js";import{g as R,d as et}from"./namdzpoal4qqgbz9.js";import{G as tt,i as $,z as at}from"./emiobmo9yrp27p7q.js";import{c as st,k as it,q as nt}from"./dkqa9jl3k2y8d11k.js";import"./ee0lorinfbhctvv3.js";import"./oxm37jjpmmj4jh4x.js";import"./j8xrc2euwar8tjsu.js";import"./exbwrpd3te4zrj2f.js";import"./cc6pb8mmonp9vszn.js";import"./h3mpj2fxmaknxuj4.js";import"./5pvvsmnp202yv97v.js";import"./gqd1dhcfmn5x8vwx.js";import"./huar325mst1d1qc5.js";import"./dgwkym7sicm8o0u9.js";import"./nhwieeg0ur43kl0h.js";const rt={enter:e=>({zIndex:0,x:e===-1?"10%":"-10%",opacity:0}),center:{zIndex:1,x:0,opacity:1},exit:e=>({zIndex:0,x:e===1?"10%":"-10%",opacity:0})},ot={enter:{opacity:0,y:"10%"},visible:{opacity:1,y:0},exit:{opacity:0,y:"10%"}},ae=1e3,se=1e3,ie=(e,a)=>Math.abs(e)*a;function lt(e){var k,d;const a=G(),i=fe(),r=xe(),f=[Q.Small,Q.Mobile].includes(r),[I,o]=p.useState({width:0,height:0}),[l,c]=p.useState(!1),[n,g]=p.useState(e.image),[u,M]=p.useState(!1),x=I.width>0&&I.height>0,v=p.useRef(null),[j,w]=p.useState(0);p.useEffect(()=>{if(!n.url)throw new Error("ExpandableImage requires a src");const s=new Image;s.onload=()=>{o({width:s.naturalWidth,height:s.naturalHeight})},s.onerror=()=>{},s.src=n.url},[n.url]),p.useEffect(()=>{const s=v.current;if(u)return s==null||s.addEventListener("keydown",_),()=>{s==null||s.removeEventListener("keydown",_)};g(e.image)},[u]);function y(){g(s=>{const b=(e.images.findIndex(h=>h.url===s.url)+1)%e.images.length;return e.images[b]}),w(-1)}function C(){g(s=>{const m=e.images.findIndex(h=>h.url===s.url),b=m>0?(m-1)%e.images.length:e.images.length-1;return e.images[b]}),w(1)}function B(s){var m;M(s),s&&((m=e.onOpen)==null||m.call(e,n))}function _(s){s.key==="ArrowLeft"?C():s.key==="ArrowRight"&&y()}const z=e.images.findIndex(s=>s.url===n.url);return t.jsxs(he,{onOpenChange:B,children:[t.jsx(pe,{disabled:!x,className:e.className,"aria-label":a.formatMessage(N.showImage),children:e.children}),t.jsx(Ie,{container:i==null?void 0:i.document.body,children:t.jsx(be,{className:"fixed inset-0 flex items-center justify-center bg-black/90 backdrop-blur-xl radix-state-open:animate-show",children:t.jsxs(we,{className:E("relative flex h-[100dvh] w-screen justify-stretch divide-x divide-white/10 focus:outline-none radix-state-open:animate-contentShow"),ref:v,children:[t.jsx("div",{className:E("flex flex-1 transition-[flex-basis]",!l&&"md:basis-[75vw]"),children:t.jsxs("div",{className:"flex flex-1 flex-col md:p-6",children:[t.jsxs("div",{className:"flex justify-between px-6 py-2 pt-6 text-white sm:mb-4 md:mt-2 md:px-0 md:py-2",children:[t.jsx(ve,{asChild:!0,children:t.jsx("button",{"aria-label":a.formatMessage(N.closeModal),children:t.jsx(De,{})})}),t.jsx("div",{children:!f&&t.jsxs(t.Fragment,{children:[(d=(k=e.getActions)==null?void 0:k.call(e,n))==null?void 0:d.map((s,m)=>t.jsx(L,{color:"ghost",size:"small",onClick:s.onClick,"aria-label":s.ariaLabel,disabled:s.disabled,icon:s.icon},m)),t.jsx(L,{color:"ghost",size:"small",onClick:()=>c(s=>!s),"aria-label":a.formatMessage(N.toggleSidebar),className:"md:inline-flex",icon:Pe})]})})]}),t.jsx("div",{className:"relative flex flex-1 flex-col items-center justify-center overflow-hidden",children:t.jsx(Oe,{initial:!1,custom:j,children:t.jsxs(O.div,{className:"absolute grid h-full w-full grid-rows-2",custom:j,variants:rt,drag:"x",dragConstraints:{left:0,right:0},dragElastic:1,onDragEnd:(s,{offset:m,velocity:b})=>{const h=ie(m.x,b.x);h<-ae?y():h>ae&&C()},children:[t.jsx(O.img,{src:n.url,alt:n.alt,className:"row-span-4 mx-auto h-full object-scale-down",onPanEnd:(s,{offset:m,velocity:b})=>{const h=ie(m.y,b.y);h<-se?c(!0):h>se&&c(!1)}},n.url),f&&l&&t.jsx(O.div,{className:"flex text-white",variants:ot,initial:"enter",animate:"visible",exit:"exit",transition:{y:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2}},children:e.metadataRenderer(n)})]},n.url)})}),e.images.length>1?t.jsxs("div",{className:"flex items-center justify-center gap-4 p-8 text-white",children:[t.jsx(L,{color:"ghost",size:"small",onClick:C,"aria-label":a.formatMessage(N.previousImage),icon:Fe}),e.images.map((s,m)=>t.jsx("img",{src:s.url,alt:s.alt??"",className:E("h-12 w-12 cursor-pointer rounded object-cover transition duration-300 hover:opacity-100",s.url===n.url?"ring-2 ring-white ring-offset-4 ring-offset-black":"opacity-25"),onClick:()=>{g(s),w(m<z?1:-1)},"aria-label":a.formatMessage(N.showImage),role:"button"},s.url)),t.jsx(L,{color:"ghost",size:"small",onClick:y,"aria-label":a.formatMessage(N.nextImage),icon:Le})]}):null]})}),t.jsx("div",{className:E("hidden items-center justify-start overflow-hidden bg-gray-900 text-white transition-[flex-basis] duration-500 md:flex",l?"md:basis-[25vw]":"md:basis-0"),children:t.jsx("div",{className:"w-[25vw] min-w-[25vw]",children:e.metadataRenderer(n)})})]})})})]})}const N=oe({showImage:{id:"imageViewer.showImage",defaultMessage:"Show Image"},closeModal:{id:"imageViewer.closeModal",defaultMessage:"Close Modal"},toggleSidebar:{id:"imageViewer.toggleSidebar",defaultMessage:"Toggle Sidebar"},nextImage:{id:"imageViewer.nextImage",defaultMessage:"Next Image"},previousImage:{id:"imageViewer.previousImage",defaultMessage:"Previous Image"}}),dt=25*1e3,H=new Map,ct=(e,a=dt)=>{const i=mt(e),[r,f]=p.useState(H.get(e)??0);return p.useEffect(()=>{let o=0;const l=setInterval(()=>{o+=100,f(c=>{let n=1.5;if(o<a){const u=Math.sin(i+c/100)*.1+1;n=(1-Math.log10(1+c/10))*u}const g=c+n;return g>=100?(clearInterval(l),100):(H.set(e,g),g)})},100);return()=>{clearInterval(l),H.delete(e)}},[i,e,a]),r};function mt(e){if(typeof e=="number")return e;let a=0;if(e.length===0)return a;for(let i=0;i<e.length;i++){const r=e.charCodeAt(i);a=(a<<5)-a+r,a|=0}return a}const gt=ye(()=>je(()=>import("./jh99ko0kocqsf3o2.js"),__vite__mapDeps([0,1,2,3])));function ut(e){const a=e.matchTextColor??!0,i=p.useRef(null),[r,f]=p.useState(null);p.useEffect(()=>{if(!i.current||!a)return;const o=()=>{i.current&&f(getComputedStyle(i.current).color)},l=new MutationObserver(()=>{o()});return l.observe(window.document.documentElement,{attributes:!0,attributeFilter:["class","style"]}),l.observe(i.current,{attributes:!0,attributeFilter:["class","style"]}),o(),()=>l.disconnect()},[a]);const I=p.useMemo(()=>{var c;if(!a)return e.animationData;const o=(c=r==null?void 0:r.match(/\d+/g))==null?void 0:c.map(Number).map(n=>n/255);if(!o)return null;o.push(1);const l=e.animationData;return"layers"in l&&Array.isArray(l.layers)&&l.layers.forEach(n=>{"ty"in n&&n.ty===4&&"shapes"in n&&Array.isArray(n.shapes)&&n.shapes.forEach(g=>{"it"in g&&Array.isArray(g.it)&&g.it.forEach(u=>{u.ty==="fl"&&(u.c.k=o)})})}),l},[e.animationData,r,a]);return t.jsx("div",{ref:i,className:e.className,children:t.jsx(gt,{animationData:I,loop:!0,autoplay:!0},r)})}function ft({id:e,withLottie:a}){return t.jsxs("div",{className:"absolute left-0 top-0 flex h-full w-full items-center justify-center rounded-full",children:[a?t.jsx(ut,{className:"h-6 w-6",animationData:Ge}):t.jsx($e,{className:"h-6 w-6"}),t.jsx(xt,{id:e})]})}function xt({id:e}){const a=ct(e);return t.jsx(Be,{percentage:a,thickness:1.25/23,className:"absolute left-1/2 top-1/2 h-10 w-10 -translate-x-1/2 -translate-y-1/2",backgroundStrokeClassName:"stroke-token-main-surface-tertiary",transitionDuration:`${(100-a)/100*.2}s`,transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"})}function Rt({messages:e,clientThreadId:a}){const[i,r]=e,f=tt(i.message),I=ze(),o=e.some(n=>I.has(n.message.id));let l=null;r!=null&&ee.isMultimodalTextMessage(r.message)&&(l=ee.getImageAssetPointers(r.message));let c=$.Running;return l!=null?c=$.Finished:r!=null?c=$.Error:f&&(c=$.Stopped),t.jsx(t.Fragment,{children:!o&&t.jsx(ht,{imageAssets:l??[],clientThreadId:a,toolStatus:c,toolMessage:r==null?void 0:r.message,messageId:i.message.id})})}const ht=({imageAssets:e,clientThreadId:a,toolMessage:i,toolStatus:r,messageId:f})=>{const I=G(),o=We(e),l=Me(),c=Ce();if((i==null?void 0:i.content.content_type)===Se.SystemError)return null;const n=ge(e[0]),g=o.map(x=>x.data).filter(x=>x!=null),u=g.map(x=>({...x,alt:R(x)})),M=(x=0)=>`${f}-image-${x}`;return t.jsx(t.Fragment,{children:t.jsxs(wt,{$numItems:o.length,className:"my-1 transition-opacity duration-300",children:[o.length===0&&r===$.Running&&t.jsx(ne,{layoutId:"loading:placeholder",shape:n,isToolRunning:!0},"loading"),o.map((x,v)=>{const{isLoading:j,data:w,error:y}=x;if(j)return t.jsx(ne,{shape:n,layoutId:M(v)},v);if(y!=null||(w==null?void 0:w.url)==null)return t.jsx(X,{layoutId:M(v),className:"text-sm text-token-text-tertiary",shape:n,children:t.jsx("div",{className:"flex min-h-full flex-col items-center justify-center gap-3 px-4 pb-5",children:I.formatMessage(S.imageLoadError)})},v);if(i&&w){const C={...w,alt:R(w)};return t.jsx(pt,{image:C,allImages:u,clientThreadId:a,toolMessage:i,index:v,onOpenImageEditor:()=>{ke&&c?(l(`/c/${a}`,{state:{focusObject:{type:q.Image,image:C,allImages:g,messageId:i.id}}}),Ee(!1,{focusMainWindow:!0})):He.setFocusedObject({type:q.Image,image:C,allImages:g,messageId:i.id})}},v)}})]})})};function pt({toolMessage:e,clientThreadId:a,allImages:i,image:r,index:f,onOpenImageEditor:I}){const o=G(),l=st(a),c=_e(),{value:n}=Ne("2189772492"),g=Ve(),u=at(a),M=ge(r),[x,v]=p.useState({}),j=u&&"gizmo"in u?u.gizmo:void 0,w=(j==null?void 0:j.gizmo.id)===Ue,y=g&&n&&!!(c!=null&&c.includes(Y.D3Editor))&&(j==null||w||!!(c!=null&&c.includes(Y.D3EditorAllGpts)));async function C(d){et(d,l,e.id)}function B(d){var s,m,b,h,V,A,T,D,P,F;J.logEvent("chatgpt_dalle_image_view_full",null,{sourceOperation:((m=(s=d.metadata)==null?void 0:s.dalle)==null?void 0:m.edit_op)??"none",hasParent:(h=(b=d.metadata)==null?void 0:b.dalle)!=null&&h.parent_gen_id?"true":"false"}),Z.logEvent(W.dalleImageViewFull,{conversationId:l,messageId:e.id,generationId:(A=(V=d.metadata)==null?void 0:V.dalle)==null?void 0:A.gen_id,parentGenerationId:(D=(T=d.metadata)==null?void 0:T.dalle)==null?void 0:D.parent_gen_id,fileId:te(d.asset_pointer),sourceOperation:(F=(P=d.metadata)==null?void 0:P.dalle)==null?void 0:F.edit_op})}function _(d,s){var m,b,h,V,A,T,D,P,F,K;v(ue=>({...ue,[d.asset_pointer]:s})),J.logEvent(W.dalleImageRating,s?"like":"dislike",{liked:s?"true":"false",sourceOperation:((b=(m=d.metadata)==null?void 0:m.dalle)==null?void 0:b.edit_op)??"none",hasParent:(V=(h=d.metadata)==null?void 0:h.dalle)!=null&&V.parent_gen_id?"true":"false"}),Z.logEvent(W.dalleImageRating,{liked:s,conversationId:l,messageId:e.id,generationId:(T=(A=d.metadata)==null?void 0:A.dalle)==null?void 0:T.gen_id,parentGenerationId:(P=(D=d.metadata)==null?void 0:D.dalle)==null?void 0:P.parent_gen_id,fileId:te(d.asset_pointer),sourceOperation:(K=(F=d.metadata)==null?void 0:F.dalle)==null?void 0:K.edit_op})}function z(d){const s=x[d.asset_pointer],m={label:o.formatMessage(S.likeImage),onClick:()=>_(d,!0),disabled:s===!0,ariaLabel:o.formatMessage(S.likeImage),icon:de},b={label:o.formatMessage(S.dislikeImage),onClick:()=>_(d,!1),disabled:s===!1,ariaLabel:o.formatMessage(S.dislikeImage),icon:ce},h={label:o.formatMessage(S.downloadImage),onClick:()=>C(d),ariaLabel:o.formatMessage(S.downloadImage),icon:me};return[s!==!1&&m,s!==!0&&b,h].filter(Boolean)}let k=t.jsx(bt,{image:r,shape:M,rating:x[r.asset_pointer],onDownload:()=>C(r),onRate:(d,s)=>_(d,s),clientThreadId:a,layoutId:void 0});return y?k=t.jsx("div",{role:"button",onClick:I,children:k}):k=t.jsx(lt,{image:r,images:i,metadataRenderer:d=>t.jsx(It,{image:d}),onOpen:B,getActions:z,children:k}),t.jsx("div",{className:"flex",children:k},f)}function ne({shape:e,layoutId:a,isToolRunning:i=!1}){return t.jsx(X,{shape:e,layoutId:a,children:t.jsx("div",{className:"flex min-h-full items-center justify-center",children:t.jsx(ft,{id:a,withLottie:i})})},"loading")}function It({image:e}){const a=G(),[i,r]=p.useState(!1),f=Te();function I(o){const l=R(e);r(!0),Ze(l,f,o),setTimeout(()=>{r(!1)},2e3)}return t.jsxs("div",{className:"flex flex-col items-start gap-3 p-6",children:[t.jsx("div",{className:"text-sm text-gray-300 sm:text-base",children:a.formatMessage(S.imageViewerMetadataTitle)}),t.jsx("div",{className:"max-h-32 overflow-y-auto text-sm md:max-h-[80vh] md:text-lg",children:R(e)}),t.jsx(L,{color:"primary",onClick:I,disabled:i,className:"hidden sm:block",icon:Re,children:i?a.formatMessage(S.imageViewerMetadataCopyButtonCopied):a.formatMessage(S.imageViewerMetadataCopyButton)})]})}function X({children:e,shape:a,className:i,layoutId:r}){return t.jsxs(O.div,{layoutId:r,className:E("relative",i,a==="1792x1024"&&"aspect-[7/4]",a==="1024x1024"&&"aspect-square max-w-[400px]",a==="1024x1792"&&"aspect-[4/7] max-w-xs","overflow-hidden rounded-2xl"),children:[t.jsx("div",{className:"pointer-events-none absolute inset-0 bg-token-main-surface-secondary"}),t.jsx("div",{className:"relative h-full",children:e})]})}function bt({image:e,shape:a,rating:i,onDownload:r,onRate:f,clientThreadId:I,layoutId:o}){const l=it(),c=qe(Je.isBusinessWorkspace),n=nt(I),g=Xe(),u=Ke(),M=(u==null?void 0:u.type)===q.Image&&u.image.asset_pointer===e.asset_pointer,{url:x,width:v,height:j}=e,w=!l&&!c&&(n==null?void 0:n.kind)!==Ae.GizmoMagicCreate;return t.jsxs(X,{shape:a,className:"group/dalle-image",layoutId:M?void 0:o,children:[t.jsx(Qe,{alt:R(e),src:x,width:v,height:j}),t.jsx("div",{className:E("pointer-events-none absolute inset-0 rounded-2xl shadow-[inset_0_0_0_1px_rgba(0,0,0,0.1)] dark:shadow-[inset_0_0_0_1px_rgba(255,255,255,0.1)]",M?"bg-black/50 group-hover/dalle-image:bg-black/70":"group-hover/dalle-image:bg-transparent")}),g?!M&&t.jsx("div",{className:"pointer-events-none invisible absolute right-3 top-3 text-white group-hover/dalle-image:visible",children:t.jsx(Ye,{})}):t.jsxs(t.Fragment,{children:[w&&t.jsxs(re,{children:[i!==!1&&t.jsx(U,{icon:de,selected:i===!0,onClick:y=>{y.stopPropagation(),f(e,!0)}}),i!==!0&&t.jsx(U,{icon:ce,selected:i===!1,onClick:y=>{y.stopPropagation(),f(e,!1)}})]}),t.jsx(re,{$rightAlign:!0,children:t.jsx(U,{icon:me,onClick:y=>{y.stopPropagation(),r()}})})]})]})}const re=le.div`invisible absolute top-3 flex gap-1 group-hover/dalle-image:visible
${({$rightAlign:e})=>e?"right-3":"left-3"}`;function U({icon:e,selected:a,onClick:i}){return t.jsx("button",{className:E("flex h-8 w-8 items-center justify-center rounded",a?"bg-gray-100":"bg-black/50 hover:opacity-70"),onClick:i,disabled:a,children:t.jsx(e,{className:E("icon-md",a?"text-gray-700":"text-white")})})}const wt=le.div`grid gap-2
${({$numItems:e})=>e<=1?"grid-cols-1":"grid-cols-2"}`;function ge(e){if(!e)return"1024x1024";const{width:a,height:i}=e;return a>i?"1792x1024":a<i?"1024x1792":"1024x1024"}const S=oe({creatingImages:{id:"dalleMessage.creatingImagesV2",defaultMessage:"Creating image"},stopped:{id:"dalleMessage.stoppedV3",defaultMessage:"Stopped creating image"},errorCreating:{id:"dalleMessage.errorCreatingV2",defaultMessage:"Error creating image"},imageLoadError:{id:"dalleMessage.imageLoadError",defaultMessage:"Error loading image"},imageViewerMetadataTitle:{id:"dalleMessage.imageViewerMetadataTitle",defaultMessage:"Prompt"},imageViewerMetadataCopyButton:{id:"dalleMessage.imageViewerMetadataCopyButton",defaultMessage:"Copy"},imageViewerMetadataCopyButtonCopied:{id:"dalleMessage.imageViewerMetadataCopyButtonCopied",defaultMessage:"Copied!"},imageEditButton:{id:"dalleMessage.imageEditButton",defaultMessage:"Edit"},downloadImage:{id:"imageViewer.downloadImage",defaultMessage:"Download Image"},likeImage:{id:"imageViewer.likeImage",defaultMessage:"Like Image"},dislikeImage:{id:"imageViewer.dislikeImage",defaultMessage:"Dislike Image"}});export{Rt as default};
//# sourceMappingURL=cg57yp53tvson9lf.js.map
