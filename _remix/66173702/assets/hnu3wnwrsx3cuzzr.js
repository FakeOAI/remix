import{j as e,cL as R,U as x,r as d,P as p,F as f,N as k,W as h,O as M,c as _,bE as E,V as L}from"./hloj85fregi26ji6.js";import{E as T,p as A,F as D,d as F,m as P}from"./dkqa9jl3k2y8d11k.js";import{g as w}from"./kqwdyvkaaavvn8k3.js";import{u as N}from"./nvid5pawe28xh20n.js";import{b as I}from"./glktjiixlihjqsbe.js";import{bU as U,bV as V,f8 as q,bX as z,f9 as B,fa as c,fb as j,A as G}from"./g7w33hsyqmw6f524.js";import{b1 as O}from"./g65last9w3zpj4e1.js";import{S as H,a as Q}from"./f4vp42zog7n0vt18.js";import{f as W}from"./lewwg1no9ai6n06r.js";import{m as v}from"./g0f573poiara0btd.js";import"./huar325mst1d1qc5.js";import"./oxm37jjpmmj4jh4x.js";function C({children:t}){return e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 text-sm font-semibold text-token-text-tertiary",children:[e.jsx(O,{className:"icon-2xl"}),t]})})}const X=({images:t,analyticsMetadata:a})=>{const o=t.map(s=>s.thumbnail_url),r=R({queries:o.map(s=>T(s)),combine:s=>{const n=new Set;return s.forEach((l,i)=>{l.isError&&n.add(o[i])}),n}});return e.jsx(e.Fragment,{children:(t==null?void 0:t.length)>0?e.jsx("div",{className:"columns-1 gap-2 px-6 py-4 xs:columns-2 md:columns-3",children:t.map((s,n)=>!r.has(s.thumbnail_url)&&e.jsx("div",{className:"relative mb-0.5 break-inside-avoid",children:e.jsx(Z,{image:s,analyticsMetadata:a})},n))}):e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(C,{children:e.jsx(x,{id:"AbVGAw",defaultMessage:"No Results"})})})})},Z=({image:t,analyticsMetadata:a})=>{const o=N(t.url).data??w(t.url,"short"),{isSuccess:r}=A(t==null?void 0:t.thumbnail_url),s={...I(a),url:t.url,title:t.title};d.useEffect(()=>{p.logEvent(f.searchSidebarImageShown,s)},[]);const n=U.useStore();return e.jsx("button",{onClick:()=>{p.logEvent(f.searchSidebarImageClicked,s),n.setCurrentImage(t?{image:t,source:V.ImagesTab,turnIndex:a.turnIndex}:void 0)},children:r?e.jsxs("div",{className:"group relative h-full w-full",children:[e.jsx("img",{src:t.thumbnail_url,alt:t.content_url,className:"w-full rounded-lg hover:opacity-100 group-hover:opacity-90"}),e.jsx("div",{className:"absolute bottom-1 left-1 max-w-[75%] truncate rounded-xl bg-black/40 px-2 py-1 text-xs font-medium text-white backdrop-blur-sm",children:o})]}):e.jsx("div",{className:"aspect-square h-full w-full animate-pulse bg-token-main-surface-tertiary"})})};function J({date:t}){const a=k(),o=t instanceof Date?t:new Date(t*1e3),r=q(o,new Date);if(r<4&&r>-4){const s=a.formatRelativeTime(r,"day",{numeric:"auto"});return s.charAt(0).toUpperCase()+s.slice(1)}else return a.formatDate(o,{year:"numeric",month:"long",day:"numeric"})}function K({citations:t,searchResults:a,analyticsMetadata:o}){if(t.length===0&&a.length===0)return e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(C,{children:e.jsx(x,{id:"AbVGAw",defaultMessage:"No Results"})})});const r=W(a,n=>n.entries).toSorted((n,l)=>((l==null?void 0:l.pub_date)??0)-((n==null?void 0:n.pub_date)??0)),s=t.toSorted((n,l)=>((l==null?void 0:l.pub_date)??0)-((n==null?void 0:n.pub_date)??0));return e.jsxs("div",{className:"mt-[-1px] flex w-full flex-col",children:[e.jsx(y,{title:e.jsx(x,{id:"dlVlo6",defaultMessage:"Citations"}),items:s,analyticsMetadata:o}),e.jsx(y,{title:e.jsx(x,{id:"iUafP7",defaultMessage:"Search Results"}),items:r,analyticsMetadata:o})]})}const Y=h.div`sticky top-[-1px] text-xs font-semibold border-token-border-light text-token-text-secondary border-y py-3 px-6 bg-token-main-surface-primary`;function y({title:t,items:a,analyticsMetadata:o}){return!a||a.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx(Y,{children:t}),e.jsx("div",{className:"flex flex-col gap-6 px-6 py-4",children:a.map((r,s)=>e.jsx($,{item:r,analyticsMetadata:o,index:s},s))})]})}function $({item:t,index:a,analyticsMetadata:o}){const r=N(t.url).data??w(t.url,"short"),s=n=>"ref_id"in n&&"content_type"in n;return e.jsx(ee,{analyticsMetadata:o,href:t.url,position:a,target:"_blank",rel:"noopener",className:"group flex gap-6",children:e.jsxs("div",{children:[e.jsxs("div",{className:"line-clamp-1 flex items-center gap-2 text-sm",children:[e.jsx(z,{url:t.url,className:"icon-sm rounded bg-token-main-surface-primary object-cover",size:32,minSize:20,fallback:e.jsx(H,{className:"icon-sm text-token-text-quaternary"})}),r,s(t)&&e.jsx(Q,{searchResult:t,className:"inline h-4 w-4 text-token-text-tertiary"})]}),e.jsx("div",{className:"line-clamp-2 text-sm font-semibold hover:underline",children:t.title}),(t.pub_date??t.snippet)&&e.jsxs("div",{className:"line-clamp-1 text-sm font-normal text-token-text-secondary",children:[t.pub_date&&e.jsx(J,{date:t.pub_date}),t.pub_date&&t.snippet&&" â€” ",t.snippet]})]})})}const ee=d.forwardRef(function(a,o){const{analyticsMetadata:r,position:s,...n}=a;function l(i){a.href&&p.logEvent(i,{...I(r),url:a.href,raw_position:s})}return d.useEffect(()=>{l(f.searchLinkShown)},[]),e.jsx("a",{ref:o,...n,onClick:i=>{var u;(u=a.onClick)==null||u.call(a,i),i.stopPropagation(),l(f.searchLinkClicked)}})});function be({clientThreadId:t}){const a=k(),{tab:o,turnIndex:r,messageId:s}=B(),n=[],l=r?D(t,r):[],i=r?F.getTurnSearchResults(t,r):[],u=r?P(t,r):[];(l.length>0||i.length>0)&&n.push(c.Sources),u.length>0&&n.push(c.Images);const b=d.useCallback(()=>{j.close(o)},[o]),g=d.useMemo(()=>({clientThreadId:t,messageId:s,turnIndex:r}),[t,s,r]);return!o||!r||n.length===0||!n.includes(o)?null:e.jsx(M,{size:"custom",noPadding:!0,isOpen:!0,onClose:b,type:"success",className:"focus-none max-w-2xl !shadow-none outline-none",children:e.jsxs("div",{className:"focus-none flex h-full flex-col items-center justify-start overflow-hidden rounded-lg outline-none",children:[e.jsxs(te,{children:[e.jsx(se,{children:n.map(m=>e.jsx("button",{onClick:()=>{j.open(m,r,s)},className:_("mb-[-1px] border-b-2 border-solid border-transparent py-6 text-lg font-medium text-token-text-tertiary hover:text-token-text-secondary",{"!border-token-text-primary font-semibold !text-token-text-primary":o===m}),children:a.formatMessage(re[m])},m))}),e.jsx(E,{onClick:b})]}),e.jsx(ne,{children:e.jsx(G,{children:o===c.Sources?e.jsx(v.div,{...S,children:e.jsx(K,{citations:l,searchResults:i,analyticsMetadata:g})},"sources"):o===c.Images?e.jsx(v.div,{...S,children:e.jsx(X,{images:u,analyticsMetadata:g})},"images"):null})})]})})}const S={initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},className:"h-full overflow-y-auto relative"},te=h.div`flex w-full flex-row items-center justify-between border-b px-6 dark:border-gray-700`,se=h.span`text-base font-semibold sm:text-base flex gap-4`,ne=h.div`h-[60vh] max-h-[700px] w-full`,re=L({[c.Images]:{id:"Z0ljgR",defaultMessage:"Images"},[c.Sources]:{id:"MqF7a0",defaultMessage:"Links"}});export{be as SearchResultsModal};
//# sourceMappingURL=hnu3wnwrsx3cuzzr.js.map
