const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ik85alr5t5x5hu8g.js","assets/hloj85fregi26ji6.js","assets/g65last9w3zpj4e1.js","assets/root-g1ux4bkd.css","assets/h5sk1x1otk8yaqwo.js","assets/g7w33hsyqmw6f524.js","assets/conversation-small-eplmind9.css","assets/iut590v2mj7dzk0d.js","assets/hpq29j7kyoxsb2a5.js","assets/l7ofbm80qwh16yc6.js","assets/evumf8dcfco4yuge.js","assets/lgngmdhge2gn7rq1.js","assets/iptnb699ml9qt2uj.js","assets/cfoc0xkgt0nhci6c.js","assets/obvwz6quqtf1mqmb.js","assets/o6nel3pz54rz9br4.js","assets/mn9n803lhy34tzs0.js"])))=>i.map(i=>d[i]);
import{j as e,r as d,W as N,M as V,bc as K,aQ as L,b as I,c as oe,bE as ie,bH as Q,bI as Z,N as X,aS as Y,O as R,U as le,V as ce,eZ as f,I as ee,c1 as de}from"./hloj85fregi26ji6.js";import{z as ue,T as v,A as me}from"./dkqa9jl3k2y8d11k.js";import"./oxm37jjpmmj4jh4x.js";import{eu as z,ev as B,aw as b,cn as xe,I as ge,q as te,Z as S,g as se,a3 as be,as as pe,at as fe,au as q,av as G,r as he,cV as F,ew as ve,ex as je,ey as ae}from"./g7w33hsyqmw6f524.js";import"./exbwrpd3te4zrj2f.js";import{c as ye}from"./d0ncnmweshpteaul.js";import{S as Se,c as we}from"./bcdt9z43mbod8jq4.js";import{C as Ce}from"./ej7tj5zdxjybjlps.js";import{C as _e}from"./h5sk1x1otk8yaqwo.js";import{an as ke,aL as re,bl as Ne,P as Me}from"./g65last9w3zpj4e1.js";import{u as De}from"./ljbu8sh7393jjfdt.js";import"./g0f573poiara0btd.js";import"./e9lafxuzyeh4418f.js";import"./hz6rcvfsuefanobi.js";import"./jmutnjyuz0rby5b2.js";import"./hn9f977mxxh6bu82.js";import"./emiobmo9yrp27p7q.js";import"./ee0lorinfbhctvv3.js";import"./j8xrc2euwar8tjsu.js";import"./cc6pb8mmonp9vszn.js";import"./h3mpj2fxmaknxuj4.js";import"./5pvvsmnp202yv97v.js";import"./gqd1dhcfmn5x8vwx.js";import"./huar325mst1d1qc5.js";import"./dgwkym7sicm8o0u9.js";import"./nhwieeg0ur43kl0h.js";import"./j01a1fgyrmdo2nse.js";import"./gbs7h0lv3lza1lcd.js";import"./jcq12ykszsbw8zt5.js";import"./fz9i5tjlk99soob3.js";import"./hpq29j7kyoxsb2a5.js";import"./jh2k70ey33410zk7.js";import"./b6wvmkrvcwpet9ow.js";import"./namdzpoal4qqgbz9.js";import"./da3yftz680geeh5o.js";import"./hhai1q8khfqgvvcd.js";import"./emi9b5jj9c6f2s4k.js";import"./mfsk43xu0r4dqsjj.js";import"./evumf8dcfco4yuge.js";import"./jryoneytkli2yql8.js";import"./jikz9wtvwjmakljj.js";import"./cd9sca6dk8zxsw8r.js";function Te({children:t,sidebarOpen:r,onClose:i}){return e.jsx(z.Root,{show:r,as:d.Fragment,children:e.jsxs(B,{as:"div",className:"relative z-10",onClose:i,children:[e.jsx("div",{className:"fixed inset-0"}),e.jsx("div",{className:"fixed inset-0 overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 overflow-hidden",children:e.jsx("div",{className:"pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-10",children:e.jsx(z.Child,{as:d.Fragment,enter:"transform transition ease-in-out duration-100 sm:duration-300",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"transform transition ease-in-out duration-300 sm:duration-500",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",children:e.jsx(B.Panel,{className:"pointer-events-auto w-screen max-w-md border-l border-gray-100 dark:border-gray-700",children:e.jsx("div",{className:"h-full overflow-y-auto bg-token-main-surface-primary shadow-xl",children:t})})})})})})]})})}function Pe({clientThreadId:t}){const{rebaseSystemMessageContent:r,showDebugConversationTurns:i}=b(),[a,n]=d.useState(()=>r?JSON.stringify(r,null,2):void 0),[o,c]=d.useState(!!r),s=ue(t,v.getThreadCurrentLeafId(t)),l=xe(s,x=>x.content.content_type===V.SystemContent),u=(l==null?void 0:l.content)??null,j=()=>{n(u?JSON.stringify(u,null,2):"")},g=K(),p=d.useMemo(()=>ge(x=>{try{x?b.setState({rebaseSystemMessageContent:{...JSON.parse(x),content_type:V.SystemContent}}):b.setState({rebaseSystemMessageContent:null}),g.closeAll()}catch{g.danger("The System Message is not valid JSON")}},500),[g]);return d.useEffect(()=>{o?p(a):(p.cancel(),b.setState({rebaseSystemMessageContent:null}))},[p,o,a]),e.jsxs("div",{className:"flex flex-col gap-3 px-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(te,{label:"Enable to apply this system message to the current conversation.",children:e.jsx(S,{id:"enabled",label:"Enabled",checked:o,onChange:x=>c(x.currentTarget.checked)})}),e.jsx(S,{id:"show-internal-conversation-turns",label:"Conversation debug mode",checked:i,onChange:()=>{b.setState({showDebugConversationTurns:!i})}})]}),e.jsx(L,{disabled:!u,className:"mt-2",onClick:j,size:"small",children:"Load active system message"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"System Message"}),e.jsx(Re,{disabled:!o,placeholder:u?"Press `Load active system message` to pre-populate this":"Start a conversation and then press `Load active system message` to pre-populate this",className:"min-h-[75vh] rounded-md border border-gray-400 p-1 font-mono",value:a,onChange:x=>n(x.target.value)})]})]})}const Re=N.textarea`w-full rounded-lg border border-token-border-light bg-token-main-surface-primary text-sm text-token-text-primary focus:border-token-text-primary focus:shadow-none focus:outline-none focus:ring-token-text-primary disabled:bg-token-main-surface-tertiary`;function Fe({clientThreadId:t}){const[r,i]=d.useState([]),a=v.getThreadCurrentLeafId(t),n=v.getThreadConversationTurns(t,a),o=s=>{const u=v.getTree(t).getLeafFromNode(s);v.setThreadCurrentLeafId(t,u.id)},c=s=>{i(l=>[...l,a]),o(s)};return e.jsxs(e.Fragment,{children:[r.length>0&&e.jsxs(L,{className:"absolute left-2 top-2",color:"secondary",onClick:()=>{const s=r[r.length-1];o(s),i(l=>l.slice(0,-1))},children:[e.jsx(ke,{className:"icon-sm"}),"Go back to ",r[r.length-1]]}),e.jsx("div",{className:"flex flex-col items-center gap-4 overflow-auto p-4 text-xs",children:n.map((s,l)=>{const u=s.messages[0].nodeId,j=v.getTree(t),g=l!==0?j.getParent(u):null,p=g!=null?g.children.findIndex(m=>u===m):0,x=g!=null?g.children:[],w=x.slice(0,p),y=x.slice(p+1);let h;switch(s.role){case I.User:h="bg-blue-500";break;case I.Assistant:h="bg-gray-600";break;default:h="bg-gray-400";break}return e.jsxs("div",{className:oe("relative p-2",h),children:[e.jsx("div",{className:"absolute bottom-0 left-0 -ml-2 flex -translate-x-full gap-2 pl-2",children:w.map(m=>e.jsx(J,{variantId:m,onChangeItemInView:c},m))}),e.jsx("div",{className:"absolute left-full top-0 ml-2 flex gap-2 pr-2",children:y.map(m=>e.jsx(J,{variantId:m,onChangeItemInView:c},m))}),e.jsx("div",{className:"flex flex-col gap-2",children:s.messages.map(m=>e.jsxs("div",{className:"h-14 w-32 truncate bg-gray-200 p-1 text-black",children:[e.jsx("div",{className:"font-semibold",children:m.nodeId}),e.jsx("div",{className:"italic text-token-text-tertiary",children:m.message.author.role}),e.jsx("div",{children:se(m.message)})]},m.nodeId))})]},l)})})]})}function J({variantId:t,onChangeItemInView:r}){return e.jsx("button",{className:"w-32 truncate bg-gray-400 p-2 text-black opacity-50 hover:opacity-100",onClick:()=>{r(t)},children:e.jsx("span",{className:"bg-gray-200 p-2",children:t})},t)}const Ie=Q(()=>Z(()=>import("./ik85alr5t5x5hu8g.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])).then(t=>t.DebugModalContents),{ssr:!1}),Le=Q(()=>Z(()=>import("./mn9n803lhy34tzs0.js"),__vite__mapDeps([16,1,2,3,5,6])).then(t=>t.FramesViewer),{ssr:!1});function It(){return e.jsx("button",{"data-testid":"open-debug-sidebar-button",className:"flex h-6 w-6 items-center justify-center rounded-full border border-token-border-light text-xs text-token-text-secondary",onClick:()=>{be.setActiveSidebar("debug")},children:e.jsx(re,{className:"icon-xs"})})}function Ae({children:t,title:r,icon:i,isOpen:a,slideOver:n,onClose:o}){const c=e.jsxs(Be,{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 text-lg font-semibold text-gray-900 dark:text-white",children:[e.jsx(i,{className:"icon-sm"}),r]}),e.jsx("div",{className:"mr-2 mt-2 flex h-7 items-center",children:e.jsx(ie,{onClick:o})})]}),t]});return n?e.jsx(Te,{sidebarOpen:a,onClose:o,children:c}):a?c:null}function Ee({nodes:t,setDebugNodeIndex:r,setFrameSrc:i,conversationId:a}){const n=t.map((o,c)=>{var U;const s=o.message,{role:l,name:u}=s.author,j=u&&u!==l,g=f(s,"metadata.__internal.model_id"),p=f(s,"metadata.__internal.agent.settings.completion_api.engine"),x=f(s,"metadata.__internal.model_experiment_name"),w=f(s,"metadata.__internal.model_experiment_treatment"),y=f(s,"metadata.__internal.normalized_model_side"),h=f(s,"metadata.__internal.alternative_model_selection_rule"),m=f(s,"metadata.__internal.model_experiment_group_name"),_=f(s,"metadata.__internal.model_experiment_group_params"),C=f(s,"metadata.__internal.model_experiment_override"),M=f(s,"metadata.__internal.model_experiment_eval_seq"),D=(U=f(s,"metadata.__internal.raw_tokens"))==null?void 0:U.length,E=f(s,"metadata.request_id"),O=F.getAudio(s),$=F.getAudioAssetPointers(s),ne=F.getFrameAssetPointers(s);return e.jsxs(Ge,{role:"button",onClick:()=>r(c),children:[e.jsxs("div",{className:"text-xs font-semibold uppercase text-token-text-tertiary",children:[l,j&&` (${u})`,s.recipient&&" -> ",ve(s)]}),(s.author.role!==I.System||E)&&e.jsxs("div",{className:"text-xs text-token-text-tertiary",children:[e.jsxs("div",{children:["ID: ",s.id]}),o.id!==s.id&&e.jsxs("div",{children:["UI Node ID: ",o.id]}),e.jsxs("div",{children:["Req ID: ",E||"Reload page to see ID"]})]}),e.jsx("div",{className:"line-clamp-6",children:se(s)}),(D||g||p||x||w||y||h||m||_||C||M)&&e.jsxs("div",{className:"mt-4 w-full self-start rounded-xl bg-blue-200 px-3 py-0.5 text-xs text-black",children:[D!==void 0&&e.jsxs("div",{children:[e.jsx("b",{children:"Tokens Count:"})," ",D]}),g&&e.jsxs("div",{children:[e.jsx("b",{children:"Model ID:"})," ",g]}),p&&e.jsxs("div",{children:[e.jsx("b",{children:"Engine:"})," ",p]}),x&&e.jsxs("div",{children:[e.jsx("b",{children:"Experiment:"})," ",x]}),w&&e.jsxs("div",{children:[e.jsx("b",{children:"Treatment:"})," ",w]}),y&&e.jsxs("div",{children:[e.jsx("b",{children:"Normalized Side:"})," ",y]}),h&&e.jsxs("div",{children:[e.jsx("b",{children:"Alternative Model Rule:"})," ",h]}),m&&e.jsxs("div",{children:[e.jsx("b",{children:"Group Name:"})," ",m]}),_&&e.jsxs("div",{children:[e.jsx("b",{children:"Group Params:"}),e.jsx("div",{children:JSON.stringify(_,null,2)})]}),C&&e.jsxs("div",{children:[e.jsx("b",{children:"Above Params are Overridden By:"})," ",C]}),M&&e.jsxs("div",{children:[e.jsx("b",{children:"Experiment Eval Seq:"})," click to see"]})]}),O.length||$.length?e.jsxs("div",{className:"mt-4 flex flex-col flex-nowrap gap-2",children:[e.jsx(ze,{frameAssets:ne,setFrameSrc:i},c),O.map((T,P)=>e.jsx(k,{audio:T,conversationId:a},P)),$.map((T,P)=>e.jsx(k,{assetPointer:T,conversationId:a},P))]}):null]},s.id)});return e.jsx(qe,{children:n})}const H=t=>e.jsx(we.Input,{...t,inputClassName:"focus:ring-0"});function Oe(){const t=b(),i=De().map(a=>({label:a.name,options:a.options.map(n=>({label:`${n.value} (${n.name})`,value:n.value}))}));return e.jsxs("div",{className:"mt-2 flex flex-col justify-around gap-3 px-4 py-1 text-xs font-semibold",children:[e.jsx(S,{id:"force-paragen",label:"Force Parallel Gen",checked:t.forceParagen,onChange:()=>{b.setState({forceParagen:!t.forceParagen})}}),e.jsx(Ce,{options:i,name:"force-paragen-model",className:"shadow-none dark:text-gray-800",isDisabled:!t.forceParagen,isLoading:i.length===0,value:t.forceParagenModel,isClearable:!0,isMulti:!1,components:{Input:H},onChange:a=>{b.setState({forceParagenModel:a??je})}}),e.jsx(S,{id:"show-paragen-metadata",label:"Show Paragen Metadata",checked:t.showParagenMetadata,onChange:()=>{b.setState({showParagenMetadata:!t.showParagenMetadata})}}),e.jsx("div",{id:"force-use-search-label",children:"Force Use Search:"}),e.jsx(Se,{id:"force-use-search",options:[{label:"Default",value:"default"},{label:"Force",value:"true"},{label:"Disable",value:"false"}],name:"force-use-search",className:"shadow-none dark:text-gray-800",value:t.forceUseSearch==null?{value:"default",label:"Default"}:t.forceUseSearch?{value:"true",label:"Force"}:{value:"false",label:"Disable"},isMulti:!1,components:{Input:H},onChange:a=>{b.setState({forceUseSearch:((a==null?void 0:a.value)??"default")==="default"?null:(a==null?void 0:a.value)==="true"})}}),e.jsx(S,{id:"force-indepth-feedback",label:"Force Indepth Feedback with prompt:",checked:t.forceIndepthFeedback,onChange:()=>{b.setState({forceIndepthFeedback:!t.forceIndepthFeedback})}}),e.jsx(ye,{id:"force-indepth-feedback-prompt",value:t.forceIndepthFeedbackPrompt,disabled:!t.forceIndepthFeedback,className:"font-weight-normal font-mono text-xs",onChange:a=>{b.setState({forceIndepthFeedbackPrompt:a.target.value})}}),e.jsx(S,{id:"force-rate-limit",label:"Force Rate Limit",checked:t.forceRateLimit,onChange:()=>{b.setState({forceRateLimit:!t.forceRateLimit})}}),e.jsx(S,{id:"reset-rate-limit",label:"Reset Rate Limits",checked:t.resetRateLimits,onChange:()=>{b.setState({resetRateLimits:!t.resetRateLimits})}}),e.jsx(te,{label:"Enabling this will show debug conversation messages in the chat",children:e.jsx(S,{id:"show-internal-conversation-turns",label:"Conversation debug mode",checked:t.showDebugConversationTurns,onChange:()=>{b.setState({showDebugConversationTurns:!t.showDebugConversationTurns})}})})]})}const W=N.div`px-3 pb-2 text-xs font-semibold uppercase border-b-2 ${({$isSelected:t})=>t?"border-black dark:border-white":"border-transparent"}`;function Lt({clientThreadId:t,isOpen:r,slideOver:i,onClose:a}){const n=X(),o=Y(),[c,s]=d.useState("conversation");return o!=null&&o.includes("debug")?e.jsx(Ae,{icon:re,title:n.formatMessage(A.debugTitle),isOpen:r,slideOver:i,onClose:a,children:e.jsxs(pe,{orientation:"vertical",defaultValue:c,onValueChange:l=>s(l),children:[e.jsxs(fe,{className:"mb-4 flex items-center justify-center gap-2 px-2 py-1 text-xs",children:[e.jsx(q,{value:"conversation",children:e.jsx(W,{$isSelected:c==="conversation",children:"Conversation"})}),e.jsx(q,{value:"system-message-editor",children:e.jsx(W,{$isSelected:c==="system-message-editor",children:"System Message"})}),!1]}),e.jsx(G,{value:"conversation",children:e.jsx($e,{clientThreadId:t})}),e.jsx(G,{value:"system-message-editor",children:e.jsx(Pe,{clientThreadId:t})}),!1]})}):null}function $e({clientThreadId:t}){var y,h,m,_;const r=X(),i=v.getThreadCurrentLeafId(t),a=me(t,i),[n,o]=d.useState(),c=Y(),s=d.useCallback(()=>{o(void 0)},[]),l=K(),u=d.useCallback(C=>{const M=v.getTree(t);he(M.getTextFromThread(i),l,C)},[i,t,l]),[j,g]=d.useState(!1),[p,x]=d.useState(void 0);return c!=null&&c.includes("debug")?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-2 flex items-center justify-around px-4 py-1 text-xs font-semibold uppercase",children:e.jsx(Ve,{clientThreadId:t,messages:a.map(C=>C.message)})}),!1,e.jsxs("div",{className:"flex items-center justify-around gap-2 px-4 py-1 text-xs font-semibold uppercase",children:[e.jsx("div",{children:e.jsx(_e,{onCopy:u,buttonText:r.formatMessage(A.copyText)})}),e.jsxs("button",{className:"flex items-center justify-center gap-2",onClick:()=>g(!0),children:[e.jsx(Ne,{className:"icon-sm rotate-90"}),"View tree"]})]}),e.jsx(Oe,{}),e.jsx(Ee,{nodes:a,setDebugNodeIndex:o,setFrameSrc:x,conversationId:v.getServerThreadId(t)}),n!==void 0&&e.jsx(R,{type:"success",size:"fullscreen",noPadding:!0,isOpen:!0,onClose:s,children:e.jsx(Ie,{threadId:(h=(y=a[n].message.metadata)==null?void 0:y.__internal)==null?void 0:h.sonic_thread_id,threadUserId:(_=(m=a[n].message.metadata)==null?void 0:m.__internal)==null?void 0:_.sonic_user_id,onClose:s,message:a[n].message})},`DebugMessageModal-${n}`),j&&e.jsx(R,{isOpen:!0,onClose:()=>g(!1),type:"success",size:"custom",noPadding:!0,children:e.jsx(Fe,{clientThreadId:t})},"DebugTreeViewer"),p&&e.jsx(R,{size:"normal",isOpen:!0,onClose:()=>x(void 0),type:"success",children:e.jsx("img",{src:p,alt:"debug image"})},"DebugFrameViewer")]}):null}function Ue(t,r){const i=JSON.stringify({conversation_id:v.getServerThreadId(t),messages:r},null,2),a=new Blob([i],{type:"application/json"}),n=URL.createObjectURL(a),o=document.createElement("a");o.href=n,o.download=`messages-${v.getServerThreadId(t)}.json`,o.click(),URL.revokeObjectURL(n)}function Ve({clientThreadId:t,messages:r}){const i=d.useCallback(()=>{Ue(t,r)},[t,r]);return e.jsx(L,{onClick:i,color:"primary",size:"small",icon:Me,children:e.jsx(le,{...A.downloadRawConversation})})}function ze(t){const[r,i]=d.useState([]),a=ee(),{frameAssets:n}=t;return d.useEffect(()=>{async function o(){const c=n.map(async({image_asset_pointer:s,timestamp:l})=>{const u={asset:s};return{src:(await ae.fetch(a,u)).url,timestamp:l}});return Promise.all(c)}n.length>0&&o().then(i)},[n,a]),e.jsx(Le,{frames:r,setFrameSrc:t.setFrameSrc})}function k(t){const r=k.useAssetPointerSource(t.assetPointer,t.conversationId),i=k.useAudioSource(t.audio),a=r??i,o=de("3230069703").config.value.expirySeconds,[c,s]=d.useState(Date.now()),l=d.useRef(null);return d.useEffect(()=>{const u=setInterval(()=>{l.current&&l.current.currentTime>0&&!l.current.paused&&!l.current.ended&&l.current.readyState>2||s(Date.now())},o*1e3);return()=>clearInterval(u)},[o]),a?e.jsx("audio",{ref:l,controls:!0,src:a,className:"w-full"},c):null}k.useAssetPointerSource=(t,r)=>{const[i,a]=d.useState(null),n=ee();return d.useEffect(()=>{t&&ae.fetch(n,{asset:t,conversationId:r}).then(o=>{a(o.url)})},[n,t,r]),i};k.useAudioSource=t=>{const[r,i]=d.useState(null);return d.useEffect(()=>{if(t){const a=atob(t.payload),n=new Uint8Array(a.length);for(let s=0;s<a.length;s++)n[s]=a.charCodeAt(s);const o=new Blob([n],{type:`audio/${t.format}`}),c=URL.createObjectURL(o);return i(c),()=>{URL.revokeObjectURL(c)}}},[t]),r};const Be=N.div`overflow-y-auto h-full md:w-[250px] lg:w-[300px] xl:w-[350px] 2xl:w-[400px] md:border-l md:border-gray-100 md:dark:border-gray-700 popover bg-token-main-surface-primary`,qe=N.pre`whitespace-pre-wrap text-sm`,Ge=N.div`px-6 py-4 flex flex-col gap-1 hover:bg-gray-50 dark:hover:bg-gray-500/10 cursor-pointer border-b dark:border-white/10 border-gray-200`,A=ce({debugTitle:{id:"DebugSidebar.debugTitle",defaultMessage:"Debug"},copyText:{id:"DebugSidebar.copyText",defaultMessage:"Copy text"},downloadRawConversation:{id:"DebugSidebar.downloadRawConversation",defaultMessage:"Download raw conversation"},uploadRawConversation:{id:"DebugSidebar.uploadRawConversation",defaultMessage:"Upload conversation dump"},closeSidebar:{id:"DebugSidebar.closeSidebar",defaultMessage:"Close sidebar"}});export{$e as DebugConversation,Lt as DebugConversationSidebar,It as OpenDebugSidebarButton,Ae as default,Ue as downloadMessages};
//# sourceMappingURL=khnrket2is6tan0p.js.map
