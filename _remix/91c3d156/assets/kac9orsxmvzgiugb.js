const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/mms1xirc7o4ry3s6.js","assets/nz057gr5epx40qb6.js","assets/dqhf08ckfv2lp5xs.js","assets/root-cpnh8fjk.css","assets/o6zqjewfrbkw2hay.js","assets/f6nleccxr4ywnup7.js","assets/conversation-small-c8xg50op.css","assets/hrmua7ck04du5gd5.js","assets/ebpf4voa5d3vxres.js","assets/m2xe2yz88n6tlr7d.js","assets/n5kib4j70t3pqxea.js","assets/n4ws16xltg8fzmrd.js","assets/el2zb5qo0351dpws.js","assets/jhzaldjay3n7wxoa.js","assets/c03bifv9j0h9ii0w.js","assets/b5617aojn6a04hrd.js","assets/d0g8ptgc5gcqjwyj.js"])))=>i.map(i=>d[i]);
import{j as e,r as d,I as _,c3 as U,a2 as V,ba as P,cH as R,c as re,cu as W,bh as oe,ch as Y,bY as Q,D as X,av as Z,E as T,G as le,H as ie,eG as h,cX as F,eH as ce,z as ee,af as de}from"./nz057gr5epx40qb6.js";import{x as ue,T as v,y as me}from"./b4ts5qdk2jq98v1f.js";import"./krtedq8xntik1fg1.js";import{dY as z,dZ as B,d_ as b,bN as xe,n as ge,f as se,I as C,U as be,$ as fe,B as he,D as G,E as q,F as pe,d$ as ve,e0 as te}from"./f6nleccxr4ywnup7.js";import{c as je}from"./e9gjmrjckmf42xbu.js";import{S as ye,c as Se}from"./kc89oodk0sk77ka3.js";import{C as Ce}from"./cgghuaa24szqnjmw.js";import{C as we}from"./o6zqjewfrbkw2hay.js";import{aC as Ne,aE as ae,av as _e,P as ke}from"./dqhf08ckfv2lp5xs.js";import{_ as De}from"./mrskscr5a3nc8aoq.js";import"./bdsajzly1t5b3gkr.js";import"./hcl0k169m8va9obe.js";import"./bcvw67fsdxcvkge5.js";import"./k8fdk47wxcl0vnjb.js";import"./ousohe1aim2swyoh.js";import"./b10b76bo4mu9ak9c.js";import"./ebpf4voa5d3vxres.js";import"./buke0enxngxxdhhb.js";import"./lq5ec0gb81oney03.js";import"./hx27mv2bj8by6eih.js";import"./fcwae0uiwnje0qo4.js";import"./l6vavy2gxcrpbnvj.js";import"./pdswpibrq44hekis.js";import"./bsqwwe729de7dwl2.js";import"./n5kib4j70t3pqxea.js";import"./jcpkfm9amz7vnhtf.js";import"./mxm0v27vn1qixg7x.js";import"./b95igggbmy84kcf7.js";import"./i4g5jnt5psyi2pc3.js";function Me({children:s,sidebarOpen:n,onClose:o}){return e.jsx(z.Root,{show:n,as:d.Fragment,children:e.jsxs(B,{as:"div",className:"relative z-10",onClose:o,children:[e.jsx("div",{className:"fixed inset-0"}),e.jsx("div",{className:"fixed inset-0 overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 overflow-hidden",children:e.jsx("div",{className:"pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-10",children:e.jsx(z.Child,{as:d.Fragment,enter:"transform transition ease-in-out duration-100 sm:duration-300",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"transform transition ease-in-out duration-300 sm:duration-500",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",children:e.jsx(B.Panel,{className:"pointer-events-auto w-screen max-w-md border-l border-gray-100 dark:border-gray-700",children:e.jsx("div",{className:"h-full overflow-y-auto bg-token-main-surface-primary shadow-xl",children:s})})})})})})]})})}function Te({clientThreadId:s}){const{rebaseSystemMessageContent:n,showDebugConversationTurns:o}=b(),[t,r]=d.useState(()=>n?JSON.stringify(n,null,2):void 0),[l,a]=d.useState(!!n),i=ue(s,v.getThreadCurrentLeafId(s)),c=xe(i,m=>m.content.content_type===U.SystemContent),x=(c==null?void 0:c.content)??null,f=()=>{r(x?JSON.stringify(x,null,2):"")},g=d.useMemo(()=>ge(m=>{try{m?b.setState({rebaseSystemMessageContent:{...JSON.parse(m),content_type:U.SystemContent}}):b.setState({rebaseSystemMessageContent:null}),V.closeAll()}catch{V.danger("The System Message is not valid JSON")}},500),[]);return d.useEffect(()=>{l?g(t):(g.cancel(),b.setState({rebaseSystemMessageContent:null}))},[g,l,t]),e.jsxs("div",{className:"flex flex-col gap-3 px-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(se,{label:"Enable to apply this system message to the current conversation.",children:e.jsx(C,{id:"enabled",label:"Enabled",checked:l,onChange:m=>a(m.currentTarget.checked)})}),e.jsx(C,{id:"show-internal-conversation-turns",label:"Conversation debug mode",checked:o,onChange:()=>{b.setState({showDebugConversationTurns:!o})}})]}),e.jsx(P,{disabled:!x,className:"mt-2",onClick:f,size:"small",children:"Load active system message"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"System Message"}),e.jsx(Fe,{disabled:!l,placeholder:x?"Press `Load active system message` to pre-populate this":"Start a conversation and then press `Load active system message` to pre-populate this",className:"min-h-[75vh] rounded-md border border-gray-400 p-1 font-mono",value:t,onChange:m=>r(m.target.value)})]})]})}const Fe=_.textarea`w-full rounded-lg border border-token-border-light bg-token-main-surface-primary text-sm text-token-text-primary focus:border-token-text-primary focus:shadow-none focus:outline-none focus:ring-token-text-primary disabled:bg-token-main-surface-tertiary`;function Re({clientThreadId:s}){const[n,o]=d.useState([]),t=v.getThreadCurrentLeafId(s),r=v.getThreadConversationTurns(s,t),l=i=>{const x=v.getTree(s).getLeafFromNode(i);v.setThreadCurrentLeafId(s,x.id)},a=i=>{o(c=>[...c,t]),l(i)};return e.jsxs(e.Fragment,{children:[n.length>0&&e.jsxs(P,{className:"absolute left-2 top-2",color:"secondary",onClick:()=>{const i=n[n.length-1];l(i),o(c=>c.slice(0,-1))},children:[e.jsx(Ne,{className:"icon-sm"}),"Go back to ",n[n.length-1]]}),e.jsx("div",{className:"flex flex-col items-center gap-4 overflow-auto p-4 text-xs",children:r.map((i,c)=>{const x=i.messages[0].nodeId,f=v.getTree(s),g=c!==0?f.getParent(x):null,m=g!=null?g.children.findIndex(u=>x===u):0,j=g!=null?g.children:[],y=j.slice(0,m),S=j.slice(m+1);let p;switch(i.role){case R.User:p="bg-blue-500";break;case R.Assistant:p="bg-gray-600";break;default:p="bg-gray-400";break}return e.jsxs("div",{className:re("relative p-2",p),children:[e.jsx("div",{className:"absolute bottom-0 left-0 -ml-2 flex -translate-x-full gap-2 pl-2",children:y.map(u=>e.jsx(J,{variantId:u,onChangeItemInView:a},u))}),e.jsx("div",{className:"absolute left-full top-0 ml-2 flex gap-2 pr-2",children:S.map(u=>e.jsx(J,{variantId:u,onChangeItemInView:a},u))}),e.jsx("div",{className:"flex flex-col gap-2",children:i.messages.map(u=>e.jsxs("div",{className:"h-14 w-32 truncate bg-gray-200 p-1 text-black",children:[e.jsx("div",{className:"font-semibold",children:u.nodeId}),e.jsx("div",{className:"italic text-token-text-tertiary",children:u.message.author.role}),e.jsx("div",{children:W(u.message)})]},u.nodeId))})]},c)})})]})}function J({variantId:s,onChangeItemInView:n}){return e.jsx("button",{className:"w-32 truncate bg-gray-400 p-2 text-black opacity-50 hover:opacity-100",onClick:()=>{n(s)},children:e.jsx("span",{className:"bg-gray-200 p-2",children:s})},s)}const Pe=Y(()=>Q(()=>import("./mms1xirc7o4ry3s6.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14])).then(s=>s.DebugModalContents),{ssr:!1}),Ie=Y(()=>Q(()=>import("./b5617aojn6a04hrd.js"),__vite__mapDeps([15,1,2,3,16])).then(s=>s.FramesViewer),{ssr:!1});function js(){return e.jsx("button",{"data-testid":"open-debug-sidebar-button",className:"flex h-6 w-6 items-center justify-center rounded-full border border-token-border-light text-xs text-token-text-secondary",onClick:()=>{be.setActiveSidebar("debug")},children:e.jsx(ae,{className:"icon-xs"})})}function Le({children:s,title:n,icon:o,isOpen:t,slideOver:r,onClose:l}){const a=e.jsxs(ze,{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 text-lg font-semibold text-gray-900 dark:text-white",children:[e.jsx(o,{className:"icon-sm"}),n]}),e.jsx("div",{className:"mr-2 mt-2 flex h-7 items-center",children:e.jsx(oe,{onClick:l})})]}),s]});return r?e.jsx(Me,{sidebarOpen:t,onClose:l,children:a}):t?a:null}function Ae({nodes:s,setDebugNodeIndex:n,setFrameSrc:o}){const t=s.map((r,l)=>{var O;const a=r.message,{role:i,name:c}=a.author,x=c&&c!==i,f=h(a,"metadata.__internal.model_id"),g=h(a,"metadata.__internal.agent.settings.completion_api.engine"),m=h(a,"metadata.__internal.model_experiment_name"),j=h(a,"metadata.__internal.model_experiment_treatment"),y=h(a,"metadata.__internal.normalized_model_side"),S=h(a,"metadata.__internal.alternative_model_selection_rule"),p=h(a,"metadata.__internal.model_experiment_group_name"),u=h(a,"metadata.__internal.model_experiment_group_params"),w=h(a,"metadata.__internal.model_experiment_override"),L=h(a,"metadata.__internal.model_experiment_eval_seq"),k=(O=h(a,"metadata.__internal.raw_tokens"))==null?void 0:O.length,A=h(a,"metadata.request_id"),E=F.getAudio(a),$=F.getAudioAssetPointers(a),ne=F.getFrameAssetPointers(a);return e.jsxs(Ge,{role:"button",onClick:()=>n(l),children:[e.jsxs("div",{className:"text-xs font-semibold uppercase text-token-text-tertiary",children:[i,x&&` (${c})`,a.recipient&&" -> ",ce(a)]}),(a.author.role!==R.System||A)&&e.jsxs("div",{className:"text-xs text-token-text-tertiary",children:[e.jsxs("div",{children:["ID: ",a.id]}),r.id!==a.id&&e.jsxs("div",{children:["UI Node ID: ",r.id]}),e.jsxs("div",{children:["Req ID: ",A||"Reload page to see ID"]})]}),e.jsx("div",{className:"line-clamp-6",children:W(a)}),(k||f||g||m||j||y||S||p||u||w||L)&&e.jsxs("div",{className:"mt-4 w-full self-start rounded-xl bg-blue-200 px-3 py-0.5 text-xs text-black",children:[k!==void 0&&e.jsxs("div",{children:[e.jsx("b",{children:"Tokens Count:"})," ",k]}),f&&e.jsxs("div",{children:[e.jsx("b",{children:"Model ID:"})," ",f]}),g&&e.jsxs("div",{children:[e.jsx("b",{children:"Engine:"})," ",g]}),m&&e.jsxs("div",{children:[e.jsx("b",{children:"Experiment:"})," ",m]}),j&&e.jsxs("div",{children:[e.jsx("b",{children:"Treatment:"})," ",j]}),y&&e.jsxs("div",{children:[e.jsx("b",{children:"Normalized Side:"})," ",y]}),S&&e.jsxs("div",{children:[e.jsx("b",{children:"Alternative Model Rule:"})," ",S]}),p&&e.jsxs("div",{children:[e.jsx("b",{children:"Group Name:"})," ",p]}),u&&e.jsxs("div",{children:[e.jsx("b",{children:"Group Params:"}),e.jsx("div",{children:JSON.stringify(u,null,2)})]}),w&&e.jsxs("div",{children:[e.jsx("b",{children:"Above Params are Overridden By:"})," ",w]}),L&&e.jsxs("div",{children:[e.jsx("b",{children:"Experiment Eval Seq:"})," click to see"]})]}),E.length||$.length?e.jsxs("div",{className:"mt-4 flex flex-col flex-nowrap gap-2",children:[e.jsx(Ve,{frameAssets:ne,setFrameSrc:o},l),E.map((D,M)=>e.jsx(N,{audio:D},M)),$.map((D,M)=>e.jsx(N,{assetPointer:D},M))]}):null]},a.id)});return e.jsx(Be,{children:t})}const H=s=>e.jsx(Se.Input,{...s,inputClassName:"focus:ring-0"});function Ee(){const s=b(),o=De().map(t=>({label:t.name,options:t.options.map(r=>({label:`${r.value} (${r.name})`,value:r.value}))}));return e.jsxs("div",{className:"mt-2 flex flex-col justify-around gap-3 px-4 py-1 text-xs font-semibold",children:[e.jsx(C,{id:"force-paragen",label:"Force Parallel Gen",checked:s.forceParagen,onChange:()=>{b.setState({forceParagen:!s.forceParagen})}}),e.jsx(Ce,{options:o,name:"force-paragen-model",className:"shadow-none dark:text-gray-800",isDisabled:!s.forceParagen,isLoading:o.length===0,value:s.forceParagenModel,isClearable:!0,isMulti:!1,components:{Input:H},onChange:t=>{b.setState({forceParagenModel:t??ve})}}),e.jsx(C,{id:"force-paragen",label:"Force Nulligen",checked:s.forceNulligen,onChange:()=>{b.setState({forceNulligen:!s.forceNulligen})}}),e.jsx("div",{id:"force-use-search-label",children:"Force Use Search:"}),e.jsx(ye,{id:"force-use-search",options:[{label:"Default",value:"default"},{label:"Force",value:"true"},{label:"Disable",value:"false"}],name:"force-use-search",className:"shadow-none dark:text-gray-800",value:s.forceUseSearch==null?{value:"default",label:"Default"}:s.forceUseSearch?{value:"true",label:"Force"}:{value:"false",label:"Disable"},isMulti:!1,components:{Input:H},onChange:t=>{b.setState({forceUseSearch:((t==null?void 0:t.value)??"default")==="default"?null:(t==null?void 0:t.value)==="true"})}}),e.jsx(C,{id:"force-indepth-feedback",label:"Force Indepth Feedback with prompt:",checked:s.forceIndepthFeedback,onChange:()=>{b.setState({forceIndepthFeedback:!s.forceIndepthFeedback})}}),e.jsx(je,{id:"force-indepth-feedback-prompt",value:s.forceIndepthFeedbackPrompt,disabled:!s.forceIndepthFeedback,className:"font-weight-normal font-mono text-xs",onChange:t=>{b.setState({forceIndepthFeedbackPrompt:t.target.value})}}),e.jsx(C,{id:"force-rate-limit",label:"Force Rate Limit",checked:s.forceRateLimit,onChange:()=>{b.setState({forceRateLimit:!s.forceRateLimit})}}),e.jsx(C,{id:"reset-rate-limit",label:"Reset Rate Limits",checked:s.resetRateLimits,onChange:()=>{b.setState({resetRateLimits:!s.resetRateLimits})}}),e.jsx(se,{label:"Enabling this will show debug conversation messages in the chat",children:e.jsx(C,{id:"show-internal-conversation-turns",label:"Conversation debug mode",checked:s.showDebugConversationTurns,onChange:()=>{b.setState({showDebugConversationTurns:!s.showDebugConversationTurns})}})})]})}const K=_.div`px-3 pb-2 text-xs font-semibold uppercase border-b-2 ${({$isSelected:s})=>s?"border-black dark:border-white":"border-transparent"}`;function ys({clientThreadId:s,isOpen:n,slideOver:o,onClose:t}){const r=X(),l=Z(),[a,i]=d.useState("conversation");return l!=null&&l.includes("debug")?e.jsx(Le,{icon:ae,title:r.formatMessage(I.debugTitle),isOpen:n,slideOver:o,onClose:t,children:e.jsxs(fe,{orientation:"vertical",defaultValue:a,onValueChange:c=>i(c),children:[e.jsxs(he,{className:"flex items-center justify-center gap-2 px-4 py-1 text-xs font-semibold",children:[e.jsx(G,{value:"conversation",children:e.jsx(K,{$isSelected:a==="conversation",children:"Conversation"})}),e.jsx(G,{value:"system-message-editor",className:"p-4",children:e.jsx(K,{$isSelected:a==="system-message-editor",children:"System Message Editor"})})]}),e.jsx(q,{value:"conversation",children:e.jsx($e,{clientThreadId:s})}),e.jsx(q,{value:"system-message-editor",children:e.jsx(Te,{clientThreadId:s})})]})}):null}function $e({clientThreadId:s}){var y,S,p,u;const n=X(),o=v.getThreadCurrentLeafId(s),t=me(s,o),[r,l]=d.useState(),a=Z(),i=d.useCallback(()=>{l(void 0)},[]),c=d.useCallback(()=>{const w=v.getTree(s);pe(w.getTextFromThread(o))},[o,s]),[x,f]=d.useState(!1),[g,m]=d.useState(void 0);return a!=null&&a.includes("debug")?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-2 flex items-center justify-around px-4 py-1 text-xs font-semibold uppercase",children:e.jsx(Ue,{clientThreadId:s,messages:t.map(w=>w.message)})}),!1,e.jsxs("div",{className:"flex items-center justify-around gap-2 px-4 py-1 text-xs font-semibold uppercase",children:[e.jsx("div",{children:e.jsx(we,{onCopy:c,buttonText:n.formatMessage(I.copyText)})}),e.jsxs("button",{className:"flex items-center justify-center gap-2",onClick:()=>f(!0),children:[e.jsx(_e,{className:"icon-sm rotate-90"}),"View tree"]})]}),e.jsx(Ee,{}),e.jsx(Ae,{nodes:t,setDebugNodeIndex:l,setFrameSrc:m}),r!==void 0&&e.jsx(T,{type:"success",size:"fullscreen",noPadding:!0,isOpen:!0,onClose:i,children:e.jsx(Pe,{threadId:(S=(y=t[r].message.metadata)==null?void 0:y.__internal)==null?void 0:S.sonic_thread_id,threadUserId:(u=(p=t[r].message.metadata)==null?void 0:p.__internal)==null?void 0:u.sonic_user_id,onClose:i,message:t[r].message})},`DebugMessageModal-${r}`),x&&e.jsx(T,{isOpen:!0,onClose:()=>f(!1),type:"success",size:"custom",noPadding:!0,children:e.jsx(Re,{clientThreadId:s})},"DebugTreeViewer"),g&&e.jsx(T,{size:"normal",isOpen:!0,onClose:()=>m(void 0),type:"success",children:e.jsx("img",{src:g,alt:"debug image"})},"DebugFrameViewer")]}):null}function Oe(s,n){const o=JSON.stringify({conversation_id:v.getServerThreadId(s),messages:n},null,2),t=new Blob([o],{type:"application/json"}),r=URL.createObjectURL(t),l=document.createElement("a");l.href=r,l.download=`messages-${v.getServerThreadId(s)}.json`,l.click(),URL.revokeObjectURL(r)}function Ue({clientThreadId:s,messages:n}){const o=d.useCallback(()=>{Oe(s,n)},[s,n]);return e.jsx(P,{onClick:o,color:"primary",size:"small",icon:ke,children:e.jsx(le,{...I.downloadRawConversation})})}function Ve(s){const[n,o]=d.useState([]),t=ee(),{frameAssets:r}=s;return d.useEffect(()=>{async function l(){const a=r.map(async({image_asset_pointer:i,timestamp:c})=>{const x={asset:i};return{src:(await te.fetch(t,x)).url,timestamp:c}});return Promise.all(a)}r.length>0&&l().then(o)},[r,t]),e.jsx(Ie,{frames:n,setFrameSrc:s.setFrameSrc})}function N(s){const n=N.useAssetPointerSource(s.assetPointer),o=N.useAudioSource(s.audio),t=n??o,l=de("3230069703").config.value.expirySeconds,[a,i]=d.useState(Date.now()),c=d.useRef(null);return d.useEffect(()=>{const x=setInterval(()=>{c.current&&c.current.currentTime>0&&!c.current.paused&&!c.current.ended&&c.current.readyState>2||i(Date.now())},l*1e3);return()=>clearInterval(x)},[l]),t?e.jsx("audio",{ref:c,controls:!0,src:t,className:"w-full"},a):null}N.useAssetPointerSource=s=>{const[n,o]=d.useState(null),t=ee();return d.useEffect(()=>{s&&te.fetch(t,{asset:s}).then(r=>{o(r.url)})},[t,s]),n};N.useAudioSource=s=>{const[n,o]=d.useState(null);return d.useEffect(()=>{if(s){const t=atob(s.payload),r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);const l=new Blob([r],{type:`audio/${s.format}`}),a=URL.createObjectURL(l);return o(a),()=>{URL.revokeObjectURL(a)}}},[s]),n};const ze=_.div`overflow-y-auto h-full md:w-[250px] lg:w-[300px] xl:w-[350px] 2xl:w-[400px] md:border-l md:border-gray-100 md:dark:border-gray-700 popover bg-token-main-surface-primary`,Be=_.pre`whitespace-pre-wrap text-sm`,Ge=_.div`px-6 py-4 flex flex-col gap-1 hover:bg-gray-50 dark:hover:bg-gray-500/10 cursor-pointer border-b dark:border-white/10 border-gray-200`,I=ie({debugTitle:{id:"DebugSidebar.debugTitle",defaultMessage:"Debug"},copyText:{id:"DebugSidebar.copyText",defaultMessage:"Copy text"},downloadRawConversation:{id:"DebugSidebar.downloadRawConversation",defaultMessage:"Download raw conversation"},uploadRawConversation:{id:"DebugSidebar.uploadRawConversation",defaultMessage:"Upload conversation dump"},closeSidebar:{id:"DebugSidebar.closeSidebar",defaultMessage:"Close sidebar"}});export{$e as DebugConversation,ys as DebugConversationSidebar,js as OpenDebugSidebarButton,Le as default,Oe as downloadMessages};
//# sourceMappingURL=kac9orsxmvzgiugb.js.map
