const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/h4ipvn8hldmmrslc.js","assets/igmsoa7ir4is8dpb.js","assets/hbay3om4ggoz07k5.js","assets/mcjxbkmf3g1q207d.js","assets/c7sgref9mfwezh7s.js","assets/l3hptpare9m1mqfv.js","assets/km9gro7xi1t4gs2t.js","assets/root-pbd7dlk8.css","assets/conversation-small-ict01xsi.css","assets/dpmpp4vjdzk6xdj4.js","assets/ds7myuf7nkx8b20x.js","assets/bkgevi7dwlpkqxzf.js","assets/ev3ca23urw2rf3h9.js","assets/i4jzjalmx9h3noc6.js","assets/mh08vel4sd7gl5e4.js","assets/o8pwa9djmd3woe3v.js","assets/gef2pkbm9t7u9jaf.js","assets/o71ynssks3gq9sk8.js","assets/bsywfsy5tkh0mk4a.js","assets/j8l5f95d43kfn123.js","assets/m55lizayp80mdb2a.js","assets/batv2cgjogg0gfks.js","assets/b2qyk9ne7ya27cgn.js","assets/ns424vb18pd1zgzy.js","assets/nwaf22xbmqth897a.js","assets/f0ls4t57n79bcxom.js","assets/fclxdwisbgu7djib.js","assets/mnnohn664kljhdh9.js","assets/ci5kiwa8ad5lk6br.js","assets/bm5qthmfawg2rqof.js"])))=>i.map(i=>d[i]);
import{aG as N,bc as ut,i as ao,g as io,fL as co,a6 as u,ar as M,n as te,r as v,aj as Me,fu as lo,b as dt,aL as uo,cJ as ft,at as R,bF as fo,aw as mt}from"./l3hptpare9m1mqfv.js";import{p$ as _,n7 as mo,q0 as le,jN as B,q1 as pt,q2 as gt,jM as ge,bA as X,g9 as j,bz as ht,f_ as oe,ee as po,c$ as vt,q3 as D,k0 as W,jV as Pe,q4 as go,q5 as ho,q6 as vo,ly as Fe,gi as He,jP as $e,$ as Co,b as xo,f as Eo,g as yo,d as bo,gb as _o,lB as No,gc as To}from"./c7sgref9mfwezh7s.js";import{c as Po,S as So,H as Io,x as ko,t as m}from"./hbay3om4ggoz07k5.js";import{E as Ao,a2 as re,a1 as Y,C as O,a3 as he,a4 as Mo,a5 as ve,a6 as Ye,b as Ro,u as wo,e as Oo,a7 as Lo,_ as V,a8 as Ct,S as xt}from"./mcjxbkmf3g1q207d.js";import{m as L}from"./mh08vel4sd7gl5e4.js";import{c8 as jo,c9 as Do,ac as Bo,b as Go,ca as Vo}from"./km9gro7xi1t4gs2t.js";import{d as Fo}from"./j6n14by4mv1mn19j.js";import{T as Ho,P as Et,f as $o,c as Yo,i as Uo,e as Ko,D as Ue,d as yt}from"./gef2pkbm9t7u9jaf.js";import{u as zo}from"./l6y8nur0rcsuz3d2.js";import{i as Xo}from"./kt2wzbpt1cq6zkgh.js";const Wo="_modelCursor_1mtn0_1",_s={modelCursor:Wo},qo=(...e)=>o=>{e.forEach(t=>{if(typeof t=="function")t(o);else if(t){const n=t;n.current=o}})};function k(e){return new Po(So.define(e))}const Ke=()=>N(()=>import("./pbl95wx6493wq92j.js"),[]).then(e=>k(e.shell)),bt={[_.bash]:Ke,[_.zsh]:Ke,[_.swift]:()=>N(()=>import("./pijqfo56g5y7ss6b.js"),[]).then(e=>k(e.swift)),[_.css]:()=>N(()=>import("./h4ipvn8hldmmrslc.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16])).then(e=>e.css()),[_.html]:()=>N(()=>import("./o71ynssks3gq9sk8.js"),__vite__mapDeps([17,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,0,18])).then(e=>e.html()),[_.javascript]:()=>N(()=>import("./bsywfsy5tkh0mk4a.js"),__vite__mapDeps([18,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16])).then(e=>e.javascript({jsx:!0,typescript:!1})),[_.typescript]:()=>N(()=>import("./bsywfsy5tkh0mk4a.js"),__vite__mapDeps([18,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16])).then(e=>e.javascript({jsx:!0,typescript:!0})),[_.json]:()=>N(()=>import("./j8l5f95d43kfn123.js"),__vite__mapDeps([19,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16])).then(e=>e.json()),[_.python]:()=>N(()=>import("./m55lizayp80mdb2a.js"),__vite__mapDeps([20,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16])).then(e=>e.python()),[_.sql]:()=>N(()=>import("./batv2cgjogg0gfks.js"),__vite__mapDeps([21,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,1])).then(e=>e.sql()),[_.go]:()=>N(()=>import("./b2qyk9ne7ya27cgn.js"),__vite__mapDeps([22,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16])).then(e=>e.go()),[_.yaml]:()=>N(()=>import("./ns424vb18pd1zgzy.js"),__vite__mapDeps([23,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16])).then(e=>e.yaml()),[_.java]:()=>N(()=>import("./nwaf22xbmqth897a.js"),__vite__mapDeps([24,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16])).then(e=>e.java()),[_.rust]:()=>N(()=>import("./f0ls4t57n79bcxom.js"),__vite__mapDeps([25,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16])).then(e=>e.rust()),[_.cpp]:()=>N(()=>import("./fclxdwisbgu7djib.js"),__vite__mapDeps([26,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16])).then(e=>e.cpp()),[_.php]:()=>N(()=>import("./mnnohn664kljhdh9.js"),__vite__mapDeps([27,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,0,18])).then(e=>e.php()),[_.xml]:()=>N(()=>import("./ci5kiwa8ad5lk6br.js"),__vite__mapDeps([28,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16])).then(e=>e.xml()),[_.vue]:()=>N(()=>import("./bm5qthmfawg2rqof.js"),__vite__mapDeps([29,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,1,0,18])).then(e=>e.vue()),[_.ruby]:()=>N(()=>import("./e4lhyu305wu0fcut.js"),[]).then(e=>k(e.ruby)),[_.haskell]:()=>N(()=>import("./bf6r3t2rw7f01so5.js"),[]).then(e=>k(e.haskell)),[_.kotlin]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>k(e.kotlin)),[_.csharp]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>k(e.csharp)),[_.c]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>k(e.c)),[_.objectivec]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>k(e.objectiveC)),[_.r]:()=>N(()=>import("./n0t2rpizlasjzcxa.js"),[]).then(e=>k(e.r)),[_.lua]:()=>N(()=>import("./harowmpdmpnd9wki.js"),[]).then(e=>k(e.lua)),[_.dart]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>k(e.dart)),[_.scala]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>k(e.scala)),[_.perl]:()=>N(()=>import("./gq1ss5v2zpbborxl.js"),[]).then(e=>k(e.perl)),[_.commonlisp]:()=>N(()=>import("./jr6cjysmysifr6mr.js"),[]).then(e=>k(e.commonLisp)),[_.clojure]:()=>N(()=>import("./gf1tfl9d2himhfic.js"),[]).then(e=>k(e.clojure)),[_.ocaml]:()=>N(()=>import("./khji33iw1sxityyt.js"),[]).then(e=>k(e.oCaml)),[_.powershell]:()=>N(()=>import("./i9u5kd7kvamutmln.js"),[]).then(e=>k(e.powerShell)),[_.verilog]:()=>N(()=>import("./fix340p09fldyqxz.js"),[]).then(e=>k(e.verilog)),[_.dockerfile]:()=>N(()=>import("./cgm5tyzi32u32j10.js"),[]).then(e=>k(e.dockerFile)),[_.other]:()=>null},Jo=e=>e in bt,ue={},Ns=async e=>{if(ue[e]!=null)return ue[e];if(Jo(e)){const o=await bt[e]();return ue[e]=o,o}return null},Ts=e=>ue[e]??null;var _t=e=>{var{theme:o,settings:t={},styles:n=[]}=e,r={".cm-gutters":{}},s={};t.background&&(s.backgroundColor=t.background),t.backgroundImage&&(s.backgroundImage=t.backgroundImage),t.foreground&&(s.color=t.foreground),t.fontSize&&(s.fontSize=t.fontSize),(t.background||t.foreground)&&(r["&"]=s),t.fontFamily&&(r["&.cm-editor .cm-scroller"]={fontFamily:t.fontFamily}),t.gutterBackground&&(r[".cm-gutters"].backgroundColor=t.gutterBackground),t.gutterForeground&&(r[".cm-gutters"].color=t.gutterForeground),t.gutterBorder&&(r[".cm-gutters"].borderRightColor=t.gutterBorder),t.caret&&(r[".cm-content"]={caretColor:t.caret},r[".cm-cursor, .cm-dropCursor"]={borderLeftColor:t.caret});var a={};t.gutterActiveForeground&&(a.color=t.gutterActiveForeground),t.lineHighlight&&(r[".cm-activeLine"]={backgroundColor:t.lineHighlight},a.backgroundColor=t.lineHighlight),r[".cm-activeLineGutter"]=a,t.selection&&(r["&.cm-focused .cm-selectionBackground, & .cm-line::selection, & .cm-selectionLayer .cm-selectionBackground, .cm-content ::selection"]={background:t.selection+" !important"}),t.selectionMatch&&(r["& .cm-selectionMatch"]={backgroundColor:t.selectionMatch});var i=Ao.theme(r,{dark:o==="dark"}),c=Io.define(n),l=[i,ko(c)];return l},Zo={background:"#ffffff",foreground:"#383a42",caret:"#000",selection:"#add6ff",selectionMatch:"#a8ac94",lineHighlight:"#f0f0f0",gutterBackground:"#fff",gutterForeground:"#237893",gutterActiveForeground:"#0b216f",fontFamily:'Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace'},Qo=[{tag:[m.keyword,m.operatorKeyword,m.modifier,m.color,m.constant(m.name),m.standard(m.name),m.standard(m.tagName),m.special(m.brace),m.atom,m.bool,m.special(m.variableName)],color:"#0000ff"},{tag:[m.moduleKeyword,m.controlKeyword],color:"#af00db"},{tag:[m.name,m.deleted,m.character,m.macroName,m.propertyName,m.variableName,m.labelName,m.definition(m.name)],color:"#0070c1"},{tag:m.heading,fontWeight:"bold",color:"#0070c1"},{tag:[m.typeName,m.className,m.tagName,m.number,m.changed,m.annotation,m.self,m.namespace],color:"#267f99"},{tag:[m.function(m.variableName),m.function(m.propertyName)],color:"#795e26"},{tag:[m.number],color:"#098658"},{tag:[m.operator,m.punctuation,m.separator,m.url,m.escape,m.regexp],color:"#383a42"},{tag:[m.regexp],color:"#af00db"},{tag:[m.special(m.string),m.processingInstruction,m.string,m.inserted],color:"#a31515"},{tag:[m.angleBracket],color:"#383a42"},{tag:m.strong,fontWeight:"bold"},{tag:m.emphasis,fontStyle:"italic"},{tag:m.strikethrough,textDecoration:"line-through"},{tag:[m.meta,m.comment],color:"#008000"},{tag:m.link,color:"#4078f2",textDecoration:"underline"},{tag:m.invalid,color:"#e45649"}];function en(e){var{theme:o="dark",settings:t={},styles:n=[]}=e||{};return _t({theme:o,settings:ut({},Zo,t),styles:[...Qo,...n]})}var Ps=en(),tn={background:"#1e1e1e",foreground:"#9cdcfe",caret:"#c6c6c6",selection:"#6199ff2f",selectionMatch:"#72a1ff59",lineHighlight:"#ffffff0f",gutterBackground:"#1e1e1e",gutterForeground:"#838383",gutterActiveForeground:"#fff",fontFamily:'Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace'},on=[{tag:[m.keyword,m.operatorKeyword,m.modifier,m.color,m.constant(m.name),m.standard(m.name),m.standard(m.tagName),m.special(m.brace),m.atom,m.bool,m.special(m.variableName)],color:"#569cd6"},{tag:[m.controlKeyword,m.moduleKeyword],color:"#c586c0"},{tag:[m.name,m.deleted,m.character,m.macroName,m.propertyName,m.variableName,m.labelName,m.definition(m.name)],color:"#9cdcfe"},{tag:m.heading,fontWeight:"bold",color:"#9cdcfe"},{tag:[m.typeName,m.className,m.tagName,m.number,m.changed,m.annotation,m.self,m.namespace],color:"#4ec9b0"},{tag:[m.function(m.variableName),m.function(m.propertyName)],color:"#dcdcaa"},{tag:[m.number],color:"#b5cea8"},{tag:[m.operator,m.punctuation,m.separator,m.url,m.escape,m.regexp],color:"#d4d4d4"},{tag:[m.regexp],color:"#d16969"},{tag:[m.special(m.string),m.processingInstruction,m.string,m.inserted],color:"#ce9178"},{tag:[m.angleBracket],color:"#808080"},{tag:m.strong,fontWeight:"bold"},{tag:m.emphasis,fontStyle:"italic"},{tag:m.strikethrough,textDecoration:"line-through"},{tag:[m.meta,m.comment],color:"#6a9955"},{tag:m.link,color:"#6a9955",textDecoration:"underline"},{tag:m.invalid,color:"#ff0000"}];function nn(e){var{theme:o="dark",settings:t={},styles:n=[]}=e||{};return _t({theme:o,settings:ut({},tn,t),styles:[...on,...n]})}var Ss=nn(),rn=ao;function sn(e){return typeof e=="function"?e:rn}var an=sn,cn=co,ln=an,un=mo,dn=9007199254740991,_e=4294967295,fn=Math.min;function mn(e,o){if(e=un(e),e<1||e>dn)return[];var t=_e,n=fn(e,_e);o=ln(o),e-=_e;for(var r=cn(n,o);++t<e;)o(t);return r}var pn=mn;const gn=io(pn),hn=e=>u.jsx(L.div,{className:"dark:bg-white-400 aspect-square rounded-full bg-gray-400",animate:{translateY:["0%","-50%","0%","0%","0%"]},style:{translateX:.5,width:3,height:3},transition:{repeat:1/0,type:"keyframes",delay:e/10,duration:.7}},e),vn=()=>u.jsx(L.div,{className:"grid h-full max-w-full flex-1 grid-cols-3 items-center gap-[0.4] p-1",children:gn(3,e=>hn(e))});function Cn(e){switch(e){case"dark_gray":return{normal:"text-token-text-secondary dark:text-white-400",hover:"cursor-pointer hover:text-token-text-primary group-hover:text-token-text-primary"};case"light_gray":return{normal:"text-gray-400",hover:"cursor-pointer hover:text-token-text-secondary group-hover:text-token-text-secondary"}}}function Re({children:e,className:o,onClick:t,isClickable:n=!1,theme:r="dark_gray"}){const s=Cn(r),a=(t!=null||n)&&s.hover;return u.jsxs("div",{className:M("relative inline-block h-[20px] w-[20px] shrink-0 transition-opacity",o,a,s.normal),onClick:t,children:[e?u.jsx(jo,{className:"h-[20px] w-[20px] shrink-0"}):u.jsx(Do,{className:"h-[20px] w-[20px] shrink-0"}),u.jsx("span",{className:M("absolute inset-0 flex items-center justify-center text-[8px] font-black",a,s.normal),children:e})]})}function Ce(){return u.jsx(Re,{theme:"light_gray",children:u.jsx(vn,{})})}function xn({count:e,isLoading:o,onClick:t}){return o?u.jsx(Ce,{}):u.jsx(Re,{onClick:t,theme:"dark_gray",children:e})}function En({isLoading:e=!1,onClick:o}){return e?u.jsx(Ce,{}):u.jsx(Re,{isClickable:!0,onClick:o,theme:"light_gray"})}var H=(e=>(e[e.up=-1]="up",e[e.down=1]="down",e))(H||{}),de=(e=>(e.COMMENT="comment",e.COMPOSER="composer",e))(de||{}),w=(e=>(e.COLLAPSED="collapsed",e.EXPANDED="expanded",e))(w||{});const Nt=([e,o],[t,n])=>{const r=e+o,s=t+n;return e<s&&t<r},Se=([e,o])=>e+o,J=e=>{if(e.type===w.COLLAPSED)return[e.offsetY??0,0];const{offsetY:o,shiftY:t=0,height:n=0}=e,r=o+t;return t<0?[r,n+Math.abs(t)]:[r,n]},yn=(e,o,t)=>{if(!Nt(e,o))return null;const[n,r]=e,s=n+r,[a,i]=o,c=a+i,l=a-s,f=c-n;return t===H.up?l:f};var Tt=(e=>(e.ABOVE="above",e.BELOW="below",e))(Tt||{});function ee(e,o){return te(e.coordsAtPos(o))}const ze=360,bn=250,Pt=44,Xe=.5,We=[.5,.9,1],_n=[1,.75,.2],Nn=({onClose:e,onSubmit:o,opensOverDocument:t=!1,opensFromGutter:n=!1,gutterHasComments:r=!1},s)=>{const a=Me(),i=v.useRef(null),c=v.useRef(!1),[l,f]=v.useState(""),[d,p]=v.useState(!0),g=()=>{f(""),e?.(c.current)},h=(T=l)=>{c.current=!0,o?.(T),f("")},x=lo(({windowWidth:T})=>t?T<ze+100?bn:ze:le,0),C={};n&&(C.top=-12),t&&n?C.right=0:C.left=0;let E="";n&&!t?E="8px 50%":n&&t?E="calc(100% + 8px) 50%":t&&(E="center left");let y=0;n&&!t&&r&&(y=gt);const I=T=>{const{metaKey:P,shiftKey:S,key:A}=T;A==="Enter"&&l&&!(S||P)?(h(),T.preventDefault()):A==="Escape"&&(f(""),e?.(!1))},b=a.formatMessage({id:"VvfbvY",defaultMessage:"Edit or explain..."});return u.jsx(L.div,{ref:qo(i,s),className:M("absolute flex items-center",B.commentComposer),style:{...C,minHeight:Pt},transition:{type:"spring",bounce:.18,duration:.48},initial:{translateX:0},animate:{translateX:y},exit:{translateX:0},children:u.jsx(L.div,{className:M("no-scrollbar relative z-10 flex items-center overflow-x-hidden border border-token-border-light",pt,{"rounded-full":d,"rounded-2xl":!d}),initial:{width:t?le:24,scaleX:t?Xe:void 0,scale:t?void 0:Xe},animate:{width:x,scaleX:t?We:void 0,scale:t?void 0:We},exit:{filter:"blur(16px)",scale:t?void 0:_n,width:t?le:24,opacity:t?0:[1,1,0]},transition:{type:"spring",bounce:t?.14:0,duration:.28,scale:{type:"tween",duration:.2},opacity:{type:"tween",time:[0,.95,1]}},style:{transformOrigin:E},children:u.jsxs(L.div,{className:"relative z-0 flex w-full items-center bg-token-main-surface-primary px-4 py-2.5",children:[u.jsx(L.div,{className:"backdrop-saturate-25 absolute inset-0 z-[-1] bg-gray-50/75 backdrop-blur-3xl dark:bg-gray-700/75",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.2}}),u.jsx(Xo,{"aria-placeholder":b,value:l,className:"w-full resize-none border-0 bg-transparent px-1 py-0 pr-2 text-token-text-primary outline-0 placeholder:text-token-text-secondary focus:ring-0 focus-visible:ring-0",autoFocus:!0,maxRows:4,onBlur:g,onHeightChange:(T,{rowHeight:P})=>{p(Math.floor(T/P)<=1)},onChange:({target:{value:T}})=>f(T),onKeyDown:I}),!l&&u.jsx("span",{"aria-hidden":!0,className:"absolute inline-block text-nowrap pl-1 text-token-text-secondary",children:b}),u.jsx(L.button,{className:M("-mr-1.5 h-6 w-6 rounded-full bg-black text-center dark:bg-white",{"self-end":!d}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:()=>h(),children:u.jsx(Bo,{className:"h-6 w-6 text-white dark:text-black"})})]})})})},St=v.forwardRef(Nn),Tn=(e,o)=>{if(o?.type!==Y.SELECTION)return null;try{const{from:t,to:n}=o,{top:r}=e.dom.getBoundingClientRect(),{bottom:s,top:a}=ee(e,t),{bottom:i}=ee(e,n),c=he(e)?-30:-24;let l=s-r+c;const f=a-r;return l=i-r+8,{composerTop:l,loadingTop:f}}catch(t){return j.logError("Invalid position in SelectionCommentComposer",t),null}},Pn=({toolbarPosition:e,composerRect:o,view:t})=>{let{width:n,height:r}=o;if(r||=Pt,t==null||e==null)return null;const{right:s,left:a}=t.dom.getBoundingClientRect(),{left:i,top:c,aboveOrBelow:l,toolbarSize:f}=e,d=c-(l===Tt.ABOVE&&r!==0?r-f.height:0),p=Mo(t)?12:0;return{left:Math.min(i,s-a-n-p),composerTop:d,aboveOrBelow:l}},Sn=({toolbarPosition:e,commentingOn:o,isWaitingForCommentResponse:t=!1,onAddComment:n})=>{const r=re()(),[s,a]=ge(),i=Pn({view:r,toolbarPosition:e,composerRect:s});if(r==null||i==null)return null;const{left:c,composerTop:l}=i,f=d=>{if(o?.type!==Y.SELECTION)return;const{action:p,sourceRange:g}=o;n?.(d,p,g,o.type)};return u.jsx(X,{children:o?.type===Y.SELECTION&&!t&&u.jsx("div",{className:M("absolute",B.commentComposer),style:{left:c,top:l},children:u.jsx(St,{opensOverDocument:!0,onClose:d=>{d||(O.cancelCommentingOn(),r&&he(r)&&!r.state.selection.empty&&r.dispatch(r.state.tr.setSelection(new Ho(r.state.selection.$from))),document.getSelection()?.removeAllRanges())},onSubmit:f,ref:a})},"composer")})};function It(e,o){return o?e.getState(o)??null:null}function In(e){return e.nodeSize-2}function kn(e,o){return o>=0&&o<=In(e)}class U{constructor(o,t,n={}){this.match=o,this.match=o,this.handler=typeof t=="string"?An(t):t,this.undoable=n.undoable!==!1,this.inCode=n.inCode||!1}}function An(e){return function(o,t,n,r){let s=e;if(t[1]){let a=t[0].lastIndexOf(t[1]);s+=t[0].slice(a+t[1].length),n+=a;let i=n-r;i>0&&(s=t[0].slice(a-i,a)+s,n=r)}return o.tr.insertText(s,n,r)}}const Mn=500;function Is({rules:e}){let o=new Et({state:{init(){return null},apply(t,n){let r=t.getMeta(this);return r||(t.selectionSet||t.docChanged?null:n)}},props:{handleTextInput(t,n,r,s){return qe(t,n,r,s,e,o)},handleDOMEvents:{compositionend:t=>{setTimeout(()=>{let{$cursor:n}=t.state.selection;n&&qe(t,n.pos,n.pos,"",e,o)})}}},isInputRules:!0});return o}function qe(e,o,t,n,r,s){if(e.composing)return!1;let a=e.state,i=a.doc.resolve(o),c=i.parent.textBetween(Math.max(0,i.parentOffset-Mn),i.parentOffset,null,"￼")+n;for(let l=0;l<r.length;l++){let f=r[l];if(i.parent.type.spec.code){if(!f.inCode)continue}else if(f.inCode==="only")continue;let d=f.match.exec(c),p=d&&f.handler(a,d,o-(d[0].length-n.length),t);if(p)return f.undoable&&p.setMeta(s,{transform:p,from:o,to:t,text:n}),e.dispatch(p),!0}return!1}new U(/--$/,"—");new U(/\.\.\.$/,"…");new U(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"“");new U(/"$/,"”");new U(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"‘");new U(/'$/,"’");function ks(e,o,t=null,n){return new U(e,(r,s,a,i)=>{let c=t instanceof Function?t(s):t,l=r.tr.delete(a,i),f=l.doc.resolve(a),d=f.blockRange(),p=d&&$o(d,o,c);if(!p)return null;l.wrap(d,p);let g=l.doc.resolve(a-1).nodeBefore;return g&&g.type==o&&Yo(l.doc,a-1)&&(!n||n(s,g))&&l.join(a-1),l})}function Rn(e,o,t=null){return new U(e,(n,r,s,a)=>{let i=n.doc.resolve(s),c=t instanceof Function?t(r):t;return i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),o)?n.tr.delete(s,a).setBlockType(s,s,o,c):null})}function we(e,o,t,n={}){if(e==null)return null;const r=(Array.isArray(t)?t:[t]).filter(ht),s=o.nodes[e].createAndFill(n,r);return s??null}const wn={content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM(){return["p",0]}},On="paragraph";class kt extends ve{unistNodeName(){return On}static proseMirrorNodeName(){return"paragraph"}proseMirrorNodeSpec(){return wn}unistNodeToProseMirrorNodes({schema:o,convertedChildren:t,attrs:n}){return we(this.proseMirrorNodeName(),o,t,n)}proseMirrorNodeToUnistNodes(o,t){return[{type:this.unistNodeName(),children:t}]}}const Ln=(e,o,t,n)=>e.value?o.text(e.value,[o.marks.startend.create(t),...n??[]]):null;class ne extends ve{unistNodeName(){return"text"}static proseMirrorNodeName(){return"text"}proseMirrorNodeSpec(){return{group:"inline"}}unistNodeToProseMirrorNodes({node:o,schema:t,attrs:n}){return Ln(o,t,n)}proseMirrorNodeToUnistNodes(o){return[{type:this.unistNodeName(),value:o.text??""}]}}class q extends ve{static isAtStart(o,t){return o.selection.empty?t!==void 0?t.endOfTextblock("backward",o):o.selection.$anchor.parentOffset>0:!1}static headingLevelCommandBuilder(o,t,n){return(r,s,a)=>{if(n&&!q.isAtStart(r,a))return!1;const{$anchor:i}=r.selection,c=i.parent;if(c.type.name!=="heading")return!1;const l=c.attrs.level+t;if(l<0||l>6)return!1;if(s===void 0)return!0;const f=i.before(i.depth);return l>0?s(r.tr.setNodeMarkup(f,void 0,{level:l})):s(r.tr.setNodeMarkup(f,o.nodes.paragraph)),!0}}dependencies(){return[new kt,new ne]}unistNodeName(){return"heading"}static proseMirrorNodeName(){return"heading"}proseMirrorNodeSpec(){return{attrs:{level:{default:1}},content:"text*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM(o){return["h"+o.attrs.level.toString(),0]}}}proseMirrorInputRules(o){return[Rn(/^\s{0,3}(#{1,6})\s$/,o.nodes[this.proseMirrorNodeName()],t=>({level:t[1].length}))]}proseMirrorKeymap(o){const t={Tab:q.headingLevelCommandBuilder(o,1,!1),"#":q.headingLevelCommandBuilder(o,1,!0),"Shift-Tab":q.headingLevelCommandBuilder(o,-1,!1)};for(let n=1;n<=6;n++)t[`Shift-Mod-${n.toString()}`]=Fo(o.nodes[this.proseMirrorNodeName()],{level:n});return t}unistNodeToProseMirrorNodes({node:o,schema:t,convertedChildren:n,attrs:r}){const{depth:s}=o;return we(this.proseMirrorNodeName(),t,n,{...r,level:s})}proseMirrorNodeToUnistNodes(o,t){return[{type:this.unistNodeName(),depth:o.attrs.level,children:t}]}}const Je=(e,o,t)=>{const n=t==="min"?0:o.length-1;for(let r=n;t==="min"?r<o.length:r>=0;t==="min"?r++:r--){const{sourcePos:s,pmPos:a}=o[r];if(s===e)return a;if(t==="min"&&s>e||t==="max"&&s<e)return t==="min"?o[r-1]?.pmPos??a:a}return null};class jn extends ve{unistNodeName(){return"root"}static proseMirrorNodeName(){return"doc"}proseMirrorNodeSpec(){return{content:"block+"}}unistNodeToProseMirrorNodes({schema:o,convertedChildren:t,attrs:n}){return we(this.proseMirrorNodeName(),o,t,n)}proseMirrorNodeToUnistNodes(o,t){return[{type:this.unistNodeName(),children:t}]}}const Ze=(e,o)=>{if(!o)return!1;const[t,n]=o;return e>=t&&e<n},At=(e,o)=>e.pmPos-o.pmPos,Qe=(e,o)=>{const t=o[o.length-1].sourcePos;return Math.min(Math.max(e,0),t)},et=(e,o)=>{const t=oe(o)?.sourcePos??0;return Math.min(Math.max(e,0),t)},tt=({positions:e,sourcePos:o,sourceEndPos:t})=>{const n=[];for(let r=0;r<e.length;r++){const s=e[r],{sourcePos:a,leafSourceRange:i,isClose:c=!1}=s;if(t!=null&&a>t)break;const l=e[r+1]??null,f=d=>{let p=e[d];if(p==null)return d;let g=e[d+1],{leafSourceRange:h}=p;for(;p.nodeTypeName!==ne.proseMirrorNodeName()&&!p.isClose&&g!=null&&!Ze(o,h);)n.push(g),p=g,g=e[d+2],h=p.leafSourceRange,d++;return d};if(a===o&&!c||Ze(o,i))n.push(s),r=f(r);else if(a<=o&&(l?.sourcePos??Number.POSITIVE_INFINITY)>=o){let d=r+1;const p=[];for(;e[d]?.isClose===!0;)p.push(d),d++;if(e[d]){const{sourcePos:g}=e[d];do n.push(e[d]);while(e[++d].sourcePos===g);d=f(d-1)}else{(a===o||c)&&n.push(s);for(const g of p)n.push(e[g])}r=d}}return n.sort(At)},ot=({positions:e,sourcePos:o})=>{const t=[],n=r=>{r&&t.push(r)};for(let r=0;r<e.length;r++){const s=e[r],{sourcePos:a}=s;if(o==null||a>o)break;const i=e[r-1]??null,c=e[r+1]??null,l=o>a&&o<(c?.sourcePos??-1),f=s.nodeTypeName===ne.proseMirrorNodeName();if(a===o||l&&!f){if(s.isClose&&!i?.isClose&&s.nodeTypeName===i?.nodeTypeName||!s.isClose&&c.isClose&&s.nodeTypeName===c.nodeTypeName||s.isClose&&i?.isClose||!s.isClose&&i!=null&&i?.nodeTypeName!==ne.proseMirrorNodeName()){n(i);let h=r-2,x=e[h];for(;h>=0&&x.isClose;)n(x),x=e[--h]}let d=r,p=s,g=p;do n(p),g=p,p=e[++d];while(p?.sourcePos===o||p?.depth<g?.depth);break}else if(l&&f){let d=r+1,p=e[d];for(;p?.isClose;)n(p),p=e[++d];break}}return t.sort(At)},Dn=e=>{const o=new Map;e.descendants((r,s)=>{const a=Ye(r);if(!a)return;const{start:i,end:c}=a,l=r.type.name,{depth:f}=e.resolve(s);if(o.set(s,{pmPos:s,sourcePos:i,leafSourceRange:r.isBlock?void 0:[i,c],depth:f,nodeTypeName:l,isClose:!1,parentNodeTypeNameStack:[]}),r.isBlock){const d=s+r.nodeSize-1;o.set(d,{pmPos:d,sourcePos:c,depth:e.resolve(d).depth,nodeTypeName:l,isClose:!0,parentNodeTypeNameStack:[]})}if(r.isText)for(let d=0;d<(r.text?.length??0);d++){const p=s+d;o.set(p,{pmPos:p,sourcePos:i+d,depth:f,nodeTypeName:l,isClose:!1,parentNodeTypeNameStack:[]})}}),o.set(e.content.size,{pmPos:e.content.size,nodeTypeName:e.type.name,depth:0,isClose:!0,sourcePos:te(Ye(e)).end,parentNodeTypeNameStack:[]});const t=Array.from(o.entries()).sort(([r],[s])=>r-s).map(([,r])=>r),n=[jn.proseMirrorNodeName()];for(const r of t)r.isClose?(r.parentNodeTypeNameStack=n.concat(),n.pop()):(r.parentNodeTypeNameStack=n.concat(),r.nodeTypeName!==ne.proseMirrorNodeName()&&oe(n)!==r.nodeTypeName&&n.push(r.nodeTypeName));return{positions:t,pmRangeToSourceRange:({start:r,end:s})=>({start:t[Math.max(r,0)].sourcePos,end:t[Math.min(s,t.length-1)].sourcePos}),sourceStartToPmPos:r=>tt({sourcePos:Qe(r,t),positions:t,sourceEndPos:null}),sourceEndToPmPos:r=>ot({sourcePos:et(r,t),positions:t}),sourceRangeToPmRange:r=>{const{start:s,end:a}=r,i=et(a,t),c=tt({sourcePos:Qe(s,t),sourceEndPos:i,positions:t}),l=ot({sourcePos:i,positions:t});return{start:c,end:l}}}};function Bn(e,o){const t=Fn(e);if(t.length===0)return o;let n=o;return t.forEach(r=>{n=Gn(r,n)}),n}function Gn(e,o){return Ro(o,{start:e.from,end:e.to},Vn(e))}function Vn(e){return e.slice.size-(e.to-e.from)}function Fn(e){return e.steps.filter(o=>o instanceof Uo)}const fe=new Ko("comments");function nt(e,o){const{sourceRangeToPmRange:t}=Dn(e),n=o.map(({id:r,at:s})=>{const{start:a,end:i}=t(s),c=Je(s.start,a,"max"),l=Je(s.end,i,"min");return l==null||c==null?null:[r,{start:c,end:l}]}).filter(ht);return new Map(n)}function Hn(e,o){const{type:t}=o;if(t===Y.SELECTION){const{from:s,to:a}=o;return[s,a]}const{pos:n}=o,r=n+(e.nodeAt(n)?.nodeSize??0);return[n,r]}const rt=(e,o,t=null,n=null)=>{const r=[],s=Array.from(o.entries()).reverse(),a=new Map(e.map(i=>[i.id,i]));for(const[i,c]of s){const l=a.get(i),p=Oo({isHovered:t===i,isFocused:n===i,isCode:!1,diffStatus:l?.diffStatus});r.push(yt.inline(c.start,c.end,{class:p,"data-comment-id":i,nodeName:"span"}))}return r},As=e=>new Et({key:fe,state:{init:(o,{doc:t})=>{const n=nt(t,e);return{comments:e,commentingOn:null,hoveredOnBlock:null,hoveredCommentId:null,focusedCommentId:null,decorations:rt(e,n),positions:n}},apply:(o,t)=>{const n=o.getMeta(fe)??{},r=n.comments,s=r??t.comments,a=r!=null?nt(o.doc,s):t.positions;let i=n.commentingOn;i===void 0&&(i=t.commentingOn);let c=n.hoveredCommentId;c===void 0&&(c=t.hoveredCommentId);let l=n.focusedCommentId;l===void 0&&(l=t.focusedCommentId);const f=Bn(o,a),d=wo(s,f);return{comments:d,commentingOn:i,hoveredCommentId:c,focusedCommentId:l,decorations:rt(d,f,c,l),positions:f}}},props:{handleClickOn:(o,t,n,r,s)=>{const{target:a}=s;if(a instanceof HTMLElement){const{commentId:i}=a.dataset;if(!i)return;O.focusComment(i)}},handleDOMEvents:{mouseover(o,t){const{target:n}=t;if(n instanceof HTMLElement){const{commentId:r}=n.dataset;r?O.mouseEnterComment(r):O.mouseLeaveComment()}}},decorations(o){const t=this.getState(o);if(!t)return Ue.empty;const{commentingOn:n,decorations:r}=t,{doc:s}=o;if(n){const[a,i]=Hn(s,n);a!=null&&i!=null&&r.push(yt.inline(a,i,{class:po.document},{comment:{pattern:n}}))}return Ue.create(s,r.concat())}}});function $n(e,o,t){const n=e+o;for(const r of t.values()){const s=r.start,a=r.end;if(e<a&&s<n)return!0}return!1}const Yn=50,Un=200,Kn=[kt.proseMirrorNodeName(),q.proseMirrorNodeName()],zn=e=>e?e.isBlock:!1,Xn=e=>{if(!e)return!1;const{isBlock:o,type:{name:t}}=e;return o&&Kn.includes(t)},Wn=(e,o,t,n)=>{const r=e.posAtCoords({left:o,top:t});if(r==null)return;const{pos:s,inside:a}=r;if(a===-1)return;const{state:i}=e;let c=s,l=i.doc.nodeAt(c);for(;!zn(l)&&c>=0;)c--,l=i.doc.nodeAt(c);if(!l||!Xn(l))return;const f=n!=null&&$n(c,l.nodeSize,n);return{node:l,nodeHasComment:f,pos:c}};function qn(e,o,t){const n=Wn(e,o.x,o.y,t);if(n==null)return null;const{node:r,pos:s,nodeHasComment:a}=n,{top:i}=e.coordsAtPos(0);function c(){const g=s+1;return kn(e.state.doc,g)&&e.state.doc.nodeAt(g)?.isText?e.coordsAtPos(g).top:e.coordsAtPos(s).top}const l=c(),f=l-i;return{height:e.coordsAtPos(s+r.nodeSize-1).bottom-l,nodeHasComment:a,mouseEnteredAt:Date.now(),yOffset:f,pos:s}}function Jn(e){const o=v.useRef(!1),t=v.useRef(!1),[n,r]=v.useState(null),s=Lo(),a=s()?.dom,i=v.useRef(!1),c=V(({visibleBlockCommentLauncher_DEBUG_ONLY:d})=>d),l=v.useCallback(vt(d=>{o.current=!0;const{commentingOn:p}=V.getState();if(t.current||p!=null)return;const g=s();if(g==null||!o.current)return r(null);const{dom:h,state:x}=g,C=It(fe,x)?.positions;if(C==null)return r(null);const E=qn(g,d,C);if(E==null||E.nodeHasComment&&e===D.COLLAPSED){r(null);return}if(i.current&&E.yOffset!==n?.yOffset){r(null);return}const y=g.coordsAtPos(0),I=h.getBoundingClientRect().width,T=(d.x-y.left)/I>=Yn/100;r(T?E:null)},Un),[s,i,n]);v.useEffect(()=>{if(a!=null)return dt(a,{mouseenter:()=>{o.current=!0,t.current=!1},mouseleave:({relatedTarget:d})=>{if(l.cancel(),d instanceof HTMLElement&&d.closest("[data-block-comment-launcher]")){t.current=!0;return}t.current=!1,o.current=!1,V.getState().commentingOn==null&&r(null)},mousemove:l})},[s,a,e,l]);const f=v.useCallback(({relatedTarget:d})=>{const{commentingOn:p}=V.getState();p==null&&d!==a&&(t.current=!1,r(null))},[a]);return{visibleBlockComment:c??n,handleMouseLeave:f,onComposerVisibleChange:d=>{i.current=d}}}const Zn=({isWaitingForCommentResponse:e=!1,opensOverDocument:o=!1,hasComments:t=!1,activeBlockComment:n,composerRef:r,onLaunchComposer:s,onMouseLeave:a,onSubmit:i})=>{const[c,l]=v.useState(!1),{yOffset:f,height:d,pos:p}=n,g=()=>{l(!0),s?.(),j.logButtonClick(W.BLOCK_COMMENT_LAUNCHER),O.startCommentingOn({type:Y.BLOCK,pos:p})},h=E=>{E||(l(!1),O.cancelCommentingOn())},x=E=>{l(!1),i?.(E)};v.useEffect(()=>()=>{O.mouseLeaveBlock()},[]);const C=t&&c?o?-88:88:0;return u.jsx(L.div,{className:M("pointer-events-auto absolute flex h-6 w-5 origin-[14px_50%] items-start after:absolute after:-inset-4 after:content-['']",B.commentComposer),initial:!1,animate:{opacity:1},exit:{opacity:0},transition:{type:"spring",duration:.2,bounce:.1},style:{top:0,height:d,translateY:f},onMouseLeave:a,"data-block-comment-launcher":!0,children:u.jsxs(X,{children:[c?u.jsx(St,{ref:r,opensFromGutter:!0,onClose:h,onSubmit:x,gutterHasComments:t,opensOverDocument:o},"composer"):null,u.jsx(L.button,{initial:{opacity:0},animate:{opacity:c?0:1,translateX:C},transition:{duration:.15,translateX:{type:"spring",bounce:.18,duration:.48}},className:"group absolute z-10 flex h-6 gap-1 bg-transparent after:absolute after:-inset-y-4 after:-left-1 after:-right-4 after:content-['']",onClick:g,onMouseEnter:()=>O.mouseEnterBlock(p),onMouseLeave:()=>O.mouseLeaveBlock(),disabled:c||e,children:u.jsx(En,{isLoading:e})},"launcer")]})})},Qn=({isWaitingForCommentResponse:e=!1,isRequestActive:o=!1,hasComments:t=!1,composerRef:n,gutterMode:r,onAddComment:s})=>{const a=Ct(),{visibleBlockComment:i,handleMouseLeave:c,onComposerVisibleChange:l}=Jn(r),f=d=>{if(!i||!a)return;const{doc:p}=a,{pos:g}=i,h=p.nodeAt(g);if(!h)return;const{attrs:{start:x,end:C}}=h;s?.(d,xt.ASK,{start:x,end:C},Y.BLOCK)};return u.jsx(X,{onExitComplete:()=>l(!1),children:i&&a&&(e||!o)&&u.jsx(Zn,{composerRef:n,isWaitingForCommentResponse:e,opensOverDocument:r===D.COLLAPSED,activeBlockComment:i,hasComments:t,onSubmit:f,onMouseLeave:c,onLaunchComposer:()=>l(!0)},"launcher")})},Mt={type:"spring",bounce:.12,duration:.5},Rt="opacity-50",er=({count:e,offsetY:o,isLoading:t=!1,onClick:n})=>u.jsx(L.div,{className:M("absolute",B.collapsedComment),initial:{opacity:0},animate:{opacity:1},style:{translateY:o},transition:Mt,exit:{opacity:0},children:u.jsx(xn,{count:e,isLoading:t,onClick:n})}),tr=({isFocused:e,isHovered:o})=>{const t=e||o?"grow font-medium text-token-text-primary transition-colors":"grow font-medium text-token-text-secondary transition-colors",n=e||o?"opacity-100 transition":"opacity-75 transition";return u.jsxs(u.Fragment,{children:[u.jsx("div",{className:n,children:u.jsx("div",{className:"gizmo-bot-avatar rounded-full",children:u.jsx(go,{size:"gizmoConversation",iconName:"openai"})})}),u.jsx("span",{className:t,children:"ChatGPT"})]})},or=({comment:e,isFocused:o,isSomeCommentFocused:t,isHovered:n})=>{const r=e.diffStatus===Pe.REMOVED;return u.jsx("div",{className:M("mt-2 text-token-text-primary transition-all",{"opacity-80":!o&&!t&&!n&&!r,"opacity-40":!o&&t&&!n&&!r,[Rt]:r}),children:e.content})},nr=({left:e,right:o,comment:t,disableAnimations:n=!1,onClick:r,onMouseEnter:s,onMouseLeave:a,onAccept:i,onDismiss:c,translateY:l,isFocused:f=!1,isSomeCommentFocused:d=!1,disableActions:p=!1,isHovered:g=!1},h)=>{const[x,C]=v.useState(!1),E=t.diffStatus===Pe.ADDED,y=t.diffStatus===Pe.REMOVED,I=t.diffStatus!=null,b=()=>{C(!0),s?.()},T=()=>{C(!1),a?.()},P=Me(),S=f||x&&!d;return u.jsx(L.div,{ref:h,className:M("absolute",B.expandedComment,{"cursor-default":f,"cursor-pointer":!f,[B.expandedCommentFocused]:f,[B.expandedCommentHovered]:g}),style:{left:e,right:o},initial:n?!1:{translateY:l,scale:.85,opacity:0},animate:n?void 0:{translateY:l,scale:f?1:.97,opacity:1},exit:n?void 0:{scale:.85,opacity:0,filter:"blur(16px)"},transition:Mt,onClick:r,onMouseEnter:p?void 0:b,onMouseLeave:p?void 0:T,"data-comment-id":t.id,children:u.jsxs("div",{className:M("flex min-h-8 flex-col overflow-hidden rounded-2xl border p-4 pt-2 text-left text-sm transition-all",{"border-transparent bg-gray-50 dark:bg-gray-800":!f&&!g,"border-token-border-light bg-token-main-surface-primary":g&&!f,"border-token-border-light bg-token-main-surface-primary shadow-xl":f||x&&!d,"relative after:absolute after:bottom-0 after:left-0 after:top-0 after:w-1":I,"after:bg-green-500":E,"after:bg-red-500":y}),style:{width:le},children:[u.jsxs("div",{className:M("flex h-8 flex-row items-center gap-2.5",{[Rt]:y}),children:[u.jsx(tr,{isFocused:f,isHovered:g}),u.jsx("button",{className:M("-mr-1 rounded-full bg-transparent p-1 text-token-text-secondary",{"cursor-pointer hover:bg-gray-100 hover:text-token-text-primary dark:hover:bg-gray-700":!p,"cursor-not-allowed":p}),onClick:c,disabled:p,"aria-label":P.formatMessage({id:"fYDa3C",defaultMessage:"Dismiss comment"}),children:u.jsx(Go,{className:"icon-sm"})})]}),u.jsx(or,{comment:t,isFocused:f,isHovered:g,isSomeCommentFocused:d}),u.jsx(X,{initial:!1,children:S&&u.jsx(L.div,{initial:n?!1:{opacity:0,height:0},animate:{opacity:1,height:"auto",transition:{opacity:{delay:.14,duration:.2},height:{bounce:0,duration:.2}}},exit:n?void 0:{opacity:0,height:0,transition:{opacity:{duration:.08},height:{bounce:0,duration:.2}}},className:"flex items-center justify-start",children:u.jsx("div",{className:"mt-2.5",children:u.jsx(uo,{color:"secondary",onClick:i,disabled:p,children:P.formatMessage({id:"WIW5OL",defaultMessage:"Apply"})})})})})]})})},wt=v.forwardRef(nr),rr=({offsetY:e,opensOverDocument:o=!1,disableActions:t=!1,isFocused:n=!1,isSomeCommentFocused:r=!1,onAccept:s,onClick:a,onDismiss:i,onMouseEnter:c,onMouseLeave:l,comment:f,isHovered:d=!1})=>{const p=v.useRef(null);return v.useEffect(()=>dt(document,{mousedown:({target:g})=>{g instanceof HTMLElement&&!g.closest("[data-comment-id]")&&!p.current?.contains(g)&&O.blurComment()}})),u.jsx(wt,{ref:p,comment:f,disableActions:t,onAccept:s,onDismiss:i,onMouseEnter:c,onMouseLeave:l,isSomeCommentFocused:r,isHovered:d,onClick:a,translateY:e,isFocused:n,left:o?void 0:gt,right:o?ho:void 0})},sr=({onAcceptComment:e,onDismissComment:o,disableActions:t=!1,entry:n,isGutterCollapsed:r=!1,isHovered:s=!1,isFocused:a=!1,isSomeCommentFocused:i=!1})=>{const{offsetY:c,type:l}=n,[f,d]=vo();let p=null;if(l===w.COLLAPSED)p=!a&&u.jsx(er,{offsetY:c,count:n.count,onClick:()=>{j.logButtonClick(W.COLLAPSED_COMMENT),O.focusComment(n.children[0])}},"collapsed");else{const{comment:g}=n;if(g==null||g.content===""||g.status===Fe.DISMISSED)p=null;else if(g.status===Fe.ACCEPT_INITIATED)p=u.jsx("div",{className:"absolute",style:{top:c},children:u.jsx(Ce,{})},"loading");else{const{id:h}=g;p=u.jsx(rr,{isSomeCommentFocused:i,isHovered:s,isFocused:a,offsetY:c,disableActions:t,onClick:()=>{j.logButtonClick(W.EXPANDED_COMMENT),O.focusComment(h)},onMouseEnter:()=>O.mouseEnterComment(h),onMouseLeave:()=>O.mouseLeaveComment(),comment:g,onAccept:()=>{j.logButtonClick(W.COMMENT_ACCEPT,{commentId:h}),e?.(h)},onDismiss:()=>{j.logButtonClick(W.COMMENT_DISMISS,{commentId:h}),o?.(h)},opensOverDocument:r},"expanded")}}return u.jsx(X,{onExitComplete:()=>d?.(),children:f&&p})},st=({onMeasureHeight:e,comment:o,isFocused:t=!1})=>{const[{height:n},r]=ge();return ft(()=>{e?.(n)},[n]),u.jsx(wt,{ref:r,comment:o,isFocused:t,disableAnimations:!0})},ar=({comments:e,onMeasure:o,getStableCommentId:t})=>{const n=v.useRef(new Map),r=v.useRef(new Map),s=v.useRef(null),a=(i,c,l=!1)=>{c&&(l?r.current.set(t(i),c):n.current.set(t(i),c),s.current&&cancelAnimationFrame(s.current),s.current=requestAnimationFrame(()=>{o?.({focusedHeights:new Map(r.current),heights:new Map(n.current)}),s.current=null}))};return e?.length?u.jsxs("div",{className:"pointer-events-none invisible fixed left-0 top-0 overflow-clip","aria-hidden":"true",children:[e.map(i=>u.jsx(st,{comment:i,onMeasureHeight:c=>a(i.id,c)},t(i.id))),e.map(i=>u.jsx(st,{isFocused:!0,comment:i,onMeasureHeight:c=>a(i.id,c,!0)},`${t(i.id)}-focused`))]}):null},at=(e,o,t)=>{let n=t+o;for(;o===H.down?n<e.length:n>-1;){const r=e[n],s=e[n-o],a=yn(J(r),J(s),o);if(a!=null&&r.type!==w.COLLAPSED)r.shiftY+=a;else break;n+=o}},it=(e,o)=>{for(const t of o){const{index:n,amount:r}=t,s=e[n];s.type===w.EXPANDED&&(s.shiftY+=r),at(e,H.down,n),at(e,H.up,n);for(const a of e)a.type!==w.COLLAPSED&&(a.offsetY+=a.shiftY,a.shiftY=0)}},ir=(e,o)=>{const t=[],[n,r]=o,s=n+r;for(let a=0;a<e.length;a++){const i=e[a],[c]=J(i),l=[c,i.type===w.EXPANDED?i.height:0],[f,d]=l;if(Nt(l,o)){const p=f+d,g=n-p,h=s-f,C=(Math.abs(g)<Math.abs(h)?H.up:H.down)===H.up?g:h;t.push({index:a,amount:C})}}return t},cr=({gutterMode:e,focusedCommentId:o,gutterPositions:t,getCommentKey:n,getComment:r})=>{if(!t?.size)return[];const s=new Map,a=[];let i=null,c=-1;for(const f of t.values()){if(f.type===de.COMPOSER){i=[f.offsetY,f.height];continue}const{commentId:d,height:p,collapsedOffsetY:g,offsetY:h}=f;if(e===D.EXPANDED){const E=oe(a),y=E?Se(J(E)):0;let I=h;E&&I<=y&&(I=y),s.set(d,{originalOffsetY:h,offsetY:I}),o===d&&(c=a.length),a.push({key:n(d),comment:r(d),type:w.EXPANDED,height:p,offsetY:I,shiftY:0});continue}let x=a.findIndex(({offsetY:E,type:y})=>y===w.COLLAPSED&&E===g),C=a[x]??null;if(!C)C={key:a.length,type:w.COLLAPSED,offsetY:h,count:1,children:[d]},x=a.length,a.push(C);else{if(C.type!==w.COLLAPSED)throw new Error("Collapsed parent type expected to be collapsed");C.count+=1,C.children.push(d),C.offsetY=g}o===d&&(c=x)}const l=a[c];if(e===D.COLLAPSED&&l?.type===w.COLLAPSED){const f=[];for(let d=0;d<l.children.length;d++){const p=l.children[d];p===o&&(c+=d+1);const g=oe(f),h=g?Se(J(g)):0,x=t.get(p)?.offsetY??0,C=Math.max(h,x);s.set(p,{originalOffsetY:x,offsetY:C}),f.push({type:w.EXPANDED,key:n(p),comment:r(p),offsetY:C,height:t.get(p)?.height??0,shiftY:0})}a.splice(c,0,...f)}if(o){const f=s.get(o);if(!f)return a;const{offsetY:d,originalOffsetY:p}=f,g=p-d,h=[{amount:g,index:c}];let x=c+1;for(;x<a.length;){const C=a[x],{type:E}=C;let y=g;if(E===w.EXPANDED&&C.comment?.id){const{offsetY:I,originalOffsetY:b}=te(s.get(C.comment.id));if(I===b)break;y=Math.max(b-I,g)}else break;h.push({amount:y,index:x}),x++}h.length&&it(a,h)}else if(e!==D.COLLAPSED&&i){const f=ir(a,i);it(a,f)}return a},lr=e=>{try{return cr(e)}catch(o){return j.logError("Generating comment gutter entries",o),[]}},ur=e=>"length"in e?e.length===0:e.nodeSize===0,Ne=12,dr=({composerHeight:e,getCommentHeight:o,getCollapsedStartPos:t,commentingOn:n,commentPositions:r,view:s})=>{if(!r||!s||ur(s.state.doc))return null;const{top:a}=s.dom.getBoundingClientRect(),i=Array.from(r.entries()).sort(([l,f],[d,p])=>f.start-p.start),c=new Map;for(const[l,{start:f}]of i)try{const d=t?.(f)??f,{top:p}=ee(s,d),{top:g}=ee(s,f),h=g-a,x=p-a,C=(o(l)??0)+Ne;c.set(l,{commentId:l,height:C,collapsedOffsetY:x,offsetY:h,type:de.COMMENT})}catch{continue}if(n?.type===Y.BLOCK){const{pos:l}=n;try{const{top:f}=ee(s,l),p=f-a-Ne;c.set("block-composer",{type:de.COMPOSER,height:(e??0)+Ne,offsetY:p})}catch{}}return c},Ot=(e,o)=>o.nodeAt(e)?.isBlock?e+1:Ot(e-1,o);function fr(e){const o=Ct(),n=re()?.();if(!n)return null;if(he(n)){if(!o)return null;const r=It(fe,o);return r?r.positions:null}return new Map(e.map(r=>[r.id,r.at]))}const mr=({gutterMode:e,focusedCommentId:o,commentingOn:t,comments:n,getStableId:r})=>{const[{height:s},a]=ge(),i=re(),[c,l]=v.useState(()=>new Map),[f,d]=v.useState(()=>new Map),p=v.useCallback(({focusedHeights:b,heights:T})=>{l(b),d(T)},[]),g=b=>{const T=r(b);return b===o?c.get(T)??0:f.get(T)??0},h=i(),x=h!=null&&he(h)?b=>Ot(b,h.state.doc):void 0,C=new Map(n?.map(b=>[r(b.id),b])),E=fr(n),y=dr({composerHeight:s,commentingOn:t,getCommentHeight:g,getCollapsedStartPos:x,commentPositions:E,view:h}),I=lr({gutterMode:e,gutterPositions:y,focusedCommentId:o,getComment:b=>C.get(r(b))??null,getCommentKey:r});return{blockComposerRef:a,onMeasureComments:p,gutterEntries:I}};function pr(){const o=re()(),t=V(({commentingOn:s})=>s),r=o==null?null:Tn(o,t);return r==null?null:u.jsx(L.div,{className:"absolute",style:{top:r.loadingTop},initial:!1,animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},transition:{delay:.2},children:u.jsx(Ce,{})},"selection-loading")}const gr=e=>u.jsx("div",{className:"absolute",style:{top:Se(J(e))},children:u.jsx("div",{className:"h-[max(3rem,18vh)] w-1"})}),Ms=({availableWidth:e,comments:o,commentsMode:t,disableBlockComments:n=!1,isRequestActive:r=!1,isWaitingForCommentResponse:s=!1,onAddComment:a,onAcceptComment:i,onDismissComment:c,getStableCommentId:l})=>{const f=V(({focusedCommentId:S})=>S),d=V(({hoveredCommentId:S})=>S),p=V(({commentingOn:S})=>S),g=e<He?D.COLLAPSED:D.EXPANDED,{onMeasureComments:h,blockComposerRef:x,gutterEntries:C}=mr({comments:o,getStableId:l,gutterMode:g,focusedCommentId:f,commentingOn:p}),E=C.length>0,y=p!=null&&!s&&p.type!=="selection"||E,b=(()=>{if(!y)return 0;switch(g){case D.COLLAPSED:return 0;case D.EXPANDED:return He}})(),T=p?.type==="selection",P=oe(C);return u.jsxs(L.div,{className:M("pointer-events-none relative flex h-full flex-shrink-0",B.commentGutter,g===D.COLLAPSED&&b?"basis-[32px]":"basis-0"),initial:{width:0,opacity:0},animate:{width:b,opacity:1},exit:{width:0,opacity:0},children:[u.jsx(ar,{getStableCommentId:l,comments:o,onMeasure:h}),u.jsxs("div",{className:M("pointer-events-auto absolute bottom-0 left-0 top-0 w-0 overflow-visible",{"pl-2":y||!n}),children:[u.jsx(X,{children:C.map(S=>{const{key:A,type:ae}=S,ie=!!f&&ae===w.EXPANDED&&S.comment?.id===f,Q=!!f&&S.type===w.COLLAPSED&&S.children.includes(f);return u.jsx(sr,{isGutterCollapsed:g===D.COLLAPSED,isSomeCommentFocused:!!p||!!f,isHovered:ae===w.EXPANDED&&S.comment?.id===d,isFocused:ie||Q,entry:S,disableActions:r||s||t===$e.COMMENTS_READONLY,onAcceptComment:K=>{try{i?.(te(o?.find(G=>G.id===K)))}catch(G){j.logError(`Comment ${K} not found`,G)}},onDismissComment:K=>{try{c?.(te(o?.find(G=>G.id===K)))}catch(G){j.logError(`Comment ${K} not found`,G)}}},A)})}),E&&P&&u.jsx(gr,{...P}),t===$e.ENABLED&&!T&&!n&&u.jsx(Qn,{composerRef:x,gutterMode:g,onAddComment:a,isWaitingForCommentResponse:s,isRequestActive:r,hasComments:E}),s&&T&&u.jsx(pr,{})]})]})};function $(e,o,{checkForDefaultPrevented:t=!0}={}){return function(r){if(e?.(r),t===!1||!r.defaultPrevented)return o?.(r)}}function xe(e,o=[]){let t=[];function n(s,a){const i=v.createContext(a),c=t.length;t=[...t,a];function l(d){const{scope:p,children:g,...h}=d,x=p?.[e][c]||i,C=v.useMemo(()=>h,Object.values(h));return u.jsx(x.Provider,{value:C,children:g})}function f(d,p){const g=p?.[e][c]||i,h=v.useContext(g);if(h)return h;if(a!==void 0)return a;throw new Error(`\`${d}\` must be used within \`${s}\``)}return l.displayName=s+"Provider",[l,f]}const r=()=>{const s=t.map(a=>v.createContext(a));return function(i){const c=i?.[e]||s;return v.useMemo(()=>({[`__scope${e}`]:{...i,[e]:c}}),[i,c])}};return r.scopeName=e,[n,hr(r,...o)]}function hr(...e){const o=e[0];if(e.length===1)return o;const t=()=>{const n=e.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(s){const a=n.reduce((i,{useScope:c,scopeName:l})=>{const d=c(s)[`__scope${l}`];return{...i,...d}},{});return v.useMemo(()=>({[`__scope${o.scopeName}`]:a}),[a])}};return t.scopeName=o.scopeName,t}function vr(e,o){typeof e=="function"?e(o):e!=null&&(e.current=o)}function Lt(...e){return o=>e.forEach(t=>vr(t,o))}function Ie(...e){return v.useCallback(Lt(...e),e)}var me=v.forwardRef((e,o)=>{const{children:t,...n}=e,r=v.Children.toArray(t),s=r.find(xr);if(s){const a=s.props.children,i=r.map(c=>c===s?v.Children.count(a)>1?v.Children.only(null):v.isValidElement(a)?a.props.children:null:c);return u.jsx(ke,{...n,ref:o,children:v.isValidElement(a)?v.cloneElement(a,void 0,i):null})}return u.jsx(ke,{...n,ref:o,children:t})});me.displayName="Slot";var ke=v.forwardRef((e,o)=>{const{children:t,...n}=e;if(v.isValidElement(t)){const r=yr(t);return v.cloneElement(t,{...Er(n,t.props),ref:o?Lt(o,r):r})}return v.Children.count(t)>1?v.Children.only(null):null});ke.displayName="SlotClone";var Cr=({children:e})=>u.jsx(u.Fragment,{children:e});function xr(e){return v.isValidElement(e)&&e.type===Cr}function Er(e,o){const t={...o};for(const n in o){const r=e[n],s=o[n];/^on[A-Z]/.test(n)?r&&s?t[n]=(...i)=>{s(...i),r(...i)}:r&&(t[n]=r):n==="style"?t[n]={...r,...s}:n==="className"&&(t[n]=[r,s].filter(Boolean).join(" "))}return{...e,...t}}function yr(e){let o=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,t=o&&"isReactWarning"in o&&o.isReactWarning;return t?e.ref:(o=Object.getOwnPropertyDescriptor(e,"ref")?.get,t=o&&"isReactWarning"in o&&o.isReactWarning,t?e.props.ref:e.props.ref||e.ref)}function br(e){const o=e+"CollectionProvider",[t,n]=xe(o),[r,s]=t(o,{collectionRef:{current:null},itemMap:new Map}),a=g=>{const{scope:h,children:x}=g,C=R.useRef(null),E=R.useRef(new Map).current;return u.jsx(r,{scope:h,itemMap:E,collectionRef:C,children:x})};a.displayName=o;const i=e+"CollectionSlot",c=R.forwardRef((g,h)=>{const{scope:x,children:C}=g,E=s(i,x),y=Ie(h,E.collectionRef);return u.jsx(me,{ref:y,children:C})});c.displayName=i;const l=e+"CollectionItemSlot",f="data-radix-collection-item",d=R.forwardRef((g,h)=>{const{scope:x,children:C,...E}=g,y=R.useRef(null),I=Ie(h,y),b=s(l,x);return R.useEffect(()=>(b.itemMap.set(y,{ref:y,...E}),()=>void b.itemMap.delete(y))),u.jsx(me,{[f]:"",ref:I,children:C})});d.displayName=l;function p(g){const h=s(e+"CollectionConsumer",g);return R.useCallback(()=>{const C=h.collectionRef.current;if(!C)return[];const E=Array.from(C.querySelectorAll(`[${f}]`));return Array.from(h.itemMap.values()).sort((b,T)=>E.indexOf(b.ref.current)-E.indexOf(T.ref.current))},[h.collectionRef,h.itemMap])}return[{Provider:a,Slot:c,ItemSlot:d},p,n]}var _r=globalThis?.document?v.useLayoutEffect:()=>{},Nr=fo.useId||(()=>{}),Tr=0;function Pr(e){const[o,t]=v.useState(Nr());return _r(()=>{t(n=>n??String(Tr++))},[e]),o?`radix-${o}`:""}var Sr=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],F=Sr.reduce((e,o)=>{const t=v.forwardRef((n,r)=>{const{asChild:s,...a}=n,i=s?me:o;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),u.jsx(i,{...a,ref:r})});return t.displayName=`Primitive.${o}`,{...e,[o]:t}},{});function Oe(e){const o=v.useRef(e);return v.useEffect(()=>{o.current=e}),v.useMemo(()=>(...t)=>o.current?.(...t),[])}function Ee({prop:e,defaultProp:o,onChange:t=()=>{}}){const[n,r]=Ir({defaultProp:o,onChange:t}),s=e!==void 0,a=s?e:n,i=Oe(t),c=v.useCallback(l=>{if(s){const d=typeof l=="function"?l(e):l;d!==e&&i(d)}else r(l)},[s,e,r,i]);return[a,c]}function Ir({defaultProp:e,onChange:o}){const t=v.useState(e),[n]=t,r=v.useRef(n),s=Oe(o);return v.useEffect(()=>{r.current!==n&&(s(n),r.current=n)},[n,r,s]),t}var kr=v.createContext(void 0);function Le(e){const o=v.useContext(kr);return e||o||"ltr"}var Te="rovingFocusGroup.onEntryFocus",Ar={bubbles:!1,cancelable:!0},ye="RovingFocusGroup",[Ae,jt,Mr]=br(ye),[Rr,be]=xe(ye,[Mr]),[wr,Or]=Rr(ye),Dt=v.forwardRef((e,o)=>u.jsx(Ae.Provider,{scope:e.__scopeRovingFocusGroup,children:u.jsx(Ae.Slot,{scope:e.__scopeRovingFocusGroup,children:u.jsx(Lr,{...e,ref:o})})}));Dt.displayName=ye;var Lr=v.forwardRef((e,o)=>{const{__scopeRovingFocusGroup:t,orientation:n,loop:r=!1,dir:s,currentTabStopId:a,defaultCurrentTabStopId:i,onCurrentTabStopIdChange:c,onEntryFocus:l,preventScrollOnEntryFocus:f=!1,...d}=e,p=v.useRef(null),g=Ie(o,p),h=Le(s),[x=null,C]=Ee({prop:a,defaultProp:i,onChange:c}),[E,y]=v.useState(!1),I=Oe(l),b=jt(t),T=v.useRef(!1),[P,S]=v.useState(0);return v.useEffect(()=>{const A=p.current;if(A)return A.addEventListener(Te,I),()=>A.removeEventListener(Te,I)},[I]),u.jsx(wr,{scope:t,orientation:n,dir:h,loop:r,currentTabStopId:x,onItemFocus:v.useCallback(A=>C(A),[C]),onItemShiftTab:v.useCallback(()=>y(!0),[]),onFocusableItemAdd:v.useCallback(()=>S(A=>A+1),[]),onFocusableItemRemove:v.useCallback(()=>S(A=>A-1),[]),children:u.jsx(F.div,{tabIndex:E||P===0?-1:0,"data-orientation":n,...d,ref:g,style:{outline:"none",...e.style},onMouseDown:$(e.onMouseDown,()=>{T.current=!0}),onFocus:$(e.onFocus,A=>{const ae=!T.current;if(A.target===A.currentTarget&&ae&&!E){const ie=new CustomEvent(Te,Ar);if(A.currentTarget.dispatchEvent(ie),!ie.defaultPrevented){const Q=b().filter(z=>z.focusable),K=Q.find(z=>z.active),G=Q.find(z=>z.id===x),so=[K,G,...Q].filter(Boolean).map(z=>z.ref.current);Vt(so,f)}}T.current=!1}),onBlur:$(e.onBlur,()=>y(!1))})})}),Bt="RovingFocusGroupItem",Gt=v.forwardRef((e,o)=>{const{__scopeRovingFocusGroup:t,focusable:n=!0,active:r=!1,tabStopId:s,...a}=e,i=Pr(),c=s||i,l=Or(Bt,t),f=l.currentTabStopId===c,d=jt(t),{onFocusableItemAdd:p,onFocusableItemRemove:g}=l;return v.useEffect(()=>{if(n)return p(),()=>g()},[n,p,g]),u.jsx(Ae.ItemSlot,{scope:t,id:c,focusable:n,active:r,children:u.jsx(F.span,{tabIndex:f?0:-1,"data-orientation":l.orientation,...a,ref:o,onMouseDown:$(e.onMouseDown,h=>{n?l.onItemFocus(c):h.preventDefault()}),onFocus:$(e.onFocus,()=>l.onItemFocus(c)),onKeyDown:$(e.onKeyDown,h=>{if(h.key==="Tab"&&h.shiftKey){l.onItemShiftTab();return}if(h.target!==h.currentTarget)return;const x=Br(h,l.orientation,l.dir);if(x!==void 0){if(h.metaKey||h.ctrlKey||h.altKey||h.shiftKey)return;h.preventDefault();let E=d().filter(y=>y.focusable).map(y=>y.ref.current);if(x==="last")E.reverse();else if(x==="prev"||x==="next"){x==="prev"&&E.reverse();const y=E.indexOf(h.currentTarget);E=l.loop?Gr(E,y+1):E.slice(y+1)}setTimeout(()=>Vt(E))}})})})});Gt.displayName=Bt;var jr={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Dr(e,o){return o!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function Br(e,o,t){const n=Dr(e.key,t);if(!(o==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(o==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return jr[n]}function Vt(e,o=!1){const t=document.activeElement;for(const n of e)if(n===t||(n.focus({preventScroll:o}),document.activeElement!==t))return}function Gr(e,o){return e.map((t,n)=>e[(o+n)%e.length])}var Ft=Dt,je=Gt,Vr="Separator",ct="horizontal",Fr=["horizontal","vertical"],Ht=v.forwardRef((e,o)=>{const{decorative:t,orientation:n=ct,...r}=e,s=Hr(n)?n:ct,i=t?{role:"none"}:{"aria-orientation":s==="vertical"?s:void 0,role:"separator"};return u.jsx(F.div,{"data-orientation":s,...i,...r,ref:o})});Ht.displayName=Vr;function Hr(e){return Fr.includes(e)}var $r=Ht,Yr="Toggle",$t=v.forwardRef((e,o)=>{const{pressed:t,defaultPressed:n=!1,onPressedChange:r,...s}=e,[a=!1,i]=Ee({prop:t,onChange:r,defaultProp:n});return u.jsx(F.button,{type:"button","aria-pressed":a,"data-state":a?"on":"off","data-disabled":e.disabled?"":void 0,...s,ref:o,onClick:$(e.onClick,()=>{e.disabled||i(!a)})})});$t.displayName=Yr;var Z="ToggleGroup",[Yt,Ut]=xe(Z,[be]),Kt=be(),De=R.forwardRef((e,o)=>{const{type:t,...n}=e;if(t==="single"){const r=n;return u.jsx(Ur,{...r,ref:o})}if(t==="multiple"){const r=n;return u.jsx(Kr,{...r,ref:o})}throw new Error(`Missing prop \`type\` expected on \`${Z}\``)});De.displayName=Z;var[zt,Xt]=Yt(Z),Ur=R.forwardRef((e,o)=>{const{value:t,defaultValue:n,onValueChange:r=()=>{},...s}=e,[a,i]=Ee({prop:t,defaultProp:n,onChange:r});return u.jsx(zt,{scope:e.__scopeToggleGroup,type:"single",value:a?[a]:[],onItemActivate:i,onItemDeactivate:R.useCallback(()=>i(""),[i]),children:u.jsx(Wt,{...s,ref:o})})}),Kr=R.forwardRef((e,o)=>{const{value:t,defaultValue:n,onValueChange:r=()=>{},...s}=e,[a=[],i]=Ee({prop:t,defaultProp:n,onChange:r}),c=R.useCallback(f=>i((d=[])=>[...d,f]),[i]),l=R.useCallback(f=>i((d=[])=>d.filter(p=>p!==f)),[i]);return u.jsx(zt,{scope:e.__scopeToggleGroup,type:"multiple",value:a,onItemActivate:c,onItemDeactivate:l,children:u.jsx(Wt,{...s,ref:o})})});De.displayName=Z;var[zr,Xr]=Yt(Z),Wt=R.forwardRef((e,o)=>{const{__scopeToggleGroup:t,disabled:n=!1,rovingFocus:r=!0,orientation:s,dir:a,loop:i=!0,...c}=e,l=Kt(t),f=Le(a),d={role:"group",dir:f,...c};return u.jsx(zr,{scope:t,rovingFocus:r,disabled:n,children:r?u.jsx(Ft,{asChild:!0,...l,orientation:s,dir:f,loop:i,children:u.jsx(F.div,{...d,ref:o})}):u.jsx(F.div,{...d,ref:o})})}),pe="ToggleGroupItem",qt=R.forwardRef((e,o)=>{const t=Xt(pe,e.__scopeToggleGroup),n=Xr(pe,e.__scopeToggleGroup),r=Kt(e.__scopeToggleGroup),s=t.value.includes(e.value),a=n.disabled||e.disabled,i={...e,pressed:s,disabled:a},c=R.useRef(null);return n.rovingFocus?u.jsx(je,{asChild:!0,...r,focusable:!a,active:s,ref:c,children:u.jsx(lt,{...i,ref:o})}):u.jsx(lt,{...i,ref:o})});qt.displayName=pe;var lt=R.forwardRef((e,o)=>{const{__scopeToggleGroup:t,value:n,...r}=e,s=Xt(pe,t),a={role:"radio","aria-checked":e.pressed,"aria-pressed":void 0},i=s.type==="single"?a:void 0;return u.jsx($t,{...i,...r,ref:o,onPressedChange:c=>{c?s.onItemActivate(n):s.onItemDeactivate(n)}})}),Wr=De,qr=qt,Be="Toolbar",[Jr,Rs]=xe(Be,[be,Ut]),Ge=be(),Jt=Ut(),[Zr,Zt]=Jr(Be),Qt=v.forwardRef((e,o)=>{const{__scopeToolbar:t,orientation:n="horizontal",dir:r,loop:s=!0,...a}=e,i=Ge(t),c=Le(r);return u.jsx(Zr,{scope:t,orientation:n,dir:c,children:u.jsx(Ft,{asChild:!0,...i,orientation:n,dir:c,loop:s,children:u.jsx(F.div,{role:"toolbar","aria-orientation":n,dir:c,...a,ref:o})})})});Qt.displayName=Be;var eo="ToolbarSeparator",to=v.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=Zt(eo,t);return u.jsx($r,{orientation:r.orientation==="horizontal"?"vertical":"horizontal",...n,ref:o})});to.displayName=eo;var Qr="ToolbarButton",Ve=v.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=Ge(t);return u.jsx(je,{asChild:!0,...r,focusable:!e.disabled,children:u.jsx(F.button,{type:"button",...n,ref:o})})});Ve.displayName=Qr;var es="ToolbarLink",ts=v.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=Ge(t);return u.jsx(je,{asChild:!0,...r,focusable:!0,children:u.jsx(F.a,{...n,ref:o,onKeyDown:$(e.onKeyDown,s=>{s.key===" "&&s.currentTarget.click()})})})});ts.displayName=es;var oo="ToolbarToggleGroup",os=v.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=Zt(oo,t),s=Jt(t);return u.jsx(Wr,{"data-orientation":r.orientation,dir:r.dir,...s,...n,ref:o,rovingFocus:!1})});os.displayName=oo;var ns="ToolbarToggleItem",rs=v.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=Jt(t),s={__scopeToolbar:e.__scopeToolbar};return u.jsx(Ve,{asChild:!0,...s,children:u.jsx(qr,{...r,...n,ref:o})})});rs.displayName=ns;var ss=Qt,as=to,is=(e=>(e.CODE="code",e.WRITING="writing",e))(is||{});const se=({children:e,toolbarType:o})=>u.jsx(ss,{className:M("m-0 flex h-10 w-fit min-w-0 flex-shrink items-center overflow-hidden rounded-xl border border-token-border-light bg-token-main-surface-primary",pt,o==="code"?"p-0":"p-1"),children:e}),no=({icon:e,hideLabel:o,label:t})=>u.jsxs(u.Fragment,{children:[u.jsx(e,{className:M("icon-sm",{"mr-0.5 text-token-text-tertiary":!o,"text-token-text-primary":o})}),!o&&u.jsx("span",{className:"truncate text-sm text-token-text-primary",children:t})]}),ro=mt(Ve)`flex h-full items-center gap-1 rounded-lg px-2.5 hover:bg-[#f5f5f5] dark:hover:bg-token-main-surface-secondary`,cs=({label:e,icon:o,hideLabel:t=!1,onClick:n,onMouseDown:r})=>u.jsx(ro,{onClick:n,"aria-label":t?e:void 0,onMouseDown:r,children:u.jsx(no,{icon:o,hideLabel:t,label:e})}),ls=({icon:e,hideLabel:o,label:t,children:n})=>u.jsxs(Co,{children:[u.jsx(xo,{asChild:!0,children:u.jsx(ro,{"aria-label":o?t:void 0,children:u.jsx(no,{icon:e,hideLabel:o,label:t})})}),u.jsx(Eo,{children:u.jsx(yo,{align:"end",className:B.toolbar,sideOffset:8,children:n})})]});se.Separator=mt(as)`mx-1 p-0 list-none h-full w-[1px] bg-token-border-light`;se.Action=cs;se.Popover=ls;const us=({getSelectionRange:e})=>{const o=Me(),t=()=>{const n=e();if(n==null)return;const{from:r,to:s,sourceFrom:a,sourceTo:i}=n;if(r==null||s==null||a==null||i==null){j.logError("Missing selection range on targeted edit",n);return}const c=xt.ASK;j.logButtonClick(W.TOOLBAR_ASK_CHATGPT,{action:c,sourceFrom:a,sourceTo:i}),O.startCommentingOn({type:Y.SELECTION,from:r,to:s,sourceRange:{start:a,end:i},action:c})};return u.jsx(se.Action,{label:o.formatMessage({id:"wOaJUU",defaultMessage:"Ask ChatGPT"}),onClick:t,icon:Vo})},ws=({getEditorDom:e,getToolbarPosition:o,getSelectionRange:t,toolbarType:n,children:r,onAddComment:s,isWaitingForCommentResponse:a=!1})=>{const[{height:i,width:c},l]=ge(),[f,d]=v.useState(!0),[p,g]=v.useState(!1),h=e(),x=V(({commentingOn:P})=>P),[C,E]=v.useState(null),y=v.useCallback(()=>{const P=e(),S=document.getSelection();return!S||S.type!=="Range"||S.isCollapsed||!P?.contains(S.anchorNode)},[e]);v.useEffect(()=>{const P=bo(()=>{g(!0)},200,{leading:!0}),S=()=>{P.cancel(),g(!1)};return h?.addEventListener("pointerdown",P,{passive:!0}),document.addEventListener("pointerup",S,{passive:!0}),()=>{h?.removeEventListener("pointerdown",P),document.removeEventListener("pointerup",S)}},[h]),v.useEffect(()=>{const P=()=>{d(y())};return document.addEventListener("selectionchange",P,{passive:!0}),()=>{document.removeEventListener("selectionchange",P)}},[y]),ft(()=>{if(f||y())return d(!0);try{const P=o({width:c,height:i});P!=null&&E(P)}catch(P){j.logError("Invalid position in getToolbarPosition",P)}},[i,c,f,y,o]);const I=u.jsxs(se,{toolbarType:n,children:[u.jsx(us,{getSelectionRange:t}),r]}),b=!f&&!x&&C!=null,T=zo(b);return v.useEffect(()=>{!b&&T&&!x&&h?.focus()},[h,T,b,x]),u.jsxs(u.Fragment,{children:[u.jsx("div",{"aria-hidden":"true",className:"pointer-events-none invisible fixed left-0 top-0 h-0 overflow-clip",children:u.jsx("div",{ref:l,children:I})}),u.jsx(X,{children:b&&u.jsx(L.div,{initial:{opacity:0,scale:.95},animate:{opacity:p?0:1,scale:p?.95:1},style:{top:C.top,left:C.left},exit:{opacity:0,scale:.95},transition:{type:"spring",bounce:.1,duration:.1,delay:p?0:.1},className:M("absolute",B.toolbar,p?"pointer-events-none":"pointer-events-auto"),children:I})}),u.jsx(Sn,{toolbarPosition:C,commentingOn:x,isWaitingForCommentResponse:a,onAddComment:s})]})};function ds(e){let o=e;for(;o;){const n=window.getComputedStyle(o).overflowY;if(n==="auto"||n==="scroll")return o;o=o.parentElement}return null}function Os(e,o){const t=re(),n=_o(),r=t();v.useEffect(()=>{const s=r?.dom;if(!s||e.length===0)return;const a=()=>{if(!n)return;const{textdocId:f,history:d}=n;d?No(f,d):To(f)},i=ds(s),c=f=>{f.key==="Escape"&&a()};window.document.addEventListener("keydown",c,{passive:!0});const l=o?vt(o,100):null;return i&&l&&i.addEventListener("scroll",l,{passive:!0}),()=>{window.document.removeEventListener("keydown",c),l&&(i&&i.removeEventListener("scroll",l),l.cancel())}},[r,n,e,o])}let ce=null;function Ls(){if(ce!=null)return ce;if(typeof window>"u")return 0;const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.overflow="scroll",e.style.position="absolute",e.style.top="-9999px",document.body.appendChild(e);try{ce=e.offsetWidth-e.clientWidth}finally{document.body.removeChild(e)}return ce}function js(e){return e==null?null:e.scrollHeight>e.clientHeight}export{Tt as A,In as B,Ms as C,ur as D,se as E,q as H,U as I,wn as P,jn as R,ws as T,Ps as a,Ts as b,is as c,Ls as d,ne as e,en as f,Ns as g,Ss as h,js as i,we as j,Ln as k,On as l,qo as m,kt as n,Is as o,Dn as p,Je as q,kn as r,_s as s,Rn as t,Os as u,nn as v,ks as w,As as x,It as y,fe as z};
//# sourceMappingURL=nc4kw6by74hh7wj1.js.map
