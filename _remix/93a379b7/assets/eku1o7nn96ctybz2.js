import{U as F,r as i,a6 as e,ar as C,cN as Q,aj as Y,a2 as J,P as L,d as G,v as U,aH as h,aL as T,ai as X,ak as Z,b1 as q}from"./l3hptpare9m1mqfv.js";import{bn as B,b7 as ee,d1 as se,d2 as te,d3 as re,d4 as ae,d5 as ie,d6 as oe,bV as K,bY as ne}from"./c7sgref9mfwezh7s.js";import{G as le,a as ce}from"./cwxwqqwxymts05ba.js";import{a as de}from"./dpmpp4vjdzk6xdj4.js";import{w as me,Q as ue}from"./km9gro7xi1t4gs2t.js";import{G as xe}from"./ighnjpo7t7h4h60s.js";import{a as V}from"./be8bofiqdkk45zw7.js";function ge({gizmo:t,children:s,onClick:r,onModalOpen:l,onModalClose:m,selectOnly:a,className:d}){const u=F("1825130190").value,[x,o]=i.useState(!1);return a?e.jsx("a",{className:C("gizmo-link cursor-pointer",d),href:"#",onClick:n=>{n.preventDefault(),r?.(n)},children:s}):u?e.jsxs(e.Fragment,{children:[x&&e.jsx(le,{gizmoId:t.gizmo.id,creatorId:t.gizmo.author.user_id,onClose:()=>{o(!1),m?.()},children:e.jsx(ce,{as:"link",to:B(t)})}),e.jsx("a",{className:C("gizmo-link cursor-pointer",d),href:"#",onClick:n=>{n.preventDefault(),r?.(n),o(!0),l?.()},children:s})]}):e.jsx(Q,{to:B(t),className:C("gizmo-link",d),target:"_blank",onClick:r,children:s})}const Ce=i.forwardRef(function({className:s,inputClassName:r,iconClassName:l,open:m,setOpen:a,resultsSizeOffset:d,placeholder:u,effectiveRole:x,onSelect:o},n){const k=Y(),[v,y]=i.useState(""),[E,b]=i.useState(""),[g,M]=i.useState(!1),S=m??g,j=a??M,z=i.useRef(null),A=J()?.isWorkspaceAccount(),W=F("3054422710").value,I=A!==void 0&&A&&W,c=ee();i.useEffect(()=>{if(!S)return;const N=R=>{R.key==="Escape"&&(j(!1),z.current?.blur())},D=R=>{R.target instanceof Node&&typeof n!="function"&&!n?.current?.contains(R.target)&&j(!1)};return document.addEventListener("keydown",N,!1),document.addEventListener("mousedown",D,!1),()=>{document.removeEventListener("keydown",N,!1),document.removeEventListener("mousedown",D,!1)}},[S,j,z,n]);const[f,H]=i.useState();i.useEffect(()=>{const N=()=>{H(window.visualViewport?.height)};return window.visualViewport?.addEventListener("resize",N),N(),()=>{window.visualViewport?.removeEventListener("resize",N)}},[H]);const[_,$]=i.useState(!1);return i.useEffect(()=>{_&&!S&&j(!0)},[_,j,S]),i.useEffect(()=>{const N=setTimeout(()=>{b(v)},250);return()=>{clearTimeout(N)}},[v]),e.jsxs(V,{as:"div",className:C("group relative rounded-xl",s),ref:n,style:c?{width:"calc(min(var(--screen-content-ideal-size, 40rem), var(--container-w-except-padding)) - 1rem)"}:void 0,children:[e.jsx(me,{className:C("pointer-none icon-md absolute top-0 h-full text-token-text-tertiary",l)}),e.jsx("input",{className:C("z-10 w-full rounded-xl border border-token-border-light bg-token-main-surface-primary py-2 pr-3 font-normal outline-0 delay-100","",r),placeholder:u??k.formatMessage(p.discoverySearch),value:v,onChange:N=>y(N.target.value),onFocus:()=>{j(!0),L.logEvent(G.searchOpened)},ref:z}),e.jsx(de,{show:S,children:e.jsx(V.Panel,{static:!0,className:"absolute top-[calc(100%-10px)] w-full overflow-y-auto rounded-lg rounded-t-none border border-t-0 border-token-border-light bg-token-main-surface-primary px-3 py-2",style:{maxHeight:f!=null?f+(d??0):"100vh"},children:e.jsx(fe,{query:E,effectiveRole:x,setPopoverForceOpen:$,onSelect:o,showWorkspaceResults:I})})})]})});function O(){return e.jsx("div",{className:"flex items-center justify-center py-1",children:e.jsx(q,{})})}function fe({query:t,effectiveRole:s,setPopoverForceOpen:r,showWorkspaceResults:l,onSelect:m}){const[a,d]=i.useState("ALL");i.useEffect(()=>{L.logEvent(G.searchStart)},[]);const{data:u,isLoading:x}=se(t),{data:o,isLoading:n}=te(t,l),{data:k,isLoading:v}=re({cutId:"recent",limit:3});return e.jsx(he,{debouncedQuery:t,searchResults:u?.items,isLoadingSearch:x,searchResultsCursor:u?.cursor,showWorkspaceResults:l,workspaceSearchResults:o?.items,workspaceSearchResultsCursor:o?.cursor,isLoadingWorkspaceSearch:n,isLoadingRecent:v,recent:k?.pages.flatMap(y=>y.list.items.map(E=>E.resource))??[],effectiveRole:s,setPopoverForceOpen:r,onSelect:m,activeTab:a,setActiveTab:d})}function he({debouncedQuery:t,searchResults:s,isLoadingSearch:r,searchResultsCursor:l,showWorkspaceResults:m,workspaceSearchResults:a,workspaceSearchResultsCursor:d,isLoadingWorkspaceSearch:u,recent:x,isLoadingRecent:o,effectiveRole:n,setPopoverForceOpen:k,onSelect:v,activeTab:y,setActiveTab:E}){const b=i.useRef(U());if(i.useEffect(()=>{L.logEvent(G.searchStart)},[]),i.useEffect(()=>{!r&&s&&(b.current=U(),s.length>0?Promise.all(s.map((g,M)=>{L.logEvent(G.searchDisplayResult,{search_id:b.current,gizmo_id:g.gizmo.id,position:M,query:t})})):L.logEvent(G.searchNoResults,{query:t}))},[s,r,t]),t===""&&o)return e.jsx(O,{});if(m){if(y==="ALL"&&r||y==="WORKSPACE"&&u)return e.jsx(O,{});if(t!==""&&!r&&!u&&(!s||s.length===0)&&(!a||a.length===0))return e.jsx("div",{className:"mx-2",children:e.jsx(w,{onClick:void 0,isSelected:void 0,isClickable:!1,children:e.jsx(h,{...p.discoveryNoResultsSearch})})})}else{if(r)return e.jsx(O,{});if(t!==""&&!r&&(!s||s.length===0))return e.jsx("div",{className:"mx-2",children:e.jsx(w,{onClick:void 0,isSelected:void 0,isClickable:!1,children:e.jsx(h,{...p.discoveryNoResultsSearch})})})}return e.jsxs(e.Fragment,{children:[e.jsx(ve,{query:t,activeTab:y,setActiveTab:E,showWorkspaceResults:m,recentSearchResults:x??[]}),e.jsx(pe,{query:t}),e.jsx(ye,{query:t,searchIdRef:b.current,searchResults:s,searchResultsCursor:l,isLoadingSearch:r,workspaceSearchResults:a,workspaceSearchResultsCursor:d,isLoadingWorkspaceSearch:u,recentSearchResults:x??[],activeTab:y,setPopoverForceOpen:k,effectiveRole:n,onSelect:v})]})}function pe({query:t}){if(/search\s?gpt/i.test(t))return e.jsx("div",{className:"mb-1 mt-2 rounded-lg bg-gray-50 py-3 text-center text-xs dark:bg-gray-750",children:e.jsx(h,{id:"NEGLw8",defaultMessage:"Learn more about OpenAI's <searchGPTLink>SearchGPT prototype</searchGPTLink>",values:{searchGPTLink:s=>e.jsx(Q,{to:"/search",target:"_blank",className:"text-brand-blue-800 dark:text-blue-400",onClick:()=>{L.logEvent(G.searchGPTGizmoBannerLinkClicked)},children:s})}})})}function w({children:t,onClick:s,isSelected:r,isClickable:l}){return e.jsx("div",{className:`px-3 pb-2 text-xs text-token-text-tertiary ${r?"border-b-2 font-bold":"font-semibold"} ${l?"cursor-pointer":""}`,onClick:()=>{s?.()},children:t})}function ve({query:t,activeTab:s,setActiveTab:r,showWorkspaceResults:l,recentSearchResults:m}){const a=ae();return t===""?m&&m.length>0?e.jsx(w,{onClick:void 0,isSelected:!1,isClickable:!1,children:e.jsx(h,{...p.discoverySearchRecentlyUsed})}):e.jsx(w,{onClick:void 0,isSelected:void 0,isClickable:!1,children:e.jsx(h,{...p.discoverySearchRecentlyUsedEmpty})}):e.jsxs("div",{className:"flex",children:[e.jsx(w,{onClick:()=>r("ALL"),isSelected:s==="ALL"&&l,isClickable:l,children:e.jsx(h,{...p.discoveryAllResultsHeader})}),l&&e.jsx(w,{onClick:()=>r("WORKSPACE"),isSelected:s==="WORKSPACE",isClickable:!0,children:e.jsx(h,{...p.discoveryWorkspaceResultsHeader,values:{workspaceName:a}})})]})}function ye({query:t,searchIdRef:s,searchResults:r,searchResultsCursor:l,isLoadingSearch:m,workspaceSearchResults:a,workspaceSearchResultsCursor:d,isLoadingWorkspaceSearch:u,recentSearchResults:x,setPopoverForceOpen:o,activeTab:n,effectiveRole:k,onSelect:v}){const[y,E]=i.useState(!1),b=ie(t,y,n==="WORKSPACE",n==="WORKSPACE"?d:l),{data:g,hasNextPage:M,fetchNextPage:S,isFetchingNextPage:j,isError:z}={...b,data:b.data?.pages.flatMap(c=>c.items.map(f=>f))??[]},[A,W]=i.useState(g.length),I=i.useRef(null);return i.useEffect(()=>{g.length>A&&(W(g.length),I.current?.scrollIntoView({behavior:"smooth",block:"nearest"}))},[g.length,A]),t===""&&x&&x.length>0?e.jsx(e.Fragment,{children:x.map((c,f)=>e.jsx(P,{searchId:s,position:f,query:t,resource:c,effectiveRole:k,setPopoverForceOpen:o,onSelect:v},c.gizmo.id))}):t!==""&&!m&&n==="ALL"&&(r==null||r.length===0)?e.jsx("div",{className:"mt-4 px-3 pb-2 text-xs font-semibold text-token-text-tertiary",children:e.jsx(h,{...p.discoveryNoResultsSearch})}):t!==""&&!u&&n==="WORKSPACE"&&(a==null||a.length===0)?e.jsx("div",{className:"mt-4 px-3 pb-2 text-xs font-semibold text-token-text-tertiary",children:e.jsx(h,{...p.discoveryNoResultsSearch})}):e.jsx("div",{children:n==="ALL"?e.jsxs("div",{children:[r&&r.map((c,f)=>e.jsx(P,{searchId:s,position:f,query:t,resource:c,effectiveRole:k,setPopoverForceOpen:o,onSelect:v},c.gizmo.id)),r&&g&&g.map((c,f)=>e.jsx(P,{searchId:s,position:f+r?.length,query:t,resource:c,effectiveRole:k,setPopoverForceOpen:o,onSelect:v},c.gizmo.id)),(!y&&g.length===0||M||j||z)&&l!=null&&e.jsx(T,{color:z?"danger-outline":"secondary",onClick:()=>{E(!0),S(),o?.(!0)},loading:j,fullWidth:!0,className:"mt-2 md:mt-3",children:z?e.jsx(h,{...p.discoveryLoadMoreError}):e.jsx(h,{...p.discoveryLoadMore})})]}):e.jsxs("div",{children:[a&&a.map((c,f)=>e.jsx(P,{searchId:s,position:f,resource:c,query:t,setPopoverForceOpen:o},c.gizmo.id)),a&&g&&g.map((c,f)=>e.jsx(P,{searchId:s,position:f+a?.length,query:t,resource:c,effectiveRole:k,setPopoverForceOpen:o,onSelect:v},c.gizmo.id)),(!y&&g.length===0||M||j||z)&&d!=null&&e.jsx(T,{color:z?"danger-outline":"secondary",onClick:()=>{E(!0),S(),o?.(!0)},fullWidth:!0,className:"mt-2 md:mt-3",loading:j,children:z?e.jsx(h,{...p.discoveryLoadMoreError}):e.jsx(h,{...p.discoveryLoadMore})})]})})}function P({searchId:t,resource:s,position:r,query:l,effectiveRole:m,setPopoverForceOpen:a,onSelect:d}){const u=s.gizmo.vanity_metrics?.num_conversations_str,x=oe(),o=s.gizmo.tags?.includes(K.WorkspaceDisabled)&&m!==X.OWNER;return e.jsxs(ge,{gizmo:s,className:C("group mx-2 flex items-center gap-3 rounded-lg px-3 py-2 hover:bg-gray-50 dark:hover:bg-white/10",o&&"opacity-50 hover:opacity-100"),onClick:()=>{d?d(s):L.logEvent(G.storeClickGizmo,{search_id:t,gizmo_id:s.gizmo.id,position:r,query:l,section:"search"})},onModalOpen:()=>{a?.(!0)},onModalClose:()=>{a?.(!1)},selectOnly:!!d,children:[e.jsx(ne,{isFirstParty:!!s.gizmo.tags?.includes(K.FirstParty),src:s.gizmo.display.profile_picture_url??void 0,className:C("h-8 w-8 shrink-0",o&&"grayscale group-hover:grayscale-0")}),e.jsxs("div",{className:"flex flex-col space-y-1 truncate",children:[e.jsx("div",{className:"flex flex-row items-end space-x-2",children:e.jsx("span",{className:"shrink-0 truncate text-sm font-semibold",children:s.gizmo.display.name})}),x&&e.jsx("span",{className:"max-w-md truncate text-xs text-token-text-tertiary",children:s.gizmo.display.description}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"-mt-1",children:e.jsx(xe,{gizmo:s,className:"truncate text-xs text-token-text-tertiary",hideLink:!0})}),u&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center gap-1 font-semibold text-token-text-tertiary",style:{marginTop:"-2px"},children:[e.jsx(ue,{className:"icon-xs"}),e.jsx("span",{className:"line-clamp-1 text-xs",children:u})]})})]})]})]})}const p=Z({discoveryAllResultsHeader:{id:"gizmo.discovery.AllResultsHeader",defaultMessage:"All"},discoveryWorkspaceResultsHeader:{id:"gizmo.discovery.workspaceResultsHeaderName",defaultMessage:"{workspaceName} workspace"},discoveryNoResultsSearch:{id:"gizmo.discovery.search.empty",defaultMessage:"No results found"},discoverySearch:{id:"gizmo.discovery.search",defaultMessage:"Search GPTs"},discoverySearchRecentlyUsed:{id:"gizmo.discovery.search.recentlyUsed",defaultMessage:"Recently Used"},discoverySearchRecentlyUsedEmpty:{id:"gizmo.discovery.search.recentlyUsedEmpty",defaultMessage:"No recently used GPTs"},discoveryLoadMore:{id:"gizmo.discovery.loadMore",defaultMessage:"See more"},discoveryLoadMoreError:{id:"gizmo.discovery.loadMoreError",defaultMessage:"Error loading more"}});export{ge as D,Ce as G};
//# sourceMappingURL=eku1o7nn96ctybz2.js.map
