const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/sso-l6maw02gfr61gxuy.js","assets/l3hptpare9m1mqfv.js","assets/km9gro7xi1t4gs2t.js","assets/root-pbd7dlk8.css","assets/c7sgref9mfwezh7s.js","assets/conversation-small-ict01xsi.css","assets/dpmpp4vjdzk6xdj4.js","assets/ds7myuf7nkx8b20x.js","assets/bkgevi7dwlpkqxzf.js","assets/ev3ca23urw2rf3h9.js","assets/i4jzjalmx9h3noc6.js","assets/mh08vel4sd7gl5e4.js","assets/o8pwa9djmd3woe3v.js","assets/lns5kq4ey1gyy1uu.js","assets/duyea5q9uhztwp3a.js","assets/m3u39f47qeyvq62d.js","assets/mht8s0gbxscgla4h.js","assets/bn8prp53be57kvrr.js","assets/nnbdhs3jm6w31w40.js","assets/itghwucfyv5ciib7.js","assets/hfnvhnx4tjyvep6z.js","assets/lf4es60s4kckl0yk.js","assets/iun23drvqs0fpxk6.js","assets/n5kcz8n2w7jr63jr.js","assets/lvbcuxdmjki2cvij.js","assets/983a0dy92b3ronpv.js","assets/g1bu5c1ec5yxyg3p.js","assets/kqwdyvkaaavvn8k3.js","assets/ncl359hthn5v44i3.js","assets/ng2uc9w22y62gn06.js","assets/okp41zh4bsuygyd2.js","assets/i6qz7v651vjjrezh.js","assets/e9lafxuzyeh4418f.js","assets/g17ny8y1cqtvxzoo.js","assets/ee918rv19yl7fa6v.js","assets/not8qb855y7h2g0l.js","assets/ngbip2m6jkxbcxc8.js","assets/gde52p7rbqlsz28z.js","assets/dblqglbuigwu0tuc.js","assets/iej0cupg2dqkmejt.js","assets/n6f2h57crrqbwq7s.js","assets/dlgj6pr5esd4jcw4.js","assets/jk8w36bsokizpx57.js","assets/ighnjpo7t7h4h60s.js","assets/0odnh5vt1ryeof4u.js","assets/ket2mxd52rxkhf27.js","assets/mf0ttb2hpwuwu86q.js","assets/h50zu6s2u2uacmov.js","assets/l0xfn9kpbf63uq0m.js","assets/b0cc5t6nfdppks2k.js","assets/eku1o7nn96ctybz2.js","assets/cwxwqqwxymts05ba.js","assets/mzxkdr9pas3hg58p.js","assets/be8bofiqdkk45zw7.js","assets/gglanyq0myoxra0i.js","assets/js1kbx8gxo422op6.js","assets/beaxjp5jjpr3rgid.js"])))=>i.map(i=>d[i]);
import{r as d,aw as Me,a6 as e,P as q,d as H,aH as P,b4 as Da,g9 as Lo,bV as Fa,c as qr,f as $r,ax as En,aj as ee,ak as be,cJ as Nn,aB as ze,ca as kt,R as ve,ar as A,a_ as De,di as Oo,bG as Bo,U as _t,ga as Kr,gb as Yr,a7 as Rt,dL as Xr,d6 as La,b1 as zo,c5 as Uo,aE as Pt,w as Ne,aG as It,a1 as Qs,S as ce,aZ as Dt,b8 as us,aL as Ve,aa as Zs,a5 as Ho,aK as Oa,a2 as hs,$ as Go,Z as Js,bS as en,an as Ft,d3 as Qr,eT as Qn,I as et,aR as ns,bP as Zr,bQ as Jr,bR as el,s as tl,bt as Fe,D as Rn,O as Wo,a0 as sl,a8 as Ba,j as Vo,eP as nl,K as Ke,v as qo,n as yt,gc as al,at as $o,gd as za,a9 as ol,X as Zn,ge as il,dF as rl,dG as ll,dJ as ts,dH as Ua,dI as cl,c2 as wt,gf as dl,M as Tt,aP as ul,cY as hl,a$ as fe,aS as ml,b7 as fl,gg as gl,dr as pl}from"./l3hptpare9m1mqfv.js";import{na as tn,nb as xl,nc as Sl,bc as ms,e6 as vl,nd as bl,ne as yl,fU as sn,fV as mt,bA as fs,nf as wl,ds as Ue,cM as Ko,cP as Yo,aj as jl,a2 as Ml,db as Cl,cL as kl,ng as Re,nh as At,ni as _l,nj as Tl,nk as Al,nl as El,nm as Nl,nn as Rl,lk as Pl,d$ as ft,no as Il,np as Dl,v as Q,nq as Fl,nr as oe,ns as Xo,nt as Qo,nu as Jn,nv as Ll,nw as Zo,mO as ea,nx as ta,ny as Ol,nz as Bl,nA as nn,nB as Xt,mn as Pn,cw as an,dB as sa,F as on,nC as Jo,nD as zl,nE as Ul,nF as Hl,mq as as,s as ei,nG as Gl,nH as Wl,nI as Vl,d7 as ti,cX as ql,nJ as $l,jt as Kl,fG as Yl,nK as Xl,nL as Ql,nM as si,nN as Zl,b7 as Ye,nO as Jl,nP as Hs,r as Ha,gK as ec,hI as tc,gC as sc,nQ as ni,hQ as nc,ki as ac,nR as ai,nS as oc,d6 as ic,ij as na,fM as aa,nT as rc,nU as oi,dF as os,cC as Et,nV as ii,nW as ri,cx as rn,dy as is,nX as We,nY as li,nZ as lc,n_ as cc,n$ as Gs,o0 as dc,o1 as uc,o2 as hc,o3 as mc,n as fc,o4 as gc,o5 as pc,o6 as xc,o7 as Sc,o8 as ln,o9 as oa,oa as vc,dG as ci,ob as bc,bg as gs,oc as yc,lu as di,od as wc,cs as jc,cq as Mc,oe as Cc,of as Ws,aa as ia,p as kc,gz as ui,t as _c,fK as hi,og as Ga,oh as Tc,oi as Ac,oj as Ec,mp as Nc,my as Wa,ok as Rc,ol as Pc,om as Ic,on as Dc,gp as mi,oo as Fc,op as Lc,lt as fi,fT as gi,A as ra,oq as Va,cl as Oc,or as Bc,os as zc,fu as Uc,mm as Hc,fv as Gc,fw as Wc,ot as pi,ou as In,ov as Vc,ow as qc,ox as $c,oy as Kc,oz as Yc,bZ as xi,U as rs,bV as la,bY as Xc,oA as Qc,oB as Zc,oC as Jc,oD as ed,oE as td,oF as sd,oG as nd,oH as ad,dw as od,fx as id,a8 as Nt,oI as rd,oJ as ld,b$ as Si,oK as cd,oL as dd,oM as ud,oN as hd,oO as md,oP as fd,oQ as gd,dr as ca,e0 as da,a7 as ua,oR as vi,oS as ha,cD as ls,oT as pd,oU as xd,oV as Sd,fi as Je,oW as Vs,ll as Dn,i9 as bi,fX as yi,oX as wi,oY as vd,l_ as bd,oZ as yd,o_ as wd,cv as ma,cA as Fn,o$ as jd,p0 as ji,dt as cn,p1 as Md,cu as Bs,p2 as Ln,d as Mi,p3 as qa,p4 as Cd,p5 as kd,p6 as _d,ct as Td,p7 as Ad,p8 as Ed,u as Nd,dC as Rd,p9 as Ci,dD as fa,lE as ga,fp as Pd,b_ as Id,c5 as Dd,pa as Fd,m as Ld,pb as Qe,q as ki,pc as Od,dE as Mn,pd as _i,l as Bd,i as zd,iS as Is,pe as Ud,dP as Hd,pf as Gd,dY as Wd,iI as Vd,pg as qd,ph as $d,pi as Kd,f2 as Yd,n2 as Xd,pj as Qd,gH as Zd,pk as Jd,pl as Ti,pm as Ai,kD as Ei,pn as eu,jH as tu,kr as pa,dk as Ni,po as su,pp as Qt,pq as nu,bw as Ri,pr as au,ae as Pi,iz as ou,ps as Ii,pt as $a,pu as On,pv as iu,f_ as Zt,eS as ru,f$ as qs,mx as $s,pw as Bn,px as lu,py as cu,pz as du,pA as uu,jZ as Ka,pB as Ds,g2 as $e,pC as hu,ch as Di,ci as Fi,e2 as mu,pD as fu,fI as gu,kB as pu,cz as Li,lm as xu,pE as Su,pF as vu,pG as bu,pH as yu,du as wu,fZ as ju,pI as Mu,pJ as Cu,pK as ku,pL as _u,pM as Tu,pN as Au,pO as Eu,pP as Nu,pQ as Ru,c7 as Oi,jF as Pu,kd as Iu,kc as Du,pR as Fu,pS as Lu,pT as Bi,gO as Ou,gl as zi,pU as Bu,gj as zu,jT as Uu,gk as Cn,pV as Hu,pW as Gu,gv as Wu,gn as Vu,pX as qu,kz as $u,kA as Ku,gF as Yu,cW as Xu,b6 as Qu,gD as Zu,gE as Ju,gG as eh,pY as th,gq as Ya,c8 as sh,c9 as nh,iM as ah,pZ as oh,iv as ih}from"./c7sgref9mfwezh7s.js";import{e as ps,P as xs,d as rh,D as lh,T as zn,g as ch,E as dh,h as uh}from"./gef2pkbm9t7u9jaf.js";import{p as hh,k as Un,c as Xa,h as mh,u as fh,r as Qa,g as gh,i as ph,n as xh}from"./ma543wl1emaceytt.js";import{b$ as Sh,aa as vh,c0 as bh,bO as yh,ad as wh,c1 as jh,d as Ui,bI as Mh,p as Ch,ar as xa,bm as kh,ap as Hi,c2 as Ss,ae as Gi,H as _h,c3 as Th,bA as Wi,au as Ah,bQ as Eh,c4 as Nh,a1 as Rh,c5 as Ph,c as Vi,aJ as dn,a4 as Ih,c6 as qi,aV as Dh,c7 as Fh,aU as Lh,bJ as Oh,E as Bh,bj as $i,bk as Ki,b as zh,al as Uh,ak as Hh,b4 as Gh,P as Wh,bo as Vh,X as qh,bD as $h}from"./km9gro7xi1t4gs2t.js";import{m as te}from"./mh08vel4sd7gl5e4.js";import{D as z,B as Kh,$ as Yi}from"./ds7myuf7nkx8b20x.js";import{b as Yh}from"./j6n14by4mv1mn19j.js";import{m as Xh,n as Qh,o as Zh,p as Jh}from"./dpmpp4vjdzk6xdj4.js";import{S as Xi,a as em,b as tm,G as sm,L as nm,c as am}from"./mzxkdr9pas3hg58p.js";import om from"./fg34biyrlirgihlj.js";import{I as im,B as rm}from"./i4jzjalmx9h3noc6.js";import{C as Hn,g as lm}from"./lqjdha68cqgoq5qr.js";import{a as cm}from"./0odnh5vt1ryeof4u.js";const Qi=new ps("transactionEventPlugin"),Gn="prosemirrorDispatchTransaction";function Za(t,s){const{eventTarget:n}=Qi.getState(t.state);return n.addEventListener(Gn,s),()=>{n.removeEventListener(Gn,s)}}function dm(t){return new xs({key:Qi,state:{init(){return{eventTarget:t}},apply(s,n){return n}}})}const zs=new ps("customKeymapPlugin");function um(t,s){t.dispatch(t.state.tr.setMeta(zs,{handlers:s}))}function hm(t={handlers:{}}){return new xs({key:zs,state:{init(){return{...t}},apply(s,n){const a=s.getMeta(zs);return a?{...n,...a}:n}},props:{handleKeyDown(s,n){const o=zs.getState(s.state).handlers[n.key];return o?o(n):!1}}})}const ht=new ps("menuSelectorPlugin");function jt(t){t.dispatch(t.state.tr.setMeta(ht,{active:!1,onMenuAction:void 0}))}function mm(t,s){t.dispatch(t.state.tr.setMeta(ht,{active:!0,onMenuAction:s}))}function fm(t={submitKeys:["Enter","Tab"],cancelKeys:["Escape"],checkStrictMatchKeys:[]}){return new xs({key:ht,state:{init(){return{...t,active:!1}},apply(s,n){const a=s.getMeta(ht);return a?{...n,...a}:n}},props:{handleKeyDown(s,n){const a=ht.getState(s.state);return a.active?a.submitKeys.includes(n.key)?(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),a.onMenuAction?.("submit"),jt(s),!0):a.cancelKeys.includes(n.key)?(n.preventDefault(),a.onMenuAction?.("cancel"),jt(s),!0):n.key==="ArrowUp"?(n.preventDefault(),a.onMenuAction?.("up"),!0):n.key==="ArrowDown"?(n.preventDefault(),a.onMenuAction?.("down"),!0):(a.checkStrictMatchKeys.includes(n.key)&&a.onMenuAction?.("checkMatch"),!1):!1},handleDOMEvents:{blur:s=>{ht.getState(s.state).onMenuAction?.("cancel")}}}})}const Jt=new ps("placeholderPlugin");function gm(t){return new xs({key:Jt,state:{init(){return{placeholder:t}},apply(s,n){return s.getMeta(Jt)?{placeholder:s.getMeta(Jt).placeholder}:n}},props:{decorations(s){const{doc:n}=s;if(n.childCount===1&&n.firstChild?.isTextblock&&n.firstChild.content.size===0){const o=[],{placeholder:i}=Jt.getState(s);return s.doc.descendants((r,l)=>{const c=rh.node(l,l+r.nodeSize,{class:"placeholder","data-placeholder":i});o.push(c)}),lh.create(n,o)}}}})}const un="command_token",pm={group:"inline",inline:!0,atom:!0,content:"text*",attrs:{id:"",hint:""},selectable:!1,draggable:!1,toDOM:t=>["span",{"data-mention-id":t.attrs.id,"data-mention-hint":t.attrs.hint,class:"hint-pill"},t.attrs.hint],parseDOM:[{tag:"span[data-mention-id][data-mention-hint]",getAttrs:t=>{const s=t.getAttribute("data-mention-id"),n=t.getAttribute("data-mention-hint");return{id:s,hint:n}}}]};function Zi(t,s){if(t.depth===0)return;const n=t.before(),o=t.doc.textBetween(n,t.pos,`
`,"\0").match(new RegExp(/(^|\s)\/(\w*)$/));if(o&&o.index!==void 0){const i=o[0].startsWith(" ")?o.index+1:o.index,r=o[0].startsWith(" ")?o[0].length-1:o[0].length,l=t.start()+i,c=l+r,h=l===s?.from;return{range:{from:l,to:c},queryText:o[2],isDismissed:h}}}const cs=new ps("slashCommandPlugin");function xm(t){const n=t.state.selection.$from,a=Zi(n,void 0);if(!a)return;const o=t.state.tr;t.dispatch(o.setMeta(cs,{...o.getMeta(cs),dismissedRange:a.range}))}function Ja(){return{queryText:"",active:!1,range:void 0}}function Sm(t,s,n,a,o,i){let r;if(s.id===tn.Search&&o)r=t.state.tr.delete(n.from,n.to),i(!0);else{const l=t.state.schema.nodes[un].create({...s},t.state.schema.text(s.hint));r=t.state.tr.replaceWith(n.from,n.to,l),a&&r.insertText(" ",n.from+l.nodeSize)}t.dispatch(r)}function eo(t){const{active:s,range:n,queryText:a,onHintMatch:o,dismissedRange:i}=t;if(o)return!s||!n||i?.from===n.from?o(void 0):o({text:a,range:n})}function vm(t){const s=[];return t.descendants(n=>{n.type.name===un&&typeof n.attrs?.id=="string"&&s.push(n.attrs.id)}),s}function bm(t){const s=t.state.tr;s.doc.descendants((n,a)=>{n.type.name===un&&s.insertText(n.textContent,a,a+n.nodeSize)}),s.steps.length>0&&t.dispatch(s)}function ym(){return new xs({key:cs,state:{init(){return Ja()},apply(t,s){const n=t.getMeta(cs),a=t.selection,o=a.$from,i=Zi(o,s.dismissedRange),r={...Ja(),...s,...n};return a.from!==a.to?(eo(r),r):(r.active=!!i,i&&(r.queryText=i.queryText,r.range=i.range,i.isDismissed&&(i.queryText===""&&s.queryText!==""?r.dismissedRange=void 0:r.dismissedRange=i.range)),eo(r),r)}}})}class hn extends xl{constructor(s){super(),this.view=s}get document(){return this.view.dom.ownerDocument}isEmpty(){return this.view.state.doc.textContent.trim().length===0}trimLeadingText(s){const a=this.view.state.tr;let o=!1,i=!1;return a.doc.descendants((r,l)=>{o||!r.isText||(o=!0,r.text?.startsWith(s)&&(i=!0,a.insertText(r.text.replace(s,""),l,l+r.text.length)))}),i&&this.view.dispatch(a),i}replaceAll(s,n){const o=this.view.state.tr,i=[];o.doc.descendants((r,l)=>{!r.isText||r.text===void 0||i.push({node:r,pos:l})}),i.reverse(),i.forEach(({node:r,pos:l})=>{!r.isText||r.text===void 0||r.text.includes(s)&&o.insertText(r.text.replaceAll(s,n),l,l+r.text.length)}),this.view.dispatch(o)}appendText(s){this.view.dispatch(this.view.state.tr.insertText(s))}focus(){this.view.focus(),this.view.dispatch(this.view.state.tr.setSelection(zn.atEnd(this.view.state.doc)))}setText(s){const{tr:n,schema:a}=this.view.state,o=s?a.nodes.paragraph.create(null,a.text(s)):a.nodes.paragraph.create();this.view.dispatch(n.replaceWith(0,this.view.state.doc.content.size,o)),this.view.hasFocus()&&this.view.dispatch(this.view.state.tr.setSelection(zn.atEnd(this.view.state.doc)))}getCurrentText(){return this.view.state.doc.textContent}hasMultipleLines(){let s=0;return this.view.state.doc.descendants(n=>{n.isBlock&&s++}),s>1}getContentToSend(){return hh(this.view)}resize(){}isReady(){return!!this.view.state.doc}setPlaceholder(s){this.view.dispatch(this.view.state.tr.setMeta(Jt,{placeholder:s}))}getSelectionStart(){return this.view.state.selection.ranges[0].$from.pos}isMenuSelectorActive(){return ht.getState(this.view.state).active}registerKeyHandlers(s){um(this.view,s)}acceptLegacyKeydown(){return!1}subscribe(s,n){if(s==="change"){const a=()=>n(void 0);return Za(this.view,a)}return this.view.dom?.addEventListener(s,n),()=>{this.view.dom?.removeEventListener(s,n)}}useState(s){return d.useSyncExternalStore(n=>Za(this.view,n),()=>s(this),()=>s(this))}getSystemHintsFromDoc(){return vm(this.view.state.tr.doc)}getSystemHints(){const s=this.getSystemHintsFromDoc();return s.length?[s[0]]:[]}replaceSlashCommandTokensWithText(){bm(this.view)}canShowAutocompletion(){return!this.isMenuSelectorActive()&&!this.getSystemHintsFromDoc().length}}const to=Me.div`m-8 flex flex-col items-center`;function so(t){return e.jsx(te.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...t})}function wm({clientThreadId:t}){const n=Sl(t)?.gizmoId,{data:a}=ms(n);return n==null||a==null||!vl(a)?null:e.jsx(jm,{gizmoId:n})}function jm({gizmoId:t}){const[s,n]=d.useState(!1),[a,o]=d.useState(!1),i=bl(t),r=async c=>{n(!0),setTimeout(()=>{o(!0)},5e3),q.logEvent(H.submitInlineRating,{gizmo_id:t,rating:c}),await i.mutateAsync({rating:c})},l=async()=>{o(!0),q.logEvent(H.dismissInlineRating,{gizmo_id:t}),await i.mutateAsync({})};return d.useEffect(()=>{a||q.logEvent(H.showInlineRating,{gizmo_id:t})},[a,t]),a?null:s?e.jsx(to,{children:e.jsxs(so,{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"rounded-lg border border-token-border-heavy p-4",children:e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(P,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),e.jsx(Da,{onClick:()=>{o(!0)}})]})}),e.jsx("div",{className:"text-xs text-token-text-tertiary",children:e.jsx(P,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):e.jsx(to,{children:e.jsxs(so,{className:"flex flex-col items-center gap-4 rounded-lg border border-token-border-heavy p-4",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(P,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),e.jsx(Da,{onClick:l})]}),e.jsx(yl,{rating:void 0,onRating:r})]})})}const Mm=({clientThreadId:t})=>{const s=Lo(),n=sn(t),a=mt(n);d.useEffect(()=>{a&&Fa.dismissBanner()},[a]);const o=s?.is_dismissible?()=>Fa.dismissBanner():void 0;return e.jsx(fs,{children:s&&e.jsx(te.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(wl,{clientThreadId:t,rateLimitInfo:s,onDismiss:o})})})};function Cm(t){const s=sn(t),n=mt(s),a=Lo();return!n&&a!=null}const Wn=window.sessionStorage,Vn=qr($r(()=>({memoryFullBannerDismissed:!!Wn?.getItem(En.MemoryFullBannerDismissed)}))),Ji={dismissBanner(){Vn.setState(t=>{t.memoryFullBannerDismissed=!0}),Wn?.setItem(En.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){Vn.setState(t=>{t.memoryFullBannerDismissed=!1}),Wn?.removeItem(En.MemoryFullBannerDismissed)}};function km(t){const s=Ue(t),n=Ko(),{data:a}=Yo(s,!1,n),o=a!=null,i=o&&a.memoryFullPct>=100,[r,l]=d.useState(!1);d.useEffect(()=>{!i&&o&&(l(!0),Ji.clearDismissedBanner())},[i,o]);const c=Vn(h=>h.memoryFullBannerDismissed);return i&&r&&!c}function _m(){const t=ee(),{openSettings:s}=jl();return e.jsx(te.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(Ml,{title:t.formatMessage(Fs.memoryFullTitle),content:t.formatMessage(Fs.memoryFullTooltip,Fs.memoryFullTooltip.values),primaryCtaText:t.formatMessage(Fs.memoryManageButton),onPrimaryCtaClick:()=>s(Cl.Personalization),onDismiss:()=>Ji.dismissBanner()})})}const Fs=be({memoryFullTitle:{id:"yRGU2/",defaultMessage:"Memory is full."},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"neUc+N",defaultMessage:"New memories won’t be created until you make space. <a>Learn more</a>",values:{a:t=>e.jsx("a",{href:kl,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}}}),Tm=d.memo(function(s){return Am(s),Em(s),Nm(),null});function Am(t){const{store:s}=Re(),n=s.useSetSharedProps();Nn(()=>{n(t)},[t,n])}function Em(t){const{clientThreadId:s,canContinue:n}=t,{store:a}=Re(),o=d.useRef({top:a.useContentAreaApi(At.HeaderTop),bottom:a.useContentAreaApi(At.HeaderBottom)}).current,i=Im(t),r=_l(s),{shouldShowBannerSignup:l,shouldShowBannerTermsDisclaimer:c}=Dm(s),h=Cm(s),u=Tl(t),m=Al(t),g=El(t),p=km(s),b=Nl(),f=Rl(t);Nn(()=>{f.eligible?o.top.set(oe.AdvancedVoiceOnMobileAnnouncement):b?o.top.set(oe.ParagenControls):c?o.top.set(oe.BannerTermsDisclaimer):h?o.top.set(oe.BannersRateLimit):u.eligible?o.top.set(oe.BannerSidekickAnnouncement):m?o.top.set(oe.SearchBrowserExtensionAnnouncement):g?o.top.set(oe.SearchBrowserExtensionReactiveAnnouncement):i?o.top.set(oe.ItemActions):n?o.top.set(oe.PromptTextareaAction):l?o.top.set(oe.BannerSignup):p?o.top.set(oe.BannerMemoryFull):o.top.set(null)},[o,i,n,c,l,h,u,p,b,f]),Nn(()=>{r&&o.bottom.set(Xo.DallePromptControls)},[o,r])}function Nm(){const{store:t}=Re();d.useEffect(()=>()=>{t.reset()},[t])}function Rm(t){const s=Qo(),n=ft(t),a=Q.getTree(t).getLastValidNode(n)?.message?.id;return s?.messageId===a?s.suggestions:[]}function Pm(t){return Rm(t).length>0}function Im(t){const s=Pl(t.clientThreadId),n=Pm(t.clientThreadId);return t.isDisabled?!1:t.isNewThread||s||n}function Dm(t){const{isUnauthenticated:s}=ze(),n=ft(t),{layer:a}=kt("3637408529"),o=a.get("should_show_no_auth_signup_banner",!0),i=Il(g=>g.bannerDisclaimerClientThreadId),r=Dl(),l={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1};if(!t)return l;const c=Q.getTree(t),h=c.countMessagesByAuthor(ve.User),u=c.getNodeByIdOrMessageId(n),m=u?.message?.author.role===ve.Assistant&&Fl(u.message);return l.shouldShowBannerTermsDisclaimer=m&&s&&h===1&&!r&&(i==null||i===t),l.shouldShowBannerSignup=o&&m&&s&&h>0&&h%5===0,l}function er({children:t,className:s,showBackground:n}){return e.jsxs("div",{className:"relative",children:[t,n&&e.jsx(te.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:A("pointer-events-none absolute bottom-0 top-0 h-8 w-8 rounded-full",s)})]})}function no({entry:t,onClick:s}){const{connectorConfig:n}=Jn();d.useEffect(()=>{if(!open||t.type!==De.GDRIVE)return;const l=n.get(De.GDRIVE)?.access_token;l&&Ll(l)},[n,t.type]);const a=Zo(t.type),o=ee(),i=t.access_token?ao.uploadFromMessage:ao.signinWithMessage;return e.jsx(z.Item,{onClick:s,icon:a,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx(P,{...i,values:{connectorName:ea(t.type,o)}}),t.type===De.O365_BUSINESS&&e.jsx("div",{className:"text-s text-token-text-tertiary",children:e.jsx(P,{...ta.includesSharePoint})})]})},t.id)}const ao=be({signinWithMessage:{id:"ContextConnectorPickerDropdownItem.signInWithMessage",defaultMessage:"Connect to {connectorName}"},uploadFromMessage:{id:"ContextConnectorPickerDropdownItem.uploadWithMessage",defaultMessage:"Add from {connectorName}"}});function Fm({clientThreadId:t,icon:s,setOpen:n,isDisabled:a=!1,highlightTooltip:o=!1}){const i=Oo(),r=ee();return a=a||!!i,e.jsxs(e.Fragment,{children:[e.jsx(z.Trigger,{className:"m-0 h-0 w-0 border-none bg-transparent p-0"}),e.jsx(Ol,{clientThreadId:t,rateLimitPopup:i,highlightTooltip:o,children:e.jsx(Bl,{disabled:a,"aria-disabled":a,"aria-label":r.formatMessage({id:"tA7CXR",defaultMessage:"Attach files"}),onClick:l=>{l.preventDefault(),n(!0)},children:s})})]})}function Lm({connectorEntries:t,onOauthRedirect:s}){const n=ee();return e.jsxs(z.Sub,{children:[e.jsx(z.SubMenuTrigger,{icon:Sh,children:e.jsx("div",{className:"line-clamp-1 text-ellipsis",children:e.jsx(P,{...Om.connectApps})})}),e.jsx(z.Portal,{children:e.jsx(z.SubContent,{children:t.map(a=>e.jsx(z.Item,{onClick:()=>s(a),icon:Zo(a.type),children:e.jsxs("div",{className:"flex flex-col",children:[ea(a.type,n),a.type===De.O365_BUSINESS&&e.jsx("div",{className:"text-s text-token-text-tertiary",children:e.jsx(P,{...ta.includesSharePoint})})]})},a.id))})})]})}const Om=be({connectApps:{id:"ContextConnectorPicker.connectApps",defaultMessage:"Connect apps"}});function Bm({onOauthRedirect:t,connectors:s}){const n=ee();return e.jsxs(z.Sub,{children:[e.jsx(z.SubMenuTrigger,{icon:vh,children:e.jsx(P,{...zm.oneDriveSubmenuName})}),e.jsx(z.Portal,{children:e.jsx(z.SubContent,{children:s.map(a=>a?e.jsx(z.Item,{onClick:()=>t(a),children:e.jsxs("div",{className:"flex flex-col",children:[ea(a.type,n),a.type===De.O365_BUSINESS&&e.jsx("div",{className:"text-s text-token-text-tertiary",children:e.jsx(P,{...ta.includesSharePoint})})]})},a.id):null)})})]})}const zm=be({oneDriveSubmenuName:{id:"ContextConnectorPickerOneDriveSubmenu.oneDriveSubmenuName",defaultMessage:"Connect to Microsoft OneDrive"}}),Um={"image/jpeg":".jpg","image/png":".png"};function Hm({entry:t}){return e.jsx(z.Item,{onClick:t.onClick,icon:t.icon,children:e.jsx(P,{...t.label})},t.key)}function Gm(t){const s=ee(),n=Rt(),a=nn();return d.useCallback(async i=>{const r=`${new Date().toISOString().replaceAll(":","-")}${Um[i.mimeType]}`;Xt.uploadFile(a,new File([i.data],r,{type:i.mimeType}),t,s,n,void 0,void 0,Pn.Multimodal)},[a,s,n,t])}function Wm(t){const s=Gm(t),n=Vm(s),a=qm(s);return{desktopConnectors:d.useMemo(()=>Bo?[n,a].filter(i=>i!==void 0):[],[n,a])}}function Vm(t){const{value:s}=_t("4204519260");return d.useMemo(()=>{if(s)return{key:"takeScreenshot",label:tr.takeScreenshot,icon:bh,onClick:async()=>{const n=await Kr();n&&(q.logEvent(H.sidetronScreenshotAttached),await t(n))}}},[s,t])}function qm(t){const{value:s}=_t("239993468");return d.useMemo(()=>{if(s)return{key:"takePhoto",label:tr.takePhoto,icon:yh,onClick:async()=>{const n=await Yr();n&&(q.logEvent(H.sidetronPhotoAttached),await t(n))}}},[s,t])}const tr=be({takeScreenshot:{id:"ContextConnectorPickerDropdownItem.takeScreenshotDesktop",defaultMessage:"Take screenshot"},takePhoto:{id:"ContextConnectorPickerDropdownItem.takePhotoDesktop",defaultMessage:"Take photo"}});function $m(){const{connectorConfig:t}=Jn(),s=an(),n=ti(),[a,o]=as(ei([...t.values()],u=>!!u.access_token),u=>!!u.access_token),[i,r]=as(o,u=>u.type===De.O365_PERSONAL||u.type===De.O365_BUSINESS),l=!s&&!n&&a.length>0,c=!s&&!n&&!l&&i.length>1;return{unconnectedConnectors:n?[]:c?r:o,showUnconnectedInSubmenu:l,showOneDriveInSubmenu:c}}function Km({clientThreadId:t,icon:s,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:a,attachmentsProductFeature:o,onOauthRedirect:i,uploadType:r,getInputProps:l,openFileDialog:c,isDisabled:h=!1,highlightTooltip:u=!1}){const{currentLocale:m}=Xr(),g=ee(),p=Rt(),b=nn(),f=an(),{connectorConfig:y,isLoading:x}=Jn(),j=sa(on.ContextConnectors),{getGizmoId:S}=Jo(),[v,k]=d.useState();d.useEffect(()=>{S?S().then(I=>k(I)):k(void 0)},[S]);const D=d.useRef(null),[N,M]=d.useState(!1),w=d.useRef(!1),_=d.useCallback(()=>{const I=D.current?.files;Array.from(I??[]).forEach(re=>Xt.uploadFile(b,re,a,g,p,o))},[b,a,g,p,o]),[Y,U]=d.useState(null),T=d.useCallback(()=>U(null),[U]),G=d.useCallback((I,re)=>Xt.uploadPickedFile(b,I,re,a,n,o,v,g,p),[b,a,n,o,v,g,p]),{openMenu:F,confirmMenuOpened:R}=zl();d.useEffect(()=>{F&&(M(!0),R())},[F,R,M]);const C=d.useCallback(I=>{Xt.doContextConnectorOauthRedirect(location.pathname+location.search+location.hash,I,i,La.Picker),i()},[i]),W=d.useCallback(I=>{Xt.uploadPickedFile(b,I,De.GDRIVE,a,n,o,v,g,p)},[b,a,n,o,v,g,p]),$=d.useCallback(async I=>{const{access_token:re}=I;if(!re){C(I);return}switch(Ul(I,La.Picker),I.type){case De.GDRIVE:Hl(m,I.type,re,Le=>Le.forEach(W));break;case De.O365_PERSONAL:case De.O365_BUSINESS:U(I.type);break}},[W,C,U,m]),K=()=>{q.logEvent(H.openFileViewer,{intent:r.toString()}),c()},O=I=>{if(!I&&w.current&&!x)K();else if(I&&Ce&&!x){K();return}M(I),I&&(j.eligible&&j.markAsViewed(),q.logEvent(H.composerOpenContextConnectorPicker),w.current=!0,setTimeout(()=>{w.current=!1},250))},[se,ye]=as(ei([...y.values()],I=>!!I.access_token),I=>!!I.access_token);Ym(se,$);const[me]=as(ye,I=>I.type===De.O365_PERSONAL||I.type===De.O365_BUSINESS),{unconnectedConnectors:ne,showUnconnectedInSubmenu:ae,showOneDriveInSubmenu:Pe}=$m(),{desktopConnectors:ie}=Wm(a),Ce=!se.length&&!ne.length&&!ie.length,xe=e.jsxs(e.Fragment,{children:[ae&&ne.length>0&&e.jsx(Lm,{connectorEntries:ne,onOauthRedirect:I=>C(I)}),!ae&&ne.map(I=>e.jsx(no,{entry:I,onClick:()=>$(I)},I.id)),Pe&&e.jsx(Bm,{connectors:me,onOauthRedirect:C}),x&&e.jsx(z.Item,{icon:e.jsx(zo,{className:"text-token-text-secondary"})}),(ne.length>0||x)&&e.jsx(z.Separator,{}),se.map(I=>e.jsx(no,{entry:I,onClick:()=>$(I)},I.id)),ie.map(I=>e.jsx(Hm,{entry:I},I.key)),e.jsx(z.Item,{onClick:K,icon:wh,children:e.jsx(P,{...f?oo.uploadFileMobile:oo.uploadFile})},"upload")]}),we=e.jsxs("div",{className:"flex flex-col",children:[e.jsx(Gl,{type:Y,onClose:T,uploadPickedFile:G}),e.jsx("input",{onChange:_,...l({className:"hidden"})}),e.jsxs(z.Root,{open:N,onOpenChange:O,children:[e.jsx(Fm,{clientThreadId:t,icon:s,setOpen:O,isDisabled:h,highlightTooltip:u}),e.jsx(z.Portal,{children:e.jsx(z.Content,{size:"large",children:xe})})]}),e.jsx(Wl,{hasConnectors:!x&&!Ce})]});return{dropdownItems:xe,mainComponent:we}}function Ym(t,s){const{connector:n,clearParam:a}=Vl(),o=t.find(i=>i.type===n&&!!i.access_token);d.useEffect(()=>{o&&(s(o),a())},[o,s,a])}function Xm(t){const{mainComponent:s}=Km(t);return s}const oo=be({attachFiles:{id:"ContextConnectorPicker.attachFiles",defaultMessage:"Attach files"},uploadFile:{id:"LocalFileDropdownItem.uploadFile",defaultMessage:"Upload from computer"},uploadFileMobile:{id:"LocalFileDropdownItem.uploadFileMobile",defaultMessage:"Upload file"}});function Qm({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:a,attachmentsProductFeature:o,getInputProps:i,openFileDialog:r,onOauthRedirect:l,historyDisabled:c,isDisabled:h,highlightTooltip:u}){const m=ti(),{gdriveStatus:g,o365Status:p}=ql(),b=e.jsx(jh,{className:c?"text-white":u?"text-brand-blue-800":void 0}),f=g!=="false"||p!=="false"||m;return e.jsx("div",{className:A("relative",h&&"pointer-events-none opacity-30"),children:e.jsx(er,{showBackground:u,className:"bg-brand-blue-800/20",children:f?e.jsx(Xm,{clientThreadId:t,icon:b,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:a,attachmentsProductFeature:o,onOauthRedirect:l,uploadType:s,openFileDialog:r,getInputProps:i,isDisabled:h,highlightTooltip:u}):e.jsx($l,{clientThreadId:t,uploadType:s,openFileDialog:r,getInputProps:i,icon:b,isDisabled:h,highlightTooltip:u})})})}function Zm(){return Un({"Shift-Enter":(t,s)=>Xa(t,s),Enter:(t,s)=>window.innerWidth>Kl[Yl.Medium]?!1:Xa(t,s)})}const Jm=["p",0],ef=["br"],tf=new ch({nodes:{paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p",preserveWhitespace:"full"}],toDOM(){return Jm}},text:{group:"inline"},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM(){return ef}},[un]:pm,doc:{content:"block+"}},marks:{}});function sf(){const t=new EventTarget,s=new dh(null,{state:uh.create({schema:tf,plugins:[mh(),fm({submitKeys:["Enter","Tab"],cancelKeys:["Escape"],checkStrictMatchKeys:[" "]}),gm(""),ym(),Zm(),Un({"Mod-z":fh,"Mod-y":Qa,"Mod-Shift-z":Qa}),hm(),Un(Yh),dm(t),gh()]}),dispatchTransaction(n){const a=s.state.apply(n);s.updateState(a),n.docChanged&&t.dispatchEvent(new Event(Gn))},handlePaste(n,a){const o=a.clipboardData?.getData("text/plain");return o===void 0?!1:(Xl(o)||ph(n,o),!0)},clipboardTextSerializer(n){return xh(n.content).content}});return s}function nf(){try{return navigator.userAgent.toLocaleLowerCase().includes("firefox")}catch{return!1}}const af=[A([Ql["prosemirror-parent"],"text-token-text-primary","max-h-[25dvh]","max-h-52","overflow-auto",nf()?"firefox":"default-browser"])],of=({children:t})=>{const[s]=d.useState(()=>new hn(sf()));return t(s)},io=({composerController:t,placeholder:s})=>{const n=d.useContext(Uo),a=d.useRef(null),o=d.useRef(null),i=d.useRef(!1);return d.useEffect(()=>{if(i.current)return;if(!(t instanceof hn))throw new Error(`Expected instance of ProseMirrorComposerController but got ${t.constructor.name}`);i.current=!0;const r=o.current;if(r!=null){const{value:l,selectionStart:c,selectionEnd:h}=r;t.view.dispatch(t.view.state.tr.insertText(l)),t.view.dispatch(t.view.state.tr.setSelection(zn.create(t.view.state.doc,c+1,h+1))),r.style.display="none",r.value=""}a.current.appendChild(t.view.dom),t.view.dom.id=si,Zl(t.view.dom),t.view.focus()},[t]),d.useEffect(()=>{t.setPlaceholder(s)},[s,t]),d.useEffect(()=>{t.logPageMount()},[]),e.jsxs("div",{ref:a,className:A(af),children:[e.jsx("textarea",{className:"block h-10 w-full resize-none border-0 bg-transparent px-0 py-2 text-token-text-primary placeholder:text-token-text-secondary",autoFocus:!0,placeholder:s,ref:o}),e.jsx("script",{nonce:n.cspScriptNonce,suppressHydrationWarning:!0,children:"window.__oai_logHTML?window.__oai_logHTML():window.__oai_SSR_HTML=window.__oai_SSR_HTML||Date.now();requestAnimationFrame((function(){window.__oai_logTTI?window.__oai_logTTI():window.__oai_SSR_TTI=window.__oai_SSR_TTI||Date.now()}))"})]})},rf=Pt(()=>It(()=>import("./sso-l6maw02gfr61gxuy.js").then(t=>t.b),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44])).then(t=>({default:t.ComposerRightActions}))),lf=d.forwardRef(function({type:s,placeholder:n,replyRegions:a,state:o,renderFiles:i,leftSideActions:r,onSubmit:l,inputState:c,currentLeafId:h,composerController:u,clientThreadId:m,gizmoId:g,disableReason:p,modelId:b},f){const y=Ye(),x=Jl(),{value:j}=Ne("1567586774"),{value:S}=Ne("1028682714");d.useEffect(()=>{u.focus()},[x?.modelId,u]);const v=k=>{mf({target:k.target,rootId:"composer-background",additonalInteractiveIds:["reply-regions"]})||u.focus()};return e.jsxs("div",{id:"composer-background",ref:f,className:A("flex w-full flex-col transition-colors contain-inline-size",y&&"backdrop-blur-2xl no-transparency:backdrop-blur-none",y&&s!=="temporary"&&"bg-token-composer-surface",j?"cursor-text rounded-3xl px-2.5 py-1":"gap-1.5 rounded-[26px] px-2.5 py-1.5",!y&&s!=="temporary"&&"bg-[#f4f4f4] dark:bg-token-main-surface-secondary",s==="temporary"&&"dark bg-black"),onClick:v,children:[e.jsx(fs,{initial:!1,children:a.length>0&&e.jsx(te.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0,transition:{duration:.06}},transition:{ease:"easeOut",duration:.1},id:"reply-regions",children:e.jsx(cf,{replyRegions:a})})}),j?e.jsxs(e.Fragment,{children:[i,e.jsx("div",{className:"flex min-h-[44px] items-center px-2",children:e.jsx("div",{className:"max-w-full flex-1",children:u instanceof Hs?e.jsx(ro,{composerController:u,currentLeafId:h,placeholder:n,inputState:c}):e.jsx(io,{composerController:u,placeholder:n})})}),e.jsxs("div",{className:"flex h-[44px] items-center justify-between",children:[e.jsx("div",{className:"flex gap-x-1",children:r}),S?e.jsx(rf,{inputState:c,state:o,onSubmit:l,composerController:u,clientThreadId:m,gizmoId:g,disableReason:p,modelId:b}):e.jsx(Ha,{inputState:c,state:o,onSubmit:l,composerController:u,clientThreadId:m,gizmoId:g,disableReason:p})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-end gap-1.5 pl-4 md:gap-2",children:[!!r?.length&&e.jsx(te.div,{initial:{opacity:0},animate:{opacity:1},transition:{ease:"easeOut",duration:.06},className:"-ml-2.5 mb-1 flex",children:r},"leftSideActions"),e.jsxs(te.div,{layout:!0,transition:{duration:.1},className:A("flex min-w-0 flex-1 flex-col"),children:[i,u instanceof Hs?e.jsx(ro,{composerController:u,currentLeafId:h,placeholder:n,inputState:c}):e.jsx(io,{composerController:u,placeholder:n})]}),e.jsx("div",{className:"mb-1 me-1",children:e.jsx(Ha,{inputState:c,state:o,onSubmit:l,composerController:u,clientThreadId:m,gizmoId:g,disableReason:p})})]})})]})});function ro({composerController:t,currentLeafId:s,placeholder:n,inputState:a}){const o=d.useContext(Uo);return e.jsxs(e.Fragment,{children:[e.jsx(ec,{id:si,autoFocus:!0,tabIndex:0,"data-id":s,dir:"auto",ref:i=>{if(!(t instanceof Hs))throw new Error("Expected TextAreaComposerController");i!=null&&(t.textArea=i,t.logPageMount())},rows:1,placeholder:n,disabled:a!=="default",className:A("m-0 resize-none border-0 bg-transparent px-0 text-token-text-primary focus:ring-0 focus-visible:ring-0",a==="disabled"&&"text-center",["max-h-[25dvh]","max-h-52"])}),e.jsx("script",{nonce:o.cspScriptNonce,suppressHydrationWarning:!0,children:"requestAnimationFrame((function(){window.__oai_logTTI?window.__oai_logTTI():window.__oai_SSR_TTI=window.__oai_SSR_TTI??Date.now()}))"})]})}function cf({replyRegions:t}){return e.jsx("div",{className:"flex cursor-auto flex-col divide-y divide-token-border-light overflow-hidden rounded-b-lg rounded-t-[20px] bg-token-main-surface-primary",children:t.map((s,n)=>{switch(s.type){case"text":return e.jsx(df,{value:s.value,onRemoveRegion:s.onRemoveRegion},n);case"object":return e.jsx(uf,{value:s.value,onRemoveRegion:s.onRemoveRegion},n);case"mention":case"system_hint":return e.jsx(hf,{value:s.value,icon:s.icon,onRemoveRegion:s.onRemoveRegion},n)}})})}function df({value:t,onRemoveRegion:s}){return e.jsxs(va,{className:"text-token-text-secondary",children:[e.jsx(ba,{children:e.jsx(Ui,{className:"icon-lg-heavy"})}),e.jsx(ya,{children:`“${t}”`}),e.jsx(Sa,{onClick:s})]})}function uf({value:t,onRemoveRegion:s}){return e.jsxs(va,{className:"text-blue-selection",children:[e.jsx(ba,{children:e.jsx(Ui,{className:"icon-lg-heavy"})}),e.jsx(ya,{className:"font-semibold",children:t}),e.jsx(Sa,{onClick:s})]})}function hf({value:t,icon:s,onRemoveRegion:n}){return e.jsxs(va,{children:[e.jsx(ba,{className:"mt-0",children:s}),e.jsx(ya,{className:"font-semibold text-token-text-primary",children:t}),e.jsx(Sa,{onClick:n})]})}function Sa({onClick:t}){return e.jsx("button",{onClick:t,type:"button",className:"flex-shrink-0 text-token-text-secondary",children:e.jsx(Mh,{className:"icon-lg"})})}const va=Me.div`flex items-start py-2.5 gap-3 pl-3 pr-1.5 text-sm`,ba=Me.span`flex-shrink-0 mt-0.5 w-7 h-6 flex justify-center items-center`,ya=Me.span`flex-1 line-clamp-3 py-0.5`;function mf({target:t,rootId:s,additonalInteractiveIds:n}){let a=t;for(;a&&a!=null;){if(a.tagName==="BUTTON"||a.tagName==="INPUT"||a.tagName==="TEXTAREA"||a.isContentEditable||n.includes(a.id))return!0;if(a.id===s)return!1;a=a.parentElement}return!1}const ff=t=>{const{metadata:s}=t;return s?.type?ac(s.type):!1},gf=({textdocId:t,pastedTextdoc:s,isCanvasOpen:n=!1,isFocused:a=!1})=>{const{content:o,metadata:i}=s;return e.jsxs("div",{className:"group/file-tile relative",children:[e.jsx("button",{onClick:()=>ni.removePastedContent(t),className:"absolute -left-1 -top-1 z-10 hidden rounded-full border-[3px] border-[#f4f4f4] bg-black p-[2px] text-white group-hover/file-tile:block dark:border-token-main-surface-secondary dark:bg-white dark:text-black",children:e.jsx(Ch,{className:"icon-xs"})}),e.jsx(Xh,{isInlinePreview:!0,isCanvasOpen:n,isFocused:a,textdocId:t,name:i?.title??null,type:i?.type??null,size:"small",onClick:()=>nc(t),children:e.jsx("div",{className:A("whitespace-pre px-4",ff(s)&&"font-mono"),children:o})})]})},pf=({textdocId:t,pastedTextdoc:s})=>{const n=tc(t),a=sc();return e.jsx(gf,{isFocused:n,isCanvasOpen:a,pastedTextdoc:s,textdocId:t})};function xf({composerController:t}){const{doesUserHaveAnyAccountsWithPlusFeatures:s}=Qs(),n=ee(),a=ai();return e.jsxs("div",{className:A("flex justify-between",!a&&"bg-gradient-to-t from-token-main-surface-primary to-transparent px-4"),children:[e.jsx("div",{className:"flex gap-2",children:e.jsx(vf,{onClickStyle:o=>{co(n.formatMessage(o.expandedName??o.name),t)}})}),s&&e.jsx("div",{className:"flex gap-2",children:e.jsx(Sf,{onClickAspectRatio:o=>co(n.formatMessage(o.expandedName),t)})})]})}function Sf({onClickAspectRatio:t}){const s=ee();return e.jsxs(z.Root,{onOpenChange:n=>{n&&(ce.logEvent(H.dalleOpenAspectRatioDropdown),q.logEvent(H.dalleOpenAspectRatioDropdown))},children:[e.jsxs(qn,{$as:z.Trigger,className:"pr-1.5",children:[e.jsx(P,{id:"dalleControls.aspectRatio",defaultMessage:"Aspect Ratio"}),e.jsx(xa,{className:"icon-md"})]}),e.jsx(z.Portal,{children:e.jsx(z.Content,{children:oc.map(n=>e.jsx(z.Item,{onClick:()=>{t(n),ce.logEvent(H.dalleClickAspectRatio,n.name.defaultMessage?.toString()),q.logEvent(H.dalleClickAspectRatio,{aspectRatio:n.name.defaultMessage})},icon:n.icon,children:s.formatMessage(n.name)},n.name.id))})})]})}function vf({onClickStyle:t}){const[s,n]=d.useState(lo()),a=ic(),o=na(),i=aa(),r=ee();let l=2;return i||(o?l=5:a&&(l=3)),e.jsxs(e.Fragment,{children:[s.slice(0,l).map(c=>e.jsx(Dt,{label:e.jsx(bf,{style:c}),side:"top",sideOffset:4,customPaddingClassName:"p-1",children:e.jsxs(qn,{$as:"button",type:"button",onClick:()=>{t(c),ce.logEvent(H.dalleClickStyle,c.name.defaultMessage?.toString()),q.logEvent(H.dalleClickStyle,{style:c.name.defaultMessage})},children:[e.jsx(kh,{className:"h-4 w-4 text-token-text-tertiary"}),r.formatMessage(c.name)]})},c.name.id)),e.jsx(qn,{$as:"button",type:"button",onClick:()=>{n(lo()),ce.logEvent(H.dalleShuffleStyles),q.logEvent(H.dalleShuffleStyles)},children:e.jsx(rc,{className:"icon-sm text-token-text-tertiary"})}),oi.map(c=>e.jsx("img",{src:c.image.src,alt:r.formatMessage(c.name),width:100,height:100,className:"invisible fixed -left-96 -top-96"},c.name.id))]})}function bf({style:t}){const s=ee();return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("img",{src:t.image.src,alt:s.formatMessage(t.name),width:100,height:100,className:"rounded-md"}),e.jsx("div",{className:"text-xs font-medium",children:s.formatMessage(t.name)})]})}function lo(){return[...oi].sort(()=>Math.random()-.5)}function yf(t,s){const n=s.getCurrentText();return n.trim()===""?t:n.endsWith(",")?` ${t.toLocaleLowerCase()}`:n.endsWith(", ")?t.toLocaleLowerCase():`, ${t.toLocaleLowerCase()}`}function co(t,s){const n=yf(t,s);s.appendText(n),os()}const qn=Me.div`h-7 bg-token-main-surface-primary border border-token-border-light text-xs hover:bg-token-main-surface-secondary hover:text-token-text-primary px-2.5 radix-state-open:bg-token-main-surface-secondary radix-state-open:text-token-text-primary rounded-full flex flex-nowrap gap-0.5 items-center text-token-text-secondary font-normal`,Ls={initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:.1},exit:{opacity:0,scale:.5,transition:{duration:.2}}},wf=({suggestions:t,onSelectingSuggestedReply:s})=>e.jsx("div",{className:"absolute bottom-full flex w-full max-w-[100vw] grow gap-2 overflow-auto px-1 pb-1 contain-inline-size sm:mb-0 sm:justify-start sm:px-2 sm:pb-0 md:static md:mb-2 md:max-w-none md:justify-center md:overflow-visible",children:t.slice(0,2).map((n,a)=>e.jsx(te.div,{initial:Ls.initial,animate:Ls.animate,transition:{delay:(a-1)*Ls.transition.delay},exit:Ls.exit,children:e.jsx(Ve,{as:"button",color:"secondary",size:"small",onClick:()=>{s(n,t,a)},className:"group whitespace-nowrap md:whitespace-normal",children:e.jsx(Mf,{suggestion:n})},a)},a))});function jf({suggestions:t,onSelectingSuggestedReply:s,clientThreadId:n}){const a=t?.length>0;d.useEffect(()=>{a&&Et(t,n)},[a,n]);const{isUnauthenticated:o}=ze();return a?t.every(ii)?e.jsxs(te.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"flex flex-col items-center",children:[o&&e.jsx(us,{className:"mb-6 h-12 w-12 sm:hidden"}),e.jsx(Xi,{starterPrompts:t,onSelectStarterPrompt:s})]}):t.every(ri)?e.jsx(wf,{suggestions:t,onSelectingSuggestedReply:s}):null:null}function Mf({suggestion:t}){return ri(t)?e.jsx(e.Fragment,{children:t.text}):ii(t)?e.jsxs("div",{className:"flex flex-col overflow-hidden",children:[t.title&&e.jsx("div",{className:"truncate font-semibold",children:t.title}),e.jsx("div",{className:A("truncate font-normal",t.title?"opacity-50":""),children:t.body})]}):null}function Cf(){const{store:t}=Re(),s=t.useSharedProps();return s?e.jsx(kf,{...s}):null}function kf({clientThreadId:t,suggestions:s}){const n=rn();return s===void 0||s.length===0?null:e.jsx("div",{children:e.jsx(_f,{children:e.jsx("div",{className:"grow",children:s!==void 0&&e.jsx(jf,{suggestions:s,onSelectingSuggestedReply:n,clientThreadId:t})})})})}const _f=Me.div`h-full flex ml-1 md:w-full md:m-auto gap-0 md:gap-2 justify-center`,sr=({className:t,children:s})=>e.jsx(te.div,{className:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:s});function Tf({currentLeafId:t,canContinue:s,onContinueGenerating:n}){const a=d.useCallback(()=>{const i=new is;n(t,i),os()},[n,t]);let o=null;return s&&(o=e.jsx(Ef,{onHandleContinueGenerating:a})),o&&e.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:o})}function Af({className:t}){return e.jsx(Hi,{className:A("-rotate-180",t)})}const Ef=({onHandleContinueGenerating:t})=>e.jsx(sr,{children:e.jsx(Ve,{as:"button",color:"secondary",onClick:t,className:"whitespace-nowrap py-2",icon:Af,size:"small",children:e.jsx(P,{...We.continueGenerating})})}),Nf=()=>{const{shouldShowSkipButton:t}=li();return t?e.jsx(sr,{className:"flex justify-center",children:e.jsx(Ve,{as:"button",color:"secondary",onClick:()=>lc.skipParagen(),children:e.jsx(P,{...Rf.skip})})}):null},Rf=be({skip:{id:"dvcUbp",defaultMessage:"Skip"}}),nr=d.memo(function({className:s}){const{store:n}=Re(),a=n.useIsHeaderContentAreaPopulated();return e.jsx("div",{className:A(s??"absolute bottom-full left-0 right-0",Gs.PromptTextareaHeader),children:e.jsx(cc,{shouldRender:a,contentArea:At.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(ar,{}),e.jsx(or,{})]})})})});function ar(){const{store:t}=Re(),s=t.useSharedProps(o=>o?.clientThreadId),n=t.useContentAreaId(At.HeaderTop);let a;switch(n){case oe.AdvancedVoiceOnMobileAnnouncement:a=e.jsx(mc,{clientThreadId:s});break;case oe.ParagenControls:a=e.jsx(Nf,{});break;case oe.ItemActions:a=e.jsx(Cf,{});break;case oe.BannerSignup:a=e.jsx(If,{});break;case oe.BannerTermsDisclaimer:a=e.jsx(Df,{});break;case oe.PromptTextareaAction:a=e.jsx(Ff,{});break;case oe.BannersRateLimit:a=e.jsx(Lf,{});break;case oe.BannerSidekickAnnouncement:a=e.jsx(hc,{});break;case oe.SearchBrowserExtensionAnnouncement:a=e.jsx(uc,{});break;case oe.SearchBrowserExtensionReactiveAnnouncement:a=e.jsx(dc,{});break;case oe.BannerMemoryFull:a=e.jsx(_m,{});break;case oe.Box:a=e.jsxs("div",{className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;default:a=null;break}return a}function or(){const{store:t}=Re(),s=t.useContentAreaId(At.HeaderBottom);let n;switch(s){case Xo.DallePromptControls:n=e.jsx(Pf,{});break;default:n=null;break}return n}function Pf(){const{store:t}=Re(),s=t.useSharedProps(n=>n?.composerController);return s?e.jsx(xf,{composerController:s}):null}function If(){const{store:t}=Re(),s=t.useSharedProps(o=>o?.clientThreadId),n=fc(),a=gc();return s?n?e.jsx(pc,{threadId:s,showSignUp:a}):e.jsx(xc,{threadId:s,showLogin:a}):null}function Df(){const{store:t}=Re(),s=t.useSharedProps(n=>n?.clientThreadId);return s?e.jsx(Sc,{threadId:s}):null}function Ff(){const{store:t}=Re(),s=t.useSharedProps();return s?e.jsx(Tf,{...s}):null}function Lf(){const{store:t}=Re(),s=t.useSharedProps(n=>n?.clientThreadId);return s?e.jsx(Mm,{clientThreadId:s}):null}function Of(t){const{value:s}=Ne("1567586774");return s?e.jsx(Bf,{...t}):e.jsx(zf,{...t})}function Bf({composerController:t,isDisabled:s,highlightTooltip:n,clientThreadId:a}){const{setThreadSearchMode:o}=ln(),i=oa(),r=vc(),[l,c]=d.useState(!1),h=ee(),u={clientThreadId:a};return e.jsx(ir,{highlightTooltip:n,analyticsMetadata:u,isThreadUsingSearchMode:i,isDisabled:s,children:e.jsxs("button",{className:A("flex h-8 min-w-8 items-center justify-center rounded-lg p-1 text-xs font-semibold disabled:opacity-30",l&&"transition-all duration-150",i||n?"!rounded-2xl bg-blue-250 text-blue-1000 hover:bg-[#BDDCF4] dark:bg-[#2A4A6D] dark:text-[#48AAFF] dark:hover:bg-[#1A416A]":"hover:bg-black/10 focus-visible:outline-black dark:focus-visible:outline-white"),"aria-pressed":i,"aria-label":h.formatMessage({id:"Sl1VH/",defaultMessage:"Search the web"}),disabled:s,onTransitionEnd:()=>c(!1),onClick:m=>{m.stopPropagation(),m.preventDefault(),c(!0),q.logEventWithStatsig(H.composerSearchButtonClicked,"composer_search_button_clicked",u),o(!i,u,Zs.CONVERSATION_COMPOSER_WEB_ICON),/^search\s?$/i.test(t.getCurrentText())&&t.setText(""),t.replaceSlashCommandTokensWithText(),t.focus()},children:[e.jsx(Ss,{}),e.jsx(fs,{children:i&&e.jsx(te.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:r?0:.15},children:e.jsx("div",{className:"pl-1 pr-2",children:e.jsx(P,{id:"TbHx8d",defaultMessage:"Search"})})})})]})})}function zf({composerController:t,highlightTooltip:s,clientThreadId:n,isDisabled:a}){const{setThreadSearchMode:o}=ln(),i={clientThreadId:n};return e.jsx(ir,{highlightTooltip:s,analyticsMetadata:i,isThreadUsingSearchMode:!1,isDisabled:a,children:e.jsx(er,{showBackground:s,className:"bg-brand-purple/20",children:e.jsx("button",{className:"flex h-8 w-8 items-center justify-center text-token-text-primary disabled:opacity-30",disabled:a,onClick:()=>{q.logEventWithStatsig(H.composerSearchButtonClicked,"composer_search_button_clicked",i),o(!0,i,Zs.CONVERSATION_COMPOSER_WEB_ICON),/^search\s?$/i.test(t.getCurrentText())&&t.setText(""),t.replaceSlashCommandTokensWithText(),t.focus()},children:e.jsx(Ss,{className:A(s&&"text-brand-purple-800 dark:text-brand-purple-600")})})})})}function Uf(){const t=sa(on.hasSeenComposerSearchButtonTooltip);return!t.isLoading&&t.eligible}function ir({children:t,highlightTooltip:s,analyticsMetadata:n,isThreadUsingSearchMode:a,isDisabled:o}){const i=Uf()&&!a,r=sa(on.hasSeenComposerSearchButtonTooltip);return o?e.jsx("div",{children:t}):i?e.jsx(ci,{side:"right",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(P,{id:"Yjduqi",defaultMessage:"Search the web"}),onDismiss:r.markAsViewed,sideOffset:0,className:"!max-w-sm",description:e.jsx(P,{id:"W51Aei",defaultMessage:"Get fast answers with trusted sources. {learnMore}",values:{learnMore:e.jsx(bc,{href:"https://openai.com/index/introducing-chatgpt-search",className:"underline",children:e.jsx(P,{id:"stA7F4",defaultMessage:"Learn more"})})}}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx(Dt,{sideOffset:0,label:e.jsx(P,{id:"c+4o2s",defaultMessage:"Search the web"}),side:"right",open:s||(a?!1:void 0),onOpenChange:l=>{l&&q.logEventWithStatsig(H.composerSearchButtonHovered,"composer_search_button_hovered",n)},children:t})})}function Hf({composerController:t,clientThreadId:s}){const n=gs(s),{setThreadSearchMode:a}=ln(),i=yc().size>0,r=di(s,Ho.Search),l=wc(s),[c,h]=d.useState([]),[u,m]=d.useState(void 0),[g,p]=d.useState(0);d.useEffect(()=>{h(u?l.filter(M=>M.name.toLocaleLowerCase().startsWith(u.text.toLocaleLowerCase())||M.systemHint.toLocaleLowerCase().startsWith(u.text.toLocaleLowerCase())):[])},[u]);const b=t.useState(M=>M.getSystemHints().length>0);d.useEffect(()=>{const M=w=>{m(_=>!_||!w?w:_.text===w.text&&_.range.from===w.range.to&&_.range.to?_:w)};t.view.dispatch(t.view.state.tr.setMeta(cs,{onHintMatch:M}))},[t]);const f=i||b||!l.length||!c.length||!u;d.useEffect(()=>{f&&p(0)},[f]);const y=c.length,x=d.useCallback(M=>{p(w=>(M(w)%y+y)%y)},[y]),j=c[g],S=({hintToSave:M=j,expectPerfectMatch:w,appendSpace:_=!0})=>{if(!u||!j||w&&M.name.toLowerCase()!==u.text.toLowerCase())return;q.logEvent(H.systemHintSelected,{system_hint:M.systemHint,conversation_id:n??Oa});const Y=u.text+M.name.slice(u.text.length),U={clientThreadId:s};Sm(t.view,{id:M.systemHint,hint:Y},u.range,_,r,T=>a(T,U,Zs.CONVERSATION_COMPOSER_SLASH_SEARCH)),jt(t.view)},v=d.useRef(S);v.current=S;const k=d.useRef(x);k.current=x;const D=d.useRef(u);D.current=u;const N=t.view;return d.useEffect(()=>(f||mm(N,M=>{M==="up"?k.current(w=>w-1):M==="down"?k.current(w=>w+1):M==="cancel"?(jt(N),xm(N)):M==="submit"?(v.current({expectPerfectMatch:!1}),jt(N)):M==="checkMatch"&&v.current({expectPerfectMatch:!0,appendSpace:!1})}),()=>jt(N)),[f,N]),d.useEffect(()=>{f||q.logEvent(H.systemHintListOpened,{conversation_id:n??Oa})},[f]),f?null:e.jsx(jc,{className:"max-w-60",onMouseDown:M=>{M.preventDefault()},children:c.map((M,w)=>e.jsx("div",{onMouseOver:()=>p(w),onClick:()=>{S({hintToSave:M,expectPerfectMatch:!1}),t.focus()},children:e.jsx(Mc,{autoFocus:!1,className:"group rounded-lg px-1 py-2 hover:bg-token-hint-text",spoofHovered:w===g,children:e.jsx(Gf,{title:M.name,description:M.description,icon:e.jsx(Cc,{svgString:M.logo,className:"icon-lg text-token-text-secondary group-hover:text-white"}),checked:!1})})},M.systemHint))})}function Gf({title:t,description:s,icon:n,checked:a}){return e.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-1.5 pl-1.5 pr-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:n}),e.jsxs("div",{className:"shrink grow basis-0",children:[e.jsx("p",{className:"text-sm font-normal leading-tight text-token-text-primary group-hover:text-white",children:t}),!!s&&e.jsx("p",{className:"text-[13px] font-normal leading-[18px] text-token-text-secondary group-hover:text-white",children:s})]}),a&&e.jsx(Gi,{className:A("icon-md text-token-text-primary",{"group-hover:hidden":!a})})]})}function Wf({composerController:t,clientThreadId:s}){return t instanceof hn?e.jsx(Hf,{composerController:t,clientThreadId:s}):null}function Vf({suggestions:t,composerController:s,onSelect:n,onChange:a}){const o=rn(),i=d.useCallback((u,m,g)=>{n?.(u,m,g),o(u,m,g)},[n,o]),[r,l]=d.useState(-1),[c,h]=d.useState(!1);return d.useEffect(()=>{const u=m=>{if(m.key==="ArrowDown"){const g=r===t.length-1?0:r+1;l(g),a?.(g,!0,t[g])}else if(m.key==="ArrowUp"){m.preventDefault();const g=r<=0?t.length-1:r-1;l(g),a?.(g,!0,t[g])}else m.key==="Enter"&&!m.shiftKey&&t[r]&&i(t[r],t,r)};return s.subscribe("keydown",u)},[t,r,a,i,s]),d.useEffect(()=>s.subscribe("blur",()=>{l(-1),a?.(-1,!1)}),[s,a]),d.useEffect(()=>{if(!c){const u=()=>{h(!0),window.removeEventListener("mousemove",u)};return window.addEventListener("mousemove",u),()=>{window.removeEventListener("mousemove",u)}}},[c]),d.useEffect(()=>{l(-1),a?.(-1,!1),h(!1)},[t,a]),e.jsx(te.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"hidden w-full flex-col p-2.5 group-focus-within:flex group-focus-within:max-lg:flex-col-reverse",children:t.map((u,m)=>e.jsxs(te.li,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:m*.03},exit:{opacity:0,translateY:4},className:"w-full",children:[m>0&&e.jsx("div",{className:A("h-[1px] opacity-60 max-lg:hidden",r===m||r===m-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")}),e.jsxs("button",{className:A("flex w-full cursor-pointer items-center justify-start whitespace-pre-wrap rounded-lg px-2.5 py-3 text-start",r===m?"bg-token-main-surface-secondary":"bg-token-main-surface-primary"),onClick:g=>{g.preventDefault(),i(u,t,m)},onMouseDown:g=>{g.preventDefault()},onMouseEnter:()=>{c&&(l(m),a?.(m,!1,u))},onMouseLeave:()=>{l(-1),a?.(-1,!1,u)},children:[u.icon?e.jsx("span",{className:"mr-4 h-6 w-6 text-token-text-secondary",children:u.icon}):null,e.jsx("span",{className:"whitespace-pre-wrap",children:u.autocompletionChunks&&u.autocompletionChunks.length>0?e.jsx(e.Fragment,{children:u.autocompletionChunks.map((g,p)=>e.jsx("span",{className:A(g.isMatched?"text-token-text-tertiary":"text-token-text-primary"),children:g.text},p))}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:A(u.type===Ws.Starter?"text-token-text-secondary":"text-token-text-tertiary"),children:u.title}),e.jsx("span",{className:"text-token-text-primary",children:u.body})]})})]}),m>0&&e.jsx("div",{className:A("h-[1px] opacity-60 lg:hidden",r===m||r===m-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")})]},u.id??m))})}function qf(t,s){t=t.toLocaleLowerCase();const n=s;s=s.toLocaleLowerCase();const a=[];let o=0;for(let l=0;l<s.length&&(o<t.length&&t[o]===s[l]&&(a.push(l),o++),o!==t.length);l++);const i=[];let r=0;if(a.forEach(l=>{if(l>r){const c=n.slice(r,l);c&&i.push({text:c,isMatched:!1})}i.push({text:n[l],isMatched:!0}),r=l+1}),r<s.length){const l=n.slice(r);l&&i.push({text:l,isMatched:!1})}return $f(i)}function $f(t){if(t.length===0)return t;let s=[t[0]];for(let a=1;a<t.length;a++){const o=s[s.length-1],i=t[a];o.isMatched===i.isMatched?o.text+=i.text:s.push(i)}const n=s.filter(a=>a.isMatched).reduce((a,o)=>a+o.text.trim().length,0);return s.length<=4&&n>=2?s:[{text:s.map(a=>a.text).join(""),isMatched:!1}]}const Kf=1,Yf=3e3;function Xf({files:t,className:s}){const n=an(),a=nn(),{value:o}=Ne("1567586774"),i=ad();return e.jsxs("div",{className:s,children:[i.map(r=>e.jsx(pf,{pastedTextdoc:r,textdocId:r.tempId},r.tempId)),t.map(r=>e.jsx(od,{borderRadius:o?"2xl":"xl",useV2Style:o,width:n?"normal":"wide",onRemoveFileClick:()=>In.remove(a,r.tempId,"none"),file:r.file,fileId:r.fileId??void 0,contextConnectorInfo:r.contextConnectorInfo,loadingPercentage:r.status===id.Uploading?r.progress:void 0},r.tempId))]})}function Qf({onAbortCompletion:t,onCreateNewCompletion:s,onContinueGenerating:n,currentModelId:a,clientThreadId:o,isNewThread:i,isCompletionInProgress:r,className:l,disabled:c=!1,disabledReason:h,canPause:u=!1,canContinue:m=!1,suggestions:g,isInteractableSharedThread:p,composerContainerRef:b,composerController:f,autocompletions:y,requiresFileUpload:x,onComposerInput:j,onComposerChange:S,onAutocompleteSelect:v,headerClassName:k,hideHeader:D,setComposerBarElement:N,onTaggingDropdownOpen:M,onTaggingDropdownClose:w}){const _=ia(),Y=hs(),{isUnauthenticated:U}=ze(),T=ee(),G=Rt(),F=nn(),R=ft(o),C=sn(o),[W]=Go(),$=Js(),K=na(),{gizmoEditorData:O,mode:se,getGizmoId:ye}=Jo(),me=en(),ne=kc(),ae=Ft(),Pe=aa(),ie=gs(o),Ce=!!Qr(),xe=!!Qn(),[we,I]=d.useState({}),{setThreadSearchMode:re,clearSearchModeTrigger:Le,getSearchModeTrigger:ke}=ln(),L=oa(),[B,de]=d.useState(!1),[le,ue]=d.useState(!1),Z=Ye(),X=d.useRef(!1),he=ui(),{value:je}=Ne("1567586774"),ge=a!==null?he[a]:void 0,He=_c(o);let J=hi(o),Ge=J&&"gizmo"in J?J.gizmo:void 0;const[Se,gt]=d.useState(null);Se!==null&&(J={gizmo:Se,gizmo_id:Se.gizmo.id,kind:et.GizmoInteraction},Ge=Se);const _e=Ga(ge,J);let vs=!1;Tc(J)&&Ge?.gizmo.id===Ac&&(vs=!0);const mn=Oo(),Lt=!c&&!vs&&_e!==Pn.None&&!U,tt=Ec(ge,J),Ot=Nc(ge,J);let Ie=Wa(E=>E.files);const[st]=d.useState(()=>Rc());se==="magic"?Ie=Ie.filter(E=>E.gizmoId!=null):Ie=Ie.filter(E=>E.gizmoId==null);const fn=Pc(),nt=Ie.length>0||fn,Bt=Wa(Ic.hasUploadInProgress),zt=f.useState(E=>{const pe=Dc(E);return typeof ge?.maxTokens=="number"&&pe>ge.maxTokens}),Ut=f.useState(E=>!E.isEmpty()),pt=!zt&&!Bt&&(Ut||nt);mi(Ie.length>0||Bt||Ut);const bs=(_e===Pn.Multimodal?Fc:Lc)-Ie.length,at=bs<=0,qe=pt&&!c&&!r&&!xe,[ys,xt]=d.useState(!1),gn=fi(),ot=a||gn.id,Ht=di(o,Ho.Search),it=!c&&!Ge&&me?.includes(ns.SearchTool)&&(me?.includes(ns.BrowsingAvailable)||!Y?.isEnterprisey()),rt=it&&Ht,pn=he[ot]?.tags,{targetedContent:ws,setTargetedContent:Gt}=gi(),Ae=ws?.isFocusedViewContent&&!Pe?void 0:ws,{rebaseSystemMessageContent:xn}=ra();d.useEffect(()=>{if(!_?.id)return;const E=Va.getAndReset(_?.id,ie);E&&f.setText(E.inputText)},[_?.id,ie,f]),d.useEffect(()=>{ys!==qe&&(xt(qe),qe&&Zr(!0).then(E=>{Jr.startEnforcement(E),Oc.startEnforcement(E),el.startEnforcement(E)}))},[qe,ys,J?.kind,me]);const Wt=Bc(ge,J),{handleFileAccepted:js}=zc(T,Ga(ge,J),tt,"mouse",ye,Wt?.attachments),{getInputProps:ka,open:Sn}=Uc({disabled:c||!Lt||at,noClick:!0,onDropAccepted:js,onDropRejected:E=>Hc(E,T,G,_e),multiple:!0,maxSize:Gc,maxFiles:bs,...Wc(Ot)}),Ms=tl(st),Cs=d.useCallback(()=>{f.eraseContent(),Ms.clearMessages(),f.resize(Kf),Q.clearOverrideModelId(o),pi();for(const E of Ie)In.remove(F,E.tempId,"none");ni.markAllAsSent()},[f,Ms,Ie,F,o]),St=async(E,pe)=>{if(E?.preventDefault(),c||!pt&&!pe||!J||Nt.isLoading(o)!==!1)return;const Oe=new is;de(!0);const Ee=f.getContentToSend(),ct=rd(Ee.content),yn=`${R}-nextPrompt`,Kt=new ld(Si.CompletionRequest,{expectedTimingLogs:[{name:"prompt_submitted",expectedInMs:3e3}]}),{content:Wr,attachments:Ra}=cd(F,ct,ge,J),wn=[];xn&&wn.push(dd(xn));const jn={...J};"gizmo"in jn&&delete jn.gizmo;let Ps=f.getSystemHints();L&&(Ps=[tn.Search]);const Pa=ke(),Vr=L?Pa??Zs.CONVERSATION_COMPOSER_WEB_ICON:void 0,Ia=ud();let Yt={promptId:yn,content:Wr,eventMetadata:{eventSource:E?"mouse":"keyboard"},completionMetadata:{suggestions:g,conversationMode:jn,systemHints:Ps,searchSource:Vr},messageMetadata:{...Ra.length>0&&{attachments:Ra},...Se&&{gizmo_id:Se?.gizmo.id},...we,...Ps.length>0&&{system_hints:Ps},...!!Ee.metadata&&{serialization_metadata:Ee.metadata},...Ia.length>0&&{canvas:{pasted_textdocs:Ia}}},appendMessages:wn.length>0?wn:void 0,turnTracker:Oe,profiler:Kt,requestedModelId:He};Yt=hd(Yt),Ae?.createNewCompletionParams&&(Yt=await Ae.createNewCompletionParams(Yt)),Kt.logTiming("request_params_ready"),await s(Yt),Ae?.onCreateCompletion?.({serverThreadId:ie,currentLeafId:R}),Ae?.shouldPersistAcrossMessages!==!0&&Gt(void 0),rs.hideThreadHeader(),Cs(),de(!1),Kt.logTiming("prompt_submitted"),g!==void 0&&(ce.logEvent("chatgpt_prompt_ignore_suggestions"),q.logEvent(H.promptIgnoreSuggestions)),L&&Pa&&Le()},vn=d.useRef(St);d.useEffect(()=>{vn.current=St});const bn=E=>{Gt(E.targetedReply),E.targetedReply&&(f.focus(),q.logEvent(H.targetedReplyButtonClicked,{conversationId:ie,sourceMessageId:E.messageId}))},ks=d.useCallback(()=>{Ae?.onCleared?.({serverThreadId:ie,currentLeafId:R}),Gt(void 0),f.focus()},[R,ie,Ae,Gt,f]),_s={Enter:{validator:E=>{const pe=E.isComposing||E.keyCode===229;return!(le&&X.current)&&(E.metaKey||(ne||Bo)&&!E.shiftKey&&!pe)},handler:E=>{if(!qe){zt&&G.danger("The message you submitted was too long, please submit something shorter.",{hasCloseButton:!0});return}E.preventDefault(),St()}},Escape:{validator:E=>!E.isComposing,handler:E=>{u&&r&&(t("",C),q.logEvent(H.pauseCompletion,{threadId:Q.getServerThreadId(o),currentLeafId:Q.getTree(o).getMessageId(R),eventSource:"keyboard"})),E.target.value===""&&ks()}}},lt=d.useRef(_s);lt.current=_s;const Ts=d.useRef(null),V=Vc(pn,J?.kind),[Te,Xe]=d.useState(!1),[Vt,As]=d.useState(!1),Es=V&&Te,_a=f.isReady();d.useEffect(()=>f.subscribe("keydown",E=>{f.acceptLegacyKeydown()&&lt.current[E.key]?.validator(E)&&lt.current[E.key].handler(E);const Oe=f.getCurrentText();if(E.key==="@"){const Ee=f.getSelectionStart(),ct=Oe.substring(0,Ee);(!ct||/\s$/.test(ct)||Ee===0)&&(Ts.current?.handleClose(),setTimeout(()=>Xe(!0),10))}else Te&&Xe(!1);if(E.key==="Escape"&&(gt(null),ue(!1)),rt&&!L){let Ee;E.key==="Backspace"?Ee=Oe.substring(0,Oe.length-1):Ee=Oe+E.key,/^search\s?$/i.test(Ee)?As(!0):Vt&&As(!1)}L&&E.key==="Escape"&&re(!1,{clientThreadId:o})}),[f,_a,Te,Vt,rt,L,re,o]),d.useEffect(()=>{const E=Object.fromEntries(Object.keys(lt.current).map(pe=>[pe,Ee=>{const ct=lt.current[pe];if(!ct||f.acceptLegacyKeydown())return!1;const{validator:yn,handler:Kt}=ct;return yn(Ee)?(Kt(Ee),!0):!1}]));f.registerKeyHandlers(E)},[f,_a]),d.useEffect(()=>f.subscribe("paste",E=>{qc({filePickerStore:F,event:E,intl:T,toaster:G,clientThreadId:o,conversationMode:J,currentModelConfig:ge,getEditorGizmoId:ye,modelSupportedImageMimeTypes:tt})}),[T,o,J,ge,ye,tt,f,G,F]);const kr=E=>{Ce||gt(E),f.trimLeadingText("@"),os(),Xe(!1)},_r=$c(o,st,T,tt,Wt?.attachments),Tr=d.useCallback(E=>{E?.preventDefault(),t("",C),q.logEvent(H.pauseCompletion,{threadId:Q.getServerThreadId(o),currentLeafId:Q.getTree(o).getMessageId(R),eventSource:"mouse"}),os()},[t,o,C,R]),Ta=d.useCallback(()=>{Va.set(_?.id,ie,f.getCurrentText())},[ie,_?.id,f]);d.useEffect(()=>{O||!B&&!Kc()&&f.focus()},[B,f]),d.useEffect(()=>{O||In.reset(F)},[a,F,O]),d.useEffect(()=>{(!V&&Se||Ce)&&gt(null)},[V,Se,Ce]);const[Ar,Er]=(()=>{switch(h){case"workspaceDisallowsGizmo":return[We.disallowedByWorkspacePlaceholder,!0];case"feedbackRequired":return[We.disabledFeedbackPlaceholder,!0];case"noModelsAvailable":return[We.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[We.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[We.loading,!0];case"noTestGizmoId":return[We.noTestGizmoId,!0];default:return p?[We.placeholderWithName,!1]:Ae?.placeholderTextOverride!=null?[Ae.placeholderTextOverride,!1]:[We.placeholderWithName,!1]}})(),Nr=T.formatMessage(Ar,{name:O!=null?se==="magic"?Yc:O.name||"GPT":Ge?.gizmo.display.name??"ChatGPT"});d.useEffect(()=>f.subscribe("input",()=>{xi.getState().isThreadHeaderVisible&&rs.hideThreadHeader(),ue(!0)}),[f]),d.useEffect(()=>{if(j)return f.subscribe("input",()=>{j?.()})},[f,j]),d.useEffect(()=>{if(S)return f.subscribe("change",()=>{S?.()})},[f,S]),d.useEffect(()=>f.subscribe("focus",()=>{ue(!0)}),[f]);const Rr={clientThreadId:o,uploadType:_e,modelAcceptedMimeTypes:Ot,modelSupportedImageMimeTypes:tt,attachmentsProductFeature:Wt?.attachments,getInputProps:ka,openFileDialog:Sn,historyDisabled:ae,onOauthRedirect:Ta,highlightTooltip:x&&!nt},qt=[],Aa=!c&&!at&&(Lt||mn!=null)&&!L;(je||Aa)&&qt.push(e.jsx(Qm,{...Rr,isDisabled:!Aa},"file-upload-button")),it&&(!L||je)&&qt.push(e.jsx(Of,{composerController:f,highlightTooltip:Vt,clientThreadId:o,isDisabled:!rt||nt},"search-button"));const Pr=nt&&e.jsxs(e.Fragment,{children:[se==="magic"&&e.jsx("div",{className:"m-2 mb-0 rounded-lg bg-token-main-surface-secondary p-2 text-xs text-token-text-secondary",children:e.jsx(P,{...We.gizmoKnowledgeWarning})}),e.jsx(Xf,{files:Ie,className:A("flex flex-nowrap gap-2 overflow-x-auto",je?"p-1.5":"pb-1.5 pt-[7px]")})]}),Ir=Er?"disabled":"default",Dr=r&&u,Fr=!qe||B,Lr=md(Bt,Ut,zt),Ns=Dr?"streaming":Fr?"disabled":"idle",$t=d.useRef(null),vt=d.useRef(null),{layer:Or}=Fe("387752763"),{layer:Br}=Fe("51287004"),zr=Or.get("enable_slash_commands",!1)&&(U||!Y?.isFree()||Br.get("enable",!1)),Ur=a&&[fd,gd].includes(a),Hr=zr&&J?.kind===et.PrimaryAssistant&&!L;d.useEffect(()=>{const E=()=>{$t.current!=null&&Rn.addAction("composer_state_disabled",{threadId:Q.getServerThreadId(o),disabledReason:$t.current})};if(pt&&Ns==="disabled"){let pe="unknown";c?pe=h??"component_disabled_unknown":r?pe="completion_in_progress":xe?pe="thread_hard_blocked":B&&(pe="starting_new_completion_request"),$t.current!==pe&&(vt.current&&clearTimeout(vt.current),vt.current=setTimeout(E,Yf)),$t.current=pe}else $t.current=null;return()=>{vt.current&&(clearTimeout(vt.current),vt.current=null)}},[o,pt,Ns,c,h,r,xe,B]);const Rs=[];if(L&&!je&&Rs.push({type:"system_hint",value:T.formatMessage(Zf.searchMode),icon:e.jsx("span",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-brand-purple/15",children:e.jsx(Ss,{className:"h-[20px] w-[20px] shrink-0 text-[#814CFF]"})}),onRemoveRegion:()=>{re(!1,{clientThreadId:o}),f.focus()}}),Ae?.label&&Rs.push({type:Ae.type,value:Ae.label,onRemoveRegion:ks}),Se!==null){const E=!!Se.gizmo.tags?.includes(la.FirstParty);Rs.push({type:"mention",value:Se.gizmo.display.name,icon:e.jsx(Xc,{isFirstParty:E,src:Se.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{gt(null),f.focus()}})}d.useEffect(()=>{(!y||y.length===0||!le)&&(X.current=!1)},[y,le]);const Gr=(E,pe,Oe)=>{X.current=E>=0,pe&&f.setText(Oe?`${Oe.title}${Oe.body}`:"")},Ea=le&&y&&y.length>0&&!Es&&!f.hasMultipleLines()&&f.canShowAutocompletion();d.useEffect(()=>{Es?M?.():w?.()},[Es,M,w]);const Na=Ns==="streaming"?Tr:St;return e.jsxs(Qc.Provider,{value:st,children:[e.jsx(Zc,{onOauthRedirect:Ta,children:e.jsx("form",{className:l,onSubmit:Na,children:e.jsxs("div",{className:"relative flex h-full max-w-full flex-1 flex-col",children:[!D&&!Z&&e.jsx(nr,{className:k}),e.jsxs("div",{className:"relative h-0",children:[Es&&e.jsx("div",{className:A("absolute bottom-3 w-full space-y-2",Gs.TagGpt),children:e.jsx(Jc,{onClick:E=>kr(E),onClose:()=>{Xe(!1),f.focus()}})}),Hr&&e.jsx("div",{className:A("absolute bottom-3 space-y-2",Gs.TagGpt),children:e.jsx(Wf,{composerController:f,clientThreadId:o})})]}),e.jsxs("div",{ref:b,className:"group relative flex w-full items-center",children:[i&&W.has("from_template_row")&&e.jsx("button",{type:"button",onClick:()=>{$("/")},className:"mr-2 flex h-8 w-8 items-center justify-center text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(_h,{className:"icon-lg"})}),V&&!!ie&&e.jsx(ed,{ref:Ts}),e.jsx(lf,{type:ae?"temporary":"default",ref:N,replyRegions:Rs,placeholder:Nr,inputState:Ir,composerController:f,leftSideActions:qt,state:Ns,onSubmit:Na,renderFiles:Pr,currentLeafId:R,clientThreadId:o,gizmoId:Ge?.gizmo.id,disableReason:Lr,modelId:ot}),Ea&&e.jsx("div",{className:A("absolute left-0 z-10 box-border w-full bg-token-main-surface-primary max-lg:bottom-full lg:top-full",qt?.length>0&&K&&!je?`px-${qt.length*8}`:"pl-0"),children:e.jsx(Vf,{suggestions:y,composerController:f,onSelect:v,onChange:Gr})})]}),e.jsx(td,{composerController:f,parsedDocumentHandler:_r})]})})}),e.jsx(Tm,{canUseInlineTagging:V,isDisabled:c,clientThreadId:o,currentLeafId:R,currentRequestId:C,canContinue:m,composerController:f,setPromptInputMetadata:I,suggestions:g,isNewThread:i,onCreateNewCompletion:s,onContinueGenerating:n,onResetState:Cs,conversationMode:J,isShowingAutocomplete:!!Ea}),J!=null&&!Ur&&sd.includes(J.kind)&&e.jsx(nd,{onTargetedReply:bn})]})}const Zf=be({searchMode:{id:"LSO1pB",defaultMessage:"Search the web"}}),Jf=({children:t})=>{const[s]=d.useState(()=>new Hs);return t(s)},rr=({children:t})=>{const{layer:s}=Fe("387752763");return s.get("enable_rich_text_composer",!1)?e.jsx(of,{children:t}):e.jsx(Jf,{children:t})};function eg(t){const s=t.message?.author.role===ve.User,n=t.metadata?.err!=null&&t.metadata?.errCode!==Vs.ContentPolicy,a=t.metadata?.errCode===Vs.ModelIncompatibility;return t.metadata?.canRetry===!1||a?!1:s||n}function tg(t){return t.composerController?e.jsx(uo,{...t,composerController:t.composerController}):e.jsx(rr,{children:s=>e.jsx(uo,{...t,composerController:s})})}function uo({clientThreadId:t,isNewThread:s,currentModelId:n,showPromptStarters:a,noWrap:o,onRequestCompletion:i,composerContainerRef:r,composerController:l}){const c=ca(),h=da(),u=ua(g=>{const p=Nt.getCurrentNode(t,g);return eg(p)});if(vi(l),!h&&u)return e.jsx(sg,{clientThreadId:t});const m=e.jsx(e.Fragment,{children:e.jsx(lr,{composerContainerRef:r,composerController:l,clientThreadId:t,currentModelId:n,isNewThread:s,showPromptStarters:a,onRequestCompletion:i})});return o?m:e.jsxs(e.Fragment,{children:[e.jsx(wm,{clientThreadId:t}),e.jsx(ha,{clientThreadId:t,isStaticSharedThread:c,withVerticalPadding:!1,withHorizontalPadding:!0,children:e.jsx(ls,{children:m})})]})}function sg({clientThreadId:t}){const s=pd(t),n=ua(i=>Nt.getCurrentNode(t,i).metadata?.errCode===xd),a=Sd(i=>i.isoDate),o=ft(t);return n&&a!=null&&a!==""?null:e.jsxs("div",{children:[e.jsx("div",{className:"mb-3 text-center text-xs",children:e.jsx(P,{...ho.errorGeneratingResponse})}),e.jsx("div",{className:"flex items-center md:mb-4",children:e.jsx(Ve,{as:"button",color:"primary",onClick:()=>{const i=new is;ce.logEvent("chatgpt_regenerate_due_to_error_button_clicked",void 0,Je({clientThreadId:t})),s({id:o,eventMetadata:{eventSource:"mouse"},conversationMode:Nt.getConversationMode(t),turnTracker:i})},className:"m-auto",icon:Hi,"data-testid":"regenerate-thread-error-button",children:e.jsx(P,{...ho.regenerateResponse})})})]})}function lr({clientThreadId:t,currentModelId:s,isNewThread:n,onRequestCompletion:a,showPromptStarters:o,composerContainerRef:i,composerController:r,autocompletions:l,requiresFileUpload:c,onComposerInput:h,onComposerChange:u,onAutocompleteSelect:m,headerClassName:g,hideHeader:p,onTaggingDropdownClose:b,onTaggingDropdownOpen:f}){const y=ft(t),x=sn(t),j=Dn(),{isUnauthenticated:S}=ze(),k=bi(t)===Wo.STREAMING,D=yi({clientThreadId:t,conversationLeafId:y}),N=mt(x),M=wi({clientThreadId:t}),w=!S,_=sl(),{isOpen:Y,onClose:U}=vd({type:"just-hit-rate-limit"}),T=d.useCallback((ke,L)=>{q.logEvent(H.continueCompletion),a({type:Ba.Continue,promptId:ke,eventMetadata:{eventSource:"mouse"},cancelActiveRequests:!1,completionMetadata:{conversationMode:Nt.getConversationMode(t)},turnTracker:L})},[a,t]),G=Vo(),F=d.useCallback(async(ke,L)=>bd({clientThreadId:t,currentRequestId:L,isHistoryAndTrainingDisabled:_,queryClient:G}),[t,_,G]),R=d.useCallback(async({promptId:ke,content:L,eventMetadata:B,completionMetadata:de,messageMetadata:le,appendMessages:ue,turnTracker:Z,profiler:X,requestedModelId:he})=>{const je=Q.getThreadCurrentLeafId(t);Q.updateTree(t,ge=>{ge.addNode(ke,L,je,ve.User,void 0,le)}),await a({type:Ba.Next,promptId:ke,eventMetadata:B,cancelActiveRequests:!0,completionMetadata:de,appendMessages:ue,turnTracker:Z,profiler:X,...he?{requestedModelId:he}:{}})},[t,a]),C=yd(t,y),W=wd(t,y),$=!D&&(N||k),K=d.useMemo(()=>$?!1:!C&&W,[C,W,$]),O=$&&s!=="gpt-4-pbrowse",se=ma(t),ye=Ue(t),me=ms(ye).data,{promptStarters:ne,isSuccess:ae}=Fn(n&&!se,t,4),Pe=Qo(),ie=(()=>{if(Pe?.messageId===Q.getTree(t).getLastValidNode(y)?.message?.id)return Pe?.suggestions;if(o&&!se&&ae&&!w)return ne})(),Ce=jd(),xe=nl(),we=(()=>{if(me?.gizmo.tags?.includes(la.WorkspaceDisabled)&&!xe)return"workspaceDisallowsGizmo";if(Ce.size){if(j.displayingSideBySideFeedback&&j.unskippable)return"feedbackRequired"}else return"noModelsAvailable";const L=Nt.getConversationMode(t);return L?.kind===et.GizmoTest&&L.gizmo_id==null?"noTestGizmoId":null})(),I=ji(t),re=cn(t),Le=_t("15117983")?.value;return e.jsxs(e.Fragment,{children:[Y?e.jsx(Md,{onClose:U}):null,Le&&re&&re.kind===et.PrimaryAssistant&&re.plugin_ids&&re.plugin_ids.length>0?e.jsx(ng,{}):e.jsx(Qf,{composerContainerRef:i,composerController:r,clientThreadId:t,onCreateNewCompletion:R,onAbortCompletion:F,onContinueGenerating:T,currentModelId:s,isNewThread:n,isCompletionInProgress:M,className:"w-full",canContinue:K,suggestions:ie??[],disabled:!!we,disabledReason:we??void 0,canPause:O,isInteractableSharedThread:I,autocompletions:l,requiresFileUpload:c,onComposerInput:h,onComposerChange:u,onAutocompleteSelect:m,headerClassName:g,hideHeader:p,onTaggingDropdownClose:b,onTaggingDropdownOpen:f},t)]})}function ng(){return e.jsxs("div",{className:"mx-auto flex max-w-md flex-col items-center justify-center gap-2 rounded-xl border border-token-border-light bg-token-main-surface-primary p-6 shadow-lg",children:[e.jsx("span",{className:"text-token-text-primary",children:e.jsx(P,{id:"PluginsDecrepatedNotice.pluginsDeprecationTitle",defaultMessage:"Conversations with plugins are archived"})}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(P,{id:"PluginsDecrepatedNotice.pluginsDeprecationSubtitle",defaultMessage:"Explore GPT Store to find a replacement"})}),e.jsxs("a",{href:"https://chat.openai.com/gpts",className:"text-green-500 hover:cursor-pointer dark:text-green-400",children:[e.jsx(P,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLink",defaultMessage:"Explore GPTs"}),e.jsx("span",{className:"ml-2",children:e.jsx(P,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLinkArrow",defaultMessage:"→"})})]})]})}const ho=be({errorGeneratingResponse:{id:"PromptTextarea.errorGeneratingResponse",defaultMessage:"There was an error generating a response"},regenerateResponse:{id:"PromptTextarea.regenerateResponse",defaultMessage:"Regenerate"}}),cr=d.memo(function(){return e.jsxs("div",{className:`flex flex-col gap-2 ${Gs.PromptTextareaHeader}`,children:[e.jsx(ar,{}),e.jsx(or,{})]})}),Xp=Object.freeze(Object.defineProperty({__proto__:null,ChatScreenComposerAlerts:cr},Symbol.toStringTag,{value:"Module"})),kn=4;function ag(t){const{layer:s}=Fe("3533083032"),{layer:n}=kt("3533083032"),{value:a,isLoading:o}=Ne("3006519778");return o||!a?!1:t?s.get("enable_new_homepage_anon",!1):n.get("enable_new_homepage_anon",!1)}function og(){const{layer:t}=kt("4031588851"),s=t.get("autocomplete_qualified_start_date","2099-09-13T00:00:00Z"),n=ia();return!!n&&n.created*1e3>=new Date(s).getTime()}function ig(t){const{layer:s}=Fe("4031588851"),{layer:n}=kt("4031588851"),{value:a,isLoading:o}=Ne("633009675");return o||!a?!1:t?s.get("enable_new_autocomplete_homepage",!1):n.get("enable_new_autocomplete_homepage",!1)}const _n=t=>`${t.title}${t.body}`.toLocaleLowerCase();function rg(t){return Ue(t.clientThreadId),e.jsx(rr,{children:s=>e.jsx(hg,{...t,composerController:s})})}function lg({children:t,composerController:s}){const{store:n}=Re(),[a,o]=d.useState(!1);d.useEffect(()=>s.subscribe("focus",()=>{o(!0)}),[s]),d.useEffect(()=>s.subscribe("blur",()=>{o(!1)}),[s]);const r=!!n.useSharedProps()?.isShowingAutocomplete;return t(r&&a)}function cg({isUnauthenticated:t,shouldShowLegacyStarterPrompts:s,legacyPromptStarters:n,isSendBlocked:a,clientThreadId:o}){return e.jsxs("div",{className:A(t?"justify-end lg:justify-center":"justify-center","flex h-full flex-shrink flex-col items-center overflow-y-hidden text-token-text-primary lg:hidden"),children:[e.jsx("div",{className:A(t&&"flex sm:items-center md:flex-1","flex-shrink-0"),children:e.jsx(us,{className:"mb-6 h-12 w-12"})}),s&&(n&&n.length>0?e.jsx(pg,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},promptStarters:n,isSendBlocked:a,clientThreadId:o,isSquare:t}):e.jsx(em,{}))]})}function dg({composerController:t,isSendBlocked:s,clientThreadId:n,isModelLoaded:a,headlineOption:o,enableNewMobileDesign:i,shouldShowStarterPrompts:r,promptChips:l,onSelectStarterPrompt:c,starterPromptExpanded:h,setStarterPromptExpanded:u}){return e.jsx(lg,{composerController:t,children:m=>e.jsxs(te.div,{initial:{opacity:0},animate:{opacity:m?0:1},exit:{opacity:0},transition:{duration:.1},className:A("justify-center",m?"pointer-events-none":"","mt-[var(--screen-optical-compact-offset-amount)] flex h-full flex-shrink flex-col items-center overflow-hidden text-token-text-primary lg:hidden"),children:[o==="CHATGPT_LOGO"?e.jsx(us,{className:"inline-block h-12 w-12"}):e.jsx(dr,{headlineOption:o,isModelLoaded:a}),e.jsx(te.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:A(!i&&"lg:hidden",!h&&"h-[116px]"),children:r&&e.jsx(hr,{starterPrompts:l,onSelectStarterPrompt:c,disabled:s,clientThreadId:n,onExpand:()=>u(!0),mobileLayout:!0})})]})})}function ug(t,s,n){const a=Ne("1468311859").value,o=Ne("3664702598").value,{layer:i}=Fe("4031588851"),r=og(),l=t||s,c=l&&a,h=l&&o&&r;let u="HARDCODED";if(l)if(n){const m=i.get("search_autocomplete_mode","");c&&m&&(u=m)}else h&&(u=i.get("autocomplete_mode","HARDCODED"));return u}function hg({clientThreadId:t,currentModelId:s,isModelLoaded:n,onRequestCompletion:a,composerController:o,v2HomepageDisclaimer:i}){const r=Bs(t),l=ma(t),c=Qn(),[h,u]=d.useState([]),{trendingSuggestions:m,fetchTrendingSuggestions:g}=xg(kn),p=d.useRef(!1),{isUnauthenticated:b}=ze(),f=na(),[y,x]=d.useState(!1),j=oa(),S=Ye();vi(o);const v=Ne("589604007").value,{layer:k}=kt("4031588851"),{layer:D}=Fe("4031588851"),{layer:N}=kt("3533083032"),{layer:M}=Fe("3533083032"),{promptStarters:w,isSuccess:_}=Fn(r&&!l&&n,t,8,v,!0,s??void 0),{promptStarters:Y,isSuccess:U,isError:T}=Fn(r&&!l&&n,t,4,void 0,void 0,s??void 0),G=f&&!!h.find(L=>!!L.requires_file_upload),F=d.useCallback(L=>{const B=o.getCurrentText();return B&&_n(L).startsWith(B.toLocaleLowerCase())},[o]),R=d.useCallback(L=>{const B=o.getCurrentText(),de=L.title+L.body;return F(L)?{...L,title:B,body:de.slice(B.length)}:{...L,title:de,body:""}},[o,F]),C=d.useCallback((L=!1)=>{u(B=>!B.some(F)&&B.length>0?[]:L?B:B.map(R))},[F,R]),W=(L,B,de)=>{const le=L.title;u([]),o.focus(),o.setText(le),requestAnimationFrame(()=>{const ue=(w?.filter(Z=>Z.theme===L.theme)??[]).map(Z=>{const X=yt(Z.oneliner),he=X.startsWith(Z.title);return{...Z,title:he?`${Z.title} `:"",body:he?Z.body:X,autocompletionChunks:qf(le,X),type:Ws.Autocomplete}});u(ue),ue.length>0&&Et(ue,t),kd(L,de,t)})};d.useEffect(()=>{const L=h.some(B=>B.theme===Ln.Search);j&&o.getCurrentText()===""?m.length>0?u(m):g():L&&!j&&u(B=>B.filter(de=>de.theme!==Ln.Search))},[h,j,m,g,o]);const $=w?.reduce((L,B)=>(B.theme&&!L[B.theme]&&(L[B.theme]=B),L),{}),K=[];if($)for(const L in $)K.push($[L]);const O=K&&K.length>0,se=!!(_&&O&&n),ye=!!((U||T)&&n),me=kn-h.filter(F).length,ne=b?M.get("enable_new_mobile",!1):D.get("enable_new_mobile",!1),ae=ug(ne,f,j),Pe=b?N.get("headline_option","HELP_WITH"):k.get("headline_option","HELP_WITH"),ie=k.get("autocomplete_min_char",4),Ce=k.get("autocomplete_fetch_interval",200),xe=d.useRef(null),we=d.useCallback(Mi(async L=>{const B=o.getCurrentText();if(!B||B.length<ie||B.length>80||o.hasMultipleLines()){u([]);return}if(!p.current&&!(xe.current&&xe.current.length>ie&&B.startsWith(xe.current)))try{const de=await Ke.generateAutocompletions(B,L,j);if(de.completions.length===0){xe.current=B;return}const le=de.completions.map(ue=>({id:qo(),type:Ws.Autocomplete,title:ue.slice(0,B.length),body:ue.slice(B.length),oneliner:ue,prompt:ue,source:ae})).filter(F).map(R);u(ue=>{const Z=ue.filter(F),X=le.filter(he=>{const je=_n(he);return!Z.some(ge=>{const He=_n(ge);if(je===He)return!0;const J=/[\p{P}\p{S}]$/u,Ge=je.replace(J,""),Se=He.replace(J,"");return Ge===He||je===Se||Ge===Se})}).slice(0,kn-Z.length);return[...Z,...X]}),le.length>0&&Et(le,t)}catch{}},ae==="BING"?150:Ce),[o,ae,R,Ce]),I=d.useCallback(()=>{C(),me>0&&we(me)},[we,C,me]);d.useEffect(()=>{p.current&&u([])},[p]);const re=d.useMemo(()=>ae==="HARDCODED"?C:I,[ae,I,C]),Le=d.useCallback(()=>{o instanceof hn&&C(!0),o.getCurrentText().indexOf(`
`)>0&&u([])},[o,C]),ke=d.useCallback((L,B,de)=>{B.forEach(le=>{le.id===L.id&&(le.userInput=o.getCurrentText())}),u([B[de]])},[o]);return e.jsx(e.Fragment,{children:e.jsx(fs,{children:e.jsx("div",{className:"h-full w-full lg:py-[18px]",children:e.jsx(ha,{isStaticSharedThread:!1,withVerticalPadding:!1,withHorizontalPadding:!0,clientThreadId:t,fullHeight:!0,children:e.jsxs(qa,{children:[e.jsx("div",{className:"mb-7 hidden text-center lg:block",children:Pe==="CHATGPT_LOGO"?e.jsx(us,{className:"inline-block h-12 w-12"}):e.jsx(dr,{headlineOption:Pe,isModelLoaded:n})}),!ne&&e.jsx(cg,{isUnauthenticated:b,shouldShowLegacyStarterPrompts:ye,legacyPromptStarters:Y,isSendBlocked:c,clientThreadId:t}),ne&&e.jsx(dg,{composerController:o,isModelLoaded:n,headlineOption:Pe,enableNewMobileDesign:ne,shouldShowStarterPrompts:se,promptChips:K,onSelectStarterPrompt:W,starterPromptExpanded:y,setStarterPromptExpanded:x,isSendBlocked:c,clientThreadId:t}),e.jsx("div",{className:A("lg:w-full","lg:absolute lg:bottom-8 lg:left-0"),children:e.jsx(qa,{children:S?e.jsx(cr,{}):e.jsx(nr,{className:"block"})})}),e.jsx("div",{className:"w-full",children:e.jsx(lr,{clientThreadId:t,isNewThread:r,currentModelId:s,onRequestCompletion:a,showPromptStarters:!1,composerController:o,autocompletions:h,requiresFileUpload:G,onComposerInput:re,onComposerChange:Le,onAutocompleteSelect:ke,onTaggingDropdownClose:()=>{p.current=!1},onTaggingDropdownOpen:()=>{p.current=!0},hideHeader:!0})}),e.jsx(te.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:A("hidden lg:block",i&&b&&y?"":"h-[70px]"),children:se&&e.jsx(hr,{starterPrompts:K,onSelectStarterPrompt:W,disabled:c,clientThreadId:t,onExpand:()=>x(!0)})}),i&&e.jsx("div",{className:"w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px] lg:absolute lg:bottom-0 lg:left-0",children:e.jsx("div",{className:"min-h-4",children:i})})]})})})})})}function dr({headlineOption:t,isModelLoaded:s}){const n=ee(),[a,o]=d.useState(0),[i,r]=d.useState(!0),l=20,c=n.formatMessage(Sg[t]||ss.whatCanIHelpWith);return d.useEffect(()=>{if(!s)return;let h;return a<c.length?h=setTimeout(()=>{o(a+1)},l):i&&(h=setTimeout(()=>{r(!1)},500)),()=>clearTimeout(h)},[c,a,i,s]),e.jsxs("div",{className:"relative inline-flex justify-center text-center text-2xl font-semibold leading-9",children:[e.jsx("h1",{children:c.substring(0,a)||"​"}),e.jsx("h1",{className:"result-streaming absolute left-full transition-opacity",style:{opacity:i?1:0},children:e.jsx("span",{})})]})}function ur({label:t,onClick:s,disabled:n=!1,icon:a}){return e.jsxs("button",{className:"group relative flex h-[42px] items-center gap-1.5 rounded-full border border-token-border-light px-3 py-2 text-start text-[13px] shadow-xxs transition enabled:hover:bg-token-main-surface-secondary disabled:cursor-not-allowed xl:gap-2 xl:text-[14px]",disabled:n,onClick:s,children:[a,e.jsx("span",{className:"max-w-full select-none whitespace-nowrap text-gray-600 transition group-hover:text-token-text-primary dark:text-gray-500",children:t})]})}function mg({starterPrompt:t,starterPrompts:s,index:n,disabled:a,onSelectStarterPrompt:o}){const i=t.theme??t.title,r=rn(),{mutate:l}=_d(),c=t.category==="onboarding"?()=>{l({key:on.hasUsedConversationalOnboardingStarterPrompt}),r(t,s,n)}:()=>o(t,s,n);return e.jsx(ur,{disabled:a,onClick:c,icon:e.jsx(Td,{starterPrompt:t,useV2Colors:!0}),label:i})}function mo({clientThreadId:t,onClick:s}){d.useEffect(()=>{Ad(t)},[t]);const n=ee();return e.jsx(te.div,{initial:{opacity:0,translateY:5},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:5},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(ur,{onClick:()=>{Ed(t),s()},label:n.formatMessage(ss.moreStarterPrompts)})})}const fg=5,gg=3;function hr({starterPrompts:t,onSelectStarterPrompt:s,disabled:n,clientThreadId:a,onExpand:o,mobileLayout:i=!1}){const r=i?gg:fg,[l,c]=d.useState(r),[h,u]=d.useState(r),[m,g]=d.useState(!1),p=d.useRef(null),b=t.length<=l;d.useEffect(()=>{Et(t.slice(0,r),a)},[a]),d.useEffect(()=>{if(!m&&!b&&p.current){const y=p.current,x=y.getBoundingClientRect(),j=x.width,S=Array.from(y.children);let v=0;for(let k=0;k<S.length&&S[k].getBoundingClientRect().right-x.left<=j;k++)v++;c(v),u(v),g(!0)}},[t,b,m]);const f=()=>{const y=t.slice(l,t.length).map(x=>({...x,isAdditional:!0}));y.length>0&&Et(y,a),c(t.length),o()};return e.jsxs("div",{className:A("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",m&&t.length>0?"opacity-100":"opacity-[0.01]",i?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:A("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",b||i?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:p,children:[t.slice(0,l).map((y,x)=>e.jsx(te.li,{initial:{opacity:0,...x<h?{translateY:5}:{}},animate:{opacity:1,...x<h?{translateY:0}:{}},exit:{opacity:0,...x<h?{translateY:5}:{}},transition:{duration:.3,delay:x>=h?(x-h)*.06:0,ease:"easeOut"},children:e.jsx(mg,{starterPrompt:y,starterPrompts:t,index:x,disabled:n,onSelectStarterPrompt:s})},y.id??x)),i&&t.length>l&&e.jsx(mo,{clientThreadId:a,onClick:f})]}),!i&&t.length>l&&e.jsx(mo,{clientThreadId:a,onClick:f})]})}function pg({promptStarters:t,isSendBlocked:s,clientThreadId:n,isSquare:a,...o}){d.useEffect(()=>{Et(t,n)},[n]);const i=rn();return e.jsx(e.Fragment,{children:a?e.jsx(te.div,{...o,className:"mb-2 w-full flex-shrink overflow-y-hidden",children:e.jsx(ls,{children:e.jsx(Xi,{starterPrompts:t,onSelectStarterPrompt:i,disabled:s})})}):e.jsx(te.div,{...o,className:"flex-shrink overflow-y-hidden",children:e.jsx(tm,{starterPrompts:t,onSelectStarterPrompt:i,disabled:s,cssMobileDisplayLimit:2,marginOverride:"mt-6 lg:mt-12"})})})}const xg=t=>{const[s,n]=d.useState([]),a=d.useCallback(async()=>{const i=(await Ke.generateTrendingSuggestions(t)).suggestions.map((r,l)=>({type:Ws.Starter,title:fo(r),body:"",icon:e.jsx(Th,{}),prompt:fo(r),id:`starter-${l}`,theme:Ln.Search}));n(i)},[t]);return{trendingSuggestions:s,fetchTrendingSuggestions:a}};function fo(t){return t.split(" ").map(Cd).join(" ")}const ss=be({whatCanIHelpWith:{id:"SplashScreenV2.whatCanIHelpWith",defaultMessage:"What can I help with?"},whereShouldWeStart:{id:"SplashScreenV2.whereShouldWeStart",defaultMessage:"Where should we start?"},askChatgptAnything:{id:"SplashScreenV2.askChatgptAnything",defaultMessage:"Ask ChatGPT anything"},moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),Sg={HELP_WITH:ss.whatCanIHelpWith,WHERE_TO_START:ss.whereShouldWeStart,ASK_CHATGPT:ss.askChatgptAnything};function vg({currentModel:t,categoryOptions:s,className:n,modelSwitcherDenialsBySlug:a,displayInFull_INTERNAL_USE_ONLY:o=!1}){const i=t?.id;return e.jsx(z.Portal,{children:e.jsx(z.SubContent,{className:n,children:s.map(r=>{const{value:l}=r;return"options"in r?e.jsx(es,{currentModel:t,isSelected:i.startsWith(l),option:r,modelSwitcherDenialsBySlug:a,displayInFull_INTERNAL_USE_ONLY:o},l):e.jsx(Ks,{isSelected:i===l,value:l,renderName:()=>r.name,modelSwitcherDenialsBySlug:a,showNewChatHint:!1,displayInFull_INTERNAL_USE_ONLY:o},l)})})})}function es({currentModel:t,option:s,isSelected:n=!1,modelSwitcherDenialsBySlug:a,displayInFull_INTERNAL_USE_ONLY:o=!1}){const{name:i,options:r,categoryId:l}=s,c=`${i} Models`,h=()=>e.jsx("div",{className:"flex shrink-0 grow justify-between gap-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ah,{className:"icon-md w-7 text-token-text-secondary"}),c]})});let u;return o&&n&&(u=s.options.find(m=>m.value===t.id)?.name),e.jsxs(z.Sub,{children:[e.jsx(z.SubMenuTrigger,{children:e.jsxs("div",{className:A("flex grow justify-between gap-2 overflow-hidden",o?"items-center break-all":""),children:[l?h():i,n&&e.jsx("div",{className:"truncate text-token-text-tertiary",children:u??t.title})]})}),e.jsx(vg,{currentModel:t,categoryOptions:r,modelSwitcherDenialsBySlug:a,displayInFull_INTERNAL_USE_ONLY:o})]})}function Ks({value:t,renderName:s,isSelected:n,showNewChatHint:a=!0,onClick:o,modelSwitcherDenialsBySlug:i,isUpgradeUpsell:r=!1,testId:l,displayInFull_INTERNAL_USE_ONLY:c=!1}){const h=Nd(),u=Rd(),m=t?i[t]?.conversation?.[0]:null,{layer:g}=Fe("1846737571"),p=e.jsx(z.Item,{onClick:()=>{if(o)o();else if(t){const b=t;h({modelId:b,location:"Model switcher menu item"}),u(b)}},className:A("!pr-3",n&&"!opacity-100",m&&"pointer-events-none text-token-text-quaternary"),"data-testid":l,children:e.jsxs("div",{className:"flex grow items-center justify-between gap-2",children:[e.jsx("div",{className:c?"break-all":"",children:s(m!=null)}),r&&e.jsx(Ve,{color:"secondary",size:"small",className:g.get("is_upgrade_button_blue",!1)?"border-none bg-blue-600 text-white hover:bg-blue-800":"",children:e.jsx(P,{id:"oKo8wt",defaultMessage:"Upgrade"})}),r?e.jsx(e.Fragment,{children:n&&e.jsx(Wi,{className:A("icon-md group-hover:invisible",!a&&"block group-hover:hidden")})}):n&&e.jsx(Gi,{className:"icon-md"})]})},t);return m?e.jsx(Dt,{isLeftArrow:!0,sideOffset:-10,label:e.jsx(Ci,{modelSwitcherDeny:m}),children:p}):p}const bg=Pt(()=>It(()=>import("./ket2mxd52rxkhf27.js"),__vite__mapDeps([45,1,2,3,4,5,46])).then(t=>t.ThreadHeaderGizmoDropdown)),go=Me.button`group flex cursor-pointer items-center gap-1 rounded-lg py-1.5 ${({$isScreenArch:t})=>t?"text-md px-2 ml-1.5 translate-x-[-0.4rem]":"px-3 text-lg"} hover:bg-token-main-surface-secondary radix-state-open:bg-token-main-surface-secondary font-semibold text-token-text-secondary overflow-hidden whitespace-nowrap`;function yg({clientThreadId:t}){const s=ee(),n=Ft(),a=Bd(t),o=Js(),[,i]=Go(),r=()=>{!a&&!n?o({pathname:"/",search:new URLSearchParams({[Is]:"true"}).toString()}):i(l=>(l.get(Is)==="true"?l.delete(Is):l.set(Is,"true"),l),{replace:a,state:Ud()})};return e.jsx(z.Item,{size:"large",className:"!pr-3",onClick:r,icon:Rh,children:e.jsxs("div",{className:"flex grow items-center justify-between gap-2",children:[e.jsx("div",{className:"flex flex-1 items-center gap-3",children:e.jsx(P,{...gr.temporaryChat})}),e.jsx(zd,{enabled:n,label:s.formatMessage({defaultMessage:"Temporary",id:"temporaryChatToggleLabel"}),testId:"temporary-chat-toggle"})]})})}function mr(t,s,n){let a=t;if(t===za.AUTO){const r=s.filter(({defaultModel:l})=>l!==za.AUTO);r.length===1&&(a=r[0].defaultModel)}const o=s.find(({defaultModel:r})=>r===a);if(o){const{categoryId:r,shortLabel:l}=o;return{selectedCategory:r,modelLabel:l}}const i=n.find(({modelIds:r})=>r.includes(a));if(i){const{group:r,shortLabel:l}=i;return{selectedCategory:r,modelLabel:l}}return{selectedCategory:null,modelLabel:null}}function wg({modelLabel:t}){return e.jsx("span",{className:"text-token-text-secondary",children:t})}function jg({clientThreadId:t,inMobileHeader:s}){const{isLoading:n,categories:a,groups:o}=fa(),i=al(),l=ga(t).id,c=Pd(),{modelLabel:h}=mr(l,a,o),u=Cg(t,c),m=ee(),{isUnauthenticated:g}=ze(),p=fr(),b=(!g||!p)&&!i;d.useEffect(()=>{n||Id({namespace:Si.ChatPageLoad})?.logTiming("render_model_switcher")},[n]);const f=Ye(),y=e.jsxs("div",{className:A(!f&&"text-token-text-secondary"),children:[Dd," ",b?e.jsx("span",{className:"text-token-text-secondary",children:h}):g&&h?e.jsx(wg,{modelLabel:h}):null]});return u.length?n?null:e.jsx(Kh,{sideOffset:8,size:"large",triggerButton:e.jsxs(go,{$isScreenArch:f,"aria-label":h?m.formatMessage({id:"JrtGPQ",defaultMessage:"Model selector, current model is {modelLabel}"},{modelLabel:h}):"",children:[y,f?e.jsx(Eh,{className:"icon-md text-token-text-tertiary"}):e.jsx(xa,{className:"icon-md text-token-text-tertiary"})]}),onOpenChange:x=>{q.logEvent(H.toggleModelSwitcher,{isOpen:x}),ce.logEvent("toggle_model_switcher",null,{isOpen:String(x)})},contentAlign:s?"center":"start",testId:"model-switcher-dropdown",children:e.jsx(_g,{sections:u})}):e.jsx(go,{className:"cursor-default",children:y})}function fr(){return Ne("462735957").value}function Mg({category:t,modelSwitcherDenialsBySlug:s,currentGizmoId:n,currentModelId:a,omitIcon:o,testId:i}){const{defaultModel:r,label:l,categoryId:c,description:h,isBeta:u}=t;return e.jsx(Ks,{value:r,modelSwitcherDenialsBySlug:s,renderName:m=>e.jsx($n,{categoryId:c,name:l,description:h,isDisabled:m,omitIcon:o,isBeta:u}),isSelected:!n&&a===r,testId:i},r)}function Cg(t,s){const n=ga(t),a=n.id,o=Ue(t),{categories:i,groups:r}=fa(),{doesUserHaveAnyAccountsWithPlusFeatures:l}=Qs(),c=Q.getServerThreadId(t),h=Fd({clientThreadId:t}),u=ee(),m=!c,{isUnauthenticated:g}=ze(),p=Ld(),{layer:b}=Fe("2723963139"),f=b.get("is_dynamic_model_enabled",!1),y=fr(),x=s.find(({categoryId:C})=>C===Qe.ALPHA),j=s.find(({categoryId:C})=>C===Qe.DATA_CAMPAIGNS),S=s.find(({categoryId:C})=>C===Qe.EXPERIMENTS),v=s.find(({categoryId:C})=>C===Qe.MAINLINE),k=Ne("566128514").value,D=!!x?.options?.length,N=!!j?.options?.length,M=!!S?.options?.length,w=!!v?.options?.length,_=Js(),Y=d.useCallback(()=>{q.logEvent(H.openModalAccountPaymentfromModelPicker,{content:"gizmo-button"}),ki(_,"Thread header dropdown")},[_]),U=()=>{ce.logEvent("chatgpt_model_switcher_plus_upgrade_button_clicked"),q.logEvent(H.modelSwitcherPlusUpgradeButtonClicked),g?p({shouldOpenPaymentModalOnAuth:!0,callback:C=>{q.logSignUpButtonClicked({location:"Model switcher GPT-4 upsell",provider:C})}}):Y()},T=[],G=e.jsxs("div",{className:"mb-1 flex items-center justify-between px-5 pt-2",children:[e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(P,{id:"ilkdMh",defaultMessage:"Model"})}),e.jsx("a",{href:f?"https://help.openai.com/en/articles/9155758-what-is-the-chatgpt-plus-model-selector":"https://help.openai.com/en/articles/7102672-how-can-i-access-gpt-4",target:"_blank",rel:"noreferrer",children:e.jsx(Vi,{className:"icon-md h-5 w-5 pl-0.5 text-token-text-tertiary"})})]},"header");if(y&&g){const C={id:"modelSection",content:[]};C.content.push(e.jsx(Od,{},"noAuthUpsell")),T.push(C)}else if(l){const C={id:"modelSection",content:[]};i.length&&C.content.push(G);const W=new Map;i.forEach($=>{const K=e.jsx(Mg,{category:$,currentGizmoId:o,currentModelId:a,modelSwitcherDenialsBySlug:h,omitIcon:k,testId:`model-switcher-${$.defaultModel}`},$.categoryId);$.subcategory?(W.has($.subcategory)||W.set($.subcategory,[]),W.get($.subcategory)?.push(K)):C.content.push(K)}),W.forEach(($,K)=>{const O=i.find(se=>se.subcategory===K&&se.defaultModel===n.id);C.content.push(e.jsxs(z.Sub,{children:[e.jsx(z.SubMenuTrigger,{"data-testid":K==="More models"?"more-models-submenu":void 0,children:e.jsxs("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:[K,!!O&&e.jsx("div",{className:"truncate text-token-text-tertiary",children:O.label})]})}),e.jsx(z.Portal,{children:e.jsx(z.SubContent,{className:"min-w-72",children:$})})]},K))}),T.push(C)}else{const C={id:"modelSection",content:[]};C.content.push(e.jsx(Ks,{value:"",onClick:U,modelSwitcherDenialsBySlug:h,isUpgradeUpsell:!0,renderName:W=>e.jsx($n,{icon:Ph,isDisabled:W,name:u.formatMessage({id:"mzDzkX",defaultMessage:"ChatGPT Plus"}),description:u.formatMessage({id:"bqTHri",defaultMessage:"Our smartest model & more"}),omitIcon:!1}),isSelected:!1,showNewChatHint:!1},"plusUpgrade")),C.content.push(e.jsx(Ks,{value:Mn.AUTO,modelSwitcherDenialsBySlug:h,renderName:W=>e.jsx($n,{icon:Nh,name:u.formatMessage({id:"U9E7Rx",defaultMessage:"ChatGPT"}),description:u.formatMessage({id:"n96qML",defaultMessage:"Great for everyday tasks"}),isDisabled:W,omitIcon:!1}),isSelected:!o&&a===Mn.AUTO,showNewChatHint:!0},Mn.AUTO)),T.push(C)}const F={id:"otherOptionsSection",content:[]},{selectedCategory:R}=mr(a,i,r);return m&&(D&&F.content.push(e.jsx(es,{isSelected:R===Qe.ALPHA,currentModel:n,option:x,modelSwitcherDenialsBySlug:h,displayInFull_INTERNAL_USE_ONLY:!0},x.value)),N&&F.content.push(e.jsx(es,{isSelected:R===Qe.DATA_CAMPAIGNS,currentModel:n,option:j,modelSwitcherDenialsBySlug:h,displayInFull_INTERNAL_USE_ONLY:!0},j.value)),M&&F.content.push(e.jsx(es,{currentModel:n,isSelected:R===Qe.EXPERIMENTS,option:S,modelSwitcherDenialsBySlug:h,displayInFull_INTERNAL_USE_ONLY:!0},S.value)),w&&F.content.push(e.jsx(es,{isSelected:R===Qe.MAINLINE,currentModel:n,option:v,modelSwitcherDenialsBySlug:h,displayInFull_INTERNAL_USE_ONLY:!0},v.value))),F.content.length&&T.push(F),g||T.push({id:"temporaryChatSection",content:[e.jsx(yg,{clientThreadId:t},"tempChat")]}),T}function kg(){const t=ee();return e.jsx("div",{className:"border-token-text-quartenary items-center rounded-full border px-1 py-0.5 text-[8px] font-semibold uppercase leading-3 text-token-text-secondary dark:border-token-border-heavy dark:text-token-text-tertiary",children:t.formatMessage(gr.beta)})}function $n({isDisabled:t,name:s,icon:n,categoryId:a,description:o,extra:i,omitIcon:r,isBeta:l=!1}){let c=s;return l&&(c=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),e.jsx(kg,{})]})),e.jsxs("div",{className:"flex items-center gap-3",children:[!r&&e.jsx("span",{className:"flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-full bg-token-main-surface-secondary",children:n?e.jsx(n,{className:"h-4 w-4 text-token-text-primary"}):a&&e.jsx(_i,{type:"filled",className:A("h-4 w-4",t&&"text-gray-300",!t&&"text-token-text-primary"),categoryId:a})}),e.jsxs("div",{children:[c,e.jsxs("div",{className:A(!t&&"text-token-text-secondary","text-xs"),children:[o,i]})]})]})}function _g({sections:t}){return e.jsx(e.Fragment,{children:t.map((s,n)=>e.jsxs($o.Fragment,{children:[n!==0?e.jsx(z.Separator,{}):null,s.content]},s.id))})}function Tg({clientThreadId:t,inMobileHeader:s=!1}){const n=Ue(t);return n==null?e.jsx(jg,{clientThreadId:t,inMobileHeader:s}):e.jsx(bg,{clientThreadId:t,gizmoId:n,inMobileHeader:s})}const gr=be({beta:{id:"XZwFET",defaultMessage:"Beta"},gpt35ShortExplainer:{defaultMessage:"Great for everyday tasks",id:"ModelSwitcher.gpt35ShortExplainer"},modelTunerSmartSelectionTitle:{id:"czjW8I",defaultMessage:"Dynamic"},modelTunerSmartSelectionExplainer:{id:"gp/YH1",defaultMessage:"Optimized for speed and intelligence"},gpt4ShortExplainer:{defaultMessage:"With DALL·E, browsing and analysis",id:"ModelSwitcher.gpt4ShortExplainer"},gpt4ShortExplainerWithoutBrowse:{defaultMessage:"With DALL·E and analysis",id:"ModelSwitcher.gpt4ShortExplainerWithoutBrowse"},gpt4UpsellExplainer:{id:"ModelSwitcher.gpt4Upsell",defaultMessage:"Our smartest and most capable model. Includes DALL·E, browsing and more."},userUpgrade:{id:"ModelSwithcer.upgradeButton",defaultMessage:"Upgrade to Plus"},userUpgradeSignup:{id:"ModelSwitcher.signupUpgradeButton",defaultMessage:"Sign up for ChatGPT Plus"},temporaryChat:{id:"ModelSwitcher.temporaryChat",defaultMessage:"Temporary chat"},shareChat:{id:"ModelSwitcher.shareChat",defaultMessage:"Share chat"}}),Ag=Pt(()=>It(()=>import("./h50zu6s2u2uacmov.js"),__vite__mapDeps([47,1,2,3,48,49,4,5,50,51,7,43,52,11,6,8,9,10,12,53])).then(t=>t.GizmoUsingAsOwnerNotice)),Eg=({clientThreadId:t})=>{const s=xi(h=>h.activeStageSidebar),n=Q.getServerThreadId(t),a=Hd(ns.WorkspaceShareLinks),{isUnauthenticated:o}=ze(),i=Ft(),r=a&&n&&!o&&!i,l=Ye(),c=!s&&!l;return e.jsx("div",{className:"flex items-center gap-2 pr-1 leading-[0]",children:e.jsx(Qh,{showShareButton:r,showProfileDropdown:c,clientThreadId:t})})};function Ng({clientThreadId:t,gizmoId:s}){const n=Gd(),{data:a}=ms(s),o=hs();return e.jsxs(e.Fragment,{children:[e.jsxs(Wd,{className:"max-md:hidden",children:[e.jsxs("div",{className:"absolute start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2",children:[a!=null&&o?.isWorkspaceAccount()&&a.gizmo.tags?.includes(la.WorkspaceDisabled)&&e.jsx(Ag,{gizmo:a}),e.jsx(Vd,{gizmoId:s,clientThreadId:t})]}),e.jsx(qd,{children:e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden",children:[e.jsx(Zh,{clientThreadId:t}),e.jsx(Tg,{clientThreadId:t})]})}),e.jsx(Eg,{clientThreadId:t})]}),n&&e.jsx($d,{})]})}function pr({clientThreadId:t}){const s=Ue(t),n=ca(),a=Ye();return n||a?null:e.jsx(Ng,{gizmoId:s,clientThreadId:t})}function Rg({clientThreadId:t,currentModelId:s,isModelLoaded:n,onRequestCompletion:a,enableV2Homepage:o,v2HomepageDisclaimer:i}){const r=Ft();let l=e.jsx(nm,{}),c;return r?(c=e.jsx(Pg,{}),l=e.jsx(us,{className:"mb-6 h-12 w-12"})):t!=null?(c=o?e.jsx(rg,{clientThreadId:t,currentModelId:s,isModelLoaded:n,onRequestCompletion:a,v2HomepageDisclaimer:i}):e.jsx(am,{clientThreadId:t}),l=null):c=e.jsx(Ig,{}),e.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-token-text-primary",children:[l,c]})}function Pg({gizmo:t}){const s=Xd(),n=t?Qd(t.tools):!1,a=hs();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-5 text-2xl font-semibold","data-testid":"temporary-chat-label",children:[e.jsx(Zd,{id:"temporary-chat-checkbox",name:"temporary-chat-checkbox",checked:!0}),e.jsx(P,{...ut.temporaryChat})]}),e.jsxs("div",{className:"max-w-sm text-center text-sm font-normal text-token-text-tertiary",children:[e.jsx(P,{...a?.isWorkspaceAccount()?s?ut.temporaryChatBizMemoryAvailable:ut.temporaryChatBizMemoryUnavailable:s?ut.temporaryChatDescriptionMemoryAvailable:ut.temporaryChatDescriptionMemoryUnavailable}),n&&e.jsx("div",{className:"mt-3",children:e.jsx(P,{...ut.temporaryChatDescriptionGptActions,values:{link:o=>e.jsx("a",{href:"https://help.openai.com/en/articles/8914046-temporary-chat-faq",target:"_blank",className:"underline",rel:"noreferrer",children:o})}})})]})]})}function Ig(){return e.jsx("div",{className:"mb-5 text-2xl font-semibold",children:e.jsx(P,{...ut.howCanIHelpYouToday})})}function Dg({clientThreadId:t,currentModelId:s,isModelLoaded:n,onRequestCompletion:a,enableV2Homepage:o,v2HomepageDisclaimer:i}){const r=Ue(t),l=Kd(),c=Qn(),{data:h}=ms(r),u=Yd(),m=ol(()=>navigator.windowControlsOverlay);return(l!=null||r!=null)&&h==null?null:e.jsxs("div",{className:"relative h-full",children:[e.jsx("div",{className:m?.visible?A("absolute right-[calc(100dvw-env(titlebar-area-width,100dvw)-env(titlebar-area-x,0))]",u?"left-[env(titlebar-area-x,0)]":"left-0"):"absolute left-0 right-0",children:e.jsx(pr,{clientThreadId:t})}),h!=null?e.jsx(sm,{gizmo:h,showStarterPrompts:!0,disableStarterPrompts:c}):e.jsx(Rg,{clientThreadId:t,currentModelId:s,isModelLoaded:n,onRequestCompletion:a,enableV2Homepage:o,v2HomepageDisclaimer:i})]})}const ut=be({temporaryChat:{id:"GizmoLanding.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatBizMemoryAvailable:{id:"g1opBW",defaultMessage:"This chat won't appear in your history and won't use or create memories."},temporaryChatBizMemoryUnavailable:{id:"fQmbtG",defaultMessage:"This chat won't appear your conversation history."},temporaryChatDescriptionMemoryAvailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryAvailable",defaultMessage:"This chat won't appear in history, use or create memories, or be used to train our models. For safety purposes, we may keep a copy for up to 30 days."},temporaryChatDescriptionMemoryUnavailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryUnavailable",defaultMessage:"This chat won't appear in history or be used to train our models. For safety purposes, we may keep a copy of this chat for up to 30 days."},temporaryChatDescriptionGptActions:{id:"GizmoLanding.temporaryChatDescriptionGptActions",defaultMessage:"Any data shared with a third party through GPT actions are subject to the third party's privacy policy. <link>Learn more</link>"},howCanIHelpYouToday:{id:"GizmoLanding.howCanIHelpYouToday",defaultMessage:"How can I help you today?"}}),Mt=({modelSwitcherDeny:t,value:s,label:n,subtitle:a,icon:o,onMouseEnter:i,onMouseLeave:r,onSelect:l,messageModelSlug:c,isHovered:h=!1,shouldShowUpsell:u=!1,className:m,includeCheck:g,includeRegenerate:p,justifyIcon:b,wrapIcon:f=!0})=>{const y=hs(),x=!t,j=!x&&!u,S=Js(),v=()=>{if(!u){l?.();return}q.logEvent(H.openModalAccountPaymentfromMessageModelPicker),q.logRateLimitGetPlusButtonClicked({type:Zn.RATE_LIMIT,location:"message_model_switcher_dropdown",plan_type:y?.planType??"unknown",is_hard_block:!1,hard_block_reason:"",is_new_conversation:!1}),ki(S,"Message model switcher dropdown")};return e.jsx(z.Item,{onSelect:v,onMouseEnter:()=>x&&i?.(),onMouseLeave:()=>x&&r?.(),disabled:j,className:m??"radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed radix-disabled:hover:bg-transparent",children:e.jsxs(Dt,{label:t&&e.jsx(Ci,{modelSwitcherDeny:t}),className:"flex w-full items-center justify-between gap-2",sideOffset:0,children:[e.jsxs("div",{className:A("flex items-center gap-3",b==="right"&&"w-full"),children:[!!o&&(f?e.jsx("span",{className:A("flex h-7 w-7 items-center justify-center rounded-full bg-token-main-surface-secondary",b==="right"&&"order-10 ml-auto"),children:o}):o),e.jsxs("div",{children:[e.jsx("div",{children:n}),e.jsx("div",{className:A({"text-sm text-token-text-secondary":!j},{"text-sm text-token-text-quaternary":j}),children:a})]})]}),u?e.jsx(Ve,{color:"secondary",size:"small",children:e.jsx(P,{id:"54fmrA",defaultMessage:"Get Plus"})}):e.jsx(Fg,{messageModelSlug:c,isHovered:h,modelSwitcherDeny:t,optionModelSlug:s,includeCheck:g,includeRegenerate:p})]})})},Fg=({modelSwitcherDeny:t,optionModelSlug:s,isHovered:n,messageModelSlug:a,includeRegenerate:o=!0,includeCheck:i=!0})=>{let r=null;if(t)switch(t.reason){case Zn.RATE_LIMIT:r=Ih;break;default:r=Vi;break}if(t)return e.jsx(r,{className:"icon-md"});const l=!!o&&e.jsx(dn,{className:A("icon-md hidden text-token-text-tertiary",{"group-hover:block":n})});return a===s&&i?e.jsxs(e.Fragment,{children:[e.jsx(Wi,{className:A("icon-md text-token-text-primary",{"group-hover:hidden":n})}),l]}):l};function Lg({className:t,clientThreadId:s,message:n,onModelSelect:a,onDropdownChange:o}){const i=ee(),[r,l]=d.useState(null),[c,h]=d.useState(!1),[u,m]=d.useState(!1),g=Jd(),p=Ti(s),b=Ue(s),f=Ai({clientThreadId:s,message:n}),y=n.message.metadata?.model_slug,{modelOptions:x,modelSlug:j,animateModelLabelOnRender:S,nuxProps:v,messageModelEnabledTools:k}=f,D=Ei(n.message),N=k.includes(tn.Search),M=d.useMemo(()=>x.find(R=>R.value==y),[x,y]),{doesUserHaveAnyAccountsWithPlusFeatures:w}=Qs(),_=d.useRef(null),Y=R=>{R||setTimeout(()=>{_.current&&_.current.blur()},10)};if(d.useEffect(()=>{Y(c)},[c]),!g||b)return null;const U=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:i.formatMessage(po.search),icon:e.jsx(Ss,{className:"icon-sm"}),condition:N&&!D,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:i.formatMessage(po.nosearch),icon:e.jsx(qi,{className:"icon-sm"}),condition:N&&D,eventName:"chatgpt_regenerate_without_search_button_clicked"}];let T,G;v.shouldRenderNux?(T=Bg,G={title:e.jsx(P,{id:"g/+2Hh",defaultMessage:"Optimized your response"}),description:e.jsx(P,{id:"H0Flqm",defaultMessage:"Used {usedModelName} for a faster response that saves your limited {largestModelName} messages",values:{usedModelName:v.usedModelName,largestModelName:v.largestModelName}}),markAsViewed:v.announcement.markAsViewed}):(T=Og,G={label:p?e.jsx(P,{id:"LBYK9a",defaultMessage:"Change model"}):e.jsx(P,{id:"nygjPN",defaultMessage:"Used {modelName}",values:{modelName:v.usedModelName}})});const F=p&&x.some(R=>ds(R,w));return e.jsxs(z.Root,{onOpenChange:R=>{p&&(h(R),o(R),Y(R)),R&&q.logEvent(H.conversationOpenMessageModelSelector,{has_get_plus_button:F})},children:[e.jsx(T,{...G,children:e.jsx(Yi,{ref:_,className:A("cursor-pointer",t),onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),children:e.jsx(Kn,{modelSlug:j,animateModelLabelOnRender:S,isDropdownOpen:c,isRegenerateEnabled:p,isHovered:u})})}),p&&e.jsxs(z.Content,{className:"z-30 origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[x.map(R=>{const C=ds(R,w),{value:W,...$}=R;return e.jsx(Mt,{value:W,onSelect:()=>{ce.logEvent("chatgpt_regenerate_switch_model_button_clicked",W,{requestedModelId:W,...Je({clientThreadId:s})}),a({requestedModelId:W})},onMouseEnter:()=>l(W),onMouseLeave:()=>l(null),isHovered:r===W,messageModelSlug:n.message.metadata?.model_slug,shouldShowUpsell:C,...$},W)}),!!M&&e.jsxs(e.Fragment,{children:[e.jsx(z.Separator,{}),U.filter(R=>R.condition).map(R=>e.jsx(Mt,{onSelect:()=>{ce.logEvent(R.eventName,M.value,{requestedModelId:M.value,...Je({clientThreadId:s})}),a({requestedModelId:M.value,extraStreamParams:R.extraStreamParams})},includeRegenerate:!0,onMouseEnter:()=>l(R.key),onMouseLeave:()=>l(null),isHovered:r===R.key,messageModelSlug:y,includeCheck:!1,...M,label:R.label,subtitle:"",icon:R.icon},R.key))]})]})]})}function Kn({modelSlug:t,animateModelLabelOnRender:s,isDropdownOpen:n,isRegenerateEnabled:a,isHovered:o,isRegenLabel:i=!1,animateShortLabel:r,omitIcon:l}){const[c,h]=d.useState("initial"),{categories:u}=fa({isRegen:!!i});d.useEffect(()=>{if(s){const x=setTimeout(()=>h("show"),500),j=setTimeout(()=>h("initial"),2e3);return()=>{clearTimeout(x),clearTimeout(j)}}h("initial")},[s]);const m=u.find(({defaultModel:x})=>x===t),g=t===eu?{categoryId:"gpt_3.5",shorterLabel:"3.5"}:{},{categoryId:p,shorterLabel:b}=m??g,f={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},y=n?"visible":o?"show":c;return e.jsxs(te.div,{initial:"initial",animate:y,className:"flex items-center pb-0",children:[!l&&(i?e.jsx(dn,{className:"icon-md"}):p&&e.jsx(_i,{type:"outline",categoryId:p,className:"icon-md h-4 w-4"})),(a||r)&&e.jsx(te.span,{className:"overflow-hidden text-clip whitespace-nowrap text-sm",variants:f,transition:{type:"tween",duration:.18},children:b}),a&&e.jsx(xa,{className:A("icon-sm",{"text-token-text-quaternary":!o&&!i},{"text-token-text-secondary":o&&!i})})]})}function Og({children:t,label:s}){return e.jsx(Dt,{label:s,sideOffset:0,children:t})}function Bg({children:t,title:s,description:n,markAsViewed:a}){return e.jsx(ci,{show:!0,side:"bottom",sideOffset:-4,title:s,description:n,badge:"beta",onDismiss:a,dismissOnOutsideClick:!0,children:t})}function ds(t,s){const{modelSwitcherDeny:n,subscriptionLevel:a}=t;return!!n&&n.reason===Zn.RATE_LIMIT&&a===il.PLUS&&!s}const po=be({search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),zg=d.memo(Lg),bt=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,xr=new Set,Yn=typeof process=="object"&&process?process:{},Sr=(t,s,n,a)=>{typeof Yn.emitWarning=="function"?Yn.emitWarning(t,s,n,a):console.error(`[${n}] ${s}: ${t}`)};let Ys=globalThis.AbortController,xo=globalThis.AbortSignal;if(typeof Ys>"u"){xo=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(a,o){this._onabort.push(o)}},Ys=class{constructor(){s()}signal=new xo;abort(a){if(!this.signal.aborted){this.signal.reason=a,this.signal.aborted=!0;for(const o of this.signal._onabort)o(a);this.signal.onabort?.(a)}}};let t=Yn.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1";const s=()=>{t&&(t=!1,Sr("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",s))}}const Ug=t=>!xr.has(t),Ze=t=>t&&t===Math.floor(t)&&t>0&&isFinite(t),vr=t=>Ze(t)?t<=Math.pow(2,8)?Uint8Array:t<=Math.pow(2,16)?Uint16Array:t<=Math.pow(2,32)?Uint32Array:t<=Number.MAX_SAFE_INTEGER?Us:null:null;class Us extends Array{constructor(s){super(s),this.fill(0)}}class Ct{heap;length;static#l=!1;static create(s){const n=vr(s);if(!n)return[];Ct.#l=!0;const a=new Ct(s,n);return Ct.#l=!1,a}constructor(s,n){if(!Ct.#l)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new n(s),this.length=0}push(s){this.heap[this.length++]=s}pop(){return this.heap[--this.length]}}class wa{#l;#u;#g;#p;#A;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#a;#x;#n;#s;#e;#c;#h;#r;#o;#S;#i;#v;#b;#m;#y;#C;#d;static unsafeExposeInternals(s){return{starts:s.#b,ttls:s.#m,sizes:s.#v,keyMap:s.#n,keyList:s.#s,valList:s.#e,next:s.#c,prev:s.#h,get head(){return s.#r},get tail(){return s.#o},free:s.#S,isBackgroundFetch:n=>s.#t(n),backgroundFetch:(n,a,o,i)=>s.#R(n,a,o,i),moveToTail:n=>s.#T(n),indexes:n=>s.#w(n),rindexes:n=>s.#j(n),isStale:n=>s.#f(n)}}get max(){return this.#l}get maxSize(){return this.#u}get calculatedSize(){return this.#x}get size(){return this.#a}get fetchMethod(){return this.#A}get dispose(){return this.#g}get disposeAfter(){return this.#p}constructor(s){const{max:n=0,ttl:a,ttlResolution:o=1,ttlAutopurge:i,updateAgeOnGet:r,updateAgeOnHas:l,allowStale:c,dispose:h,disposeAfter:u,noDisposeOnSet:m,noUpdateTTL:g,maxSize:p=0,maxEntrySize:b=0,sizeCalculation:f,fetchMethod:y,noDeleteOnFetchRejection:x,noDeleteOnStaleGet:j,allowStaleOnFetchRejection:S,allowStaleOnFetchAbort:v,ignoreFetchAbort:k}=s;if(n!==0&&!Ze(n))throw new TypeError("max option must be a nonnegative integer");const D=n?vr(n):Array;if(!D)throw new Error("invalid max value: "+n);if(this.#l=n,this.#u=p,this.maxEntrySize=b||this.#u,this.sizeCalculation=f,this.sizeCalculation){if(!this.#u&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(y!==void 0&&typeof y!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#A=y,this.#C=!!y,this.#n=new Map,this.#s=new Array(n).fill(void 0),this.#e=new Array(n).fill(void 0),this.#c=new D(n),this.#h=new D(n),this.#r=0,this.#o=0,this.#S=Ct.create(n),this.#a=0,this.#x=0,typeof h=="function"&&(this.#g=h),typeof u=="function"?(this.#p=u,this.#i=[]):(this.#p=void 0,this.#i=void 0),this.#y=!!this.#g,this.#d=!!this.#p,this.noDisposeOnSet=!!m,this.noUpdateTTL=!!g,this.noDeleteOnFetchRejection=!!x,this.allowStaleOnFetchRejection=!!S,this.allowStaleOnFetchAbort=!!v,this.ignoreFetchAbort=!!k,this.maxEntrySize!==0){if(this.#u!==0&&!Ze(this.#u))throw new TypeError("maxSize must be a positive integer if specified");if(!Ze(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#O()}if(this.allowStale=!!c,this.noDeleteOnStaleGet=!!j,this.updateAgeOnGet=!!r,this.updateAgeOnHas=!!l,this.ttlResolution=Ze(o)||o===0?o:1,this.ttlAutopurge=!!i,this.ttl=a||0,this.ttl){if(!Ze(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#P()}if(this.#l===0&&this.ttl===0&&this.#u===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#l&&!this.#u){const N="LRU_CACHE_UNBOUNDED";Ug(N)&&(xr.add(N),Sr("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",N,wa))}}getRemainingTTL(s){return this.#n.has(s)?1/0:0}#P(){const s=new Us(this.#l),n=new Us(this.#l);this.#m=s,this.#b=n,this.#I=(i,r,l=bt.now())=>{if(n[i]=r!==0?l:0,s[i]=r,r!==0&&this.ttlAutopurge){const c=setTimeout(()=>{this.#f(i)&&this.delete(this.#s[i])},r+1);c.unref&&c.unref()}},this.#k=i=>{n[i]=s[i]!==0?bt.now():0},this.#M=(i,r)=>{if(s[r]){const l=s[r],c=n[r];if(!l||!c)return;i.ttl=l,i.start=c,i.now=a||o();const h=i.now-c;i.remainingTTL=l-h}};let a=0;const o=()=>{const i=bt.now();if(this.ttlResolution>0){a=i;const r=setTimeout(()=>a=0,this.ttlResolution);r.unref&&r.unref()}return i};this.getRemainingTTL=i=>{const r=this.#n.get(i);if(r===void 0)return 0;const l=s[r],c=n[r];if(!l||!c)return 1/0;const h=(a||o())-c;return l-h},this.#f=i=>{const r=n[i],l=s[i];return!!l&&!!r&&(a||o())-r>l}}#k=()=>{};#M=()=>{};#I=()=>{};#f=()=>!1;#O(){const s=new Us(this.#l);this.#x=0,this.#v=s,this.#_=n=>{this.#x-=s[n],s[n]=0},this.#D=(n,a,o,i)=>{if(this.#t(a))return 0;if(!Ze(o))if(i){if(typeof i!="function")throw new TypeError("sizeCalculation must be a function");if(o=i(a,n),!Ze(o))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return o},this.#E=(n,a,o)=>{if(s[n]=a,this.#u){const i=this.#u-s[n];for(;this.#x>i;)this.#N(!0)}this.#x+=s[n],o&&(o.entrySize=a,o.totalCalculatedSize=this.#x)}}#_=s=>{};#E=(s,n,a)=>{};#D=(s,n,a,o)=>{if(a||o)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#w({allowStale:s=this.allowStale}={}){if(this.#a)for(let n=this.#o;!(!this.#F(n)||((s||!this.#f(n))&&(yield n),n===this.#r));)n=this.#h[n]}*#j({allowStale:s=this.allowStale}={}){if(this.#a)for(let n=this.#r;!(!this.#F(n)||((s||!this.#f(n))&&(yield n),n===this.#o));)n=this.#c[n]}#F(s){return s!==void 0&&this.#n.get(this.#s[s])===s}*entries(){for(const s of this.#w())this.#e[s]!==void 0&&this.#s[s]!==void 0&&!this.#t(this.#e[s])&&(yield[this.#s[s],this.#e[s]])}*rentries(){for(const s of this.#j())this.#e[s]!==void 0&&this.#s[s]!==void 0&&!this.#t(this.#e[s])&&(yield[this.#s[s],this.#e[s]])}*keys(){for(const s of this.#w()){const n=this.#s[s];n!==void 0&&!this.#t(this.#e[s])&&(yield n)}}*rkeys(){for(const s of this.#j()){const n=this.#s[s];n!==void 0&&!this.#t(this.#e[s])&&(yield n)}}*values(){for(const s of this.#w())this.#e[s]!==void 0&&!this.#t(this.#e[s])&&(yield this.#e[s])}*rvalues(){for(const s of this.#j())this.#e[s]!==void 0&&!this.#t(this.#e[s])&&(yield this.#e[s])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(s,n={}){for(const a of this.#w()){const o=this.#e[a],i=this.#t(o)?o.__staleWhileFetching:o;if(i!==void 0&&s(i,this.#s[a],this))return this.get(this.#s[a],n)}}forEach(s,n=this){for(const a of this.#w()){const o=this.#e[a],i=this.#t(o)?o.__staleWhileFetching:o;i!==void 0&&s.call(n,i,this.#s[a],this)}}rforEach(s,n=this){for(const a of this.#j()){const o=this.#e[a],i=this.#t(o)?o.__staleWhileFetching:o;i!==void 0&&s.call(n,i,this.#s[a],this)}}purgeStale(){let s=!1;for(const n of this.#j({allowStale:!0}))this.#f(n)&&(this.delete(this.#s[n]),s=!0);return s}info(s){const n=this.#n.get(s);if(n===void 0)return;const a=this.#e[n],o=this.#t(a)?a.__staleWhileFetching:a;if(o===void 0)return;const i={value:o};if(this.#m&&this.#b){const r=this.#m[n],l=this.#b[n];if(r&&l){const c=r-(bt.now()-l);i.ttl=c,i.start=Date.now()}}return this.#v&&(i.size=this.#v[n]),i}dump(){const s=[];for(const n of this.#w({allowStale:!0})){const a=this.#s[n],o=this.#e[n],i=this.#t(o)?o.__staleWhileFetching:o;if(i===void 0||a===void 0)continue;const r={value:i};if(this.#m&&this.#b){r.ttl=this.#m[n];const l=bt.now()-this.#b[n];r.start=Math.floor(Date.now()-l)}this.#v&&(r.size=this.#v[n]),s.unshift([a,r])}return s}load(s){this.clear();for(const[n,a]of s){if(a.start){const o=Date.now()-a.start;a.start=bt.now()-o}this.set(n,a.value,a)}}set(s,n,a={}){if(n===void 0)return this.delete(s),this;const{ttl:o=this.ttl,start:i,noDisposeOnSet:r=this.noDisposeOnSet,sizeCalculation:l=this.sizeCalculation,status:c}=a;let{noUpdateTTL:h=this.noUpdateTTL}=a;const u=this.#D(s,n,a.size||0,l);if(this.maxEntrySize&&u>this.maxEntrySize)return c&&(c.set="miss",c.maxEntrySizeExceeded=!0),this.delete(s),this;let m=this.#a===0?void 0:this.#n.get(s);if(m===void 0)m=this.#a===0?this.#o:this.#S.length!==0?this.#S.pop():this.#a===this.#l?this.#N(!1):this.#a,this.#s[m]=s,this.#e[m]=n,this.#n.set(s,m),this.#c[this.#o]=m,this.#h[m]=this.#o,this.#o=m,this.#a++,this.#E(m,u,c),c&&(c.set="add"),h=!1;else{this.#T(m);const g=this.#e[m];if(n!==g){if(this.#C&&this.#t(g)){g.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:p}=g;p!==void 0&&!r&&(this.#y&&this.#g?.(p,s,"set"),this.#d&&this.#i?.push([p,s,"set"]))}else r||(this.#y&&this.#g?.(g,s,"set"),this.#d&&this.#i?.push([g,s,"set"]));if(this.#_(m),this.#E(m,u,c),this.#e[m]=n,c){c.set="replace";const p=g&&this.#t(g)?g.__staleWhileFetching:g;p!==void 0&&(c.oldValue=p)}}else c&&(c.set="update")}if(o!==0&&!this.#m&&this.#P(),this.#m&&(h||this.#I(m,o,i),c&&this.#M(c,m)),!r&&this.#d&&this.#i){const g=this.#i;let p;for(;p=g?.shift();)this.#p?.(...p)}return this}pop(){try{for(;this.#a;){const s=this.#e[this.#r];if(this.#N(!0),this.#t(s)){if(s.__staleWhileFetching)return s.__staleWhileFetching}else if(s!==void 0)return s}}finally{if(this.#d&&this.#i){const s=this.#i;let n;for(;n=s?.shift();)this.#p?.(...n)}}}#N(s){const n=this.#r,a=this.#s[n],o=this.#e[n];return this.#C&&this.#t(o)?o.__abortController.abort(new Error("evicted")):(this.#y||this.#d)&&(this.#y&&this.#g?.(o,a,"evict"),this.#d&&this.#i?.push([o,a,"evict"])),this.#_(n),s&&(this.#s[n]=void 0,this.#e[n]=void 0,this.#S.push(n)),this.#a===1?(this.#r=this.#o=0,this.#S.length=0):this.#r=this.#c[n],this.#n.delete(a),this.#a--,n}has(s,n={}){const{updateAgeOnHas:a=this.updateAgeOnHas,status:o}=n,i=this.#n.get(s);if(i!==void 0){const r=this.#e[i];if(this.#t(r)&&r.__staleWhileFetching===void 0)return!1;if(this.#f(i))o&&(o.has="stale",this.#M(o,i));else return a&&this.#k(i),o&&(o.has="hit",this.#M(o,i)),!0}else o&&(o.has="miss");return!1}peek(s,n={}){const{allowStale:a=this.allowStale}=n,o=this.#n.get(s);if(o===void 0||!a&&this.#f(o))return;const i=this.#e[o];return this.#t(i)?i.__staleWhileFetching:i}#R(s,n,a,o){const i=n===void 0?void 0:this.#e[n];if(this.#t(i))return i;const r=new Ys,{signal:l}=a;l?.addEventListener("abort",()=>r.abort(l.reason),{signal:r.signal});const c={signal:r.signal,options:a,context:o},h=(f,y=!1)=>{const{aborted:x}=r.signal,j=a.ignoreFetchAbort&&f!==void 0;if(a.status&&(x&&!y?(a.status.fetchAborted=!0,a.status.fetchError=r.signal.reason,j&&(a.status.fetchAbortIgnored=!0)):a.status.fetchResolved=!0),x&&!j&&!y)return m(r.signal.reason);const S=p;return this.#e[n]===p&&(f===void 0?S.__staleWhileFetching?this.#e[n]=S.__staleWhileFetching:this.delete(s):(a.status&&(a.status.fetchUpdated=!0),this.set(s,f,c.options))),f},u=f=>(a.status&&(a.status.fetchRejected=!0,a.status.fetchError=f),m(f)),m=f=>{const{aborted:y}=r.signal,x=y&&a.allowStaleOnFetchAbort,j=x||a.allowStaleOnFetchRejection,S=j||a.noDeleteOnFetchRejection,v=p;if(this.#e[n]===p&&(!S||v.__staleWhileFetching===void 0?this.delete(s):x||(this.#e[n]=v.__staleWhileFetching)),j)return a.status&&v.__staleWhileFetching!==void 0&&(a.status.returnedStale=!0),v.__staleWhileFetching;if(v.__returned===v)throw f},g=(f,y)=>{const x=this.#A?.(s,i,c);x&&x instanceof Promise&&x.then(j=>f(j===void 0?void 0:j),y),r.signal.addEventListener("abort",()=>{(!a.ignoreFetchAbort||a.allowStaleOnFetchAbort)&&(f(void 0),a.allowStaleOnFetchAbort&&(f=j=>h(j,!0)))})};a.status&&(a.status.fetchDispatched=!0);const p=new Promise(g).then(h,u),b=Object.assign(p,{__abortController:r,__staleWhileFetching:i,__returned:void 0});return n===void 0?(this.set(s,b,{...c.options,status:void 0}),n=this.#n.get(s)):this.#e[n]=b,b}#t(s){if(!this.#C)return!1;const n=s;return!!n&&n instanceof Promise&&n.hasOwnProperty("__staleWhileFetching")&&n.__abortController instanceof Ys}async fetch(s,n={}){const{allowStale:a=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,ttl:r=this.ttl,noDisposeOnSet:l=this.noDisposeOnSet,size:c=0,sizeCalculation:h=this.sizeCalculation,noUpdateTTL:u=this.noUpdateTTL,noDeleteOnFetchRejection:m=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:g=this.allowStaleOnFetchRejection,ignoreFetchAbort:p=this.ignoreFetchAbort,allowStaleOnFetchAbort:b=this.allowStaleOnFetchAbort,context:f,forceRefresh:y=!1,status:x,signal:j}=n;if(!this.#C)return x&&(x.fetch="get"),this.get(s,{allowStale:a,updateAgeOnGet:o,noDeleteOnStaleGet:i,status:x});const S={allowStale:a,updateAgeOnGet:o,noDeleteOnStaleGet:i,ttl:r,noDisposeOnSet:l,size:c,sizeCalculation:h,noUpdateTTL:u,noDeleteOnFetchRejection:m,allowStaleOnFetchRejection:g,allowStaleOnFetchAbort:b,ignoreFetchAbort:p,status:x,signal:j};let v=this.#n.get(s);if(v===void 0){x&&(x.fetch="miss");const k=this.#R(s,v,S,f);return k.__returned=k}else{const k=this.#e[v];if(this.#t(k)){const _=a&&k.__staleWhileFetching!==void 0;return x&&(x.fetch="inflight",_&&(x.returnedStale=!0)),_?k.__staleWhileFetching:k.__returned=k}const D=this.#f(v);if(!y&&!D)return x&&(x.fetch="hit"),this.#T(v),o&&this.#k(v),x&&this.#M(x,v),k;const N=this.#R(s,v,S,f),w=N.__staleWhileFetching!==void 0&&a;return x&&(x.fetch=D?"stale":"refresh",w&&D&&(x.returnedStale=!0)),w?N.__staleWhileFetching:N.__returned=N}}get(s,n={}){const{allowStale:a=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,status:r}=n,l=this.#n.get(s);if(l!==void 0){const c=this.#e[l],h=this.#t(c);return r&&this.#M(r,l),this.#f(l)?(r&&(r.get="stale"),h?(r&&a&&c.__staleWhileFetching!==void 0&&(r.returnedStale=!0),a?c.__staleWhileFetching:void 0):(i||this.delete(s),r&&a&&(r.returnedStale=!0),a?c:void 0)):(r&&(r.get="hit"),h?c.__staleWhileFetching:(this.#T(l),o&&this.#k(l),c))}else r&&(r.get="miss")}#L(s,n){this.#h[n]=s,this.#c[s]=n}#T(s){s!==this.#o&&(s===this.#r?this.#r=this.#c[s]:this.#L(this.#h[s],this.#c[s]),this.#L(this.#o,s),this.#o=s)}delete(s){let n=!1;if(this.#a!==0){const a=this.#n.get(s);if(a!==void 0)if(n=!0,this.#a===1)this.clear();else{this.#_(a);const o=this.#e[a];if(this.#t(o)?o.__abortController.abort(new Error("deleted")):(this.#y||this.#d)&&(this.#y&&this.#g?.(o,s,"delete"),this.#d&&this.#i?.push([o,s,"delete"])),this.#n.delete(s),this.#s[a]=void 0,this.#e[a]=void 0,a===this.#o)this.#o=this.#h[a];else if(a===this.#r)this.#r=this.#c[a];else{const i=this.#h[a];this.#c[i]=this.#c[a];const r=this.#c[a];this.#h[r]=this.#h[a]}this.#a--,this.#S.push(a)}}if(this.#d&&this.#i?.length){const a=this.#i;let o;for(;o=a?.shift();)this.#p?.(...o)}return n}clear(){for(const s of this.#j({allowStale:!0})){const n=this.#e[s];if(this.#t(n))n.__abortController.abort(new Error("deleted"));else{const a=this.#s[s];this.#y&&this.#g?.(n,a,"delete"),this.#d&&this.#i?.push([n,a,"delete"])}}if(this.#n.clear(),this.#e.fill(void 0),this.#s.fill(void 0),this.#m&&this.#b&&(this.#m.fill(0),this.#b.fill(0)),this.#v&&this.#v.fill(0),this.#r=0,this.#o=0,this.#S.length=0,this.#x=0,this.#a=0,this.#d&&this.#i){const s=this.#i;let n;for(;n=s?.shift();)this.#p?.(...n)}}}function Hg({conversationId:t,messageId:s}){const[n,a]=d.useState(!1),o=d.useRef({isMediaSourceAvailable:ja(),mediaSourceFormat:Ma()??"n/a",playPromise:null,shouldAbortQueuedPlayback:!1}).current,i=ee(),r=Rt(),{voiceName:l}=tu(),c=`${t}.${s}.${l}`,h=rl(),u=ll(f=>f.isPlaying&&f.sourceUrl===Be.get(c)?.src),m=d.useCallback(async()=>{if(!h)return;a(!0);const f={isMediaSourceAvailable:o.isMediaSourceAvailable,format:o.mediaSourceFormat};try{const y=await Gg({key:c,message_id:s,conversation_id:t,voice:l,onStreamingError:x=>{ts.readAloud.error(x,f),a(!1),r.danger(i.formatMessage(So.playbackError,{error:x.message}))},onStreamingStart:()=>{a(!1)}});if(o.shouldAbortQueuedPlayback){o.shouldAbortQueuedPlayback=!1;return}h.changeSource(y),o.playPromise=h.play()}catch(y){ts.readAloud.error(y,f),a(!1),r.danger(i.formatMessage(So.playbackError,{error:y.message}))}},[h,o,c,s,t,l,r,i]),g=d.useCallback(()=>{const f=Ua();f&&(o.playPromise?o.playPromise.then(()=>{f.stop(),o.playPromise=null}):f.stop())},[o]),p=d.useCallback(()=>{const f=Ua();f&&(f.state.isPlaying&&f.state.sourceUrl===Be.get(c)?.src?g():(ts.readAloud.click({isMediaSourceAvailable:o.isMediaSourceAvailable,format:o.mediaSourceFormat}),m()))},[c,o,m,g]);d.useEffect(()=>{n&&u&&a(!1)},[n,u]);const b=d.useRef(c);return d.useEffect(()=>{b.current=c}),d.useEffect(()=>(o.shouldAbortQueuedPlayback=!1,()=>{const f=cl();f.isPlaying&&f.sourceUrl===Be.get(b.current)?.src?g():o.shouldAbortQueuedPlayback=!0}),[o,g]),{togglePlayback:p,isPlaying:u,isLoading:n}}async function br({message_id:t,conversation_id:s,voice:n}){const a=await Ke.synthesize({message_id:t,conversation_id:s,voice:n,format:Ma()}),o=a.headers.get("content-type")??"audio/aac";return{response:a,format:o}}async function Gg(t){return ja()?Vg(t):Wg(t)}async function Wg({key:t,...s}){const n=Be.get(t);if(n?.blob)return n.src;const{response:a,format:o}=await br(s),i=await a.arrayBuffer(),r=new Blob([i],{type:o}),l=yr({key:t,src:URL.createObjectURL(r),format:o,blob:r});return Be.set(t,l),l.src}async function Vg({key:t,onStreamingError:s,onStreamingStart:n,...a}){let o=Be.get(t);o?.streaming&&(Be.delete(t),o=void 0);let i,r;const l=$g(),c=new l;if(o)i=o,i.src=URL.createObjectURL(c);else{const{format:m,response:g}=await br(a);r=g,i=yr({key:t,src:URL.createObjectURL(c),format:m})}const h=qg(i.id),u={sourceopen:async()=>{h("sourceopen");const m=c.addSourceBuffer(i.format),g=async()=>{m.updating&&await new Promise(p=>m.addEventListener("updateend",p,{once:!0}))};if(i.segments.length&&!i.streaming){h("streaming from cache"),i.streaming=!0,n();for(const p of i.segments)m.appendBuffer(p),await g();c.readyState==="open"&&c.endOfStream(),i.streaming=!1,h("done streaming from cache");return}if(r){h("fetching audio");try{const p=r.body?.getReader();if(!p)return;for(;Be.get(t)?.id===i.id;){const{done:b,value:f}=await p.read();if(b){h("done streaming"),i.streaming=!1,c.readyState==="open"&&c.endOfStream();break}if(!Array.from(c.sourceBuffers).includes(m)){h("stop streaming, source buffer removed"),i.streaming=!1;break}i.streaming||(h("start streaming"),i.streaming=!0,n()),m.appendBuffer(f),i.segments.push(f),await g()}}catch(p){if(h("error while streaming",p),i.streaming=!1,c.readyState==="open")try{c.endOfStream("network")}catch(b){ts.readAloud.error(b)}Be.delete(t),s(p)}}},sourceclose:()=>{h("sourceclose"),i.streaming&&(i.streaming=!1,Be.get(t)?.id===i.id&&(h("sourceclosed while streaming, cleaning up cache"),Be.delete(t)))},sourceended:wt};for(const[m,g]of Object.entries(u))c.addEventListener(m,()=>{try{return g()}catch(p){ts.readAloud.error(p)}});return Be.set(t,i),i.src}const So=be({playbackError:{id:"useVoiceReadAloudAudio.playbackError",defaultMessage:"Failed to play message"}}),qg=t=>wt;function $g(){return ja()?window.MediaSource:null}function ja(){return!!Ma()}function Ma(){if("MediaSource"in window){const t=s=>dl(s)&&MediaSource.isTypeSupported(s);if(t("audio/aac"))return"aac";if(t("audio/mpeg"))return"mp3";if(t("audio/ogg"))return"ogg"}}const yr=t=>({id:qo(),segments:[],streaming:!1,...t}),Be=new wa({max:50,dispose:t=>{URL.revokeObjectURL(t.src)}}),Kg=d.memo(function(s){const n=_t("1923022511")?.value,a=gs(s.conversationId),{errCode:o}=pa(s.message);if(!n||!a||o)return null;const i=Ni.getAudioAssetPointers(s.message.message)[0];return i?e.jsx(Yg,{audioAssetPointer:i,conversationId:a}):e.jsx(Xg,{...s,conversationId:a})});function Yg({audioAssetPointer:t,conversationId:s}){const{isLoading:n,isPlaying:a,togglePlayback:o}=su({audioAssetPointer:t,conversationId:s});return e.jsx(wr,{onClick:o,isPlaying:a,isLoading:n,playText:Xs.replay,playIcon:Dh})}function Xg({conversationId:t,message:s}){const{isLoading:n,isPlaying:a,togglePlayback:o}=Hg({conversationId:t,messageId:s.message.id});return e.jsx(wr,{onClick:o,isPlaying:a,isLoading:n,playText:Xs.play,playIcon:Fh})}function wr({onClick:t,isPlaying:s,isLoading:n,playText:a,playIcon:o}){let i,r;const l=ee();return n?(i=zo,r=Xs.loading):s?(i=Lh,r=Xs.stop):(i=o,r=a),e.jsx(Qt,{icon:i,label:r?l.formatMessage(r):void 0,disabled:n,onClick:t,style:s||n?{visibility:"visible"}:void 0,testId:"voice-play-turn-action-button"})}const Xs={replay:{id:"VoiceReadOutLoudButton.replay",defaultMessage:"Replay",description:"The tooltip for the replay button"},play:{id:"VoiceReadOutLoudButton.play",defaultMessage:"Read aloud",description:"The tooltip for the read aloud button"},stop:{id:"VoiceReadOutLoudButton.stop",defaultMessage:"Stop",description:"The tooltip for the stop button"},loading:{id:"VoiceReadOutLoudButton.loading",defaultMessage:"Loading",description:"The tooltip for the spinner"}},Os="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function Qg({className:t,clientThreadId:s,message:n,onModelSelect:a,onDropdownChange:o,canRegenerateResponse:i}){const r=Ne("566128514").value,[l,c]=d.useState(null),[h,u]=d.useState(!1),[m,g]=d.useState(!1),p=Ue(s),b=Ai({clientThreadId:s,message:n}),f=n.message.metadata?.model_slug,y=n.message.id,{modelOptions:x,modelSlug:j,animateModelLabelOnRender:S,messageModelEnabledTools:v}=b,k=Ei(n.message),D=v.includes(tn.Search),N=d.useMemo(()=>x.find(T=>T.value===f),[x,f]),M=d.useRef(null),{doesUserHaveAnyAccountsWithPlusFeatures:w}=Qs(),_=T=>{T||setTimeout(()=>{M.current&&M.current.blur()},10)};if(d.useEffect(()=>{_(h)},[h]),nu(s))return null;const U=i&&x.some(T=>ds(T,w));return p?null:e.jsxs(z.Root,{onOpenChange:T=>{i&&(u(T),o(T),_(T)),T&&q.logEvent(H.conversationOpenMessageModelSelector,{has_get_plus_button:U,is_new_regen_dropdown:!0})},children:[i?e.jsx(Jg,{label:e.jsx(P,{id:"wDs5sz",defaultMessage:"Switch model"}),children:e.jsx(Yi,{ref:M,className:A("cursor-pointer",t),onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:e.jsx(Kn,{modelSlug:j,animateModelLabelOnRender:S,isDropdownOpen:h,isRegenerateEnabled:i,isHovered:m,isRegenLabel:!0,omitIcon:!1})})}):e.jsx("button",{className:A("cursor-pointer",t),onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:e.jsx(Kn,{modelSlug:j,animateModelLabelOnRender:S,isDropdownOpen:!1,isRegenerateEnabled:!1,isHovered:m,omitIcon:r,animateShortLabel:!0})}),i&&e.jsx(z.Portal,{children:e.jsxs(z.Content,{className:"z-30 min-w-fit origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[e.jsx(z.Item,{disabled:!0,className:"pb-0 pt-2",children:e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(P,{id:"bFLh5u",defaultMessage:"Switch model"})})}),e.jsx(Zg,{clientThreadId:s,messageId:y,onModelSelect:a,messageModelSlug:f,omitModelIcons:r,modelOptions:x,setHoveredOption:c,hoveredOption:l,retryOption:N,lastResponseUsedSearch:k,modelSupportsSearch:D,doesUserHaveAnyAccountsWithPlusFeatures:w})]})})]})}function Zg({clientThreadId:t,messageId:s,modelOptions:n,messageModelSlug:a,onModelSelect:o,omitModelIcons:i,setHoveredOption:r,hoveredOption:l,retryOption:c,lastResponseUsedSearch:h,modelSupportsSearch:u,doesUserHaveAnyAccountsWithPlusFeatures:m}){const g=ee(),[p,b]=d.useMemo(()=>as(n,S=>S.subcategory),[n]),f=d.useMemo(()=>{const S=new Map;return p.forEach(v=>{const k=v.subcategory;k&&(S.has(k)||S.set(k,[]),S.get(k)?.push(v))}),S},[p]),y=A("icon-sm",i&&"order-10 ml-auto text-token-text-tertiary icon-md"),x=i?"right":"left",j=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:g.formatMessage(Tn.search),icon:e.jsx(Ss,{className:y}),condition:u&&!h,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:g.formatMessage(Tn.nosearch),icon:e.jsx(qi,{className:y}),condition:u&&h,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return e.jsxs(e.Fragment,{children:[b.map(S=>{const{value:v,...k}=S;return e.jsx(Mt,{value:v,onSelect:()=>{ce.logEvent("chatgpt_regenerate_switch_model_button_clicked",v,{requestedModelId:v,...Je({clientThreadId:t,messageId:s})}),o({requestedModelId:v})},includeRegenerate:!1,onMouseEnter:()=>r(v),onMouseLeave:()=>r(null),isHovered:l===v,messageModelSlug:a,includeCheck:!1,shouldShowUpsell:ds(S,m),className:Os,...k,icon:i?e.jsx("span",{className:y}):k.icon,justifyIcon:x,wrapIcon:!i},v)}),[...f.entries()].map(([S,v])=>e.jsxs(z.Sub,{children:[e.jsx(z.SubMenuTrigger,{children:e.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:S})}),e.jsx(z.Portal,{children:e.jsx(z.SubContent,{className:"min-w-fit",children:v.map(k=>{const{value:D,...N}=k;return e.jsx(Mt,{value:D,onSelect:()=>{ce.logEvent("chatgpt_regenerate_switch_model_button_clicked",D,{requestedModelId:D,...Je({clientThreadId:t,messageId:s})}),o({requestedModelId:D})},includeRegenerate:!1,onMouseEnter:()=>r(D),onMouseLeave:()=>r(null),isHovered:l===D,messageModelSlug:a,includeCheck:!1,className:Os,...N,icon:null,justifyIcon:x,wrapIcon:!i,shouldShowUpsell:ds(k,m)},S+"-"+D)})})})]},S)),!!c&&e.jsxs(e.Fragment,{children:[e.jsx(z.Separator,{}),e.jsx(Mt,{onSelect:()=>{ce.logEvent("chatgpt_regenerate_try_again_button_clicked",c.value,{requestedModelId:c.value,...Je({clientThreadId:t,messageId:s})}),o({requestedModelId:c.value})},includeRegenerate:!0,onMouseEnter:()=>r(c.value),onMouseLeave:()=>r(null),messageModelSlug:a,includeCheck:!1,className:Os,...c,label:g.formatMessage(Tn.tryAgain),subtitle:c.label,icon:e.jsx(dn,{className:y}),justifyIcon:x,wrapIcon:!i},c.value),j.filter(S=>S.condition).map(S=>e.jsx(Mt,{onSelect:()=>{ce.logEvent(S.eventName,c.value,{requestedModelId:c.value,...Je({clientThreadId:t,messageId:s})}),o({requestedModelId:c.value,extraStreamParams:S.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>r(S.key),onMouseLeave:()=>r(null),isHovered:l===S.key,messageModelSlug:a,includeCheck:!1,className:Os,...c,label:S.label,subtitle:"",icon:S.icon,justifyIcon:x,wrapIcon:!i},S.key))]})]})}function Jg({children:t,label:s}){return e.jsx(Dt,{label:s,sideOffset:0,children:t})}const Tn=be({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),ep=d.memo(Qg);function jr(t){return t.find(s=>s.message.author.role===ve.Tool&&s.message.metadata?.pending_memory_info)}function tp(t){return t.filter((s,n)=>{const a=t[n+1],i=a?.message.recipient==="assistant"&&a?.message.author.role===ve.Tool&&a?.message.author.name==="bio"&&Ri(a.message).startsWith("Model set context");return s.message.author.role===ve.Assistant&&s.message.recipient==="bio"&&i}).flatMap(s=>{const n=s.message.content.content_type;return n===Tt.Text?s.message.content.parts:n===Tt.Code?[s.message.content.text]:[]}).map(lp)}function sp(t){return t.some(s=>s.message.author.role===ve.Assistant&&s.message.recipient==="bio"&&s.message.status==="in_progress")}function np(t){const{eligible:s,isLoading:n}=au(),a=d.useMemo(()=>t.length>0,[t]);d.useEffect(()=>{a&&s&&!n&&rs.openModal(Pi.GlobalMemoryOnboarding)},[a,s,n])}function ap(t){const[s,n]=d.useState(!1);return{isPopoverOpen:s,setIsPopoverOpen:n,handleTogglePopover:o=>{const i=o??!s;n(i),i&&q.logEvent(H.memoryUpdatePopoverShown,{updateCount:t.length})}}}function Mr({memoryWrites:t,popoverState:s,triggerButton:n,isParagen:a,setShowMemoriesModal:o}){return e.jsxs(ou,{open:s.isPopoverOpen,sideOffset:4,side:"bottom",alignAgainstAnchor:"start",size:"none",className:"z-10 min-w-60 max-w-96 text-sm",onOpenChange:i=>s.handleTogglePopover(i),disableAutofocus:!0,triggerButton:n,children:[e.jsx("div",{className:"mb-2 rounded border border-token-border-light bg-token-main-surface-secondary",children:t.map((i,r)=>e.jsx("div",{className:"border-b border-token-border-light px-3 py-2 first-letter:uppercase last:border-b-0",children:i},r))}),a?e.jsx("div",{className:"text-xs text-token-text-tertiary",children:e.jsx(P,{id:"MemoryActionResult.paragenMessage",defaultMessage:"This memory will be saved if you choose this response."})}):e.jsxs("button",{className:"flex w-full items-center justify-between rounded px-3 py-2 font-semibold hover:bg-token-main-surface-secondary",onClick:()=>{o(!0),q.logEvent(H.memoryUpdatePopoverManageButtonClicked,{updateCount:t.length})},children:[e.jsx(P,{id:"MemoryActionResult.manageMemories",defaultMessage:"Manage memories"}),e.jsx(Bh,{className:"icon-md -mr-1 text-token-text-tertiary"})]})]})}function op({clientThreadId:t,pendingMessage:s,memoryWrites:n,popoverState:a,setShowMemoriesModal:o}){const i=Rt(),r=ee(),l=Q.getServerThreadId(t),c=wi({clientThreadId:t}),h=n.join(" ");let u=h.slice(0,50).replace(new RegExp("^\\p{L}","u"),g=>g.toLocaleUpperCase()).replace(/\.$/,"");h.length>50&&(u+="...");const m=async g=>{if(!l)throw new Error("Failed to confirm or reject memory update: serverThreadId is not found");const p=s.message.metadata?.pending_memory_info;Q.updateTree(t,b=>{b.updateNodeMessageMetadata(s.nodeId,{pending_memory_info:{...p,is_pending:!1,confirm_result:g}})});try{await Ke.confirmOrRejectMemory(s.message.id,l,g)}catch{i.danger(r.formatMessage({id:"memory.confirmOrDenyFail",defaultMessage:"Failed to confirm or reject memory update"})),Q.updateTree(t,f=>{f.updateNodeMessageMetadata(s.nodeId,{pending_memory_info:p})})}};return e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"inline-block text-sm font-semibold text-token-text-tertiary outline-none",children:e.jsx(P,{id:"MemoryActionResult.memoryConfirmation",defaultMessage:"Remember this? {memoryText}",values:{memoryText:e.jsx("div",{className:"inline-block py-1",onMouseOver:()=>a.handleTogglePopover(!0),onMouseOut:()=>a.handleTogglePopover(!1),children:e.jsx(Mr,{memoryWrites:n,popoverState:a,triggerButton:e.jsx("button",{className:A("text-left font-normal",a.isPopoverOpen?"text-token-text-secondary":"text-token-text-tertiary"),children:e.jsx(P,{id:"MemoryActionResult.memoryWrapper",defaultMessage:"“{memoryWrites}”",values:{memoryWrites:u}})}),setShowMemoriesModal:o})})}})}),e.jsx(Ve,{className:"ml-3 text-token-text-tertiary hover:text-token-text-primary",size:"xs",color:"secondary",disabled:c,onClick:()=>{m(!0)},children:e.jsx(P,{id:"MemoryActionResult.confirm",defaultMessage:"Yes"})}),e.jsx(Ve,{className:"ml-2 text-token-text-tertiary hover:text-token-text-primary",size:"xs",color:"secondary",disabled:c,onClick:()=>{m(!1)},children:e.jsx(P,{id:"MemoryActionResult.deny",defaultMessage:"No"})})]})}function ip({memoryWrites:t,popoverState:s,isParagen:n,setShowMemoriesModal:a}){return t.length===0?null:e.jsx(e.Fragment,{children:e.jsx("div",{className:"inline-block",onMouseOver:()=>s.handleTogglePopover(!0),onMouseOut:()=>s.handleTogglePopover(!1),children:e.jsx(Mr,{memoryWrites:t,popoverState:s,isParagen:n,triggerButton:e.jsxs("button",{className:A("my-1 flex items-center gap-1 text-sm font-semibold outline-none",s.isPopoverOpen?"text-token-text-secondary":"text-token-text-tertiary"),children:[e.jsx(Oh,{className:"mb-[-1px]"}),t.length===1?e.jsx(P,{id:"MemoryActionResult.memoryWriteSingular.1",defaultMessage:"Memory updated"}):e.jsx(P,{id:"MemoryActionResult.memoryWritePlural.1",defaultMessage:"Memories updated"})]}),setShowMemoriesModal:a})})})}function rp(t){const s=jr(t),n=s?.message.metadata?.pending_memory_info?.confirm_result;return s==null?null:n===!0?"confirmed":n===!1?"denied":"pending"}function Xn({messages:t,clientThreadId:s,gizmoId:n,isParagen:a}){const o=tp(t),i=ap(o),r=sp(t);np(o);const[l,c]=d.useState(!1),h=jr(t),u=rp(t);return u==="denied"?null:r?e.jsx("div",{className:"result-streaming",children:e.jsx("span",{children:e.jsx("pre",{})})}):e.jsxs(e.Fragment,{children:[u==="pending"?e.jsx(op,{clientThreadId:s,memoryWrites:o,popoverState:i,setShowMemoriesModal:c,pendingMessage:h}):e.jsx(ip,{memoryWrites:o,popoverState:i,isParagen:a,setShowMemoriesModal:c}),l&&e.jsx(cm,{initialGizmoId:n,onClose:()=>c(!1)})]})}function lp(t){const s=["The user ","The user's ","User ","User's "];for(const n of s)if(t.startsWith(n))return t.slice(n.length);return t}function vo(t,s,n){Q.updateTree(t,a=>{a.updateNodeMetadata(s,{inlineComparisonRating:n})})}function bo(t){return{is_dark_mode:t==="dark",time_since_loaded:Math.floor(performance.now()/1e3),page_height:window?.innerHeight,page_width:window?.innerWidth,pixel_ratio:window?.devicePixelRatio,screen_height:window?.screen?.height,screen_width:window?.screen?.width}}const yo=({messages:t})=>{for(const{message:{metadata:s}}of t){const{augmented_paragen_prompt_label:n}=s??{};if(n)return n}};function cp(t){const s=d.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});return t.stubSideBySideFeedback?e.jsx(Cr,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:s,...t}):e.jsx(dp,{...t,visibilityStateRef:s})}function dp(t){const{clientThreadId:s,variantIds:n,variantsInStreamInfo:a,turnIndex:o}=t;if(n.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const i=Ca(),[r]=d.useState(()=>Date.now()),l=da(),{resolvedTheme:c}=ul(),[h,u]=d.useMemo(()=>Ii(n.join(""))()<.5?[0,1]:[1,0],[n[0],n[1]]),m=h<u?"left":"right",g=m==="left"?"right":"left",p=n[h],b=n[u],f=$a(s,p),y=$a(s,b),x=yt(On(s,o,yt(f).id)),j=yt(On(s,o,yt(y).id)),S=m==="left"?x:j,v=m==="left"?j:x,k=a.display_treatment==="unskippable",D=i?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";d.useEffect(()=>(Dn.setState({displayingSideBySideFeedback:!0,unskippable:k}),()=>{Dn.setState({displayingSideBySideFeedback:!1,unskippable:!1})}),[k]),iu();const N=d.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});d.useEffect(()=>hl(ru,{requestCompletion:()=>{const w=Zt(S.messages)?.completionSampleFinishTime,_=Zt(v.messages)?.completionSampleFinishTime;Ke.submitMessageComparisonFeedback({feedback_version:D,original_message_id:S.messages[S.messages.length-1]?.message.id,new_message_id:v.messages[v.messages.length-1]?.message.id,conversation_id:Q.getServerThreadId(s),completion_comparison_rating:"skip",new_completion_placement:g,feedback_start_time:r,compare_step_start_time:r,original_completion_load_start_time:r,original_completion_load_end_time:w??0,new_completion_load_start_time:r,new_completion_load_end_time:_??0,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:bo(c),...N.current})}}),[x,j,s,r,D,g,S?.messages,v?.messages,c]);const M=w=>{const Y=Q.getTree(s).getLeafFromNode(w);Q.setThreadCurrentLeafId(s,Y.id);const T=w===p===(m==="left"),G=Zt(S.messages)?.completionSampleFinishTime,F=Zt(v.messages)?.completionSampleFinishTime;S.messages.length>0&&vo(s,S.messages[S.messages.length-1].nodeId,T?"original":"new"),v.messages.length>0&&vo(s,v.messages[v.messages.length-1].nodeId,T?"original":"new");let R;G==null||F==null?R=T?"partial_load_comparison_original":"partial_load_comparison_new":R=T?"original":"new",Ke.submitMessageComparisonFeedback({feedback_version:D,original_message_id:S.messages[S.messages.length-1]?.message.id,new_message_id:v.messages[v.messages.length-1]?.message.id,conversation_id:Q.getServerThreadId(s),completion_comparison_rating:R,new_completion_placement:g,feedback_start_time:r,compare_step_start_time:r,original_completion_load_start_time:r,original_completion_load_end_time:G??null,new_completion_load_start_time:r,new_completion_load_end_time:F??null,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:bo(c),...N.current})};return e.jsx(Cr,{...t,setPreferredFeedback:M,leftVariantId:p,rightVariantId:b,leftTurn:x,rightTurn:j,hasActiveRequest:l,originalTurn:S,visibilityStateRef:N})}function up(t){if(!t.length)return!1;const s=t.filter(n=>n.type===$e.Text||n.type===$e.MultiText).filter(n=>n.message.message.status!=="finished_successfully"&&n.message.message.metadata?.snorkle_status!==void 0);return s.length>0&&s.every(n=>{const a=n.message.message.content;return a?.content_type===Tt.Text&&a.parts.join("")===""})}function Cr({setPreferredFeedback:t,leftVariantId:s,rightVariantId:n,leftTurn:a,rightTurn:o,hasActiveRequest:i,originalTurn:r,visibilityStateRef:l,...c}){const{defaultParagenLabel:h,shouldShowParagenLabels:u=!1}=li(),m=a&&yo(a)||h,g=o&&yo(o)||h,p=d.useMemo(()=>a?.messages??[],[a?.messages]),b=d.useMemo(()=>o?.messages??[],[o?.messages]),{avatarClassName:f}=c,y=d.useMemo(()=>qs(p),[p]),x=d.useMemo(()=>qs(b),[b]),j=Ko(),[S,v]=d.useMemo(()=>[y,x].map(W=>up(W)),[y,x]),k=mt(a?$s.getRequestIdFromConversationTurn(a):"")||S,D=mt(o?$s.getRequestIdFromConversationTurn(o):"")||v,N=a?.role===ve.User,M=o?.role===ve.User,w=d.useRef(null),_=d.useRef(null),Y=d.useRef(null),U=c.stubSideBySideFeedback||S,T=c.stubSideBySideFeedback||v;d.useEffect(()=>{if(w.current&&_.current&&Y.current){const W=Array(11).fill(0).map((K,O)=>O/10),$=new IntersectionObserver(K=>K.forEach(O=>{O.target===_.current?(l.current.left_visibility_initial==null&&(l.current.left_visibility_initial=O.intersectionRatio),l.current.left_visibility_max=Math.max(l.current.left_visibility_max??0,O.intersectionRatio)):O.target===Y.current&&(l.current.right_visibility_initial==null&&(l.current.right_visibility_initial=O.intersectionRatio),l.current.right_visibility_max=Math.max(l.current.right_visibility_max??0,O.intersectionRatio))}),{root:w.current,threshold:W});return $.observe(_.current),$.observe(Y.current),()=>$.disconnect()}},[l]);const{data:G}=Yo(void 0,!1,j),F=Ca(),R=e.jsx("div",{className:"text-pretty px-6 pb-5 pt-1 text-center text-sm text-token-text-secondary",children:e.jsx(P,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),C=Ye();return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:A("sticky z-[1] text-pretty bg-token-main-surface-primary px-6 text-center text-lg",C&&"top-[var(--thread-leading-height)] pt-3",!C&&"top-[-1px]",F&&!C?"md:top-header-height":C?"":"md:static"),children:[e.jsx(P,{id:"JgCHDY",defaultMessage:"You’re giving feedback on a new version of ChatGPT."}),F?R:null]}),F?null:R,e.jsx("div",{className:"relative -mb-2 snap-x snap-mandatory overflow-x-auto px-3 pb-4 md:px-5 lg:px-10",ref:w,children:e.jsx("div",{className:A(!C&&"min-w-fit"),children:e.jsxs("div",{className:A("mx-auto flex max-w-6xl items-start",F&&!C&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",!F&&!C&&"gap-4 sm:gap-6",F&&C&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",C&&!F&&"gap-4 sm:gap-6"),children:[e.jsxs(wo,{horizontalScrollContainerRef:w,rootElementRef:_,onClick:()=>{t(s)},hasActiveRequest:i,isWaitingOnFirstUserVisibleToken:U,children:[e.jsxs(Co,{children:[e.jsx(Bn,{messages:p,isUserTurn:N,avatarClassName:f}),e.jsx(Mo,{children:u?e.jsx("span",{className:"font-bold text-token-text-primary",children:m}):e.jsx(P,{..._o.responseNumber,values:{responseIndex:1}})})]}),F&&U?e.jsx(jo,{}):e.jsxs(e.Fragment,{children:[G!=null&&!N&&e.jsx(Xn,{clientThreadId:c.clientThreadId,messages:p,isParagen:!0}),e.jsx(Hn,{...c,groupedMessagesToRender:y,allGroupedMessages:y,isEditing:!1,isUserTurn:N,isCompletionRequestInProgress:k,hasActiveRequest:i,handleEnterEdit:wt,handleExitEdit:wt,shouldGrowContainer:!1}),e.jsx(ko,{turn:a,originalTurn:r})]})]}),e.jsxs(wo,{horizontalScrollContainerRef:w,rootElementRef:Y,onClick:()=>{t(n)},hasActiveRequest:i,isWaitingOnFirstUserVisibleToken:T,children:[e.jsxs(Co,{children:[e.jsx(Bn,{messages:b,isUserTurn:M,avatarClassName:f}),e.jsx(Mo,{children:u?e.jsx("span",{className:"font-bold text-token-text-primary",children:g}):e.jsx(P,{..._o.responseNumber,values:{responseIndex:2}})})]}),F&&T?e.jsx(jo,{}):e.jsxs(e.Fragment,{children:[G!=null&&!M&&e.jsx(Xn,{clientThreadId:c.clientThreadId,messages:b,isParagen:!0}),e.jsx(Hn,{...c,groupedMessagesToRender:x,allGroupedMessages:x,isEditing:!1,isUserTurn:M,isCompletionRequestInProgress:D,hasActiveRequest:i,handleEnterEdit:wt,handleExitEdit:wt,shouldGrowContainer:!1}),e.jsx(ko,{turn:o,originalTurn:r})]})]})]})})})]})}function wo({horizontalScrollContainerRef:t,rootElementRef:s,onClick:n,children:a,hasActiveRequest:o,isWaitingOnFirstUserVisibleToken:i}){const r=Ca(),l=Ye(),{scrollX:c}=lu({layoutEffect:!1,container:t,target:s}),h=cu(),u=du(),m=d.useRef(null),g=d.useRef(null),p=d.useRef(null),[b,f]=d.useState(!1),[y,x]=d.useState(!1),[j,S]=d.useState(!1),[v,k]=d.useState(0);d.useEffect(()=>{if(!r)return;const U=new IntersectionObserver(T=>{for(const G of T)G.target===m.current?f(G.isIntersecting):G.target===p.current?S(G.isIntersecting):G.target===g.current&&x(G.isIntersecting)},{root:h?.current,rootMargin:l?`0px 0px -${v}px 0px`:void 0});return m.current&&g.current&&p.current&&(U.observe(m.current),U.observe(g.current),U.observe(p.current)),()=>{U.disconnect()}},[v,r,l,h]);const D=!j&&(y||b),N=uu(c,U=>D?-1*U:0),M=Ka(0);d.useEffect(()=>{if(!r)return;const U=new ResizeObserver(T=>{Ds(T.length===1,"entryList.length === 1");const G=T[0];Ds(G.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),M.set(G.contentBoxSize[0].inlineSize)});return s.current&&U.observe(s.current),()=>{U.disconnect()}},[r,M,s]);const w=Ka(0);d.useEffect(()=>{if(!r)return;const U=new ResizeObserver(T=>{Ds(T.length===1,"entryList.length === 1");const G=T[0];Ds(G.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),w.set(G.contentBoxSize[0].blockSize+16),k(G.contentBoxSize[0].blockSize)});return u.current&&U.observe(u.current),()=>{U.disconnect()}},[r,w,u]);const _=e.jsx(Ve,{className:r?"px-5":"mt-4 self-start",onClick:n,children:e.jsx(P,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),Y=i;return e.jsxs("div",{"data-paragen-root":!0,className:A("relative flex w-full min-w-[min(450px,80vw)] snap-center flex-col gap-1 text-left",l&&r&&"pl-3 pr-5 sm:w-[calc(100cqw-62px)] sm:pl-3 sm:pr-5 md:px-10",!l&&r&&"px-10",r?"min-h-60 py-4":"rounded-2xl border border-token-main-surface-tertiary bg-white p-5 dark:bg-gray-700"),ref:s,children:[e.jsx("div",{className:A("absolute left-0 right-0 top-48 h-px","invisible"),ref:m}),e.jsx("div",{className:A("absolute bottom-0 left-0 right-0 top-48","invisible"),ref:g}),e.jsx("div",{className:A("absolute bottom-0 left-0 right-0 h-px","invisible"),ref:p}),a,r?e.jsx("div",{className:"flex-1"}):null,r?e.jsx("div",{className:"mt-4 min-h-10",children:Y?null:e.jsx(te.div,{style:{translateX:N,width:M,bottom:w},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:A({fixed:D,"z-20 flex w-full justify-center":!0}),children:_})}):o?null:_]})}function jo(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pb-5 pt-3",children:[e.jsx(dt,{className:"h-4 w-[75%]"}),e.jsx(dt,{className:"h-4 w-[50%]"}),e.jsx(dt,{className:"h-4 w-[80%]"}),e.jsx(dt,{className:"h-4 w-[55%]"}),e.jsx(dt,{className:"h-4 w-[66%]"}),e.jsx(dt,{className:"h-4 w-[64%]"}),e.jsx(dt,{className:"h-4 w-[48%]"})]})}function Ca(){const{layer:t}=Fe("3119715334");return t.get("should-enable-hojicha",!1)}const Mo=Me.div`text-sm text-token-text-secondary font-semibold`,Co=Me.div`flex gap-4 items-center mb-1`,dt=Me.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function ko({turn:t,originalTurn:s}){const n=ra();if(!n.showParagenMetadata||!n.showDebugConversationTurns&&!n.forceParagen||t==null)return null;let a=t===s?"ORIGINAL":"NEW";const i=t.messages[t.messages.length-1]?.message?.metadata?.__internal;if(i){const{model_id:r,model_definition_slug:l,model_definition_virtual_model_id:c,alternative_model_selection_rule:h,augmented_paragen_prompt_group_id:u,augmented_paragen_prompt_id:m,augmented_paragen_prompt:g}=i;r&&(a+=`
Model ID: ${r}`),l&&(a+=`
Model Slug: ${l}`),c&&(a+=`
Virtual Model ID: ${c}`),h&&(a+=`
Alternative Model Rule: ${h}`),u&&(a+=`
Prompt Group ID: ${u}`),m&&(a+=`
Prompt ID: ${m}`),g&&(a+=`
Prompt: ${g}`)}return e.jsx("div",{className:"whitespace-pre-wrap text-sm text-red-500",children:a})}const _o=be({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}"}}),To=(...t)=>s=>t.some(n=>n(s)),Ao=({allGroupedMessages:t})=>t.some(s=>[$e.Browsing,$e.RetrievalBrowsing,$e.ParallelBrowsing].includes(s.type)),Eo=({allGroupedMessages:t})=>t.some(s=>s.type===$e.SearchGPTQuery),No=({allGroupedMessages:t})=>t.some(s=>s.type===$e.CodeInterpreter);function hp(t){return!t||!t.instructions?"":typeof t.instructions=="string"?t.instructions:t.instructions.filter(s=>typeof s=="string").join("")}const mp=[{match:To(Ao,Eo),tag:"Shouldn't have searched the web",label:fe({id:"kL047b",defaultMessage:"Shouldn't have searched the web"})},{match:To(Ao,Eo),tag:"Don't like the source it cited",label:fe({id:"OWjzGX",defaultMessage:"Don't like the sources it cited"})},{match:No,tag:"Shouldn't have run code",label:fe({id:"53w4ay",defaultMessage:"Shouldn't have run code"})},{match:No,tag:"Couldn't handle my file",label:fe({id:"EkFTQ5",defaultMessage:"Couldn't handle my file"})},{match:({allGroupedMessages:t})=>t.some(s=>s.type===$e.Dalle),tag:"Shouldn't have created an image",label:fe({id:"S8FRsr",defaultMessage:"Shouldn't have created an image"})},{match:({allGroupedMessages:t})=>t.some(s=>{if(s.type!==$e.Text)return!1;const{message:n}=s.message,{content:a}=n;return a.content_type===Tt.Text&&Ri(n).match(/^```[\S]+\n/gm)}),tag:"Code was incorrect",label:fe({id:"4EBdQk",defaultMessage:"Code was incorrect"})},{match:({systemContent:t})=>hp(t).includes("Personality")??!1,tag:"Too chatty or casual",label:fe({id:"ATzJKW",defaultMessage:"Too chatty or casual"})},{match:({features:t})=>t.includes(ns.Sunshine),tag:"Shouldn't have used Memory",label:fe({id:"yfUEiz",defaultMessage:"Shouldn't have used Memory"})},{tag:"Don't like the style",label:fe({id:"nGxjdj",defaultMessage:"Don't like the style"})},{tag:"Not factually correct",label:fe({id:"Ke7JtQ",defaultMessage:"Not factually correct"})},{tag:"Didn't fully follow instructions",label:fe({id:"Rdlt9V",defaultMessage:"Didn't fully follow instructions"})},{tag:"Refused when it shouldn't have",label:fe({id:"2yRS/Q",defaultMessage:"Refused when it shouldn't have"})},{tag:"Being lazy",label:fe({id:"14MPmT",defaultMessage:"Being lazy"})},{tag:"Unsafe or problematic",label:fe({id:"02pXBl",defaultMessage:"Unsafe or problematic"})},{tag:"Other",label:fe({id:"WiIGE+",defaultMessage:"Other"})}],fp=[{tag:"I disagree with the policy",label:fe({id:"oKyDLz",defaultMessage:"I disagree with the policy"})},{tag:"This didn't violate the policy",label:fe({id:"7fUkVF",defaultMessage:"This didn't violate the policy"})},{tag:"I don't understand the policy",label:fe({id:"4Cdp6N",defaultMessage:"I don't understand the policy"})},{tag:"This didn't take the full context",label:fe({id:"vnZJDP",defaultMessage:"This didn't take the full context"})}];function gp(t,s,n){return s.filter(a=>!a.match||a.match(n)).map(a=>({value:a.tag,label:t.formatMessage(a.label)}))}function pp(t){const s=t[t.length-1];if(!s)return!1;const n="message"in s?s.message:null;if(n){const{errCode:a}=pa(n);return[Vs.ContentPolicy,Vs.ContentOrTos].includes(a)}else return!1}function xp({clientThreadId:t,conversationMessage:s,currentModelId:n,allGroupedMessages:a}){const o=ee(),i=en()??[],r=s.rating,l=hu(t,s.message.id),c=l?.message.content.content_type===Tt.SystemContent?l?.message.content:null,h=d.useCallback(g=>{const p=Q.getServerThreadId(t);p&&(g.tags.length===0&&!g.textFeedback||(q.logEvent(g.source==="inline"?H.messageFeedbackInlineSubmitted:H.messageFeedbackDialogSubmitted,{id:s.message.id,threadId:p,tags:g.tags,content:g.textFeedback,model:n,rating:r}),ce.logEvent(g.source==="inline"?"chatgpt_feedback_inline_submitted":"chatgpt_feedback_dialog_submitted",g.tags?.[0]??null,{id:s.message.id,threadId:p,tag:g.tags?.[0]??"",content:g.textFeedback??"",model:n,rating:r??""}),r&&Ke.submitMessageFeedback({message_id:s.message.id,conversation_id:p,rating:r,text:g.textFeedback,tags:g.tags,tag_choices:g.tagChoices})))},[t,s.message,n,r]),u=()=>{q.logEvent(H.messageFeedbackMoreOptionsClicked,{id:s.message.id,threadId:Q.getServerThreadId(t),model:n,rating:r})},m=gp(o,pp(a)?fp:mp,{allGroupedMessages:a,features:i,currentModelId:n,systemContent:c});return r==="thumbsUp"?null:e.jsx(im,{tagOptions:m,onSubmit:h,onMoreClicked:u})}const Ro=[1,2,3,4,10,20,30],Sp=.5;function vp({clientThreadId:t,conversationLeafId:s}){const n=Di(Fi.isBusinessWorkspace),a=d.useRef(!1),o=gs(t),i=cn(t),{isUnauthenticated:r}=ze(),l=d.useMemo(()=>{if(!o)return-1;const w=Ii(o);return w()>Sp?-1:Ro[Math.floor(w()*Ro.length)]},[o]),c=mu(t,s),h=c[c.length-1],u=d.useMemo(()=>$s.getRequestIdFromConversationTurn(h),[h]),m=mt(u),[g,p]=d.useState(null),[b,f]=d.useState(!1),[y,x]=d.useState(!1),[j,S]=d.useState(!1),v=w=>{const _=Zt(c)?.messages[0]?.message.id;p(w),N(_,w)},k=c.filter(w=>w.role===ve.Assistant).length,D=h?.role===ve.Assistant,N=d.useMemo(()=>Mi((w,_)=>{o&&w&&Ke.submitConversationRating({conversation_id:o,message_id:w,rating:_,shown_at_assistant_turn:l}),q.logEvent(H.conversationRatingSubmitted,{rating:_,showAtAssistantTurn:l,conversationId:o}),f(!0),setTimeout(()=>{x(!0)},1500)},2e3),[o,l]),M=k!==l||m||!D||!!n||i?.kind!==et.PrimaryAssistant||j||r;return d.useEffect(()=>{!M&&!a.current&&(q.logEvent(H.conversationRatingShown,{showAtAssistantTurn:l,conversationId:o}),a.current=!0)},[M]),j||M?null:e.jsxs("div",{className:"mx-auto",children:[e.jsx(fs,{children:b&&!y&&e.jsx(te.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(Po,{$padded:!0,children:e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(P,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!b&&e.jsx(te.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:e.jsxs(Po,{$padded:!1,children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-secondary",children:[e.jsx(P,{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(An,{$selected:g==="thumbsUp",onClick:()=>v("thumbsUp"),children:e.jsx($i,{className:"icon-md"})}),e.jsx(An,{$selected:g==="thumbsDown",onClick:()=>v("thumbsDown"),children:e.jsx(Ki,{className:"icon-md"})})]})]}),e.jsx("div",{className:"w-px flex-1 self-stretch bg-token-main-surface-tertiary"}),e.jsx(An,{className:"p-3",$selected:!1,onClick:()=>S(!0),children:e.jsx(zh,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const An=Me.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,Po=Me.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`;function bp({clientThreadId:t,conversationLeafId:s,canShowInlineMessageFeedback:n,messageForRating:a,allGroupedMessages:o,currentModelId:i}){let r=null;return fu(t,s)?null:(a.rating&&n?r=e.jsx(xp,{clientThreadId:t,conversationMessage:a,allGroupedMessages:o,currentModelId:i}):r=e.jsx("div",{className:"text-center",children:e.jsx(vp,{clientThreadId:t,conversationLeafId:s})}),e.jsx("div",{className:"mt-3 w-full empty:hidden",children:r}))}const Io=128;function yp(t){const{turnIndex:s,conversationLeafId:n,isFinalTurn:a,clientThreadId:o,onChangeItemInView:i,onChangeRating:r,currentModelId:l,avatarClassName:c,showAvatar:h=!0,scrollToMessageId:u}=t,m=ee(),g=ia(),p=!!g&&ml(g),b=ca(),f=Di(Fi.isBusinessWorkspace),y=Rt(),{value:x}=Ne("2848981774"),j=Q.getServerThreadId(o),S=yt(On(o,s,n)),{messages:v,variantIds:k,variantsInStreamInfo:D}=S,N=qs(v),M=gu();let w=v[v.length-1];for(const V of N){const Te=lm(V);if(Te.some(Xe=>M.has(Xe.message.id))){w=Te[Te.length-1];break}}const _=v.slice(0,v.indexOf(w)+1),Y=an(),[U,T]=d.useState(!1),[G,F]=d.useState(!1),R=k.findIndex(V=>_.some(Te=>Te.nodeId===V)),C=S.role===ve.User,W=Ft(),$=Ue(o),K=ms(S.gizmoId??$)?.data,O=pu(),se=K&&O.includes(K.gizmo.id),ye=Li(l),me=xu(l),ne=Ye(),ae=cn(o,K?.gizmo.id),ie=bi(o)===Wo.STREAMING,Ce=en(),{value:xe}=_t("1410082514"),{value:we}=_t("2291672486"),I=_.some(V=>V.message.content.content_type===Tt.MultimodalText),{layer:re}=Fe("1547743984"),Le=j&&Y&&re.get("show_share_button_inline",!1),{isUnauthenticated:ke}=ze(),[L,B]=d.useState(!1),[de,le]=d.useState(!1),ue=S.messages.map(V=>V.message.id),Z=d.useRef(null),X=v[v.length-1],he=X.rating,je=()=>{_.length===1&&(q.logEvent(H.editPrompt,{id:_[0].message.id,threadId:Q.getServerThreadId(o)}),ce.logEvent("chatgpt_edit_prompt"),T(!0))},ge=d.useCallback(()=>{T(!1)},[]),He=d.useCallback(V=>{Q.copyMessageToClipboard(o,s,y,V)},[o,s,y]),J=V=>{r({nodeId:X.nodeId,messageId:X.message.id,rating:V}),q.logEvent(V==="thumbsDown"?H.messageFeedbackThumbsDownClicked:H.messageFeedbackThumbsUpClicked,{id:X.message.id,threadId:Q.getServerThreadId(o),model:l,rating:V}),F(!0)},[Ge]=d.useState(()=>Date.now()),Se=d.useMemo(()=>$s.getRequestIdFromConversationTurn(S),[S]),gt=yi({clientThreadId:o,conversationLeafId:n}),_e=mt(Se)&&!gt,vs=da(),mn=qs(_),Lt=d.useRef(!1);d.useEffect(()=>{if(!(Lt.current||u==null||!x||!ne||!Z.current)&&(ue.includes(u)||u==="finalAgentTurn"&&a)){if(Lt.current=!0,u==="finalAgentTurn"&&a)Z.current.scrollIntoView({behavior:"instant",block:"end"});else{const V=Z.current.offsetHeight;let Te;V>Io?Te=Io-V:Te=0,Z.current.style.scrollMarginTop=`calc(${Te}px + 2px + var(--thread-leading-height))`,Z.current.scrollIntoView({behavior:"smooth"})}Q.updateScrollToMessageId(o,void 0)}},[u,Z.current]);const{showDebugConversationTurns:tt}=ra(),Ot=ji(o),Ie=Ti(o),st=Su({clientThreadId:o,conversationMode:ae}),fn=ft(o),nt=d.useCallback(({requestedModelId:V,systemMessage:Te,juice:Xe,extraStreamParams:Vt})=>{const As=new is;st({id:X.nodeId,eventMetadata:{eventSource:"mouse"},turnTracker:As,requestedModelId:V,systemMessage:Te,juice:Xe,extraStreamParams:Vt})},[X,st]),Bt=xe&&_.some(V=>V.message.metadata?.snorkle_status!=null),zt=!b&&!Ot&&!W&&!C,Ut=vu(),pt=w.message.author.role===ve.Assistant?w.message:null;bu({isCompletionRequestInProgress:_e,isUserTurn:C,message:pt});const bs=yu(o,k),at=wu(ae),qe=!Ut&&!at&&zt&&a&&D?.num_variants_in_stream===2&&!X.inlineComparisonRating&&!bs,ys=ju(S),xt=qe,gn=qe&&!ys,ot=!C&&!b&&!Ot&&!at&&!ie&&!_e,Ht=ot&&(!f||Bt||me||p)&&!at&&!ke&&!W,it=!b&&!((_e||ie)&&a)&&k.length>1&&!U&&!xt;let rt=!1;if(C&&_.length===1){const{shouldHideContent:V}=pa(_[0]);V&&(rt=!0)}const pn=C&&!at&&!b&&!I&&_.length===1&&!rt&&!U&&!ke,ws=V=>{i(k[V]),q.logEvent(H.changeNode,{intent:"toggle_between"})};if(!(S.role===ve.Root?!1:S.role===ve.System||S.role===ve.Developer||_.every(V=>V.message.metadata?.is_visually_hidden_from_conversation)?tt:!0)&&!xt)return null;const Ae=_.some(({message:V})=>Ni.getAssetPointers(V).length>0),Wt=!Ae&&a&&Ie&&!we?e.jsx(Qt,{onClick:()=>{ce.logEvent("chatgpt_regenerate_try_again_button_clicked",l,{requestedModelId:l,...Je({clientThreadId:o,turnIndex:s})});const V=new is;st({id:fn,eventMetadata:{eventSource:"mouse"},turnTracker:V}),os()},icon:dn,label:m.formatMessage({id:"ConversationTurn.regenerateTooltip",defaultMessage:"Regenerate"}),testId:"regenerate-turn-action-button"}):null,js="h-[30px] rounded-md px-1 text-token-text-secondary hover:bg-token-main-surface-secondary",Sn=!Ae&&we?e.jsx(ep,{className:js,clientThreadId:o,message:X,onModelSelect:nt,onDropdownChange:B,canRegenerateResponse:Ie}):null,Ms=!C&&!rt&&(!a||!_e)?e.jsx(Nu,{onClick:He}):null,Cs=!C&&(!a||!_e)&&(X.disclaimers??[]).length===0&&X.nodeId?e.jsx(Kg,{conversationId:o,message:X,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-xs text-token-text-tertiary hover:text-token-text-primary"}):null,St=!C&&X&&(!a||!_e)?e.jsx(Ru,{message:X,isFinalTurn:a,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-token-text-tertiary hover:text-token-text-primary"}):null,vn=Ht&&!_e?e.jsxs("div",{className:"flex",children:[!Ce?.includes(ns.ThumbsDownOnly)&&he!=="thumbsDown"&&e.jsx(Qt,{onClick:()=>J("thumbsUp"),disabled:he==="thumbsUp",icon:he==="thumbsUp"?Uh:$i,label:m.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"},`thumbsUp:${X.nodeId}`),he!=="thumbsUp"&&e.jsx(Qt,{onClick:()=>J("thumbsDown"),disabled:he==="thumbsDown",icon:he==="thumbsDown"?Hh:Ki,label:m.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"},`thumbsDown:${X.nodeId}`)]}):null,bn=Le&&e.jsx(Qt,{onClick:()=>{rs.openSharingModal(j)},label:m.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:Gh}),ks=!we&&e.jsx(zg,{className:js,clientThreadId:o,message:X,onModelSelect:nt,onDropdownChange:B});function _s(V){return ne?V:e.jsx(ha,{clientThreadId:o,isStaticSharedThread:b,withVerticalPadding:!0,withHorizontalPadding:!xt,children:V})}function lt(V){return ne?V:e.jsx(ls,{children:V})}const Ts=u!=="finalAgentTurn"&&a&&x&&ne;return e.jsxs("article",{className:A("w-full scroll-mb-[var(--thread-trailing-height)] text-token-text-primary focus-visible:outline-2 focus-visible:outline-offset-[-4px]",Ts?"min-h-[calc(100cqh-var(--thread-leading-height)-var(--thread-trailing-height)-100px)]":""),ref:Z,dir:"auto","data-testid":`conversation-turn-${s}`,"data-scroll-anchor":a,onMouseEnter:()=>le(!0),onMouseLeave:()=>le(!1),children:[e.jsx(Mu,{role:S.role}),_s(e.jsx(e.Fragment,{children:xt?e.jsx(cp,{isFeedbackEnabled:Ht,variantIds:k,variantsInStreamInfo:D,conversationTurnMountTime:Ge,stubSideBySideFeedback:gn,...t}):lt(e.jsxs(e.Fragment,{children:[!C&&h&&e.jsx(jp,{children:e.jsx(Bn,{messages:_,isUserTurn:C,avatarClassName:c,gizmo:K})}),e.jsx("div",{className:A("group/conversation-turn relative flex w-full min-w-0 flex-col",!C&&Cu),children:e.jsx("div",{className:"flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[!C&&!b&&e.jsx(Xn,{messages:_,clientThreadId:o,gizmoId:K?.gizmo.id}),e.jsx(Hn,{groupedMessagesToRender:mn,allGroupedMessages:N,...t,isEditing:U,isUserTurn:C,isCompletionRequestInProgress:_e,isFeedbackEnabled:Ht,isFinalTurn:a,hasActiveRequest:vs,showEditButton:pn,handleEnterEdit:je,handleExitEdit:ge}),se&&e.jsx("div",{className:"mb-4",children:e.jsx(ku,{messages:_})}),ye&&e.jsx("div",{className:"mb-4",children:e.jsx(_u,{messages:_})}),(ot||it)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:A("mb-2 flex gap-3 empty:hidden",C?"mr-1 flex-row-reverse":"-ml-2"),children:e.jsx(Tu,{alwaysShow:a,showInline:a||it,isHovered:de||L,pagination:it&&e.jsx(Au,{showInline:a||it,currentPage:R,onChangeIndex:ws,length:k.length,className:A("self-center",k.length>1?"visible":"!invisible")}),actions:ot&&e.jsxs(e.Fragment,{children:[Cs,Ms,Wt,vn,St,ks,bn,Sn]})})}),ot&&!_e?e.jsx("div",{className:"pr-2 lg:pr-0",children:e.jsx(Eu,{message:X,isFinalTurn:a})}):null,a&&!_e&&e.jsx(bp,{canShowInlineMessageFeedback:G,clientThreadId:o,conversationLeafId:n,messageForRating:X,allGroupedMessages:N,currentModelId:l})]})]})})})]}))}))]})}const wp=$o.memo(yp),jp=Me.div`flex-shrink-0 flex flex-col relative items-end`,Mp=3;function Cp({onChangeItemInView:t,onRequestMoreCompletions:s,onChangeRating:n,onRequestCompletion:a,clientThreadId:o,conversationLeafId:i,hideHeader:r}){const l=Re(),c=Oi(),h=Pu(),[u]=Iu(),m=Du(),[g]=Fu(),p=cn(o),b=hs(),f=ga(o),y=Lu(o),x=l.store.useContentAreaDimensions(At.Header,O=>O?.height?O.height:void 0),j=l.store.useIsHeaderContentAreaPopulated(),S=Bi(o),{isArchived:v}=S,k=Ou(f.id),D=p?.kind===et.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":k,N=zi(o,i),M=ai(),[w,_]=d.useState(0),[Y,U]=d.useState(!1);d.useEffect(()=>{c&&(w===0?_(N):!Y&&N>w&&(U(!0),ce.logEvent("chatgpt_continue_conversation_first_message_sent"),q.logEvent(H.continueConversationFirstMessageSent)))},[N,w,Y,c]),c&&(ce.logEvent("chatgpt_continue_conversation_page_loaded"),q.logEvent(H.continueConversationPageLoaded));const T=d.useCallback(()=>{h({behavior:"smooth"})},[h]),G=Bu(o),F=M&&!v,R=(O,se,ye,me)=>(me&&(O=O+Mp),[...new Array(se-O).keys()].map(ne=>{const ae=ne+O;return e.jsx(wp,{isFinalTurn:ye(ae),turnIndex:ae,clientThreadId:o,conversationLeafId:i,onChangeItemInView:t,onChangeRating:n,onRequestMoreCompletions:s,onRequestCompletion:a,currentModelId:f.id,avatarClassName:D,scrollToBottom:T},ae)})),{layer:C}=Fe("4031588851"),W=C.get("enable_hardcoded_onboarding_prompt",!1),[$,K]=d.useState(!1);return d.useEffect(()=>{if(!W)return;const O=Q.getTree(o),se=O.getChildrenFromNode("root")[0],me=O.getChildrenFromNode(se.id)[0].message.author.metadata?.is_system_initiated_conversation===!0;K(me)},[i,N,a,o,W]),e.jsxs("div",{onCopy:G,className:A("flex flex-col text-sm",F&&"pb-[120px]",x||F?null:"md:pb-9"),style:{paddingBottom:F?void 0:x},children:[!r&&b?.data&&e.jsx(pr,{clientThreadId:o}),c&&e.jsxs(e.Fragment,{children:[e.jsx(ls,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(P,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),N-w===0&&e.jsx("div",{className:"text-center text-xs font-semibold text-token-text-primary",children:e.jsx("button",{onClick:()=>{rs.openModal(Pi.ReportConversation),ce.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),q.logEvent(H.sharedConversationReportContentClicked,{location:"Dynamic Shared Thread Page"})},children:e.jsx(P,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})}),R(0,w,O=>O===w-1),e.jsx(ls,{children:e.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(Wh,{className:"icon-xs mr-2"}),e.jsx(P,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})}),R(w,N,O=>O===N-1)]}),!c&&R(0,N,O=>O===N-1,$),y&&u&&!g&&e.jsx(Do,{className:A("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{ce.logEvent("chatgpt_thread_scroll_to_top"),m({behavior:"smooth"})},children:e.jsx(Vh,{className:"icon-md text-token-text-primary"})}),!u&&e.jsx(Do,{className:A(x?null:"bottom-5",F?j?"translate-y-[-50px]":"translate-y-[-10px]":""),style:{bottom:M?"calc(var(--composer-bar_footer-current-height) + var(--composer-bar_current-height))":x},onClick:()=>{ce.logEvent("chatgpt_thread_scroll_to_bottom"),h({behavior:"smooth"})},children:e.jsx(qh,{className:"icon-md text-token-text-primary"})})]})}const Do=Me.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-light right-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`,kp=60,_p=({children:t,scrollViewClassName:s,scrollAnchorTopOffset:n=0})=>{const a=d.useRef(null);return e.jsx("div",{className:"h-full",ref:a,children:e.jsx(fl,{children:e.jsx(rm,{className:"h-full",followButtonClassName:"hidden",initialScrollBehavior:"auto",scrollViewClassName:s,scroller:()=>Tp(a,n)?0:1/0,children:t})})})},Tp=(t,s)=>{const n=Ap(t.current);if(n==null)return!1;const a=n>s,o=n<s-kp;return!a&&!o};function Ap(t){if(!t)return null;const s=t.querySelector('[data-scroll-anchor="true"]');if(!s)return null;const n=s.getBoundingClientRect().top,a=t.getBoundingClientRect().top;return n-a}const Ep=Pt(()=>It(()=>import("./gglanyq0myoxra0i.js"),__vite__mapDeps([54,1,2,3,4,5,31,32,33,34,55])).then(t=>t.OpenDebugSidebarButton)),Np=Pt(()=>It(()=>import("./beaxjp5jjpr3rgid.js"),__vite__mapDeps([56,1,2,3,4,5,11]))),Rp=Pt(()=>It(()=>import("./sso-l6maw02gfr61gxuy.js").then(t=>t.e),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44])).catch(()=>()=>null)),Fo=be({doNotShareSensitive:{id:"thread.modal.onboarding.title",defaultMessage:"Do not share sensitive materials with this application"},somethingWentWrong:{id:"thread.modal.unrecoverableError.title",defaultMessage:"Something went wrong"},tryAgainLater:{id:"thread.modal.unrecoverableError.description",defaultMessage:"We're sorry, but something went wrong. Please try again later."},resetThread:{id:"thread.modal.unrecoverableError.resetThread",defaultMessage:"Reset thread"},sharedConversationReportConversation:{id:"thread.sharedConversation.report",defaultMessage:"Report conversation"},latencyButton:{id:"thread.latencyButton",defaultMessage:"Latency"},archivedConversationDescription:{id:"thread.archivedConversationDescription",defaultMessage:"This conversation is archived. To continue, please unarchive it first."},unarchiveButton:{id:"thread.unarchiveButton",defaultMessage:"Unarchive"}});function Pp({clientThreadId:t}){const s=Vo(),n=gs(t),a=async()=>{n&&(await Ke.patchConversation(n,{is_archived:!1}),s.invalidateQueries({queryKey:["conversation",t]}),ua.setState(o=>{const i=o.threads[n];i!=null&&(i.initialThreadData.isArchived=!1)}),ih(s))};return e.jsxs("div",{className:"my-6 flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"px-3 text-center text-sm text-token-text-secondary",children:e.jsx(P,{...Fo.archivedConversationDescription})}),e.jsx("div",{children:e.jsx(Ve,{disabled:!n,onClick:a,icon:$h,children:e.jsx(P,{...Fo.unarchiveButton})})})]})}const Jp=function({clientThreadId:t,onCompletionFinished:s,onCreate:n,preRequestCompletion:a,hideHeader:o,hideMessages:i,hideFooter:r,hideToolsOverlay:l,messagesVerticalAlign:c="top",prependThreadChildren:h,renderEmptyState:u,prefetchSearch:m}){const g=en(),p=hi(t),b=ma(t),f=ft(t),x=Bi(t).isArchived;d.useEffect(()=>{b||(Bs(t)?Rn.addTiming("chatgpt.web.chatPage.renderNewConversation"):Rn.addTiming("chatgpt.web.chatPage.renderExistingConversation"))},[t,b]);const j=zu(t,f),S=zi(t,f),{setTargetedContent:v}=gi(),k=g?.includes(gl),D=Uu(),N=S>=2;mi(N);const M=Bs(t)&&!N&&Cn(p),w=Bs(t)&&!j&&(Cn(p)||p?.kind===et.GizmoTest),Y=fi().id,U=Hu(t),T=U??Y,G=!!U,F=Li(T),C=ui()[T],W=Gu(t,p),$=aa();Wu(S,t,f,M),d.useEffect(()=>{pi()},[]),d.useEffect(()=>{$||v(void 0)},[t,v,$,f]);const{caModal:K,onRequestCompletion:O,onChangeItemInView:se,onChangeRating:ye,onRequestMoreCompletions:me}=Jh({clientThreadId:t,currentModelId:T,defaultModelId:Y,onCompletionFinished:s,onThreadCreated:n,preRequestCompletion:a}),{isUnauthenticated:ne,isLoading:ae}=ze(),Pe=Vu({clientThreadId:t,currentLeafId:f,handleRequestCompletion:O,prefetchSearchPromise:m});qu({clientThreadId:t,currentModelId:T});const ie=He=>e.jsx(_p,{scrollAnchorTopOffset:o?0:oh,children:c==="bottom"?e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex-1"}),He]}):He});d.useEffect(()=>{document.title=W??"ChatGPT"},[W]);const Ce=Ue(t),xe=Ft(),we=pl(),I=w&&!we&&!u&&!Ce&&!F&&!xe,re=I&&!ae&&ne,Le=I&&!ae&&!ne,ke=ag(re),L=ig(Le),B=re&&ke||Le&&L,de=Oi(),le=$u(),{reset:ue,streamingContext:Z,StreamingProvider:X}=Ku();d.useEffect(()=>{le&&(Z.setOnResetContext=()=>{ue()})},[le,ue,Z]);const he=d.useRef(null),je=d.useRef(null),ge=d.useMemo(()=>({threadContentScrollContainerElementRef:he,footerRootContainerElementRef:je}),[]);return e.jsx(Yu,{clientThreadId:t,currentLeafId:f,children:e.jsxs(X,{value:Z,children:[k&&e.jsx(Np,{}),e.jsx(Xu,{children:W!=null&&e.jsx("title",{children:W})}),p?.kind===et.GizmoInteraction&&p.gizmo&&e.jsx(Qu,{gizmo:p.gizmo}),e.jsx(Zu.Provider,{value:O,children:e.jsxs(Ju,{children:[e.jsxs(eh,{clientThreadId:t,currentModelConfig:C,className:"composer-parent flex h-full flex-col focus-visible:outline-0",children:[!i&&e.jsx(th,{value:ge,children:e.jsx(Ip,{ref:he,children:!b&&!Pe?w?u??e.jsx(Dg,{clientThreadId:t,currentModelId:T,isModelLoaded:G,onRequestCompletion:O,enableV2Homepage:B,v2HomepageDisclaimer:B&&e.jsx(Ya,{clientThreadId:t})}):N?ie(e.jsxs(e.Fragment,{children:[h,e.jsx(Cp,{onChangeItemInView:se,onRequestMoreCompletions:me,onChangeRating:ye,onRequestCompletion:O,clientThreadId:t,conversationLeafId:f,hideHeader:o},t)]})):null:null})}),e.jsx(Dp,{ref:je,children:x?e.jsx(Pp,{clientThreadId:t}):e.jsxs("div",{children:[!B&&e.jsx(tg,{clientThreadId:t,isNewThread:M,showPromptStarters:M||!j,currentModelId:T,onRequestCompletion:O}),!r&&e.jsx("div",{className:"relative w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",children:Cn(p)&&!B&&e.jsx("div",{className:"min-h-4",children:e.jsx(Ya,{clientThreadId:t})})})]})})]}),!l&&e.jsxs("div",{className:"group absolute bottom-2 end-2 z-20 hidden gap-1 md:flex lg:bottom-3 lg:end-3",children:[D?e.jsxs(e.Fragment,{children:[e.jsx(Ep,{}),e.jsx(Rp,{})]}):null,e.jsx(om,{})]}),K,e.jsx(sh,{clientThreadId:t,isStaticSharedThread:!1,isDynamicSharedThread:de}),e.jsx(nh,{}),e.jsx(ah,{conversationId:t,currentModelId:T,isActiveWindow:!we})]})})]})})},Ip=Me.div`grow flex-1 overflow-hidden`,Dp=Me.div`md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent w-full`;export{wp as C,Dg as E,go as G,rg as S,Jp as T,_p as W,tg as a,Tg as b,Eg as c,Xp as d};
//# sourceMappingURL=he20qiwgsftwhtr2.js.map
