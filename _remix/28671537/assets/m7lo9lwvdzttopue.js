import{R as u,h1 as o,D as c,c as x,j as S,aN as $}from"./2dfa7mijpk96ivcu.js";import{i as _}from"./n1ui85qe1scppnjf.js";var p=(e=>(e.SCALLION="scallion",e.SCALLION_RC="scallion-rc",e))(p||{});const b=async({queryKey:e})=>{const[t,n]=e;if(n.length<2)return[];const r=new URLSearchParams({query_fragment:n});return u.get(`${o}/suggestions?${r.toString()}`).then(s=>s.suggestions).catch(()=>[])};async function q({threadId:e,sessionId:t,query:n,agentSettingsOverrides:r,metadata:s}){const E=g(r),l=e?`${o}/threads/${e}/turns?blocking=false`:`${o}/turns?nonce=${t}`;r.emulated_location&&(s={...s,...r.emulated_location});const d=new PerformanceObserver(w=>{const h=w.getEntriesByName(l,"resource");if(h.length){const i=h[0];if(i.connectEnd){const k=i.connectEnd-i.fetchStart;c.addAction("sonic.web.home.new_turn_connection_time",{durationMs:k})}d.disconnect()}});return d.observe({type:"resource"}),u.post(l,{...E,turn:{user_query:n,now:r.emulated_date?new Date(r.emulated_date).toISOString():void 0},user_metadata:s})}async function I(){return u.delete(`${o}/threads`)}function g(e){return{settings_overrides:{search_results:{search_engines:e.use_labrador?{bing:{}}:{bing:{ranking_model:null,rrf_alpha:1,rrf_input_threshold:0},labrador:null}},model_response:{enable_multimodal:e.show_image_to_model,completion_model:e.completion_model&&e.completion_model!=="production"?{model:e.completion_model,clip_model:"@mmapi",direct_connection_urls:[]}:{}}},base_config:e.base_config??p.SCALLION,eval_preset:e.eval_preset}}async function M({threadId:e,threadUserId:t,routePrefix:n}){let r=o;n&&(r=r+n);const s=new URL(`${r}/threads/${e}/with_turns`);return t&&s.searchParams.append("thread_user_id",t),await u.get(s.toString())}async function W(e){const t=new FormData;return t.append("feedback",JSON.stringify({thread_id:e.threadId,turn_index:e.turnIndex,rating:e.rating,search_query:e.searchQuery,text:e.text,model_instructions:e.modelInstructions,tags:e.tags,user_email:e.userEmail})),e.screenshot&&t.append("file",new File([e.screenshot],"screenshot.jpeg",{type:"image/jpeg"})),u.post(`${o}/feedback/turns`,t)}async function v(e,t){return u.post(`${o}/threads/${e}/turns/${t}/images_try_hard`)}async function O(e){const t=new FormData;return e.screenshot&&t.append("file",new File([e.screenshot],"screenshot.jpeg",{type:"image/jpeg"})),t.append("feedback",JSON.stringify({thread_id:e.threadId,url:e.url,title:e.title,snippet:e.snippet,rating:e.rating,search_query:e.searchQuery,text:e.text,tags:e.tags,user_email:e.userEmail,turn_index:e.turnIndex})),u.post(`${o}/feedback/links`,t)}function P(e){const t=g(e.agentSettingsOverrides);u.post(`${o}/prefetch`,{...t,turn:{user_query:e.query},user_metadata:e.metadata})}function z(){return u.get(`${o}/healthcheck`)}function U(){return u.post(`${o}/waitlist`)}function m(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[r,s]of e)if(!Object.is(s,t.get(r)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const r of n)if(!Object.prototype.hasOwnProperty.call(t,r)||!Object.is(e[r],t[r]))return!1;return!0}class H extends Error{constructor(t){super(t),this.name="WebsocketConnectError"}}class T extends Error{constructor(t){super(t),this.name="TurnError"}}class J extends Error{constructor(t){super(t),this.name="TurnDeltaMessageError"}}function L(e){return e?e.model_response?.text!=null&&e.model_response.text.length>0:!1}function f(e){return e.execution_status==="fatal_system_error"}function F(e){return e.execution_status==="in_progress"||e.execution_status===null}function Q(e){return a(t=>t.thread?.turns.map(n=>e.reduce((r,s)=>(r[s]=n[s],r),{}))??[],(t,n)=>{if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(!m(t[r],n[r]))return!1;return!0})}function V(){return a(e=>$(e.thread?.turns.flatMap(t=>t.model_response?.citations)),m)}const y={thread:null,error:void 0},a=x(S(()=>({...y}))),R=_(()=>{c.addError(new T("got updateTurn with no current thread"))},1e3),C=_(e=>{c.addError(new T("turn not found"),{turnIndex:e})},1e3),G={threadId:e=>e.thread?.id??null,turns:e=>e.thread?.turns??[],turnCitations:e=>t=>t.thread?.turns[e].model_response?.citations??[],hasResponse:e=>L(e.thread?.turns[0]),firstTurn:e=>e.thread!=null?e.thread.turns[0]:void 0,lastTurn:e=>e.thread!=null?e.thread.turns[e.thread.turns.length-1]:void 0,numTurns:e=>e.thread?.turns.length??0,isLastTurnStreaming:e=>{const t=e.thread!=null?e.thread.turns[e.thread.turns.length-1]:void 0;return t!=null&&F(t)},hasModelResponseText:e=>e.thread?.turns[0]?.model_response?.text!=null,hasFirstTurnError:e=>{const t=e.thread?.turns[0];return!!t&&f(t)},hasTurnError:e=>e.thread?.turns.some(f)??!1,threadError:e=>e.error,__deprecated_sportsWidget:e=>e.thread?.turns[0]?.sports_widget??null},K={appendTurn(e,t,n){a.setState(r=>{r.thread?.id!==e&&(n?.(e),r.thread={id:e,turns:[]}),r.thread.turns.push(t)})},updateTurn(e,t){a.setState(n=>{const r=n.thread;if(!r){R();return}const s=r.turns[e];if(!s){C(e);return}t(s)})},clearThread(){a.setState(()=>({...y}))},setError(e){a.setState(t=>{t.error=e})},setThread(e,t){a.setState(n=>{n.thread={id:e,turns:t}})}};export{p as B,K as T,H as W,a,G as b,V as c,f as d,I as e,U as f,M as g,z as h,q as i,T as j,J as k,b as l,W as m,O as n,F as o,v as p,P as r,Q as u};
//# sourceMappingURL=m7lo9lwvdzttopue.js.map
