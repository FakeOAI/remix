const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ijwz0cpmkj00yyki.js","assets/ornmk1um6pytkf56.js","assets/gyt8ikkud27lp54m.js","assets/root-o6g0n1da.css","assets/fl6q9z66k3fbh83y.js","assets/conversation-small-cll5buey.css","assets/q87lshoqcipac183.js","assets/c8zxz05g6fozv2d6.js","assets/lb77108t2pd7cmgz.js","assets/gtkn2sln66iaqe9r.js","assets/h9d8gf8zabmyld3j.js","assets/nffs3uwjlshp2f6o.js","assets/r910aebmjwqa8f6g.js","assets/jebpfhgxpd46kt5o.js","assets/iuruwr9n7vuvwwwc.js","assets/n2waatanazyixasb.js","assets/iolwngj4r86yp6qr.js","assets/dsurwjwve9ns2b4z.js","assets/du6cl22gdnth06pl.js","assets/djx3w9g8bqctvu1a.js","assets/iytjv2rb4r5juap5.js","assets/fhj1x6x5mv8ztzvu.js","assets/d8sjg49twkp74c2n.js","assets/cvtp1jqp0nbvrq61.js","assets/ho15zo99vomcb2me.js","assets/n0g921oxcaazr42z.js","assets/ljm6t9y6mf4obpk1.js","assets/f838bxlw69dd8ijo.js"])))=>i.map(i=>d[i]);
import{r as f,ab as ne,ac as re,a0 as A,L as U,ed as p,eg as I,e8 as $,y as s,a4 as b,c5 as oe,P as E,d as N,S as O,ak as ie,j as L,be as le,al as de,N as k,as as ce,ae as w,a1 as ue}from"./ornmk1um6pytkf56.js";import{cG as fe,eW as q,eX as me,x as he,c2 as G,eY as ye,eZ as ge,dr as pe,W as be,br as F,e_ as ve,cb as Te,ee as Se,ef as xe,eg as H,eh as Ee,e$ as Ne}from"./fl6q9z66k3fbh83y.js";import{a as ke,g as Ce}from"./q87lshoqcipac183.js";import{b as Ie,r as M,s as Y}from"./jebpfhgxpd46kt5o.js";import{f as we}from"./r910aebmjwqa8f6g.js";import{t as Re,v as B,s as Me,r as _e,T as V}from"./c8zxz05g6fozv2d6.js";import{G as z}from"./nffs3uwjlshp2f6o.js";import{ae as je}from"./gyt8ikkud27lp54m.js";function De(e,i,t){const{title:n,titleSource:a}=Re(e),[o,r]=f.useState(!1),l=n??i,d=f.useRef(l);return f.useEffect(()=>(t&&a===B.Generated&&l!==d.current&&r(!0),()=>{d.current=l}),[t,l,a]),{isTypingEffect:o,resolvedTitle:l}}const Oe=ne(()=>re(()=>import("./ijwz0cpmkj00yyki.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27])).then(e=>e.GizmoConversationOptionsDropdown)),Ae=new Date(2024,9,11,0);function Le(e){O.checkGate("3922476776")||ge.abortAllRequests(),E.logEvent(N.loadThread,{threadId:e})}function Ge({conversation:e,conversationTitle:i,onOpenChange:t,testId:n}){const a=A(),{isUnauthenticated:o}=ie(),{eligible:r,markAsViewed:l}=pe(be.ArchiveConversationOnboarding),d=_e(e.id),[c,m]=f.useState(!1),g=L(),h=le(),T=de();return f.useEffect(()=>$(z,{deleteChat:({serverThreadId:u})=>{u===e.id&&m(!0)},archiveChat:async({serverThreadId:u})=>{u===e.id&&(await k.patchConversation(e.id,{is_archived:!0}),M(g),O.logEvent("chatgpt_conversation_archived"),E.logEvent(N.conversationArchived),r&&(T.info(a.formatMessage({defaultMessage:"You can view archived chats in Settings",id:"HistoryGizmoItem.archiveChatOnboarding"}),{duration:10,hasCloseButton:!0}),l()),d&&F(h))}}),[h,T,g,r,e.id,a,d,l]),o?null:s.jsxs(s.Fragment,{children:[s.jsx(ce,{label:a.formatMessage({id:"tJPHEQ",defaultMessage:"Options"}),sideOffset:4,side:"top",children:s.jsx(Oe,{clientThreadId:e.id,onOpenChange:t,children:s.jsx("button",{className:"flex items-center justify-center text-token-text-secondary transition hover:text-token-text-primary radix-state-open:text-token-text-secondary","data-testid":n,children:s.jsx(je,{className:"icon-md"})})})}),c&&s.jsx(ve,{title:i,handleDelete:()=>{k.patchConversation(e.id,{is_visible:!1}).then(()=>{M(g),O.logEvent("chatgpt_conversation_deleted"),E.logEvent(N.conversationDeleted),Te.publish({kind:"deleteConversation",serverThreadId:e.id})}),d&&F(h)},onClose:()=>{m(!1)}})]})}function Pe({conversation:e,onClose:i}){const[t,n]=f.useState(e.title),a=L();function o(){t!==e.title&&(V.setTitle(e.id,t,B.User),E.logEvent(N.renameThread,{threadId:e.id,content:t}),k.patchConversation(e.id,{title:t}).then(()=>{M(a)}))}return s.jsx("input",{type:"text",value:t,onChange:r=>{n(r.target.value)},onKeyDown:r=>{switch(r.key){case"Escape":i();break;case"Enter":o(),i();break}},onBlur:()=>{o(),i()},autoFocus:!0,className:"w-full border border-token-border-light bg-transparent p-0 text-sm"})}const K=5,Ue=3e3;function Fe({threadId:e}){const i=L(),t=f.useRef(!1),n=f.useRef(null);return f.useEffect(()=>{async function a(){t.current=!0;const o=await we(e);if(o.async_status===p.UNREAD){M(i),V.initThreadFromServerData(e,o,!0,void 0,!0);return}if(o.async_status!==p.STREAMING)return;const r=o.update_time??0;q(new Date,new Date(r*1e3))<K?n.current=window.setTimeout(a,Ue):k.setConversationStatus(e)}return t.current||(E.logEvent(N.conversationPollingStarted),a()),()=>{n.current&&window.clearTimeout(n.current)}},[i,e]),null}function He({conversation:e,className:i,isActive:t,elementRef:n,isPrimaryBackgroundColor:a,testId:o}){const r=A(),[l,d]=f.useState(!1),[c,m]=f.useState(!1),{value:g}=U("3922476776"),{value:h}=U("232791851"),T=Ie(e.id),{value:u=null,source:v=null}=T??{},_=Me(e.id),S=fe(_),C=q(new Date,new Date(e.update_time??0))<K,X=e.update_time&&me(new Date(e.update_time),Ae),Q=u===p.STREAMING&&C,W=h&&!t&&!S&&X&&u===p.UNREAD,J=h&&!t&&(S||Q),Z=h&&u===p.STREAMING&&v===I.SERVER&&!S&&C,j=f.useRef(!1);f.useEffect(()=>{j.current||g&&(async()=>(j.current=!0,t&&u===p.UNREAD&&(v===I.SERVER&&await k.setConversationStatus(e.id),Y(e.id,null)),!t&&v===I.CLIENT&&u===p.UNREAD&&(await k.setConversationStatus(e.id,u),Y(e.id,{value:p.UNREAD,source:I.SERVER})),j.current=!1))()},[g,t,e.id,u,v,S]),f.useEffect(()=>$(z,{editTitle:({serverThreadId:y})=>{(y?y===e.id:t)&&d(!0)}}),[e.id,t]);const P=r.formatMessage({id:"mpXAeu",defaultMessage:"New chat"}),{resolvedTitle:D,isTypingEffect:ee}=De(e.id,e.title,t),te=he(),se=ee&&t&&te,{data:ae}=ke(e.conversation_template_id??void 0),x=G();return s.jsxs("div",{className:b("no-draggable group relative rounded-lg active:opacity-90",i,x&&"text-sm tracking-condensed",t?"bg-token-sidebar-surface-secondary":x?"hover:bg-token-main-surface-secondary":"hover:bg-token-sidebar-surface-secondary",c&&!t&&"bg-token-sidebar-surface-secondary"),children:[Z&&s.jsx(Fe,{threadId:e.id}),s.jsx(oe,{to:Ce(e.id,ae),onClick:y=>{y.metaKey||y.ctrlKey||t||Le(e.id)},onDoubleClick:()=>{d(!0)},ref:n,className:b("flex items-center gap-2",x&&"px-2 py-2.5",!x&&"p-2"),style:{maskImage:x?"var(--sidebar-mask)":void 0},children:s.jsxs("div",{className:b("relative grow overflow-hidden whitespace-nowrap",J&&"loading-shimmer"),dir:"auto",children:[se?s.jsx(ye,{text:D||P}):D||P,!x&&s.jsx("div",{className:b("absolute bottom-0 top-0 to-transparent ltr:right-0 ltr:bg-gradient-to-l rtl:left-0 rtl:bg-gradient-to-r",a?t||!t&&c?"from-token-sidebar-surface-secondary":"from-token-main-surface-primary":!1,a?!1:t||!t&&c?"from-token-sidebar-surface-secondary":"from-token-sidebar-surface-primary",{"from-token-main-surface-primary can-hover:group-hover:from-token-sidebar-surface-secondary":a&&!t&&!c,"from-token-sidebar-surface-primary can-hover:group-hover:from-token-sidebar-surface-secondary":!a&&!t&&!c,"w-10 from-60%":t||c,"w-8 from-0% can-hover:group-hover:w-10 can-hover:group-hover:from-60%":!t&&!c})})]})}),l?s.jsx("div",{className:"absolute bottom-0 left-[7px] right-2 top-0 flex items-center bg-token-sidebar-surface-secondary",children:s.jsx(Pe,{conversation:e,onClose:()=>{d(!1)}})}):W?s.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:s.jsx("div",{className:"h-2 w-2 rounded-full bg-blue-selection"})}):s.jsx("div",{className:b("absolute bottom-0 top-0 items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",t||c?"flex":"hidden can-hover:group-hover:flex"),children:s.jsx(Ge,{conversation:e,conversationTitle:D??e.title,onOpenChange:y=>{m(y),y&&E.logEvent(N.conversationHistoryItemOpenMenu,{conversationId:e.id})},testId:`${o}-options`})})]})}function Ye({className:e,elementRef:i,item:t,isActive:n,isFirstItem:a,isPrimaryBackgroundColor:o,testId:r}){const l=G();return s.jsx("li",{className:b(!l&&"relative",a&&!l?"z-[15]":""),"data-testid":r,children:s.jsx(He,{className:e,isPrimaryBackgroundColor:o,conversation:t,isActive:n,elementRef:i,testId:r})})}const R=ue({historyBucketToday:{id:"history.bucket.today",defaultMessage:"Today"},historyBucketYesterday:{id:"history.bucket.yesterday",defaultMessage:"Yesterday"},historyBucketLastSeven:{id:"history.bucket.lastSeven",defaultMessage:"Previous 7 Days"},historyBucketLastThirty:{id:"history.bucket.lastThirty",defaultMessage:"Previous 30 Days"}}),$e=5;function Je(e,i){const t=A();return f.useMemo(()=>e.reduce((n,a)=>{const o=new Date(a.update_time??a.create_time??0),r=Se(new Date,o);if(r===0)n.recent.today.items.push(a);else if(r<=1)n.recent.yesterday.items.push(a);else if(r<=7)n.recent.lastSeven.items.push(a);else if(r<=30)n.recent.lastThirty.items.push(a);else if(xe(o)){const l=H(o),d=Ee(o),c=`${l}-${d}`;n.dynamicMonths[c]?n.dynamicMonths[c].items.push(a):n.dynamicMonths[c]={label:t.formatDate(o,{month:"long"}),items:[a]}}else{const d=`${H(o)}-`;n.dynamicYears[d]?n.dynamicYears[d].items.push(a):n.dynamicYears[d]={label:t.formatDate(o,{year:"numeric"}),items:[a]}}return n},{recent:{today:{label:s.jsx(w,{...R.historyBucketToday}),items:[]},yesterday:{label:s.jsx(w,{...R.historyBucketYesterday}),items:[]},lastSeven:{label:s.jsx(w,{...R.historyBucketLastSeven}),items:[]},lastThirty:{label:s.jsx(w,{...R.historyBucketLastThirty}),items:[]}},dynamicMonths:{},dynamicYears:{}}),[i,e])}function Ze({activeId:e,bucketedItems:i,items:t,hasNextPage:n,isPrimaryBackgroundColor:a,infiniteScrollTriggerElementRef:o}){const r=G();return s.jsx(s.Fragment,{children:[i.recent,i.dynamicMonths,i.dynamicYears].flatMap((l,d)=>s.jsx(f.Fragment,{children:Object.entries(l).map(([c,{items:m,label:g}],h)=>{if(c!=="today"&&!m.length)return null;const T=!!m.find(u=>t.length>0&&u.id===t[0]?.id);return m.length>0&&s.jsxs("div",{className:b(a&&"first:mt-0",r&&"first:mt-1",!r&&"relative mt-5 first:mt-0 last:mb-5"),children:[s.jsx("div",{className:b("sticky",!r&&"bg-token-sidebar-surface-primary",r?"top-[--sidebar-sticky-threshold] z-20":"top-0 z-20"),children:s.jsx("span",{className:"flex h-9 items-center",children:s.jsx(Ne,{$screenArch:r,children:g})})}),s.jsx("ol",{className:r?"flex flex-col gap-0.5":void 0,children:m.map((u,v)=>{const _=e===u.id,S=T&&v===0,C=n&&t[t.length-$e-1]?.id===u.id?o:void 0;return s.jsx(Ye,{item:u,isActive:_,isFirstItem:S,isPrimaryBackgroundColor:a,elementRef:C,testId:`history-item-${v}`},`history-item-${u.id}-${c}`)})})]},`${c}-${d}-${h}`)})},`category-${d}`))})}export{Ze as H,Ye as a,Je as u};
//# sourceMappingURL=d3jkm6smrg5ihui1.js.map
