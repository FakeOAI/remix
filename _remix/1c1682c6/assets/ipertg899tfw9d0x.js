const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/n3ihh3l3n61ycpjl.js","assets/d63lrq7vlweafxz1.js","assets/ohl9cn85y3aaicqe.js","assets/root-myjlts4g.css","assets/g3zxt2mfvuei9piv.js","assets/conversation-small-eplmind9.css","assets/fs5gbgqmch243kc5.js","assets/hzasuzxvzvyrjf2o.js","assets/t1dfvypwzj0qsy2j.js","assets/jcyypd2lct8700iz.js","assets/orovqpljoil3dvcp.js","assets/klnxt9ipzdtcd7ws.js","assets/eexqsmb80tn46cif.js","assets/dias3110nn2tob8p.js","assets/ma0trg4hlajpugg1.js","assets/e86hbuttel85uo7n.js","assets/mwn34khfvfuni0fv.js","assets/kshxul0ya814ewyl.js","assets/i4qjt97rop38eyad.js"])))=>i.map(i=>d[i]);
import{r as d,ck as J,c1 as W,ak as R,P as N,A as w,H as L,aN as P,f8 as T,f9 as G,bu as Z,j as s,c as p,bz as ee,B as te,E as F,ay as se,b3 as ae,R as C,K as k,N as ne}from"./d63lrq7vlweafxz1.js";import{dS as re,u as ie,dT as B,dU as oe,dV as le,bJ as de,aB as ce,bm as A,l as ue,dW as fe,dX as Y,dY as me,dZ as he,d_ as H,d$ as ye,e0 as ge}from"./g3zxt2mfvuei9piv.js";import{c as pe}from"./fs5gbgqmch243kc5.js";import{u as be,s as xe}from"./le0xcrm6n3gyouuy.js";import{f as Te}from"./eaehzgrq0vivay3l.js";import{t as ve,v as q,b as Ee,w as Se,T as z}from"./hzasuzxvzvyrjf2o.js";import{G as U}from"./jcyypd2lct8700iz.js";import{g as Ne}from"./orovqpljoil3dvcp.js";import{ag as we}from"./ohl9cn85y3aaicqe.js";import{r as _}from"./jb449adwxbxi1me5.js";import{m as Ce}from"./t1dfvypwzj0qsy2j.js";function Ie(e,t,i){const{title:a,titleSource:r}=ve(e),[n,l]=d.useState(!1),o=a??t,c=d.useRef(o);return d.useEffect(()=>(i&&r===q.Generated&&o!==c.current&&l(!0),()=>{c.current=o}),[i,o,r]),{isTypingEffect:n,resolvedTitle:o}}const ke=J(()=>W(()=>import("./n3ihh3l3n61ycpjl.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18])).then(e=>e.GizmoConversationOptionsDropdown)),je=new Date(2024,8,24,13);function _e(e){R.checkGate("3922476776")||re.abortAllRequests(),N.logEvent(w.loadThread,{threadId:e})}function Me({conversation:e,conversationTitle:t,onOpenChange:i}){const a=L(),{isUnauthenticated:r}=te(),{eligible:n,markAsViewed:l}=de(ce.ArchiveConversationOnboarding),o=Se(e.id),[c,f]=d.useState(!1),m=F(),u=se(),b=ae();return d.useEffect(()=>G(U,{deleteChat:({serverThreadId:h})=>{h===e.id&&f(!0)},archiveChat:async({serverThreadId:h})=>{h===e.id&&(await C.patchConversation(e.id,{is_archived:!0}),_(m),R.logEvent("chatgpt_conversation_archived"),N.logEvent(w.conversationArchived),n&&(b.info(a.formatMessage({defaultMessage:"You can view archived chats in Settings",id:"HistoryGizmoItem.archiveChatOnboarding"}),{duration:10,hasCloseButton:!0}),l()),o&&A(u))}}),[u,b,m,n,e.id,a,o,l]),r?null:s.jsxs(s.Fragment,{children:[s.jsx(ue,{label:a.formatMessage({id:"tJPHEQ",defaultMessage:"Options"}),sideOffset:4,side:"top",children:s.jsx(ke,{clientThreadId:e.id,onOpenChange:i,children:s.jsx("button",{className:"flex items-center justify-center text-token-text-secondary transition hover:text-token-text-primary radix-state-open:text-token-text-secondary",children:s.jsx(we,{className:"icon-md"})})})}),c&&s.jsx(fe,{title:t,handleDelete:()=>{C.patchConversation(e.id,{is_visible:!1}).then(()=>{_(m),R.logEvent("chatgpt_conversation_deleted"),N.logEvent(w.conversationDeleted)}),o&&A(u)},onClose:()=>{f(!1)}})]})}function De({conversation:e,onClose:t}){const[i,a]=d.useState(e.title),r=F();function n(){i!==e.title&&(z.setTitle(e.id,i,q.User),N.logEvent(w.renameThread,{threadId:e.id,content:i}),C.patchConversation(e.id,{title:i}).then(()=>{_(r)}))}return s.jsx("input",{type:"text",value:i,onChange:l=>{a(l.target.value)},onKeyDown:l=>{switch(l.key){case"Escape":t();break;case"Enter":n(),t();break}},onBlur:()=>{n(),t()},autoFocus:!0,className:"w-full border border-token-border-light bg-transparent p-0 text-sm"})}const V=5,Oe=3e3;function Re({threadId:e}){const t=F(),i=d.useRef(!1),a=d.useRef(null);return d.useEffect(()=>{async function r(){i.current=!0;const n=await Te(e);if(n.async_status===T.FINISHED){_(t),z.initThreadFromServerData(e,n,!0,void 0,!0);return}if(n.async_status!==T.PENDING)return;const l=n.update_time??0;B(new Date,new Date(l*1e3))<V?a.current=window.setTimeout(r,Oe):C.clearConversationStatus(e)}return i.current||r(),()=>{a.current&&window.clearTimeout(a.current)}},[t,e]),null}function Le({conversation:e,isActive:t,elementRef:i,isPrimaryBackgroundColor:a}){const r=L(),[n,l]=d.useState(!1),[o,c]=d.useState(!1),{value:f}=P("3922476776"),{value:m}=P("232791851"),u=be(e.id),b=Ee(e.id),h=ie(b),I=B(new Date,new Date(e.update_time??0))<V,y=e.update_time&&oe(new Date(e.update_time),je),x=u===T.PENDING&&I,M=m&&!t&&!h&&y&&u===T.FINISHED,D=m&&!t&&(h||x),O=m&&u===T.PENDING&&!h&&I,v=d.useRef(!1);d.useEffect(()=>{!v.current&&!h&&u===T.FINISHED&&t&&f&&(async()=>(v.current=!0,await C.clearConversationStatus(e.id),xe(e.id,null),v.current=!1))()},[f,t,e.id,u,h]),d.useEffect(()=>G(U,{editTitle:({serverThreadId:g})=>{(g?g===e.id:t)&&l(!0)}}),[e.id,t]);const E=r.formatMessage({id:"mpXAeu",defaultMessage:"New chat"}),{resolvedTitle:S,isTypingEffect:$}=Ie(e.id,e.title,t),K=Z(),X=$&&t&&K,{data:Q}=pe(e.conversation_template_id??void 0);return s.jsxs("div",{className:p("no-draggable group relative rounded-lg active:opacity-90",t?"bg-token-sidebar-surface-secondary":"hover:bg-token-sidebar-surface-secondary",o&&!t&&"bg-token-sidebar-surface-secondary"),children:[O&&s.jsx(Re,{threadId:e.id}),s.jsx(ee,{to:Ne(e.id,Q),onClick:g=>{g.metaKey||g.ctrlKey||t||_e(e.id)},onDoubleClick:()=>{l(!0)},ref:i,className:"flex items-center gap-2 p-2",children:s.jsxs("div",{className:p("relative grow overflow-hidden whitespace-nowrap",D&&"loading-shimmer"),dir:"auto",children:[X?s.jsx(le,{text:S||E}):S||E,s.jsx("div",{className:p("absolute bottom-0 top-0 to-transparent ltr:right-0 ltr:bg-gradient-to-l rtl:left-0 rtl:bg-gradient-to-r",a?t||!t&&o?"from-token-sidebar-surface-secondary":"from-token-main-surface-primary":!1,a?!1:t||!t&&o?"from-token-sidebar-surface-secondary":"from-token-sidebar-surface-primary",{"from-token-main-surface-primary can-hover:group-hover:from-token-sidebar-surface-secondary":a&&!t&&!o,"from-token-sidebar-surface-primary can-hover:group-hover:from-token-sidebar-surface-secondary":!a&&!t&&!o,"w-10 from-60%":t||o,"w-8 from-0% can-hover:group-hover:w-10 can-hover:group-hover:from-60%":!t&&!o})})]})}),n?s.jsx("div",{className:"absolute bottom-0 left-[7px] right-2 top-0 flex items-center bg-token-sidebar-surface-secondary",children:s.jsx(De,{conversation:e,onClose:()=>{l(!1)}})}):M?s.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:s.jsx("div",{className:"h-2 w-2 rounded-full bg-blue-selection"})}):s.jsx("div",{className:p("absolute bottom-0 top-0 items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",t||o?"flex":"hidden can-hover:group-hover:flex"),children:s.jsx(Me,{conversation:e,conversationTitle:S??e.title,onOpenChange:g=>{c(g),g&&N.logEvent(w.conversationHistoryItemOpenMenu,{conversationId:e.id})}})})]})}const Fe={initial:({isNew:e})=>e?{opacity:0,height:0,overflow:"hidden"}:{},animate:()=>({opacity:1,height:"auto"}),exit:()=>({opacity:0,height:0})};function Pe({elementRef:e,item:t,isActive:i,isFirstItem:a,isExistingItem:r,isPrimaryBackgroundColor:n}){const l=Y();return s.jsx(Ce.li,{className:p("relative",a&&!l?"z-[15]":""),layout:"position",custom:{isNew:!r},variants:Fe,initial:"initial",animate:"animate",exit:"exit","data-testid":"history-item",children:s.jsx(Le,{isPrimaryBackgroundColor:n,conversation:t,isActive:i,elementRef:e})})}const j=ne({historyBucketToday:{id:"history.bucket.today",defaultMessage:"Today"},historyBucketYesterday:{id:"history.bucket.yesterday",defaultMessage:"Yesterday"},historyBucketLastSeven:{id:"history.bucket.lastSeven",defaultMessage:"Previous 7 Days"},historyBucketLastThirty:{id:"history.bucket.lastThirty",defaultMessage:"Previous 30 Days"}}),Ae=5;function Qe(e,t){const i=L();return d.useMemo(()=>e.reduce((a,r)=>{const n=new Date(r.update_time??r.create_time??0),l=me(new Date,n);if(l===0)a.recent.today.items.push(r);else if(l<=1)a.recent.yesterday.items.push(r);else if(l<=7)a.recent.lastSeven.items.push(r);else if(l<=30)a.recent.lastThirty.items.push(r);else if(he(n)){const o=H(n),c=ye(n),f=`${o}-${c}`;a.dynamicMonths[f]?a.dynamicMonths[f].items.push(r):a.dynamicMonths[f]={label:i.formatDate(n,{month:"long"}),items:[r]}}else{const c=`${H(n)}-`;a.dynamicYears[c]?a.dynamicYears[c].items.push(r):a.dynamicYears[c]={label:i.formatDate(n,{year:"numeric"}),items:[r]}}return a},{recent:{today:{label:s.jsx(k,{...j.historyBucketToday}),items:[]},yesterday:{label:s.jsx(k,{...j.historyBucketYesterday}),items:[]},lastSeven:{label:s.jsx(k,{...j.historyBucketLastSeven}),items:[]},lastThirty:{label:s.jsx(k,{...j.historyBucketLastThirty}),items:[]}},dynamicMonths:{},dynamicYears:{}}),[t,e])}function Je({activeId:e,bucketedItems:t,items:i,hasNextPage:a,isPrimaryBackgroundColor:r,previousItems:n,infiniteScrollTriggerElementRef:l}){const o=Y();return s.jsx(s.Fragment,{children:[t.recent,t.dynamicMonths,t.dynamicYears].flatMap((c,f)=>s.jsx(d.Fragment,{children:Object.entries(c).map(([m,{items:u,label:b}],h)=>{if(m!=="today"&&!u.length)return null;const I=!!u.find(y=>{var x;return i.length>0&&y.id===((x=i[0])==null?void 0:x.id)});return u.length>0&&s.jsxs("div",{className:p(r&&"first:mt-0","relative mt-5 first:mt-0 last:mb-5"),children:[s.jsx("div",{className:p("sticky z-20 bg-token-sidebar-surface-primary",o?"top-[--sidebar-sticky-threshold] mb-2":"top-0"),children:s.jsx("span",{className:"flex h-9 items-center",children:s.jsx(ge,{children:b})})}),s.jsx("ol",{children:u.map((y,x)=>{var E;const M=e===y.id,D=I&&x===0,O=n==null?void 0:n.find(({id:S})=>S===y.id),v=a&&((E=i[i.length-Ae-1])==null?void 0:E.id)===y.id?l:void 0;return s.jsx(Pe,{item:y,isActive:M,isFirstItem:D,isExistingItem:!!O,isPrimaryBackgroundColor:r,elementRef:v},`history-item-${y.id}-${m}`)})})]},`${m}-${f}-${h}`)})},`category-${f}`))})}export{Je as H,Pe as a,_e as o,Qe as u};
//# sourceMappingURL=ipertg899tfw9d0x.js.map
