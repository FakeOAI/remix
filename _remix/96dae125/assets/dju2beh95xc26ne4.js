import{c as z,f as Z,dL as J,aa as ee,w as te,ah as se,S as k,r as m,P as f,d as y,y as o,ae as h,aA as R,a1 as H,$ as O,eY as ne,be as ae,x as oe,a0 as G,bA as ie,eZ as re,e_ as ce,N as le,bn as x,bj as C,e$ as de}from"./gdcgecchw5ye4zd8.js";import{de as T,L as N,fl as ue,a1 as me,eT as ge,eU as he,eV as j,eW as ke,fm as v}from"./megyxj7wc7eqtmhh.js";import{L as Y}from"./b7on5mzt5iy10tm1.js";import{a as fe,P}from"./jayzhgcczng9w1zw.js";import{T as ye}from"./cdqhuqxhiu5dqby5.js";const L=z(Z(()=>({statusMap:{}}))),He=e=>L(s=>s.statusMap[e]),Ge=(e,s)=>{L.setState(t=>{t.statusMap[e]=s;const n=ye.getServerThreadId(e);n&&(t.statusMap[n]=s)})},be=e=>{L.setState(s=>{for(const{id:t,async_status:n}of e)n!=null&&(s.statusMap[t]={source:J.SERVER,value:n})})};function pe(){return te("437245079").value}function Se(){const e=pe(),s=fe(),t=ee("1908072088").config.value,{eligible:n,isLoading:a}=T(N.AG8PqS2q);return{eligible:n&&e&&s&&t.blocking_modal===!0,singleButtonVariant:t.single_button_variant===!0,isLoading:a}}const K=N.UseSidekick,Me=N.SidekickLauncherOnboarding,B="https://persistent.oaistatic.com/sidekick/public/ChatGPT_Desktop_public_latest.dmg",U="download";function I(){const e=O(),s=ne("1696863369").layer.get("has_sidekick_access",!1);return e!=null&&s}function ve(e){return e===U}function Te(){const e=ae(),{hash:s}=oe(),t=ve(s.slice(1));return{openModal:()=>{e({hash:U})},closeModal:()=>{e({hash:""})},isOpen:t}}function Ye(e){const{eligible:s,isLoading:t}=Se(),n=I(),{eligible:a,isLoading:r}=T(K),{eligible:l,isLoading:i}=T(Me),c=s||!a||!l||!n||e.conversationMode?.kind!==se.PrimaryAssistant,b=t||i||r;return{eligible:!c&&k.getLayerValue({layerName:"1696863369",key:"show_nux_banner",defaultValue:!1}),isLoading:b}}function Ke({onClose:e}){m.useEffect(()=>{f.logEvent(y.sidekickAnnouncementShown),k.logEvent("chatgpt_sidekick_announcement_shown")},[]);const{markAsViewed:s}=T(K),t=m.useCallback(()=>{s(),f.logEvent(y.sidekickAnnouncementDismissed),k.logEvent("chatgpt_sidekick_announcement_closed"),e&&e()},[s,e]),n=m.useCallback(()=>{f.logEvent(y.sidekickAnnouncementLinkClicked),k.logEvent("chatgpt_sidekick_announcement_download_clicked"),s(),e&&e()},[s,e]),a={downloadUrl:B,markAsDownloaded:n,markAsViewed:t,isSidekickAvailable:I()};return o.jsx(Ee,{...a})}function _e(){window.open(B,"_blank")}function we(){return O()?.isPlus()?u.bannerTitleMentioningPlus:u.bannerTitleNotMentioningPlus}function Ue(){const{closeModal:e,isOpen:s}=Te(),t=I(),n=m.useMemo(()=>({isDesktopAppAvailable:t}),[t]),a=()=>{f.logEvent(y.sidekickDownloadModalClosed,n),k.logEvent("chatgpt_sidekick_modal_closed"),e()},r=()=>{f.logEvent(y.sidekickDownloadModalDownloaded,n),k.logEvent("chatgpt_sidekick_modal_download_clicked"),e()};return m.useEffect(()=>{s&&(f.logEvent(y.sidekickDownloadModalShown,{...n}),k.logEvent("chatgpt_sidekick_modal_shown"))},[n,s]),s?o.jsx(Ae,{downloadUrl:B,markAsDownloaded:r,markAsViewed:a,isSidekickAvailable:t}):null}function Ae({downloadUrl:e,markAsDownloaded:s,markAsViewed:t,isSidekickAvailable:n}){const a=n?u.modalTitleEligible:u.modalTitleNotEligible,r=o.jsx(h,{...a}),l=o.jsx(h,{...u.modalContent}),i=n?u.disclaimer:u.comingSoonDisclaimer,c=o.jsx(h,{...i,values:{learnMoreLink:E=>o.jsx(Y,{openNewTab:!0,href:"https://help.openai.com/en/articles/9275200",children:E})}}),b=o.jsxs("div",{children:[o.jsx("div",{children:l}),o.jsx("div",{className:"mt-2",children:c})]}),_=o.jsx(R,{as:"link",to:e,color:"primary",onClick:s,openNewTab:!0,children:o.jsx(h,{...u.download})}),M=o.jsx(R,{color:"secondary",onClick:t,children:o.jsx(h,{...u.close})}),w=n?_:M,A=n?M:void 0;return o.jsx(ue,{onClose:t,title:r,description:b,actionButton:w,cancelButton:A})}function Ee({markAsDownloaded:e,markAsViewed:s}){const t=G(),n=m.useCallback(()=>{_e(),e()},[e]),a=o.jsx(h,{...we()}),r=o.jsx(h,{...u.bannerContent}),l=o.jsx(h,{...u.disclaimer,values:{learnMoreLink:c=>o.jsx(Y,{openNewTab:!0,href:"https://help.openai.com/en/articles/9275200",children:c},"link")}}),i=o.jsxs("div",{className:"flex-grow",children:[o.jsx("div",{className:"mb-0.5 font-semibold",children:a}),o.jsxs("span",{className:"text-token-text-secondary",children:[r," ",l]})]});return o.jsx(me,{onPrimaryCtaClick:n,primaryCtaText:t.formatMessage(u.download),onDismiss:s,content:i})}const u=H({bannerTitleNotMentioningPlus:{id:"SidekickOnboarding.bannerTitleEnterprisey_2",defaultMessage:"ChatGPT is available for macOS 14+ with Apple Silicon"},bannerTitleMentioningPlus:{id:"SidekickOnboarding.bannerTitleMentioningPlus",defaultMessage:"ChatGPT is now available for macOSâ€”Plus users get early access"},modalTitleEligible:{id:"SidekickOnboarding.modalTitleEligible",defaultMessage:"The ChatGPT app is now available for macOS"},modalTitleNotEligible:{id:"SidekickOnboarding.modalTitleNotEligible",defaultMessage:"The ChatGPT macOS desktop app is coming soon"},modalContent:{id:"SidekickOnboarding.modal_content_eligible",defaultMessage:"Quickly access ChatGPT from anywhere on your computer with a shortcut: Option + Space. Share screenshots, upload files and photos, have voice conversations, and search through past conversations."},bannerContent:{id:"SidekickOnboarding.banner_content_3",defaultMessage:"Get faster access to ChatGPT with the Option + Space shortcut and the floating companion window."},disclaimer:{id:"SidekickOnboarding.disclaimer_3",defaultMessage:"<learnMoreLink>Learn more</learnMoreLink>."},comingSoonDisclaimer:{id:"SidekickOnboarding.coming_soon_disclaimer",defaultMessage:"The app will be available over the next couple of weeks."},download:{id:"SidekickOnboarding.download",defaultMessage:"Download"},close:{id:"SidekickOnboarding.close",defaultMessage:"Close"}}),De=28,F="conversationHistory";function Fe(e={}){const{buckets:s,recentConversationLimit:t}=e,a=ie()?.includes(re)??!1,r=O(),l=!a&&!!r?.data,i=G(),{data:c,fetchNextPage:b,hasNextPage:_,isLoading:M,isFetchingNextPage:w,isError:A,refetch:E}=ce({queryKey:[F],queryFn:async({pageParam:d})=>{const g=await le.getConversations({offset:d,limit:De});return be(g.items),g},initialPageParam:0,getNextPageParam:d=>{const g=d.offset+d.limit;return g<d.total?g:void 0},enabled:l}),p=m.useMemo(()=>c?.pages.flatMap(g=>g.items)??[],[c,e]),V=m.useMemo(()=>{if(!c||!s)return[];const d=xe(p,i);return[d.recent,d.dynamicMonths,d.dynamicYears].flatMap(D=>Object.entries(D).map(([q,{items:Q,label:W}],X)=>({key:`${q}-${X}`,label:W,items:Q}))).filter(D=>D.items.length>0)},[p,c,i,s]),$=m.useMemo(()=>{const d=p.slice(0,t??5);return{key:"recents",label:i.formatMessage(S.historyBucketRecent),items:d}},[p,t,i]);return{buckets:V,conversations:p,data:c,fetchNextPage:b,hasNextPage:_,refetch:E,recents:$,isLoading:M,isFetchingNextPage:w,isError:A}}function xe(e,s){return e.reduce((t,n)=>{const a=new Date(n.update_time??n.create_time??0),r=ge(new Date,a);if(r===0)t.recent.today.items.push(n);else if(r<=1)t.recent.yesterday.items.push(n);else if(r<=7)t.recent.lastSeven.items.push(n);else if(r<=30)t.recent.lastThirty.items.push(n);else if(he(a)){const l=j(a),i=ke(a),c=`${l}-${i}`;t.dynamicMonths[c]?t.dynamicMonths[c].items.push(n):t.dynamicMonths[c]={label:s.formatDate(a,{month:"long"}),items:[n]}}else{const i=`${j(a)}-`;t.dynamicYears[i]?t.dynamicYears[i].items.push(n):t.dynamicYears[i]={label:s.formatDate(a,{year:"numeric"}),items:[n]}}return t},{recent:{today:{label:s.formatMessage(S.historyBucketToday),items:[]},yesterday:{label:s.formatMessage(S.historyBucketYesterday),items:[]},lastSeven:{label:s.formatMessage(S.historyBucketLastSeven),items:[]},lastThirty:{label:s.formatMessage(S.historyBucketLastThirty),items:[]}},dynamicMonths:{},dynamicYears:{}})}function Ve(e){e.invalidateQueries({queryKey:[F]}),e.invalidateQueries({queryKey:["gizmoConversations"]})}const S=H({historyBucketRecent:{id:"history.bucket.recent",defaultMessage:"Recent"},historyBucketToday:{id:"history.bucket.today",defaultMessage:"Today"},historyBucketYesterday:{id:"history.bucket.yesterday",defaultMessage:"Yesterday"},historyBucketLastSeven:{id:"history.bucket.lastSeven",defaultMessage:"Previous 7 Days"},historyBucketLastThirty:{id:"history.bucket.lastThirty",defaultMessage:"Previous 30 Days"}}),Ce="prompt-textarea";function $e(){document.getElementById(Ce)?.focus()}const qe={getAndReset:(e,s)=>{const t=x.getItem(C.RestoreMessageAfterOauthRedirect);return x.removeItem(C.RestoreMessageAfterOauthRedirect),!t||t.userId!==e||s!==t.serverThreadId||Date.now()>t.expiresAt?null:t},set:(e,s,t)=>{const n={userId:e,serverThreadId:s,inputText:t,expiresAt:Date.now()+6e4};x.setItem(C.RestoreMessageAfterOauthRedirect,n)}},Qe=()=>P.useState(P.getPersistedSystemHints).has(v.Search),We=()=>{const e=P.useStore(),s=m.useCallback(()=>e.getPersistedSystemHintTrigger(v.Search),[e]),t=m.useCallback(()=>e.clearPersistedSystemHintTrigger(v.Search),[e]),n=m.useCallback((a,r,l)=>{(a?e.addPersistedSystemHint:e.removePersistedSystemHint)(v.Search,r,l)},[e]);return{getSearchModeTrigger:s,clearSearchModeTrigger:t,setThreadSearchMode:n}},Xe=(e,s,t)=>e?"file_upload_pending":s?t?"text_content_too_long":void 0:"empty_text_content",Pe=e=>e.replace(/[\u{E0000}-\u{E007F}]+/gu,""),ze=e=>{const s=Pe(e.getContentToSend().content);return Math.ceil(s.length/4)},Oe=1e3;function Ze(e){return e&&e.length>Oe&&!de().shift&&k.checkGate("1508312659")}export{F as C,Ue as D,qe as P,Ce as T,Fe as a,He as b,We as c,I as d,Te as e,Ye as f,Qe as g,Ke as h,Ze as i,ze as j,Pe as k,Xe as l,Ve as r,Ge as s,$e as t,Se as u};
//# sourceMappingURL=dju2beh95xc26ne4.js.map
