import{r as o,D as F,j as e,b5 as L,W as q,P as S,F as E,c as u,z as K,as as J,cw as Y,el as Z,aA as ee,U as f,em as te,en as se}from"./iryvtox9frru8zal.js";import{c as H,T as ae,d as R,a as ne,C as re,b as oe,F as ie,g as le}from"./hkc6ktibfw2w83ws.js";import{T as ce,R as de,bf as O,aE as W,aX as me,aY as B,bg as ue,bh as fe}from"./ju8uhwb40r1gh3q5.js";import{c as xe}from"./i7imfmvlw2tpm5ab.js";import{S as k}from"./ff1jihia30cviggy.js";import{br as z,bV as D,d2 as pe,r as A,d3 as U,B as he,bU as T}from"./ibpo4l2zkh6u1ih1.js";import{C as G}from"./jfohr2iyl3lnygl8.js";import{u as ge,y as je,v as be,x as ye,Q as ve}from"./klae3o32p1l6wsb0.js";import{m as _}from"./huvolgphco6l4rty.js";import"./bef1v5lirq1cbcr2.js";import"./ndvwxxk0s9s8lao0.js";import"./nm04jgpfyxi6pn12.js";import"./n1yksj50403rmrub.js";import"./gr0sdntlncvsozwg.js";import"./w02x0qxu750r2xzd.js";import"./mf6g7tm9dubb0dmt.js";import"./iwd0icm3lsqsqxx8.js";import"./czgd79kfog1dyt49.js";import"./gmujrpfl3j0k2ye1.js";import"./eovub15q8ucryed9.js";import"./ob0adlimgokiq43t.js";import"./kptcb3p9npo4cgga.js";import"./j8hlry24mn5b67g9.js";import"./l10u0lbuaglz65cp.js";function we(t){const s=o.useRef(!1);return()=>{s.current||(t(),s.current=!0)}}const P=300,Ce=350;function tt({visualization:t,clientThreadId:s,expanded:i=!1}){return t.type==="chart"?t.fallback_image==null?(F.addError("Chart visualizations require a fallback image message"),null):t.fallback_to_image?t.fallback_image==null?(F.addError("No fallback image message provided for fallback chart"),null):e.jsx(De,{visualization:t,expanded:i,clientThreadId:s}):e.jsx(Ae,{visualization:t,clientThreadId:s,expanded:i}):t.type==="table"?e.jsx(ke,{visualization:t,expanded:i,clientThreadId:s}):(F.addError("Unsupported visualization type",t.type),null)}function ke({visualization:t,expanded:s,clientThreadId:i}){const l=z(),r=l&&!s,{isLoading:x,data:a,isError:j}=ge(t),[c,p]=o.useState(),h=o.useCallback(()=>{a&&H(a.download_url)},[a]),[m,w]=o.useState(0),[C,N]=o.useState(0),g=o.useRef(null);let d;a&&(Array.isArray(a.content)?d=a.content.find(n=>n.name===c)??a.content[0]:d=a.content);const b=()=>{g.current&&N(g.current.offsetWidth)};return o.useEffect(()=>(b(),window.addEventListener("resize",b),()=>window.removeEventListener("resize",b)),[]),o.useEffect(()=>{const n=()=>{const v=window.innerHeight-48;w(v)};return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),j?e.jsx(Q,{fileName:t.title}):e.jsx(I,{ref:g,focusObject:{type:D.ADAVisualization,visualization:t},title:e.jsxs(e.Fragment,{children:[t.title,!r&&Array.isArray(a==null?void 0:a.content)&&e.jsxs(k.Root,{defaultValue:c,onValueChange:n=>{p(n)},children:[e.jsxs(k.Trigger,{className:"m-0 h-4 bg-transparent p-1 text-xs font-semibold",children:[c??a.content[0].name,e.jsx(k.Icon,{})]}),e.jsx(k.Portal,{children:e.jsx(k.Content,{children:a.content.map(n=>e.jsx(k.Item,{className:"text-xs font-semibold",value:n.name??"",children:n.name},n.name))})})]})]}),onDownload:h,expanded:s,clientThreadId:i,children:x||d==null?e.jsx("div",{className:"flex w-full items-center justify-center",children:e.jsx(L,{})}):e.jsx("div",{className:"border-t border-token-border-light",children:e.jsx(ae,{table:{...d,name:t.title,sheetName:c},height:s?m:P,width:C,isInFocusedView:l})})})}function Ne({showStatic:t,setShowStatic:s}){return e.jsx(A,{side:"top",sideOffset:4,label:t?e.jsx(f,{id:"o0thnT",defaultMessage:"Switch to interactive chart"}):e.jsx(f,{id:"cigiQO",defaultMessage:"Switch to static chart"}),children:e.jsx("button",{className:"flex",onClick:()=>{s(!t)},children:t?e.jsx(me,{className:"icon-md text-token-text-tertiary hover:text-token-text-primary"}):e.jsx(B,{className:"icon-md text-token-text-tertiary hover:text-token-text-primary"})})})}function Se({type:t}){return e.jsx(Ee,{children:t==="chart"?e.jsxs(e.Fragment,{children:[e.jsx(f,{id:"XBhWwK",defaultMessage:"Now interactive! (Beta)"})," ",e.jsx(B,{className:"icon-md"})]}):e.jsx(f,{id:"N0TMRs",defaultMessage:"Now interactive!"})})}const Ee=q.div`flex flex-shrink-0 cursor-pointer flex-nowrap items-center gap-1 rounded-lg bg-blue-selection/[0.1] py-1 pl-2 pr-1.5 text-xs font-semibold text-blue-selection`;function Ae({visualization:t,clientThreadId:s,expanded:i}){const{isLoading:l,data:r,isError:x}=je(t),a=o.useRef(null),j=be(),[c,p]=o.useState(!j),h=o.useCallback(async()=>{if(c&&t.fallback_image)S.logEvent(E.adaDownloadedStaticChart),await R(t.fallback_image);else if(a.current){const d=a.current.getBase64Image();d&&(S.logEvent(E.adaDownloadedInteractiveChart),H(d,`${t.title}.png`))}},[t.fallback_image,c,a,t.title]),[m,w]=o.useState(void 0),C=xe(s),N=we(()=>{S.logEvent(E.adaToggledInteractiveChart,{conversationId:C})}),g=d=>{N(),p(d)};return o.useEffect(()=>{S.logEvent(E.adaInteractiveChartShown)},[]),o.useEffect(()=>{if(r&&r.content!==m){const{chart_type:d,datasets:b,labels:n}=r.content,y=r.content;y.datasets=b.map((v,V)=>{const M=ne(d,v,V);return{...v,colors:M}}),y.labels=Array.isArray(n)?n:[n],w(y)}},[m,r]),x?e.jsx(Q,{fileName:t.title}):e.jsx(I,{focusObject:{type:D.ADAVisualization,visualization:t},title:t.title,onDownload:h,additionalActions:[e.jsx(Ne,{showStatic:c,setShowStatic:g},0),e.jsx(re,{chartData:m,setChartData:w},1)],expanded:i,clientThreadId:s,children:l||m==null?e.jsx("div",{className:"flex w-full items-center justify-center",children:e.jsx(L,{})}):c&&t.fallback_image?e.jsx(G,{jupyterMessage:t.fallback_image}):e.jsx(oe,{ref:a,chart:m})})}function De({visualization:t,expanded:s,clientThreadId:i}){const[l,r]=o.useState(!1),x=ye(),a=o.useCallback(async()=>{t.fallback_image&&await R(t.fallback_image)},[t.fallback_image]);return t.fallback_image==null?null:e.jsx(I,{focusObject:{type:D.ADAVisualization,visualization:t},title:t.title,onDownload:a,expanded:s,clientThreadId:i,children:e.jsx("div",{className:u("h-full w-full",s&&"cursor-pointer items-center justify-center"),onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:e.jsxs("div",{className:u("relative flex h-full cursor-pointer items-center justify-center",!s&&"w-full"),children:[e.jsx(G,{jupyterMessage:t.fallback_image}),x&&e.jsx(ie,{isHovered:l})]})})})}const I=K.forwardRef(({focusObject:t,title:s="",onDownload:i=()=>{},additionalActions:l=[],expanded:r=!1,clientThreadId:x,children:a},j)=>{const c=z(),p=pe(),h=p&&p.type===D.ADAVisualization&&p.type===t.type&&p.visualization.file_id===t.visualization.file_id&&t.visualization.title===p.visualization.title,m=J(),w=t.visualization.type,[C,N]=ve(w,(m==null?void 0:m.id)??""),g=Y(),d=Z(),b=ee(),n=t.visualization.type,{sourceUrl:y,contextConnectorName:v}=le(t.visualization);if(c&&!r||g)return e.jsx(Ie,{focusObject:t,title:s,type:n,isFocused:h??!1,disabled:g});const V=e.jsxs(e.Fragment,{children:[l.map((M,$)=>e.jsx("div",{className:"flex p-0",children:M},$)),y&&v&&e.jsx(A,{side:"top",sideOffset:4,label:e.jsx(f,{id:"KG958Q",defaultMessage:"Open in {contextConnectorName}",values:{contextConnectorName:v}}),children:e.jsx("a",{className:"flex items-center text-xs",href:y,target:"_blank",rel:"noreferrer",children:e.jsx(ce,{className:u("icon-md text-token-text-tertiary hover:text-token-text-primary")})})}),i&&e.jsx(A,{side:"top",sideOffset:4,label:e.jsx(f,{id:"X0SJIT",defaultMessage:"Download {type}",values:{type:n}}),children:e.jsx("button",{onClick:i,className:"flex items-center text-xs",children:e.jsx(de,{className:u("icon-md text-token-text-tertiary hover:text-token-text-primary")})})}),e.jsx(A,{side:"top",sideOffset:4,label:h?e.jsx(f,{id:"vilGuu",defaultMessage:"Collapse {type}",values:{type:n}}):e.jsx(f,{id:"7kLyF5",defaultMessage:"Expand {type}",values:{type:n}}),children:e.jsx("button",{onClick:()=>{te&&d?(b(`/c/${x}`,{state:{focusObject:t}}),se(!1,{focusMainWindow:!0})):X(h??!1,t)},className:"flex items-center text-xs",children:h?e.jsx(O,{className:u("icon-md text-token-text-tertiary hover:text-token-text-primary")}):e.jsx(W,{className:u("icon-md text-token-text-tertiary hover:text-token-text-primary")})})})]});return e.jsxs(_.div,{className:u("relative overflow-hidden border-token-border-light text-token-text-primary",!r&&"rounded-2xl border"),ref:j,onMouseEnter:()=>{N(!0)},...U,children:[e.jsxs("div",{className:u("flex items-center justify-between gap-2 bg-token-main-surface-primary px-4 py-3"),children:[e.jsx("span",{className:"flex-grow items-center truncate font-semibold capitalize",children:s}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{children:!C&&e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",ease:"easeInOut",duration:.2},className:"absolute right-3 top-3",children:e.jsx(Se,{type:n})})}),C&&V]})]}),e.jsx("div",{className:"flex items-center justify-center bg-token-main-surface-primary",style:{height:r?"calc(100vh - 48px)":`${n==="table"?P:Ce}px`},children:a})]})});I.displayName="ADAVisualizationWrapper";function Ie({focusObject:t,title:s="",type:i,isFocused:l,disabled:r=!1}){const[x,a]=o.useState(!1),j=i==="chart"?ue:fe,c=l||x||r;return e.jsx(_.div,{className:u("relative w-52 overflow-hidden rounded-2xl border",l&&"border-blue-selection/[.3]",c?"text-token-text-primary":"text-token-text-secondary",!r&&"cursor-pointer"),onMouseEnter:()=>{r||a(!0)},onMouseLeave:()=>{r||a(!1)},onClick:()=>{r||X(l,t)},...U,children:e.jsxs("div",{className:"flex justify-between bg-token-main-surface-primary px-3 py-2",children:[e.jsxs("div",{className:"my-0 flex w-full items-center gap-2 overflow-hidden text-sm font-semibold capitalize",children:[e.jsx(j,{className:u("icon-lg flex-shrink-0",c?"text-brand-green-800":"text-token-text-quaternary")}),e.jsx("span",{className:"flex-grow truncate",children:s})]}),x&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(A,{side:"top",sideOffset:4,label:l?e.jsx(f,{id:"vilGuu",defaultMessage:"Collapse {type}",values:{type:i}}):e.jsx(f,{id:"7kLyF5",defaultMessage:"Expand {type}",values:{type:i}}),children:l?e.jsx(O,{className:"icon-md icon-md text-token-text-secondary"}):e.jsx(W,{className:u("icon-md text-token-text-secondary")})})})]})})}function Q({fileName:t=""}){return e.jsx("div",{className:"w-full rounded-2xl border border-red-600 p-3",children:e.jsxs("div",{className:"my-0 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("p",{className:"m-0 p-0 text-lg font-semibold capitalize",children:t})}),e.jsx("span",{className:"text-sm text-red-600",children:e.jsx(f,{id:"ADAVisualzationComponent.unableToLoadOutput",defaultMessage:"Unable to display visualization"})})]})})}const X=(t,s)=>{S.logEvent(E.adaFocusModeToggled),t?T.close():T.setFocusedObject(s)};export{tt as default};
//# sourceMappingURL=o1fyzl7usupvnpr8.js.map
