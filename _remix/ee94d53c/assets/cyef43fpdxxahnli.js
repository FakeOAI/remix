import{G as w,M as k,gc as a,m as r,q as b,aC as S,gd as j,L as _,aM as E}from"./ndi7jo66fl6rg84p.js";import{aY as v,aX as Q,aZ as F,a_ as q,aJ as B,a$ as L}from"./id0jk80okmzlid6x.js";import{O as T,j as N}from"./idygk0c4cylpz8ae.js";import{a as p,T as O}from"./iqerz6k3sbqq2l34.js";import{m as D}from"./ehxtjemwqtjnagpv.js";function te({messages:e,isRequestActive:t,isLastMessageInTurn:n,isRetrieval:o,isUsingGizmo:i}){const u=e.map(g=>g.message),f=U(u),l=f.filter(g=>I(g,!1)),c=l[l.length-1]??void 0,s=w();if(V(u).some(({content:g})=>g.content_type===k.SystemError))return null;let m=p.Running;const y=l.filter(g=>g.type===a.Search).length,h={count:l.length-y,domain:c?v(M(c)??""):void 0,query:c?C(c):void 0};let d=o?i?s.formatMessage({id:"browsingMessage.searchingKnowledge",defaultMessage:"Searching my knowledge"}):s.formatMessage({id:"browsingMessage.startingRetrieval",defaultMessage:"Reading documents"}):s.formatMessage({id:"message.tools.browse.running",defaultMessage:"Searching the web"});return u.some(Q)?(m=p.Stopped,d=o?i?s.formatMessage({id:"browsingMessage.searchingKnowledgeStopped",defaultMessage:"Stopped searching knowledge"}):s.formatMessage({id:"browsingMessage.retrievalStopped",defaultMessage:"Stopped reading documents"}):s.formatMessage({id:"message.tools.browse.stopped",defaultMessage:"Search stopped"})):!n||!t?f.length>0&&f.every(g=>g.didError)?(m=p.Error,d=o?i?s.formatMessage({id:"browsingMessage.searchingKnowledgeFailed",defaultMessage:"Error searching knowledge"}):s.formatMessage({id:"browsingMessage.retrievalFailed",defaultMessage:"Error reading documents"}):s.formatMessage({id:"message.tools.browse.failed",defaultMessage:"Search failed"})):(m=p.Finished,d=o?null:h.count===0?s.formatMessage({id:"message.tools.browse.started",defaultMessage:"Searching the web..."}):s.formatMessage({id:"message.tools.browse.finished",defaultMessage:"Searched {count, plural, =0 {0 sites} one {# site} other {# sites}}"},h)):l.length>0&&(d=A(s,h,o,i,l[l.length-1])),(l.length>0||o&&n)&&m!==p.Error?r.jsx(O,{highlightedCommand:d,showWorkUserSetting:!1,status:m,children:l.length===0?null:r.jsx(W,{commands:l})}):r.jsx(J,{$isError:m===p.Error,children:d})}function x(e){return e.metadata?.command==="quote"||e.metadata?.command==="quote_full"||e.metadata?.command==="quote_lines"}function U(e){return e.map((t,n)=>{if(t.author.role!==b.Tool||n>0&&x(t)&&x(e[n-1]))return null;const o=t.metadata;if(!o)return null;const{command:i,status:u}=o;return i?{type:i,status:u,didError:t.content.content_type===k.SystemError,message:t}:null}).filter(F)}function W({commands:e}){const t=w(),n=e.map(M).filter(i=>i!=null),o=q(n);return r.jsx("div",{className:"mb-4 divide-y divide-token-border-light rounded-xl border border-token-border-light text-sm",children:r.jsx(B,{initial:!1,children:e.map((i,u)=>{const f=P(i);if(f==null)return null;const{icon:l,url:c,title:s,externalLink:m}=f,y=c?v(c):void 0,h=s?typeof s=="string"?s:t.formatMessage(s):null,d=c?o.get(c):null;return r.jsx(D.div,{initial:"collapsed",animate:"open",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:r.jsxs($,{url:m??c,className:S("flex items-start gap-3 px-4 py-3",s?"text-token-text-secondary":"text-token-text-primary",u===0&&"rounded-t-xl",u===e.length-1&&"rounded-b-xl"),children:[l?r.jsx(l,{className:"icon-sm mt-0.5 flex-shrink-0 text-token-text-secondary"}):c?r.jsx(L,{url:c,className:"mt-1"}):null,r.jsxs("div",{children:[h&&r.jsxs("div",{className:"line-clamp-1 text-token-text-primary",children:[d&&`${d} — `,h]}),r.jsx("div",{children:y})]})]})},u)})})})}function $({url:e,children:t,className:n}){return e?r.jsxs("a",{href:e,target:"_blank",className:S(n,"group relative hover:bg-token-main-surface-secondary"),rel:"noreferrer",children:[t,r.jsx("div",{className:"invisible absolute right-3 bg-gradient-to-l from-token-main-surface-secondary to-transparent pl-4 group-hover:visible",children:r.jsx(T,{className:"icon-md text-token-text-secondary"})})]}):r.jsx("div",{className:n,children:t})}function K(e){const t=e.message.metadata?._cite_metadata?.metadata_list[0];return t!=null&&t.type!=="file"?t.title:null}function C(e){return e.message.metadata?.args?.[0]}function P(e){switch(e.type){case a.Search:{const t=e.message.metadata?.search_engine;if(t&&t!==j.Bing)return null;const n=C(e);return{icon:N,url:e.message.metadata?.message_source==="apple"?null:"bing.com",externalLink:R(e),title:n?`“${n}”`:{id:"message.tools.browse.querying",defaultMessage:"Querying",description:"Status message when issuing a query"}}}case a.Click:case a.MultiClick:case a.Lookup:case a.OpenUrl:case a.Open:case a.Quote:case a.QuoteFull:case a.QuoteLines:case a.Scroll:return{url:M(e),title:K(e)??void 0};case a.Back:return null}}function R(e){const t=e.message.metadata?.args?.[0];return t===void 0?null:_.getBingLink({query:t})}function A(e,t,n,o,i){switch(i?.type){case a.Click:case a.MultiClick:case a.Lookup:case a.OpenUrl:case a.Quote:case a.QuoteFull:case a.QuoteLines:case a.Scroll:case a.Open:case a.Back:return e.formatMessage({id:"message.tools.browse.reading",defaultMessage:"Browsing {domain}"},t);case a.Search:case void 0:return n?o?e.formatMessage({id:"browsingMessage.searchingKnowledge",defaultMessage:"Searching my knowledge"}):e.formatMessage({id:"browsingMessage.startingRetrieval",defaultMessage:"Reading documents"}):e.formatMessage({id:"message.tools.browse.searching",defaultMessage:'Searching "{query}"'},t)}}function H(e){const t=e.message.metadata?._cite_metadata?.metadata_list[0];return t!=null&&t.type==="file"?t.name:null}function I(e,t){switch(e.type){case a.Search:return!0;case a.Click:case a.Lookup:case a.MultiClick:case a.OpenUrl:case a.Quote:case a.QuoteFull:case a.QuoteLines:return t?H(e)!=null:M(e)!=null;case a.Open:case a.Back:case a.Scroll:return!1}}function M(e){const t=e.message.metadata?._cite_metadata?.metadata_list[0];return t!=null&&t.type!=="file"?t.url:null}function V(e){return e.filter(t=>t.author.role===b.Tool)}const J=E.p`first:mt-0 my-1.5 h-8 flex items-center ltr:mr-auto rtl:ml-auto empty:hidden
${({$isError:e})=>e?"text-token-text-error":"text-token-text-secondary"}`;export{te as BrowsingMessage,M as getVisitedUrl};
//# sourceMappingURL=cyef43fpdxxahnli.js.map
