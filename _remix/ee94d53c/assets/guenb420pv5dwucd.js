const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/f3qvtxwg4ex6ln5f.js","assets/ndi7jo66fl6rg84p.js","assets/idygk0c4cylpz8ae.js","assets/root-nt0zomoh.css","assets/id0jk80okmzlid6x.js","assets/conversation-small-lkohtmkm.css","assets/bnpbomw6cydrb33m.js","assets/k36rydz7z5bbu6op.js","assets/n98jufv3fvbl4o30.js","assets/ehxtjemwqtjnagpv.js","assets/dd81nt91qkljvod4.js","assets/mwg8ab4hw6kwwcgx.js","assets/e3j5vlkw389xpd5h.js","assets/oaio6pzd5tecbxee.js","assets/f56ma2rzioew0qzv.js","assets/iqerz6k3sbqq2l34.js","assets/kuu5evo2olx33ew4.js","assets/fzrn137102spawew.js","assets/kqzgw3u8fmknuj68.js","assets/k1mvqz0lev3ndwtx.js","assets/en6i8rr4ow69xfv9.js","assets/ly71pzcqzy3n3dev.js","assets/ov37wiznpcztdnaq.js","assets/jllv275n0fi4nzxi.js","assets/k7cxagc633xjpehl.js","assets/textdoc-sandpack-code-preview-mk0lbw6o.css","assets/iq632wi3g3rzig3o.js"])))=>i.map(i=>d[i]);
import{m as b,bM as ba,bN as xa,aH as ya,F as we,G as Ct,bJ as wa,aT as ne,bK as va,dg as Sa,aC as tt,c as Ca,eq as B,aI as oo,aJ as lo,r as v,aZ as Be,aK as me,n as ai,bo as ka,b as Ds,gK as Ma,ba as Ue,ay as Aa,az as Ta,q as Rs,C as Ea,H as Oa,e5 as Da,o as Ps,L as Ra,go as ao,i2 as Pa,cj as Na,ck as La,cl as Ia,a9 as Ba,R as ho,x as Ha,i3 as _n,w as co,al as Va,l as Fa,aA as ja,aB as Wa,es as qa,$ as _a}from"./ndi7jo66fl6rg84p.js";import{c5 as za,c6 as $a,l as ge,bM as Ka,nT as Ua,l5 as Ns,aZ as uo,dX as Ga,dY as Ya,nU as Xa,m as jt,nV as Ja,bc as Mt,l7 as Qa,nW as Ae,t as Za,nX as th,nY as eh,nZ as ft,n_ as ih,n5 as sh,jQ as nh,n$ as fo,aJ as Ui,hn as go,ho as Te,k0 as rh,fy as oh,o0 as lh,bP as Gi,de as ah,av as wn,o1 as hh,o2 as mo,o3 as po,bq as ch,bA as uh,br as fh,bz as dh,jp as gh,iK as mh,bb as ph,o4 as bh,o5 as bo,o6 as xh,o7 as yh,n as wh,o8 as vh,o9 as Sh,oa as Ch,fF as Je,ob as kh,oc as Mh,ft as Ah,od as Th,fv as Eh,oe as Oh,i as Dh,of as Rh,og as Ph,oh as Nh,oi as Lh,oj as Ih,j as Bh,k as Hh,ok as Vh,ol as Fh,om as jh,g as Wh,on as qh,oo as _h,op as zn,mC as zh,oq as Ai,or as $n}from"./id0jk80okmzlid6x.js";import{bC as $h,c2 as Kh,b2 as Uh,c3 as Gh,c4 as Yh,c5 as Xh,a6 as Jh,F as Qh,c6 as Zh,bD as tc,c7 as ec,b9 as ic,c8 as sc,c9 as nc,ca as rc,af as rs,ae as oc,at as lc,aj as ac,bB as hc,cb as cc,cc as uc}from"./idygk0c4cylpz8ae.js";import{m as $}from"./ehxtjemwqtjnagpv.js";import{e as fc,m as dc,H as gc,a as xo,Z as mc,O as yo,N as pc,c as Ee,g as bc,A as xc,b as yc,d as wc,C as Ce,D as vc}from"./dd81nt91qkljvod4.js";import"./f56ma2rzioew0qzv.js";import{E as Sc,d as Cc,C as kc}from"./iqerz6k3sbqq2l34.js";import{i as Mc}from"./kuu5evo2olx33ew4.js";import{L as Ac}from"./k1mvqz0lev3ndwtx.js";import{P as Tc}from"./e3j5vlkw389xpd5h.js";import{u as Ec}from"./en6i8rr4ow69xfv9.js";import{u as Oc}from"./ly71pzcqzy3n3dev.js";import{u as Kn}from"./ov37wiznpcztdnaq.js";var wo=(n=>(n.Close="close",n.Loaded="loaded",n.Streaming="streaming",n.Download="download",n))(wo||{});const os="https://persistent.oaistatic.com/canvas/nux-videos/",Dc=`${os}canvas_writing.mp4`,Rc=`${os}canvas_coding.mp4`,Pc=`${os}canvas_writing_hero.jpg`,Nc=`${os}canvas_coding_hero.jpg`,Lc="https://help.openai.com/en/articles/9930697-what-is-the-canvas-feature-in-chatgpt-and-how-do-i-use-it",Ic=({onClose:n,title:t,description:e,asset:i,size:s})=>{const r=Ct(),o=i===0;return b.jsxs("div",{className:"flex flex-col items-center focus:outline-none",children:[b.jsx("div",{className:"relative flex w-full items-center justify-center overflow-hidden border-b border-token-border-light bg-token-main-surface-secondary text-token-text-secondary",style:{height:s===1?252:218},children:b.jsx("video",{muted:!0,loop:!0,autoPlay:!0,playsInline:!0,className:"h-full max-w-none",poster:o?Pc:Nc,src:o?Dc:Rc})}),b.jsxs("div",{className:"flex flex-col items-center gap-4 px-10 py-8",children:[b.jsxs("div",{className:"flex flex-col gap-2",children:[b.jsx(wa,{className:"text-center text-xl font-semibold leading-6",children:b.jsx(ne,{...t})}),b.jsx(va,{className:"text-center text-sm text-token-text-secondary",children:b.jsx(ne,{...e})})]}),b.jsx(Sa.Button,{onClick:n,title:r.formatMessage(Oe.button),color:"primary"}),b.jsxs(Ka,{href:Lc,className:"flex items-center gap-1 font-medium",children:[b.jsx(ne,{...Oe.learnMore}),b.jsx($h,{className:"icon-sm"})]})]})]})},Bc=({textdocType:n})=>{const{markAsViewed:t}=za($a.hasDismissedCanvasContextualOnboarding);return b.jsx(ba,{open:!0,defaultOpen:!0,modal:!1,children:b.jsx(xa,{container:ya()?.document.body,children:b.jsx($.div,{initial:{opacity:.75,scale:.9},animate:{opacity:1,scale:1},transition:{type:"spring",bounce:.2,duration:.56},className:"popover fixed bottom-4 right-4 z-50 max-w-sm overflow-hidden rounded-2xl border border-token-border-light bg-token-main-surface-primary shadow-xl",children:b.jsx(Ic,{onClose:t,asset:ge(n)?1:0,size:0,title:ge(n)?Oe.contextualModalTitleCoding:Oe.contextualModalTitleWriting,description:ge(n)?Oe.contextualModalDescriptionCoding:Oe.contextualModalDescriptionWriting})})})})},Oe=we({blockingModalTitle:{id:"euF+gX",defaultMessage:"Create and edit on an interactive canvas"},blockingModalDescription:{id:"yN6g+K",defaultMessage:"Collaborate with ChatGPT to write and code in a dedicated space."},contextualModalTitleWriting:{id:"Pi+0RT",defaultMessage:"Draft and refine on the spot"},contextualModalDescriptionWriting:{id:"Jv0f02",defaultMessage:"Make it shorter. Add an emoji. Translate to kindergartener. ChatGPT can do it all, right on the canvas."},contextualModalTitleCoding:{id:"Zi5Ty0",defaultMessage:"Refine and debug on the spot"},contextualModalDescriptionCoding:{id:"XnaO2x",defaultMessage:"Refactor code. Translate to Python. Check for bugs. ChatGPT can do it all, right on the canvas."},button:{id:"7bNl4/",defaultMessage:"Got it"},learnMore:{id:"vs1lx2",defaultMessage:"Learn more about canvas"}});function Hc(n,t,e){const i=new Map;return n.forEach((s,r)=>{const o=Ua(s,t,e);o&&i.set(r,o)}),i}function Vc(n,t){const e=Wc(n);if(e.length===0)return t;let i=t;return e.forEach(s=>{i=Fc(s,i)}),i}function Fc(n,t){return Hc(t,{start:n.fromA,end:n.toA},jc(n))}function jc(n){const{fromA:t,toA:e,fromB:i,toB:s}=n;return s-i-(e-t)}function Wc(n){const t=[],e=(i,s,r,o)=>{t.push({fromA:i,toA:s,fromB:r,toB:o})};return n.changes.iterChangedRanges(e,!0),t}function qc(n,t){const e=Array.from(n.keys()),i=Array.from(t.keys());if(e.length!==i.length)return!1;e.sort(),i.sort();for(let s=0;s<e.length;s++)if(e[s]!==i[s])return!1;for(const s of e){const r=n.get(s),o=t.get(s);if(!r||!o||r.start!==o.start||r.end!==o.end)return!1}return!0}function _c(n,t){return{"bg-yellow-100 dark:bg-yellow-400":!0,"bg-opacity-40 bg-yellow-400 dark:bg-yellow-400 dark:bg-opacity-50":n&&!t,"bg-opacity-60 bg-yellow-400 dark:bg-yellow-500 dark:bg-opacity-70":t,"bg-yellow-100 dark:bg-yellow-400 dark:bg-opacity-30":!n&&!t}}const zc={"!bg-transparent":!0};function $c({isHovered:n,isFocused:t,isCode:e,diffStatus:i}){return tt(e?fc:dc,"cursor-text group is-comment transition-colors",{...i===Ns.REMOVED?zc:_c(n,t)},"group-[.is-comment]:bg-opacity-40")}function Kc(n,t){return n.map(e=>{const i=t.get(e.id);return i?{...e,at:i}:null}).filter(uo)}var st=(n=>(n.ASK="ask",n.CREATE_TEXTDOC="create_textdoc",n.COMMENT="comment",n.EDIT="edit",n))(st||{}),Ls=(n=>(n.SELECTION="selection",n.BLOCK="block",n))(Ls||{});function mm(n){return n?.type==="selection"}const Uc=Ca(()=>({commentingOn:null,hoveredCommentId:null,focusedCommentId:null,visibleBlockCommentLauncher_DEBUG_ONLY:null,hoveredBlockCommentLauncherPos:null})),{setState:Bt,getInitialState:Gc}=Uc,pe={reset:()=>Bt(Gc()),startCommentingOn:n=>Bt(t=>({...t,commentingOn:n})),cancelCommentingOn:()=>Bt(n=>({...n,commentingOn:null})),focusComment:n=>Bt(t=>({...t,focusedCommentId:n})),blurComment:()=>Bt(n=>({...n,focusedCommentId:null})),mouseEnterComment:n=>Bt(t=>({...t,hoveredCommentId:n})),mouseLeaveComment:()=>Bt(n=>({...n,hoveredCommentId:null})),mouseEnterBlock:n=>Bt(t=>({...t,hoveredBlockCommentLauncherPos:n})),mouseLeaveBlock:()=>Bt(n=>({...n,hoveredBlockCommentLauncherPos:null})),setVisibleBlockComment_DEBUG_ONLY:n=>Bt(t=>({...t,visibleBlockCommentLauncher_DEBUG_ONLY:n}))};class L{lineAt(t){if(t<0||t>this.length)throw new RangeError(`Invalid position ${t} in document of length ${this.length}`);return this.lineInner(t,!1,1,0)}line(t){if(t<1||t>this.lines)throw new RangeError(`Invalid line number ${t} in ${this.lines}-line document`);return this.lineInner(t,!0,1,0)}replace(t,e,i){[t,e]=He(this,t,e);let s=[];return this.decompose(0,t,s,2),i.length&&i.decompose(0,i.length,s,3),this.decompose(e,this.length,s,1),Vt.from(s,this.length-(e-t)+i.length)}append(t){return this.replace(this.length,this.length,t)}slice(t,e=this.length){[t,e]=He(this,t,e);let i=[];return this.decompose(t,e,i,0),Vt.from(i,e-t)}eq(t){if(t==this)return!0;if(t.length!=this.length||t.lines!=this.lines)return!1;let e=this.scanIdentical(t,1),i=this.length-this.scanIdentical(t,-1),s=new ii(this),r=new ii(t);for(let o=e,l=e;;){if(s.next(o),r.next(o),o=0,s.lineBreak!=r.lineBreak||s.done!=r.done||s.value!=r.value)return!1;if(l+=s.value.length,s.done||l>=i)return!0}}iter(t=1){return new ii(this,t)}iterRange(t,e=this.length){return new vo(this,t,e)}iterLines(t,e){let i;if(t==null)i=this.iter();else{e==null&&(e=this.lines+1);let s=this.line(t).from;i=this.iterRange(s,Math.max(s,e==this.lines+1?this.length:e<=1?0:this.line(e-1).to))}return new So(i)}toString(){return this.sliceString(0)}toJSON(){let t=[];return this.flatten(t),t}constructor(){}static of(t){if(t.length==0)throw new RangeError("A document must have at least one line");return t.length==1&&!t[0]?L.empty:t.length<=32?new Y(t):Vt.from(Y.split(t,[]))}}class Y extends L{constructor(t,e=Yc(t)){super(),this.text=t,this.length=e}get lines(){return this.text.length}get children(){return null}lineInner(t,e,i,s){for(let r=0;;r++){let o=this.text[r],l=s+o.length;if((e?i:l)>=t)return new Xc(s,l,i,o);s=l+1,i++}}decompose(t,e,i,s){let r=t<=0&&e>=this.length?this:new Y(Un(this.text,t,e),Math.min(e,this.length)-Math.max(0,t));if(s&1){let o=i.pop(),l=Fi(r.text,o.text.slice(),0,r.length);if(l.length<=32)i.push(new Y(l,o.length+r.length));else{let a=l.length>>1;i.push(new Y(l.slice(0,a)),new Y(l.slice(a)))}}else i.push(r)}replace(t,e,i){if(!(i instanceof Y))return super.replace(t,e,i);[t,e]=He(this,t,e);let s=Fi(this.text,Fi(i.text,Un(this.text,0,t)),e),r=this.length+i.length-(e-t);return s.length<=32?new Y(s,r):Vt.from(Y.split(s,[]),r)}sliceString(t,e=this.length,i=`
`){[t,e]=He(this,t,e);let s="";for(let r=0,o=0;r<=e&&o<this.text.length;o++){let l=this.text[o],a=r+l.length;r>t&&o&&(s+=i),t<a&&e>r&&(s+=l.slice(Math.max(0,t-r),e-r)),r=a+1}return s}flatten(t){for(let e of this.text)t.push(e)}scanIdentical(){return 0}static split(t,e){let i=[],s=-1;for(let r of t)i.push(r),s+=r.length+1,i.length==32&&(e.push(new Y(i,s)),i=[],s=-1);return s>-1&&e.push(new Y(i,s)),e}}class Vt extends L{constructor(t,e){super(),this.children=t,this.length=e,this.lines=0;for(let i of t)this.lines+=i.lines}lineInner(t,e,i,s){for(let r=0;;r++){let o=this.children[r],l=s+o.length,a=i+o.lines-1;if((e?a:l)>=t)return o.lineInner(t,e,i,s);s=l+1,i=a+1}}decompose(t,e,i,s){for(let r=0,o=0;o<=e&&r<this.children.length;r++){let l=this.children[r],a=o+l.length;if(t<=a&&e>=o){let c=s&((o<=t?1:0)|(a>=e?2:0));o>=t&&a<=e&&!c?i.push(l):l.decompose(t-o,e-o,i,c)}o=a+1}}replace(t,e,i){if([t,e]=He(this,t,e),i.lines<this.lines)for(let s=0,r=0;s<this.children.length;s++){let o=this.children[s],l=r+o.length;if(t>=r&&e<=l){let a=o.replace(t-r,e-r,i),c=this.lines-o.lines+a.lines;if(a.lines<c>>4&&a.lines>c>>6){let h=this.children.slice();return h[s]=a,new Vt(h,this.length-(e-t)+i.length)}return super.replace(r,l,a)}r=l+1}return super.replace(t,e,i)}sliceString(t,e=this.length,i=`
`){[t,e]=He(this,t,e);let s="";for(let r=0,o=0;r<this.children.length&&o<=e;r++){let l=this.children[r],a=o+l.length;o>t&&r&&(s+=i),t<a&&e>o&&(s+=l.sliceString(t-o,e-o,i)),o=a+1}return s}flatten(t){for(let e of this.children)e.flatten(t)}scanIdentical(t,e){if(!(t instanceof Vt))return 0;let i=0,[s,r,o,l]=e>0?[0,0,this.children.length,t.children.length]:[this.children.length-1,t.children.length-1,-1,-1];for(;;s+=e,r+=e){if(s==o||r==l)return i;let a=this.children[s],c=t.children[r];if(a!=c)return i+a.scanIdentical(c,e);i+=a.length+1}}static from(t,e=t.reduce((i,s)=>i+s.length+1,-1)){let i=0;for(let d of t)i+=d.lines;if(i<32){let d=[];for(let g of t)g.flatten(d);return new Y(d,e)}let s=Math.max(32,i>>5),r=s<<1,o=s>>1,l=[],a=0,c=-1,h=[];function u(d){let g;if(d.lines>r&&d instanceof Vt)for(let p of d.children)u(p);else d.lines>o&&(a>o||!a)?(f(),l.push(d)):d instanceof Y&&a&&(g=h[h.length-1])instanceof Y&&d.lines+g.lines<=32?(a+=d.lines,c+=d.length+1,h[h.length-1]=new Y(g.text.concat(d.text),g.length+1+d.length)):(a+d.lines>s&&f(),a+=d.lines,c+=d.length+1,h.push(d))}function f(){a!=0&&(l.push(h.length==1?h[0]:Vt.from(h,c)),c=-1,a=h.length=0)}for(let d of t)u(d);return f(),l.length==1?l[0]:new Vt(l,e)}}L.empty=new Y([""],0);function Yc(n){let t=-1;for(let e of n)t+=e.length+1;return t}function Fi(n,t,e=0,i=1e9){for(let s=0,r=0,o=!0;r<n.length&&s<=i;r++){let l=n[r],a=s+l.length;a>=e&&(a>i&&(l=l.slice(0,i-s)),s<e&&(l=l.slice(e-s)),o?(t[t.length-1]+=l,o=!1):t.push(l)),s=a+1}return t}function Un(n,t,e){return Fi(n,[""],t,e)}class ii{constructor(t,e=1){this.dir=e,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[t],this.offsets=[e>0?1:(t instanceof Y?t.text.length:t.children.length)<<1]}nextInner(t,e){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,s=this.nodes[i],r=this.offsets[i],o=r>>1,l=s instanceof Y?s.text.length:s.children.length;if(o==(e>0?l:0)){if(i==0)return this.done=!0,this.value="",this;e>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((r&1)==(e>0?0:1)){if(this.offsets[i]+=e,t==0)return this.lineBreak=!0,this.value=`
`,this;t--}else if(s instanceof Y){let a=s.text[o+(e<0?-1:0)];if(this.offsets[i]+=e,a.length>Math.max(0,t))return this.value=t==0?a:e>0?a.slice(t):a.slice(0,a.length-t),this;t-=a.length}else{let a=s.children[o+(e<0?-1:0)];t>a.length?(t-=a.length,this.offsets[i]+=e):(e<0&&this.offsets[i]--,this.nodes.push(a),this.offsets.push(e>0?1:(a instanceof Y?a.text.length:a.children.length)<<1))}}}next(t=0){return t<0&&(this.nextInner(-t,-this.dir),t=this.value.length),this.nextInner(t,this.dir)}}class vo{constructor(t,e,i){this.value="",this.done=!1,this.cursor=new ii(t,e>i?-1:1),this.pos=e>i?t.length:0,this.from=Math.min(e,i),this.to=Math.max(e,i)}nextInner(t,e){if(e<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;t+=Math.max(0,e<0?this.pos-this.to:this.from-this.pos);let i=e<0?this.pos-this.from:this.to-this.pos;t>i&&(t=i),i-=t;let{value:s}=this.cursor.next(t);return this.pos+=(s.length+t)*e,this.value=s.length<=i?s:e<0?s.slice(s.length-i):s.slice(0,i),this.done=!this.value,this}next(t=0){return t<0?t=Math.max(t,this.from-this.pos):t>0&&(t=Math.min(t,this.to-this.pos)),this.nextInner(t,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class So{constructor(t){this.inner=t,this.afterBreak=!0,this.value="",this.done=!1}next(t=0){let{done:e,lineBreak:i,value:s}=this.inner.next(t);return e&&this.afterBreak?(this.value="",this.afterBreak=!1):e?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=s,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(L.prototype[Symbol.iterator]=function(){return this.iter()},ii.prototype[Symbol.iterator]=vo.prototype[Symbol.iterator]=So.prototype[Symbol.iterator]=function(){return this});class Xc{constructor(t,e,i,s){this.from=t,this.to=e,this.number=i,this.text=s}get length(){return this.to-this.from}}function He(n,t,e){return t=Math.max(0,Math.min(n.length,t)),[t,Math.max(t,Math.min(n.length,e))]}let Re="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(n=>n?parseInt(n,36):1);for(let n=1;n<Re.length;n++)Re[n]+=Re[n-1];function Jc(n){for(let t=1;t<Re.length;t+=2)if(Re[t]>n)return Re[t-1]<=n;return!1}function Gn(n){return n>=127462&&n<=127487}const Yn=8205;function Wt(n,t,e=!0,i=!0){return(e?Co:Qc)(n,t,i)}function Co(n,t,e){if(t==n.length)return t;t&&ko(n.charCodeAt(t))&&Mo(n.charCodeAt(t-1))&&t--;let i=si(n,t);for(t+=Is(i);t<n.length;){let s=si(n,t);if(i==Yn||s==Yn||e&&Jc(s))t+=Is(s),i=s;else if(Gn(s)){let r=0,o=t-2;for(;o>=0&&Gn(si(n,o));)r++,o-=2;if(r%2==0)break;t+=2}else break}return t}function Qc(n,t,e){for(;t>0;){let i=Co(n,t-2,e);if(i<t)return i;t--}return 0}function ko(n){return n>=56320&&n<57344}function Mo(n){return n>=55296&&n<56320}function si(n,t){let e=n.charCodeAt(t);if(!Mo(e)||t+1==n.length)return e;let i=n.charCodeAt(t+1);return ko(i)?(e-55296<<10)+(i-56320)+65536:e}function pm(n){return n<=65535?String.fromCharCode(n):(n-=65536,String.fromCharCode((n>>10)+55296,(n&1023)+56320))}function Is(n){return n<65536?1:2}const Bs=/\r\n?|\n/;var St=function(n){return n[n.Simple=0]="Simple",n[n.TrackDel=1]="TrackDel",n[n.TrackBefore=2]="TrackBefore",n[n.TrackAfter=3]="TrackAfter",n}(St||(St={}));class Kt{constructor(t){this.sections=t}get length(){let t=0;for(let e=0;e<this.sections.length;e+=2)t+=this.sections[e];return t}get newLength(){let t=0;for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e+1];t+=i<0?this.sections[e]:i}return t}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(t){for(let e=0,i=0,s=0;e<this.sections.length;){let r=this.sections[e++],o=this.sections[e++];o<0?(t(i,s,r),s+=r):s+=o,i+=r}}iterChangedRanges(t,e=!1){Hs(this,t,e)}get invertedDesc(){let t=[];for(let e=0;e<this.sections.length;){let i=this.sections[e++],s=this.sections[e++];s<0?t.push(i,s):t.push(s,i)}return new Kt(t)}composeDesc(t){return this.empty?t:t.empty?this:Ao(this,t)}mapDesc(t,e=!1){return t.empty?this:Vs(this,t,e)}mapPos(t,e=-1,i=St.Simple){let s=0,r=0;for(let o=0;o<this.sections.length;){let l=this.sections[o++],a=this.sections[o++],c=s+l;if(a<0){if(c>t)return r+(t-s);r+=l}else{if(i!=St.Simple&&c>=t&&(i==St.TrackDel&&s<t&&c>t||i==St.TrackBefore&&s<t||i==St.TrackAfter&&c>t))return null;if(c>t||c==t&&e<0&&!l)return t==s||e<0?r:r+a;r+=a}s=c}if(t>s)throw new RangeError(`Position ${t} is out of range for changeset of length ${s}`);return r}touchesRange(t,e=t){for(let i=0,s=0;i<this.sections.length&&s<=e;){let r=this.sections[i++],o=this.sections[i++],l=s+r;if(o>=0&&s<=e&&l>=t)return s<t&&l>e?"cover":!0;s=l}return!1}toString(){let t="";for(let e=0;e<this.sections.length;){let i=this.sections[e++],s=this.sections[e++];t+=(t?" ":"")+i+(s>=0?":"+s:"")}return t}toJSON(){return this.sections}static fromJSON(t){if(!Array.isArray(t)||t.length%2||t.some(e=>typeof e!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Kt(t)}static create(t){return new Kt(t)}}class it extends Kt{constructor(t,e){super(t),this.inserted=e}apply(t){if(this.length!=t.length)throw new RangeError("Applying change set to a document with the wrong length");return Hs(this,(e,i,s,r,o)=>t=t.replace(s,s+(i-e),o),!1),t}mapDesc(t,e=!1){return Vs(this,t,e,!0)}invert(t){let e=this.sections.slice(),i=[];for(let s=0,r=0;s<e.length;s+=2){let o=e[s],l=e[s+1];if(l>=0){e[s]=l,e[s+1]=o;let a=s>>1;for(;i.length<a;)i.push(L.empty);i.push(o?t.slice(r,r+o):L.empty)}r+=o}return new it(e,i)}compose(t){return this.empty?t:t.empty?this:Ao(this,t,!0)}map(t,e=!1){return t.empty?this:Vs(this,t,e,!0)}iterChanges(t,e=!1){Hs(this,t,e)}get desc(){return Kt.create(this.sections)}filter(t){let e=[],i=[],s=[],r=new hi(this);t:for(let o=0,l=0;;){let a=o==t.length?1e9:t[o++];for(;l<a||l==a&&r.len==0;){if(r.done)break t;let h=Math.min(r.len,a-l);at(s,h,-1);let u=r.ins==-1?-1:r.off==0?r.ins:0;at(e,h,u),u>0&&ee(i,e,r.text),r.forward(h),l+=h}let c=t[o++];for(;l<c;){if(r.done)break t;let h=Math.min(r.len,c-l);at(e,h,-1),at(s,h,r.ins==-1?-1:r.off==0?r.ins:0),r.forward(h),l+=h}}return{changes:new it(e,i),filtered:Kt.create(s)}}toJSON(){let t=[];for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e],s=this.sections[e+1];s<0?t.push(i):s==0?t.push([i]):t.push([i].concat(this.inserted[e>>1].toJSON()))}return t}static of(t,e,i){let s=[],r=[],o=0,l=null;function a(h=!1){if(!h&&!s.length)return;o<e&&at(s,e-o,-1);let u=new it(s,r);l=l?l.compose(u.map(l)):u,s=[],r=[],o=0}function c(h){if(Array.isArray(h))for(let u of h)c(u);else if(h instanceof it){if(h.length!=e)throw new RangeError(`Mismatched change set length (got ${h.length}, expected ${e})`);a(),l=l?l.compose(h.map(l)):h}else{let{from:u,to:f=u,insert:d}=h;if(u>f||u<0||f>e)throw new RangeError(`Invalid change range ${u} to ${f} (in doc of length ${e})`);let g=d?typeof d=="string"?L.of(d.split(i||Bs)):d:L.empty,p=g.length;if(u==f&&p==0)return;u<o&&a(),u>o&&at(s,u-o,-1),at(s,f-u,p),ee(r,s,g),o=f}}return c(t),a(!l),l}static empty(t){return new it(t?[t,-1]:[],[])}static fromJSON(t){if(!Array.isArray(t))throw new RangeError("Invalid JSON representation of ChangeSet");let e=[],i=[];for(let s=0;s<t.length;s++){let r=t[s];if(typeof r=="number")e.push(r,-1);else{if(!Array.isArray(r)||typeof r[0]!="number"||r.some((o,l)=>l&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(r.length==1)e.push(r[0],0);else{for(;i.length<s;)i.push(L.empty);i[s]=L.of(r.slice(1)),e.push(r[0],i[s].length)}}}return new it(e,i)}static createSet(t,e){return new it(t,e)}}function at(n,t,e,i=!1){if(t==0&&e<=0)return;let s=n.length-2;s>=0&&e<=0&&e==n[s+1]?n[s]+=t:t==0&&n[s]==0?n[s+1]+=e:i?(n[s]+=t,n[s+1]+=e):n.push(t,e)}function ee(n,t,e){if(e.length==0)return;let i=t.length-2>>1;if(i<n.length)n[n.length-1]=n[n.length-1].append(e);else{for(;n.length<i;)n.push(L.empty);n.push(e)}}function Hs(n,t,e){let i=n.inserted;for(let s=0,r=0,o=0;o<n.sections.length;){let l=n.sections[o++],a=n.sections[o++];if(a<0)s+=l,r+=l;else{let c=s,h=r,u=L.empty;for(;c+=l,h+=a,a&&i&&(u=u.append(i[o-2>>1])),!(e||o==n.sections.length||n.sections[o+1]<0);)l=n.sections[o++],a=n.sections[o++];t(s,c,r,h,u),s=c,r=h}}}function Vs(n,t,e,i=!1){let s=[],r=i?[]:null,o=new hi(n),l=new hi(t);for(let a=-1;;)if(o.ins==-1&&l.ins==-1){let c=Math.min(o.len,l.len);at(s,c,-1),o.forward(c),l.forward(c)}else if(l.ins>=0&&(o.ins<0||a==o.i||o.off==0&&(l.len<o.len||l.len==o.len&&!e))){let c=l.len;for(at(s,l.ins,-1);c;){let h=Math.min(o.len,c);o.ins>=0&&a<o.i&&o.len<=h&&(at(s,0,o.ins),r&&ee(r,s,o.text),a=o.i),o.forward(h),c-=h}l.next()}else if(o.ins>=0){let c=0,h=o.len;for(;h;)if(l.ins==-1){let u=Math.min(h,l.len);c+=u,h-=u,l.forward(u)}else if(l.ins==0&&l.len<h)h-=l.len,l.next();else break;at(s,c,a<o.i?o.ins:0),r&&a<o.i&&ee(r,s,o.text),a=o.i,o.forward(o.len-h)}else{if(o.done&&l.done)return r?it.createSet(s,r):Kt.create(s);throw new Error("Mismatched change set lengths")}}function Ao(n,t,e=!1){let i=[],s=e?[]:null,r=new hi(n),o=new hi(t);for(let l=!1;;){if(r.done&&o.done)return s?it.createSet(i,s):Kt.create(i);if(r.ins==0)at(i,r.len,0,l),r.next();else if(o.len==0&&!o.done)at(i,0,o.ins,l),s&&ee(s,i,o.text),o.next();else{if(r.done||o.done)throw new Error("Mismatched change set lengths");{let a=Math.min(r.len2,o.len),c=i.length;if(r.ins==-1){let h=o.ins==-1?-1:o.off?0:o.ins;at(i,a,h,l),s&&h&&ee(s,i,o.text)}else o.ins==-1?(at(i,r.off?0:r.len,a,l),s&&ee(s,i,r.textBit(a))):(at(i,r.off?0:r.len,o.off?0:o.ins,l),s&&!o.off&&ee(s,i,o.text));l=(r.ins>a||o.ins>=0&&o.len>a)&&(l||i.length>c),r.forward2(a),o.forward(a)}}}}class hi{constructor(t){this.set=t,this.i=0,this.next()}next(){let{sections:t}=this.set;this.i<t.length?(this.len=t[this.i++],this.ins=t[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:t}=this.set,e=this.i-2>>1;return e>=t.length?L.empty:t[e]}textBit(t){let{inserted:e}=this.set,i=this.i-2>>1;return i>=e.length&&!t?L.empty:e[i].slice(this.off,t==null?void 0:this.off+t)}forward(t){t==this.len?this.next():(this.len-=t,this.off+=t)}forward2(t){this.ins==-1?this.forward(t):t==this.ins?this.next():(this.ins-=t,this.off+=t)}}class fe{constructor(t,e,i){this.from=t,this.to=e,this.flags=i}get anchor(){return this.flags&32?this.to:this.from}get head(){return this.flags&32?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&8?-1:this.flags&16?1:0}get bidiLevel(){let t=this.flags&7;return t==7?null:t}get goalColumn(){let t=this.flags>>6;return t==16777215?void 0:t}map(t,e=-1){let i,s;return this.empty?i=s=t.mapPos(this.from,e):(i=t.mapPos(this.from,1),s=t.mapPos(this.to,-1)),i==this.from&&s==this.to?this:new fe(i,s,this.flags)}extend(t,e=t){if(t<=this.anchor&&e>=this.anchor)return M.range(t,e);let i=Math.abs(t-this.anchor)>Math.abs(e-this.anchor)?t:e;return M.range(this.anchor,i)}eq(t,e=!1){return this.anchor==t.anchor&&this.head==t.head&&(!e||!this.empty||this.assoc==t.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(t){if(!t||typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return M.range(t.anchor,t.head)}static create(t,e,i){return new fe(t,e,i)}}class M{constructor(t,e){this.ranges=t,this.mainIndex=e}map(t,e=-1){return t.empty?this:M.create(this.ranges.map(i=>i.map(t,e)),this.mainIndex)}eq(t,e=!1){if(this.ranges.length!=t.ranges.length||this.mainIndex!=t.mainIndex)return!1;for(let i=0;i<this.ranges.length;i++)if(!this.ranges[i].eq(t.ranges[i],e))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new M([this.main],0)}addRange(t,e=!0){return M.create([t].concat(this.ranges),e?0:this.mainIndex+1)}replaceRange(t,e=this.mainIndex){let i=this.ranges.slice();return i[e]=t,M.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(t=>t.toJSON()),main:this.mainIndex}}static fromJSON(t){if(!t||!Array.isArray(t.ranges)||typeof t.main!="number"||t.main>=t.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new M(t.ranges.map(e=>fe.fromJSON(e)),t.main)}static single(t,e=t){return new M([M.range(t,e)],0)}static create(t,e=0){if(t.length==0)throw new RangeError("A selection needs at least one range");for(let i=0,s=0;s<t.length;s++){let r=t[s];if(r.empty?r.from<=i:r.from<i)return M.normalized(t.slice(),e);i=r.to}return new M(t,e)}static cursor(t,e=0,i,s){return fe.create(t,t,(e==0?0:e<0?8:16)|(i==null?7:Math.min(6,i))|(s??16777215)<<6)}static range(t,e,i,s){let r=(i??16777215)<<6|(s==null?7:Math.min(6,s));return e<t?fe.create(e,t,48|r):fe.create(t,e,(e>t?8:0)|r)}static normalized(t,e=0){let i=t[e];t.sort((s,r)=>s.from-r.from),e=t.indexOf(i);for(let s=1;s<t.length;s++){let r=t[s],o=t[s-1];if(r.empty?r.from<=o.to:r.from<o.to){let l=o.from,a=Math.max(r.to,o.to);s<=e&&e--,t.splice(--s,2,r.anchor>r.head?M.range(a,l):M.range(l,a))}}return new M(t,e)}}function To(n,t){for(let e of n.ranges)if(e.to>t)throw new RangeError("Selection points outside of document")}let vn=0;class T{constructor(t,e,i,s,r){this.combine=t,this.compareInput=e,this.compare=i,this.isStatic=s,this.id=vn++,this.default=t([]),this.extensions=typeof r=="function"?r(this):r}get reader(){return this}static define(t={}){return new T(t.combine||(e=>e),t.compareInput||((e,i)=>e===i),t.compare||(t.combine?(e,i)=>e===i:Sn),!!t.static,t.enables)}of(t){return new ji([],this,0,t)}compute(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new ji(t,this,1,e)}computeN(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new ji(t,this,2,e)}from(t,e){return e||(e=i=>i),this.compute([t],i=>e(i.field(t)))}}function Sn(n,t){return n==t||n.length==t.length&&n.every((e,i)=>e===t[i])}class ji{constructor(t,e,i,s){this.dependencies=t,this.facet=e,this.type=i,this.value=s,this.id=vn++}dynamicSlot(t){var e;let i=this.value,s=this.facet.compareInput,r=this.id,o=t[r]>>1,l=this.type==2,a=!1,c=!1,h=[];for(let u of this.dependencies)u=="doc"?a=!0:u=="selection"?c=!0:((e=t[u.id])!==null&&e!==void 0?e:1)&1||h.push(t[u.id]);return{create(u){return u.values[o]=i(u),1},update(u,f){if(a&&f.docChanged||c&&(f.docChanged||f.selection)||Fs(u,h)){let d=i(u);if(l?!Xn(d,u.values[o],s):!s(d,u.values[o]))return u.values[o]=d,1}return 0},reconfigure:(u,f)=>{let d,g=f.config.address[r];if(g!=null){let p=Xi(f,g);if(this.dependencies.every(m=>m instanceof T?f.facet(m)===u.facet(m):m instanceof Et?f.field(m,!1)==u.field(m,!1):!0)||(l?Xn(d=i(u),p,s):s(d=i(u),p)))return u.values[o]=p,0}else d=i(u);return u.values[o]=d,1}}}}function Xn(n,t,e){if(n.length!=t.length)return!1;for(let i=0;i<n.length;i++)if(!e(n[i],t[i]))return!1;return!0}function Fs(n,t){let e=!1;for(let i of t)ni(n,i)&1&&(e=!0);return e}function Zc(n,t,e){let i=e.map(a=>n[a.id]),s=e.map(a=>a.type),r=i.filter(a=>!(a&1)),o=n[t.id]>>1;function l(a){let c=[];for(let h=0;h<i.length;h++){let u=Xi(a,i[h]);if(s[h]==2)for(let f of u)c.push(f);else c.push(u)}return t.combine(c)}return{create(a){for(let c of i)ni(a,c);return a.values[o]=l(a),1},update(a,c){if(!Fs(a,r))return 0;let h=l(a);return t.compare(h,a.values[o])?0:(a.values[o]=h,1)},reconfigure(a,c){let h=Fs(a,i),u=c.config.facets[t.id],f=c.facet(t);if(u&&!h&&Sn(e,u))return a.values[o]=f,0;let d=l(a);return t.compare(d,f)?(a.values[o]=f,0):(a.values[o]=d,1)}}}const Jn=T.define({static:!0});class Et{constructor(t,e,i,s,r){this.id=t,this.createF=e,this.updateF=i,this.compareF=s,this.spec=r,this.provides=void 0}static define(t){let e=new Et(vn++,t.create,t.update,t.compare||((i,s)=>i===s),t);return t.provide&&(e.provides=t.provide(e)),e}create(t){let e=t.facet(Jn).find(i=>i.field==this);return(e?.create||this.createF)(t)}slot(t){let e=t[this.id]>>1;return{create:i=>(i.values[e]=this.create(i),1),update:(i,s)=>{let r=i.values[e],o=this.updateF(r,s);return this.compareF(r,o)?0:(i.values[e]=o,1)},reconfigure:(i,s)=>s.config.address[this.id]!=null?(i.values[e]=s.field(this),0):(i.values[e]=this.create(i),1)}}init(t){return[this,Jn.of({field:this,create:t})]}get extension(){return this}}const ue={lowest:4,low:3,default:2,high:1,highest:0};function Ge(n){return t=>new Eo(t,n)}const Cn={highest:Ge(ue.highest),high:Ge(ue.high),default:Ge(ue.default),low:Ge(ue.low),lowest:Ge(ue.lowest)};class Eo{constructor(t,e){this.inner=t,this.prec=e}}class ls{of(t){return new js(this,t)}reconfigure(t){return ls.reconfigure.of({compartment:this,extension:t})}get(t){return t.config.compartments.get(this)}}class js{constructor(t,e){this.compartment=t,this.inner=e}}class Yi{constructor(t,e,i,s,r,o){for(this.base=t,this.compartments=e,this.dynamicSlots=i,this.address=s,this.staticValues=r,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(t){let e=this.address[t.id];return e==null?t.default:this.staticValues[e>>1]}static resolve(t,e,i){let s=[],r=Object.create(null),o=new Map;for(let f of tu(t,e,o))f instanceof Et?s.push(f):(r[f.facet.id]||(r[f.facet.id]=[])).push(f);let l=Object.create(null),a=[],c=[];for(let f of s)l[f.id]=c.length<<1,c.push(d=>f.slot(d));let h=i?.config.facets;for(let f in r){let d=r[f],g=d[0].facet,p=h&&h[f]||[];if(d.every(m=>m.type==0))if(l[g.id]=a.length<<1|1,Sn(p,d))a.push(i.facet(g));else{let m=g.combine(d.map(x=>x.value));a.push(i&&g.compare(m,i.facet(g))?i.facet(g):m)}else{for(let m of d)m.type==0?(l[m.id]=a.length<<1|1,a.push(m.value)):(l[m.id]=c.length<<1,c.push(x=>m.dynamicSlot(x)));l[g.id]=c.length<<1,c.push(m=>Zc(m,g,d))}}let u=c.map(f=>f(l));return new Yi(t,o,u,l,a,r)}}function tu(n,t,e){let i=[[],[],[],[],[]],s=new Map;function r(o,l){let a=s.get(o);if(a!=null){if(a<=l)return;let c=i[a].indexOf(o);c>-1&&i[a].splice(c,1),o instanceof js&&e.delete(o.compartment)}if(s.set(o,l),Array.isArray(o))for(let c of o)r(c,l);else if(o instanceof js){if(e.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let c=t.get(o.compartment)||o.inner;e.set(o.compartment,c),r(c,l)}else if(o instanceof Eo)r(o.inner,o.prec);else if(o instanceof Et)i[l].push(o),o.provides&&r(o.provides,l);else if(o instanceof ji)i[l].push(o),o.facet.extensions&&r(o.facet.extensions,ue.default);else{let c=o.extension;if(!c)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);r(c,l)}}return r(n,ue.default),i.reduce((o,l)=>o.concat(l))}function ni(n,t){if(t&1)return 2;let e=t>>1,i=n.status[e];if(i==4)throw new Error("Cyclic dependency between fields and/or facets");if(i&2)return i;n.status[e]=4;let s=n.computeSlot(n,n.config.dynamicSlots[e]);return n.status[e]=2|s}function Xi(n,t){return t&1?n.config.staticValues[t>>1]:n.values[t>>1]}const Oo=T.define(),Ws=T.define({combine:n=>n.some(t=>t),static:!0}),Do=T.define({combine:n=>n.length?n[0]:void 0,static:!0}),Ro=T.define(),Po=T.define(),No=T.define(),Lo=T.define({combine:n=>n.length?n[0]:!1});class _e{constructor(t,e){this.type=t,this.value=e}static define(){return new eu}}class eu{of(t){return new _e(this,t)}}class iu{constructor(t){this.map=t}of(t){return new K(this,t)}}class K{constructor(t,e){this.type=t,this.value=e}map(t){let e=this.type.map(this.value,t);return e===void 0?void 0:e==this.value?this:new K(this.type,e)}is(t){return this.type==t}static define(t={}){return new iu(t.map||(e=>e))}static mapEffects(t,e){if(!t.length)return t;let i=[];for(let s of t){let r=s.map(e);r&&i.push(r)}return i}}K.reconfigure=K.define();K.appendConfig=K.define();class ct{constructor(t,e,i,s,r,o){this.startState=t,this.changes=e,this.selection=i,this.effects=s,this.annotations=r,this.scrollIntoView=o,this._doc=null,this._state=null,i&&To(i,e.newLength),r.some(l=>l.type==ct.time)||(this.annotations=r.concat(ct.time.of(Date.now())))}static create(t,e,i,s,r,o){return new ct(t,e,i,s,r,o)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(t){for(let e of this.annotations)if(e.type==t)return e.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(t){let e=this.annotation(ct.userEvent);return!!(e&&(e==t||e.length>t.length&&e.slice(0,t.length)==t&&e[t.length]=="."))}}ct.time=_e.define();ct.userEvent=_e.define();ct.addToHistory=_e.define();ct.remote=_e.define();function su(n,t){let e=[];for(let i=0,s=0;;){let r,o;if(i<n.length&&(s==t.length||t[s]>=n[i]))r=n[i++],o=n[i++];else if(s<t.length)r=t[s++],o=t[s++];else return e;!e.length||e[e.length-1]<r?e.push(r,o):e[e.length-1]<o&&(e[e.length-1]=o)}}function Io(n,t,e){var i;let s,r,o;return e?(s=t.changes,r=it.empty(t.changes.length),o=n.changes.compose(t.changes)):(s=t.changes.map(n.changes),r=n.changes.mapDesc(t.changes,!0),o=n.changes.compose(s)),{changes:o,selection:t.selection?t.selection.map(r):(i=n.selection)===null||i===void 0?void 0:i.map(s),effects:K.mapEffects(n.effects,s).concat(K.mapEffects(t.effects,r)),annotations:n.annotations.length?n.annotations.concat(t.annotations):t.annotations,scrollIntoView:n.scrollIntoView||t.scrollIntoView}}function qs(n,t,e){let i=t.selection,s=Pe(t.annotations);return t.userEvent&&(s=s.concat(ct.userEvent.of(t.userEvent))),{changes:t.changes instanceof it?t.changes:it.of(t.changes||[],e,n.facet(Do)),selection:i&&(i instanceof M?i:M.single(i.anchor,i.head)),effects:Pe(t.effects),annotations:s,scrollIntoView:!!t.scrollIntoView}}function Bo(n,t,e){let i=qs(n,t.length?t[0]:{},n.doc.length);t.length&&t[0].filter===!1&&(e=!1);for(let r=1;r<t.length;r++){t[r].filter===!1&&(e=!1);let o=!!t[r].sequential;i=Io(i,qs(n,t[r],o?i.changes.newLength:n.doc.length),o)}let s=ct.create(n,i.changes,i.selection,i.effects,i.annotations,i.scrollIntoView);return ru(e?nu(s):s)}function nu(n){let t=n.startState,e=!0;for(let s of t.facet(Ro)){let r=s(n);if(r===!1){e=!1;break}Array.isArray(r)&&(e=e===!0?r:su(e,r))}if(e!==!0){let s,r;if(e===!1)r=n.changes.invertedDesc,s=it.empty(t.doc.length);else{let o=n.changes.filter(e);s=o.changes,r=o.filtered.mapDesc(o.changes).invertedDesc}n=ct.create(t,s,n.selection&&n.selection.map(r),K.mapEffects(n.effects,r),n.annotations,n.scrollIntoView)}let i=t.facet(Po);for(let s=i.length-1;s>=0;s--){let r=i[s](n);r instanceof ct?n=r:Array.isArray(r)&&r.length==1&&r[0]instanceof ct?n=r[0]:n=Bo(t,Pe(r),!1)}return n}function ru(n){let t=n.startState,e=t.facet(No),i=n;for(let s=e.length-1;s>=0;s--){let r=e[s](n);r&&Object.keys(r).length&&(i=Io(i,qs(t,r,n.changes.newLength),!0))}return i==n?n:ct.create(t,n.changes,n.selection,i.effects,i.annotations,i.scrollIntoView)}const ou=[];function Pe(n){return n==null?ou:Array.isArray(n)?n:[n]}var zt=function(n){return n[n.Word=0]="Word",n[n.Space=1]="Space",n[n.Other=2]="Other",n}(zt||(zt={}));const lu=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let _s;try{_s=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function au(n){if(_s)return _s.test(n);for(let t=0;t<n.length;t++){let e=n[t];if(/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||lu.test(e)))return!0}return!1}function hu(n){return t=>{if(!/\S/.test(t))return zt.Space;if(au(t))return zt.Word;for(let e=0;e<n.length;e++)if(t.indexOf(n[e])>-1)return zt.Word;return zt.Other}}class q{constructor(t,e,i,s,r,o){this.config=t,this.doc=e,this.selection=i,this.values=s,this.status=t.statusTemplate.slice(),this.computeSlot=r,o&&(o._state=this);for(let l=0;l<this.config.dynamicSlots.length;l++)ni(this,l<<1);this.computeSlot=null}field(t,e=!0){let i=this.config.address[t.id];if(i==null){if(e)throw new RangeError("Field is not present in this state");return}return ni(this,i),Xi(this,i)}update(...t){return Bo(this,t,!0)}applyTransaction(t){let e=this.config,{base:i,compartments:s}=e;for(let l of t.effects)l.is(ls.reconfigure)?(e&&(s=new Map,e.compartments.forEach((a,c)=>s.set(c,a)),e=null),s.set(l.value.compartment,l.value.extension)):l.is(K.reconfigure)?(e=null,i=l.value):l.is(K.appendConfig)&&(e=null,i=Pe(i).concat(l.value));let r;e?r=t.startState.values.slice():(e=Yi.resolve(i,s,this),r=new q(e,this.doc,this.selection,e.dynamicSlots.map(()=>null),(a,c)=>c.reconfigure(a,this),null).values);let o=t.startState.facet(Ws)?t.newSelection:t.newSelection.asSingle();new q(e,t.newDoc,o,r,(l,a)=>a.update(l,t),t)}replaceSelection(t){return typeof t=="string"&&(t=this.toText(t)),this.changeByRange(e=>({changes:{from:e.from,to:e.to,insert:t},range:M.cursor(e.from+t.length)}))}changeByRange(t){let e=this.selection,i=t(e.ranges[0]),s=this.changes(i.changes),r=[i.range],o=Pe(i.effects);for(let l=1;l<e.ranges.length;l++){let a=t(e.ranges[l]),c=this.changes(a.changes),h=c.map(s);for(let f=0;f<l;f++)r[f]=r[f].map(h);let u=s.mapDesc(c,!0);r.push(a.range.map(u)),s=s.compose(h),o=K.mapEffects(o,h).concat(K.mapEffects(Pe(a.effects),u))}return{changes:s,selection:M.create(r,e.mainIndex),effects:o}}changes(t=[]){return t instanceof it?t:it.of(t,this.doc.length,this.facet(q.lineSeparator))}toText(t){return L.of(t.split(this.facet(q.lineSeparator)||Bs))}sliceDoc(t=0,e=this.doc.length){return this.doc.sliceString(t,e,this.lineBreak)}facet(t){let e=this.config.address[t.id];return e==null?t.default:(ni(this,e),Xi(this,e))}toJSON(t){let e={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(t)for(let i in t){let s=t[i];s instanceof Et&&this.config.address[s.id]!=null&&(e[i]=s.spec.toJSON(this.field(t[i]),this))}return e}static fromJSON(t,e={},i){if(!t||typeof t.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let s=[];if(i){for(let r in i)if(Object.prototype.hasOwnProperty.call(t,r)){let o=i[r],l=t[r];s.push(o.init(a=>o.spec.fromJSON(l,a)))}}return q.create({doc:t.doc,selection:M.fromJSON(t.selection),extensions:e.extensions?s.concat([e.extensions]):s})}static create(t={}){let e=Yi.resolve(t.extensions||[],new Map),i=t.doc instanceof L?t.doc:L.of((t.doc||"").split(e.staticFacet(q.lineSeparator)||Bs)),s=t.selection?t.selection instanceof M?t.selection:M.single(t.selection.anchor,t.selection.head):M.single(0);return To(s,i.length),e.staticFacet(Ws)||(s=s.asSingle()),new q(e,i,s,e.dynamicSlots.map(()=>null),(r,o)=>o.create(r),null)}get tabSize(){return this.facet(q.tabSize)}get lineBreak(){return this.facet(q.lineSeparator)||`
`}get readOnly(){return this.facet(Lo)}phrase(t,...e){for(let i of this.facet(q.phrases))if(Object.prototype.hasOwnProperty.call(i,t)){t=i[t];break}return e.length&&(t=t.replace(/\$(\$|\d*)/g,(i,s)=>{if(s=="$")return"$";let r=+(s||1);return!r||r>e.length?i:e[r-1]})),t}languageDataAt(t,e,i=-1){let s=[];for(let r of this.facet(Oo))for(let o of r(this,e,i))Object.prototype.hasOwnProperty.call(o,t)&&s.push(o[t]);return s}charCategorizer(t){return hu(this.languageDataAt("wordChars",t).join(""))}wordAt(t){let{text:e,from:i,length:s}=this.doc.lineAt(t),r=this.charCategorizer(t),o=t-i,l=t-i;for(;o>0;){let a=Wt(e,o,!1);if(r(e.slice(a,o))!=zt.Word)break;o=a}for(;l<s;){let a=Wt(e,l);if(r(e.slice(l,a))!=zt.Word)break;l=a}return o==l?null:M.range(o+i,l+i)}}q.allowMultipleSelections=Ws;q.tabSize=T.define({combine:n=>n.length?n[0]:4});q.lineSeparator=Do;q.readOnly=Lo;q.phrases=T.define({compare(n,t){let e=Object.keys(n),i=Object.keys(t);return e.length==i.length&&e.every(s=>n[s]==t[s])}});q.languageData=Oo;q.changeFilter=Ro;q.transactionFilter=Po;q.transactionExtender=No;ls.reconfigure=K.define();function kn(n,t,e={}){let i={};for(let s of n)for(let r of Object.keys(s)){let o=s[r],l=i[r];if(l===void 0)i[r]=o;else if(!(l===o||o===void 0))if(Object.hasOwnProperty.call(e,r))i[r]=e[r](l,o);else throw new Error("Config merge conflict for field "+r)}for(let s in t)i[s]===void 0&&(i[s]=t[s]);return i}class Ve{eq(t){return this==t}range(t,e=t){return ci.create(t,e,this)}}Ve.prototype.startSide=Ve.prototype.endSide=0;Ve.prototype.point=!1;Ve.prototype.mapMode=St.TrackDel;class ci{constructor(t,e,i){this.from=t,this.to=e,this.value=i}static create(t,e,i){return new ci(t,e,i)}}function zs(n,t){return n.from-t.from||n.value.startSide-t.value.startSide}class Mn{constructor(t,e,i,s){this.from=t,this.to=e,this.value=i,this.maxPoint=s}get length(){return this.to[this.to.length-1]}findIndex(t,e,i,s=0){let r=i?this.to:this.from;for(let o=s,l=r.length;;){if(o==l)return o;let a=o+l>>1,c=r[a]-t||(i?this.value[a].endSide:this.value[a].startSide)-e;if(a==o)return c>=0?o:l;c>=0?l=a:o=a+1}}between(t,e,i,s){for(let r=this.findIndex(e,-1e9,!0),o=this.findIndex(i,1e9,!1,r);r<o;r++)if(s(this.from[r]+t,this.to[r]+t,this.value[r])===!1)return!1}map(t,e){let i=[],s=[],r=[],o=-1,l=-1;for(let a=0;a<this.value.length;a++){let c=this.value[a],h=this.from[a]+t,u=this.to[a]+t,f,d;if(h==u){let g=e.mapPos(h,c.startSide,c.mapMode);if(g==null||(f=d=g,c.startSide!=c.endSide&&(d=e.mapPos(h,c.endSide),d<f)))continue}else if(f=e.mapPos(h,c.startSide),d=e.mapPos(u,c.endSide),f>d||f==d&&c.startSide>0&&c.endSide<=0)continue;(d-f||c.endSide-c.startSide)<0||(o<0&&(o=f),c.point&&(l=Math.max(l,d-f)),i.push(c),s.push(f-o),r.push(d-o))}return{mapped:i.length?new Mn(s,r,i,l):null,pos:o}}}class N{constructor(t,e,i,s){this.chunkPos=t,this.chunk=e,this.nextLayer=i,this.maxPoint=s}static create(t,e,i,s){return new N(t,e,i,s)}get length(){let t=this.chunk.length-1;return t<0?0:Math.max(this.chunkEnd(t),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let t=this.nextLayer.size;for(let e of this.chunk)t+=e.value.length;return t}chunkEnd(t){return this.chunkPos[t]+this.chunk[t].length}update(t){let{add:e=[],sort:i=!1,filterFrom:s=0,filterTo:r=this.length}=t,o=t.filter;if(e.length==0&&!o)return this;if(i&&(e=e.slice().sort(zs)),this.isEmpty)return e.length?N.of(e):this;let l=new Ho(this,null,-1).goto(0),a=0,c=[],h=new ui;for(;l.value||a<e.length;)if(a<e.length&&(l.from-e[a].from||l.startSide-e[a].value.startSide)>=0){let u=e[a++];h.addInner(u.from,u.to,u.value)||c.push(u)}else l.rangeIndex==1&&l.chunkIndex<this.chunk.length&&(a==e.length||this.chunkEnd(l.chunkIndex)<e[a].from)&&(!o||s>this.chunkEnd(l.chunkIndex)||r<this.chunkPos[l.chunkIndex])&&h.addChunk(this.chunkPos[l.chunkIndex],this.chunk[l.chunkIndex])?l.nextChunk():((!o||s>l.to||r<l.from||o(l.from,l.to,l.value))&&(h.addInner(l.from,l.to,l.value)||c.push(ci.create(l.from,l.to,l.value))),l.next());return h.finishInner(this.nextLayer.isEmpty&&!c.length?N.empty:this.nextLayer.update({add:c,filter:o,filterFrom:s,filterTo:r}))}map(t){if(t.empty||this.isEmpty)return this;let e=[],i=[],s=-1;for(let o=0;o<this.chunk.length;o++){let l=this.chunkPos[o],a=this.chunk[o],c=t.touchesRange(l,l+a.length);if(c===!1)s=Math.max(s,a.maxPoint),e.push(a),i.push(t.mapPos(l));else if(c===!0){let{mapped:h,pos:u}=a.map(l,t);h&&(s=Math.max(s,h.maxPoint),e.push(h),i.push(u))}}let r=this.nextLayer.map(t);return e.length==0?r:new N(i,e,r||N.empty,s)}between(t,e,i){if(!this.isEmpty){for(let s=0;s<this.chunk.length;s++){let r=this.chunkPos[s],o=this.chunk[s];if(e>=r&&t<=r+o.length&&o.between(r,t-r,e-r,i)===!1)return}this.nextLayer.between(t,e,i)}}iter(t=0){return fi.from([this]).goto(t)}get isEmpty(){return this.nextLayer==this}static iter(t,e=0){return fi.from(t).goto(e)}static compare(t,e,i,s,r=-1){let o=t.filter(u=>u.maxPoint>0||!u.isEmpty&&u.maxPoint>=r),l=e.filter(u=>u.maxPoint>0||!u.isEmpty&&u.maxPoint>=r),a=Qn(o,l,i),c=new Ye(o,a,r),h=new Ye(l,a,r);i.iterGaps((u,f,d)=>Zn(c,u,h,f,d,s)),i.empty&&i.length==0&&Zn(c,0,h,0,0,s)}static eq(t,e,i=0,s){s==null&&(s=999999999);let r=t.filter(h=>!h.isEmpty&&e.indexOf(h)<0),o=e.filter(h=>!h.isEmpty&&t.indexOf(h)<0);if(r.length!=o.length)return!1;if(!r.length)return!0;let l=Qn(r,o),a=new Ye(r,l,0).goto(i),c=new Ye(o,l,0).goto(i);for(;;){if(a.to!=c.to||!$s(a.active,c.active)||a.point&&(!c.point||!a.point.eq(c.point)))return!1;if(a.to>s)return!0;a.next(),c.next()}}static spans(t,e,i,s,r=-1){let o=new Ye(t,null,r).goto(e),l=e,a=o.openStart;for(;;){let c=Math.min(o.to,i);if(o.point){let h=o.activeForPoint(o.to),u=o.pointFrom<e?h.length+1:o.point.startSide<0?h.length:Math.min(h.length,a);s.point(l,c,o.point,h,u,o.pointRank),a=Math.min(o.openEnd(c),h.length)}else c>l&&(s.span(l,c,o.active,a),a=o.openEnd(c));if(o.to>i)return a+(o.point&&o.to>i?1:0);l=o.to,o.next()}}static of(t,e=!1){let i=new ui;for(let s of t instanceof ci?[t]:e?cu(t):t)i.add(s.from,s.to,s.value);return i.finish()}static join(t){if(!t.length)return N.empty;let e=t[t.length-1];for(let i=t.length-2;i>=0;i--)for(let s=t[i];s!=N.empty;s=s.nextLayer)e=new N(s.chunkPos,s.chunk,e,Math.max(s.maxPoint,e.maxPoint));return e}}N.empty=new N([],[],null,-1);function cu(n){if(n.length>1)for(let t=n[0],e=1;e<n.length;e++){let i=n[e];if(zs(t,i)>0)return n.slice().sort(zs);t=i}return n}N.empty.nextLayer=N.empty;class ui{finishChunk(t){this.chunks.push(new Mn(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,t&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(t,e,i){this.addInner(t,e,i)||(this.nextLayer||(this.nextLayer=new ui)).add(t,e,i)}addInner(t,e,i){let s=t-this.lastTo||i.startSide-this.last.endSide;if(s<=0&&(t-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return s<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=t),this.from.push(t-this.chunkStart),this.to.push(e-this.chunkStart),this.last=i,this.lastFrom=t,this.lastTo=e,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,e-t)),!0)}addChunk(t,e){if((t-this.lastTo||e.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,e.maxPoint),this.chunks.push(e),this.chunkPos.push(t);let i=e.value.length-1;return this.last=e.value[i],this.lastFrom=e.from[i]+t,this.lastTo=e.to[i]+t,!0}finish(){return this.finishInner(N.empty)}finishInner(t){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return t;let e=N.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(t):t,this.setMaxPoint);return this.from=null,e}}function Qn(n,t,e){let i=new Map;for(let r of n)for(let o=0;o<r.chunk.length;o++)r.chunk[o].maxPoint<=0&&i.set(r.chunk[o],r.chunkPos[o]);let s=new Set;for(let r of t)for(let o=0;o<r.chunk.length;o++){let l=i.get(r.chunk[o]);l!=null&&(e?e.mapPos(l):l)==r.chunkPos[o]&&!e?.touchesRange(l,l+r.chunk[o].length)&&s.add(r.chunk[o])}return s}class Ho{constructor(t,e,i,s=0){this.layer=t,this.skip=e,this.minPoint=i,this.rank=s}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(t,e=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(t,e,!1),this}gotoInner(t,e,i){for(;this.chunkIndex<this.layer.chunk.length;){let s=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(s)||this.layer.chunkEnd(this.chunkIndex)<t||s.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let s=this.layer.chunk[this.chunkIndex].findIndex(t-this.layer.chunkPos[this.chunkIndex],e,!0);(!i||this.rangeIndex<s)&&this.setRangeIndex(s)}this.next()}forward(t,e){(this.to-t||this.endSide-e)<0&&this.gotoInner(t,e,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let t=this.layer.chunkPos[this.chunkIndex],e=this.layer.chunk[this.chunkIndex],i=t+e.from[this.rangeIndex];if(this.from=i,this.to=t+e.to[this.rangeIndex],this.value=e.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(t){if(t==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=t}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(t){return this.from-t.from||this.startSide-t.startSide||this.rank-t.rank||this.to-t.to||this.endSide-t.endSide}}class fi{constructor(t){this.heap=t}static from(t,e=null,i=-1){let s=[];for(let r=0;r<t.length;r++)for(let o=t[r];!o.isEmpty;o=o.nextLayer)o.maxPoint>=i&&s.push(new Ho(o,e,i,r));return s.length==1?s[0]:new fi(s)}get startSide(){return this.value?this.value.startSide:0}goto(t,e=-1e9){for(let i of this.heap)i.goto(t,e);for(let i=this.heap.length>>1;i>=0;i--)xs(this.heap,i);return this.next(),this}forward(t,e){for(let i of this.heap)i.forward(t,e);for(let i=this.heap.length>>1;i>=0;i--)xs(this.heap,i);(this.to-t||this.value.endSide-e)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let t=this.heap[0];this.from=t.from,this.to=t.to,this.value=t.value,this.rank=t.rank,t.value&&t.next(),xs(this.heap,0)}}}function xs(n,t){for(let e=n[t];;){let i=(t<<1)+1;if(i>=n.length)break;let s=n[i];if(i+1<n.length&&s.compare(n[i+1])>=0&&(s=n[i+1],i++),e.compare(s)<0)break;n[i]=e,n[t]=s,t=i}}class Ye{constructor(t,e,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=fi.from(t,e,i)}goto(t,e=-1e9){return this.cursor.goto(t,e),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=t,this.endSide=e,this.openStart=-1,this.next(),this}forward(t,e){for(;this.minActive>-1&&(this.activeTo[this.minActive]-t||this.active[this.minActive].endSide-e)<0;)this.removeActive(this.minActive);this.cursor.forward(t,e)}removeActive(t){Ti(this.active,t),Ti(this.activeTo,t),Ti(this.activeRank,t),this.minActive=tr(this.active,this.activeTo)}addActive(t){let e=0,{value:i,to:s,rank:r}=this.cursor;for(;e<this.activeRank.length&&(r-this.activeRank[e]||s-this.activeTo[e])>0;)e++;Ei(this.active,e,i),Ei(this.activeTo,e,s),Ei(this.activeRank,e,r),t&&Ei(t,e,this.cursor.from),this.minActive=tr(this.active,this.activeTo)}next(){let t=this.to,e=this.point;this.point=null;let i=this.openStart<0?[]:null;for(;;){let s=this.minActive;if(s>-1&&(this.activeTo[s]-this.cursor.from||this.active[s].endSide-this.cursor.startSide)<0){if(this.activeTo[s]>t){this.to=this.activeTo[s],this.endSide=this.active[s].endSide;break}this.removeActive(s),i&&Ti(i,s)}else if(this.cursor.value)if(this.cursor.from>t){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let r=this.cursor.value;if(!r.point)this.addActive(i),this.cursor.next();else if(e&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=r,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=r.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(i){this.openStart=0;for(let s=i.length-1;s>=0&&i[s]<t;s--)this.openStart++}}activeForPoint(t){if(!this.active.length)return this.active;let e=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>t||this.activeTo[i]==t&&this.active[i].endSide>=this.point.endSide)&&e.push(this.active[i]);return e.reverse()}openEnd(t){let e=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>t;i--)e++;return e}}function Zn(n,t,e,i,s,r){n.goto(t),e.goto(i);let o=i+s,l=i,a=i-t;for(;;){let c=n.to+a-e.to||n.endSide-e.endSide,h=c<0?n.to+a:e.to,u=Math.min(h,o);if(n.point||e.point?n.point&&e.point&&(n.point==e.point||n.point.eq(e.point))&&$s(n.activeForPoint(n.to),e.activeForPoint(e.to))||r.comparePoint(l,u,n.point,e.point):u>l&&!$s(n.active,e.active)&&r.compareRange(l,u,n.active,e.active),h>o)break;l=h,c<=0&&n.next(),c>=0&&e.next()}}function $s(n,t){if(n.length!=t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!=t[e]&&!n[e].eq(t[e]))return!1;return!0}function Ti(n,t){for(let e=t,i=n.length-1;e<i;e++)n[e]=n[e+1];n.pop()}function Ei(n,t,e){for(let i=n.length-1;i>=t;i--)n[i+1]=n[i];n[t]=e}function tr(n,t){let e=-1,i=1e9;for(let s=0;s<t.length;s++)(t[s]-i||n[s].endSide-n[e].endSide)<0&&(e=s,i=t[s]);return e}function uu(n,t,e=n.length){let i=0;for(let s=0;s<e;)n.charCodeAt(s)==9?(i+=t-i%t,s++):(i++,s=Wt(n,s));return i}function fu(n,t,e,i){for(let s=0,r=0;;){if(r>=t)return s;if(s==n.length)break;r+=n.charCodeAt(s)==9?e-r%e:1,s=Wt(n,s)}return i===!0?-1:n.length}const Ks="ͼ",er=typeof Symbol>"u"?"__"+Ks:Symbol.for(Ks),Us=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),ir=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class Fe{constructor(t,e){this.rules=[];let{finish:i}=e||{};function s(o){return/^@/.test(o)?[o]:o.split(/,\s*/)}function r(o,l,a,c){let h=[],u=/^@(\w+)\b/.exec(o[0]),f=u&&u[1]=="keyframes";if(u&&l==null)return a.push(o[0]+";");for(let d in l){let g=l[d];if(/&/.test(d))r(d.split(/,\s*/).map(p=>o.map(m=>p.replace(/&/,m))).reduce((p,m)=>p.concat(m)),g,a);else if(g&&typeof g=="object"){if(!u)throw new RangeError("The value of a property ("+d+") should be a primitive value.");r(s(d),g,h,f)}else g!=null&&h.push(d.replace(/_.*/,"").replace(/[A-Z]/g,p=>"-"+p.toLowerCase())+": "+g+";")}(h.length||f)&&a.push((i&&!u&&!c?o.map(i):o).join(", ")+" {"+h.join(" ")+"}")}for(let o in t)r(s(o),t[o],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let t=ir[er]||1;return ir[er]=t+1,Ks+t.toString(36)}static mount(t,e,i){let s=t[Us],r=i&&i.nonce;s?r&&s.setNonce(r):s=new du(t,r),s.mount(Array.isArray(e)?e:[e],t)}}let sr=new Map;class du{constructor(t,e){let i=t.ownerDocument||t,s=i.defaultView;if(!t.head&&t.adoptedStyleSheets&&s.CSSStyleSheet){let r=sr.get(i);if(r)return t[Us]=r;this.sheet=new s.CSSStyleSheet,sr.set(i,this)}else this.styleTag=i.createElement("style"),e&&this.styleTag.setAttribute("nonce",e);this.modules=[],t[Us]=this}mount(t,e){let i=this.sheet,s=0,r=0;for(let o=0;o<t.length;o++){let l=t[o],a=this.modules.indexOf(l);if(a<r&&a>-1&&(this.modules.splice(a,1),r--,a=-1),a==-1){if(this.modules.splice(r++,0,l),i)for(let c=0;c<l.rules.length;c++)i.insertRule(l.rules[c],s++)}else{for(;r<a;)s+=this.modules[r++].rules.length;s+=l.rules.length,r++}}if(i)e.adoptedStyleSheets.indexOf(this.sheet)<0&&(e.adoptedStyleSheets=[this.sheet,...e.adoptedStyleSheets]);else{let o="";for(let a=0;a<this.modules.length;a++)o+=this.modules[a].getRules()+`
`;this.styleTag.textContent=o;let l=e.head||e;this.styleTag.parentNode!=l&&l.insertBefore(this.styleTag,l.firstChild)}}setNonce(t){this.styleTag&&this.styleTag.getAttribute("nonce")!=t&&this.styleTag.setAttribute("nonce",t)}}function di(n){let t;return n.nodeType==11?t=n.getSelection?n:n.ownerDocument:t=n,t.getSelection()}function Gs(n,t){return t?n==t||n.contains(t.nodeType!=1?t.parentNode:t):!1}function gu(n){let t=n.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}function Wi(n,t){if(!t.anchorNode)return!1;try{return Gs(n,t.anchorNode)}catch{return!1}}function je(n){return n.nodeType==3?xe(n,0,n.nodeValue.length).getClientRects():n.nodeType==1?n.getClientRects():[]}function ri(n,t,e,i){return e?nr(n,t,e,i,-1)||nr(n,t,e,i,1):!1}function be(n){for(var t=0;;t++)if(n=n.previousSibling,!n)return t}function Ji(n){return n.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(n.nodeName)}function nr(n,t,e,i,s){for(;;){if(n==e&&t==i)return!0;if(t==(s<0?0:Gt(n))){if(n.nodeName=="DIV")return!1;let r=n.parentNode;if(!r||r.nodeType!=1)return!1;t=be(n)+(s<0?0:1),n=r}else if(n.nodeType==1){if(n=n.childNodes[t+(s<0?-1:0)],n.nodeType==1&&n.contentEditable=="false")return!1;t=s<0?Gt(n):0}else return!1}}function Gt(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function as(n,t){let e=t?n.left:n.right;return{left:e,right:e,top:n.top,bottom:n.bottom}}function mu(n){let t=n.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:n.innerWidth,top:0,bottom:n.innerHeight}}function Vo(n,t){let e=t.width/n.offsetWidth,i=t.height/n.offsetHeight;return(e>.995&&e<1.005||!isFinite(e)||Math.abs(t.width-n.offsetWidth)<1)&&(e=1),(i>.995&&i<1.005||!isFinite(i)||Math.abs(t.height-n.offsetHeight)<1)&&(i=1),{scaleX:e,scaleY:i}}function pu(n,t,e,i,s,r,o,l){let a=n.ownerDocument,c=a.defaultView||window;for(let h=n,u=!1;h&&!u;)if(h.nodeType==1){let f,d=h==a.body,g=1,p=1;if(d)f=mu(c);else{if(/^(fixed|sticky)$/.test(getComputedStyle(h).position)&&(u=!0),h.scrollHeight<=h.clientHeight&&h.scrollWidth<=h.clientWidth){h=h.assignedSlot||h.parentNode;continue}let y=h.getBoundingClientRect();({scaleX:g,scaleY:p}=Vo(h,y)),f={left:y.left,right:y.left+h.clientWidth*g,top:y.top,bottom:y.top+h.clientHeight*p}}let m=0,x=0;if(s=="nearest")t.top<f.top?(x=-(f.top-t.top+o),e>0&&t.bottom>f.bottom+x&&(x=t.bottom-f.bottom+x+o)):t.bottom>f.bottom&&(x=t.bottom-f.bottom+o,e<0&&t.top-x<f.top&&(x=-(f.top+x-t.top+o)));else{let y=t.bottom-t.top,S=f.bottom-f.top;x=(s=="center"&&y<=S?t.top+y/2-S/2:s=="start"||s=="center"&&e<0?t.top-o:t.bottom-S+o)-f.top}if(i=="nearest"?t.left<f.left?(m=-(f.left-t.left+r),e>0&&t.right>f.right+m&&(m=t.right-f.right+m+r)):t.right>f.right&&(m=t.right-f.right+r,e<0&&t.left<f.left+m&&(m=-(f.left+m-t.left+r))):m=(i=="center"?t.left+(t.right-t.left)/2-(f.right-f.left)/2:i=="start"==l?t.left-r:t.right-(f.right-f.left)+r)-f.left,m||x)if(d)c.scrollBy(m,x);else{let y=0,S=0;if(x){let w=h.scrollTop;h.scrollTop+=x/p,S=(h.scrollTop-w)*p}if(m){let w=h.scrollLeft;h.scrollLeft+=m/g,y=(h.scrollLeft-w)*g}t={left:t.left-y,top:t.top-S,right:t.right-y,bottom:t.bottom-S},y&&Math.abs(y-m)<1&&(i="nearest"),S&&Math.abs(S-x)<1&&(s="nearest")}if(d)break;h=h.assignedSlot||h.parentNode}else if(h.nodeType==11)h=h.host;else break}function bu(n){let t=n.ownerDocument,e,i;for(let s=n.parentNode;s&&!(s==t.body||e&&i);)if(s.nodeType==1)!i&&s.scrollHeight>s.clientHeight&&(i=s),!e&&s.scrollWidth>s.clientWidth&&(e=s),s=s.assignedSlot||s.parentNode;else if(s.nodeType==11)s=s.host;else break;return{x:e,y:i}}class xu{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){let{anchorNode:e,focusNode:i}=t;this.set(e,Math.min(t.anchorOffset,e?Gt(e):0),i,Math.min(t.focusOffset,i?Gt(i):0))}set(t,e,i,s){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=s}}let ke=null;function Fo(n){if(n.setActive)return n.setActive();if(ke)return n.focus(ke);let t=[];for(let e=n;e&&(t.push(e,e.scrollTop,e.scrollLeft),e!=e.ownerDocument);e=e.parentNode);if(n.focus(ke==null?{get preventScroll(){return ke={preventScroll:!0},!0}}:void 0),!ke){ke=!1;for(let e=0;e<t.length;){let i=t[e++],s=t[e++],r=t[e++];i.scrollTop!=s&&(i.scrollTop=s),i.scrollLeft!=r&&(i.scrollLeft=r)}}}let rr;function xe(n,t,e=t){let i=rr||(rr=document.createRange());return i.setEnd(n,e),i.setStart(n,t),i}function Ne(n,t,e,i){let s={key:t,code:t,keyCode:e,which:e,cancelable:!0};i&&({altKey:s.altKey,ctrlKey:s.ctrlKey,shiftKey:s.shiftKey,metaKey:s.metaKey}=i);let r=new KeyboardEvent("keydown",s);r.synthetic=!0,n.dispatchEvent(r);let o=new KeyboardEvent("keyup",s);return o.synthetic=!0,n.dispatchEvent(o),r.defaultPrevented||o.defaultPrevented}function yu(n){for(;n;){if(n&&(n.nodeType==9||n.nodeType==11&&n.host))return n;n=n.assignedSlot||n.parentNode}return null}function jo(n){for(;n.attributes.length;)n.removeAttributeNode(n.attributes[0])}function wu(n,t){let e=t.focusNode,i=t.focusOffset;if(!e||t.anchorNode!=e||t.anchorOffset!=i)return!1;for(i=Math.min(i,Gt(e));;)if(i){if(e.nodeType!=1)return!1;let s=e.childNodes[i-1];s.contentEditable=="false"?i--:(e=s,i=Gt(e))}else{if(e==n)return!0;i=be(e),e=e.parentNode}}function Wo(n){return n.scrollTop>Math.max(1,n.scrollHeight-n.clientHeight-4)}function qo(n,t){for(let e=n,i=t;;){if(e.nodeType==3&&i>0)return{node:e,offset:i};if(e.nodeType==1&&i>0){if(e.contentEditable=="false")return null;e=e.childNodes[i-1],i=Gt(e)}else if(e.parentNode&&!Ji(e))i=be(e),e=e.parentNode;else return null}}function _o(n,t){for(let e=n,i=t;;){if(e.nodeType==3&&i<e.nodeValue.length)return{node:e,offset:i};if(e.nodeType==1&&i<e.childNodes.length){if(e.contentEditable=="false")return null;e=e.childNodes[i],i=0}else if(e.parentNode&&!Ji(e))i=be(e)+1,e=e.parentNode;else return null}}class ht{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new ht(t.parentNode,be(t),e)}static after(t,e){return new ht(t.parentNode,be(t)+1,e)}}const An=[];class V{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}sync(t,e){if(this.flags&2){let i=this.dom,s=null,r;for(let o of this.children){if(o.flags&7){if(!o.dom&&(r=s?s.nextSibling:i.firstChild)){let l=V.get(r);(!l||!l.parent&&l.canReuseDOM(o))&&o.reuseDOM(r)}o.sync(t,e),o.flags&=-8}if(r=s?s.nextSibling:i.firstChild,e&&!e.written&&e.node==i&&r!=o.dom&&(e.written=!0),o.dom.parentNode==i)for(;r&&r!=o.dom;)r=or(r);else i.insertBefore(o.dom,r);s=o.dom}for(r=s?s.nextSibling:i.firstChild,r&&e&&e.node==i&&(e.written=!0);r;)r=or(r)}else if(this.flags&1)for(let i of this.children)i.flags&7&&(i.sync(t,e),i.flags&=-8)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let s=Gt(t)==0?0:e==0?-1:1;for(;;){let r=t.parentNode;if(r==this.dom)break;s==0&&r.firstChild!=r.lastChild&&(t==r.firstChild?s=-1:s=1),t=r}s<0?i=t:i=t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!V.get(i);)i=i.nextSibling;if(!i)return this.length;for(let s=0,r=0;;s++){let o=this.children[s];if(o.dom==i)return r;r+=o.length+o.breakAfter}}domBoundsAround(t,e,i=0){let s=-1,r=-1,o=-1,l=-1;for(let a=0,c=i,h=i;a<this.children.length;a++){let u=this.children[a],f=c+u.length;if(c<t&&f>e)return u.domBoundsAround(t,e,c);if(f>=t&&s==-1&&(s=a,r=c),c>e&&u.dom.parentNode==this.dom){o=a,l=h;break}h=f,c=f+u.breakAfter}return{from:r,to:l<0?i+this.length:l,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(t=!1){this.flags|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.flags|=2),e.flags&1)return;e.flags|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.flags&7&&this.markParentsDirty(!0))}setDOM(t){this.dom!=t&&(this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this)}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=An){this.markDirty();for(let s=t;s<e;s++){let r=this.children[s];r.parent==this&&i.indexOf(r)<0&&r.destroy()}this.children.splice(t,e-t,...i);for(let s=0;s<i.length;s++)i[s].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new zo(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+(t=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(t,e,i,s,r,o){return!1}become(t){return!1}canReuseDOM(t){return t.constructor==this.constructor&&!((this.flags|t.flags)&8)}getSide(){return 0}destroy(){for(let t of this.children)t.parent==this&&t.destroy();this.parent=null}}V.prototype.breakAfter=0;function or(n){let t=n.nextSibling;return n.parentNode.removeChild(n),t}class zo{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function $o(n,t,e,i,s,r,o,l,a){let{children:c}=n,h=c.length?c[t]:null,u=r.length?r[r.length-1]:null,f=u?u.breakAfter:o;if(!(t==i&&h&&!o&&!f&&r.length<2&&h.merge(e,s,r.length?u:null,e==0,l,a))){if(i<c.length){let d=c[i];d&&(s<d.length||d.breakAfter&&u?.breakAfter)?(t==i&&(d=d.split(s),s=0),!f&&u&&d.merge(0,s,u,!0,0,a)?r[r.length-1]=d:((s||d.children.length&&!d.children[0].length)&&d.merge(0,s,null,!1,0,a),r.push(d))):d?.breakAfter&&(u?u.breakAfter=1:o=1),i++}for(h&&(h.breakAfter=o,e>0&&(!o&&r.length&&h.merge(e,h.length,r[0],!1,l,0)?h.breakAfter=r.shift().breakAfter:(e<h.length||h.children.length&&h.children[h.children.length-1].length==0)&&h.merge(e,h.length,null,!1,l,0),t++));t<i&&r.length;)if(c[i-1].become(r[r.length-1]))i--,r.pop(),a=r.length?0:l;else if(c[t].become(r[0]))t++,r.shift(),l=r.length?0:a;else break;!r.length&&t&&i<c.length&&!c[t-1].breakAfter&&c[i].merge(0,0,c[t-1],!1,l,a)&&t--,(t<i||r.length)&&n.replaceChildren(t,i,r)}}function Ko(n,t,e,i,s,r){let o=n.childCursor(),{i:l,off:a}=o.findPos(e,1),{i:c,off:h}=o.findPos(t,-1),u=t-e;for(let f of i)u+=f.length;n.length+=u,$o(n,c,h,l,a,i,0,s,r)}let bt=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},Ys=typeof document<"u"?document:{documentElement:{style:{}}};const Xs=/Edge\/(\d+)/.exec(bt.userAgent),Uo=/MSIE \d/.test(bt.userAgent),Js=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(bt.userAgent),hs=!!(Uo||Js||Xs),lr=!hs&&/gecko\/(\d+)/i.test(bt.userAgent),ys=!hs&&/Chrome\/(\d+)/.exec(bt.userAgent),ar="webkitFontSmoothing"in Ys.documentElement.style,Go=!hs&&/Apple Computer/.test(bt.vendor),hr=Go&&(/Mobile\/\w+/.test(bt.userAgent)||bt.maxTouchPoints>2);var C={mac:hr||/Mac/.test(bt.platform),windows:/Win/.test(bt.platform),linux:/Linux|X11/.test(bt.platform),ie:hs,ie_version:Uo?Ys.documentMode||6:Js?+Js[1]:Xs?+Xs[1]:0,gecko:lr,gecko_version:lr?+(/Firefox\/(\d+)/.exec(bt.userAgent)||[0,0])[1]:0,chrome:!!ys,chrome_version:ys?+ys[1]:0,ios:hr,android:/Android\b/.test(bt.userAgent),webkit:ar,safari:Go,webkit_version:ar?+(/\bAppleWebKit\/(\d+)/.exec(bt.userAgent)||[0,0])[1]:0,tabSize:Ys.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const vu=256;class Pt extends V{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t,e){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(e&&e.node==this.dom&&(e.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){t.nodeType==3&&this.createDOM(t)}merge(t,e,i){return this.flags&8||i&&(!(i instanceof Pt)||this.length-(e-t)+i.length>vu||i.flags&8)?!1:(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new Pt(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e.flags|=this.flags&8,e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new ht(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return Su(this.dom,t,e)}}class Yt extends V{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let s of e)s.setParent(this)}setAttrs(t){if(jo(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}canReuseDOM(t){return super.canReuseDOM(t)&&!((this.flags|t.flags)&8)}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.flags|=6)}sync(t,e){this.dom?this.flags&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t,e)}merge(t,e,i,s,r,o){return i&&(!(i instanceof Yt&&i.mark.eq(this.mark))||t&&r<=0||e<this.length&&o<=0)?!1:(Ko(this,t,e,i?i.children.slice():[],r-1,o-1),this.markDirty(),!0)}split(t){let e=[],i=0,s=-1,r=0;for(let l of this.children){let a=i+l.length;a>t&&e.push(i<t?l.split(t-i):l),s<0&&i>=t&&(s=r),i=a,r++}let o=this.length-t;return this.length=t,s>-1&&(this.children.length=s,this.markDirty()),new Yt(this.mark,e,o)}domAtPos(t){return Yo(this,t)}coordsAt(t,e){return Jo(this,t,e)}}function Su(n,t,e){let i=n.nodeValue.length;t>i&&(t=i);let s=t,r=t,o=0;t==0&&e<0||t==i&&e>=0?C.chrome||C.gecko||(t?(s--,o=1):r<i&&(r++,o=-1)):e<0?s--:r<i&&r++;let l=xe(n,s,r).getClientRects();if(!l.length)return null;let a=l[(o?o<0:e>=0)?0:l.length-1];return C.safari&&!o&&a.width==0&&(a=Array.prototype.find.call(l,c=>c.width)||a),o?as(a,o<0):a||null}class de extends V{static create(t,e,i){return new de(t,e,i)}constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}split(t){let e=de.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(t){(!this.dom||!this.widget.updateDOM(this.dom,t))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(t)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(t,e,i,s,r,o){return i&&(!(i instanceof de)||!this.widget.compare(i.widget)||t>0&&r<=0||e<this.length&&o<=0)?!1:(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t instanceof de&&t.side==this.side&&this.widget.constructor==t.widget.constructor?(this.widget.compare(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(this.length==0)return L.empty;let t=this;for(;t.parent;)t=t.parent;let{view:e}=t,i=e&&e.state.doc,s=this.posAtStart;return i?i.slice(s,s+this.length):L.empty}domAtPos(t){return(this.length?t==0:this.side>0)?ht.before(this.dom):ht.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.widget.coordsAt(this.dom,t,e);if(i)return i;let s=this.dom.getClientRects(),r=null;if(!s.length)return null;let o=this.side?this.side<0:t>0;for(let l=o?s.length-1:0;r=s[l],!(t>0?l==0:l==s.length-1||r.top<r.bottom);l+=o?-1:1);return as(r,!o)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class We extends V{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof We&&t.side==this.side}split(){return new We(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return this.side>0?ht.before(this.dom):ht.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){return this.dom.getBoundingClientRect()}get overrideDOMText(){return L.empty}get isHidden(){return!0}}Pt.prototype.children=de.prototype.children=We.prototype.children=An;function Yo(n,t){let e=n.dom,{children:i}=n,s=0;for(let r=0;s<i.length;s++){let o=i[s],l=r+o.length;if(!(l==r&&o.getSide()<=0)){if(t>r&&t<l&&o.dom.parentNode==e)return o.domAtPos(t-r);if(t<=r)break;r=l}}for(let r=s;r>0;r--){let o=i[r-1];if(o.dom.parentNode==e)return o.domAtPos(o.length)}for(let r=s;r<i.length;r++){let o=i[r];if(o.dom.parentNode==e)return o.domAtPos(0)}return new ht(e,0)}function Xo(n,t,e){let i,{children:s}=n;e>0&&t instanceof Yt&&s.length&&(i=s[s.length-1])instanceof Yt&&i.mark.eq(t.mark)?Xo(i,t.children[0],e-1):(s.push(t),t.setParent(n)),n.length+=t.length}function Jo(n,t,e){let i=null,s=-1,r=null,o=-1;function l(c,h){for(let u=0,f=0;u<c.children.length&&f<=h;u++){let d=c.children[u],g=f+d.length;g>=h&&(d.children.length?l(d,h-f):(!r||r.isHidden&&e>0)&&(g>h||f==g&&d.getSide()>0)?(r=d,o=h-f):(f<h||f==g&&d.getSide()<0&&!d.isHidden)&&(i=d,s=h-f)),f=g}}l(n,t);let a=(e<0?i:r)||i||r;return a?a.coordsAt(Math.max(0,a==i?s:o),e):Cu(n)}function Cu(n){let t=n.dom.lastChild;if(!t)return n.dom.getBoundingClientRect();let e=je(t);return e[e.length-1]||null}function Qs(n,t){for(let e in n)e=="class"&&t.class?t.class+=" "+n.class:e=="style"&&t.style?t.style+=";"+n.style:t[e]=n[e];return t}const cr=Object.create(null);function Qi(n,t,e){if(n==t)return!0;n||(n=cr),t||(t=cr);let i=Object.keys(n),s=Object.keys(t);if(i.length-(e&&i.indexOf(e)>-1?1:0)!=s.length-(e&&s.indexOf(e)>-1?1:0))return!1;for(let r of i)if(r!=e&&(s.indexOf(r)==-1||n[r]!==t[r]))return!1;return!0}function Zs(n,t,e){let i=!1;if(t)for(let s in t)e&&s in e||(i=!0,s=="style"?n.style.cssText="":n.removeAttribute(s));if(e)for(let s in e)t&&t[s]==e[s]||(i=!0,s=="style"?n.style.cssText=e[s]:n.setAttribute(s,e[s]));return i}function ku(n){let t=Object.create(null);for(let e=0;e<n.attributes.length;e++){let i=n.attributes[e];t[i.name]=i.value}return t}class Q extends V{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,s,r,o){if(i){if(!(i instanceof Q))return!1;this.dom||i.transferDOM(this)}return s&&this.setDeco(i?i.attrs:null),Ko(this,t,e,i?i.children.slice():[],r,o),!0}split(t){let e=new Q;if(e.breakAfter=this.breakAfter,this.length==0)return e;let{i,off:s}=this.childPos(t);s&&(e.append(this.children[i].split(s),0),this.children[i].merge(s,this.children[i].length,null,!1,0,0),i++);for(let r=i;r<this.children.length;r++)e.append(this.children[r],0);for(;i>0&&this.children[i-1].length==0;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(this.markDirty(),t.setDOM(this.dom),t.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){Qi(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){Xo(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=Qs(e,this.attrs||{})),i&&(this.attrs=Qs({class:i},this.attrs||{}))}domAtPos(t){return Yo(this,t)}reuseDOM(t){t.nodeName=="DIV"&&(this.setDOM(t),this.flags|=6)}sync(t,e){var i;this.dom?this.flags&4&&(jo(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(Zs(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t,e);let s=this.dom.lastChild;for(;s&&V.get(s)instanceof Yt;)s=s.lastChild;if(!s||!this.length||s.nodeName!="BR"&&((i=V.get(s))===null||i===void 0?void 0:i.isEditable)==!1&&(!C.ios||!this.children.some(r=>r instanceof Pt))){let r=document.createElement("BR");r.cmIgnore=!0,this.dom.appendChild(r)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let t=0,e;for(let i of this.children){if(!(i instanceof Pt)||/[^ -~]/.test(i.text))return null;let s=je(i.dom);if(s.length!=1)return null;t+=s[0].width,e=s[0].height}return t?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length,textHeight:e}:null}coordsAt(t,e){let i=Jo(this,t,e);if(!this.children.length&&i&&this.parent){let{heightOracle:s}=this.parent.view.viewState,r=i.bottom-i.top;if(Math.abs(r-s.lineHeight)<2&&s.textHeight<r){let o=(r-s.textHeight)/2;return{top:i.top+o,bottom:i.bottom-o,left:i.left,right:i.left}}}return i}become(t){return t instanceof Q&&this.children.length==0&&t.children.length==0&&Qi(this.attrs,t.attrs)&&this.breakAfter==t.breakAfter}covers(){return!0}static find(t,e){for(let i=0,s=0;i<t.children.length;i++){let r=t.children[i],o=s+r.length;if(o>=e){if(r instanceof Q)return r;if(o>e)break}s=o+r.breakAfter}return null}}class Ut extends V{constructor(t,e,i){super(),this.widget=t,this.length=e,this.deco=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,s,r,o){return i&&(!(i instanceof Ut)||!this.widget.compare(i.widget)||t>0&&r<=0||e<this.length&&o<=0)?!1:(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return t==0?ht.before(this.dom):ht.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new Ut(this.widget,e,this.deco);return i.breakAfter=this.breakAfter,i}get children(){return An}sync(t){(!this.dom||!this.widget.updateDOM(this.dom,t))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(t)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):L.empty}domBoundsAround(){return null}become(t){return t instanceof Ut&&t.widget.constructor==this.widget.constructor?(t.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.deco=t.deco,this.breakAfter=t.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(t,e){return this.widget.coordsAt(this.dom,t,e)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(t){let{startSide:e,endSide:i}=this.deco;return e==i?!1:t<0?e<0:i>0}}class ze{eq(t){return!1}updateDOM(t,e){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(t){return!0}coordsAt(t,e,i){return null}get isHidden(){return!1}get editable(){return!1}destroy(t){}}var dt=function(n){return n[n.Text=0]="Text",n[n.WidgetBefore=1]="WidgetBefore",n[n.WidgetAfter=2]="WidgetAfter",n[n.WidgetRange=3]="WidgetRange",n}(dt||(dt={}));class I extends Ve{constructor(t,e,i,s){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=s}get heightRelevant(){return!1}static mark(t){return new wi(t)}static widget(t){let e=Math.max(-1e4,Math.min(1e4,t.side||0)),i=!!t.block;return e+=i&&!t.inlineOrder?e>0?3e8:-4e8:e>0?1e8:-1e8,new re(t,e,e,i,t.widget||null,!1)}static replace(t){let e=!!t.block,i,s;if(t.isBlockGap)i=-5e8,s=4e8;else{let{start:r,end:o}=Qo(t,e);i=(r?e?-3e8:-1:5e8)-1,s=(o?e?2e8:1:-6e8)+1}return new re(t,i,s,e,t.widget||null,!0)}static line(t){return new vi(t)}static set(t,e=!1){return N.of(t,e)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}I.none=N.empty;class wi extends I{constructor(t){let{start:e,end:i}=Qo(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){var e,i;return this==t||t instanceof wi&&this.tagName==t.tagName&&(this.class||((e=this.attrs)===null||e===void 0?void 0:e.class))==(t.class||((i=t.attrs)===null||i===void 0?void 0:i.class))&&Qi(this.attrs,t.attrs,"class")}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}wi.prototype.point=!1;class vi extends I{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof vi&&this.spec.class==t.spec.class&&Qi(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}vi.prototype.mapMode=St.TrackBefore;vi.prototype.point=!0;class re extends I{constructor(t,e,i,s,r,o){super(e,i,r,t),this.block=s,this.isReplace=o,this.mapMode=s?e<=0?St.TrackBefore:St.TrackAfter:St.TrackDel}get type(){return this.startSide!=this.endSide?dt.WidgetRange:this.startSide<=0?dt.WidgetBefore:dt.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(t){return t instanceof re&&Mu(this.widget,t.widget)&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}re.prototype.point=!0;function Qo(n,t=!1){let{inclusiveStart:e,inclusiveEnd:i}=n;return e==null&&(e=n.inclusive),i==null&&(i=n.inclusive),{start:e??t,end:i??t}}function Mu(n,t){return n==t||!!(n&&t&&n.compare(t))}function tn(n,t,e,i=0){let s=e.length-1;s>=0&&e[s]+i>=n?e[s]=Math.max(e[s],t):e.push(n,t)}class oi{constructor(t,e,i,s){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsFor=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof Ut&&t.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new Q),this.atCursorPos=!0),this.curLine}flushBuffer(t=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(Oi(new We(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer(),this.curLine=null,this.content.push(t)}finish(t){this.pendingBuffer&&t<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,!this.posCovered()&&!(t&&this.content.length&&this.content[this.content.length-1]instanceof Ut)&&this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:r,lineBreak:o,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(o){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,t--;continue}else this.text=r,this.textOff=0}let s=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(e.length-i)),this.getLine().append(Oi(new Pt(this.text.slice(this.textOff,this.textOff+s)),e),i),this.atCursorPos=!0,this.textOff+=s,t-=s,i=0}}span(t,e,i,s){this.buildText(e-t,i,s),this.pos=e,this.openStart<0&&(this.openStart=s)}point(t,e,i,s,r,o){if(this.disallowBlockEffectsFor[o]&&i instanceof re){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let l=e-t;if(i instanceof re)if(i.block)i.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new Ut(i.widget||qe.block,l,i));else{let a=de.create(i.widget||qe.inline,l,l?0:i.startSide),c=this.atCursorPos&&!a.isEditable&&r<=s.length&&(t<e||i.startSide>0),h=!a.isEditable&&(t<e||r>s.length||i.startSide<=0),u=this.getLine();this.pendingBuffer==2&&!c&&!a.isEditable&&(this.pendingBuffer=0),this.flushBuffer(s),c&&(u.append(Oi(new We(1),s),r),r=s.length+Math.max(0,r-s.length)),u.append(Oi(a,s),r),this.atCursorPos=h,this.pendingBuffer=h?t<e||r>s.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=s.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);l&&(this.textOff+l<=this.text.length?this.textOff+=l:(this.skip+=l-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=r)}static build(t,e,i,s,r){let o=new oi(t,e,i,r);return o.openEnd=N.spans(s,e,i,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}}function Oi(n,t){for(let e of t)n=new Yt(e,[n],n.length);return n}class qe extends ze{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}qe.inline=new qe("span");qe.block=new qe("div");var Z=function(n){return n[n.LTR=0]="LTR",n[n.RTL=1]="RTL",n}(Z||(Z={}));const ye=Z.LTR,Tn=Z.RTL;function Zo(n){let t=[];for(let e=0;e<n.length;e++)t.push(1<<+n[e]);return t}const Au=Zo("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),Tu=Zo("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),en=Object.create(null),Ht=[];for(let n of["()","[]","{}"]){let t=n.charCodeAt(0),e=n.charCodeAt(1);en[t]=e,en[e]=-t}function tl(n){return n<=247?Au[n]:1424<=n&&n<=1524?2:1536<=n&&n<=1785?Tu[n-1536]:1774<=n&&n<=2220?4:8192<=n&&n<=8204?256:64336<=n&&n<=65023?4:1}const Eu=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class ie{get dir(){return this.level%2?Tn:ye}constructor(t,e,i){this.from=t,this.to=e,this.level=i}side(t,e){return this.dir==e==t?this.to:this.from}forward(t,e){return t==(this.dir==e)}static find(t,e,i,s){let r=-1;for(let o=0;o<t.length;o++){let l=t[o];if(l.from<=e&&l.to>=e){if(l.level==i)return o;(r<0||(s!=0?s<0?l.from<e:l.to>e:t[r].level>l.level))&&(r=o)}}if(r<0)throw new RangeError("Index out of range");return r}}function el(n,t){if(n.length!=t.length)return!1;for(let e=0;e<n.length;e++){let i=n[e],s=t[e];if(i.from!=s.from||i.to!=s.to||i.direction!=s.direction||!el(i.inner,s.inner))return!1}return!0}const H=[];function Ou(n,t,e,i,s){for(let r=0;r<=i.length;r++){let o=r?i[r-1].to:t,l=r<i.length?i[r].from:e,a=r?256:s;for(let c=o,h=a,u=a;c<l;c++){let f=tl(n.charCodeAt(c));f==512?f=h:f==8&&u==4&&(f=16),H[c]=f==4?2:f,f&7&&(u=f),h=f}for(let c=o,h=a,u=a;c<l;c++){let f=H[c];if(f==128)c<l-1&&h==H[c+1]&&h&24?f=H[c]=h:H[c]=256;else if(f==64){let d=c+1;for(;d<l&&H[d]==64;)d++;let g=c&&h==8||d<e&&H[d]==8?u==1?1:8:256;for(let p=c;p<d;p++)H[p]=g;c=d-1}else f==8&&u==1&&(H[c]=1);h=f,f&7&&(u=f)}}}function Du(n,t,e,i,s){let r=s==1?2:1;for(let o=0,l=0,a=0;o<=i.length;o++){let c=o?i[o-1].to:t,h=o<i.length?i[o].from:e;for(let u=c,f,d,g;u<h;u++)if(d=en[f=n.charCodeAt(u)])if(d<0){for(let p=l-3;p>=0;p-=3)if(Ht[p+1]==-d){let m=Ht[p+2],x=m&2?s:m&4?m&1?r:s:0;x&&(H[u]=H[Ht[p]]=x),l=p;break}}else{if(Ht.length==189)break;Ht[l++]=u,Ht[l++]=f,Ht[l++]=a}else if((g=H[u])==2||g==1){let p=g==s;a=p?0:1;for(let m=l-3;m>=0;m-=3){let x=Ht[m+2];if(x&2)break;if(p)Ht[m+2]|=2;else{if(x&4)break;Ht[m+2]|=4}}}}}function Ru(n,t,e,i){for(let s=0,r=i;s<=e.length;s++){let o=s?e[s-1].to:n,l=s<e.length?e[s].from:t;for(let a=o;a<l;){let c=H[a];if(c==256){let h=a+1;for(;;)if(h==l){if(s==e.length)break;h=e[s++].to,l=s<e.length?e[s].from:t}else if(H[h]==256)h++;else break;let u=r==1,f=(h<t?H[h]:i)==1,d=u==f?u?1:2:i;for(let g=h,p=s,m=p?e[p-1].to:n;g>a;)g==m&&(g=e[--p].from,m=p?e[p-1].to:n),H[--g]=d;a=h}else r=c,a++}}}function sn(n,t,e,i,s,r,o){let l=i%2?2:1;if(i%2==s%2)for(let a=t,c=0;a<e;){let h=!0,u=!1;if(c==r.length||a<r[c].from){let p=H[a];p!=l&&(h=!1,u=p==16)}let f=!h&&l==1?[]:null,d=h?i:i+1,g=a;t:for(;;)if(c<r.length&&g==r[c].from){if(u)break t;let p=r[c];if(!h)for(let m=p.to,x=c+1;;){if(m==e)break t;if(x<r.length&&r[x].from==m)m=r[x++].to;else{if(H[m]==l)break t;break}}if(c++,f)f.push(p);else{p.from>a&&o.push(new ie(a,p.from,d));let m=p.direction==ye!=!(d%2);nn(n,m?i+1:i,s,p.inner,p.from,p.to,o),a=p.to}g=p.to}else{if(g==e||(h?H[g]!=l:H[g]==l))break;g++}f?sn(n,a,g,i+1,s,f,o):a<g&&o.push(new ie(a,g,d)),a=g}else for(let a=e,c=r.length;a>t;){let h=!0,u=!1;if(!c||a>r[c-1].to){let p=H[a-1];p!=l&&(h=!1,u=p==16)}let f=!h&&l==1?[]:null,d=h?i:i+1,g=a;t:for(;;)if(c&&g==r[c-1].to){if(u)break t;let p=r[--c];if(!h)for(let m=p.from,x=c;;){if(m==t)break t;if(x&&r[x-1].to==m)m=r[--x].from;else{if(H[m-1]==l)break t;break}}if(f)f.push(p);else{p.to<a&&o.push(new ie(p.to,a,d));let m=p.direction==ye!=!(d%2);nn(n,m?i+1:i,s,p.inner,p.from,p.to,o),a=p.from}g=p.from}else{if(g==t||(h?H[g-1]!=l:H[g-1]==l))break;g--}f?sn(n,g,a,i+1,s,f,o):g<a&&o.push(new ie(g,a,d)),a=g}}function nn(n,t,e,i,s,r,o){let l=t%2?2:1;Ou(n,s,r,i,l),Du(n,s,r,i,l),Ru(s,r,i,l),sn(n,s,r,t,e,i,o)}function Pu(n,t,e){if(!n)return[new ie(0,0,t==Tn?1:0)];if(t==ye&&!e.length&&!Eu.test(n))return il(n.length);if(e.length)for(;n.length>H.length;)H[H.length]=256;let i=[],s=t==ye?0:1;return nn(n,s,s,e,0,n.length,i),i}function il(n){return[new ie(0,n,0)]}let sl="";function Nu(n,t,e,i,s){var r;let o=i.head-n.from,l=ie.find(t,o,(r=i.bidiLevel)!==null&&r!==void 0?r:-1,i.assoc),a=t[l],c=a.side(s,e);if(o==c){let f=l+=s?1:-1;if(f<0||f>=t.length)return null;a=t[l=f],o=a.side(!s,e),c=a.side(s,e)}let h=Wt(n.text,o,a.forward(s,e));(h<a.from||h>a.to)&&(h=c),sl=n.text.slice(Math.min(o,h),Math.max(o,h));let u=l==(s?t.length-1:0)?null:t[l+(s?1:-1)];return u&&h==c&&u.level+(s?0:1)<a.level?M.cursor(u.side(!s,e)+n.from,u.forward(s,e)?1:-1,u.level):M.cursor(h+n.from,a.forward(s,e)?-1:1,a.level)}function Lu(n,t,e){for(let i=t;i<e;i++){let s=tl(n.charCodeAt(i));if(s==1)return ye;if(s==2||s==4)return Tn}return ye}const nl=T.define(),rl=T.define(),ol=T.define(),ll=T.define(),rn=T.define(),al=T.define(),hl=T.define(),cl=T.define({combine:n=>n.some(t=>t)}),ul=T.define({combine:n=>n.some(t=>t)}),fl=T.define();class Le{constructor(t,e="nearest",i="nearest",s=5,r=5,o=!1){this.range=t,this.y=e,this.x=i,this.yMargin=s,this.xMargin=r,this.isSnapshot=o}map(t){return t.empty?this:new Le(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(t){return this.range.to<=t.doc.length?this:new Le(M.cursor(t.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const Di=K.define({map:(n,t)=>n.map(t)}),dl=K.define();function $t(n,t,e){let i=n.facet(ll);i.length?i[0](t):window.onerror?window.onerror(String(t),e,void 0,void 0,t):e?console.error(e+":",t):console.error(t)}const Zt=T.define({combine:n=>n.length?n[0]:!0});let Iu=0;const Qe=T.define();class Nt{constructor(t,e,i,s,r){this.id=t,this.create=e,this.domEventHandlers=i,this.domEventObservers=s,this.extension=r(this)}static define(t,e){const{eventHandlers:i,eventObservers:s,provide:r,decorations:o}=e||{};return new Nt(Iu++,t,i,s,l=>{let a=[Qe.of(l)];return o&&a.push(gi.of(c=>{let h=c.plugin(l);return h?o(h):I.none})),r&&a.push(r(l)),a})}static fromClass(t,e){return Nt.define(i=>new t(i),e)}}class ws{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}update(t){if(this.value){if(this.mustUpdate){let e=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(e)}catch(i){if($t(e.state,i,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){$t(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(!((e=this.value)===null||e===void 0)&&e.destroy)try{this.value.destroy()}catch(i){$t(t.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const gl=T.define(),En=T.define(),gi=T.define(),ml=T.define(),On=T.define(),pl=T.define();function ur(n,t){let e=n.state.facet(pl);if(!e.length)return e;let i=e.map(r=>r instanceof Function?r(n):r),s=[];return N.spans(i,t.from,t.to,{point(){},span(r,o,l,a){let c=r-t.from,h=o-t.from,u=s;for(let f=l.length-1;f>=0;f--,a--){let d=l[f].spec.bidiIsolate,g;if(d==null&&(d=Lu(t.text,c,h)),a>0&&u.length&&(g=u[u.length-1]).to==c&&g.direction==d)g.to=h,u=g.inner;else{let p={from:c,to:h,direction:d,inner:[]};u.push(p),u=p.inner}}}}),s}const bl=T.define();function xl(n){let t=0,e=0,i=0,s=0;for(let r of n.state.facet(bl)){let o=r(n);o&&(o.left!=null&&(t=Math.max(t,o.left)),o.right!=null&&(e=Math.max(e,o.right)),o.top!=null&&(i=Math.max(i,o.top)),o.bottom!=null&&(s=Math.max(s,o.bottom)))}return{left:t,right:e,top:i,bottom:s}}const Ze=T.define();class At{constructor(t,e,i,s){this.fromA=t,this.toA=e,this.fromB=i,this.toB=s}join(t){return new At(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let s=t[e-1];if(!(s.fromA>i.toA)){if(s.toA<i.fromA)break;i=i.join(s),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(e.length==0)return t;let i=[];for(let s=0,r=0,o=0,l=0;;s++){let a=s==t.length?null:t[s],c=o-l,h=a?a.fromB:1e9;for(;r<e.length&&e[r]<h;){let u=e[r],f=e[r+1],d=Math.max(l,u),g=Math.min(h,f);if(d<=g&&new At(d+c,g+c,d,g).addToSet(i),f>h)break;r+=2}if(!a)return i;new At(a.fromA,a.toA,a.fromB,a.toB).addToSet(i),o=a.toA,l=a.toB}}}class Zi{constructor(t,e,i){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=it.empty(this.startState.doc.length);for(let r of i)this.changes=this.changes.compose(r.changes);let s=[];this.changes.iterChangedRanges((r,o,l,a)=>s.push(new At(r,o,l,a))),this.changedRanges=s}static create(t,e,i){return new Zi(t,e,i)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(t=>t.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}class fr extends V{get length(){return this.view.state.doc.length}constructor(t){super(),this.view=t,this.decorations=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.editContextFormatting=I.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new Q],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new At(0,0,0,t.state.doc.length)],0,null)}update(t){var e;let i=t.changedRanges;this.minWidth>0&&i.length&&(i.every(({fromA:c,toA:h})=>h<this.minWidthFrom||c>this.minWidthTo)?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(t);let s=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&(!((e=this.domChanged)===null||e===void 0)&&e.newSel?s=this.domChanged.newSel.head:!qu(t.changes,this.hasComposition)&&!t.selectionSet&&(s=t.state.selection.main.head));let r=s>-1?Hu(this.view,t.changes,s):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:c,to:h}=this.hasComposition;i=new At(c,h,t.changes.mapPos(c,-1),t.changes.mapPos(h,1)).addToSet(i.slice())}this.hasComposition=r?{from:r.range.fromB,to:r.range.toB}:null,(C.ie||C.chrome)&&!r&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let o=this.decorations,l=this.updateDeco(),a=ju(o,l,t.changes);return i=At.extendWithRanges(i,a),!(this.flags&7)&&i.length==0?!1:(this.updateInner(i,t.startState.doc.length,r),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e,i){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e,i);let{observer:s}=this.view;s.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let o=C.chrome||C.ios?{node:s.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,o),this.flags&=-8,o&&(o.written||s.selectionRange.focusNode!=o.node)&&(this.forceSelection=!0),this.dom.style.height=""}),this.markedForComposition.forEach(o=>o.flags&=-9);let r=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let o of this.children)o instanceof Ut&&o.widget instanceof dr&&r.push(o.dom);s.updateGaps(r)}updateChildren(t,e,i){let s=i?i.range.addToSet(t.slice()):t,r=this.childCursor(e);for(let o=s.length-1;;o--){let l=o>=0?s[o]:null;if(!l)break;let{fromA:a,toA:c,fromB:h,toB:u}=l,f,d,g,p;if(i&&i.range.fromB<u&&i.range.toB>h){let w=oi.build(this.view.state.doc,h,i.range.fromB,this.decorations,this.dynamicDecorationMap),k=oi.build(this.view.state.doc,i.range.toB,u,this.decorations,this.dynamicDecorationMap);d=w.breakAtStart,g=w.openStart,p=k.openEnd;let A=this.compositionView(i);k.breakAtStart?A.breakAfter=1:k.content.length&&A.merge(A.length,A.length,k.content[0],!1,k.openStart,0)&&(A.breakAfter=k.content[0].breakAfter,k.content.shift()),w.content.length&&A.merge(0,0,w.content[w.content.length-1],!0,0,w.openEnd)&&w.content.pop(),f=w.content.concat(A).concat(k.content)}else({content:f,breakAtStart:d,openStart:g,openEnd:p}=oi.build(this.view.state.doc,h,u,this.decorations,this.dynamicDecorationMap));let{i:m,off:x}=r.findPos(c,1),{i:y,off:S}=r.findPos(a,-1);$o(this,y,S,m,x,f,d,g,p)}i&&this.fixCompositionDOM(i)}updateEditContextFormatting(t){this.editContextFormatting=this.editContextFormatting.map(t.changes);for(let e of t.transactions)for(let i of e.effects)i.is(dl)&&(this.editContextFormatting=i.value)}compositionView(t){let e=new Pt(t.text.nodeValue);e.flags|=8;for(let{deco:s}of t.marks)e=new Yt(s,[e],e.length);let i=new Q;return i.append(e,0),i}fixCompositionDOM(t){let e=(r,o)=>{o.flags|=8|(o.children.some(a=>a.flags&7)?1:0),this.markedForComposition.add(o);let l=V.get(r);l&&l!=o&&(l.dom=null),o.setDOM(r)},i=this.childPos(t.range.fromB,1),s=this.children[i.i];e(t.line,s);for(let r=t.marks.length-1;r>=-1;r--)i=s.childPos(i.off,1),s=s.children[i.i],e(r>=0?t.marks[r].node:t.text,s)}updateSelection(t=!1,e=!1){(t||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let i=this.view.root.activeElement,s=i==this.dom,r=!s&&Wi(this.dom,this.view.observer.selectionRange)&&!(i&&this.dom.contains(i));if(!(s||e||r))return;let o=this.forceSelection;this.forceSelection=!1;let l=this.view.state.selection.main,a=this.moveToLine(this.domAtPos(l.anchor)),c=l.empty?a:this.moveToLine(this.domAtPos(l.head));if(C.gecko&&l.empty&&!this.hasComposition&&Bu(a)){let u=document.createTextNode("");this.view.observer.ignore(()=>a.node.insertBefore(u,a.node.childNodes[a.offset]||null)),a=c=new ht(u,0),o=!0}let h=this.view.observer.selectionRange;(o||!h.focusNode||(!ri(a.node,a.offset,h.anchorNode,h.anchorOffset)||!ri(c.node,c.offset,h.focusNode,h.focusOffset))&&!this.suppressWidgetCursorChange(h,l))&&(this.view.observer.ignore(()=>{C.android&&C.chrome&&this.dom.contains(h.focusNode)&&Wu(h.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let u=di(this.view.root);if(u)if(l.empty){if(C.gecko){let f=Vu(a.node,a.offset);if(f&&f!=3){let d=(f==1?qo:_o)(a.node,a.offset);d&&(a=new ht(d.node,d.offset))}}u.collapse(a.node,a.offset),l.bidiLevel!=null&&u.caretBidiLevel!==void 0&&(u.caretBidiLevel=l.bidiLevel)}else if(u.extend){u.collapse(a.node,a.offset);try{u.extend(c.node,c.offset)}catch{}}else{let f=document.createRange();l.anchor>l.head&&([a,c]=[c,a]),f.setEnd(c.node,c.offset),f.setStart(a.node,a.offset),u.removeAllRanges(),u.addRange(f)}r&&this.view.root.activeElement==this.dom&&(this.dom.blur(),i&&i.focus())}),this.view.observer.setSelectionRange(a,c)),this.impreciseAnchor=a.precise?null:new ht(h.anchorNode,h.anchorOffset),this.impreciseHead=c.precise?null:new ht(h.focusNode,h.focusOffset)}suppressWidgetCursorChange(t,e){return this.hasComposition&&e.empty&&ri(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)&&this.posFromDOM(t.focusNode,t.focusOffset)==e.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:t}=this,e=t.state.selection.main,i=di(t.root),{anchorNode:s,anchorOffset:r}=t.observer.selectionRange;if(!i||!e.empty||!e.assoc||!i.modify)return;let o=Q.find(this,e.head);if(!o)return;let l=o.posAtStart;if(e.head==l||e.head==l+o.length)return;let a=this.coordsAt(e.head,-1),c=this.coordsAt(e.head,1);if(!a||!c||a.bottom>c.top)return;let h=this.domAtPos(e.head+e.assoc);i.collapse(h.node,h.offset),i.modify("move",e.assoc<0?"forward":"backward","lineboundary"),t.observer.readSelectionRange();let u=t.observer.selectionRange;t.docView.posFromDOM(u.anchorNode,u.anchorOffset)!=e.from&&i.collapse(s,r)}moveToLine(t){let e=this.dom,i;if(t.node!=e)return t;for(let s=t.offset;!i&&s<e.childNodes.length;s++){let r=V.get(e.childNodes[s]);r instanceof Q&&(i=r.domAtPos(0))}for(let s=t.offset-1;!i&&s>=0;s--){let r=V.get(e.childNodes[s]);r instanceof Q&&(i=r.domAtPos(r.length))}return i?new ht(i.node,i.offset,!0):t}nearest(t){for(let e=t;e;){let i=V.get(e);if(i&&i.rootView==this)return i;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let s=this.children[e];if(i<s.length||s instanceof Q)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){let i=null,s=0;for(let r=this.length,o=this.children.length-1;o>=0;o--){let l=this.children[o],a=r-l.breakAfter,c=a-l.length;if(a<t)break;if(c<=t&&(c<t||l.covers(-1))&&(a>t||l.covers(1))&&(!i||l instanceof Q&&!(i instanceof Q&&e>=0)))i=l,s=c;else if(i&&c==t&&a==t&&l instanceof Ut&&Math.abs(e)<2){if(l.deco.startSide<0)break;o&&(i=null)}r=c}return i?i.coordsAt(t-s,e):null}coordsForChar(t){let{i:e,off:i}=this.childPos(t,1),s=this.children[e];if(!(s instanceof Q))return null;for(;s.children.length;){let{i:l,off:a}=s.childPos(i,1);for(;;l++){if(l==s.children.length)return null;if((s=s.children[l]).length)break}i=a}if(!(s instanceof Pt))return null;let r=Wt(s.text,i);if(r==i)return null;let o=xe(s.dom,i,r).getClientRects();for(let l=0;l<o.length;l++){let a=o[l];if(l==o.length-1||a.top<a.bottom&&a.left<a.right)return a}return null}measureVisibleLineHeights(t){let e=[],{from:i,to:s}=t,r=this.view.contentDOM.clientWidth,o=r>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,l=-1,a=this.view.textDirection==Z.LTR;for(let c=0,h=0;h<this.children.length;h++){let u=this.children[h],f=c+u.length;if(f>s)break;if(c>=i){let d=u.dom.getBoundingClientRect();if(e.push(d.height),o){let g=u.dom.lastChild,p=g?je(g):[];if(p.length){let m=p[p.length-1],x=a?m.right-d.left:d.right-m.left;x>l&&(l=x,this.minWidth=r,this.minWidthFrom=c,this.minWidthTo=f)}}}c=f+u.breakAfter}return e}textDirectionAt(t){let{i:e}=this.childPos(t,1);return getComputedStyle(this.children[e].dom).direction=="rtl"?Z.RTL:Z.LTR}measureTextSize(){for(let r of this.children)if(r instanceof Q){let o=r.measureTextSize();if(o)return o}let t=document.createElement("div"),e,i,s;return t.className="cm-line",t.style.width="99999px",t.style.position="absolute",t.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(t);let r=je(t.firstChild)[0];e=t.getBoundingClientRect().height,i=r?r.width/27:7,s=r?r.height:e,t.remove()}),{lineHeight:e,charWidth:i,textHeight:s}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new zo(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,s=0;;s++){let r=s==e.viewports.length?null:e.viewports[s],o=r?r.from-1:this.length;if(o>i){let l=(e.lineBlockAt(o).bottom-e.lineBlockAt(i).top)/this.view.scaleY;t.push(I.replace({widget:new dr(l),block:!0,inclusive:!0,isBlockGap:!0}).range(i,o))}if(!r)break;i=r.to+1}return I.set(t)}updateDeco(){let t=1,e=this.view.state.facet(gi).map(r=>(this.dynamicDecorationMap[t++]=typeof r=="function")?r(this.view):r),i=!1,s=this.view.state.facet(ml).map((r,o)=>{let l=typeof r=="function";return l&&(i=!0),l?r(this.view):r});for(s.length&&(this.dynamicDecorationMap[t++]=i,e.push(N.join(s))),this.decorations=[this.editContextFormatting,...e,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];t<this.decorations.length;)this.dynamicDecorationMap[t++]=!1;return this.decorations}scrollIntoView(t){if(t.isSnapshot){let c=this.view.viewState.lineBlockAt(t.range.head);this.view.scrollDOM.scrollTop=c.top-t.yMargin,this.view.scrollDOM.scrollLeft=t.xMargin;return}for(let c of this.view.state.facet(fl))try{if(c(this.view,t.range,t))return!0}catch(h){$t(this.view.state,h,"scroll handler")}let{range:e}=t,i=this.coordsAt(e.head,e.empty?e.assoc:e.head>e.anchor?-1:1),s;if(!i)return;!e.empty&&(s=this.coordsAt(e.anchor,e.anchor>e.head?-1:1))&&(i={left:Math.min(i.left,s.left),top:Math.min(i.top,s.top),right:Math.max(i.right,s.right),bottom:Math.max(i.bottom,s.bottom)});let r=xl(this.view),o={left:i.left-r.left,top:i.top-r.top,right:i.right+r.right,bottom:i.bottom+r.bottom},{offsetWidth:l,offsetHeight:a}=this.view.scrollDOM;pu(this.view.scrollDOM,o,e.head<e.anchor?-1:1,t.x,t.y,Math.max(Math.min(t.xMargin,l),-l),Math.max(Math.min(t.yMargin,a),-a),this.view.textDirection==Z.LTR)}}function Bu(n){return n.node.nodeType==1&&n.node.firstChild&&(n.offset==0||n.node.childNodes[n.offset-1].contentEditable=="false")&&(n.offset==n.node.childNodes.length||n.node.childNodes[n.offset].contentEditable=="false")}class dr extends ze{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return t.className="cm-gap",this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}function yl(n,t){let e=n.observer.selectionRange;if(!e.focusNode)return null;let i=qo(e.focusNode,e.focusOffset),s=_o(e.focusNode,e.focusOffset),r=i||s;if(s&&i&&s.node!=i.node){let l=V.get(s.node);if(!l||l instanceof Pt&&l.text!=s.node.nodeValue)r=s;else if(n.docView.lastCompositionAfterCursor){let a=V.get(i.node);!a||a instanceof Pt&&a.text!=i.node.nodeValue||(r=s)}}if(n.docView.lastCompositionAfterCursor=r!=i,!r)return null;let o=t-r.offset;return{from:o,to:o+r.node.nodeValue.length,node:r.node}}function Hu(n,t,e){let i=yl(n,e);if(!i)return null;let{node:s,from:r,to:o}=i,l=s.nodeValue;if(/[\n\r]/.test(l)||n.state.doc.sliceString(i.from,i.to)!=l)return null;let a=t.invertedDesc,c=new At(a.mapPos(r),a.mapPos(o),r,o),h=[];for(let u=s.parentNode;;u=u.parentNode){let f=V.get(u);if(f instanceof Yt)h.push({node:u,deco:f.mark});else{if(f instanceof Q||u.nodeName=="DIV"&&u.parentNode==n.contentDOM)return{range:c,text:s,marks:h,line:u};if(u!=n.contentDOM)h.push({node:u,deco:new wi({inclusive:!0,attributes:ku(u),tagName:u.tagName.toLowerCase()})});else return null}}}function Vu(n,t){return n.nodeType!=1?0:(t&&n.childNodes[t-1].contentEditable=="false"?1:0)|(t<n.childNodes.length&&n.childNodes[t].contentEditable=="false"?2:0)}let Fu=class{constructor(){this.changes=[]}compareRange(t,e){tn(t,e,this.changes)}comparePoint(t,e){tn(t,e,this.changes)}};function ju(n,t,e){let i=new Fu;return N.compare(n,t,e,i),i.changes}function Wu(n,t){for(let e=n;e&&e!=t;e=e.assignedSlot||e.parentNode)if(e.nodeType==1&&e.contentEditable=="false")return!0;return!1}function qu(n,t){let e=!1;return t&&n.iterChangedRanges((i,s)=>{i<t.to&&s>t.from&&(e=!0)}),e}function _u(n,t,e=1){let i=n.charCategorizer(t),s=n.doc.lineAt(t),r=t-s.from;if(s.length==0)return M.cursor(t);r==0?e=1:r==s.length&&(e=-1);let o=r,l=r;e<0?o=Wt(s.text,r,!1):l=Wt(s.text,r);let a=i(s.text.slice(o,l));for(;o>0;){let c=Wt(s.text,o,!1);if(i(s.text.slice(c,o))!=a)break;o=c}for(;l<s.length;){let c=Wt(s.text,l);if(i(s.text.slice(l,c))!=a)break;l=c}return M.range(o+s.from,l+s.from)}function zu(n,t){return t.left>n?t.left-n:Math.max(0,n-t.right)}function $u(n,t){return t.top>n?t.top-n:Math.max(0,n-t.bottom)}function vs(n,t){return n.top<t.bottom-1&&n.bottom>t.top+1}function gr(n,t){return t<n.top?{top:t,left:n.left,right:n.right,bottom:n.bottom}:n}function mr(n,t){return t>n.bottom?{top:n.top,left:n.left,right:n.right,bottom:t}:n}function on(n,t,e){let i,s,r,o,l=!1,a,c,h,u;for(let g=n.firstChild;g;g=g.nextSibling){let p=je(g);for(let m=0;m<p.length;m++){let x=p[m];s&&vs(s,x)&&(x=gr(mr(x,s.bottom),s.top));let y=zu(t,x),S=$u(e,x);if(y==0&&S==0)return g.nodeType==3?pr(g,t,e):on(g,t,e);if(!i||o>S||o==S&&r>y){i=g,s=x,r=y,o=S;let w=S?e<x.top?-1:1:y?t<x.left?-1:1:0;l=!w||(w>0?m<p.length-1:m>0)}y==0?e>x.bottom&&(!h||h.bottom<x.bottom)?(a=g,h=x):e<x.top&&(!u||u.top>x.top)&&(c=g,u=x):h&&vs(h,x)?h=mr(h,x.bottom):u&&vs(u,x)&&(u=gr(u,x.top))}}if(h&&h.bottom>=e?(i=a,s=h):u&&u.top<=e&&(i=c,s=u),!i)return{node:n,offset:0};let f=Math.max(s.left,Math.min(s.right,t));if(i.nodeType==3)return pr(i,f,e);if(l&&i.contentEditable!="false")return on(i,f,e);let d=Array.prototype.indexOf.call(n.childNodes,i)+(t>=(s.left+s.right)/2?1:0);return{node:n,offset:d}}function pr(n,t,e){let i=n.nodeValue.length,s=-1,r=1e9,o=0;for(let l=0;l<i;l++){let a=xe(n,l,l+1).getClientRects();for(let c=0;c<a.length;c++){let h=a[c];if(h.top==h.bottom)continue;o||(o=t-h.left);let u=(h.top>e?h.top-e:e-h.bottom)-1;if(h.left-1<=t&&h.right+1>=t&&u<r){let f=t>=(h.left+h.right)/2,d=f;if((C.chrome||C.gecko)&&xe(n,l).getBoundingClientRect().left==h.right&&(d=!f),u<=0)return{node:n,offset:l+(d?1:0)};s=l+(d?1:0),r=u}}}return{node:n,offset:s>-1?s:o>0?n.nodeValue.length:0}}function wl(n,t,e,i=-1){var s,r;let o=n.contentDOM.getBoundingClientRect(),l=o.top+n.viewState.paddingTop,a,{docHeight:c}=n.viewState,{x:h,y:u}=t,f=u-l;if(f<0)return 0;if(f>c)return n.state.doc.length;for(let w=n.viewState.heightOracle.textHeight/2,k=!1;a=n.elementAtHeight(f),a.type!=dt.Text;)for(;f=i>0?a.bottom+w:a.top-w,!(f>=0&&f<=c);){if(k)return e?null:0;k=!0,i=-i}u=l+f;let d=a.from;if(d<n.viewport.from)return n.viewport.from==0?0:e?null:br(n,o,a,h,u);if(d>n.viewport.to)return n.viewport.to==n.state.doc.length?n.state.doc.length:e?null:br(n,o,a,h,u);let g=n.dom.ownerDocument,p=n.root.elementFromPoint?n.root:g,m=p.elementFromPoint(h,u);m&&!n.contentDOM.contains(m)&&(m=null),m||(h=Math.max(o.left+1,Math.min(o.right-1,h)),m=p.elementFromPoint(h,u),m&&!n.contentDOM.contains(m)&&(m=null));let x,y=-1;if(m&&((s=n.docView.nearest(m))===null||s===void 0?void 0:s.isEditable)!=!1){if(g.caretPositionFromPoint){let w=g.caretPositionFromPoint(h,u);w&&({offsetNode:x,offset:y}=w)}else if(g.caretRangeFromPoint){let w=g.caretRangeFromPoint(h,u);w&&({startContainer:x,startOffset:y}=w,(!n.contentDOM.contains(x)||C.safari&&Ku(x,y,h)||C.chrome&&Uu(x,y,h))&&(x=void 0))}}if(!x||!n.docView.dom.contains(x)){let w=Q.find(n.docView,d);if(!w)return f>a.top+a.height/2?a.to:a.from;({node:x,offset:y}=on(w.dom,h,u))}let S=n.docView.nearest(x);if(!S)return null;if(S.isWidget&&((r=S.dom)===null||r===void 0?void 0:r.nodeType)==1){let w=S.dom.getBoundingClientRect();return t.y<w.top||t.y<=w.bottom&&t.x<=(w.left+w.right)/2?S.posAtStart:S.posAtEnd}else return S.localPosFromDOM(x,y)+S.posAtStart}function br(n,t,e,i,s){let r=Math.round((i-t.left)*n.defaultCharacterWidth);if(n.lineWrapping&&e.height>n.defaultLineHeight*1.5){let l=n.viewState.heightOracle.textHeight,a=Math.floor((s-e.top-(n.defaultLineHeight-l)*.5)/l);r+=a*n.viewState.heightOracle.lineLength}let o=n.state.sliceDoc(e.from,e.to);return e.from+fu(o,r,n.state.tabSize)}function Ku(n,t,e){let i;if(n.nodeType!=3||t!=(i=n.nodeValue.length))return!1;for(let s=n.nextSibling;s;s=s.nextSibling)if(s.nodeType!=1||s.nodeName!="BR")return!1;return xe(n,i-1,i).getBoundingClientRect().left>e}function Uu(n,t,e){if(t!=0)return!1;for(let s=n;;){let r=s.parentNode;if(!r||r.nodeType!=1||r.firstChild!=s)return!1;if(r.classList.contains("cm-line"))break;s=r}let i=n.nodeType==1?n.getBoundingClientRect():xe(n,0,Math.max(n.nodeValue.length,1)).getBoundingClientRect();return e-i.left>5}function ln(n,t){let e=n.lineBlockAt(t);if(Array.isArray(e.type)){for(let i of e.type)if(i.to>t||i.to==t&&(i.to==e.to||i.type==dt.Text))return i}return e}function Gu(n,t,e,i){let s=ln(n,t.head),r=!i||s.type!=dt.Text||!(n.lineWrapping||s.widgetLineBreaks)?null:n.coordsAtPos(t.assoc<0&&t.head>s.from?t.head-1:t.head);if(r){let o=n.dom.getBoundingClientRect(),l=n.textDirectionAt(s.from),a=n.posAtCoords({x:e==(l==Z.LTR)?o.right-1:o.left+1,y:(r.top+r.bottom)/2});if(a!=null)return M.cursor(a,e?-1:1)}return M.cursor(e?s.to:s.from,e?-1:1)}function xr(n,t,e,i){let s=n.state.doc.lineAt(t.head),r=n.bidiSpans(s),o=n.textDirectionAt(s.from);for(let l=t,a=null;;){let c=Nu(s,r,o,l,e),h=sl;if(!c){if(s.number==(e?n.state.doc.lines:1))return l;h=`
`,s=n.state.doc.line(s.number+(e?1:-1)),r=n.bidiSpans(s),c=n.visualLineSide(s,!e)}if(a){if(!a(h))return l}else{if(!i)return c;a=i(h)}l=c}}function Yu(n,t,e){let i=n.state.charCategorizer(t),s=i(e);return r=>{let o=i(r);return s==zt.Space&&(s=o),s==o}}function Xu(n,t,e,i){let s=t.head,r=e?1:-1;if(s==(e?n.state.doc.length:0))return M.cursor(s,t.assoc);let o=t.goalColumn,l,a=n.contentDOM.getBoundingClientRect(),c=n.coordsAtPos(s,t.assoc||-1),h=n.documentTop;if(c)o==null&&(o=c.left-a.left),l=r<0?c.top:c.bottom;else{let d=n.viewState.lineBlockAt(s);o==null&&(o=Math.min(a.right-a.left,n.defaultCharacterWidth*(s-d.from))),l=(r<0?d.top:d.bottom)+h}let u=a.left+o,f=i??n.viewState.heightOracle.textHeight>>1;for(let d=0;;d+=10){let g=l+(f+d)*r,p=wl(n,{x:u,y:g},!1,r);if(g<a.top||g>a.bottom||(r<0?p<s:p>s)){let m=n.docView.coordsForChar(p),x=!m||g<m.top?-1:1;return M.cursor(p,x,void 0,o)}}}function qi(n,t,e){for(;;){let i=0;for(let s of n)s.between(t-1,t+1,(r,o,l)=>{if(t>r&&t<o){let a=i||e||(t-r<o-t?-1:1);t=a<0?r:o,i=a}});if(!i)return t}}function Ss(n,t,e){let i=qi(n.state.facet(On).map(s=>s(n)),e.from,t.head>e.from?-1:1);return i==e.from?e:M.cursor(i,i<e.from?1:-1)}class Ju{setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}constructor(t){this.view=t,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=t.hasFocus,C.safari&&t.contentDOM.addEventListener("input",()=>null),C.gecko&&gf(t.contentDOM.ownerDocument)}handleEvent(t){!of(this.view,t)||this.ignoreDuringComposition(t)||t.type=="keydown"&&this.keydown(t)||this.runHandlers(t.type,t)}runHandlers(t,e){let i=this.handlers[t];if(i){for(let s of i.observers)s(this.view,e);for(let s of i.handlers){if(e.defaultPrevented)break;if(s(this.view,e)){e.preventDefault();break}}}}ensureHandlers(t){let e=Qu(t),i=this.handlers,s=this.view.contentDOM;for(let r in e)if(r!="scroll"){let o=!e[r].handlers.length,l=i[r];l&&o!=!l.handlers.length&&(s.removeEventListener(r,this.handleEvent),l=null),l||s.addEventListener(r,this.handleEvent,{passive:o})}for(let r in i)r!="scroll"&&!e[r]&&s.removeEventListener(r,this.handleEvent);this.handlers=e}keydown(t){if(this.lastKeyCode=t.keyCode,this.lastKeyTime=Date.now(),t.keyCode==9&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&t.keyCode!=27&&Sl.indexOf(t.keyCode)<0&&(this.tabFocusMode=-1),C.android&&C.chrome&&!t.synthetic&&(t.keyCode==13||t.keyCode==8))return this.view.observer.delayAndroidKey(t.key,t.keyCode),!0;let e;return C.ios&&!t.synthetic&&!t.altKey&&!t.metaKey&&((e=vl.find(i=>i.keyCode==t.keyCode))&&!t.ctrlKey||Zu.indexOf(t.key)>-1&&t.ctrlKey&&!t.shiftKey)?(this.pendingIOSKey=e||t,setTimeout(()=>this.flushIOSKey(),250),!0):(t.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(t){let e=this.pendingIOSKey;return!e||e.key=="Enter"&&t&&t.from<t.to&&/^\S+$/.test(t.insert.toString())?!1:(this.pendingIOSKey=void 0,Ne(this.view.contentDOM,e.key,e.keyCode,e instanceof KeyboardEvent?e:void 0))}ignoreDuringComposition(t){return/^key/.test(t.type)?this.composing>0?!0:C.safari&&!C.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1:!1}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.view.observer.update(t),this.mouseSelection&&this.mouseSelection.update(t),this.draggedContent&&t.docChanged&&(this.draggedContent=this.draggedContent.map(t.changes)),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function yr(n,t){return(e,i)=>{try{return t.call(n,i,e)}catch(s){$t(e.state,s)}}}function Qu(n){let t=Object.create(null);function e(i){return t[i]||(t[i]={observers:[],handlers:[]})}for(let i of n){let s=i.spec;if(s&&s.domEventHandlers)for(let r in s.domEventHandlers){let o=s.domEventHandlers[r];o&&e(r).handlers.push(yr(i.value,o))}if(s&&s.domEventObservers)for(let r in s.domEventObservers){let o=s.domEventObservers[r];o&&e(r).observers.push(yr(i.value,o))}}for(let i in Lt)e(i).handlers.push(Lt[i]);for(let i in Tt)e(i).observers.push(Tt[i]);return t}const vl=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Zu="dthko",Sl=[16,17,18,20,91,92,224,225],Ri=6;function Pi(n){return Math.max(0,n)*.7+8}function tf(n,t){return Math.max(Math.abs(n.clientX-t.clientX),Math.abs(n.clientY-t.clientY))}class ef{constructor(t,e,i,s){this.view=t,this.startEvent=e,this.style=i,this.mustSelect=s,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=e,this.scrollParents=bu(t.contentDOM),this.atoms=t.state.facet(On).map(o=>o(t));let r=t.contentDOM.ownerDocument;r.addEventListener("mousemove",this.move=this.move.bind(this)),r.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet(q.allowMultipleSelections)&&sf(t,e),this.dragging=rf(t,e)&&Al(e)==1?null:!1}start(t){this.dragging===!1&&this.select(t)}move(t){if(t.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&tf(this.startEvent,t)<10)return;this.select(this.lastEvent=t);let e=0,i=0,s=0,r=0,o=this.view.win.innerWidth,l=this.view.win.innerHeight;this.scrollParents.x&&({left:s,right:o}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:r,bottom:l}=this.scrollParents.y.getBoundingClientRect());let a=xl(this.view);t.clientX-a.left<=s+Ri?e=-Pi(s-t.clientX):t.clientX+a.right>=o-Ri&&(e=Pi(t.clientX-o)),t.clientY-a.top<=r+Ri?i=-Pi(r-t.clientY):t.clientY+a.bottom>=l-Ri&&(i=Pi(t.clientY-l)),this.setScrollSpeed(e,i)}up(t){this.dragging==null&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(t,e){this.scrollSpeed={x:t,y:e},t||e?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:t,y:e}=this.scrollSpeed;t&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=t,t=0),e&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=e,e=0),(t||e)&&this.view.win.scrollBy(t,e),this.dragging===!1&&this.select(this.lastEvent)}skipAtoms(t){let e=null;for(let i=0;i<t.ranges.length;i++){let s=t.ranges[i],r=null;if(s.empty){let o=qi(this.atoms,s.from,0);o!=s.from&&(r=M.cursor(o,-1))}else{let o=qi(this.atoms,s.from,-1),l=qi(this.atoms,s.to,1);(o!=s.from||l!=s.to)&&(r=M.range(s.from==s.anchor?o:l,s.from==s.head?o:l))}r&&(e||(e=t.ranges.slice()),e[i]=r)}return e?M.create(e,t.mainIndex):t}select(t){let{view:e}=this,i=this.skipAtoms(this.style.get(t,this.extend,this.multiple));(this.mustSelect||!i.eq(e.state.selection,this.dragging===!1))&&this.view.dispatch({selection:i,userEvent:"select.pointer"}),this.mustSelect=!1}update(t){t.transactions.some(e=>e.isUserEvent("input.type"))?this.destroy():this.style.update(t)&&setTimeout(()=>this.select(this.lastEvent),20)}}function sf(n,t){let e=n.state.facet(nl);return e.length?e[0](t):C.mac?t.metaKey:t.ctrlKey}function nf(n,t){let e=n.state.facet(rl);return e.length?e[0](t):C.mac?!t.altKey:!t.ctrlKey}function rf(n,t){let{main:e}=n.state.selection;if(e.empty)return!1;let i=di(n.root);if(!i||i.rangeCount==0)return!0;let s=i.getRangeAt(0).getClientRects();for(let r=0;r<s.length;r++){let o=s[r];if(o.left<=t.clientX&&o.right>=t.clientX&&o.top<=t.clientY&&o.bottom>=t.clientY)return!0}return!1}function of(n,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let e=t.target,i;e!=n.contentDOM;e=e.parentNode)if(!e||e.nodeType==11||(i=V.get(e))&&i.ignoreEvent(t))return!1;return!0}const Lt=Object.create(null),Tt=Object.create(null),Cl=C.ie&&C.ie_version<15||C.ios&&C.webkit_version<604;function lf(n){let t=n.dom.parentNode;if(!t)return;let e=t.appendChild(document.createElement("textarea"));e.style.cssText="position: fixed; left: -10000px; top: 10px",e.focus(),setTimeout(()=>{n.focus(),e.remove(),kl(n,e.value)},50)}function kl(n,t){let{state:e}=n,i,s=1,r=e.toText(t),o=r.lines==e.selection.ranges.length;if(an!=null&&e.selection.ranges.every(a=>a.empty)&&an==r.toString()){let a=-1;i=e.changeByRange(c=>{let h=e.doc.lineAt(c.from);if(h.from==a)return{range:c};a=h.from;let u=e.toText((o?r.line(s++).text:t)+e.lineBreak);return{changes:{from:h.from,insert:u},range:M.cursor(c.from+u.length)}})}else o?i=e.changeByRange(a=>{let c=r.line(s++);return{changes:{from:a.from,to:a.to,insert:c.text},range:M.cursor(a.from+c.length)}}):i=e.replaceSelection(r);n.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}Tt.scroll=n=>{n.inputState.lastScrollTop=n.scrollDOM.scrollTop,n.inputState.lastScrollLeft=n.scrollDOM.scrollLeft};Lt.keydown=(n,t)=>(n.inputState.setSelectionOrigin("select"),t.keyCode==27&&n.inputState.tabFocusMode!=0&&(n.inputState.tabFocusMode=Date.now()+2e3),!1);Tt.touchstart=(n,t)=>{n.inputState.lastTouchTime=Date.now(),n.inputState.setSelectionOrigin("select.pointer")};Tt.touchmove=n=>{n.inputState.setSelectionOrigin("select.pointer")};Lt.mousedown=(n,t)=>{if(n.observer.flush(),n.inputState.lastTouchTime>Date.now()-2e3)return!1;let e=null;for(let i of n.state.facet(ol))if(e=i(n,t),e)break;if(!e&&t.button==0&&(e=cf(n,t)),e){let i=!n.hasFocus;n.inputState.startMouseSelection(new ef(n,t,e,i)),i&&n.observer.ignore(()=>{Fo(n.contentDOM);let r=n.root.activeElement;r&&!r.contains(n.contentDOM)&&r.blur()});let s=n.inputState.mouseSelection;if(s)return s.start(t),s.dragging===!1}return!1};function wr(n,t,e,i){if(i==1)return M.cursor(t,e);if(i==2)return _u(n.state,t,e);{let s=Q.find(n.docView,t),r=n.state.doc.lineAt(s?s.posAtEnd:t),o=s?s.posAtStart:r.from,l=s?s.posAtEnd:r.to;return l<n.state.doc.length&&l==r.to&&l++,M.range(o,l)}}let Ml=(n,t)=>n>=t.top&&n<=t.bottom,vr=(n,t,e)=>Ml(t,e)&&n>=e.left&&n<=e.right;function af(n,t,e,i){let s=Q.find(n.docView,t);if(!s)return 1;let r=t-s.posAtStart;if(r==0)return 1;if(r==s.length)return-1;let o=s.coordsAt(r,-1);if(o&&vr(e,i,o))return-1;let l=s.coordsAt(r,1);return l&&vr(e,i,l)?1:o&&Ml(i,o)?-1:1}function Sr(n,t){let e=n.posAtCoords({x:t.clientX,y:t.clientY},!1);return{pos:e,bias:af(n,e,t.clientX,t.clientY)}}const hf=C.ie&&C.ie_version<=11;let Cr=null,kr=0,Mr=0;function Al(n){if(!hf)return n.detail;let t=Cr,e=Mr;return Cr=n,Mr=Date.now(),kr=!t||e>Date.now()-400&&Math.abs(t.clientX-n.clientX)<2&&Math.abs(t.clientY-n.clientY)<2?(kr+1)%3:1}function cf(n,t){let e=Sr(n,t),i=Al(t),s=n.state.selection;return{update(r){r.docChanged&&(e.pos=r.changes.mapPos(e.pos),s=s.map(r.changes))},get(r,o,l){let a=Sr(n,r),c,h=wr(n,a.pos,a.bias,i);if(e.pos!=a.pos&&!o){let u=wr(n,e.pos,e.bias,i),f=Math.min(u.from,h.from),d=Math.max(u.to,h.to);h=f<h.from?M.range(f,d):M.range(d,f)}return o?s.replaceRange(s.main.extend(h.from,h.to)):l&&i==1&&s.ranges.length>1&&(c=uf(s,a.pos))?c:l?s.addRange(h):M.create([h])}}}function uf(n,t){for(let e=0;e<n.ranges.length;e++){let{from:i,to:s}=n.ranges[e];if(i<=t&&s>=t)return M.create(n.ranges.slice(0,e).concat(n.ranges.slice(e+1)),n.mainIndex==e?0:n.mainIndex-(n.mainIndex>e?1:0))}return null}Lt.dragstart=(n,t)=>{let{selection:{main:e}}=n.state;if(t.target.draggable){let s=n.docView.nearest(t.target);if(s&&s.isWidget){let r=s.posAtStart,o=r+s.length;(r>=e.to||o<=e.from)&&(e=M.range(r,o))}}let{inputState:i}=n;return i.mouseSelection&&(i.mouseSelection.dragging=!0),i.draggedContent=e,t.dataTransfer&&(t.dataTransfer.setData("Text",n.state.sliceDoc(e.from,e.to)),t.dataTransfer.effectAllowed="copyMove"),!1};Lt.dragend=n=>(n.inputState.draggedContent=null,!1);function Ar(n,t,e,i){if(!e)return;let s=n.posAtCoords({x:t.clientX,y:t.clientY},!1),{draggedContent:r}=n.inputState,o=i&&r&&nf(n,t)?{from:r.from,to:r.to}:null,l={from:s,insert:e},a=n.state.changes(o?[o,l]:l);n.focus(),n.dispatch({changes:a,selection:{anchor:a.mapPos(s,-1),head:a.mapPos(s,1)},userEvent:o?"move.drop":"input.drop"}),n.inputState.draggedContent=null}Lt.drop=(n,t)=>{if(!t.dataTransfer)return!1;if(n.state.readOnly)return!0;let e=t.dataTransfer.files;if(e&&e.length){let i=Array(e.length),s=0,r=()=>{++s==e.length&&Ar(n,t,i.filter(o=>o!=null).join(n.state.lineBreak),!1)};for(let o=0;o<e.length;o++){let l=new FileReader;l.onerror=r,l.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(l.result)||(i[o]=l.result),r()},l.readAsText(e[o])}return!0}else{let i=t.dataTransfer.getData("Text");if(i)return Ar(n,t,i,!0),!0}return!1};Lt.paste=(n,t)=>{if(n.state.readOnly)return!0;n.observer.flush();let e=Cl?null:t.clipboardData;return e?(kl(n,e.getData("text/plain")||e.getData("text/uri-list")),!0):(lf(n),!1)};function ff(n,t){let e=n.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.value=t,i.focus(),i.selectionEnd=t.length,i.selectionStart=0,setTimeout(()=>{i.remove(),n.focus()},50)}function df(n){let t=[],e=[],i=!1;for(let s of n.selection.ranges)s.empty||(t.push(n.sliceDoc(s.from,s.to)),e.push(s));if(!t.length){let s=-1;for(let{from:r}of n.selection.ranges){let o=n.doc.lineAt(r);o.number>s&&(t.push(o.text),e.push({from:o.from,to:Math.min(n.doc.length,o.to+1)})),s=o.number}i=!0}return{text:t.join(n.lineBreak),ranges:e,linewise:i}}let an=null;Lt.copy=Lt.cut=(n,t)=>{let{text:e,ranges:i,linewise:s}=df(n.state);if(!e&&!s)return!1;an=s?e:null,t.type=="cut"&&!n.state.readOnly&&n.dispatch({changes:i,scrollIntoView:!0,userEvent:"delete.cut"});let r=Cl?null:t.clipboardData;return r?(r.clearData(),r.setData("text/plain",e),!0):(ff(n,e),!1)};const Tl=_e.define();function El(n,t){let e=[];for(let i of n.facet(hl)){let s=i(n,t);s&&e.push(s)}return e?n.update({effects:e,annotations:Tl.of(!0)}):null}function Ol(n){setTimeout(()=>{let t=n.hasFocus;if(t!=n.inputState.notifiedFocused){let e=El(n.state,t);e?n.dispatch(e):n.update([])}},10)}Tt.focus=n=>{n.inputState.lastFocusTime=Date.now(),!n.scrollDOM.scrollTop&&(n.inputState.lastScrollTop||n.inputState.lastScrollLeft)&&(n.scrollDOM.scrollTop=n.inputState.lastScrollTop,n.scrollDOM.scrollLeft=n.inputState.lastScrollLeft),Ol(n)};Tt.blur=n=>{n.observer.clearSelectionRange(),Ol(n)};Tt.compositionstart=Tt.compositionupdate=n=>{n.observer.editContext||(n.inputState.compositionFirstChange==null&&(n.inputState.compositionFirstChange=!0),n.inputState.composing<0&&(n.inputState.composing=0))};Tt.compositionend=n=>{n.observer.editContext||(n.inputState.composing=-1,n.inputState.compositionEndedAt=Date.now(),n.inputState.compositionPendingKey=!0,n.inputState.compositionPendingChange=n.observer.pendingRecords().length>0,n.inputState.compositionFirstChange=null,C.chrome&&C.android?n.observer.flushSoon():n.inputState.compositionPendingChange?Promise.resolve().then(()=>n.observer.flush()):setTimeout(()=>{n.inputState.composing<0&&n.docView.hasComposition&&n.update([])},50))};Tt.contextmenu=n=>{n.inputState.lastContextMenu=Date.now()};Lt.beforeinput=(n,t)=>{var e;let i;if(C.chrome&&C.android&&(i=vl.find(s=>s.inputType==t.inputType))&&(n.observer.delayAndroidKey(i.key,i.keyCode),i.key=="Backspace"||i.key=="Delete")){let s=((e=window.visualViewport)===null||e===void 0?void 0:e.height)||0;setTimeout(()=>{var r;(((r=window.visualViewport)===null||r===void 0?void 0:r.height)||0)>s+10&&n.hasFocus&&(n.contentDOM.blur(),n.focus())},100)}return C.ios&&t.inputType=="deleteContentForward"&&n.observer.flushSoon(),C.safari&&t.inputType=="insertText"&&n.inputState.composing>=0&&setTimeout(()=>Tt.compositionend(n,t),20),!1};const Tr=new Set;function gf(n){Tr.has(n)||(Tr.add(n),n.addEventListener("copy",()=>{}),n.addEventListener("cut",()=>{}))}const Er=["pre-wrap","normal","pre-line","break-spaces"];class mf{constructor(t){this.lineWrapping=t,this.doc=L.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.max(0,Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength))),this.lineHeight*i}heightForLine(t){return this.lineWrapping?(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForWrapping(t){return Er.indexOf(t)>-1!=this.lineWrapping}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let s=t[i];s<0?i++:this.heightSamples[Math.floor(s*10)]||(e=!0,this.heightSamples[Math.floor(s*10)]=!0)}return e}refresh(t,e,i,s,r,o){let l=Er.indexOf(t)>-1,a=Math.round(e)!=Math.round(this.lineHeight)||this.lineWrapping!=l;if(this.lineWrapping=l,this.lineHeight=e,this.charWidth=i,this.textHeight=s,this.lineLength=r,a){this.heightSamples={};for(let c=0;c<o.length;c++){let h=o[c];h<0?c++:this.heightSamples[Math.floor(h*10)]=!0}}return a}}class pf{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class Ft{constructor(t,e,i,s,r){this.from=t,this.length=e,this.top=i,this.height=s,this._content=r}get type(){return typeof this._content=="number"?dt.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof re?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(t){let e=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(t._content)?t._content:[t]);return new Ft(this.from,this.length+t.length,this.top,this.height+t.height,e)}}var W=function(n){return n[n.ByPos=0]="ByPos",n[n.ByHeight=1]="ByHeight",n[n.ByPosNoHeight=2]="ByPosNoHeight",n}(W||(W={}));const _i=.001;class gt{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(this.flags&2)>0}set outdated(t){this.flags=(t?2:0)|this.flags&-3}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>_i&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return gt.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,s){let r=this,o=i.doc;for(let l=s.length-1;l>=0;l--){let{fromA:a,toA:c,fromB:h,toB:u}=s[l],f=r.lineAt(a,W.ByPosNoHeight,i.setDoc(e),0,0),d=f.to>=c?f:r.lineAt(c,W.ByPosNoHeight,i,0,0);for(u+=d.to-c,c=d.to;l>0&&f.from<=s[l-1].toA;)a=s[l-1].fromA,h=s[l-1].fromB,l--,a<f.from&&(f=r.lineAt(a,W.ByPosNoHeight,i,0,0));h+=f.from-a,a=f.from;let g=Dn.build(i.setDoc(o),t,h,u);r=r.replace(a,c,g)}return r.updateHeight(i,0)}static empty(){return new vt(0,0)}static of(t){if(t.length==1)return t[0];let e=0,i=t.length,s=0,r=0;for(;;)if(e==i)if(s>r*2){let l=t[e-1];l.break?t.splice(--e,1,l.left,null,l.right):t.splice(--e,1,l.left,l.right),i+=1+l.break,s-=l.size}else if(r>s*2){let l=t[i];l.break?t.splice(i,1,l.left,null,l.right):t.splice(i,1,l.left,l.right),i+=2+l.break,r-=l.size}else break;else if(s<r){let l=t[e++];l&&(s+=l.size)}else{let l=t[--i];l&&(r+=l.size)}let o=0;return t[e-1]==null?(o=1,e--):t[e]==null&&(o=1,i++),new bf(gt.of(t.slice(0,e)),o,gt.of(t.slice(i)))}}gt.prototype.size=1;class Dl extends gt{constructor(t,e,i){super(t,e),this.deco=i}blockAt(t,e,i,s){return new Ft(s,this.length,i,this.height,this.deco||0)}lineAt(t,e,i,s,r){return this.blockAt(0,i,s,r)}forEachLine(t,e,i,s,r,o){t<=r+this.length&&e>=r&&o(this.blockAt(0,i,s,r))}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more&&this.setHeight(t,s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class vt extends Dl{constructor(t,e){super(t,e,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(t,e,i,s){return new Ft(s,this.length,i,this.height,this.breaks)}replace(t,e,i){let s=i[0];return i.length==1&&(s instanceof vt||s instanceof rt&&s.flags&4)&&Math.abs(this.length-s.length)<10?(s instanceof rt?s=new vt(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):gt.of(i)}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more?this.setHeight(t,s.heights[s.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))+this.breaks*t.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class rt extends gt{constructor(t){super(t,0)}heightMetrics(t,e){let i=t.doc.lineAt(e).number,s=t.doc.lineAt(e+this.length).number,r=s-i+1,o,l=0;if(t.lineWrapping){let a=Math.min(this.height,t.lineHeight*r);o=a/r,this.length>r+1&&(l=(this.height-a)/(this.length-r-1))}else o=this.height/r;return{firstLine:i,lastLine:s,perLine:o,perChar:l}}blockAt(t,e,i,s){let{firstLine:r,lastLine:o,perLine:l,perChar:a}=this.heightMetrics(e,s);if(e.lineWrapping){let c=s+(t<e.lineHeight?0:Math.round(Math.max(0,Math.min(1,(t-i)/this.height))*this.length)),h=e.doc.lineAt(c),u=l+h.length*a,f=Math.max(i,t-u/2);return new Ft(h.from,h.length,f,u,0)}else{let c=Math.max(0,Math.min(o-r,Math.floor((t-i)/l))),{from:h,length:u}=e.doc.line(r+c);return new Ft(h,u,i+l*c,l,0)}}lineAt(t,e,i,s,r){if(e==W.ByHeight)return this.blockAt(t,i,s,r);if(e==W.ByPosNoHeight){let{from:d,to:g}=i.doc.lineAt(t);return new Ft(d,g-d,0,0,0)}let{firstLine:o,perLine:l,perChar:a}=this.heightMetrics(i,r),c=i.doc.lineAt(t),h=l+c.length*a,u=c.number-o,f=s+l*u+a*(c.from-r-u);return new Ft(c.from,c.length,Math.max(s,Math.min(f,s+this.height-h)),h,0)}forEachLine(t,e,i,s,r,o){t=Math.max(t,r),e=Math.min(e,r+this.length);let{firstLine:l,perLine:a,perChar:c}=this.heightMetrics(i,r);for(let h=t,u=s;h<=e;){let f=i.doc.lineAt(h);if(h==t){let g=f.number-l;u+=a*g+c*(t-r-g)}let d=a+c*f.length;o(new Ft(f.from,f.length,u,d,0)),u+=d,h=f.to+1}}replace(t,e,i){let s=this.length-e;if(s>0){let r=i[i.length-1];r instanceof rt?i[i.length-1]=new rt(r.length+s):i.push(null,new rt(s-1))}if(t>0){let r=i[0];r instanceof rt?i[0]=new rt(t+r.length):i.unshift(new rt(t-1),null)}return gt.of(i)}decomposeLeft(t,e){e.push(new rt(t-1),null)}decomposeRight(t,e){e.push(null,new rt(this.length-t-1))}updateHeight(t,e=0,i=!1,s){let r=e+this.length;if(s&&s.from<=e+this.length&&s.more){let o=[],l=Math.max(e,s.from),a=-1;for(s.from>e&&o.push(new rt(s.from-e-1).updateHeight(t,e));l<=r&&s.more;){let h=t.doc.lineAt(l).length;o.length&&o.push(null);let u=s.heights[s.index++];a==-1?a=u:Math.abs(u-a)>=_i&&(a=-2);let f=new vt(h,u);f.outdated=!1,o.push(f),l+=h+1}l<=r&&o.push(null,new rt(r-l).updateHeight(t,l));let c=gt.of(o);return(a<0||Math.abs(c.height-this.height)>=_i||Math.abs(a-this.heightMetrics(t,e).perLine)>=_i)&&(t.heightChanged=!0),c}else(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class bf extends gt{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return this.flags&1}blockAt(t,e,i,s){let r=i+this.left.height;return t<r?this.left.blockAt(t,e,i,s):this.right.blockAt(t,e,r,s+this.left.length+this.break)}lineAt(t,e,i,s,r){let o=s+this.left.height,l=r+this.left.length+this.break,a=e==W.ByHeight?t<o:t<l,c=a?this.left.lineAt(t,e,i,s,r):this.right.lineAt(t,e,i,o,l);if(this.break||(a?c.to<l:c.from>l))return c;let h=e==W.ByPosNoHeight?W.ByPosNoHeight:W.ByPos;return a?c.join(this.right.lineAt(l,h,i,o,l)):this.left.lineAt(l,h,i,s,r).join(c)}forEachLine(t,e,i,s,r,o){let l=s+this.left.height,a=r+this.left.length+this.break;if(this.break)t<a&&this.left.forEachLine(t,e,i,s,r,o),e>=a&&this.right.forEachLine(t,e,i,l,a,o);else{let c=this.lineAt(a,W.ByPos,i,s,r);t<c.from&&this.left.forEachLine(t,c.from-1,i,s,r,o),c.to>=t&&c.from<=e&&o(c),e>c.to&&this.right.forEachLine(c.to+1,e,i,l,a,o)}}replace(t,e,i){let s=this.left.length+this.break;if(e<s)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-s,e-s,i));let r=[];t>0&&this.decomposeLeft(t,r);let o=r.length;for(let l of i)r.push(l);if(t>0&&Or(r,o-1),e<this.length){let l=r.length;this.decomposeRight(e,r),Or(r,l)}return gt.of(r)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,s=i+this.break;if(t>=s)return this.right.decomposeRight(t-s,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<s&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?gt.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,s){let{left:r,right:o}=this,l=e+r.length+this.break,a=null;return s&&s.from<=e+r.length&&s.more?a=r=r.updateHeight(t,e,i,s):r.updateHeight(t,e,i),s&&s.from<=l+o.length&&s.more?a=o=o.updateHeight(t,l,i,s):o.updateHeight(t,l,i),a?this.balanced(r,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function Or(n,t){let e,i;n[t]==null&&(e=n[t-1])instanceof rt&&(i=n[t+1])instanceof rt&&n.splice(t-1,3,new rt(e.length+1+i.length))}const xf=5;class Dn{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let i=Math.min(e,this.lineEnd),s=this.nodes[this.nodes.length-1];s instanceof vt?s.length+=i-this.pos:(i>this.pos||!this.isCovered)&&this.nodes.push(new vt(i-this.pos,-1)),this.writtenTo=i,e>i&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let s=i.widget?i.widget.estimatedHeight:0,r=i.widget?i.widget.lineBreaks:0;s<0&&(s=this.oracle.lineHeight);let o=e-t;i.block?this.addBlock(new Dl(o,s,i)):(o||r||s>=xf)&&this.addLineDeco(s,r,o)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new vt(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new rt(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof vt)return t;let e=new vt(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine();let e=t.deco;e&&e.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,e&&e.endSide>0&&(this.covering=t)}addLineDeco(t,e,i){let s=this.ensureLine();s.length+=i,s.collapsed+=i,s.widgetHeight=Math.max(s.widgetHeight,t),s.breaks+=e,this.writtenTo=this.pos=this.pos+i}finish(t){let e=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(e instanceof vt)&&!this.isCovered?this.nodes.push(new vt(0,-1)):(this.writtenTo<this.pos||e==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let i=t;for(let s of this.nodes)s instanceof vt&&s.updateHeight(this.oracle,i),i+=s?s.length:1;return this.nodes}static build(t,e,i,s){let r=new Dn(i,t);return N.spans(e,i,s,r,0),r.finish(i)}}function yf(n,t,e){let i=new wf;return N.compare(n,t,e,i,0),i.changes}class wf{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,s){(t<e||i&&i.heightRelevant||s&&s.heightRelevant)&&tn(t,e,this.changes,5)}}function vf(n,t){let e=n.getBoundingClientRect(),i=n.ownerDocument,s=i.defaultView||window,r=Math.max(0,e.left),o=Math.min(s.innerWidth,e.right),l=Math.max(0,e.top),a=Math.min(s.innerHeight,e.bottom);for(let c=n.parentNode;c&&c!=i.body;)if(c.nodeType==1){let h=c,u=window.getComputedStyle(h);if((h.scrollHeight>h.clientHeight||h.scrollWidth>h.clientWidth)&&u.overflow!="visible"){let f=h.getBoundingClientRect();r=Math.max(r,f.left),o=Math.min(o,f.right),l=Math.max(l,f.top),a=c==n.parentNode?f.bottom:Math.min(a,f.bottom)}c=u.position=="absolute"||u.position=="fixed"?h.offsetParent:h.parentNode}else if(c.nodeType==11)c=c.host;else break;return{left:r-e.left,right:Math.max(r,o)-e.left,top:l-(e.top+t),bottom:Math.max(l,a)-(e.top+t)}}function Sf(n,t){let e=n.getBoundingClientRect();return{left:0,right:e.right-e.left,top:t,bottom:e.bottom-(e.top+t)}}class Cs{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let s=t[i],r=e[i];if(s.from!=r.from||s.to!=r.to||s.size!=r.size)return!1}return!0}draw(t,e){return I.replace({widget:new Cf(this.size*(e?t.scaleY:t.scaleX),e)}).range(this.from,this.to)}}class Cf extends ze{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class Dr{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=Rr,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=Z.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let e=t.facet(En).some(i=>typeof i!="function"&&i.class=="cm-lineWrapping");this.heightOracle=new mf(e),this.stateDeco=t.facet(gi).filter(i=>typeof i!="function"),this.heightMap=gt.empty().applyChanges(this.stateDeco,L.empty,this.heightOracle.setDoc(t.doc),[new At(0,0,0,t.doc.length)]);for(let i=0;i<2&&(this.viewport=this.getViewport(0,null),!!this.updateForViewport());i++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=I.set(this.lineGaps.map(i=>i.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let s=i?e.head:e.anchor;if(!t.some(({from:r,to:o})=>s>=r&&s<=o)){let{from:r,to:o}=this.lineBlockAt(s);t.push(new Ni(r,o))}}return this.viewports=t.sort((i,s)=>i.from-s.from),this.updateScaler()}updateScaler(){let t=this.scaler;return this.scaler=this.heightMap.height<=7e6?Rr:new Rn(this.heightOracle,this.heightMap,this.viewports),t.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,t=>{this.viewportLines.push(ti(t,this.scaler))})}update(t,e=null){this.state=t.state;let i=this.stateDeco;this.stateDeco=this.state.facet(gi).filter(h=>typeof h!="function");let s=t.changedRanges,r=At.extendWithRanges(s,yf(i,this.stateDeco,t?t.changes:it.empty(this.state.doc.length))),o=this.heightMap.height,l=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);this.heightMap=this.heightMap.applyChanges(this.stateDeco,t.startState.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2),l?(this.scrollAnchorPos=t.changes.mapPos(l.from,-1),this.scrollAnchorHeight=l.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=this.heightMap.height);let a=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<a.from||e.range.head>a.to)||!this.viewportIsAppropriate(a))&&(a=this.getViewport(0,e));let c=a.from!=this.viewport.from||a.to!=this.viewport.to;this.viewport=a,t.flags|=this.updateForViewport(),(c||!t.changes.empty||t.flags&2)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&!t.state.facet(ul)&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),s=this.heightOracle,r=i.whiteSpace;this.defaultTextDirection=i.direction=="rtl"?Z.RTL:Z.LTR;let o=this.heightOracle.mustRefreshForWrapping(r),l=e.getBoundingClientRect(),a=o||this.mustMeasureContent||this.contentDOMHeight!=l.height;this.contentDOMHeight=l.height,this.mustMeasureContent=!1;let c=0,h=0;if(l.width&&l.height){let{scaleX:w,scaleY:k}=Vo(e,l);(w>.005&&Math.abs(this.scaleX-w)>.005||k>.005&&Math.abs(this.scaleY-k)>.005)&&(this.scaleX=w,this.scaleY=k,c|=8,o=a=!0)}let u=(parseInt(i.paddingTop)||0)*this.scaleY,f=(parseInt(i.paddingBottom)||0)*this.scaleY;(this.paddingTop!=u||this.paddingBottom!=f)&&(this.paddingTop=u,this.paddingBottom=f,c|=10),this.editorWidth!=t.scrollDOM.clientWidth&&(s.lineWrapping&&(a=!0),this.editorWidth=t.scrollDOM.clientWidth,c|=8);let d=t.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=d&&(this.scrollAnchorHeight=-1,this.scrollTop=d),this.scrolledToBottom=Wo(t.scrollDOM);let g=(this.printing?Sf:vf)(e,this.paddingTop),p=g.top-this.pixelViewport.top,m=g.bottom-this.pixelViewport.bottom;this.pixelViewport=g;let x=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(x!=this.inView&&(this.inView=x,x&&(a=!0)),!this.inView&&!this.scrollTarget)return 0;let y=l.width;if((this.contentDOMWidth!=y||this.editorHeight!=t.scrollDOM.clientHeight)&&(this.contentDOMWidth=l.width,this.editorHeight=t.scrollDOM.clientHeight,c|=8),a){let w=t.docView.measureVisibleLineHeights(this.viewport);if(s.mustRefreshForHeights(w)&&(o=!0),o||s.lineWrapping&&Math.abs(y-this.contentDOMWidth)>s.charWidth){let{lineHeight:k,charWidth:A,textHeight:P}=t.docView.measureTextSize();o=k>0&&s.refresh(r,k,A,P,y/A,w),o&&(t.docView.minWidth=0,c|=8)}p>0&&m>0?h=Math.max(p,m):p<0&&m<0&&(h=Math.min(p,m)),s.heightChanged=!1;for(let k of this.viewports){let A=k.from==this.viewport.from?w:t.docView.measureVisibleLineHeights(k);this.heightMap=(o?gt.empty().applyChanges(this.stateDeco,L.empty,this.heightOracle,[new At(0,0,0,t.state.doc.length)]):this.heightMap).updateHeight(s,0,o,new pf(k.from,A))}s.heightChanged&&(c|=2)}let S=!this.viewportIsAppropriate(this.viewport,h)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return S&&(c&2&&(c|=this.updateScaler()),this.viewport=this.getViewport(h,this.scrollTarget),c|=this.updateForViewport()),(c&2||S)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps,t)),c|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),c}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),s=this.heightMap,r=this.heightOracle,{visibleTop:o,visibleBottom:l}=this,a=new Ni(s.lineAt(o-i*1e3,W.ByHeight,r,0,0).from,s.lineAt(l+(1-i)*1e3,W.ByHeight,r,0,0).to);if(e){let{head:c}=e.range;if(c<a.from||c>a.to){let h=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),u=s.lineAt(c,W.ByPos,r,0,0),f;e.y=="center"?f=(u.top+u.bottom)/2-h/2:e.y=="start"||e.y=="nearest"&&c<a.from?f=u.top:f=u.bottom-h,a=new Ni(s.lineAt(f-1e3/2,W.ByHeight,r,0,0).from,s.lineAt(f+h+1e3/2,W.ByHeight,r,0,0).to)}}return a}mapViewport(t,e){let i=e.mapPos(t.from,-1),s=e.mapPos(t.to,1);return new Ni(this.heightMap.lineAt(i,W.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(s,W.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(t,W.ByPos,this.heightOracle,0,0),{bottom:r}=this.heightMap.lineAt(e,W.ByPos,this.heightOracle,0,0),{visibleTop:o,visibleBottom:l}=this;return(t==0||s<=o-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||r>=l+Math.max(10,Math.min(i,250)))&&s>o-2*1e3&&r<l+2*1e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let s of t)e.touchesRange(s.from,s.to)||i.push(new Cs(e.mapPos(s.from),e.mapPos(s.to),s.size));return i}ensureLineGaps(t,e){let i=this.heightOracle.lineWrapping,s=i?1e4:2e3,r=s>>1,o=s<<1;if(this.defaultTextDirection!=Z.LTR&&!i)return[];let l=[],a=(h,u,f,d)=>{if(u-h<r)return;let g=this.state.selection.main,p=[g.from];g.empty||p.push(g.to);for(let x of p)if(x>h&&x<u){a(h,x-10,f,d),a(x+10,u,f,d);return}let m=Mf(t,x=>x.from>=f.from&&x.to<=f.to&&Math.abs(x.from-h)<r&&Math.abs(x.to-u)<r&&!p.some(y=>x.from<y&&x.to>y));if(!m){if(u<f.to&&e&&i&&e.visibleRanges.some(x=>x.from<=u&&x.to>=u)){let x=e.moveToLineBoundary(M.cursor(u),!1,!0).head;x>h&&(u=x)}m=new Cs(h,u,this.gapSize(f,h,u,d))}l.push(m)},c=h=>{if(h.length<o||h.type!=dt.Text)return;let u=kf(h.from,h.to,this.stateDeco);if(u.total<o)return;let f=this.scrollTarget?this.scrollTarget.range.head:null,d,g;if(i){let p=s/this.heightOracle.lineLength*this.heightOracle.lineHeight,m,x;if(f!=null){let y=Ii(u,f),S=((this.visibleBottom-this.visibleTop)/2+p)/h.height;m=y-S,x=y+S}else m=(this.visibleTop-h.top-p)/h.height,x=(this.visibleBottom-h.top+p)/h.height;d=Li(u,m),g=Li(u,x)}else{let p=u.total*this.heightOracle.charWidth,m=s*this.heightOracle.charWidth,x,y;if(f!=null){let S=Ii(u,f),w=((this.pixelViewport.right-this.pixelViewport.left)/2+m)/p;x=S-w,y=S+w}else x=(this.pixelViewport.left-m)/p,y=(this.pixelViewport.right+m)/p;d=Li(u,x),g=Li(u,y)}d>h.from&&a(h.from,d,h,u),g<h.to&&a(g,h.to,h,u)};for(let h of this.viewportLines)Array.isArray(h.type)?h.type.forEach(c):c(h);return l}gapSize(t,e,i,s){let r=Ii(s,i)-Ii(s,e);return this.heightOracle.lineWrapping?t.height*r:s.total*this.heightOracle.charWidth*r}updateLineGaps(t){Cs.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=I.set(t.map(e=>e.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];N.spans(t,this.viewport.from,this.viewport.to,{span(s,r){e.push({from:s,to:r})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some((s,r)=>s.from!=e[r].from||s.to!=e[r].to);return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find(e=>e.from<=t&&e.to>=t)||ti(this.heightMap.lineAt(t,W.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(t){return t>=this.viewportLines[0].top&&t<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find(e=>e.top<=t&&e.bottom>=t)||ti(this.heightMap.lineAt(this.scaler.fromDOM(t),W.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(t){let e=this.lineBlockAtHeight(t+8);return e.from>=this.viewport.from||this.viewportLines[0].top-t>200?e:this.viewportLines[0]}elementAtHeight(t){return ti(this.heightMap.blockAt(this.scaler.fromDOM(t),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Ni{constructor(t,e){this.from=t,this.to=e}}function kf(n,t,e){let i=[],s=n,r=0;return N.spans(e,n,t,{span(){},point(o,l){o>s&&(i.push({from:s,to:o}),r+=o-s),s=l}},20),s<t&&(i.push({from:s,to:t}),r+=t-s),{total:r,ranges:i}}function Li({total:n,ranges:t},e){if(e<=0)return t[0].from;if(e>=1)return t[t.length-1].to;let i=Math.floor(n*e);for(let s=0;;s++){let{from:r,to:o}=t[s],l=o-r;if(i<=l)return r+i;i-=l}}function Ii(n,t){let e=0;for(let{from:i,to:s}of n.ranges){if(t<=s){e+=t-i;break}e+=s-i}return e/n.total}function Mf(n,t){for(let e of n)if(t(e))return e}const Rr={toDOM(n){return n},fromDOM(n){return n},scale:1,eq(n){return n==this}};class Rn{constructor(t,e,i){let s=0,r=0,o=0;this.viewports=i.map(({from:l,to:a})=>{let c=e.lineAt(l,W.ByPos,t,0,0).top,h=e.lineAt(a,W.ByPos,t,0,0).bottom;return s+=h-c,{from:l,to:a,top:c,bottom:h,domTop:0,domBottom:0}}),this.scale=(7e6-s)/(e.height-s);for(let l of this.viewports)l.domTop=o+(l.top-r)*this.scale,o=l.domBottom=l.domTop+(l.bottom-l.top),r=l.bottom}toDOM(t){for(let e=0,i=0,s=0;;e++){let r=e<this.viewports.length?this.viewports[e]:null;if(!r||t<r.top)return s+(t-i)*this.scale;if(t<=r.bottom)return r.domTop+(t-r.top);i=r.bottom,s=r.domBottom}}fromDOM(t){for(let e=0,i=0,s=0;;e++){let r=e<this.viewports.length?this.viewports[e]:null;if(!r||t<r.domTop)return i+(t-s)/this.scale;if(t<=r.domBottom)return r.top+(t-r.domTop);i=r.bottom,s=r.domBottom}}eq(t){return t instanceof Rn?this.scale==t.scale&&this.viewports.length==t.viewports.length&&this.viewports.every((e,i)=>e.from==t.viewports[i].from&&e.to==t.viewports[i].to):!1}}function ti(n,t){if(t.scale==1)return n;let e=t.toDOM(n.top),i=t.toDOM(n.bottom);return new Ft(n.from,n.length,e,i-e,Array.isArray(n._content)?n._content.map(s=>ti(s,t)):n._content)}const Bi=T.define({combine:n=>n.join(" ")}),hn=T.define({combine:n=>n.indexOf(!0)>-1}),cn=Fe.newName(),Rl=Fe.newName(),Pl=Fe.newName(),Nl={"&light":"."+Rl,"&dark":"."+Pl};function un(n,t,e){return new Fe(t,{finish(i){return/&/.test(i)?i.replace(/&\w*/,s=>{if(s=="&")return n;if(!e||!e[s])throw new RangeError(`Unsupported selector: ${s}`);return e[s]}):n+" "+i}})}const Af=un("."+cn,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",insetInlineStart:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-highlightSpace:before":{content:"attr(data-display)",position:"absolute",pointerEvents:"none",color:"#888"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},Nl),ei="￿";class Tf{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet(q.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+=ei}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let s=t;;){this.findPointBefore(i,s);let r=this.text.length;this.readNode(s);let o=s.nextSibling;if(o==e)break;let l=V.get(s),a=V.get(o);(l&&a?l.breakAfter:(l?l.breakAfter:Ji(s))||Ji(o)&&(s.nodeName!="BR"||s.cmIgnore)&&this.text.length>r)&&this.lineBreak(),s=o}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let r=-1,o=1,l;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(l=s.exec(e))&&(r=l.index,o=l[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let a of this.points)a.node==t&&a.pos>this.text.length&&(a.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=V.get(t),i=e&&e.overrideDOMText;if(i!=null){this.findPointInside(t,i.length);for(let s=i.iter();!s.next().done;)s.lineBreak?this.lineBreak():this.append(s.value)}else t.nodeType==3?this.readTextNode(t):t.nodeName=="BR"?t.nextSibling&&this.lineBreak():t.nodeType==1&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(t.nodeType==3?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+(Ef(t,i.node,i.offset)?e:0))}}function Ef(n,t,e){for(;;){if(!t||e<Gt(t))return!1;if(t==n)return!0;e=be(t)+1,t=t.parentNode}}class Pr{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class Of{constructor(t,e,i,s){this.typeOver=s,this.bounds=null,this.text="",this.domChanged=e>-1;let{impreciseHead:r,impreciseAnchor:o}=t.docView;if(t.state.readOnly&&e>-1)this.newSel=null;else if(e>-1&&(this.bounds=t.docView.domBoundsAround(e,i,0))){let l=r||o?[]:Pf(t),a=new Tf(l,t.state);a.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=a.text,this.newSel=Nf(l,this.bounds.from)}else{let l=t.observer.selectionRange,a=r&&r.node==l.focusNode&&r.offset==l.focusOffset||!Gs(t.contentDOM,l.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(l.focusNode,l.focusOffset),c=o&&o.node==l.anchorNode&&o.offset==l.anchorOffset||!Gs(t.contentDOM,l.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(l.anchorNode,l.anchorOffset),h=t.viewport;if((C.ios||C.chrome)&&t.state.selection.main.empty&&a!=c&&(h.from>0||h.to<t.state.doc.length)){let u=Math.min(a,c),f=Math.max(a,c),d=h.from-u,g=h.to-f;(d==0||d==1||u==0)&&(g==0||g==-1||f==t.state.doc.length)&&(a=0,c=t.state.doc.length)}this.newSel=M.single(c,a)}}}function Ll(n,t){let e,{newSel:i}=t,s=n.state.selection.main,r=n.inputState.lastKeyTime>Date.now()-100?n.inputState.lastKeyCode:-1;if(t.bounds){let{from:o,to:l}=t.bounds,a=s.from,c=null;(r===8||C.android&&t.text.length<l-o)&&(a=s.to,c="end");let h=Rf(n.state.doc.sliceString(o,l,ei),t.text,a-o,c);h&&(C.chrome&&r==13&&h.toB==h.from+2&&t.text.slice(h.from,h.toB)==ei+ei&&h.toB--,e={from:o+h.from,to:o+h.toA,insert:L.of(t.text.slice(h.from,h.toB).split(ei))})}else i&&(!n.hasFocus&&n.state.facet(Zt)||i.main.eq(s))&&(i=null);if(!e&&!i)return!1;if(!e&&t.typeOver&&!s.empty&&i&&i.main.empty?e={from:s.from,to:s.to,insert:n.state.doc.slice(s.from,s.to)}:e&&e.from>=s.from&&e.to<=s.to&&(e.from!=s.from||e.to!=s.to)&&s.to-s.from-(e.to-e.from)<=4?e={from:s.from,to:s.to,insert:n.state.doc.slice(s.from,e.from).append(e.insert).append(n.state.doc.slice(e.to,s.to))}:(C.mac||C.android)&&e&&e.from==e.to&&e.from==s.head-1&&/^\. ?$/.test(e.insert.toString())&&n.contentDOM.getAttribute("autocorrect")=="off"?(i&&e.insert.length==2&&(i=M.single(i.main.anchor-1,i.main.head-1)),e={from:s.from,to:s.to,insert:L.of([" "])}):C.chrome&&e&&e.from==e.to&&e.from==s.head&&e.insert.toString()==`
 `&&n.lineWrapping&&(i&&(i=M.single(i.main.anchor-1,i.main.head-1)),e={from:s.from,to:s.to,insert:L.of([" "])}),e)return Il(n,e,i,r);if(i&&!i.main.eq(s)){let o=!1,l="select";return n.inputState.lastSelectionTime>Date.now()-50&&(n.inputState.lastSelectionOrigin=="select"&&(o=!0),l=n.inputState.lastSelectionOrigin),n.dispatch({selection:i,scrollIntoView:o,userEvent:l}),!0}else return!1}function Il(n,t,e,i=-1){if(C.ios&&n.inputState.flushIOSKey(t))return!0;let s=n.state.selection.main;if(C.android&&(t.to==s.to&&(t.from==s.from||t.from==s.from-1&&n.state.sliceDoc(t.from,s.from)==" ")&&t.insert.length==1&&t.insert.lines==2&&Ne(n.contentDOM,"Enter",13)||(t.from==s.from-1&&t.to==s.to&&t.insert.length==0||i==8&&t.insert.length<t.to-t.from&&t.to>s.head)&&Ne(n.contentDOM,"Backspace",8)||t.from==s.from&&t.to==s.to+1&&t.insert.length==0&&Ne(n.contentDOM,"Delete",46)))return!0;let r=t.insert.toString();n.inputState.composing>=0&&n.inputState.composing++;let o,l=()=>o||(o=Df(n,t,e));return n.state.facet(al).some(a=>a(n,t.from,t.to,r,l))||n.dispatch(l()),!0}function Df(n,t,e){let i,s=n.state,r=s.selection.main;if(t.from>=r.from&&t.to<=r.to&&t.to-t.from>=(r.to-r.from)/3&&(!e||e.main.empty&&e.main.from==t.from+t.insert.length)&&n.inputState.composing<0){let l=r.from<t.from?s.sliceDoc(r.from,t.from):"",a=r.to>t.to?s.sliceDoc(t.to,r.to):"";i=s.replaceSelection(n.state.toText(l+t.insert.sliceString(0,void 0,n.state.lineBreak)+a))}else{let l=s.changes(t),a=e&&e.main.to<=l.newLength?e.main:void 0;if(s.selection.ranges.length>1&&n.inputState.composing>=0&&t.to<=r.to&&t.to>=r.to-10){let c=n.state.sliceDoc(t.from,t.to),h,u=e&&yl(n,e.main.head);if(u){let g=t.insert.length-(t.to-t.from);h={from:u.from,to:u.to-g}}else h=n.state.doc.lineAt(r.head);let f=r.to-t.to,d=r.to-r.from;i=s.changeByRange(g=>{if(g.from==r.from&&g.to==r.to)return{changes:l,range:a||g.map(l)};let p=g.to-f,m=p-c.length;if(g.to-g.from!=d||n.state.sliceDoc(m,p)!=c||g.to>=h.from&&g.from<=h.to)return{range:g};let x=s.changes({from:m,to:p,insert:t.insert}),y=g.to-r.to;return{changes:x,range:a?M.range(Math.max(0,a.anchor+y),Math.max(0,a.head+y)):g.map(x)}})}else i={changes:l,selection:a&&s.selection.replaceRange(a)}}let o="input.type";return(n.composing||n.inputState.compositionPendingChange&&n.inputState.compositionEndedAt>Date.now()-50)&&(n.inputState.compositionPendingChange=!1,o+=".compose",n.inputState.compositionFirstChange&&(o+=".start",n.inputState.compositionFirstChange=!1)),s.update(i,{userEvent:o,scrollIntoView:!0})}function Rf(n,t,e,i){let s=Math.min(n.length,t.length),r=0;for(;r<s&&n.charCodeAt(r)==t.charCodeAt(r);)r++;if(r==s&&n.length==t.length)return null;let o=n.length,l=t.length;for(;o>0&&l>0&&n.charCodeAt(o-1)==t.charCodeAt(l-1);)o--,l--;if(i=="end"){let a=Math.max(0,r-Math.min(o,l));e-=o+a-r}if(o<r&&n.length<t.length){let a=e<=r&&e>=o?r-e:0;r-=a,l=r+(l-o),o=r}else if(l<r){let a=e<=r&&e>=l?r-e:0;r-=a,o=r+(o-l),l=r}return{from:r,toA:o,toB:l}}function Pf(n){let t=[];if(n.root.activeElement!=n.contentDOM)return t;let{anchorNode:e,anchorOffset:i,focusNode:s,focusOffset:r}=n.observer.selectionRange;return e&&(t.push(new Pr(e,i)),(s!=e||r!=i)&&t.push(new Pr(s,r))),t}function Nf(n,t){if(n.length==0)return null;let e=n[0].pos,i=n.length==2?n[1].pos:e;return e>-1&&i>-1?M.single(e+t,i+t):null}const Lf={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},ks=C.ie&&C.ie_version<=11;class If{constructor(t){this.view=t,this.active=!1,this.editContext=null,this.selectionRange=new xu,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver(e=>{for(let i of e)this.queue.push(i);(C.ie&&C.ie_version<=11||C.ios&&t.composing)&&e.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),window.EditContext&&t.constructor.EDIT_CONTEXT!==!1&&!(C.chrome&&C.chrome_version<126)&&(this.editContext=new Hf(t),t.state.facet(Zt)&&(t.contentDOM.editContext=this.editContext.editContext)),ks&&(this.onCharData=e=>{this.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var e;((e=this.view.docView)===null||e===void 0?void 0:e.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(t.scrollDOM)),this.addWindowListeners(this.win=t.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(e=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),e.length>0&&e[e.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(e=>{e.length>0&&e[e.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(t){this.view.inputState.runHandlers("scroll",t),this.intersecting&&this.view.measure()}onScroll(t){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(t){t.type=="change"&&!t.matches||(this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500))}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some((e,i)=>e!=t[i]))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){let e=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:i}=this,s=this.selectionRange;if(i.state.facet(Zt)?i.root.activeElement!=this.dom:!Wi(i.dom,s))return;let r=s.anchorNode&&i.docView.nearest(s.anchorNode);if(r&&r.ignoreEvent(t)){e||(this.selectionChanged=!1);return}(C.ie&&C.ie_version<=11||C.android&&C.chrome)&&!i.state.selection.main.empty&&s.focusNode&&ri(s.focusNode,s.focusOffset,s.anchorNode,s.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:t}=this,e=di(t.root);if(!e)return!1;let i=C.safari&&t.root.nodeType==11&&gu(this.dom.ownerDocument)==this.dom&&Bf(this.view,e)||e;if(!i||this.selectionRange.eq(i))return!1;let s=Wi(this.dom,i);return s&&!this.selectionChanged&&t.inputState.lastFocusTime>Date.now()-200&&t.inputState.lastTouchTime<Date.now()-300&&wu(this.dom,i)?(this.view.inputState.lastFocusTime=0,t.docView.updateSelection(),!1):(this.selectionRange.setRange(i),s&&(this.selectionChanged=!0),!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(i.nodeType==1)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);for(let i of this.scrollTargets=e)i.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,Lf),ks&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),ks&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){var i;if(!this.delayedAndroidKey){let s=()=>{let r=this.delayedAndroidKey;r&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=r.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&r.force&&Ne(this.dom,r.key,r.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(s)}(!this.delayedAndroidKey||t=="Enter")&&(this.delayedAndroidKey={key:t,keyCode:e,force:this.lastChange<Date.now()-50||!!(!((i=this.delayedAndroidKey)===null||i===void 0)&&i.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let t of this.observer.takeRecords())this.queue.push(t);return this.queue}processRecords(){let t=this.pendingRecords();t.length&&(this.queue=[]);let e=-1,i=-1,s=!1;for(let r of t){let o=this.readMutation(r);o&&(o.typeOver&&(s=!0),e==-1?{from:e,to:i}=o:(e=Math.min(o.from,e),i=Math.max(o.to,i)))}return{from:e,to:i,typeOver:s}}readChange(){let{from:t,to:e,typeOver:i}=this.processRecords(),s=this.selectionChanged&&Wi(this.dom,this.selectionRange);if(t<0&&!s)return null;t>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let r=new Of(this.view,t,e,i);return this.view.docView.domChanged={newSel:r.newSel?r.newSel.main:null},r}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;t&&this.readSelectionRange();let e=this.readChange();if(!e)return this.view.requestMeasure(),!1;let i=this.view.state,s=Ll(this.view,e);return this.view.state==i&&(e.domChanged||e.newSel&&!e.newSel.main.eq(this.view.state.selection.main))&&this.view.update([]),s}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty(t.type=="attributes"),t.type=="attributes"&&(e.flags|=4),t.type=="childList"){let i=Nr(e,t.previousSibling||t.target.previousSibling,-1),s=Nr(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:s?e.posBefore(s):e.posAtEnd,typeOver:!1}}else return t.type=="characterData"?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}setWindow(t){t!=this.win&&(this.removeWindowListeners(this.win),this.win=t,this.addWindowListeners(this.win))}addWindowListeners(t){t.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener("change",this.onPrint):t.addEventListener("beforeprint",this.onPrint),t.addEventListener("scroll",this.onScroll),t.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(t){t.removeEventListener("scroll",this.onScroll),t.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener("change",this.onPrint):t.removeEventListener("beforeprint",this.onPrint),t.document.removeEventListener("selectionchange",this.onSelectionChange)}update(t){this.editContext&&(this.editContext.update(t),t.startState.facet(Zt)!=t.state.facet(Zt)&&(t.view.contentDOM.editContext=t.state.facet(Zt)?this.editContext.editContext:null))}destroy(){var t,e,i;this.stop(),(t=this.intersection)===null||t===void 0||t.disconnect(),(e=this.gapIntersection)===null||e===void 0||e.disconnect(),(i=this.resizeScroll)===null||i===void 0||i.disconnect();for(let s of this.scrollTargets)s.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function Nr(n,t,e){for(;t;){let i=V.get(t);if(i&&i.parent==n)return i;let s=t.parentNode;t=s!=n.dom?s:e>0?t.nextSibling:t.previousSibling}return null}function Lr(n,t){let e=t.startContainer,i=t.startOffset,s=t.endContainer,r=t.endOffset,o=n.docView.domAtPos(n.state.selection.main.anchor);return ri(o.node,o.offset,s,r)&&([e,i,s,r]=[s,r,e,i]),{anchorNode:e,anchorOffset:i,focusNode:s,focusOffset:r}}function Bf(n,t){if(t.getComposedRanges){let s=t.getComposedRanges(n.root)[0];if(s)return Lr(n,s)}let e=null;function i(s){s.preventDefault(),s.stopImmediatePropagation(),e=s.getTargetRanges()[0]}return n.contentDOM.addEventListener("beforeinput",i,!0),n.dom.ownerDocument.execCommand("indent"),n.contentDOM.removeEventListener("beforeinput",i,!0),e?Lr(n,e):null}class Hf{constructor(t){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.resetRange(t.state);let e=this.editContext=new window.EditContext({text:t.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,t.state.selection.main.anchor))),selectionEnd:this.toContextPos(t.state.selection.main.head)});this.handlers.textupdate=i=>{let{anchor:s}=t.state.selection.main,r={from:this.toEditorPos(i.updateRangeStart),to:this.toEditorPos(i.updateRangeEnd),insert:L.of(i.text.split(`
`))};r.from==this.from&&s<this.from?r.from=s:r.to==this.to&&s>this.to&&(r.to=s),!(r.from==r.to&&!r.insert.length)&&(this.pendingContextChange=r,Il(t,r,M.single(this.toEditorPos(i.selectionStart),this.toEditorPos(i.selectionEnd))),this.pendingContextChange&&(this.revertPending(t.state),this.setSelection(t.state)))},this.handlers.characterboundsupdate=i=>{let s=[],r=null;for(let o=this.toEditorPos(i.rangeStart),l=this.toEditorPos(i.rangeEnd);o<l;o++){let a=t.coordsForChar(o);r=a&&new DOMRect(a.left,a.top,a.right-a.left,a.bottom-a.top)||r||new DOMRect,s.push(r)}e.updateCharacterBounds(i.rangeStart,s)},this.handlers.textformatupdate=i=>{let s=[];for(let r of i.getTextFormats()){let o=r.underlineStyle,l=r.underlineThickness;if(o!="None"&&l!="None"){let a=`text-decoration: underline ${o=="Dashed"?"dashed ":o=="Squiggle"?"wavy ":""}${l=="Thin"?1:2}px`;s.push(I.mark({attributes:{style:a}}).range(this.toEditorPos(r.rangeStart),this.toEditorPos(r.rangeEnd)))}}t.dispatch({effects:dl.of(I.set(s))})},this.handlers.compositionstart=()=>{t.inputState.composing<0&&(t.inputState.composing=0,t.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{t.inputState.composing=-1,t.inputState.compositionFirstChange=null};for(let i in this.handlers)e.addEventListener(i,this.handlers[i]);this.measureReq={read:i=>{this.editContext.updateControlBounds(i.contentDOM.getBoundingClientRect());let s=di(i.root);s&&s.rangeCount&&this.editContext.updateSelectionBounds(s.getRangeAt(0).getBoundingClientRect())}}}applyEdits(t){let e=0,i=!1,s=this.pendingContextChange;return t.changes.iterChanges((r,o,l,a,c)=>{if(i)return;let h=c.length-(o-r);if(s&&o>=s.to)if(s.from==r&&s.to==o&&s.insert.eq(c)){s=this.pendingContextChange=null,e+=h,this.to+=h;return}else s=null,this.revertPending(t.state);if(r+=e,o+=e,o<=this.from)this.from+=h,this.to+=h;else if(r<this.to){if(r<this.from||o>this.to||this.to-this.from+c.length>3e4){i=!0;return}this.editContext.updateText(this.toContextPos(r),this.toContextPos(o),c.toString()),this.to+=h}e+=h}),s&&!i&&this.revertPending(t.state),!i}update(t){let e=this.pendingContextChange;!this.applyEdits(t)||!this.rangeIsValid(t.state)?(this.pendingContextChange=null,this.resetRange(t.state),this.editContext.updateText(0,this.editContext.text.length,t.state.doc.sliceString(this.from,this.to)),this.setSelection(t.state)):(t.docChanged||t.selectionSet||e)&&this.setSelection(t.state),(t.geometryChanged||t.docChanged||t.selectionSet)&&t.view.requestMeasure(this.measureReq)}resetRange(t){let{head:e}=t.selection.main;this.from=Math.max(0,e-1e4),this.to=Math.min(t.doc.length,e+1e4)}revertPending(t){let e=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(e.from),this.toContextPos(e.from+e.insert.length),t.doc.sliceString(e.from,e.to))}setSelection(t){let{main:e}=t.selection,i=this.toContextPos(Math.max(this.from,Math.min(this.to,e.anchor))),s=this.toContextPos(e.head);(this.editContext.selectionStart!=i||this.editContext.selectionEnd!=s)&&this.editContext.updateSelection(i,s)}rangeIsValid(t){let{head:e}=t.selection.main;return!(this.from>0&&e-this.from<500||this.to<t.doc.length&&this.to-e<500||this.to-this.from>1e4*3)}toEditorPos(t){return t+this.from}toContextPos(t){return t-this.from}destroy(){for(let t in this.handlers)this.editContext.removeEventListener(t,this.handlers[t])}}class R{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),t.parent&&t.parent.appendChild(this.dom);let{dispatch:e}=t;this.dispatchTransactions=t.dispatchTransactions||e&&(i=>i.forEach(s=>e(s,this)))||(i=>this.update(i)),this.dispatch=this.dispatch.bind(this),this._root=t.root||yu(t.parent)||document,this.viewState=new Dr(t.state||q.create(t)),t.scrollTo&&t.scrollTo.is(Di)&&(this.viewState.scrollTarget=t.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(Qe).map(i=>new ws(i));for(let i of this.plugins)i.update(this);this.observer=new If(this),this.inputState=new Ju(this),this.inputState.ensureHandlers(this.plugins),this.docView=new fr(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure()}dispatch(...t){let e=t.length==1&&t[0]instanceof ct?t:t.length==1&&Array.isArray(t[0])?t[0]:[this.state.update(...t)];this.dispatchTransactions(e,this)}update(t){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e=!1,i=!1,s,r=this.state;for(let f of t){if(f.startState!=r)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");r=f.state}if(this.destroyed){this.viewState.state=r;return}let o=this.hasFocus,l=0,a=null;t.some(f=>f.annotation(Tl))?(this.inputState.notifiedFocused=o,l=1):o!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=o,a=El(r,o),a||(l=1));let c=this.observer.delayedAndroidKey,h=null;if(c?(this.observer.clearDelayedAndroidKey(),h=this.observer.readChange(),(h&&!this.state.doc.eq(r.doc)||!this.state.selection.eq(r.selection))&&(h=null)):this.observer.clear(),r.facet(q.phrases)!=this.state.facet(q.phrases))return this.setState(r);s=Zi.create(this,r,t),s.flags|=l;let u=this.viewState.scrollTarget;try{this.updateState=2;for(let f of t){if(u&&(u=u.map(f.changes)),f.scrollIntoView){let{main:d}=f.state.selection;u=new Le(d.empty?d:M.cursor(d.head,d.head>d.anchor?-1:1))}for(let d of f.effects)d.is(Di)&&(u=d.value.clip(this.state))}this.viewState.update(s,u),this.bidiCache=ts.update(this.bidiCache,s.changes),s.empty||(this.updatePlugins(s),this.inputState.update(s)),e=this.docView.update(s),this.state.facet(Ze)!=this.styleModules&&this.mountStyles(),i=this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(e,t.some(f=>f.isUserEvent("select.pointer")))}finally{this.updateState=0}if(s.startState.facet(Bi)!=s.state.facet(Bi)&&(this.viewState.mustMeasureContent=!0),(e||i||u||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),e&&this.docViewUpdate(),!s.empty)for(let f of this.state.facet(rn))try{f(s)}catch(d){$t(this.state,d,"update listener")}(a||h)&&Promise.resolve().then(()=>{a&&this.state==a.startState&&this.dispatch(a),h&&!Ll(this,h)&&c.force&&Ne(this.contentDOM,c.key,c.keyCode)})}setState(t){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=t;return}this.updateState=2;let e=this.hasFocus;try{for(let i of this.plugins)i.destroy(this);this.viewState=new Dr(t),this.plugins=t.facet(Qe).map(i=>new ws(i)),this.pluginMap.clear();for(let i of this.plugins)i.update(this);this.docView.destroy(),this.docView=new fr(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(Qe),i=t.state.facet(Qe);if(e!=i){let s=[];for(let r of i){let o=e.indexOf(r);if(o<0)s.push(new ws(r));else{let l=this.plugins[o];l.mustUpdate=t,s.push(l)}}for(let r of this.plugins)r.mustUpdate!=t&&r.destroy(this);this.plugins=s,this.pluginMap.clear()}else for(let s of this.plugins)s.mustUpdate=t;for(let s=0;s<this.plugins.length;s++)this.plugins[s].update(this);e!=i&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let t of this.plugins){let e=t.value;if(e&&e.docViewUpdate)try{e.docViewUpdate(this)}catch(i){$t(this.state,i,"doc view update listener")}}}measure(t=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,t&&this.observer.forceFlush();let e=null,i=this.scrollDOM,s=i.scrollTop*this.scaleY,{scrollAnchorPos:r,scrollAnchorHeight:o}=this.viewState;Math.abs(s-this.viewState.scrollTop)>1&&(o=-1),this.viewState.scrollAnchorHeight=-1;try{for(let l=0;;l++){if(o<0)if(Wo(i))r=-1,o=this.viewState.heightMap.height;else{let d=this.viewState.scrollAnchorAt(s);r=d.from,o=d.top}this.updateState=1;let a=this.viewState.measure(this);if(!a&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(l>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let c=[];a&4||([this.measureRequests,c]=[c,this.measureRequests]);let h=c.map(d=>{try{return d.read(this)}catch(g){return $t(this.state,g),Ir}}),u=Zi.create(this,this.state,[]),f=!1;u.flags|=a,e?e.flags|=a:e=u,this.updateState=2,u.empty||(this.updatePlugins(u),this.inputState.update(u),this.updateAttrs(),f=this.docView.update(u),f&&this.docViewUpdate());for(let d=0;d<c.length;d++)if(h[d]!=Ir)try{let g=c[d];g.write&&g.write(h[d],this)}catch(g){$t(this.state,g)}if(f&&this.docView.updateSelection(!0),!u.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,o=-1;continue}else{let g=(r<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(r).top)-o;if(g>1||g<-1){s=s+g,i.scrollTop=s/this.scaleY,o=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let l of this.state.facet(rn))l(e)}get themeClasses(){return cn+" "+(this.state.facet(hn)?Pl:Rl)+" "+this.state.facet(Bi)}updateAttrs(){let t=Br(this,gl,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(Zt)?"true":"false",class:"cm-content",style:`${C.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),Br(this,En,e);let i=this.observer.ignore(()=>{let s=Zs(this.contentDOM,this.contentAttrs,e),r=Zs(this.dom,this.editorAttrs,t);return s||r});return this.editorAttrs=t,this.contentAttrs=e,i}showAnnouncements(t){let e=!0;for(let i of t)for(let s of i.effects)if(s.is(R.announce)){e&&(this.announceDOM.textContent=""),e=!1;let r=this.announceDOM.appendChild(document.createElement("div"));r.textContent=s.value}}mountStyles(){this.styleModules=this.state.facet(Ze);let t=this.state.facet(R.cspNonce);Fe.mount(this.root,this.styleModules.concat(Af).reverse(),t?{nonce:t}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),t){if(this.measureRequests.indexOf(t)>-1)return;if(t.key!=null){for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key){this.measureRequests[e]=t;return}}this.measureRequests.push(t)}}plugin(t){let e=this.pluginMap.get(t);return(e===void 0||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find(i=>i.spec==t)||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return Ss(this,t,xr(this,t,e,i))}moveByGroup(t,e){return Ss(this,t,xr(this,t,e,i=>Yu(this,t.head,i)))}visualLineSide(t,e){let i=this.bidiSpans(t),s=this.textDirectionAt(t.from),r=i[e?i.length-1:0];return M.cursor(r.side(e,s)+t.from,r.forward(!e,s)?1:-1)}moveToLineBoundary(t,e,i=!0){return Gu(this,t,e,i)}moveVertically(t,e,i){return Ss(this,t,Xu(this,t,e,i))}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),wl(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let s=this.state.doc.lineAt(t),r=this.bidiSpans(s),o=r[ie.find(r,t-s.from,-1,e)];return as(i,o.dir==Z.LTR==e>0)}coordsForChar(t){return this.readMeasured(),this.docView.coordsForChar(t)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(t){return!this.state.facet(cl)||t<this.viewport.from||t>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(t))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>Vf)return il(t.length);let e=this.textDirectionAt(t.from),i;for(let r of this.bidiCache)if(r.from==t.from&&r.dir==e&&(r.fresh||el(r.isolates,i=ur(this,t))))return r.order;i||(i=ur(this,t));let s=Pu(t.text,e,i);return this.bidiCache.push(new ts(t.from,t.to,e,i,!0,s)),s}get hasFocus(){var t;return(this.dom.ownerDocument.hasFocus()||C.safari&&((t=this.inputState)===null||t===void 0?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{Fo(this.contentDOM),this.docView.updateSelection()})}setRoot(t){this._root!=t&&(this._root=t,this.observer.setWindow((t.nodeType==9?t:t.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return Di.of(new Le(typeof t=="number"?M.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}scrollSnapshot(){let{scrollTop:t,scrollLeft:e}=this.scrollDOM,i=this.viewState.scrollAnchorAt(t);return Di.of(new Le(M.cursor(i.from),"start","start",i.top-t,e,!0))}setTabFocusMode(t){t==null?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:typeof t=="boolean"?this.inputState.tabFocusMode=t?0:-1:this.inputState.tabFocusMode!=0&&(this.inputState.tabFocusMode=Date.now()+t)}static domEventHandlers(t){return Nt.define(()=>({}),{eventHandlers:t})}static domEventObservers(t){return Nt.define(()=>({}),{eventObservers:t})}static theme(t,e){let i=Fe.newName(),s=[Bi.of(i),Ze.of(un(`.${i}`,t))];return e&&e.dark&&s.push(hn.of(!0)),s}static baseTheme(t){return Cn.lowest(Ze.of(un("."+cn,t,Nl)))}static findFromDOM(t){var e;let i=t.querySelector(".cm-content"),s=i&&V.get(i)||V.get(t);return((e=s?.rootView)===null||e===void 0?void 0:e.view)||null}}R.styleModule=Ze;R.inputHandler=al;R.scrollHandler=fl;R.focusChangeEffect=hl;R.perLineTextDirection=cl;R.exceptionSink=ll;R.updateListener=rn;R.editable=Zt;R.mouseSelectionStyle=ol;R.dragMovesSelection=rl;R.clickAddsSelectionRange=nl;R.decorations=gi;R.outerDecorations=ml;R.atomicRanges=On;R.bidiIsolatedRanges=pl;R.scrollMargins=bl;R.darkTheme=hn;R.cspNonce=T.define({combine:n=>n.length?n[0]:""});R.contentAttributes=En;R.editorAttributes=gl;R.lineWrapping=R.contentAttributes.of({class:"cm-lineWrapping"});R.announce=K.define();const Vf=4096,Ir={};class ts{constructor(t,e,i,s,r,o){this.from=t,this.to=e,this.dir=i,this.isolates=s,this.fresh=r,this.order=o}static update(t,e){if(e.empty&&!t.some(r=>r.fresh))return t;let i=[],s=t.length?t[t.length-1].dir:Z.LTR;for(let r=Math.max(0,t.length-10);r<t.length;r++){let o=t[r];o.dir==s&&!e.touchesRange(o.from,o.to)&&i.push(new ts(e.mapPos(o.from,1),e.mapPos(o.to,-1),o.dir,o.isolates,!1,o.order))}return i}}function Br(n,t,e){for(let i=n.state.facet(t),s=i.length-1;s>=0;s--){let r=i[s],o=typeof r=="function"?r(n):r;o&&Qs(o,e)}return e}const Ff=C.mac?"mac":C.windows?"win":C.linux?"linux":"key";function jf(n,t){const e=n.split(/-(?!$)/);let i=e[e.length-1];i=="Space"&&(i=" ");let s,r,o,l;for(let a=0;a<e.length-1;++a){const c=e[a];if(/^(cmd|meta|m)$/i.test(c))l=!0;else if(/^a(lt)?$/i.test(c))s=!0;else if(/^(c|ctrl|control)$/i.test(c))r=!0;else if(/^s(hift)?$/i.test(c))o=!0;else if(/^mod$/i.test(c))t=="mac"?l=!0:r=!0;else throw new Error("Unrecognized modifier name: "+c)}return s&&(i="Alt-"+i),r&&(i="Ctrl-"+i),l&&(i="Meta-"+i),o&&(i="Shift-"+i),i}function Hi(n,t,e){return t.altKey&&(n="Alt-"+n),t.ctrlKey&&(n="Ctrl-"+n),t.metaKey&&(n="Meta-"+n),e!==!1&&t.shiftKey&&(n="Shift-"+n),n}const Wf=Cn.default(R.domEventHandlers({keydown(n,t){return Kf(_f(t.state),n,t,"editor")}})),qf=T.define({enables:Wf}),Hr=new WeakMap;function _f(n){let t=n.facet(qf),e=Hr.get(t);return e||Hr.set(t,e=$f(t.reduce((i,s)=>i.concat(s),[]))),e}let te=null;const zf=4e3;function $f(n,t=Ff){let e=Object.create(null),i=Object.create(null),s=(o,l)=>{let a=i[o];if(a==null)i[o]=l;else if(a!=l)throw new Error("Key binding "+o+" is used both as a regular binding and as a multi-stroke prefix")},r=(o,l,a,c,h)=>{var u,f;let d=e[o]||(e[o]=Object.create(null)),g=l.split(/ (?!$)/).map(x=>jf(x,t));for(let x=1;x<g.length;x++){let y=g.slice(0,x).join(" ");s(y,!0),d[y]||(d[y]={preventDefault:!0,stopPropagation:!1,run:[S=>{let w=te={view:S,prefix:y,scope:o};return setTimeout(()=>{te==w&&(te=null)},zf),!0}]})}let p=g.join(" ");s(p,!1);let m=d[p]||(d[p]={preventDefault:!1,stopPropagation:!1,run:((f=(u=d._any)===null||u===void 0?void 0:u.run)===null||f===void 0?void 0:f.slice())||[]});a&&m.run.push(a),c&&(m.preventDefault=!0),h&&(m.stopPropagation=!0)};for(let o of n){let l=o.scope?o.scope.split(" "):["editor"];if(o.any)for(let c of l){let h=e[c]||(e[c]=Object.create(null));h._any||(h._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:u}=o;for(let f in h)h[f].run.push(d=>u(d,fn))}let a=o[t]||o.key;if(a)for(let c of l)r(c,a,o.run,o.preventDefault,o.stopPropagation),o.shift&&r(c,"Shift-"+a,o.shift,o.preventDefault,o.stopPropagation)}return e}let fn=null;function Kf(n,t,e,i){fn=t;let s=Ga(t),r=si(s,0),o=Is(r)==s.length&&s!=" ",l="",a=!1,c=!1,h=!1;te&&te.view==e&&te.scope==i&&(l=te.prefix+" ",Sl.indexOf(t.keyCode)<0&&(c=!0,te=null));let u=new Set,f=m=>{if(m){for(let x of m.run)if(!u.has(x)&&(u.add(x),x(e)))return m.stopPropagation&&(h=!0),!0;m.preventDefault&&(m.stopPropagation&&(h=!0),c=!0)}return!1},d=n[i],g,p;return d&&(f(d[l+Hi(s,t,!o)])?a=!0:o&&(t.altKey||t.metaKey||t.ctrlKey)&&!(C.windows&&t.ctrlKey&&t.altKey)&&(g=Ya[t.keyCode])&&g!=s?(f(d[l+Hi(g,t,!0)])||t.shiftKey&&(p=Xa[t.keyCode])!=s&&p!=g&&f(d[l+Hi(p,t,!1)]))&&(a=!0):o&&t.shiftKey&&f(d[l+Hi(s,t,!0)])&&(a=!0),!a&&f(d._any)&&(a=!0)),c&&(a=!0),a&&h&&t.stopPropagation(),fn=null,a}class Si{constructor(t,e,i,s,r){this.className=t,this.left=e,this.top=i,this.width=s,this.height=r}draw(){let t=document.createElement("div");return t.className=this.className,this.adjust(t),t}update(t,e){return e.className!=this.className?!1:(this.adjust(t),!0)}adjust(t){t.style.left=this.left+"px",t.style.top=this.top+"px",this.width!=null&&(t.style.width=this.width+"px"),t.style.height=this.height+"px"}eq(t){return this.left==t.left&&this.top==t.top&&this.width==t.width&&this.height==t.height&&this.className==t.className}static forRange(t,e,i){if(i.empty){let s=t.coordsAtPos(i.head,i.assoc||1);if(!s)return[];let r=Bl(t);return[new Si(e,s.left-r.left,s.top-r.top,null,s.bottom-s.top)]}else return Uf(t,e,i)}}function Bl(n){let t=n.scrollDOM.getBoundingClientRect();return{left:(n.textDirection==Z.LTR?t.left:t.right-n.scrollDOM.clientWidth*n.scaleX)-n.scrollDOM.scrollLeft*n.scaleX,top:t.top-n.scrollDOM.scrollTop*n.scaleY}}function Vr(n,t,e,i){let s=n.coordsAtPos(t,e*2);if(!s)return i;let r=n.dom.getBoundingClientRect(),o=(s.top+s.bottom)/2,l=n.posAtCoords({x:r.left+1,y:o}),a=n.posAtCoords({x:r.right-1,y:o});return l==null||a==null?i:{from:Math.max(i.from,Math.min(l,a)),to:Math.min(i.to,Math.max(l,a))}}function Uf(n,t,e){if(e.to<=n.viewport.from||e.from>=n.viewport.to)return[];let i=Math.max(e.from,n.viewport.from),s=Math.min(e.to,n.viewport.to),r=n.textDirection==Z.LTR,o=n.contentDOM,l=o.getBoundingClientRect(),a=Bl(n),c=o.querySelector(".cm-line"),h=c&&window.getComputedStyle(c),u=l.left+(h?parseInt(h.paddingLeft)+Math.min(0,parseInt(h.textIndent)):0),f=l.right-(h?parseInt(h.paddingRight):0),d=ln(n,i),g=ln(n,s),p=d.type==dt.Text?d:null,m=g.type==dt.Text?g:null;if(p&&(n.lineWrapping||d.widgetLineBreaks)&&(p=Vr(n,i,1,p)),m&&(n.lineWrapping||g.widgetLineBreaks)&&(m=Vr(n,s,-1,m)),p&&m&&p.from==m.from&&p.to==m.to)return y(S(e.from,e.to,p));{let k=p?S(e.from,null,p):w(d,!1),A=m?S(null,e.to,m):w(g,!0),P=[];return(p||d).to<(m||g).from-(p&&m?1:0)||d.widgetLineBreaks>1&&k.bottom+n.defaultLineHeight/2<A.top?P.push(x(u,k.bottom,f,A.top)):k.bottom<A.top&&n.elementAtHeight((k.bottom+A.top)/2).type==dt.Text&&(k.bottom=A.top=(k.bottom+A.top)/2),y(k).concat(P).concat(y(A))}function x(k,A,P,E){return new Si(t,k-a.left,A-a.top-.01,P-k,E-A+.01)}function y({top:k,bottom:A,horizontal:P}){let E=[];for(let O=0;O<P.length;O+=2)E.push(x(P[O],k,P[O+1],A));return E}function S(k,A,P){let E=1e9,O=-1e9,X=[];function ot(et,_,J,D,qt){let z=n.coordsAtPos(et,et==P.to?-2:2),U=n.coordsAtPos(J,J==P.from?2:-2);!z||!U||(E=Math.min(z.top,U.top,E),O=Math.max(z.bottom,U.bottom,O),qt==Z.LTR?X.push(r&&_?u:z.left,r&&D?f:U.right):X.push(!r&&D?u:U.left,!r&&_?f:z.right))}let lt=k??P.from,xt=A??P.to;for(let et of n.visibleRanges)if(et.to>lt&&et.from<xt)for(let _=Math.max(et.from,lt),J=Math.min(et.to,xt);;){let D=n.state.doc.lineAt(_);for(let qt of n.bidiSpans(D)){let z=qt.from+D.from,U=qt.to+D.from;if(z>=J)break;U>_&&ot(Math.max(z,_),k==null&&z<=lt,Math.min(U,J),A==null&&U>=xt,qt.dir)}if(_=D.to+1,_>=J)break}return X.length==0&&ot(lt,k==null,xt,A==null,n.textDirection),{top:E,bottom:O,horizontal:X}}function w(k,A){let P=l.top+(A?k.top:k.bottom);return{top:P,bottom:P,horizontal:[]}}}function Gf(n,t){return n.constructor==t.constructor&&n.eq(t)}class Yf{constructor(t,e){this.view=t,this.layer=e,this.drawn=[],this.scaleX=1,this.scaleY=1,this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=t.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),e.above&&this.dom.classList.add("cm-layer-above"),e.class&&this.dom.classList.add(e.class),this.scale(),this.dom.setAttribute("aria-hidden","true"),this.setOrder(t.state),t.requestMeasure(this.measureReq),e.mount&&e.mount(this.dom,t)}update(t){t.startState.facet(zi)!=t.state.facet(zi)&&this.setOrder(t.state),(this.layer.update(t,this.dom)||t.geometryChanged)&&(this.scale(),t.view.requestMeasure(this.measureReq))}docViewUpdate(t){this.layer.updateOnDocViewUpdate!==!1&&t.requestMeasure(this.measureReq)}setOrder(t){let e=0,i=t.facet(zi);for(;e<i.length&&i[e]!=this.layer;)e++;this.dom.style.zIndex=String((this.layer.above?150:-1)-e)}measure(){return this.layer.markers(this.view)}scale(){let{scaleX:t,scaleY:e}=this.view;(t!=this.scaleX||e!=this.scaleY)&&(this.scaleX=t,this.scaleY=e,this.dom.style.transform=`scale(${1/t}, ${1/e})`)}draw(t){if(t.length!=this.drawn.length||t.some((e,i)=>!Gf(e,this.drawn[i]))){let e=this.dom.firstChild,i=0;for(let s of t)s.update&&e&&s.constructor&&this.drawn[i].constructor&&s.update(e,this.drawn[i])?(e=e.nextSibling,i++):this.dom.insertBefore(s.draw(),e);for(;e;){let s=e.nextSibling;e.remove(),e=s}this.drawn=t}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const zi=T.define();function Hl(n){return[Nt.define(t=>new Yf(t,n)),zi.of(n)]}const Vl=!C.ios,mi=T.define({combine(n){return kn(n,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(t,e)=>Math.min(t,e),drawRangeCursor:(t,e)=>t||e})}});function xm(n={}){return[mi.of(n),Xf,Jf,Qf,ul.of(!0)]}function Fl(n){return n.startState.facet(mi)!=n.state.facet(mi)}const Xf=Hl({above:!0,markers(n){let{state:t}=n,e=t.facet(mi),i=[];for(let s of t.selection.ranges){let r=s==t.selection.main;if(s.empty?!r||Vl:e.drawRangeCursor){let o=r?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",l=s.empty?s:M.cursor(s.head,s.head>s.anchor?-1:1);for(let a of Si.forRange(n,o,l))i.push(a)}}return i},update(n,t){n.transactions.some(i=>i.selection)&&(t.style.animationName=t.style.animationName=="cm-blink"?"cm-blink2":"cm-blink");let e=Fl(n);return e&&Fr(n.state,t),n.docChanged||n.selectionSet||e},mount(n,t){Fr(t.state,n)},class:"cm-cursorLayer"});function Fr(n,t){t.style.animationDuration=n.facet(mi).cursorBlinkRate+"ms"}const Jf=Hl({above:!1,markers(n){return n.state.selection.ranges.map(t=>t.empty?[]:Si.forRange(n,"cm-selectionBackground",t)).reduce((t,e)=>t.concat(e))},update(n,t){return n.docChanged||n.selectionSet||n.viewportChanged||Fl(n)},class:"cm-selectionLayer"}),dn={".cm-line":{"& ::selection, &::selection":{backgroundColor:"transparent !important"}},".cm-content":{"& :focus":{caretColor:"initial !important","&::selection, & ::selection":{backgroundColor:"Highlight !important"}}}};Vl&&(dn[".cm-line"].caretColor=dn[".cm-content"].caretColor="transparent !important");const Qf=Cn.highest(R.theme(dn));function jr(n,t,e,i,s){t.lastIndex=0;for(let r=n.iterRange(e,i),o=e,l;!r.next().done;o+=r.value.length)if(!r.lineBreak)for(;l=t.exec(r.value);)s(o+l.index,l)}function Zf(n,t){let e=n.visibleRanges;if(e.length==1&&e[0].from==n.viewport.from&&e[0].to==n.viewport.to)return e;let i=[];for(let{from:s,to:r}of e)s=Math.max(n.state.doc.lineAt(s).from,s-t),r=Math.min(n.state.doc.lineAt(r).to,r+t),i.length&&i[i.length-1].to>=s?i[i.length-1].to=r:i.push({from:s,to:r});return i}class td{constructor(t){const{regexp:e,decoration:i,decorate:s,boundary:r,maxLength:o=1e3}=t;if(!e.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=e,s)this.addMatch=(l,a,c,h)=>s(h,c,c+l[0].length,l,a);else if(typeof i=="function")this.addMatch=(l,a,c,h)=>{let u=i(l,a,c);u&&h(c,c+l[0].length,u)};else if(i)this.addMatch=(l,a,c,h)=>h(c,c+l[0].length,i);else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.boundary=r,this.maxLength=o}createDeco(t){let e=new ui,i=e.add.bind(e);for(let{from:s,to:r}of Zf(t,this.maxLength))jr(t.state.doc,this.regexp,s,r,(o,l)=>this.addMatch(l,t,o,i));return e.finish()}updateDeco(t,e){let i=1e9,s=-1;return t.docChanged&&t.changes.iterChanges((r,o,l,a)=>{a>t.view.viewport.from&&l<t.view.viewport.to&&(i=Math.min(l,i),s=Math.max(a,s))}),t.viewportChanged||s-i>1e3?this.createDeco(t.view):s>-1?this.updateRange(t.view,e.map(t.changes),i,s):e}updateRange(t,e,i,s){for(let r of t.visibleRanges){let o=Math.max(r.from,i),l=Math.min(r.to,s);if(l>o){let a=t.state.doc.lineAt(o),c=a.to<l?t.state.doc.lineAt(l):a,h=Math.max(r.from,a.from),u=Math.min(r.to,c.to);if(this.boundary){for(;o>a.from;o--)if(this.boundary.test(a.text[o-1-a.from])){h=o;break}for(;l<c.to;l++)if(this.boundary.test(c.text[l-c.from])){u=l;break}}let f=[],d,g=(p,m,x)=>f.push(x.range(p,m));if(a==c)for(this.regexp.lastIndex=h-a.from;(d=this.regexp.exec(a.text))&&d.index<u-a.from;)this.addMatch(d,t,d.index+a.from,g);else jr(t.state.doc,this.regexp,h,u,(p,m)=>this.addMatch(m,t,p,g));e=e.update({filterFrom:h,filterTo:u,filter:(p,m)=>p<h||m>u,add:f})}}return e}}const gn=/x/.unicode!=null?"gu":"g",ed=new RegExp(`[\0-\b
--­؜​‎‏\u2028\u2029‭‮⁦⁧⁩\uFEFF￹-￼]`,gn),id={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let Ms=null;function sd(){var n;if(Ms==null&&typeof document<"u"&&document.body){let t=document.body.style;Ms=((n=t.tabSize)!==null&&n!==void 0?n:t.MozTabSize)!=null}return Ms||!1}const $i=T.define({combine(n){let t=kn(n,{render:null,specialChars:ed,addSpecialChars:null});return(t.replaceTabs=!sd())&&(t.specialChars=new RegExp("	|"+t.specialChars.source,gn)),t.addSpecialChars&&(t.specialChars=new RegExp(t.specialChars.source+"|"+t.addSpecialChars.source,gn)),t}});function ym(n={}){return[$i.of(n),nd()]}let Wr=null;function nd(){return Wr||(Wr=Nt.fromClass(class{constructor(n){this.view=n,this.decorations=I.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(n.state.facet($i)),this.decorations=this.decorator.createDeco(n)}makeDecorator(n){return new td({regexp:n.specialChars,decoration:(t,e,i)=>{let{doc:s}=e.state,r=si(t[0],0);if(r==9){let o=s.lineAt(i),l=e.state.tabSize,a=uu(o.text,l,i-o.from);return I.replace({widget:new ad((l-a%l)*this.view.defaultCharacterWidth/this.view.scaleX)})}return this.decorationCache[r]||(this.decorationCache[r]=I.replace({widget:new ld(n,r)}))},boundary:n.replaceTabs?void 0:/[^]/})}update(n){let t=n.state.facet($i);n.startState.facet($i)!=t?(this.decorator=this.makeDecorator(t),this.decorations=this.decorator.createDeco(n.view)):this.decorations=this.decorator.updateDeco(n,this.decorations)}},{decorations:n=>n.decorations}))}const rd="•";function od(n){return n>=32?rd:n==10?"␤":String.fromCharCode(9216+n)}class ld extends ze{constructor(t,e){super(),this.options=t,this.code=e}eq(t){return t.code==this.code}toDOM(t){let e=od(this.code),i=t.state.phrase("Control character")+" "+(id[this.code]||"0x"+this.code.toString(16)),s=this.options.render&&this.options.render(this.code,i,e);if(s)return s;let r=document.createElement("span");return r.textContent=e,r.title=i,r.setAttribute("aria-label",i),r.className="cm-specialChar",r}ignoreEvent(){return!1}}class ad extends ze{constructor(t){super(),this.width=t}eq(t){return t.width==this.width}toDOM(){let t=document.createElement("span");return t.textContent="	",t.className="cm-tab",t.style.width=this.width+"px",t}ignoreEvent(){return!1}}function wm(){return cd}const hd=I.line({class:"cm-activeLine"}),cd=Nt.fromClass(class{constructor(n){this.decorations=this.getDeco(n)}update(n){(n.docChanged||n.selectionSet)&&(this.decorations=this.getDeco(n.view))}getDeco(n){let t=-1,e=[];for(let i of n.state.selection.ranges){let s=n.lineBlockAt(i.head);s.from>t&&(e.push(hd.range(s.from)),t=s.from)}return I.set(e)}},{decorations:n=>n.decorations});class ud extends ze{constructor(t){super(),this.content=t}toDOM(){let t=document.createElement("span");return t.className="cm-placeholder",t.style.pointerEvents="none",t.appendChild(typeof this.content=="string"?document.createTextNode(this.content):this.content),typeof this.content=="string"?t.setAttribute("aria-label","placeholder "+this.content):t.setAttribute("aria-hidden","true"),t}coordsAt(t){let e=t.firstChild?je(t.firstChild):[];if(!e.length)return null;let i=window.getComputedStyle(t.parentNode),s=as(e[0],i.direction!="rtl"),r=parseInt(i.lineHeight);return s.bottom-s.top>r*1.5?{left:s.left,right:s.right,top:s.top,bottom:s.top+r}:s}ignoreEvent(){return!1}}function vm(n){return Nt.fromClass(class{constructor(t){this.view=t,this.placeholder=n?I.set([I.widget({widget:new ud(n),side:1}).range(0)]):I.none}get decorations(){return this.view.state.doc.length?I.none:this.placeholder}},{decorations:t=>t.decorations})}const Xe="-10000px";class fd{constructor(t,e,i,s){this.facet=e,this.createTooltipView=i,this.removeTooltipView=s,this.input=t.state.facet(e),this.tooltips=this.input.filter(o=>o);let r=null;this.tooltipViews=this.tooltips.map(o=>r=i(o,r))}update(t,e){var i;let s=t.state.facet(this.facet),r=s.filter(a=>a);if(s===this.input){for(let a of this.tooltipViews)a.update&&a.update(t);return!1}let o=[],l=e?[]:null;for(let a=0;a<r.length;a++){let c=r[a],h=-1;if(c){for(let u=0;u<this.tooltips.length;u++){let f=this.tooltips[u];f&&f.create==c.create&&(h=u)}if(h<0)o[a]=this.createTooltipView(c,a?o[a-1]:null),l&&(l[a]=!!c.above);else{let u=o[a]=this.tooltipViews[h];l&&(l[a]=e[h]),u.update&&u.update(t)}}}for(let a of this.tooltipViews)o.indexOf(a)<0&&(this.removeTooltipView(a),(i=a.destroy)===null||i===void 0||i.call(a));return e&&(l.forEach((a,c)=>e[c]=a),e.length=l.length),this.input=s,this.tooltips=r,this.tooltipViews=o,!0}}function dd(n){let{win:t}=n;return{top:0,left:0,bottom:t.innerHeight,right:t.innerWidth}}const As=T.define({combine:n=>{var t,e,i;return{position:C.ios?"absolute":((t=n.find(s=>s.position))===null||t===void 0?void 0:t.position)||"fixed",parent:((e=n.find(s=>s.parent))===null||e===void 0?void 0:e.parent)||null,tooltipSpace:((i=n.find(s=>s.tooltipSpace))===null||i===void 0?void 0:i.tooltipSpace)||dd}}}),qr=new WeakMap,jl=Nt.fromClass(class{constructor(n){this.view=n,this.above=[],this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let t=n.state.facet(As);this.position=t.position,this.parent=t.parent,this.classes=n.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.resizeObserver=typeof ResizeObserver=="function"?new ResizeObserver(()=>this.measureSoon()):null,this.manager=new fd(n,pd,(e,i)=>this.createTooltip(e,i),e=>{this.resizeObserver&&this.resizeObserver.unobserve(e.dom),e.dom.remove()}),this.above=this.manager.tooltips.map(e=>!!e.above),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(e=>{Date.now()>this.lastTransaction-50&&e.length>0&&e[e.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),n.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let n of this.manager.tooltipViews)this.intersectionObserver.observe(n.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(n){n.transactions.length&&(this.lastTransaction=Date.now());let t=this.manager.update(n,this.above);t&&this.observeIntersection();let e=t||n.geometryChanged,i=n.state.facet(As);if(i.position!=this.position&&!this.madeAbsolute){this.position=i.position;for(let s of this.manager.tooltipViews)s.dom.style.position=this.position;e=!0}if(i.parent!=this.parent){this.parent&&this.container.remove(),this.parent=i.parent,this.createContainer();for(let s of this.manager.tooltipViews)this.container.appendChild(s.dom);e=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);e&&this.maybeMeasure()}createTooltip(n,t){let e=n.create(this.view),i=t?t.dom:null;if(e.dom.classList.add("cm-tooltip"),n.arrow&&!e.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let s=document.createElement("div");s.className="cm-tooltip-arrow",e.dom.appendChild(s)}return e.dom.style.position=this.position,e.dom.style.top=Xe,e.dom.style.left="0px",this.container.insertBefore(e.dom,i),e.mount&&e.mount(this.view),this.resizeObserver&&this.resizeObserver.observe(e.dom),e}destroy(){var n,t,e;this.view.win.removeEventListener("resize",this.measureSoon);for(let i of this.manager.tooltipViews)i.dom.remove(),(n=i.destroy)===null||n===void 0||n.call(i);this.parent&&this.container.remove(),(t=this.resizeObserver)===null||t===void 0||t.disconnect(),(e=this.intersectionObserver)===null||e===void 0||e.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let n=this.view.dom.getBoundingClientRect(),t=1,e=1,i=!1;if(this.position=="fixed"&&this.manager.tooltipViews.length){let{dom:s}=this.manager.tooltipViews[0];if(C.gecko)i=s.offsetParent!=this.container.ownerDocument.body;else if(s.style.top==Xe&&s.style.left=="0px"){let r=s.getBoundingClientRect();i=Math.abs(r.top+1e4)>1||Math.abs(r.left)>1}}if(i||this.position=="absolute")if(this.parent){let s=this.parent.getBoundingClientRect();s.width&&s.height&&(t=s.width/this.parent.offsetWidth,e=s.height/this.parent.offsetHeight)}else({scaleX:t,scaleY:e}=this.view.viewState);return{editor:n,parent:this.parent?this.container.getBoundingClientRect():n,pos:this.manager.tooltips.map((s,r)=>{let o=this.manager.tooltipViews[r];return o.getCoords?o.getCoords(s.pos):this.view.coordsAtPos(s.pos)}),size:this.manager.tooltipViews.map(({dom:s})=>s.getBoundingClientRect()),space:this.view.state.facet(As).tooltipSpace(this.view),scaleX:t,scaleY:e,makeAbsolute:i}}writeMeasure(n){var t;if(n.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let l of this.manager.tooltipViews)l.dom.style.position="absolute"}let{editor:e,space:i,scaleX:s,scaleY:r}=n,o=[];for(let l=0;l<this.manager.tooltips.length;l++){let a=this.manager.tooltips[l],c=this.manager.tooltipViews[l],{dom:h}=c,u=n.pos[l],f=n.size[l];if(!u||u.bottom<=Math.max(e.top,i.top)||u.top>=Math.min(e.bottom,i.bottom)||u.right<Math.max(e.left,i.left)-.1||u.left>Math.min(e.right,i.right)+.1){h.style.top=Xe;continue}let d=a.arrow?c.dom.querySelector(".cm-tooltip-arrow"):null,g=d?7:0,p=f.right-f.left,m=(t=qr.get(c))!==null&&t!==void 0?t:f.bottom-f.top,x=c.offset||md,y=this.view.textDirection==Z.LTR,S=f.width>i.right-i.left?y?i.left:i.right-f.width:y?Math.min(u.left-(d?14:0)+x.x,i.right-p):Math.max(i.left,u.left-p+(d?14:0)-x.x),w=this.above[l];!a.strictSide&&(w?u.top-(f.bottom-f.top)-x.y<i.top:u.bottom+(f.bottom-f.top)+x.y>i.bottom)&&w==i.bottom-u.bottom>u.top-i.top&&(w=this.above[l]=!w);let k=(w?u.top-i.top:i.bottom-u.bottom)-g;if(k<m&&c.resize!==!1){if(k<this.view.defaultLineHeight){h.style.top=Xe;continue}qr.set(c,m),h.style.height=(m=k)/r+"px"}else h.style.height&&(h.style.height="");let A=w?u.top-m-g-x.y:u.bottom+g+x.y,P=S+p;if(c.overlap!==!0)for(let E of o)E.left<P&&E.right>S&&E.top<A+m&&E.bottom>A&&(A=w?E.top-m-2-g:E.bottom+g+2);if(this.position=="absolute"?(h.style.top=(A-n.parent.top)/r+"px",h.style.left=(S-n.parent.left)/s+"px"):(h.style.top=A/r+"px",h.style.left=S/s+"px"),d){let E=u.left+(y?x.x:-x.x)-(S+14-7);d.style.left=E/s+"px"}c.overlap!==!0&&o.push({left:S,top:A,right:P,bottom:A+m}),h.classList.toggle("cm-tooltip-above",w),h.classList.toggle("cm-tooltip-below",!w),c.positioned&&c.positioned(n.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let n of this.manager.tooltipViews)n.dom.style.top=Xe}},{eventObservers:{scroll(){this.maybeMeasure()}}}),gd=R.baseTheme({".cm-tooltip":{zIndex:100,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:`${7*2}px`,position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),md={x:0,y:0},pd=T.define({enables:[jl,gd]});function Sm(n,t){let e=n.plugin(jl);if(!e)return null;let i=e.manager.tooltips.indexOf(t);return i<0?null:e.manager.tooltipViews[i]}class oe extends Ve{compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}eq(t){return!1}destroy(t){}}oe.prototype.elementClass="";oe.prototype.toDOM=void 0;oe.prototype.mapMode=St.TrackBefore;oe.prototype.startSide=oe.prototype.endSide=-1;oe.prototype.point=!0;const Ki=T.define(),bd={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>N.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},li=T.define();function Cm(n){return[Wl(),li.of(Object.assign(Object.assign({},bd),n))]}const _r=T.define({combine:n=>n.some(t=>t)});function Wl(n){return[xd]}const xd=Nt.fromClass(class{constructor(n){this.view=n,this.prevViewport=n.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=n.state.facet(li).map(t=>new $r(n,t));for(let t of this.gutters)this.dom.appendChild(t.dom);this.fixed=!n.state.facet(_r),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),n.scrollDOM.insertBefore(this.dom,n.contentDOM)}update(n){if(this.updateGutters(n)){let t=this.prevViewport,e=n.view.viewport,i=Math.min(t.to,e.to)-Math.max(t.from,e.from);this.syncGutters(i<(e.to-e.from)*.8)}n.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px"),this.view.state.facet(_r)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=n.view.viewport}syncGutters(n){let t=this.dom.nextSibling;n&&this.dom.remove();let e=N.iter(this.view.state.facet(Ki),this.view.viewport.from),i=[],s=this.gutters.map(r=>new yd(r,this.view.viewport,-this.view.documentPadding.top));for(let r of this.view.viewportLineBlocks)if(i.length&&(i=[]),Array.isArray(r.type)){let o=!0;for(let l of r.type)if(l.type==dt.Text&&o){mn(e,i,l.from);for(let a of s)a.line(this.view,l,i);o=!1}else if(l.widget)for(let a of s)a.widget(this.view,l)}else if(r.type==dt.Text){mn(e,i,r.from);for(let o of s)o.line(this.view,r,i)}else if(r.widget)for(let o of s)o.widget(this.view,r);for(let r of s)r.finish();n&&this.view.scrollDOM.insertBefore(this.dom,t)}updateGutters(n){let t=n.startState.facet(li),e=n.state.facet(li),i=n.docChanged||n.heightChanged||n.viewportChanged||!N.eq(n.startState.facet(Ki),n.state.facet(Ki),n.view.viewport.from,n.view.viewport.to);if(t==e)for(let s of this.gutters)s.update(n)&&(i=!0);else{i=!0;let s=[];for(let r of e){let o=t.indexOf(r);o<0?s.push(new $r(this.view,r)):(this.gutters[o].update(n),s.push(this.gutters[o]))}for(let r of this.gutters)r.dom.remove(),s.indexOf(r)<0&&r.destroy();for(let r of s)this.dom.appendChild(r.dom);this.gutters=s}return i}destroy(){for(let n of this.gutters)n.destroy();this.dom.remove()}},{provide:n=>R.scrollMargins.of(t=>{let e=t.plugin(n);return!e||e.gutters.length==0||!e.fixed?null:t.textDirection==Z.LTR?{left:e.dom.offsetWidth*t.scaleX}:{right:e.dom.offsetWidth*t.scaleX}})});function zr(n){return Array.isArray(n)?n:[n]}function mn(n,t,e){for(;n.value&&n.from<=e;)n.from==e&&t.push(n.value),n.next()}class yd{constructor(t,e,i){this.gutter=t,this.height=i,this.i=0,this.cursor=N.iter(t.markers,e.from)}addElement(t,e,i){let{gutter:s}=this,r=(e.top-this.height)/t.scaleY,o=e.height/t.scaleY;if(this.i==s.elements.length){let l=new ql(t,o,r,i);s.elements.push(l),s.dom.appendChild(l.dom)}else s.elements[this.i].update(t,o,r,i);this.height=e.bottom,this.i++}line(t,e,i){let s=[];mn(this.cursor,s,e.from),i.length&&(s=s.concat(i));let r=this.gutter.config.lineMarker(t,e,s);r&&s.unshift(r);let o=this.gutter;s.length==0&&!o.config.renderEmptyElements||this.addElement(t,e,s)}widget(t,e){let i=this.gutter.config.widgetMarker(t,e.widget,e);i&&this.addElement(t,e,[i])}finish(){let t=this.gutter;for(;t.elements.length>this.i;){let e=t.elements.pop();t.dom.removeChild(e.dom),e.destroy()}}}class $r{constructor(t,e){this.view=t,this.config=e,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let i in e.domEventHandlers)this.dom.addEventListener(i,s=>{let r=s.target,o;if(r!=this.dom&&this.dom.contains(r)){for(;r.parentNode!=this.dom;)r=r.parentNode;let a=r.getBoundingClientRect();o=(a.top+a.bottom)/2}else o=s.clientY;let l=t.lineBlockAtHeight(o-t.documentTop);e.domEventHandlers[i](t,l,s)&&s.preventDefault()});this.markers=zr(e.markers(t)),e.initialSpacer&&(this.spacer=new ql(t,0,0,[e.initialSpacer(t)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(t){let e=this.markers;if(this.markers=zr(this.config.markers(t.view)),this.spacer&&this.config.updateSpacer){let s=this.config.updateSpacer(this.spacer.markers[0],t);s!=this.spacer.markers[0]&&this.spacer.update(t.view,0,0,[s])}let i=t.view.viewport;return!N.eq(this.markers,e,i.from,i.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(t):!1)}destroy(){for(let t of this.elements)t.destroy()}}class ql{constructor(t,e,i,s){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(t,e,i,s)}update(t,e,i,s){this.height!=e&&(this.height=e,this.dom.style.height=e+"px"),this.above!=i&&(this.dom.style.marginTop=(this.above=i)?i+"px":""),wd(this.markers,s)||this.setMarkers(t,s)}setMarkers(t,e){let i="cm-gutterElement",s=this.dom.firstChild;for(let r=0,o=0;;){let l=o,a=r<e.length?e[r++]:null,c=!1;if(a){let h=a.elementClass;h&&(i+=" "+h);for(let u=o;u<this.markers.length;u++)if(this.markers[u].compare(a)){l=u,c=!0;break}}else l=this.markers.length;for(;o<l;){let h=this.markers[o++];if(h.toDOM){h.destroy(s);let u=s.nextSibling;s.remove(),s=u}}if(!a)break;a.toDOM&&(c?s=s.nextSibling:this.dom.insertBefore(a.toDOM(t),s)),c&&o++}this.dom.className=i,this.markers=e}destroy(){this.setMarkers(null,[])}}function wd(n,t){if(n.length!=t.length)return!1;for(let e=0;e<n.length;e++)if(!n[e].compare(t[e]))return!1;return!0}const vd=T.define(),De=T.define({combine(n){return kn(n,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(t,e){let i=Object.assign({},t);for(let s in e){let r=i[s],o=e[s];i[s]=r?(l,a,c)=>r(l,a,c)||o(l,a,c):o}return i}})}});class Ts extends oe{constructor(t){super(),this.number=t}eq(t){return this.number==t.number}toDOM(){return document.createTextNode(this.number)}}function Es(n,t){return n.state.facet(De).formatNumber(t,n.state)}const Sd=li.compute([De],n=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(t){return t.state.facet(vd)},lineMarker(t,e,i){return i.some(s=>s.toDOM)?null:new Ts(Es(t,t.state.doc.lineAt(e.from).number))},widgetMarker:()=>null,lineMarkerChange:t=>t.startState.facet(De)!=t.state.facet(De),initialSpacer(t){return new Ts(Es(t,Kr(t.state.doc.lines)))},updateSpacer(t,e){let i=Es(e.view,Kr(e.view.state.doc.lines));return i==t.number?t:new Ts(i)},domEventHandlers:n.facet(De).domEventHandlers}));function km(n={}){return[De.of(n),Wl(),Sd]}function Kr(n){let t=9;for(;t<n;)t=t*10+9;return t}const Cd=new class extends oe{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},kd=Ki.compute(["selection"],n=>{let t=[],e=-1;for(let i of n.selection.ranges){let s=n.doc.lineAt(i.head).from;s>e&&(e=s,t.push(Cd.range(s)))}return N.of(t)});function Mm(){return kd}const _l=K.define(),Md=K.define(),Ad=K.define(),Td=K.define();function Ed(n){return new Map(n.map(t=>[t.id,t.at]))}const pn=Et.define({create(){return null},update(n,t){for(const e of t.effects)if(e.is(_l))return e.value;return n}}),es=Et.define({create(){return[]},update(n,t){for(const o of t.effects)if(o.is(Md))return o.value;const e=n,i=Ed(e),s=Vc(t,i);return qc(i,s)?e:Kc(e,s)}}),bn=Et.define({create(){return null},update(n,t){for(const e of t.effects)if(e.is(Ad))return e.value;return n}}),xn=Et.define({create(){return null},update(n,t){for(const e of t.effects)if(e.is(Td))return e.value;return n}});function Ur(n){if(!n||n.to-n.from===0)return I.none;const t=I.mark({class:gc.code});return I.set([t.range(n.from,n.to)])}function Gr(n,t,e){if(n.length===0)return I.none;const s=[...n].sort((r,o)=>r.at.start-o.at.start).map(r=>{if(r.at.end-r.at.start===0)return null;const o=r.id===t,l=r.id===e,a=$c({isHovered:o,isFocused:l,isCode:!0,diffStatus:r.diffStatus});return I.mark({class:a,attributes:{"data-comment-id":r.id}}).range(r.at.start,r.at.end)}).filter(uo);return I.set(s)}const Od=Et.define({create(n){const t=n.field(pn,!1);return Ur(t??null)},update(n,t){const e=t.state.field(pn,!1);return Ur(e??null)},provide:n=>R.decorations.from(n)}),Dd=Et.define({create(n){const t=n.field(es,!1),e=n.field(bn,!1),i=n.field(xn,!1);return Gr(t??[],e??null,i??null)},update(n,t){const e=t.state.field(es,!1),i=t.state.field(bn,!1),s=t.state.field(xn,!1);return Gr(e??[],i??null,s??null)},provide:n=>R.decorations.from(n)});function Rd(n){n.state.selection.main.empty&&n.dispatch({effects:_l.of(null)})}function zl(n){let t=n.dataset.commentId;for(let e=0;e<10&&!t&&n.parentElement;e++)n=n.parentElement,t=n.dataset.commentId;return t}function Pd(n){const t=n.target,e=zl(t);e&&pe.focusComment(e)}function Nd(n){const t=n.target,e=zl(t);e?pe.mouseEnterComment(e):pe.mouseLeaveComment()}function Am(n,t=null,e=null){return[es.init(()=>n),pn,bn.init(()=>t),xn.init(()=>e),Od,Dd,R.updateListener.of(i=>{i.selectionSet&&Rd(i.view)}),R.domEventHandlers({click:Pd,mouseover:Nd})]}function Me(n){return`Create a new document that rewrites the code in ${n}.`}const Ld=[{id:"review",title:B({id:"upv1Y0",defaultMessage:"Code review"}),icon:Kh,prompt:"Search for bugs and opportunities to improve the code—for example, ways that performance or code structure could be improved. Leave as few comments as possible, but add more comments if the text is long. DO NOT leave more than 5 comments. You may reply that you reviewed the code and left suggestions to improve the coding quality, but do not mention the prompt.",action:st.COMMENT},{id:"comments",title:B({id:"sTWMBR",defaultMessage:"Add comments"}),icon:Uh,prompt:"Add inline code comments to explain the code, especially parts that are more complex. Make sure to rewrite all the code. You may reply that you added inline comments, but do not mention the prompt.",action:st.EDIT},{id:"logs",title:B({id:"+00vDz",defaultMessage:"Add logs"}),icon:Gh,prompt:"Insert logs/print statements in the code that will help debug its behavior. Do not make any other changes to the code.",action:st.EDIT},{id:"bugs",title:B({id:"Uw2B/L",defaultMessage:"Fix bugs"}),icon:Yh,prompt:"Find any bugs and rewrite all the code to fix the bugs. Do not add any new comments. If there are no bugs, reply that you reviewed the code and found no bugs.",action:st.EDIT},{id:"port",title:B({id:"BotcNe",defaultMessage:"Port to a language"}),icon:Xh,prompt:"Port to a language.",action:st.CREATE_TEXTDOC,menu:[{prompt:Me("PHP"),title:B({id:"oR7PqF",defaultMessage:"PHP"})},{prompt:Me("C++"),title:B({id:"QbnHp2",defaultMessage:"C++"})},{prompt:Me("Python"),title:B({id:"viPy6U",defaultMessage:"Python"})},{prompt:Me("JavaScript"),title:B({id:"Mnbu7B",defaultMessage:"JavaScript"})},{prompt:Me("TypeScript"),title:B({id:"pot/GV",defaultMessage:"TypeScript"})},{prompt:Me("Java"),title:B({id:"78tNyh",defaultMessage:"Java"})}]}];function Id(n){return n.includes("'react'")||n.includes('"react"')}function Bd(n,t){switch(n){case jt.CODE_HTML:return"static";case jt.CODE_REACT:return"react";case jt.CODE_JAVASCRIPT:case jt.CODE_TYPESCRIPT:return Id(t)?"react":void 0;default:return}}function yn(n,t){return Bd(n,t)!=null}function Pn(n){return Ja([jt.CODE_JAVASCRIPT,jt.CODE_TYPESCRIPT,jt.CODE_PYTHON],n)}function Yr(){if(typeof globalThis<"u")return globalThis;if(typeof window<"u")return window;if(typeof global<"u")return global;if(typeof self<"u")return self;throw new Error("Unable to locate global object.")}function Hd(){const n=eval;function t(e){return e==="this"?Yr():n(e)}try{Yr().eval=t}catch(e){Mt.logError("Failed to polyfill eval",e)}}Hd();oo(()=>lo(()=>import("./f3qvtxwg4ex6ln5f.js").then(n=>n.t),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25])).then(n=>n.TextdocSandpackCodePreview),{fallback:()=>b.jsx("div",{className:"h-full w-full",children:"Failed to load"}),loading:()=>b.jsx("div",{className:"h-full w-full"})});const Xr=(n=[])=>n.filter(({status:t})=>t!==Qa.DISMISSED),Vd=({isTextdocStreaming:n,isRequestActive:t,value:e,comments:i})=>{const[s,r]=v.useState(!1);return v.useEffect(()=>{n&&s&&(r(!1),pe.reset())},[e,i]),v.useEffect(()=>{t||(r(!1),pe.reset())},[t]),[s,r]};function Fd({onClickRestore:n,onClickResetLatest:t}){const e=Ct();return b.jsx($.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{bounce:0,duration:.24},className:"absolute bottom-0 left-0 z-30 w-full items-center border-t border-gray-100 bg-token-main-surface-primary p-6 shadow-[0_-4px_32px_rgba(0,0,0,0.08)] @container dark:border-token-border-xlight dark:shadow-[0_-4px_32px_rgba(0,0,0,0.12)] lg:border-l",children:b.jsxs("div",{className:"mx-auto flex max-w-[48rem] flex-col flex-wrap justify-center gap-5 @2xl:flex-row @2xl:justify-between",children:[b.jsxs("div",{className:"flex flex-col px-2 text-center @2xl:text-start",children:[b.jsx("span",{className:"text-md text-wrap font-semibold",children:e.formatMessage({id:"gt23pb",defaultMessage:"You are viewing a previous version"})}),b.jsx("span",{className:"text-wrap text-sm text-token-text-secondary",children:e.formatMessage({id:"sAlUJn",defaultMessage:"Restore this version to make edits"})})]}),b.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4",children:[b.jsx(Be,{as:"button",color:"primary",onClick:n,children:e.formatMessage({id:"+cddAb",defaultMessage:"Restore this version"})}),b.jsx(Be,{as:"button",color:"secondary",onClick:t,children:e.formatMessage({id:"qCD3eu",defaultMessage:"Back to latest version"})})]})]})})}const jd=({onClose:n,onClear:t})=>b.jsxs("div",{className:"flex items-center justify-between border-b border-gray-100 bg-token-main-surface-primary p-2 dark:border-token-border-medium",children:[b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx(Be,{size:"small",color:"ghost",as:"button",className:"aspect-square !p-1",onClick:n,icon:Jh}),b.jsx(ne,{...Jr.output})]}),b.jsx("div",{className:"flex items-center gap-2",children:b.jsx(me,{label:b.jsx(ne,{...Jr.clearConsole}),children:b.jsx(Be,{size:"small",color:"ghost",as:"button",className:"aspect-square !p-1",icon:Qh,onClick:t})})})]}),Jr=we({output:{id:"P/lYBq",defaultMessage:"Output"},clearConsole:{id:"gAICYK",defaultMessage:"Clear console"}}),Wd=({onDrag:n,onDragEnd:t,onDoubleClick:e})=>b.jsx($.div,{drag:"y",className:"absolute top-[-2px] z-10 h-[4px] w-full cursor-ns-resize bg-token-text-quaternary opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,height:"8px",top:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateY(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onDrag:(i,s)=>{n?.(s)},onDragEnd:t,onDoubleClick:e});var is=(n=>(n.RAN_CODE="ran_code",n))(is||{});const $l=(n,{name:t,message:e,line:i,stack:s})=>`${t}: ${e}

Stack:
${s.join("")}

Error occured in:
${n.split(`
`).slice(i-1,i+1).join(`
`)}`,qd=({name:n,message:t,stack:e})=>`${n}: ${t}
${e.join(`
`)}`,_d=({time:n})=>{const[,t]=v.useState(0);return v.useEffect(()=>{const e=setInterval(()=>t(i=>i+1),6e4);return()=>clearInterval(e)},[]),th(n,{includeSeconds:!1,addSuffix:!0})},zd=({log:n,level:t})=>b.jsx("span",{className:tt("whitespace-pre-wrap",t==="error"&&"text-red-500"),children:n}),$d=({error:n,isLast:t,isRequestActive:e,onRequestHelp:i})=>{const[s,r]=v.useState(!1),o=l=>async()=>{r(l),await i?.(n,l),r(!1)};return b.jsxs("div",{className:"flex flex-col gap-2",children:[b.jsx("span",{className:"whitespace-pre-wrap text-red-500",children:qd(n)}),t&&!e&&b.jsxs("div",{className:"flex gap-2",children:[b.jsx(Be,{onClick:o("comment"),icon:Zh,type:"button",color:"secondary",disabled:!!s,loading:s==="comment",children:b.jsx(ne,{...ss.askForHelp})}),b.jsx(Be,{onClick:o("fix"),icon:tc,type:"button",color:"primary",disabled:!!s,loading:s==="fix",children:b.jsx(ne,{...ss.askForFix})})]})]})},Kd=({ranAt:n})=>b.jsxs("div",{className:"flex items-center justify-between gap-2 font-sans",children:[b.jsx("div",{className:"rounded-full bg-token-main-surface-secondary px-2 py-0.5",children:b.jsx(ne,{...ss.ranCode})}),b.jsx("div",{className:"flex items-center gap-2",children:b.jsx(_d,{time:n})})]}),Ud=({output:n})=>{const t=Ct();return n==null?null:typeof n=="string"&&n.startsWith("blob:")?b.jsx("img",{alt:t.formatMessage(ss.imgAlt),src:n}):b.jsx("span",{className:"flex items-center gap-2",children:Za(n)})},Gd=({log:n,isLast:t=!1,isRequestActive:e=!1,onRequestHelp:i})=>{let s=null;switch(n.type){case Ae.LOG:{s=b.jsx(zd,{...n});break}case Ae.ERROR:{s=b.jsx($d,{...n,isLast:t,isRequestActive:e,onRequestHelp:i});break}case Ae.OUTPUT:{s=b.jsx(Ud,{...n});break}case is.RAN_CODE:{s=b.jsx(Kd,{...n});break}case Ae.RUN_COMPLETE:break}return b.jsx("li",{className:tt("whitespace-pre px-2 py-1 font-mono",n.type===is.RAN_CODE&&"sticky top-0 border-b border-token-border-light bg-token-main-surface-primary shadow-[0_-1px_0_0_var(--border-light)]"),children:s})},ss=we({imgAlt:{id:"L6t7Yb",defaultMessage:"Plot"},ranCode:{id:"ffa9Nt",defaultMessage:"Ran code"},askForHelp:{id:"wMZco9",defaultMessage:"Ask ChatGPT for help"},askForFix:{id:"A9pxgT",defaultMessage:"Fix it for me"}}),Kl=`You're a professional developer highly skilled in debugging. The user ran the textdoc's code, and an error was thrown.
Please think carefully about how to fix the error`,Yd=(n,t)=>{const e=$l(n,t);return`
${Kl}, and then rewrite the textdoc to fix it.

- NEVER change existing test cases unless they're clearly wrong.
- ALWAYS add more test cases if there aren't any yet.
- ALWAYS ask the user what the expected behavior is in the chat if the code is not clear.

# Error

${e}`.trim()},Xd=(n,t)=>{const e=$l(n,t);return`
${Kl}, and then add multiple comments with suggestions on where things might be going wrong.

- NEVER comment on test cases unless they are clearly incorrect, or you are unsure of what the correct behavior of the code is.
- The user sees which line the error occurred on, so do not comment on that line directly.

# Error

${e}`.trim()},Jd=({logs:n,isRequestActive:t,onClear:e,onClose:i,onRequestHelp:s})=>{const[r,o]=v.useState(320),l=n.filter(a=>a.type!==Ae.RUN_COMPLETE);return b.jsxs($.div,{className:"relative w-full border-t border-token-border-light",children:[b.jsx(Wd,{onDrag:({delta:{y:a}})=>o(c=>c-a)}),b.jsxs("div",{className:"flex flex-col",style:{height:r},children:[b.jsx(jd,{onClear:e,onClose:i}),b.jsx("div",{className:"flex flex-1 flex-col-reverse overflow-auto bg-white dark:bg-black",children:b.jsx("ol",{className:"flex flex-1 flex-col justify-end pb-4",children:l.map((a,c)=>b.jsx(Gd,{log:a,isLast:c===l.length-1,isRequestActive:t,onRequestHelp:s},c))})})]})]})},Qd=({textdocContent:n,isRequestActive:t,createTextdocTurn:e},i)=>{const s=eh(),[r,o]=v.useState(!1),[l,a]=v.useState([]),c=(h,u)=>e({action:st.COMMENT,userMessageType:ft.CONSOLE,content:u==="fix"?Yd(n,h):Xd(n,h)});return v.useImperativeHandle(i,()=>({runCode:async(h,u)=>{if(!Pn(h))return;o(!0),a(g=>[...g,{type:is.RAN_CODE,ranAt:Date.now()}]);const f=xo(h),d=ai(s.current).evalAsync({code:u,type:f});for await(const g of d)g.type!==Ae.READY&&a(p=>[...p,g])},open:()=>o(!0)})),r?b.jsx(Jd,{logs:l,onClose:()=>o(!1),onClear:()=>a([]),isRequestActive:t,onRequestHelp:c}):null};v.forwardRef(Qd);const Zd=[{id:"suggest",title:B({id:"W2jkH/",defaultMessage:"Suggest edits"}),icon:ec,prompt:"Suggest edits that would improve this text, like content to add or remove, places to rephrase so that the text flows more smoothly, or ways to reorganize the ideas to be more effective. Leave as few comments as possible, but add a few more comments if the text is long. DO NOT leave more than 5 comments. You can reply that you added comments and suggestions to help improve the writing quality, but do not mention the prompt.",action:st.COMMENT},{id:"emoji",title:B({id:"X+gAr3",defaultMessage:"Add emojis"}),icon:ic,prompt:"Replace as many words as possible with emojis.",action:st.EDIT},{id:"polish",title:B({id:"sYPRi3",defaultMessage:"Add final polish"}),icon:sc,prompt:"Add some final polish to the text. If relevant, add a large title or any section titles. Check grammar and mechanics, make sure everything is consistent and reads well. You can reply that you added some final polish and checked for grammar, but do not mention the prompt.",action:st.EDIT},{id:"reading-level",title:B({id:"89gu5T",defaultMessage:"Reading level"}),icon:nc,prompt:"Reading level",action:st.EDIT,scrub:[{prompt:"Rewrite this text at the reading level of a doctoral writer in this subject. You may reply that you adjusted the text to reflect a graduate school reading level, but do not mention the prompt.",title:B({id:"zkwvk0",defaultMessage:"Graduate School"})},{prompt:"Rewrite this text at the reading level of a college student majoring in this subject",title:B({id:"qB/+5R",defaultMessage:"College"})},{prompt:"Rewrite this text at the reading level of a high school student who has taken a couple of classes in this subject.",title:B({id:"QI/qX+",defaultMessage:"High School"})},{prompt:"Keep current reading level",title:B({id:"tO5EOl",defaultMessage:"Keep current reading level"}),isCancel:!0},{prompt:"Rewrite this text at the reading level of a middle schooler.",title:B({id:"x2Nzhp",defaultMessage:"Middle School"})},{prompt:"Rewrite this text at the reading level of a kindergartener.",title:B({id:"VXziIP",defaultMessage:"Kindergarten"})}]},{id:"length",title:B({id:"X/oN5v",defaultMessage:"Adjust the length"}),icon:rc,prompt:"Adjust the length",action:st.EDIT,scrub:[{prompt:"Make this text 75% longer.",title:B({id:"4i2xtx",defaultMessage:"Longest"})},{prompt:"Make this text 50% longer.",title:B({id:"MR9tfb",defaultMessage:"Longer"})},{prompt:"Keep current length",title:B({id:"+Vn3dN",defaultMessage:"Keep current length"}),isCancel:!0},{prompt:"Make this text 50% shorter.",title:B({id:"ZiO7i/",defaultMessage:"Shorter"})},{prompt:"Make this text 75% shorter.",title:B({id:"HPUWV1",defaultMessage:"Shortest"})}]}];class tg{dependencies(){return[]}unifiedInitializationHook(t){return t}}class Ul extends tg{unistToProseMirrorTest(t){return t.type===this.unistNodeName()}proseMirrorInputRules(t){return[]}proseMirrorKeymap(t){return{}}postUnistToProseMirrorHook(t){}}class Tm extends Ul{proseMirrorToUnistTest(t){return this.proseMirrorNodeName()===t.type.name}proseMirrorNodeView(){return null}proseMirrorNodeName(){return this.constructor.proseMirrorNodeName()}static proseMirrorNodeName(){throw new Error("Method not implemented.")}}class eg extends Ul{proseMirrorMarkName(){return this.constructor.proseMirrorMarkName()}static proseMirrorMarkName(){throw new Error("Method not implemented.")}}class ig extends eg{unistNodeName(){return"startend"}static proseMirrorMarkName(){return"startend"}proseMirrorMarkSpec(){return{attrs:{start:{},end:{}},toDOM(){return["span",0]}}}unistNodeToProseMirrorNodes({schema:t,convertedChildren:e,attrs:i}){return e.map(s=>s.mark(s.marks.concat([t.marks[this.proseMirrorMarkName()].create(i)])))}processConvertedUnistNode(t){return{type:this.unistNodeName(),children:[t]}}}function ns(n){if(n.type.name!=="text"){const{start:s,end:r}=n.attrs;return s==null||r==null?null:{start:s,end:r}}const t=n.marks.find(s=>s.type.name===ig.proseMirrorMarkName());if(!t)return null;const{start:e,end:i}=t.attrs;return e==null||i==null?null:{start:e,end:i}}function Gl(n,t){const{parent:e,textOffset:i}=t,s=n.nodeAt(t.pos);if(!s)return ai(ns(e)).end;const{start:r}=ai(ns(s));return r+i}function Yl(n,t){const e=n.nodeAt(t.pos);if(e){const{start:i}=ai(ns(e));return i+t.textOffset}return ai(ns(t.parent)).end}function Em(n,t){const e=new Map;for(const[i,s]of t){const r=Gl(n,n.resolve(s.start)),o=Yl(n,n.resolve(s.end));e.set(i,{start:r,end:o})}return e}function sg(n){const{doc:t,selection:e}=n,{$from:i,$to:s}=e,{pos:r}=i,{pos:o}=s,l=t.textBetween(r,o);try{const a=Gl(t,i),c=Yl(t,s);return{sourceFrom:a,sourceTo:c,from:r,to:o,selectedText:l}}catch(a){Mt.logError("Getting source selection",a)}return{selectedText:l,from:r,to:o}}const Ie={type:"spring",bounce:.2,duration:.5};function ng(n){return n instanceof Sc}function Om(n){return n instanceof R}const rg=v.createContext(()=>null),og=v.createContext(null),lg=v.createContext(0),ag=()=>v.useContext(rg),Dm=()=>v.useContext(og),Rm=()=>v.useContext(lg),hg=v.createContext(()=>null),cg=v.createContext(null),Pm=v.createContext(0),ug=()=>v.useContext(hg),Nm=()=>v.useContext(cg);function fg(){const n=ug(),t=ag();return v.useMemo(()=>()=>n()??t(),[n,t])}function pi(){return window.matchMedia("(hover: hover)").matches}const Xl=({title:n,icon:t,size:e,opacity:i,initialHeight:s=e,initialScale:r=1,onClick:o,isConfirming:l,isSmall:a,onSubmit:c})=>{const h=Ct(),u=ih(),[f,d]=v.useState(!1),g=pi(),p=()=>{d(!0)},m=()=>{d(!1)},x=b.jsx($.div,{initial:{scale:r,opacity:0},animate:{scale:1,opacity:1,transition:{type:"spring",bounce:.24,duration:.52}},exit:{scale:.5,opacity:0,transition:{type:"spring",bounce:.24,duration:.52,opacity:{duration:.1}}},whileHover:{scale:1.15},transition:Ie,children:b.jsx($.div,{className:"flex cursor-pointer items-start overflow-hidden",initial:{width:e,height:e},animate:{width:e,height:e},transition:Ie,onMouseEnter:p,onMouseLeave:m,children:l?b.jsx($.button,{className:"m-auto h-8 w-8 rounded-full bg-black text-center dark:bg-white",initial:{opacity:0,scale:.64},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.64},transition:{type:"spring",duration:.32,bounce:.14},onClick:c,children:b.jsx(rs,{className:tt("h-8 w-8 animate-pulsing text-white dark:text-black",a?"icon-md":"icon-lg")})}):t})});return b.jsx($.div,{role:"button",onClick:o,initial:{height:s},animate:{height:e,opacity:l?1:i??.52},exit:{height:0},whileHover:{opacity:1},transition:Ie,children:g?b.jsx(me,{delayDuration:0,sideOffset:4,open:u?!!(l||f):!1,label:h.formatMessage(n),side:"right",contentClassName:"pointer-events-none",children:x}):x})};function Qr({accelerator:n,size:t,opacity:e,onClick:i,onSubmit:s,disableHeightAnimation:r=!1,disableLabel:o=!1,isCancelledScrubber:l=!1,isSmall:a=!1,isConfirming:c}){const{title:h,icon:u}=n,f=pi(),d=Ct();return b.jsxs("div",{className:"relative",children:[!f&&!o&&b.jsx($.div,{className:"absolute right-full top-1/2 w-[160px] -translate-y-1/2 transform pr-4 text-right text-sm text-token-text-secondary",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:d.formatMessage(h)}),b.jsx(Xl,{size:t,onClick:i,opacity:e,initialHeight:l||r?"auto":0,initialScale:l?.88:.5,title:h,isSmall:a,isConfirming:c,onSubmit:s,icon:b.jsx(u,{className:tt("text-token-primary m-auto",a?"icon-md":"icon-lg")})})]})}function dg({title:n,onClick:t,isConfirming:e,onSubmit:i,isAnyItemConfirmed:s}){const r=Ct();return b.jsxs($.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:t,className:tt("flex-item my-1 flex min-w-40 cursor-pointer items-center overflow-hidden text-clip whitespace-nowrap rounded-2xl py-2 pl-4 pr-2 font-medium transition-colors hover:bg-gray-100/75 dark:hover:bg-gray-700",{"bg-gray-100/50 dark:bg-gray-700/50":e,"text-token-text-secondary hover:text-token-text-primary":!e&&s}),children:[b.jsx("div",{className:"flex-auto",children:r.formatMessage(n)}),b.jsx($.button,{className:tt("ml-3 h-6 w-6 rounded-full bg-black text-center dark:bg-white",{"pointer-events-none invisible":!e}),initial:{opacity:0,scale:.64},animate:{opacity:e?1:0,scale:e?1:.64},transition:{type:"spring",duration:.32,bounce:.14},onClick:i,children:b.jsx(rs,{className:tt("icon-sm h-6 w-6 text-white dark:text-black")})})]})}function gg({menu:n,onConfirm:t,onSubmit:e}){const[i,s]=v.useState(!1),r=n.map((o,l)=>b.jsx(dg,{title:o.title,isConfirming:i===l,isAnyItemConfirmed:i!==!1,onClick:()=>{s(l),t?.()},onSubmit:()=>{e?.(n[l].prompt)}},`menu-item-${o.title}`));return b.jsx("div",{className:"h-full flex-col content-center px-3",children:r})}const Os=288,Zr=120,mg=oo(()=>lo(()=>import("./iq632wi3g3rzig3o.js"),__vite__mapDeps([26,1,2,3])));function pg(n,t,e){if(e===t)return 1;const i=(n-t)/(e-t);return fo(i,0,1)}function bg({size:n,acceleratorScrubber:t,onConfirm:e,onCancel:i,onSubmit:s,onDragStart:r,isConfirming:o}){const{scrub:l,lottie:a,icon:c}=t,h=6,u=n-h*2,f=Ct(),d=v.useRef(null),g=v.useRef(null),[p,m]=v.useState(l?Math.floor(l.length/2):0),x=Math.round(p),y=v.useRef(p),S=l?f.formatMessage(l[x].title):null,w=v.useRef(null),k=sh(0);nh(k,"change",E=>{const O=-(Os-h)/2+u/2,X=(Os-h)/2-u/2,lt=pg(E,O,X)*(l?l.length-1:0);y.current=lt,m(lt)}),v.useEffect(()=>{let E;const O=()=>{if(!w.current||!y.current)return;const X=Math.round((1-y.current/(l?l.length-1:0))*Zr),ot=fo(X,0,Zr-1);w.current.goToAndStop(ot,!0),E=requestAnimationFrame(O)};return E=requestAnimationFrame(O),()=>cancelAnimationFrame(E)},[l]);const A=()=>{if(!l||l[x].isCancel||o)return i?.();l&&e?.()},P=()=>{!l||!o||s?.(l[x].prompt)};return b.jsx($.div,{ref:d,className:"start-items relative z-20 my-2 flex w-full",style:{height:Os-h},children:b.jsx($.div,{drag:"y",ref:g,dragConstraints:d,dragMomentum:!1,dragElastic:0,className:tt("m-auto rounded-full border border-token-border-light shadow-md transition-colors",o?"cursor-pointer bg-black dark:bg-white":"cursor-grab bg-token-main-surface-primary"),style:{y:k,width:u,height:u},onDragStart:r,onDragEnd:A,children:b.jsx(me,{delayDuration:0,open:!0,sideOffset:10,label:S,side:"right",children:b.jsx("div",{className:"flex h-full w-full items-start overflow-hidden",children:o?b.jsx(rs,{onClick:P,className:"icon-lg mx-auto h-10 w-10 translate-y-0.5 animate-pulsing text-white dark:text-black"}):a?b.jsx("div",{className:"m-auto",children:b.jsx(mg,{animationData:a,lottieRef:w,initialSegment:[0,120],loop:!1,autoplay:!1})}):b.jsx(c,{className:tt("text-token-primary icon-lg m-auto")})})})})})}const Vi=288,to=1250,xg=56,yg=32,wg=28;function vg({top:n}){return b.jsx($.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute left-1/2 m-auto h-1 w-1 -translate-x-1/2 rounded-full bg-gray-300",style:{top:n}})}function Sg({bottom:n=20,right:t=20,isEmbeddedInPromptArea:e=!1,disableHint:i=!1,disableOverlay:s=!1,onCancel:r,onExpandedChange:o,onSubmit:l,isRequestActive:a=!1,readonlyReason:c,actions:h}){const[u,f]=v.useState(!1),[d,g]=v.useState(!i&&!a),[p,m]=v.useState(!0),[x,y]=v.useState(null),[S,w]=v.useState(!1),[k,A]=v.useState(!1),[P,E]=v.useState(!1),[O,X]=v.useState(null),[ot,lt]=v.useState(null),xt=!p,{resolvedTheme:et}=ka(),_=et==="dark",J=e&&!d,D=J?yg:xg,qt=fg(),z=v.useRef(null),U=a||u,Xt=a&&!d&&p;v.useEffect(()=>{d&&!k&&A(!0),o?.(d)},[d,k]),v.useEffect(()=>{S&&!U&&!O&&(z.current!=null&&clearTimeout(z.current),g(!0)),!S&&!U&&!O&&(z.current!=null&&clearTimeout(z.current),z.current=window.setTimeout(()=>{g(!1),y(null),E(!1)},to))},[S,U,O,d]),v.useEffect(()=>{if(a){y(null);return}f(!1),!k&&!i&&(A(!0),g(!0),z.current!=null&&clearTimeout(z.current),z.current=window.setTimeout(()=>{g(!1),y(null),E(!1),A(!0)},to))},[a,i,k]);const le=F=>{y(F)},Jt=(F,nt)=>{w(!1),f(!0),g(!1),y(null),E(!1),X(null),lt(null);const mt=qt(),ve=(It,ce)=>{Mt.logButtonClick(Te.ACCELERATOR,{action:{action:nt.action,id:nt.id,title:nt.title,prompt:nt.prompt},prompt:F,sourceFrom:It,sourceTo:ce})};if(mt&&ng(mt)){const{state:It}=mt,{sourceFrom:ce,sourceTo:Ot}=sg(It);if(ve(ce,Ot),ce==null||Ot==null){l?.(null,F,nt);return}l?.({start:ce,end:Ot},F,nt);const Ci=It.tr.setSelection(Cc.create(It.doc,It.selection.anchor));mt.dispatch(Ci);return}ve(),l?.(null,F,nt)},kt=h[0],cs=h.slice(1),_t=!!ot&&h.find(({id:F})=>F===ot),yt=!!O&&h.find(({id:F})=>F===O),G=cs.map(F=>{if(!d)return null;const{scrub:nt,id:mt,prompt:ve,menu:It}=F;return b.jsx(Qr,{accelerator:F,isConfirming:mt===x,isCancelledScrubber:P,size:D,onClick:()=>{if(!xt){if(It)return lt(mt);if(nt)return X(mt);le(mt)}},onSubmit:()=>{xt||Jt(ve,F)}},mt)}),wt=v.useRef(null);v.useEffect(()=>{const{current:F}=wt;if(F)return Ds(document,{mousedown:({target:nt})=>{nt instanceof HTMLElement&&!F.contains(nt)&&(g(!1),y(null),E(!1),w(!1),X(null),lt(null))}})},[O,ot]);const ae=Math.round(Vi/D)*2,$e=[];let us=0;for(let F=0;F<ae-1;F++)us+=Vi/ae,$e.push(b.jsx(vg,{top:us}));const he=c?.isReadonly&&!c.isStreaming,ut=b.jsx($.div,{ref:wt,initial:{opacity:0,scale:.85,borderRadius:D/2},exit:{opacity:0,borderRadius:D/2},className:tt("absolute select-none overflow-visible border border-token-border-light transition-colors",mc.accelerators,{"pointer-events-none":he,"bg-token-main-surface-primary shadow-xl":d&&!O&&!a,"bg-token-main-surface-primary shadow-lg":!d&&!O&&!a,"border-transparent bg-token-main-surface-secondary":O&&!a,"bg-token-main-surface-primary":a&&!Xt,"!bg-black !text-white":!_&&Xt,"!bg-white !text-black":_&&Xt}),style:{right:t,bottom:n},animate:{scale:U||Xt||u?.85:1,opacity:he?0:1,borderRadius:ot&&_t&&!U?wg:D/2},onHoverStart:()=>{z.current!=null&&clearTimeout(z.current),w(!0)},onHoverEnd:()=>w(!1),children:b.jsx(Ui,{children:ot&&_t&&_t.menu&&!U?b.jsx($.div,{initial:{height:D,width:D},transition:Ie,animate:{height:Vi,width:"auto"},exit:{height:D,width:D},children:b.jsx(gg,{isConfirming:x===_t.id,onConfirm:()=>le(_t.id),onSubmit:F=>Jt(F,_t),menu:_t.menu})}):O&&yt&&!U?b.jsxs($.div,{initial:{height:D,width:D},transition:Ie,animate:{height:Vi,width:D},exit:{height:D,width:D},onClick:()=>{y(null)},children:[b.jsx(bg,{onDragStart:()=>y(null),isConfirming:x===yt.id,onConfirm:()=>le(yt.id),onSubmit:F=>Jt(F,yt),onCancel:()=>{X(null),E(!0)},size:D,acceleratorScrubber:yt}),$e]}):b.jsxs($.div,{className:"flex flex-col",initial:e?!1:{height:D,width:D},transition:Ie,animate:{height:d?D*h.length:D,width:D},exit:{height:D,width:D},onAnimationComplete:()=>m(!0),onAnimationStart:()=>m(!1),children:[b.jsx(Ui,{children:G}),b.jsx("div",{className:"flex items-center",style:{width:D,height:D},children:U?Xt?b.jsx(Xl,{title:Cg.cancel,icon:b.jsx(oc,{className:tt("m-auto shrink-0 animate-pulsing",J?"h-6 w-6":"h-10 w-10")}),isSmall:J,opacity:1,size:D,onClick:()=>{y(null),r?.()}}):b.jsx(go,{size:20,className:"m-auto text-token-text-secondary"}):b.jsx(Qr,{disableHeightAnimation:e,disableLabel:pi()||!d,isCancelledScrubber:P,accelerator:kt,isConfirming:x===kt.id,opacity:d?void 0:1,isSmall:J,size:D,onSubmit:()=>{xt||Jt(kt.prompt,kt)},onClick:()=>{if(!xt){if(!S){w(!0);return}if(kt.menu)return lt(kt.id);if(kt.scrub)return X(kt.id);le(kt.id)}}})})]})})});return s||pi()?ut:b.jsxs(b.Fragment,{children:[d&&b.jsx(yo,{zIndexKey:"acceleratorsOverlay",className:"bg-white/95 dark:bg-black/85"}),ut]})}const Cg=we({cancel:{id:"Hov840",defaultMessage:"Cancel"}}),kg={type:"spring",damping:35,stiffness:300},Mg=({clientThreadId:n,turn:t})=>{const e=Ma(),i=rh(),s=oh(t.messages);return b.jsxs($.div,{className:"absolute left-0 right-0 top-0 z-10 -translate-y-full",children:[b.jsx($.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:tt("absolute inset-0 -top-5",i?"bg-gradient-to-t from-token-main-surface-primary to-transparent":"bg-vert-light-gradient")}),b.jsx($.div,{className:"flex items-center py-2",initial:{opacity:.75,translateX:-50,translateY:"100%"},animate:{opacity:1,translateX:0,translateY:"0"},exit:{opacity:0,translateY:20},transition:kg,children:b.jsx(kc,{clientThreadId:n,onChangeItemInView:Ue,onRequestCompletion:async r=>Ue(r),onRequestMoreCompletions:Ue,groupedMessagesToRender:s,allGroupedMessages:s,isEditing:!1,isUserTurn:!0,turnIndex:0,isCompletionRequestInProgress:!1,isFeedbackEnabled:!1,isFinalTurn:!1,hasActiveRequest:e,showEditButton:!1,handleEnterEdit:Ue,handleExitEdit:Ue})})]},"user-message")},Ag=({clientThreadId:n})=>{const t=Aa(n),e=Ta(n,t),{lastUserTurn:i,lastAssistantTurn:s}=v.useMemo(()=>{let o=null,l=null;for(let a=e.length-1;a>0;a--){const c=e[a];if(!o&&c.role===Rs.User?o=c:!l&&c.role===Rs.Assistant&&(l=c),o&&l)break}return{lastUserTurn:o,lastAssistantTurn:l}},[e]),r=i&&!s?.messages.find(({message:o})=>o.recipient?.startsWith(Ea));return b.jsx(Ui,{initial:!1,children:r&&b.jsx(Mg,{turn:i,clientThreadId:n})})},Tg=({isRequestActive:n=!1,clientThreadId:t,readonlyReason:e,onCancel:i,onSubmit:s,onSubmitAccelerator:r,acceleratorActions:o=[]})=>{const[l,a]=v.useState(!1),[c,h]=v.useState(""),[u,f]=v.useState(!0),d=Ct(),[g,p]=v.useState(!1),m=pi(),x=()=>{s?.(c),h("")},y=S=>{const{metaKey:w,shiftKey:k,key:A}=S;A==="Enter"&&c.trim()&&!(k||w)&&(x(),S.preventDefault())};return b.jsxs(b.Fragment,{children:[l&&!m&&b.jsx(yo,{zIndexKey:"acceleratorsOverlay",className:"bg-white/95 dark:bg-black/85"}),b.jsx("div",{className:"relative mb-3 flex items-end justify-center",children:b.jsxs("div",{className:"relative mx-6 max-w-2xl flex-1",children:[b.jsx(Ag,{clientThreadId:t}),b.jsx("div",{className:"flex flex-auto items-start",children:b.jsx("div",{className:tt("flex min-h-12 flex-auto items-center bg-[#f4f4f4] py-1 pl-6 pr-2 dark:bg-token-main-surface-secondary",{"rounded-full":u,"rounded-2xl":!u,"bg-transparent":g}),children:b.jsxs("div",{className:"relative flex flex-auto items-center self-stretch",children:[b.jsx(Mc,{placeholder:d.formatMessage({id:"zrUbTJ",defaultMessage:"Ask ChatGPT to edit"}),disabled:n,value:c,className:tt("w-full resize-none border-0 bg-transparent p-0 text-token-text-primary outline-0 placeholder:text-token-text-secondary focus:ring-0 focus-visible:ring-0",{"opacity-0":g}),maxRows:4,onChange:({target:{value:S}})=>h(S),onKeyDown:y,onHeightChange:(S,{rowHeight:w})=>f(Math.floor(S/w)<=1)}),c?b.jsx($.button,{className:tt("dark h-8 w-8 rounded-full bg-token-main-surface-primary text-center disabled:bg-[#D7D7D7]",{"self-end":!u}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:()=>x(),children:b.jsx(rs,{className:"h-8 w-8 text-token-text-primary"})}):(o?.length??0)>0&&b.jsx(Sg,{disableHint:!0,readonlyReason:e,disableOverlay:!0,isEmbeddedInPromptArea:!0,isRequestActive:n,actions:o,onCancel:i,onExpandedChange:S=>{m||p(S),a(S)},onSubmit:r,right:0,bottom:4})]})})})]})})]})};function Eg(n,t){const e=new Set(n.map(l=>l.id)),i=new Set(t.map(l=>l.id)),s=n.filter(l=>!i.has(l.id)).map(l=>({...l,diffStatus:Ns.REMOVED})),r=t.filter(l=>!e.has(l.id)).map(l=>({...l,diffStatus:Ns.ADDED})),o=n.filter(l=>i.has(l.id));return s.concat(r,o)}function Og({textdocVersion:n,clientThreadId:t}){const e=Ct(),i=Oa(),[s,r]=v.useState(!1),o=Da(),l=lh(h=>n&&h?.lastCanvasAssistantMessageById[n.textdocId]),a=v.useRef(n?.content??"");v.useEffect(()=>{a.current=n?.content??""},[n]);const c=h=>{s||(o(()=>{const u=Ps.getServerThreadId(t);n!=null&&u!=null&&l!=null&&Ra.submitImplicitMessageFeedback({type:"copy",source:"mouse",location:"canvas",selectedText:a.current,messageId:l,serverThreadId:u}),Mt.logButtonClick(Te.COPY,{contentLength:a.current.length,textdocType:n?.type}),ah(a.current,i,h)},0),r(!0),o(()=>r(!1),2e3))};return b.jsx(me,{label:e.formatMessage(Dg.copy),children:b.jsx(Gi,{icon:s?lc:ac,onClick:c})})}const Dg=we({copy:{id:"rbIYfo",defaultMessage:"Copy"}});function Rg({disabled:n=!1,isShowingChanges:t,onMouseEnter:e,onClick:i,onEsc:s}){const r=Ct(),o=v.useRef(null);return v.useEffect(()=>{if(t){const l=a=>{a.key==="Escape"&&(s?.(),o.current&&o.current===document.activeElement&&o.current.blur())};return window.document.addEventListener("keydown",l),()=>{window.document.removeEventListener("keydown",l)}}},[t,s]),b.jsx(me,{label:!n&&r.formatMessage(t?eo.hideChanges:eo.showChanges),children:b.jsx(Gi,{icon:hc,ref:o,disabled:n,onClick:i,onMouseEnter:e,className:tt("transition-colors",t&&pc)})})}const eo=we({showChanges:{id:"3jMGNS",defaultMessage:"Show changes"},hideChanges:{id:"HWiQSk",defaultMessage:"Hide changes"}});function Pg({disabled:n=!1,hasPreviousVersion:t,hasNextVersion:e,isShowingChanges:i,onHoverPrevious:s,onHoverShowChanges:r,onToggleShowChanges:o,onClickPrevious:l,onClickNext:a}){const c=wn(),h=Ct();return b.jsxs("div",{className:tt("flex items-center",c?"gap-1":"gap-1.5"),children:[b.jsx(Rg,{disabled:n||!t,isShowingChanges:i,onMouseEnter:r,onClick:o,onEsc:o}),b.jsx(me,{label:t&&h.formatMessage({id:"PoD5+8",defaultMessage:"Previous version"}),children:b.jsx(Gi,{disabled:n||!t,icon:cc,onMouseOver:s,onClick:l})}),b.jsx(me,{label:e&&h.formatMessage({id:"PJ8YVJ",defaultMessage:"Next version"}),children:b.jsx(Gi,{disabled:n||!e,icon:uc,onClick:a})})]})}const Ng=({clientThreadId:n,isHistoricalVersion:t,textdocVersion:e,readonlyReason:i,hasDebug:s,isEmbedded:r,isPersisting:o,isShowingChanges:l,hideHistoryActions:a=!1,onHoverPrevious:c,onHoverShowChanges:h,onToggleShowChanges:u,onClickPrevious:f,onClickNext:d,setShowDebugView:g,onClickCodePreview:p,onClose:m,isShowingCodePreview:x})=>{const y=wn(),S=hh(e?.title??""),w=mo(),k=po();e==null||yn(e.type,e.content)&&w||Pn(e.type);const A=tt("transition-opacity duration-500",i.isStreaming&&"pointer-events-none opacity-0"),P=e?.versionInt,E=P!=null&&P>1,O=t,X=!a&&(E||O);return b.jsxs(Ee.Header,{className:"@container",children:[b.jsxs("div",{className:"flex flex-1 items-center gap-1 truncate leading-[0] @container",children:[!y&&b.jsx(Ee.CloseButton,{onClick:m}),b.jsx(Ee.Title,{className:"@[0px]:hidden @[150px]:block",children:S||b.jsx("div",{className:"w-52",children:b.jsx(Tc,{lines:1,size:"base",width:100,widthVariance:0})})}),o&&b.jsx(go,{size:12,className:"pl-2 text-token-text-secondary"})]}),b.jsxs("div",{className:tt("flex select-none items-center leading-[0]",y?"gap-1":"gap-2"),children:[X&&b.jsx("div",{className:A,children:b.jsx(Pg,{disabled:i.isStreaming,hasNextVersion:O,hasPreviousVersion:E,isShowingChanges:l,onHoverPrevious:c,onHoverShowChanges:h,onToggleShowChanges:u,onClickPrevious:f,onClickNext:d})}),b.jsx(Og,{clientThreadId:n,textdocVersion:e}),!1,!1,!y&&!r&&b.jsx(Ac,{}),y&&b.jsx(Ee.CloseButton,{onClick:m})]})]})},Lg=/\s/,Ig=30;function io(n,t){const e=n.indexOf(t);return e===-1?!1:n.indexOf(t,e+t.length)===-1}function se(n,t){return Lg.test(n[t])}function so(n,t,e=!1){if(t===0||e&&se(n,t-1))return t;for(;t>0&&se(n,t-1);)t--;for(;t>0&&!se(n,t-1);)t--;return se(n,t)&&t++,t}function no(n,t,e=!1){if(t===n.length||e&&se(n,t))return t;for(;t<n.length&&se(n,t);)t++;for(;t<n.length&&!se(n,t);)t++;return se(n,t-1)&&t--,t}function Bg(n,t,e=!0,i=Ig){if(n.start<0||n.end>t.length||n.start>n.end)throw new Error("Invalid commentSourceRange provided.");const s=t.substring(n.start,n.end);let r=n.start,o=n.end;e&&(r=so(t,r,!0),o=no(t,o,!0));let l=t.substring(r,n.start),a=t.substring(n.end,o),c=`${l}${s}${a}`;if(io(t,c)&&(i==null||c.length>=i))return{before:l,after:a,allSurrounding:c};let h=r,u=o,f=!0;for(;f&&(i==null||c.length<i);){let d=!1;const g=h>0?so(t,h):h;g<h&&(h=g,d=!0);const p=u<t.length?no(t,u):u;if(p>u&&(u=p,d=!0),d){const m=t.substring(h,n.start),x=t.substring(n.end,u),y=`${m}${s}${x}`;if(io(t,y)&&(i==null||y.length>=i))return{before:m,after:x,allSurrounding:y};l=m,a=x,c=y}else f=!1}return{before:l,after:a,allSurrounding:c}}const bi="# Context",xi="# Instructions";function yi(n,t,e){if(t==null||e==null)return`The user is referring to the entire text of "${n}".`;const i=`
## Selected Text
The user has selected this text in "${n}" in particular:
${t}
`.trim();return e.allSurrounding===t?i:`
${i}

## Surrounding Context
Here is the surrounding context:
${e.allSurrounding}
`.trim()}function Jl(n,t){return n==null||t==null?"entire document":n===t.allSurrounding?"selected text":"surrounding context"}function Ql(n){return`For the update pattern, create a regex which exactly matches the ${n}. Edit just this string in order to fullfill the user's request. NEVER rewrite the entire document. Instead, ALWAYS edit ONLY the ${n}. The only exception to this rule is if the ${n} includes markdown lists or tables. In that case, fully rewrite the document using ".*" as the regex update pattern.`.trim()}function Hg(n,t,e,i){if(!ge(t)&&e&&i){const s=Jl(e,i);return`
${bi}
The user requests that you directly edit the document.

${yi(n,e,i)}

${xi}
Use the update_textdoc tool to make this edit. ${Ql(s)}`.trim()}return`
${bi}
The user requests that you directly edit the document.

${yi(n,e,i)}

${xi}
Use the update_textdoc tool to make this edit. You MUST fully rewrite the entire document by using ".*" as the update regex pattern.`.trim()}function Vg(n,t,e){return`
${bi}
The user requests that you add comments about some text.

${yi(n,t,e)}

${xi}
Do not respond to the user's question directly, just leave comments.`.trim()}function Fg(n,t){return ge(n)?t==="entire document"?` If you choose to update the ${t}, you MUST fully rewrite the ${t} by using ".*" as the update regex pattern.`:` If you choose to update the ${t}, you MUST fully rewrite the entire document by using ".*" as the update regex pattern. When you do so, ONLY modify the ${t} and rewrite other sections exactly as is, except for parts that must change based on this update`:t==="entire document"?"":` If you choose to update the ${t}, follow these instructions: ${Ql(t)}`}function jg(n,t,e,i){const s=Jl(e,i),r=Fg(t,s);return`
${bi}
${yi(n,e,i)}

${xi}
The user would like you perform one of the following actions:
- Update the ${s} via the \`update_textdoc\` tool.${r}
- Explain the selected text via chat, or answer a general question about the selected text (no tool call required).
- Comment on the ${s} with feedback via the \`comment_textdoc\` tool. This should only be used if the user very explicitly asks for feedback, critique, or comments.

Based on the user's request, choose the appropriate action.
`.trim()}function Wg(n,t,e){return`
${bi}
${yi(n,t,e)}

${xi}
The user would like you to create a new textdoc.
`.trim()}function qg(n,t,e,i=null,s=null){switch(e){case st.ASK:return jg(n,t,i,s);case st.CREATE_TEXTDOC:return Wg(n,i,s);case st.EDIT:return Hg(n,t,i,s);case st.COMMENT:return Vg(n,i,s)}}function _g(n){switch(n){case ft.ACCELERATOR:case ft.CONSOLE:case ft.ACCEPT_COMMENT:return!0;case ft.ASK_CHATGPT:case ft.FULL_SCREEN_SUBMIT:return!1}}function zg(n,t){switch(t){case ft.ASK_CHATGPT:case ft.ACCEPT_COMMENT:case ft.FULL_SCREEN_SUBMIT:return n.formatMessage(Kg.askChatGPT);case ft.ACCELERATOR:case ft.CONSOLE:return}}const $g=(n,t)=>{const e=Ct(),{tags:i}=ch(n),s=uh(),r=fh(n),o=dh(n)??s.id,l=gh({clientThreadId:n}),a=ao();return v.useCallback(async({content:c,sourceRange:h,action:u,userMessageType:f,acceleratorMetadata:d,selectionMetadata:g})=>{if(t?.versionInt==null||a)return;const{textdocId:p,type:m,versionInt:x,content:y}=t;let S,w=null;h&&h.start!==h.end&&(S=y.slice(h.start,h.end),w=Bg(h,y));const k=qg(p,m,u,S,w),P=Pa(k,{exclude_after_next_user_message:!0}),E=performance.now(),O=await Na(),[X,ot,lt]=await Promise.all([La.getEnforcementToken(O),mh.getEnforcementToken(O),Ia.getEnforcementToken(O)]),xt=new ph,et=Ps.getThreadCurrentLeafId(n),_=`${et}-nextPrompt`;Ps.updateTree(n,J=>{J.addNode(_,c,et,Rs.User,void 0,{canvas:{textdoc_id:p,textdoc_type:m,version:x,textdoc_content_length:y.length,user_message_type:f,accelerator_metadata:d,selection_metadata:g},is_visually_hidden_from_conversation:_g(f),targeted_reply:S,targeted_reply_label:zg(e,f),open_in_canvas_view:{type:"canvas_textdoc",id:p}})}),l({model:o,completionType:Ba.Next,parentNodeId:_,metadata:{eventSource:"mouse"},completionMetadata:r?{conversationMode:r}:void 0,chatReq:O,arkoseToken:X??null,turnstileToken:ot??null,proofToken:lt??null,preflightTime:performance.now()-E,appendMessages:[P],turnTracker:xt})},[t,a,i,n,l,o,r,e])},Kg=we({askChatGPT:{id:"h5ANdM",defaultMessage:"Asked ChatGPT"}});function Ug(n){const t=/\[([^\]]+)\]\((https?:\/\/[^\s)]+|www\.[^\s)]+)\)/gi,e=new Set,i=n.matchAll(t);for(const s of i){const r=s[2];try{let o=r;o.startsWith("www.")&&(o="http://"+r),new URL(o),e.add(r)}catch{}}return e}const Gg=async({lastVersion:n,textdocId:t,content:e,comments:i})=>{const s=bh(i,e);return(await ho.safePost("/textdoc/{textdoc_id}",{parameters:{path:{textdoc_id:t}},requestBody:{version:n,content:e,comments:s}})).version},Yg=()=>{const n=v.useRef([]),t=v.useRef(null),{mutateAsync:e,isPending:i}=Ha({mutationKey:["canvas","textdoc","persist"],mutationFn:Gg});return[v.useCallback(async(r,o,l)=>{const a=new AbortController,h=(async()=>{const[g]=n.current;try{await g?.promise}catch(p){Mt.logError("Saving document",p)}if(!a.signal.aborted)try{const p=Math.max(t.current??0,r.versionInt??bo);let m="";try{_n(o)?m=o():m=o}catch(w){Mt.logError("Serializing document",w)}let x=[];try{_n(l)?x=l():x=l}catch(w){Mt.logError("Adjusting comments",w)}const{textdocId:y}=r;xh({textdocId:y,basedOnVersionInt:p,content:m,comments:x});const S=await e({textdocId:y,lastVersion:p,content:m,comments:x});yh({textdocId:y,basedOnVersionInt:p,newVersion:S}),t.current=S}catch(p){Mt.logError("Error saving document",p)}finally{n.current.shift()}})(),u={abort:()=>a.abort(),promise:h},[f,d]=n.current;return d&&(d.abort(),n.current=f?[f]:[]),n.current=f?[f,u]:[u],h},[e]),n,i]},Xg=3e3,Jg=n=>{const[t,e,i]=Yg(),s=Ct(),r=v.useRef(null),o=v.useCallback(wh(t,Xg,{leading:!1}),[t]),l=vh(n);return v.useEffect(()=>{if(!l)return;const c=Ds(window,{pagehide:()=>o.flush(),beforeunload:u=>{o.flush(),u.returnValue=s.formatMessage({id:"QZrKwi",defaultMessage:"You have a canvas save in progress."})}}),h=Ds(document,{visibilitychange:()=>o.flush(),keydown:()=>{r.current="keyboard"},mousemove:()=>{r.current!=="mouse"&&o.flush(),r.current="mouse"}});return()=>{r.current=null,h(),c()}},[s,l,o]),v.useEffect(()=>()=>{o.flush()},[n,o]),Sh(async()=>{await o.flush(),await Promise.allSettled(e.current?.map(({promise:c})=>c)??[])}),[v.useCallback((c,h,u)=>{const{textdocId:f}=c;return Ch(f),o(c,h,u)},[o]),o.flush,i||l]};function Qg(n,t,e){const i=co(),s=e!=null&&t!=null,{data:r,error:o,fetchNextPage:l,hasNextPage:a,isFetching:c}=Va(ro(n,t,s)),h=v.useCallback(async()=>{const p=t!=null;await i.prefetchInfiniteQuery(ro(n,t,p))},[i,n,t]);v.useEffect(()=>{const p=t;return()=>{i.removeQueries({queryKey:Zl(n,p),exact:!0})}},[i,n,t]);const[u,f,d,g]=v.useMemo(()=>{if(r&&e){const m=r.pages.flatMap(y=>y),x=m.findIndex(y=>"beforeVersion"in e?(y.versionInt??bo)<e.beforeVersion:y.versionInt===e.version);if(x!==-1)return[x===m.length-1,m[x],x>0?m[x-1]:null,x<m.length-1?m[x+1]:null]}const p=r?.pages.flatMap(m=>m)??[];return[!0,null,null,p.length===0?null:p[0]]},[r,e]);return v.useEffect(()=>{!c&&s&&a&&u&&l()},[c,s,a,u,l]),v.useEffect(()=>{!f&&o&&Je(n)},[f,o,n]),{historicalTextdocVersion:f,nextHistoricalTextdocVersion:d,prefetchHistoricalTextdocVersion:h,previousHistoricalTextdocVersion:g}}function Zl(n,t=null){return["textdocHistory",n,t]}function ro(n,t,e=!0){return{queryKey:Zl(n,t),queryFn:({pageParam:i})=>Zg(n,i),initialPageParam:t??void 0,getNextPageParam:i=>{const s=Fa(i)?.versionInt;if(s&&s>1)return s},enabled:e,staleTime:1/0,retry:2}}async function Zg(n,t){return t===void 0?[]:(await ho.safeGet("/textdoc/{textdoc_id}/history",{parameters:{path:{textdoc_id:n},query:{before_version:t}}})).previous_doc_states.map(({id:i,version:s,textdoc_type:r,title:o,content:l,updated_at:a,comments:c})=>({textdocId:i,versionInt:s,messageId:null,title:o,type:kh(r),content:l,status:Mh.COMPLETE,createdAt:Ah(a),comments:Th(c,l)}))}const Lm=({isFullScreen:n=!1,isEmbedded:t=!1,hideHeader:e=!1,isReadonlyFromQueryParam:i=!1,clientThreadId:s,focusedTextdoc:r,onClose:o,isAnimating:l=!1,width:a,hideBottomComposer:c=!1})=>{const{textdocId:h,history:u,showChangesAtVersion:f=null}=r,d=mo(),[g,p,m]=Jg(h),{targetedContent:x}=Eh(),y=Oh(),[S,w]=v.useState(!1),k=Dh(h),A=Rh(),P=ja(s),E=Wa(P),{data:O,isLoading:X}=Ph(h,f),[ot,lt]=v.useState(!1),xt=Ec(s),et=ao()||xt,_=k?.versions??[],J=_[0]?.versionInt,{historicalTextdocVersion:D,nextHistoricalTextdocVersion:qt,previousHistoricalTextdocVersion:z,prefetchHistoricalTextdocVersion:U}=Qg(h,J,u),Xt=Nh();v.useEffect(()=>{pe.reset()},[h]);const le=_.length>0?_[_.length-1]:null,Jt=_.length>1?_[_.length-2]:null,kt=qa(s),{restoreHistoricalTextdocVersion:cs,optimisticRestoredTextdocVersion:_t}=Lh(kt,le,D),yt=u!=null,G=yt?D:le,wt=f!=null,ae=$g(s,G),$e=l?null:O,he=(()=>{if(l||G==null)return[];const j=Xr(G.comments);return!wt&&D!=null?D.comments:!wt||O==null?j:O.contentBefore!==O.contentAfter?[]:Eg(O.commentsBefore,O.commentsAfter)})(),ut=G?.type??jt.LOADING,F=Ih(),nt=Bh(G),mt=Hh(G),ve=Vh(G)&&!t,It=Kn(A),ce=Kn(E);v.useEffect(()=>{_.length===0&&(!A&&It||!E&&ce||!A&&!E)&&o?.()},[_.length,A,E]);const{content:Ot,currentlyStreamingLineIndex:Ci}=O?.contentBefore!=null&&!ge(ut)?{content:O.contentBefore,currentlyStreamingLineIndex:null}:bc(G,Jt),ta=Oc(kt,Array.from(Ug(Ot))),[ki,fs]=Vd({value:Ot,isRequestActive:E,isTextdocStreaming:nt,comments:he}),Nn=Fh(G),Ln=F===jh.LAST_TURN||ki||m;v.useEffect(()=>{Wh().sendMessage({type:wo.Streaming,streaming:Ln})},[Ln]);const ea=({getSerializedDocument:j,getAdjustedComments:pt})=>{G&&g(G,j,pt)},ia=j=>{if(!G)return;const pt=j.doc.toString();g(G,pt,j.field(es,!1)??[])},In=(j,pt,Qt,Se)=>{fs(!0),ae({action:pt,content:j,userMessageType:ft.ASK_CHATGPT,sourceRange:Qt,selectionMetadata:{selection_type:Se,selection_position_range:Qt}})},Bn=({id:j})=>{Nn(j,zn.DISMISS),pe.reset()},Hn=async j=>{fs(!0);const{id:pt,at:Qt,content:Se}=j;if(await Nn(pt,zn.ACCEPT)===!1)return fs(!1);ae({content:Se,userMessageType:ft.ACCEPT_COMMENT,sourceRange:Qt,action:st.EDIT,selectionMetadata:{selection_type:Ls.SELECTION,selection_position_range:Qt}})},ds=(j,pt,Qt)=>{const{action:Se}=Qt;ae({action:Se,content:pt,sourceRange:j,userMessageType:ft.ACCELERATOR,acceleratorMetadata:{action:Se,id:Qt.id,prompt:pt},selectionMetadata:j!=null?{selection_type:Ls.SELECTION,selection_position_range:j}:void 0})},sa=j=>{ae({action:st.EDIT,content:j,userMessageType:ft.FULL_SCREEN_SUBMIT})},na=_a(),ra=co(),oa=qh(),Vn=j=>oa?.[j]??j,gs=()=>zh({clientThreadId:s,currentRequestId:P,queryClient:ra,isHistoryAndTrainingDisabled:na}),la=()=>{u?Ai(h,u):Je(h)},Dt=wc({isRestoring:_t!=null,isStreaming:E||nt,isReadonlyFromQueryParam:i,isHistoricalVersion:yt,isShowingChanges:wt});let Ke=null;const Fn=l||Dt.isReadonly||ki,jn=()=>l&&he.length>0?Ce.ALL_HIDDEN:et?Ce.COMMENTS_READONLY:Dt.isReadonly?Dt.isStreaming?Ce.ENABLED:Dt.isReadonlyFromQueryParam||Dt.isShowingChanges||Dt.isHistoricalVersion?Ce.COMMENTS_READONLY:Ce.ALL_HIDDEN:Ce.ENABLED,Wn=n||l||i||et;let ms=[];switch(ut){case jt.LOADING:Ke=b.jsx(vc,{isPreview:!n});break;case jt.DOCUMENT:Ke=b.jsx(yc,{value:Ot,comments:he,previousValue:Jt?.content,previousComments:Xr(Jt?.comments),isRewriting:mt,isAnimatingFromPreview:l,isSendDisabled:et,getStableCommentId:Vn,diff:$e,isPreview:!n,isRequestActive:E,isDisabled:Dt.isReadonly||A,isWaitingForCommentResponse:ki,hideAccelerators:Wn,hideToolbar:Fn,hideEditOverlay:l,commentsMode:jn(),readonlyReason:Dt,onBlur:p,onSave:p,onChange:ea,onCancelRequest:gs,targetedContent:x,onAddComment:In,onAcceptComment:Hn,onDismissComment:Bn,onSubmitAccelerator:ds,onExitShowChanges:la,safeUrls:ta,width:a,modelCursor:nt&&!mt?G?.modelCursor:void 0,shouldResetSelection:G?.versionInt===1}),ms=Zd;break;default:if(ge(ut)){const j=yn(ut,Ot),pt=b.jsx(xc,{id:"codemirror",getStableCommentId:Vn,language:xo(ut),value:Ot,comments:he,hideAccelerators:Wn,commentsMode:jn(),hideToolbar:Fn,onSubmitAccelerator:ds,currentlyStreamingLineIndex:Ci??null,readonlyReason:Dt,isRequestActive:E,isSendDisabled:et,isWaitingForCommentResponse:ki,onChange:ia,onCancelRequest:gs,onAddComment:In,onDismissComment:Bn,onAcceptComment:Hn,textdocDiff:$e??void 0,modelCursor:nt&&Ci==null?G?.modelCursor:void 0});Ke=!d||!j?pt:b.jsxs(b.Fragment,{children:[b.jsx("div",{style:{display:ot?"none":"block"},children:pt}),!1]}),ms=Ld}}const aa=v.useRef(null);po()&&!yt&&Pn(ut);const ha=()=>{yn(ut,Ot)?lt(j=>!j):aa.current?.runCode(ut,Ot)},{eligible:ca,markAsViewed:ua}=_h(),qn=wn(),Rt=G?.versionInt,fa=Rt!=null&&Rt>1,da=yt,Mi=z?.versionInt,ps=qt?.versionInt,ga=()=>{wt?u?Ai(h,u):Je(h):(Mt.logButtonClick(Te.SHOW_CHANGES,{textdocType:ut,textdocId:h,versionInt:Rt,latestVersionInt:J}),Rt&&$n(h,Rt,u))},ma=()=>{Mt.logButtonClick(Te.HISTORY_PREVIOUS,{textdocType:ut,textdocId:h,versionInt:Rt,latestVersionInt:J,isShowingChanges:wt}),h&&Rt&&fa&&Ai(h,{beforeVersion:Rt},wt&&Mi!=null?Mi:void 0)},pa=()=>{Mt.logButtonClick(Te.HISTORY_NEXT,{textdocType:ut,textdocId:h,versionInt:Rt,latestVersionInt:J,isShowingChanges:wt}),da&&(ps?Ai(h,{version:ps},wt?ps:void 0):wt&&J?$n(h,J,null):Je(h))},bs=!e&&b.jsx(Ng,{clientThreadId:s,isHistoricalVersion:yt,textdocVersion:G,readonlyReason:Dt,hasDebug:y,isEmbedded:t,isPersisting:m,isShowingChanges:wt,hideHistoryActions:i,onHoverPrevious:()=>{U(),Mi&&Xt(h,Mi)},onHoverShowChanges:()=>{U(),Rt&&Xt(h,Rt)},onToggleShowChanges:ga,onClickPrevious:ma,onClickNext:pa,setShowDebugView:w,onClose:()=>{Mt.logButtonClick(Te.CLOSE_TEXTDOC,{textdocType:G?.type}),ua(),o?.()},onClickCodePreview:ha,isShowingCodePreview:ot});return b.jsxs(Ee,{children:[!qn&&bs,b.jsx(Ee.Content,{scrollToBottomMode:ve?"bottom":"top",shouldScrollToTop:mt,isLoading:X,children:qn&&bs?b.jsxs(b.Fragment,{children:[bs,b.jsx("div",{className:"h-[calc(100%-var(--screen-thread-header-min-height,60px))]",children:Ke})]}):Ke}),!1,b.jsx(Ui,{children:yt&&!i&&b.jsx(Fd,{onClickRestore:cs,onClickResetLatest:()=>Je(h)})}),n&&!yt&&!c&&!et&&b.jsx(Tg,{isRequestActive:E,clientThreadId:s,onSubmitAccelerator:ds,onSubmit:sa,onCancel:gs,readonlyReason:Dt,acceleratorActions:ms}),!l&&!t&&ca&&b.jsx(Bc,{textdocType:ut})]})};export{ag as $,_e as A,Bd as B,wo as C,I as D,R as E,T as F,oe as G,Id as H,vm as I,Mm as J,Am as K,ls as L,St as M,Md as N,mm as O,Cn as P,_l as Q,N as R,Et as S,Lm as T,Ad as U,Nt as V,ze as W,Td as X,rg as Y,og as Z,lg as _,M as a,Dm as a0,Rm as a1,Uc as a2,Sg as a3,Ld as a4,fg as a5,Ls as a6,pe as a7,ng as a8,Om as a9,Tm as aa,ns as ab,Hc as ac,Kc as ad,$c as ae,ug as af,Nm as ag,st as ah,eg as ai,xm as aj,ig as ak,tg as al,Em as am,hg as an,cg as ao,Pm as ap,sg as aq,Zd as ar,Z as b,q as c,K as d,kn as e,uu as f,Cm as g,Fe as h,ui as i,Is as j,si as k,$t as l,zt as m,L as n,ct as o,qf as p,Ve as q,pm as r,Sm as s,pd as t,it as u,Kt as v,Wt as w,ym as x,wm as y,km as z};
//# sourceMappingURL=guenb420pv5dwucd.js.map
