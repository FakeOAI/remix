import{gZ as S,bH as N,r as l,m as i,aC as q,aD as P,aA as Y,f9 as $,e1 as K,l as X,f as Z,T as _,e$ as J,bE as W,g5 as Q,aE as ee,g_ as te}from"./dkrkpapzk8i632go.js";import{fu as se,fv as ae,C as g,fw as oe,fx as ne,fy as ie,fz as re,fA as ce,fB as de,bI as le,fC as ue,fD as fe,fE as O,b7 as he,c0 as j,fF as pe,fG as me,u as xe,fH as ge,fI as R,U as D,aC as ve,b5 as M}from"./fnh1ee9l40s79ybh.js";import{s as Ce,g as be,u as we}from"./fyiicr2pxo20g0xa.js";import{L as ye}from"./gus5ys87ebe3yyy0.js";import{u as Te}from"./gvz14qf5woeu83oi.js";import{T as Se}from"./kgzzu4tf7u5313rd.js";import{m as x}from"./ey5apunl1vnvf9g5.js";import"./fow2c4yq3c8klomi.js";import"./jqqo55reqowwgoc4.js";import"./kdmay48w4tjzal97.js";import"./iagw21vtml2xbtg6.js";import"./cb4up3wxp9co5lzh.js";import"./dkptqlxvdk2bhhas.js";import"./l0w8th2xkt507fp5.js";import"./fzrn137102spawew.js";import"./lebsyc66aja9e6ew.js";import"./dgwshraa8ui7irnp.js";import"./kuia0na4bz0zmvoq.js";import"./m8dgj9xaftrqw1zi.js";const F="oai/apps/canmoreSidebarWidth",Ie=.25,Ee=400,k=400;function L(e){return e-Ee}function y(e,n){return ae(k,L(e),n??Ie*e)}function Ae(){const e=S.useState(S.selectWindowWidth),n=y(e,se(N.DANGER_SECRET_FOLDERS_ONLY_getItem(F))),s=H(),[t,r]=l.useState(n);l.useEffect(()=>{(t<k||t>L(e))&&r(y(e,t))},[e]);function a(h){r(p=>y(e,p+=h.delta.x))}function c(h){r(h),N.DANGER_SECRET_FOLDERS_ONLY_setItem(F,h)}function u(){const h=y(e,void 0);c(h)}const o=`calc(100vw - ${t}px)`;return s?{chatWidth:t,canvasWidth:e-t,canvasWidthCalc:o,viewportWidth:e,handleDrag:a,handleDoubleClick:u,persist:c}:{chatWidth:0,canvasWidth:e,canvasWidthCalc:"100vw",viewportWidth:e,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function H(){return S.useState(e=>S.selectWindowWidth(e)>1e3)}function Ne(e,n){let s;return n?.type===g.Textdoc&&(s={type:"canvas_textdoc",id:n.textdocId}),{...e,messageMetadata:{...e.messageMetadata,open_in_canvas_view:s}}}const z=({isFullScreen:e=!1,clientThreadId:n,focusedObject:s,onClose:t,isAnimating:r=!1,width:a})=>{const{setTargetedContent:c}=oe(),u=l.useRef(!1);if(l.useEffect(()=>(u.current&&c(void 0),u.current=!0,()=>{u.current=!1}),[s]),s==null)return null;switch(s.type){case g.Textdoc:return i.jsx(Se,{isFullScreen:e,onClose:t,clientThreadId:n,focusedTextdoc:s,isAnimating:r,width:a});case g.ADAVisualization:return null}},_e=300,je=e=>e?.type===g.Textdoc?e.textdocId:null;function Re(e){const n=q(e),s=P(n),t=Y(e),r=$(e,t),a=K({clientThreadId:e,conversationLeafId:t}),c=ne(),[u,o]=l.useMemo(()=>{if(r&&ie(r))return[void 0,null];let m;return!a&&r&&(m=X(re(r.messages))),De(s,c,m)},[a,r,s,c]),h=o!=null,p=je(o);l.useEffect(()=>{if(o&&u&&!ce()&&(de(o,u),o.type===g.Textdoc)){const{textdocId:m}=o,C=be(m);Ce(document.getElementById(C))}},[h,p])}function De(e,n,s){switch(s?.type){case le.Canmore:{const[t,r]=s.messages;if(!ue(t?.message))break;const a=fe(e,t.message,r?.message??null),c=a.textdocId??n;if(c&&(a.function===Z.CreateTextdoc?(a.content??"").length>_e||a.status===_.WAITING:a.status===_.STREAMING))return[a.messageId,{type:g.Textdoc,textdocId:c}];break}}return[void 0,null]}const Me=260,T={type:"spring",bounce:.12,duration:.64},Fe={type:"spring",bounce:0,duration:.58},We=({clientThreadId:e,focusedObject:n,onClose:s})=>{const{chatWidth:t,canvasWidthCalc:r,handleDrag:a,handleDoubleClick:c,persist:u}=Ae(),o=W(),[h,p]=l.useState(!0),[m,C]=l.useState(!1),G=j(d=>d.activeSidebar),I=we(({rect:d})=>d),{windowHeight:b,windowWidth:v}=Q(d=>d,{windowWidth:0,windowHeight:0});let f=I??{top:0,left:t,width:v-t,height:b},A=!1;if(I&&(f.top<0||f.top+f.height>b)){A=!0;const d={width:(v-t)*.75,height:b*.75};f={top:b/2-d.height/2,left:(v-t-d.width)/2+t,width:d.width,height:d.height}}if(o){const d=v-f.width-f.left;f={...f,left:-d}}const w=I?.borderRadius,E=pe(),U=E?.history!=null||E?.showChangesAtVersion!=null,V=j(d=>d.isDesktopNavCollapsed);return i.jsxs(i.Fragment,{children:[U&&i.jsx(ye,{onClick:()=>me(E.textdocId),zIndexKey:"chatOverlay"}),i.jsxs(x.div,{initial:!o&&{marginRight:V?0:-Me},animate:!o&&{marginRight:0},transition:Fe,children:[i.jsx(x.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:{...T,delay:.22},className:"pointer-events-none absolute left-0 top-0 z-20 h-full w-full bg-token-main-surface-primary"}),!o&&i.jsx(x.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"pointer-events-none absolute left-0 top-0 z-10 h-full w-full bg-black/[0.025] dark:bg-transparent"}),i.jsx(x.div,{className:"relative z-20 h-full",style:{width:r},exit:{width:0},transition:{type:"spring",bounce:0,duration:.1}})]}),i.jsx(x.div,{className:ee("absolute z-20 h-full transition-shadow",o&&"right-0 max-h-[100cqh] max-w-[var(--available-details-width)] overflow-y-auto overflow-x-clip",!o&&"overflow-hidden",!o&&(G==="debug"?"md:left-[-250px] lg:left-[-300px] xl:left-[-350px] 2xl:left-[-400px]":"left-0")),initial:{borderRadius:w,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)",opacity:A?0:1,x:f.left,y:f.top,height:f.height,width:f.width},animate:{opacity:1,x:o?0:t,y:0,width:o?`calc(100cqw - ${t}px)`:r,height:"100%",borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:{opacity:{duration:.14,bounce:.1}},borderRadius:w,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:m?{duration:0}:T,onAnimationComplete:()=>p(!1),children:i.jsx(x.div,{className:"h-full overflow-hidden border-l border-gray-100 dark:border-token-border-medium",initial:{borderRadius:w},animate:{borderRadius:0},exit:{borderRadius:w},transition:T,children:i.jsxs("div",{className:"h-full",children:[i.jsx(x.div,{drag:"x",className:"absolute left-[-2px] z-10 h-full w-[4px] cursor-ew-resize bg-token-text-quaternary opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onDrag:(d,B)=>{C(!0),a(B)},onDragEnd:()=>{C(!1),u(t)},onDoubleClick:()=>c()}),i.jsx(z,{onClose:s,clientThreadId:e,isAnimating:h,focusedObject:n,width:v-t})]})})})]})},Oe=l.memo(We),ke=({clientThreadId:e,focusedObject:n,onClose:s})=>i.jsx(te,{children:i.jsx(x.div,{className:"fixed inset-0 z-20 overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:T,children:i.jsx(z,{isFullScreen:!0,clientThreadId:e,focusedObject:n,onClose:s})})}),Le=({clientThreadId:e})=>{const n=H(),s=Te(e);Re(e);const t=xe(),r=ge(),a=l.useMemo(()=>{let p=t;if(t?.type===g.Textdoc){const m=r?.[t.textdocId];m&&(p={...t,textdocId:m})}return p},[t,r]);l.useEffect(()=>{O()},[e]);const c=a&&(n?i.jsx(Oe,{clientThreadId:e,onClose:M,focusedObject:a},"canvas-sidebar"):i.jsx(ke,{clientThreadId:e,onClose:M,focusedObject:a},"canvas-modal"));l.useEffect(()=>{if(a)return R(p=>Ne(p,a)),()=>R(null)},[a,r]);const u=W(),o=c!=null;return l.useEffect(()=>{if(!u)return D.setActiveStageSidebar(o),()=>{o&&D.setActiveStageSidebar(!1)}},[o,u]),s!==e?null:i.jsx(ve,{children:c})},ot=e=>{const n=l.useRef(null);return i.jsx(J,{ref:n,onError:(s,t)=>{O(),setTimeout(()=>{n.current?.resetErrorBoundary()}),he.logError("Error boundary hit",s,{componentStack:t})},name:"canmore-focused-view",children:i.jsx(Le,{...e})})};export{ot as CanvasFocusedViewManager};
//# sourceMappingURL=5yik4ijweuefhsh1.js.map
