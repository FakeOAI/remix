const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/mrqtg03vjej7jbkc.js","assets/feqczpzhl32x4td2.js","assets/jmekn9ukb2dt0emn.js","assets/kgzzu4tf7u5313rd.js","assets/dkrkpapzk8i632go.js","assets/fow2c4yq3c8klomi.js","assets/root-k8yvx6b6.css","assets/fnh1ee9l40s79ybh.js","assets/conversation-small-lkohtmkm.css","assets/ey5apunl1vnvf9g5.js","assets/gus5ys87ebe3yyy0.js","assets/jqqo55reqowwgoc4.js","assets/kdmay48w4tjzal97.js","assets/iagw21vtml2xbtg6.js","assets/cb4up3wxp9co5lzh.js","assets/dkptqlxvdk2bhhas.js","assets/l0w8th2xkt507fp5.js","assets/fzrn137102spawew.js","assets/lebsyc66aja9e6ew.js","assets/dgwshraa8ui7irnp.js","assets/kuia0na4bz0zmvoq.js","assets/m8dgj9xaftrqw1zi.js","assets/gvz14qf5woeu83oi.js","assets/f8gej6u80yhs2ypx.js","assets/gp85v9xixrv3bohq.js","assets/3o81qjdw8n67xz1z.js","assets/ht5picexppy8sp7d.js","assets/jjl9gcpn0mw5w2ek.js","assets/g8ionzntg3ydmrv9.js","assets/hsklqwvz225jicy5.js","assets/j1gifdt3ptro4tte.js","assets/kus2ncnz7yznrfcq.js","assets/c0muejemttw0bq6p.js","assets/n0trabo01addyvzs.js","assets/ey1rp9v8gm3nvjs6.js","assets/hmn4uz5y5xnc7zcv.js"])))=>i.map(i=>d[i]);
import{b4 as N,n as q,r as _,L as Ve,g5 as yt,m as p,aE as j,l as J,b as bt,e2 as He,aQ as se,gy as Tt,c3 as Fe,c4 as xt,c5 as Pt,c6 as Ge,aR as St,aJ as Ye}from"./dkrkpapzk8i632go.js";import{i as v,E as le,Z as K,j as Ue,k as kt,H as Lt,G as I,T as Ee,C as Ce}from"./gus5ys87ebe3yyy0.js";import{c as Ot,S as At,H as Mt,x as wt,t as c}from"./jmekn9ukb2dt0emn.js";import{_ as ze}from"./fzrn137102spawew.js";import{E as It,a5 as Z,a6 as H,a7 as O,a8 as ae,a9 as Rt,aa as ie,ab as ve,ac as Dt,ad as jt,ae as Bt,af as Vt,a2 as B,ag as Ke,ah as Ht,ai as Xe,aj as Ft,ak as $e,al as Gt,am as Yt}from"./kgzzu4tf7u5313rd.js";import{aC as X,b7 as w,aU as We,jV as Ut,kE as zt,hv as Kt,cr as qe,hQ as Y,kF as Xt,kG as _e,jf as $t,jl as Wt,kv as qt,kw as Jt,jn as Qt,n as Zt,fF as eo}from"./fnh1ee9l40s79ybh.js";import{b as to}from"./ohjx34ealw57wtov.js";import{T as oo,P as Je,f as no,c as ro,i as so,j as ao,D as Ne,h as Qe}from"./dkptqlxvdk2bhhas.js";import{m as D}from"./ey5apunl1vnvf9g5.js";import{u as ce}from"./iagw21vtml2xbtg6.js";import{c as Ze,R as io,I as co}from"./abq5ffo6ld58dpco.js";import{af as lo,bX as uo}from"./fow2c4yq3c8klomi.js";import{u as mo}from"./gvz14qf5woeu83oi.js";import{i as fo}from"./l0w8th2xkt507fp5.js";const po="_modelCursor_1mtn0_1",$n={modelCursor:po},go=(...e)=>o=>{e.forEach(t=>{if(typeof t=="function")t(o);else if(t){const n=t;n.current=o}})};function k(e){return new Ot(At.define(e))}const ye=()=>N(()=>import("./pbl95wx6493wq92j.js"),[]).then(e=>k(e.shell)),et={[v.bash]:ye,[v.zsh]:ye,[v.swift]:()=>N(()=>import("./pijqfo56g5y7ss6b.js"),[]).then(e=>k(e.swift)),[v.css]:()=>N(()=>import("./mrqtg03vjej7jbkc.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(e=>e.css()),[v.html]:()=>N(()=>import("./f8gej6u80yhs2ypx.js"),__vite__mapDeps([23,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,0,24])).then(e=>e.html()),[v.javascript]:()=>N(()=>import("./gp85v9xixrv3bohq.js"),__vite__mapDeps([24,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(e=>e.javascript({jsx:!0,typescript:!1})),[v.typescript]:()=>N(()=>import("./gp85v9xixrv3bohq.js"),__vite__mapDeps([24,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(e=>e.javascript({jsx:!0,typescript:!0})),[v.json]:()=>N(()=>import("./3o81qjdw8n67xz1z.js"),__vite__mapDeps([25,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(e=>e.json()),[v.python]:()=>N(()=>import("./ht5picexppy8sp7d.js"),__vite__mapDeps([26,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(e=>e.python()),[v.sql]:()=>N(()=>import("./jjl9gcpn0mw5w2ek.js"),__vite__mapDeps([27,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,1])).then(e=>e.sql()),[v.go]:()=>N(()=>import("./g8ionzntg3ydmrv9.js"),__vite__mapDeps([28,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(e=>e.go()),[v.yaml]:()=>N(()=>import("./hsklqwvz225jicy5.js"),__vite__mapDeps([29,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(e=>e.yaml()),[v.java]:()=>N(()=>import("./j1gifdt3ptro4tte.js"),__vite__mapDeps([30,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(e=>e.java()),[v.rust]:()=>N(()=>import("./kus2ncnz7yznrfcq.js"),__vite__mapDeps([31,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(e=>e.rust()),[v.cpp]:()=>N(()=>import("./c0muejemttw0bq6p.js"),__vite__mapDeps([32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(e=>e.cpp()),[v.php]:()=>N(()=>import("./n0trabo01addyvzs.js"),__vite__mapDeps([33,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,0,24])).then(e=>e.php()),[v.xml]:()=>N(()=>import("./ey1rp9v8gm3nvjs6.js"),__vite__mapDeps([34,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(e=>e.xml()),[v.vue]:()=>N(()=>import("./hmn4uz5y5xnc7zcv.js"),__vite__mapDeps([35,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,1,0,24])).then(e=>e.vue()),[v.ruby]:()=>N(()=>import("./e4lhyu305wu0fcut.js"),[]).then(e=>k(e.ruby)),[v.haskell]:()=>N(()=>import("./bf6r3t2rw7f01so5.js"),[]).then(e=>k(e.haskell)),[v.kotlin]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>k(e.kotlin)),[v.csharp]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>k(e.csharp)),[v.c]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>k(e.c)),[v.objectivec]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>k(e.objectiveC)),[v.r]:()=>N(()=>import("./n0t2rpizlasjzcxa.js"),[]).then(e=>k(e.r)),[v.lua]:()=>N(()=>import("./harowmpdmpnd9wki.js"),[]).then(e=>k(e.lua)),[v.dart]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>k(e.dart)),[v.scala]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>k(e.scala)),[v.perl]:()=>N(()=>import("./gq1ss5v2zpbborxl.js"),[]).then(e=>k(e.perl)),[v.commonlisp]:()=>N(()=>import("./jr6cjysmysifr6mr.js"),[]).then(e=>k(e.commonLisp)),[v.clojure]:()=>N(()=>import("./gf1tfl9d2himhfic.js"),[]).then(e=>k(e.clojure)),[v.ocaml]:()=>N(()=>import("./khji33iw1sxityyt.js"),[]).then(e=>k(e.oCaml)),[v.powershell]:()=>N(()=>import("./i9u5kd7kvamutmln.js"),[]).then(e=>k(e.powerShell)),[v.verilog]:()=>N(()=>import("./fix340p09fldyqxz.js"),[]).then(e=>k(e.verilog)),[v.dockerfile]:()=>N(()=>import("./cgm5tyzi32u32j10.js"),[]).then(e=>k(e.dockerFile)),[v.other]:()=>null},ho=e=>e in et,oe={},Wn=async e=>{if(oe[e]!=null)return oe[e];if(ho(e)){const o=await et[e]();return oe[e]=o,o}return null},qn=e=>oe[e]??null;var tt=e=>{var{theme:o,settings:t={},styles:n=[]}=e,r={".cm-gutters":{}},s={};t.background&&(s.backgroundColor=t.background),t.backgroundImage&&(s.backgroundImage=t.backgroundImage),t.foreground&&(s.color=t.foreground),t.fontSize&&(s.fontSize=t.fontSize),(t.background||t.foreground)&&(r["&"]=s),t.fontFamily&&(r["&.cm-editor .cm-scroller"]={fontFamily:t.fontFamily}),t.gutterBackground&&(r[".cm-gutters"].backgroundColor=t.gutterBackground),t.gutterForeground&&(r[".cm-gutters"].color=t.gutterForeground),t.gutterBorder&&(r[".cm-gutters"].borderRightColor=t.gutterBorder),t.caret&&(r[".cm-content"]={caretColor:t.caret},r[".cm-cursor, .cm-dropCursor"]={borderLeftColor:t.caret});var a={};t.gutterActiveForeground&&(a.color=t.gutterActiveForeground),t.lineHighlight&&(r[".cm-activeLine"]={backgroundColor:t.lineHighlight},a.backgroundColor=t.lineHighlight),r[".cm-activeLineGutter"]=a,t.selection&&(r["&.cm-focused .cm-selectionBackground, & .cm-line::selection, & .cm-selectionLayer .cm-selectionBackground, .cm-content ::selection"]={background:t.selection+" !important"}),t.selectionMatch&&(r["& .cm-selectionMatch"]={backgroundColor:t.selectionMatch});var i=It.theme(r,{dark:o==="dark"}),l=Mt.define(n),u=[i,wt(l)];return u},Eo={background:"#ffffff",foreground:"#383a42",caret:"#000",selection:"#add6ff",selectionMatch:"#a8ac94",lineHighlight:"#f0f0f0",gutterBackground:"#fff",gutterForeground:"#237893",gutterActiveForeground:"#0b216f",fontFamily:'Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace'},Co=[{tag:[c.keyword,c.operatorKeyword,c.modifier,c.color,c.constant(c.name),c.standard(c.name),c.standard(c.tagName),c.special(c.brace),c.atom,c.bool,c.special(c.variableName)],color:"#0000ff"},{tag:[c.moduleKeyword,c.controlKeyword],color:"#af00db"},{tag:[c.name,c.deleted,c.character,c.macroName,c.propertyName,c.variableName,c.labelName,c.definition(c.name)],color:"#0070c1"},{tag:c.heading,fontWeight:"bold",color:"#0070c1"},{tag:[c.typeName,c.className,c.tagName,c.number,c.changed,c.annotation,c.self,c.namespace],color:"#267f99"},{tag:[c.function(c.variableName),c.function(c.propertyName)],color:"#795e26"},{tag:[c.number],color:"#098658"},{tag:[c.operator,c.punctuation,c.separator,c.url,c.escape,c.regexp],color:"#383a42"},{tag:[c.regexp],color:"#af00db"},{tag:[c.special(c.string),c.processingInstruction,c.string,c.inserted],color:"#a31515"},{tag:[c.angleBracket],color:"#383a42"},{tag:c.strong,fontWeight:"bold"},{tag:c.emphasis,fontStyle:"italic"},{tag:c.strikethrough,textDecoration:"line-through"},{tag:[c.meta,c.comment],color:"#008000"},{tag:c.link,color:"#4078f2",textDecoration:"underline"},{tag:c.invalid,color:"#e45649"}];function vo(e){var{theme:o="dark",settings:t={},styles:n=[]}=e||{};return tt({theme:o,settings:ze({},Eo,t),styles:[...Co,...n]})}var Jn=vo(),_o={background:"#1e1e1e",foreground:"#9cdcfe",caret:"#c6c6c6",selection:"#6199ff2f",selectionMatch:"#72a1ff59",lineHighlight:"#ffffff0f",gutterBackground:"#1e1e1e",gutterForeground:"#838383",gutterActiveForeground:"#fff",fontFamily:'Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace'},No=[{tag:[c.keyword,c.operatorKeyword,c.modifier,c.color,c.constant(c.name),c.standard(c.name),c.standard(c.tagName),c.special(c.brace),c.atom,c.bool,c.special(c.variableName)],color:"#569cd6"},{tag:[c.controlKeyword,c.moduleKeyword],color:"#c586c0"},{tag:[c.name,c.deleted,c.character,c.macroName,c.propertyName,c.variableName,c.labelName,c.definition(c.name)],color:"#9cdcfe"},{tag:c.heading,fontWeight:"bold",color:"#9cdcfe"},{tag:[c.typeName,c.className,c.tagName,c.number,c.changed,c.annotation,c.self,c.namespace],color:"#4ec9b0"},{tag:[c.function(c.variableName),c.function(c.propertyName)],color:"#dcdcaa"},{tag:[c.number],color:"#b5cea8"},{tag:[c.operator,c.punctuation,c.separator,c.url,c.escape,c.regexp],color:"#d4d4d4"},{tag:[c.regexp],color:"#d16969"},{tag:[c.special(c.string),c.processingInstruction,c.string,c.inserted],color:"#ce9178"},{tag:[c.angleBracket],color:"#808080"},{tag:c.strong,fontWeight:"bold"},{tag:c.emphasis,fontStyle:"italic"},{tag:c.strikethrough,textDecoration:"line-through"},{tag:[c.meta,c.comment],color:"#6a9955"},{tag:c.link,color:"#6a9955",textDecoration:"underline"},{tag:c.invalid,color:"#ff0000"}];function yo(e){var{theme:o="dark",settings:t={},styles:n=[]}=e||{};return tt({theme:o,settings:ze({},_o,t),styles:[...No,...n]})}var Qn=yo(),V=(e=>(e[e.up=-1]="up",e[e.down=1]="down",e))(V||{}),ne=(e=>(e.COMMENT="comment",e.COMPOSER="composer",e))(ne||{}),L=(e=>(e.COLLAPSED="collapsed",e.EXPANDED="expanded",e))(L||{});const ot=([e,o],[t,n])=>{const r=e+o,s=t+n;return e<s&&t<r},de=([e,o])=>e+o,z=e=>{if(e.type===L.COLLAPSED)return[e.offsetY??0,0];const{offsetY:o,shiftY:t=0,height:n=0}=e,r=o+t;return t<0?[r,n+Math.abs(t)]:[r,n]},bo=(e,o,t)=>{if(!ot(e,o))return null;const[n,r]=e,s=n+r,[a,i]=o,l=a+i,u=a-s,f=l-n;return t===V.up?u:f};var nt=(e=>(e.ABOVE="above",e.BELOW="below",e))(nt||{});function W(e,o){return q(e.coordsAtPos(o))}const be=360,To=250,rt=44,Te=.5,xe=[.5,.9,1],xo=[1,.75,.2],Po=({onClose:e,onSubmit:o,opensOverDocument:t=!1,opensFromGutter:n=!1,gutterHasComments:r=!1},s)=>{const a=Ve(),i=_.useRef(null),l=_.useRef(!1),[u,f]=_.useState(""),[d,m]=_.useState(!0),g=()=>{f(""),e?.(l.current)},h=(b=u)=>{l.current=!0,o?.(b),f("")},C=yt(({windowWidth:b})=>t?b<be+100?To:be:le,0),E={};n&&(E.top=-12),t&&n?E.right=0:E.left=0;let y="";n&&!t?y="8px 50%":n&&t?y="calc(100% + 8px) 50%":t&&(y="center left");let P=0;n&&!t&&r&&(P=kt);const x=b=>{const{metaKey:R,shiftKey:S,key:A}=b;A==="Enter"&&u&&!(S||R)?(h(),b.preventDefault()):A==="Escape"&&(f(""),e?.(!1))},T=a.formatMessage({id:"VvfbvY",defaultMessage:"Edit or explain..."});return p.jsx(D.div,{ref:go(i,s),className:j("absolute flex items-center",K.commentComposer),style:{...E,minHeight:rt},transition:{type:"spring",bounce:.18,duration:.48},initial:{translateX:0},animate:{translateX:P},exit:{translateX:0},children:p.jsx(D.div,{className:j("no-scrollbar relative z-10 flex items-center overflow-x-hidden border border-token-border-light",Ue,{"rounded-full":d,"rounded-2xl":!d}),initial:{width:t?le:24,scaleX:t?Te:void 0,scale:t?void 0:Te},animate:{width:C,scaleX:t?xe:void 0,scale:t?void 0:xe},exit:{filter:"blur(16px)",scale:t?void 0:xo,width:t?le:24,opacity:t?0:[1,1,0]},transition:{type:"spring",bounce:t?.14:0,duration:.28,scale:{type:"tween",duration:.2},opacity:{type:"tween",time:[0,.95,1]}},style:{transformOrigin:y},children:p.jsxs(D.div,{className:"relative z-0 flex w-full items-center bg-token-main-surface-primary px-4 py-2.5",children:[p.jsx(D.div,{className:"backdrop-saturate-25 absolute inset-0 z-[-1] bg-gray-50/75 backdrop-blur-3xl dark:bg-gray-700/75",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.2}}),p.jsx(fo,{"aria-placeholder":T,value:u,className:"w-full resize-none border-0 bg-transparent px-1 py-0 pr-2 text-token-text-primary outline-0 placeholder:text-token-text-secondary focus:ring-0 focus-visible:ring-0",autoFocus:!0,maxRows:4,onBlur:g,onHeightChange:(b,{rowHeight:R})=>{m(Math.floor(b/R)<=1)},onChange:({target:{value:b}})=>f(b),onKeyDown:x}),!u&&p.jsx("span",{"aria-hidden":!0,className:"absolute inline-block text-nowrap pl-1 text-token-text-secondary",children:T}),p.jsx(D.button,{className:j("-mr-1.5 h-6 w-6 rounded-full bg-black text-center dark:bg-white",{"self-end":!d}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:()=>h(),children:p.jsx(lo,{className:"h-6 w-6 text-white dark:text-black"})})]})})})},st=_.forwardRef(Po),So=(e,o)=>{if(o?.type!==H.SELECTION)return null;try{const{from:t,to:n}=o,{top:r}=e.dom.getBoundingClientRect(),{bottom:s,top:a}=W(e,t),{bottom:i}=W(e,n),l=ae(e)?-30:-24;let u=s-r+l;const f=a-r;return u=i-r+8,{composerTop:u,loadingTop:f}}catch(t){return w.logError("Invalid position in SelectionCommentComposer",t),null}},ko=({toolbarPosition:e,composerRect:o,view:t})=>{let{width:n,height:r}=o;if(r||=rt,t==null||e==null)return null;const{right:s,left:a}=t.dom.getBoundingClientRect(),{left:i,top:l,aboveOrBelow:u,toolbarSize:f}=e,d=l-(u===nt.ABOVE&&r!==0?r-f.height:0),m=Rt(t)?12:0;return{left:Math.min(i,s-a-n-m),composerTop:d,aboveOrBelow:u}},Lo=({toolbarPosition:e,commentingOn:o,isWaitingForCommentResponse:t=!1,onAddComment:n})=>{const r=Z()(),[s,a]=ce(),i=ko({view:r,toolbarPosition:e,composerRect:s});if(r==null||i==null)return null;const{left:l,composerTop:u}=i,f=d=>{if(o?.type!==H.SELECTION)return;const{action:m,sourceRange:g}=o;n?.(d,m,g,o.type)};return p.jsx(X,{children:o?.type===H.SELECTION&&!t&&p.jsx("div",{className:j("absolute",K.commentComposer),style:{left:l,top:u},children:p.jsx(st,{opensOverDocument:!0,onClose:d=>{d||(O.cancelCommentingOn(),r&&ae(r)&&!r.state.selection.empty&&r.dispatch(r.state.tr.setSelection(new oo(r.state.selection.$from))),document.getSelection()?.removeAllRanges())},onSubmit:f,ref:a})},"composer")})};function at(e,o){return o?e.getState(o)??null:null}function Oo(e){return e.nodeSize-2}function Ao(e,o){return o>=0&&o<=Oo(e)}class F{constructor(o,t,n={}){this.match=o,this.match=o,this.handler=typeof t=="string"?Mo(t):t,this.undoable=n.undoable!==!1,this.inCode=n.inCode||!1}}function Mo(e){return function(o,t,n,r){let s=e;if(t[1]){let a=t[0].lastIndexOf(t[1]);s+=t[0].slice(a+t[1].length),n+=a;let i=n-r;i>0&&(s=t[0].slice(a-i,a)+s,n=r)}return o.tr.insertText(s,n,r)}}const wo=500;function Zn({rules:e}){let o=new Je({state:{init(){return null},apply(t,n){let r=t.getMeta(this);return r||(t.selectionSet||t.docChanged?null:n)}},props:{handleTextInput(t,n,r,s){return Pe(t,n,r,s,e,o)},handleDOMEvents:{compositionend:t=>{setTimeout(()=>{let{$cursor:n}=t.state.selection;n&&Pe(t,n.pos,n.pos,"",e,o)})}}},isInputRules:!0});return o}function Pe(e,o,t,n,r,s){if(e.composing)return!1;let a=e.state,i=a.doc.resolve(o),l=i.parent.textBetween(Math.max(0,i.parentOffset-wo),i.parentOffset,null,"￼")+n;for(let u=0;u<r.length;u++){let f=r[u];if(i.parent.type.spec.code){if(!f.inCode)continue}else if(f.inCode==="only")continue;let d=f.match.exec(l),m=d&&f.handler(a,d,o-(d[0].length-n.length),t);if(m)return f.undoable&&m.setMeta(s,{transform:m,from:o,to:t,text:n}),e.dispatch(m),!0}return!1}new F(/--$/,"—");new F(/\.\.\.$/,"…");new F(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"“");new F(/"$/,"”");new F(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"‘");new F(/'$/,"’");function er(e,o,t=null,n){return new F(e,(r,s,a,i)=>{let l=t instanceof Function?t(s):t,u=r.tr.delete(a,i),f=u.doc.resolve(a),d=f.blockRange(),m=d&&no(d,o,l);if(!m)return null;u.wrap(d,m);let g=u.doc.resolve(a-1).nodeBefore;return g&&g.type==o&&ro(u.doc,a-1)&&(!n||n(s,g))&&u.join(a-1),u})}function Io(e,o,t=null){return new F(e,(n,r,s,a)=>{let i=n.doc.resolve(s),l=t instanceof Function?t(r):t;return i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),o)?n.tr.delete(s,a).setBlockType(s,s,o,l):null})}function me(e,o,t,n={}){if(e==null)return null;const r=(Array.isArray(t)?t:[t]).filter(We),s=o.nodes[e].createAndFill(n,r);return s??null}const Ro={content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM(){return["p",0]}},Do="paragraph";class it extends ie{unistNodeName(){return Do}static proseMirrorNodeName(){return"paragraph"}proseMirrorNodeSpec(){return Ro}unistNodeToProseMirrorNodes({schema:o,convertedChildren:t,attrs:n}){return me(this.proseMirrorNodeName(),o,t,n)}proseMirrorNodeToUnistNodes(o,t){return[{type:this.unistNodeName(),children:t}]}}const jo=(e,o,t,n)=>e.value?o.text(e.value,[o.marks.startend.create(t),...n??[]]):null;class Q extends ie{unistNodeName(){return"text"}static proseMirrorNodeName(){return"text"}proseMirrorNodeSpec(){return{group:"inline"}}unistNodeToProseMirrorNodes({node:o,schema:t,attrs:n}){return jo(o,t,n)}proseMirrorNodeToUnistNodes(o){return[{type:this.unistNodeName(),value:o.text??""}]}}class U extends ie{static isAtStart(o,t){return o.selection.empty?t!==void 0?t.endOfTextblock("backward",o):o.selection.$anchor.parentOffset>0:!1}static headingLevelCommandBuilder(o,t,n){return(r,s,a)=>{if(n&&!U.isAtStart(r,a))return!1;const{$anchor:i}=r.selection,l=i.parent;if(l.type.name!=="heading")return!1;const u=l.attrs.level+t;if(u<0||u>6)return!1;if(s===void 0)return!0;const f=i.before(i.depth);return u>0?s(r.tr.setNodeMarkup(f,void 0,{level:u})):s(r.tr.setNodeMarkup(f,o.nodes.paragraph)),!0}}dependencies(){return[new it,new Q]}unistNodeName(){return"heading"}static proseMirrorNodeName(){return"heading"}proseMirrorNodeSpec(){return{attrs:{level:{default:1}},content:"text*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM(o){return["h"+o.attrs.level.toString(),0]}}}proseMirrorInputRules(o){return[Io(/^\s{0,3}(#{1,6})\s$/,o.nodes[this.proseMirrorNodeName()],t=>({level:t[1].length}))]}proseMirrorKeymap(o){const t={Tab:U.headingLevelCommandBuilder(o,1,!1),"#":U.headingLevelCommandBuilder(o,1,!0),"Shift-Tab":U.headingLevelCommandBuilder(o,-1,!1)};for(let n=1;n<=6;n++)t[`Shift-Mod-${n.toString()}`]=to(o.nodes[this.proseMirrorNodeName()],{level:n});return t}unistNodeToProseMirrorNodes({node:o,schema:t,convertedChildren:n,attrs:r}){const{depth:s}=o;return me(this.proseMirrorNodeName(),t,n,{...r,level:s})}proseMirrorNodeToUnistNodes(o,t){return[{type:this.unistNodeName(),depth:o.attrs.level,children:t}]}}const Se=(e,o,t)=>{const n=t==="min"?0:o.length-1;for(let r=n;t==="min"?r<o.length:r>=0;t==="min"?r++:r--){const{sourcePos:s,pmPos:a}=o[r];if(s===e)return a;if(t==="min"&&s>e||t==="max"&&s<e)return t==="min"?o[r-1]?.pmPos??a:a}return null};class Bo extends ie{unistNodeName(){return"root"}static proseMirrorNodeName(){return"doc"}proseMirrorNodeSpec(){return{content:"block+"}}unistNodeToProseMirrorNodes({schema:o,convertedChildren:t,attrs:n}){return me(this.proseMirrorNodeName(),o,t,n)}proseMirrorNodeToUnistNodes(o,t){return[{type:this.unistNodeName(),children:t}]}}const ke=(e,o)=>{if(!o)return!1;const[t,n]=o;return e>=t&&e<n},ct=(e,o)=>e.pmPos-o.pmPos,Le=(e,o)=>{const t=o[o.length-1].sourcePos;return Math.min(Math.max(e,0),t)},Oe=(e,o)=>{const t=J(o)?.sourcePos??0;return Math.min(Math.max(e,0),t)},Ae=({positions:e,sourcePos:o,sourceEndPos:t})=>{const n=[];for(let r=0;r<e.length;r++){const s=e[r],{sourcePos:a,leafSourceRange:i,isClose:l=!1}=s;if(t!=null&&a>t)break;const u=e[r+1]??null,f=d=>{let m=e[d];if(m==null)return d;let g=e[d+1],{leafSourceRange:h}=m;for(;m.nodeTypeName!==Q.proseMirrorNodeName()&&!m.isClose&&g!=null&&!ke(o,h);)n.push(g),m=g,g=e[d+2],h=m.leafSourceRange,d++;return d};if(a===o&&!l||ke(o,i))n.push(s),r=f(r);else if(a<=o&&(u?.sourcePos??Number.POSITIVE_INFINITY)>=o){let d=r+1;const m=[];for(;e[d]?.isClose===!0;)m.push(d),d++;if(e[d]){const{sourcePos:g}=e[d];do n.push(e[d]);while(e[++d].sourcePos===g);d=f(d-1)}else{(a===o||l)&&n.push(s);for(const g of m)n.push(e[g])}r=d}}return n.sort(ct)},Me=({positions:e,sourcePos:o})=>{const t=[],n=r=>{r&&t.push(r)};for(let r=0;r<e.length;r++){const s=e[r],{sourcePos:a}=s;if(o==null||a>o)break;const i=e[r-1]??null,l=e[r+1]??null,u=o>a&&o<(l?.sourcePos??-1),f=s.nodeTypeName===Q.proseMirrorNodeName();if(a===o||u&&!f){if(s.isClose&&!i?.isClose&&s.nodeTypeName===i?.nodeTypeName||!s.isClose&&l.isClose&&s.nodeTypeName===l.nodeTypeName||s.isClose&&i?.isClose||!s.isClose&&i!=null&&i?.nodeTypeName!==Q.proseMirrorNodeName()){n(i);let h=r-2,C=e[h];for(;h>=0&&C.isClose;)n(C),C=e[--h]}let d=r,m=s,g=m;do n(m),g=m,m=e[++d];while(m?.sourcePos===o||m?.depth<g?.depth);break}else if(u&&f){let d=r+1,m=e[d];for(;m?.isClose;)n(m),m=e[++d];break}}return t.sort(ct)},Vo=e=>{const o=new zt(Kt.GetPositionTransformer,{debug:!1});o.startBlock("get_positition_transformer");const t=new Map;e.descendants((s,a)=>{const i=ve(s);if(!i)return;const{start:l,end:u}=i,f=s.type.name,{depth:d}=e.resolve(a);if(t.set(a,{pmPos:a,sourcePos:l,leafSourceRange:s.isBlock?void 0:[l,u],depth:d,nodeTypeName:f,isClose:!1,parentNodeTypeNameStack:[]}),s.isBlock){const m=a+s.nodeSize-1;t.set(m,{pmPos:m,sourcePos:u,depth:e.resolve(m).depth,nodeTypeName:f,isClose:!0,parentNodeTypeNameStack:[]})}if(s.isText)for(let m=0;m<(s.text?.length??0);m++){const g=a+m;t.set(g,{pmPos:g,sourcePos:l+m,depth:d,nodeTypeName:f,isClose:!1,parentNodeTypeNameStack:[]})}}),t.set(e.content.size,{pmPos:e.content.size,nodeTypeName:e.type.name,depth:0,isClose:!0,sourcePos:q(ve(e)).end,parentNodeTypeNameStack:[]});const n=Array.from(t.entries()).sort(([s],[a])=>s-a).map(([,s])=>s),r=[Bo.proseMirrorNodeName()];for(const s of n)s.isClose?(s.parentNodeTypeNameStack=r.concat(),r.pop()):(s.parentNodeTypeNameStack=r.concat(),s.nodeTypeName!==Q.proseMirrorNodeName()&&J(r)!==s.nodeTypeName&&r.push(s.nodeTypeName));return o.endBlock("get_positition_transformer"),{positions:n,pmRangeToSourceRange:({start:s,end:a})=>({start:n[Math.max(s,0)].sourcePos,end:n[Math.min(a,n.length-1)].sourcePos}),sourceStartToPmPos:s=>Ae({sourcePos:Le(s,n),positions:n,sourceEndPos:null}),sourceEndToPmPos:s=>Me({sourcePos:Oe(s,n),positions:n}),sourceRangeToPmRange:s=>{o.startBlock("source_range_to_pm_range");const{start:a,end:i}=s,l=Oe(i,n),u=Ae({sourcePos:Le(a,n),sourceEndPos:l,positions:n}),f=Me({sourcePos:l,positions:n});return o.endBlock("source_range_to_pm_range"),{start:u,end:f}}}},Ho=Ut(Vo);function Fo(e,o){const t=Uo(e);if(t.length===0)return o;let n=o;return t.forEach(r=>{n=Go(r,n)}),n}function Go(e,o){return Dt(o,{start:e.from,end:e.to},Yo(e))}function Yo(e){return e.slice.size-(e.to-e.from)}function Uo(e){return e.steps.filter(o=>o instanceof so)}const re=new ao("comments");function we(e,o){const{sourceRangeToPmRange:t}=Ho(e),n=o.map(({id:r,at:s})=>{const{start:a,end:i}=t(s),l=Se(s.start,a,"max"),u=Se(s.end,i,"min");return u==null||l==null?null:[r,{start:l,end:u}]}).filter(We);return new Map(n)}function zo(e,o){const{type:t}=o;if(t===H.SELECTION){const{from:s,to:a}=o;return[s,a]}const{pos:n}=o,r=n+(e.nodeAt(n)?.nodeSize??0);return[n,r]}const Ie=(e,o,t=null,n=null)=>{const r=[],s=Array.from(o.entries()).reverse(),a=new Map(e.map(i=>[i.id,i]));for(const[i,l]of s){const u=a.get(i),m=Bt({isHovered:t===i,isFocused:n===i,isCode:!1,diffStatus:u?.diffStatus});r.push(Qe.inline(l.start,l.end,{class:m,"data-comment-id":i,nodeName:"span"}))}return r},tr=e=>new Je({key:re,state:{init:(o,{doc:t})=>{const n=we(t,e);return{comments:e,commentingOn:null,hoveredOnBlock:null,hoveredCommentId:null,focusedCommentId:null,decorations:Ie(e,n),positions:n}},apply:(o,t)=>{const n=o.getMeta(re)??{},r=n.comments,s=r??t.comments,a=r!=null?we(o.doc,s):t.positions;let i=n.commentingOn;i===void 0&&(i=t.commentingOn);let l=n.hoveredCommentId;l===void 0&&(l=t.hoveredCommentId);let u=n.focusedCommentId;u===void 0&&(u=t.focusedCommentId);const f=Fo(o,a),d=jt(s,f);return{comments:d,commentingOn:i,hoveredCommentId:l,focusedCommentId:u,decorations:Ie(d,f,l,u),positions:f}}},props:{handleClickOn:(o,t,n,r,s)=>{const{target:a}=s;if(a instanceof HTMLElement){const{commentId:i}=a.dataset;if(!i)return;O.focusComment(i)}},handleDOMEvents:{mouseover(o,t){const{target:n}=t;if(n instanceof HTMLElement){const{commentId:r}=n.dataset;r?O.mouseEnterComment(r):O.mouseLeaveComment()}}},decorations(o){const t=this.getState(o);if(!t)return Ne.empty;const{commentingOn:n,decorations:r}=t,{doc:s}=o;if(n){const[a,i]=zo(s,n);a!=null&&i!=null&&r.push(Qe.inline(a,i,{class:Lt.document},{comment:{pattern:n}}))}return Ne.create(s,r.concat())}}});function Ko(e,o,t){const n=e+o;for(const r of t.values()){const s=r.start,a=r.end;if(e<a&&s<n)return!0}return!1}const Xo=50,$o=200,Wo=[it.proseMirrorNodeName(),U.proseMirrorNodeName()],qo=e=>e?e.isBlock:!1,Jo=e=>{if(!e)return!1;const{isBlock:o,type:{name:t}}=e;return o&&Wo.includes(t)},Qo=(e,o,t,n)=>{const r=e.posAtCoords({left:o,top:t});if(r==null)return;const{pos:s,inside:a}=r;if(a===-1)return;const{state:i}=e;let l=s,u=i.doc.nodeAt(l);for(;!qo(u)&&l>=0;)l--,u=i.doc.nodeAt(l);if(!u||!Jo(u))return;const f=n!=null&&Ko(l,u.nodeSize,n);return{node:u,nodeHasComment:f,pos:l}};function Zo(e,o,t){const n=Qo(e,o.x,o.y,t);if(n==null)return null;const{node:r,pos:s,nodeHasComment:a}=n,{top:i}=e.coordsAtPos(0);function l(){const g=s+1;return Ao(e.state.doc,g)&&e.state.doc.nodeAt(g)?.isText?e.coordsAtPos(g).top:e.coordsAtPos(s).top}const u=l(),f=u-i;return{height:e.coordsAtPos(s+r.nodeSize-1).bottom-u,nodeHasComment:a,mouseEnteredAt:Date.now(),yOffset:f,pos:s}}function en(e){const o=_.useRef(!1),t=_.useRef(!1),[n,r]=_.useState(null),s=Vt(),a=s()?.dom,i=_.useRef(!1),l=B(({visibleBlockCommentLauncher_DEBUG_ONLY:d})=>d),u=_.useCallback(qe(d=>{o.current=!0;const{commentingOn:m}=B.getState();if(t.current||m!=null)return;const g=s();if(g==null||!o.current)return r(null);const{dom:h,state:C}=g,E=at(re,C)?.positions;if(E==null)return r(null);const y=Zo(g,d,E);if(y==null||y.nodeHasComment&&e===I.COLLAPSED){r(null);return}if(i.current&&y.yOffset!==n?.yOffset){r(null);return}const P=g.coordsAtPos(0),x=h.getBoundingClientRect().width,b=(d.x-P.left)/x>=Xo/100;r(b?y:null)},$o),[s,i,n]);_.useEffect(()=>{if(a!=null)return bt(a,{mouseenter:()=>{o.current=!0,t.current=!1},mouseleave:({relatedTarget:d})=>{if(u.cancel(),d instanceof HTMLElement&&d.closest("[data-block-comment-launcher]")){t.current=!0;return}t.current=!1,o.current=!1,B.getState().commentingOn==null&&r(null)},mousemove:u})},[s,a,e,u]);const f=_.useCallback(({relatedTarget:d})=>{const{commentingOn:m}=B.getState();m==null&&d!==a&&(t.current=!1,r(null))},[a]);return{visibleBlockComment:l??n,handleMouseLeave:f,onComposerVisibleChange:d=>{i.current=d}}}const tn=({isWaitingForCommentResponse:e=!1,opensOverDocument:o=!1,hasComments:t=!1,activeBlockComment:n,composerRef:r,onLaunchComposer:s,onMouseLeave:a,onSubmit:i})=>{const[l,u]=_.useState(!1),{yOffset:f,height:d,pos:m}=n,g=()=>{u(!0),s?.(),w.logButtonClick(Y.BLOCK_COMMENT_LAUNCHER),O.startCommentingOn({type:H.BLOCK,pos:m})},h=y=>{y||(u(!1),O.cancelCommentingOn())},C=y=>{u(!1),i?.(y)};_.useEffect(()=>()=>{O.mouseLeaveBlock()},[]);const E=t&&l?o?-88:88:0;return p.jsx(D.div,{className:j("pointer-events-auto absolute flex h-6 w-5 origin-[14px_50%] items-start after:absolute after:-inset-4 after:content-['']",K.commentComposer),initial:!1,animate:{opacity:1},exit:{opacity:0},transition:{type:"spring",duration:.2,bounce:.1},style:{top:0,height:d,translateY:f},onMouseLeave:a,"data-block-comment-launcher":!0,children:p.jsxs(X,{children:[l?p.jsx(st,{ref:r,opensFromGutter:!0,onClose:h,onSubmit:C,gutterHasComments:t,opensOverDocument:o},"composer"):null,p.jsx(D.button,{initial:{opacity:0},animate:{opacity:l?0:1,translateX:E},transition:{duration:.15,translateX:{type:"spring",bounce:.18,duration:.48}},className:"group absolute z-10 flex h-6 gap-1 bg-transparent after:absolute after:-inset-y-4 after:-left-1 after:-right-4 after:content-['']",onClick:g,onMouseEnter:()=>O.mouseEnterBlock(m),onMouseLeave:()=>O.mouseLeaveBlock(),disabled:l||e,children:p.jsx(Ht,{isLoading:e})},"launcer")]})})},on=({isWaitingForCommentResponse:e=!1,isRequestActive:o=!1,hasComments:t=!1,composerRef:n,gutterMode:r,onAddComment:s})=>{const a=Ke(),{visibleBlockComment:i,handleMouseLeave:l,onComposerVisibleChange:u}=en(r),f=d=>{if(!i||!a)return;const{doc:m}=a,{pos:g}=i,h=m.nodeAt(g);if(!h)return;const{attrs:{start:C,end:E}}=h;s?.(d,Xe.ASK,{start:C,end:E},H.BLOCK)};return p.jsx(X,{onExitComplete:()=>u(!1),children:i&&a&&(e||!o)&&p.jsx(tn,{composerRef:n,isWaitingForCommentResponse:e,opensOverDocument:r===I.COLLAPSED,activeBlockComment:i,hasComments:t,onSubmit:f,onMouseLeave:l,onLaunchComposer:()=>u(!0)},"launcher")})},nn=({onAcceptComment:e,onDismissComment:o,disableActions:t=!1,entry:n,isGutterCollapsed:r=!1,isHovered:s=!1,isFocused:a=!1,isSomeCommentFocused:i=!1})=>{const{offsetY:l,type:u}=n,[f,d]=Xt();let m=null;if(u===L.COLLAPSED)m=!a&&p.jsx(Ft,{offsetY:l,count:n.count,onClick:()=>{w.logButtonClick(Y.COLLAPSED_COMMENT),O.focusComment(n.children[0])}},"collapsed");else{const{comment:g}=n;if(g==null||g.content===""||g.status===_e.DISMISSED)m=null;else if(g.status===_e.ACCEPT_INITIATED)m=p.jsx("div",{className:"absolute",style:{top:l},children:p.jsx($e,{})},"loading");else{const{id:h}=g;m=p.jsx(Gt,{isSomeCommentFocused:i,isHovered:s,isFocused:a,offsetY:l,disableActions:t,onClick:()=>{w.logButtonClick(Y.EXPANDED_COMMENT),O.focusComment(h)},onMouseEnter:()=>O.mouseEnterComment(h),onMouseLeave:()=>O.mouseLeaveComment(),comment:g,onAccept:()=>{w.logButtonClick(Y.COMMENT_ACCEPT,{commentId:h}),e?.(h)},onDismiss:()=>{w.logButtonClick(Y.COMMENT_DISMISS,{commentId:h}),o?.(h)},opensOverDocument:r},"expanded")}}return p.jsx(X,{onExitComplete:()=>d?.(),children:f&&m})},Re=({onMeasureHeight:e,comment:o,isFocused:t=!1})=>{const[{height:n},r]=ce();return He(()=>{e?.(n)},[n]),p.jsx(Yt,{ref:r,comment:o,isFocused:t,disableAnimations:!0})},rn=({comments:e,onMeasure:o,getStableCommentId:t})=>{const n=_.useRef(new Map),r=_.useRef(new Map),s=_.useRef(null),a=(i,l,u=!1)=>{l&&(u?r.current.set(t(i),l):n.current.set(t(i),l),s.current&&cancelAnimationFrame(s.current),s.current=requestAnimationFrame(()=>{o?.({focusedHeights:new Map(r.current),heights:new Map(n.current)}),s.current=null}))};return e?.length?p.jsxs("div",{className:"pointer-events-none invisible fixed left-0 top-0 overflow-clip","aria-hidden":"true",children:[e.map(i=>p.jsx(Re,{comment:i,onMeasureHeight:l=>a(i.id,l)},t(i.id))),e.map(i=>p.jsx(Re,{isFocused:!0,comment:i,onMeasureHeight:l=>a(i.id,l,!0)},`${t(i.id)}-focused`))]}):null},De=(e,o,t)=>{let n=t+o;for(;o===V.down?n<e.length:n>-1;){const r=e[n],s=e[n-o],a=bo(z(r),z(s),o);if(a!=null&&r.type!==L.COLLAPSED)r.shiftY+=a;else break;n+=o}},je=(e,o)=>{for(const t of o){const{index:n,amount:r}=t,s=e[n];s.type===L.EXPANDED&&(s.shiftY+=r),De(e,V.down,n),De(e,V.up,n);for(const a of e)a.type!==L.COLLAPSED&&(a.offsetY+=a.shiftY,a.shiftY=0)}},sn=(e,o)=>{const t=[],[n,r]=o,s=n+r;for(let a=0;a<e.length;a++){const i=e[a],[l]=z(i),u=[l,i.type===L.EXPANDED?i.height:0],[f,d]=u;if(ot(u,o)){const m=f+d,g=n-m,h=s-f,E=(Math.abs(g)<Math.abs(h)?V.up:V.down)===V.up?g:h;t.push({index:a,amount:E})}}return t},an=({gutterMode:e,focusedCommentId:o,gutterPositions:t,getCommentKey:n,getComment:r})=>{if(!t?.size)return[];const s=new Map,a=[];let i=null,l=-1;for(const f of t.values()){if(f.type===ne.COMPOSER){i=[f.offsetY,f.height];continue}const{commentId:d,height:m,collapsedOffsetY:g,offsetY:h}=f;if(e===I.EXPANDED){const y=J(a),P=y?de(z(y)):0;let x=h;y&&x<=P&&(x=P),s.set(d,{originalOffsetY:h,offsetY:x}),o===d&&(l=a.length),a.push({key:n(d),comment:r(d),type:L.EXPANDED,height:m,offsetY:x,shiftY:0});continue}let C=a.findIndex(({offsetY:y,type:P})=>P===L.COLLAPSED&&y===g),E=a[C]??null;if(!E)E={key:a.length,type:L.COLLAPSED,offsetY:h,count:1,children:[d]},C=a.length,a.push(E);else{if(E.type!==L.COLLAPSED)throw new Error("Collapsed parent type expected to be collapsed");E.count+=1,E.children.push(d),E.offsetY=g}o===d&&(l=C)}const u=a[l];if(e===I.COLLAPSED&&u?.type===L.COLLAPSED){const f=[];for(let d=0;d<u.children.length;d++){const m=u.children[d];m===o&&(l+=d+1);const g=J(f),h=g?de(z(g)):0,C=t.get(m)?.offsetY??0,E=Math.max(h,C);s.set(m,{originalOffsetY:C,offsetY:E}),f.push({type:L.EXPANDED,key:n(m),comment:r(m),offsetY:E,height:t.get(m)?.height??0,shiftY:0})}a.splice(l,0,...f)}if(o){const f=s.get(o);if(!f)return a;const{offsetY:d,originalOffsetY:m}=f,g=m-d,h=[{amount:g,index:l}];let C=l+1;for(;C<a.length;){const E=a[C],{type:y}=E;let P=g;if(y===L.EXPANDED&&E.comment?.id){const{offsetY:x,originalOffsetY:T}=q(s.get(E.comment.id));if(x===T)break;P=Math.max(T-x,g)}else break;h.push({amount:P,index:C}),C++}h.length&&je(a,h)}else if(e!==I.COLLAPSED&&i){const f=sn(a,i);je(a,f)}return a},cn=e=>{try{return an(e)}catch(o){return w.logError("Generating comment gutter entries",o),[]}},ln=e=>"length"in e?e.length===0:e.nodeSize===0,ue=12,un=({composerHeight:e,getCommentHeight:o,getCollapsedStartPos:t,commentingOn:n,commentPositions:r,view:s})=>{if(!r||!s||ln(s.state.doc))return null;const{top:a}=s.dom.getBoundingClientRect(),i=Array.from(r.entries()).sort(([u,f],[d,m])=>f.start-m.start),l=new Map;for(const[u,{start:f}]of i)try{const d=t?.(f)??f,{top:m}=W(s,d),{top:g}=W(s,f),h=g-a,C=m-a,E=(o(u)??0)+ue;l.set(u,{commentId:u,height:E,collapsedOffsetY:C,offsetY:h,type:ne.COMMENT})}catch{continue}if(n?.type===H.BLOCK){const{pos:u}=n;try{const{top:f}=W(s,u),m=f-a-ue;l.set("block-composer",{type:ne.COMPOSER,height:(e??0)+ue,offsetY:m})}catch{}}return l},lt=(e,o)=>o.nodeAt(e)?.isBlock?e+1:lt(e-1,o);function dn(e){const o=Ke(),n=Z()?.();if(!n)return null;if(ae(n)){if(!o)return null;const r=at(re,o);return r?r.positions:null}return new Map(e.map(r=>[r.id,r.at]))}const mn=({gutterMode:e,focusedCommentId:o,commentingOn:t,comments:n,getStableId:r})=>{const[{height:s},a]=ce(),i=Z(),[l,u]=_.useState(()=>new Map),[f,d]=_.useState(()=>new Map),m=_.useCallback(({focusedHeights:T,heights:b})=>{u(T),d(b)},[]),g=T=>{const b=r(T);return T===o?l.get(b)??0:f.get(b)??0},h=i(),C=h!=null&&ae(h)?T=>lt(T,h.state.doc):void 0,E=new Map(n?.map(T=>[r(T.id),T])),y=dn(n),P=un({composerHeight:s,commentingOn:t,getCommentHeight:g,getCollapsedStartPos:C,commentPositions:y,view:h}),x=cn({gutterMode:e,gutterPositions:P,focusedCommentId:o,getComment:T=>E.get(r(T))??null,getCommentKey:r});return{blockComposerRef:a,onMeasureComments:m,gutterEntries:x}};function fn(){const o=Z()(),t=B(({commentingOn:s})=>s),r=o==null?null:So(o,t);return r==null?null:p.jsx(D.div,{className:"absolute",style:{top:r.loadingTop},initial:!1,animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},transition:{delay:.2},children:p.jsx($e,{})},"selection-loading")}const pn=e=>p.jsx("div",{className:"absolute",style:{top:de(z(e))},children:p.jsx("div",{className:"h-[max(3rem,18vh)] w-1"})}),or=({availableWidth:e,comments:o,commentsMode:t,disableBlockComments:n=!1,isRequestActive:r=!1,isWaitingForCommentResponse:s=!1,onAddComment:a,onAcceptComment:i,onDismissComment:l,getStableCommentId:u})=>{const f=B(({focusedCommentId:M})=>M),d=B(({hoveredCommentId:M})=>M),m=B(({commentingOn:M})=>M),g=$t(),h=e<Ee?I.COLLAPSED:I.EXPANDED,{onMeasureComments:C,blockComposerRef:E,gutterEntries:y}=mn({comments:o,getStableId:u,gutterMode:h,focusedCommentId:f,commentingOn:m}),P=y.length>0,x=m!=null&&!s&&m.type!=="selection"||P,b=(()=>{if(!x)return 0;switch(h){case I.COLLAPSED:return 0;case I.EXPANDED:return Ee}})(),R=m?.type==="selection",S=J(y),A=t===Ce.ENABLED&&g&&!R&&!n;return p.jsxs(D.div,{className:j("pointer-events-none relative flex h-full flex-shrink-0",K.commentGutter,h===I.COLLAPSED&&b?"basis-[32px]":"basis-0"),initial:{width:0,opacity:0},animate:{width:b,opacity:1},exit:{width:0,opacity:0},children:[p.jsx(rn,{getStableCommentId:u,comments:o,onMeasure:C}),p.jsxs("div",{className:j("pointer-events-auto absolute bottom-0 left-0 top-0 w-0 overflow-visible",{"pl-2":x||!n}),children:[p.jsx(X,{children:y.map(M=>{const{key:vt,type:he}=M,_t=!!f&&he===L.EXPANDED&&M.comment?.id===f,Nt=!!f&&M.type===L.COLLAPSED&&M.children.includes(f);return p.jsx(nn,{isGutterCollapsed:h===I.COLLAPSED,isSomeCommentFocused:!!m||!!f,isHovered:he===L.EXPANDED&&M.comment?.id===d,isFocused:_t||Nt,entry:M,disableActions:r||s||t===Ce.COMMENTS_READONLY,onAcceptComment:$=>{try{i?.(q(o?.find(G=>G.id===$)))}catch(G){w.logError(`Comment ${$} not found`,G)}},onDismissComment:$=>{try{l?.(q(o?.find(G=>G.id===$)))}catch(G){w.logError(`Comment ${$} not found`,G)}}},vt)})}),P&&S&&p.jsx(pn,{...S}),A&&p.jsx(on,{composerRef:E,gutterMode:h,onAddComment:a,isWaitingForCommentResponse:s,isRequestActive:r,hasComments:P}),s&&R&&p.jsx(fn,{})]})]})};var gn="Separator",Be="horizontal",hn=["horizontal","vertical"],ut=_.forwardRef((e,o)=>{const{decorative:t,orientation:n=Be,...r}=e,s=En(n)?n:Be,i=t?{role:"none"}:{"aria-orientation":s==="vertical"?s:void 0,role:"separator"};return p.jsx(se.div,{"data-orientation":s,...i,...r,ref:o})});ut.displayName=gn;function En(e){return hn.includes(e)}var Cn=ut,fe="Toolbar",[vn,nr]=Tt(fe,[Fe,Ze]),pe=Fe(),dt=Ze(),[_n,mt]=vn(fe),ft=_.forwardRef((e,o)=>{const{__scopeToolbar:t,orientation:n="horizontal",dir:r,loop:s=!0,...a}=e,i=pe(t),l=xt(r);return p.jsx(_n,{scope:t,orientation:n,dir:l,children:p.jsx(Pt,{asChild:!0,...i,orientation:n,dir:l,loop:s,children:p.jsx(se.div,{role:"toolbar","aria-orientation":n,dir:l,...a,ref:o})})})});ft.displayName=fe;var pt="ToolbarSeparator",gt=_.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=mt(pt,t);return p.jsx(Cn,{orientation:r.orientation==="horizontal"?"vertical":"horizontal",...n,ref:o})});gt.displayName=pt;var Nn="ToolbarButton",ge=_.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=pe(t);return p.jsx(Ge,{asChild:!0,...r,focusable:!e.disabled,children:p.jsx(se.button,{type:"button",...n,ref:o})})});ge.displayName=Nn;var yn="ToolbarLink",bn=_.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=pe(t);return p.jsx(Ge,{asChild:!0,...r,focusable:!0,children:p.jsx(se.a,{...n,ref:o,onKeyDown:St(e.onKeyDown,s=>{s.key===" "&&s.currentTarget.click()})})})});bn.displayName=yn;var ht="ToolbarToggleGroup",Tn=_.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=mt(ht,t),s=dt(t);return p.jsx(io,{"data-orientation":r.orientation,dir:r.dir,...s,...n,ref:o,rovingFocus:!1})});Tn.displayName=ht;var xn="ToolbarToggleItem",Pn=_.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=dt(t),s={__scopeToolbar:e.__scopeToolbar};return p.jsx(ge,{asChild:!0,...s,children:p.jsx(co,{...r,...n,ref:o})})});Pn.displayName=xn;var Sn=ft,kn=gt,Ln=(e=>(e.CODE="code",e.WRITING="writing",e))(Ln||{});const ee=({children:e,toolbarType:o})=>p.jsx(Sn,{className:j("m-0 flex h-10 w-fit min-w-0 flex-shrink items-center overflow-hidden rounded-xl border border-token-border-light bg-token-main-surface-primary",Ue,o==="code"?"p-0":"p-1"),children:e}),Et=({icon:e,hideLabel:o,label:t})=>p.jsxs(p.Fragment,{children:[p.jsx(e,{className:j("icon-sm",{"mr-0.5 text-token-text-tertiary":!o,"text-token-text-primary":o})}),!o&&p.jsx("span",{className:"truncate text-sm text-token-text-primary",children:t})]}),Ct=Ye(ge)`flex h-full items-center gap-1 rounded-lg px-2.5 hover:bg-[#f5f5f5] disabled:opacity-50 disabled:cursor-not-allowed dark:hover:bg-token-main-surface-secondary disabled:hover:bg-transparent`,On=({label:e,icon:o,isDisabled:t=!1,hideLabel:n=!1,onClick:r,onMouseDown:s})=>p.jsx(Ct,{onClick:r,"aria-label":n?e:void 0,onMouseDown:s,disabled:t,children:p.jsx(Et,{icon:o,hideLabel:n,label:e})}),An=({icon:e,hideLabel:o,label:t,children:n})=>p.jsxs(Wt,{children:[p.jsx(qt,{asChild:!0,children:p.jsx(Ct,{"aria-label":o?t:void 0,children:p.jsx(Et,{icon:e,hideLabel:o,label:t})})}),p.jsx(Jt,{children:p.jsx(Qt,{align:"end",className:K.toolbar,sideOffset:8,children:n})})]});ee.Separator=Ye(kn)`mx-1 p-0 list-none h-full w-[1px] bg-token-border-light`;ee.Action=On;ee.Popover=An;const Mn=({isSendDisabled:e=!1,getSelectionRange:o})=>{const t=Ve(),n=()=>{const r=o();if(r==null)return;const{from:s,to:a,sourceFrom:i,sourceTo:l}=r;if(s==null||a==null||i==null||l==null){w.logError("Missing selection range on targeted edit",r);return}const u=Xe.ASK;w.logButtonClick(Y.TOOLBAR_ASK_CHATGPT,{action:u,sourceFrom:i,sourceTo:l}),O.startCommentingOn({type:H.SELECTION,from:s,to:a,sourceRange:{start:i,end:l},action:u})};return p.jsx(ee.Action,{isDisabled:e,label:t.formatMessage({id:"wOaJUU",defaultMessage:"Ask ChatGPT"}),onClick:n,icon:uo})},rr=({getEditorDom:e,getToolbarPosition:o,getSelectionRange:t,toolbarType:n,children:r,onAddComment:s,isWaitingForCommentResponse:a=!1,isSendDisabled:i=!1})=>{const[{height:l,width:u},f]=ce(),[d,m]=_.useState(!0),[g,h]=_.useState(!1),C=e(),E=B(({commentingOn:S})=>S),[y,P]=_.useState(null),x=_.useCallback(()=>{const S=e(),A=document.getSelection();return!A||A.type!=="Range"||A.isCollapsed||!S?.contains(A.anchorNode)},[e]);_.useEffect(()=>{const S=Zt(()=>{h(!0)},200,{leading:!0}),A=()=>{S.cancel(),h(!1)};return C?.addEventListener("pointerdown",S,{passive:!0}),document.addEventListener("pointerup",A,{passive:!0}),()=>{C?.removeEventListener("pointerdown",S),document.removeEventListener("pointerup",A)}},[C]),_.useEffect(()=>{const S=()=>{m(x())};return document.addEventListener("selectionchange",S,{passive:!0}),()=>{document.removeEventListener("selectionchange",S)}},[x]),He(()=>{if(d||x())return m(!0);try{const S=o({width:u,height:l});S!=null&&P(S)}catch(S){w.logError("Invalid position in getToolbarPosition",S)}},[l,u,d,x,o]);const T=p.jsxs(ee,{toolbarType:n,children:[p.jsx(Mn,{isSendDisabled:i,getSelectionRange:t}),r]}),b=!d&&!E&&y!=null,R=mo(b);return _.useEffect(()=>{!b&&R&&!E&&C?.focus()},[C,R,b,E]),p.jsxs(p.Fragment,{children:[p.jsx("div",{"aria-hidden":"true",className:"pointer-events-none invisible fixed left-0 top-0 h-0 overflow-clip",children:p.jsx("div",{ref:f,children:T})}),p.jsx(X,{children:b&&p.jsx(D.div,{initial:{opacity:0,scale:.95},animate:{opacity:g?0:1,scale:g?.95:1},style:{top:y.top,left:y.left},exit:{opacity:0,scale:.95},transition:{type:"spring",bounce:.1,duration:.1,delay:g?0:.1},className:j("absolute",K.toolbar,g?"pointer-events-none":"pointer-events-auto"),children:T})}),p.jsx(Lo,{toolbarPosition:y,commentingOn:E,isWaitingForCommentResponse:a,onAddComment:s})]})};function wn(e){let o=e;for(;o;){const n=window.getComputedStyle(o).overflowY;if(n==="auto"||n==="scroll")return o;o=o.parentElement}return null}function sr(e,o){const t=Z(),n=eo(),r=t();_.useEffect(()=>{const s=r?.dom;if(!s||e.length===0)return;const a=wn(s),i=o?qe(o,100):null;return a&&i&&a.addEventListener("scroll",i,{passive:!0}),()=>{i&&(a&&a.removeEventListener("scroll",i),i.cancel())}},[r,n,e,o])}let te=null;function ar(){if(te!=null)return te;if(typeof window>"u")return 0;const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.overflow="scroll",e.style.position="absolute",e.style.top="-9999px",document.body.appendChild(e);try{te=e.offsetWidth-e.clientWidth}finally{document.body.removeChild(e)}return te}function ir(e){return e==null?null:e.scrollHeight>e.clientHeight}export{nt as A,Oo as B,or as C,ln as D,ee as E,U as H,F as I,Ro as P,Bo as R,rr as T,Jn as a,qn as b,Ln as c,ar as d,Q as e,vo as f,Wn as g,Qn as h,ir as i,me as j,jo as k,Do as l,go as m,it as n,Zn as o,Ho as p,Se as q,Ao as r,$n as s,Io as t,sr as u,yo as v,er as w,tr as x,at as y,re as z};
//# sourceMappingURL=ol26cae9ruoxd3px.js.map
