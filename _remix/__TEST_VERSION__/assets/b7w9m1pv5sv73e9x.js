import{r as y,a1 as U,m as c,bd as Ie,a3 as G,R as tt,q as Se,aK as Ut,ea as Ht,a6 as Re,a5 as Ft,cT as Bt,cU as zt,cV as Gt,dW as Yt,f as vt,e as Jt,fo as nt,cY as st,u as Ct,d2 as Wt,dH as Xt}from"./eljox9y9liclbxjs.js";import{dL as Qt,ft as Zt,hY as Kt,G as yt,hZ as ie,h_ as he,T as ce,N as X,fD as P,gF as fe,Y as Vt,h$ as ke,fG as pe,i0 as Tt,i1 as en,i2 as tn,i3 as nn,hA as wt,hX as sn,as as O,bd as rn,bx as on,i4 as an,i5 as un,i6 as k,i7 as ln,gz as Et,i8 as cn,i9 as fn,d as mn,ia as dn,ib as hn,ic as pn,fs as gn,gg as vn,fp as Cn,gh as yn,fq as Tn,de as wn,id as En,ie as Me,ig as xn,ih as bn,ii as Mn,fH as In,ij as Sn,ik as rt}from"./q02ioa5nz1msdn73.js";import{C as kn,t as J,g as An,v as Dn,w as Nn,x as Ln,y as _n,z as Rn}from"./bpx8yk8lhvr4hu9a.js";import{e as On,C as Pn}from"./c4b6lf0gasvdk5f8.js";import{C as me,w as jn,S as B,x as ot}from"./ctv5zl6thp0tttje.js";import{m as W}from"./gej2wzszabjtgedr.js";import{D as qn}from"./i0hzoutiwdqlll20.js";import{bG as $n,by as Un,Y as Hn,bI as Fn,bJ as Bn,av as zn,y as Gn}from"./mov0dqfy71k4mkbp.js";import{i as Yn}from"./g55wszzvw80ez5vs.js";import{q as Jn,r as Wn,T as Xn,o as Qn,b as Zn}from"./ei22way1wz63smda.js";import{L as Kn,e as Vn,f as es,g as ts}from"./i4lebxob07xbpc6p.js";import{P as ns}from"./m2j9a5yzu7labkem.js";import{J as ss,a as rs}from"./btkmfibrorj6h94u.js";import{u as os}from"./ffm0ki31s7071ctc.js";const as=({isTextdocStreaming:t,isRequestActive:e,value:n,comments:s})=>{const[r,o]=y.useState(!1);return y.useEffect(()=>{t&&r&&(o(!1),me.reset())},[n,s]),y.useEffect(()=>{e||(o(!1),me.reset())},[e]),[r,o]};function is({onClickRestore:t,onClickResetLatest:e}){const n=U();return c.jsx(W.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{bounce:0,duration:.24},className:"absolute bottom-0 left-0 z-30 w-full items-center border-t border-gray-100 bg-token-main-surface-primary p-6 shadow-[0_-4px_32px_rgba(0,0,0,0.08)] @container dark:border-token-border-xlight dark:shadow-[0_-4px_32px_rgba(0,0,0,0.12)] lg:border-l",children:c.jsxs("div",{className:"mx-auto flex max-w-[48rem] flex-col flex-wrap justify-center gap-5 @2xl:flex-row @2xl:justify-between",children:[c.jsxs("div",{className:"flex flex-col px-2 text-center @2xl:text-start",children:[c.jsx("span",{className:"text-md text-wrap font-semibold",children:n.formatMessage({id:"gt23pb",defaultMessage:"You are viewing a previous version"})}),c.jsx("span",{className:"text-wrap text-sm text-token-text-secondary",children:n.formatMessage({id:"sAlUJn",defaultMessage:"Restore this version to make edits"})})]}),c.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4",children:[c.jsx(Ie,{as:"button",color:"primary",onClick:t,children:n.formatMessage({id:"+cddAb",defaultMessage:"Restore this version"})}),c.jsx(Ie,{as:"button",color:"secondary",onClick:e,children:n.formatMessage({id:"qCD3eu",defaultMessage:"Back to latest version"})})]})]})})}const us={type:"spring",damping:35,stiffness:300},ls=({clientThreadId:t,turn:e})=>{const n=Qt(),s=Zt(e.messages);return c.jsxs(W.div,{className:"absolute left-0 right-0 top-0 z-10 -translate-y-full",children:[c.jsx(W.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-vert-light-gradient dark:bg-vert-dark-gradient"}),c.jsx(W.div,{className:"flex items-center px-6 py-2",initial:{opacity:.75,translateX:-50,translateY:"100%"},animate:{opacity:1,translateX:0,translateY:"0"},exit:{opacity:0,translateY:20},transition:us,children:c.jsx(kn,{clientThreadId:t,onChangeItemInView:G,onRequestCompletion:async r=>G(r),onRequestMoreCompletions:G,groupedMessagesToRender:s,allGroupedMessages:s,isEditing:!1,isUserTurn:!0,turnIndex:0,isCompletionRequestInProgress:!1,isFeedbackEnabled:!1,isFinalTurn:!1,hasActiveRequest:n,showEditButton:!1,handleEnterEdit:G,handleExitEdit:G})})]},"user-message")},cs=({clientThreadId:t})=>{const e=Jn(t),n=Wn(t,e),{lastUserTurn:s,lastAssistantTurn:r}=y.useMemo(()=>{let a=null,i=null;for(let l=n.length-1;l>0;l--){const u=n[l];if(!a&&u.role===tt.User?a=u:!i&&u.role===tt.Assistant&&(i=u),a&&i)break}return{lastUserTurn:a,lastAssistantTurn:i}},[n]),o=s&&!(r!=null&&r.messages.find(({message:a})=>{var i;return(i=a.recipient)==null?void 0:i.startsWith(Kt)}));return c.jsx(yt,{initial:!1,children:o&&c.jsx(ls,{turn:s,clientThreadId:t})})},fs=({isRequestActive:t=!1,clientThreadId:e,onCancel:n,onSubmit:s,onSubmitAccelerator:r,acceleratorActions:o=[]})=>{const[a,i]=y.useState(""),[l,u]=y.useState(!0),f=U(),m=()=>{s==null||s(a),i("")},g=v=>{const{metaKey:d,shiftKey:p,key:w}=v;w==="Enter"&&a.trim()&&!(p||d)&&(m(),v.preventDefault())};return c.jsxs("div",{className:"relative mb-3 flex max-w-2xl flex-1 justify-center",children:[c.jsx(cs,{clientThreadId:e}),c.jsx("div",{className:"flex flex-auto items-start",children:c.jsx("div",{className:Se("mx-6 flex min-h-12 flex-auto items-center bg-[#f4f4f4] py-1 pl-6 pr-2 dark:bg-token-main-surface-secondary",{"rounded-full":l,"rounded-2xl":!l}),children:c.jsxs("div",{className:"relative flex flex-auto items-center self-stretch",children:[c.jsx(Yn,{placeholder:f.formatMessage({id:"zrUbTJ",defaultMessage:"Ask ChatGPT to edit"}),disabled:t,value:a,className:"w-full resize-none border-0 bg-transparent p-0 text-token-text-primary outline-0 placeholder:text-token-text-secondary focus:ring-0 focus-visible:ring-0",maxRows:4,onChange:({target:{value:v}})=>i(v),onKeyDown:g,onHeightChange:(v,{rowHeight:d})=>u(Math.floor(v/d)<=1)}),a?c.jsx(W.button,{className:Se("dark h-8 w-8 rounded-full bg-token-main-surface-primary text-center dark:bg-token-main-surface-primary",{"self-end":!l}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:()=>m(),children:c.jsx($n,{className:"h-8 w-8 text-token-text-primary"})}):((o==null?void 0:o.length)??0)>0&&c.jsx(jn,{disableHint:!0,isEmbeddedInPromptArea:!0,isRequestActive:t,actions:o,onCancel:n,onSubmit:r,right:0,bottom:4})]})})})]})};function D(){}D.prototype={diff:function(e,n){var s,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=r.callback;typeof r=="function"&&(o=r,r={});var a=this;function i(C){return C=a.postProcess(C,r),o?(setTimeout(function(){o(C)},0),!0):C}e=this.castInput(e,r),n=this.castInput(n,r),e=this.removeEmpty(this.tokenize(e,r)),n=this.removeEmpty(this.tokenize(n,r));var l=n.length,u=e.length,f=1,m=l+u;r.maxEditLength!=null&&(m=Math.min(m,r.maxEditLength));var g=(s=r.timeout)!==null&&s!==void 0?s:1/0,v=Date.now()+g,d=[{oldPos:-1,lastComponent:void 0}],p=this.extractCommon(d[0],n,e,0,r);if(d[0].oldPos+1>=u&&p+1>=l)return i(at(a,d[0].lastComponent,n,e,a.useLongestToken));var w=-1/0,b=1/0;function x(){for(var C=Math.max(w,-f);C<=Math.min(b,f);C+=2){var M=void 0,I=d[C-1],L=d[C+1];I&&(d[C-1]=void 0);var z=!1;if(L){var _=L.oldPos-C;z=L&&0<=_&&_<l}var ee=I&&I.oldPos+1<u;if(!z&&!ee){d[C]=void 0;continue}if(!ee||z&&I.oldPos<L.oldPos?M=a.addToPath(L,!0,!1,0,r):M=a.addToPath(I,!1,!0,1,r),p=a.extractCommon(M,n,e,C,r),M.oldPos+1>=u&&p+1>=l)return i(at(a,M.lastComponent,n,e,a.useLongestToken));d[C]=M,M.oldPos+1>=u&&(b=Math.min(b,C-1)),p+1>=l&&(w=Math.max(w,C+1))}f++}if(o)(function C(){setTimeout(function(){if(f>m||Date.now()>v)return o();x()||C()},0)})();else for(;f<=m&&Date.now()<=v;){var E=x();if(E)return E}},addToPath:function(e,n,s,r,o){var a=e.lastComponent;return a&&!o.oneChangePerToken&&a.added===n&&a.removed===s?{oldPos:e.oldPos+r,lastComponent:{count:a.count+1,added:n,removed:s,previousComponent:a.previousComponent}}:{oldPos:e.oldPos+r,lastComponent:{count:1,added:n,removed:s,previousComponent:a}}},extractCommon:function(e,n,s,r,o){for(var a=n.length,i=s.length,l=e.oldPos,u=l-r,f=0;u+1<a&&l+1<i&&this.equals(s[l+1],n[u+1],o);)u++,l++,f++,o.oneChangePerToken&&(e.lastComponent={count:1,previousComponent:e.lastComponent,added:!1,removed:!1});return f&&!o.oneChangePerToken&&(e.lastComponent={count:f,previousComponent:e.lastComponent,added:!1,removed:!1}),e.oldPos=l,u},equals:function(e,n,s){return s.comparator?s.comparator(e,n):e===n||s.ignoreCase&&e.toLowerCase()===n.toLowerCase()},removeEmpty:function(e){for(var n=[],s=0;s<e.length;s++)e[s]&&n.push(e[s]);return n},castInput:function(e){return e},tokenize:function(e){return Array.from(e)},join:function(e){return e.join("")},postProcess:function(e){return e}};function at(t,e,n,s,r){for(var o=[],a;e;)o.push(e),a=e.previousComponent,delete e.previousComponent,e=a;o.reverse();for(var i=0,l=o.length,u=0,f=0;i<l;i++){var m=o[i];if(m.removed)m.value=t.join(s.slice(f,f+m.count)),f+=m.count;else{if(!m.added&&r){var g=n.slice(u,u+m.count);g=g.map(function(v,d){var p=s[f+d];return p.length>v.length?p:v}),m.value=t.join(g)}else m.value=t.join(n.slice(u,u+m.count));u+=m.count,m.added||(f+=m.count)}}return o}function it(t,e){var n;for(n=0;n<t.length&&n<e.length;n++)if(t[n]!=e[n])return t.slice(0,n);return t.slice(0,n)}function ut(t,e){var n;if(!t||!e||t[t.length-1]!=e[e.length-1])return"";for(n=0;n<t.length&&n<e.length;n++)if(t[t.length-(n+1)]!=e[e.length-(n+1)])return t.slice(-n);return t.slice(-n)}function Ae(t,e,n){if(t.slice(0,e.length)!=e)throw Error("string ".concat(JSON.stringify(t)," doesn't start with prefix ").concat(JSON.stringify(e),"; this is a bug"));return n+t.slice(e.length)}function De(t,e,n){if(!e)return t+n;if(t.slice(-e.length)!=e)throw Error("string ".concat(JSON.stringify(t)," doesn't end with suffix ").concat(JSON.stringify(e),"; this is a bug"));return t.slice(0,-e.length)+n}function Y(t,e){return Ae(t,e,"")}function ae(t,e){return De(t,e,"")}function lt(t,e){return e.slice(0,ms(t,e))}function ms(t,e){var n=0;t.length>e.length&&(n=t.length-e.length);var s=e.length;t.length<e.length&&(s=t.length);var r=Array(s),o=0;r[0]=0;for(var a=1;a<s;a++){for(e[a]==e[o]?r[a]=r[o]:r[a]=o;o>0&&e[a]!=e[o];)o=r[o];e[a]==e[o]&&o++}o=0;for(var i=n;i<t.length;i++){for(;o>0&&t[i]!=e[o];)o=r[o];t[i]==e[o]&&o++}return o}var de="a-zA-Z0-9_\\u{C0}-\\u{FF}\\u{D8}-\\u{F6}\\u{F8}-\\u{2C6}\\u{2C8}-\\u{2D7}\\u{2DE}-\\u{2FF}\\u{1E00}-\\u{1EFF}",ds=new RegExp("[".concat(de,"]+|\\s+|[^").concat(de,"]"),"ug"),ge=new D;ge.equals=function(t,e,n){return n.ignoreCase&&(t=t.toLowerCase(),e=e.toLowerCase()),t.trim()===e.trim()};ge.tokenize=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n;if(e.intlSegmenter){if(e.intlSegmenter.resolvedOptions().granularity!="word")throw new Error('The segmenter passed must have a granularity of "word"');n=Array.from(e.intlSegmenter.segment(t),function(o){return o.segment})}else n=t.match(ds)||[];var s=[],r=null;return n.forEach(function(o){/\s/.test(o)?r==null?s.push(o):s.push(s.pop()+o):/\s/.test(r)?s[s.length-1]==r?s.push(s.pop()+o):s.push(r+o):s.push(o),r=o}),s};ge.join=function(t){return t.map(function(e,n){return n==0?e:e.replace(/^\s+/,"")}).join("")};ge.postProcess=function(t,e){if(!t||e.oneChangePerToken)return t;var n=null,s=null,r=null;return t.forEach(function(o){o.added?s=o:o.removed?r=o:((s||r)&&ct(n,r,s,o),n=o,s=null,r=null)}),(s||r)&&ct(n,r,s,null),t};function ct(t,e,n,s){if(e&&n){var r=e.value.match(/^\s*/)[0],o=e.value.match(/\s*$/)[0],a=n.value.match(/^\s*/)[0],i=n.value.match(/\s*$/)[0];if(t){var l=it(r,a);t.value=De(t.value,a,l),e.value=Y(e.value,l),n.value=Y(n.value,l)}if(s){var u=ut(o,i);s.value=Ae(s.value,i,u),e.value=ae(e.value,u),n.value=ae(n.value,u)}}else if(n)t&&(n.value=n.value.replace(/^\s*/,"")),s&&(s.value=s.value.replace(/^\s*/,""));else if(t&&s){var f=s.value.match(/^\s*/)[0],m=e.value.match(/^\s*/)[0],g=e.value.match(/\s*$/)[0],v=it(f,m);e.value=Y(e.value,v);var d=ut(Y(f,v),g);e.value=ae(e.value,d),s.value=Ae(s.value,f,d),t.value=De(t.value,f,f.slice(0,f.length-d.length))}else if(s){var p=s.value.match(/^\s*/)[0],w=e.value.match(/\s*$/)[0],b=lt(w,p);e.value=ae(e.value,b)}else if(t){var x=t.value.match(/\s*$/)[0],E=e.value.match(/^\s*/)[0],C=lt(x,E);e.value=Y(e.value,C)}}var hs=new D;hs.tokenize=function(t){var e=new RegExp("(\\r?\\n)|[".concat(de,"]+|[^\\S\\n\\r]+|[^").concat(de,"]"),"ug");return t.match(e)||[]};var ve=new D;ve.tokenize=function(t,e){e.stripTrailingCr&&(t=t.replace(/\r\n/g,`
`));var n=[],s=t.split(/(\n|\r\n)/);s[s.length-1]||s.pop();for(var r=0;r<s.length;r++){var o=s[r];r%2&&!e.newlineIsToken?n[n.length-1]+=o:n.push(o)}return n};ve.equals=function(t,e,n){return n.ignoreWhitespace?((!n.newlineIsToken||!t.includes(`
`))&&(t=t.trim()),(!n.newlineIsToken||!e.includes(`
`))&&(e=e.trim())):n.ignoreNewlineAtEof&&!n.newlineIsToken&&(t.endsWith(`
`)&&(t=t.slice(0,-1)),e.endsWith(`
`)&&(e=e.slice(0,-1))),D.prototype.equals.call(this,t,e,n)};function ps(t,e,n){return ve.diff(t,e,n)}var gs=new D;gs.tokenize=function(t){return t.split(/(\S.+?[.!?])(?=\s+|$)/)};var vs=new D;vs.tokenize=function(t){return t.split(/([{}:;,]|\s+)/)};function Ne(t){"@babel/helpers - typeof";return Ne=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ne(t)}var Q=new D;Q.useLongestToken=!0;Q.tokenize=ve.tokenize;Q.castInput=function(t,e){var n=e.undefinedReplacement,s=e.stringifyReplacer,r=s===void 0?function(o,a){return typeof a>"u"?n:a}:s;return typeof t=="string"?t:JSON.stringify(Le(t,null,null,r),r,"  ")};Q.equals=function(t,e,n){return D.prototype.equals.call(Q,t.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"),n)};function Le(t,e,n,s,r){e=e||[],n=n||[],s&&(t=s(r,t));var o;for(o=0;o<e.length;o+=1)if(e[o]===t)return n[o];var a;if(Object.prototype.toString.call(t)==="[object Array]"){for(e.push(t),a=new Array(t.length),n.push(a),o=0;o<t.length;o+=1)a[o]=Le(t[o],e,n,s,r);return e.pop(),n.pop(),a}if(t&&t.toJSON&&(t=t.toJSON()),Ne(t)==="object"&&t!==null){e.push(t),a={},n.push(a);var i=[],l;for(l in t)Object.prototype.hasOwnProperty.call(t,l)&&i.push(l);for(i.sort(),o=0;o<i.length;o+=1)l=i[o],a[l]=Le(t[l],e,n,s,l);e.pop(),n.pop()}else a=t;return a}var _e=new D;_e.tokenize=function(t){return t.slice()};_e.join=_e.removeEmpty=function(t){return t};var ue=(t=>(t.ADDED="added",t.REMOVED="removed",t.UNCHANGED="unchanged",t))(ue||{});function Oe(t){if(t==="")return 0;const e=t.split(`
`).length;return t.endsWith(`
`)?e-1:e}function Cs(t,e){return ps(t,e,{newlineIsToken:!0}).map(s=>({count:s.count??Oe(s.value),value:s.value,type:s.added?"added":s.removed?"removed":"unchanged"}))}function ys(t){let e="";for(const{type:n,value:s}of t)(n==="added"||n==="unchanged")&&(e+=s);return e}function Ts(t,e){const n=Oe(e),s=xs(t,n);return{changes:Cs(s,e),numLinesDiffed:n}}function ws(t){const e=[...t],n=[],s=[];for(;e.length>0;){const r=e[e.length-1];if(r.type===ue.REMOVED)e.pop(),r.type===ue.REMOVED&&n.unshift(r);else if(r.type===ue.ADDED)e.pop(),s.unshift(r);else break}return{prunedChanges:[...e,...s],prunedRemovedChanges:n}}function Es(t,e){const{changes:n,numLinesDiffed:s}=Ts(t,e),{prunedChanges:r,prunedRemovedChanges:o}=ws(n),a=ys(r),i=o.map(u=>u.value).join(`
`),l=xt(t,s,"start");return{content:a+i+l,numLinesDiffed:Oe(a)}}function xs(t,e){if(e<=0)return"";let n=0,s=t.length;for(let r=0;r<t.length;r++)if(t[r]===`
`&&(n++,n===e)){s=r+1;break}return t.substring(0,s)}function xt(t,e,n="start"){if(e<=0)return t;if(n==="start"){let a=0;for(let i=0;i<t.length;i++)if(t[i]===`
`&&(a++,a===e))return t.substring(i+1);return""}let s=0,r=-1;const o=t.endsWith(`
`)?e+1:e;for(let a=t.length-1;a>=0;a--)if(t[a]===`
`&&(s++,s===o)){r=a;break}return r===-1?"":t.substring(0,r+1)}function bs(t,e){const n=(t==null?void 0:t.type)??ie.LOADING,s=(t==null?void 0:t.content)??"",r=!!(t!=null&&t.isPartial);if(!he(n)||e==null||!r||(t==null?void 0:t.isRewriting)!==!0)return{content:s,currentlyStreamingLineIndex:null};const o=xt(s,1,"end");if(o==="")return{content:e.content,currentlyStreamingLineIndex:0};const a=Es(e.content,o);return{content:a.content,currentlyStreamingLineIndex:a.numLinesDiffed}}var le=(t=>(t.Close="close",t.Loaded="loaded",t.Streaming="streaming",t.Download="download",t))(le||{});function Ms({textdocVersion:t}){const e=U(),n=Ut(),[s,r]=y.useState(!1),o=Ht(),a=y.useRef((t==null?void 0:t.content)??"");y.useEffect(()=>{a.current=(t==null?void 0:t.content)??""},[t]);const i=l=>{s||(o(()=>{P.logButtonClick(fe.COPY,{contentLength:a.current.length,textdocType:t==null?void 0:t.type}),Vt(a.current,n,l)},0),r(!0),o(()=>r(!1),2e3))};return c.jsx(ce,{label:e.formatMessage(Is.copy),children:c.jsx(X,{icon:s?Un:Hn,onClick:i})})}const Is=Re({copy:{id:"rbIYfo",defaultMessage:"Copy"}});function Ss({textdocId:t,version:e,isHistorical:n,nextVersion:s,onHoverPrevious:r,textdocType:o}){const a=U(),i=e==null||e===1,l=e!=null&&e>1;return i&&!n?null:c.jsxs("div",{className:"flex items-center gap-1.5",children:[c.jsx(ce,{label:l&&a.formatMessage({id:"PoD5+8",defaultMessage:"Previous version"}),children:c.jsx(X,{disabled:!l,icon:Fn,onMouseOver:r,onClick:()=>{P.logButtonClick(fe.HISTORY_PREVIOUS,{textdocType:o}),t&&e&&l&&ke(t,{beforeVersion:e})}})}),c.jsx(ce,{label:n&&a.formatMessage({id:"PJ8YVJ",defaultMessage:"Next version"}),children:c.jsx(X,{disabled:!n,icon:Bn,onClick:()=>{P.logButtonClick(fe.HISTORY_NEXT,{textdocType:o}),n&&(s?ke(t,{version:s}):pe(t))}})})]})}function ks({textdocId:t,history:e,version:n,isShowingChanges:s}){const{data:r}=Tt(t,(n==null?void 0:n.versionInt)??null),o=en(),a=U(),i=(r==null?void 0:r.textdocEdits)??[],l=()=>{e?ke(t,e):pe(t)};if(s)return c.jsx(Ie,{color:"primary",onClick:l,children:c.jsx(Ft,{...ft.done})});const u=n&&i.length>0,f=()=>{(n==null?void 0:n.versionInt)!=null&&tn(t,n.versionInt)},m=()=>{(n==null?void 0:n.versionInt)!=null&&o(t,n.versionInt)};return c.jsx(ce,{label:u&&a.formatMessage(ft.showChanges),children:c.jsx(X,{icon:zn,disabled:!u,onClick:f,onMouseOver:m})})}const ft=Re({done:{id:"0MCBfo",defaultMessage:"Done"},showChanges:{id:"3jMGNS",defaultMessage:"Show changes"}}),As=800,Ds=100,mt=100,Ns=({textdocId:t,isHistoricalVersion:e,nextHistoricalTextdocVersion:n,textdocVersion:s,readonlyReason:r,history:o,hasDebug:a,contentWidth:i,isEmbedded:l,isPersisting:u,isShowChangesFeatureEnabled:f,isShowingChanges:m,hideHistoryActions:g=!1,prefetchHistoricalTextdocVersion:v,restoreHistoricalTextdocVersion:d,setShowDebugView:p,onClose:w})=>{const b=nn((s==null?void 0:s.title)??""),[{width:x},E]=wt(),C=i-x-Ds-mt>0;return c.jsxs(J.Header,{children:[c.jsxs("div",{className:"flex flex-1 items-center leading-[0]",children:[c.jsx(J.CloseButton,{onClick:w}),C&&c.jsx("div",{className:"flex flex-row items-center gap-2.5",children:c.jsx(J.Title,{style:{maxWidth:i-x-mt},children:b||c.jsx("div",{className:"w-52",children:c.jsx(ns,{lines:1,size:"base",width:100,widthVariance:0})})})}),u&&c.jsx(sn,{size:12,className:"pl-2 text-token-text-secondary"})]}),c.jsxs("div",{className:"flex select-none items-center gap-2 leading-[0]",ref:E,children:[c.jsxs("div",{className:Se("flex items-center gap-2 transition-opacity duration-500",r===O.Streaming&&"pointer-events-none opacity-0"),children:[a&&i>As&&c.jsx(X,{icon:Gn,onClick:()=>p(M=>!M)}),!m&&!g&&c.jsx(Ss,{textdocId:t,isHistorical:e,version:s==null?void 0:s.versionInt,nextVersion:n==null?void 0:n.versionInt,readonlyReason:r,onHoverPrevious:v,onClickRestore:d,textdocType:s==null?void 0:s.type}),!g&&f&&c.jsx(ks,{textdocId:t,history:o,version:s,isShowingChanges:m}),c.jsx(Ms,{textdocVersion:s})]}),!l&&!m&&c.jsx(Kn,{})]})]})},Ls=/\s/,_s=30;function dt(t,e){const n=t.indexOf(e);return n===-1?!1:t.indexOf(e,n+e.length)===-1}function j(t,e){return Ls.test(t[e])}function ht(t,e,n=!1){if(e===0||n&&j(t,e-1))return e;for(;e>0&&j(t,e-1);)e--;for(;e>0&&!j(t,e-1);)e--;return j(t,e)&&e++,e}function pt(t,e,n=!1){if(e===t.length||n&&j(t,e))return e;for(;e<t.length&&j(t,e);)e++;for(;e<t.length&&!j(t,e);)e++;return j(t,e-1)&&e--,e}function Rs(t,e,n=!0,s=_s){if(t.start<0||t.end>e.length||t.start>t.end)throw new Error("Invalid commentSourceRange provided.");const r=e.substring(t.start,t.end);let o=t.start,a=t.end;n&&(o=ht(e,o,!0),a=pt(e,a,!0));let i=e.substring(o,t.start),l=e.substring(t.end,a),u=`${i}${r}${l}`;if(dt(e,u)&&(s==null||u.length>=s))return{before:i,after:l,allSurrounding:u};let f=o,m=a,g=!0;for(;g&&(s==null||u.length<s);){let v=!1;const d=f>0?ht(e,f):f;d<f&&(f=d,v=!0);const p=m<e.length?pt(e,m):m;if(p>m&&(m=p,v=!0),v){const w=e.substring(f,t.start),b=e.substring(t.end,m),x=`${w}${r}${b}`;if(dt(e,x)&&(s==null||x.length>=s))return{before:w,after:b,allSurrounding:x};i=w,l=b,u=x}else g=!1}return{before:i,after:l,allSurrounding:u}}const Z="# Context",K="# Instructions";function V(t,e,n){if(e==null||n==null)return`The user is referring to the entire text of "${t}".`;const s=`
## Selected Text
The user has selected this text in "${t}" in particular:
${e}
`.trim();return n.allSurrounding===e?s:`
${s}

## Surrounding Context
Here is the surrounding context:
${n.allSurrounding}
`.trim()}function bt(t,e){return t==null||e==null?"entire document":t===e.allSurrounding?"selected text":"surrounding context"}function Mt(t){return`For the update pattern, create a regex which exactly matches the ${t}. Edit just this string in order to fullfill the user's request. NEVER rewrite the entire document. Instead, ALWAYS edit ONLY the ${t}. The only exception to this rule is if the ${t} includes markdown lists or tables. In that case, fully rewrite the document using ".*" as the regex update pattern.`.trim()}function Os(t,e,n,s){if(!he(e)&&n&&s){const r=bt(n,s);return`
${Z}
The user requests that you directly edit the document.

${V(t,n,s)}

${K}
Use the update_textdoc tool to make this edit. ${Mt(r)}`.trim()}return`
${Z}
The user requests that you directly edit the document.

${V(t,n,s)}

${K}
Use the update_textdoc tool to make this edit. You MUST fully rewrite the entire document by using ".*" as the update regex pattern.`.trim()}function Ps(t,e,n){return`
${Z}
The user requests that you add comments about some text.

${V(t,e,n)}

${K}
Do not respond to the user's question directly, just leave comments.`.trim()}function js(t,e){return he(t)?e==="entire document"?` If you choose to update the ${e}, you MUST fully rewrite the ${e} by using ".*" as the update regex pattern.`:` If you choose to update the ${e}, you MUST fully rewrite the entire document by using ".*" as the update regex pattern. When you do so, ONLY modify the ${e} and rewrite other sections exactly as is, except for parts that must change based on this update`:e==="entire document"?"":` If you choose to update the ${e}, follow these instructions: ${Mt(e)}`}function qs(t,e,n,s){const r=bt(n,s),o=js(e,r);return`
${Z}
${V(t,n,s)}

${K}
The user would like you perform one of the following actions:
- Update the ${r} via the \`update_textdoc\` tool.${o}
- Explain the selected text via chat, or answer a general question about the selected text (no tool call required).
- Comment on the ${r} with feedback via the \`comment_textdoc\` tool. This should only be used if the user very explicitly asks for feedback, critique, or comments.

Based on the user's request, choose the appropriate action.
`.trim()}function $s(t,e,n){return`
${Z}
${V(t,e,n)}

${K}
The user would like you to create a new textdoc.
`.trim()}function Us(t,e,n,s=null,r=null){switch(n){case B.ASK:return qs(t,e,s,r);case B.CREATE_TEXTDOC:return $s(t,s,r);case B.EDIT:return Os(t,e,s,r);case B.COMMENT:return Ps(t,s,r)}}function Hs(t){const e=ss(),n=An(t),s=rs(t)??e.id,r=Dn({clientThreadId:t});return async function(o){const a=new rn,i=Xn.getThreadCurrentLeafId(t),l=performance.now(),u=await Bt(),[f,m,g]=await Promise.all([zt.getEnforcementToken(u),on.getEnforcementToken(u),Gt.getEnforcementToken(u)]);r({model:s,completionType:Yt.Next,parentNodeId:i,metadata:{eventSource:"mouse"},completionMetadata:{conversationMode:n},chatReq:u,arkoseToken:f??null,turnstileToken:m??null,proofToken:g??null,preflightTime:performance.now()-l,appendMessages:o,turnTracker:a})}}function Fs(t){switch(t){case k.ACCELERATOR:case k.ACCEPT_COMMENT:return!0;case k.ASK_CHATGPT:case k.FULL_SCREEN_SUBMIT:return!1}}function Bs(t,e){switch(e){case k.ASK_CHATGPT:case k.ACCEPT_COMMENT:case k.FULL_SCREEN_SUBMIT:return t.formatMessage(Gs.askChatGPT);case k.ACCELERATOR:return}}const zs=(t,e)=>{const n=Hs(t),s=U();return y.useCallback(({content:r,sourceRange:o,action:a,userMessageType:i,acceleratorMetadata:l,selectionMetadata:u})=>{if((e==null?void 0:e.versionInt)==null)return;const{textdocId:f,type:m,versionInt:g,content:v}=e;let d,p=null;o&&(d=v.slice(o.start,o.end),p=Rs(o,v)),n([an([r],{canvas:{textdoc_id:f,textdoc_type:m,version:g,textdoc_content_length:v.length,user_message_type:i,accelerator_metadata:l,selection_metadata:u},is_visually_hidden_from_conversation:Fs(i),targeted_reply:d,targeted_reply_label:Bs(s,i),open_in_canvas_view:{type:"canvas_textdoc",id:f}}),un([Us(f,m,a,d,p)],{exclude_after_next_user_message:!0})])},[n,s,e])},Gs=Re({askChatGPT:{id:"h5ANdM",defaultMessage:"Asked ChatGPT"}});function Ys(t){const e=/\[([^\]]+)\]\((https?:\/\/[^\s)]+|www\.[^\s)]+)\)/gi,n=new Set,s=t.matchAll(e);for(const r of s){const o=r[2];try{let a=o;a.startsWith("www.")&&(a="http://"+o),new URL(a),n.add(o)}catch{}}return n}const Js=async({lastVersion:t,textdocId:e,content:n,comments:s})=>{const r=ln(s,n);return(await vt.safePost("/textdoc/{textdoc_id}",{parameters:{path:{textdoc_id:e}},requestBody:{version:t,content:n,comments:r}})).version},Ws=()=>{const t=y.useRef([]),e=y.useRef(null),{mutateAsync:n,isPending:s}=Jt({mutationKey:["canvas","textdoc","persist"],mutationFn:Js});return[y.useCallback(async(o,a,i)=>{const l=new AbortController,f=(async()=>{const[d]=t.current;try{await(d==null?void 0:d.promise)}catch(p){P.logError("Saving document",p)}if(!l.signal.aborted)try{const p=Math.max(e.current??0,o.versionInt??Et);let w="";try{nt(a)?w=a():w=a}catch(C){P.logError("Serializing document",C)}let b=[];try{nt(i)?b=i():b=i}catch(C){P.logError("Adjusting comments",C)}const{textdocId:x}=o;cn({textdocId:x,basedOnVersionInt:p,content:w,comments:b});const E=await n({textdocId:x,lastVersion:p,content:w,comments:b});fn({textdocId:x,basedOnVersionInt:p,newVersion:E}),e.current=E}catch(p){P.logError("Error saving document",p)}finally{t.current.shift()}})(),m={abort:()=>l.abort(),promise:f},[g,v]=t.current;return v&&(v.abort(),t.current=g?[g]:[]),t.current=g?[g,m]:[m],f},[n]),t,s]},Xs=3e3,Qs=t=>{const[e,n,s]=Ws(),r=U(),o=y.useRef(null),a=y.useCallback(mn(e,Xs,{leading:!1}),[e]),i=dn(t);return y.useEffect(()=>{if(!i)return;const u=st(window,{pagehide:()=>a.flush(),beforeunload:m=>{a.flush(),m.returnValue=r.formatMessage({id:"QZrKwi",defaultMessage:"You have a canvas save in progress."})}}),f=st(document,{visibilitychange:()=>a.flush(),keydown:()=>{o.current="keyboard"},mousemove:()=>{o.current!=="mouse"&&a.flush(),o.current="mouse"}});return()=>{o.current=null,f(),u()}},[r,i,a]),y.useEffect(()=>()=>{a.flush()},[t,a]),hn(async()=>{var u;await a.flush(),await Promise.allSettled(((u=n.current)==null?void 0:u.map(({promise:f})=>f))??[])}),[y.useCallback((u,f,m)=>{const{textdocId:g}=u;return pn(g),a(u,f,m)},[a]),a.flush,s||i]};function Zs(t,e,n){const s=Ct(),r=n!=null&&e!=null,{data:o,error:a,fetchNextPage:i,hasNextPage:l,isFetching:u}=Wt(gt(t,e,r)),f=y.useCallback(async()=>{const d=e!=null;await s.prefetchInfiniteQuery(gt(t,e,d))},[s,t,e]);y.useEffect(()=>{const d=e;return()=>{s.removeQueries({queryKey:It(t,d),exact:!0})}},[s,t,e]);const[m,g,v]=y.useMemo(()=>{if(o&&n){const d=o.pages.flatMap(w=>w),p=d.findIndex(w=>"beforeVersion"in n?(w.versionInt??Et)<n.beforeVersion:w.versionInt===n.version);if(p!==-1)return[p===d.length-1,d[p],p>0?d[p-1]:null]}return[!0,null,null]},[o,n]);return y.useEffect(()=>{!u&&r&&l&&m&&i()},[u,r,l,m,i]),y.useEffect(()=>{!g&&a&&pe(t)},[g,a,t]),{historicalTextdocVersion:g,nextHistoricalTextdocVersion:v,prefetchHistoricalTextdocVersion:f}}function It(t,e=null){return["textdocHistory",t,e]}function gt(t,e,n=!0){return{queryKey:It(t,e),queryFn:({pageParam:s})=>Ks(t,s),initialPageParam:e??void 0,getNextPageParam:s=>{var o;const r=(o=gn(s))==null?void 0:o.versionInt;if(r&&r>1)return r},enabled:n,staleTime:1/0,retry:2}}async function Ks(t,e){return e===void 0?[]:(await vt.safeGet("/textdoc/{textdoc_id}/history",{parameters:{path:{textdoc_id:t},query:{before_version:e}}})).previous_doc_states.map(({id:s,version:r,textdoc_type:o,title:a,content:i,updated_at:l,comments:u})=>({textdocId:s,versionInt:r,messageId:null,title:a,type:vn(o),content:i,createdAt:Cn(l),comments:yn(u,i)}))}const hr=({isFullScreen:t=!1,isEmbedded:e=!1,hideHeader:n=!1,readonlyReason:s,clientThreadId:r,focusedTextdoc:o,onClose:a,isAnimating:i=!1,width:l})=>{var Ve,et;const{textdocId:u,history:f,showChangesAtVersion:m=null}=o,[g,v,d]=Qs(u),{targetedContent:p}=Tn(),w=Vn(),[b,x]=y.useState(!1),E=es(u),C=ts(),M=Qn(r),I=wn(M),[L,z]=wt(),_=En(),{data:ee}=Tt(u,_?m:null),{textdocEdits:Pe,previousContent:je}=ee??{},N=(E==null?void 0:E.versions)??[],St=(Ve=N[0])==null?void 0:Ve.versionInt,{historicalTextdocVersion:qe,nextHistoricalTextdocVersion:kt,prefetchHistoricalTextdocVersion:At}=Zs(u,St,f);y.useEffect(()=>{me.reset()},[u]),y.useEffect(()=>{var T;(T=E==null?void 0:E.metadata)!=null&&T.textdocId&&Me().sendMessage({type:le.Loaded})},[(et=E==null?void 0:E.metadata)==null?void 0:et.textdocId]);const $e=N.length>0?N[N.length-1]:null,q=N.length>1?N[N.length-2]:null,Ue=Zn(r),{restoreHistoricalTextdocVersion:He,optimisticRestoredTextdocVersion:Dt}=xn(Ue,$e,qe),H=f!=null,h=H?qe:$e,te=zs(r,h),ne=y.useMemo(()=>i?[]:(h==null?void 0:h.comments.filter(T=>T.status!==bn.DISMISSED))??[],[i,h]),Fe=y.useMemo(()=>i||!_?[]:Pe??[],[i,_,Pe]),Ce=(h==null?void 0:h.type)??ie.LOADING,$=!!(h!=null&&h.isPartial);y.useEffect(()=>{N.length===0&&!C&&(a==null||a())},[N.length,a,C]);const Nt=!!s&&s!==O.OldVersion,ye=_&&m!=null&&Fe.length>0,Te=$&&!!(h!=null&&h.isRewriting),Lt=$&&!!(h!=null&&h.isCreation),{content:se,currentlyStreamingLineIndex:Be}=je!=null?{content:je,currentlyStreamingLineIndex:null}:bs(h,q),_t=os(Ue,Array.from(Ys(se))),[re,we]=as({value:se,isRequestActive:I,isTextdocStreaming:$,comments:ne}),ze=Mn(h),Ge=$||I||re||d;y.useEffect(()=>{Me().sendMessage({type:le.Streaming,streaming:Ge})},[Ge]);const Rt=({getSerializedDocument:T,getAdjustedComments:A})=>{h&&g(h,T,A)},Ot=T=>{if(!h)return;const A=T.doc.toString();g(h,A,T.field(On,!1)??[])},Ye=(T,A,R,F)=>{we(!0),te({action:A,content:T,userMessageType:k.ASK_CHATGPT,sourceRange:R,selectionMetadata:{selection_type:F,selection_position_range:R}})},Je=({id:T})=>{ze(T,rt.DISMISS),me.reset()},We=async T=>{we(!0);const{id:A,at:R,content:F}=T;if(await ze(A,rt.ACCEPT)===!1)return we(!1);te({content:F,userMessageType:k.ACCEPT_COMMENT,sourceRange:R,action:B.EDIT,selectionMetadata:{selection_type:ot.SELECTION,selection_position_range:R}})},Ee=(T,A,R)=>{const{action:F}=R;te({action:F,content:A,sourceRange:T,userMessageType:k.ACCELERATOR,acceleratorMetadata:{action:F,id:R.id,prompt:A},selectionMetadata:T!=null?{selection_type:ot.SELECTION,selection_position_range:T}:void 0})},Pt=T=>{te({action:B.EDIT,content:T,userMessageType:k.FULL_SCREEN_SUBMIT})},jt=Xt(),qt=Ct(),$t=In(({resolveTempCommentId:T})=>T),Xe=T=>$t[T]||T,xe=()=>_n({clientThreadId:r,currentRequestId:M,queryClient:qt,isHistoryAndTrainingDisabled:jt});let S=s;H?S=O.OldVersion:ye?S=O.ShowingChanges:Dt!=null?S=O.Restoring:($||I)&&(S=O.Streaming);let oe=null;const Qe=i||S!=null||re,Ze=i&&ne.length>0||H||S!=null&&S!==O.Streaming,Ke=t||i;let be=[];switch(Ce){case ie.LOADING:oe=c.jsx(Rn,{});break;case ie.DOCUMENT:oe=c.jsx(Ln,{value:se,comments:ne,previousValue:q==null?void 0:q.content,previousComments:q==null?void 0:q.comments,isRewriting:Te,isAnimatingFromPreview:i,getStableCommentId:Xe,edits:Fe,isRequestActive:I,isDisabled:S!=null||C,isWaitingForCommentResponse:re,hideAccelerators:Ke,hideToolbar:Qe,hideEditOverlay:i,hideComments:Ze,readonlyReason:S,canvasContentRect:L,onBlur:v,onSave:v,onChange:Rt,onCancelRequest:xe,targetedContent:p,onAddComment:Ye,onAcceptComment:We,onDismissComment:Je,onSubmitAccelerator:Ee,safeUrls:_t,width:l,modelCursor:$&&!Te?h==null?void 0:h.modelCursor:void 0,shouldResetSelection:(h==null?void 0:h.versionInt)===1}),be=qn;break;default:he(Ce)&&(oe=c.jsx(Nn,{id:"codemirror",getStableCommentId:Xe,language:Sn(Ce),value:se,comments:ne,hideAccelerators:Ke,hideComments:Ze,hideToolbar:Qe,onSubmitAccelerator:Ee,currentlyStreamingLineIndex:Be??null,readonlyReason:S,isRequestActive:I,isWaitingForCommentResponse:re,onChange:Ot,onCancelRequest:xe,onAddComment:Ye,onDismissComment:Je,onAcceptComment:We,modelCursor:$&&Be==null?h==null?void 0:h.modelCursor:void 0}),be=Pn)}return c.jsxs(J,{children:[!n&&c.jsx(Ns,{textdocId:u,isHistoricalVersion:H,nextHistoricalTextdocVersion:kt,textdocVersion:h,readonlyReason:S,history:f,hasDebug:w,contentWidth:L.width,isEmbedded:e,isPersisting:d,isShowChangesFeatureEnabled:_,isShowingChanges:ye,hideHistoryActions:S===O.QueryParam,prefetchHistoricalTextdocVersion:At,restoreHistoricalTextdocVersion:He,setShowDebugView:x,onClose:()=>{const T=Me();T.isNative&&T.sendMessage({type:le.Close}),P.logButtonClick(fe.CLOSE_TEXTDOC,{textdocType:h==null?void 0:h.type}),a==null||a()}}),c.jsxs(J.Content,{ref:z,scrollToBottomMode:Lt?"bottom":"top",shouldScrollToTop:Te,children:[!1,oe]}),c.jsx(yt,{children:!ye&&H&&!Nt&&c.jsx(is,{onClickRestore:He,onClickResetLatest:()=>pe(u)})}),t&&!H&&c.jsx("div",{className:"relative flex items-center justify-center pb-3",children:c.jsx(fs,{isRequestActive:I,clientThreadId:r,onSubmitAccelerator:Ee,onSubmit:Pt,onCancel:xe,acceleratorActions:be})})]})};export{hr as T};
//# sourceMappingURL=b7w9m1pv5sv73e9x.js.map
