import{j as M,r as C,c as Pt}from"./nqo5y2f0dorhrqsr.js";import{d as H,S as W,D as v,E as T,c as te,A as it,n as fe,F as Ut,V as Me,P as Te,g as st,i as re,R as lt,G as at,W as Be,h as Kt,u as $t,B as qt,a as _e,J as zt,y as Jt,K as Zt,p as Qt,L as Yt,N as X,O as We,Q as Xt,U as en,X as tn,Y as nn,Z as rn,_ as on,$ as sn,a0 as ln,a1 as an,a2 as cn,a3 as me,a4 as fn,a5 as dn}from"./gjkg5f2h569ez3qj.js";import{as as ct,e as ft,n as de,bE as un,F as hn,a as mn}from"./i4np6cv57rki7vb1.js";import{ka as gn,dw as dt,kb as pn,aY as Cn,d0 as xn,jS as ut,kc as Ae,g as En}from"./c0tidrcnxh2cm8mc.js";import{B as wn,G as An,y as bn,z as Sn,x as kn,J as vn,A as Ln,K as Mn,u as Tn,v as Bn,M as Dn,O as yn,w as On,Q as Nn,R as Rn}from"./ja2da1wuzb1lgox5.js";import{e as Gn,Z as Hn,f as In,C as ge,h as _n,i as Wn}from"./dqh5um3h6p6wol34.js";import{s as Vn,v as jn,a as Fn,g as Pn,b as pe,T as Un,c as Kn,A as Ve,u as $n,i as qn,C as zn,d as Jn}from"./lad8u6x58cxdssud.js";import{c as Zn}from"./fpwmsu1awpj0g2ko.js";import"./gdesxkqxsoz75aum.js";import"./itzwlfoi7caa8gqm.js";import"./ergxkgfpa1klt06l.js";import"./l26obrirrfjcwlw1.js";import"./mm25miyl2g2larye.js";import"./fzrn137102spawew.js";import"./jduckhgljimdwo8y.js";import"./pm2iuyzv6hhuv1bc.js";import"./l35pvk6j2ug7fgbc.js";import"./gadxbxgurucfd90p.js";import"./ftzkqhrwb7sqtgq0.js";import"./ehu6hsbnosptkam5.js";import"./ht6ipl79v3uy6uee.js";import"./l35d2tk815idlvbz.js";const be=H.define(),ht=W.define({create:()=>null,update:(e,t)=>{const n=t.effects.find(i=>i.is(be));return n?n.value:e}}),Qn=e=>v.line({class:"!bg-[Highlight]"}).range(e),Yn=e=>v.line({class:"streaming-line-overlay before:content-['*'] before:bg-white/50 dark:before:bg-gray-750/50"}).range(e),Xn=W.define({create:()=>v.none,update:(e,t)=>{e=e.map(t.changes);const n=t.state.field(ht);if(n==null)return v.none;const i=t.state.doc,o=n+1;if(o>i.lines)return v.none;const r=i.line(o),s=Qn(r.from),a=Array.from({length:i.lines-o},(c,f)=>Yn(i.line(o+1+f).from));return v.set([s,...a])},provide:e=>T.decorations.from(e)}),er=e=>[ht.init(()=>e),Xn],mt=H.define(),gt=H.define(),pt=H.define(),Ct=H.define(),Se=(e,t)=>e.doc.line(t).from,le=(e,t,n,i)=>{const o=Se(t,n),r=v.line({attributes:{class:ct("transition-colors bg-transparent",i===1&&"bg-yellow-100 dark:bg-yellow-500 dark:bg-opacity-50")}}).range(Se(t,n));return e.update({add:i===3?[]:[r],filter:s=>s!==o})},tr=W.define({create(){return v.none},update(e,t){for(let n of t.effects){const{value:i}=n;if(n.is(mt))return le(e,t.state,i,0);if(n.is(gt))return le(e,t.state,i,1);if(n.is(pt))return le(e,t.state,i,2);if(n.is(Ct))return le(e,t.state,i,3)}return e.map(t.changes)},provide:e=>T.decorations.from(e)}),nr=[tr];function rr(e,t,n=500){e.dispatch({effects:mt.of(t)});const i=Se(e.state,t);e.dispatch({selection:{anchor:i,head:i},scrollIntoView:!0}),requestAnimationFrame(()=>{e.dispatch({effects:gt.of(t)})}),setTimeout(()=>{e.dispatch({effects:pt.of(t)}),setTimeout(()=>{e.dispatch({effects:Ct.of(t)})},150)},n),e.focus()}function or(e){return e.toString().length}function ir(e,t,n){return i=>{if(!i.docChanged)return i;const o=or(i.state.doc);if(o<=e)return i;n&&t&&gn(n,t);const r=i.state.doc.sliceString(0,e),s=i.startState.update({changes:{from:0,to:i.startState.doc.length,insert:r}});return dt.logEvent(ft.canvasCodemirrorMaxLength,{maxLength:e,newLength:o}),[s]}}function sr(e,t,n){return[te.transactionFilter.of(ir(n,e,t))]}const xt=it.define();function lr(){return T.updateListener.of(e=>{if(!e.docChanged||e.state.readOnly)return;const t=e.state.doc;t.length>0&&t.sliceString(t.length-1)!==`
`&&e.view.dispatch({changes:{from:t.length,to:t.length,insert:`
`},annotations:xt.of(!0)})})}class k{constructor(t,n,i,o){this.fromA=t,this.toA=n,this.fromB=i,this.toB=o}offset(t,n=t){return new k(this.fromA+t,this.toA+t,this.fromB+n,this.toB+n)}}function U(e,t,n,i,o,r){if(e==i)return[];let s=De(e,t,n,i,o,r),a=ye(e,t+s,n,i,o+s,r);t+=s,n-=a,o+=s,r-=a;let c=n-t,f=r-o;if(!c||!f)return[new k(t,n,o,r)];if(c>f){let d=e.slice(t,n).indexOf(i.slice(o,r));if(d>-1)return[new k(t,t+d,o,o),new k(t+d+f,n,r,r)]}else if(f>c){let d=i.slice(o,r).indexOf(e.slice(t,n));if(d>-1)return[new k(t,t,o,o+d),new k(n,n,o+d+c,r)]}if(c==1||f==1)return[new k(t,n,o,r)];let l=At(e,t,n,i,o,r);if(l){let[d,u,h]=l;return U(e,t,d,i,o,u).concat(U(e,d+h,n,i,u+h,r))}return ar(e,t,n,i,o,r)}let ee=1e9;function ar(e,t,n,i,o,r){let s=n-t,a=r-o;if(ee<1e9&&Math.min(s,a)>ee*16)return Math.min(s,a)>ee*64?[new k(t,n,o,r)]:je(e,t,n,i,o,r);let c=Math.ceil((s+a)/2);Ce.reset(c),xe.reset(c);let f=(h,g)=>e.charCodeAt(t+h)==i.charCodeAt(o+g),l=(h,g)=>e.charCodeAt(n-h-1)==i.charCodeAt(r-g-1),d=(s-a)%2!=0?xe:null,u=d?null:Ce;for(let h=0;h<c;h++){if(h>ee)return je(e,t,n,i,o,r);let g=Ce.advance(h,s,a,c,d,!1,f)||xe.advance(h,s,a,c,u,!0,l);if(g)return cr(e,t,n,t+g[0],i,o,r,o+g[1])}return[new k(t,n,o,r)]}class Et{vec=[];len;start;end;reset(t){this.len=t<<1;for(let n=0;n<this.len;n++)this.vec[n]=-1;this.vec[t+1]=0,this.start=this.end=0}advance(t,n,i,o,r,s,a){for(let c=-t+this.start;c<=t-this.end;c+=2){let f=o+c,l=c==-t||c!=t&&this.vec[f-1]<this.vec[f+1]?this.vec[f+1]:this.vec[f-1]+1,d=l-c;for(;l<n&&d<i&&a(l,d);)l++,d++;if(this.vec[f]=l,l>n)this.end+=2;else if(d>i)this.start+=2;else if(r){let u=o+(n-i)-c;if(u>=0&&u<this.len&&r.vec[u]!=-1)if(s){let h=r.vec[u];if(h>=n-l)return[h,o+h-u]}else{let h=n-r.vec[u];if(l>=h)return[l,d]}}}return null}}const Ce=new Et,xe=new Et;function cr(e,t,n,i,o,r,s,a){let c=!1;return!Z(e,i)&&++i==n&&(c=!0),!Z(o,a)&&++a==s&&(c=!0),c?[new k(t,n,r,s)]:U(e,t,i,o,r,a).concat(U(e,i,n,o,a,s))}function wt(e,t){let n=1,i=Math.min(e,t);for(;n<i;)n=n<<1;return n}function De(e,t,n,i,o,r){if(t==n||t==r||e.charCodeAt(t)!=i.charCodeAt(o))return 0;let s=wt(n-t,r-o);for(let a=t,c=o;;){let f=a+s,l=c+s;if(f>n||l>r||e.slice(a,f)!=i.slice(c,l)){if(s==1)return a-t-(Z(e,a)?0:1);s=s>>1}else{if(f==n||l==r)return f-t;a=f,c=l}}}function ye(e,t,n,i,o,r){if(t==n||o==r||e.charCodeAt(n-1)!=i.charCodeAt(r-1))return 0;let s=wt(n-t,r-o);for(let a=n,c=r;;){let f=a-s,l=c-s;if(f<t||l<o||e.slice(f,a)!=i.slice(l,c)){if(s==1)return n-a-(Z(e,a)?0:1);s=s>>1}else{if(f==t||l==o)return n-f;a=f,c=l}}}function ke(e,t,n,i,o,r,s,a){let c=i.slice(o,r),f=null;for(;;){if(f||s<a)return f;for(let l=t+s;;){Z(e,l)||l++;let d=l+s;if(Z(e,d)||(d+=d==l+1?1:-1),d>=n)break;let u=e.slice(l,d),h=-1;for(;(h=c.indexOf(u,h+1))!=-1;){let g=De(e,d,n,i,o+h+u.length,r),p=ye(e,t,l,i,o,o+h),m=u.length+g+p;(!f||f[2]<m)&&(f=[l-p,o+h-p,m])}l=d}if(a<0)return f;s=s>>1}}function At(e,t,n,i,o,r){let s=n-t,a=r-o;if(s<a){let c=At(i,o,r,e,t,n);return c&&[c[1],c[0],c[2]]}return s<4||a*2<s?null:ke(e,t,n,i,o,r,Math.floor(s/4),-1)}function je(e,t,n,i,o,r){let s=n-t,a=r-o,c;if(s<a){let u=ke(i,o,r,e,t,n,Math.floor(s/6),50);c=u&&[u[1],u[0],u[2]]}else c=ke(e,t,n,i,o,r,Math.floor(a/6),50);if(!c)return[new k(t,n,o,r)];let[f,l,d]=c;return U(e,t,f,i,o,l).concat(U(e,f+d,n,i,l+d,r))}function bt(e,t){for(let n=1;n<e.length;n++){let i=e[n-1],o=e[n];i.toA>o.fromA-t&&i.toB>o.fromB-t&&(e[n-1]=new k(i.fromA,o.toA,i.fromB,o.toB),e.splice(n--,1))}}function fr(e,t,n){for(;;){bt(n,1);let i=!1;for(let o=0;o<n.length;o++){let r=n[o],s,a;(s=De(e,r.fromA,r.toA,t,r.fromB,r.toB))&&(r=n[o]=new k(r.fromA+s,r.toA,r.fromB+s,r.toB)),(a=ye(e,r.fromA,r.toA,t,r.fromB,r.toB))&&(r=n[o]=new k(r.fromA,r.toA-a,r.fromB,r.toB-a));let c=r.toA-r.fromA,f=r.toB-r.fromB;if(c&&f)continue;let l=r.fromA-(o?n[o-1].toA:0),d=(o<n.length-1?n[o+1].fromA:e.length)-r.toA;if(!l||!d)continue;let u=c?e.slice(r.fromA,r.toA):t.slice(r.fromB,r.toB);l<=u.length&&e.slice(r.fromA-l,r.fromA)==u.slice(u.length-l)?(n[o]=new k(r.fromA-l,r.toA-l,r.fromB-l,r.toB-l),i=!0):d<=u.length&&e.slice(r.toA,r.toA+d)==u.slice(0,d)&&(n[o]=new k(r.fromA+d,r.toA+d,r.fromB+d,r.toB+d),i=!0)}if(!i)break}return n}function dr(e,t,n){for(let i=0,o=0;o<e.length;o++){let r=e[o],s=r.toA-r.fromA,a=r.toB-r.fromB;if(s&&a||s>3||a>3){let c=o==e.length-1?t.length:e[o+1].fromA,f=r.fromA-i,l=c-r.toA,d=Pe(t,r.fromA,Math.min(f,5)),u=Fe(t,r.toA,Math.min(l,5)),h=r.fromA-d,g=u-r.toA;if(!s||!a){let p=Math.max(s,a),[m,E,w]=s?[t,r.fromA,r.toA]:[n,r.fromB,r.toB];h&&g&&(p>h&&t.slice(d,r.fromA)==m.slice(w-h,w)?(r=e[o]=new k(d,d+s,r.fromB-h,r.toB-h),d=r.fromA,u=Fe(t,r.toA,Math.min(c-r.toA,5))):p>g&&t.slice(r.toA,u)==m.slice(E,E+g)&&(r=e[o]=new k(u-s,u,r.fromB+g,r.toB+g),u=r.toA,d=Pe(t,r.fromA,Math.min(r.fromA-i,5))),h=r.fromA-d,g=u-r.toA)}if(h||g)r=e[o]=new k(r.fromA-h,r.toA+g,r.fromB-h,r.toB+g);else if(s){if(!a){let p=Ke(t,r.fromA,r.toA),m,E=p<0?-1:Ue(t,r.toA,r.fromA);p>-1&&(m=p-r.fromA)<=l&&t.slice(r.fromA,p)==t.slice(r.toA,r.toA+m)?r=e[o]=r.offset(m):E>-1&&(m=r.toA-E)>=f&&n.slice(r.fromA-m,r.fromA)==n.slice(E,r.toA)&&(r=e[o]=r.offset(-m))}}else{let p=Ke(n,r.fromB,r.toB),m,E=p<0?-1:Ue(n,r.toB,r.fromB);p>-1&&(m=p-r.fromB)<=l&&n.slice(r.fromB,p)==n.slice(r.toB,r.toB+m)?r=e[o]=r.offset(m):E>-1&&(m=r.toB-E)>=f&&n.slice(r.fromB-m,r.fromB)==n.slice(E,r.toB)&&(r=e[o]=r.offset(-m))}i=r.toA}}return bt(e,3),e}let P;try{P=new RegExp("[\\p{Alphabetic}\\p{Number}]","u")}catch{}function St(e){return e>48&&e<58||e>64&&e<91||e>96&&e<123}function kt(e,t){if(t==e.length)return 0;let n=e.charCodeAt(t);return n<192?St(n)?1:0:P?!Lt(n)||t==e.length-1?P.test(String.fromCharCode(n))?1:0:P.test(e.slice(t,t+2))?2:0:0}function vt(e,t){if(!t)return 0;let n=e.charCodeAt(t-1);return n<192?St(n)?1:0:P?!Mt(n)||t==1?P.test(String.fromCharCode(n))?1:0:P.test(e.slice(t-2,t))?2:0:0}function Fe(e,t,n){if(t==e.length||!vt(e,t))return t;for(let i=t,o=t+n;;){let r=kt(e,i);if(!r)return i;if(i+=r,i>o)return t}}function Pe(e,t,n){if(!t||!kt(e,t))return t;for(let i=t,o=t-n;;){let r=vt(e,i);if(!r)return i;if(i-=r,i<o)return t}}function Ue(e,t,n){for(;t!=n;t--)if(e.charCodeAt(t-1)==10)return t;return-1}function Ke(e,t,n){for(;t!=n;t++)if(e.charCodeAt(t)==10)return t;return-1}const Lt=e=>e>=55296&&e<=56319,Mt=e=>e>=56320&&e<=57343;function Z(e,t){return!t||t==e.length||!Lt(e.charCodeAt(t-1))||!Mt(e.charCodeAt(t))}function ur(e,t,n){return ee=(n?.scanLimit??1e9)>>1,fr(e,t,U(e,0,e.length,t,0,t.length))}function Tt(e,t,n){return dr(ur(e,t,n),e,t)}function hr(e){const{start:t,end:n}=e.positionBefore,{start:i,end:o}=e.positionAfter;return new k(t,n,i,o)}class oe{constructor(t,n,i,o,r){this.changes=t,this.fromA=n,this.toA=i,this.fromB=o,this.toB=r}offset(t,n){return t||n?new oe(this.changes,this.fromA+t,this.toA+t,this.fromB+n,this.toB+n):this}get endA(){return Math.max(this.fromA,this.toA)}get endB(){return Math.max(this.fromB,this.toB)}static buildFromTextdocDiff(t){const i=t.edits.map(hr);return i.sort((r,s)=>r.fromA-s.fromA),ve(i,fe.of(t.contentBefore.split(`
`)),fe.of(t.contentAfter.split(`
`)),0,0)}static build(t,n,i){const o=Tt(t.toString(),n.toString(),i);return ve(o,t,n,0,0)}static updateA(t,n,i,o,r){return Ze(Je(t,o,!0,i.length),t,n,i,r)}static updateB(t,n,i,o,r){return Ze(Je(t,o,!1,n.length),t,n,i,r)}}function $e(e,t,n,i){let o=n.lineAt(e),r=i.lineAt(t);return o.to==e&&r.to==t&&e<n.length&&t<i.length?[e+1,t+1]:[o.from,r.from]}function qe(e,t,n,i){let o=n.lineAt(e),r=i.lineAt(t);return o.from==e&&r.from==t?[e,t]:[o.to+1,r.to+1]}function ve(e,t,n,i,o){let r=[];for(let s=0;s<e.length;s++){let a=e[s],[c,f]=$e(a.fromA+i,a.fromB+o,t,n),[l,d]=qe(a.toA+i,a.toB+o,t,n),u=[a.offset(-c+i,-f+o)];for(;s<e.length-1;){let h=e[s+1],[g,p]=$e(h.fromA+i,h.fromB+o,t,n);if(g>l+1&&p>d+1)break;u.push(h.offset(-c+i,-f+o)),[l,d]=qe(h.toA+i,h.toB+o,t,n),s++}r.push(new oe(u,c,Math.max(c,l),f,Math.max(f,d)))}return r}const ae=1e3;function ze(e,t,n,i){let o=0,r=e.length;for(;;){if(o==r){let l=0,d=0;o&&({toA:l,toB:d}=e[o-1]);let u=t-(n?l:d);return[l+u,d+u]}let s=o+r>>1,a=e[s],[c,f]=n?[a.fromA,a.toA]:[a.fromB,a.toB];if(c>t)r=s;else if(f<=t)o=s+1;else return i?[a.fromA,a.fromB]:[a.toA,a.toB]}}function Je(e,t,n,i){let o=[];return t.iterChangedRanges((r,s,a,c)=>{let f=0,l=n?t.length:i,d=0,u=n?i:t.length;r>ae&&([f,d]=ze(e,r-ae,n,!0)),s<t.length-ae&&([l,u]=ze(e,s+ae,n,!1));let h=c-a-(s-r),g,[p,m]=n?[h,0]:[0,h];o.length&&(g=o[o.length-1]).toA>=f?o[o.length-1]={fromA:g.fromA,fromB:g.fromB,toA:l,toB:u,diffA:g.diffA+p,diffB:g.diffB+m}:o.push({fromA:f,toA:l,fromB:d,toB:u,diffA:p,diffB:m})}),o}function Ze(e,t,n,i,o){if(!e.length)return t;let r=[];for(let s=0,a=0,c=0,f=0;;s++){let l=s==e.length?null:e[s],d=l?l.fromA+a:n.length,u=l?l.fromB+c:i.length;for(;f<t.length;){let m=t[f];if(m.toA+a>d||m.toB+c>u)break;r.push(m.offset(a,c)),f++}if(!l)break;let h=l.toA+a+l.diffA,g=l.toB+c+l.diffB,p=Tt(n.sliceString(d,h),i.sliceString(u,g),o);for(let m of ve(p,n,i,d,u))r.push(m);for(a+=l.diffA,c+=l.diffB;f<t.length;){let m=t[f];if(m.fromA+a>h&&m.fromB+c>g)break;f++}}return r}const K=Ut.define({combine:e=>e[0]}),Bt=H.define(),G=W.define({create(){return null},update(e,t){for(let n of t.effects)n.is(Bt)&&(e=n.value);return e}}),mr="bg-red-100 dark:bg-red-600/30",gr="bg-green-100 dark:bg-green-600/30",Oe=Me.fromClass(class{deco;gutter;constructor(e){({deco:this.deco,gutter:this.gutter}=Xe(e))}update(e){(e.docChanged||e.viewportChanged||pr(e.startState,e.state)||Cr(e.startState,e.state))&&({deco:this.deco,gutter:this.gutter}=Xe(e.view))}},{decorations:e=>e.deco});Te.low(st({class:"cm-changeGutter",markers:e=>e.plugin(Oe)?.gutter||lt.empty}));function pr(e,t){return e.field(G,!1)!=t.field(G,!1)}function Cr(e,t){return e.facet(K)!=t.facet(K)}const Qe=v.line({class:`cm-changedLine ${gr}`}),xr=v.mark({class:"cm-changedText"}),Er=v.mark({tagName:"ins",class:"cm-insertedLine"}),wr=v.mark({tagName:"del",class:"cm-deletedLine"}),Ye=new class extends at{elementClass="cm-changedLineGutter"};function Ar(e,t,n,i,o,r){let s=n?e.fromA:e.fromB,a=n?e.toA:e.toB,c=0;if(s!=a){o.add(s,s,Qe),o.add(s,a,n?wr:Er),r&&r.add(s,s,Ye);for(let f=t.iterRange(s,a-1),l=s;!f.next().done;){if(f.lineBreak){l++,o.add(l,l,Qe),r&&r.add(l,l,Ye);continue}let d=l+f.value.length;if(i)for(;c<e.changes.length;){let u=e.changes[c],h=s+(n?u.fromA:u.fromB),g=s+(n?u.toA:u.toB),p=Math.max(l,h),m=Math.min(d,g);if(p<m&&o.add(p,m,xr),g<d)c++;else break}l=d}}}function Xe(e){let t=e.state.field(G),{side:n,highlightChanges:i,markGutter:o}=e.state.facet(K),r=n=="a",s=new re,a=o?new re:null,{from:c,to:f}=e.viewport;for(let l of t){if((r?l.fromA:l.fromB)>=f)break;(r?l.toA:l.toB)>c&&Ar(l,e.state.doc,r,i,s,a)}return{deco:s.finish(),gutter:a&&a.finish()}}const br=H.define({map:(e,t)=>e.map(t)});W.define({create:()=>v.none,update:(e,t)=>{for(let n of t.effects)if(n.is(br))return n.value;return e.map(t.changes)},provide:e=>T.decorations.from(e)});const Le=H.define({map:(e,t)=>t.mapPos(e)});class Sr extends Be{constructor(t){super(),this.lines=t}eq(t){return this.lines==t.lines}toDOM(t){let n=document.createElement("div");return n.className="cm-collapsedLines",n.textContent="⦚ "+t.state.phrase("$ unchanged lines",this.lines)+" ⦚",n.addEventListener("click",i=>{let o=t.posAtDOM(i.target);t.dispatch({effects:Le.of(o)});let{side:r,sibling:s}=t.state.facet(K);s&&s().dispatch({effects:Le.of(kr(o,t.state.field(G),r=="a"))})}),n}ignoreEvent(t){return t instanceof MouseEvent}get estimatedHeight(){return 27}}function kr(e,t,n){let i=0,o=0;for(let r=0;;r++){let s=r<t.length?t[r]:null;if(!s||(n?s.fromA:s.fromB)>=e)return o+(e-i);[i,o]=n?[s.toA,s.toB]:[s.toB,s.toA]}}const vr=W.define({create(){return v.none},update(e,t){e=e.map(t.changes);for(let n of t.effects)n.is(Le)&&(e=e.update({filter:i=>i!=n.value}));return e},provide:e=>T.decorations.from(e)});function Lr({margin:e=3,minSize:t=4}){return vr.init(n=>Mr(n,e,t))}function Mr(e,t,n){let i=new re,o=e.facet(K).side=="a",r=e.field(G),s=1;for(let a=0;;a++){let c=a<r.length?r[a]:null,f=a?s+t:1,l=c?e.doc.lineAt(o?c.fromA:c.fromB).number-1-t:e.doc.lines,d=l-f+1;if(d>=n&&i.add(e.doc.line(f).from,e.doc.line(l).to,v.replace({widget:new Sr(d),block:!0})),!c)break;s=e.doc.lineAt(Math.min(e.doc.length,o?c.toA:c.toB)).number}return i.finish()}T.styleModule.of(new Kt({".cm-mergeView":{overflowY:"auto"},".cm-mergeViewEditors":{display:"flex",alignItems:"stretch"},".cm-mergeViewEditor":{flexGrow:1,flexBasis:0,overflow:"hidden"},".cm-merge-revert":{width:"1.6em",flexGrow:0,flexShrink:0,position:"relative"},".cm-merge-revert button":{position:"absolute",display:"block",width:"100%",boxSizing:"border-box",textAlign:"center",background:"none",border:"none",font:"inherit",cursor:"pointer"}}));const Tr=T.baseTheme({".cm-mergeView & .cm-scroller, .cm-mergeView &":{height:"auto !important",overflowY:"visible !important"},"&light.cm-merge-a .cm-changedText, &light .cm-deletedChunk .cm-deletedText":{background:"linear-gradient(#ee443366, #ee443366) bottom/100% 2px no-repeat"},"&dark.cm-merge-a .cm-changedText, &dark .cm-deletedChunk .cm-deletedText":{background:"linear-gradient(#ffaa9966, #ffaa9966) bottom/100% 2px no-repeat"},"&light.cm-merge-b .cm-changedText":{background:"linear-gradient(#22bb2266, #22bb2266) bottom/100% 2px no-repeat"},"&dark.cm-merge-b .cm-changedText":{background:"linear-gradient(#88ff8866, #88ff8866) bottom/100% 2px no-repeat"},".cm-insertedLine, .cm-deletedLine":{textDecoration:"none"},".cm-deletedChunk":{paddingLeft:"6px","& .cm-chunkButtons":{position:"absolute",insetInlineEnd:"5px"},"& button":{border:"none",cursor:"pointer",color:"white",margin:"0 2px",borderRadius:"3px","&[name=accept]":{background:"#2a2"},"&[name=reject]":{background:"#d43"}}},".cm-collapsedLines":{padding:"5px 5px 5px 10px",cursor:"pointer"},"&light .cm-collapsedLines":{color:"#444",background:"linear-gradient(to bottom, transparent 0, #f3f3f3 30%, #f3f3f3 70%, transparent 100%)"},"&dark .cm-collapsedLines":{color:"#ddd",background:"linear-gradient(to bottom, transparent 0, #222 30%, #222 70%, transparent 100%)"},".cm-changeGutter":{width:"3px",paddingLeft:"1px"},"&light.cm-merge-a .cm-changedLineGutter, &light .cm-deletedLineGutter":{background:"#e43"},"&dark.cm-merge-a .cm-changedLineGutter, &dark .cm-deletedLineGutter":{background:"#fa9"},"&light.cm-merge-b .cm-changedLineGutter":{background:"#2b2"},"&dark.cm-merge-b .cm-changedLineGutter":{background:"#8f8"}}),Ee="unknown",Br=new class extends at{elementClass="cm-deletedLineGutter"},Dr=Te.low(st({class:"cm-changeGutter",markers:e=>e.plugin(Oe)?.gutter||lt.empty,widgetMarker:(e,t)=>t instanceof yt?Br:null}));function yr(e){let t=fe.of(e.textdocDiff.contentBefore.split(`
`));return[Te.low(Oe),Gr(e.language),Tr,T.editorAttributes.of({class:"cm-merge-b"}),K.of({highlightChanges:e.highlightChanges!==!1,markGutter:e.gutter!==!1,syntaxHighlightDeletions:e.syntaxHighlightDeletions!==!1,mergeControls:e.mergeControls!==!1,side:"b"}),ue.init(()=>t),e.gutter!==!1?Dr:[],e.collapseUnchanged?Lr(e.collapseUnchanged):[],G.init(()=>oe.buildFromTextdocDiff(e.textdocDiff))]}const Dt=H.define(),ue=W.define({create:()=>fe.empty,update(e,t){for(let n of t.effects)n.is(Dt)&&(e=n.value.doc);return e}}),Y=new WeakMap;class yt extends Be{constructor(t){super(),this.buildDOM=t}dom=null;eq(t){return this.dom==t.dom}toDOM(t){return this.dom||(this.dom=this.buildDOM(t))}}function Or(e,t,n){if(Y.has(t.changes)){const r=de(Y.get(t.changes)).get(n?.name??Ee);if(r)return r}let i=r=>{let{highlightChanges:s,syntaxHighlightDeletions:a,mergeControls:c}=e.facet(K),f=r.state.field(ue).sliceString(t.fromA,t.endA),l=document.createElement("div");if(l.className=`cm-deletedChunk ${mr}`,c){let m=l.appendChild(document.createElement("div"));m.className="cm-chunkButtons";let E=m.appendChild(document.createElement("button"));E.name="accept",E.textContent=e.phrase("Accept"),E.onmousedown=A=>{A.preventDefault(),Nr(r,r.posAtDOM(l))};let w=m.appendChild(document.createElement("button"));w.name="reject",w.textContent=e.phrase("Reject"),w.onmousedown=A=>{A.preventDefault(),Rr(r,r.posAtDOM(l))}}let d=l.appendChild(document.createElement("del")),u=t.changes,h=0,g=!1;function p(m,E,w){for(let A=m;A<E;){let L=E,x=w+(g?" cm-deletedText":""),B=!1;if(s&&h<u.length){let D=Math.max(0,g?u[h].toA:u[h].fromA);D<=L&&(L=D,g&&h++,B=!0)}if(L>A){let D=document.createTextNode(f.slice(A,L));if(x){let I=d.appendChild(document.createElement("span"));I.className=x,I.appendChild(D)}else d.appendChild(D)}A=L,B&&(g=!g)}}if(a&&n){let m=n.parser.parse(f),E=0;wn(m,{style:w=>An(e,w)},(w,A,L)=>{w>E&&p(E,w,""),p(w,A,L),E=A}),p(E,f.length,"")}else p(0,f.length,"");return l},o=v.widget({block:!0,side:-1,widget:new yt(i)});return Y.has(t.changes)?de(Y.get(t.changes)).set(n?.name??Ee,o):Y.set(t.changes,new Map([[n?.name??Ee,o]])),o}function Nr(e,t){let{state:n}=e,i=t??n.selection.main.head,o=e.state.field(G).find(c=>c.fromB<=i&&c.endB>=i);if(!o)return!1;let r=e.state.sliceDoc(o.fromB,Math.max(o.fromB,o.toB-1)),s=e.state.field(ue);o.fromB!=o.toB&&o.toA<=s.length&&(r+=e.state.lineBreak);let a=$t.of({from:o.fromA,to:Math.min(s.length,o.toA),insert:r},s.length);return e.dispatch({effects:Dt.of({doc:a.apply(s),changes:a}),userEvent:"accept"}),!0}function Rr(e,t){let{state:n}=e,i=t??n.selection.main.head,o=n.field(G).find(a=>a.fromB<=i&&a.endB>=i);if(!o)return!1;let s=n.field(ue).sliceString(o.fromA,Math.max(o.fromA,o.toA-1));return o.fromA!=o.toA&&o.toB<=n.doc.length&&(s+=n.lineBreak),e.dispatch({changes:{from:o.fromB,to:Math.min(n.doc.length,o.toB),insert:s},userEvent:"revert"}),!0}function et(e,t){let n=new re;for(let i of e.field(G))n.add(i.fromB,i.fromB,Or(e,i,t));return n.finish()}const Gr=e=>W.define({create:t=>et(t,e),update(t,n){return n.state.field(G,!1)!=n.startState.field(G,!1)?et(n.state,e):t},provide:t=>T.decorations.from(t)}),Ot=H.define(),ce=W.define({create:()=>{},update(e,t){for(let n of t.effects)if(n.is(Ot))return n.value;return e}});class Hr extends Be{toDOM(){const t=document.createElement("span");return t.className=Vn.modelCursor,t}}const Ir=Me.fromClass(class{decorations;constructor(e){this.decorations=this.buildDecorations(e)}update(e){(e.docChanged||e.viewportChanged||e.state.field(ce)!==e.startState.field(ce))&&(this.decorations=this.buildDecorations(e.view))}buildDecorations(e){const t=new re,n=e.state.field(ce);if(!n)return v.none;const{doc:i}=e.state,{modelCursorPosition:o,modelSelectionPositionRange:r}=n;if(o!=null)o>=0&&o<=i.length&&t.add(o,o,v.widget({widget:new Hr,side:1}));else if(r!=null){const{start:s,end:a}=r;s>=0&&a<=i.length&&s<a&&t.add(s,a,v.mark({class:`${Gn} !bg-[Highlight]`}))}return t.finish()}},{decorations:e=>e.decorations}),_r=e=>[ce.init(()=>e),Ir],he=H.define(),Ne=W.define({create(){return null},update(e,t){for(const n of t.effects)if(n.is(he))return n.value;return e}});function Nt(e,t){const{selectionStart:n,selectionEnd:i}=t,[o,r]=n.from>i.from?[i.from,n.to]:[n.from,i.to];e.dispatch({selection:_e.create([_e.range(o,r)]),effects:he.of(t)})}function Wr(e,t){Nt(e,{selectionStart:t,selectionEnd:t}),e.focus();const i=()=>{e.dispatch({effects:he.of(null)}),window.removeEventListener("mouseup",i)};return window.addEventListener("mouseup",i),!0}function Vr(e,t){const n=e.state.field(Ne);if(n){const i={...n,selectionEnd:t};Nt(e,i)}return!0}const jr=Me.fromClass(class{constructor(e){this.view=e,this.updateCursor()}update(e){e.transactions.some(t=>t.effects.some(n=>n.is(he)))&&this.updateCursor()}updateCursor(){this.view.state.field(Ne)?this.view.dom.classList.add("cm-line-number-dragging"):this.view.dom.classList.remove("cm-line-number-dragging")}}),Fr=T.theme({".cm-gutters":{cursor:"default"},"&.cm-line-number-dragging .cm-gutters":{cursor:"text"}});function Pr(){return[Ne,jr,Fr,qt({domEventHandlers:{mousedown:Wr,mousemove:Vr}})]}const tt=it.define();function Rt(e,t){return e==null?[]:yr({highlightChanges:!1,gutter:!1,syntaxHighlightDeletions:!0,mergeControls:!1,language:t,textdocDiff:e})}function we(e,t,n){const i=e.reconfigure(Rt(t,n??null));if(t==null)return[i];const o=oe.buildFromTextdocDiff(t);return[i,Bt.of(o)]}const Ur=({currentlyStreamingLineIndex:e,value:t,textdocDiff:n,placeholderContent:i,languageCompartment:o,languageCompartmentInit:r,editableCompartment:s,readOnlyCompartment:a,editableInit:c,handleChange:f,handleBlur:l,handleSave:d,extensionsProp:u,editorTheme:h,comments:g,maxLength:p=pn,intl:m,toaster:E,modelCursor:w,unifiedMergeViewCompartment:A})=>{const L=[zt(i),sr(m,E,p),bn(),o.of(r??[]),s.of([T.editable.of(c)]),a.of([te.readOnly.of(!c)]),Jt(),te.allowMultipleSelections.of(!0),Sn(),kn(vn,{fallback:!0}),Ln(),Pr(),Zt(),Mn({markerDOM:x=>{const B=document.createElement("span"),D=Zn.createRoot(B),I=x?M.jsx(Cn,{className:"icon-sm text-token-text-tertiary"}):M.jsx(xn,{className:"icon-sm text-token-text-tertiary"});return D.render(I),B}}),_r(w),A.of(Rt(n,r?.language??null)),...u??[],...nr,Qt.of([...Tn,...Bn,...Dn,...yn,...On,Nn]),Rn(),h,Yt(g),lr(),er(e??null),T.updateListener.of(f),T.domEventHandlers({blur:l,keydown(x){(x.key==="s"||x.key==="S")&&x.metaKey&&d?.()},paste(x){const B=x.clipboardData?.getData("text/plain");B!=null&&dt.logEvent(ft.canvasCodemirrorPaste,{textLength:B.length})}})];return te.create({doc:t,extensions:L})};function Kr({state:e,parent:t,onUpdateState:n}){const i=(o,r)=>{r.update(o);const s=r.state;n(s)};return new T({state:e,parent:t,dispatchTransactions:i})}const $r="_codemirror_cto5h_1",qr="_preview_cto5h_12",nt={codemirror:$r,preview:qr},zr=jn({settings:{background:"var(--main-surface-primary)"}}),Jr=Fn({theme:"light"}),rt=T.theme({".cm-tooltip-autocomplete":{backgroundColor:"var(--main-surface-primary)",color:"var(--text-primary)",border:"1px solid var(--border-light)",borderRadius:"6px",padding:"4px",boxShadow:"0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1)"},".cm-tooltip-autocomplete > ul > li":{borderRadius:"5px",color:"var(--text-primary)"},".cm-tooltip-autocomplete > ul > li[aria-selected]":{backgroundColor:"var(--main-surface-secondary)",color:"var(--text-primary)"},".cm-tooltip-autocomplete > ul > li:hover":{backgroundColor:"var(--selection)",color:"#ffffff"},".cm-completionMatchedText":{textDecoration:"none",fontWeight:"700"}}),ot=e=>e?[zr,rt]:[Jr,rt],Zr=e=>{const[t]=C.useState(()=>new X),n=un();C.useEffect(()=>{e.current?.dispatch({effects:t.reconfigure(ot(n))})},[n,t,e]);const[i]=C.useState(()=>t.of(ot(n)));return i},ne=({id:e,children:t,comments:n,commentingOn:i,currentlyStreamingLineIndex:o,hoveredCommentId:r,focusedCommentId:s,placeholder:a="",readonlyReason:c,language:f,value:l,textdocDiff:d,extensions:u,onBlur:h,onSave:g,onChange:p,editorRef:m,width:E,modelCursor:w,isPreview:A})=>{const L=C.useRef(null),x=C.useRef(null),B=Pt(),D=hn(),[I,V]=C.useState(null),_=C.useRef(null),[{width:Q},$]=ut(),[y]=C.useState(()=>new X),[O]=C.useState(()=>new X),[j]=C.useState(()=>new X),[N]=C.useState(()=>new X),q=C.useRef(p);q.current=p;const z=C.useCallback(({docChanged:b,state:S,transactions:J})=>{for(const R of J)if(R.annotation(tt)===!0||R.annotation(xt)===!0)return;if(S.doc.sliceString(S.doc.length-1)===`
`&&b){const R=S.doc.toString();_.current=R,q.current?.(S)}},[]),ie=C.useRef(h);ie.current=h;const F=C.useCallback(()=>ie.current?.(),[]),Re=C.useRef(g);Re.current=g;const It=C.useCallback(()=>Re.current?.(),[]),_t=async b=>b?await Pn(b):null,Ge=C.useCallback(async b=>{const S=await _t(b);S&&x.current?.dispatch({effects:[y.reconfigure(S),...we(N,d,S?.language)]})},[y,N]),Wt=Zr(x),Vt=C.useCallback(b=>{if(b===_.current){_.current=null;return}const{current:S}=x;if(!S)return;const J=S.state.doc,R=f!=null?pe(f):null,Ft=S.state.update({changes:{from:0,to:J.length,insert:b},effects:[We.of(n??[]),be.of(o??null),...R!=null?[y.reconfigure(R)]:[],...we(N,d,R?.language)],annotations:tt.of(!0)});S.update([Ft])},[n,o,f,y,d,N]);C.useImperativeHandle(m,()=>({UNSAFE_setValue:Vt,codeViewRef:x,highlightLine:(b,S)=>rr(de(x.current),b,S)})),C.useEffect(()=>{Ge(f)},[f,Ge]),C.useEffect(()=>{const b=f==null?null:pe(f);x.current?.dispatch({effects:we(N,d,b?.language)})},[N,d]);const se=c?.isReadonly===!0;C.useEffect(()=>{x.current?.dispatch({effects:[O.reconfigure(T.editable.of(!se)),j.reconfigure(te.readOnly.of(se))]})},[se,O,j]),C.useEffect(()=>{(i==null||Xt(i))&&x.current?.dispatch({effects:en.of(i??null)})},[i]),C.useEffect(()=>{x.current?.dispatch({effects:We.of(n??[])})},[n]),C.useEffect(()=>{x.current?.dispatch({effects:tn.of(r)})},[r]),C.useEffect(()=>{x.current?.dispatch({effects:nn.of(s)})},[s]),C.useEffect(()=>{x.current?.dispatch({effects:Ot.of(w)})},[w]),C.useEffect(()=>{x.current?.dispatch({effects:be.of(o??null)})},[o]),C.useEffect(()=>{const b=L.current;if(b==null)return;const S=f==null?null:pe(f),J=Ur({currentlyStreamingLineIndex:o,value:l,placeholderContent:a,editableCompartment:O,readOnlyCompartment:j,editableInit:!se,languageCompartment:y,languageCompartmentInit:S??null,handleChange:z,handleBlur:F,handleSave:It,extensionsProp:u,editorTheme:Wt,intl:B,toaster:D,comments:n??[],modelCursor:w,textdocDiff:d,unifiedMergeViewCompartment:N});V(J);const R=Kr({state:J,parent:b,onUpdateState:V});return x.current=R,()=>{R.destroy()}},[e,u,a]);const jt=C.useCallback(()=>x.current,[x]),He=[],Ie=[];return C.Children.forEach(t,b=>{if(!C.isValidElement(b))return;const{type:S}=b;if(S===Ht)He.push(b);else if(S===Gt)Ie.push(b);else throw new Error("Invalid Codemirror child: "+JSON.stringify(S))}),M.jsx(rn.Provider,{value:jt,children:M.jsx(on.Provider,{value:I,children:M.jsxs(sn.Provider,{value:Q,children:[M.jsxs("div",{className:"relative z-0 flex h-full max-w-full",children:[M.jsx("div",{id:e,className:ct(nt.codemirror,A&&nt.preview,Hn.composer,"flex h-full w-full flex-col items-stretch"),ref:Ae(L,$),style:{width:E}}),Ie]}),He]})})})},Gt=({children:e})=>e,Ht=({children:e})=>e;ne.EditorChildren=Gt;ne.ContextChildren=Ht;function Qr(e,t){const n=e.doc.lineAt(t.from);return t.from===n.from&&t.to-1===n.to}function Yr(e){const t=e.dom.querySelector(".cm-gutters");return t?t.offsetWidth:0}const Xr=({onAddComment:e,isSendDisabled:t=!1,isWaitingForCommentResponse:n=!1})=>{const i=ln(),o=an(),r=cn(),s=C.useCallback(c=>{const{height:f,width:l}=c,d=i();if(!o||!d)return null;const u=o.selection.asSingle();if(u.ranges.length===0)return null;const h=u.ranges[0],{empty:g,to:p}=h;let{head:m}=h;const{platform:E}=En();m=E==="web"?m:p;const w=m===p;let A=m;if(w&&Qr(o,h)&&(A-=1),g)return null;const{left:L,top:x,bottom:B}=d.contentDOM.getBoundingClientRect(),{left:D,top:I,bottom:V}=de(d.coordsAtPos(A,w?-1:1)),_=Yr(d);function Q(){if(w)return Math.max(D-L+_-l,_);let O=D-L+_;return O+l>r&&(O=-(l-r)),O}function $(O){const j=f*2,N=O.contentHeight-(V-B)>j&&window.innerHeight-V>j,q=V-x+8,z=I-x-f-8;return w&&N||z<0?{top:q,aboveOrBelow:Ve.BELOW}:{top:z,aboveOrBelow:Ve.ABOVE}}const y=$(d);return{left:Q(),top:y.top,aboveOrBelow:y.aboveOrBelow,toolbarSize:c}},[o,i,r]),a=C.useCallback(()=>i()?.dom??null,[i]);return M.jsx(Un,{onAddComment:e,isWaitingForCommentResponse:n,isSendDisabled:t,toolbarType:Kn.CODE,getToolbarPosition:s,getEditorDom:a,getSelectionRange:()=>{const c=i();if(!c)return null;const{state:f}=c,l=f.selection.asSingle();if(l.ranges.length===0)return null;const d=l.ranges[0],{from:u,to:h}=d;return u==null||h==null?null:{from:u,to:h,sourceFrom:u,sourceTo:h}}})};function eo({diff:e}){return $n(e?.edits??[]),null}function to(e,t,n){const i=n?Jn():0;return e<=1e3-i?e-(t?_n:0):e-(t?Wn:0)}const vo=({comments:e,currentlyStreamingLineIndex:t,isPreview:n=!1,isWaitingForCommentResponse:i=!1,isSendDisabled:o=!1,readonlyReason:r,isRequestActive:s=!1,language:a,value:c,textdocDiff:f,onAcceleratorsExpandedChange:l,onAddComment:d,onAcceptComment:u,onDismissComment:h,onBlur:g,onSave:p,onChange:m,onCancelRequest:E,getStableCommentId:w=mn,commentsMode:A=ge.ENABLED,hideToolbar:L,hideAccelerators:x=!1,onSubmitAccelerator:B,modelCursor:D,codemirrorRef:I})=>{const V=C.useRef(null),[{width:_},Q]=ut(),$=C.useRef(null),y=e.length>0,O=$.current,j=to(_,y,qn(O)??!1),N=me(({commentingOn:F})=>F),q=me(({hoveredCommentId:F})=>F),z=me(({focusedCommentId:F})=>F);C.useEffect(()=>{V.current?.UNSAFE_setValue(c||"")},[c]);const ie=_-j;return M.jsx("div",{className:In.code,ref:Ae(Q,$),children:M.jsxs(ne,{id:"codemirror",comments:A===ge.ALL_HIDDEN?void 0:e,commentingOn:N,currentlyStreamingLineIndex:t,hoveredCommentId:q,focusedCommentId:z,language:a,readonlyReason:r,onChange:m,value:c,textdocDiff:f,editorRef:Ae(V,I),width:j,modelCursor:D,isPreview:n,onBlur:g,onSave:p,children:[M.jsxs(ne.EditorChildren,{children:[!L&&M.jsx(Xr,{onAddComment:d,isSendDisabled:o,isWaitingForCommentResponse:i}),A!==ge.ALL_HIDDEN&&M.jsx("div",{className:y?"mr-4":"",children:M.jsx(zn,{getStableCommentId:w,availableWidth:ie,comments:e,commentsMode:A,onAddComment:d,onAcceptComment:u,onDismissComment:h,isWaitingForCommentResponse:i,isRequestActive:s,disableBlockComments:!0})})]}),M.jsxs(ne.ContextChildren,{children:[f&&M.jsx(eo,{diff:f}),!x&&M.jsx(fn,{isRequestActive:s,isVisuallyHidden:o||r?.isReadonly&&!r.isStreaming,onSubmit:B,onCancel:E,actions:dn,onExpandedChange:l})]})]})})};export{vo as CodeComposer};
//# sourceMappingURL=jnlzvywg6sl6bj5h.js.map
