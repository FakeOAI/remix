import{r as s,N as Ke,eT as O,ev as eA,g as ee,L as Z,c4 as te,m as o,hG as He,a8 as $e,ag as U,d3 as At,df as et,cb as oe,a_ as ne,aD as uA,c7 as tA,aL as tt,D as ot,e_ as ae,e$ as nt,bx as at,u as st,bn as it,aK as rt,aT as ct,hH as lt}from"./ejnnsd2ul10wwon8.js";import{c as se,aA as dt,a7 as ut,bK as mt,bL as ft,bM as gt,bN as pt,av as ht,ac as xt,a as TA,bO as bt,au as vt,bp as kt,I as Ct,bP as Et,bQ as St,p as It}from"./iq818lbd3vi25zxi.js";import{jf as NA,b$ as Bt,jd as ie,bn as MA,dO as OA,d3 as mA,aF as wt,je as re,d2 as Mt,kl as yt,km as jt,aD as L,ka as Vt,bT as Qt,cp as Rt,bU as ZA,kc as ce,kb as le,kn as FA,ko as Dt,kp as Tt,bB as Nt}from"./71wmxosf3hlynfn3.js";import{$ as Ot,C as Zt,_ as j,R as dA,f as Y,M as Ft,m as YA,y as Yt,W as oA,T as G,O as de,N as Lt,S as iA,n as ue,o as SA,p as IA,q as Wt,Y as Gt,F as Jt,x as Pt,b as fA,k as xA,r as bA,s as me,l as fe,a as S,t as ge,v as Xt,d as yA,e as jA,w as pe,g as Ut,V as D,X as LA,z as BA,A as _t,E as qt}from"./g5l9lzquxe1dsy3t.js";import{u as VA,a as zt,V as Kt}from"./mpfrwmow0k2ocv1u.js";import{M as he}from"./hyu4w5767f0t6xo1.js";import{m as w}from"./bhodeadh6qtod2rx.js";import{W as Ht}from"./hpr9emzdoqezsi05.js";import{u as $t,s as Ao,B as xe,a as rA,b as cA,c as eo,d as to,e as oo,T as no,n as ao,V as so,f as io}from"./gtn5eh3dc9652n2d.js";import"./h0kpabp1jtuoi17n.js";import"./nrpmzwpmkgs4zly1.js";import"./o4stuqgjq01q0m8v.js";import"./k55tvdvc94a3v24b.js";import"./jl6nxl2zxu4djhch.js";import"./moogu9j7gmp2sz13.js";import"./ez66yy6ef0rdgwfu.js";import"./hoa50yshgnfy7z32.js";import"./m3kxuhbm52zu7odn.js";import"./c4bxzbp1808foto4.js";function be(A){var e,t,n="";if(typeof A=="string"||typeof A=="number")n+=A;else if(typeof A=="object")if(Array.isArray(A)){var a=A.length;for(e=0;e<a;e++)A[e]&&(t=be(A[e]))&&(n&&(n+=" "),n+=t)}else for(t in A)A[t]&&(n&&(n+=" "),n+=t);return n}function ro(){for(var A,e,t=0,n="",a=arguments.length;t<a;t++)(A=arguments[t])&&(e=be(A))&&(n&&(n+=" "),n+=e);return n}function co(...A){return(...e)=>{for(const t of A)if(typeof t=="function")try{t(...e)}catch(n){console.error(n)}}}function ve(...A){const e={...A[0]};for(let t=1;t<A.length;t++){const n=A[t];for(const a in n){const r=e[a],c=n[a];typeof r=="function"&&typeof c=="function"&&a[0]==="o"&&a[1]==="n"&&a.charCodeAt(2)>=65&&a.charCodeAt(2)<=90?e[a]=co(r,c):(a==="className"||a==="UNSAFE_className")&&typeof r=="string"&&typeof c=="string"?e[a]=ro(r,c):e[a]=c!==void 0?c:r}}return e}const lo={connect:!0,audio:!1,video:!1};function uo(A){const{token:e,serverUrl:t,options:n,room:a,connectOptions:r,connect:c,audio:i,video:l,screen:d,onConnected:m,onDisconnected:u,onError:p,onMediaDeviceFailure:b,onEncryptionError:f,simulateParticipants:h,...g}={...lo,...A};n&&a&&j.warn("when using a manually created room, the options object will be ignored. set the desired options directly when creating the room instead.");const[x,M]=s.useState();s.useEffect(()=>{M(a??new dA(n))},[a]);const E=s.useMemo(()=>{const{className:v}=Yt();return ve(g,{className:v})},[g]);return s.useEffect(()=>{if(!x)return;const v=()=>{const I=x.localParticipant;j.debug("trying to publish local tracks"),Promise.all([I.setMicrophoneEnabled(!!i,typeof i!="boolean"?i:void 0),I.setCameraEnabled(!!l,typeof l!="boolean"?l:void 0),I.setScreenShareEnabled(!!d,typeof d!="boolean"?d:void 0)]).catch(B=>{j.warn(B),p?.(B)})},y=I=>{const B=Ft.getFailure(I);b?.(B)},C=I=>{f?.(I)};return x.on(Y.SignalConnected,v).on(Y.MediaDevicesError,y).on(Y.EncryptionError,C),()=>{x.off(Y.SignalConnected,v).off(Y.MediaDevicesError,y).off(Y.EncryptionError,C)}},[x,i,l,d,p,f,b]),s.useEffect(()=>{if(x){if(h){x.simulateParticipants({participants:{count:h},publish:{audio:!0,useRealTracks:!0}});return}if(!e){j.debug("no token yet");return}if(!t){j.warn("no livekit url provided"),p?.(Error("no livekit url provided"));return}c?(j.debug("connecting"),x.connect(t,e,r).catch(v=>{j.warn(v),p?.(v)})):(j.debug("disconnecting because connect is false"),x.disconnect())}},[c,e,JSON.stringify(r),x,p,t,h]),s.useEffect(()=>{if(!x)return;const v=y=>{switch(y){case YA.Disconnected:u&&u();break;case YA.Connected:m&&m();break}};return x.on(Y.ConnectionStateChanged,v),()=>{x.off(Y.ConnectionStateChanged,v)}},[e,m,u,x]),s.useEffect(()=>{if(x)return()=>{j.info("disconnecting on onmount"),x.disconnect()}},[x]),{room:x,htmlProps:E}}const mo=s.forwardRef(function(A,e){const{room:t,htmlProps:n}=uo(A);return s.createElement("div",{ref:e,...n},t&&s.createElement(Ot.Provider,{value:t},s.createElement(Zt.Provider,{value:A.featureFlags},A.children)))});function fo(A){return A!==void 0}function go(...A){return ve(...A.filter(fo))}function ke(A,e={}){const[t,n]=s.useState(Wt(A)),[a,r]=s.useState(t?.isMuted),[c,i]=s.useState(t?.isSubscribed),[l,d]=s.useState(t?.track),[m,u]=s.useState("landscape"),p=s.useRef(),{className:b,trackObserver:f}=s.useMemo(()=>Gt(A),[A.participant.sid??A.participant.identity,A.source,Jt(A)&&A.publication.trackSid]);return s.useEffect(()=>{const h=f.subscribe(g=>{j.debug("update track",g),n(g),r(g?.isMuted),i(g?.isSubscribed),d(g?.track)});return()=>h?.unsubscribe()},[f]),s.useEffect(()=>{var h,g;return l&&(p.current&&l.detach(p.current),(h=e.element)!=null&&h.current&&!(de(A.participant)&&l?.kind==="audio")&&l.attach(e.element.current)),p.current=(g=e.element)==null?void 0:g.current,()=>{p.current&&l?.detach(p.current)}},[l,e.element]),s.useEffect(()=>{var h,g;if(typeof((h=t?.dimensions)==null?void 0:h.width)=="number"&&typeof((g=t?.dimensions)==null?void 0:g.height)=="number"){const x=t.dimensions.width>t.dimensions.height?"landscape":"portrait";u(x)}},[t]),{publication:t,isMuted:a,isSubscribed:c,track:l,elementProps:go(e.props,{className:b,"data-lk-local-participant":A.participant.isLocal,"data-lk-source":t?.source,...t?.kind==="video"&&{"data-lk-orientation":m}})}}var po="Expected a function",WA=NaN,ho="[object Symbol]",xo=/^\s+|\s+$/g,bo=/^[-+]0x[0-9a-f]+$/i,vo=/^0b[01]+$/i,ko=/^0o[0-7]+$/i,Co=parseInt,Eo=typeof iA=="object"&&iA&&iA.Object===Object&&iA,So=typeof self=="object"&&self&&self.Object===Object&&self,Io=Eo||So||Function("return this")(),Bo=Object.prototype,wo=Bo.toString,Mo=Math.max,yo=Math.min,vA=function(){return Io.Date.now()};function jo(A,e,t){var n,a,r,c,i,l,d=0,m=!1,u=!1,p=!0;if(typeof A!="function")throw new TypeError(po);e=GA(e)||0,wA(t)&&(m=!!t.leading,u="maxWait"in t,r=u?Mo(GA(t.maxWait)||0,e):r,p="trailing"in t?!!t.trailing:p);function b(C){var I=n,B=a;return n=a=void 0,d=C,c=A.apply(B,I),c}function f(C){return d=C,i=setTimeout(x,e),m?b(C):c}function h(C){var I=C-l,B=C-d,W=e-I;return u?yo(W,r-B):W}function g(C){var I=C-l,B=C-d;return l===void 0||I>=e||I<0||u&&B>=r}function x(){var C=vA();if(g(C))return M(C);i=setTimeout(x,h(C))}function M(C){return i=void 0,p&&n?b(C):(n=a=void 0,c)}function E(){i!==void 0&&clearTimeout(i),d=0,n=l=a=i=void 0}function v(){return i===void 0?c:M(vA())}function y(){var C=vA(),I=g(C);if(n=arguments,a=this,l=C,I){if(i===void 0)return f(l);if(u)return i=setTimeout(x,e),b(l)}return i===void 0&&(i=setTimeout(x,e)),c}return y.cancel=E,y.flush=v,y}function wA(A){var e=typeof A;return!!A&&(e=="object"||e=="function")}function Vo(A){return!!A&&typeof A=="object"}function Qo(A){return typeof A=="symbol"||Vo(A)&&wo.call(A)==ho}function GA(A){if(typeof A=="number")return A;if(Qo(A))return WA;if(wA(A)){var e=typeof A.valueOf=="function"?A.valueOf():A;A=wA(e)?e+"":e}if(typeof A!="string")return A===0?A:+A;A=A.replace(xo,"");var t=vo.test(A);return t||ko.test(A)?Co(A.slice(2),t?2:8):bo.test(A)?WA:+A}var Ro=jo;const JA=Pt(Ro);function Do(A){const e=s.useRef(A);e.current=A,s.useEffect(()=>()=>{e.current()},[])}function To(A,e=500,t){const n=s.useRef();Do(()=>{n.current&&n.current.cancel()});const a=s.useMemo(()=>{const r=JA(A,e,t),c=(...i)=>r(...i);return c.cancel=()=>{r.cancel()},c.isPending=()=>!!n.current,c.flush=()=>r.flush(),c},[A,e,t]);return s.useEffect(()=>{n.current=JA(A,e,t)},[A,e,t]),a}function No(A,e,t){const n=(d,m)=>d===m,a=A instanceof Function?A():A,[r,c]=s.useState(a),i=s.useRef(a),l=To(c,e,t);return n(i.current,a)||(l(a),i.current=a),[r,l]}function Oo({threshold:A=0,root:e=null,rootMargin:t="0%",freezeOnceVisible:n=!1,initialIsIntersecting:a=!1,onChange:r}={}){var c;const[i,l]=s.useState(null),[d,m]=s.useState(()=>({isIntersecting:a,entry:void 0})),u=s.useRef();u.current=r;const p=((c=d.entry)==null?void 0:c.isIntersecting)&&n;s.useEffect(()=>{if(!i||!("IntersectionObserver"in window)||p)return;let h;const g=new IntersectionObserver(x=>{const M=Array.isArray(g.thresholds)?g.thresholds:[g.thresholds];x.forEach(E=>{const v=E.isIntersecting&&M.some(y=>E.intersectionRatio>=y);m({isIntersecting:v,entry:E}),u.current&&u.current(v,E),v&&n&&h&&(h(),h=void 0)})},{threshold:A,root:e,rootMargin:t});return g.observe(i),()=>{g.disconnect()}},[i,JSON.stringify(A),e,t,p,n]);const b=s.useRef(null);s.useEffect(()=>{var h;!i&&(h=d.entry)!=null&&h.target&&!n&&!p&&b.current!==d.entry.target&&(b.current=d.entry.target,m({isIntersecting:a,entry:void 0}))},[i,d.entry,n,p,a]);const f=[l,!!d.isIntersecting,d.entry];return f.ref=f[0],f.isIntersecting=f[1],f.entry=f[2],f}const Ce=s.forwardRef(function({onTrackClick:A,onClick:e,onSubscriptionStatusChanged:t,trackRef:n,manageSubscription:a,...r},c){const i=ue(n),l=s.useRef(null);s.useImperativeHandle(c,()=>l.current);const d=Oo({root:l.current}),[m]=No(d,3e3);s.useEffect(()=>{a&&i.publication instanceof SA&&m?.isIntersecting===!1&&d?.isIntersecting===!1&&i.publication.setSubscribed(!1)},[m,i,a]),s.useEffect(()=>{a&&i.publication instanceof SA&&d?.isIntersecting===!0&&i.publication.setSubscribed(!0)},[d,i,a]);const{elementProps:u,publication:p,isSubscribed:b}=ke(i,{element:l,props:r});s.useEffect(()=>{t?.(!!b)},[b,t]);const f=h=>{e?.(h),A?.({participant:i?.participant,track:p})};return s.createElement("video",{ref:l,...u,muted:!0,onClick:f})}),Zo=s.forwardRef(function({trackRef:A,onSubscriptionStatusChanged:e,volume:t,muted:n,...a},r){const c=ue(A),i=s.useRef(null);s.useImperativeHandle(r,()=>i.current);const{elementProps:l,isSubscribed:d,track:m,publication:u}=ke(c,{element:i,props:a});return s.useEffect(()=>{e?.(!!d)},[d,e]),s.useEffect(()=>{m===void 0||t===void 0||(m instanceof IA?m.setVolume(t):j.warn("Volume can only be set on remote audio tracks."))},[t,m]),s.useEffect(()=>{u===void 0||n===void 0||(u instanceof SA?u.setEnabled(!n):j.warn("Can only call setEnabled on remote track publications."))},[n,u,m]),s.createElement("audio",{ref:i,...l})});function Fo({volume:A,muted:e}){const t=oA([G.Source.Microphone,G.Source.ScreenShareAudio,G.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0}).filter(n=>!de(n.participant)&&n.publication.kind===G.Kind.Audio);return s.createElement("div",{style:{display:"none"}},t.map(n=>s.createElement(Zo,{key:Lt(n),trackRef:n,volume:A,muted:e})))}const Ee=()=>{const A=Ke(),e=s.useCallback(()=>fA.getState().isVoiceModeActive,[]);return s.useMemo(()=>new Proxy(A,{get(t,n){const a=t[n];return e()||n==="closeAll"?a:()=>{}}}),[e,A])};function Yo(){const A=Ee(),e=s.useCallback(()=>{xA.debug("disconnected from room"),bA()},[]),t=s.useCallback(a=>{A.danger("Something went wrong"),xA.error("an error occurred within the room",a);const r=NA(fA.getState());O.voiceMode.error({...r,error:a.message}),bA()},[A]),n=s.useCallback(a=>{A.danger("Something went wrong"),xA.error("an encryption error occurred within the room",a);const r=NA(fA.getState());O.voiceMode.error({encryptionError:a.message,eventSource:"voice-session",...r}),bA()},[A]);return{onDisconnected:e,onError:t,onEncryptionError:n}}function Se({conversationId:A}){const{shouldDelayDisconnect:e,delayDisconnect:t,immediateDisconnect:n}=VA({refetchLater:!0}),{toggleMute:a}=me(),r=eA(A);return s.useCallback(async()=>{O.voiceSessionEndedByUser.click(),Bt.setState({voiceFeedbackThread:r,lastVoiceSessionEndTime:new Date}),e?(await a(),t()):n()},[t,n,r,e,a])}var Lo={webm:"data:video/webm;base64,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",mp4:"data:video/mp4;base64,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"};const{webm:Wo,mp4:Go}=Lo,kA=()=>typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,CA=()=>"wakeLock"in navigator;class Jo{constructor(){if(this.enabled=!1,CA()){this._wakeLock=null;const e=()=>{this._wakeLock!==null&&document.visibilityState==="visible"&&this.enable()};document.addEventListener("visibilitychange",e),document.addEventListener("fullscreenchange",e)}else kA()?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("title","No Sleep"),this.noSleepVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.noSleepVideo,"webm",Wo),this._addSourceToVideo(this.noSleepVideo,"mp4",Go),this.noSleepVideo.addEventListener("loadedmetadata",()=>{this.noSleepVideo.duration<=1?this.noSleepVideo.setAttribute("loop",""):this.noSleepVideo.addEventListener("timeupdate",()=>{this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())})}))}_addSourceToVideo(e,t,n){var a=document.createElement("source");a.src=n,a.type=`video/${t}`,e.appendChild(a)}get isEnabled(){return this.enabled}enable(){return CA()?navigator.wakeLock.request("screen").then(e=>{this._wakeLock=e,this.enabled=!0,console.log("Wake Lock active."),this._wakeLock.addEventListener("release",()=>{console.log("Wake Lock released.")})}).catch(e=>{throw this.enabled=!1,console.error(`${e.name}, ${e.message}`),e}):kA()?(this.disable(),console.warn(`
        NoSleep enabled for older iOS devices. This can interrupt
        active or long-running network requests from completing successfully.
        See https://github.com/richtr/NoSleep.js/issues/15 for more details.
      `),this.noSleepTimer=window.setInterval(()=>{document.hidden||(window.location.href=window.location.href.split("#")[0],window.setTimeout(window.stop,0))},15e3),this.enabled=!0,Promise.resolve()):this.noSleepVideo.play().then(t=>(this.enabled=!0,t)).catch(t=>{throw this.enabled=!1,t})}disable(){CA()?(this._wakeLock&&this._wakeLock.release(),this._wakeLock=null):kA()?this.noSleepTimer&&(console.warn(`
          NoSleep now disabled for older iOS devices.
        `),window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause(),this.enabled=!1}}var Po=Jo;const Xo=ee(Po);function Uo(A){const e=A.default_voice_mode,t=A.modes.find(n=>n.mode===e);if(!t)throw new Error("Voice status returned a default_voice_mode that does not exist in the modes array");return t.default_model_slug}function QA(){const A=Z(),e=Ee(),{startVoiceMode:t,stopVoiceMode:n,isConnected:a,isVoiceModeActive:r}=fe(),c=s.useCallback(async i=>{const l={conversation_id:i.serverThreadId,parent_message_id:i.parentMessageId,model_slug:i.modelSlug,model_slug_advanced:i.isAdvancedMode?i.modelSlug:void 0,voice_mode:i.isAdvancedMode?"advanced":"standard",eventSource:i.eventSource,clientThreadId:i.clientThreadId,gizmo_id:i.gizmoId,voice:i.voice},d=A.formatMessage({id:"useVoiceModeButtonAction.error",defaultMessage:"Failed to start voice mode"});try{await t(l)}catch{if(i.isAdvancedMode&&i.retryWithStandard)try{await t({...l,voice_mode:"standard"})}catch{e.danger(d),O.voiceMode.error({error:d})}else e.danger(d),O.voiceMode.error({error:d})}},[A,t,e]);return{isVoiceModeActive:r,isConnected:a,toggleVoiceMode:c,stopVoiceMode:n}}const Ie="inline-flex items-center bg-transparent text-token-text-secondary hover:text-token-text-primary",_o=({message:A,onClick:e,type:t})=>{const n=Z(),a=ie()&&te;if(!A)return null;switch(t){case"microphone_denied":return a?o.jsxs("a",{href:"ms-settings:privacy-microphone",className:Ie,children:[A,o.jsx(se,{className:"icon-sm ml-1"})]}):o.jsx(PA,{onClick:e,message:A});case"connection_quality":return o.jsxs("div",{className:"inline-flex items-center",children:[A,o.jsx("button",{onClick:e,className:"ml-1",children:o.jsx("strong",{children:n.formatMessage(Be.retry)})})]});case"normal":return o.jsx(PA,{onClick:e,message:A})}},PA=({message:A,onClick:e})=>{const t=Z();return o.jsxs("button",{onClick:e,className:Ie,"aria-label":t.formatMessage(Be.openInfoModal),children:[A,o.jsx(se,{className:"icon-sm ml-1"})]})},Be={openInfoModal:{id:"hintMessage.openInfoModal",defaultMessage:"Open info modal",description:"Open info modal about voice mode usage"},retry:{id:"hintMessage.retry",defaultMessage:"Retry",description:"Retry text next to lost connection message"}};function qo(A){const{button:e,conversationId:t,modelId:n,onClick:a}=A,r=eA(t),c=MA(t),i=e.action==="new_chat"?c:n,{toggleVoiceMode:l}=QA(),d=$e(),m=s.useCallback(()=>{switch(e.action){case"new_chat":{const u=i??mA;wt(`/?model=${u}`),l({serverThreadId:void 0,modelSlug:u,isAdvancedMode:!0,eventSource:`modal_${e.action}`,parentMessageId:void 0,retryWithStandard:!1,clientThreadId:At(),gizmoId:void 0});break}case"switch_to_standard":r&&n&&l({serverThreadId:r,modelSlug:i??mA,isAdvancedMode:!1,eventSource:`modal_${e.action}`,parentMessageId:void 0,retryWithStandard:!1,clientThreadId:r,gizmoId:U.getGizmoId(t)});break;case"upgrade_to_plus":OA(d,"Voice Mode Upgrade To Plus Modal");break;case"upgrade_to_pro":OA(d,"Voice Mode Upgrade To Pro Modal");break}a?.()},[e.action,t,i,n,d,a,r,l]);return o.jsx(et.Button,{onClick:m,title:e.title,color:A.color})}const zo={primary:"primary",secondary:"secondary",tertiary:"ghost"};function we({buttons:A,conversationId:e,modelId:t,onClick:n}){let a,r,c;return!A||A.length===0?{primary:void 0,secondary:void 0,tertiary:void 0}:(A.forEach(i=>{if(!He.includes(i.action))return;const d=o.jsx(qo,{button:i,conversationId:e,modelId:t,onClick:n,color:zo[i.style]});switch(i.style){case"primary":a=d;break;case"secondary":r=d;break;case"tertiary":c=d;break}}),{primary:a,secondary:r,tertiary:c})}function Ko({conversationId:A,modelId:e,isOpen:t,onClose:n,buttons:a,title:r,description_markdown:c}){const i=we({buttons:a,conversationId:A,modelId:e,onClick:n}),l=o.jsx(he,{className:"markdown mb-6 text-token-text-secondary",urlTransform:d=>d,children:c});return o.jsx(oe,{title:r,isOpen:t,onClose:n,size:"custom",className:"max-w-[550px]",type:"warning",showCloseButton:!0,children:o.jsxs("div",{className:"w-full",children:[l,o.jsxs("div",{className:"flex flex-row justify-end gap-6",children:[i.primary,i.secondary,i.tertiary]})]})})}function Ho({conversationId:A,currentModelId:e}){const t=Z(),n=Se({conversationId:A}),a=S(k=>k.server.usage),r=S(k=>k.server.voiceConnectionQuality),c=k=>k===pe.Lost,i=S(k=>k.server.connectionState),l=ge(),[d,m]=s.useState(!1),u=S(k=>k.server.toolUpdate),[p,b]=s.useState(!1),[f,h]=s.useState(!0),[g,x]=s.useState(null),[M,E]=s.useState(null),[v,y]=s.useState(null),[C,I]=s.useState(!1),[B,W]=s.useState(!1),T=s.useRef(!1),q=eA(A),{stopVoiceMode:z,toggleVoiceMode:K,isVoiceModeActive:V}=QA(),nA=Xt();s.useEffect(()=>{B||nA().then(k=>{I(k)}).finally(()=>{W(!0)})},[nA,B]);const H=S(k=>k.dev.room?.localParticipant.isMicrophoneEnabled);s.useEffect(()=>{V&&(C&&!H)&&(W(!1),I(!1))},[V,H,C]);const gA=ie()&&te,R=V&&B&&!C,Q=V&&C&&!i&&l;s.useEffect(()=>{R&&(m(!1),y(null),x(t.formatMessage(EA.hint)),E({title:t.formatMessage(EA.title),description_markdown:t.formatMessage(EA.description_markdown),buttons:[]}))},[t,gA,R]),s.useEffect(()=>{if(Q&&!T.current){T.current=!0,x(null),E(null);const k=Uo(l),P=U.getCurrentNode(A)?.id,sA={serverThreadId:q,modelSlug:k,parentMessageId:P,isAdvancedMode:l.default_voice_mode==="advanced",retryWithStandard:!0,eventSource:"composer_speech_button",clientThreadId:A,gizmoId:U.getGizmoId(A)};O.voiceSessionStarted.click(),K(sA)}},[A,Q,l,q,K]);const{reaching_limit_disclosure:$,exceed_limit_message:F}=a?.rate_limit_message??{},aA=l?.modes.find(k=>k.mode===l?.default_voice_mode),pA=aA?.disclosure_message,hA=c(r)?"Lost connection.":$?.hint??F?.title??pA?.hint??null;s.useEffect(()=>{aA&&!R&&x(aA.disclosure_message?.hint??null)},[aA,R]),s.useEffect(()=>{const k=u?.text;let P,sA,DA;return k&&(h(!1),P=setTimeout(()=>{b(!0),sA=setTimeout(()=>{b(!1),DA=setTimeout(()=>{h(!0),fA.setState(ze=>{ze.server.toolUpdate=null})},750)},3e3)},750)),()=>{clearTimeout(P),clearTimeout(sA),clearTimeout(DA)}},[u]),s.useEffect(()=>{if(!R){if(hA&&x(hA),F&&V){z();const k={title:F.title,description_markdown:F.description_markdown,buttons:F.buttons};d?y(k):(E(k),m(!0)),O.rateLimitReached.success()}else if(!M){const k=$??pA;k&&E({title:k.title,description_markdown:k.message_markdown,buttons:k.buttons})}}},[pA,F,hA,d,V,M,$,z,R]);const Ge=s.useCallback(()=>{v&&(E(v),y(null)),m(!0)},[v]),Je=s.useCallback(()=>{m(!1)},[]),{startVoiceMode:Pe}=fe(),Xe=MA(A),Ue=S(k=>k.voiceMode),{voiceName:_e}=re(),qe=async()=>{try{x(null),await Pe({conversation_id:q,model_slug:Xe??mA,eventSource:"lost_connection_hint_message",voice_mode:Ue,voice:_e,clientThreadId:A,gizmo_id:U.getGizmoId(A)})}catch(k){const P=k instanceof Error?k.message:String(k);O.voiceMode.error({error:P,eventSource:"lost_connection_hint_message"})}};let AA;return R?AA="microphone_denied":c(r)?AA="connection_quality":AA="normal",o.jsxs("div",{className:"flex w-full flex-col items-center",children:[o.jsxs("div",{className:"relative mb-6 flex min-h-5 w-full items-center justify-center text-xs text-token-text-secondary",children:[u?.text&&o.jsx(w.div,{initial:{opacity:0},animate:{opacity:p?1:0},transition:{duration:.5},style:{position:"absolute",left:"50%",transform:"translateX(-50%)",textAlign:"center"},children:o.jsxs("div",{className:"flex items-center",children:[u?.text&&o.jsx(dt,{className:"icon-sm mr-1"}),u?.text]})}),o.jsx(w.div,{initial:{opacity:0},animate:{opacity:f?1:0},transition:{duration:.5},style:{position:"absolute",left:"50%",transform:"translateX(-50%)",textAlign:"center",pointerEvents:u?.text?"none":"auto",cursor:u?.text?"default":"pointer"},children:o.jsx("div",{className:"flex items-center",children:o.jsx(_o,{type:AA,message:g,onClick:AA==="connection_quality"?qe:Ge})})})]}),o.jsxs("div",{className:uA("flex flex-row items-center gap-6","rounded-full px-3 py-1","transition-width duration-200 ease-in-out"),children:[o.jsx(XA,{capability:"video",children:o.jsx($o,{})}),o.jsx(en,{shouldQueryDevices:!!Q,hideTooltip:R}),o.jsx(XA,{capability:"screenshare",children:o.jsx(tn,{})}),o.jsx(RA,{onClick:n})]}),o.jsx(Ko,{conversationId:A,modelId:e,isOpen:d,onClose:Je,title:M?.title,description_markdown:M?.description_markdown,buttons:M?.buttons??[]})]})}function XA({children:A,capability:e}){const t=zt();return!t.av||!t[e]?null:o.jsx(o.Fragment,{children:A})}function $o(){const{isVideoEnabled:A,isStartingVideo:e,toggleVideo:t}=yA();let n=null;e?n=tA:n=mt;const a=A?"bg-gray-900 hover:bg-gray-800 active:bg-gray-700":"bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10",r=A?"text-token-main-surface-primary":"text-token-main-surface-primary-inverse";return o.jsx(_,{onClick:()=>t("ControlButton"),disabled:e,icon:n,className:a,iconColor:r})}const An=async()=>{try{return(await Ut("audioinput"))?.label??""}catch(A){return console.warn("Error fetching default media device:",A),ot.addError("Failed to fetch default media device",{error:A}),"Error accessing microphone devices"}};function en({shouldQueryDevices:A,hideTooltip:e}){const{isMicrophoneEnabled:t,isMuting:n,toggleMute:a}=me(),r=Z(),{disconnectPending:c}=VA(),[i,l]=s.useState(""),d=t?ft:gt,m=t?"bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10":"bg-red-500/10 hover:bg-red-500/15 active:bg-red-500/20 dark:bg-red-500/10 dark:hover:bg-red-500/15 dark:active:bg-red-500/20",u=t?"text-token-main-surface-primary-inverse":"text-danger";s.useEffect(()=>{A&&An().then(b=>l(b))},[A]);const p=t?r.formatMessage({id:"PJzixV",defaultMessage:"Turn off microphone"}):r.formatMessage({id:"nbbUMb",defaultMessage:"Turn on microphone"});return o.jsx(_,{"aria-label":p,onClick:a,icon:d,disabled:n||c,className:m,iconColor:u,tooltipPrimaryLabel:!e&&i?p:"",tooltipSecondaryLabel:i})}function tn(){const{isScreenshareEnabled:A,isScreenshareStarting:e,toggleScreenShare:t}=jA();let n=null;e?n=tA:n=pt;const a=A?"bg-gray-900 hover:bg-gray-800 active:bg-gray-700":"bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10",r=A?"text-token-main-surface-primary":"text-token-main-surface-primary-inverse";return o.jsx(_,{onClick:()=>t("ControlButton"),disabled:e,icon:n,className:a,iconColor:r})}function RA({className:A,onClick:e}){const t=Z(),{disconnectPending:n}=VA(),a="bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10",r=t.formatMessage({id:"9Mto0a",defaultMessage:"End"});return o.jsx(_,{disabled:n,onClick:e,icon:n?tA:ut,iconColor:"text-token-main-surface-primary-inverse",className:A??a,"aria-label":t.formatMessage({id:"7/8k4Y",defaultMessage:"End voice mode"}),tooltipPrimaryLabel:r})}function _(A){const{icon:e,disabled:t,className:n,iconColor:a="text-current",iconSize:r="icon-xl",buttonSize:c="h-16 w-16",tooltipPrimaryLabel:i,tooltipSecondaryLabel:l,...d}=A,[m,u]=s.useState(!1),p=s.useRef(void 0),b=s.useCallback(()=>{const g=window.setTimeout(()=>{u(!0)},Mt);p.current=g},[]),f=s.useCallback(()=>{clearTimeout(p.current),u(!1)},[]),h=o.jsx(on,{className:uA(n,c,"overflow-hidden rounded-full border-none p-0.5 text-token-text-primary transition-colors duration-200 ease-in-out hover:text-token-text-secondary"),disabled:t,...d,children:o.jsx(e,{className:uA(r,a)})});return i?o.jsx(tt,{sideOffset:14,label:i,secondaryLabel:l,contentClassName:"flex flex-col items-center justify-center",className:"flex",open:m,side:"top",children:o.jsx("span",{onPointerEnter:b,onPointerLeave:f,children:h})}):h}const on=w(ne),EA={hint:{id:"micMessages.hint",defaultMessage:"Enable microphone access in Settings",description:"Hint to the user to manually enable microphone access for voice mode"},title:{id:"micMessages.title",defaultMessage:"Microphone access required",description:"Title for modal that informs the user that microphone access is required for voice mode"},description_markdown:{id:"micMessages.description_markdown",defaultMessage:"To use voice mode, you'll need to enable your microphone and try again.",description:"Description for modal that informs the user that microphone access is required for voice mode"}};function nn(A,e,t,n){var a=-1,r=A==null?0:A.length;for(n&&r&&(t=A[++a]);++a<r;)t=e(t,A[a],a,A);return t}var an=nn;function sn(A){return function(e){return A?.[e]}}var rn=sn,cn=rn,ln={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},dn=cn(ln),un=dn,mn=un,fn=ae,gn=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,pn="\\u0300-\\u036f",hn="\\ufe20-\\ufe2f",xn="\\u20d0-\\u20ff",bn=pn+hn+xn,vn="["+bn+"]",kn=RegExp(vn,"g");function Cn(A){return A=fn(A),A&&A.replace(gn,mn).replace(kn,"")}var En=Cn,Sn=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function In(A){return A.match(Sn)||[]}var Bn=In,wn=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function Mn(A){return wn.test(A)}var yn=Mn,Me="\\ud800-\\udfff",jn="\\u0300-\\u036f",Vn="\\ufe20-\\ufe2f",Qn="\\u20d0-\\u20ff",Rn=jn+Vn+Qn,ye="\\u2700-\\u27bf",je="a-z\\xdf-\\xf6\\xf8-\\xff",Dn="\\xac\\xb1\\xd7\\xf7",Tn="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Nn="\\u2000-\\u206f",On=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ve="A-Z\\xc0-\\xd6\\xd8-\\xde",Zn="\\ufe0e\\ufe0f",Qe=Dn+Tn+Nn+On,Re="['’]",UA="["+Qe+"]",Fn="["+Rn+"]",De="\\d+",Yn="["+ye+"]",Te="["+je+"]",Ne="[^"+Me+Qe+De+ye+je+Ve+"]",Ln="\\ud83c[\\udffb-\\udfff]",Wn="(?:"+Fn+"|"+Ln+")",Gn="[^"+Me+"]",Oe="(?:\\ud83c[\\udde6-\\uddff]){2}",Ze="[\\ud800-\\udbff][\\udc00-\\udfff]",X="["+Ve+"]",Jn="\\u200d",_A="(?:"+Te+"|"+Ne+")",Pn="(?:"+X+"|"+Ne+")",qA="(?:"+Re+"(?:d|ll|m|re|s|t|ve))?",zA="(?:"+Re+"(?:D|LL|M|RE|S|T|VE))?",Fe=Wn+"?",Ye="["+Zn+"]?",Xn="(?:"+Jn+"(?:"+[Gn,Oe,Ze].join("|")+")"+Ye+Fe+")*",Un="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",_n="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",qn=Ye+Fe+Xn,zn="(?:"+[Yn,Oe,Ze].join("|")+")"+qn,Kn=RegExp([X+"?"+Te+"+"+qA+"(?="+[UA,X,"$"].join("|")+")",Pn+"+"+zA+"(?="+[UA,X+_A,"$"].join("|")+")",X+"?"+_A+"+"+qA,X+"+"+zA,_n,Un,De,zn].join("|"),"g");function Hn(A){return A.match(Kn)||[]}var $n=Hn,Aa=Bn,ea=yn,ta=ae,oa=$n;function na(A,e,t){return A=ta(A),e=t?void 0:e,e===void 0?ea(A)?oa(A):Aa(A):A.match(e)||[]}var aa=na,sa=an,ia=En,ra=aa,ca="['’]",la=RegExp(ca,"g");function da(A){return function(e){return sa(ra(ia(e).replace(la,"")),A,"")}}var ua=da,ma=ua,fa=yt,ga=ma(function(A,e,t){return A+(t?" ":"")+fa(e)}),pa=ga;const ha=ee(pa);function xa({conversationId:A}){const e=st("1426009137")?.value,t=eA(A),n=MA(A),a=U.getCurrentNode(A)?.id,r=ge();return!e||!n?null:o.jsx(J,{conversationId:t??A,parentMessageId:a,status:r})}function J(A){const e=A?.status?.modes,[t,n]=s.useState(!1),[a,r]=s.useState(),c=s.useCallback(d=>{r(d),n(!0)},[]),i=Z(),l=s.useCallback(()=>n(!1),[]);return o.jsxs(o.Fragment,{children:[o.jsx(nt,{contentAlign:"center",triggerButton:o.jsx(J.Trigger,{}),children:e?e.map(d=>{const m=d.default_model_slug;return s.createElement(J.Item,{...A,modelSlug:m,key:d.mode,voiceStatusMode:d,onShowModal:c})}):o.jsx("div",{role:"progressbar","aria-valuetext":i.formatMessage({defaultMessage:"Loading voice modes",id:"voiceModeButton.loadingModes"}),"aria-busy":"true","aria-live":"assertive","aria-valuemin":0,"aria-valuemax":100,children:o.jsx(tA,{"aria-hidden":"true",className:"my-4 min-w-full"})})}),o.jsx(J.Modal,{conversationId:A.conversationId,disabledModeMetadata:a,isOpen:t,onClose:l})]})}J.Modal=function(e){const t=e.disabledModeMetadata?.buttons??[],n=we({buttons:t,conversationId:e.conversationId,modelId:mA,onClick:e.onClose}),a=o.jsx(he,{children:e.disabledModeMetadata?.description_markdown});return o.jsx(oe,{title:e.disabledModeMetadata?.title,description:a,isOpen:e.isOpen,onClose:e.onClose,type:"success",primaryButton:n.primary,secondaryButton:n.secondary})};J.Trigger=s.forwardRef(function(e,t){const n=S(a=>a.voiceMode);return o.jsxs(jt,{ref:t,...e,children:[ha(n)??o.jsx(tA,{}),o.jsx(ht,{className:"icon-md text-token-text-tertiary"})]})});J.Item=function({conversationId:e,modelSlug:t,parentMessageId:n,voiceStatusMode:a,onShowModal:r}){const{disabled_mode_metadata:c,mode:i}=a,{toggleVoiceMode:l}=QA(),d=eA(e),m=s.useCallback(async()=>{c?r(c.disabled_message):l({serverThreadId:d,modelSlug:t,parentMessageId:n,isAdvancedMode:i==="advanced"&&!c,eventSource:"voice_mode_picker",retryWithStandard:!1,clientThreadId:e,gizmoId:U.getGizmoId(e)})},[e,c,i,t,r,n,d,l]);return o.jsx(at.Item,{onClick:m,children:o.jsxs("div",{children:[a.display_name,o.jsx("div",{className:"text-xs text-token-text-tertiary",children:a.description})]})})};function ba({conversationId:A}){const e=S(n=>n.server.messages),t=S(n=>n.voiceSessionId);return o.jsx("div",{className:"relative h-full",children:o.jsx(w.div,{className:"absolute hidden h-full max-w-[500px] overflow-y-hidden rounded-xl border-l border-l-token-sidebar-surface-secondary bg-token-main-surface-secondary pt-4 shadow-inner md:block",initial:{opacity:0,x:520,width:"0px"},animate:{opacity:1,x:0,width:"500px",left:"-520px"},exit:{opacity:0,x:520,width:"0px",left:"0px"},transition:{type:"tween"},children:o.jsx(L,{children:o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"flex w-full items-center justify-center",children:o.jsx(xa,{conversationId:A})}),o.jsx("div",{className:"p-4 py-2 text-sm",children:o.jsx(N,{name:"Voice Session ID",text:t??"n/a"})}),e.length?o.jsxs(w.div,{className:"flex h-full w-full flex-col",initial:{opacity:0,x:-100},animate:{opacity:1,x:0},exit:{opacity:0,x:-100},children:[o.jsx(va,{}),o.jsx("h3",{className:"p-4 py-2 text-lg font-semibold text-token-text-secondary",children:"Messages"}),o.jsx("div",{className:"grow overflow-hidden",children:o.jsx(Ht,{children:o.jsx(w.ul,{className:"pointer-events-none flex w-full flex-col gap-4 pb-24 pt-4",initial:"initial",animate:"animate",exit:"exit",variants:Le,transition:{delayChildren:.25,staggerChildren:.05},children:e.map((n,a)=>o.jsx(Sa,{index:a,message:n},a))})})})]}):null]})})})})}function va(){return o.jsx("div",{className:"px-4 pb-8",children:o.jsxs("div",{className:"flex flex-col flex-nowrap gap-2",children:[o.jsx(ka,{}),o.jsx(Ca,{})]})})}function ka(){const A=S(i=>i.server.connectionState),e=S(i=>i.dev.room),[t,n]=s.useState("Unknown"),a=e?.localParticipant,r=e?.numParticipants??"Unknown",c=e?.activeSpeakers??[];return s.useEffect(()=>{if(a){const i=l=>{n(l)};return a.on("connectionQualityChanged",i),()=>{a.off("connectionQualityChanged",i)}}},[a]),o.jsxs(o.Fragment,{children:[o.jsx(N,{name:"Connection Quality",text:String(t)}),o.jsx(N,{name:"Connection State",text:String(A)}),o.jsx(N,{name:"Participants",text:r}),o.jsx(N,{name:"Speakers",text:c.length})]})}function Ca(){const A=S(m=>m.dev.room),[e,t]=s.useState(null),[n,a]=s.useState(null),[r,c]=s.useState(null),i=A?.getActiveDevice("audioinput"),l=A?.getActiveDevice("audiooutput"),d=A?.getActiveDevice("videoinput");return s.useEffect(()=>{async function m(){const u=await dA.getLocalDevices("audioinput"),p=await dA.getLocalDevices("audiooutput"),b=await dA.getLocalDevices("videoinput"),f=u.find(x=>x.deviceId===i),h=p.find(x=>x.deviceId===l),g=b.find(x=>x.deviceId===d);t(f?.label??"Unknown"),a(h?.label??"Unknown"),c(g?.label??null)}m()},[i,l,d]),o.jsxs(o.Fragment,{children:[o.jsx(KA,{text:"Devices"}),r?o.jsx(N,{icon:xt,name:"Video Input",text:r}):null,o.jsx(N,{icon:TA,name:"Audio Input",text:e??"Unknown"}),o.jsx(N,{icon:bt,name:"Audio Output",text:n??"Unknown"}),o.jsx(KA,{text:"Monitors"}),o.jsx(N,{name:"Mic level",icon:TA,text:"unknown",content:o.jsx(Ea,{})})]})}function Ea(){const A=S(e=>e.dev.room?.localParticipant.audioLevel);return o.jsx("div",{className:"flex flex-row flex-nowrap items-center gap-1",children:o.jsx("div",{className:"flex flex-row flex-nowrap items-center gap-1",children:Array.from({length:10}).map((e,t)=>o.jsx("div",{className:`h-2 w-2 rounded-full ${(A??0)>t*.1?"bg-gray-500":"bg-token-main-surface-tertiary"}`},t))})})}function KA({text:A}){return o.jsx("h4",{className:"py-2 text-sm font-semibold",children:A})}function N(A){return o.jsxs("div",{className:"flex flex-row flex-nowrap items-center gap-2",children:[o.jsx("span",{className:"opacity-85",children:A.icon?o.jsx(A.icon,{className:"h-[0.75rem] w-[0.75rem]"}):o.jsxs("span",{className:"text-sm",children:[A.name,":"]})}),A.content??o.jsx("span",{className:"line-clamp-1 rounded-lg bg-token-main-surface-tertiary p-0.5 px-1 font-mono text-xs",children:A.text})]})}function Sa({index:A,message:e}){const[t,n]=s.useState(!1),a=Z();let r=null;switch(e.source){case"remote":r=Ct;break;case"local":r=kt;break}return o.jsx(w.div,{className:"w-full border-t border-token-main-surface-tertiary p-4",variants:Le,children:o.jsxs("div",{className:"flex w-full flex-col gap-2 rounded-lg bg-token-main-surface-secondary",children:[o.jsxs("div",{className:"font-mono text-[0.65rem] font-semibold text-token-text-secondary",children:[o.jsxs("div",{className:"flex w-full flex-row flex-nowrap items-center justify-between",children:[o.jsxs("div",{className:"flex flex-row flex-nowrap items-center gap-1",children:[o.jsx(r,{className:"h-3 w-3 text-token-text-secondary"}),o.jsx("span",{children:` | ${A+1} | ${a.formatDate(e.timestamp,{hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:2})}`})]}),o.jsx("div",{className:"flex flex-row flex-nowrap items-center gap-2",children:o.jsx(ne,{className:"rounded-full p-0.5",color:"ghost",size:"small",onClick:()=>n(c=>!c),children:o.jsx(vt,{className:`transform transition-transform ${t?"rotate-180":""}`})})})]}),o.jsx("div",{className:"mt-1 text-xs font-bold",children:e.type})]}),o.jsx(L,{children:t?o.jsx(w.pre,{initial:{opacity:0,transform:"blur(4px)"},animate:{opacity:1,transform:"blur(0px)"},exit:{opacity:0,transform:"blur(4px)"},className:"overflow-x-auto rounded-md bg-token-main-surface-tertiary p-2 text-xs text-token-text-secondary",children:JSON.stringify(e.payload,null,2)}):null})]})})}const Le={hidden:{opacity:0,x:100},animate:{opacity:1,x:0},exit:{opacity:0,x:100}};function Ia({children:A}){const{isVideoEnabled:e}=yA(),{isScreenshareEnabled:t}=jA(),n=e||t;return o.jsx(L,{mode:"wait",children:n?o.jsx("div",{className:"flex h-full w-full flex-nowrap items-center",children:e?o.jsx(Ba,{}):o.jsx(wa,{})}):o.jsx(w.div,{className:"flex h-full w-full items-center justify-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:A},"children")})}function Ba(){const{isVideoEnabled:A,isStartingVideo:e,toggleVideo:t}=yA(),a=oA([G.Source.Camera]).find(c=>c.participant.isLocal),r=A&&!e&&a;return s.useEffect(()=>{const c=a?.publication?.track;if(c){const i=()=>{t("Browser Video Controls")};return c.on("ended",i),()=>{c.off("ended",i)}}},[a,t]),o.jsx(L,{children:r&&o.jsx(We,{children:o.jsxs("div",{className:"aspect-w-16 aspect-h-9 group relative max-h-[95%] w-fit max-w-[60%] overflow-hidden rounded-3xl shadow-md",children:[o.jsx("div",{className:"absolute right-2 top-2 z-10 opacity-0 transition-opacity group-hover:opacity-90",children:o.jsx(RA,{onClick:()=>t("StopButton"),className:"bg-gray-900 bg-opacity-20 backdrop-blur-lg hover:bg-opacity-30 dark:bg-gray-900 dark:bg-opacity-20 dark:backdrop-blur-lg dark:hover:bg-opacity-30"})}),o.jsx(Ce,{className:"h-full w-full object-contain",trackRef:a})]})},"camera-renderer")})}function wa(){const{isScreenshareEnabled:A,isScreenshareStarting:e,toggleScreenShare:t}=jA(),a=oA([G.Source.ScreenShare]).find(c=>c.participant.isLocal),r=A&&!e&&a;return s.useEffect(()=>{const c=a?.publication?.track;if(c){const i=()=>{t("Browser ScreenShare Controls")};return c.on("ended",i),()=>{c.off("ended",i)}}},[a,t]),o.jsx(L,{children:r&&o.jsx(We,{children:o.jsxs("div",{className:"aspect-w-16 aspect-h-9 group relative max-h-[95%] w-fit max-w-[60%] overflow-hidden rounded-3xl shadow-md",children:[o.jsx("div",{className:"absolute right-2 top-2 z-10 opacity-0 transition-opacity group-hover:opacity-90",children:o.jsx(RA,{onClick:()=>t("StopButton"),className:"bg-gray-900 bg-opacity-20 backdrop-blur-lg hover:bg-opacity-30 dark:bg-gray-900 dark:bg-opacity-20 dark:backdrop-blur-lg dark:hover:bg-opacity-30"})}),o.jsx(Ce,{className:"h-full w-full object-contain",trackRef:a})]})},"screenshare-renderer")})}function We({children:A,key:e}){return o.jsx(w.div,{className:"flex h-full w-full flex-col items-center justify-center gap-2 bg-token-main-surface-primary",initial:{opacity:0,transform:"blur(12px)",scale:.75},animate:{opacity:1,transform:"blur(0px)",scale:1},exit:{opacity:0,transform:"blur(12px)",scale:.75},transition:{duration:.2},children:A},e)}const HA=A=>{const[e,t]=s.useState({audioData:[0,0,0,0],cumulativeAudioData:[0,0,0,0]}),n=s.useRef([0,0,0,0]),a=s.useRef(void 0),r=s.useRef(performance.now()),{bandMagnitudes:c,cumulativeMagnitude:i}=$t(A,{bands:3,bins:1,gainMultipliers:[10,1,1]});n.current=[...c,i].flat();const l=s.useCallback(()=>{const d=performance.now(),m=(d-r.current)/1e3;r.current=d;const u=n.current,{audioData:p,cumulativeAudioData:b}=e,f=Ao({deltaTimeS:m,audioDataRaw:u,prevAudioData:p,prevCumulativeAudioData:b});t(f)},[e]);return s.useEffect(()=>(a.current||(a.current=window.setInterval(l,xe)),()=>{clearInterval(a.current),a.current=void 0}),[l]),e};function $A({className:A}){return o.jsx(Ta,{className:A})}const Ma=1.55,ya=1.4,ja="voice-wav",Va="shout",Qa="User",Ra={bands:4,loPass:0,hiPass:400},Ae=[300,300];function Da(){const{resolvedTheme:A}=it(),e=A==="dark",t=S(f=>f.voiceMode==="advanced"),n=oA([G.Source.Microphone]),a=n.find(f=>f.publication.trackName===ja),r=n.find(f=>f.publication.trackName===Va);let c=LA(r?.publication.audioTrack,Ra);c.length===0&&(c=[0,0,0,0]),c.map(f=>f*ya);let i=HA(r?.publication.audioTrack),l=HA(a?.publication.audioTrack);const d=i.audioData.map((f,h)=>{const g=l.audioData[h];return f>0&&g>0?(f+g)/2:f>0?f:g}),m=i.cumulativeAudioData.map((f,h)=>{const g=l.cumulativeAudioData[h];return f>0&&g>0?(f+g)/2:f>0?f:g}),u=S(f=>f.server.remoteState),p=n.find(f=>f.participant.identity===Qa),b=(LA(p,{bands:1,loPass:0,hiPass:400})[0]??0)*Ma;return{remoteState:u,userVolume:b,isAdvanced:t,avgMag:d,cumulativeAudio:m,isDarkMode:e,standardBloopVolumes:c}}function Ta({className:A}){const{remoteState:e,userVolume:t,isAdvanced:n,avgMag:a,cumulativeAudio:r,isDarkMode:c,standardBloopVolumes:i}=Da(),[l,d]=s.useState(Ae),{canvasSizeRef:m,handleCanvasSizeUpdate:u}=Vt(Ae),p=s.useRef(void 0),b=s.useCallback(Q=>{d([Q.width,Q.height])},[]),f=s.useRef([0,0,0,0]);s.useEffect(()=>{e===D.Connecting&&(f.current=[0,0,0,0])},[e]);const h=s.useRef(performance.now());s.useEffect(()=>{const Q=performance.now();e===D.Speaking&&Q-h.current>50&&(h.current=Q,f.current=f.current.map(($,F)=>$+a[F]))},[e,a]);const[g,x]=rA(cA(D.Listening,e)),[M,E]=rA(cA(D.Speaking,e)),[v,y]=rA(cA(D.Thinking,e)),[C,I]=rA(cA(D.Halted,e)),[B,W]=s.useState(performance.now()/1e3);s.useEffect(()=>{const Q=setInterval(()=>{W(performance.now()/1e3)},xe);return()=>clearInterval(Q)},[]);const T=s.useMemo(()=>performance.now()/1e3,[]),[q,z]=s.useState(1e5),K=s.useRef(e);s.useEffect(()=>{e===D.Connecting?z(1e5):K.current===D.Connecting&&z(B),K.current=e},[e,B]);const V=eo(n),nA=n?a:i,H=g===1||M===1,gA=to({viewport:l,canvasSize:m.current,shouldMeasurePerf:H,source:"VoiceMode"}),R=oo({shouldCalibrate:H,viewport:l,initialScale:1});return p.current={time:B-T,micLevel:t,stateListen:g,listenTimestamp:Math.max(x-T,0),stateThink:v,thinkTimestamp:Math.max(y-T,0),stateSpeak:M,speakTimestamp:Math.max(E-T,0),readyTimestamp:q-T,stateHalt:C,haltTimestamp:Math.max(I-T,0),touchDownTimestamp:0,touchUpTimestamp:0,stateFailedToConnect:0,failedToConnectTimestamp:0,avgMag:nA,cumulativeAudio:r??f.current,isNewBloop:!0,isAdvancedBloop:n,bloopColorMain:Array.from(V.bloopColorMain),bloopColorLow:Array.from(V.bloopColorLow),bloopColorMid:Array.from(V.bloopColorMid),bloopColorHigh:Array.from(V.bloopColorHigh),isDarkMode:c,screenScaleFactor:window.devicePixelRatio,viewport:l,silenceAmount:0,silenceTimestamp:0,fadeBloopWhileListening:!1},o.jsx(no,{className:uA("flex items-center justify-center",A),variablesRef:p,onViewportUpdate:b,textureImage:ao,textureName:"uTextureNoise",onGlAvailable:gA,onCanvasSizeUpdate:u,scale:R})}function Na(){const A=Qt(Rt()?ZA.hasStartedElectronVoiceModeStraw:ZA.hasStartedWebVoiceModeStraw),e=ce(),t=!A.isLoading&&A.eligible&&e,[n,a]=s.useState(!1),[r,c]=s.useState(!1),[i,l]=s.useState(""),[d,m]=s.useState(!1),u=s.useCallback(()=>{n?(l(le),m(!0)):l("")},[n]);return{shouldShowVoicePickerSnowflake:t,showSnowflake:n,setShowSnowflake:a,enableFadeInPickerIcon:r,setEnableFadeInPickerIcon:c,initialVoiceName:i,hasShownSnowflake:d,handleStrawVoiceEntry:u}}const Oa=({conversationId:A})=>{const e=oA(),[t,n]=s.useState(!1),[a,r]=s.useState(!1),{shouldShowVoicePickerSnowflake:c,showSnowflake:i,setShowSnowflake:l,enableFadeInPickerIcon:d,setEnableFadeInPickerIcon:m,initialVoiceName:u,hasShownSnowflake:p,handleStrawVoiceEntry:b}=Na(),f=S(E=>E.server.remoteState===D.Listening||E.server.remoteState===D.ListeningIntently);s.useEffect(()=>{if(c&&f&&!p){const E=setTimeout(()=>{l(!0),m(!1)},FA),v=setTimeout(()=>{l(!1),m(!0)},FA+Dt);return()=>{clearTimeout(E),clearTimeout(v)}}else m(!1),l(!1)},[p,f,m,l,c]);const h=s.useCallback(()=>{e&&e.length>0&&e.forEach(E=>{const{publication:v}=E;v.audioTrack instanceof BA?(r(v.audioTrack.isMuted),v.audioTrack.mute()):v.audioTrack instanceof IA&&v.audioTrack.setMuted(!0)})},[e]),g=s.useCallback(()=>{e&&e.length>0&&e.forEach(E=>{const{publication:v}=E;v.audioTrack instanceof BA?a||v.audioTrack.unmute():v.audioTrack instanceof IA&&v.audioTrack.setMuted(!1)})},[e,a]),x=()=>{O.voiceSelectionShown.click(),b(),h(),n(!0)},M=()=>{g(),n(!1)};return o.jsxs("div",{className:"relative h-[40px] w-[40px]",children:[o.jsx(L,{mode:"wait",children:i?o.jsx(w.div,{initial:{opacity:0,scale:.5,rotate:0},animate:{opacity:1,scale:1,rotate:360},exit:{opacity:0,scale:.5},transition:{opacity:{duration:.5},scale:{duration:.3,ease:"easeInOut"},rotate:{duration:24,ease:"linear"}},className:"absolute inset-0 flex items-center justify-center",children:o.jsx(_,{onClick:x,icon:Et,iconColor:"text-token-text-secondary",className:"h-[40px] w-[40px] bg-transparent hover:bg-black/10 active:bg-black/20 dark:bg-transparent dark:hover:bg-white/5 dark:active:bg-white/10",iconSize:"icon-lg"})},"snowflake"):o.jsx(w.div,{initial:d?{opacity:0,scale:.5}:{},animate:d?{opacity:1,scale:1}:{},exit:{opacity:0,scale:.5},transition:{opacity:{duration:.5},scale:{duration:.3,ease:"easeInOut"}},className:"absolute inset-0 flex items-center justify-center",children:o.jsx(_,{onClick:x,icon:St,iconColor:"text-token-text-secondary",className:"h-[40px] w-[40px] bg-transparent hover:bg-black/10 active:bg-black/20 dark:bg-transparent dark:hover:bg-white/5 dark:active:bg-white/10",iconSize:"icon-md"})},"voicePickerIcon")}),t&&o.jsx(so,{conversationId:A,onClose:M,initialVoiceName:u})]})};class Za extends Worker{constructor(e,t){const n=String(e);super(n.includes("://")&&!n.startsWith(location.origin)?URL.createObjectURL(new Blob([`import("${n}")`],{type:"text/javascript"})):e,t)}}function Fa(A={}){const[e,t]=s.useState(!1),[n,a]=s.useState(!1),[r,c]=s.useState(!1);let i=_t().microphoneTrack;const[l,d]=s.useState();A.trackRef&&(i=A.trackRef.publication);const m=s.useCallback(async u=>{if(u){const{KrispNoiseFilter:p,isKrispNoiseFilterSupported:b}=await rt(async()=>{const{KrispNoiseFilter:f,isKrispNoiseFilterSupported:h}=await import("./cdeb6wdntgjfxjgj.js");return{KrispNoiseFilter:f,isKrispNoiseFilterSupported:h}},[]);if(!b()){console.warn("Krisp noise filter is not supported in this browser");return}l||d(p(A.filterOptions))}t(p=>(p!==u&&a(!0),u))},[]);return s.useEffect(()=>{var u;if(i&&i.track instanceof BA&&l){const p=i.track.getProcessor();p&&p.name==="livekit-noise-filter"?(a(!0),p.setEnabled(e).finally(()=>{a(!1),c(e)})):!p&&e&&(a(!0),(u=i?.track)==null||u.setProcessor(l).then(()=>l.setEnabled(e)).then(()=>{c(!0)}).catch(b=>{c(!1),console.error(b)}).finally(()=>{a(!1)}))}},[e,i,l]),{setNoiseFilterEnabled:m,isNoiseFilterEnabled:r,isNoiseFilterPending:n,processor:l}}const Ya=s.memo(function(){const e=ct("989226566").value,{setNoiseFilterEnabled:t}=Fa();return s.useEffect(()=>{t(e)},[e,t]),null}),La=new Za(new URL("https://cdn.oaistatic.com/assets/livekit-client.e2ee.worker-DK0iMXIf.js",import.meta.url),{type:"module"}),Wa=s.memo(function({children:e}){const t=s.useRef({keyProvider:new qt}).current,[n,a]=s.useState(!1),{token:r,url:c,e2eeKey:i}=S(u=>u.credentials),l=Yo(),d=S(u=>u.isVoiceModeActive),m=S(u=>u.audioInputDevice?.deviceId);return s.useEffect(()=>{const u=r&&c&&i;!n&&u?t.keyProvider.setKey(i).then(()=>{a(!0)}):n&&!u&&a(!1)},[r,c,i,n,t]),d?o.jsxs(mo,{...l,connect:!0,token:r??void 0,serverUrl:c??void 0,audio:{deviceId:{ideal:m,exact:m},noiseSuppression:!0,echoCancellation:!0},options:{e2ee:{keyProvider:t.keyProvider,worker:La}},children:[e,n&&r&&c&&o.jsx(Kt,{}),n&&r&&c&&o.jsx(Fo,{}),n&&r&&c&&o.jsx(Ya,{})]}):null});function rs({conversationId:A,currentModelId:e,isActiveWindow:t}){const{voiceName:n}=re(),a=n===le,r=ce(),[c,i]=s.useState(!1),l=S(g=>g.isVoiceModeActive),d=S(g=>g.server.voiceConnectionQuality),m=Tt(),u=S(g=>g.screenshare!=null),p=S(g=>g.video!=null),b=Z(),f=Se({conversationId:A});lt(f),s.useEffect(()=>{if(!t)return;const g=new Xo;return l?g.enable():g.disable(),()=>{g.disable()}},[l,t]);const h=s.useMemo(()=>({name:r?"straw":"normal",themeActive:a?"yes":"no"}),[r,a]);return t&&o.jsxs(Wa,{children:[o.jsx(L,{children:o.jsx(io,{value:h,children:l?o.jsx(w.div,{className:"fixed left-0 top-0 z-50 flex h-full w-full flex-col bg-token-main-surface-primary",initial:"hidden",animate:"visible",exit:"hidden",variants:lA,children:o.jsxs(w.div,{className:"relative h-full w-full",variants:lA,children:[o.jsxs(w.div,{variants:lA,className:"flex h-full w-full flex-col justify-between gap-6",children:[o.jsxs(w.div,{className:"relative mt-6 flex w-full justify-center",children:[o.jsx("div",{className:"flex w-full items-center justify-center",children:(u||p)&&o.jsx($A,{className:"h-16 w-16"})}),o.jsx("div",{className:"mr-4",children:o.jsx(Oa,{conversationId:A})})]}),o.jsxs("div",{className:"flex h-full min-h-0 items-center justify-center",children:[o.jsx(Ia,{children:o.jsx($A,{className:"h-max min-h-52 w-max min-w-52"})}),o.jsx(L,{children:c?o.jsx(ba,{conversationId:A}):null})]}),o.jsx(w.div,{className:"mb-6 flex justify-center",children:o.jsx(Ho,{conversationId:A,currentModelId:e})})]}),o.jsx(w.div,{className:"absolute bottom-0 right-0 flex w-auto items-center justify-end p-4",variants:lA,children:m?o.jsx(Nt,{onClick:()=>i(g=>!g),icon:It}):null})]})}):null})}),d===pe.Poor&&o.jsx("div",{className:"absolute left-1/2 top-6 z-50 -translate-x-1/2 transform",children:o.jsx("div",{className:"inline-flex flex-col items-center rounded-full border border-token-border-light bg-token-main-surface-primary px-6 py-3",children:o.jsx("span",{className:"text-token-text-secondary",children:b.formatMessage({id:"YE2Eng",defaultMessage:"Poor connection"})})})})]})}const lA={hidden:{opacity:0,transform:"blur(4px)"},visible:{transform:"blur(0px)",opacity:1},exit:{opacity:0,transform:"blur(4px)"}};export{rs as VoiceModeLayout};
//# sourceMappingURL=l9uvhxo8fftyjx9p.js.map
