const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/l7re60r7vv52ucch.js","assets/mtnbdcyqrcvvklqa.js","assets/fiqi1nsnq1a08oyy.js","assets/root-oxo7srkb.css","assets/sso-h0bjpb1so7k1oa5s.js","assets/mefecv78ttcfptwg.js","assets/i25o23eggpk6999r.js","assets/conversation-small-eplmind9.css","assets/dwl4nir48hzbst85.js","assets/j2ceccqazufd0uaz.js","assets/nqsn4uroyabjm3i7.js","assets/ifcn8mwf3l3g632t.js","assets/fi5ix3t0db6nn4a0.js","assets/mseopalu3o6y1shz.js","assets/kz7apo8euaqzqef5.js","assets/osmp6xwkpf5fyqn4.js","assets/e492oug42hlif5y2.js","assets/m09ka59xujso3ws2.js","assets/j6m9c4ofoa0idx20.js","assets/kfjfn6a6uxbrxoqk.js","assets/fyh33v0r7742bhsf.js","assets/ktpnzx2935qm69yf.js","assets/mavgrps17z1iarjf.js","assets/kqwdyvkaaavvn8k3.js","assets/hq9pqooxa25lpsfg.js","assets/khf2b3hv98fp1uts.js","assets/f0cgb9eadmvbtbq2.js","assets/glw97pge495riwo0.js","assets/bt9o2ivxxlkzt8tv.js","assets/knhqdfl27hub5iuf.js","assets/e9lafxuzyeh4418f.js","assets/koqbnertcgber5c2.js","assets/jmutnjyuz0rby5b2.js","assets/j6udp7acx2p13w90.js","assets/nhwwej1nq0zrd7sc.js","assets/a39mxrg2omp0opgs.js","assets/c0aeo0xdanj0dxxz.js","assets/f2euwl1bn0ufh792.js","assets/lalgh526cf9apsgq.js","assets/oj5l5fhr9b92tcfo.js","assets/g056ar0phzt2ex7q.js","assets/ms9l0oi5q7ce3jgh.js","assets/ebt040vudkrowyg9.js","assets/oiya65f430wrxqul.js","assets/f55qc8aw9qu8bdhv.js","assets/kf4kgvfmqb9bgaen.js","assets/kvyqyxem9s4d0p8j.js","assets/fvohhll2njv2xkar.js","assets/omr9to05fjnpnw2r.js","assets/dp56hgn2nxx0eygj.js","assets/j8z180fha1rcgygi.js","assets/gx8z7gm74yr02gla.js","assets/n5b2lxqdh8ll88ws.js","assets/vwounbuo88r6esbf.js","assets/ncce4bd6lw5yz76s.js","assets/kmvupimsdl5m0bma.js","assets/d1p3b22nupqvtzt1.js","assets/je68hwp95qnot9bi.js","assets/c1c47wrtoekaampm.js","assets/fgfpemv6gomzkid1.js","assets/ngmp2lyhqkvuz1ip.js","assets/gh6iehhilku5rhs7.js","assets/j29bawbul6890dl6.js","assets/o1ewrqot3k4s61x1.js","assets/dlleg8qcnihct8xg.js","assets/abgnoqxjacxurtrb.js","assets/ob6ln24x8q345cc0.js","assets/jp73uzl6bj1nskjt.js","assets/mmhgubkrcdxe4ky2.js","assets/bipc5et2l9uuuk5p.js","assets/isjdmfmhzv09v01t.js","assets/itk2kcd70xpeksti.js","assets/cvbztom8s8wpbc90.js","assets/ow8berxjbf26h521.js","assets/f9ogdnmqzkiikwti.js","assets/ij2983vxdkciqtzx.js","assets/iej0cupg2dqkmejt.js","assets/chjcf32tloloqxik.js","assets/jk8w36bsokizpx57.js","assets/o7zypadk6x603j8a.js","assets/o12zbcdkcabvizak.js","assets/gsss7sk8ube5ahf8.js","assets/ld8vrgk0wbhpcu5u.js","assets/jvkcgag7e3cfmltg.js","assets/ckbihhcqbkh0i70x.js","assets/knp9urilt4hoo4se.js","assets/nzqktei96y74vp8f.js","assets/nudo31c6a3kr1n46.js","assets/oaj334tcc5vnea3c.js","assets/j85ki7s1x9ecz195.js","assets/nm04jgpfyxi6pn12.js","assets/dzx39wg3g15nf45k.js","assets/shared-mk6ngktc.css","assets/eoxzk911fem4143z.js","assets/carousel-bss5aguy.css","assets/sso-bfz9b7nm.css","assets/omeo039438yfi8ye.js","assets/j9kstrq83clvs26y.js","assets/o7tg2hyicap3122c.js","assets/n0zkcrtxod8lol44.js","assets/fsddy3bxlesj6ecw.js","assets/gghqqwnhvrwbydxk.js","assets/pag38t0pi6m98s9f.js","assets/cu7i7jyqvstu6net.js","assets/ez5caczm84295e46.js"])))=>i.map(i=>d[i]);
import{O as Be,j as e,K as d,aU as Ie,r as v,c3 as K,H as D,E as Fe,aq as Ue,I as ue,M as ke,J as Ve,dt as X,aO as re,gg as it,bK as xa,aa as ot,gh as lt,Y as ha,gi as ja,gj as va,gk as ya,ch as ba,Z as ct,gl as ka,e1 as wa,d$ as Ts,c_ as dt,c$ as ut,cm as pt,gm as Ma,e0 as Ta,gn as _a,go as Na,bJ as Sa,a1 as Pa,cr as Ee,c8 as $e,ba as me,a7 as we,c as ie,u as Ca,R as We,N as je,aQ as ft,ay as mt,b3 as _s,bU as gt,bQ as rs,P as xt,A as ht,aR as jt,bS as Ns,a6 as Ss,bW as Ia,fe as vt,w as yt,bP as _e,fb as Aa,ag as Re,cX as pe,d2 as La,cy as bt,cz as kt,cA as wt,ee as Mt,ek as Ae,a4 as gs,gp as Ua,cU as Ra,X as Ga,fi as Oa,y as Rs,L as Gs,dn as Ba}from"./mtnbdcyqrcvvklqa.js";import{bv as y,iA as Tt,aL as Le,av as oe,V as Ze,as as Fa,iB as _t,iC as Nt,iD as St,fS as $,b4 as Pt,iE as Ct,iF as Ea,iG as xs,iH as $a,M as hs,iI as ee,iJ as Ye,b7 as Wa,gi as Os,fK as qa,iK as Ge,bu as ze,bZ as It,aQ as Ha,W as At,X as Lt,eh as Ka,iL as Va,Y as Oe,dR as Ut,hG as Ya,dS as Rt,dT as Gt,dW as Qa,dU as ne,iM as Xa,dV as Ja,dX as Za,bk as js,dY as za,iN as Da,iO as Bs,iP as is,bj as en,cK as Fs,cw as Ot,cx as sn,A as tn,cA as an,iQ as Es,l as Bt,b0 as nn,a8 as Ft,iR as Et,bS as $t,iS as rn,c0 as Wt,bi as on,iT as ln,cE as cn,D as dn,er as un}from"./i25o23eggpk6999r.js";import{b as qt,I as Ht,F as Kt,j as Ps,a as Vt,k as pn,J as fn,K as mn,L as gn,M as xn,N as hn,O as $s}from"./f0cgb9eadmvbtbq2.js";import{F as jn,b as vs,q as ts,_ as Yt,b9 as ys,ar as Qe,$ as vn,ao as yn,s as bn,b2 as os,bj as De,bc as Qt,bs as Xt,W as Jt,al as kn,bk as wn,ae as Mn,aL as Tn,S as _n,H as Nn,aE as Sn,a as Pn,an as Cn,bP as In}from"./fiqi1nsnq1a08oyy.js";import{a as z,F as ae,c as bs,b as ls,G as An}from"./itk2kcd70xpeksti.js";import{u as Ln,G as Un,j as Xe,T as E}from"./kfjfn6a6uxbrxoqk.js";import{u as Rn}from"./abgnoqxjacxurtrb.js";import{f as Gn,b as On}from"./khf2b3hv98fp1uts.js";import{_ as Bn}from"./fsddy3bxlesj6ecw.js";import{G as Cs}from"./j8z180fha1rcgygi.js";import{G as Fn}from"./gghqqwnhvrwbydxk.js";import{D as W,B as Is}from"./e492oug42hlif5y2.js";import{S as Q}from"./dwl4nir48hzbst85.js";import{G as En}from"./gx8z7gm74yr02gla.js";import{c as qe,a as $n,u as Zt}from"./f2euwl1bn0ufh792.js";import{h as Wn,C as qn,f as zt,W as Hn}from"./kvyqyxem9s4d0p8j.js";import{G as Kn}from"./pag38t0pi6m98s9f.js";import{m as Dt}from"./j6m9c4ofoa0idx20.js";import{a as Vn}from"./cu7i7jyqvstu6net.js";import{J as ea}from"./c0aeo0xdanj0dxxz.js";import{G as Yn}from"./dp56hgn2nxx0eygj.js";import{i as ks}from"./ez5caczm84295e46.js";function sa(s){return s==y.User||s==y.Group?y.Private:s==y.WorkspaceLink?y.Workspace:s}function de(s,t){return s=sa(s),t===void 0?!1:t.some(a=>a.recipient===s&&a.allowed)}function As(s,t){if(t===void 0)return[];s=sa(s);const a=t.find(n=>n.recipient===s);return a==null?void 0:a.moderated_fields}function cs(s,t){const a=As(s,t);return a&&a.length>0}const Ws=Be.a`bold underline`,Qn=Be.textarea`w-full text-sm overflow-y-auto rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400 border-token-border-medium bg-token-main-surface-primary h-32`;var Me=(s=>(s[s.None=0]="None",s[s.AppealAvailable=1]="AppealAvailable",s[s.AppealSent=2]="AppealSent",s))(Me||{}),as=(s=>(s[s.None=0]="None",s[s.PublishBlocked=1]="PublishBlocked",s[s.RemovedFromMarketplace=2]="RemovedFromMarketplace",s[s.RemovedFromPublic=3]="RemovedFromPublic",s[s.RemovedFromPrivate=4]="RemovedFromPrivate",s[s.Recategorized=5]="Recategorized",s))(as||{});function Xn(s){var n;if(!s)return;const t=((n=s.gizmo.appeal_info)==null?void 0:n.state.kind)==="appeal_sent",a=Jn(s.gizmo.share_recipient,s.gizmo.sharing_targets);return{sharingRecipient:s.gizmo.share_recipient,categories:s.gizmo.categories,gizmoId:s.gizmo.id,moderationType:a,sharingTargets:s.gizmo.sharing_targets,showModal:t?2:a!==0?1:0}}const qs={[y.User]:y.Private,[y.Group]:y.Private,[y.WorkspaceLink]:y.Workspace};function Jn(s,t=[]){const a=new Set(t.filter(i=>i.allowed).map(i=>i.recipient));if(!s||(s in qs&&(s=qs[s]),a.has(s)))return 0;const n=a.has(y.Private)||a.has(y.Workspace),r=a.has(y.Link)||a.has(y.Marketplace);return s===y.Marketplace&&r?2:!r&&n?3:4}function Hs(s){switch(s){case 0:case 1:return K({id:"gizmo.appeals.publishBlockedTitle",defaultMessage:"Your changes couldn’t be published"});case 2:return K({id:"gizmo.appeals.removedFromMarketplaceTitle",defaultMessage:"Your GPT has been removed from the marketplace"});case 3:return K({id:"gizmo.appeals.removedFromPublicTitle",defaultMessage:"Your GPT has been removed from public view"});case 5:return K({id:"gizmo.appeals.recategorizedTitle",defaultMessage:"Your GPT has been recategorized"});default:Tt(s)}}function Zn(s){switch(s){case"profile_picture":return K({id:"gizmo.appeals.profilePictureFieldName",defaultMessage:"Profile Picture"});case"gizmo_name":return K({id:"gizmo.appeals.gizmoNameFieldName",defaultMessage:"Name"});case"gizmo_description":return K({id:"gizmo.appeals.gizmoDescriptionFieldName",defaultMessage:"Description"});case"gizmo_instructions":return K({id:"gizmo.appeals.gizmoInstructionsFieldName",defaultMessage:"Instructions"});case"gizmo_welcome_message":return K({id:"gizmo.appeals.gizmoWelcomeMessageFieldName",defaultMessage:"Welcome Message"});case"custom_actions":return K({id:"gizmo.appeals.customActionsFieldName",defaultMessage:"Custom Actions"});case"conversation_starter":return K({id:"gizmo.appeals.conversationStarterFieldName",defaultMessage:"Conversation Starter"});case"file":return K({id:"gizmo.appeals.fileFieldName",defaultMessage:"File"});case"gizmo_combined_content":return K({id:"gizmo.appeals.gizmoCombinedContentFieldName",defaultMessage:"Overall GPT Config"})}}function zn(s){switch(s){case y.Private:case y.Workspace:return K({id:"gizmo.appeals.privateRecipientModerationText",defaultMessage:"Your GPT can’t be updated because it violates our {usagePolicyLink}Usage Policies{usagePolicyLink}."});case y.Link:return K({id:"gizmo.appeals.linkRecipientModerationText",defaultMessage:"Your GPT can’t be shared publicly because it violates our {usagePolicyLink}Usage Policies{usagePolicyLink}."});case y.Marketplace:return K({id:"gizmo.appeals.marketplaceRecipientModerationText",defaultMessage:"Your GPT can’t appear in the Explore GPTs page because it violates our {usagePolicyLink}Usage Policies{usagePolicyLink}."});default:Tt(s)}}function ta({sharingRecipient:s,moderatedFields:t,appealAvailable:a}){const n=t.length;return e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx(d,{...zn(s),values:{usagePolicyLink:r=>e.jsx(Ws,{target:"_blank",href:"https://openai.com/policies/usage-policies",rel:"noreferrer",children:r})}})," ",n>0&&e.jsx(d,{id:"gizmo.appeals.seeBelowForSpecificIssues",defaultMessage:`{numModeratedFields, plural,
              one {See below for the specific issue:}
              other {See below for the specific issues:}
            }`,values:{numModeratedFields:n}})]}),n>0&&(t==null?void 0:t.map(r=>e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-bold",children:e.jsx(d,{...Zn(r.name)})}),e.jsx("ul",{className:"list-disc pl-5",children:r.reasons.map(i=>e.jsxs("li",{children:[i.description," ",i.link?e.jsx(Ws,{href:i.link,target:"_blank",rel:"noreferrer",children:e.jsx(d,{id:"gizmo.appeals.learnMore",defaultMessage:"Learn more"})}):""]},i.description))})]}))),a&&e.jsx("p",{children:e.jsx(d,{id:"gizmo.appeals.appealAvailableText",defaultMessage:"Alternatively you may appeal this decision and we will get back to you as soon as possible. Or you can publish to “Only me” and use this GPT privately."})})]})}function Dn({gizmoId:s,sharingRecipient:t,categories:a,moderationType:n,sharingTargets:r,appealAvailable:i,onClose:o,onAppealSubmitted:c}){const l=D(),[g,x]=v.useState(""),[h,p]=v.useState(0),f=Fe(),m=async()=>{await Le.postGizmoAppeal(f,s,g,t,a),p(2),c==null||c()},u=As(t,r),j=(u==null?void 0:u.length)??0,w=Ue();if(j==0&&(w==null?void 0:w.isEnterprisey()))return e.jsx(ue,{title:l.formatMessage(Hs(n)),isOpen:!0,onClose:o,showCloseButton:!0,type:"warning",primaryButton:e.jsx(ke.Button,{color:"primary",onClick:o,children:e.jsx(d,{id:"wEsAOU",defaultMessage:"OK"})}),children:e.jsx("p",{className:"text-sm",children:e.jsx(d,{id:"gizmo.appeals.workspaceSettingsMessage",defaultMessage:"Access to your GPT has been reduced by your workspace's GPT sharing settings. An owner of the workspace can change these settings in the workspace settings page."})})});switch(h){case 0:return e.jsx(ue,{title:l.formatMessage(Hs(n)),isOpen:!0,onClose:o,showCloseButton:!0,primaryButton:e.jsx(ke.Button,{color:"primary",onClick:o,children:e.jsx(d,{id:"gizmo.appeals.contunueButton",defaultMessage:"Continue"})}),secondaryButton:i?e.jsx(ke.Button,{onClick:()=>p(1),children:e.jsx(d,{id:"gizmo.appeals.appealButton",defaultMessage:"Appeal"})}):void 0,type:"warning",children:e.jsx("div",{className:"flex flex-col gap-2 text-sm",children:e.jsx(ta,{sharingRecipient:t,moderatedFields:u??[],appealAvailable:i})})});case 1:return e.jsx(ue,{title:l.formatMessage({id:"gizmo.appeals.appealModalTitle",defaultMessage:"Appeal"}),isOpen:!0,onClose:o,showCloseButton:!0,shouldIgnoreClickOutside:!0,primaryButton:e.jsx(ke.Button,{color:"primary",onClick:m,disabled:g.trim().length===0,children:e.jsx(d,{id:"gizmo.appeals.submitAppealButton",defaultMessage:"Submit"})}),secondaryButton:e.jsx(ke.Button,{onClick:()=>p(0),children:e.jsx(d,{id:"gizmo.appeals.backButton",defaultMessage:"Back"})}),type:"warning",children:e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsx("p",{children:e.jsx(d,{id:"gizmo.appeals.appealReasonText",defaultMessage:"Please provide a reason for why you believe this GPT doesn’t violate our policies and should be published"})}),e.jsx(Qn,{value:g,onChange:T=>x(T.target.value)})]})});case 2:return e.jsx(e.Fragment,{})}}function er({onClose:s}){const t=D();return e.jsx(ue,{title:t.formatMessage({id:"gizmo.appeals.appealSubmittedModalTitle",defaultMessage:"Appeal submitted"}),isOpen:!0,onClose:s,showCloseButton:!0,primaryButton:e.jsx(ke.Button,{color:"primary",onClick:s,children:e.jsx(d,{id:"gizmo.appeals.closeButton",defaultMessage:"Close"})}),type:"success",children:e.jsx("div",{className:"flex flex-col gap-2 text-sm",children:e.jsx("div",{children:e.jsx(d,{id:"gizmo.appeals.appealSubmittedText",defaultMessage:"Your appeal has been submitted. We will get back to you as soon as possible."})})})})}function sr({gizmoId:s,onClose:t}){const{data:a}=qt(s,!0),n=Fe(),r=async()=>{await Le.postGizmoCancelAppeal(n,s)};return e.jsx(ue,{isOpen:!0,onClose:Ve,primaryButton:e.jsx(ke.Button,{color:"primary",onClick:()=>{r(),t==null||t()},children:e.jsx(d,{id:"gizmo.appeals.cancelAppealButton",defaultMessage:"Cancel appeal"})}),type:"warning",children:e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsx("h2",{className:"text-lg font-semibold",children:e.jsx(d,{id:"gizmo.appeals.appealReviewingHeader",defaultMessage:"Reviewing your appeal"})}),e.jsx("p",{children:e.jsx(d,{id:"gizmo.appeals.appealSentModalText",defaultMessage:"During the review you can continue using “{gizmoName}” as your private GPT, but won’t be able to update it or share it with others.",values:{gizmoName:a==null?void 0:a.gizmo.display.name}})})]})})}function tr({appealState:s,onAppealClose:t,onAppealSubmitted:a}){const{value:n}=Ie("4226692983"),[r,i]=v.useState(!1);return r?e.jsx(er,{onClose:()=>{i(!1),a==null||a()}}):e.jsxs(e.Fragment,{children:[(s==null?void 0:s.showModal)==2&&e.jsx(sr,{gizmoId:s.gizmoId,onClose:t}),(s==null?void 0:s.showModal)==1&&e.jsx(Dn,{gizmoId:s.gizmoId,sharingRecipient:s.sharingRecipient,categories:s.categories,moderationType:s.moderationType,sharingTargets:s.sharingTargets,appealAvailable:n,onClose:()=>t==null?void 0:t(),onAppealSubmitted:()=>i(!0)})]})}function ar({gizmoEditorData:s,onOpen:t}){var i;const a=(i=s==null?void 0:s.tools)==null?void 0:i.find(o=>o.type===X.INTENT&&"prompt_config"in o.settings),[n]=v.useState((a==null?void 0:a.settings.prompt_config)??[]),[r]=v.useState((a==null?void 0:a.settings.state_keys)??[]);return e.jsxs(ae,{children:[e.jsx("div",{className:"text-sm",children:e.jsx(z,{label:"Blocks + State",description:"Blocks and State for your GPT"})}),e.jsxs("div",{className:"mb space-y-1",children:[!(n||r)&&e.jsx("div",{className:"flex text-token-text-primary",children:"Add prompt blocks and state keys to your GPT"}),e.jsx(oe,{onClick:()=>t(),children:n||r?"Show Blocks & State":"Add Blocks & State"})]})]})}function nr({gizmoEditorData:s,updateGizmo:t,onClose:a}){var h;const n=(h=s==null?void 0:s.tools)==null?void 0:h.find(p=>p.type===X.INTENT&&"prompt_config"in p.settings),[r,i]=v.useState((n==null?void 0:n.settings.prompt_config)??[]),[o,c]=v.useState((n==null?void 0:n.settings.state_keys)??[]),l={key_name:"",description:""},g={prompt_key:"",prompt:"",continuation:"",hidden:!1},x=()=>{t(p=>({...p,tools:n?p.tools.map(f=>f.type===X.INTENT?{...f,settings:{...f.settings,prompt_config:r,state_keys:o}}:f):[...p.tools,{type:X.INTENT,settings:{prompt_config:r,state_keys:o}}]}))};return e.jsxs("div",{className:"h-full overflow-auto px-4 pb-12 text-sm",children:[e.jsxs("div",{className:"relative flex flex-col items-center px-16 py-6 text-center",children:[e.jsx("div",{className:"absolute left-0 top-6",children:e.jsx(re,{color:"secondary",onClick:a,icon:jn})}),e.jsx("div",{className:"text-xl font-semibold",children:e.jsx(d,{id:"eIFoMg",defaultMessage:"Blocks & State"})}),e.jsx("div",{className:"text-sm text-token-text-tertiary",children:e.jsx(d,{id:"rdK8Dl",defaultMessage:"Construct your GPT with instruction blocks and state."})}),e.jsx(z,{label:e.jsx("div",{className:"text-sm font-semibold text-token-text-tertiary",children:"Learn more"}),description:e.jsxs("div",{className:"space-y-2 text-sm font-normal",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Blocks"})," allow you to break up your GPT's instructions into smaller sections, letting the GPT decide which to load up in what scenario."]}),e.jsxs("div",{children:[e.jsx("b",{children:"State"})," gives the GPT a per-user storage for data, that will be provided at the start of all new conversations."]})]})})]}),e.jsx(ae,{children:e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"mb-4 space-y-5 text-lg",children:[e.jsx(z,{label:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"Instruction Blocks"}),e.jsx(vs,{className:"icon-sm"})]}),description:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:"Instruction Blocks are added to the end of your GPT's instructions when the GPT decides to use them."}),e.jsx("div",{children:"The GPT only knows these blocks by their name. and your initial GPT instructions must describe how to use at least one of these blocks."})]})}),e.jsxs("div",{className:"space-y-5 text-sm",children:[r.map((p,f)=>e.jsx(rr,{promptKey:p.prompt_key,prompt:p.prompt,continuation:p.continuation,hidden:p.hidden,visible:!1,isDuplicate:r.filter(m=>m.prompt_key===p.prompt_key).length>1,onChange:({promptKey:m,prompt:u,continuation:j,hidden:w})=>{i(b=>{const T=[...b];return T[f]={prompt_key:m,prompt:u,continuation:j,hidden:w},T}),x()},onDelete:({promptKey:m})=>{i(u=>u.filter(j=>j.prompt_key!==m)),x()}},f)),e.jsx(oe,{onClick:()=>{i(p=>[...p,g])},children:"Add Block"})]}),e.jsx(z,{label:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"Saved State"}),e.jsx(vs,{className:"icon-sm"})]}),description:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:"State the GPT can save per-user, that will be provided at the start of all new conversations"}),e.jsx("div",{children:"Your GPT has access to write to these state entries, and read from them."}),e.jsx("div",{children:"The user can see this data."})]})}),o.map((p,f)=>e.jsx(ir,{keyName:p.key_name,description:p.description,isDuplicate:o.filter(m=>m.key_name===p.key_name).length>1,onChange:({keyName:m,description:u})=>{c(j=>{const w=[...j];return w[f]={key_name:m,description:u},w}),x()},onDelete:({keyName:m})=>{c(u=>u.filter(j=>j.key_name!==m)),x()}},f))]}),e.jsx(oe,{onClick:()=>{c(p=>[...p,l])},children:"Add State Data"})]})})]})}function rr({promptKey:s,prompt:t,continuation:a,hidden:n,visible:r,isDuplicate:i,onChange:o,onDelete:c}){v.useState(n);const[l,g]=v.useState(r),x=()=>{g(!l)},h=[];s.length>20&&h.push({msg:"Block names work best when they are short"}),i&&h.push({msg:"Block names must be unique"});const p=h.length>0?Yt:void 0;return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex space-x-2 text-sm",children:[e.jsx(z,{collapsed:!l,label:"Block",onClick:x}),e.jsx(Ze,{name:"promptKey",value:s,onChange:f=>o({promptKey:f.target.value,prompt:t,continuation:a}),icon:p,className:"max-w-xs grow-0",placeholder:"Block name"})]}),h.map(f=>e.jsx("div",{className:"text-xs text-token-text-secondary",children:f.msg},f.msg)),l&&e.jsxs("div",{className:"mb-4 space-y-1",children:[e.jsx(Fa,{rows:5,name:"prompt",value:t,onChange:f=>o({promptKey:s,prompt:f.target.value,continuation:a}),className:"grow",placeholder:"Block Text"}),or,e.jsx("div",{role:"button",className:"flex items-center space-x-2",onClick:()=>{c({promptKey:s})},children:e.jsx(ts,{className:"icon-sm"})})]})]})}function ir({keyName:s,description:t,isDuplicate:a,onChange:n,onDelete:r}){const i=[];s.length>20&&i.push({msg:"State names work best when they are short"}),a&&i.push({msg:"State names must be unique"});const o=i.length>0?Yt:void 0;return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex space-x-2 text-sm",children:[e.jsx(Ze,{name:"key",value:s,onChange:c=>n({keyName:c.target.value,description:t}),icon:o,className:"max-w-xs grow-0",placeholder:"State Name"}),e.jsx(Ze,{name:"description",value:t,onChange:c=>n({keyName:s,description:c.target.value}),className:"max-w-s flex-grow",placeholder:"Description"}),e.jsx("div",{role:"button",className:"flex items-center space-x-2",onClick:()=>{r({keyName:s})},children:e.jsx(ts,{className:"icon-sm"})})]}),i.map(c=>e.jsx("div",{className:"text-xs text-token-text-secondary",children:c.msg},c.msg))]})}const or=!1;function lr(s,t){for(var a=-1,n=s==null?0:s.length;++a<n&&t(s[a],a,s)!==!1;);return s}var cr=lr,dr=it,ur=xa;function pr(s,t,a,n){var r=!a;a||(a={});for(var i=-1,o=t.length;++i<o;){var c=t[i],l=n?n(a[c],s[c],c,a,s):void 0;l===void 0&&(l=s[c]),r?ur(a,c,l):dr(a,c,l)}return a}var ns=pr,fr=ns,mr=ot;function gr(s,t){return s&&fr(t,mr(t),s)}var xr=gr,hr=ns,jr=lt;function vr(s,t){return s&&hr(t,jr(t),s)}var yr=vr,es={exports:{}};es.exports;(function(s,t){var a=ha,n=t&&!t.nodeType&&t,r=n&&!0&&s&&!s.nodeType&&s,i=r&&r.exports===n,o=i?a.Buffer:void 0,c=o?o.allocUnsafe:void 0;function l(g,x){if(x)return g.slice();var h=g.length,p=c?c(h):new g.constructor(h);return g.copy(p),p}s.exports=l})(es,es.exports);var br=es.exports,kr=ns,wr=ja;function Mr(s,t){return kr(s,wr(s),t)}var Tr=Mr,_r=ns,Nr=va;function Sr(s,t){return _r(s,Nr(s),t)}var Pr=Sr,Cr=Object.prototype,Ir=Cr.hasOwnProperty;function Ar(s){var t=s.length,a=new s.constructor(t);return t&&typeof s[0]=="string"&&Ir.call(s,"index")&&(a.index=s.index,a.input=s.input),a}var Lr=Ar,Ks=ya;function Ur(s){var t=new s.constructor(s.byteLength);return new Ks(t).set(new Ks(s)),t}var Ls=Ur,Rr=Ls;function Gr(s,t){var a=t?Rr(s.buffer):s.buffer;return new s.constructor(a,s.byteOffset,s.byteLength)}var Or=Gr,Br=/\w*$/;function Fr(s){var t=new s.constructor(s.source,Br.exec(s));return t.lastIndex=s.lastIndex,t}var Er=Fr,Vs=ba,Ys=Vs?Vs.prototype:void 0,Qs=Ys?Ys.valueOf:void 0;function $r(s){return Qs?Object(Qs.call(s)):{}}var Wr=$r,qr=Ls;function Hr(s,t){var a=t?qr(s.buffer):s.buffer;return new s.constructor(a,s.byteOffset,s.length)}var Kr=Hr,Vr=Ls,Yr=Or,Qr=Er,Xr=Wr,Jr=Kr,Zr="[object Boolean]",zr="[object Date]",Dr="[object Map]",ei="[object Number]",si="[object RegExp]",ti="[object Set]",ai="[object String]",ni="[object Symbol]",ri="[object ArrayBuffer]",ii="[object DataView]",oi="[object Float32Array]",li="[object Float64Array]",ci="[object Int8Array]",di="[object Int16Array]",ui="[object Int32Array]",pi="[object Uint8Array]",fi="[object Uint8ClampedArray]",mi="[object Uint16Array]",gi="[object Uint32Array]";function xi(s,t,a){var n=s.constructor;switch(t){case ri:return Vr(s);case Zr:case zr:return new n(+s);case ii:return Yr(s,a);case oi:case li:case ci:case di:case ui:case pi:case fi:case mi:case gi:return Jr(s,a);case Dr:return new n;case ei:case ai:return new n(s);case si:return Qr(s);case ti:return new n;case ni:return Xr(s)}}var hi=xi,ji=ct,Xs=Object.create,vi=function(){function s(){}return function(t){if(!ji(t))return{};if(Xs)return Xs(t);s.prototype=t;var a=new s;return s.prototype=void 0,a}}(),yi=vi,bi=yi,ki=ka,wi=wa;function Mi(s){return typeof s.constructor=="function"&&!wi(s)?bi(ki(s)):{}}var Ti=Mi,_i=Ts,Ni=dt,Si="[object Map]";function Pi(s){return Ni(s)&&_i(s)==Si}var Ci=Pi,Ii=Ci,Ai=pt,Js=ut,Zs=Js&&Js.isMap,Li=Zs?Ai(Zs):Ii,Ui=Li,Ri=Ts,Gi=dt,Oi="[object Set]";function Bi(s){return Gi(s)&&Ri(s)==Oi}var Fi=Bi,Ei=Fi,$i=pt,zs=ut,Ds=zs&&zs.isSet,Wi=Ds?$i(Ds):Ei,qi=Wi,Hi=Ma,Ki=cr,Vi=it,Yi=xr,Qi=yr,Xi=br,Ji=Bn,Zi=Tr,zi=Pr,Di=_a,eo=Na,so=Ts,to=Lr,ao=hi,no=Ti,ro=Sa,io=Ta,oo=Ui,lo=ct,co=qi,uo=ot,po=lt,fo=1,mo=2,go=4,aa="[object Arguments]",xo="[object Array]",ho="[object Boolean]",jo="[object Date]",vo="[object Error]",na="[object Function]",yo="[object GeneratorFunction]",bo="[object Map]",ko="[object Number]",ra="[object Object]",wo="[object RegExp]",Mo="[object Set]",To="[object String]",_o="[object Symbol]",No="[object WeakMap]",So="[object ArrayBuffer]",Po="[object DataView]",Co="[object Float32Array]",Io="[object Float64Array]",Ao="[object Int8Array]",Lo="[object Int16Array]",Uo="[object Int32Array]",Ro="[object Uint8Array]",Go="[object Uint8ClampedArray]",Oo="[object Uint16Array]",Bo="[object Uint32Array]",U={};U[aa]=U[xo]=U[So]=U[Po]=U[ho]=U[jo]=U[Co]=U[Io]=U[Ao]=U[Lo]=U[Uo]=U[bo]=U[ko]=U[ra]=U[wo]=U[Mo]=U[To]=U[_o]=U[Ro]=U[Go]=U[Oo]=U[Bo]=!0;U[vo]=U[na]=U[No]=!1;function Je(s,t,a,n,r,i){var o,c=t&fo,l=t&mo,g=t&go;if(a&&(o=r?a(s,n,r,i):a(s)),o!==void 0)return o;if(!lo(s))return s;var x=ro(s);if(x){if(o=to(s),!c)return Ji(s,o)}else{var h=so(s),p=h==na||h==yo;if(io(s))return Xi(s,c);if(h==ra||h==aa||p&&!r){if(o=l||p?{}:no(s),!c)return l?zi(s,Qi(o,s)):Zi(s,Yi(o,s))}else{if(!U[h])return r?s:{};o=ao(s,h,c)}}i||(i=new Hi);var f=i.get(s);if(f)return f;i.set(s,o),co(s)?s.forEach(function(j){o.add(Je(j,t,a,j,s,i))}):oo(s)&&s.forEach(function(j,w){o.set(w,Je(j,t,a,w,s,i))});var m=g?l?eo:Di:l?po:uo,u=x?void 0:m(s);return Ki(u||s,function(j,w){u&&(w=j,j=s[w]),Vi(o,w,Je(j,t,a,w,s,i))}),o}var Fo=Je,Eo=Fo,$o=1,Wo=4;function qo(s){return Eo(s,$o|Wo)}var Ho=qo;const Ce=Pa(Ho);function Ko(s,t){if(t==null)return s;function a(n){return typeof n=="object"&&n!=null?Array.isArray(n)?n.map(a):Object.fromEntries(Object.entries(n).map(([r,i])=>[r,a(i)])):n===null?void 0:n}return t=a(t),{...s,...t}}var fe=(s=>(s[s.Loading=0]="Loading",s[s.UploadingProfilePic=1]="UploadingProfilePic",s[s.GeneratingProfilePic=2]="GeneratingProfilePic",s[s.GizmoNameTooLong=3]="GizmoNameTooLong",s[s.GizmoDescriptionTooLong=4]="GizmoDescriptionTooLong",s[s.GizmoInstructionsTooLong=5]="GizmoInstructionsTooLong",s[s.NameEmpty=6]="NameEmpty",s[s.MissingPublicActionPrivacyPolicyURL=7]="MissingPublicActionPrivacyPolicyURL",s[s.MissingCategory=8]="MissingCategory",s))(fe||{});function ws(s){switch(s){case 0:return"Loading";case 1:return"Uploading profile picture";case 2:return"Generating profile picture";case 3:return"GPT name too long";case 4:return"GPT description too long";case 5:return"GPT instructions too long";case 6:return"GPT name cannot be empty";case 7:return"Public actions require valid privacy policy URLs";case 8:return"Public GPTs must have a category"}}function Vo(s){return s==="link"||s==="marketplace"}function Yo(s){try{return new URL(s),!0}catch{return!1}}function He(s,t,a){var c,l,g,x;const n=s.name.length>_t,r=(((c=s.description)==null?void 0:c.length)??0)>Nt,i=(((l=s.instructions)==null?void 0:l.length)??0)>St,o=[];if((s==null?void 0:s.name)===""&&o.push(6),n&&o.push(3),r&&o.push(4),i&&o.push(5),t!=null&&Vo(t)){const h=(g=s.tools)==null?void 0:g.filter(p=>p.type===X.JIT_PLUGIN);for(const p of h){const f=(x=p.metadata)==null?void 0:x.privacy_policy_url;if(f==null||!Yo(f)){o.push(7);break}}}return t===y.Marketplace&&a==null&&o.push(8),o}const ia=Ee(()=>$e(()=>import("./l7re60r7vv52ucch.js"),__vite__mapDeps([0,1,2,3])).then(s=>s.DirectorySyncResourceManagedIndication)),Qo=[ee,Ye];function Xo(s,t){return s.type===$.USER?s.user_id===t.user_id:s.type===$.GROUP?s.group_id===t.group_id:s.type===t.type}const Jo={[$.USER]:y.User,[$.GROUP]:y.Group,[$.WORKSPACE]:y.Workspace,[$.ALL]:y.Marketplace};function oa(s){const t=Jo[s.type];if(!t)throw new Error("Unknown sharing subject type: "+s.type);return{...s,type:t}}function Zo({gizmo:s,publishedGizmo:t,updateGizmo:a,promoteGizmo:n,appealGizmo:r,setAppealState:i,showActionsModal:o,shareOnly:c,onClose:l,workspaceOwner:g=!1}){var ye,N,H;const x=D(),h=me(),p=Ue(),f=((ye=p==null?void 0:p.data)==null?void 0:ye.name)??"your workspace",m=Pt(),u=Ht(),[j,w]=v.useState(void 0);v.useEffect(()=>{var k;if(j==null)if(t!=null&&t.gizmo.display.categories&&(t==null?void 0:t.gizmo.display.categories.length)>0){const L=(k=u.data)==null?void 0:k.categories.find(te=>te.id===(t==null?void 0:t.gizmo.display.categories[0]));L&&w(L)}else u.data!=null&&w(u.data.categories[u.data.categories.length-1])},[u.data,j,t]);const[b,T]=v.useState(s.sharingRecipient??y.Private),[I,R]=v.useState(((N=s.sharing)==null?void 0:N.subjects)??[]),[_,A]=v.useState(null),[G,S]=v.useState(!1),P=v.useCallback(()=>{var k;return!we((k=s.sharing)==null?void 0:k.subjects,I)||s.sharingRecipient!==b},[s.sharing,s.sharingRecipient,b,I]),O=Fe(),q=He(s,b,(j==null?void 0:j.id)??void 0),J=q.includes(fe.MissingPublicActionPrivacyPolicyURL),B=s.tools.find(k=>k.type===X.JIT_PLUGIN&&!k.metadata.privacy_policy_url);if(_)return e.jsx(ca,{publishedGizmo:_,sharing:{recipient:b,subjects:I},workspaceName:f,onClose:l});function V(k){I.find(L=>Xo(L,k))||R([...I,k])}const F=Ct(I);function ve(k){const L=I.filter(te=>[$.WORKSPACE,$.ALL].indexOf(te.type)===-1);k!=null&&L.push(k),R(L)}function se(k){switch(T(k),k){case y.Marketplace:case y.Link:ve({type:$.ALL,capabilities:ee});break;case y.Workspace:case y.WorkspaceLink:ve({type:$.WORKSPACE,capabilities:ee});break;default:ve(null)}}function ge(k){F!=null&&R(I.map(L=>L===F?{...L,capabilities:k}:L))}function xe(k,L,te){return k.type===$.USER&&k.user_id.indexOf("__")===-1?{...k,user_id:k.user_id+"__"+(p==null?void 0:p.getWorkspaceId())}:k}async function Ne(k,L){if(G)return;if(k&&!L)throw new Error("Cannot share a gizmo that hasn't been promoted before");if(!j)return;S(!0);let le=I.map(xe).map(oa);if(le=Ge(b,le,(F==null?void 0:F.capabilities)??ee),g)return!p||!L?(h.warning("Unable to change sharing settings"),l()):(await We.updateWorkspaceGPTSharing(p.id,L,le),h.success(x.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),O.invalidateQueries({queryKey:["workspace"]}),l());if(k){if(!L||!t)throw new Error("No gizmo ID to share");try{const M={sharing:le};j&&(M.categories=[j.id]);const C=await Le.shareGizmo(L,M);C.error?cs(b,C.sharing_targets)?(i({gizmoId:t.gizmo.id,sharingRecipient:b,categories:t.gizmo.display.categories,moderationType:as.PublishBlocked,sharingTargets:C.sharing_targets,showModal:Me.AppealAvailable}),l()):h.warning(x.formatMessage({id:"tmIKmp",defaultMessage:"Unable to share GPT"})):(O.setQueryData(["gizmo",{gizmoId:t.gizmo.id},{draft:!1}],Y=>C.resource),a(Y=>({...Y,sharingRecipient:b})),h.success(x.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),l())}catch{return h.warning(x.formatMessage({id:"dKC65l",defaultMessage:"Failed to update sharing settings"})),l()}}else{const M=await n({subjects:le,recipient:b},j.id);L||(L=M==null?void 0:M.gizmo.id),A(M??null),a({liveVersion:(M==null?void 0:M.gizmo.live_version)??void 0}),O.invalidateQueries({queryKey:["gizmo",{gizmoId:L}]})}S(!1),O.invalidateQueries({queryKey:["gizmos"]}),O.invalidateQueries({queryKey:["gizmo","userActionSettings",{gizmoId:L}]}),O.invalidateQueries({queryKey:["workspace"]}),a({sharing:{recipient:b,subjects:I},sharingRecipient:b},!1)}return e.jsx(ue,{type:"success",className:"max-w-[555px]",size:"custom",isOpen:!0,onClose:l,primaryButton:cs(b,s.sharingTargets)?e.jsx(re,{onClick:()=>r(b,j==null?void 0:j.id),children:e.jsx(d,{id:"HRzqKK",defaultMessage:"Appeal"})}):e.jsx(re,{onClick:()=>Ne(c,t==null?void 0:t.gizmo.id),loading:G,disabled:q.length>0||!de(b,s.sharingTargets),children:c?e.jsx(d,{id:"BEKjVh",defaultMessage:"Save"}):e.jsx(d,{id:"24j5ts",defaultMessage:"Update"})}),secondaryButton:e.jsxs(e.Fragment,{children:[P()&&e.jsx("div",{className:"absolute bottom-8 left-6 text-sm text-token-text-secondary",children:e.jsx(d,{id:"9CkgC4",defaultMessage:"Unsaved changes"})}),t&&e.jsx(re,{color:"secondary",onClick:k=>qe(t,h,k,x.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:e.jsx(d,{id:"wvL15a",defaultMessage:"Copy link"})})]}),title:x.formatMessage({id:"7JggXH",defaultMessage:"Share GPT"}),showCloseButton:!0,children:e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsx(Do,{onAdd:k=>V(k),publishedGizmo:t}),e.jsx("h3",{className:"text-base font-semibold",children:e.jsx(d,{id:"bNQXcV",defaultMessage:"Share with..."})}),e.jsxs("div",{className:"max-h-[200px] space-y-2 overflow-y-auto",children:[e.jsxs("div",{className:"mb-4 flex flex-row items-center justify-between space-x-3",children:[e.jsx("div",{className:"shrink-0 grow-0 self-start",children:e.jsx(Ea,{user:m,size:"gizmoConversation",roundedStyle:"rounded-full"})}),e.jsx("div",{className:"grow",children:!t||el(t==null?void 0:t.gizmo.author.user_id.split("__")[0],m==null?void 0:m.id)?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-base font-semibold",children:e.jsx(d,{id:"U7tzof",defaultMessage:"{userName} (you)",values:{userName:m==null?void 0:m.name}})}),e.jsx("span",{className:"-mt-1 text-sm text-token-text-secondary",children:m==null?void 0:m.email})]}):e.jsx("span",{className:"text-base font-semibold",children:e.jsx(d,{id:"scRZqV",defaultMessage:"{userName} (builder)",values:{userName:t==null?void 0:t.gizmo.author.display_name}})})})]}),I.map((k,L)=>xs(k)&&e.jsxs("div",{className:"mb-4 flex flex-row items-center justify-between space-x-3",children:[e.jsx($a,{name:k.type===$.GROUP?k.group_name:`${k.user_name} ${k.user_email}`,initialsCount:k.type===$.USER?2:1,size:"gizmoConversation",className:ie("shrink-0 grow-0",k.type===$.USER&&"self-start")}),e.jsxs("div",{className:"flex grow flex-col",children:[e.jsxs("span",{className:"flex flex-row",children:[e.jsx("span",{className:"mr-2 text-base font-semibold",children:k.type===$.GROUP?k.group_name:k.user_name}),k.type===$.GROUP&&k.is_scim_managed&&e.jsx(ia,{})]}),k.type===$.USER&&e.jsx("span",{className:"-mt-1 text-sm text-token-text-secondary",children:k.user_email})]}),e.jsxs(W.Root,{children:[e.jsxs(W.Trigger,{className:"whitespace-nowrap text-base text-token-text-secondary",children:[e.jsx(d,{...Te(k.capabilities)}),e.jsx(ys,{className:"icon-md"})]}),e.jsx(W.Portal,{children:e.jsxs(W.Content,{className:"max-w-[280px]",children:[Qo.map((te,le)=>e.jsx(ds,{caps:te,selected:we(te,k.capabilities),onClick:()=>{R(I.map(M=>M===k?{...M,capabilities:te}:M))}},le)),e.jsx(W.Separator,{}),e.jsx(W.Item,{onClick:()=>R(I.filter(te=>te!==k)),color:"danger",icon:ts,children:e.jsx(d,{id:"NU0BOB",defaultMessage:"Remove"})})]})})]})]},L))]}),e.jsx("hr",{className:"border-token-border-medium"}),e.jsx("h3",{className:"text-base font-semibold",children:e.jsx(d,{id:"uqD7Y8",defaultMessage:"Access"})}),e.jsxs("div",{className:"-ms-3.5 flex flex-row items-center justify-between space-x-3",children:[e.jsxs(Q.Root,{value:b,onValueChange:k=>se(k),children:[e.jsxs(Q.Trigger,{children:[e.jsx(Q.Value,{}),e.jsx(Q.Icon,{})]}),e.jsx(Q.Portal,{children:e.jsxs(Q.Content,{children:[e.jsxs(Q.Group,{children:[e.jsx(Q.Label,{children:e.jsx(d,{id:"YIQwaP",defaultMessage:"Private"})}),e.jsx(Q.Item,{value:y.Private,children:e.jsx(Pe,{shareLevel:y.Private,workspaceName:f})})]}),e.jsx(Q.Separator,{}),e.jsx(hs,{label:x.formatMessage({id:"n0m61x",defaultMessage:"Your workspace has disabled sharing with the workspace."}),side:"bottom",disabled:de("workspace",s.sharingTargets),children:e.jsxs(Q.Group,{children:[e.jsx(Q.Label,{children:f}),e.jsx(Q.Item,{value:y.WorkspaceLink,disabled:!de(y.WorkspaceLink,s.sharingTargets)&&!de(y.Workspace,s.sharingTargets),children:e.jsx(Pe,{shareLevel:y.WorkspaceLink,workspaceName:f})}),e.jsx(Q.Item,{value:y.Workspace,disabled:!de("workspace",s.sharingTargets),children:e.jsx(Pe,{shareLevel:y.Workspace,workspaceName:f})})]})}),e.jsx(Q.Separator,{}),e.jsx(hs,{label:x.formatMessage({id:"IHnort",defaultMessage:"Your workspace has disabled public sharing."}),side:"bottom",disabled:de("marketplace",s.sharingTargets),children:e.jsxs(Q.Group,{children:[e.jsx(Q.Label,{children:e.jsx(d,{id:"PjY9bi",defaultMessage:"Public"})}),e.jsx(Q.Item,{value:y.Link,disabled:!de("link",s.sharingTargets),children:e.jsx(Pe,{shareLevel:y.Link,workspaceName:f})}),e.jsx(Q.Item,{disabled:!de("marketplace",s.sharingTargets),value:y.Marketplace,children:e.jsx(Pe,{shareLevel:y.Marketplace,workspaceName:f})})]})})]})})]}),b!==y.Private&&b!==y.User&&e.jsxs(W.Root,{children:[e.jsxs(W.Trigger,{className:"whitespace-nowrap text-base text-token-text-secondary",children:[F==null?e.jsx(d,{...Te(ee)}):e.jsx(d,{...Te(F.capabilities)}),e.jsx(ys,{className:"icon-md"})]}),e.jsx(W.Portal,{children:e.jsxs(W.Content,{className:"max-w-[280px]",children:[e.jsx(ds,{onClick:()=>ge(ee),caps:ee,selected:we(F==null?void 0:F.capabilities,ee)}),b!==y.Marketplace&&b!==y.Link&&e.jsx(ds,{onClick:()=>ge(Ye),caps:Ye,selected:we(F==null?void 0:F.capabilities,Ye)})]})})]})]}),J&&e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(d,{id:"/iw1Iv",defaultMessage:"Public actions require valid privacy policy URLs. Click <fixlink>here</fixlink> to update.",values:{fixlink:k=>e.jsx("button",{onClick:()=>{o(B==null?void 0:B.metadata.action_id),l()},className:"underline",children:k})}})}),(b===y.Marketplace||b===y.Workspace)&&(de(b,s.sharingTargets)?e.jsx(Us,{gizmo:s,category:j==null?void 0:j.id,categories:(H=u.data)==null?void 0:H.categories,onCategoryChange:k=>w(k)}):cs(b,s.sharingTargets)?e.jsx("div",{className:"pb-2 text-xs text-red-500",children:e.jsx(ta,{sharingRecipient:b,moderatedFields:As(b,s.sharingTargets)??[],appealAvailable:!0})}):e.jsx("div",{className:"pb-2 text-xs text-red-500",children:e.jsx(d,{id:"BzqqKH",defaultMessage:"Your workspace's settings don't allow this level of access. An owner of the workspace can change this setting in the workspace's GPTs settings."})}))]})})}const la=je({private:{id:"pSXBWQ",defaultMessage:"Invite-only"},user:{id:"pSXBWQ",defaultMessage:"Invite-only"},group:{id:"pSXBWQ",defaultMessage:"Invite-only"},workspace_link:{id:"Giaxt1",defaultMessage:"Anyone at {workspaceName} with the link"},workspace:{id:"XLHaTU",defaultMessage:"{workspaceName}"},link:{id:"uP1+Ri",defaultMessage:"Anyone with the link"},marketplace:{id:"82Ilac",defaultMessage:"GPT Store"}}),zo=je({workspace:{id:"1kpopF",defaultMessage:"Published to {workspaceName}"},marketplace:{id:"hdTRpJ",defaultMessage:"Published to GPT Store"}});function Te(s){return s.can_write?K({id:"SubCqD",defaultMessage:"Can edit"}):s.can_view_config?K({id:"ud3lp4",defaultMessage:"Can view configuration"}):s.can_read?K({id:"/0j34W",defaultMessage:"Can chat"}):K({id:"x2E8ET",defaultMessage:"Unknown"})}function ds({caps:s,selected:t,onClick:a}){let n=vn;return s.can_view_config?n=yn:s.can_read&&(n=bn),e.jsx(W.Item,{className:"flex h-auto flex-row items-start space-x-3 px-3 py-3",onClick:a,icon:n,children:s.can_write?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex grow flex-col",children:e.jsx("span",{className:"text-base font-semibold leading-tight",children:e.jsx(d,{...Te(s)})})}),e.jsx(Qe,{className:ie("icon-lg shrink-0",!t&&"invisible")})]}):s.can_view_config?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex grow flex-col",children:[e.jsx("span",{className:"align-baseline text-base font-semibold leading-tight",children:e.jsx(d,{...Te(s)})}),e.jsx("span",{className:"text-xs text-token-text-secondary",children:e.jsx(d,{id:"fL1rWw",defaultMessage:"View configuration settings, duplicate, and chat"})})]}),e.jsx(Qe,{className:ie("icon-lg shrink-0",!t&&"invisible")})]}):s.can_read?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex grow flex-col",children:[e.jsx("span",{className:"text-base font-semibold leading-tight",children:e.jsx(d,{...Te(s)})}),e.jsx("span",{className:"text-xs text-token-text-secondary",children:e.jsx(d,{id:"tx5q1o",defaultMessage:"Users can only chat with this GPT"})})]}),e.jsx(Qe,{className:ie("icon-lg shrink-0",!t&&"invisible")})]}):null})}const ss={private:os,user:os,group:os,workspace_link:De,workspace:Qt,link:De,marketplace:Xt};function Pe({shareLevel:s,workspaceName:t,hasInviteSharing:a=!0}){(s===y.User||s===y.Group)&&(s=y.Private);const n=ss[s];return e.jsxs("div",{className:"flex flex-row items-center gap-3 text-base",children:[e.jsx(n,{className:"icon-lg"}),e.jsx("div",{className:"line-clamp-1 pt-px text-start font-semibold",children:!a&&s===y.Private?e.jsx(d,{id:"vVJhYB",defaultMessage:"Only me"}):e.jsx(d,{...la[s],values:{workspaceName:t}})})]})}function ca({publishedGizmo:s,sharing:t,workspaceName:a,onClose:n}){const r=t.recipient,i=ss[r],o=D(),c=me();return e.jsxs(ue,{isOpen:!0,onClose:n,showCloseButton:!0,className:"w-[304px]",title:e.jsx(d,{id:"5CEceY",defaultMessage:"GPT Updated"}),primaryButton:e.jsx(re,{onClick:()=>{window.location.href=`/g/${s.gizmo.id}`},children:e.jsx(d,{id:"RF75o5",defaultMessage:"View GPT"})}),secondaryButton:e.jsx(re,{color:"secondary",onClick:l=>qe(s,c,l,o.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:e.jsx(d,{id:"9hLOl9",defaultMessage:"Copy link"})}),type:"success",children:[e.jsx(Us,{gizmo:{profilePictureUrl:s.gizmo.display.profile_picture_url??void 0,name:s.gizmo.display.name}}),t.subjects.filter(l=>xs(l)).length>0&&e.jsxs("div",{className:"my-4",children:[e.jsx("h4",{className:"text-xs font-semibold text-token-text-secondary",children:e.jsx(d,{id:"/paYH9",defaultMessage:"Shared with"})}),t.subjects&&t.subjects.map((l,g)=>xs(l)&&e.jsxs("div",{className:"flex flex-row items-center justify-between space-x-3 py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-base font-semibold",children:l.type===$.GROUP?l.group_name:l.user_name}),l.type===$.USER&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{className:"text-sm text-token-text-secondary",children:l.user_email})]})]}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(d,{...Te(l.capabilities)})})]},g))]}),e.jsxs("div",{className:"my-4",children:[e.jsx("h4",{className:"text-xs font-semibold text-token-text-secondary",children:e.jsx(d,{id:"q9XNZ7",defaultMessage:"Access"})}),e.jsxs("div",{className:"ml-[3px] flex flex-row items-center py-3 text-left text-base font-semibold",children:[e.jsx(i,{className:"md:icon-lg mr-3 h-6 w-6 shrink-0"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(d,{...zo[r]??la[r],values:{workspaceName:a}})}),(r===y.Workspace||r===y.Marketplace)&&e.jsx("span",{className:"text-xs text-token-text-secondary"})]})]})]})]})}function Us({gizmo:s,category:t,categories:a,onCategoryChange:n}){const{data:r,isLoading:i}=Kt(),o=a==null?void 0:a.find(c=>c.id===t);return e.jsxs("div",{children:[e.jsxs("div",{className:ie("mb-[1px] flex flex-row items-center space-x-2 bg-token-main-surface-secondary p-4",i&&"invisible",a?"rounded-t-lg":"rounded-lg"),children:[e.jsx(Cs,{isFirstParty:!1,className:"h-11 w-11",src:s.profilePictureUrl}),e.jsxs("div",{className:"flex grow flex-col space-y-0",children:[e.jsx("span",{className:"text-base font-semibold",children:s.name}),e.jsx(En,{builderName:r==null?void 0:r.display_name,builderUrl:r==null?void 0:r.website_url,socials:[r==null?void 0:r.socials.linkedin,r==null?void 0:r.socials.github,r==null?void 0:r.socials.twitter].filter(c=>c!=null),className:"text-xs text-token-text-secondary"})]})]}),a&&e.jsxs("div",{className:"flex min-h-[56px] flex-row items-center justify-between space-x-2 rounded-b-lg bg-token-main-surface-secondary px-4 text-base",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(d,{id:"JcA4/t",defaultMessage:"Category"})}),e.jsx("div",{className:"text-token-text-secondary",children:n?e.jsx(Is,{size:"small",triggerButton:e.jsxs("button",{className:"flex items-center gap-1",children:[o==null?void 0:o.title,e.jsx(ys,{className:"icon-md"})]}),children:a.map((c,l)=>e.jsx(W.Item,{onClick:()=>n(c),children:c.title},l))}):e.jsx("span",{className:"text-token-text-secondary",children:o==null?void 0:o.title})})]})]})}const et=Be.li`flex flex-col rounded-sm p-1 hover:bg-token-main-surface-secondary`;function Do({onAdd:s,publishedGizmo:t}){var m;const a=D(),n=Ue(),[r,i]=v.useState(""),c=(m=Wa(n==null?void 0:n.id,0,r,5).data)==null?void 0:m.items.filter(u=>u.id!==(t==null?void 0:t.gizmo.author.user_id.split("__")[0])),{data:l}=Ca({queryKey:[n==null?void 0:n.id,"groups","filtered",r],queryFn:()=>We.getWorkspaceGroups(n.id,{query:r,orderby:"@score"}),enabled:r.trim()!==""&&n!=null&&!!n.getWorkspaceId()}),g=((c==null?void 0:c.length)??0)>0||((l==null?void 0:l.items.length)??0)>0,[x,h]=v.useState(!1);function p(u,j,w){s({type:$.GROUP,group_id:u,group_name:j,capabilities:{...ee},is_scim_managed:w}),i("")}function f(u,j,w){n&&(s({type:$.USER,user_id:u+"__"+n.getWorkspaceId(),user_name:j,user_email:w,capabilities:{...ee}}),i(""))}return e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex w-full flex-row space-x-3",children:e.jsxs(Os,{as:"div",className:"group relative z-10 grow",children:[e.jsx(Ze,{list:"suggested-choices",name:"share-with-input",placeholder:n!=null&&n.isEnterprisey()?a.formatMessage({id:"xy/AMO",defaultMessage:"Add people and groups from your workspace"}):a.formatMessage({id:"Lh9njB",defaultMessage:"Add people from your workspace"}),value:r,onChange:u=>i(u.target.value),onFocus:()=>h(!0),onBlur:()=>h(!1)}),e.jsx(qa,{show:r.trim()!==""&&g&&x,children:e.jsx(Os.Panel,{static:!0,className:"absolute top-8 ml-0 w-full cursor-pointer overflow-y-auto rounded-lg rounded-t-none border border-t-0 border-token-border-light bg-token-main-surface-primary px-1 py-1 group-has-[:focus]:border-token-border-xheavy",children:r.trim()!==""&&e.jsxs("ul",{id:"suggested-choices",children:[c&&c.map(u=>e.jsxs(et,{tabIndex:0,className:"rounded-sm p-1 text-sm hover:bg-token-main-surface-secondary",onClick:()=>f(u.id,u.name,u.email??""),children:[e.jsx("span",{className:"w-full font-semibold",children:u.name}),e.jsx("span",{className:"text-sm text-token-text-secondary",children:u.email})]},u.id)),(l==null?void 0:l.items)&&l.items.slice(0,5).map(u=>e.jsx(et,{tabIndex:0,onClick:()=>p(u.id,u.name,u.is_scim_managed??!1),children:e.jsxs("span",{className:"flex flex-col",children:[e.jsxs("span",{className:"flex flex-row",children:[e.jsx("span",{className:"mr-2 font-semibold",children:u.name}),u.is_scim_managed&&e.jsx(ia,{})]}),e.jsx("span",{className:"text-sm text-token-text-secondary",children:e.jsx(d,{id:"r3Rx6X",defaultMessage:"{numMembers, plural, one {1 member} other {# members}}",values:{numMembers:u.num_members}})})]})},u.id))]})})})]})})})}function el(s,t){return s===void 0||t===void 0?!1:s.split("__")[0]===t.split("__")[0]}function sl({gizmo:s,updateGizmo:t,publishedGizmo:a,promoteGizmo:n,appealGizmo:r,setAppealState:i,showActionsModal:o,shareOnly:c,onClose:l}){const[g,x]=v.useState({type:"privacy"});return g.type==="privacy"?e.jsx(al,{gizmo:s,updateGizmo:t,publishedGizmo:a,promoteGizmo:n,appealGizmo:r,setAppealState:i,setStep:x,showActionsModal:o,shareOnly:c,onClose:l}):e.jsx(nl,{publishedGizmo:g.publishedGizmo,onClose:l})}function tl(s){return s?y.Workspace:y.Link}function al({gizmo:s,publishedGizmo:t,updateGizmo:a,promoteGizmo:n,appealGizmo:r,setAppealState:i,setStep:o,showActionsModal:c,shareOnly:l,onClose:g}){var ge,xe,Ne,ye;const[x,h]=v.useState(!1),p=ze(It.isBusinessWorkspace),f=D(),m=me(),[u,j]=v.useState(Ps(s)?tl(!!p):s.sharingRecipient),w=Fe(),b=de(u,s.sharingTargets),{data:T,isLoading:I}=Kt(),R=Ht(),[_,A]=v.useState(t!=null&&t.gizmo.display.categories.length>0?(xe=(ge=R.data)==null?void 0:ge.categories.find(N=>N.id===t.gizmo.display.categories[0]))==null?void 0:xe.id:void 0);v.useEffect(()=>{A(t==null?void 0:t.gizmo.display.categories[0])},[t==null?void 0:t.gizmo.display.categories]);const[G,S]=v.useState(void 0),P=v.useRef(Ha((N,H)=>Le.generateCategory(N,H),1e3)),O=T!=null&&T.is_verified?void 0:f.formatMessage({id:"qEQtmt",defaultMessage:"To publish your GPTs to the Explore GPTs page, set up your builder profile."});u===y.Marketplace&&O!=null&&!I&&j(y.Link);const q=p&&!((Ne=s.sharingTargets)!=null&&Ne.some(N=>N.recipient===y.Link)),J=He(s,u,_),B=J.includes(fe.MissingPublicActionPrivacyPolicyURL),V=s.tools.find(N=>N.type===X.JIT_PLUGIN&&!N.metadata.privacy_policy_url),F=ze(N=>N.currentWorkspace),ve=ft();v.useEffect(()=>{let N=!0;return(async()=>{try{if(_!=null)return;const H=await P.current(s.name,s.instructions);N&&_==null&&(H?A(H.id):S(!0))}catch{N&&_==null&&S(!0)}})(),()=>{N=!1}},[s.instructions,s.name,ve,_]);const{value:se}=Ie("4226692983");return e.jsx(ue,{type:"success",isOpen:!0,onClose:g,title:e.jsx(d,{id:"9viumf",defaultMessage:"Share GPT"}),showCloseButton:!0,primaryButton:b?e.jsx(re,{color:"primary",disabled:J.length>0,loading:x,onClick:async()=>{try{if(h(!0),l){if(!(t!=null&&t.gizmo.id)){m.danger(f.formatMessage({id:"QYVEx8",defaultMessage:"Error sharing GPT"}));return}const N=await Le.shareGizmo(t.gizmo.id,_?{sharing:Ge(u,[],ee),categories:[_]}:{sharing:Ge(u,[],ee)});N.error?(m.warning(f.formatMessage({id:"tmIKmp",defaultMessage:"Unable to share GPT"})),a({sharingTargets:N.sharing_targets}),i({gizmoId:t.gizmo.id,sharingRecipient:u,categories:t.gizmo.display.categories,moderationType:as.PublishBlocked,sharingTargets:N.sharing_targets,showModal:Me.AppealAvailable})):(w.setQueryData(["gizmo",{gizmoId:t.gizmo.id},{draft:!1}],H=>N.resource),a(H=>({...H,sharingRecipient:u})),m.success(f.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),g())}else{const N=await n({recipient:u,subjects:Ge(u,[],ee)},_);N?(o({type:"published",publishedGizmo:N}),a(H=>({...H,id:N.gizmo.id,sharingRecipient:u})),N.gizmo.live_version!=null&&a({liveVersion:N.gizmo.live_version}),m.success(f.formatMessage({id:"R5zko1",defaultMessage:"GPT published"}))):(m.warning(f.formatMessage({id:"uf7WYw",defaultMessage:"Unable to publish GPT"})),g())}}finally{h(!1)}},children:e.jsx(d,{id:"SW4DG4",defaultMessage:"Save"})}):se?e.jsx(e.Fragment,{children:e.jsx(re,{color:"primary",onClick:async()=>{await r(u,_)},children:e.jsx(d,{id:"bBmLUr",defaultMessage:"Appeal"})})}):null,secondaryButton:t?e.jsx(re,{color:"secondary",onClick:N=>qe(t,m,N,f.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:e.jsx(d,{id:"wvL15a",defaultMessage:"Copy link"})}):null,children:e.jsxs("div",{className:"mx-[-16px] flex flex-col gap-3 text-sm",children:[e.jsx("div",{className:"space-y-1.5",children:e.jsxs(At,{value:u,onValueChange:N=>j(N),children:[s.sharingTargets&&s.sharingTargets.map((N,H)=>e.jsx(us,{value:N.recipient,disabled:N.recipient===y.Marketplace&&O!=null,tooltipText:N.recipient===y.Marketplace?O??f.formatMessage({id:"0Rcb4e",defaultMessage:"Your GPT will appear in the Explore GPTs page"}):void 0,shareLevel:N.recipient},H)),q&&e.jsxs(e.Fragment,{children:[e.jsx(us,{value:y.Link,disabled:!0,tooltipText:f.formatMessage(st.workspaceDisabledHint),shareLevel:y.Link,workspaceName:F==null?void 0:F.name}),e.jsx(us,{value:y.Link,disabled:!0,tooltipText:f.formatMessage(st.workspaceDisabledHint),shareLevel:y.Marketplace,workspaceName:F==null?void 0:F.name})]})]})}),B&&e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(d,{id:"/iw1Iv",defaultMessage:"Public actions require valid privacy policy URLs. Click <fixlink>here</fixlink> to update.",values:{fixlink:N=>e.jsx("button",{onClick:()=>{c(V==null?void 0:V.metadata.action_id)},className:"underline",children:N})}})}),u!==y.Private&&e.jsx(Us,{gizmo:s,category:_,categories:u===y.Marketplace?((ye=R.data)==null?void 0:ye.categories)??[]:void 0,onCategoryChange:u===y.Marketplace?N=>A(N.id):void 0}),u===y.Marketplace&&(G?e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(d,{id:"tpC3ui",defaultMessage:"There was an error updating the list of categories"})}):null),!b&&se&&e.jsx("div",{className:"flex items-center justify-between text-sm text-token-text-secondary",children:e.jsx(d,{id:"jLCMMV",defaultMessage:"Because this GPT previously may have violated our policies, you will have to submit an appeal to make it available at this level."})})]})})}function nl({publishedGizmo:s,onClose:t}){const a=$n(s),n=D(),r=me();return e.jsx(ue,{type:"success",isOpen:!0,onClose:t,title:e.jsx(d,{id:"rCRRmx",defaultMessage:"Settings Saved"}),showCloseButton:!0,primaryButton:e.jsx(re,{color:"primary",as:"link",to:a,children:e.jsx(d,{id:"lyZz44",defaultMessage:"View GPT"})}),children:e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex gap-1 rounded bg-token-main-surface-secondary px-2 py-1",children:[e.jsx("div",{className:"line-clamp-1 text-ellipsis break-all",children:a}),e.jsx("button",{onClick:i=>{qe(s,r,i,n.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"}))},className:"text-token-text-secondary transition hover:text-token-text-primary",children:e.jsx(Jt,{className:"icon-sm"})})]})})})}const st=je({workspaceDisabledHint:{id:"gizmo.workspaceDisabledHint",defaultMessage:"Your workspace administrator has disabled this setting"}});function us({shareLevel:s,workspaceName:t,value:a,disabled:n=!1,tooltipText:r}){const i=v.useId();return e.jsx(hs,{disabled:r==null,label:r,side:"top",children:e.jsxs(Lt,{id:i,value:a,disabled:n,className:"flex h-14 w-full cursor-pointer flex-row items-center justify-between gap-2 rounded-md px-3 py-4 font-semibold hover:bg-token-main-surface-secondary",children:[e.jsx("label",{htmlFor:i,className:"flex cursor-pointer items-center gap-1",children:e.jsx(Pe,{shareLevel:s,workspaceName:t??"",hasInviteSharing:!1})}),e.jsx(Ka,{children:e.jsx(Qe,{className:"icon-lg mr-1"})})]})})}function da(s){window.history.length>1?s(-1):s(Gn())}function rl({gizmo:s,publishedGizmo:t,isLoading:a,isUploadingProfilePic:n,isGeneratingProfilePic:r,updateGizmo:i,promoteGizmo:o,appealGizmo:c,setAppealState:l,showActionsModal:g}){const x=Ue(),h=s!=null?He(s):[];(s==null||a)&&h.push(fe.Loading),n&&h.push(fe.UploadingProfilePic),r&&h.push(fe.GeneratingProfilePic);const p=Ps(s),[f,m]=v.useState(!1),[u,j]=v.useState(!1),w=s.sharingRecipient?ss[s.sharingRecipient]:ss.private;return e.jsxs(e.Fragment,{children:[p?e.jsx(oe,{color:"primary",onClick:()=>m("promote"),loading:a,disabled:s.id===void 0||h.length>0,tooltip:h.length>0?h.map(ws).join(`
`):void 0,children:e.jsx(d,{id:"svUGIb",defaultMessage:"Create"})}):e.jsxs(e.Fragment,{children:[e.jsxs(oe,{color:"secondary",loading:a||!t,onClick:()=>m("share"),children:[e.jsx(w,{className:"icon-sm shrink-0"}),e.jsx(d,{id:"aXKW4G",defaultMessage:"Share"})]}),e.jsx(oe,{color:"primary",onClick:async()=>{let b=s.sharing.subjects.map(oa);const T=Ct(s.sharing.subjects);b=Ge(s.sharing.recipient,b,(T==null?void 0:T.capabilities)??ee),await o({recipient:s.sharing.recipient,subjects:b},t==null?void 0:t.gizmo.display.categories[0])&&j(!0)},loading:a||!t,disabled:h.length>0,tooltip:h.length>0?h.map(ws).join(`
`):void 0,children:e.jsx(d,{id:"84QVoj",defaultMessage:"Update"})})]}),f&&((x==null?void 0:x.getWorkspaceId())==null?e.jsx(sl,{gizmo:s,publishedGizmo:t,promoteGizmo:o,appealGizmo:c,setAppealState:l,showActionsModal:g,updateGizmo:i,shareOnly:f==="share",onClose:()=>m(!1)}):e.jsx(Zo,{gizmo:s,publishedGizmo:t,promoteGizmo:o,appealGizmo:c,setAppealState:l,showActionsModal:g,updateGizmo:i,onClose:()=>m(!1),shareOnly:f==="share"})),u&&e.jsx(ca,{publishedGizmo:t,sharing:t.gizmo.sharing,onClose:()=>j(!1),workspaceName:(x==null?void 0:x.data.name)??""})]})}function il({gizmoEditorData:s,publishedGizmo:t,revertDraft:a}){const n=D(),r=me(),i=mt(),[o,c]=v.useState(!1),l=ft(),{value:g}=Ie("3645668434");return!(l!=null&&l.includes("debug"))&&(s==null?void 0:s.id)==null?null:e.jsxs(e.Fragment,{children:[e.jsxs(Is,{side:"top",contentAlign:"end",sideOffset:8,triggerButton:e.jsx(oe,{color:"ghost",icon:kn}),children:[t!=null&&e.jsxs(W.Item,{onClick:x=>{qe(t,r,x)},children:[e.jsx(De,{className:"icon-sm"}),e.jsx(d,{...he.copyLink})]}),a!=null&&e.jsxs(W.Item,{onClick:()=>{window.confirm(n.formatMessage(he.revertConfirm))&&a()},children:[e.jsx(wn,{className:"icon-sm"}),e.jsx(d,{id:"W2blnV",defaultMessage:"Revert..."})]}),(s==null?void 0:s.id)!=null&&g&&s.liveVersion>0&&e.jsxs(e.Fragment,{children:[e.jsxs(W.Item,{onClick:()=>{i(`/g/${s.id}/view`)},children:[e.jsx(Mn,{className:"icon-sm"}),e.jsx(d,{id:"gizmo.versionHistory",defaultMessage:"Version History"})]}),e.jsxs(W.Item,{onClick:async()=>{const x=await Le.copyGizmo({gizmoId:s.id});x.gizmo.id&&i(`/gpts/editor/${x.gizmo.id}`)},children:[e.jsx(Jt,{className:"icon-sm"}),e.jsx(d,{id:"GizmoInformation.copyGizmoLabel",defaultMessage:"Duplicate GPT"})]})]}),(s==null?void 0:s.id)!=null&&e.jsxs(W.Item,{color:"danger",onClick:()=>{c(!0)},children:[e.jsx(ts,{className:"icon-sm"}),e.jsx(d,{id:"tNrOLG",defaultMessage:"Delete GPT"})]}),(l==null?void 0:l.includes("debug"))&&e.jsxs(e.Fragment,{children:[e.jsx(W.Separator,{}),e.jsxs(W.Item,{onClick:()=>{Oe.toggleActiveSidebar("debug")},children:[e.jsx(Tn,{className:"icon-sm"}),"Debug (Internal only)"]})]})]}),o&&e.jsx(Fn,{gizmoId:s.id,onSuccess:()=>da(i),onClose:()=>{c(!1)}})]})}const Ke=Be.div`flex items-center gap-1`;function ol({gizmoEditorData:s}){const t=ze(a=>{var n;return(n=a.currentWorkspace)==null?void 0:n.name});switch(s.sharingRecipient){case y.Private:return e.jsxs(Ke,{children:[e.jsx(_n,{className:"icon-xs"}),e.jsx(d,{...he.onlyMe})]});case y.Link:return e.jsxs(Ke,{children:[e.jsx(De,{className:"icon-xs"}),e.jsx(d,{...he.anyoneWithLink})]});case y.Workspace:return e.jsxs(Ke,{children:[e.jsx(Qt,{className:"icon-xs"}),t]});case y.Marketplace:return e.jsxs(Ke,{children:[e.jsx(Xt,{className:"icon-xs"}),e.jsx(d,{...he.public})]});default:return e.jsx("div",{})}}function ll({gizmoEditorData:s}){return e.jsxs("div",{className:"flex items-center gap-2",children:[s.profilePictureUrl!=null?e.jsx(Cs,{isFirstParty:!1,src:s.profilePictureUrl,className:"h-8 w-8"}):e.jsx("div",{className:"h-8 w-8 rounded-full border-2 border-dashed border-token-border-medium"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:s.name||e.jsx(d,{...he.newGPT})}),e.jsx("div",{className:"text-xs text-token-text-secondary",children:Ps(s)?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-token-text-tertiary"}),e.jsx(d,{...he.draft})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-brand-green"}),s.sharingRecipient===y.Marketplace?e.jsx(d,{...he.published}):e.jsx(d,{id:"gizmoEditorHeader.live",defaultMessage:"Live"})," · ",e.jsx(ol,{gizmoEditorData:s})]})})]})]})}function cl({gizmoEditorData:s,isLoading:t,isUploadingProfilePic:a,isGeneratingProfilePic:n,publishedGizmo:r,updateGizmo:i,promoteGizmo:o,appealGizmo:c,setAppealState:l,revertDraft:g,draftMessage:x,className:h,hasUnpublishedChanges:p,showActionsModal:f}){const m=mt();return e.jsxs("div",{className:ie("relative flex h-14 w-full items-center justify-between gap-2 border-b border-token-border-medium px-3",h),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{className:"cursor-pointer text-token-text-primary",onClick:()=>da(m),children:e.jsx(Va,{className:"icon-lg"})}),e.jsx(ll,{gizmoEditorData:s})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[x,e.jsx(il,{gizmoEditorData:s,publishedGizmo:r,revertDraft:g}),e.jsx(rl,{gizmo:s,publishedGizmo:r,isLoading:t,isUploadingProfilePic:a,isGeneratingProfilePic:n,updateGizmo:i,promoteGizmo:o,appealGizmo:c,setAppealState:l,hasUnpublishedChanges:p,showActionsModal:f})]})]})}const he=je({onlyMe:{id:"gizmo.onlyMe",defaultMessage:"Only me"},anyoneWithLink:{id:"gizmo.anyoneWithLink",defaultMessage:"Anyone with a link"},public:{id:"gizmo.public",defaultMessage:"Everyone"},newGPT:{id:"gizmo.newGPT",defaultMessage:"New GPT"},draft:{id:"gizmo.draft",defaultMessage:"Draft"},published:{id:"gizmo.published",defaultMessage:"Published"},revertConfirm:{id:"gizmo.revertConfirm",defaultMessage:"Are you sure you want to revert to the last saved version?"},copyLink:{id:"gizmo.copyLink",defaultMessage:"Copy link"}}),dl=512;function ul(){return e.jsx("div",{className:"relative flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-token-border-medium",children:e.jsx(_s,{className:"h-1/4 w-1/4"})})}function pl({gizmoEditorData:s,onFileChange:t,generateProfilePic:a,isGeneratingProfilePic:n,setIsGeneratingProfilePic:r}){const i=D(),o=me(),[c,l]=v.useState(void 0),g=v.useRef(t);v.useEffect(()=>{g.current=t});async function x(f){if(f.length>0){r(!1);const m=await Za(f[0],dl),u=js(m);l({tempId:u,file:m,status:ne.Uploading,progress:1,fileId:null,cdnUrl:null}),g.current("uploading"),za(u,m,i,o,gt.ProfilePicture,{onFileCreated(j,w,b){l(T=>T!=="initial"&&(T==null?void 0:T.tempId)===j&&T.status===ne.Uploading?{...T,progress:10,fileId:w,cdnUrl:b}:T)},onFileUploadProgress(j,w){l(b=>b!=="initial"&&(b==null?void 0:b.tempId)===j&&b.status===ne.Uploading?{...b,progress:w}:b)},onFileUploaded(j,w,b){l(T=>T!=="initial"&&(T==null?void 0:T.tempId)===j?(g.current(T),{...T,status:ne.Ready,progress:100,fileSpec:{name:T.file.name,id:T.fileId,size:T.file.size,...b??{}}}):T)},onError(j){l(w=>{if(w!=="initial"&&(w==null?void 0:w.tempId)===j){g.current(void 0);return}return w})}})}}const{open:h,getInputProps:p}=Ut({disabled:!1,noClick:!0,onDropAccepted:x,onDropRejected:f=>Wn(f,i,o,Ya.ProfilePicture),multiple:!0,maxSize:Rt,...Gt(Qa)});return e.jsxs("div",{className:"flex w-full items-center justify-center gap-4",children:[e.jsxs(Is,{sideOffset:8,triggerButton:e.jsx("button",{className:"h-20 w-20",children:n?e.jsx(ul,{}):c!=null&&c!="initial"&&c.status!=ne.Ready?e.jsxs("div",{className:"relative h-full w-full overflow-hidden rounded-full",children:[e.jsx(Xa,{file:c.file}),c.status===ne.Uploading&&c.progress<90?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:e.jsx(Ja,{percentage:c.progress,className:"h-6 w-6"})}):null]}):(s==null?void 0:s.profilePictureUrl)!=null&&(s==null?void 0:s.profilePictureUrl)!==""?e.jsx(Cs,{isFirstParty:!1,src:s.profilePictureUrl}):e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-token-border-medium",children:e.jsx(Nn,{className:"text-4xl"})})}),children:[e.jsx(W.Item,{onClick:h,children:e.jsx(d,{id:"ERQwXg",defaultMessage:"Upload Photo"})}),e.jsx(W.Item,{onClick:a,children:e.jsx(d,{id:"NXAog/",defaultMessage:"Use DALL·E"})})]}),e.jsx("input",{...p()})]})}function fl({gizmoEditorData:s,updateGizmo:t}){var h;const a=(h=s==null?void 0:s.tools)==null?void 0:h.find(p=>p.type===X.INTENT&&"intents"in p.settings),[n,r]=v.useState((a==null?void 0:a.settings.intents)??""),[i,o]=v.useState((a==null?void 0:a.settings.intent_hook)??""),[c,l]=v.useState(!1),g=D(),x=()=>{t(p=>({...p,tools:a?p.tools.map(f=>f.type===X.INTENT?{...f,settings:{...f.settings,intents:n,intent_hook:i}}:f):[...p.tools,{type:X.INTENT,settings:{intents:n,intent_hook:i}}]})),l(!1)};return e.jsxs(ae,{children:[e.jsx(z,{label:"GPT Script",description:g.formatMessage({id:"gizmo.gptScriptExplanation",defaultMessage:"Code and Intents to save GPT state"})}),c&&e.jsxs("div",{className:"mb-4",children:[e.jsx(z,{label:"Intent Hook"}),e.jsx(bs,{value:i,rows:20,onChange:p=>o(p.target.value),placeholder:`def f(input):
return {
  "instructions": str(input.intent),
  "conversation_state": input.conversation_state,
  "user_state": input.user_state,
  "pinned": {},
}`,className:"h-50 mb-4 block w-full resize-none rounded-md border border-gray-300 p-2 font-mono text-xs shadow-sm focus:border-blue-500 focus:ring-blue-500",spellCheck:"false"}),e.jsx(z,{label:"Intents"}),e.jsx(bs,{value:n,rows:20,onChange:p=>r(p.target.value),placeholder:"Enter Intent",className:"h-50 mb-4"}),e.jsx(re,{color:"primary",onClick:()=>{x()},children:"Update"})]}),!c&&e.jsx(oe,{onClick:()=>l(!0),children:i?"Update Script":"Add Script"})]})}function ml({gizmoEditorData:s,requireGizmoId:t,currentModelConfig:a,updateGizmo:n}){const r=D(),i=me(),[o,c]=v.useState(0),l=v.useRef(new Map),g=Da(a,void 0),x=async _=>{xt.logEvent(ht.uploadFile,{client:"web",eventSource:"mouse",intent:"gizmo"});const A=await t();_.length>0&&await Promise.all(_.map(G=>{const S=js(G);l.current.set(S,{tempId:S,gizmoId:A,file:G,status:ne.Uploading,progress:1,fileId:null,cdnUrl:null}),en(js(G),G,r,i,{kind:gt.Gizmo,gizmoId:A},{onFileUploaded:(P,O,q,J)=>{const B=l.current.get(P);B==null||B.fileId==null||(n(V=>({...V,files:[...V.files??[],{file_id:B.fileId,name:B.file.name,size:B.file.size,type:B.file.type,last_modified:B.file.lastModified,file_size_tokens:J==null?void 0:J.fileTokenSize}]})),l.current.delete(P),c(V=>V+1))},onFileCreated:(P,O,q)=>{l.current.set(P,{tempId:P,gizmoId:A,file:G,status:ne.Uploading,progress:1,...l.current.get(P),fileId:O,cdnUrl:q}),c(J=>J+1)},onFileUploadProgress:(P,O)=>{const q=l.current.get(P);(q==null?void 0:q.status)===ne.Uploading&&l.current.set(P,{...q,progress:O}),c(J=>J+1)},onError:P=>{l.current.delete(P)}},{usesRetrievalIndex:a!=null&&is(a,G.type,G.name)===rs.Retrieval})}))},{getInputProps:h,open:p}=Ut({disabled:!1,noClick:!0,onDropAccepted:x,multiple:!0,maxSize:Rt,maxFiles:10,...Gt(g)}),f=(s==null?void 0:s.files)??[];function m(_){return e.jsx(Fs,{onRemoveFileClick:()=>{l.current.delete(_.tempId),c(A=>A+1)},file:_.file,loadingPercentage:_.status===ne.Uploading?_.progress:void 0},_.tempId)}function u(_){return e.jsx(Fs,{file:_.name,fileId:_.file_id,onRemoveFileClick:()=>n(A=>{var G;return{...A,files:(G=A==null?void 0:A.files)==null?void 0:G.filter(S=>S.file_id!==_.file_id)}}),gizmoId:s==null?void 0:s.id},_.file_id)}const j=Array.from(l.current.values()).filter(_=>f.every(A=>A.file_id!==_.fileId)),[w,b]=Bs(j,_=>a!=null&&is(a,_.file.type,_.file.name)===rs.CodeInterpreter),[T,I]=Bs(f,_=>a!=null&&_.type!=null&&is(a,_.type,_.name)===rs.CodeInterpreter),R=v.useRef(T.length);return v.useEffect(()=>{T.length>R.current&&n(_=>{var A;return(A=_.tools)!=null&&A.some(G=>G.type===X.PYTHON)?_:{..._,tools:[..._.tools??[],{type:X.PYTHON}]}}),R.current=T.length},[T.length]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"rounded-lg text-token-text-tertiary",children:e.jsx(d,{...gl.knowledgeWarning})}),b.length>0||I.length>0?e.jsxs("div",{className:"flex flex-wrap gap-2",children:[b.map(m),I.map(u)]}):null,w.length>0||T.length>0?e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs text-token-text-tertiary",children:e.jsx(d,{id:"i/QurZ",defaultMessage:"The following files are only available for Code Interpreter:"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[w.map(m),T.map(u)]})]}):null,e.jsx("div",{children:e.jsxs(oe,{onClick:p,children:[e.jsx("input",{...h()}),e.jsx(d,{id:"sr8Qp/",defaultMessage:"Upload files"})]})})]})}const gl=je({knowledgeWarning:{id:"gizmo.knowledgeWarning",defaultMessage:"If you upload files under Knowledge, conversations with your GPT may include file contents. Files can be downloaded when Code Interpreter is enabled"}});function xl({placeholder:s,text:t,onChange:a,onClose:n}){return e.jsx(ue,{className:"!max-h-[100vh] !max-w-[80vw]",type:"success",isOpen:!0,onClose:n,primaryButton:e.jsx(oe,{onClick:n,children:e.jsx(d,{id:"FeFVdS",defaultMessage:"Close"})}),children:e.jsx("textarea",{className:"h-[70vh] w-full resize-none rounded-lg bg-token-main-surface-primary dark:border-gray-700",value:t,onChange:r=>{a(r.target.value)},placeholder:s})})}const ps=Be.div`text-sm text-red-500`;function hl({children:s,collapsed:t,initial:a}){return e.jsx(tn,{initial:a,children:!t&&e.jsx(Dt.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:s})})}function jl({gizmo:s,onShowActionsEditor:t,isDisabled:a}){var o,c;const n=D(),r=me(),i=e.jsxs("div",{className:"space-y-1",children:[(o=s==null?void 0:s.tools)==null?void 0:o.map((l,g)=>{var x;return l.type!==X.JIT_PLUGIN?null:e.jsxs("div",{children:[e.jsx(An,{isDisabled:a,actionTool:l,onShowActionsEditor:()=>t(l.metadata.domain)}),((x=l.metadata.auth)==null?void 0:x.type)==="oauth"&&e.jsx(an,{label:n.formatMessage(Z.callbackUrlLabel),value:`https://chat.openai.com/aip/${l.metadata.action_id}/oauth/callback`,onCopied:()=>{r.success("Copied to clipboard",{duration:3})}})]},g)}),(((c=s==null?void 0:s.tools)==null?void 0:c.filter(l=>l.type===X.JIT_PLUGIN))??[]).length>=Es?e.jsx("div",{children:n.formatMessage(Z.maxActionsReached,{number:Es})}):e.jsx(oe,{disabled:a,onClick:()=>{t("Unknown domain")},className:"mt-2",children:e.jsx(d,{...Z.createActionLabel})})]});return a?e.jsx(Bt,{side:"top",label:n.formatMessage(Z.disabledCustomActionsTooltip),children:i}):i}function vl(s){var t,a;return(((t=s.files)==null?void 0:t.length)??0)>0||((a=s==null?void 0:s.tools)==null?void 0:a.some(n=>n.type===X.JIT_PLUGIN))}const yl=12;function bl({gizmoEditorData:s,updateGizmo:t,currentModelConfig:a,generateProfilePic:n,setIsUploadingProfilePic:r,isGeneratingProfilePic:i,setIsGeneratingProfilePic:o,requireGizmoId:c,onShowActionsEditor:l,onShowBlocksEditor:g}){const x=(s==null?void 0:s.tools)??[],[h,p]=v.useState(!1),[f,m]=v.useState(!0),u=(s==null?void 0:s.promptStarters)??[],j=[...u,...u.length<yl?[""]:[]],w=He(s),b=Ue(),T=b==null?void 0:b.isWorkspaceAccount(),I=Ot(jt.WorkspaceGPTCustomActions),R=D(),{value:_}=Ie("804300613"),{value:A}=Ie("736089948"),{value:G}=Ie("3047641741");return e.jsxs("div",{className:"flex h-full grow flex-col overflow-y-auto px-2 pt-6 text-sm",children:[e.jsxs("div",{className:"grow",children:[e.jsxs(ae,{children:[e.jsx(pl,{gizmoEditorData:s,generateProfilePic:n,isGeneratingProfilePic:i,setIsGeneratingProfilePic:o,onFileChange:async S=>{if(S!=null&&S!=="uploading"&&S.fileId!=null){const P=await We.getFileDownloadLink(S.fileId);P.status===Ns.Success&&t({profilePictureId:S.fileId!=null?S.fileId:void 0,profilePictureUrl:P.download_url})}else t({profilePictureId:void 0,profilePictureUrl:void 0});r(S==="uploading")}}),e.jsx(z,{label:e.jsx(d,{id:"M4dZms",defaultMessage:"Name"}),description:e.jsx(d,{id:"+Gkni2",defaultMessage:"The name of your GPT"})}),e.jsx(ls,{type:"text",placeholder:R.formatMessage(Z.gptNamePlaceholder),value:(s==null?void 0:s.name)??"",onChange:S=>{t({name:S.target.value})},onBlurCapture:()=>t(S=>({...S,name:S.name.trim()}))}),w.includes(fe.GizmoNameTooLong)?e.jsx(ps,{className:"mt-1",children:e.jsx(d,{...Z.nameTooLong,values:{length:_t}})}):null]}),e.jsxs(ae,{className:"mt-4",children:[e.jsx(z,{label:e.jsx(d,{id:"YDzNvf",defaultMessage:"Description"}),description:e.jsx(d,{id:"dpxCw8",defaultMessage:"Short description of what this GPT does"})}),e.jsx(ls,{type:"text",placeholder:R.formatMessage(Z.descriptionPlaceholder),value:(s==null?void 0:s.description)??"",onChange:S=>t({description:S.target.value}),onBlurCapture:()=>t(S=>{var P;return{...S,description:((P=S.description)==null?void 0:P.trim())??""}})}),w.includes(fe.GizmoDescriptionTooLong)?e.jsx(ps,{className:"mt-1",children:e.jsx(d,{...Z.descriptionTooLong,values:{length:Nt}})}):null]}),e.jsxs(ae,{children:[e.jsx(z,{label:e.jsx(d,{id:"2SO0RJ",defaultMessage:"Instructions"}),description:R.formatMessage(Z.instructionsSubtitle)}),e.jsxs("div",{className:"relative",children:[e.jsx(bs,{className:"resize-none",rows:8,value:s==null?void 0:s.instructions,onChange:S=>t({instructions:S.target.value}),onBlurCapture:()=>t(S=>({...S,instructions:S.instructions.trim()})),placeholder:R.formatMessage(Z.instructionsSubtitle)}),e.jsx("button",{className:"absolute bottom-3 right-2 text-token-text-tertiary",onClick:()=>p(!0),children:e.jsx(Sn,{className:"icon-sm"})})]}),w.includes(fe.GizmoInstructionsTooLong)?e.jsx(ps,{className:"mt-1",children:e.jsx(d,{...Z.instructionsTooLong,values:{length:St}})}):null]}),e.jsxs(ae,{children:[e.jsx(z,{label:e.jsx(d,{id:"6rfYOX",defaultMessage:"Conversation starters"}),description:e.jsx(d,{id:"OSOIpd",defaultMessage:"Examples for the user to start the conversation"})}),e.jsx("div",{className:"flex flex-col gap-1",children:j.map((S,P)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(ls,{className:"rounded-r-none",value:S,type:"text",onChange:O=>{const q=O.target.value;t(J=>({...J,promptStarters:Ss(P>=(u.length??0)?[...u??[],q]:u.map((B,V)=>V===P?q===""?void 0:q:B))}))}}),e.jsx("button",{className:"flex h-9 w-9 items-center justify-center rounded-lg rounded-l-none border border-l-0 border-token-border-medium",onClick:()=>t(O=>({...O,promptStarters:u.filter((q,J)=>J!==P)})),children:e.jsx(Pn,{className:"icon-sm"})})]},P))})]}),e.jsxs(ae,{children:[e.jsx(z,{label:e.jsx(d,{id:"bwXSkU",defaultMessage:"Knowledge"}),description:R.formatMessage(Z.knowledgeExplanation)}),e.jsx(ml,{gizmoEditorData:s,requireGizmoId:c,currentModelConfig:a,updateGizmo:t})]}),e.jsxs(ae,{children:[e.jsx(z,{label:e.jsx(d,{id:"mcAwDU",defaultMessage:"Capabilities"}),description:e.jsx(d,{id:"2exQT6",defaultMessage:"Functionality this GPT can use"})}),e.jsx(Kn,{enabledTools:x,onEnabledToolsChange:S=>t({tools:S})})]}),e.jsxs(ae,{children:[e.jsx(z,{label:e.jsx(d,{id:"7r7v+u",defaultMessage:"Actions"}),description:e.jsx(d,{id:"fBln7I",defaultMessage:"APIs this GPT can use"})}),e.jsx(jl,{isDisabled:!!(T&&!I),gizmo:s,onShowActionsEditor:l})]}),!T&&vl(s)&&e.jsxs(ae,{children:[e.jsx(z,{label:e.jsx(d,{id:"R3KeU7",defaultMessage:"Additional Settings"}),collapsed:!!f,onClick:()=>{m(S=>!S)}}),e.jsx(hl,{collapsed:f,initial:!1,children:e.jsx(sn,{className:"mx-3 my-1",labelClassName:"w-full cursor-pointer",label:e.jsx(d,{id:"tZgwFW",defaultMessage:"Use conversation data in your GPT to improve our models"}),id:"improve-chatgpt",checked:!s.trainingDisabled,onChange:()=>{t({trainingDisabled:!s.trainingDisabled})}})})]}),_&&e.jsx(kl,{gizmoEditorData:s,updateGizmo:t}),A&&!G&&e.jsx(fl,{gizmoEditorData:s,updateGizmo:t}),G&&e.jsx(ar,{gizmoEditorData:s,onOpen:g})]}),h&&e.jsx(xl,{text:s.instructions??"",onChange:S=>{t({instructions:S})},onClose:()=>p(!1),placeholder:R.formatMessage(Z.instructionsSubtitle)})]})}const kl=Ee(()=>$e(()=>import("./sso-h0bjpb1so7k1oa5s.js").then(s=>s.G),__vite__mapDeps([4,1,2,3,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95])).then(s=>s.GizmoContactsEditor)),Z=je({nameTooLong:{id:"gizmo.nameTooLong",defaultMessage:"GPT names cannot be longer than {length} characters."},knowledgeExplanation:{id:"gizmo.knowledgeExplanation",defaultMessage:"Additional files for this GPT to reference."},descriptionTooLong:{id:"gizmo.descriptionTooLong",defaultMessage:"GPT descriptions cannot be longer than {length} characters."},instructionsTooLong:{id:"gizmo.instructionsTooLong",defaultMessage:"GPT instructions cannot be longer than {length} characters."},disabledCustomActionsTooltip:{id:"gizmo.disabledCustomActionsTooltip",defaultMessage:"Custom actions are disabled for your workspace. Contact your admin to enable them."},createActionLabel:{id:"gizmo.createActionLabel",defaultMessage:"Create new action"},maxActionsReached:{id:"gizmo.maxActionsReached",defaultMessage:"GPTs can have a maximum of {number} actions"},descriptionPlaceholder:{id:"gizmo.descriptionPlaceholder",defaultMessage:"Add a short description about what this GPT does"},instructionsSubtitle:{id:"gizmo.instructionsSubtitle",defaultMessage:"What does this GPT do? How does it behave? What should it avoid doing?"},gptNamePlaceholder:{id:"gizmo.gptNamePlaceholder",defaultMessage:"Name your GPT"},callbackUrlLabel:{id:"gizmo.callbackUrlLabel",defaultMessage:"Callback URL"}});function wl(s,t){const a=s.response,n=vt(s);if(!Array.isArray(a))return n;const r=Ss(a.map(i=>{if(i.type==="value_error.any_str.max_length")switch(i.loc[1]){case"display":{switch(i.loc[2]){case"name":return t.formatMessage(Z.nameTooLong,{length:i.ctx.limit_value});case"description":return t.formatMessage(Z.descriptionTooLong,{length:i.ctx.limit_value})}break}case"instructions":return t.formatMessage(Z.instructionsTooLong,{length:i.ctx.limit_value})}if(typeof i.msg=="string")return i.msg}));return r.length>0?r.join(`
`):n}function Ml({upsertDraftError:s}){const t=D(),a=wl(s,t);return e.jsxs("div",{className:"flex items-center gap-2 text-red-500",children:[e.jsx("div",{children:e.jsx(d,{...ua.errorSavingDraft})}),a!=null&&e.jsx(Bt,{label:a,children:e.jsx(vs,{className:"icon-sm"})})]})}function Tl({isPublished:s,isSavingDraft:t,hasUnpublishedChanges:a,upsertDraftError:n,className:r}){return n instanceof Ia?e.jsx(Ml,{upsertDraftError:n}):a?e.jsxs("div",{className:ie("flex items-center gap-2",r),children:[e.jsx("span",{className:"text-token-text-secondary",children:s?e.jsx(d,{id:"gizmoEditor.draftUnpublished",defaultMessage:"Unpublished changes"}):e.jsx(d,{id:"gizmoEditor.draftPending",defaultMessage:"Updates pending"})}),e.jsx("div",{className:"w-4 text-token-text-tertiary",children:t&&e.jsx(_s,{})})]}):null}const ua=je({errorSavingDraft:{id:"gizmo.errorSavingDraft",defaultMessage:"Error saving draft"}});function _l({clientThreadId:s}){const t=Ln(s),a=Vt(s),n=Un(s,t),r=[...new Array(n).keys()].map(i=>e.jsx(qn,{isFinalTurn:i===n-1,turnIndex:i,clientThreadId:s,conversationLeafId:t,onChangeItemInView:Ve,onChangeRating:Ve,onRequestMoreCompletions:Ve,onRequestCompletion:Vn,currentModelId:a??""},i));return e.jsx(e.Fragment,{children:r})}function tt({clientThreadIds:s}){return e.jsx(e.Fragment,{children:s.map(t=>e.jsx(_l,{clientThreadId:t},t))})}const Nl=Ee(()=>$e(()=>import("./omeo039438yfi8ye.js"),__vite__mapDeps([96,1,2,3,19,6,7,18,26,39,71,29,30,31,32,33,84,46,47,36,37,38,40,41,42,43,25,44,45,48,49,50,51,16,52,53,54,55,56,57,58,8,14,59,21])).then(s=>s.DebugConversationSidebar));function at(){return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"border-token-border-secondary flex-grow border-b"}),e.jsxs("div",{className:"flex flex-shrink-0 items-center gap-2 px-2 py-6 text-sm text-token-text-tertiary",children:[e.jsx(In,{className:"icon-sm"}),e.jsx(d,{id:"qtaMEG",defaultMessage:"GPT updated"})]}),e.jsx("div",{className:"border-token-border-secondary flex-grow border-b"})]})}var Sl=(s=>(s.TestGizmoAction="test_gizmo_action",s))(Sl||{});const Pl=new nn;function Cl({gizmoEditorData:s,isSavingDraft:t,currentModelConfig:a,showTitle:n=!0}){var w;const[r,i]=v.useState(()=>Xe()),[o,c]=v.useState([]);v.useEffect(()=>{c(b=>b[b.length-1]===r?b:[...b,r])},[r]);const l=o.slice(0,-1);Zt(r,{kind:_e.GizmoTest,gizmo_id:s.id}),v.useEffect(()=>{E.updateConversationMode(r,{kind:_e.GizmoTest,gizmo_id:s.id})},[r,s.id]);const g=(w=s.files)==null?void 0:w.map(b=>b.file_id).join();v.useEffect(()=>{E.getServerThreadId(r)!=null&&i(Xe())},[s.id,s.instructions,s.tools,g,r]);const x=Ft(b=>b.activeSidebar),h=v.useMemo(()=>({gizmoEditorData:s,mode:"test"}),[s]),[p,f]=v.useState(0),m=()=>{f(b=>b-360)},u=s.id,j=Il(r,a);return v.useEffect(()=>Aa(Pl,{test_gizmo_action:({rootDomain:b,operationName:T})=>{u&&j(u,b,T)}}),[j,u]),e.jsx(Et.Provider,{value:h,children:e.jsxs("div",{className:ie("flex h-full w-full",t&&"cursor-wait opacity-80 transition"),children:[e.jsxs("div",{className:"flex grow flex-col",children:[e.jsx("div",{className:"relative mb-2 flex-shrink-0",children:e.jsx("div",{className:"flex justify-center py-1",children:n&&e.jsxs("div",{className:"group flex items-center gap-2 text-lg font-semibold",children:[e.jsx("div",{className:"icon-md"}),e.jsxs("button",{onClick:()=>{m(),c([]),i(Xe())},className:"flex items-center gap-2",children:[e.jsx(d,{id:"2u/6Ja",defaultMessage:"Preview"}),e.jsx(Dt.div,{className:"text-token-text-primary",animate:{rotate:p},transition:{duration:.3},children:e.jsx(Cn,{className:"icon-md invisible group-hover:visible"})})]})]})})}),e.jsx("div",{className:ie("relative grow overflow-auto px-2",t&&"pointer-events-none"),children:e.jsx(zt,{clientThreadId:r,hideHeader:!0,renderEmptyState:e.jsxs("div",{className:"relative h-full w-full",children:[l!=null&&l.length>0&&e.jsx("div",{className:"h-full w-full opacity-20",children:e.jsxs(Hn,{children:[e.jsx(tt,{clientThreadIds:l}),e.jsx(at,{})]})}),e.jsx("div",{className:"absolute left-0 top-0 h-full w-full",children:e.jsx(Yn,{gizmo:s,hideOwner:!0,showStarterPrompts:!0})})]}),prependThreadChildren:l.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"opacity-50",children:e.jsx(tt,{clientThreadIds:l})}),e.jsx(at,{})]})})})]}),x==="debug"&&e.jsx(Nl,{clientThreadId:r,slideOver:!1,onClose:()=>Oe.toggleActiveSidebar("debug"),isOpen:!0})]})})}const nt=yt.memo(Cl);function Il(s,t){const a=ea({clientThreadId:s});return v.useCallback(async(r,i,o)=>{if(!t)return;const c=new $t,l=E.getThreadCurrentLeafId(s),g=Re(),x=rn(i);E.updateTree(s,j=>{j.addNodeToEnd(l,{id:g,children:[],parentId:l,message:{id:g,author:{role:pe.User},content:{content_type:La.Text,parts:[`Call the ${i} API with the ${o} operation`]},recipient:"all",metadata:{jit_plugin_data:{from_client:{type:"test",operation:o,tool_name:x}}}}})});const h={conversationMode:{kind:_e.GizmoTest,gizmo_id:r}},p=await bt(),[f,m,u]=await Promise.all([kt.getEnforcementToken(p),Wt.getEnforcementToken(p),wt.getEnforcementToken(p)]);a({model:t.id,completionType:Mt.Next,parentNodeId:g,metadata:{},focusOnNewCompletion:!0,chatReq:p,arkoseToken:f,turnstileToken:m,proofToken:u,preflightTime:0,completionMetadata:h,turnTracker:c})},[s,a,t])}function Al(s,t){const a=E.getThreadCurrentLeafId(s),n=E.getTree(s),r=[];let i=n.getNodeByIdOrMessageId(a);for(;i!=null&&(t==null||i.id!==t);)r.unshift(i.message),i=i.parentId!==""?n.getNodeByIdOrMessageId(i.parentId):void 0;return r}function Ll(s){return s.filter(n=>n.recipient==="gizmo_editor.update_behavior").flatMap(n=>n.content.content_type==="text"?n.content.parts:n.content.content_type==="code"?[n.content.text]:[]).map(n=>JSON.parse(n)).reduce((n,r)=>({...n,...r}),{})}async function Ul(s){let t;for(const a of s)if(a.author.name==="gizmo_editor.generate_profile_pic"){const n=Ra.getImageAssetPointers(a);n.length>0&&(t=n.at(-1))}if(t!=null){const a=on(t.asset_pointer),n=await We.getFileDownloadLink(a);if(n.status===Ns.Success)return{id:a,permalink:n.download_url}}}async function Rl(s,t,a,n){const r=Al(t,n),i=Ll(r);let o=await Ul(r);if(ks(i)&&o==null)return;const{name:c,context:l,description:g,profile_pic_file_id:x,prompt_starters:h}=i;if(x!=null)try{const f=await We.getFileDownloadLink(x,s.id);f.status===Ns.Success&&(o={id:x,permalink:f.download_url})}catch(f){gs.addError(new Error("Error while retrieving profile pic in update",{cause:f})),a.warning("Something went wrong updating your GPT's profile picture.",{duration:3})}const p={name:typeof c=="string"?c:void 0,description:typeof g=="string"?g:void 0,instructions:typeof l=="string"?l:void 0,promptStarters:Array.isArray(h)?h:void 0,profilePictureId:o==null?void 0:o.id,profilePictureUrl:o==null?void 0:o.permalink};return Ua(p,f=>f!=null)}function Gl(s){const t=new Set;for(const l of s.tools)t.add(l.type);const a=s.name??"",n=s.description??"",r=s.instructions??"",i=Array.from(t).join(","),o=a===""&&n===""&&r==="",c=s.profilePictureUrl!=null;return o?`The GPT you are about to has the following abilities: ${i}.`:`This is the GPT's current set of fields:

name: ${a}

description: ${n}

context: ${r}

abilities: ${i}

${c?"The GPT has a profile picture.":"This GPT does not have a profile picture. You must generate a profile picture when you next update your behavior."}
`}function pa(s,t,a,n){var p,f;const r=a.current,i=n.current;if(we(r,i))return;const o={};r.name!==(i==null?void 0:i.name)&&(o.name=r.name),(r.description??"")!==((i==null?void 0:i.description)??"")&&(o.description=r.description??""),r.instructions!==((i==null?void 0:i.instructions)??"")&&(o.context=r.instructions??"");const c=new Set(((p=i==null?void 0:i.files)==null?void 0:p.map(m=>m.file_id))??[]),l=new Set(((f=r.files)==null?void 0:f.map(m=>m.file_id))??[]),g=(r.files??[]).filter(m=>!c.has(m.file_id)),x=((i==null?void 0:i.files)??[]).filter(m=>!l.has(m.file_id));if(ks(o)&&g.length===0&&x.length===0)return;const h=[];if(!ks(o)){const m=`Explicitly update the GPT's behavior to the following exact fields:

    ${JSON.stringify(o,null,2)}

    "Do not call update_behavior yet. Instead, use these updated fields as the GPT's current behavior, and in the next call to update_behavior, incorporate these changes."
    `;h.push(Ae.getTextAsMessage(m,pe.System))}x.length>0&&h.push(Ae.getTextAsMessage(`The user has removed the following files from the GPT. You can no longer reference these files: ${x.map(m=>m.file_id).join(", ")}`,pe.System)),g.length>0&&h.push(Ae.getTextAsMessage(`The user is adding these files to the GPT. The GPT may reference these files. The file IDs are: ${g.map(m=>m.file_id).join(", ")}`,pe.System,{attachments:g.map(m=>({id:m.file_id,name:m.name,size:m.size}))})),h.length>0&&E.updateTree(s,m=>{let u=m.getNodeByIdOrMessageId(t).parentId;for(const j of h){const w=Re();m.insertNodeBefore(t,{id:w,children:[],parentId:u,message:j,metadata:{isClientCreatedSystemMessage:!0}}),u=w}})}function Ol(s,t,a){if(a.length===0)return;const n=Re(),r=`The user is uploading files in their next message. If you need to reference these in calls to update_behavior, you will use the following File ID(s), in order: ${a.map(i=>`"${i.fileId}"`).join(", ")}`;E.updateTree(s,i=>{const o=i.getNodeByIdOrMessageId(t).parentId;i.insertNodeBefore(t,{id:n,children:[],parentId:o,message:Ae.getTextAsMessage(r,pe.System),metadata:{isClientCreatedSystemMessage:!0}})})}function Bl(s,t){const a="Remember, you should be calling either update_behavior or generate_profile_pic after most messages from the user. Your personality should be neutral and separate from the GPT you are creating.",n=E.getThreadCurrentLeafId(s),r=E.getTree(s);let i=r.getNodeByIdOrMessageId(n);for(;i!=null&&i.message.author.role!==pe.User;){if(i.message.content.content_type==="text"&&i.message.content.parts[0]===a)return;i=i.parentId!==""?r.getNodeByIdOrMessageId(i.parentId):void 0}E.updateTree(s,o=>{const c=o.getNodeByIdOrMessageId(t).parentId;o.insertNodeBefore(t,{id:Re(),children:[],parentId:c,message:Ae.getTextAsMessage(a,pe.System,{exclude_after_next_user_message:!0}),metadata:{isClientCreatedSystemMessage:!0}})})}function Fl(s,t,a){E.initThread(s,{kind:_e.GizmoMagicCreate,gizmo_id:void 0,behavior_overrides:a});const r=pn().id,i=Vt(s)??r,o=ea({clientThreadId:s,onCompletionFinished:t});return async(l,g,x)=>{if(x.length===0)return;const h=new $t;let p=E.getThreadCurrentLeafId(s);for(const T of x){const I=Re();E.updateTree(s,R=>{R.addNodeToEnd(p,{id:I,children:[],parentId:p,message:Ae.getTextAsMessage(T,pe.System),metadata:{isClientCreatedSystemMessage:!0}})}),E.setThreadCurrentLeafId(s,I),p=I}const f=p;pa(s,f,l,g);const m={conversationMode:{kind:_e.GizmoMagicCreate,gizmo_id:l.current.id,behavior_overrides:a}},u=await bt(),[j,w,b]=await Promise.all([kt.getEnforcementToken(u),Wt.getEnforcementToken(u),wt.getEnforcementToken(u)]);o({model:i,completionType:Mt.Next,parentNodeId:f,metadata:{},focusOnNewCompletion:!0,chatReq:u,arkoseToken:j,turnstileToken:w,proofToken:b,preflightTime:0,completionMetadata:m,turnTracker:h})}}const El="Generate a new profile picture for this GPT using gizmo_editor generate_profile_pic. Do not prompt the user for any clarification. Do not send extra text outside of the tool function call. DO NOT CALL update_behavior or otherwise update GPT behavior in your response.",$l=Ee(()=>$e(()=>import("./omeo039438yfi8ye.js"),__vite__mapDeps([96,1,2,3,19,6,7,18,26,39,71,29,30,31,32,33,84,46,47,36,37,38,40,41,42,43,25,44,45,48,49,50,51,16,52,53,54,55,56,57,58,8,14,59,21])).then(s=>s.DebugConversationSidebar));function Wl(s,t){v.useEffect(()=>{const a=E.getTree(s);if(a.findNode(o=>{var c;return o.message.author.role===pe.User||((c=o.metadata)==null?void 0:c.isClientCreatedSystemMessage)===!0})||(E.deleteNodesByFilter(s,o=>{var c;return((c=o.metadata)==null?void 0:c.isPlaceholderTemplateAssistantWelcomeMessage)===!0}),t==null||t.length===0))return;const r=E.getThreadCurrentLeafId(s);if(!a.hasNodeOrMessageId(r))return;const i=Re();E.updateTree(s,o=>{o.addNode(i,t,r,pe.Assistant,{isPlaceholderTemplateAssistantWelcomeMessage:!0})}),E.setThreadCurrentLeafId(s,i)},[s,t])}function ql(s,t,a){Zt(s,{kind:_e.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:a}),v.useEffect(()=>{E.updateConversationMode(s,{kind:_e.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:a})},[s,t.id,a]);const[n]=v.useState(()=>{const r=t.id==null,i=t.id!=null&&t.name!==""&&t.description!=null&&t.instructions!==""&&t.profilePictureUrl!=null;return r?`Hi! I'll help you build a new GPT. You can say something like, "make a creative who helps generate visuals for new products" or "make a software engineer who helps format my code."

What would you like to make?`:i?`Welcome back! Is there anything ${t.name} should be doing better? Anything you'd like to change?`:"You're back! Let's continue where we left off..."});Wl(s,n)}function Hl({gizmoEditorData:s,updateGizmo:t,clientThreadId:a,completionCallbackResponse:n,gizmoEditorDataRef:r,magicMakerBehaviorOverrides:i,magicMakerConversationGizmoEditorDataRef:o,requireGizmoId:c}){const l=v.useMemo(()=>({gizmoEditorData:s,gizmoId:s.id,mode:"magic",behaviorOverrides:i,getGizmoId:c}),[c,s,i]),g=ln(p=>p.files.filter(f=>f.status===ne.Ready&&f.gizmoId!=null)),x=v.useCallback((p,f)=>{Ol(p,f,g),pa(p,f,r,o),Bl(p,f),t(m=>({...m,files:[...m.files??[],...Ss(g.map(u=>{var j;return u.fileId!=null&&{file_id:u.fileId,name:u.file.name,size:u.file.size,type:u.file.type,last_modified:u.file.lastModified,file_size_tokens:(j=u.fileSpec)==null?void 0:j.fileTokenSize}}))]})),o.current=Ce(r.current)},[r,o,g,t]),h=Ft(p=>p.activeSidebar);return e.jsx(Et.Provider,{value:l,children:e.jsxs("div",{className:"relative flex h-full grow overflow-auto",children:[e.jsx("div",{className:"grow",children:e.jsx(zt,{clientThreadId:a,onCompletionFinished:n,preRequestCompletion:x,hideHeader:!0,prependThreadChildren:e.jsx("div",{className:"h-8"})})}),h==="debug"&&e.jsx($l,{clientThreadId:a,slideOver:!1,onClose:()=>Oe.toggleActiveSidebar("debug"),isOpen:!0})]})})}const Kl=yt.memo(Hl),Vl=Ee(()=>$e(()=>import("./j9kstrq83clvs26y.js"),__vite__mapDeps([97,1,2,3,6,7,98,99,71,26,19,18,65,45,25,100,50,101,16,8,51,37,38,39,46,47,36,40,41,42,43,44,48,49,52,53,54,55,56,57,58,14,59,21,102,103,104])).then(s=>s.GizmoActionsEditor));var fa=(s=>(s.MAGIC_MAKER="magic",s.ADVANCED="advanced",s.PREVIEW="preview",s))(fa||{});function fs({value:s,label:t}){return e.jsx(Lt,{value:s,className:"text-md w-1/3 flex-grow rounded-lg border-token-border-light p-1.5 font-semibold text-token-text-tertiary transition hover:text-token-text-primary radix-state-checked:border radix-state-checked:bg-token-main-surface-primary radix-state-checked:text-token-text-primary radix-state-checked:shadow-[0_0_2px_rgba(0,0,0,.03)] md:w-1/2",children:t})}function Yl({className:s,editorTab:t,setEditorTab:a}){const n=D();return e.jsxs(At,{className:ie("flex w-full overflow-hidden rounded-xl bg-token-main-surface-secondary p-1.5 md:w-1/2",s),value:t,onValueChange:r=>{a(r)},children:[e.jsx(fs,{value:"magic",label:n.formatMessage(ms.magicMakerLabel)}),e.jsx(fs,{value:"advanced",label:n.formatMessage(ms.configureLabel)}),e.jsx("div",{className:"flex w-1/3 md:hidden",children:e.jsx(fs,{value:"preview",label:n.formatMessage(ms.previewLabel)})})]})}function Ql(s,t){return s.length!==t.length?!1:s.every(a=>t.some(n=>n.type===a.type))}function Xl(s,t){var a,n;return s.name===t.gizmo.display.name&&s.description===t.gizmo.display.description&&s.instructions===t.gizmo.instructions&&Ql(s.tools,t.tools)&&we(((a=s.files)==null?void 0:a.map(r=>r.file_id))??[],((n=t.files)==null?void 0:n.map(r=>r.file_id))??[])&&s.profilePictureUrl==t.gizmo.display.profile_picture_url&&s.profilePictureId==t.gizmo.display.profile_pic_id}const Ms={id:void 0,instructions:"",name:"",description:"",profilePictureId:void 0,profilePictureUrl:void 0,promptStarters:[],sharing:{recipient:y.Private,subjects:[]},tools:[{type:X.DALLE}],files:[],trainingDisabled:!1,liveVersion:0},Jl={...Ms,tools:[...Ms.tools,{type:X.BROWSER}]};function rt(s){return{id:s.gizmo.id,instructions:s.gizmo.instructions,name:s.gizmo.display.name,description:s.gizmo.display.description??"",profilePictureId:s.gizmo.display.profile_pic_id??void 0,profilePictureUrl:s.gizmo.display.profile_picture_url??void 0,promptStarters:s.gizmo.display.prompt_starters??[],tools:Ce(s.tools),files:Ce(s.files),sharing:s.gizmo.sharing?Ce(s.gizmo.sharing):{subjects:[],recipient:s.gizmo.share_recipient},trainingDisabled:s.gizmo.training_disabled??!1,sharingRecipient:s.gizmo.share_recipient,sharingTargets:Ce(s.gizmo.sharing_targets),liveVersion:s.gizmo.live_version??0}}const ma=({gizmo:s,onNewGizmoId:t})=>{const a=Fe(),n=Ot(jt.BrowsingAvailable),r=D(),i=me(),o=v.useRef(s!=null?rt(s):n?Jl:Ms),c=v.useRef(s),l=v.useRef(o.current),[g,x]=v.useState(()=>o.current),[h,p]=v.useState(()=>Xe()),[f]=v.useState(()=>({context_message:Gl(o.current),model_slug:"unused",enabled_tools:[{tool_id:s!=null?"gizmo_editor":"gizmo_creator"}]}));ql(h,l.current,f);const{data:m}=mn(),u=(m==null?void 0:m.modelsList.find(M=>M.tags.includes(Oa.GPT_4)))??(m==null?void 0:m.modelsList.find(M=>M.id===gn)),{data:j}=qt(o.current.id),w=xn(),{isPending:b,error:T}=w,I=hn(),R=v.useMemo(()=>j!=null&&!Xl(g,j),[g,j]),_=async()=>{const M=o.current;try{const C=await w.mutateAsync({editorData:M,gizmoId:M.id});if(c.current=C,o.current.id==null){const Y=C.gizmo.id;o.current={...o.current,id:Y,sharingTargets:C.gizmo.sharing_targets},x(o.current),t==null||t(Y)}for(const Y of C.tools.filter(ce=>ce.type===X.JIT_PLUGIN)){const ce=o.current.tools.find(be=>be.type===X.JIT_PLUGIN&&be.metadata.domain===Y.metadata.domain);ce&&ce.metadata.action_id!==Y.metadata.action_id&&(ce.metadata={...ce.metadata,action_id:Y.metadata.action_id},x(o.current))}return C}catch(C){const Y=vt(C)??r.formatMessage(ua.errorSavingDraft);throw i.warning(Y,{duration:2}),C}},A=v.useRef(),G=async()=>o.current.id!=null?o.current.id:(A.current==null&&(A.current=_().then(M=>M.gizmo.id).catch(M=>{throw A.current=void 0,M})),A.current),[S]=v.useState(()=>dn(()=>_(),2e3,{trailing:!0}));function P(M,C=!0){const Y=typeof M=="function"?M(o.current):Ko(o.current,M);we(Y,o.current)||(o.current=Y,x(o.current),C&&S())}const O=v.useRef(),q=async M=>{if(M==null){H(!1);return}try{const C=await Rl(o.current,M,i,O.current);C!=null&&(P(C),l.current=Ce(o.current))}catch(C){gs.addError(C),i.warning("Something went wrong generating your GPT",{duration:3})}finally{O.current=E.getThreadCurrentLeafId(M),H(!1)}},J=Fl(h,q,f),[B,V]=v.useState(void 0);v.useEffect(()=>{V(Xn(s))},[s==null?void 0:s.gizmo.id]);const F=async(M,C)=>{const Y=He(o.current,M.recipient,C);if(Y.length>0){i.warning(`Could not save GPT:

${Y.map(Se=>`- ${ws(Se)}`).join(`
`)}`,{duration:3});return}const ce=await _(),be=ce.gizmo.id;try{return xt.logEvent(ht.promoteGizmo,{gizmo_id:ce.gizmo.id,sharing_recipient:M.recipient,editor_tab:se}),await I.mutateAsync({gizmoId:ce.gizmo.id,data:{sharingSubjects:M.subjects,sharingRecipient:M.recipient,categories:C==null?void 0:[C]}},{onSuccess(ga){a.setQueryData($s(a,be).queryKey,ga),a.invalidateQueries({queryKey:["gizmos"]}),a.invalidateQueries({queryKey:["gizmo",{gizmoId:be}]}),a.invalidateQueries({queryKey:["gizmo","userActionSettings",{gizmoId:be}]})}})}catch(Se){Se instanceof un?V({gizmoId:be,sharingRecipient:M.recipient,moderationType:as.PublishBlocked,sharingTargets:Se.response.sharing_targets,showModal:Me.AppealAvailable}):(gs.addError(Se),i.warning("Error saving GPT",{duration:2}))}},ve=w.isPending||I.isPending,[se,ge]=v.useState(()=>{const M=Rs.getItem(Gs.GizmoEditorTab);return Object.values(fa).includes(M)?M:"magic"}),xe=Ba.useState(({windowWidth:M})=>M);v.useEffect(()=>{xe!=null&&xe>=768&&se==="preview"&&ge("magic")},[xe,se]);const[Ne,ye]=v.useState(!1),[N,H]=v.useState(!1),[k,L]=v.useState(void 0),[te,le]=v.useState(!1);return e.jsxs("div",{className:"flex h-screen w-full flex-col items-center",children:[e.jsx(cl,{gizmoEditorData:g,isLoading:ve,hasUnpublishedChanges:R,isUploadingProfilePic:Ne,isGeneratingProfilePic:N,publishedGizmo:j,updateGizmo:P,promoteGizmo:async(M,C)=>{const Y=await F(M,C);return o.current={...o.current,sharingRecipient:M.recipient},x(o.current),Rs.setItem(Gs.GizmoEditorTab,se),Y},appealGizmo:async(M,C)=>{B!=null&&V({...B,sharingRecipient:M,categories:C==null?void 0:[C],showModal:Me.AppealAvailable})},setAppealState:V,revertDraft:j!=null&&R?()=>{const M=a.getQueryData($s(a,o.current.id).queryKey);if(M!=null){const C=rt(M);o.current=C,x(C),_()}}:void 0,draftMessage:e.jsx(Tl,{isPublished:j!=null&&(j.gizmo.share_recipient==="marketplace"||j.gizmo.share_recipient==="workspace"),hasUnpublishedChanges:R,isSavingDraft:b,upsertDraftError:T,className:"text-sm"}),showActionsModal:M=>{L(M)},className:"flex-shrink-0"}),B&&e.jsx(tr,{appealState:B,onAppealClose:()=>V({...B,showModal:Me.None}),onAppealSubmitted:()=>V({...B,showModal:Me.AppealSent})}),e.jsxs("div",{className:"relative flex w-full grow overflow-hidden",children:[e.jsx("div",{className:"flex w-full justify-center md:w-1/2",children:e.jsx("div",{className:"h-full grow overflow-hidden",children:k!==void 0?e.jsx(Vl,{currentlyEditingActionDomain:k,gizmoEditorData:g,updateGizmo:P,onClose:()=>{L(void 0)}}):te?e.jsx(nr,{gizmoEditorData:g,updateGizmo:P,onClose:()=>{le(!1)}}):e.jsxs("div",{className:"flex h-full flex-col px-2 pt-2",children:[e.jsx("div",{className:"flex w-full flex-row justify-center",children:e.jsx(Yl,{editorTab:se,setEditorTab:ge,className:"mb-2 flex-shrink-0 self-center"})}),e.jsx("div",{className:"grow overflow-hidden",children:se==="magic"?e.jsx("div",{className:"h-full w-full pb-5",children:e.jsx(Kl,{gizmoEditorData:g,updateGizmo:P,completionCallbackResponse:q,clientThreadId:h,gizmoEditorDataRef:o,magicMakerBehaviorOverrides:f,magicMakerConversationGizmoEditorDataRef:l,requireGizmoId:G},h)}):se==="advanced"?e.jsx(bl,{gizmoEditorData:g,updateGizmo:P,currentModelConfig:u,generateProfilePic:()=>{H(!0),J(o,l,[El])},setIsUploadingProfilePic:ye,isGeneratingProfilePic:N,setIsGeneratingProfilePic:H,requireGizmoId:G,onShowActionsEditor:M=>{L(M)},onShowBlocksEditor:()=>{le(!0)}}):e.jsx(nt,{gizmoEditorData:g,currentModelConfig:u,isSavingDraft:b,showTitle:!1})})]})})}),e.jsx("div",{className:ie("hidden w-1/2 justify-center border-l border-token-border-medium bg-token-main-surface-secondary pt-4",se!=="preview"&&"md:flex"),children:e.jsx("div",{className:"flex-grow pb-5",children:e.jsx("div",{className:"h-full",children:e.jsx(nt,{gizmoEditorData:g,currentModelConfig:u,isSavingDraft:b})})})})]})]})};function Zl({gizmoId:s,version:t}){const{data:a}=fn({gizmoId:s,draft:!0,version:t}),n=ze(It.accountUserId),r=Pt(),i=r==null?void 0:r.id,o=a!=null&&n!=null&&i!=null&&cn(a);return a!=null&&o?e.jsx(ma,{gizmo:a}):null}function zl({onNewGizmoId:s}){return e.jsx(ma,{gizmo:void 0,onNewGizmoId:s})}function bc({gizmoId:s,remixSourceId:t,version:a}){const n=Ga(),r=Ue(),i=v.useRef(void 0);v.useEffect(()=>(Oe.enterGizmoEditor(),()=>{Oe.exitGizmoEditor()}),[]);let o=s;return s!=null&&i.current===s&&(o=void 0),Rn({resetThreadAction:()=>{n.push("/")}}),e.jsx("div",{children:r!=null&&r.data?e.jsx("div",{children:o!=null?e.jsx(Zl,{gizmoId:o,version:a},o):e.jsx(zl,{remixSourceId:t,onNewGizmoId:c=>{i.current=c,window.history.replaceState(window.history.state,"",On(c))}})}):e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx(_s,{})})})}const ms=je({magicMakerLabel:{id:"gizmo.magicMakerLabel",defaultMessage:"Create"},configureLabel:{id:"gizmo.advancedLabel",defaultMessage:"Configure"},previewLabel:{id:"gizmo.previewLabel",defaultMessage:"Preview"}});export{bc as G,Zo as S,Pl as a,Sl as b,rt as c};
//# sourceMappingURL=t2a12r4ays9gq0xp.js.map
