import{b as f,K as m}from"./dnclpnvevlt4w60m.js";import{c8 as p,T as g,eA as v}from"./ofly9yrztlesgrye.js";import{d2 as w}from"./nqzijea2w2642vxo.js";function M(r={}){return new f({view(t){return new C(t,r)}})}class C{constructor(t,e){var i;this.editorView=t,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(i=e.width)!==null&&i!==void 0?i:1,this.color=e.color===!1?void 0:e.color||"black",this.class=e.class,this.handlers=["dragover","dragend","drop","dragleave"].map(s=>{let n=l=>{this[s](l)};return t.dom.addEventListener(s,n),{name:s,handler:n}})}destroy(){this.handlers.forEach(({name:t,handler:e})=>this.editorView.dom.removeEventListener(t,e))}update(t,e){this.cursorPos!=null&&e.doc!=t.state.doc&&(this.cursorPos>t.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(t){t!=this.cursorPos&&(this.cursorPos=t,t==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let t=this.editorView.state.doc.resolve(this.cursorPos),e=!t.parent.inlineContent,i;if(e){let o=t.nodeBefore,c=t.nodeAfter;if(o||c){let u=this.editorView.nodeDOM(this.cursorPos-(o?o.nodeSize:0));if(u){let d=u.getBoundingClientRect(),h=o?d.bottom:d.top;o&&c&&(h=(h+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),i={left:d.left,right:d.right,top:h-this.width/2,bottom:h+this.width/2}}}}if(!i){let o=this.editorView.coordsAtPos(this.cursorPos);i={left:o.left-this.width/2,right:o.left+this.width/2,top:o.top,bottom:o.bottom}}let s=this.editorView.dom.offsetParent;this.element||(this.element=s.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",e),this.element.classList.toggle("prosemirror-dropcursor-inline",!e);let n,l;if(!s||s==document.body&&getComputedStyle(s).position=="static")n=-pageXOffset,l=-pageYOffset;else{let o=s.getBoundingClientRect();n=o.left-s.scrollLeft,l=o.top-s.scrollTop}this.element.style.left=i.left-n+"px",this.element.style.top=i.top-l+"px",this.element.style.width=i.right-i.left+"px",this.element.style.height=i.bottom-i.top+"px"}scheduleRemoval(t){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),t)}dragover(t){if(!this.editorView.editable)return;let e=this.editorView.posAtCoords({left:t.clientX,top:t.clientY}),i=e&&e.inside>=0&&this.editorView.state.doc.nodeAt(e.inside),s=i&&i.type.spec.disableDropCursor,n=typeof s=="function"?s(this.editorView,e,t):s;if(e&&!n){let l=e.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let o=m(this.editorView.state.doc,l,this.editorView.dragging.slice);o!=null&&(l=o)}this.setCursor(l),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(t){(t.target==this.editorView.dom||!this.editorView.dom.contains(t.relatedTarget))&&this.setCursor(null)}}var b=p;function y(r){return typeof r=="function"?r:b}var V=y,P=v,R=V,T=w,A=9007199254740991,a=4294967295,_=Math.min;function x(r,t){if(r=T(r),r<1||r>A)return[];var e=a,i=_(r,a);t=R(t),r-=a;for(var s=P(i,t);++e<r;)t(e);return s}var E=x;const B=g(E);export{M as d,B as t};
