import{r as S,j as x,c1 as b,cB as z,bZ as A,dX as C,bF as G}from"./ofly9yrztlesgrye.js";import{u as E}from"./c4wbs9sfbozms9h9.js";import{a as I}from"./pdyd96jvf5nj4arp.js";import{j as N,T as h}from"./hgskjx43egewob6w.js";import"./pbk6784aea0pnvmy.js";import"./nqzijea2w2642vxo.js";import"./d4ayzlfdvw3mppxq.js";import"./eni5d61fsksdl3xv.js";import"./lj5rtlp3i0cfoffa.js";function U({messages:a,clientThreadId:i,isLastTurnInConversation:l,onRequestCompletion:n}){var u,g,y;const[m,...t]=a,d=N(),e=(y=(g=(u=t.find(o=>{var s,r,c;return((c=(r=(s=o.message.metadata)==null?void 0:s.jit_plugin_data)==null?void 0:r.from_server)==null?void 0:c.type)==="confirm_action"}))==null?void 0:u.message.metadata)==null?void 0:g.jit_plugin_data)==null?void 0:y.from_server,T=(e==null?void 0:e.body.actions[0].type)==="contact_gizmo"?e==null?void 0:e.body.actions[0].contact_gizmo.gizmo_id:void 0,{data:_}=E(T),p=l&&t[t.length-1];return S.useEffect(()=>{var s,r,c,v,j;if(d||!p||((c=(r=(s=p.message.metadata)==null?void 0:s.jit_plugin_data)==null?void 0:r.from_server)==null?void 0:c.type)!=="confirm_action")return;const o=(j=(v=p.message.metadata)==null?void 0:v.jit_plugin_data)==null?void 0:j.from_server;if((o==null?void 0:o.type)==="confirm_action"){const f=o.body.actions.find(M=>M.type==="contact_gizmo");f&&f.type==="contact_gizmo"&&R({allMessages:a,assistantMessage:m,clientThreadId:i,onRequestCompletion:n,actionData:{type:"contact_gizmo",...f.contact_gizmo}})}},[d,p,n,a,m,i]),x.jsx("div",{className:"my-2 flex flex-col",children:_&&x.jsx(I,{gizmoResource:_})})}function R({actionData:a,allMessages:i,assistantMessage:l,clientThreadId:n,onRequestCompletion:m}){const t={id:b(),author:{role:z.Tool,name:l.message.recipient},content:{content_type:A.Text,parts:[""]},recipient:"all",metadata:{jit_plugin_data:{from_client:a}}};h.updateTree(n,d=>{d.addNode(t.id,t,i[i.length-1].message.id,z.Tool,{completionSampleFinishTime:Date.now()})}),h.setThreadCurrentLeafId(n,t.id),m({type:C.Next,promptId:t.id,eventMetadata:{eventSource:"mouse"},cancelActiveRequests:!1,completionMetadata:{conversationMode:{kind:G.PrimaryAssistant}}})}export{U as GizmoContactsMessage};
