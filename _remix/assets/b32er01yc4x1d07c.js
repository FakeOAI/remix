import{j as e,cC as I,G as m,D as y,a3 as C,c9 as M,bl as _,T as R,I as x,r as f,x as h,c as S,P as T,E as A,bc as D,H as E}from"./k9l0508ak3e7lzcr.js";import{B as L,q as F,C as P,g as p}from"./d6iedxuu7mbdrnme.js";import{g as k}from"./kqwdyvkaaavvn8k3.js";import{u as w}from"./fls8d6sejczdccck.js";import{bn as z,bm as U,fw as q,fx as B,bx as G,av as O,aw as H,fy as V,fz as d,fA as b,A as Q}from"./96tandeuiw92jgym.js";import{aO as $}from"./hb601xkanolcuyaq.js";import{F as Y}from"./kvbhg5pv4kjda3of.js";import{S as Z,a as J}from"./oin19n491t9dujgw.js";import{m as g}from"./m5r2yh58ny5yc24l.js";import"./ig7iznl8s7o1ddbr.js";import"./o2j7zoei5cim6ka2.js";function N({children:t}){return e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 text-sm font-semibold text-token-text-tertiary",children:[e.jsx($,{className:"icon-2xl"}),t]})})}const K=({images:t,turnIndex:s})=>{const r=t.map(n=>n.thumbnail_url),a=I({queries:r.map(n=>L(n)),combine:n=>{const o=new Set;return n.forEach((l,i)=>{l.isError&&o.add(r[i])}),o}});return e.jsx(e.Fragment,{children:(t==null?void 0:t.length)>0?e.jsx("div",{className:"columns-1 gap-2 px-6 py-4 sm:columns-2 md:columns-3",children:t.map((n,o)=>!a.has(n.thumbnail_url)&&e.jsx("div",{className:"relative mb-0.5 break-inside-avoid",children:e.jsx(W,{image:n,turnIndex:s})},o))}):e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(N,{children:e.jsx(m,{id:"AbVGAw",defaultMessage:"No Results"})})})})},W=({image:t,turnIndex:s})=>{const r=w(t.url).data??k(t.url,"short"),{isSuccess:a}=F(t==null?void 0:t.thumbnail_url);return e.jsx("button",{onClick:()=>{z.setCurrentImage(t?{image:t,source:U.ImagesTab,turnIndex:s}:void 0)},children:a?e.jsxs("div",{className:"group relative h-full w-full",children:[e.jsx("img",{src:t.thumbnail_url,alt:t.content_url,className:"w-full rounded-xl hover:opacity-100 group-hover:opacity-90"}),e.jsx("div",{className:"absolute bottom-1 left-1 rounded-xl bg-black/40 px-2 py-1 text-xs font-medium text-white backdrop-blur-sm",children:r})]}):e.jsx("div",{className:"aspect-square h-full w-full animate-pulse bg-token-main-surface-tertiary"})})};function X({date:t}){const s=y(),r=t instanceof Date?t:new Date(t*1e3),a=q(r,new Date);if(a<4&&a>-4){const n=s.formatRelativeTime(a,"day",{numeric:"auto"});return n.charAt(0).toUpperCase()+n.slice(1)}else return s.formatDate(r,{year:"numeric",month:"long",day:"numeric"})}var ee=M,te=C,se=B,ae=_;function re(t,s){var r=ae(t)?ee:se;return r(t,te(s))}var ne=re,oe=G,le=ne;function ie(t,s){return oe(le(t,s),1)}var ce=ie;const ue=R(ce);function de({citations:t,searchResults:s,turnIndex:r}){if(t.length===0&&s.length===0)return e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(N,{children:e.jsx(m,{id:"AbVGAw",defaultMessage:"No Results"})})});const a=ue(s,o=>o.entries).toSorted((o,l)=>((l==null?void 0:l.pub_date)??0)-((o==null?void 0:o.pub_date)??0)),n=t.toSorted((o,l)=>((l==null?void 0:l.pub_date)??0)-((o==null?void 0:o.pub_date)??0));return e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsx(j,{title:e.jsx(m,{id:"dlVlo6",defaultMessage:"Citations"}),items:n,turnIndex:r}),e.jsx(j,{title:e.jsx(m,{id:"9M0Yh6",defaultMessage:"More Links"}),items:a,turnIndex:r})]})}const me=x.div`sticky top-0 text-xs font-semibold text-token-text-primary border-y py-3 px-6 bg-token-main-surface-primary`;function j({title:t,items:s,turnIndex:r}){return!s||s.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx(me,{children:t}),e.jsx("div",{className:"flex flex-col gap-6 px-6 py-4",children:s.map((a,n)=>e.jsx(xe,{item:a,turnIndex:r,index:n},n))})]})}function xe({item:t,turnIndex:s,index:r}){const a=w(t.url).data??k(t.url,"short"),n=o=>"ref_id"in o&&"content_type"in o;return e.jsx(fe,{turnIndex:s,href:t.url,position:r,target:"_blank",rel:"noopener",className:"group flex gap-6",children:e.jsxs("div",{children:[e.jsxs("div",{className:"line-clamp-1 flex items-center gap-2 text-sm",children:[e.jsx(Y,{url:t.url,className:"icon-sm rounded bg-token-main-surface-primary object-cover",size:32,minSize:20,fallback:e.jsx(Z,{className:"icon-sm text-token-text-quaternary"})}),a,n(t)&&e.jsx(J,{searchResult:t,className:"inline h-4 w-4 text-token-text-tertiary"})]}),e.jsx("div",{className:S("line-clamp-2 text-base font-semibold text-token-link"),children:t.title}),t.pub_date&&e.jsx("div",{className:"text-sm text-token-text-tertiary",children:e.jsx(X,{date:t.pub_date})})]})})}const fe=f.forwardRef(function(s,r){const a=O(H.threadId),{turnIndex:n,position:o,...l}=s;function i(c){!s.href||!a||T.logEvent(c,{url:s.href,thread_id:a,turn_index:n,raw_position:o})}return f.useEffect(()=>{i(h.searchLinkShown)},[]),e.jsx("a",{ref:r,...l,onClick:c=>{var u;(u=s.onClick)==null||u.call(s,c),c.stopPropagation(),i(h.searchLinkClicked)}})});function Re({clientThreadId:t}){const s=y(),{tab:r,turnIndex:a}=V(),n=[],o=a?P(t,a):[],l=a?p.getTurnSearchResults(t,a):[],i=a?p.getTurnImageSearchResults(t,a):[];(o.length>0||l.length>0)&&n.push(d.Sources),i.length>0&&n.push(d.Images);const c=f.useCallback(()=>{b.close(r)},[r]);return!r||!a||n.length===0||!n.includes(r)?null:e.jsx(A,{size:"custom",noPadding:!0,isOpen:!0,onClose:c,type:"success",className:"focus-none max-w-3xl !shadow-none outline-none",children:e.jsxs("div",{className:"focus-none flex h-full flex-col items-center justify-start overflow-hidden rounded-lg outline-none",children:[e.jsxs(he,{children:[e.jsx(pe,{children:n.map(u=>e.jsx("button",{onClick:()=>{b.open(u,a)},className:S("mb-[-1px] border-b-2 border-solid border-transparent py-6 text-lg font-medium text-token-text-tertiary hover:text-token-text-secondary",{"!border-token-text-primary font-semibold !text-token-text-primary":r===u}),children:s.formatMessage(ge[u])},u))}),e.jsx(D,{onClick:c})]}),e.jsx(be,{children:e.jsx(Q,{children:r===d.Sources?e.jsx(g.div,{...v,children:e.jsx(de,{citations:o,searchResults:l,turnIndex:a})},"sources"):r===d.Images?e.jsx(g.div,{...v,children:e.jsx(K,{images:i,turnIndex:a})},"images"):null})})]})})}const v={initial:{opacity:0},animate:{opacity:1},transition:{duration:.2},className:"max-h-[60vh] overflow-y-auto"},he=x.div`flex w-full flex-row items-center justify-between border-b px-6 dark:border-gray-700`,pe=x.span`text-base font-semibold sm:text-base flex gap-4`,be=x.div`max-h-[60vh] w-full`,ge=E({[d.Images]:{id:"Z0ljgR",defaultMessage:"Images"},[d.Sources]:{id:"f0O2dC",defaultMessage:"Sources"}});export{Re as SearchResultsModal};
