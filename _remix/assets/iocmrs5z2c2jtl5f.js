import{D,r as g,j as e,c as Y,H as oe,b5 as B,G as f,a2 as y,al as O,z as de,A as me,C as ce}from"./ofly9yrztlesgrye.js";import{bR as Z,e as ue,bS as fe,bT as ge,at as j,ak as pe,O as he,bU as xe,x as ve,bV as be}from"./nqzijea2w2642vxo.js";import{S as Me,c as we}from"./j793iupxz6cbek3f.js";import{B as je,V as Se,o as Ee}from"./pbk6784aea0pnvmy.js";import{S}from"./kyhim0cxnn9lnc9c.js";function $(a){return a.split(/[\s,]+/)}function Ce({value:a,onChange:n,className:v}){const h=D(),[l,d]=g.useState(""),b=g.useCallback(M=>{if(l)switch(M.key){case"Enter":case",":case" ":{const w=$(l);n([...a,...w.map(K)]),d(""),M.preventDefault()}}},[l,n,a]),p=M=>{if(l){const w=$(l);n([...a,...w.map(K)]),d(l),M.preventDefault()}};return e.jsx(Me,{className:Y("react-select-container",v),isMulti:!0,onBlur:p,classNamePrefix:"react-select",components:Ie,inputValue:l,isClearable:!0,menuIsOpen:!1,onChange:n,onInputChange:d,onKeyDown:b,placeholder:h.formatMessage(H.placeholder),value:a,"aria-labelledby":"add-emails-label",name:"add-member-emails"})}const K=a=>({label:a,value:a,isValid:Z.test(a)}),Ne=a=>{const n=D(),v=e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{children:a.children}),e.jsx(je,{className:"icon-sm"})]}),h=a.data.isValid?v:e.jsx(ue,{label:n.formatMessage(H.tooltipInvalidEmail,{email:a.data.value}),side:"top",children:v});return e.jsx(we.MultiValue,{...a,children:e.jsx("button",{className:Y("m-1 cursor-pointer rounded-full border border-transparent py-1 pl-3 pr-2 text-sm text-token-text-primary",a.data.isValid?"bg-token-main-surface-secondary hover:border-token-border-medium hover:bg-token-main-surface-tertiary":"bg-red-200 text-red-500"),onClick:l=>{var d,b;(b=(d=a.removeProps).onClick)==null||b.call(d,l),l.preventDefault()},"aria-label":n.formatMessage(H.removeMember,{member:a.data.value}),children:h})})},Ie={DropdownIndicator:()=>null,IndicatorsContainer:()=>null,ClearIndicator:()=>null,MultiValueRemove:()=>null,MultiValue:Ne},H=oe({membersAdded:{id:"emailsTextarea.membersAdded",defaultMessage:"+{count} {count, plural, one {member} other {members}}"},removeMember:{id:"emailsTextarea.removeMember",defaultMessage:"Remove {member}"},tooltipInvalidEmail:{id:"emailsTextarea.tooltipInvalidEmail",defaultMessage:'"{email}" may not be a valid email'},clearAllEntries:{id:"emailsTextarea.clearAllEntries",defaultMessage:"Clear all"},placeholder:{id:"emailsTextarea.placeholder",defaultMessage:"Type an email and press enter..."}}),ye=`email,role
user1@company.com,member
admin@company.com,admin
it@company.com,owner`,J=25,Q=[];function Fe({workspace:a,canResendInviteEmails:n,onCancel:v,cancelButtonText:h,onSuccess:l,fullWidthButtons:d=!1}){const b=a.isOwnerOfAccount(),[p,M]=g.useState(!1),[w,R]=g.useState(!1),c=g.useRef(null),x=a.isTeam(),m=D(),[N,E]=g.useState(!0),[k,T]=g.useState(!1),[I,A]=g.useState(0),[u,V]=g.useState([]),[F,z]=g.useState([]),{mutateAsync:ee}=Re(a.id,l),P=fe(),W=ge()??!0,[L,U]=g.useState(Q);g.useEffect(()=>{if(!(u!=null&&u.length)||!(P!=null&&P.length)||W){U(Q);return}const t=P.map(s=>"@"+s.hostname.toLowerCase()),o=u.map(({email:s})=>s.toLowerCase()).filter(s=>!t.some(r=>s.endsWith(r)));U(o)},[P,W,u]);const C=Te(b),ae=async t=>{var s;const o=(s=t.target.files)==null?void 0:s[0];if(o){const r=await ke(o,C,w);r.status==="success"?(V(r.newRows),A(1),R(r.hasWarning)):r.reason==="file_too_large"?y.danger(m.formatMessage(i.fileTooLargeWarning,{maxSize:`${J}MB`}),{duration:5}):r.reason==="invalid_file_type"&&y.danger(m.formatMessage(i.fileIncorrectTypeWarning),{duration:5})}},q=(t,o,s)=>{const r=[...u];r[t]={...r[t],[o]:s},V(r)},te=t=>{const o=[...u.slice(0,t),...u.slice(t+1)];V(o)},G=g.useCallback(()=>{V([]),A(0),T(!1),z([])},[]),ie=async()=>{T(!0);try{u.length>5&&y.info(m.formatMessage(i.inviteMessageLoading,{numRows:u.length}),{hasCloseButton:!0});const t=[["admin",O.ADMIN],["owner",O.OWNER],["member",O.STANDARD]],s=(await Promise.all(ve(t.map(([r,re])=>{const X=u.filter(_=>_.role===r).map(_=>_.email);return X.length>0&&ee({emails:X,role:re,resendEmails:N})})))).flat().length;s>0&&y.success(m.formatMessage(i.inviteSuccessToast,{numRows:s,userStr:s===1?"user":"users",workspaceName:be(m,a)})),l==null||l(),G()}finally{T(!1)}},se=()=>{const t=new Set,o=F.reduce((s,r)=>(t.has(r.value)||s.push(r.value),t.add(r.value),s),[]);V(o.map(s=>({email:s,role:C.member}))),A(1)},ne=e.jsx(B,{color:"primary",size:d?"large":"medium",disabled:k||u.length===0||L.length>0,onClick:ie,children:k?m.formatMessage(i.inviteMemberInviteSubmitButtonLoading):m.formatMessage(i.inviteMemberInviteSubmitButton)}),le=e.jsx(B,{color:"primary",size:d?"large":"medium",disabled:F.length===0,onClick:se,children:m.formatMessage(i.inviteMemberInviteNextButton)});return e.jsxs("div",{className:"flex flex-col gap-2",children:[I===0&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{htmlFor:"upload-csv",id:"upload-csv-label",children:e.jsx(f,{...i.importCSVLabel})}),e.jsxs("span",{className:"text-sm text-token-text-tertiary",children:[e.jsx(f,{...p?i.helperCSVFormatHide:i.helperCSVFormatShow,values:{link:t=>e.jsx("button",{className:"underline",onClick:()=>{M(!p)},children:t})}}),p&&e.jsx("pre",{className:"mt-4",children:ye})]})]}),e.jsx("input",{ref:c,type:"file",accept:".csv,text/csv",id:"upload-csv",className:"hidden",onChange:ae}),e.jsx(B,{color:"secondary",onClick:()=>{var t;return(t=c.current)==null?void 0:t.click()},children:e.jsx(f,{...i.importCSVButton})})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"add-member-emails",id:"add-emails-label",children:e.jsx(f,{...i.addEmailsFieldName})}),e.jsx(Ce,{value:F,onChange:z})]})]}),I===1&&e.jsxs(e.Fragment,{children:[w&&e.jsxs("div",{className:"flex w-full items-center bg-yellow-100 p-4",children:[e.jsx(Se,{className:"icon-sm mr-2 text-yellow-700"}),e.jsx("div",{className:"flex-grow text-yellow-700",children:e.jsx(f,{...i.unspecifiedRoleDescription})})]}),L.length>0&&e.jsx("div",{className:"flex w-full items-center bg-red-100 p-4",children:e.jsxs("div",{className:"flex-grow text-red-700",children:[e.jsx(f,{...i.prohibitedExternalEmailDescription}),e.jsx("pre",{className:"my-1",children:L.join(", ")}),e.jsx(f,{...i.prohibitedExternalEmailResolution})]})}),e.jsxs(j.Root,{size:"normal",children:[e.jsxs(j.Header,{children:[e.jsx(j.HeaderCell,{children:e.jsx(f,{...i.inviteTableHeaderEmail})}),e.jsx(j.HeaderCell,{className:"pl-3 dark:bg-gray-900",children:e.jsx(f,{...i.inviteTableHeaderRole})}),e.jsx(j.HeaderCell,{})]}),e.jsx(j.Body,{children:u.map((t,o)=>e.jsxs(j.Row,{children:[e.jsx(j.Cell,{children:e.jsx(pe,{name:"email",type:"email",value:t.email,onChange:s=>q(o,"email",s.target.value),color:"neutral"})}),e.jsx(j.Cell,{children:e.jsxs(S.Root,{value:t.role,onValueChange:s=>q(o,"role",s),children:[e.jsxs(S.Trigger,{children:[e.jsx(S.Value,{}),e.jsx(S.Icon,{})]}),e.jsx(S.Portal,{children:e.jsxs(S.Content,{className:"border border-token-main-surface-secondary",children:[e.jsx(S.Item,{value:C.member,children:e.jsx(f,{...i.inviteRoleMember})}),C.admin&&e.jsx(S.Item,{value:C.admin,children:e.jsx(f,{...i.inviteRoleAdmin})}),C.owner&&e.jsx(S.Item,{value:C.owner,children:e.jsx(f,{...i.inviteRoleOwner})})]})})]})}),e.jsx(j.Cell,{textAlign:"right",children:e.jsx(Ee,{onClick:()=>te(o),className:"icon-sm mr-2 cursor-pointer text-token-text-secondary"})})]},o))})]})]}),n&&E&&e.jsx("div",{className:"mt-2 flex items-center text-left text-token-text-secondary",children:e.jsx(he,{id:"resend-emails",checked:N,onChange:t=>E(t.currentTarget.checked),label:m.formatMessage(i.resendEmailsFieldName)})}),I===0&&x&&e.jsx("div",{className:"mb-4",children:e.jsx(xe,{children:e.jsx(f,{...i.teamInviteModalNote})})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(B,{color:"secondary",size:d?"large":"medium",onClick:()=>{I!==0?A(0):(G(),v())},children:I===0?h:m.formatMessage(i.inviteMemberInviteBackButton)}),I===0?le:ne]})]})}function Re(a,n){const v=D(),h=de();return me({mutationFn:async({emails:l,role:d,resendEmails:b})=>{const p=[],M=Math.max(5,Math.round(l.length/10));for(let c=0;c<l.length;c+=M)p.push(l.slice(c,c+M));const w=async c=>ce.addWorkspaceUsers(a,c,d,b).then(x=>(x.errored_emails.length>0&&y.danger(v.formatMessage(i.inviteMessageFailure,{emailsStr:x.errored_emails.map(({email_address:m,error:N})=>`${m}: ${N}`).join(", ")})),x.account_invites)).catch(x=>{throw y.danger(x.message),x});return(await Promise.all(p.map(c=>w(c)))).flat()},onSuccess:()=>{h.invalidateQueries({queryKey:["workspace","invites",a]}),n==null||n()}})}function ke(a,n,v){return new Promise(h=>{if(a.size/1048576>J)h({status:"error",reason:"file_too_large"});else if(a.type!=="text/csv")h({status:"error",reason:"invalid_file_type"});else{const d=new FileReader;d.readAsText(a),d.onload=function(b){var x;let p=v;const w=((x=b.target)==null?void 0:x.result).split(`
`),R=new Set,c=w.reduce((m,N)=>{const[E,k]=N.split(",").map(T=>T.trim());return Z.test(E)&&!R.has(E)&&(n[k]===void 0&&!p&&(p=!0),m.push({email:E,role:n[k]??n.member})),R.add(E),m},[]);h({status:"success",newRows:c,hasWarning:p})}}})}const Te=a=>{const n={member:"member"};return a&&(n.admin="admin",n.owner="owner"),n},i={importCSVLabel:{id:"adminPage.importCSVLabel",defaultMessage:"Import from CSV",description:"Name of label for import from CSV button"},helperCSVFormatHide:{id:"adminPage.helperCSVFormat",defaultMessage:'The file must include email and an optional role on each line. Roles can be "member", "admin", or "owner". <link>Hide Example</link>',description:"Instructions for formatting the import CSV, with a link to hide the example"},helperCSVFormatShow:{id:"adminPage.helperCSVFormat",defaultMessage:'The file must include email and an optional role on each line. Roles can be "member", "admin", or "owner". <link>Show Example</link>',description:"Instructions for formatting the import CSV, with a link to show an example"},importCSVButton:{id:"adminPage.importCSVButton",defaultMessage:"Upload",description:"Name of upload from CSV button"},addEmailsFieldName:{id:"adminPage.addEmailsFieldName.0",defaultMessage:"Emails",description:"Name of input for adding emails to workspace"},unspecifiedRoleDescription:{id:"adminPage.unspecifiedRoleDescription",defaultMessage:"Roles that were unspecified have been changed to Member.",description:"Description text for defaulting invite roles to member"},prohibitedExternalEmailDescription:{id:"adminPage.prohibitedExternalEmailDescription",defaultMessage:"The following emails are not a part of your organization's verified domains:",description:"Description text for error message"},prohibitedExternalEmailResolution:{id:"adminPage.prohibitedExternalEmailResolution",defaultMessage:'Either remove these emails, enable "Allow External Domain Invites" from your workspace settings, or verify these email domains.',description:"Description text for error message"},inviteTableHeaderEmail:{id:"adminPage.inviteTableHeaderEmail",defaultMessage:"Email",description:"Label for email column of invite table header"},inviteTableHeaderRole:{id:"adminPage.inviteTableHeaderRole",defaultMessage:"Role",description:"Label for role column of invite table header"},inviteRoleMember:{id:"adminPage.inviteRoleMember",defaultMessage:"Member",description:"Member role for workspace invite"},inviteRoleAdmin:{id:"adminPage.inviteRoleAdmin",defaultMessage:"Admin",description:"Admin role for workspace invite"},inviteRoleOwner:{id:"adminPage.inviteRoleOwner",defaultMessage:"Owner",description:"Owner role for workspace invite"},fileTooLargeWarning:{id:"adminPage",defaultMessage:"File is too large. Please upload a CSV file smaller than {maxSize}.",description:"Error when uploading a file that is too large"},fileIncorrectTypeWarning:{id:"adminPage",defaultMessage:"Please upload a CSV file.",description:"Error when uploading a file that is not a CSV"},resendEmailsFieldName:{id:"adminPage.resendEmailsFieldName",defaultMessage:"Resend emails for existing invites",description:"Name of checkbox input for resending emails to workspace"},teamInviteModalNote:{id:"adminPage.teamInviteModalNote",defaultMessage:"Users that accept invites will be included as additional seats on your next invoice.",description:"Note for team plan invites that additional seats will be charged"},inviteMessageLoading:{id:"adminPage.inviteMessageLoading",defaultMessage:"Sending out {numRows} invites, this may take a minute...",description:"Loading message when invites are being sent"},inviteSuccessToast:{id:"adminPage.inviteSuccessToast",defaultMessage:"Invited {numRows} {userStr} to {workspaceName}",description:"Message on successfully sending out invites"},inviteMemberInviteNextButton:{id:"adminPage.inviteMemberInviteNextButton",defaultMessage:"Next",description:"The title of the invite member modal next button"},inviteMemberInviteSubmitButton:{id:"adminPage.inviteMemberInviteSubmitButton",defaultMessage:"Send invites",description:"The title of the invite member modal submit button"},inviteMemberInviteSubmitButtonLoading:{id:"adminPage.inviteMemberInviteSubmitButtonLoading",defaultMessage:"Sending invites...",description:"Button label while inviting members"},inviteMemberInviteBackButton:{id:"adminPage.inviteMemberInviteBackButton",defaultMessage:"Back",description:"The title of the invite member modal back button"},inviteMessageFailure:{id:"adminPage.inviteMessageFailure",defaultMessage:"Unable to invite {emailsStr}",description:"Message that shows which emails were unsuccessful at being invited"}};export{Fe as A};
//# sourceMappingURL=iocmrs5z2c2jtl5f.js.map
