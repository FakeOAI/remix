import{j as s,I as E,r as w,a1 as F,d7 as M,M as N,aV as D,c as P}from"./k9l0508ak3e7lzcr.js";import{F as A}from"./kvbhg5pv4kjda3of.js";import{B as O,aO as z}from"./hb601xkanolcuyaq.js";import{n as _,o as G,p as $,g as q,q as B}from"./d6iedxuu7mbdrnme.js";import{g as U}from"./kqwdyvkaaavvn8k3.js";import{u as V}from"./fls8d6sejczdccck.js";import{bl as b,bm as o,bn as j,bo as C,A as R}from"./96tandeuiw92jgym.js";import{m as L}from"./m5r2yh58ny5yc24l.js";import"./ig7iznl8s7o1ddbr.js";import"./o2j7zoei5cim6ka2.js";function le({clientThreadId:t}){const e=b();if(!e)return null;const{image:n,source:a,turnIndex:i}=e;if(a==null||t==null||i==null)return s.jsx(m,{image:n});switch(a){case o.ImagesTab:return s.jsx(K,{image:n,clientThreadId:t,turnIndex:i});case o.Turn:return s.jsx(J,{image:n,clientThreadId:t,turnIndex:i})}}function ce(){const t=b();if(!t)return null;const{image:e,source:n}=t;if(n==null)return s.jsx(m,{image:e});switch(n){case o.ImagesTab:return s.jsx(X,{image:e});case o.Turn:return s.jsx(H,{image:e})}}function X({image:t}){const{imageResults:e}=_();return s.jsx(m,{image:t,group:e,groupSource:o.ImagesTab})}function H({image:t}){const{imageResults:e}=G();return s.jsx(m,{image:t,group:e,groupSource:o.Turn})}function J({image:t,clientThreadId:e,turnIndex:n}){const a=$(e,n);return s.jsx(m,{image:t,group:a,turnIndex:n,groupSource:o.Turn})}function K({image:t,clientThreadId:e,turnIndex:n}){const a=q.getTurnImageSearchResults(e,n);return s.jsx(m,{image:t,group:a,turnIndex:n,groupSource:o.ImagesTab})}const T=E.div`grow flex items-start p-8`;function S({title:t,urls:e}){const n=e[0],{data:a,isError:i}=B(n);if(e.length===0)return;if(i)return e.length>1?s.jsx(S,{title:t,urls:e.slice(1)}):s.jsx("div",{className:"flex h-full grow items-center justify-center",children:s.jsx("div",{className:"flex h-96 w-96 items-center justify-center bg-white/10",children:s.jsx(z,{className:"h-12 w-12 text-token-text-tertiary"})})});const c="max-w-[100vw] sm:max-w-[calc(100vw-10rem)] object-scale-down h-full";return a!=null?s.jsx(L.img,{src:n,alt:t,initial:{opacity:0},animate:{opacity:1},className:c}):s.jsx("div",{className:P("w-full animate-pulse bg-white/10",c)})}const Q={enter:t=>({x:t>0?1e3:-1e3,opacity:0}),center:{zIndex:1,x:0,opacity:1},exit:t=>({zIndex:0,x:t<0?1e3:-1e3,opacity:0})},k=1e4,W=(t,e)=>Math.abs(t)*e;function m({image:t,group:e,groupSource:n,turnIndex:a}){const i=V((t==null?void 0:t.url)??""),c=b(),I=c==null?void 0:c.mountDirection;w.useEffect(()=>{var h,p;(p=(h=window==null?void 0:window.history)==null?void 0:h.state)!=null&&p.imageModalOpen||window.history.pushState({imageModalOpen:!0},"",window.location.href);const r=()=>{var f,y;(y=(f=window==null?void 0:window.history)==null?void 0:f.state)!=null&&y.imageModalOpen||j.setCurrentImage(void 0)};return window.addEventListener("popstate",r),()=>window.removeEventListener("popstate",r)},[]);const v=()=>{window.history.go(-1),j.setCurrentImage(void 0)},l=e==null?void 0:e.findIndex(r=>F(t,r)),u=(e==null?void 0:e.length)??1,x=l!=null&&u>1,d=w.useCallback(()=>{!x||e==null||j.setCurrentImage({image:e[(l+1)%e.length],source:n,mountDirection:C.FromRight,turnIndex:a})},[e,x,l,n,a]),g=w.useCallback(()=>{!x||e==null||j.setCurrentImage({image:e[(l-1+e.length)%e.length],source:n,mountDirection:C.FromLeft,turnIndex:a})},[e,x,l,n,a]);return w.useEffect(()=>M(document,{keydown:r=>{r.key==="ArrowRight"?d():r.key==="ArrowLeft"&&g()}}),[d,g]),s.jsx(R,{children:t&&s.jsx(N.Root,{isOpen:!0,onClose:v,children:s.jsx(N.Overlay,{children:s.jsxs(D,{className:"flex h-full w-full flex-col bg-black/95",children:[s.jsxs("div",{className:"relative flex w-full grow justify-center overflow-hidden",children:[s.jsxs("div",{className:"absolute right-4 top-4 flex items-center sm:right-6 sm:top-6",children:[x&&s.jsxs("div",{className:"shrink-0 px-4 py-2 text-token-text-tertiary",children:[l+1," / ",u]}),s.jsx("button",{onClick:r=>{r.stopPropagation(),v()},className:"flex h-9 w-9 items-center justify-center outline-none hover:opacity-70",children:s.jsx(O,{className:"h-6 w-6 text-gray-400"})})]}),u>1&&s.jsx(T,{className:"cursor-w-resize",onClick:r=>{r.stopPropagation(),g()}}),s.jsx(R,{initial:!1,custom:I,children:s.jsx(L.div,{variants:Q,custom:I??0,className:"absolute bottom-4 top-24",initial:"enter",animate:"center",exit:"exit",transition:{x:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2}},drag:u>1?"x":!1,dragConstraints:{left:0,right:0},dragElastic:1,onDragEnd:(r,{offset:h,velocity:p})=>{const f=W(h.x,p.x);f<-k?d():f>k&&g()},children:s.jsx(S,{title:t.title,urls:[t.content_url.replace(/^http:\/\//,"https://"),t.thumbnail_url]})},l)}),u>1&&s.jsx(T,{className:"cursor-e-resize",onClick:r=>{r.stopPropagation(),d()}})]}),s.jsx("a",{href:t.url,target:"_blank",rel:"noopener",className:"flex min-h-20 w-full shrink-0 items-center gap-8 px-6 pb-3 pt-8 text-sm hover:opacity-70 sm:px-8 sm:pb-8",children:s.jsxs("div",{className:"flex grow flex-col gap-0.5 overflow-hidden pr-2",children:[s.jsxs("div",{className:"flex items-center gap-2 truncate text-token-text-tertiary",children:[s.jsx(A,{url:t.content_url,className:"rounded",size:16}),i.data??U(t.url)]}),s.jsx("div",{className:"truncate font-semibold text-white",children:t.title})]})})]})})})})}export{le as ImageLightbox,ce as ImageLightboxSearchGPT,m as ImageResultModal};
