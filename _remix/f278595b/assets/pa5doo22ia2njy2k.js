const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/cnie0f73c1vqtojb.js","assets/ddcjry37y0ueobh3.js","assets/ostblj7tqg38i6fa.js","assets/root-pebmx3ar.css","assets/mlzz6djcph5fthpz.js","assets/conversation-small-cll5buey.css","assets/m780wk85gg28bdfy.js","assets/dcc45rtf5i4crsq0.js","assets/g232mik5xb95sf81.js","assets/s8ck5rhbggwsgpvb.js","assets/lxw6kvlkbnjsbx5r.js","assets/cu8ha0xsn15q3kuh.js","assets/nx9wnt9smxe2g0dl.js","assets/lw8c0noczs2rbs9j.js","assets/iwvyrmtfz5lkn9sl.js","assets/dun9tl2py1kc9nqh.js","assets/dqx1biyivpsf3few.js","assets/h45knxg1fgjhb147.js","assets/fh2qut1d6jaeqbdt.js","assets/fcpw5nyxo3dqdqna.js","assets/fkdtydvtm9fd2xtc.js","assets/bo5lt597wbofkr1p.js","assets/h9z74bskym3ttzc8.js","assets/jj3i5x6opi4xqiiv.js","assets/bwn9p8wp0adpm8es.js","assets/nf5bsp4k1f7qe67v.js"])))=>i.map(i=>d[i]);
import{r as c,Z as re,$ as oe,X as F,bF as V,ef as v,ej as I,f2 as z,y as s,O as S,c8 as ie,P as x,b as E,S as U,a8 as le,u as P,bh as de,a9 as ce,l as C,an as ue,a1 as k,a6 as fe}from"./ddcjry37y0ueobh3.js";import{cF as me,fj as K,fk as he,w as ye,bY as j,fl as ge,fm as pe,dp as be,V as ve,bm as B,fn as Se,cx as Te,eO as xe,eP as Ee,eQ as q,eR as Ce,bZ as Ne,eV as we,eW as Ie}from"./mlzz6djcph5fthpz.js";import{b as ke,r as R,s as Y,a as Me}from"./lw8c0noczs2rbs9j.js";import{u as Re,d as je,U as $}from"./lxw6kvlkbnjsbx5r.js";import{a as _e,g as De}from"./m780wk85gg28bdfy.js";import{f as Oe}from"./nx9wnt9smxe2g0dl.js";import{B as Ae,C as X,q as Le,w as He,T as Q}from"./dcc45rtf5i4crsq0.js";import{G as Z}from"./cu8ha0xsn15q3kuh.js";import{ag as Ue}from"./ostblj7tqg38i6fa.js";function Fe(e,o,t){const{title:n,titleSource:a}=Ae(e),[r,l]=c.useState(!1),d=n??o,i=c.useRef(d);return c.useEffect(()=>(t&&a===X.Generated&&d!==i.current&&l(!0),()=>{i.current=d}),[t,d,a]),{isTypingEffect:r,resolvedTitle:d}}const Pe=re(()=>oe(()=>import("./cnie0f73c1vqtojb.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25])).then(e=>e.GizmoConversationOptionsDropdown)),Ge=new Date(2024,9,11,0);function Ve(e){U.checkGate("3922476776")||pe.abortAllRequests(),x.logEvent(E.loadThread,{threadId:e})}function Be({conversation:e,conversationTitle:o,onOpenChange:t,testId:n}){const a=F(),{isUnauthenticated:r}=le(),{eligible:l,markAsViewed:d}=be(ve.ArchiveConversationOnboarding),i=He(e.id),[u,b]=c.useState(!1),y=P(),m=de(),g=ce();return c.useEffect(()=>z(Z,{deleteChat:({serverThreadId:f})=>{f===e.id&&b(!0)},archiveChat:async({serverThreadId:f})=>{f===e.id&&(await C.patchConversation(e.id,{is_archived:!0}),R(y),U.logEvent("chatgpt_conversation_archived"),x.logEvent(E.conversationArchived),l&&(g.info(a.formatMessage({defaultMessage:"You can view archived chats in Settings",id:"HistoryGizmoItem.archiveChatOnboarding"}),{duration:10,hasCloseButton:!0}),d()),i&&B(m))}}),[m,g,y,l,e.id,a,i,d]),r?null:s.jsxs(s.Fragment,{children:[s.jsx(ue,{label:a.formatMessage({id:"tJPHEQ",defaultMessage:"Options"}),sideOffset:4,side:"top",children:s.jsx(Pe,{clientThreadId:e.id,onOpenChange:t,children:s.jsx("button",{className:"flex items-center justify-center text-token-text-secondary transition hover:text-token-text-primary radix-state-open:text-token-text-secondary","data-testid":n,children:s.jsx(Ue,{className:"icon-md"})})})}),u&&s.jsx(Se,{title:o,handleDelete:()=>{C.patchConversation(e.id,{is_visible:!1}).then(()=>{R(y),U.logEvent("chatgpt_conversation_deleted"),x.logEvent(E.conversationDeleted),Te.publish({kind:"deleteConversation",serverThreadId:e.id})}),i&&B(m)},onClose:()=>{b(!1)}})]})}function qe({conversation:e,onClose:o}){const[t,n]=c.useState(e.title),a=P();function r(){t!==e.title&&(Q.setTitle(e.id,t,X.User),x.logEvent(E.renameThread,{threadId:e.id,content:t}),C.patchConversation(e.id,{title:t}).then(()=>{R(a)}))}return s.jsx("input",{type:"text",value:t,onChange:l=>{n(l.target.value)},onKeyDown:l=>{switch(l.key){case"Escape":o();break;case"Enter":r(),o();break}},onBlur:()=>{r(),o()},autoFocus:!0,className:"w-full border border-token-border-light bg-transparent p-0 text-sm"})}const J=5,Ye=3e3;function $e({threadId:e}){const o=P(),t=c.useRef(!1),n=c.useRef(null);return c.useEffect(()=>{async function a(){t.current=!0;const r=await Oe(e);if(r.async_status===v.UNREAD){R(o),Q.initThreadFromServerData(e,r,!0,void 0,!0);return}if(r.async_status!==v.STREAMING)return;const l=r.update_time??0;K(new Date,new Date(l*1e3))<J?n.current=window.setTimeout(a,Ye):C.setConversationStatus(e)}return t.current||(x.logEvent(E.conversationPollingStarted),a()),()=>{n.current&&window.clearTimeout(n.current)}},[o,e]),null}function ze({conversation:e,className:o,isActive:t,elementRef:n,isPrimaryBackgroundColor:a,testId:r}){const l=F(),[d,i]=c.useState(!1),[u,b]=c.useState(!1),{value:y}=V("3922476776"),{value:m}=V("232791851"),g=ke(e.id),{value:f=null,source:T=null}=g??{},_=Le(e.id),h=me(_),N=K(new Date,new Date(e.update_time??0))<J,D=e.update_time&&he(new Date(e.update_time),Ge),O=f===v.STREAMING&&N,A=m&&!t&&!h&&D&&f===v.UNREAD,W=m&&!t&&(h||O),ee=m&&f===v.STREAMING&&T===I.SERVER&&!h&&N,L=c.useRef(!1);c.useEffect(()=>{L.current||y&&(async()=>(L.current=!0,t&&f===v.UNREAD&&(T===I.SERVER&&await C.setConversationStatus(e.id),Y(e.id,null)),!t&&T===I.CLIENT&&f===v.UNREAD&&(await C.setConversationStatus(e.id,f),Y(e.id,{value:v.UNREAD,source:I.SERVER})),L.current=!1))()},[y,t,e.id,f,T,h]),c.useEffect(()=>z(Z,{editTitle:({serverThreadId:p})=>{(p?p===e.id:t)&&i(!0)}}),[e.id,t]);const G=l.formatMessage({id:"mpXAeu",defaultMessage:"New chat"}),{resolvedTitle:H,isTypingEffect:te}=Fe(e.id,e.title,t),se=ye(),ae=te&&t&&se,{data:ne}=_e(e.conversation_template_id??void 0),w=j();return s.jsxs("div",{className:S("no-draggable group relative rounded-lg active:opacity-90",o,w&&"text-sm tracking-condensed",t?"bg-token-sidebar-surface-secondary":"hover:bg-token-sidebar-surface-secondary",u&&!t&&"bg-token-sidebar-surface-secondary"),children:[ee&&s.jsx($e,{threadId:e.id}),s.jsx(ie,{to:De(e.id,ne),onClick:p=>{p.metaKey||p.ctrlKey||t||Ve(e.id)},onDoubleClick:()=>{i(!0)},ref:n,className:S("flex items-center gap-2",w&&"px-2 py-2.5",!w&&"p-2"),style:{maskImage:w?"var(--sidebar-mask)":void 0},children:s.jsxs("div",{className:S("relative grow overflow-hidden whitespace-nowrap",W&&"loading-shimmer"),dir:"auto",children:[ae?s.jsx(ge,{text:H||G}):H||G,!w&&s.jsx("div",{className:S("absolute bottom-0 top-0 to-transparent ltr:right-0 ltr:bg-gradient-to-l rtl:left-0 rtl:bg-gradient-to-r",a?t||!t&&u?"from-token-sidebar-surface-secondary":"from-token-main-surface-primary":!1,a?!1:t||!t&&u?"from-token-sidebar-surface-secondary":"from-token-sidebar-surface-primary",{"from-token-main-surface-primary can-hover:group-hover:from-token-sidebar-surface-secondary":a&&!t&&!u,"from-token-sidebar-surface-primary can-hover:group-hover:from-token-sidebar-surface-secondary":!a&&!t&&!u,"w-10 from-60%":t||u,"w-8 from-0% can-hover:group-hover:w-10 can-hover:group-hover:from-60%":!t&&!u})})]})}),d?s.jsx("div",{className:"absolute bottom-0 left-[7px] right-2 top-0 flex items-center bg-token-sidebar-surface-secondary",children:s.jsx(qe,{conversation:e,onClose:()=>{i(!1)}})}):A?s.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:s.jsx("div",{className:"h-2 w-2 rounded-full bg-blue-selection"})}):s.jsx("div",{className:S("absolute bottom-0 top-0 items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",t||u?"flex":"hidden can-hover:group-hover:flex"),children:s.jsx(Be,{conversation:e,conversationTitle:H??e.title,onOpenChange:p=>{b(p),p&&x.logEvent(E.conversationHistoryItemOpenMenu,{conversationId:e.id})},testId:`${r}-options`})})]})}function Ke({className:e,elementRef:o,item:t,isActive:n,isFirstItem:a,isPrimaryBackgroundColor:r,testId:l}){const d=j();return s.jsx("li",{className:S(!d&&"relative",a&&!d?"z-[15]":""),"data-testid":l,children:s.jsx(ze,{className:e,isPrimaryBackgroundColor:r,conversation:t,isActive:n,elementRef:o,testId:l})})}function Xe(){const e=j(),{conversations:o}=Me();return{isCollapsible:e&&o.length>5,recentConversationLimit:5}}const M=fe({historyBucketToday:{id:"history.bucket.today",defaultMessage:"Today"},historyBucketYesterday:{id:"history.bucket.yesterday",defaultMessage:"Yesterday"},historyBucketLastSeven:{id:"history.bucket.lastSeven",defaultMessage:"Previous 7 Days"},historyBucketLastThirty:{id:"history.bucket.lastThirty",defaultMessage:"Previous 30 Days"}}),Qe=5;function ot(e,o){const t=F();return c.useMemo(()=>e.reduce((n,a)=>{const r=new Date(a.update_time??a.create_time??0),l=xe(new Date,r);if(l===0)n.recent.today.items.push(a);else if(l<=1)n.recent.yesterday.items.push(a);else if(l<=7)n.recent.lastSeven.items.push(a);else if(l<=30)n.recent.lastThirty.items.push(a);else if(Ee(r)){const d=q(r),i=Ce(r),u=`${d}-${i}`;n.dynamicMonths[u]?n.dynamicMonths[u].items.push(a):n.dynamicMonths[u]={label:t.formatDate(r,{month:"long"}),items:[a]}}else{const i=`${q(r)}-`;n.dynamicYears[i]?n.dynamicYears[i].items.push(a):n.dynamicYears[i]={label:t.formatDate(r,{year:"numeric"}),items:[a]}}return n},{recent:{today:{label:s.jsx(k,{...M.historyBucketToday}),items:[]},yesterday:{label:s.jsx(k,{...M.historyBucketYesterday}),items:[]},lastSeven:{label:s.jsx(k,{...M.historyBucketLastSeven}),items:[]},lastThirty:{label:s.jsx(k,{...M.historyBucketLastThirty}),items:[]}},dynamicMonths:{},dynamicYears:{}}),[o,e])}function it({activeId:e,bucketedItems:o,items:t,hasNextPage:n,isPrimaryBackgroundColor:a,infiniteScrollTriggerElementRef:r}){const{isCollapsible:l}=Xe(),d=Re(je.isHistoryCollapsed),i=j(),[u]=Ne({onChange:b=>{c.startTransition(()=>{$.setHistoryShowMoreVisible(b)})}});return s.jsxs(s.Fragment,{children:[[o.recent,o.dynamicMonths,o.dynamicYears].flatMap((b,y)=>s.jsx(c.Fragment,{children:Object.entries(b).map(([m,{items:g,label:f}],T)=>{if(m!=="today"&&!g.length)return null;const _=!!g.find(h=>t.length>0&&h.id===t[0]?.id);return g.length>0&&s.jsxs("div",{className:S(a&&"first:mt-0",i&&"first:mt-1",!i&&"relative mt-5 first:mt-0 last:mb-5"),children:[s.jsx("div",{className:S("sticky",!i&&"bg-token-sidebar-surface-primary",i?"top-[--sidebar-sticky-threshold] z-20":"top-0 z-20"),children:s.jsx("span",{className:"flex h-9 items-center",children:s.jsx(we,{$screenArch:i,children:f})})}),s.jsx("ol",{className:i?"flex flex-col gap-0.5":void 0,children:g.map((h,N)=>{const D=e===h.id,O=_&&N===0,A=n&&t[t.length-Qe-1]?.id===h.id?r:void 0;return s.jsx(Ke,{item:h,isActive:D,isFirstItem:O,isPrimaryBackgroundColor:a,elementRef:A,testId:`history-item-${N}`},`history-item-${h.id}-${m}`)})})]},`${m}-${y}-${T}`)})},`category-${y}`)),l&&!d&&s.jsx("div",{ref:u,children:s.jsx(Ie,{type:"less",onClick:$.toggleHistoryCollapsed})})]})}export{it as H,Xe as a,Ke as b,ot as u};
//# sourceMappingURL=pa5doo22ia2njy2k.js.map
