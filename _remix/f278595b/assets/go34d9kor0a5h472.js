import{a6 as Qe,O as W,r as C,n as Me,b as ne,C as Wr,X as et,a9 as Kr,au as nr,y as N,d7 as Gr,c7 as Xr,a1 as Yr,D as qr,f5 as We,c as Jr,a as Zr}from"./ddcjry37y0ueobh3.js";import{e as ae,f as Qr,b as en,h as gt,g as tn,w as tt,j as $,I as or,t as rn,k as sr,P as nn,l as on,n as ir,H as ar,R as cr,o as sn,p as Mt,q as Re,s as an,r as lr,u as cn,x as ur,m as rt,y as ln,z as un,T as dn,c as pn,B as Se,A as Nt,i as hn,C as fn,d as kt}from"./lmj4wujldnzrfkti.js";import{a9 as Ne,L as wt,g as yt,E as xt,r as mn,aa as gn,a5 as F,ab as _e,ac as Mn,a6 as Et,ad as Nn,u as kn,ae as wn,af as yn,ag as xn,a7 as nt,a8 as dr,ah as En,a2 as ot,_ as Te,$ as bn}from"./k97tmjlsj9q60xxk.js";import{j as Q,P as X,d as U,i as ge,D as J,y as Cn,z as Sn,M as Tn,S as st,N as Pn,A as bt,B as vn,G as Ke,f as An,F as B,R as Ee,b as be,e as pr,l as Rn,c as In,s as On,q as Bn,H as Dn,t as hr,E as fr}from"./kg9tfaw6um1c8diz.js";import{j3 as Ct,fH as Ge,a4 as St,n$ as _n,dA as it,o0 as Ln,o1 as Vn,o2 as Hn,o3 as zn,bJ as jn,fV as R,nn as $n,c2 as Fn,o4 as Un,iN as at,i$ as Wn,iP as mr,iQ as gr,iR as Mr,j2 as Tt,mt as Kn,o5 as Pt,nK as Gn,hv as vt,aa as Xn,j5 as he,mo as Yn,aD as Ie,fX as qn,co as Jn,kg as Zn,fY as Qn,iS as eo,jh as At,iT as je,ji as Rt,iV as to,jj as ro}from"./mlzz6djcph5fthpz.js";import{v as no,u as oo,Q as so,A as io,z as ao,R as co,x as lo,J as uo}from"./jpi7cbyc49tt1e8j.js";import{w as po,c as Nr,e as ho,t as Xe,d as fo,b as kr}from"./h74tyzi0cj9cuq81.js";import{f as It,a as mo,p as go,h as Mo,R as No}from"./jc94mxc1ucktjohx.js";import{k as ct,g as ko,h as wo,i as yo,u as xo,r as Ot}from"./ocsskvgpfcir594a.js";import{m as me}from"./g232mik5xb95sf81.js";import{cg as Eo,ch as bo,ci as Co,bq as So,Q as To}from"./ostblj7tqg38i6fa.js";import{D as Po}from"./h7ehhe3gw4v3d1di.js";import"./kx49bbo715vyu5as.js";import"./dgg0jllcrloulmgi.js";import"./1y8gcdhosb6yuyg9.js";import"./kbm6e58dnhlxymg3.js";import"./b9g8fafm8dztbaej.js";import"./m780wk85gg28bdfy.js";import"./dcc45rtf5i4crsq0.js";import"./s8ck5rhbggwsgpvb.js";import"./bo5lt597wbofkr1p.js";import"./dqx1biyivpsf3few.js";import"./lw8c0noczs2rbs9j.js";import"./iwvyrmtfz5lkn9sl.js";import"./h9z74bskym3ttzc8.js";import"./lxw6kvlkbnjsbx5r.js";import"./jj3i5x6opi4xqiiv.js";import"./bwn9p8wp0adpm8es.js";import"./nx9wnt9smxe2g0dl.js";import"./ic1b912tnetmuev5.js";class wr extends Ne{unistNodeName(){return"link"}static proseMirrorMarkName(){return"link"}proseMirrorMarkSpec(){return{attrs:{href:{},title:{default:null},disabled:{default:!0}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs(e){return{href:e.getAttribute("href"),title:e.getAttribute("title")}}}],toDOM(e){return["a",{...e.attrs,...e.attrs.disabled?{href:void 0}:{}}]}}}unistNodeToProseMirrorNodes({node:e,convertedChildren:t,schema:n}){const{url:o,title:s}=e;return t.map(i=>i.mark(i.marks.concat([n.marks[this.proseMirrorMarkName()].create({href:o,title:s})])))}processConvertedUnistNode(e,t){return{type:this.unistNodeName(),url:t.attrs.href,...t.attrs.title!=null&&{title:t.attrs.title},children:[e]}}}function vo(r,e){const t=[];return r.descendants((n,o)=>{n.marks.forEach(s=>{s.type===e&&t.push({from:o,to:o+n.nodeSize,mark:s})})}),t}function Ao(r,e,t){const n=e.mark.type,o={...e.mark.attrs,disabled:t};return r.removeMark(e.from,e.to,n),r.addMark(e.from,e.to,n.create(o)),r}const lt=new Q("disableUnsafeLinks");function Ro(r,e){return r.setMeta(lt,{safeUrls:e})}function Io(r){return r.getMeta(lt)??null}function Oo(r=new Set){return new X({key:lt,state:{init(e){return{safeUrls:r}},apply(e,t){const n=Io(e);if(n==null)return t;const{safeUrls:o}=n;return{...t,safeUrls:o}}},appendTransaction(e,t,n){const o=this.getState(n),s=n.tr,i=n.schema.marks[wr.proseMirrorMarkName()],a=vo(n.doc,i);let c=!1;return a.forEach(u=>{const l=u.mark.attrs.href,d=o.safeUrls.has(l),h=u.mark.attrs.disabled===!0;d===h&&(Ao(s,u,!d),c=!0)}),c?s:null}})}const Oe=new Q("placeholder");function Bo(r,e){return r.setMeta(Oe,{isDisabled:e})}function Do(r){return r.getMeta(Oe)??null}function _o(r,e=!1){return new X({key:Oe,state:{init(){return{isDisabled:e}},apply(t,n){const o=Do(t);return o?.isDisabled!=null?{...n,isDisabled:o.isDisabled}:n}},props:{decorations(t){const{doc:n,selection:o}=t;if(Oe.getState(t).isDisabled||!(o instanceof U&&o.empty))return null;const{$cursor:i}=o;if(!i||!r)return null;const a=i.start();if(!((i.parent.isTextblock||i.parent.type.name==="doc")&&i.pos===a&&i.node().content.size===0))return null;const u=ge.widget(a,()=>{const l=document.createTextNode(r.formatMessage(Lo.placeholder)),d=document.createElement("span");return d.className="text-token-text-tertiary dark:text-gray-500 pointer-events-none select-none",d.style.position="absolute",d.appendChild(l),d});return J.create(n,[u])}}})}const Lo=Qe({placeholder:{id:"n2B51U",defaultMessage:"Write something..."}}),Vo={"override-strong-color":"_override-strong-color_y6grp_1"};function yr({isHovered:r,isRejected:e,isTextAcive:t}){return W({"line-through":!t,"filter grayscale-[0.6]":e&&!t,"opacity-60":e&&!t,"bg-opacity-50 dark:bg-opacity-50":e&&r,"bg-opacity-10 dark:bg-opacity-10":e&&!r,"bg-opacity-60 dark:bg-opacity-60":!e&&!r})}function Ho({isHovered:r,isRejected:e,isReplacement:t}){return W("bg-red-100 dark:bg-red-600",yr({isHovered:r,isRejected:e,isTextAcive:e}),{"dark:bg-red-800":e,"text-red-500 dark:text-red-200":!e,"border border-red-400 rounded-l border-r-0":e&&t,"border border-red-400 rounded":e&&!t})}function zo({isHovered:r,isRejected:e,isReplacement:t}){const n=!e;return W(Vo["override-strong-color"],"text-green-600 dark:text-green-200 bg-green-100 dark:bg-green-600",yr({isHovered:r,isRejected:e,isTextAcive:n}),{"dark:bg-green-800":e,"border border-green-500 rounded-r border-l-0":e&&t,"border border-green-500 rounded":e&&!t})}const Ye=new Q("edit"),Bt=(r,e,t,n)=>{const o=[];for(const{start:s,end:i,editId:a}of e)o.push(ge.inline(s,i,{class:Ho({isHovered:!1,isRejected:!1,isReplacement:!1}),"data-edit-id":a}));for(const{start:s,end:i,editId:a}of r)o.push(ge.inline(s,i,{class:zo({isHovered:!1,isRejected:!1,isReplacement:!0}),"data-edit-id":a}));return o},jo=(r,e)=>new X({key:Ye,state:{init(){const n=new Set;return{decorations:Bt(r,e),hoveredEditId:null,rejectedEdits:n}},apply(t,n){const o=t.getMeta(Ye)??null,{hoveredEditId:s,rejectedEdits:i}=o??n;return{decorations:Bt(r,e),hoveredEditId:s,rejectedEdits:i}}},props:{decorations(t){const n=this.getState(t);return n?J.create(t.doc,n.decorations.concat()):J.empty},editable(){return!1},attributes(){return{class:"cursor-default",style:"--text-primary:var(--text-secondary)"}}}});class q{constructor(e,t){this.length=e,this.step=t}cut(e){return e===this.length?this:new q(e,this.step)}static slice(e,t,n){if(t===n)return q.none;if(t===0&&n===q.len(e))return e;const o=[];for(let s=0,i=0;i<n;s++){const a=e[s],c=i+a.length,u=Math.min(n,c)-Math.max(t,i);u>0&&o.push(a.cut(u)),i=c}return o}static join(e,t,n){if(e.length===0)return t;if(t.length===0)return e;const o=n(e[e.length-1].step,t[0].step);if(o==null)return e.concat(t);const s=e.slice(0,e.length-1);s.push(new q(e[e.length-1].length+t[0].length,o));for(const i of t)s.push(i);return s}static len(e){let t=0;for(const n of e)t+=n.length;return t}static none=[]}class $o{constructor(e,t,n,o,s,i){this.fromA=e,this.toA=t,this.fromB=n,this.toB=o,this.deleted=s,this.inserted=i}get lenA(){return this.toA-this.fromA}get lenB(){return this.toB-this.fromB}}const Dt=(r,e,t,n,o)=>new $o(r,e,t,n,r===e?q.none:[new q(e-r,o)],t===n?q.none:[new q(n-t,o)]);class Be{constructor(e,t){this.doc=e,this.changes=t}static create(e){return new Be(e,[])}addSteps(e,t){const n=[];for(const s of t){let i=0;if(s.getMap().forEach((a,c,u,l)=>{n.push(Dt(a+i,c+i,u,l,s)),i=l-u-(c-a)}),s instanceof Cn||s instanceof Sn){const{from:a,to:c}=s;n.push(Dt(a,c,a,c,s))}}if(n.length===0)return this;const o=this.changes.concat(n);return new Be(e,o)}}const xe=new Q("changeset"),qe=new Q("highlightChanges"),xr=r=>xe.getState(r),Fo=r=>{const{state:e}=r,t=e.tr.setMeta(xe,!0);r.updateState(e.apply(t))},Uo=r=>{const{state:e}=r,t=xr(e);if(!t)return;const{maps:n,steps:o}=t,s=new Tn(n),i=e.tr;for(let c=o.length-1;c>=0;c--){const u=o[c].map(s.slice(c+1));if(!u)continue;i.maybeStep(u).doc&&s.appendMap(u.getMap(),c)}const a=e.apply(i.setMeta(xe,!0));r.updateState(a)},Wo=()=>{const r=n=>({changeset:Be.create(n),maps:[],steps:[]}),e=new X({key:xe,state:{init:(n,{doc:o})=>r(o),apply:(n,o,s,i)=>{const{doc:a}=i;if(n.getMeta(xe))return r(a);const{docChanged:u,mapping:l,steps:d,docs:h}=n;if(!u)return o;const{changeset:p,maps:m,steps:f}=o,{maps:g}=l,w=d.map((y,x)=>y.invert(h[x]));return{changeset:p.addSteps(a,d),maps:m.concat(g),steps:f.concat(w)}}}}),t=new X({key:qe,state:{init(){return{deco:J.empty,show:!1}},apply(n,o,s,i){const a=e.getState(i);if(!a)return o;const{changeset:c}=a,{doc:u}=i,{changes:l}=c,d=l.map(({fromB:p,toB:m})=>ge.inline(p,m,{class:"blame-marker"})),h=n.getMeta(qe);return{deco:J.create(u,d),show:h??o.show}}},props:{decorations(n){const o=this.getState(n);if(!o?.show)return J.empty;const{deco:s}=o;return s}}});return[e,t]},oe=(r,e,t)=>{C.useEffect(()=>{const n=e.current;if(!n)return;const{state:o}=n,s=r(o.tr);s&&n.dispatch(s)},t)};var le=(r=>(r.PROSEMIRROR_CONTEXT_CHILDREN="prosemirror-context-children",r.PROSEMIRROR_EDITOR_CONTAINER="prosemirror-editor-container",r))(le||{});function Ko(r,e){return{x:Ct(e.x,r.left,r.right),y:Ct(e.y,r.top,r.bottom)}}function Er(r){let e=r.selection.$from.pos-1;if(e<0)return null;let t=r.doc.nodeAt(e);for(;(t==null||t.type.name===ae.proseMirrorNodeName())&&e>0;)e-=1,t=r.doc.nodeAt(e);return t!=null?{node:t,pos:e}:t}function Go(r,e){const t=Er(r);if(t==null)return!1;const{node:n,pos:o}=t,s=o+n.nodeSize,i=r.tr,c=r.schema.nodes.paragraph.create(null);i.insert(s,c);const u=s+c.nodeSize-1,l=i.doc.resolve(u),d=new U(l);return i.setSelection(d),e(i),!0}function Xo(r,e){const t=Er(r);if(t==null)return!1;const{node:n,pos:o}=t,s=r.tr;return s.deleteRange(o,o+n.nodeSize),e(s),!0}const _t=(r,e)=>{if(r===e)return null;let t=0,n=r.length,o=e.length;for(;t<n&&r.charCodeAt(t)===e.charCodeAt(t);)t+=1;for(;n>t&&o>t&&r.charCodeAt(n-1)===e.charCodeAt(o-1);)n-=1,o-=1;return{from:t,to:n,text:e.slice(t,o)}},Lt=Qr({settings:{background:"var(--gray-100)"}});class ut{constructor(e,t,n,o){this.pmView=t,this.getPos=n,this.node=e;const s=[{key:"ArrowUp",run:this.maybeEscape("line",-1)},{key:"ArrowLeft",run:this.maybeEscape("char",-1)},{key:"ArrowDown",run:this.maybeEscape("line",1)},{key:"ArrowRight",run:this.maybeEscape("char",1)},{key:"Backspace",run:this.handleBackspace},{key:"Shift-Enter",run:this.handleShiftEnter}];this.languageCompartment=new wt,this.themeCompartment=new wt;const i=en(e.attrs.lang),a=yt.create({doc:this.node.textContent,extensions:[this.themeCompartment.of(o?gt:Lt),xt.theme({"&":{borderRadius:"4px",padding:"0.5rem"},"&.cm-focused":{outline:"none"}}),mn.of([...s,...no,...oo,so]),io(),ao(),co(),gn(),lo(uo),this.languageCompartment.of(i!=null?[i]:[]),yt.changeFilter.of(c=>(!c.docChanged&&!this.updating&&this.forwardSelection(),!0))]});this.cm=new xt({state:a,dispatch:this.dispatch}),i==null&&this.setLanguage(e.attrs.lang)}node;updating=!1;cm;languageCompartment;themeCompartment;get pmSchema(){return this.pmView.state.schema}get dom(){return this._setIsCodeBlockView(),this.cm.dom}setLanguage=async e=>{const t=await tn(e);t&&this.cm.dispatch({effects:this.languageCompartment.reconfigure(t)})};setTheme=e=>{const t=e?gt:Lt;this.cm.dispatch({effects:this.themeCompartment.reconfigure(t)})};handleBackspace=e=>{const{selection:t}=e.state;if(!(t.main.empty&&t.main.from===0)||this.cm.state.doc.length>0)return!1;const n=Xo(this.pmView.state,this.pmView.dispatch);return this.pmView.focus(),n};handleShiftEnter=()=>{const e=Go(this.pmView.state,this.pmView.dispatch);return this.pmView.focus(),e};dispatch=e=>{if(this.cm.update([e]),this.updating)return;const t=(this.getPos()??0)+1,n=e.state.doc.toString(),o=_t(this.node.textContent,n);if(o){const{text:s,from:i,to:a}=o,c=s?this.pmSchema.text(s):null,u=this.pmView.state.tr.replaceWith(i+t,a+t,c);this.pmView.dispatch(u)}this.forwardSelection()};update=e=>{if(e.type!==this.node.type)return!1;e.attrs.lang!==this.node.attrs.lang&&this.setLanguage(e.attrs.lang),e.attrs.isDarkMode!=null&&e.attrs.isDarkMode!==this.node.attrs.isDarkMode&&this.setTheme(e.attrs.isDarkMode),this.node=e;const t=_t(this.cm.state.doc.toString(),e.textContent);if(t){const{text:n,from:o,to:s}=t;this.updating=!0,this.cm.dispatch({changes:{from:o,to:s,insert:n}}),this.updating=!1}return!0};asProseMirrorSelection=e=>{const t=(this.getPos()??0)+2,{anchor:n,head:o}=this.cm.state.selection.main;return U.create(e,n+t,o+t)};forwardSelection=()=>{if(!this.cm.hasFocus)return;const{state:e}=this.pmView,t=this.asProseMirrorSelection(e.doc);t.eq(e.selection)||this.pmView.dispatch(e.tr.setSelection(t))};maybeEscape=(e,t)=>n=>{const{state:o}=n,{selection:s}=o,a=(()=>{const p=s.main.from,{number:m,from:f}=o.doc.lineAt(p);return{line:m,ch:p-f}})(),c=o.selection.ranges.some(p=>!p.empty),u=1,l=o.doc.lineAt(o.doc.length).number;if(c||a.line!==(t<0?u:l)||e==="char"&&a.ch!==(t<0?0:o.doc.line(a.line).length))return!1;const d=(this.getPos()??0)+(t<0?0:this.node.nodeSize),h=st.near(this.pmView.state.doc.resolve(d),t);return this.pmView.dispatch(this.pmView.state.tr.setSelection(h).scrollIntoView()),this.pmView.focus(),!0};setSelection=(e,t)=>{this.focus(),this.updating=!0,this.cm.dispatch({selection:{anchor:e,head:t}}),this.updating=!1};focus=()=>{this.cm.focus(),this.forwardSelection()};selectNode=()=>{this.focus()};stopEvent=()=>!0;destroy=()=>{this.cm.destroy()};_setIsCodeBlockView=()=>{this.cm.dom.dataset.isCodeBlockView="true"};static _getIsCodeBlockView=e=>e.dataset.isCodeBlockView==="true";static isInCodeBlockView(e){return e instanceof HTMLElement?e.closest("[data-is-code-block-view]")!=null:!1}}function Yo(r,e,t){try{return e instanceof U?U.create(r,e.anchor,e.head):e instanceof Pn?U.create(r,e.from,e.to):e instanceof bt?new bt(r):void 0}catch{return U.create(r,0)}}class qo extends F{unistNodeName(){return"blockquote"}static proseMirrorNodeName(){return"blockquote"}proseMirrorNodeSpec(){return{content:"block+",group:"block",parseDOM:[{tag:"blockquote"}],toDOM(){return["blockquote",0]}}}proseMirrorInputRules(e){return[tt(/^\s{0,3}>\s$/,e.nodes[this.proseMirrorNodeName()])]}proseMirrorKeymap(e){return{"Mod->":po(e.nodes[this.proseMirrorNodeName()])}}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:n}){return $(this.proseMirrorNodeName(),e,t,n)}proseMirrorNodeToUnistNodes(e,t){return[{type:this.unistNodeName(),children:t}]}}function Jo(r,e,t,n){for(let o=0;o<e.length;o++){let{$from:s,$to:i}=e[o],a=s.depth===0?r.inlineContent&&r.type.allowsMarkType(t):!1;if(r.nodesBetween(s.pos,i.pos,(c,u)=>{if(a||!n)return!1;a=c.inlineContent&&c.type.allowsMarkType(t)}),a)return!0}return!1}function Vt(r){return/^\s*/.exec(r)?.[0]?.length??0}function Ht(r){return/\s*$/.exec(r)?.[0]?.length??0}function Zo(r,e,t){for(;e>0;){const n=e-1;if(!r.rangeHasMark(n,e,t))break;e=n}return e}function Qo(r,e,t){for(;e<r.content.size&&r.rangeHasMark(e,e+1,t);)e+=1;return e}function br(r,e,t,n=null){const{selection:o}=r;if(!(o instanceof U))return!1;let{empty:s,$cursor:i,ranges:a}=o;if(s&&!i||!Jo(r.doc,a,t,!0))return!1;if(i)t.isInSet(r.storedMarks||i.marks())?e(r.tr.removeStoredMark(t)):e(r.tr.addStoredMark(t.create(n)));else{let c=r.tr;const u=!a.some(l=>r.doc.rangeHasMark(l.$from.pos,l.$to.pos,t));for(let l=0;l<a.length;l++){let{$from:d,$to:h}=a[l],p=d.pos,m=h.pos;const f=r.doc.textBetween(p,m,`
`);if(/^\s*$/.test(f))continue;const g=d.nodeBefore?.text??"",w=d.nodeAfter?.text??"",y=h.nodeBefore?.text??"",x=h.nodeAfter?.text??"";if(u){let E=Vt(w),b=Ht(y);p+E<m&&(p+=E,m-=b),p=Zo(r.doc,p,t),m=Qo(r.doc,m,t),c.removeMark(p,m,r.schema.marks[_e.proseMirrorMarkName()]),c.addMark(p,m,t.create(n))}else{const E=Ht(g),b=Vt(x);p-=E,m+=b,c.removeMark(p,m,t)}}e(c.scrollIntoView())}return!0}function zt(r,e=null){return(t,n)=>n?br(t,n,r,e):!0}class Z extends or{markType;constructor(e,t){super(e,(n,o,s,i)=>this.markHandler(n,o,s,i)),this.markType=t}static markApplies(e,t,n){for(const o of t){const{$from:s,$to:i}=o;let a=s.depth===0?e.type.allowsMarkType(n):!1;if(e.nodesBetween(s.pos,i.pos,c=>a?!1:(a=c.inlineContent&&c.type.allowsMarkType(n),!0)),a)return!0}return!1}markHandler(e,t,n,o){if(!(e.selection instanceof U))return null;const s=e.doc.resolve(n),i=e.doc.resolve(o),a=[new vn(s,i)];if(!Z.markApplies(e.doc,a,this.markType))return null;const c=e.doc.nodeAt(n)?.marks.map(l=>l.type)??[];c.push(this.markType);const u=e.tr.replaceWith(n,o,this.markType.schema.text(t[1]));for(const l of c)u.addMark(u.mapping.map(n),u.mapping.map(o),l.create(null));for(const l of c)u.removeStoredMark(l);return u.insertText(t[2])}}class Cr extends Ne{unistNodeName(){return"strong"}static proseMirrorMarkName(){return"strong"}proseMirrorMarkSpec(){return{parseDOM:[{tag:"b"},{tag:"strong"},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}],toDOM(){return["strong"]}}}proseMirrorInputRules(e){return[new Z(/\*\*([^\s](?:.*[^\s])?)\*\*([\s\S])$/,e.marks[this.proseMirrorMarkName()]),new Z(/__([^\s](?:.*[^\s])?)__([\s\S])$/,e.marks[this.proseMirrorMarkName()])]}proseMirrorKeymap(e){const t=e.marks[this.proseMirrorMarkName()];return{"Mod-b":zt(t),"Mod-B":zt(t)}}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:n}){return t.map(o=>o.mark(o.marks.concat([e.marks[this.proseMirrorMarkName()].create(n)])))}processConvertedUnistNode(e){return{type:this.unistNodeName(),children:[e]}}}const Sr=92,es=10,De="backslashEscape";function ts(r,e,t){function n(o){return o==null||o===es?(r.exit(De),e(o)):t(o)}return o=>o!==Sr?t(o):(r.enter(De),r.consume(o),n)}function rs(){return{text:{[Sr]:{name:De,tokenize:ts}}}}function ns(){const r=this.data();r.micromarkExtensions??=[],r.micromarkExtensions.push(rs()),r.fromMarkdownExtensions??=[],r.fromMarkdownExtensions.push({enter:{[De](e){this.enter({type:"break"},e),this.exit(e)}}})}class os extends F{unistNodeName(){return"break"}static proseMirrorNodeName(){return"hard_break"}proseMirrorNodeSpec(){return{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],marks:_e.proseMirrorMarkName(),toDOM(){return["br"]}}}proseMirrorKeymap(e){const t=Nr(ho,(o,s)=>(s&&s(o.tr.replaceSelectionWith(e.nodes[this.proseMirrorNodeName()].create()).scrollIntoView()),!0)),n=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;return{"Mod-Enter":t,"Shift-Enter":t,...n&&{"Ctrl-Enter":t}}}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:n}){return $(this.proseMirrorNodeName(),e,t,n)}proseMirrorNodeToUnistNodes(){return[{type:this.unistNodeName()}]}unifiedInitializationHook(e){return e.use(ns)}}const Le="code_block",jt="```\n";function ss(r,e){const{start:t,end:n}=r;return t==null||n==null?null:{start:t+jt.length+(e.lang??"").length,end:n-jt.length}}class Je extends F{dependencies(){return[new ae]}unistNodeName(){return"code"}static proseMirrorNodeName(){return Le}proseMirrorNodeSpec(){return{content:"text*",group:"block",code:!0,defining:!0,marks:[_e.proseMirrorMarkName()].join(" "),attrs:{lang:{default:null},isDarkMode:{default:null}},parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM(){return["pre",["code",0]]}}}proseMirrorInputRules(e){return[rn(/^\s{0,3}```$/,e.nodes[this.proseMirrorNodeName()])]}unistNodeToProseMirrorNodes({node:e,attrs:t,schema:n}){const{lang:o}=e;return $(this.proseMirrorNodeName(),n,sr(e,n,{...t,...ss(t,e)??{}}),{lang:o,...t})}proseMirrorNodeToUnistNodes(e,t){return[{type:this.unistNodeName(),value:t.map(n=>n.type==="startend"?n.children.map(o=>o.value).join(""):n.value).join(""),lang:e.attrs.lang}]}}class is extends F{unistNodeName(){return"thematicBreak"}static proseMirrorNodeName(){return"horizontal_rule"}proseMirrorNodeSpec(){return{group:"block",parseDOM:[{tag:"hr"}],toDOM(){return["div",["hr"]]}}}proseMirrorInputRules(e){return[new or(/^\s{0,3}(?:\*\*\*|---|___)\n$/,(t,n,o,s)=>t.tr.replaceWith(o,s,$(this.proseMirrorNodeName(),e,[])??[]))]}proseMirrorKeymap(e){return{"Mod-_":(t,n)=>(n&&n(t.tr.replaceSelectionWith(e.nodes[this.proseMirrorNodeName()].create()).scrollIntoView()),!0)}}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:n}){return $(this.proseMirrorNodeName(),e,t,n)}proseMirrorNodeToUnistNodes(){return[{type:this.unistNodeName()}]}}class as extends Ne{unistNodeName(){return"inlineCode"}static proseMirrorMarkName(){return"code"}proseMirrorMarkSpec(){return{inclusive:!1,parseDOM:[{tag:"code"}],toDOM(){return["code"]}}}proseMirrorInputRules(e){return[new Z(/`([^\s](?:.*[^\s])?)`([\s\S])$/,e.marks[this.proseMirrorMarkName()])]}proseMirrorKeymap(e){const t=e.marks[this.proseMirrorMarkName()];return{"Ctrl-`":Xe(t)}}unistNodeToProseMirrorNodes({node:e,schema:t,attrs:n}){const o=sr(e,t,n,[t.marks[this.proseMirrorMarkName()].create(n)]);return o?[o]:[]}processConvertedUnistNode(e){return{type:this.unistNodeName(),value:e.value}}}class Tr extends Ne{unistNodeName(){return"emphasis"}static proseMirrorMarkName(){return"em"}proseMirrorMarkSpec(){return{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style",getAttrs:e=>e==="italic"&&null}],toDOM(){return["em"]}}}proseMirrorInputRules(e){return[new Z(new RegExp("(?<!\\*)\\*([^\\s*](?:.*[^\\s])?)\\*([^*])$"),e.marks[this.proseMirrorMarkName()]),new Z(new RegExp("(?<!_)_([^\\s_](?:.*[^\\s])?)_([^_])$"),e.marks[this.proseMirrorMarkName()])]}proseMirrorKeymap(e){const t=e.marks[this.proseMirrorMarkName()];return{"Mod-i":Xe(t),"Mod-I":Xe(t)}}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:n}){return t.map(o=>o.mark(o.marks.concat([e.marks[this.proseMirrorMarkName()].create(n)])))}processConvertedUnistNode(e){return{type:this.unistNodeName(),children:[e]}}}function Pr(r){return"children"in r}const fe="lineEndingBlank";function $t(r){return r.type===fe}const cs=({startIndex:r,endIndex:e,depth:t,isLastChild:n,parent:o=null})=>{const s=e-r;return t>0&&o?.type!=="list"?s:n||r===0?s-Math.floor((s+1)/2):s-Math.floor((s-1)/2)};function ls(){const r=this.data();r.fromMarkdownExtensions??=[],r.fromMarkdownExtensions.push({enter:{lineEndingBlank(t){this.enter({type:fe},t)}},exit:{lineEndingBlank(t){this.exit(t)}}});const e=(t,n=0)=>{if(!Pr(t))return;const{children:o}=t;let s=0,i=null,a=null;const c=o.length;for(let u=0;u<c;u++){const l=o[u-s];e(l,n+1);const{type:d}=l,p=u===c-1&&d===fe;if(d===fe&&i==null?i=u:d!==fe&&i!=null?a=u:p&&i!=null&&(a=u+1),i!=null&&a!=null){const m=cs({startIndex:i,endIndex:a,depth:n,isLastChild:p,parent:t});o.splice(i-s,m),i=null,a=null,s+=m}}};return t=>{e(t)}}class us extends F{unistNodeName(){return fe}static proseMirrorNodeName(){return"paragraph"}proseMirrorNodeSpec(){return nn}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:n}){return $(this.proseMirrorNodeName(),e,t,n)}proseMirrorNodeToUnistNodes(e,t){return[{type:on,children:t}]}unifiedInitializationHook(e){return e.use(ls)}}function vr(r,e=null){return function(t,n){let{$from:o,$to:s}=t.selection,i=o.blockRange(s),a=!1,c=i;if(!i)return!1;if(i.depth>=2&&o.node(i.depth-1).type.compatibleContent(r)&&i.startIndex==0){if(o.index(i.depth-1)==0)return!1;let l=t.doc.resolve(i.start-2);c=new Ke(l,l,i.depth),i.endIndex<i.parent.childCount&&(i=new Ke(o,t.doc.resolve(s.end(i.depth)),i.depth)),a=!0}let u=An(c,r,e,i);return u?(n&&n(ds(t.tr,i,u,a,r).scrollIntoView()),!0):!1}}function ds(r,e,t,n,o){let s=B.empty;for(let l=t.length-1;l>=0;l--)s=B.from(t[l].type.create(t[l].attrs,s));r.step(new Ee(e.start-(n?2:0),e.end,e.start,e.end,new be(s,0,0),t.length,!0));let i=0;for(let l=0;l<t.length;l++)t[l].type==o&&(i=l+1);let a=t.length-i,c=e.start+t.length-(n?2:0),u=e.parent;for(let l=e.startIndex,d=e.endIndex,h=!0;l<d;l++,h=!1)!h&&pr(r.doc,c,a)&&(r.split(c,a),c+=2*a),c+=u.child(l).nodeSize;return r}function ps(r,e){return function(t,n){let{$from:o,$to:s,node:i}=t.selection;if(i&&i.isBlock||o.depth<2||!o.sameParent(s))return!1;let a=o.node(-1);if(a.type!=r)return!1;if(o.parent.content.size==0&&o.node(-1).childCount==o.indexAfter(-1)){if(o.depth==3||o.node(-3).type!=r||o.index(-2)!=o.node(-2).childCount-1)return!1;if(n){let d=B.empty,h=o.index(-1)?1:o.index(-2)?2:3;for(let w=o.depth-h;w>=o.depth-3;w--)d=B.from(o.node(w).copy(d));let p=o.indexAfter(-1)<o.node(-2).childCount?1:o.indexAfter(-2)<o.node(-3).childCount?2:3;d=d.append(B.from(r.createAndFill()));let m=o.before(o.depth-(h-1)),f=t.tr.replace(m,o.after(-p),new be(d,4-h,0)),g=-1;f.doc.nodesBetween(m,f.doc.content.size,(w,y)=>{if(g>-1)return!1;w.isTextblock&&w.content.size==0&&(g=y+1)}),g>-1&&f.setSelection(st.near(f.doc.resolve(g))),n(f.scrollIntoView())}return!0}let c=s.pos==o.end()?a.contentMatchAt(0).defaultType:null,u=t.tr.delete(o.pos,s.pos),l=c?[null,{type:c}]:void 0;return pr(u.doc,o.pos,2,l)?(n&&n(u.split(o.pos,2,l).scrollIntoView()),!0):!1}}function hs(r){return function(e,t){let{$from:n,$to:o}=e.selection,s=n.blockRange(o,i=>i.childCount>0&&i.firstChild.type==r);return s?t?n.node(s.depth-1).type==r?fs(e,t,r,s):ms(e,t,s):!0:!1}}function fs(r,e,t,n){let o=r.tr,s=n.end,i=n.$to.end(n.depth);s<i&&(o.step(new Ee(s-1,i,s,i,new be(B.from(t.create(null,n.parent.copy())),1,0),1,!0)),n=new Ke(o.doc.resolve(n.$from.pos),o.doc.resolve(i),n.depth));const a=Rn(n);if(a==null)return!1;o.lift(n,a);let c=o.mapping.map(s,-1)-1;return In(o.doc,c)&&o.join(c),e(o.scrollIntoView()),!0}function ms(r,e,t){let n=r.tr,o=t.parent;for(let p=t.end,m=t.endIndex-1,f=t.startIndex;m>f;m--)p-=o.child(m).nodeSize,n.delete(p-1,p+1);let s=n.doc.resolve(t.start),i=s.nodeAfter;if(n.mapping.map(t.end)!=t.start+s.nodeAfter.nodeSize)return!1;let a=t.startIndex==0,c=t.endIndex==o.childCount,u=s.node(-1),l=s.index(-1);if(!u.canReplace(l+(a?0:1),l+1,i.content.append(c?B.empty:B.from(o))))return!1;let d=s.pos,h=d+i.nodeSize;return n.step(new Ee(d-(a?1:0),h+(c?1:0),d+1,h-1,new be((a?B.empty:B.from(o.copy(B.empty))).append(c?B.empty:B.from(o.copy(B.empty))),a?0:1,c?0:1),a?0:1)),e(n.scrollIntoView()),!0}function gs(r){return function(e,t){let{$from:n,$to:o}=e.selection,s=n.blockRange(o,u=>u.childCount>0&&u.firstChild.type==r);if(!s)return!1;let i=s.startIndex;if(i==0)return!1;let a=s.parent,c=a.child(i-1);if(c.type!=r)return!1;if(t){let u=c.lastChild&&c.lastChild.type==a.type,l=B.from(u?r.create():null),d=new be(B.from(r.create(null,B.from(a.type.create(null,l)))),u?3:1,0),h=s.start,p=s.end;t(e.tr.step(new Ee(h-(u?3:1),p,h,p,d,1,!0)).scrollIntoView())}return!0}}class dt extends F{unistNodeName(){return"listItem"}static proseMirrorNodeName(){return"regular_list_item"}proseMirrorNodeSpec(){return{content:"paragraph block*",defining:!0,group:"list_item",parseDOM:[{tag:"li"}],toDOM(){return["li",0]}}}unistToProseMirrorTest(e){return e.type===this.unistNodeName()&&(!("checked"in e)||typeof e.checked!="boolean")}proseMirrorKeymap(e){const t=e.nodes[this.proseMirrorNodeName()];return{Enter:ps(t),"Shift-Tab":hs(t),Tab:gs(t)}}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:n}){return $(this.proseMirrorNodeName(),e,t,n)}proseMirrorNodeToUnistNodes(e,t){return[{type:this.unistNodeName(),children:t}]}}class Ms extends F{dependencies(){return[new dt]}unistNodeName(){return"list"}unistToProseMirrorTest(e){return e.type===this.unistNodeName()&&e.ordered===!0}static proseMirrorNodeName(){return"ordered_list"}proseMirrorNodeSpec(){return{content:"list_item+",group:"block",attrs:{spread:{default:!1},startingNumber:{default:1}},parseDOM:[{getAttrs(e){const t=e.getAttribute("start");return{spread:e.getAttribute("data-spread")==="true",startingNumber:t!=null?parseInt(t):1}},tag:"ol"}],toDOM(e){return["ol",{"data-spread":e.attrs.spread,start:e.attrs.startingNumber},0]}}}proseMirrorInputRules(e){return[tt(/^\s{0,3}(\d+)\.\s$/,e.nodes[this.proseMirrorNodeName()],t=>({startingNumber:+t[1]}),(t,n)=>n.childCount+n.attrs.startingNumber===+t[1])]}proseMirrorKeymap(e){return{"Shift-Mod-9":vr(e.nodes[this.proseMirrorNodeName()])}}unistNodeToProseMirrorNodes({node:e,schema:t,convertedChildren:n,attrs:o}){const{spread:s,start:i}=e;return $(this.proseMirrorNodeName(),t,n,{...o,spread:s,startingNumber:i??1})}proseMirrorNodeToUnistNodes(e,t){const n=e.attrs.spread;return[{type:this.unistNodeName(),ordered:!0,spread:n,start:e.attrs.startingNumber,children:t.map(o=>(o.spread=n,o))}]}}class Ns extends Ne{unistNodeName(){return"delete"}static proseMirrorMarkName(){return"strikethrough"}proseMirrorMarkSpec(){return{parseDOM:[{tag:"s"},{tag:"del"},{style:"text-decoration",getAttrs:e=>/(^|[\s])line-through([\s]|$)/.test(e)&&null}],toDOM(){return["s"]}}}proseMirrorInputRules(e){return[new Z(/~([^\s](?:.*[^\s~])?)~([^~])$/,e.marks[this.proseMirrorMarkName()]),new Z(/~~([^\s](?:.*[^\s])?)~~([\s\S])$/,e.marks[this.proseMirrorMarkName()])]}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t}){return t.map(n=>n.mark(n.marks.concat([e.marks[this.proseMirrorMarkName()].create()])))}processConvertedUnistNode(e){return{type:this.unistNodeName(),children:[e]}}}function ks(){return r=>{let e=-1;function t(o,s){if(o.type==="tableRow"&&e++,o.type==="tableCell"){const i=o;i.data={...i.data??{},rowIndex:e,columnIndex:s}}}function n(o){if(Pr(o))for(let s=0;s<o.children.length;s++){const i=o.children[s];t(i,s),n(i)}}n(r)}}class Ar extends F{unistNodeName(){return"tableCell"}unistToProseMirrorTest(e){return e.type===this.unistNodeName()}static proseMirrorNodeName(){return"table_cell"}proseMirrorNodeSpec(){return{content:"inline*",attrs:{rowIndex:{default:null},columnIndex:{default:null},colspan:{default:1},rowspan:{default:1}},tableRole:"cell",isolating:!0,parseDOM:[{tag:"td",getAttrs(e){const t=e;return{colspan:Ge(t.getAttribute("colspan"),1),rowspan:Ge(t.getAttribute("rowspan"),1)}}}],toDOM(e){const{colspan:t,rowspan:n}=e.attrs,o={colspan:t!==1?St(t,void 0):void 0,rowspan:n!==1?St(n,void 0):void 0};return[e.attrs.rowIndex==null||e.attrs.rowIndex>0?"td":"th",o,0]}}}proseMirrorInputRules(e){return[]}proseMirrorKeymap(e){return{}}unistNodeToProseMirrorNodes({node:e,schema:t,convertedChildren:n,attrs:o}){return $(this.proseMirrorNodeName(),t,n,{...o,colspan:1,rowspan:1,rowIndex:e.data?.rowIndex,columnIndex:e.data?.columnIndex})}proseMirrorNodeToUnistNodes(e,t){return[{type:this.unistNodeName(),children:t,data:{rowIndex:e.attrs.rowIndex,columnIndex:e.attrs.columnIndex}}]}}class Rr extends F{dependencies(){return[new Ar]}unistNodeName(){return"tableRow"}static proseMirrorNodeName(){return"table_row"}proseMirrorNodeSpec(){return{content:"(table_cell+)",tableRole:"row",parseDOM:[{tag:"tr"}],toDOM(){return["tr",0]}}}proseMirrorInputRules(e){return[]}proseMirrorKeymap(e){return{}}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:n}){return $(this.proseMirrorNodeName(),e,t,n)}proseMirrorNodeToUnistNodes(e,t){return[{type:this.unistNodeName(),children:t}]}}class ws extends F{dependencies(){return[new Rr]}unistNodeName(){return"table"}static proseMirrorNodeName(){return"table"}proseMirrorNodeSpec(){return{content:"(table_row+)",tableRole:"table",isolating:!0,group:"block",parseDOM:[{tag:"table"}],toDOM(){return["table",["tbody",0]]}}}proseMirrorInputRules(e){return[]}proseMirrorKeymap(e){return{}}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:n}){return $(this.proseMirrorNodeName(),e,t,n)}proseMirrorNodeToUnistNodes(e,t){return[{type:this.unistNodeName(),align:[],children:t}]}unifiedInitializationHook(e){return e.use(ks)}}class ys extends F{dependencies(){return[new dt]}unistNodeName(){return"list"}unistToProseMirrorTest(e){return e.type===this.unistNodeName()&&e.ordered!==!0}static proseMirrorNodeName(){return"list"}proseMirrorNodeSpec(){return{content:"list_item+",group:"block",attrs:{spread:{default:!1}},parseDOM:[{getAttrs(e){return{spread:e.getAttribute("data-spread")==="true"}},tag:"ul"}],toDOM(e){return["ul",{"data-spread":e.attrs.spread},0]}}}proseMirrorInputRules(e){return[tt(/^\s{0,3}([-+*])\s$/,e.nodes[this.proseMirrorNodeName()])]}proseMirrorKeymap(e){return{"Shift-Mod-8":vr(e.nodes[this.proseMirrorNodeName()])}}unistNodeToProseMirrorNodes({node:e,schema:t,convertedChildren:n,attrs:o}){const{spread:s}=e;return $(this.proseMirrorNodeName(),t,n,{...o,spread:s})}proseMirrorNodeToUnistNodes(e,t){const n=e.attrs.spread;return[{type:this.unistNodeName(),ordered:!1,spread:n,children:t.map(o=>(o.spread=n,o))}]}}function Ft(r,e){if(!(r==null||e==null))return{start:{...r},end:{...e}}}const xs=()=>r=>{_n(r,"list",(e,t,n)=>{if(n==null||t==null)return;const o=[];let s=[],i=0;for(;i<e.children.length;){const a=e.children[i];if($t(a)){const c=[];for(;i<e.children.length&&$t(e.children[i]);)c.push(e.children[i]),i++;if(s.length===0)throw new Error("Unexpected state: currentListItems is empty after encountering blank lines.");const u=s[0],l=Me(it(s)),d=Ft(u.position?.start??e.position?.start,l.position?.end??e.position?.end),h={type:"list",ordered:e.ordered,start:e.start,spread:e.spread,children:s,position:d};o.push(h),s=[],o.push(...c.map(p=>({type:"lineEndingBlank",position:p.position})))}else s.push(a),i++}if(s.length>0){const a=s[0],c=s[s.length-1],u=Ft(a.position?.start??e.position?.start,c.position?.end??e.position?.end),l={type:"list",ordered:e.ordered,start:e.start,spread:e.spread,children:s,position:u};o.push(l)}n.children.splice(t,1,...o)})};var Ut={}.hasOwnProperty;function Es(r,e){var t=e||{};function n(o){var s=n.invalid,i=n.handlers;if(o&&Ut.call(o,r)&&(s=Ut.call(i,o[r])?i[o[r]]:n.unknown),s)return s.apply(this,arguments)}return n.handlers=t.handlers||{},n.invalid=t.invalid,n.unknown=t.unknown,n}const bs={}.hasOwnProperty;function Ir(r,e){let t=-1,n;if(e.extensions)for(;++t<e.extensions.length;)Ir(r,e.extensions[t]);for(n in e)if(bs.call(e,n))switch(n){case"extensions":break;case"unsafe":{Wt(r[n],e[n]);break}case"join":{Wt(r[n],e[n]);break}case"handlers":{Cs(r[n],e[n]);break}default:r.options[n]=e[n]}return r}function Wt(r,e){e&&r.push(...e)}function Cs(r,e){e&&Object.assign(r,e)}const Ss=[Ts];function Ts(r,e,t,n){if(e.type==="code"&&It(e,n)&&(r.type==="list"||r.type===e.type&&It(r,n)))return!1;if("spread"in t&&typeof t.spread=="boolean")return r.type==="paragraph"&&(r.type===e.type||e.type==="definition"||e.type==="heading"&&mo(e,n))?void 0:t.spread?1:0}const se=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"],Ps=[{character:"	",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"	",before:"[\\r\\n]",inConstruct:"phrasing"},{character:"	",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"\r",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:`
`,inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:" ",after:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",before:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"!",after:"\\[",inConstruct:"phrasing",notInConstruct:se},{character:'"',inConstruct:"titleQuote"},{atBreak:!0,character:"#"},{character:"#",inConstruct:"headingAtx",after:`(?:[\r
]|$)`},{character:"&",after:"[#A-Za-z]",inConstruct:"phrasing"},{character:"'",inConstruct:"titleApostrophe"},{character:"(",inConstruct:"destinationRaw"},{before:"\\]",character:"(",inConstruct:"phrasing",notInConstruct:se},{atBreak:!0,before:"\\d+",character:")"},{character:")",inConstruct:"destinationRaw"},{atBreak:!0,character:"*",after:`(?:[ 	\r
*])`},{character:"*",inConstruct:"phrasing",notInConstruct:se},{atBreak:!0,character:"+",after:`(?:[ 	\r
])`},{atBreak:!0,character:"-",after:`(?:[ 	\r
-])`},{atBreak:!0,before:"\\d+",character:".",after:`(?:[ 	\r
]|$)`},{atBreak:!0,character:"<",after:"[!/?A-Za-z]"},{character:"<",after:"[!/?A-Za-z]",inConstruct:"phrasing",notInConstruct:se},{character:"<",inConstruct:"destinationLiteral"},{atBreak:!0,character:"="},{atBreak:!0,character:">"},{character:">",inConstruct:"destinationLiteral"},{atBreak:!0,character:"["},{character:"[",inConstruct:"phrasing",notInConstruct:se},{character:"[",inConstruct:["label","reference"]},{character:"\\",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"]",inConstruct:["label","reference"]},{atBreak:!0,character:"_"},{character:"_",inConstruct:"phrasing",notInConstruct:se},{atBreak:!0,character:"`"},{character:"`",inConstruct:["codeFencedLangGraveAccent","codeFencedMetaGraveAccent"]},{character:"`",inConstruct:"phrasing",notInConstruct:se},{atBreak:!0,character:"~"}];function vs(r){return r.label||!r.identifier?r.label||"":Ln(r.identifier)}function As(r){if(!r._compiled){const e=(r.atBreak?"[\\r\\n][\\t ]*":"")+(r.before?"(?:"+r.before+")":"");r._compiled=new RegExp((e?"("+e+")":"")+(/[|\\{}()[\]^$+*?.-]/.test(r.character)?"\\":"")+r.character+(r.after?"(?:"+r.after+")":""),"g")}return r._compiled}function Rs(r,e,t){const n=e.indexStack,o=r.children||[],s=[];let i=-1,a=t.before;n.push(-1);let c=e.createTracker(t);for(;++i<o.length;){const u=o[i];let l;if(n[n.length-1]=i,i+1<o.length){let d=e.handle.handlers[o[i+1].type];d&&d.peek&&(d=d.peek),l=d?d(o[i+1],r,e,{before:"",after:"",...c.current()}).charAt(0):""}else l=t.after;s.length>0&&(a==="\r"||a===`
`)&&u.type==="html"&&(s[s.length-1]=s[s.length-1].replace(/(\r?\n|\r)$/," "),a=" ",c=e.createTracker(t),c.move(s.join(""))),s.push(c.move(e.handle(u,r,e,{...c.current(),before:a,after:l}))),a=s[s.length-1].slice(-1)}return n.pop(),s.join("")}function Is(r,e,t){const n=e.indexStack,o=r.children||[],s=e.createTracker(t),i=[];let a=-1;for(n.push(-1);++a<o.length;){const c=o[a];n[n.length-1]=a,i.push(s.move(e.handle(c,r,e,{before:`
`,after:`
`,...s.current()}))),c.type!=="list"&&(e.bulletLastUsed=void 0),a<o.length-1&&i.push(s.move(Os(c,o[a+1],r,e)))}return n.pop(),i.join("")}function Os(r,e,t,n){let o=n.join.length;for(;o--;){const s=n.join[o](r,e,t,n);if(s===!0||s===1)break;if(typeof s=="number")return`
`.repeat(1+s);if(s===!1)return`

<!---->

`}return`

`}const Bs=/\r?\n|\r/g;function Ds(r,e){const t=[];let n=0,o=0,s;for(;s=Bs.exec(r);)i(r.slice(n,s.index)),t.push(s[0]),n=s.index+s[0].length,o++;return i(r.slice(n)),t.join("");function i(a){t.push(e(a,o,!a))}}function _s(r,e,t){const n=(t.before||"")+(e||"")+(t.after||""),o=[],s=[],i={};let a=-1;for(;++a<r.unsafe.length;){const l=r.unsafe[a];if(!go(r.stack,l))continue;const d=r.compilePattern(l);let h;for(;h=d.exec(n);){const p="before"in l||!!l.atBreak,m="after"in l,f=h.index+(p?h[1].length:0);o.includes(f)?(i[f].before&&!p&&(i[f].before=!1),i[f].after&&!m&&(i[f].after=!1)):(o.push(f),i[f]={before:p,after:m})}}o.sort(Ls);let c=t.before?t.before.length:0;const u=n.length-(t.after?t.after.length:0);for(a=-1;++a<o.length;){const l=o[a];l<c||l>=u||l+1<u&&o[a+1]===l+1&&i[l].after&&!i[l+1].before&&!i[l+1].after||o[a-1]===l-1&&i[l].before&&!i[l-1].before&&!i[l-1].after||(c!==l&&s.push(Kt(n.slice(c,l),"\\")),c=l,/[!-/:-@[-`{-~]/.test(n.charAt(l))&&(!t.encode||!t.encode.includes(n.charAt(l)))?s.push("\\"):(s.push("&#x"+n.charCodeAt(l).toString(16).toUpperCase()+";"),c++))}return s.push(Kt(n.slice(c,u),t.after)),s.join("")}function Ls(r,e){return r-e}function Kt(r,e){const t=/\\(?=[!-/:-@[-`{-~])/g,n=[],o=[],s=r+e;let i=-1,a=0,c;for(;c=t.exec(s);)n.push(c.index);for(;++i<n.length;)a!==n[i]&&o.push(r.slice(a,n[i])),o.push("\\"),a=n[i];return o.push(r.slice(a)),o.join("")}function Vs(r){const e=r||{},t=e.now||{};let n=e.lineShift||0,o=t.line||1,s=t.column||1;return{move:c,current:i,shift:a};function i(){return{now:{line:o,column:s},lineShift:n}}function a(u){n+=u}function c(u){const l=u||"",d=l.split(/\r?\n|\r/g),h=d[d.length-1];return o+=d.length-1,s=d.length===1?s+h.length:1+h.length+n,l}}function Hs(r,e={}){const t={enter:o,indentLines:Ds,associationId:vs,containerPhrasing:Fs,containerFlow:Us,createTracker:Vs,compilePattern:As,safe:Ws,stack:[],unsafe:[...Ps],join:[...Ss],handlers:{...Mo},options:{},indexStack:[],handle:void 0};Ir(t,e),t.options.tightDefinitions&&t.join.push($s),t.handle=Es("type",{invalid:zs,unknown:js,handlers:t.handlers});let n=t.handle(r,void 0,t,{before:`
`,after:`
`,now:{line:1,column:1},lineShift:0});return n&&n.charCodeAt(n.length-1)!==10&&n.charCodeAt(n.length-1)!==13&&(n+=`
`),n;function o(s){return t.stack.push(s),i;function i(){t.stack.pop()}}}function zs(r){throw new Error("Cannot handle value `"+r+"`, expected node")}function js(r){const e=r;throw new Error("Cannot handle unknown node `"+e.type+"`")}function $s(r,e){if(r.type==="definition"&&r.type===e.type)return 0}function Fs(r,e){return Rs(r,this,e)}function Us(r,e){return Is(r,this,e)}function Ws(r,e){return _s(this,r,e)}const Ks=(r,e,t,n)=>r.children.map(o=>t.handle(o,void 0,t,n)).join(""),Gs=(r,e,t,n)=>t.safe(r.value,n).replaceAll("\\[","[").replaceAll("\\&","&");function Xs(){const r=this;r.compiler=e;function e(t){return Hs(t,{...r.data("settings"),fences:!0,bullet:"-",bulletOther:"*",listItemIndent:"one",resourceLink:!0,tightDefinitions:!0,rule:"-",handlers:{text:Gs,startend:Ks},extensions:r.data("toMarkdownExtensions")||[]})}}class Ys extends Mn{dependencies(){return[new us,new ir,new qo,new Cr,new os,new Je,new ar,new is,new as,new Tr,new wr,new dt,new Ms,new cr,new ae,new ys,new Ns,new _e,new ws,new Rr,new Ar]}unifiedInitializationHook(e){return e.use(Vn).use(No).use(xs).use(Xs)}}class qs{rules;constructor(e,t){this.rules=[].concat.apply([],e.syntaxExtensions().map(n=>n.proseMirrorInputRules(t)))}build(){return sn({rules:this.rules})}}class Js{keymap;constructor(e,t){this.keymap=new Map;for(const n of e.syntaxExtensions())this.addKeymap(n.proseMirrorKeymap(t));this.addKeymap(fo)}build(){const e={};return this.keymap.forEach((t,n)=>{e[n]=Nr(...t)}),ct(e)}addKeymap(e){for(const t in e)this.keymap.get(t)||this.keymap.set(t,[]),Me(this.keymap.get(t)).push(e[t])}}class Zs{nodeViews;constructor(e){this.nodeViews={};for(const t of e.nodeExtensions()){const n=t.proseMirrorNodeName(),o=t.proseMirrorNodeView();n!=null&&o!=null&&(this.nodeViews[n]=o)}}build(){return this.nodeViews}}class Qs{nodes={};marks={};constructor(e){for(const t of e.nodeExtensions()){const n=t.proseMirrorNodeName(),o=t.proseMirrorNodeSpec();n!=null&&o!=null&&(n!=="text"&&(o.attrs={...o.attrs,start:{default:void 0},end:{default:void 0}}),this.nodes[n]=o)}for(const t of e.markExtensions()){const n=t.proseMirrorMarkName(),o=t.proseMirrorMarkSpec();n!=null&&o!=null&&(this.marks[n]=o)}}build(){return new On({nodes:this.nodes,marks:this.marks})}}class ei{extensionManager;constructor(e){this.extensionManager=e}build(){let e=Hn();for(const t of this.extensionManager.extensions())e=t.unifiedInitializationHook(e);return e}}function ti(r){return r instanceof F}function ri(r){return r instanceof Ne}class ni{markExtensionList;nodeExtensionList;otherExtensionList;constructor(e){this.markExtensionList=new Map,this.nodeExtensionList=new Map,this.otherExtensionList=new Map;for(const t of e)this.add(t)}extensions(){return this.syntaxExtensions().concat(Array.from(this.otherExtensionList.values()))}markExtensions(){return Array.from(this.markExtensionList.values())}getMarkExtension(e){return this.markExtensionList.get(e)??null}nodeExtensions(){return Array.from(this.nodeExtensionList.values())}getNodeExtension(e){return this.nodeExtensionList.get(e)??null}syntaxExtensions(){return this.nodeExtensions().concat(this.markExtensions())}add(e){for(const t of e.dependencies())this.add(t);if(ri(e)){this.markExtensionList.set(e.constructor.name,e);return}if(ti(e)){this.nodeExtensionList.set(e.constructor.name,e);return}this.otherExtensionList.set(e.constructor.name,e)}}class oi{extensionManager;constructor(e){this.extensionManager=e}convert(e){const t=this.convertNode(e);if(t.length!==1)throw new Error("Couldn't find any way to convert the root ProseMirror node.");return t[0]}convertNode(e){let t=null;const n=[];for(const o of this.extensionManager.nodeExtensions()){if(!o.proseMirrorToUnistTest(e))continue;n.push(o);let s=[];for(let i=0;i<e.childCount;++i)s=s.concat(this.convertNode(e.child(i)));t=o.proseMirrorNodeToUnistNodes(e,s)}return t==null?(console.warn(`Couldn't find any way to convert ProseMirror node of type "`+e.type.name+'" to a unist node.'),[]):t.map(o=>{for(const s of e.marks){const{type:{name:i}}=s;if(n.some(u=>{const l=u.proseMirrorNodeSpec()?.marks;return l!=null&&!l.includes(i)}))continue;let c=!1;for(const u of this.extensionManager.markExtensions())s.type.name===u.proseMirrorMarkName()&&(o=u.processConvertedUnistNode(o,s),c=!0);c||console.warn(`Couldn't find any way to convert ProseMirror mark of type "`+i+'" to a unist node.')}return o})}}class pt{extensionManager;proseMirrorSchema;constructor(e,t){this.extensionManager=e,this.proseMirrorSchema=t}static unistNodeIsParent(e){return"children"in e}convert(e){const t={},n=this.convertNode(e,t);for(const o of this.extensionManager.syntaxExtensions())o.postUnistToProseMirrorHook(t);if(n.length!==1)throw new Error("Couldn't find any way to convert the root unist node.");return n[0]}convertNode(e,t){let n=0;const o=(s,i)=>{for(const a of this.extensionManager.syntaxExtensions()){if(!a.unistToProseMirrorTest(s))continue;let c=[];pt.unistNodeIsParent(s)&&(c=s.children.flatMap(m=>o(m,i)));const{position:u}=s;let l=u?.start.offset??n,d=u?.end.offset;if(d==null&&"value"in s&&typeof s.value=="string"){const{value:m}=s;d=l+m.length}d==null&&(d=l),n=d;const h={start:l,end:d};return zn(a.unistNodeToProseMirrorNodes({node:s,schema:this.proseMirrorSchema,convertedChildren:c,context:i,attrs:h})).filter(jn)}return console.warn(`Couldn't find any way to convert unist node of type "`+s.type+'" to a ProseMirror node.'),[]};return o(e,t)}}const si=5;class ii{builtSchema;inputRulesBuilder;keymapBuilder;nodeViewBuilder;unistToProseMirrorConverter;proseMirrorToUnistConverter;unified;memoizedProsemirrorDocs=new Map;constructor(e=[]){const t=new ni(e);this.builtSchema=new Qs(t).build(),this.inputRulesBuilder=new qs(t,this.builtSchema),this.keymapBuilder=new Js(t,this.builtSchema),this.nodeViewBuilder=new Zs(t),this.unistToProseMirrorConverter=new pt(t,this.builtSchema),this.proseMirrorToUnistConverter=new oi(t),this.unified=new ei(t).build()}parse(e){try{if(this.memoizedProsemirrorDocs.has(e))return Me(this.memoizedProsemirrorDocs.get(e));const t=this.unistToProseMirrorConverter.convert(this.parseUnist(e));if(this.memoizedProsemirrorDocs.set(e,t),this.memoizedProsemirrorDocs.size>si){const n=this.memoizedProsemirrorDocs.keys().next().value;this.memoizedProsemirrorDocs.delete(n)}return t}catch(t){R.logError("Failed to parse document",t)}return this.schema().text(" ")}parseUnist(e){return this.unified.runSync(this.unified.parse(e))}schema(){return this.builtSchema}inputRulesPlugin(){return this.inputRulesBuilder.build()}keymapPlugin(){return this.keymapBuilder.build()}nodeViews(){return this.nodeViewBuilder.build()}serialize(e){const t=this.proseMirrorToUnistConverter.convert(e);return this.unified.stringify(t)}}let Gt=null;function ce(){return Gt??=new ii([new Ys]),Gt}const Xt=(r,e)=>{if(!e)return!1;const[t,n]=e;return r>=t&&r<n},$e=r=>{const e=new Map;r.descendants((o,s)=>{const i=Et(o);if(!i)return;const{start:a,end:c}=i,u=o.type.name,{depth:l}=r.resolve(s);if(e.set(s,{pmPos:s,sourcePos:a,leafSourceRange:o.isBlock?void 0:[a,c],depth:l,nodeTypeName:u,isClose:!1,parentNodeTypeNameStack:[]}),o.isBlock){const d=s+o.nodeSize-1;e.set(d,{pmPos:d,sourcePos:c,depth:r.resolve(d).depth,nodeTypeName:u,isClose:!0,parentNodeTypeNameStack:[]})}if(o.isText)for(let d=0;d<(o.text?.length??0);d++){const h=s+d;e.set(h,{pmPos:h,sourcePos:a+d,depth:l,nodeTypeName:u,isClose:!1,parentNodeTypeNameStack:[]})}}),e.set(r.content.size,{pmPos:r.content.size,nodeTypeName:r.type.name,depth:0,isClose:!0,sourcePos:Me(Et(r)).end,parentNodeTypeNameStack:[]});const t=Array.from(e.entries()).sort(([o],[s])=>o-s).map(([,o])=>o),n=[cr.proseMirrorNodeName()];for(const o of t)o.isClose?(o.parentNodeTypeNameStack=n.concat(),n.pop()):(o.parentNodeTypeNameStack=n.concat(),o.nodeTypeName!==ae.proseMirrorNodeName()&&it(n)!==o.nodeTypeName&&n.push(o.nodeTypeName));return{positions:t,pmRangeToSourceRange:({start:o,end:s})=>({start:t[Math.max(o,0)].sourcePos,end:t[Math.min(s,t.length-1)].sourcePos}),sourceRangeToPmRange:o=>{let s=[],i=[];const{start:a,end:c}=o,u=t[t.length-1].sourcePos,l=Math.min(Math.max(a,0),u),d=Math.min(Math.max(c,0),u),h=f=>{s.push(f)},p=f=>{i.push(f)};for(let f=0;f<t.length;f++){const g=t[f],{sourcePos:w,leafSourceRange:y,isClose:x=!1}=g;if(w>d)break;const E=t[f+1]??null,b=k=>{let M=t[k];if(M==null)return k;let S=t[k+1],{leafSourceRange:v}=M;for(;M.nodeTypeName!==ae.proseMirrorNodeName()&&!M.isClose&&S!=null&&!Xt(l,v);)h(S),M=S,S=t[k+2],v=M.leafSourceRange,k++;return k};if(w===l&&!x||Xt(l,y))h(g),f=b(f);else if(w<=l&&(E?.sourcePos??Number.POSITIVE_INFINITY)>=l){let k=f+1;const M=[];for(;t[k]?.isClose===!0;)M.push(k),k++;if(t[k]){const{sourcePos:S}=t[k];do h(t[k]);while(t[++k].sourcePos===S);k=b(k-1)}else{(w===l||x)&&h(g);for(const S of M)h(t[S])}f=k}}for(let f=0;f<t.length;f++){const g=t[f],{sourcePos:w}=g;if(w>d)break;const y=t[f-1]??null,x=t[f+1]??null,E=d>w&&d<(x?.sourcePos??-1),b=g.nodeTypeName===ae.proseMirrorNodeName();if(w===d||E&&!b){if(g.isClose&&!y?.isClose&&g.nodeTypeName===y.nodeTypeName||!g.isClose&&x.isClose&&g.nodeTypeName===x.nodeTypeName||g.isClose&&y?.isClose||!g.isClose&&y!=null&&y?.nodeTypeName!==ae.proseMirrorNodeName()){p(y);let v=f-2,A=t[v];for(;v>=0&&A.isClose;)p(A),A=t[--v]}let k=f,M=g,S=M;do p(M),S=M,M=t[++k];while(M?.sourcePos===d||M?.depth<S?.depth);break}else if(E&&b){let k=f+1,M=t[k];for(;M?.isClose;)p(M),M=t[++k];break}}const m=(f,g)=>f.pmPos-g.pmPos;return{start:s.sort(m),end:i.sort(m)}}}},ai=(r,e,t,n)=>{const o=[];for(const s of e)for(const i of t)o.push({from:s,to:i,parentNodeNamesAtStart:s.parentNodeTypeNameStack,slice:r.slice(s.pmPos,i.pmPos)});return o.sort((s,i)=>{const a=Math.abs(s.from.sourcePos-n.start)+Math.abs(s.to.sourcePos-n.end),c=Math.abs(i.from.sourcePos-n.start)+Math.abs(i.to.sourcePos-n.end);return a===c?i.slice.size-s.slice.size:a-c}),o},ci=(r,e)=>Wr(r.parentNodeNamesAtStart,e.parentNodeTypeNameStack),Yt=new WeakMap,li=({diff:r})=>{const e=new $n(Fn.GetDiffedDoc,{debug:!1});e.startBlock("get_diffed_doc");const t=ce(),{contentAfter:n,contentBefore:o,edits:s}=r,i=t.parse(n),a=t.parse(o),c=s.concat().sort((y,x)=>y.positionBefore.start-x.positionBefore.start),u=[],l=[];e.startBlock("init_position_transformers");const{sourceRangeToPmRange:d}=$e(a),{sourceRangeToPmRange:h}=$e(i);e.endBlock("init_position_transformers");let p=a,m=0,f=0;const g=[],w=(y,x,E)=>{for(const[b,k]of E.entries())try{if(!ci(x,k))continue;const{pmPos:M}=k,{slice:S}=x;return p=p.replace(M,M,S),u.push({editId:y,start:M,end:M+S.size}),[b,k]}catch(M){g.push(M)}return null};for(let y=0;y<c.length;y++){const{id:x,positionBefore:E,positionAfter:b}=c[y];e.startBlock("transform_positions");const k=d(E),M=h(b);e.endBlock("transform_positions");const{start:S,end:v}=k,{start:A,end:_}=M,P=b.start!==b.end,K=P?ai(i,A,_,b):null;e.startBlock("get_merged_doc_positions");const{positions:Y}=$e(p);e.endBlock("get_merged_doc_positions");const D=Math.max(...S.map(({pmPos:z})=>z)),V=Math.min(...v.map(({pmPos:z})=>z)),ue=[].concat(v).concat(S),ee=E.start!==E.end&&a.textBetween(D,V).length>0;let j=!1;if(ee&&!P)l.push({editId:x,start:D+m,end:V+m}),j=!0;else if(!ee&&!P)j=!0;else{const z=ue.map(({pmPos:H})=>Y[H+m]);for(const H of K??[]){const L=w(x,H,z);if(L==null)continue;const te=L[0],de=H.slice.size,ke=te<v.length;ke||(m+=de),ee&&l.push({editId:x,start:D+m,end:V+m}),ke&&(m+=de),j=!0;break}}if(!j&&K!=null){const H=Math.min(...S.map(({pmPos:L})=>L))+m-1;for(const L of K)try{p=p.replace(H,H,L.slice),u.push({editId:x,start:H,end:H+L.slice.size}),m+=L.slice.size,ee&&l.push({editId:x,start:D+m,end:V+m}),j=!0;break}catch(te){g.push(te)}}j?R.logEvent(ne.canvasDiffEditSuccess):(R.logEvent(ne.canvasDiffEditFail),R.logError("Failed to insert edit for diffed doc",it(g),{errors:g.map(Un),replaceFromCandidates:S,replaceToCandidates:v,sliceFromCandidates:A,sliceToCandidates:_}),f++)}return R.logDistribution(ne.canvasDiffEditSuccessRatio,(c.length-f)/c.length),R.logDistribution(ne.canvasDiffEditFailCount,f),R.logDistribution(ne.canvasDiffEditSuccessCount,c.length-f),R.logDistribution(ne.canvasDiffEditCount,c.length),e.endBlock("get_diffed_doc"),{doc:p,addedRanges:u,deletedRanges:l}},ui=({diff:r})=>{const e=Yt.get(r);if(e!=null)return e;const t=li({diff:r});return Yt.set(r,t),t},Pe=new Q("focus"),di=(r,e)=>new X({key:Pe,state:{init:()=>!1,apply(t,n){const o=t.getMeta(Pe);return typeof o=="boolean"?o:n}},props:{handleDOMEvents:{blur:(t,n)=>{const{relatedTarget:o}=n;return o!=null&&ut.isInCodeBlockView(o)||(e(n),t.dispatch(t.state.tr.setMeta(Pe,!1))),!1},focus:(t,n)=>(r(n),t.dispatch(t.state.tr.setMeta(Pe,!0)),!1)}}});function Or(r,e){const t=e&&r.dom?.querySelectorAll(`[data-edit-id="${e}"]`);return t?Array.from(t):[]}function pi(r,e){return Or(r,e).flatMap(n=>Array.from(n.getClientRects()))}function Ze(r,e,t){return r>=t.left&&r<=t.right&&e>=t.top&&e<=t.bottom}function Br(r){const e=Math.min(...r.map(s=>s.left)),t=Math.max(...r.map(s=>s.right)),n=Math.min(...r.map(s=>s.top)),o=Math.max(...r.map(s=>s.bottom));return{left:e,right:t,top:n,bottom:o}}function hi(r,e,t){return t.some(o=>Ze(r,e,o))?!0:t.length<2?!1:t.some(o=>r>=o.left&&r<=o.right&&e>o.bottom)&&t.some(o=>r>=o.left&&r<=o.right&&e<o.top)}const fi=new Q("linkTooltip"),mi=36;class gi{tooltipElement;button;onMouseLeave;constructor(e){this.tooltipElement=document.createElement("div"),this.tooltipElement.className=W("absolute  py-1.5 px-2.5 bg-token-main-surface-primary border border-token-border-light rounded-lg text-xs z-50 items-center cursor-pointer shadow-md flex justify-center cursor-pointer","transform -translate-x-1/2"),this.button=document.createElement("button"),this.button.textContent="Open link",this.button.className=W("bg-none","border-none","text-token-text-primary ","text-sm"),this.tooltipElement.appendChild(this.button),this.onMouseLeave=e,this.tooltipElement.addEventListener("mouseleave",e)}show(e,t,n){document.body.appendChild(this.tooltipElement),this.tooltipElement.style.left=`${e}px`,this.tooltipElement.style.top=`${t}px`;const o=()=>{window.open(n,"_blank"),this.hide()};this.button.addEventListener("click",o,{once:!0})}hide(){this.tooltipElement.parentNode&&this.tooltipElement.parentNode.removeChild(this.tooltipElement)}}function Mi(){let r=null,e=null;const t=s=>{if(r==null||e==null)return!1;const i=Array.from(e.getClientRects()),a=r.tooltipElement.getBoundingClientRect();if(i.length===1){const c=i[0];return!Ze(s.clientX,s.clientY,Br([c,a]))}else return!hi(s.clientX,s.clientY,[a,...i])},n=(s,i)=>{r&&(r.hide(),r=null);const a=s.getAttribute("href");if(!a)return;const c=Array.from(s.getClientRects()),u=c.find(h=>Ze(i.clientX,i.clientY,h))??c[0],l=u.left+u.width/2,d=u.top-mi;r=new gi(h=>{t(h)&&o()}),r.show(l,d,a),e=s},o=()=>{r&&(r.hide(),r=null),e=null};return new X({key:fi,props:{handleDOMEvents:{mousemove(s,i){const a=()=>{const{target:u}=i;if(!(u instanceof HTMLElement))return!1;const l=u.closest("a[href]");return l!=null&&l!==e?(n(l,i),!0):!1},c=()=>{r==null||!t(i)||o()};a()||c()}}},view:()=>({destroy:o})})}function Dr(r){return ce().serialize(r).length}const Ni=new Q("maxLength"),ki=(r,e,t)=>new X({key:Ni,state:{init(){return t},apply:()=>{}},filterTransaction(n){if(r==null||!n.steps.some(i=>i instanceof Bn||i instanceof Ee?i.slice.size>i.to-i.from:!1))return!0;const s=Dr(n.doc);return s<=t?!0:(e&&at(e,r,t),R.logEvent(ne.canvasProsemirrorMaxLength,{maxLength:t,newLength:s}),!1)}});function wi(r={}){return new X({view(e){return new yi(e,r)}})}class yi{constructor(e,t){var n;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(n=t.width)!==null&&n!==void 0?n:1,this.color=t.color===!1?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map(o=>{let s=i=>{this[o](i)};return e.dom.addEventListener(o,s),{name:o,handler:s}})}destroy(){this.handlers.forEach(({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t))}update(e,t){this.cursorPos!=null&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),t=!e.parent.inlineContent,n;if(t){let a=e.nodeBefore,c=e.nodeAfter;if(a||c){let u=this.editorView.nodeDOM(this.cursorPos-(a?a.nodeSize:0));if(u){let l=u.getBoundingClientRect(),d=a?l.bottom:l.top;a&&c&&(d=(d+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),n={left:l.left,right:l.right,top:d-this.width/2,bottom:d+this.width/2}}}}if(!n){let a=this.editorView.coordsAtPos(this.cursorPos);n={left:a.left-this.width/2,right:a.left+this.width/2,top:a.top,bottom:a.bottom}}let o=this.editorView.dom.offsetParent;this.element||(this.element=o.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",t),this.element.classList.toggle("prosemirror-dropcursor-inline",!t);let s,i;if(!o||o==document.body&&getComputedStyle(o).position=="static")s=-pageXOffset,i=-pageYOffset;else{let a=o.getBoundingClientRect();s=a.left-o.scrollLeft,i=a.top-o.scrollTop}this.element.style.left=n.left-s+"px",this.element.style.top=n.top-i+"px",this.element.style.width=n.right-n.left+"px",this.element.style.height=n.bottom-n.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),n=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),o=n&&n.type.spec.disableDropCursor,s=typeof o=="function"?o(this.editorView,t,e):o;if(t&&!s){let i=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=Dn(this.editorView.state.doc,i,this.editorView.dragging.slice);a!=null&&(i=a)}this.setCursor(i),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){(e.target==this.editorView.dom||!this.editorView.dom.contains(e.relatedTarget))&&this.setCursor(null)}}function ve(r){return(e,t,n)=>{const{doc:o,selection:s}=e,{empty:i,$head:a}=s;if(i&&n?.endOfTextblock(r)){const c=r==="left"||r==="up"?-1:1,u=st.near(o.resolve(c>0?a.after():a.before()),c);if(u.$head?.parent.type.name===Le)return t?.(e.tr.setSelection(u)),!0}return!1}}const xi=ct({ArrowLeft:ve("left"),ArrowRight:ve("right"),ArrowUp:ve("up"),ArrowDown:ve("down")}),ht=new Q("modelCursor");function Ei(r,e){return r.setMeta(ht,{modelCursor:e})}function bi(r){return r.getMeta(ht)??null}const qt=(r,e)=>{const{doc:t}=r,n=[],{modelSelectionPositionRange:o,modelCursorPosition:s}=e??{};if(s!=null){const i=Mt(t,[s])[0];if(Re(t,i)){const a=t.resolve(i);if(t.nodeAt(i)?.type.name===Je.proseMirrorNodeName()||a.nodeBefore?.type.name===Je.proseMirrorNodeName())return J.empty}n.push(ge.widget(i,()=>{const a=document.createElement("span");return a.className=an.modelCursor,a},{ignoreSelection:!0,side:1}))}else if(o!=null){const[i,a]=Mt(r.doc,[o.start,o.end]);n.push(ge.inline(i,a,{class:`${Wn} !bg-[Highlight]`}))}return n.length?J.create(t,n):J.empty};function Ci(r=void 0){return new X({key:ht,state:{init:(e,t)=>({modelCursor:r,deco:qt(t,r)}),apply:(e,t,n,o)=>{const i=bi(e)?.modelCursor??t.modelCursor;return{modelCursor:i,deco:qt(o,i)}}},props:{decorations(e){return this.getState(e)?.deco}}})}const _r="ignoreDocChange";function Si(r){return r.setMeta(_r,!0)}function Ti(r){return r.getMeta(_r)===!0}function Pi(r){const e=r.content.size-(r.lastChild?.content.size??0)-1;if(Re(r,e))return U.create(r,e)}const Lr=({intl:r,toaster:e,value:t,comments:n,diff:o,maxLength:s=mr,selection:i,onFocus:a,onBlur:c,onSave:u,safeUrls:l,modelCursor:d,isDisabled:h})=>{const p=ce(),m=p.schema();let f=t;s!=null&&f.length>s&&(f=f.slice(0,s),e!=null&&r!=null&&at(e,r,s));let g,w=[],y=[];o&&o.edits.length>0?{doc:g,addedRanges:w,deletedRanges:y}=ui({diff:o}):g=p.parse(f);const x=i?Yo(g,i):Pi(g);return hr.create({doc:g,schema:m,selection:x,plugins:[ki(r,e,s),p.inputRulesPlugin(),p.keymapPlugin(),ct({"Mod-s":()=>(u(),!0),"Mod-z":xo,"Mod-shift-z":Ot,"Mod-y":Ot}),xi,wi(),ko(),wo(),di(a,c),lr(n??[]),...o?[jo(w,y)]:[],Ci(d),Oo(new Set(l??[])),_o(r,h),Mi(),...Wo()]})},Vr=(r,e)=>{const t=ce(),n=t.schema(),o=t.parse(r);return hr.create({doc:o,schema:n,plugins:[lr(e??[])]})},vi=({mount:r,value:e,comments:t,isDarkMode:n})=>new fr({mount:r},{editable:()=>!1,state:Vr(e,t),nodeViews:{[Le]:(s,i,a)=>new ut(s,i,a,n)}}),Ai=(r,{intl:e,toaster:t,comments:n,value:o,maxLength:s=mr,onBlur:i,onFocus:a,onChange:c,onUpdate:u,onSave:l,safeUrls:d,modelCursor:h,selection:p,isDisabled:m,diff:f},g=!1)=>{const w=Lr({intl:e,toaster:t,comments:n,value:o,maxLength:s,onBlur:i,onFocus:a,onSave:l,safeUrls:d,modelCursor:h,selection:p,isDisabled:m,diff:f});u(w);const y=E=>{const b=x.state.apply(E);if(x.updateState(b),u(b),!E.docChanged||Ti(E))return;const k=xr(b);if(!k)return;const{doc:M}=b,{changeset:S}=k;c?.({transaction:E,changeset:S,doc:M,getSerializedDocument:()=>ce().serialize(M),getAdjustedComments:()=>{const v=cn(ur,b);if(v==null)return[];const A=ce(),_=A.parse(A.serialize(M)),P=Nn(_,v.positions);return kn(v.comments,P)}})},x=new fr({mount:r},{state:w,dispatchTransaction:y,nodeViews:f!=null?{}:{[Le]:(E,b,k)=>new ut(E,b,k,g)},handlePaste(E,b){const k=b.clipboardData?.getData("text/plain");if(k==null)return!1;R.logEvent(ne.canvasProsemirrorPaste,{textLength:k.length});const M=Dr(E.state.doc),S=M+k.length;let v=k;if(s!=null&&S>s){t!=null&&e!=null&&at(t,e,s);const _=s-M-50;v=_>0?k.slice(0,_):""}return yo(E,v),!0}});return{view:x,pmu:ce()}},Ri="_main_5jn6z_1",Hr={main:Ri};function Ii(r,e){const t=e.target;if(t instanceof Element&&[le.PROSEMIRROR_EDITOR_CONTAINER,le.PROSEMIRROR_CONTEXT_CHILDREN].some(c=>t.closest(`#${c}`)!=null))return!1;r.focus();const n=Ko(r.dom.getBoundingClientRect(),{x:e.clientX,y:e.clientY}),o=r.state.tr,s=r.posAtCoords({left:n.x,top:n.y});if(s!=null){const i=Math.min(s.pos,ln(r.state.doc)-1);o.setSelection(new U(o.doc.resolve(i))),r.dispatch(o)}return!0}const ye=({editorRef:r,wrapperClassName:e,transparentBackground:t=!1,comments:n,commentingOn:o,diff:s,paddingBottom:i,hoveredCommentId:a,focusedCommentId:c,hoveredEditId:u,rejectedEdits:l,showChanges:d,readonlyReason:h,isDisabled:p=!1,value:m,onBlur:f,onFocus:g,onChange:w,onMouseLeave:y,onSave:x,safeUrls:E,children:b,width:k,modelCursor:M,shouldResetSelection:S=!1})=>{const v=et(),A=Kr(),_=C.useRef(null),P=C.useRef(null),[K,Y]=C.useState(null),D=nr(),V=D.resolvedTheme==="dark",[{width:ue},ee]=gr(),j=C.useRef(f);j.current=f;const z=C.useRef(g);z.current=g;const H=C.useRef(w);H.current=w;const L=C.useRef(x);L.current=x;const te=C.useCallback((T=m)=>Lr({intl:v,toaster:A,comments:n,diff:s,value:T,selection:S?void 0:P.current?.state.selection,onBlur:I=>j.current?.(I),onFocus:I=>z.current?.(I),onSave:()=>L.current?.(),modelCursor:M,isDisabled:p,safeUrls:E}),[v,A,n,s,m,S,M,p,E]),de=C.useCallback(T=>{const I=te(T);P.current?.updateState(I),Y(I)},[te]);C.useImperativeHandle(r,()=>({UNSAFE_setValue:de,revertChanges:()=>{if(P.current==null)throw new Error("Tried to call revertChanges, but viewRef.current is null");Uo(P.current)},flushChanges:()=>{if(P.current==null)throw new Error("Tried to call flushChanges, but viewRef.current is null");Fo(P.current)},maybeFocusOnEditor:T=>{if(P.current==null)throw new Error("Tried to call maybeFocus, but viewRef.current is null");return Ii(P.current,T)},viewRef:P})),C.useEffect(()=>{const{current:T}=_;if(!T)return;const{view:I}=Ai(T,{intl:v,toaster:A,comments:n,diff:s,value:m,onBlur:G=>j.current?.(G),onFocus:G=>z.current?.(G),onChange:G=>H.current?.(G),onUpdate:Y,onSave:()=>L.current?.(),isDisabled:p,safeUrls:E},V);return P.current=I,()=>{I?.destroy()}},[h,s]),C.useEffect(()=>{P.current?.setProps({editable:()=>!p})},[p]),oe(T=>Bo(T,p),P,[p]),oe(T=>{if(D.resolvedTheme==null)return;const{schema:I}=T.doc.type,G=I.nodes.code_block;return G?(T.doc.descendants((re,Ce)=>{if(re.type===G){const Ve=re.type.create({...re.attrs,isDarkMode:V},re.content,re.marks);T.replaceWith(Ce,Ce+re.nodeSize,Ve)}}),Si(T)):T},P,[D.resolvedTheme,V]),oe(T=>T.setMeta(qe,d),P,[d]),oe(T=>Ei(T,M),P,[M]),oe(T=>T.setMeta(ur,{comments:n,commentingOn:o,hoveredCommentId:a,focusedCommentId:c}),P,[n,a,c,o]),oe(T=>T.setMeta(Ye,{hoveredEditId:u,rejectedEdits:l??new Set}),P,[u,l]),oe(T=>Ro(T,new Set(E??[])),P,[E]);const ke=C.useCallback(()=>P.current,[P]),we=[],pe=[];return C.Children.forEach(b,T=>{if(!C.isValidElement(T))return;const{type:I}=T;if(I===jr)we.push(T);else if(I===zr)pe.push(T);else throw new Error("Invalid Prosemirror child: "+JSON.stringify(I))}),N.jsx(wn.Provider,{value:ke,children:N.jsx(yn.Provider,{value:K,children:N.jsxs(xn.Provider,{value:ue,children:[N.jsx("div",{id:le.PROSEMIRROR_CONTEXT_CHILDREN,children:we}),N.jsxs("div",{className:e,onMouseLeave:y,id:le.PROSEMIRROR_EDITOR_CONTAINER,style:{paddingBottom:i},children:[N.jsx("div",{ref:rt(_,ee),className:W(Hr.main,Mr.composer,"markdown prose contain-inline-size dark:prose-invert focus:outline-none",t?"bg-transparent":"bg-token-main-surface-primary"),style:{width:k}}),pe]})]})})})},zr=({children:r})=>r,jr=({children:r})=>r;ye.EditorChildren=zr;ye.ContextChildren=jr;function Oi(r,e){C.useEffect(()=>{const t=r?.current;if(t!=null)return Gr(t,{mousedown:n=>{e.current?.maybeFocusOnEditor(n)===!0&&n.preventDefault()}})},[e,r])}const Bi=({wrapperClassName:r,value:e="",width:t,comments:n,paddingBottom:o})=>{const s=C.useRef(null),i=C.useRef(null),a=nr().resolvedTheme==="dark";return C.useEffect(()=>{const{current:c}=s;if(c)return i.current=vi({mount:c,comments:n,value:e,isDarkMode:a}),()=>{i.current?.destroy()}},[]),C.useEffect(()=>{const c=Vr(e,n);i.current?.updateState(c)},[e,n]),N.jsx("div",{className:r,children:N.jsx("div",{ref:rt(s),className:W(Hr.main,"markdown prose dark:prose-invert focus:outline-none"),style:{width:t,paddingBottom:o}})})},Ae=100,Di={type:"spring",duration:1.5,bounce:.1},_i={type:"spring",duration:.5,bounce:0},Jt={type:"spring",duration:.2},Zt={type:"spring",duration:1,delay:.1},Li={type:"spring",duration:1},Vi={type:"spring",duration:.5,bounce:0},Hi=({isRewriting:r=!1,value:e,previousValue:t,previousComments:n,documentWidth:o,paddingBottom:s,onStart:i})=>{const a=nt(),c=Tt(0),u=Tt(-Ae),l=C.useRef(!1),[d,h]=Kn();Xr(()=>{const m=a();if(m)return m.dom.style.clipPath="inset(0 0 100% 0)",()=>{const f=a();f&&(f.dom.style.clipPath="")}},[]),C.useEffect(()=>{const m=a();if(!(!m||un(m.state.doc)))try{const{top:f}=m.coordsAtPos(0),{top:g,bottom:w}=m.coordsAtPos(Math.max(m.state.doc.content.size-1,0),-1),y=w-f,x=g-f;if(c.set(y-x),!d){Pt(u,y+2*c.get(),_i).then(()=>h?.());return}Pt(u,y,Di)}catch(f){R.logError("Failed to set rewrite animation position",f),h?.()}},[d,e]);const p=Gn(u,m=>Ge(m)-Ae+2);return vt(u,"change",m=>{const f=a();!f||!m||!l.current||(f.dom.style.clipPath=`inset(0 0 calc(100% - ${m}px) 0)`)}),vt(u,"animationStart",()=>{r&&i?.()}),N.jsxs(N.Fragment,{children:[N.jsx(me.div,{className:"absolute top-0 z-10 w-full origin-bottom bg-gradient-to-t from-token-main-surface-primary from-10% to-transparent",style:{translateY:p,height:Ae},initial:{opacity:0},animate:{opacity:1,transition:Jt},exit:{opacity:0,transition:Zt},onAnimationComplete:()=>l.current=!0},"wash-top"),N.jsx(me.div,{className:"absolute top-0 z-10 w-full bg-gradient-to-b from-token-main-surface-primary to-transparent",style:{translateY:u,height:Ae},initial:{opacity:0},animate:{opacity:1,transition:Jt},exit:{opacity:0,transition:Zt}},"wash-bottom"),N.jsx(me.div,{className:"pointer-events-none absolute z-0 min-w-0 max-w-full",initial:{opacity:1},animate:{opacity:.3,transition:Li},exit:{opacity:0,transition:Vi},children:N.jsx(Bi,{value:t,width:o,comments:n,wrapperClassName:"h-fit flex",paddingBottom:s})},"previousValue")]})};function Qt(r,e){if(r==null)return!1;const t=r.state.schema.marks[e];return t==null?!1:br(r.state,r.dispatch,t)}function Fe(r,e){if(r==null)return!1;const{state:t,dispatch:n}=r,o=Me(t.schema.nodes[ar.proseMirrorNodeName()]);return kr(o,{level:e})(t,n)}function zi(r){if(r==null)return!1;const{state:e,dispatch:t}=r,n=Me(e.schema.nodes[ir.proseMirrorNodeName()]);return kr(n)(e,t)}const ji=({onAddComment:r,isWaitingForCommentResponse:e=!1})=>{const t=et(),n=nt(),o=dr(),s=C.useCallback(c=>{const{width:u,height:l}=c,d=n();if(!o||!d||"docView"in d&&d.docView==null)return null;const{to:h,empty:p,head:m}=o.selection,{platform:f}=Xn(),g=f==="web"?m:h,w=g===h;if(p||!Re(d.state.doc,g))return null;const{right:y,left:x,top:E}=d.coordsAtPos(0);let b=g,k=d.state.doc.nodeAt(b);const M=w?-1:1;for(;!k?.isText&&Re(d.state.doc,b+M);)b+=M,k=d.state.doc.nodeAt(b);const{left:S,bottom:v,top:A}=d.coordsAtPos(b,w?-1:1),_=y-x;function P(){if(w)return Math.max(S-x-u,0);let D=S-x;return D+u>_&&(D=-(u-_)),D}function K(){const D=window.innerHeight-v>l*2;return w&&D?{top:v-E+8,aboveOrBelow:Nt.BELOW}:{top:A-E-l-8,aboveOrBelow:Nt.ABOVE}}const Y=K();return{left:P(),top:Y.top,aboveOrBelow:Y.aboveOrBelow,toolbarSize:c}},[o,n]),i=C.useCallback(()=>n()?.dom??null,[n]),a=[{label:t.formatMessage(ie.heading1),className:"text-5xl font-semibold",onClick:()=>{R.logButtonClick(he.TOOLBAR_FORMAT_HEADER1),Fe(n(),1)}},{label:t.formatMessage(ie.heading2),className:"text-3xl font-semibold",onClick:()=>{R.logButtonClick(he.TOOLBAR_FORMAT_HEADER2),Fe(n(),2)}},{label:t.formatMessage(ie.heading3),className:"text-2xl font-semibold",onClick:()=>{R.logButtonClick(he.TOOLBAR_FORMAT_HEADER3),Fe(n(),3)}},{label:t.formatMessage(ie.body),className:"text-base",onClick:()=>{R.logButtonClick(he.TOOLBAR_FORMAT_PARAGRAPH),zi(n())}}];return N.jsxs(dn,{isWaitingForCommentResponse:e,onAddComment:r,toolbarType:pn.WRITING,getToolbarPosition:s,getEditorDom:i,getSelectionRange:()=>{const c=n();if(!c)return null;const{state:u}=c,{from:l,to:d,sourceFrom:h,sourceTo:p}=En(u);return l==null||d==null||h==null||p==null?(R.logError("Prosemirror getSelectionRange has null values",null,{from:l,to:d,sourceFrom:h,sourceTo:p}),null):{from:l,to:d,sourceFrom:h,sourceTo:p}},children:[N.jsx(Se.Separator,{}),N.jsx(Se.Action,{label:t.formatMessage(ie.bold),hideLabel:!0,icon:Eo,onClick:()=>{R.logButtonClick(he.TOOLBAR_FORMAT_BOLD),Qt(n(),Cr.proseMirrorMarkName())},onMouseDown:c=>c.preventDefault()}),N.jsx(Se.Action,{label:t.formatMessage(ie.italic),hideLabel:!0,icon:bo,onClick:()=>{R.logButtonClick(he.TOOLBAR_FORMAT_ITALIC),Qt(n(),Tr.proseMirrorMarkName())},onMouseDown:c=>c.preventDefault()}),N.jsx(Se.Popover,{label:t.formatMessage(ie.textStyle),hideLabel:!0,icon:Co,children:N.jsx("div",{className:W("flex flex-col items-stretch rounded-xl bg-token-main-surface-primary",Yn),children:a.map(({label:c,className:u,onClick:l})=>N.jsx("button",{onClick:l,className:"w-full rounded-xl p-4 text-start hover:bg-token-main-surface-secondary",children:N.jsx("div",{className:u,children:c})},c))})})]})},ie=Qe({bold:{id:"qqbk91",defaultMessage:"Bold"},italic:{id:"5oh4LV",defaultMessage:"Italic"},textStyle:{id:"+SV1Ro",defaultMessage:"Text style"},heading1:{id:"AR5o30",defaultMessage:"Heading 1"},heading2:{id:"zb/wrc",defaultMessage:"Heading 2"},heading3:{id:"xZJvLM",defaultMessage:"Heading 3"},body:{id:"Hi6z3L",defaultMessage:"Body"},caption:{id:"VXpL7v",defaultMessage:"Caption"}});function er({position:r,numEdits:e,closestEditId:t}){const n=ot(),o=et(),s=r==="top"?So:To,i=()=>{const c=n();if(!c||!t)return;const u=Or(c,t);if(u.length===0){qr.addError("Edit could not be found while attempting to scroll",{closestEditId:t});return}u[r==="top"?0:u.length-1].scrollIntoView({behavior:"smooth",block:"center"})},a=r==="top"?-4:4;return N.jsx(Ie,{children:e>0&&N.jsx(me.div,{className:W("absolute left-1/2 z-20 select-none",{"bottom-[20px]":r==="bottom","top-[20px]":r==="top"}),initial:{scale:.95,translateY:a,translateX:"-50%",opacity:0},animate:{scale:1,translateY:0,translateX:"-50%",opacity:1},exit:{scale:.95,translateY:a,translateX:"-50%",opacity:0},transition:{type:"spring",duration:.3},children:N.jsxs("div",{className:W("flex items-center justify-center rounded-full border px-4 py-2","border-token-main-surface-tertiary bg-token-main-surface-primary shadow-md hover:bg-token-main-surface-secondary"),"aria-label":o.formatMessage(tr.ariaLabel),role:"button",onClick:i,children:[N.jsx(Yr,{...tr.label,values:{count:e}}),N.jsx(s,{className:"icon-sm ml-2"})]})})})}const tr=Qe({label:{id:"Pf30w4",defaultMessage:"{count, plural, one {1 more edit} other {{count} more edits}}"},ariaLabel:{id:"qTJjzl",defaultMessage:"Button to scroll the next edit into view."}});function $i(r){let e=r;for(;e;){const n=window.getComputedStyle(e).overflowY;if(n==="auto"||n==="scroll")return e;e=e.parentElement}return null}function Fi(r,e){const t=ot(),n=qn(),o=t();C.useEffect(()=>{const s=o?.dom;if(!s||r.length===0)return;const i=()=>{if(!n)return;const{textdocId:l,history:d}=n;d?Zn(l,d):Qn(l)},a=$i(s),c=l=>{l.key==="Escape"&&i()},u=Jn(e,100);return window.document.addEventListener("keydown",c,{passive:!0}),a&&a.addEventListener("scroll",u,{passive:!0}),()=>{window.document.removeEventListener("keydown",c),a&&a.removeEventListener("scroll",u),u.cancel()}},[o,n,r,e])}function Ui({diff:r=null}){const e=ot(),[t,n]=C.useState([]),[o,s]=C.useState([]),i=We.useState(We.selectWindowHeight),a=C.useCallback(()=>{const c=e();if(!c||!r)return;const u=[],l=[];for(const d of r.edits){const h=pi(c,d.id);if(h.length>0){const p=Br(h);p.bottom<0?u.push([d.id,p]):p.top>i&&l.push([d.id,p])}}u.sort(([,d],[,h])=>d.bottom-h.bottom),l.sort(([,d],[,h])=>d.top-h.top),n(u.map(([d])=>d)),s(l.map(([d])=>d))},[r,i,e]);return Fi(r?.edits??[],a),C.useEffect(()=>{const c=setTimeout(a,500);return()=>{clearTimeout(c)}},[a]),N.jsxs(N.Fragment,{children:[N.jsx(er,{position:"top",numEdits:t.length,closestEditId:t[t.length-1]}),N.jsx(er,{position:"bottom",numEdits:o.length,closestEditId:o[0]})]})}const rr=Jr(()=>({rejectedEdits:new Set,hoveredEditId:null})),Wi=({pos:r})=>{const e=nt()(),t=dr();if(!e||!t||r==null)return null;const{doc:n}=t,{top:o,left:s}=e.coordsAtPos(0),{top:i,left:a}=e.coordsAtPos(r),c=n.nodeAt(r),u=r+(c?.nodeSize??0)-1,{top:l}=e.coordsAtPos(r+1),{top:d,bottom:h,right:p}=e.coordsAtPos(u),f=(l>=d?p:e.dom.getBoundingClientRect().right)-a,g=h-i+4;return N.jsx(me.div,{style:{top:i-o,left:a-s,height:g,width:f},className:W("absolute after:absolute after:inset-x-[-4px] after:inset-y-0 after:z-0 after:rounded-md after:bg-[Highlight] after:content-[''] dark:after:bg-[Highlight]",Mr.blockCommentHover),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}})},Ki=({pos:r})=>N.jsx(Ie,{children:r!=null&&N.jsx(Wi,{pos:r})}),Gi={type:"spring",bounce:.12,duration:.64},Ue=24,Xi=8,Ca=({comments:r,diff:e,readonlyReason:t,isDisabled:n=!1,isRewriting:o=!1,isAnimatingFromPreview:s=!1,previousComments:i,previousValue:a,isPreview:c=!1,isRequestActive:u=!1,isWaitingForCommentResponse:l=!1,targetedContent:d=null,onAcceleratorsExpandedChange:h,getStableCommentId:p=Zr,onBlur:m,onCancelRequest:f,onChange:g,onSave:w,onAddComment:y,onSubmitAccelerator:x,onAcceptComment:E,onDismissComment:b,onExitShowChanges:k,value:M,commentsMode:S=je.ENABLED,hideAccelerators:v=!1,hideToolbar:A=!1,hideEditOverlay:_=!1,safeUrls:P,width:K,modelCursor:Y,shouldResetSelection:D})=>{const V=C.useRef(null),ue=C.useRef(null);Oi(ue,V);const[{width:ee},j]=gr(),z=C.useRef(null),[H,L]=C.useState(!1),te=z.current,de=hn(te)??!1,we=(()=>{if(K==null){const O=de?0:kt();return ee-O}return K-At*2-kt()})(),pe=we>=Rt+to?Rt:ro,T=we-pe,I=Te(({commentingOn:O})=>O),G=Te(({hoveredCommentId:O})=>O),re=Te(({focusedCommentId:O})=>O),Ce=Te(({hoveredBlockCommentLauncherPos:O})=>O),Ve=rr(O=>O.hoveredEditId),$r=rr(O=>O.rejectedEdits);C.useEffect(()=>{d==null&&V.current?.revertChanges()},[d]),C.useEffect(()=>{V.current?.flushChanges(),V.current?.UNSAFE_setValue(M)},[M]);const Fr=We.useState(({windowHeight:O})=>{if(c)return Ue;const He=Xi/100*O;return Math.max(Ue,He)}),Ur=({currentTarget:O,nativeEvent:He})=>{const mt=He.composedPath();for(const ze of mt.slice(0,mt.indexOf(O)))if(ze instanceof HTMLElement&&(ze.id===le.PROSEMIRROR_EDITOR_CONTAINER||ze.id===le.PROSEMIRROR_CONTEXT_CHILDREN))return;k?.()},ft="max(3rem,24vh)";return N.jsx("div",{className:"h-full w-full",ref:ue,onClick:Ur,children:N.jsx(me.div,{className:eo.document,style:{margin:`0 ${At}px`},initial:s?{paddingTop:Ue}:!1,animate:{paddingTop:Fr},transition:Gi,children:N.jsx("div",{ref:rt(j,z),className:"z-0 flex w-full flex-col items-center",children:N.jsxs(ye,{comments:r,diff:e,editorRef:V,hoveredCommentId:G,focusedCommentId:re,hoveredEditId:Ve,rejectedEdits:$r,value:M,commentingOn:I,isDisabled:n,readonlyReason:t,onBlur:m,onChange:g,onSave:w,width:pe,safeUrls:P,wrapperClassName:"relative z-10 flex max-w-full h-fit",paddingBottom:ft,modelCursor:Y,shouldResetSelection:D,transparentBackground:!H,children:[N.jsxs(ye.EditorChildren,{children:[N.jsx(Ie,{onExitComplete:()=>L(!1),children:o&&N.jsx(Hi,{isRewriting:o,documentWidth:pe,previousValue:a,previousComments:i,value:M,paddingBottom:ft,onStart:()=>L(!0)})}),!A&&N.jsx(ji,{isWaitingForCommentResponse:l,onAddComment:y}),S===je.ENABLED&&N.jsx(Ki,{pos:Ce}),N.jsx(Ie,{children:S!==je.ALL_HIDDEN&&N.jsx(fn,{availableWidth:T,comments:r,commentsMode:S,isRequestActive:u,onAddComment:y,onAcceptComment:E,onDismissComment:b,isWaitingForCommentResponse:l,disableBlockComments:u,getStableCommentId:p})})]}),N.jsxs(ye.ContextChildren,{children:[!_&&e&&N.jsx(Ui,{diff:e}),!v&&N.jsx(bn,{isRequestActive:u,onSubmit:x,readonlyReason:t,actions:Po,onCancel:f,onExpandedChange:h})]})]})})})})};export{Ca as DocumentComposer};
//# sourceMappingURL=go34d9kor0a5h472.js.map
