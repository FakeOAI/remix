const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/cb8nh5c1orrzuumz.js","assets/f7fcphlcmge2bakt.js","assets/j8d4rbgte5ok7mfe.js","assets/root-cvhhn8wc.css"])))=>i.map(i=>d[i]);
import{ey as z,co as E,c3 as F,j as e,H as T,N as H,r as p,bg as P,bn as U,c as L}from"./f7fcphlcmge2bakt.js";import{C as I}from"./nq4f15i7u5ult7lm.js";import{P as A}from"./j8d4rbgte5ok7mfe.js";import{D as B}from"./jwlwz6f1q2dfkkny.js";import{u as J,a as G,U as M,b as K}from"./kxzq6od3rgf7ujnq.js";import{a as X}from"./vyia90ahqul2epog.js";import{$ as q,D as Q,E as b,F as v,K as W,cI as Y}from"./btwi9uxkutuvbi6k.js";import"./durf57ntrxthlin8.js";import"./mu8x73qjpf3z5g60.js";import"./pd11x8r3lr6mtq53.js";import"./m7wvy8a7959kubdd.js";import"./eefeaqqri40ut5cp.js";function Z(t){return z({tag:"svg",attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{d:"M9 9H4v1h5V9z"}},{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M5 3l1-1h7l1 1v7l-1 1h-2v2l-1 1H3l-1-1V6l1-1h2V3zm1 2h4l1 1v4h2V3H6v2zm4 1H3v7h7V6z"}}]})(t)}function ee(t){return z({tag:"svg",attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{d:"M9 9H4v1h5V9z"}},{tag:"path",attr:{d:"M7 12V7H6v5h1z"}},{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M5 3l1-1h7l1 1v7l-1 1h-2v2l-1 1H3l-1-1V6l1-1h2V3zm1 2h4l1 1v4h2V3H6v2zm4 1H3v7h7V6z"}}]})(t)}const se=E(()=>F(()=>import("./cb8nh5c1orrzuumz.js"),__vite__mapDeps([0,1,2,3])),{ssr:!1});function je({threadId:t,threadUserId:a}){return J(G.isDebugModalOpen)&&e.jsx(T,{isOpen:!0,onClose:()=>M.toggleDebugModalOpen(),type:"success",size:"fullscreen",noPadding:!0,rootClassName:"z-50",children:e.jsx(ne,{threadId:t,threadUserId:a,onClose:()=>M.toggleDebugModalOpen()})})}const te=(t,a)=>{const l=JSON.stringify(a,null,2),r=new Blob([l],{type:"application/json"}),o=window.URL.createObjectURL(r),n=document.createElement("a");n.href=o,n.download=t,n.click(),window.URL.revokeObjectURL(o)},S="<|im_start|>",V="<|im_sep|>",D="<|im_end|>",le="<|fim_suffix|>";function ae({prompt:t}){const a=[];let l=0;for(;;){const r=t.indexOf(S,l);if(r===-1)break;const o=t.indexOf(V,r);if(o===-1)break;let n=t.indexOf(D,o);const d=t.indexOf(le,o);if(d!==-1&&(n===-1||d<n)&&(n=d),n===-1)break;const m=t.substring(r+S.length,o),g=t.substring(o+V.length,n);a.push(e.jsxs("div",{children:[e.jsxs("span",{className:"font-semibold",children:["[",m,"]"]})," ",g]},r)),l=n+D.length}return a}const j=H.div`mb-[-5px] px-2 pb-1 font-semibold uppercase border-b-2 ${({$isSelected:t})=>t?"border-black dark:border-white":"border-transparent"}`;function ne({threadId:t,threadUserId:a,message:l,onClose:r}){var y,C,k;const{sessionUser:o}=K(),[n,d]=p.useState(l?"message":"json"),{data:m,isLoading:g,refetch:R}=X({threadId:t,threadUserId:a,refetchOnMount:"always"}),s=m==null?void 0:m.thread;if(p.useEffect(()=>{d(l?"message":s!=null&&s.turns.length?`turn${(s==null?void 0:s.turns.length)-1}`:"thread")},[s==null?void 0:s.turns.length,l]),!g&&!s&&!l)return e.jsxs(B,{onClickRetry:()=>R(),children:["Failed to load."," "]});if(g)return e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:"Loading..."});const x=s==null?void 0:s.turns,w=(k=(C=(y=s==null?void 0:s.turns[s.turns.length-1])==null?void 0:y.artifacts__)==null?void 0:C.model_snapshots)==null?void 0:k.default_id,N=a&&t?Y(a,t):null;return e.jsx("div",{className:"flex flex-col gap-2 break-words font-mono text-xs",children:e.jsxs(q,{orientation:"vertical",value:n,onValueChange:i=>d(i),children:[e.jsxs(Q,{className:"flex items-center justify-center gap-2 px-4 py-1",children:[l&&e.jsx(b,{value:"message",children:e.jsx(j,{$isSelected:n==="message",children:"Message"})},"message"),s&&e.jsx(b,{value:"thread",children:e.jsx(j,{$isSelected:n==="thread",children:"Thread"})},"thread"),x==null?void 0:x.map((i,c)=>{var h,u;return e.jsxs(p.Fragment,{children:[e.jsx(b,{value:`turn${c}`,children:e.jsxs(j,{$isSelected:n===`turn${c}`,children:["Turn[",c,"]"]})},c),(u=(h=i.artifacts__)==null?void 0:h.debug_ddtrace_urls)==null?void 0:u.map(f=>e.jsx(j,{$isSelected:!1,children:e.jsxs("a",{target:"_blank",href:f,className:"text-nowrap",children:["Trace[",c,"] â†—"]})},f))]},c)}),e.jsx("div",{className:"flex-grow"}),w&&e.jsxs(e.Fragment,{children:[e.jsx(_,{name:"Model",id:w})," ",e.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx(_,{name:"User ID",id:o.id})," ",e.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),N&&e.jsxs(e.Fragment,{children:[e.jsx(_,{name:"Permalink",id:N}),e.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),s&&e.jsxs(P,{size:"small",color:"secondary",onClick:()=>te("thread.json",s),children:[e.jsx(A,{className:"icon-sm"})," thread.json"]}),e.jsx(U,{onClick:r})]}),x==null?void 0:x.map((i,c)=>{var h,u,f,$;return e.jsxs(v,{value:`turn${c}`,className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth",children:[e.jsxs("div",{className:L("flex flex-col gap-1 p-6",i.index%2===0&&"bg-token-main-surface-tertiary"),children:[e.jsx(ae,{prompt:((f=(u=(h=i.artifacts__)==null?void 0:h.debug_info)==null?void 0:u.main_model_response)==null?void 0:f.prompt_string)??""}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"[assistant]"})," ",($=i.model_response)==null?void 0:$.text]})]})," "]},c)}),s&&e.jsx(v,{value:"thread",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-6",children:e.jsx(O,{data:s,collapsed:4})}),l&&e.jsx(v,{value:"message",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-6",children:e.jsx(O,{data:l,collapsed:4})})]},(s==null?void 0:s.turns.length)??"message")})}function O({data:t,collapsed:a}){const[l,r]=p.useState(a??!0);return e.jsxs("div",{className:"flex flex-col items-start gap-1",children:[e.jsx("button",{onClick:()=>r(!l),className:"flex items-center gap-1",children:l?e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:14})," Expand all"]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{size:14})," Collapse all"]})}),e.jsx("div",{className:"w-full",children:e.jsx(se,{json:t,jsonViewProps:{collapsed:l,shortenTextAfterLength:0}},String(l))})]})}function _({name:t,id:a}){const l=p.useCallback(()=>{W(a)},[a]);return e.jsxs("div",{className:"flex items-center gap-2 truncate",children:[e.jsxs("span",{className:"text-nowrap font-semibold",children:[t,":"]}),e.jsx("span",{title:a,className:"truncate text-gray-500 dark:text-white",children:a}),e.jsx(I,{onCopy:l})]})}export{O as DebugJsonViewer,je as DebugModal,ne as DebugModalContents};
//# sourceMappingURL=kv6xfgf9fki7n7ak.js.map
