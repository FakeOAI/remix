import{r as a,u as f,b4 as i,b5 as s,t as d}from"./ius2rjc8aciuj2rl.js";import{b as y}from"./ft4dy4z5nigizpf8.js";import{bI as g}from"./jdz9mwngh3t5nytb.js";const r="last_checked_loc",S=24*60*60*1e3,c="last_denied_loc",A=60*60*1e3;function w(){const[e]=y(),{data:n}=f({queryKey:["userLocation",e.useLocation],queryFn:({queryKey:[o,t]})=>C({enabled:t}),initialData:_(e.useLocation),networkMode:"always",refetchOnMount:"always",refetchOnWindowFocus:"always",staleTime:0});return n}function _(e){if(e){const n=i.getCookie(s.LastLocation);if(n)try{return JSON.parse(n)}catch{return u(),null}}return null}async function C({enabled:e}){if(!e)return u();if((await L())?.state!=="granted"){const o=localStorage.getItem(r);if(o){const t=Number(o);if(Date.now()-S<t)try{return JSON.parse(i.getCookie(s.LastLocation))}catch{}}}const n=localStorage.getItem(c);if(n){const o=Number(n);if(Date.now()-A<o)return null}return await new Promise(o=>{navigator.geolocation.getCurrentPosition(t=>{const l={latitude:t.coords.latitude,longitude:t.coords.longitude,locationAccuracy:t.coords.accuracy};i.setCookie(s.LastLocation,JSON.stringify(l),{maxAge:g}),localStorage.setItem(r,Date.now().toString()),o(l)},()=>{localStorage.setItem(c,Date.now().toString()),o(u())},{enableHighAccuracy:!0,maximumAge:0})})}async function L(){return navigator?.permissions?await navigator.permissions.query({name:"geolocation"}):null}const I={latitude:null,longitude:null,locationAccuracy:null};function u(){return i.setCookie(s.LastLocation,JSON.stringify(I),{maxAge:g}),localStorage.removeItem(r),localStorage.removeItem(c),null}const m=a.createContext(null),x=({children:e})=>{const[n,o]=a.useState(null);return a.useEffect(()=>{L().then(t=>{t!=null&&(o(t.state),t.onchange=()=>{o(t.state)})})},[]),d.jsx(m.Provider,{value:n,children:e})};function P(){return a.useContext(m)}export{x as L,P as a,w as u};
//# sourceMappingURL=eduhtg8y78f7tze9.js.map
