import{f5 as ye,f6 as Z,cG as ge,f7 as b,r as m,df as he,bo as pe,f8 as Se,P as Q,dN as Me,h as y,aQ as x,j as re,el as N,aM as se,d0 as Pe,a as J,f9 as _e,l as ze,a8 as Ge,aJ as k,R as ve,e3 as Ce,bA as Ee,v as we,d7 as ne,u as P,e as v,aG as X}from"./f1tbg9vupz7s4vaz.js";import{cp as oe,cs as B,de as Te,ft as De,fu as be,cv as g,fv as qe,b$ as Fe,eU as D,ag as u,fw as Le,dL as Re,dF as Ue,fx as Qe,fy as Ae}from"./eyfm2skil9fzhvo1.js";import{T as G,G as He,a as xe}from"./oixhn1b8fi6yhijp.js";function Ke({clientThreadId:e}){const t=G.getThreadCurrentLeafId(e),s=G.getTree(e).getMessage(t).metadata?.model_switcher_deny??[],n={};s.forEach(i=>{const{slug:a,context:l,reason:d,description:c}=i,f=n[a]??{},h=f[l]??[];h.push({reason:d,description:c}),f[l]=h,n[a]=f});const o=ye();for(const{resets_after:i,model_slug:a}of o)[Z.CONVERSATION,Z.REGENERATE].forEach(l=>{const d=n[a]??{},c=d[l]??[],f={reason:ge.RATE_LIMIT,resetsAfter:i};c.push(f),d[l]=c,n[a]=d});return n}const ut="text-davinci-002-render-sha",ct="gpt-4",lt="gpt-4o",dt="o1-preview",mt="o1-mini",A=oe({slug:B,max_tokens:4097,title:"Default",description:"",tags:[b.GPT_3_5],product_features:{}}),Ie=({default_model:e,tagline:t,color:r,human_category_name:s,category:n,human_category_short_name:o,human_category_shorter_name:i,subscription_level:a,short_explainer:l,subcategory:d,is_beta:c,...f})=>({color:r,tagline:t,defaultModel:e,label:s,shortLabel:o,description:l,shorterLabel:i??o,subscriptionLevel:a,categoryId:n,subcategory:d,isBeta:c,...f}),Oe=({icon:e,icon_filled_src:t,icon_outline_src:r})=>({iconName:e,iconFilledSrc:t,iconOutlineSrc:r}),Ne=({group:e,human_group_name:t,human_group_short_name:r,model_ids:s})=>({group:e,label:t,shortLabel:r,modelIds:s});function ke(){return x({retry:5,queryKey:["modelIcons"],queryFn:async()=>await re.getModelIcons().then(e=>Object.fromEntries(Object.entries(e).map(([t,r])=>[t,Oe(r)])))})}function Be(e){return x({retry:5,queryKey:["models",{isHistoryDisabled:e}],queryFn:async()=>await re.getModels(e).then(t=>{const{models:r,internal_groups:s,categories:n}=t,o=r.map(oe);return{categories:n.concat().reverse().map(Ie),groups:s?.map(Ne)??[],modelsList:o,modelsMap:Object.fromEntries(o.map(i=>[i.id,i]))}})})}function C(){const e=Me();return y(Be(e))}function ft(){return y(ke())}function $e({isRegen:e=!1}={}){const{isLoading:t,data:{categories:r=[],groups:s=[]}={}}=C(),n=m.useMemo(()=>e?r.filter(o=>o.is_regenerate_category!==!1):r.filter(o=>!o.is_regenerate_category),[r,e]);return{isLoading:t,categories:n,groups:s??[]}}function yt(){const{categories:e}=$e();return!!e.find(({categoryId:t})=>t===Te.GPT4o)}function gt(){const{data:e}=C();return m.useMemo(()=>e?new Set(Object.keys(e.modelsMap)):new Set([B]),[e])}const je={[B]:A};function We(){const{data:e}=C();return e?.modelsMap??je}function ie(e,t,r){let s=b.GPT_3_5;return r?s=b.GPT_4:t&&(s=b.GPT_4o),e?.modelsList.find(n=>n.tags.includes(s))??e?.modelsList[0]??A}function ht(e=!1){const t=he(),r=pe(),[,s]=Se();return m.useCallback(({location:n,modelId:o})=>{const i=t.pathname.includes("/g/");e||i?(Q.logNewChatButtonClicked({location:n}),r({pathname:"/",search:`?model=${encodeURIComponent(o)}`})):(s(a=>(a.set("model",encodeURIComponent(o)),a)),Q.logNewChatButtonClicked({location:n}))},[e,t,r,s])}function pt(){const{data:{categories:e=[]}={}}=C(),{doesUserHaveAnyAccountsWithPlusFeatures:t}=N();return t?null:e.find(De)?.defaultModel??null}function Ve(e){return He(e)}function ae(e){const t=Ve(e),r=We();return m.useMemo(()=>t==null?A:r[t]??A,[t,r])}function Ye(e,t){return ae(e).enabledTools?.includes(t)??!1}function St(e){const t=be(),r=ae(e),s=m.useMemo(()=>!t.isSuccess||!t.data?[]:t.data,[t.data,t.isSuccess]),n=Ke({clientThreadId:e});return m.useMemo(()=>{const i=new Set(r.enabledTools||[]);return s.filter(a=>!(!(a.requiredFeatures.length===0||a.requiredFeatures.every(c=>i.has(c)))||!(a.requiredModels.length===0||a.requiredModels.some(c=>!n[c]))))},[s,r,n])}function Mt(e){return decodeURIComponent(e.model??"")||null}function Pt(){const{data:e}=C(),{doesUserHaveAnyAccountsWithPlusFeatures:t}=N(),r=se();return ie(e,!!t,!!r?.isEnterprise())}const ee=e=>({turn_index:e.turnIndex,thread_id:e.threadId,conversation_id:e.clientThreadId?G.getServerThreadId(e.clientThreadId):void 0,message_id:e?.messageId}),Ze="hints";class H extends Pe()(t=>({persistedSystemHints:new Set(t)})){static getPersistedSystemHints=({persistedSystemHints:t})=>t;addPersistedSystemHint=(t,r)=>{t===g.Search&&Q.logEvent(J.searchModeEngaged,ee(r)),this.setState(({persistedSystemHints:s})=>({persistedSystemHints:new Set(s).add(t)}))};removePersistedSystemHint=(t,r)=>{t===g.Search&&Q.logEvent(J.searchModeDisabled,ee(r)),this.setState(({persistedSystemHints:s})=>{const n=new Set(s);return n.delete(t),{persistedSystemHints:n}})}}const _t=()=>H.useState(H.getPersistedSystemHints);function zt({children:e,clientThreadId:t,currentLeafId:r}){const s=Ye(t,_e.Search),o=G.getLastMessgageSystemHints(t,r).includes(g.Search)&&s,[i]=m.useState(()=>new H(o?[g.Search]:[]));return m.useEffect(()=>{const a=i.getState().persistedSystemHints;o&&!a.has(g.Search)&&i?.addPersistedSystemHint(g.Search,{clientThreadId:t,turnIndex:0})},[o,i,t]),ze.jsx(H.Provider,{store:i,children:e})}function Je(e){const t=new Set;if(e){const r=e.split(",");Array.isArray(r)&&r.forEach(s=>{Object.values(g).includes(s)&&t.add(s)})}return t}const ue="q",Xe="m";function Gt(e){const{clientThreadId:t,currentLeafId:r,handleRequestCompletion:s}=e,n=m.useRef(!1),{isLoading:o,data:i}=C(),{doesUserHaveAnyAccountsWithPlusFeatures:a,isLoading:l}=N(),d=se(),c=Ge(),f=k(),h=m.useCallback((p,E,_,z)=>{G.updateTree(t,S=>{S.addNode(p,_,E,ve.User,void 0,z)})},[t]),j=m.useCallback(async(p,{content:E,attachments:_},z,S,R,I)=>{const w=r,T=_.length>0?{attachments:_}:{};T.system_hints=S.systemHints,h(p,w,E,T),s({type:Ce.Next,promptId:p,requestedModelId:I,eventMetadata:z,cancelActiveRequests:!0,completionMetadata:S,turnTracker:R})},[h,s,r]),F=Ee(()=>window.location.pathname)??null,W=qe();let V=!o&&!l&&F!=null;const[K,L]=m.useState(!0);return m.useEffect(()=>{if(!K||n.current)return;const p=xe.getConversationMode(t);if(!V||p==null)return;if(!tt(F)||et(F)&&W===void 0||G.getServerThreadId(t)!=null){L(!1);return}const E=(()=>{try{return Object.fromEntries(new URLSearchParams(location.hash.slice(1)).entries())}catch{return{}}})(),_={...c.query,...E},{[ue]:z,[Xe]:S,[Ze]:R,...I}=_,w=(typeof z=="string"?z:null)??(typeof S=="string"?S:null);if(!w||!w.trim()){L(!1);return}const T=Je(R),me=we();n.current=!0;let O=i?.modelsList;T.has(g.Search)&&(O=O?.filter(U=>U.enabledTools?.includes(g.Search)));const Y=i&&ie({...i,modelsList:O??[]},!!a,!!d?.isEnterprise());if(c.replace({query:I},void 0,{shallow:!0}),Y==null){f.warning("No model available for this request"),L(!1);return}const fe=new Fe;(e.prefetchSearchPromise??Promise.resolve(null)).then(U=>{j(me,{content:w,attachments:[]},{eventSource:"url"},{conversationMode:p,source:"instant-query",systemHints:R?Array.from(T):void 0,prefetchIds:U!=null?[U]:void 0},fe,Y?.id),L(!1)})},[o,l,V,F,c,i,a,d,j,K,t,W,f,e.prefetchSearchPromise]),K}function et(e){return ce(e)}function ce(e){return e==null?!1:/^\/g\/[\w-]+$/.test(e)}function tt(e){return e==null?!1:e==="/"||ce(e)}const vt="GPT Builder";function Ct(e){if(e)return`ChatGPT - ${e}`}function $(e){return e.gizmo.short_url??e.gizmo.id??"-"}function le(e){return`/g/${e}`}function Et(e){return`https://chatgpt.com${le(e)}`}function rt(e){return le($(e))}function wt(e,t){const r=new URLSearchParams;return t!=null&&r.set(ue,t),Le(new URL(`${rt(e)}?${r}`,"https://chatgpt.com"))}function Tt(e){return`/g/${$(e)}`}function Dt(e){return Re(e)&&e.gizmo.live_version===0||Ue(e)&&e.liveVersion===0}function bt(e,t){return y({queryKey:["gizmos","discovery",{locale:e,isAnon:t}],queryFn:async()=>u.getGizmoDiscovery(e,t)})}function qt({cutId:e,locale:t,limit:r,cursor:s,enabled:n=!0}){return ne({queryKey:["gizmos","discovery",{cutId:e,locale:t,limit:r}],queryFn:async({pageParam:o})=>u.getGizmoDiscoveryCut(e,{locale:t,cursor:o,limit:r}),initialPageParam:s,getNextPageParam:o=>o.list.cursor??void 0,enabled:n})}function Ft(){return y({queryKey:["gizmos","pinned"],queryFn:async()=>u.getGizmoPinned()})}function q(){return x({queryKey:["gizmos","bootstrap"],queryFn:async()=>u.getGizmoBootstrap().then(e=>({gizmos:e.gizmos.map(t=>({resource:t.resource,flair:t.flair}))}))})}function Lt(){return y(q())}function te(e,t){const r=e.filter(n=>n.resource.gizmo.id!==t.resource.gizmo.id);let s=r.findIndex(n=>n.flair.kind===D.Recent);return s===-1&&(s=r.length),r.splice(s,0,t),r}const Rt={handleGizmoInteracted(e,t){const r=e.getQueryData(M(e,t).queryKey);r!=null&&e.setQueryData(q().queryKey,s=>{if(s==null)return s;const n=s.gizmos.find(o=>o.resource.gizmo.id===t);return n?.flair.kind===D.FirstParty||n?.flair.kind===D.SidebarKeep?s:{gizmos:te(s.gizmos,{resource:r,flair:{kind:D.Recent}})}})},handleGizmoSidebarKeep(e,t){const r=e.getQueryData(M(e,t).queryKey);r!=null&&e.setQueryData(q().queryKey,s=>s==null?s:{gizmos:te(s.gizmos,{resource:r,flair:{kind:D.SidebarKeep}})})},handleGizmoSidebarHide(e,t){e.setQueryData(q().queryKey,r=>r?.gizmos.some(s=>s.resource.gizmo.id===t)?{gizmos:r.gizmos.filter(s=>s.resource.gizmo.id!==t)}:r)}};function Ut(e,t=!1){const r=P();return y(M(r,e,t))}function Qt({gizmoId:e,draft:t,version:r}){const s=P(),n=r?{queryKey:["gizmo","version",{gizmoId:e,version:r}],queryFn:async()=>u.getVersion({gizmoId:e,version:r}),enabled:e!=null}:M(s,e,t);return y(n)}function At(e,t){return y({queryKey:["gizmo","userActionSettings",{gizmoId:e}],queryFn:async()=>u.getUserActionSettings(e),enabled:e!=null&&t})}function M(e,t,r=!1){return x({queryKey:["gizmo",{gizmoId:t},{draft:r}],queryFn:async()=>u.getGizmo(t,r),enabled:t!=null,initialData:()=>{if(r===!0)return;const s=e.getQueryData(q().queryKey);if(s!=null)return s.gizmos.find(o=>o.resource.gizmo.id===t)?.resource;const n=e.getQueryData(["gizmos","discovery"]);if(n!=null)for(const o of n.cuts){const i=o.list.items.find(a=>a.resource.gizmo.id===t)?.resource;if(i!=null)return i}}})}function Ht(e,t){return e.fetchQuery(M(e,t))}function xt(e){return y({queryKey:["gizmo",{search:e}],queryFn:async()=>u.getGizmoSearch(e),enabled:e.length>0})}function Kt(e,t){return y({queryKey:["gizmo-search-workspace",{search:e}],queryFn:async()=>u.getGizmoSearchForWorkspace(e),enabled:e.length>0&&t})}function It(e,t=!1,r=!1,s=null){return ne({queryKey:[r?"gizmo-search-workspace":"gizmo",{query:e,cursor:s}],queryFn:async({pageParam:n})=>r?u.getGizmoSearchForWorkspace(e,s=n):u.getGizmoSearch(e,s=n),initialPageParam:s,getNextPageParam:n=>n.cursor??void 0,enabled:t})}function Ot(){const e=P();return v({mutationFn:async({gizmoId:t,editorData:r})=>{const{instructions:s,name:n,description:o,profilePictureId:i,profilePictureUrl:a,promptStarters:l,tools:d,files:c,trainingDisabled:f}=r;return u.upsertDraft({instructions:s,display:{name:n,description:o,profile_pic_id:i,profile_picture_url:a,prompt_starters:l},tools:d,files:c.map(h=>({...h,location:Qe.FILE_SERVICE})),training_disabled:f},t)},onSettled:t=>{t&&(e.setQueryData(M(e,t.gizmo.id,!0).queryKey,t),e.invalidateQueries({queryKey:["gizmos","mine"],refetchType:"none"}))}})}function Nt(){const e=P();return v({mutationFn:async({gizmoId:t,data:r})=>{const{sharingRecipient:s,categories:n}=r,o=await u.promoteDraft({sharing:r.sharingSubjects&&r.sharingSubjects.length>0?r.sharingSubjects:{recipient:s},categories:n},t);if(o.error)throw new Ae(o);return o.resource},onSettled:t=>{e.invalidateQueries({queryKey:["gizmos"],refetchType:"all"}),e.invalidateQueries({queryKey:["gizmos","pinned"],refetchType:"none"}),t&&e.setQueryData(M(e,t.gizmo.id,!1).queryKey,t)}})}function kt(){const e=P();return v({mutationFn:async({gizmoId:t})=>u.deleteGizmo(t),onSettled:()=>{e.invalidateQueries({queryKey:["gizmos"],refetchType:"all"})}})}function Bt(){const e=P(),t=k();return v({mutationFn:async({name:r,hideName:s,websiteUrl:n,willReceiveSupportEmails:o})=>u.updateBuilderProfile({name:r,hide_name:s,website_url:n,will_receive_support_emails:o}),onSuccess:r=>{e.setQueryData(["builderProfile"],r)},onError:r=>{t.warning(r.message)}})}function $t(){return y({queryKey:["builderProfile"],queryFn:async()=>u.getBuilderProfile()})}function jt(){return v({mutationFn:async({gizmoId:e})=>u.copyGizmo({gizmoId:e})})}function Wt(){return y({queryKey:["gizmoCategories"],queryFn:async()=>u.getCategories()})}function Vt(e,t){return!!(t!=null&&[X.PrimaryAssistant,X.GizmoInteraction].includes(t)&&e?.includes(b.GPT_4))}function Yt(e,t){const r=P(),s=k();return v({mutationFn:async({rating:n,message:o,includeFrom:i})=>{await u.upsertUserReview(e,n,o,i)},onSuccess:async()=>{r.invalidateQueries({queryKey:["gizmo","review",{gizmoId:e}]})},onError:n=>{s.danger(n.message)}})}function Zt(e,t){return t?`/g/${$(t)}/c/${e}`:`/c/${e}`}function Jt(){return"/gpts"}function Xt(){return"/gpts/mine"}function de(e){return e?`/gpts/editor/${e}`:"/gpts/editor"}function er(e){const t=st();return e==null?t:de(e)}function st(e){return de(e)}function tr(e){try{const t=new URL(e);return t.hostname=t.hostname.replace(/^(www\.|web\.|mbasic\.|mobile\.)(secure\.)?/,""),t.pathname="",[...t.searchParams.keys()].forEach(r=>t.searchParams.delete(r)),t.toString()}catch{return e}}function nt(e){if(!e)return null;try{return new URL(e).hostname}catch{return null}}function rr(e){const t=nt(e);return t?t.replace(/^www\./,""):e}export{We as $,wt as A,jt as B,tr as C,At as D,er as E,_t as F,lt as G,ee as H,ae as I,Pt as J,zt as K,Xt as L,$t as M,Bt as N,Ht as O,H as P,gt as Q,Mt as R,Wt as S,Qt as T,C as U,ct as V,Ot as W,Nt as X,M as Y,Ye as Z,St as _,Ve as a,Vt as a0,vt as a1,dt as a2,mt as a3,ft as a4,Ke as a5,pt as a6,ut as a7,Gt as a8,Ut as b,yt as c,rt as d,Yt as e,kt as f,Zt as g,Tt as h,xt as i,Kt as j,qt as k,It as l,bt as m,Jt as n,de as o,rr as p,le as q,Ct as r,Dt as s,st as t,ht as u,$e as v,Lt as w,Rt as x,Ft as y,Et as z};
//# sourceMappingURL=jjp48s31c2bxsk72.js.map
