import{eW as S,K as j,r as d,l as i,cB as B,eX as q,m as P,eY as Y}from"./f1tbg9vupz7s4vaz.js";import{f2 as $,f3 as K,ar as g,f4 as X,dt as Z,f5 as J,f6 as Q,f7 as ee,f8 as te,f9 as se,fa as ae,fb as oe,fc as ie,fd as ne,fe as _,ff as re,fg as k,fh as ce,D as M,fi as de,fj as le,fk as ue,ap as fe,fl as pe,fm as R,Z as W,G as me,fn as D}from"./eyfm2skil9fzhvo1.js";import{u as he}from"./lrkgybq48wcmqeej.js";import{T as xe}from"./nt83og1ffeibaufs.js";import{v as ge,m as be,B as ve,C as Ce}from"./oixhn1b8fi6yhijp.js";import{m as p}from"./fitsuk0mifdju5f0.js";import"./ku9ixf6u9z228exb.js";import"./mt6h4jzk1jkcs287.js";import"./ioundd5um2qmksi3.js";import"./jjp48s31c2bxsk72.js";import"./fe4da7l7k2gvtlow.js";import"./c77l8ej6lw2btxdd.js";import"./hprljityfrryo2gz.js";import"./jdy1yw2t3lc2tl2b.js";import"./ljaj5cms73a3s5g2.js";import"./eg0vn9lfdm5eewe7.js";import"./l45k6ig1jn8cj2c1.js";import"./jzmm2rrmfulao93u.js";import"./ix46tddc1xj4hezn.js";import"./bbachvd0uet7chjz.js";import"./l3dd0a36sd9dz113.js";import"./ozai9665rl97qkmr.js";import"./knogs7bdg0wni4ko.js";import"./bst9lq9idt62o2tf.js";import"./n1ugpxrluw7f2lu7.js";const F="oai/apps/canmoreSidebarWidth",we=.25,ye=400,L=400;function G(e){return e-ye}function w(e,o){return K(L,G(e),o??we*e)}function Se(){const e=S.useState(S.selectWindowWidth),o=w(e,$(j.DANGER_SECRET_FOLDERS_ONLY_getItem(F))),s=A(),[t,n]=d.useState(o);d.useEffect(()=>{(t<L||t>G(e))&&n(w(e,t))},[e]);function a(r){n(m=>w(e,m+=r.delta.x))}function c(r){n(r),j.DANGER_SECRET_FOLDERS_ONLY_setItem(F,r)}function l(){const r=w(e,void 0);c(r)}const f=`calc(100vw - ${t}px)`;return s?{chatWidth:t,canvasWidth:e-t,canvasWidthCalc:f,viewportWidth:e,handleDrag:a,handleDoubleClick:l,persist:c}:{chatWidth:0,canvasWidth:e,canvasWidthCalc:"100vw",viewportWidth:e,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function A(){return S.useState(e=>S.selectWindowWidth(e)>1e3)}function Te(e,o){let s;return o?.type===g.Textdoc&&(s={type:"canvas_textdoc",id:o.textdocId}),{...e,messageMetadata:{...e.messageMetadata,open_in_canvas_view:s}}}const H=({isFullScreen:e=!1,clientThreadId:o,focusedObject:s,onClose:t,isAnimating:n=!1,width:a})=>{const{setTargetedContent:c}=X(),l=d.useRef(!1);if(d.useEffect(()=>(l.current&&c(void 0),l.current=!0,()=>{l.current=!1}),[s]),s==null)return null;switch(s.type){case g.Textdoc:return i.jsx(xe,{isFullScreen:e,onClose:t,clientThreadId:o,focusedTextdoc:s,isAnimating:n,width:a});case g.ADAVisualization:return null}},Ie=300,Ee=e=>e?.type===g.Textdoc?e.textdocId:null;function Ae(e){const o=ge(e),s=Z(o),t=be(e),n=ve(e,t),a=Ce({clientThreadId:e,conversationLeafId:t}),c=J(),[l,f]=d.useMemo(()=>{let x;return!a&&n&&(x=Q(ee(n.messages))),Ne(s,c,x)},[a,n,s,c]),r=f!=null,m=Ee(f);d.useEffect(()=>{if(f&&l&&(te(f,l),f.type===g.Textdoc)){const{textdocId:x}=f,T=re(x);se(document.getElementById(T))}},[r,m])}function Ne(e,o,s){switch(s?.type){case ae.Canmore:{const[t,n]=s.messages;if(!oe(t?.message))break;const a=ie(e,t.message,n?.message??null),c=a.textdocId??o;if(c&&(a.function===ne.CreateTextdoc?(a.content??"").length>Ie||a.status===_.WAITING:a.status===_.STREAMING))return[a.messageId,{type:g.Textdoc,textdocId:c}];break}}return[void 0,null]}const je=260,y={type:"spring",bounce:.12,duration:.64},O={type:"spring",bounce:0,duration:.58},_e=({clientThreadId:e,focusedObject:o,onClose:s})=>{const{chatWidth:t,canvasWidthCalc:n,handleDrag:a,handleDoubleClick:c,persist:l}=Se(),[f,r]=d.useState(!0),[m,x]=d.useState(!1),T=M(u=>u.activeSidebar),I=de(({rect:u})=>u),{windowHeight:b,windowWidth:v}=q(u=>u,{windowWidth:0,windowHeight:0});let h=I??{top:0,left:t,width:v-t,height:b},N=!1;if(I&&(h.top<0||h.top+h.height>b)){N=!0;const u={width:(v-t)*.75,height:b*.75};h={top:b/2-u.height/2,left:(v-t-u.width)/2+t,width:u.width,height:u.height}}const C=I?.borderRadius,E=le(),U=E?.history!=null||E?.showChangesAtVersion!=null,V=M(u=>u.isDesktopNavCollapsed);return i.jsxs(i.Fragment,{children:[U&&i.jsx(p.div,{className:"fixed inset-0 z-20 bg-gray-50/50 dark:bg-black/50",initial:{opacity:0},animate:{opacity:1},onClick:()=>ue(E.textdocId)}),i.jsxs(p.div,{initial:{marginRight:V?0:-je},animate:{marginRight:0},transition:O,children:[i.jsx(p.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:{...y,delay:.22},className:"pointer-events-none absolute left-0 top-0 z-20 h-full w-full bg-token-main-surface-primary"}),i.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"pointer-events-none absolute left-0 top-0 z-10 h-full w-full bg-black/[0.025] dark:bg-transparent"}),i.jsx(p.div,{className:"relative z-20 h-full",initial:!1,style:{width:n},exit:{width:0,transition:{duration:0}},transition:O})]}),i.jsx(p.div,{className:P("absolute z-20 h-full overflow-hidden transition-shadow",T==="debug"?"md:left-[-250px] lg:left-[-300px] xl:left-[-350px] 2xl:left-[-400px]":"left-0"),initial:{opacity:N?0:1,x:h.left,y:h.top,width:h.width,height:h.height,borderRadius:C,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},animate:{opacity:1,x:t,y:0,width:n,height:"100%",borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:{opacity:{duration:.14,bounce:.1}},borderRadius:C,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:m?{duration:0}:y,onAnimationComplete:()=>r(!1),children:i.jsx(p.div,{className:"h-full overflow-hidden border-l border-gray-100 dark:border-token-border-medium",initial:{borderRadius:C},animate:{borderRadius:0},exit:{borderRadius:C},transition:y,children:i.jsxs("div",{className:"h-full",children:[i.jsx(p.div,{drag:"x",className:"absolute left-[-2px] z-10 h-full w-[4px] cursor-ew-resize bg-token-text-quaternary opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onDrag:(u,z)=>{x(!0),a(z)},onDragEnd:()=>{x(!1),l(t)},onDoubleClick:()=>c()}),i.jsx(H,{onClose:s,clientThreadId:e,isAnimating:f,focusedObject:o,width:v-t})]})})})]})},Me=d.memo(_e),Re=({clientThreadId:e,focusedObject:o,onClose:s})=>{const t=A();return i.jsx(Y,{children:i.jsx(p.div,{className:"fixed inset-0 z-20 overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},exit:t?void 0:{opacity:0,scale:.98},transition:y,children:i.jsx(H,{isFullScreen:!0,clientThreadId:e,focusedObject:o,onClose:s})})})},We=({clientThreadId:e})=>{const o=A(),s=he(e);Ae(e);const t=fe(),n=pe(({resolveTempTextdocId:r})=>r),a=d.useMemo(()=>{let r=t;if(t?.type===g.Textdoc){const m=n?.[t.textdocId];m&&(r={...t,textdocId:m})}return r},[t,n]);d.useEffect(()=>{k()},[e]);const c=a&&(o?i.jsx(Me,{clientThreadId:e,onClose:D,focusedObject:a},"canvas-sidebar"):i.jsx(Re,{clientThreadId:e,onClose:D,focusedObject:a},"canvas-modal"));d.useEffect(()=>{if(a)return R(r=>Te(r,a)),()=>R(null)},[a,n]);const l=c!=null;return d.useEffect(()=>(W.setActiveStageSidebar(l),()=>W.setActiveStageSidebar(!1)),[l]),s!==e?null:i.jsx(me,{initial:!1,children:c})},it=e=>{const o=d.useRef(null);return i.jsx(B,{ref:o,onError:(s,t)=>{k(),setTimeout(()=>{o.current?.resetErrorBoundary()}),ce.logError("Error boundary hit",s,{componentStack:t})},name:"canmore-focused-view",children:i.jsx(We,{...e})})};export{it as CanvasFocusedViewManager};
//# sourceMappingURL=dp3sw9ytuamjxy7x.js.map
