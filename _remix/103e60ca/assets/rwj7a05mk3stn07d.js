const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ordg07m7wvo6hgn3.js","assets/mog4ji1enf6w9x04.js","assets/j4s44eoworcfgpbk.js","assets/root-i2ogspqj.css","assets/bp5aai1dwvlpcqfm.js","assets/conversation-small-ile61fj8.css","assets/kh5pbz8rrk349t6j.js","assets/fzrn137102spawew.js","assets/e9lafxuzyeh4418f.js","assets/gc574ukyr4imd478.js","assets/h3jnm3fdzexvjxzj.js","assets/oo96g80qjtmk340c.js","assets/ohtc4vn3qbytcec2.js","assets/mzkxlhrlmxhntkvn.js","assets/lj9ibor7d19efoik.js","assets/kxyfgk9edh02h0lw.js","assets/hwmkmip30wb8402u.js","assets/c4bxzbp1808foto4.js","assets/et9boeu144ybfcf9.js","assets/cf0vl3nion0u5hbm.js","assets/did3v6d6vfpagkfy.js","assets/eyarljydwvt66nvz.js","assets/w3fqzwb6ljesm4i1.js","assets/gxheuh32yjkq5458.js","assets/jkvr2pfjfhg0hmro.js","assets/h30wqxkm87lniyah.js","assets/ohra68b8pselj8ds.js","assets/gisw1guhs148wg8z.js","assets/fvd4d9pp5itab2xo.js","assets/hshqueykbu7hxyn2.js"])))=>i.map(i=>d[i]);
import{cD as Ue,gc as ne,o as q,y as I,v as oe,am as ae,L as Ee,aT as Fe,D as Ge,eO as Js,ci as Oe,cj as Be,ck as De,a9 as cs,aK as Xs,aH as We,aI as He,aG as ds,r as d,aN as $e,m as e,G as V,H as ie,t as us,c_ as J,bf as ms,u as gs,c9 as qe,aS as g,aY as pe,F as le,e3 as et,aL as fs,a3 as ue,aD as re,hw as st,Z as ye,eR as ps,br as K,c5 as Ve,d5 as hs,a_ as Pe,P as xs,d as vs,b2 as js,aJ as ys,cp as tt,gL as bs,dK as at,d3 as he,d$ as it,M as nt,W as rt,b_ as Xe,bZ as es,gV as ot,dn as lt,dp as ct,fV as dt,a4 as ut,gG as mt,fW as gt}from"./mog4ji1enf6w9x04.js";import{bj as ft,bi as pt,j2 as Ms,b1 as ws,hK as Ke,aK as ht,j3 as xt,j4 as Ts,j5 as Ps,bU as ks,ak as Ss,j6 as Cs,b7 as Is,U as de,e_ as W,b as Ns,bJ as je,bK as _s,eN as Qe,ev as vt,en as jt,ch as yt,cC as Ae,ax as G,ex as xe,et as ve,ep as Ye,hQ as Gs,j7 as bt,i9 as As,ia as Mt,j8 as wt,dN as se,eo as Tt,c4 as Ls,eX as zs,j9 as Pt,bf as kt,eY as Rs,eZ as Us,e$ as St,ja as Ct,a_ as It,f0 as Nt,be as Le,f1 as _t,jb as Gt,jc as ss,jd as ke,je as At,cE as ts,dI as Es,ej as Lt,ek as zt,el as Rt,dJ as Ut,ay as Et,ce as Ft,jf as as,jg as Ot,cz as Bt,dO as Dt,jh as Wt,b5 as Ht,e9 as $t,fD as is,ji as qt,jj as Vt,at as Kt,jk as Qt,jl as Yt,i as Zt,jm as ns,jn as Jt,cw as Xt}from"./bp5aai1dwvlpcqfm.js";import{i as ea,c as be,C as te,M as Fs,A as ce,G as sa,a as ta,b as rs,s as aa,r as ze,S as ia,d as na,E as ra,e as oa,g as la,f as ca,h as da}from"./kxyfgk9edh02h0lw.js";import{C as Os,T as Bs}from"./did3v6d6vfpagkfy.js";import{i as Re}from"./fvd4d9pp5itab2xo.js";import{ag as Ds,af as ua,L as ma,aW as Ws,aw as ga,bz as fa,E as pa,b3 as ha,b7 as xa,x as va,y as ja,t as ya,bs as ba,b as Ma,c as wa,bq as Ta}from"./j4s44eoworcfgpbk.js";import{G as Pa}from"./hshqueykbu7hxyn2.js";import{F as Q,a as Y,b as Se,c as ka,G as Sa,d as Ca}from"./lj9ibor7d19efoik.js";import{m as Hs}from"./w3fqzwb6ljesm4i1.js";import{G as Ia}from"./gxheuh32yjkq5458.js";function Na(s,t){const a=I.getThreadCurrentLeafId(s),o=I.getTree(s),n=[];let r=o.getNodeByIdOrMessageId(a);for(;r!=null&&(t==null||r.id!==t);)n.unshift(r.message),r=r.parentId!==""?o.getNodeByIdOrMessageId(r.parentId):void 0;return n}function _a(s){return s.filter(o=>o.recipient==="gizmo_editor.update_behavior").flatMap(o=>o.content.content_type==="text"?o.content.parts:o.content.content_type==="code"?[o.content.text]:[]).map(o=>JSON.parse(o)).reduce((o,n)=>({...o,...n}),{})}async function Ga(s){let t;for(const a of s)if(a.author.name==="gizmo_editor.generate_profile_pic"){const o=Xs.getImageAssetPointers(a);o.length>0&&(t=o.at(-1))}if(t!=null){const a=ht(t.asset_pointer),o=await Ee.getFileDownloadLink(a);if(o.status===Fe.Success)return{id:a,permalink:o.download_url}}}async function Aa(s,t,a,o){const n=Na(t,o),r=_a(n);let i=await Ga(n);if(Re(r)&&i==null)return;const{name:m,context:l,description:f,profile_pic_file_id:y,prompt_starters:j}=r;if(y!=null)try{const c=await Ee.getFileDownloadLink(y,s.id);c.status===Fe.Success&&(i={id:y,permalink:c.download_url})}catch(c){Ge.addError(new Error("Error while retrieving profile pic in update",{cause:c})),a.warning("Something went wrong updating your GPT's profile picture.",{duration:3})}const u={name:typeof m=="string"?m:void 0,description:typeof f=="string"?f:void 0,instructions:typeof l=="string"?l:void 0,promptStarters:Array.isArray(j)?j:void 0,profilePictureId:i?.id,profilePictureUrl:i?.permalink};return Js(u,c=>c!=null)}function La(s){const t=new Set;for(const l of s.tools)t.add(l.type);const a=s.name??"",o=s.description??"",n=s.instructions??"",r=Array.from(t).join(","),i=a===""&&o===""&&n==="",m=s.profilePictureUrl!=null;return i?`The GPT you are about to has the following abilities: ${r}.`:`This is the GPT's current set of fields:

name: ${a}

description: ${o}

context: ${n}

abilities: ${r}

${m?"The GPT has a profile picture.":"This GPT does not have a profile picture. You must generate a profile picture when you next update your behavior."}
`}function $s(s,t,a,o){const n=a.current,r=o.current;if(Ue(n,r))return;const i={};n.name!==r?.name&&(i.name=n.name),(n.description??"")!==(r?.description??"")&&(i.description=n.description??""),n.instructions!==(r?.instructions??"")&&(i.context=n.instructions??"");const m=new Set(r?.files?.map(u=>u.file_id)??[]),l=new Set(n.files?.map(u=>u.file_id)??[]),f=(n.files??[]).filter(u=>!m.has(u.file_id)),y=(r?.files??[]).filter(u=>!l.has(u.file_id));if(Re(i)&&f.length===0&&y.length===0)return;const j=[];if(!Re(i)){const u=`Explicitly update the GPT's behavior to the following exact fields:

    ${JSON.stringify(i,null,2)}

    "Do not call update_behavior yet. Instead, use these updated fields as the GPT's current behavior, and in the next call to update_behavior, incorporate these changes."
    `;j.push(ne.getTextAsMessage(u,q.System))}y.length>0&&j.push(ne.getTextAsMessage(`The user has removed the following files from the GPT. You can no longer reference these files: ${y.map(u=>u.file_id).join(", ")}`,q.System)),f.length>0&&j.push(ne.getTextAsMessage(`The user is adding these files to the GPT. The GPT may reference these files. The file IDs are: ${f.map(u=>u.file_id).join(", ")}`,q.System,{attachments:f.map(u=>({id:u.file_id,name:u.name,size:u.size}))})),j.length>0&&I.updateTree(s,u=>{let c=u.getNodeByIdOrMessageId(t).parentId;for(const v of j){const x=oe();u.insertNodeBefore(t,{id:x,children:[],parentId:c,message:v,metadata:{isClientCreatedSystemMessage:!0}}),c=x}})}function za(s,t,a){if(a.length===0)return;const o=oe(),n=`The user is uploading files in their next message. If you need to reference these in calls to update_behavior, you will use the following File ID(s), in order: ${a.map(r=>`"${r.fileId}"`).join(", ")}`;I.updateTree(s,r=>{const i=r.getNodeByIdOrMessageId(t).parentId;r.insertNodeBefore(t,{id:o,children:[],parentId:i,message:ne.getTextAsMessage(n,q.System),metadata:{isClientCreatedSystemMessage:!0}})})}function Ra(s,t){const a="Remember, you should be calling either update_behavior or generate_profile_pic after most messages from the user. Your personality should be neutral and separate from the GPT you are creating.",o=I.getThreadCurrentLeafId(s),n=I.getTree(s);let r=n.getNodeByIdOrMessageId(o);for(;r!=null&&r.message.author.role!==q.User;){if(r.message.content.content_type==="text"&&r.message.content.parts[0]===a)return;r=r.parentId!==""?n.getNodeByIdOrMessageId(r.parentId):void 0}I.updateTree(s,i=>{const m=i.getNodeByIdOrMessageId(t).parentId;i.insertNodeBefore(t,{id:oe(),children:[],parentId:m,message:ne.getTextAsMessage(a,q.System,{exclude_after_next_user_message:!0}),metadata:{isClientCreatedSystemMessage:!0}})})}function Ua(s,t,a){I.initThread(s,{kind:ae.GizmoMagicCreate,gizmo_id:void 0,behavior_overrides:a});const n=ft().id,r=pt(s)??n,i=Ms({clientThreadId:s,onCompletionFinished:t});return async(l,f,y)=>{if(y.length===0)return;const j=new ws;let u=I.getThreadCurrentLeafId(s);for(const T of y){const A=oe();I.updateTree(s,b=>{b.addNodeToEnd(u,{id:A,children:[],parentId:u,message:ne.getTextAsMessage(T,q.System),metadata:{isClientCreatedSystemMessage:!0}})}),I.setThreadCurrentLeafId(s,A),u=A}const c=u;$s(s,c,l,f);const v={conversationMode:{kind:ae.GizmoMagicCreate,gizmo_id:l.current.id,behavior_overrides:a}},x=await Oe(),[h,C,P]=await Promise.all([Be.getEnforcementToken(x),Ke.getEnforcementToken(x),De.getEnforcementToken(x)]);i({model:r,completionType:cs.Next,parentNodeId:c,metadata:{},focusOnNewCompletion:!0,chatReq:x,arkoseToken:h,turnstileToken:C,proofToken:P,preflightTime:0,completionMetadata:v,turnTracker:j})}}const Ea="Generate a new profile picture for this GPT using gizmo_editor generate_profile_pic. Do not prompt the user for any clarification. Do not send extra text outside of the tool function call. DO NOT CALL update_behavior or otherwise update GPT behavior in your response.",Fa=We(()=>He(()=>import("./ordg07m7wvo6hgn3.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])).then(s=>s.DebugConversationSidebar));function Oa(s,t){d.useEffect(()=>{const a=I.getTree(s);if(a.findNode(i=>i.message.author.role===q.User||i.metadata?.isClientCreatedSystemMessage===!0)||(I.deleteNodesByFilter(s,i=>i.metadata?.isPlaceholderTemplateAssistantWelcomeMessage===!0),t==null||t.length===0))return;const n=I.getThreadCurrentLeafId(s);if(!a.hasNodeOrMessageId(n))return;const r=oe();I.updateTree(s,i=>{i.addNode(r,t,n,q.Assistant,{isPlaceholderTemplateAssistantWelcomeMessage:!0})}),I.setThreadCurrentLeafId(s,r)},[s,t])}function Ba(s,t,a){Ns(s,{kind:ae.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:a}),d.useEffect(()=>{I.updateConversationMode(s,{kind:ae.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:a})},[s,t.id,a]);const[o]=d.useState(()=>{const n=t.id==null,r=t.id!=null&&t.name!==""&&t.description!=null&&t.instructions!==""&&t.profilePictureUrl!=null;return n?`Hi! I'll help you build a new GPT. You can say something like, "make a creative who helps generate visuals for new products" or "make a software engineer who helps format my code."

What would you like to make?`:r?`Welcome back! Is there anything ${t.name} should be doing better? Anything you'd like to change?`:"You're back! Let's continue where we left off..."});Oa(s,o)}function Da({gizmoEditorData:s,updateGizmo:t,clientThreadId:a,completionCallbackResponse:o,gizmoEditorDataRef:n,magicMakerBehaviorOverrides:r,magicMakerConversationGizmoEditorDataRef:i,requireGizmoId:m}){const l=d.useMemo(()=>({gizmoEditorData:s,gizmoId:s.id,mode:"magic",behaviorOverrides:r,getGizmoId:m}),[m,s,r]),f=xt(c=>c.files.filter(v=>v.status===W.Ready&&v.gizmoId!=null)),y=d.useCallback((c,v)=>{za(c,v,f),$s(c,v,n,i),Ra(c,v),t(x=>({...x,files:[...x.files??[],...$e(f.map(h=>h.fileId!=null&&{file_id:h.fileId,name:h.file.name,size:h.file.size,type:Ts(h.file),last_modified:h.file.lastModified,file_size_tokens:h.fileSpec?.fileTokenSize}))]})),i.current=Ps(n.current)},[n,i,f,t]),j=ks(c=>c.activeSidebar),u=Ss();return e.jsx(Cs.Provider,{value:l,children:e.jsxs("div",{className:"relative flex h-full grow overflow-auto",children:[e.jsx("div",{className:"grow",children:u?e.jsx("div",{className:"contents",style:{"--screen-height-override":"100%"},children:e.jsx(Is,{clientThreadId:a,children:e.jsx(Os,{hideHeader:!0,embedded:!0})})}):e.jsx(Bs,{clientThreadId:a,onCompletionFinished:o,preRequestCompletion:y,hideHeader:!0,prependThreadChildren:e.jsx("div",{className:"h-8"})})}),j==="debug"&&e.jsx(Fa,{clientThreadId:a,slideOver:!1,onClose:()=>de.toggleActiveSidebar("debug"),isOpen:!0})]})})}const Wa=ds.memo(Da);function Ha({gizmo:s,updateGizmo:t,publishedGizmo:a,promoteGizmo:o,appealGizmo:n,setAppealState:r,showActionsModal:i,shareOnly:m,onClose:l}){const[f,y]=d.useState({type:"privacy"});return f.type==="privacy"?e.jsx(qa,{gizmo:s,updateGizmo:t,publishedGizmo:a,promoteGizmo:o,appealGizmo:n,setAppealState:r,setStep:y,showActionsModal:i,shareOnly:m,onClose:l}):e.jsx(Va,{publishedGizmo:f.publishedGizmo,onClose:l})}function $a(s){return s?G.Workspace:G.Link}function qa({gizmo:s,publishedGizmo:t,updateGizmo:a,promoteGizmo:o,appealGizmo:n,setAppealState:r,setStep:i,showActionsModal:m,shareOnly:l,onClose:f}){const[y,j]=d.useState(!1),u=je(_s.isBusinessWorkspace),c=V(),v=ie(),[x,h]=d.useState(Qe(s)?$a(!!u):s.sharingRecipient),C=us(),P=ea(x,s.sharingTargets),{data:T,isLoading:A}=vt(),b=jt(),[p,S]=d.useState(t!=null&&t.gizmo.display.categories.length>0?b.data?.categories.find(M=>M.id===t.gizmo.display.categories[0])?.id:void 0);d.useEffect(()=>{S(t?.gizmo.display.categories[0])},[t?.gizmo.display.categories]);const[_,O]=d.useState(void 0),N=d.useRef(yt((M,L)=>Ae.generateCategory(M,L),1e3)),E=T?.is_verified?void 0:c.formatMessage({id:"qUMu4e",defaultMessage:"To publish your GPTs to the Explore GPTs page, set up your builder profile in the user settings page."});x===G.Marketplace&&E!=null&&!A&&h(G.Link);const H=u&&!s.sharingTargets?.some(M=>M.recipient===G.Link),B=be(s,x,p),U=B.includes(te.MissingPublicActionPrivacyPolicyURL),F=s.tools.find(M=>M.type===J.JIT_PLUGIN&&!M.metadata.privacy_policy_url),me=je(M=>M.currentWorkspace),Me=ms();d.useEffect(()=>{let M=!0;return(async()=>{try{if(p!=null)return;const L=await N.current(s.name,s.instructions);M&&p==null&&(L?S(L.id):O(!0))}catch{M&&p==null&&O(!0)}})(),()=>{M=!1}},[s.instructions,s.name,Me,p]);const{value:D}=gs("4226692983");return e.jsx(qe,{type:"success",isOpen:!0,onClose:f,title:e.jsx(g,{id:"9viumf",defaultMessage:"Share GPT"}),showCloseButton:!0,primaryButton:P?e.jsx(pe,{color:"primary",disabled:B.length>0,loading:y,onClick:async()=>{try{if(j(!0),l){if(!t?.gizmo.id){v.danger(c.formatMessage({id:"QYVEx8",defaultMessage:"Error sharing GPT"}));return}const M=await Ae.shareGizmo(t.gizmo.id,p?{sharing:xe(x,[],ve),categories:[p]}:{sharing:xe(x,[],ve)});M.error?(v.warning(c.formatMessage({id:"tmIKmp",defaultMessage:"Unable to share GPT"})),a({sharingTargets:M.sharing_targets}),r({gizmoId:t.gizmo.id,sharingRecipient:x,categories:t.gizmo.display.categories,moderationType:Fs.PublishBlocked,sharingTargets:M.sharing_targets,showModal:ce.AppealAvailable})):(C.setQueryData(["gizmo",{gizmoId:t.gizmo.id},{draft:!1}],L=>M.resource),a(L=>({...L,sharingRecipient:x})),v.success(c.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),f())}else{const M=await o({recipient:x,subjects:xe(x,[],ve)},p);M?(i({type:"published",publishedGizmo:M}),a(L=>({...L,id:M.gizmo.id,sharingRecipient:x})),M.gizmo.live_version!=null&&a({liveVersion:M.gizmo.live_version}),v.success(c.formatMessage({id:"R5zko1",defaultMessage:"GPT published"}),{testId:"gpt-published-toast"})):(v.warning(c.formatMessage({id:"uf7WYw",defaultMessage:"Unable to publish GPT"})),f())}}finally{j(!1)}},"data-testid":"save-gizmo-button",children:e.jsx(g,{id:"SW4DG4",defaultMessage:"Save"})}):D?e.jsx(e.Fragment,{children:e.jsx(pe,{color:"primary",onClick:async()=>{await n(x,p)},children:e.jsx(g,{id:"bBmLUr",defaultMessage:"Appeal"})})}):null,secondaryButton:t?e.jsx(pe,{color:"secondary",onClick:M=>Ye(t,v,M,c.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:e.jsx(g,{id:"wvL15a",defaultMessage:"Copy link"})}):null,children:e.jsxs("div",{className:"mx-[-16px] flex flex-col gap-3 text-sm",children:[e.jsx("div",{className:"space-y-1.5",children:e.jsxs(Gs,{value:x,onValueChange:M=>h(M),children:[s.sharingTargets&&s.sharingTargets.map((M,L)=>e.jsx(Ce,{value:M.recipient,disabled:M.recipient===G.Marketplace&&E!=null,tooltipText:M.recipient===G.Marketplace?E??c.formatMessage({id:"0Rcb4e",defaultMessage:"Your GPT will appear in the Explore GPTs page"}):void 0,shareLevel:M.recipient},L)),H&&e.jsxs(e.Fragment,{children:[e.jsx(Ce,{value:G.Link,disabled:!0,tooltipText:c.formatMessage(os.workspaceDisabledHint),shareLevel:G.Link,workspaceName:me?.name}),e.jsx(Ce,{value:G.Link,disabled:!0,tooltipText:c.formatMessage(os.workspaceDisabledHint),shareLevel:G.Marketplace,workspaceName:me?.name})]})]})}),U&&e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(g,{id:"/iw1Iv",defaultMessage:"Public actions require valid privacy policy URLs. Click <fixlink>here</fixlink> to update.",values:{fixlink:M=>e.jsx("button",{onClick:()=>{m(F?.metadata.action_id)},className:"underline",children:M})}})}),x!==G.Private&&e.jsx(sa,{gizmo:s,category:p,categories:x===G.Marketplace?b.data?.categories??[]:void 0,onCategoryChange:x===G.Marketplace?M=>S(M.id):void 0}),x===G.Marketplace&&(_?e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(g,{id:"tpC3ui",defaultMessage:"There was an error updating the list of categories"})}):null),!P&&D&&e.jsx("div",{className:"flex items-center justify-between text-sm text-token-text-secondary",children:e.jsx(g,{id:"jLCMMV",defaultMessage:"Because this GPT previously may have violated our policies, you will have to submit an appeal to make it available at this level."})})]})})}function Va({publishedGizmo:s,onClose:t}){const a=bt(s),o=V(),n=ie();return e.jsx(qe,{type:"success",isOpen:!0,onClose:t,title:e.jsx(g,{id:"rCRRmx",defaultMessage:"Settings Saved"}),showCloseButton:!0,primaryButton:e.jsx(pe,{color:"primary",as:"link",to:a,children:e.jsx(g,{id:"lyZz44",defaultMessage:"View GPT"})}),children:e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex gap-1 rounded bg-token-main-surface-secondary px-2 py-1",children:[e.jsx("div",{className:"line-clamp-1 text-ellipsis break-all",children:a}),e.jsx("button",{onClick:r=>{Ye(s,n,r,o.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"}))},className:"text-token-text-secondary transition hover:text-token-text-primary","data-testid":"copy-saved-gpt-url-button",children:e.jsx(Ds,{className:"icon-sm"})})]})})})}const os=le({workspaceDisabledHint:{id:"gizmo.workspaceDisabledHint",defaultMessage:"Your workspace administrator has disabled this setting"}});function Ce({shareLevel:s,workspaceName:t,value:a,disabled:o=!1,tooltipText:n}){const r=d.useId();return e.jsx(et,{disabled:n==null,label:n,side:"top",children:e.jsxs(As,{id:r,value:a,disabled:o,className:"flex h-14 w-full cursor-pointer flex-row items-center justify-between gap-2 rounded-md px-3 py-4 font-semibold hover:bg-token-main-surface-secondary",children:[e.jsx("label",{htmlFor:r,className:"flex cursor-pointer items-center gap-1",children:e.jsx(ta,{shareLevel:s,workspaceName:t??"",hasInviteSharing:!1})}),e.jsx(Mt,{children:e.jsx(ua,{className:"icon-lg mr-1"})})]})})}function qs(s){window.history.length>1?s(-1):s(wt())}function Ka({gizmo:s,publishedGizmo:t,isLoading:a,isUploadingProfilePic:o,isGeneratingProfilePic:n,updateGizmo:r,promoteGizmo:i,appealGizmo:m,setAppealState:l,showActionsModal:f}){const y=ye(),j=s!=null?be(s):[];(s==null||a)&&j.push(te.Loading),o&&j.push(te.UploadingProfilePic),n&&j.push(te.GeneratingProfilePic);const u=Qe(s),[c,v]=d.useState(!1),[x,h]=d.useState(!1),C=s.sharingRecipient?rs[s.sharingRecipient]:rs.private;return e.jsxs(e.Fragment,{children:[u?e.jsx(se,{color:"primary",onClick:()=>v("promote"),loading:a,disabled:s.id===void 0||j.length>0,tooltip:j.length>0?j.map(ze).join(`
`):void 0,testId:"gizmo-editor-create-gpt-button",children:e.jsx(g,{id:"svUGIb",defaultMessage:"Create"})}):e.jsxs(e.Fragment,{children:[e.jsxs(se,{color:"secondary",loading:a||!t,onClick:()=>v("share"),children:[e.jsx(C,{className:"icon-sm shrink-0"}),e.jsx(g,{id:"aXKW4G",defaultMessage:"Share"})]}),e.jsx(se,{color:"primary",onClick:async()=>{let P=s.sharing.subjects.map(aa);const T=Tt(s.sharing.subjects);P=xe(s.sharing.recipient,P,T?.capabilities??ve),await i({recipient:s.sharing.recipient,subjects:P},t?.gizmo.display.categories[0])&&h(!0)},loading:a||!t,disabled:j.length>0,tooltip:j.length>0?j.map(ze).join(`
`):void 0,children:e.jsx(g,{id:"84QVoj",defaultMessage:"Update"})})]}),c&&(y?.getWorkspaceId()==null?e.jsx(Ha,{gizmo:s,publishedGizmo:t,promoteGizmo:i,appealGizmo:m,setAppealState:l,showActionsModal:f,updateGizmo:r,shareOnly:c==="share",onClose:()=>v(!1)}):e.jsx(ia,{gizmo:s,publishedGizmo:t,promoteGizmo:i,appealGizmo:m,setAppealState:l,showActionsModal:f,updateGizmo:r,onClose:()=>v(!1),shareOnly:c==="share"})),x&&e.jsx(na,{publishedGizmo:t,sharing:t.gizmo.sharing,onClose:()=>h(!1),workspaceName:y?.data.name??""})]})}function Qa({gizmoEditorData:s,publishedGizmo:t,revertDraft:a}){const o=V(),n=ie(),r=ue(),[i,m]=d.useState(!1),l=ms(),{value:f}=gs("3645668434");return!l?.includes("debug")&&s?.id==null?null:e.jsxs(e.Fragment,{children:[e.jsxs(ps,{side:"top",contentAlign:"end",sideOffset:8,triggerButton:e.jsx(se,{color:"ghost",icon:ma}),children:[t!=null&&e.jsxs(K.Item,{onClick:y=>{Ye(t,n,y)},children:[e.jsx(Ws,{className:"icon-sm"}),e.jsx(g,{...Z.copyLink})]}),a!=null&&e.jsxs(K.Item,{onClick:()=>{window.confirm(o.formatMessage(Z.revertConfirm))&&a()},children:[e.jsx(ga,{className:"icon-sm"}),e.jsx(g,{id:"W2blnV",defaultMessage:"Revert..."})]}),s?.id!=null&&f&&s.liveVersion>0&&e.jsxs(e.Fragment,{children:[e.jsxs(K.Item,{onClick:()=>{r(`/g/${s.id}/view`)},children:[e.jsx(fa,{className:"icon-sm"}),e.jsx(g,{id:"gizmo.versionHistory",defaultMessage:"Version History"})]}),e.jsxs(K.Item,{onClick:async()=>{const y=await Ae.copyGizmo({gizmoId:s.id});y.gizmo.id&&r(`/gpts/editor/${y.gizmo.id}`)},children:[e.jsx(Ds,{className:"icon-sm"}),e.jsx(g,{id:"GizmoInformation.copyGizmoLabel",defaultMessage:"Duplicate GPT"})]})]}),s?.id!=null&&e.jsxs(K.Item,{color:"danger",onClick:()=>{m(!0)},children:[e.jsx(pa,{className:"icon-sm"}),e.jsx(g,{id:"tNrOLG",defaultMessage:"Delete GPT"})]}),l?.includes("debug")&&e.jsxs(e.Fragment,{children:[e.jsx(K.Separator,{}),e.jsxs(K.Item,{onClick:()=>{de.toggleActiveSidebar("debug")},children:[e.jsx(ha,{className:"icon-sm"}),"Debug (Internal only)"]})]})]}),i&&e.jsx(Pa,{gizmoId:s.id,onSuccess:()=>qs(r),onClose:()=>{m(!1)}})]})}const fe=fs.div`flex items-center gap-1`;function Ya({gizmoEditorData:s}){const t=je(a=>a.currentWorkspace?.name);switch(s.sharingRecipient){case G.Private:return e.jsxs(fe,{children:[e.jsx(ja,{className:"icon-xs"}),e.jsx(g,{...Z.onlyMe})]});case G.Link:return e.jsxs(fe,{children:[e.jsx(Ws,{className:"icon-xs"}),e.jsx(g,{...Z.anyoneWithLink})]});case G.Workspace:return e.jsxs(fe,{children:[e.jsx(va,{className:"icon-xs"}),t]});case G.Marketplace:return e.jsxs(fe,{children:[e.jsx(xa,{className:"icon-xs"}),e.jsx(g,{...Z.public})]});default:return e.jsx("div",{})}}function Za({gizmoEditorData:s}){return e.jsxs("div",{className:"flex items-center gap-2",children:[s.profilePictureUrl!=null?e.jsx(Ls,{isFirstParty:!1,src:s.profilePictureUrl,className:"h-8 w-8"}):e.jsx("div",{className:"h-8 w-8 rounded-full border-2 border-dashed border-token-border-medium"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:s.name||e.jsx(g,{...Z.newGPT})}),e.jsx("div",{className:"text-xs text-token-text-secondary",children:Qe(s)?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-token-text-tertiary"}),e.jsx(g,{...Z.draft})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-brand-green"}),s.sharingRecipient===G.Marketplace?e.jsx(g,{...Z.published}):e.jsx(g,{id:"gizmoEditorHeader.live",defaultMessage:"Live"})," · ",e.jsx(Ya,{gizmoEditorData:s})]})})]})]})}function Ja({gizmoEditorData:s,isLoading:t,isUploadingProfilePic:a,isGeneratingProfilePic:o,publishedGizmo:n,updateGizmo:r,promoteGizmo:i,appealGizmo:m,setAppealState:l,revertDraft:f,draftMessage:y,className:j,hasUnpublishedChanges:u,showActionsModal:c}){const v=ue();return e.jsxs("div",{className:re("relative flex h-14 w-full items-center justify-between gap-2 border-b border-token-border-medium px-3",j),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{className:"cursor-pointer text-token-text-primary",onClick:()=>qs(v),children:e.jsx(st,{className:"icon-lg"})}),e.jsx(Za,{gizmoEditorData:s})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[y,e.jsx(Qa,{gizmoEditorData:s,publishedGizmo:n,revertDraft:f}),e.jsx(Ka,{gizmo:s,publishedGizmo:n,isLoading:t,isUploadingProfilePic:a,isGeneratingProfilePic:o,updateGizmo:r,promoteGizmo:i,appealGizmo:m,setAppealState:l,hasUnpublishedChanges:u,showActionsModal:c})]})]})}const Z=le({onlyMe:{id:"gizmo.onlyMe",defaultMessage:"Only me"},anyoneWithLink:{id:"gizmo.anyoneWithLink",defaultMessage:"Anyone with a link"},public:{id:"gizmo.public",defaultMessage:"Everyone"},newGPT:{id:"gizmo.newGPT",defaultMessage:"New GPT"},draft:{id:"gizmo.draft",defaultMessage:"Draft"},published:{id:"gizmo.published",defaultMessage:"Published"},revertConfirm:{id:"gizmo.revertConfirm",defaultMessage:"Are you sure you want to revert to the last saved version?"},copyLink:{id:"gizmo.copyLink",defaultMessage:"Copy link"}}),Xa=512;function ei(){return e.jsx("div",{className:"relative flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-token-border-medium",children:e.jsx(Ve,{className:"h-1/4 w-1/4"})})}function si({gizmoEditorData:s,onFileChange:t,generateProfilePic:a,isGeneratingProfilePic:o,setIsGeneratingProfilePic:n}){const r=V(),i=ie(),[m,l]=d.useState(void 0),f=d.useRef(t);d.useEffect(()=>{f.current=t});async function y(c){if(c.length>0){n(!1);const v=await Nt(c[0],Xa),x=Le(v);l({tempId:x,file:v,status:W.Uploading,progress:1,fileId:null,cdnUrl:null}),f.current("uploading"),_t(x,v,r,i,hs.ProfilePicture,{onFileCreated(h,C,P){l(T=>T!=="initial"&&T?.tempId===h&&T.status===W.Uploading?{...T,progress:10,fileId:C,cdnUrl:P}:T)},onFileUploadProgress(h,C){l(P=>P!=="initial"&&P?.tempId===h&&P.status===W.Uploading?{...P,progress:C}:P)},onFileUploaded(h,C,P){l(T=>T!=="initial"&&T?.tempId===h?(f.current(T),{...T,status:W.Ready,progress:100,fileSpec:{name:T.file.name,id:T.fileId,size:T.file.size,...P??{}}}):T)},onError(h){l(C=>{if(C!=="initial"&&C?.tempId===h){f.current(void 0);return}return C})}})}}const{open:j,getInputProps:u}=zs({disabled:!1,noClick:!0,onDropAccepted:y,onDropRejected:c=>Pt(c,r,i,kt.ProfilePicture),multiple:!0,maxSize:Rs,...Us(St)});return e.jsxs("div",{className:"flex w-full items-center justify-center gap-4",children:[e.jsxs(ps,{sideOffset:8,triggerButton:e.jsx("button",{className:"h-20 w-20",children:o?e.jsx(ei,{}):m!=null&&m!="initial"&&m.status!=W.Ready?e.jsxs("div",{className:"relative h-full w-full overflow-hidden rounded-full",children:[e.jsx(Ct,{file:m.file}),m.status===W.Uploading&&m.progress<90?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:e.jsx(It,{percentage:m.progress,className:"h-6 w-6"})}):null]}):s?.profilePictureUrl!=null&&s?.profilePictureUrl!==""?e.jsx(Ls,{isFirstParty:!1,src:s.profilePictureUrl}):e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-token-border-medium",children:e.jsx(ya,{className:"text-4xl"})})}),children:[e.jsx(K.Item,{onClick:j,children:e.jsx(g,{id:"ERQwXg",defaultMessage:"Upload Photo"})}),e.jsx(K.Item,{onClick:a,children:e.jsx(g,{id:"NXAog/",defaultMessage:"Use DALL·E"})})]}),e.jsx("input",{...u()})]})}function ti({gizmoEditorData:s,requireGizmoId:t,currentModelConfig:a,updateGizmo:o}){const n=V(),r=ie(),[i,m]=d.useState(0),l=d.useRef(new Map),f=Gt(a,void 0),y=async p=>{xs.logEvent(vs.uploadFile,{client:"web",eventSource:"mouse",intent:"gizmo"});const S=await t();p.length>0&&await Promise.all(p.map(_=>{const O=Le(_);l.current.set(O,{tempId:O,gizmoId:S,file:_,status:W.Uploading,progress:1,fileId:null,cdnUrl:null}),At(Le(_),_,n,r,{kind:hs.Gizmo,gizmoId:S},{onFileUploaded:(N,E,H,B)=>{const U=l.current.get(N);U==null||U.fileId==null||(o(F=>({...F,files:[...F.files??[],{file_id:U.fileId,name:U.file.name,size:U.file.size,type:B?.mimeType??Ts(_),last_modified:U.file.lastModified,file_size_tokens:B?.fileTokenSize}]})),l.current.delete(N),m(F=>F+1))},onFileCreated:(N,E,H)=>{l.current.set(N,{tempId:N,gizmoId:S,file:_,status:W.Uploading,progress:1,...l.current.get(N),fileId:E,cdnUrl:H}),m(B=>B+1)},onFileUploadProgress:(N,E)=>{const H=l.current.get(N);H?.status===W.Uploading&&l.current.set(N,{...H,progress:E}),m(B=>B+1)},onError:N=>{l.current.delete(N)}},{usesRetrievalIndex:a!=null&&ke(a,_.type,_.name)===Pe.Retrieval})}))},{getInputProps:j,open:u}=zs({disabled:!1,noClick:!0,onDropAccepted:y,multiple:!0,maxSize:Rs,maxFiles:10,...Us(f)}),c=s?.files??[];function v(p){return e.jsx(ts,{onRemoveFileClick:()=>{l.current.delete(p.tempId),m(S=>S+1)},file:p.file,loadingPercentage:p.status===W.Uploading?p.progress:void 0},p.tempId)}function x(p){return e.jsx(ts,{file:p.name,fileId:p.file_id,onRemoveFileClick:()=>o(S=>({...S,files:S?.files?.filter(_=>_.file_id!==p.file_id)})),gizmoId:s?.id},p.file_id)}const h=Array.from(l.current.values()).filter(p=>c.every(S=>S.file_id!==p.fileId)),[C,P]=ss(h,p=>a!=null&&ke(a,p.file.type,p.file.name)===Pe.CodeInterpreter),[T,A]=ss(c,p=>a!=null&&p.type!=null&&ke(a,p.type,p.name)===Pe.CodeInterpreter),b=d.useRef(T.length);return d.useEffect(()=>{T.length>b.current&&o(p=>p.tools?.some(S=>S.type===J.PYTHON)?p:{...p,tools:[...p.tools??[],{type:J.PYTHON}]}),b.current=T.length},[T.length]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"rounded-lg text-token-text-tertiary",children:e.jsx(g,{...ai.knowledgeWarning})}),P.length>0||A.length>0?e.jsxs("div",{className:"flex flex-wrap gap-2",children:[P.map(v),A.map(x)]}):null,C.length>0||T.length>0?e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs text-token-text-tertiary",children:e.jsx(g,{id:"i/QurZ",defaultMessage:"The following files are only available for Code Interpreter:"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[C.map(v),T.map(x)]})]}):null,e.jsx("div",{children:e.jsxs(se,{onClick:u,children:[e.jsx("input",{...j()}),e.jsx(g,{id:"sr8Qp/",defaultMessage:"Upload files"})]})})]})}const ai=le({knowledgeWarning:{id:"gizmo.knowledgeWarning",defaultMessage:"If you upload files under Knowledge, conversations with your GPT may include file contents. Files can be downloaded when Code Interpreter is enabled"}});function ii({placeholder:s,text:t,onChange:a,onClose:o}){return e.jsx(qe,{className:"!max-h-[100vh] !max-w-[80vw]",type:"success",isOpen:!0,onClose:o,primaryButton:e.jsx(se,{onClick:o,children:e.jsx(g,{id:"FeFVdS",defaultMessage:"Close"})}),children:e.jsx("textarea",{className:"h-[70vh] w-full resize-none rounded-lg bg-token-main-surface-primary dark:border-gray-700",value:t,onChange:n=>{a(n.target.value)},placeholder:s})})}const Ie=fs.div`text-sm text-red-500`;function ni({children:s,collapsed:t,initial:a}){return e.jsx(Et,{initial:a,children:!t&&e.jsx(Hs.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:s})})}function ri({gizmo:s,onShowActionsEditor:t,isDisabled:a}){const o=V(),n=ie(),r=e.jsxs("div",{className:"space-y-1",children:[s?.tools?.map((i,m)=>i.type!==J.JIT_PLUGIN?null:e.jsxs("div",{children:[e.jsx(Ca,{isDisabled:a,actionTool:i,onShowActionsEditor:()=>t(i.metadata.domain)}),i.metadata.auth?.type==="oauth"&&e.jsx(Ft,{label:o.formatMessage(R.callbackUrlLabel),value:`https://chat.openai.com/aip/${i.metadata.action_id}/oauth/callback`,onCopied:()=>{n.success("Copied to clipboard",{duration:3})}})]},m)),(s?.tools?.filter(i=>i.type===J.JIT_PLUGIN)??[]).length>=as?e.jsx("div",{children:o.formatMessage(R.maxActionsReached,{number:as})}):e.jsx(se,{disabled:a,onClick:()=>{t("Unknown domain")},className:"mt-2",children:e.jsx(g,{...R.createActionLabel})})]});return a?e.jsx(ys,{side:"top",label:o.formatMessage(R.disabledCustomActionsTooltip),children:r}):r}function oi(s){return(s.files?.length??0)>0||s?.tools?.some(t=>t.type===J.JIT_PLUGIN)}const li=12;function ci({gizmoEditorData:s,updateGizmo:t,currentModelConfig:a,generateProfilePic:o,setIsUploadingProfilePic:n,isGeneratingProfilePic:r,setIsGeneratingProfilePic:i,requireGizmoId:m,onShowActionsEditor:l}){const f=s?.tools??[],[y,j]=d.useState(!1),[u,c]=d.useState(!0),v=s?.promptStarters??[],x=[...v,...v.length<li?[""]:[]],h=be(s),P=ye()?.isWorkspaceAccount(),T=Es(js.WorkspaceGPTCustomActions),A=V();return e.jsxs("div",{className:"flex h-full grow flex-col overflow-y-auto px-2 pt-6 text-sm",children:[e.jsxs("div",{className:"grow",children:[e.jsxs(Q,{children:[e.jsx(si,{gizmoEditorData:s,generateProfilePic:o,isGeneratingProfilePic:r,setIsGeneratingProfilePic:i,onFileChange:async b=>{if(b!=null&&b!=="uploading"&&b.fileId!=null){const p=await Ee.getFileDownloadLink(b.fileId);p.status===Fe.Success&&t({profilePictureId:b.fileId!=null?b.fileId:void 0,profilePictureUrl:p.download_url})}else t({profilePictureId:void 0,profilePictureUrl:void 0});n(b==="uploading")}}),e.jsx(Y,{label:e.jsx(g,{id:"M4dZms",defaultMessage:"Name"}),description:e.jsx(g,{id:"+Gkni2",defaultMessage:"The name of your GPT"})}),e.jsx(Se,{type:"text",placeholder:A.formatMessage(R.gptNamePlaceholder),value:s?.name??"",onChange:b=>{t({name:b.target.value})},onBlurCapture:()=>t(b=>({...b,name:b.name.trim()})),"data-testid":"gizmo-name-input"}),h.includes(te.GizmoNameTooLong)?e.jsx(Ie,{className:"mt-1",children:e.jsx(g,{...R.nameTooLong,values:{length:Lt}})}):null]}),e.jsxs(Q,{className:"mt-4",children:[e.jsx(Y,{label:e.jsx(g,{id:"YDzNvf",defaultMessage:"Description"}),description:e.jsx(g,{id:"dpxCw8",defaultMessage:"Short description of what this GPT does"})}),e.jsx(Se,{type:"text",placeholder:A.formatMessage(R.descriptionPlaceholder),value:s?.description??"",onChange:b=>t({description:b.target.value}),onBlurCapture:()=>t(b=>({...b,description:b.description?.trim()??""})),"data-testid":"gizmo-description-input"}),h.includes(te.GizmoDescriptionTooLong)?e.jsx(Ie,{className:"mt-1",children:e.jsx(g,{...R.descriptionTooLong,values:{length:zt}})}):null]}),e.jsxs(Q,{children:[e.jsx(Y,{label:e.jsx(g,{id:"2SO0RJ",defaultMessage:"Instructions"}),description:A.formatMessage(R.instructionsSubtitle)}),e.jsxs("div",{className:"relative",children:[e.jsx(ka,{className:"resize-none",rows:8,value:s?.instructions,onChange:b=>t({instructions:b.target.value}),onBlurCapture:()=>t(b=>({...b,instructions:b.instructions.trim()})),placeholder:A.formatMessage(R.instructionsSubtitle),"data-testid":"gizmo-instructions-input"}),e.jsx("button",{className:"absolute bottom-3 right-2 text-token-text-tertiary",onClick:()=>j(!0),children:e.jsx(ba,{className:"icon-sm"})})]}),h.includes(te.GizmoInstructionsTooLong)?e.jsx(Ie,{className:"mt-1",children:e.jsx(g,{...R.instructionsTooLong,values:{length:Rt}})}):null]}),e.jsxs(Q,{children:[e.jsx(Y,{label:e.jsx(g,{id:"6rfYOX",defaultMessage:"Conversation starters"}),description:e.jsx(g,{id:"OSOIpd",defaultMessage:"Examples for the user to start the conversation"})}),e.jsx("div",{className:"flex flex-col gap-1",children:x.map((b,p)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(Se,{className:"rounded-r-none",value:b,type:"text",onChange:S=>{const _=S.target.value;t(O=>({...O,promptStarters:$e(p>=(v.length??0)?[...v??[],_]:v.map((N,E)=>E===p?_===""?void 0:_:N))}))}}),e.jsx("button",{className:"flex h-9 w-9 items-center justify-center rounded-lg rounded-l-none border border-l-0 border-token-border-medium",onClick:()=>t(S=>({...S,promptStarters:v.filter((_,O)=>O!==p)})),children:e.jsx(Ma,{className:"icon-sm"})})]},p))})]}),e.jsxs(Q,{children:[e.jsx(Y,{label:e.jsx(g,{id:"bwXSkU",defaultMessage:"Knowledge"}),description:A.formatMessage(R.knowledgeExplanation)}),e.jsx(ti,{gizmoEditorData:s,requireGizmoId:m,currentModelConfig:a,updateGizmo:t})]}),e.jsxs(Q,{children:[e.jsx(Y,{label:e.jsx(g,{id:"mcAwDU",defaultMessage:"Capabilities"}),description:e.jsx(g,{id:"2exQT6",defaultMessage:"Functionality this GPT can use"})}),e.jsx(Sa,{enabledTools:f,onEnabledToolsChange:b=>t({tools:b})})]}),e.jsxs(Q,{children:[e.jsx(Y,{label:e.jsx(g,{id:"7r7v+u",defaultMessage:"Actions"}),description:e.jsx(g,{id:"fBln7I",defaultMessage:"APIs this GPT can use"})}),e.jsx(ri,{isDisabled:!!(P&&!T),gizmo:s,onShowActionsEditor:l})]}),!P&&oi(s)&&e.jsxs(Q,{children:[e.jsx(Y,{label:e.jsx(g,{id:"R3KeU7",defaultMessage:"Additional Settings"}),collapsed:!!u,onClick:()=>{c(b=>!b)}}),e.jsx(ni,{collapsed:u,initial:!1,children:e.jsx(Ut,{className:"mx-3 my-1",labelClassName:"w-full cursor-pointer",label:e.jsx(g,{id:"tZgwFW",defaultMessage:"Use conversation data in your GPT to improve our models"}),id:"improve-chatgpt",checked:!s.trainingDisabled,onChange:()=>{t({trainingDisabled:!s.trainingDisabled})}})})]})]}),y&&e.jsx(ii,{text:s.instructions??"",onChange:b=>{t({instructions:b})},onClose:()=>j(!1),placeholder:A.formatMessage(R.instructionsSubtitle)})]})}const R=le({nameTooLong:{id:"gizmo.nameTooLong",defaultMessage:"GPT names cannot be longer than {length} characters."},knowledgeExplanation:{id:"gizmo.knowledgeExplanation",defaultMessage:"Additional files for this GPT to reference."},descriptionTooLong:{id:"gizmo.descriptionTooLong",defaultMessage:"GPT descriptions cannot be longer than {length} characters."},instructionsTooLong:{id:"gizmo.instructionsTooLong",defaultMessage:"GPT instructions cannot be longer than {length} characters."},disabledCustomActionsTooltip:{id:"gizmo.disabledCustomActionsTooltip",defaultMessage:"Custom actions are disabled for your workspace. Contact your admin to enable them."},createActionLabel:{id:"gizmo.createActionLabel",defaultMessage:"Create new action"},maxActionsReached:{id:"gizmo.maxActionsReached",defaultMessage:"GPTs can have a maximum of {number} actions"},descriptionPlaceholder:{id:"gizmo.descriptionPlaceholder",defaultMessage:"Add a short description about what this GPT does"},instructionsSubtitle:{id:"gizmo.instructionsSubtitle",defaultMessage:"What does this GPT do? How does it behave? What should it avoid doing?"},gptNamePlaceholder:{id:"gizmo.gptNamePlaceholder",defaultMessage:"Name your GPT"},callbackUrlLabel:{id:"gizmo.callbackUrlLabel",defaultMessage:"Callback URL"}});function di(s,t){const a=bs(s);if(!Array.isArray(s.detail))return a;const o=$e(s.detail.map(n=>{if(n.type==="value_error.any_str.max_length")switch(n.loc[1]){case"display":{switch(n.loc[2]){case"name":return t.formatMessage(R.nameTooLong,{length:n.ctx.limit_value});case"description":return t.formatMessage(R.descriptionTooLong,{length:n.ctx.limit_value})}break}case"instructions":return t.formatMessage(R.instructionsTooLong,{length:n.ctx.limit_value})}if(typeof n.msg=="string")return n.msg}));return o.length>0?o.join(`
`):a}function ui({upsertDraftError:s}){const t=V(),a=di(s,t);return e.jsxs("div",{className:"flex items-center gap-2 text-red-500",children:[e.jsx("div",{children:e.jsx(g,{...Vs.errorSavingDraft})}),a!=null&&e.jsx(ys,{label:a,children:e.jsx(wa,{className:"icon-sm"})})]})}function mi({isPublished:s,isSavingDraft:t,hasUnpublishedChanges:a,upsertDraftError:o,className:n}){return o instanceof tt?e.jsx(ui,{upsertDraftError:o}):a?e.jsxs("div",{className:re("flex items-center gap-2",n),children:[e.jsx("span",{className:"text-token-text-secondary",children:s?e.jsx(g,{id:"gizmoEditor.draftUnpublished",defaultMessage:"Unpublished changes"}):e.jsx(g,{id:"gizmoEditor.draftPending",defaultMessage:"Updates pending"})}),e.jsx("div",{className:"w-4 text-token-text-tertiary",children:t&&e.jsx(Ve,{})})]}):null}const Vs=le({errorSavingDraft:{id:"gizmo.errorSavingDraft",defaultMessage:"Error saving draft"}}),gi=We(()=>He(()=>import("./ordg07m7wvo6hgn3.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])).then(s=>s.DebugConversationSidebar));var fi=(s=>(s.TestGizmoAction="test_gizmo_action",s))(fi||{});const pi=new at;function hi({gizmoEditorData:s,isSavingDraft:t,currentModelConfig:a,showTitle:o=!0}){const[n,r]=d.useState(()=>he());Ns(n,{kind:ae.GizmoTest,gizmo_id:s.id}),d.useEffect(()=>{I.updateConversationMode(n,{kind:ae.GizmoTest,gizmo_id:s.id})},[n,s.id]);const i=s.files?.map(h=>h.file_id).join();d.useEffect(()=>{I.getServerThreadId(n)!=null&&r(he())},[s.id,s.instructions,s.tools,i,n]);const m=ks(h=>h.activeSidebar),l=d.useMemo(()=>({gizmoEditorData:s,mode:"test"}),[s]),[f,y]=d.useState(0),j=()=>{y(h=>h-360)},u=s.id,c=xi(n,a);d.useEffect(()=>it(pi,{test_gizmo_action:({rootDomain:h,operationName:C})=>{u&&c(u,h,C)}}),[c,u]);const v=Ss(),x=d.useCallback(()=>e.jsx("div",{className:"h-full w-full",children:e.jsx(Ia,{gizmo:s,hideOwner:!0,showStarterPrompts:!0})}),[s]);return e.jsx(Cs.Provider,{value:l,children:e.jsxs("div",{className:re("flex h-full w-full",t&&"cursor-wait opacity-80 transition"),children:[e.jsxs("div",{className:"flex grow flex-col",children:[e.jsx("div",{className:"relative mb-2 flex-shrink-0",children:e.jsx("div",{className:"flex justify-center py-1",children:o&&e.jsxs("div",{className:"group flex items-center gap-2 text-lg font-semibold",children:[e.jsx("div",{className:"icon-md"}),e.jsxs("button",{onClick:()=>{j(),r(he())},className:"flex items-center gap-2",children:[e.jsx(g,{id:"2u/6Ja",defaultMessage:"Preview"}),e.jsx(Hs.div,{className:"text-token-text-primary",animate:{rotate:f},transition:{duration:.3},children:e.jsx(Ta,{className:"icon-md invisible group-hover:visible"})})]})]})})}),e.jsx("div",{className:re("relative grow overflow-auto px-2",t&&"pointer-events-none"),children:v?e.jsx("div",{className:"contents",style:{"--screen-height-override":"100%","--chat-screen-thread-parent-background":"var(--main-surface-secondary)"},children:e.jsx(Is,{clientThreadId:n,children:e.jsx(Os,{hideHeader:!0,embedded:!0,renderEmptyState:x})})}):e.jsx(Bs,{clientThreadId:n,hideHeader:!0,renderEmptyState:x()})})]}),m==="debug"&&e.jsx(gi,{clientThreadId:n,slideOver:!1,onClose:()=>de.toggleActiveSidebar("debug"),isOpen:!0})]})})}const ls=ds.memo(hi);function xi(s,t){const a=Ms({clientThreadId:s});return d.useCallback(async(n,r,i)=>{if(!t)return;const m=new ws,l=I.getThreadCurrentLeafId(s),f=oe(),y=Ot(r);I.updateTree(s,h=>{h.addNodeToEnd(l,{id:f,children:[],parentId:l,message:{id:f,author:{role:q.User},content:{content_type:nt.Text,parts:[`Call the ${r} API with the ${i} operation`]},recipient:"all",metadata:{jit_plugin_data:{from_client:{type:"test",operation:i,tool_name:y}}}}})});const j={conversationMode:{kind:ae.GizmoTest,gizmo_id:n}},u=await Oe(),[c,v,x]=await Promise.all([Be.getEnforcementToken(u),Ke.getEnforcementToken(u),De.getEnforcementToken(u)]);a({model:t.id,completionType:cs.Next,parentNodeId:f,metadata:{},focusOnNewCompletion:!0,chatReq:u,arkoseToken:c,turnstileToken:v,proofToken:x,preflightTime:0,completionMetadata:j,turnTracker:m})},[s,a,t])}const vi=We(()=>He(()=>import("./oo96g80qjtmk340c.js"),__vite__mapDeps([11,1,2,3,12,4,5,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29])).then(s=>s.GizmoActionsEditor));var Ks=(s=>(s.MAGIC_MAKER="magic",s.ADVANCED="advanced",s.PREVIEW="preview",s))(Ks||{});function Ne({value:s,label:t,testId:a}){return e.jsx(As,{value:s,className:"text-md w-1/3 flex-grow rounded-lg border-token-border-light p-1.5 font-semibold text-token-text-tertiary transition hover:text-token-text-primary radix-state-checked:border radix-state-checked:bg-token-main-surface-primary radix-state-checked:text-token-text-primary radix-state-checked:shadow-[0_0_2px_rgba(0,0,0,.03)] md:w-1/2","data-testid":a,children:t})}function ji({className:s,editorTab:t,setEditorTab:a}){const o=V();return e.jsxs(Gs,{className:re("flex w-full overflow-hidden rounded-xl bg-token-main-surface-secondary p-1.5 md:w-1/2",s),value:t,onValueChange:n=>{a(n)},children:[e.jsx(Ne,{value:"magic",label:o.formatMessage(_e.magicMakerLabel)}),e.jsx(Ne,{value:"advanced",label:o.formatMessage(_e.configureLabel),testId:"gizmo-editor-configure-button"}),e.jsx("div",{className:"flex w-1/3 md:hidden",children:e.jsx(Ne,{value:"preview",label:o.formatMessage(_e.previewLabel)})})]})}function yi(s,t){return s.length!==t.length?!1:s.every(a=>t.some(o=>o.type===a.type))}function bi(s,t){return s.name===t.gizmo.display.name&&s.description===t.gizmo.display.description&&s.instructions===t.gizmo.instructions&&yi(s.tools,t.tools)&&Ue(s.files?.map(a=>a.file_id)??[],t.files?.map(a=>a.file_id)??[])&&s.profilePictureUrl==t.gizmo.display.profile_picture_url&&s.profilePictureId==t.gizmo.display.profile_pic_id}const Qs=({gizmo:s,onNewGizmoId:t})=>{const a=us(),o=Es(js.BrowsingAvailable),n=V(),r=ie(),i=d.useRef(s!=null?is(s):o?ra:oa),m=d.useRef(s),l=d.useRef(i.current),[f,y]=d.useState(()=>i.current),[j,u]=d.useState(()=>he()),[c]=d.useState(()=>({context_message:La(i.current),model_slug:"unused",enabled_tools:[{tool_id:s!=null?"gizmo_editor":"gizmo_creator"}]}));Ba(j,l.current,c);const{data:v}=qt(),x=v?.modelsList.find(w=>w.tags.includes(rt.GPT_4))??v?.modelsList.find(w=>w.id===Vt),{data:h}=Kt(i.current.id),C=Qt(),{isPending:P,error:T}=C,A=Yt(),b=d.useMemo(()=>h!=null&&!bi(f,h),[f,h]),p=async()=>{const w=i.current;try{const k=await C.mutateAsync({editorData:w,gizmoId:w.id});if(m.current=k,i.current.id==null){const z=k.gizmo.id;i.current={...i.current,id:z,sharingTargets:k.gizmo.sharing_targets},y(i.current),t?.(z)}for(const z of k.tools.filter($=>$.type===J.JIT_PLUGIN)){const $=i.current.tools.find(X=>X.type===J.JIT_PLUGIN&&X.metadata.domain===z.metadata.domain);$&&$.metadata.action_id!==z.metadata.action_id&&($.metadata={...$.metadata,action_id:z.metadata.action_id},y(i.current))}return k}catch(k){const z=bs(k)??n.formatMessage(Vs.errorSavingDraft);throw r.warning(z,{duration:2}),k}},S=d.useRef(void 0),_=async()=>i.current.id!=null?i.current.id:(S.current==null&&(S.current=p().then(w=>w.gizmo.id).catch(w=>{throw S.current=void 0,w})),S.current),[O]=d.useState(()=>Zt(()=>p(),2e3,{trailing:!0}));function N(w,k=!0){const z=typeof w=="function"?w(i.current):da(i.current,w);Ue(z,i.current)||(i.current=z,y(i.current),k&&O())}const E=d.useRef(void 0),H=async w=>{if(w==null){ge(!1);return}try{const k=await Aa(i.current,w,r,E.current);k!=null&&(N(k),l.current=Ps(i.current))}catch(k){Ge.addError(k),r.warning("Something went wrong generating your GPT",{duration:3})}finally{E.current=I.getThreadCurrentLeafId(w),ge(!1)}},B=Ua(j,H,c),[U,F]=d.useState(void 0);d.useEffect(()=>{F(la(s))},[s?.gizmo.id]);const me=async(w,k)=>{const z=be(i.current,w.recipient,k);if(z.length>0){r.warning(`Could not save GPT:

${z.map(ee=>`- ${ze(ee)}`).join(`
`)}`,{duration:3});return}const $=await p(),X=$.gizmo.id;try{return xs.logEvent(vs.promoteGizmo,{gizmo_id:$.gizmo.id,sharing_recipient:w.recipient,editor_tab:D}),await A.mutateAsync({gizmoId:$.gizmo.id,data:{sharingSubjects:w.subjects,sharingRecipient:w.recipient,categories:k==null?void 0:[k]}},{onSuccess(Te){a.setQueryData(ns(a,X).queryKey,Te),a.invalidateQueries({queryKey:["gizmos"]}),a.invalidateQueries({queryKey:["gizmo",{gizmoId:X}]}),a.invalidateQueries({queryKey:["gizmo","userActionSettings",{gizmoId:X}]})}})}catch(ee){if(ee instanceof Jt)F({gizmoId:X,sharingRecipient:w.recipient,moderationType:Fs.PublishBlocked,sharingTargets:ee.response?.sharing_targets,showModal:ce.AppealAvailable});else{Ge.addError(ee);const Te=ee.detail??"An unknown error occurred";r.warning("Error saving GPT - "+Te,{duration:6})}}},Me=C.isPending||A.isPending,[D,M]=d.useState(()=>{const w=Xe.getItem(es.GizmoEditorTab);return Object.values(Ks).includes(w)?w:"magic"}),L=ot.useState(({windowWidth:w})=>w);d.useEffect(()=>{L!=null&&L>=768&&D==="preview"&&M("magic")},[L,D]);const[Ys,Zs]=d.useState(!1),[Ze,ge]=d.useState(!1),[Je,we]=d.useState(void 0);return e.jsxs("div",{className:"flex h-screen w-full flex-col items-center",children:[e.jsx(Ja,{gizmoEditorData:f,isLoading:Me,hasUnpublishedChanges:b,isUploadingProfilePic:Ys,isGeneratingProfilePic:Ze,publishedGizmo:h,updateGizmo:N,promoteGizmo:async(w,k)=>{const z=await me(w,k);return i.current={...i.current,sharingRecipient:w.recipient},y(i.current),Xe.setItem(es.GizmoEditorTab,D),z},appealGizmo:async(w,k)=>{U!=null&&F({...U,sharingRecipient:w,categories:k==null?void 0:[k],showModal:ce.AppealAvailable})},setAppealState:F,revertDraft:h!=null&&b?()=>{const w=a.getQueryData(ns(a,i.current.id).queryKey);if(w!=null){const k=is(w);i.current=k,y(k),p()}}:void 0,draftMessage:e.jsx(mi,{isPublished:h!=null&&(h.gizmo.share_recipient==="marketplace"||h.gizmo.share_recipient==="workspace"),hasUnpublishedChanges:b,isSavingDraft:P,upsertDraftError:T,className:"text-sm"}),showActionsModal:w=>{we(w)},className:"flex-shrink-0"}),U&&e.jsx(ca,{appealState:U,onAppealClose:()=>F({...U,showModal:ce.None}),onAppealSubmitted:()=>F({...U,showModal:ce.AppealSent})}),e.jsxs("div",{className:"relative flex w-full grow overflow-hidden",children:[e.jsx("div",{className:"flex w-full justify-center md:w-1/2",children:e.jsx("div",{className:"h-full grow overflow-hidden",children:Je!==void 0?e.jsx(vi,{currentlyEditingActionDomain:Je,gizmoEditorData:f,updateGizmo:N,onClose:()=>{we(void 0)}}):e.jsxs("div",{className:"flex h-full flex-col px-2 pt-2",children:[e.jsx("div",{className:"flex w-full flex-row justify-center",children:e.jsx(ji,{editorTab:D,setEditorTab:M,className:"mb-2 flex-shrink-0 self-center"})}),e.jsx("div",{className:"grow overflow-hidden",children:D==="magic"?e.jsx("div",{className:"h-full w-full pb-5",children:e.jsx(Wa,{gizmoEditorData:f,updateGizmo:N,completionCallbackResponse:H,clientThreadId:j,gizmoEditorDataRef:i,magicMakerBehaviorOverrides:c,magicMakerConversationGizmoEditorDataRef:l,requireGizmoId:_},j)}):D==="advanced"?e.jsx(ci,{gizmoEditorData:f,updateGizmo:N,currentModelConfig:x,generateProfilePic:()=>{ge(!0),B(i,l,[Ea])},setIsUploadingProfilePic:Zs,isGeneratingProfilePic:Ze,setIsGeneratingProfilePic:ge,requireGizmoId:_,onShowActionsEditor:w=>{we(w)}}):e.jsx(ls,{gizmoEditorData:f,currentModelConfig:x,isSavingDraft:P,showTitle:!1})})]})})}),e.jsx("div",{className:re("hidden w-1/2 justify-center border-l border-token-border-medium bg-token-main-surface-secondary pt-4",D!=="preview"&&"md:flex"),children:e.jsx("div",{className:"flex-grow pb-5",children:e.jsx("div",{className:"h-full",children:e.jsx(ls,{gizmoEditorData:f,currentModelConfig:x,isSavingDraft:P})})})})]})]})};function Mi({gizmoId:s,version:t}){const{data:a}=Wt({gizmoId:s,draft:!0,version:t}),o=je(_s.accountUserId),r=Ht()?.id,i=a!=null&&o!=null&&r!=null&&$t(a);return a==null||!i?null:e.jsx(Qs,{gizmo:a})}function wi({onNewGizmoId:s}){return e.jsx(Qs,{onNewGizmoId:s})}const Ti=({gizmoId:s,remixSourceId:t,version:a})=>{const o=ue(),n=ye(),r=d.useRef(void 0);d.useEffect(()=>(de.enterGizmoEditor(),()=>{de.exitGizmoEditor()}),[]);let i=s;return s!=null&&r.current===s&&(i=void 0),Bt({resetThreadAction:()=>{o("/")}}),n?.data?i!==void 0?e.jsx(Mi,{gizmoId:i,version:a},i):e.jsx(wi,{remixSourceId:t,onNewGizmoId:m=>{r.current=m,window.history.replaceState(window.history.state,"",Dt(m))}}):e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx(Ve,{})})},_e=le({magicMakerLabel:{id:"gizmo.magicMakerLabel",defaultMessage:"Create"},configureLabel:{id:"gizmo.advancedLabel",defaultMessage:"Configure"},previewLabel:{id:"gizmo.previewLabel",defaultMessage:"Preview"}});function Pi(s){const t=ue();d.useEffect(()=>{s||t(lt(ct.NO_ACCESS))},[s,t])}const Ri=()=>(gt(),null);function Ui(){const s=ye();Pi(s==null||s.canCreateGizmos());const t=dt(),[a]=ut(),o=ue(),n=t.slug,r=a.get("version"),i=n?mt(n):void 0,m=a.get("remixFrom");return d.useEffect(()=>{Oe(!0).then(l=>{Be.initializeAndGatherData(l),Ke.initializeAndGatherData(l),De.initializeAndGatherData(l)})},[]),d.useEffect(()=>{s!=null&&!s.canCreateGizmos()&&o("/")},[s,o]),s?.canCreateGizmos()?e.jsx(Xt,{children:e.jsx(Ti,{gizmoId:i,remixSourceId:m??void 0,version:r!=null?Number(r):void 0})}):null}export{pi as G,fi as a,Ui as b,Ri as c};
//# sourceMappingURL=rwj7a05mk3stn07d.js.map
