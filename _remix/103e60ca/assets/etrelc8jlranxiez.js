const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/g2ochhmb58t35xc8.js","assets/d32njcecuuhbp463.js","assets/dbff4h8ph6arfd9c.js","assets/6buwat3xriqhrw7w.js","assets/mog4ji1enf6w9x04.js","assets/j4s44eoworcfgpbk.js","assets/root-i2ogspqj.css","assets/bp5aai1dwvlpcqfm.js","assets/conversation-small-ile61fj8.css","assets/w3fqzwb6ljesm4i1.js","assets/m97p5g2xpdw6lt0c.js","assets/eyarljydwvt66nvz.js","assets/j0vvyczr74ntoehh.js","assets/lr1tsar0f6t77ni3.js","assets/iktb1jlodukuphl0.js","assets/jkvr2pfjfhg0hmro.js","assets/gzd5um36zhgxliv8.js","assets/fzrn137102spawew.js","assets/gc574ukyr4imd478.js","assets/et9boeu144ybfcf9.js","assets/l97y9wh13nou872p.js","assets/klril6gglm8lkz37.js","assets/clgic8b9fes7zr8l.js","assets/n04brbci9145oc4b.js","assets/b7z6e96rc9pylano.js","assets/cd3ieiagewrqfblk.js","assets/czgn07hd3gx7expc.js","assets/bd3aj44l6zxa1qhv.js","assets/linu5fcaseui5pu2.js","assets/d6kim6zo6m40sklc.js","assets/ox7om9rldkn6lk37.js","assets/dy8wp79vjcq1s3dc.js","assets/fihi2un97tl0de6h.js","assets/hsfxvgjkmuoz6h3u.js","assets/i6hrxg2qbvhkee6a.js"])))=>i.map(i=>d[i]);
import{aI as _,i as St,g as Mt,hB as Ot,hs as Lt,m as u,aD as O,n as $,r as v,G as pe,gX as At,l as W,b as Fe,aY as wt,dJ as ze,bJ as se,gv as It,bM as Ue,bN as Rt,bP as Dt,bQ as Xe,bA as jt,aL as Ke}from"./mog4ji1enf6w9x04.js";import{h as x,E as te,Z as D,i as $e,j as We,H as Bt,G as R,k as Vt,T as _e,C as ye}from"./m97p5g2xpdw6lt0c.js";import{c as Ht,S as Gt,H as Yt,x as Ft,t as c}from"./dbff4h8ph6arfd9c.js";import{_ as Je}from"./fzrn137102spawew.js";import{E as zt,a5 as q,a6 as V,a7 as A,a8 as ae,a9 as Ut,aa as ie,ab as Ne,ac as Xt,ad as Kt,ae as $t,af as Wt,a2 as j,ag as qe,ah as Ze}from"./6buwat3xriqhrw7w.js";import{ay as Y,fo as I,aO as Qe,j$ as Jt,kF as qt,hI as Zt,ch as et,il as F,kG as me,kH as Qt,kI as eo,kJ as be,js as to,ky as oo,kz as no,ju as ro,i as so,fp as ao}from"./bp5aai1dwvlpcqfm.js";import{m as w}from"./w3fqzwb6ljesm4i1.js";import{bU as io,bV as co,ac as lo,b as uo,bW as mo}from"./j4s44eoworcfgpbk.js";import{b as fo}from"./ohra68b8pselj8ds.js";import{T as po,P as tt,f as ho,c as go,e as Eo,g as vo,D as Te,d as ot}from"./jkvr2pfjfhg0hmro.js";import{u as ce}from"./lr1tsar0f6t77ni3.js";import{c as nt,R as Co,I as xo}from"./lcom2tf7ysgy5nbe.js";import{u as _o}from"./klril6gglm8lkz37.js";import{i as yo}from"./gzd5um36zhgxliv8.js";const No="_modelCursor_1mtn0_1",br={modelCursor:No},bo=(...e)=>o=>{e.forEach(t=>{if(typeof t=="function")t(o);else if(t){const n=t;n.current=o}})};function M(e){return new Ht(Gt.define(e))}const Pe=()=>_(()=>import("./pbl95wx6493wq92j.js"),[]).then(e=>M(e.shell)),rt={[x.bash]:Pe,[x.zsh]:Pe,[x.swift]:()=>_(()=>import("./pijqfo56g5y7ss6b.js"),[]).then(e=>M(e.swift)),[x.css]:()=>_(()=>import("./g2ochhmb58t35xc8.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.css()),[x.html]:()=>_(()=>import("./clgic8b9fes7zr8l.js"),__vite__mapDeps([22,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,0,23])).then(e=>e.html()),[x.javascript]:()=>_(()=>import("./n04brbci9145oc4b.js"),__vite__mapDeps([23,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.javascript({jsx:!0,typescript:!1})),[x.typescript]:()=>_(()=>import("./n04brbci9145oc4b.js"),__vite__mapDeps([23,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.javascript({jsx:!0,typescript:!0})),[x.json]:()=>_(()=>import("./b7z6e96rc9pylano.js"),__vite__mapDeps([24,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.json()),[x.python]:()=>_(()=>import("./cd3ieiagewrqfblk.js"),__vite__mapDeps([25,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.python()),[x.sql]:()=>_(()=>import("./czgn07hd3gx7expc.js"),__vite__mapDeps([26,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,1])).then(e=>e.sql()),[x.go]:()=>_(()=>import("./bd3aj44l6zxa1qhv.js"),__vite__mapDeps([27,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.go()),[x.yaml]:()=>_(()=>import("./linu5fcaseui5pu2.js"),__vite__mapDeps([28,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.yaml()),[x.java]:()=>_(()=>import("./d6kim6zo6m40sklc.js"),__vite__mapDeps([29,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.java()),[x.rust]:()=>_(()=>import("./ox7om9rldkn6lk37.js"),__vite__mapDeps([30,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.rust()),[x.cpp]:()=>_(()=>import("./dy8wp79vjcq1s3dc.js"),__vite__mapDeps([31,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.cpp()),[x.php]:()=>_(()=>import("./fihi2un97tl0de6h.js"),__vite__mapDeps([32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,0,23])).then(e=>e.php()),[x.xml]:()=>_(()=>import("./hsfxvgjkmuoz6h3u.js"),__vite__mapDeps([33,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.xml()),[x.vue]:()=>_(()=>import("./i6hrxg2qbvhkee6a.js"),__vite__mapDeps([34,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,1,0,23])).then(e=>e.vue()),[x.ruby]:()=>_(()=>import("./e4lhyu305wu0fcut.js"),[]).then(e=>M(e.ruby)),[x.haskell]:()=>_(()=>import("./bf6r3t2rw7f01so5.js"),[]).then(e=>M(e.haskell)),[x.kotlin]:()=>_(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>M(e.kotlin)),[x.csharp]:()=>_(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>M(e.csharp)),[x.c]:()=>_(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>M(e.c)),[x.objectivec]:()=>_(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>M(e.objectiveC)),[x.r]:()=>_(()=>import("./n0t2rpizlasjzcxa.js"),[]).then(e=>M(e.r)),[x.lua]:()=>_(()=>import("./harowmpdmpnd9wki.js"),[]).then(e=>M(e.lua)),[x.dart]:()=>_(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>M(e.dart)),[x.scala]:()=>_(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>M(e.scala)),[x.perl]:()=>_(()=>import("./gq1ss5v2zpbborxl.js"),[]).then(e=>M(e.perl)),[x.commonlisp]:()=>_(()=>import("./jr6cjysmysifr6mr.js"),[]).then(e=>M(e.commonLisp)),[x.clojure]:()=>_(()=>import("./gf1tfl9d2himhfic.js"),[]).then(e=>M(e.clojure)),[x.ocaml]:()=>_(()=>import("./khji33iw1sxityyt.js"),[]).then(e=>M(e.oCaml)),[x.powershell]:()=>_(()=>import("./i9u5kd7kvamutmln.js"),[]).then(e=>M(e.powerShell)),[x.verilog]:()=>_(()=>import("./fix340p09fldyqxz.js"),[]).then(e=>M(e.verilog)),[x.dockerfile]:()=>_(()=>import("./cgm5tyzi32u32j10.js"),[]).then(e=>M(e.dockerFile)),[x.other]:()=>null},To=e=>e in rt,oe={},Tr=async e=>{if(oe[e]!=null)return oe[e];if(To(e)){const o=await rt[e]();return oe[e]=o,o}return null},Pr=e=>oe[e]??null;var st=e=>{var{theme:o,settings:t={},styles:n=[]}=e,r={".cm-gutters":{}},s={};t.background&&(s.backgroundColor=t.background),t.backgroundImage&&(s.backgroundImage=t.backgroundImage),t.foreground&&(s.color=t.foreground),t.fontSize&&(s.fontSize=t.fontSize),(t.background||t.foreground)&&(r["&"]=s),t.fontFamily&&(r["&.cm-editor .cm-scroller"]={fontFamily:t.fontFamily}),t.gutterBackground&&(r[".cm-gutters"].backgroundColor=t.gutterBackground),t.gutterForeground&&(r[".cm-gutters"].color=t.gutterForeground),t.gutterBorder&&(r[".cm-gutters"].borderRightColor=t.gutterBorder),t.caret&&(r[".cm-content"]={caretColor:t.caret},r[".cm-cursor, .cm-dropCursor"]={borderLeftColor:t.caret});var a={};t.gutterActiveForeground&&(a.color=t.gutterActiveForeground),t.lineHighlight&&(r[".cm-activeLine"]={backgroundColor:t.lineHighlight},a.backgroundColor=t.lineHighlight),r[".cm-activeLineGutter"]=a,t.selection&&(r["&.cm-focused .cm-selectionBackground, & .cm-line::selection, & .cm-selectionLayer .cm-selectionBackground, .cm-content ::selection"]={background:t.selection+" !important"}),t.selectionMatch&&(r["& .cm-selectionMatch"]={backgroundColor:t.selectionMatch});var i=zt.theme(r,{dark:o==="dark"}),l=Yt.define(n),m=[i,Ft(l)];return m},Po={background:"#ffffff",foreground:"#383a42",caret:"#000",selection:"#add6ff",selectionMatch:"#a8ac94",lineHighlight:"#f0f0f0",gutterBackground:"#fff",gutterForeground:"#237893",gutterActiveForeground:"#0b216f",fontFamily:'Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace'},ko=[{tag:[c.keyword,c.operatorKeyword,c.modifier,c.color,c.constant(c.name),c.standard(c.name),c.standard(c.tagName),c.special(c.brace),c.atom,c.bool,c.special(c.variableName)],color:"#0000ff"},{tag:[c.moduleKeyword,c.controlKeyword],color:"#af00db"},{tag:[c.name,c.deleted,c.character,c.macroName,c.propertyName,c.variableName,c.labelName,c.definition(c.name)],color:"#0070c1"},{tag:c.heading,fontWeight:"bold",color:"#0070c1"},{tag:[c.typeName,c.className,c.tagName,c.number,c.changed,c.annotation,c.self,c.namespace],color:"#267f99"},{tag:[c.function(c.variableName),c.function(c.propertyName)],color:"#795e26"},{tag:[c.number],color:"#098658"},{tag:[c.operator,c.punctuation,c.separator,c.url,c.escape,c.regexp],color:"#383a42"},{tag:[c.regexp],color:"#af00db"},{tag:[c.special(c.string),c.processingInstruction,c.string,c.inserted],color:"#a31515"},{tag:[c.angleBracket],color:"#383a42"},{tag:c.strong,fontWeight:"bold"},{tag:c.emphasis,fontStyle:"italic"},{tag:c.strikethrough,textDecoration:"line-through"},{tag:[c.meta,c.comment],color:"#008000"},{tag:c.link,color:"#4078f2",textDecoration:"underline"},{tag:c.invalid,color:"#e45649"}];function So(e){var{theme:o="dark",settings:t={},styles:n=[]}=e||{};return st({theme:o,settings:Je({},Po,t),styles:[...ko,...n]})}var kr=So(),Mo={background:"#1e1e1e",foreground:"#9cdcfe",caret:"#c6c6c6",selection:"#6199ff2f",selectionMatch:"#72a1ff59",lineHighlight:"#ffffff0f",gutterBackground:"#1e1e1e",gutterForeground:"#838383",gutterActiveForeground:"#fff",fontFamily:'Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace'},Oo=[{tag:[c.keyword,c.operatorKeyword,c.modifier,c.color,c.constant(c.name),c.standard(c.name),c.standard(c.tagName),c.special(c.brace),c.atom,c.bool,c.special(c.variableName)],color:"#569cd6"},{tag:[c.controlKeyword,c.moduleKeyword],color:"#c586c0"},{tag:[c.name,c.deleted,c.character,c.macroName,c.propertyName,c.variableName,c.labelName,c.definition(c.name)],color:"#9cdcfe"},{tag:c.heading,fontWeight:"bold",color:"#9cdcfe"},{tag:[c.typeName,c.className,c.tagName,c.number,c.changed,c.annotation,c.self,c.namespace],color:"#4ec9b0"},{tag:[c.function(c.variableName),c.function(c.propertyName)],color:"#dcdcaa"},{tag:[c.number],color:"#b5cea8"},{tag:[c.operator,c.punctuation,c.separator,c.url,c.escape,c.regexp],color:"#d4d4d4"},{tag:[c.regexp],color:"#d16969"},{tag:[c.special(c.string),c.processingInstruction,c.string,c.inserted],color:"#ce9178"},{tag:[c.angleBracket],color:"#808080"},{tag:c.strong,fontWeight:"bold"},{tag:c.emphasis,fontStyle:"italic"},{tag:c.strikethrough,textDecoration:"line-through"},{tag:[c.meta,c.comment],color:"#6a9955"},{tag:c.link,color:"#6a9955",textDecoration:"underline"},{tag:c.invalid,color:"#ff0000"}];function Lo(e){var{theme:o="dark",settings:t={},styles:n=[]}=e||{};return st({theme:o,settings:Je({},Mo,t),styles:[...Oo,...n]})}var Sr=Lo(),Ao=St;function wo(e){return typeof e=="function"?e:Ao}var Io=wo,Ro=Ot,Do=Io,jo=Lt,Bo=9007199254740991,ue=4294967295,Vo=Math.min;function Ho(e,o){if(e=jo(e),e<1||e>Bo)return[];var t=ue,n=Vo(e,ue);o=Do(o),e-=ue;for(var r=Ro(n,o);++t<e;)o(t);return r}var Go=Ho;const Yo=Mt(Go),Fo=e=>u.jsx(w.div,{className:"dark:bg-white-400 aspect-square rounded-full bg-gray-400",animate:{translateY:["0%","-50%","0%","0%","0%"]},style:{translateX:.5,width:3,height:3},transition:{repeat:1/0,type:"keyframes",delay:e/10,duration:.7}},e),zo=()=>u.jsx(w.div,{className:"grid h-full max-w-full flex-1 grid-cols-3 items-center gap-[0.4] p-1",children:Yo(3,e=>Fo(e))});function Uo(e){switch(e){case"dark_gray":return{normal:"text-token-text-secondary dark:text-white-400",hover:"cursor-pointer hover:text-token-text-primary group-hover:text-token-text-primary"};case"light_gray":return{normal:"text-gray-400",hover:"cursor-pointer hover:text-token-text-secondary group-hover:text-token-text-secondary"}}}function he({children:e,className:o,onClick:t,isClickable:n=!1,theme:r="dark_gray"}){const s=Uo(r),a=(t!=null||n)&&s.hover;return u.jsxs("div",{className:O("relative inline-block h-[20px] w-[20px] shrink-0 transition-opacity",o,a,s.normal),onClick:t,children:[e?u.jsx(io,{className:"h-[20px] w-[20px] shrink-0"}):u.jsx(co,{className:"h-[20px] w-[20px] shrink-0"}),u.jsx("span",{className:O("absolute inset-0 flex items-center justify-center text-[8px] font-black",a,s.normal),children:e})]})}function le(){return u.jsx(he,{theme:"light_gray",children:u.jsx(zo,{})})}function Xo({count:e,isLoading:o,onClick:t}){return o?u.jsx(le,{}):u.jsx(he,{onClick:t,theme:"dark_gray",children:e})}function Ko({isLoading:e=!1,onClick:o}){return e?u.jsx(le,{}):u.jsx(he,{isClickable:!0,onClick:o,theme:"light_gray"})}var B=(e=>(e[e.up=-1]="up",e[e.down=1]="down",e))(B||{}),ne=(e=>(e.COMMENT="comment",e.COMPOSER="composer",e))(ne||{}),L=(e=>(e.COLLAPSED="collapsed",e.EXPANDED="expanded",e))(L||{});const at=([e,o],[t,n])=>{const r=e+o,s=t+n;return e<s&&t<r},fe=([e,o])=>e+o,U=e=>{if(e.type===L.COLLAPSED)return[e.offsetY??0,0];const{offsetY:o,shiftY:t=0,height:n=0}=e,r=o+t;return t<0?[r,n+Math.abs(t)]:[r,n]},$o=(e,o,t)=>{if(!at(e,o))return null;const[n,r]=e,s=n+r,[a,i]=o,l=a+i,m=a-s,f=l-n;return t===B.up?m:f};var it=(e=>(e.ABOVE="above",e.BELOW="below",e))(it||{});function K(e,o){return $(e.coordsAtPos(o))}const ke=360,Wo=250,ct=44,Se=.5,Me=[.5,.9,1],Jo=[1,.75,.2],qo=({onClose:e,onSubmit:o,opensOverDocument:t=!1,opensFromGutter:n=!1,gutterHasComments:r=!1},s)=>{const a=pe(),i=v.useRef(null),l=v.useRef(!1),[m,f]=v.useState(""),[p,d]=v.useState(!0),h=()=>{f(""),e?.(l.current)},g=(P=m)=>{l.current=!0,o?.(P),f("")},C=At(({windowWidth:P})=>t?P<ke+100?Wo:ke:te,0),E={};n&&(E.top=-12),t&&n?E.right=0:E.left=0;let y="";n&&!t?y="8px 50%":n&&t?y="calc(100% + 8px) 50%":t&&(y="center left");let T=0;n&&!t&&r&&(T=We);const S=P=>{const{metaKey:b,shiftKey:k,key:Q}=P;Q==="Enter"&&m&&!(k||b)?(g(),P.preventDefault()):Q==="Escape"&&(f(""),e?.(!1))},N=a.formatMessage({id:"VvfbvY",defaultMessage:"Edit or explain..."});return u.jsx(w.div,{ref:bo(i,s),className:O("absolute flex items-center",D.commentComposer),style:{...E,minHeight:ct},transition:{type:"spring",bounce:.18,duration:.48},initial:{translateX:0},animate:{translateX:T},exit:{translateX:0},children:u.jsx(w.div,{className:O("no-scrollbar relative z-10 flex items-center overflow-x-hidden border border-token-border-light",$e,{"rounded-full":p,"rounded-2xl":!p}),initial:{width:t?te:24,scaleX:t?Se:void 0,scale:t?void 0:Se},animate:{width:C,scaleX:t?Me:void 0,scale:t?void 0:Me},exit:{filter:"blur(16px)",scale:t?void 0:Jo,width:t?te:24,opacity:t?0:[1,1,0]},transition:{type:"spring",bounce:t?.14:0,duration:.28,scale:{type:"tween",duration:.2},opacity:{type:"tween",time:[0,.95,1]}},style:{transformOrigin:y},children:u.jsxs(w.div,{className:"relative z-0 flex w-full items-center bg-token-main-surface-primary px-4 py-2.5",children:[u.jsx(w.div,{className:"backdrop-saturate-25 absolute inset-0 z-[-1] bg-gray-50/75 backdrop-blur-3xl dark:bg-gray-700/75",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.2}}),u.jsx(yo,{"aria-placeholder":N,value:m,className:"w-full resize-none border-0 bg-transparent px-1 py-0 pr-2 text-token-text-primary outline-0 placeholder:text-token-text-secondary focus:ring-0 focus-visible:ring-0",autoFocus:!0,maxRows:4,onBlur:h,onHeightChange:(P,{rowHeight:b})=>{d(Math.floor(P/b)<=1)},onChange:({target:{value:P}})=>f(P),onKeyDown:S}),!m&&u.jsx("span",{"aria-hidden":!0,className:"absolute inline-block text-nowrap pl-1 text-token-text-secondary",children:N}),u.jsx(w.button,{className:O("-mr-1.5 h-6 w-6 rounded-full bg-black text-center dark:bg-white",{"self-end":!p}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:()=>g(),children:u.jsx(lo,{className:"h-6 w-6 text-white dark:text-black"})})]})})})},lt=v.forwardRef(qo),Zo=(e,o)=>{if(o?.type!==V.SELECTION)return null;try{const{from:t,to:n}=o,{top:r}=e.dom.getBoundingClientRect(),{bottom:s,top:a}=K(e,t),{bottom:i}=K(e,n),l=ae(e)?-30:-24;let m=s-r+l;const f=a-r;return m=i-r+8,{composerTop:m,loadingTop:f}}catch(t){return I.logError("Invalid position in SelectionCommentComposer",t),null}},Qo=({toolbarPosition:e,composerRect:o,view:t})=>{let{width:n,height:r}=o;if(r||=ct,t==null||e==null)return null;const{right:s,left:a}=t.dom.getBoundingClientRect(),{left:i,top:l,aboveOrBelow:m,toolbarSize:f}=e,p=l-(m===it.ABOVE&&r!==0?r-f.height:0),d=Ut(t)?12:0;return{left:Math.min(i,s-a-n-d),composerTop:p,aboveOrBelow:m}},en=({toolbarPosition:e,commentingOn:o,isWaitingForCommentResponse:t=!1,onAddComment:n})=>{const r=q()(),[s,a]=ce(),i=Qo({view:r,toolbarPosition:e,composerRect:s});if(r==null||i==null)return null;const{left:l,composerTop:m}=i,f=p=>{if(o?.type!==V.SELECTION)return;const{action:d,sourceRange:h}=o;n?.(p,d,h,o.type)};return u.jsx(Y,{children:o?.type===V.SELECTION&&!t&&u.jsx("div",{className:O("absolute",D.commentComposer),style:{left:l,top:m},children:u.jsx(lt,{opensOverDocument:!0,onClose:p=>{p||(A.cancelCommentingOn(),r&&ae(r)&&!r.state.selection.empty&&r.dispatch(r.state.tr.setSelection(new po(r.state.selection.$from))),document.getSelection()?.removeAllRanges())},onSubmit:f,ref:a})},"composer")})};function ut(e,o){return o?e.getState(o)??null:null}function tn(e){return e.nodeSize-2}function on(e,o){return o>=0&&o<=tn(e)}class H{constructor(o,t,n={}){this.match=o,this.match=o,this.handler=typeof t=="string"?nn(t):t,this.undoable=n.undoable!==!1,this.inCode=n.inCode||!1}}function nn(e){return function(o,t,n,r){let s=e;if(t[1]){let a=t[0].lastIndexOf(t[1]);s+=t[0].slice(a+t[1].length),n+=a;let i=n-r;i>0&&(s=t[0].slice(a-i,a)+s,n=r)}return o.tr.insertText(s,n,r)}}const rn=500;function Mr({rules:e}){let o=new tt({state:{init(){return null},apply(t,n){let r=t.getMeta(this);return r||(t.selectionSet||t.docChanged?null:n)}},props:{handleTextInput(t,n,r,s){return Oe(t,n,r,s,e,o)},handleDOMEvents:{compositionend:t=>{setTimeout(()=>{let{$cursor:n}=t.state.selection;n&&Oe(t,n.pos,n.pos,"",e,o)})}}},isInputRules:!0});return o}function Oe(e,o,t,n,r,s){if(e.composing)return!1;let a=e.state,i=a.doc.resolve(o),l=i.parent.textBetween(Math.max(0,i.parentOffset-rn),i.parentOffset,null,"￼")+n;for(let m=0;m<r.length;m++){let f=r[m];if(i.parent.type.spec.code){if(!f.inCode)continue}else if(f.inCode==="only")continue;let p=f.match.exec(l),d=p&&f.handler(a,p,o-(p[0].length-n.length),t);if(d)return f.undoable&&d.setMeta(s,{transform:d,from:o,to:t,text:n}),e.dispatch(d),!0}return!1}new H(/--$/,"—");new H(/\.\.\.$/,"…");new H(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"“");new H(/"$/,"”");new H(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"‘");new H(/'$/,"’");function Or(e,o,t=null,n){return new H(e,(r,s,a,i)=>{let l=t instanceof Function?t(s):t,m=r.tr.delete(a,i),f=m.doc.resolve(a),p=f.blockRange(),d=p&&ho(p,o,l);if(!d)return null;m.wrap(p,d);let h=m.doc.resolve(a-1).nodeBefore;return h&&h.type==o&&go(m.doc,a-1)&&(!n||n(s,h))&&m.join(a-1),m})}function sn(e,o,t=null){return new H(e,(n,r,s,a)=>{let i=n.doc.resolve(s),l=t instanceof Function?t(r):t;return i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),o)?n.tr.delete(s,a).setBlockType(s,s,o,l):null})}function ge(e,o,t,n={}){if(e==null)return null;const r=(Array.isArray(t)?t:[t]).filter(Qe),s=o.nodes[e].createAndFill(n,r);return s??null}const an={content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM(){return["p",0]}},cn="paragraph";class dt extends ie{unistNodeName(){return cn}static proseMirrorNodeName(){return"paragraph"}proseMirrorNodeSpec(){return an}unistNodeToProseMirrorNodes({schema:o,convertedChildren:t,attrs:n}){return ge(this.proseMirrorNodeName(),o,t,n)}proseMirrorNodeToUnistNodes(o,t){return[{type:this.unistNodeName(),children:t}]}}const ln=(e,o,t,n)=>e.value?o.text(e.value,[o.marks.startend.create(t),...n??[]]):null;class J extends ie{unistNodeName(){return"text"}static proseMirrorNodeName(){return"text"}proseMirrorNodeSpec(){return{group:"inline"}}unistNodeToProseMirrorNodes({node:o,schema:t,attrs:n}){return ln(o,t,n)}proseMirrorNodeToUnistNodes(o){return[{type:this.unistNodeName(),value:o.text??""}]}}class z extends ie{static isAtStart(o,t){return o.selection.empty?t!==void 0?t.endOfTextblock("backward",o):o.selection.$anchor.parentOffset>0:!1}static headingLevelCommandBuilder(o,t,n){return(r,s,a)=>{if(n&&!z.isAtStart(r,a))return!1;const{$anchor:i}=r.selection,l=i.parent;if(l.type.name!=="heading")return!1;const m=l.attrs.level+t;if(m<0||m>6)return!1;if(s===void 0)return!0;const f=i.before(i.depth);return m>0?s(r.tr.setNodeMarkup(f,void 0,{level:m})):s(r.tr.setNodeMarkup(f,o.nodes.paragraph)),!0}}dependencies(){return[new dt,new J]}unistNodeName(){return"heading"}static proseMirrorNodeName(){return"heading"}proseMirrorNodeSpec(){return{attrs:{level:{default:1}},content:"text*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM(o){return["h"+o.attrs.level.toString(),0]}}}proseMirrorInputRules(o){return[sn(/^\s{0,3}(#{1,6})\s$/,o.nodes[this.proseMirrorNodeName()],t=>({level:t[1].length}))]}proseMirrorKeymap(o){const t={Tab:z.headingLevelCommandBuilder(o,1,!1),"#":z.headingLevelCommandBuilder(o,1,!0),"Shift-Tab":z.headingLevelCommandBuilder(o,-1,!1)};for(let n=1;n<=6;n++)t[`Shift-Mod-${n.toString()}`]=fo(o.nodes[this.proseMirrorNodeName()],{level:n});return t}unistNodeToProseMirrorNodes({node:o,schema:t,convertedChildren:n,attrs:r}){const{depth:s}=o;return ge(this.proseMirrorNodeName(),t,n,{...r,level:s})}proseMirrorNodeToUnistNodes(o,t){return[{type:this.unistNodeName(),depth:o.attrs.level,children:t}]}}const Le=(e,o,t)=>{const n=t==="min"?0:o.length-1;for(let r=n;t==="min"?r<o.length:r>=0;t==="min"?r++:r--){const{sourcePos:s,pmPos:a}=o[r];if(s===e)return a;if(t==="min"&&s>e||t==="max"&&s<e)return t==="min"?o[r-1]?.pmPos??a:a}return null};class un extends ie{unistNodeName(){return"root"}static proseMirrorNodeName(){return"doc"}proseMirrorNodeSpec(){return{content:"block+"}}unistNodeToProseMirrorNodes({schema:o,convertedChildren:t,attrs:n}){return ge(this.proseMirrorNodeName(),o,t,n)}proseMirrorNodeToUnistNodes(o,t){return[{type:this.unistNodeName(),children:t}]}}const Ae=(e,o)=>{if(!o)return!1;const[t,n]=o;return e>=t&&e<n},mt=(e,o)=>e.pmPos-o.pmPos,we=(e,o)=>{const t=o[o.length-1].sourcePos;return Math.min(Math.max(e,0),t)},Ie=(e,o)=>{const t=W(o)?.sourcePos??0;return Math.min(Math.max(e,0),t)},Re=({positions:e,sourcePos:o,sourceEndPos:t})=>{const n=[];for(let r=0;r<e.length;r++){const s=e[r],{sourcePos:a,leafSourceRange:i,isClose:l=!1}=s;if(t!=null&&a>t)break;const m=e[r+1]??null,f=p=>{let d=e[p];if(d==null)return p;let h=e[p+1],{leafSourceRange:g}=d;for(;d.nodeTypeName!==J.proseMirrorNodeName()&&!d.isClose&&h!=null&&!Ae(o,g);)n.push(h),d=h,h=e[p+2],g=d.leafSourceRange,p++;return p};if(a===o&&!l||Ae(o,i))n.push(s),r=f(r);else if(a<=o&&(m?.sourcePos??Number.POSITIVE_INFINITY)>=o){let p=r+1;const d=[];for(;e[p]?.isClose===!0;)d.push(p),p++;if(e[p]){const{sourcePos:h}=e[p];do n.push(e[p]);while(e[++p].sourcePos===h);p=f(p-1)}else{(a===o||l)&&n.push(s);for(const h of d)n.push(e[h])}r=p}}return n.sort(mt)},De=({positions:e,sourcePos:o})=>{const t=[],n=r=>{r&&t.push(r)};for(let r=0;r<e.length;r++){const s=e[r],{sourcePos:a}=s;if(o==null||a>o)break;const i=e[r-1]??null,l=e[r+1]??null,m=o>a&&o<(l?.sourcePos??-1),f=s.nodeTypeName===J.proseMirrorNodeName();if(a===o||m&&!f){if(s.isClose&&!i?.isClose&&s.nodeTypeName===i?.nodeTypeName||!s.isClose&&l.isClose&&s.nodeTypeName===l.nodeTypeName||s.isClose&&i?.isClose||!s.isClose&&i!=null&&i?.nodeTypeName!==J.proseMirrorNodeName()){n(i);let g=r-2,C=e[g];for(;g>=0&&C.isClose;)n(C),C=e[--g]}let p=r,d=s,h=d;do n(d),h=d,d=e[++p];while(d?.sourcePos===o||d?.depth<h?.depth);break}else if(m&&f){let p=r+1,d=e[p];for(;d?.isClose;)n(d),d=e[++p];break}}return t.sort(mt)},dn=e=>{const o=new qt(Zt.GetPositionTransformer,{debug:!1});o.startBlock("get_positition_transformer");const t=new Map;e.descendants((s,a)=>{const i=Ne(s);if(!i)return;const{start:l,end:m}=i,f=s.type.name,{depth:p}=e.resolve(a);if(t.set(a,{pmPos:a,sourcePos:l,leafSourceRange:s.isBlock?void 0:[l,m],depth:p,nodeTypeName:f,isClose:!1,parentNodeTypeNameStack:[]}),s.isBlock){const d=a+s.nodeSize-1;t.set(d,{pmPos:d,sourcePos:m,depth:e.resolve(d).depth,nodeTypeName:f,isClose:!0,parentNodeTypeNameStack:[]})}if(s.isText)for(let d=0;d<(s.text?.length??0);d++){const h=a+d;t.set(h,{pmPos:h,sourcePos:l+d,depth:p,nodeTypeName:f,isClose:!1,parentNodeTypeNameStack:[]})}}),t.set(e.content.size,{pmPos:e.content.size,nodeTypeName:e.type.name,depth:0,isClose:!0,sourcePos:$(Ne(e)).end,parentNodeTypeNameStack:[]});const n=Array.from(t.entries()).sort(([s],[a])=>s-a).map(([,s])=>s),r=[un.proseMirrorNodeName()];for(const s of n)s.isClose?(s.parentNodeTypeNameStack=r.concat(),r.pop()):(s.parentNodeTypeNameStack=r.concat(),s.nodeTypeName!==J.proseMirrorNodeName()&&W(r)!==s.nodeTypeName&&r.push(s.nodeTypeName));return o.endBlock("get_positition_transformer"),{positions:n,pmRangeToSourceRange:({start:s,end:a})=>({start:n[Math.max(s,0)].sourcePos,end:n[Math.min(a,n.length-1)].sourcePos}),sourceStartToPmPos:s=>Re({sourcePos:we(s,n),positions:n,sourceEndPos:null}),sourceEndToPmPos:s=>De({sourcePos:Ie(s,n),positions:n}),sourceRangeToPmRange:s=>{o.startBlock("source_range_to_pm_range");const{start:a,end:i}=s,l=Ie(i,n),m=Re({sourcePos:we(a,n),sourceEndPos:l,positions:n}),f=De({sourcePos:l,positions:n});return o.endBlock("source_range_to_pm_range"),{start:m,end:f}}}},mn=Jt(dn);function fn(e,o){const t=gn(e);if(t.length===0)return o;let n=o;return t.forEach(r=>{n=pn(r,n)}),n}function pn(e,o){return Xt(o,{start:e.from,end:e.to},hn(e))}function hn(e){return e.slice.size-(e.to-e.from)}function gn(e){return e.steps.filter(o=>o instanceof Eo)}const re=new vo("comments");function je(e,o){const{sourceRangeToPmRange:t}=mn(e),n=o.map(({id:r,at:s})=>{const{start:a,end:i}=t(s),l=Le(s.start,a,"max"),m=Le(s.end,i,"min");return m==null||l==null?null:[r,{start:l,end:m}]}).filter(Qe);return new Map(n)}function En(e,o){const{type:t}=o;if(t===V.SELECTION){const{from:s,to:a}=o;return[s,a]}const{pos:n}=o,r=n+(e.nodeAt(n)?.nodeSize??0);return[n,r]}const Be=(e,o,t=null,n=null)=>{const r=[],s=Array.from(o.entries()).reverse(),a=new Map(e.map(i=>[i.id,i]));for(const[i,l]of s){const m=a.get(i),d=$t({isHovered:t===i,isFocused:n===i,isCode:!1,diffStatus:m?.diffStatus});r.push(ot.inline(l.start,l.end,{class:d,"data-comment-id":i,nodeName:"span"}))}return r},Lr=e=>new tt({key:re,state:{init:(o,{doc:t})=>{const n=je(t,e);return{comments:e,commentingOn:null,hoveredOnBlock:null,hoveredCommentId:null,focusedCommentId:null,decorations:Be(e,n),positions:n}},apply:(o,t)=>{const n=o.getMeta(re)??{},r=n.comments,s=r??t.comments,a=r!=null?je(o.doc,s):t.positions;let i=n.commentingOn;i===void 0&&(i=t.commentingOn);let l=n.hoveredCommentId;l===void 0&&(l=t.hoveredCommentId);let m=n.focusedCommentId;m===void 0&&(m=t.focusedCommentId);const f=fn(o,a),p=Kt(s,f);return{comments:p,commentingOn:i,hoveredCommentId:l,focusedCommentId:m,decorations:Be(p,f,l,m),positions:f}}},props:{handleClickOn:(o,t,n,r,s)=>{const{target:a}=s;if(a instanceof HTMLElement){const{commentId:i}=a.dataset;if(!i)return;A.focusComment(i)}},handleDOMEvents:{mouseover(o,t){const{target:n}=t;if(n instanceof HTMLElement){const{commentId:r}=n.dataset;r?A.mouseEnterComment(r):A.mouseLeaveComment()}}},decorations(o){const t=this.getState(o);if(!t)return Te.empty;const{commentingOn:n,decorations:r}=t,{doc:s}=o;if(n){const[a,i]=En(s,n);a!=null&&i!=null&&r.push(ot.inline(a,i,{class:Bt.document},{comment:{pattern:n}}))}return Te.create(s,r.concat())}}});function vn(e,o,t){const n=e+o;for(const r of t.values()){const s=r.start,a=r.end;if(e<a&&s<n)return!0}return!1}const Cn=50,xn=200,_n=[dt.proseMirrorNodeName(),z.proseMirrorNodeName()],yn=e=>e?e.isBlock:!1,Nn=e=>{if(!e)return!1;const{isBlock:o,type:{name:t}}=e;return o&&_n.includes(t)},bn=(e,o,t,n)=>{const r=e.posAtCoords({left:o,top:t});if(r==null)return;const{pos:s,inside:a}=r;if(a===-1)return;const{state:i}=e;let l=s,m=i.doc.nodeAt(l);for(;!yn(m)&&l>=0;)l--,m=i.doc.nodeAt(l);if(!m||!Nn(m))return;const f=n!=null&&vn(l,m.nodeSize,n);return{node:m,nodeHasComment:f,pos:l}};function Tn(e,o,t){const n=bn(e,o.x,o.y,t);if(n==null)return null;const{node:r,pos:s,nodeHasComment:a}=n,{top:i}=e.coordsAtPos(0);function l(){const h=s+1;return on(e.state.doc,h)&&e.state.doc.nodeAt(h)?.isText?e.coordsAtPos(h).top:e.coordsAtPos(s).top}const m=l(),f=m-i;return{height:e.coordsAtPos(s+r.nodeSize-1).bottom-m,nodeHasComment:a,mouseEnteredAt:Date.now(),yOffset:f,pos:s}}function Pn(e){const o=v.useRef(!1),t=v.useRef(!1),[n,r]=v.useState(null),s=Wt(),a=s()?.dom,i=v.useRef(!1),l=j(({visibleBlockCommentLauncher_DEBUG_ONLY:p})=>p),m=v.useCallback(et(p=>{o.current=!0;const{commentingOn:d}=j.getState();if(t.current||d!=null)return;const h=s();if(h==null||!o.current)return r(null);const{dom:g,state:C}=h,E=ut(re,C)?.positions;if(E==null)return r(null);const y=Tn(h,p,E);if(y==null||y.nodeHasComment&&e===R.COLLAPSED){r(null);return}if(i.current&&y.yOffset!==n?.yOffset){r(null);return}const T=h.coordsAtPos(0),S=g.getBoundingClientRect().width,P=(p.x-T.left)/S>=Cn/100;r(P?y:null)},xn),[s,i,n]);v.useEffect(()=>{if(a!=null)return Fe(a,{mouseenter:()=>{o.current=!0,t.current=!1},mouseleave:({relatedTarget:p})=>{if(m.cancel(),p instanceof HTMLElement&&p.closest("[data-block-comment-launcher]")){t.current=!0;return}t.current=!1,o.current=!1,j.getState().commentingOn==null&&r(null)},mousemove:m})},[s,a,e,m]);const f=v.useCallback(({relatedTarget:p})=>{const{commentingOn:d}=j.getState();d==null&&p!==a&&(t.current=!1,r(null))},[a]);return{visibleBlockComment:l??n,handleMouseLeave:f,onComposerVisibleChange:p=>{i.current=p}}}const kn=({isWaitingForCommentResponse:e=!1,opensOverDocument:o=!1,hasComments:t=!1,activeBlockComment:n,composerRef:r,onLaunchComposer:s,onMouseLeave:a,onSubmit:i})=>{const[l,m]=v.useState(!1),{yOffset:f,height:p,pos:d}=n,h=()=>{m(!0),s?.(),I.logButtonClick(F.BLOCK_COMMENT_LAUNCHER),A.startCommentingOn({type:V.BLOCK,pos:d})},g=y=>{y||(m(!1),A.cancelCommentingOn())},C=y=>{m(!1),i?.(y)};v.useEffect(()=>()=>{A.mouseLeaveBlock()},[]);const E=t&&l?o?-88:88:0;return u.jsx(w.div,{className:O("pointer-events-auto absolute flex h-6 w-5 origin-[14px_50%] items-start after:absolute after:-inset-4 after:content-['']",D.commentComposer),initial:!1,animate:{opacity:1},exit:{opacity:0},transition:{type:"spring",duration:.2,bounce:.1},style:{top:0,height:p,translateY:f},onMouseLeave:a,"data-block-comment-launcher":!0,children:u.jsxs(Y,{children:[l?u.jsx(lt,{ref:r,opensFromGutter:!0,onClose:g,onSubmit:C,gutterHasComments:t,opensOverDocument:o},"composer"):null,u.jsx(w.button,{initial:{opacity:0},animate:{opacity:l?0:1,translateX:E},transition:{duration:.15,translateX:{type:"spring",bounce:.18,duration:.48}},className:"group absolute z-10 flex h-6 gap-1 bg-transparent after:absolute after:-inset-y-4 after:-left-1 after:-right-4 after:content-['']",onClick:h,onMouseEnter:()=>A.mouseEnterBlock(d),onMouseLeave:()=>A.mouseLeaveBlock(),disabled:l||e,children:u.jsx(Ko,{isLoading:e})},"launcer")]})})},Sn=({isWaitingForCommentResponse:e=!1,isRequestActive:o=!1,hasComments:t=!1,composerRef:n,gutterMode:r,onAddComment:s})=>{const a=qe(),{visibleBlockComment:i,handleMouseLeave:l,onComposerVisibleChange:m}=Pn(r),f=p=>{if(!i||!a)return;const{doc:d}=a,{pos:h}=i,g=d.nodeAt(h);if(!g)return;const{attrs:{start:C,end:E}}=g;s?.(p,Ze.ASK,{start:C,end:E},V.BLOCK)};return u.jsx(Y,{onExitComplete:()=>m(!1),children:i&&a&&(e||!o)&&u.jsx(kn,{composerRef:n,isWaitingForCommentResponse:e,opensOverDocument:r===R.COLLAPSED,activeBlockComment:i,hasComments:t,onSubmit:f,onMouseLeave:l,onLaunchComposer:()=>m(!0)},"launcher")})},ft={type:"spring",bounce:.12,duration:.5},pt="opacity-50",Mn=({count:e,offsetY:o,isLoading:t=!1,onClick:n})=>u.jsx(w.div,{className:O("absolute",D.collapsedComment),initial:{opacity:0},animate:{opacity:1},style:{translateY:o},transition:ft,exit:{opacity:0},children:u.jsx(Xo,{count:e,isLoading:t,onClick:n})}),On=({isFocused:e,isHovered:o})=>{const t=e||o?"grow font-medium text-token-text-primary transition-colors":"grow font-medium text-token-text-secondary transition-colors",n=e||o?"opacity-100 transition":"opacity-75 transition";return u.jsxs(u.Fragment,{children:[u.jsx("div",{className:n,children:u.jsx("div",{className:"gizmo-bot-avatar rounded-full",children:u.jsx(Qt,{size:"gizmoConversation",iconName:"openai"})})}),u.jsx("span",{className:t,children:"ChatGPT"})]})},Ln=({comment:e,isFocused:o,isSomeCommentFocused:t,isHovered:n})=>{const r=e.diffStatus===me.REMOVED;return u.jsx("div",{className:O("mt-2 text-token-text-primary transition-all",{"opacity-80":!o&&!t&&!n&&!r,"opacity-40":!o&&t&&!n&&!r,[pt]:r}),children:e.content})},An=({left:e,right:o,comment:t,disableAnimations:n=!1,onClick:r,onMouseEnter:s,onMouseLeave:a,onAccept:i,onDismiss:l,translateY:m,isFocused:f=!1,isSomeCommentFocused:p=!1,disableActions:d=!1,isHovered:h=!1},g)=>{const[C,E]=v.useState(!1),y=t.diffStatus===me.ADDED,T=t.diffStatus===me.REMOVED,S=t.diffStatus!=null,N=()=>{E(!0),s?.()},P=()=>{E(!1),a?.()},b=pe(),k=f||C&&!p;return u.jsx(w.div,{ref:g,className:O("absolute",D.expandedComment,{"cursor-default":f,"cursor-pointer":!f,[D.expandedCommentFocused]:f,[D.expandedCommentHovered]:h}),style:{left:e,right:o},initial:n?!1:{translateY:m,scale:.85,opacity:0},animate:n?void 0:{translateY:m,scale:f?1:.97,opacity:1},exit:n?void 0:{scale:.85,opacity:0,filter:"blur(16px)"},transition:ft,onClick:r,onMouseEnter:d?void 0:N,onMouseLeave:d?void 0:P,"data-comment-id":t.id,children:u.jsxs("div",{className:O("flex min-h-8 flex-col overflow-hidden rounded-2xl border p-4 pt-2 text-left text-sm transition-all",{"border-transparent bg-gray-50 dark:bg-gray-800":!f&&!h,"border-token-border-light bg-token-main-surface-primary":h&&!f,"border-token-border-light bg-token-main-surface-primary shadow-xl":f||C&&!p,"relative after:absolute after:bottom-0 after:left-0 after:top-0 after:w-1":S,"after:bg-green-500":y,"after:bg-red-500":T}),style:{width:te},children:[u.jsxs("div",{className:O("flex h-8 flex-row items-center gap-2.5",{[pt]:T}),children:[u.jsx(On,{isFocused:f,isHovered:h}),u.jsx("button",{className:O("-mr-1 rounded-full bg-transparent p-1 text-token-text-secondary",{"cursor-pointer hover:bg-gray-100 hover:text-token-text-primary dark:hover:bg-gray-700":!d,"cursor-not-allowed":d}),onClick:l,disabled:d,"aria-label":b.formatMessage({id:"fYDa3C",defaultMessage:"Dismiss comment"}),children:u.jsx(uo,{className:"icon-sm"})})]}),u.jsx(Ln,{comment:t,isFocused:f,isHovered:h,isSomeCommentFocused:p}),u.jsx(Y,{initial:!1,children:k&&u.jsx(w.div,{initial:n?!1:{opacity:0,height:0},animate:{opacity:1,height:"auto",transition:{opacity:{delay:.14,duration:.2},height:{bounce:0,duration:.2}}},exit:n?void 0:{opacity:0,height:0,transition:{opacity:{duration:.08},height:{bounce:0,duration:.2}}},className:"flex items-center justify-start",children:u.jsx("div",{className:"mt-2.5",children:u.jsx(wt,{color:"secondary",onClick:i,disabled:d,children:b.formatMessage({id:"WIW5OL",defaultMessage:"Apply"})})})})})]})})},ht=v.forwardRef(An),wn=({offsetY:e,opensOverDocument:o=!1,disableActions:t=!1,isFocused:n=!1,isSomeCommentFocused:r=!1,onAccept:s,onClick:a,onDismiss:i,onMouseEnter:l,onMouseLeave:m,comment:f,isHovered:p=!1})=>{const d=v.useRef(null);return v.useEffect(()=>Fe(document,{mousedown:({target:h})=>{h instanceof HTMLElement&&!h.closest("[data-comment-id]")&&!d.current?.contains(h)&&A.blurComment()}})),u.jsx(ht,{ref:d,comment:f,disableActions:t,onAccept:s,onDismiss:i,onMouseEnter:l,onMouseLeave:m,isSomeCommentFocused:r,isHovered:p,onClick:a,translateY:e,isFocused:n,left:o?void 0:We,right:o?Vt:void 0})},In=({onAcceptComment:e,onDismissComment:o,disableActions:t=!1,entry:n,isGutterCollapsed:r=!1,isHovered:s=!1,isFocused:a=!1,isSomeCommentFocused:i=!1})=>{const{offsetY:l,type:m}=n,[f,p]=eo();let d=null;if(m===L.COLLAPSED)d=!a&&u.jsx(Mn,{offsetY:l,count:n.count,onClick:()=>{I.logButtonClick(F.COLLAPSED_COMMENT),A.focusComment(n.children[0])}},"collapsed");else{const{comment:h}=n;if(h==null||h.content===""||h.status===be.DISMISSED)d=null;else if(h.status===be.ACCEPT_INITIATED)d=u.jsx("div",{className:"absolute",style:{top:l},children:u.jsx(le,{})},"loading");else{const{id:g}=h;d=u.jsx(wn,{isSomeCommentFocused:i,isHovered:s,isFocused:a,offsetY:l,disableActions:t,onClick:()=>{I.logButtonClick(F.EXPANDED_COMMENT),A.focusComment(g)},onMouseEnter:()=>A.mouseEnterComment(g),onMouseLeave:()=>A.mouseLeaveComment(),comment:h,onAccept:()=>{I.logButtonClick(F.COMMENT_ACCEPT,{commentId:g}),e?.(g)},onDismiss:()=>{I.logButtonClick(F.COMMENT_DISMISS,{commentId:g}),o?.(g)},opensOverDocument:r},"expanded")}}return u.jsx(Y,{onExitComplete:()=>p?.(),children:f&&d})},Ve=({onMeasureHeight:e,comment:o,isFocused:t=!1})=>{const[{height:n},r]=ce();return ze(()=>{e?.(n)},[n]),u.jsx(ht,{ref:r,comment:o,isFocused:t,disableAnimations:!0})},Rn=({comments:e,onMeasure:o,getStableCommentId:t})=>{const n=v.useRef(new Map),r=v.useRef(new Map),s=v.useRef(null),a=(i,l,m=!1)=>{l&&(m?r.current.set(t(i),l):n.current.set(t(i),l),s.current&&cancelAnimationFrame(s.current),s.current=requestAnimationFrame(()=>{o?.({focusedHeights:new Map(r.current),heights:new Map(n.current)}),s.current=null}))};return e?.length?u.jsxs("div",{className:"pointer-events-none invisible fixed left-0 top-0 overflow-clip","aria-hidden":"true",children:[e.map(i=>u.jsx(Ve,{comment:i,onMeasureHeight:l=>a(i.id,l)},t(i.id))),e.map(i=>u.jsx(Ve,{isFocused:!0,comment:i,onMeasureHeight:l=>a(i.id,l,!0)},`${t(i.id)}-focused`))]}):null},He=(e,o,t)=>{let n=t+o;for(;o===B.down?n<e.length:n>-1;){const r=e[n],s=e[n-o],a=$o(U(r),U(s),o);if(a!=null&&r.type!==L.COLLAPSED)r.shiftY+=a;else break;n+=o}},Ge=(e,o)=>{for(const t of o){const{index:n,amount:r}=t,s=e[n];s.type===L.EXPANDED&&(s.shiftY+=r),He(e,B.down,n),He(e,B.up,n);for(const a of e)a.type!==L.COLLAPSED&&(a.offsetY+=a.shiftY,a.shiftY=0)}},Dn=(e,o)=>{const t=[],[n,r]=o,s=n+r;for(let a=0;a<e.length;a++){const i=e[a],[l]=U(i),m=[l,i.type===L.EXPANDED?i.height:0],[f,p]=m;if(at(m,o)){const d=f+p,h=n-d,g=s-f,E=(Math.abs(h)<Math.abs(g)?B.up:B.down)===B.up?h:g;t.push({index:a,amount:E})}}return t},jn=({gutterMode:e,focusedCommentId:o,gutterPositions:t,getCommentKey:n,getComment:r})=>{if(!t?.size)return[];const s=new Map,a=[];let i=null,l=-1;for(const f of t.values()){if(f.type===ne.COMPOSER){i=[f.offsetY,f.height];continue}const{commentId:p,height:d,collapsedOffsetY:h,offsetY:g}=f;if(e===R.EXPANDED){const y=W(a),T=y?fe(U(y)):0;let S=g;y&&S<=T&&(S=T),s.set(p,{originalOffsetY:g,offsetY:S}),o===p&&(l=a.length),a.push({key:n(p),comment:r(p),type:L.EXPANDED,height:d,offsetY:S,shiftY:0});continue}let C=a.findIndex(({offsetY:y,type:T})=>T===L.COLLAPSED&&y===h),E=a[C]??null;if(!E)E={key:a.length,type:L.COLLAPSED,offsetY:g,count:1,children:[p]},C=a.length,a.push(E);else{if(E.type!==L.COLLAPSED)throw new Error("Collapsed parent type expected to be collapsed");E.count+=1,E.children.push(p),E.offsetY=h}o===p&&(l=C)}const m=a[l];if(e===R.COLLAPSED&&m?.type===L.COLLAPSED){const f=[];for(let p=0;p<m.children.length;p++){const d=m.children[p];d===o&&(l+=p+1);const h=W(f),g=h?fe(U(h)):0,C=t.get(d)?.offsetY??0,E=Math.max(g,C);s.set(d,{originalOffsetY:C,offsetY:E}),f.push({type:L.EXPANDED,key:n(d),comment:r(d),offsetY:E,height:t.get(d)?.height??0,shiftY:0})}a.splice(l,0,...f)}if(o){const f=s.get(o);if(!f)return a;const{offsetY:p,originalOffsetY:d}=f,h=d-p,g=[{amount:h,index:l}];let C=l+1;for(;C<a.length;){const E=a[C],{type:y}=E;let T=h;if(y===L.EXPANDED&&E.comment?.id){const{offsetY:S,originalOffsetY:N}=$(s.get(E.comment.id));if(S===N)break;T=Math.max(N-S,h)}else break;g.push({amount:T,index:C}),C++}g.length&&Ge(a,g)}else if(e!==R.COLLAPSED&&i){const f=Dn(a,i);Ge(a,f)}return a},Bn=e=>{try{return jn(e)}catch(o){return I.logError("Generating comment gutter entries",o),[]}},Vn=e=>"length"in e?e.length===0:e.nodeSize===0,de=12,Hn=({composerHeight:e,getCommentHeight:o,getCollapsedStartPos:t,commentingOn:n,commentPositions:r,view:s})=>{if(!r||!s||Vn(s.state.doc))return null;const{top:a}=s.dom.getBoundingClientRect(),i=Array.from(r.entries()).sort(([m,f],[p,d])=>f.start-d.start),l=new Map;for(const[m,{start:f}]of i)try{const p=t?.(f)??f,{top:d}=K(s,p),{top:h}=K(s,f),g=h-a,C=d-a,E=(o(m)??0)+de;l.set(m,{commentId:m,height:E,collapsedOffsetY:C,offsetY:g,type:ne.COMMENT})}catch{continue}if(n?.type===V.BLOCK){const{pos:m}=n;try{const{top:f}=K(s,m),d=f-a-de;l.set("block-composer",{type:ne.COMPOSER,height:(e??0)+de,offsetY:d})}catch{}}return l},gt=(e,o)=>o.nodeAt(e)?.isBlock?e+1:gt(e-1,o);function Gn(e){const o=qe(),n=q()?.();if(!n)return null;if(ae(n)){if(!o)return null;const r=ut(re,o);return r?r.positions:null}return new Map(e.map(r=>[r.id,r.at]))}const Yn=({gutterMode:e,focusedCommentId:o,commentingOn:t,comments:n,getStableId:r})=>{const[{height:s},a]=ce(),i=q(),[l,m]=v.useState(()=>new Map),[f,p]=v.useState(()=>new Map),d=v.useCallback(({focusedHeights:N,heights:P})=>{m(N),p(P)},[]),h=N=>{const P=r(N);return N===o?l.get(P)??0:f.get(P)??0},g=i(),C=g!=null&&ae(g)?N=>gt(N,g.state.doc):void 0,E=new Map(n?.map(N=>[r(N.id),N])),y=Gn(n),T=Hn({composerHeight:s,commentingOn:t,getCommentHeight:h,getCollapsedStartPos:C,commentPositions:y,view:g}),S=Bn({gutterMode:e,gutterPositions:T,focusedCommentId:o,getComment:N=>E.get(r(N))??null,getCommentKey:r});return{blockComposerRef:a,onMeasureComments:d,gutterEntries:S}};function Fn(){const o=q()(),t=j(({commentingOn:s})=>s),r=o==null?null:Zo(o,t);return r==null?null:u.jsx(w.div,{className:"absolute",style:{top:r.loadingTop},initial:!1,animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},transition:{delay:.2},children:u.jsx(le,{})},"selection-loading")}const zn=e=>u.jsx("div",{className:"absolute",style:{top:fe(U(e))},children:u.jsx("div",{className:"h-[max(3rem,18vh)] w-1"})}),Ar=({availableWidth:e,comments:o,commentsMode:t,disableBlockComments:n=!1,isRequestActive:r=!1,isWaitingForCommentResponse:s=!1,onAddComment:a,onAcceptComment:i,onDismissComment:l,getStableCommentId:m})=>{const f=j(({focusedCommentId:k})=>k),p=j(({hoveredCommentId:k})=>k),d=j(({commentingOn:k})=>k),h=e<_e?R.COLLAPSED:R.EXPANDED,{onMeasureComments:g,blockComposerRef:C,gutterEntries:E}=Yn({comments:o,getStableId:m,gutterMode:h,focusedCommentId:f,commentingOn:d}),y=E.length>0,T=d!=null&&!s&&d.type!=="selection"||y,N=(()=>{if(!T)return 0;switch(h){case R.COLLAPSED:return 0;case R.EXPANDED:return _e}})(),P=d?.type==="selection",b=W(E);return u.jsxs(w.div,{className:O("pointer-events-none relative flex h-full flex-shrink-0",D.commentGutter,h===R.COLLAPSED&&N?"basis-[32px]":"basis-0"),initial:{width:0,opacity:0},animate:{width:N,opacity:1},exit:{width:0,opacity:0},children:[u.jsx(Rn,{getStableCommentId:m,comments:o,onMeasure:g}),u.jsxs("div",{className:O("pointer-events-auto absolute bottom-0 left-0 top-0 w-0 overflow-visible",{"pl-2":T||!n}),children:[u.jsx(Y,{children:E.map(k=>{const{key:Q,type:xe}=k,Pt=!!f&&xe===L.EXPANDED&&k.comment?.id===f,kt=!!f&&k.type===L.COLLAPSED&&k.children.includes(f);return u.jsx(In,{isGutterCollapsed:h===R.COLLAPSED,isSomeCommentFocused:!!d||!!f,isHovered:xe===L.EXPANDED&&k.comment?.id===p,isFocused:Pt||kt,entry:k,disableActions:r||s||t===ye.COMMENTS_READONLY,onAcceptComment:X=>{try{i?.($(o?.find(G=>G.id===X)))}catch(G){I.logError(`Comment ${X} not found`,G)}},onDismissComment:X=>{try{l?.($(o?.find(G=>G.id===X)))}catch(G){I.logError(`Comment ${X} not found`,G)}}},Q)})}),y&&b&&u.jsx(zn,{...b}),t===ye.ENABLED&&!P&&!n&&u.jsx(Sn,{composerRef:C,gutterMode:h,onAddComment:a,isWaitingForCommentResponse:s,isRequestActive:r,hasComments:y}),s&&P&&u.jsx(Fn,{})]})]})};var Un="Separator",Ye="horizontal",Xn=["horizontal","vertical"],Et=v.forwardRef((e,o)=>{const{decorative:t,orientation:n=Ye,...r}=e,s=Kn(n)?n:Ye,i=t?{role:"none"}:{"aria-orientation":s==="vertical"?s:void 0,role:"separator"};return u.jsx(se.div,{"data-orientation":s,...i,...r,ref:o})});Et.displayName=Un;function Kn(e){return Xn.includes(e)}var $n=Et,Ee="Toolbar",[Wn,wr]=It(Ee,[Ue,nt]),ve=Ue(),vt=nt(),[Jn,Ct]=Wn(Ee),xt=v.forwardRef((e,o)=>{const{__scopeToolbar:t,orientation:n="horizontal",dir:r,loop:s=!0,...a}=e,i=ve(t),l=Rt(r);return u.jsx(Jn,{scope:t,orientation:n,dir:l,children:u.jsx(Dt,{asChild:!0,...i,orientation:n,dir:l,loop:s,children:u.jsx(se.div,{role:"toolbar","aria-orientation":n,dir:l,...a,ref:o})})})});xt.displayName=Ee;var _t="ToolbarSeparator",yt=v.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=Ct(_t,t);return u.jsx($n,{orientation:r.orientation==="horizontal"?"vertical":"horizontal",...n,ref:o})});yt.displayName=_t;var qn="ToolbarButton",Ce=v.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=ve(t);return u.jsx(Xe,{asChild:!0,...r,focusable:!e.disabled,children:u.jsx(se.button,{type:"button",...n,ref:o})})});Ce.displayName=qn;var Zn="ToolbarLink",Qn=v.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=ve(t);return u.jsx(Xe,{asChild:!0,...r,focusable:!0,children:u.jsx(se.a,{...n,ref:o,onKeyDown:jt(e.onKeyDown,s=>{s.key===" "&&s.currentTarget.click()})})})});Qn.displayName=Zn;var Nt="ToolbarToggleGroup",er=v.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=Ct(Nt,t),s=vt(t);return u.jsx(Co,{"data-orientation":r.orientation,dir:r.dir,...s,...n,ref:o,rovingFocus:!1})});er.displayName=Nt;var tr="ToolbarToggleItem",or=v.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=vt(t),s={__scopeToolbar:e.__scopeToolbar};return u.jsx(Ce,{asChild:!0,...s,children:u.jsx(xo,{...r,...n,ref:o})})});or.displayName=tr;var nr=xt,rr=yt,sr=(e=>(e.CODE="code",e.WRITING="writing",e))(sr||{});const Z=({children:e,toolbarType:o})=>u.jsx(nr,{className:O("m-0 flex h-10 w-fit min-w-0 flex-shrink items-center overflow-hidden rounded-xl border border-token-border-light bg-token-main-surface-primary",$e,o==="code"?"p-0":"p-1"),children:e}),bt=({icon:e,hideLabel:o,label:t})=>u.jsxs(u.Fragment,{children:[u.jsx(e,{className:O("icon-sm",{"mr-0.5 text-token-text-tertiary":!o,"text-token-text-primary":o})}),!o&&u.jsx("span",{className:"truncate text-sm text-token-text-primary",children:t})]}),Tt=Ke(Ce)`flex h-full items-center gap-1 rounded-lg px-2.5 hover:bg-[#f5f5f5] dark:hover:bg-token-main-surface-secondary`,ar=({label:e,icon:o,hideLabel:t=!1,onClick:n,onMouseDown:r})=>u.jsx(Tt,{onClick:n,"aria-label":t?e:void 0,onMouseDown:r,children:u.jsx(bt,{icon:o,hideLabel:t,label:e})}),ir=({icon:e,hideLabel:o,label:t,children:n})=>u.jsxs(to,{children:[u.jsx(oo,{asChild:!0,children:u.jsx(Tt,{"aria-label":o?t:void 0,children:u.jsx(bt,{icon:e,hideLabel:o,label:t})})}),u.jsx(no,{children:u.jsx(ro,{align:"end",className:D.toolbar,sideOffset:8,children:n})})]});Z.Separator=Ke(rr)`mx-1 p-0 list-none h-full w-[1px] bg-token-border-light`;Z.Action=ar;Z.Popover=ir;const cr=({getSelectionRange:e})=>{const o=pe(),t=()=>{const n=e();if(n==null)return;const{from:r,to:s,sourceFrom:a,sourceTo:i}=n;if(r==null||s==null||a==null||i==null){I.logError("Missing selection range on targeted edit",n);return}const l=Ze.ASK;I.logButtonClick(F.TOOLBAR_ASK_CHATGPT,{action:l,sourceFrom:a,sourceTo:i}),A.startCommentingOn({type:V.SELECTION,from:r,to:s,sourceRange:{start:a,end:i},action:l})};return u.jsx(Z.Action,{label:o.formatMessage({id:"wOaJUU",defaultMessage:"Ask ChatGPT"}),onClick:t,icon:mo})},Ir=({getEditorDom:e,getToolbarPosition:o,getSelectionRange:t,toolbarType:n,children:r,onAddComment:s,isWaitingForCommentResponse:a=!1})=>{const[{height:i,width:l},m]=ce(),[f,p]=v.useState(!0),[d,h]=v.useState(!1),g=e(),C=j(({commentingOn:b})=>b),[E,y]=v.useState(null),T=v.useCallback(()=>{const b=e(),k=document.getSelection();return!k||k.type!=="Range"||k.isCollapsed||!b?.contains(k.anchorNode)},[e]);v.useEffect(()=>{const b=so(()=>{h(!0)},200,{leading:!0}),k=()=>{b.cancel(),h(!1)};return g?.addEventListener("pointerdown",b,{passive:!0}),document.addEventListener("pointerup",k,{passive:!0}),()=>{g?.removeEventListener("pointerdown",b),document.removeEventListener("pointerup",k)}},[g]),v.useEffect(()=>{const b=()=>{p(T())};return document.addEventListener("selectionchange",b,{passive:!0}),()=>{document.removeEventListener("selectionchange",b)}},[T]),ze(()=>{if(f||T())return p(!0);try{const b=o({width:l,height:i});b!=null&&y(b)}catch(b){I.logError("Invalid position in getToolbarPosition",b)}},[i,l,f,T,o]);const S=u.jsxs(Z,{toolbarType:n,children:[u.jsx(cr,{getSelectionRange:t}),r]}),N=!f&&!C&&E!=null,P=_o(N);return v.useEffect(()=>{!N&&P&&!C&&g?.focus()},[g,P,N,C]),u.jsxs(u.Fragment,{children:[u.jsx("div",{"aria-hidden":"true",className:"pointer-events-none invisible fixed left-0 top-0 h-0 overflow-clip",children:u.jsx("div",{ref:m,children:S})}),u.jsx(Y,{children:N&&u.jsx(w.div,{initial:{opacity:0,scale:.95},animate:{opacity:d?0:1,scale:d?.95:1},style:{top:E.top,left:E.left},exit:{opacity:0,scale:.95},transition:{type:"spring",bounce:.1,duration:.1,delay:d?0:.1},className:O("absolute",D.toolbar,d?"pointer-events-none":"pointer-events-auto"),children:S})}),u.jsx(en,{toolbarPosition:E,commentingOn:C,isWaitingForCommentResponse:a,onAddComment:s})]})};function lr(e){let o=e;for(;o;){const n=window.getComputedStyle(o).overflowY;if(n==="auto"||n==="scroll")return o;o=o.parentElement}return null}function Rr(e,o){const t=q(),n=ao(),r=t();v.useEffect(()=>{const s=r?.dom;if(!s||e.length===0)return;const a=lr(s),i=o?et(o,100):null;return a&&i&&a.addEventListener("scroll",i,{passive:!0}),()=>{i&&(a&&a.removeEventListener("scroll",i),i.cancel())}},[r,n,e,o])}let ee=null;function Dr(){if(ee!=null)return ee;if(typeof window>"u")return 0;const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.overflow="scroll",e.style.position="absolute",e.style.top="-9999px",document.body.appendChild(e);try{ee=e.offsetWidth-e.clientWidth}finally{document.body.removeChild(e)}return ee}function jr(e){return e==null?null:e.scrollHeight>e.clientHeight}export{it as A,tn as B,Ar as C,Vn as D,Z as E,z as H,H as I,an as P,un as R,Ir as T,kr as a,Pr as b,sr as c,Dr as d,J as e,So as f,Tr as g,Sr as h,jr as i,ge as j,ln as k,cn as l,bo as m,dt as n,Mr as o,mn as p,Le as q,on as r,br as s,sn as t,Rr as u,Lo as v,Or as w,Lr as x,ut as y,re as z};
//# sourceMappingURL=etrelc8jlranxiez.js.map
