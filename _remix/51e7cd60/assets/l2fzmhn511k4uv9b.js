const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/l5vapcr3q8d1v8ja.js","assets/kqru8lsn8we722yx.js","assets/jtfo8pfmx9vwsskh.js","assets/root-n17uqvbd.css","assets/nms257ef1lzn00g8.js","assets/conversation-small-lkohtmkm.css","assets/hpsjx73jjqsse5ei.js","assets/meqed4w7o0sk383r.js","assets/enediepltp16ej6g.js","assets/g38usp1a7yktla7i.js","assets/cc1wmgbcsrgkp48d.js","assets/l9rrzsqt1j5112sm.js","assets/c4bxzbp1808foto4.js","assets/h8t3k4r3s4997n6t.js","assets/oiu851pf99o91m46.js","assets/egsprt2l7oenz6yb.js","assets/r61cv0t37q4ex83p.js","assets/ewos3yaiq011b9ly.js","assets/g002fzhg8w2j4zb1.js","assets/idqb8mo29vm3xpgg.js","assets/e12pesbad5eu6omb.js","assets/gqybtvzdlsvkl1u2.js","assets/iuipwyno0jfs7m5d.js","assets/k0ovv1uwyh2p2vy1.js","assets/ly9jpbuiezff99b2.js","assets/o1nqfxkeo8evs9xt.js","assets/ild7syzsaem5vtnl.js","assets/ojlrj31ezr4ydsqq.js","assets/fndx8pddxuhest4p.js","assets/lwt6g4izs8lu1n2g.js","assets/eoczgx28u20zdnrj.js","assets/bvyjoxfacs6ag47b.js","assets/fzrn137102spawew.js","assets/e9lafxuzyeh4418f.js","assets/eey9g2dzidtwdbbk.js","assets/g5plc6ulbf22a2hx.js","assets/cyrq1sz3ujh1kr9k.js","assets/kbdi5ue5cyi9t75w.js","assets/ohem3a9epca8a5wm.js","assets/opm54b0jnbbmhp68.js"])))=>i.map(i=>d[i]);
import{r as l,aO as ye,hJ as ei,m as e,P as J,d as Z,bi as B,bI as fa,aH as Os,aI as ut,hK as ao,cB as xa,c as ti,j as si,dd as He,bL as mn,V as Oe,U as ze,e0 as hn,br as Ge,aF as Je,dj as Mt,z as Q,o as Le,bw as ni,aJ as R,ch as oo,c6 as ro,e5 as et,aQ as Zt,bo as Nt,b8 as We,b9 as Ve,an as Rn,ba as Jt,ex as es,aj as io,bn as va,go as ai,gm as oi,cO as ri,a9 as zs,W as lo,af as ii,ae as li,bG as co,aB as ts,em as ci,gl as An,hL as ui,ay as dt,eH as di,bt as Es,ct as mi,cu as hi,cv as gi,bv as pi,c5 as Qe,bs as fi,hM as xi,am as Ct,hN as vi,$ as he,D as gn,aC as Pn,gM as In,G as Dn,ai as Xe,bk as Sa,gz as uo,az as mo,d$ as ho,fn as Si,aa as bi,ak as ba,B as go,hO as yi,hP as wi,dR as Us,ge as ji,hQ as po,bm as Gs,fW as Ti,gd as Ws,bh as Ze,u as fo,aE as Wt,a0 as kt,v as Mi,n as wt,db as Ci,al as ki,a8 as xo,bO as Re,fc as vo,a3 as _i,hR as Ei,fi as Ni,bM as Ri,hS as ya,dZ as pn,e8 as Ai,l as Ke,cG as Pi,d_ as Ps,bB as ws,M as So,aG as Ii,hT as Di,eV as Fi,aN as Bi,cq as Li,hU as Hi,bb as Oi,hV as zi,hW as bo,h2 as Vs,N as Fn,fp as yo,hX as Ui,hY as Gi,cQ as Wi,e$ as wo,hZ as Vi,fs as me,e6 as qi,dW as $i}from"./kqru8lsn8we722yx.js";import{eh as qs,ka as Ki,aH as ss,ej as Yi,kb as Xi,kc as Qi,A as ns,kd as Zi,ir as jo,iu as To,dM as Ji,B as el,cv as tl,iq as sl,ke as we,kf as _t,kg as nl,kh as al,ki as ol,kj as rl,kk as il,kl as ll,km as cl,kn as ul,ko as dl,kp as se,kq as Mo,kr as Co,cl as ml,cf as hl,ks as gl,kt as pl,ku as ko,jv as fl,fI as xl,kv as vl,kw as _o,kx as Sl,ky as Eo,kz as bl,kA as No,kB as yl,F as wl,c4 as Et,kC as Ro,kD as Ao,c0 as $s,be as qt,kE as Is,kF as Fe,kG as Po,kH as jl,kI as Tl,kJ as Ds,kK as Ml,kL as Cl,kM as kl,kN as _l,dO as El,kO as Nl,kP as Rl,kQ as Al,kR as Pl,kS as Bn,ef as Ln,kT as Il,f8 as Hn,f9 as mt,fe as On,bI as Dl,kU as Io,h9 as Do,kV as Fo,kW as Fl,kX as Fs,bj as zn,bm as Bo,cV as Bl,ct as Ll,cW as Lo,kY as Un,bo as Gn,kZ as wa,k_ as Hl,k$ as Ol,bt as ja,bq as zl,j3 as Ul,iX as Ta,l0 as Gl,l1 as Wl,l2 as Vl,l3 as ql,l4 as Wn,l5 as $l,l6 as Kl,bx as Ho,fk as Vn,hZ as qn,l7 as Ma,hC as Yl,bp as Xl,l8 as Ql,fw as Zl,j1 as Jl,fx as ec,fy as tc,l9 as sc,br as fn,la as Oo,lb as nc,lc as ac,ld as oc,o as rc,le as ic,eq as $n,U as Bs,bL as Kn,c7 as lc,lf as cc,lg as uc,lh as dc,li as mc,lj as hc,lk as gc,ll as pc,j as zo,lm as fc,ln as xc,cR as vc,fz as Sc,lo as bc,k4 as yc,hA as wc,lp as jc,lq as Tc,eg as Mc,lr as Cc,ls as kc,lt as Uo,lu as Yn,c5 as $t,lv as _c,lw as Ec,lx as Nc,ly as xn,lz as Rc,lA as Ac,c2 as vn,lB as Pc,lC as Ic,lD as Dc,hq as Fc,lE as Sn,q as Go,lF as Ca,aP as Bc,lG as Lc,lH as Hc,b$ as Oc,lI as zc,lJ as Uc,dS as Gc,lK as Wc,ea as Vc,hm as qc,lL as $c,hl as Wo,lM as Kc,e7 as Yc,lN as Xc,lO as Qc,fP as bn,lP as Zc,lQ as Vo,lR as qo,lS as $o,lT as jt,lU as Jc,lV as eu,lW as tu,j4 as su,lX as Ko,lY as nu,fn as Ls,lZ as yn,l_ as au,l$ as ou,m0 as ru,m1 as iu,m2 as ka,m3 as js,bP as _a,bY as Yo,bZ as Xo,fg as lu,m4 as cu,fJ as uu,c1 as Xn,m5 as du,m6 as mu,bc as hu,m7 as gu,m8 as pu,bi as fu,cQ as xu,fm as vu,bQ as Su,m9 as bu,fh as Ts,ma as yu,mb as wu,mc as ju,md as Tu,me as Mu,mf as Cu,mg as ku,mh as _u,mi as Eu,mj as Nu,bv as Ru,js as Au,jr as Pu,mk as Iu,bn as Du,fO as Fu,ml as Bu,mm as Lu,mn as Qo,E as Hu,k3 as Ou,mo as Ns,mp as zu,mq as Zo,by as Uu,mr as Jo,ms as Gu,mt as Wu,mu as Vu,mv as er,ce as tr,mw as sr,mx as nr,my as qu,mz as Kt,ec as $u,bM as Ku,bN as Yu,mA as Xu,mB as Qu,hS as Zu,mC as Qn,mD as Ju,mE as ar,mF as ed,mG as td,mH as sd,mI as nd,mJ as ad,mK as or,iM as od,aB as wn,mL as rd,e8 as id,bO as ld,z as cd,mM as ud,mN as dd,mO as md,eX as hd,eY as gd}from"./nms257ef1lzn00g8.js";import{bT as pd,o as rr,bJ as fd,bw as ir,bU as Zn,ag as xd,E as vd,al as Sd,bV as bd,bW as lr,ay as Jn,au as yd,bk as cr,bm as ur,m as wd,bj as jd,bl as Td,a$ as Md,z as Cd,bq as kd,H as _d,bE as Ed,K as Nd}from"./jtfo8pfmx9vwsskh.js";import{B as Rd}from"./dij5mxku3l4y38ds.js";import{m as ne}from"./ewos3yaiq011b9ly.js";import{j as ht,P as Rt,h as Ad,D as Pd,T as jn,M as Id,k as Dd,E as Fd,m as Bd,C as Tn,n as Ld}from"./glw5ca81jajbw24p.js";import{S as dr,a as Hd,b as Od,G as zd,L as Ud,c as Gd}from"./gqybtvzdlsvkl1u2.js";import{C as Wd,f as Vd}from"./egsprt2l7oenz6yb.js";import{p as qd,k as Mn,c as Ea,g as $d,i as Kd,n as Yd}from"./msoqf1xutx22uw1m.js";import{d as Xd}from"./bfujlk3qvckcihxj.js";import{C as Qd}from"./oiu851pf99o91m46.js";const mr=new ht("transactionEventPlugin"),Cn="prosemirrorDispatchTransaction";function Na(t,s){const{eventTarget:n}=mr.getState(t.state);return n.addEventListener(Cn,s),()=>{n.removeEventListener(Cn,s)}}function Zd(t){return new Rt({key:mr,state:{init(){return{eventTarget:t}},apply(s,n){return n}}})}const Rs=new ht("customKeymapPlugin");function Jd(t,s){t.dispatch(t.state.tr.setMeta(Rs,{handlers:s}))}function em(t={handlers:{}}){return new Rt({key:Rs,state:{init(){return{...t}},apply(s,n){const a=s.getMeta(Rs);return a?{...n,...a}:n}},props:{handleKeyDown(s,n){const o=Rs.getState(s.state).handlers[n.key];return o?o(n):!1}}})}const lt=new ht("menuSelectorPlugin");function Tt(t){t.dispatch(t.state.tr.setMeta(lt,{active:!1,onMenuAction:void 0}))}function tm(t,s){t.dispatch(t.state.tr.setMeta(lt,{active:!0,onMenuAction:s}))}function sm(t={submitKeys:["Enter","Tab"],cancelKeys:["Escape"],checkStrictMatchKeys:[]}){return new Rt({key:lt,state:{init(){return{...t,active:!1}},apply(s,n){const a=s.getMeta(lt);return a?{...n,...a}:n}},props:{handleKeyDown(s,n){const a=lt.getState(s.state);return a.active?a.submitKeys.includes(n.key)?(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),a.onMenuAction?.("submit"),Tt(s),!0):a.cancelKeys.includes(n.key)?(n.preventDefault(),a.onMenuAction?.("cancel"),Tt(s),!0):n.key==="ArrowUp"?(n.preventDefault(),a.onMenuAction?.("up"),!0):n.key==="ArrowDown"?(n.preventDefault(),a.onMenuAction?.("down"),!0):(a.checkStrictMatchKeys.includes(n.key)&&a.onMenuAction?.("checkMatch"),!1):!1},handleDOMEvents:{blur:s=>{lt.getState(s.state).onMenuAction?.("cancel")}}}})}const Gt=new ht("placeholderPlugin");function nm(t){return new Rt({key:Gt,state:{init(){return{placeholder:t}},apply(s,n){return s.getMeta(Gt)?{placeholder:s.getMeta(Gt).placeholder}:n}},props:{decorations(s){const{doc:n}=s;if(n.childCount===1&&n.firstChild?.isTextblock&&n.firstChild.content.size===0){const o=[],{placeholder:r}=Gt.getState(s);return s.doc.descendants((i,c)=>{const u=Ad.node(c,c+i.nodeSize,{class:"placeholder","data-placeholder":r});o.push(u)}),Pd.create(n,o)}}}})}const Yt="command_token",am={group:"inline",inline:!0,atom:!0,content:"text*",attrs:{id:"",hint:""},selectable:!1,draggable:!1,toDOM:t=>["span",{"data-mention-id":t.attrs.id,"data-mention-hint":t.attrs.hint,class:"hint-pill"},t.attrs.hint],parseDOM:[{tag:"span[data-mention-id][data-mention-hint]",getAttrs:t=>{const s=t.getAttribute("data-mention-id"),n=t.getAttribute("data-mention-hint");return{id:s,hint:n}}}]};function hr(t,s){if(t.depth===0)return;const n=t.nodeBefore?.text?.match(/(?:^|\s)(\/(\w*))$/);if(n?.[1].length!==void 0){const a=t.pos-n[1].length,o=t.pos,r=a===s?.from;return{range:{from:a,to:o},queryText:n[2],isDismissed:r}}}const Hs=new ht("slashCommandPlugin");function Ks(t,s){return t.setMeta(Hs,s),t}function om(t){const n=t.state.selection.$from,a=hr(n,void 0);t.dispatch(Ks(t.state.tr,{...Xt(),dismissedRange:a?.range}))}function Xt(){return{queryText:"",active:!1,range:void 0,dismissedRange:void 0}}function rm(t,s,n={from:1,to:1},a,o,r){const i=t.state.tr;if(Ks(i,Xt()),s.id===qs.Search&&o)i.delete(n.from,n.to),r(!0);else{const c=s.hint+(a?" ":""),u=t.state.schema.nodes[Yt].create({id:s.id,hint:c},t.state.schema.text(c));i.replaceWith(n.from,n.to,u),i.doc.descendants((m,d)=>{m.type.name===Yt&&m!==u&&(n.from===1&&d===n.from+u.nodeSize||d===1&&n.from===d+m.nodeSize?i.delete(d,d+m.nodeSize):i.insertText(m.textContent,d,d+m.nodeSize))})}t.dispatch(i)}function Ra(t){const{active:s,range:n,queryText:a,onHintMatch:o}=t;if(o)return o(s?{text:a,range:n}:void 0)}function im(t){const s=[];return t.descendants(n=>{n.type.name===Yt&&typeof n.attrs?.id=="string"&&s.push(n.attrs.id)}),s}function lm(t){const s=t.state.tr;s.doc.descendants((n,a)=>{n.type.name===Yt&&s.insertText(n.textContent,a,a+n.nodeSize)}),s.steps.length>0&&t.dispatch(s)}function cm(t){const{active:s,queryText:n}=Hs.getState(t.state);t.dispatch(Ks(t.state.tr,{...Xt(),active:!s||n!==""}))}function um(){return new Rt({key:Hs,state:{init(){return Xt()},apply(t,s,n,a){const o=t.getMeta(Hs),r={...Xt(),...s,...o},i=t.selection;if(i.from!==i.to||a.doc.eq(n.doc))return Ra(r),r;const c=i.$from,u=hr(c,s.dismissedRange);return r.active=!!u&&!u.isDismissed,u&&(r.queryText=u.queryText,r.range=u.range,u.isDismissed&&(u.queryText===""&&s.queryText!==""?r.dismissedRange=void 0:r.dismissedRange=u.range)),Ra(r),r}}})}class as extends Ki{constructor(s){super(),this.view=s}get document(){return this.view.dom.ownerDocument}isEmpty(){return this.view.state.doc.textContent.trim().length===0}trimLeadingText(s){const a=this.view.state.tr;let o=!1,r=!1;return a.doc.descendants((i,c)=>{o||!i.isText||(o=!0,i.text?.startsWith(s)&&(r=!0,a.insertText(i.text.replace(s,""),c,c+i.text.length)))}),r&&this.view.dispatch(a),r}replaceAll(s,n){const o=this.view.state.tr,r=[];o.doc.descendants((i,c)=>{!i.isText||i.text===void 0||r.push({node:i,pos:c})}),r.reverse(),r.forEach(({node:i,pos:c})=>{!i.isText||i.text===void 0||i.text.includes(s)&&o.insertText(i.text.replaceAll(s,n),c,c+i.text.length)}),this.view.dispatch(o)}appendText(s){this.view.dispatch(this.view.state.tr.insertText(s))}focus(){this.view.focus(),this.view.dispatch(this.view.state.tr.setSelection(jn.atEnd(this.view.state.doc)).scrollIntoView())}setText(s){const{tr:n,schema:a}=this.view.state,o=s?a.nodes.paragraph.create(null,a.text(s)):a.nodes.paragraph.create();this.view.dispatch(n.replaceWith(0,this.view.state.doc.content.size,o)),this.view.hasFocus()&&this.view.dispatch(this.view.state.tr.setSelection(jn.atEnd(this.view.state.doc)))}getCurrentText(){return this.view.state.doc.textContent}hasMultipleLines(){let s=0;return this.view.state.doc.descendants(n=>{n.isBlock&&s++}),s>1}getContentToSend(){return qd(this.view)}resize(){}isReady(){return!!this.view.state.doc}setPlaceholder(s){this.view.dispatch(this.view.state.tr.setMeta(Gt,{placeholder:s}))}getSelectionStart(){return this.view.state.selection.ranges[0].$from.pos}isMenuSelectorActive(){return lt.getState(this.view.state).active}registerKeyHandlers(s){Jd(this.view,s)}acceptLegacyKeydown(){return!1}subscribe(s,n){if(s==="change"){const a=()=>n(void 0);return Na(this.view,a)}return this.view.dom?.addEventListener(s,n,{capture:!0}),()=>{this.view.dom?.removeEventListener(s,n,{capture:!0})}}useState(s){return l.useSyncExternalStore(n=>Na(this.view,n),()=>s(this),()=>s(this))}getSystemHintsFromDoc(){return im(this.view.state.tr.doc)}getSystemHints(){const s=this.getSystemHintsFromDoc();return s.length?[s[0]]:[]}replaceSlashCommandTokensWithText(){lm(this.view)}canShowAutocompletion(){return!this.isMenuSelectorActive()&&!this.getSystemHintsFromDoc().length}}const Aa=ye.div`m-8 flex flex-col items-center`;function Pa(t){return e.jsx(ne.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...t})}function dm({clientThreadId:t}){const n=ei(t)?.gizmoId,{data:a}=ss(n);return n==null||a==null||!Yi(a)?null:e.jsx(mm,{gizmoId:n})}function mm({gizmoId:t}){const[s,n]=l.useState(!1),[a,o]=l.useState(!1),r=Xi(t),i=async u=>{n(!0),setTimeout(()=>{o(!0)},5e3),J.logEvent(Z.submitInlineRating,{gizmo_id:t,rating:u}),await r.mutateAsync({rating:u})},c=async()=>{o(!0),J.logEvent(Z.dismissInlineRating,{gizmo_id:t}),await r.mutateAsync({})};return l.useEffect(()=>{a||J.logEvent(Z.showInlineRating,{gizmo_id:t})},[a,t]),a?null:s?e.jsx(Aa,{children:e.jsxs(Pa,{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"rounded-lg border border-token-border-heavy p-4",children:e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(B,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),e.jsx(fa,{onClick:()=>{o(!0)}})]})}),e.jsx("div",{className:"text-xs text-token-text-tertiary",children:e.jsx(B,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):e.jsx(Aa,{children:e.jsxs(Pa,{className:"flex flex-col items-center gap-4 rounded-lg border border-token-border-heavy p-4",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(B,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),e.jsx(fa,{onClick:c})]}),e.jsx(Qi,{rating:void 0,onRating:i})]})})}const hm=({clientThreadId:t})=>{const s=ao(),n=Os(t),a=ut(n);l.useEffect(()=>{a&&xa.dismissBanner()},[a]);const o=s?.is_dismissible?()=>xa.dismissBanner():void 0;return e.jsx(ns,{children:s&&e.jsx(ne.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(Zi,{clientThreadId:t,rateLimitInfo:s,onDismiss:o})})})};function gm(t){const s=Os(t),n=ut(s),a=ao();return!n&&a!=null}const kn=window.sessionStorage,_n=ti(si(()=>({memoryFullBannerDismissed:!!kn?.getItem(mn.MemoryFullBannerDismissed)}))),gr={dismissBanner(){_n.setState(t=>{t.memoryFullBannerDismissed=!0}),kn?.setItem(mn.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){_n.setState(t=>{t.memoryFullBannerDismissed=!1}),kn?.removeItem(mn.MemoryFullBannerDismissed)}};function pm(t){const s=He(t),n=jo(),{data:a}=To(s,!1,n),o=a!=null,r=o&&a.memoryFullPct>=100,[i,c]=l.useState(!1);l.useEffect(()=>{!r&&o&&(c(!0),gr.clearDismissedBanner())},[r,o]);const u=_n(m=>m.memoryFullBannerDismissed);return r&&i&&!u}function fm(){const t=Oe(),{openSettings:s}=Ji();return e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(el,{title:t.formatMessage(Ms.memoryFullTitle),content:t.formatMessage(Ms.memoryFullTooltip,Ms.memoryFullTooltip.values),primaryCtaText:t.formatMessage(Ms.memoryManageButton),onPrimaryCtaClick:()=>s(tl.Personalization),onDismiss:()=>gr.dismissBanner()})})}const Ms=ze({memoryFullTitle:{id:"yRGU2/",defaultMessage:"Memory is full."},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"neUc+N",defaultMessage:"New memories won’t be created until you make space. <a>Learn more</a>",values:{a:t=>e.jsx("a",{href:sl,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}}}),xm=l.memo(function(s){return vm(s),Sm(s),bm(),null});function vm(t){const{store:s}=we(),n=s.useSetSharedProps();hn(()=>{n(t)},[t,n])}function Sm(t){const{clientThreadId:s,canContinue:n}=t,{store:a}=we(),o=l.useRef({top:a.useContentAreaApi(_t.HeaderTop),bottom:a.useContentAreaApi(_t.HeaderBottom)}).current,r=jm(t),i=nl(s),{shouldShowBannerSignup:c,shouldShowBannerTermsDisclaimer:u}=Tm(s),m=gm(s),d=al(t),g=ol(t),p=rl(t),f=pm(s),x=il(),h=ll(t);hn(()=>{h.eligible?o.top.set(se.AdvancedVoiceOnMobileAnnouncement):x?o.top.set(se.ParagenControls):u?o.top.set(se.BannerTermsDisclaimer):m?o.top.set(se.BannersRateLimit):d.eligible?o.top.set(se.BannerSidekickAnnouncement):g?o.top.set(se.SearchBrowserExtensionAnnouncement):p?o.top.set(se.SearchBrowserExtensionReactiveAnnouncement):r?o.top.set(se.ItemActions):n?o.top.set(se.PromptTextareaAction):c?o.top.set(se.BannerSignup):f?o.top.set(se.BannerMemoryFull):o.top.set(null)},[o,r,n,u,c,m,d,f,x,h]),hn(()=>{i&&o.bottom.set(Mo.DallePromptControls)},[o,i])}function bm(){const{store:t}=we();l.useEffect(()=>()=>{t.reset()},[t])}function ym(t){const s=Co(),n=Je(t),a=Q.getTree(t).getLastValidNode(n)?.message?.id;return s?.messageId===a?s.suggestions:[]}function wm(t){return ym(t).length>0}function jm(t){const s=cl(t.clientThreadId),n=wm(t.clientThreadId);return t.isDisabled?!1:t.isNewThread||s||n}function Tm(t){const{isUnauthenticated:s}=Ge(),n=Je(t),{layer:a}=Mt("3637408529"),o=a.get("should_show_no_auth_signup_banner",!0),r=ul(p=>p.bannerDisclaimerClientThreadId),i=dl(),c={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1};if(!t)return c;const u=Q.getTree(t),m=u.countMessagesByAuthor(Le.User),d=u.getNodeByIdOrMessageId(n),g=d?.message?.author.role===Le.Assistant&&ni(d.message);return c.shouldShowBannerTermsDisclaimer=g&&s&&m===1&&!i&&(r==null||r===t),c.shouldShowBannerSignup=o&&g&&s&&m>0&&m%5===0,c}function Mm({children:t,className:s,showBackground:n}){return e.jsxs("div",{className:"relative",children:[t,n&&e.jsx(ne.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:R("pointer-events-none absolute bottom-0 top-0 h-8 w-8 rounded-full",s)})]})}function Cm({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:a,attachmentsProductFeature:o,getInputProps:r,openFileDialog:i,onOauthRedirect:c,historyDisabled:u,isDisabled:m,highlightTooltip:d}){const g=ml(),{gdriveStatus:p,o365Status:f}=hl(),x=e.jsx(pd,{className:u?"text-white":d?"text-brand-blue-800":void 0}),h=p!=="false"||f!=="false"||g;return e.jsx("div",{className:"relative",children:e.jsx(Mm,{showBackground:d,className:"bg-brand-blue-800/20",children:h?e.jsx(gl,{clientThreadId:t,icon:x,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:a,attachmentsProductFeature:o,onOauthRedirect:c,uploadType:s,openFileDialog:i,getInputProps:r,isDisabled:m,highlightTooltip:d}):e.jsx(pl,{clientThreadId:t,uploadType:s,openFileDialog:i,getInputProps:r,icon:x,isDisabled:m,highlightTooltip:d})})})}const km=500;class Ie{constructor(s,n){this.items=s,this.eventCount=n}popEvent(s,n){if(this.eventCount==0)return null;let a=this.items.length;for(;;a--)if(this.items.get(a-1).selection){--a;break}let o,r;n&&(o=this.remapping(a,this.items.length),r=o.maps.length);let i=s.tr,c,u,m=[],d=[];return this.items.forEach((g,p)=>{if(!g.step){o||(o=this.remapping(a,p+1),r=o.maps.length),r--,d.push(g);return}if(o){d.push(new Be(g.map));let f=g.step.map(o.slice(r)),x;f&&i.maybeStep(f).doc&&(x=i.mapping.maps[i.mapping.maps.length-1],m.push(new Be(x,void 0,void 0,m.length+d.length))),r--,x&&o.appendMap(x,r)}else i.maybeStep(g.step);if(g.selection)return c=o?g.selection.map(o.slice(r)):g.selection,u=new Ie(this.items.slice(0,a).append(d.reverse().concat(m)),this.eventCount-1),!1},this.items.length,0),{remaining:u,transform:i,selection:c}}addTransform(s,n,a,o){let r=[],i=this.eventCount,c=this.items,u=!o&&c.length?c.get(c.length-1):null;for(let d=0;d<s.steps.length;d++){let g=s.steps[d].invert(s.docs[d]),p=new Be(s.mapping.maps[d],g,n),f;(f=u&&u.merge(p))&&(p=f,d?r.pop():c=c.slice(0,c.length-1)),r.push(p),n&&(i++,n=void 0),o||(u=p)}let m=i-a.depth;return m>Em&&(c=_m(c,m),i-=m),new Ie(c.append(r),i)}remapping(s,n){let a=new Id;return this.items.forEach((o,r)=>{let i=o.mirrorOffset!=null&&r-o.mirrorOffset>=s?a.maps.length-o.mirrorOffset:void 0;a.appendMap(o.map,i)},s,n),a}addMaps(s){return this.eventCount==0?this:new Ie(this.items.append(s.map(n=>new Be(n))),this.eventCount)}rebased(s,n){if(!this.eventCount)return this;let a=[],o=Math.max(0,this.items.length-n),r=s.mapping,i=s.steps.length,c=this.eventCount;this.items.forEach(p=>{p.selection&&c--},o);let u=n;this.items.forEach(p=>{let f=r.getMirror(--u);if(f==null)return;i=Math.min(i,f);let x=r.maps[f];if(p.step){let h=s.steps[f].invert(s.docs[f]),b=p.selection&&p.selection.map(r.slice(u+1,f));b&&c++,a.push(new Be(x,h,b))}else a.push(new Be(x))},o);let m=[];for(let p=n;p<i;p++)m.push(new Be(r.maps[p]));let d=this.items.slice(0,o).append(m).append(a),g=new Ie(d,c);return g.emptyItemCount()>km&&(g=g.compress(this.items.length-a.length)),g}emptyItemCount(){let s=0;return this.items.forEach(n=>{n.step||s++}),s}compress(s=this.items.length){let n=this.remapping(0,s),a=n.maps.length,o=[],r=0;return this.items.forEach((i,c)=>{if(c>=s)o.push(i),i.selection&&r++;else if(i.step){let u=i.step.map(n.slice(a)),m=u&&u.getMap();if(a--,m&&n.appendMap(m,a),u){let d=i.selection&&i.selection.map(n.slice(a));d&&r++;let g=new Be(m.invert(),u,d),p,f=o.length-1;(p=o.length&&o[f].merge(g))?o[f]=p:o.push(g)}}else i.map&&a--},this.items.length,0),new Ie(ko.from(o.reverse()),r)}}Ie.empty=new Ie(ko.empty,0);function _m(t,s){let n;return t.forEach((a,o)=>{if(a.selection&&s--==0)return n=o,!1}),t.slice(n)}class Be{constructor(s,n,a,o){this.map=s,this.step=n,this.selection=a,this.mirrorOffset=o}merge(s){if(this.step&&s.step&&!s.selection){let n=s.step.merge(this.step);if(n)return new Be(n.getMap().invert(),n,this.selection)}}}class Ye{constructor(s,n,a,o,r){this.done=s,this.undone=n,this.prevRanges=a,this.prevTime=o,this.prevComposition=r}}const Em=20;function Nm(t,s,n,a){let o=n.getMeta(ct),r;if(o)return o.historyState;n.getMeta(Pm)&&(t=new Ye(t.done,t.undone,null,0,-1));let i=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(i&&i.getMeta(ct))return i.getMeta(ct).redo?new Ye(t.done.addTransform(n,void 0,a,As(s)),t.undone,Ia(n.mapping.maps),t.prevTime,t.prevComposition):new Ye(t.done,t.undone.addTransform(n,void 0,a,As(s)),null,t.prevTime,t.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(i&&i.getMeta("addToHistory")===!1)){let c=n.getMeta("composition"),u=t.prevTime==0||!i&&t.prevComposition!=c&&(t.prevTime<(n.time||0)-a.newGroupDelay||!Rm(n,t.prevRanges)),m=i?on(t.prevRanges,n.mapping):Ia(n.mapping.maps);return new Ye(t.done.addTransform(n,u?s.selection.getBookmark():void 0,a,As(s)),Ie.empty,m,n.time,c??t.prevComposition)}else return(r=n.getMeta("rebased"))?new Ye(t.done.rebased(n,r),t.undone.rebased(n,r),on(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new Ye(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),on(t.prevRanges,n.mapping),t.prevTime,t.prevComposition)}function Rm(t,s){if(!s)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((a,o)=>{for(let r=0;r<s.length;r+=2)a<=s[r+1]&&o>=s[r]&&(n=!0)}),n}function Ia(t){let s=[];for(let n=t.length-1;n>=0&&s.length==0;n--)t[n].forEach((a,o,r,i)=>s.push(r,i));return s}function on(t,s){if(!t)return null;let n=[];for(let a=0;a<t.length;a+=2){let o=s.map(t[a],1),r=s.map(t[a+1],-1);o<=r&&n.push(o,r)}return n}function Am(t,s,n){let a=As(s),o=ct.get(s).spec.config,r=(n?t.undone:t.done).popEvent(s,a);if(!r)return null;let i=r.selection.resolve(r.transform.doc),c=(n?t.done:t.undone).addTransform(r.transform,s.selection.getBookmark(),o,a),u=new Ye(n?c:r.remaining,n?r.remaining:c,null,0,-1);return r.transform.setSelection(i).setMeta(ct,{redo:n,historyState:u})}let rn=!1,Da=null;function As(t){let s=t.plugins;if(Da!=s){rn=!1,Da=s;for(let n=0;n<s.length;n++)if(s[n].spec.historyPreserveItems){rn=!0;break}}return rn}const ct=new ht("history"),Pm=new ht("closeHistory");function Im(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new Rt({key:ct,state:{init(){return new Ye(Ie.empty,Ie.empty,null,0,-1)},apply(s,n,a){return Nm(n,a,s,t)}},config:t,props:{handleDOMEvents:{beforeinput(s,n){let a=n.inputType,o=a=="historyUndo"?fr:a=="historyRedo"?En:null;return o?(n.preventDefault(),o(s.state,s.dispatch)):!1}}}})}function pr(t,s){return(n,a)=>{let o=ct.getState(n);if(!o||(t?o.undone:o.done).eventCount==0)return!1;if(a){let r=Am(o,n,t);r&&a(s?r.scrollIntoView():r)}return!0}}const fr=pr(!1,!0),En=pr(!0,!0);function Dm(){return Mn({"Shift-Enter":(t,s)=>Ea(t,s),Enter:(t,s)=>window.innerWidth>fl[xl.Medium]||oo?!1:Ea(t,s)})}const Fm=["p",0],Bm=["br"],Lm=new Dd({nodes:{paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p",preserveWhitespace:"full"}],toDOM(){return Fm}},text:{group:"inline"},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM(){return Bm}},[Yt]:am,doc:{content:"block+"}},marks:{}});function Hm(){const t=new EventTarget,s=new Fd(null,{state:Bd.create({schema:Lm,plugins:[Im(),sm({submitKeys:["Enter","Tab"],cancelKeys:["Escape"],checkStrictMatchKeys:[" "]}),nm(""),um(),Dm(),Mn({"Mod-z":fr,"Mod-y":En,"Mod-Shift-z":En}),em(),Mn(Xd),Zd(t),$d()]}),dispatchTransaction(n){const a=s.state.apply(n);s.updateState(a),n.docChanged&&t.dispatchEvent(new Event(Cn))},handlePaste(n,a){const o=a.clipboardData?.getData("text/plain");return o===void 0?!1:(a.defaultPrevented||Kd(n,o),!0)},clipboardTextSerializer(n){return Yd(n.content).content}});return s}function Om(){try{return navigator.userAgent.toLocaleLowerCase().includes("firefox")}catch{return!1}}const zm=[R([vl["prosemirror-parent"],"text-token-text-primary","max-h-[25dvh]","max-h-52","overflow-auto",Om()?"firefox":"default-browser"])],Um=({children:t})=>{const[s]=l.useState(()=>new as(Hm()));return t(s)},Gm=({composerController:t,placeholder:s})=>{const n=l.useContext(ro),a=l.useRef(null),o=l.useRef(null),r=l.useRef(!1);return l.useEffect(()=>{if(r.current)return;if(!(t instanceof as))throw new Error(`Expected instance of ProseMirrorComposerController but got ${t.constructor.name}`);r.current=!0;const i=o.current;if(i!=null){const{value:c,selectionStart:u,selectionEnd:m}=i;t.view.dispatch(t.view.state.tr.insertText(c)),t.view.dispatch(t.view.state.tr.setSelection(jn.create(t.view.state.doc,u+1,m+1))),i.style.display="none",i.value=""}a.current.appendChild(t.view.dom),t.view.dom.id=_o,Sl(t.view.dom),Eo()||t.view.focus()},[t]),l.useEffect(()=>{t.setPlaceholder(s)},[s,t]),l.useEffect(()=>{t.logPageMount()},[]),e.jsxs("div",{ref:a,className:R(zm),children:[e.jsx("textarea",{className:"block h-10 w-full resize-none border-0 bg-transparent px-0 py-2 text-token-text-primary placeholder:text-token-text-secondary",autoFocus:!0,placeholder:s,ref:o}),e.jsx("script",{nonce:n.cspScriptNonce,suppressHydrationWarning:!0,children:"window.__oai_logHTML?window.__oai_logHTML():window.__oai_SSR_HTML=window.__oai_SSR_HTML||Date.now();requestAnimationFrame((function(){window.__oai_logTTI?window.__oai_logTTI():window.__oai_SSR_TTI=window.__oai_SSR_TTI||Date.now()}))"})]})},Wm=l.forwardRef(function({type:s,placeholder:n,replyRegions:a,state:o,renderFiles:r,leftSideActions:i,onSubmit:c,inputState:u,currentLeafId:m,composerController:d,clientThreadId:g,gizmoId:p,disableReason:f},x){const h=et(),b=bl();l.useEffect(()=>{Eo()||d.focus()},[b?.modelId,d]);const S=_=>{Xm({target:_.target,rootId:"composer-background",additonalInteractiveIds:["reply-regions"]})||d.focus()};return e.jsxs("div",{id:"composer-background",ref:x,className:R("flex w-full cursor-text flex-col rounded-3xl px-2.5 py-1 transition-colors contain-inline-size",h&&"backdrop-blur-2xl no-transparency:backdrop-blur-none",h&&s!=="temporary"&&"bg-token-composer-surface",!h&&s!=="temporary"&&"bg-[#f4f4f4] dark:bg-token-main-surface-secondary",s==="temporary"&&"dark bg-black"),onClick:S,children:[e.jsx(ns,{initial:!1,children:a.length>0&&e.jsx(ne.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0,transition:{duration:.06}},transition:{ease:"easeOut",duration:.1},id:"reply-regions",children:e.jsx(qm,{replyRegions:a})})}),e.jsxs(e.Fragment,{children:[r,e.jsx("div",{className:"flex min-h-[44px] items-center px-2",children:e.jsx("div",{className:"max-w-full flex-1",children:d instanceof No?e.jsx(Vm,{composerController:d,currentLeafId:m,placeholder:n,inputState:u}):e.jsx(Gm,{composerController:d,placeholder:n})})}),e.jsxs("div",{className:"flex h-[44px] items-center justify-between",children:[e.jsx("div",{className:"flex gap-x-1",children:i}),e.jsx(yl,{inputState:u,state:o,onSubmit:c,composerController:d,clientThreadId:g,gizmoId:p,disableReason:f})]})]})]})});function Vm({composerController:t,currentLeafId:s,placeholder:n,inputState:a}){const o=l.useContext(ro);return e.jsxs(e.Fragment,{children:[e.jsx(wl,{id:_o,autoFocus:!0,tabIndex:0,"data-id":s,dir:"auto",ref:r=>{if(!(t instanceof No))throw new Error("Expected TextAreaComposerController");r!=null&&(t.textArea=r,t.logPageMount())},rows:1,placeholder:n,disabled:a!=="default",className:R("m-0 resize-none border-0 bg-transparent px-0 text-token-text-primary focus:ring-0 focus-visible:ring-0",a==="disabled"&&"text-center",["max-h-[25dvh]","max-h-52"])}),e.jsx("script",{nonce:o.cspScriptNonce,suppressHydrationWarning:!0,children:"requestAnimationFrame((function(){window.__oai_logTTI?window.__oai_logTTI():window.__oai_SSR_TTI=window.__oai_SSR_TTI??Date.now()}))"})]})}function qm({replyRegions:t}){return e.jsx("div",{className:"flex cursor-auto flex-col divide-y divide-token-border-light overflow-hidden rounded-b-lg rounded-t-[20px] bg-token-main-surface-primary",children:t.map((s,n)=>{switch(s.type){case"text":return e.jsx($m,{value:s.value,onRemoveRegion:s.onRemoveRegion},n);case"object":return e.jsx(Km,{value:s.value,onRemoveRegion:s.onRemoveRegion},n);case"mention":case"system_hint":return e.jsx(Ym,{value:s.value,icon:s.icon,onRemoveRegion:s.onRemoveRegion},n)}})})}function $m({value:t,onRemoveRegion:s}){return e.jsxs(ta,{className:"text-token-text-secondary",children:[e.jsx(sa,{children:e.jsx(rr,{className:"icon-lg-heavy"})}),e.jsx(na,{children:`“${t}”`}),e.jsx(ea,{onClick:s})]})}function Km({value:t,onRemoveRegion:s}){return e.jsxs(ta,{className:"text-blue-selection",children:[e.jsx(sa,{children:e.jsx(rr,{className:"icon-lg-heavy"})}),e.jsx(na,{className:"font-semibold",children:t}),e.jsx(ea,{onClick:s})]})}function Ym({value:t,icon:s,onRemoveRegion:n}){return e.jsxs(ta,{children:[e.jsx(sa,{className:"mt-0",children:s}),e.jsx(na,{className:"font-semibold text-token-text-primary",children:t}),e.jsx(ea,{onClick:n})]})}function ea({onClick:t}){return e.jsx("button",{onClick:t,type:"button",className:"flex-shrink-0 text-token-text-secondary",children:e.jsx(fd,{className:"icon-lg"})})}const ta=ye.div`flex items-start py-2.5 gap-3 pl-3 pr-1.5 text-sm`,sa=ye.span`flex-shrink-0 mt-0.5 w-7 h-6 flex justify-center items-center`,na=ye.span`flex-1 line-clamp-3 py-0.5`;function Xm({target:t,rootId:s,additonalInteractiveIds:n}){let a=t;for(;a&&a!=null;){if(a.tagName==="BUTTON"||a.tagName==="INPUT"||a.tagName==="TEXTAREA"||a.isContentEditable||n.includes(a.id))return!0;if(a.id===s)return!1;a=a.parentElement}return!1}const Cs={initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:.1},exit:{opacity:0,scale:.5,transition:{duration:.2}}},Qm=({suggestions:t,onSelectingSuggestedReply:s})=>e.jsx("div",{className:"absolute bottom-full flex w-full max-w-[100vw] grow gap-2 overflow-auto px-1 pb-1 contain-inline-size sm:mb-0 sm:justify-start sm:px-2 sm:pb-0 md:static md:mb-2 md:max-w-none md:justify-center md:overflow-visible",children:t.slice(0,2).map((n,a)=>e.jsx(ne.div,{initial:Cs.initial,animate:Cs.animate,transition:{delay:(a-1)*Cs.transition.delay},exit:Cs.exit,children:e.jsx(Nt,{as:"button",color:"secondary",size:"small",onClick:()=>{s(n,t,a)},className:"group whitespace-nowrap md:whitespace-normal",children:e.jsx(Jm,{suggestion:n})},a)},a))});function Zm({suggestions:t,onSelectingSuggestedReply:s,clientThreadId:n}){const a=t?.length>0;l.useEffect(()=>{a&&Et(t,n)},[a,n]);const{isUnauthenticated:o}=Ge();return a?t.every(Ro)?e.jsxs(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"flex flex-col items-center",children:[o&&e.jsx(Zt,{className:"mb-6 h-12 w-12 sm:hidden"}),e.jsx(dr,{starterPrompts:t,onSelectStarterPrompt:s})]}):t.every(Ao)?e.jsx(Qm,{suggestions:t,onSelectingSuggestedReply:s}):null:null}function Jm({suggestion:t}){return Ao(t)?e.jsx(e.Fragment,{children:t.text}):Ro(t)?e.jsxs("div",{className:"flex flex-col overflow-hidden",children:[t.title&&e.jsx("div",{className:"truncate font-semibold",children:t.title}),e.jsx("div",{className:R("truncate font-normal",t.title?"opacity-50":""),children:t.body})]}):null}function eh(){const{store:t}=we(),s=t.useSharedProps();return s?e.jsx(th,{...s}):null}function th({clientThreadId:t,suggestions:s}){const n=$s();return s===void 0||s.length===0?null:e.jsx("div",{children:e.jsx(sh,{children:e.jsx("div",{className:"grow",children:s!==void 0&&e.jsx(Zm,{suggestions:s,onSelectingSuggestedReply:n,clientThreadId:t})})})})}const sh=ye.div`h-full flex ml-1 md:w-full md:m-auto gap-0 md:gap-2 justify-center`,xr=({className:t,children:s})=>e.jsx(ne.div,{className:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:s});function nh({currentLeafId:t,canContinue:s,onContinueGenerating:n}){const a=l.useCallback(()=>{const r=new qt;n(t,r),Is()},[n,t]);let o=null;return s&&(o=e.jsx(oh,{onHandleContinueGenerating:a})),o&&e.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:o})}function ah({className:t}){return e.jsx(ir,{className:R("-rotate-180",t)})}const oh=({onHandleContinueGenerating:t})=>e.jsx(xr,{children:e.jsx(Nt,{as:"button",color:"secondary",onClick:t,className:"whitespace-nowrap py-2",icon:ah,size:"small",children:e.jsx(B,{...Fe.continueGenerating})})}),rh=()=>{const{shouldShowSkipButton:t}=Po();return t?e.jsx(xr,{className:"flex justify-center",children:e.jsx(Nt,{as:"button",color:"secondary",onClick:()=>jl.skipParagen(),children:e.jsx(B,{...ih.skip})})}):null},ih=ze({skip:{id:"dvcUbp",defaultMessage:"Skip"}}),vr=l.memo(function({className:s}){const{store:n}=we(),a=n.useIsHeaderContentAreaPopulated();return e.jsx("div",{className:R(s??"absolute bottom-full left-0 right-0",Ds.PromptTextareaHeader),children:e.jsx(Tl,{shouldRender:a,contentArea:_t.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(Sr,{}),e.jsx(br,{})]})})})});function Sr(){const{store:t}=we(),s=t.useSharedProps(o=>o?.clientThreadId),n=t.useContentAreaId(_t.HeaderTop);let a;switch(n){case se.AdvancedVoiceOnMobileAnnouncement:a=e.jsx(_l,{clientThreadId:s});break;case se.ParagenControls:a=e.jsx(rh,{});break;case se.ItemActions:a=e.jsx(eh,{});break;case se.BannerSignup:a=e.jsx(uh,{});break;case se.BannerTermsDisclaimer:a=e.jsx(dh,{});break;case se.PromptTextareaAction:a=e.jsx(mh,{});break;case se.BannersRateLimit:a=e.jsx(hh,{});break;case se.BannerSidekickAnnouncement:a=e.jsx(kl,{});break;case se.SearchBrowserExtensionAnnouncement:a=e.jsx(Cl,{});break;case se.SearchBrowserExtensionReactiveAnnouncement:a=e.jsx(Ml,{});break;case se.BannerMemoryFull:a=e.jsx(fm,{});break;case se.Box:a=e.jsxs("div",{className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;default:a=null;break}return a}function br(){const{store:t}=we(),s=t.useContentAreaId(_t.HeaderBottom);let n;switch(s){case Mo.DallePromptControls:n=e.jsx(ch,{});break;default:n=null;break}return n}const lh=We(()=>Ve(()=>import("./l5vapcr3q8d1v8ja.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.default));function ch(){const{store:t}=we(),s=t.useSharedProps(n=>n?.composerController);return s?e.jsx(lh,{composerController:s}):null}function uh(){const{store:t}=we(),s=t.useSharedProps(o=>o?.clientThreadId),n=El(),a=Nl();return s?n?e.jsx(Rl,{threadId:s,showSignUp:a}):e.jsx(Al,{threadId:s,showLogin:a}):null}function dh(){const{store:t}=we(),s=t.useSharedProps(n=>n?.clientThreadId);return s?e.jsx(Pl,{threadId:s}):null}function mh(){const{store:t}=we(),s=t.useSharedProps();return s?e.jsx(nh,{...s}):null}function hh(){const{store:t}=we(),s=t.useSharedProps(n=>n?.clientThreadId);return s?e.jsx(hm,{clientThreadId:s}):null}function gh({composerController:t,isDisabled:s,highlightTooltip:n,clientThreadId:a}){const{setThreadSearchMode:o}=Bn(),r=Ln(),i=Il(),[c,u]=l.useState(!1),m=Oe(),d={clientThreadId:a};return e.jsx(fh,{highlightTooltip:n,analyticsMetadata:d,isThreadUsingSearchMode:r,isDisabled:s,children:e.jsxs("button",{className:R("flex h-8 min-w-8 items-center justify-center rounded-lg p-1 text-xs font-semibold",c&&"transition-all duration-150",r||n?"!rounded-2xl bg-blue-250 text-blue-1000 hover:bg-[#BDDCF4] dark:bg-[#2A4A6D] dark:text-[#48AAFF] dark:hover:bg-[#1A416A]":s?"opacity-30":"hover:bg-black/10 focus-visible:outline-black dark:focus-visible:outline-white"),"aria-pressed":r,"aria-label":m.formatMessage({id:"Sl1VH/",defaultMessage:"Search the web"}),disabled:s,onTransitionEnd:()=>u(!1),onClick:g=>{g.stopPropagation(),g.preventDefault(),u(!0),J.logEventWithStatsig(Z.composerSearchButtonClicked,"composer_search_button_clicked",d),o(!r,d,Rn.CONVERSATION_COMPOSER_WEB_ICON),/^search\s?$/i.test(t.getCurrentText())&&t.setText(""),t.replaceSlashCommandTokensWithText(),t.focus()},children:[e.jsx(Zn,{}),e.jsx(ns,{children:r&&e.jsx(ne.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:i?0:.15},children:e.jsx("div",{className:"whitespace-nowrap pl-1 pr-2",children:e.jsx(B,{id:"TbHx8d",defaultMessage:"Search"})})})})]})})}function ph(){const t=Hn(mt.hasSeenComposerSearchButtonTooltip);return!t.isLoading&&t.eligible}function fh({children:t,highlightTooltip:s,analyticsMetadata:n,isThreadUsingSearchMode:a,isDisabled:o}){const r=ph()&&!a,i=Hn(mt.hasSeenComposerSearchButtonTooltip);return r?e.jsx(On,{announcementKey:mt.hasSeenComposerSearchButtonTooltip,side:"right",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(B,{id:"Yjduqi",defaultMessage:"Search the web"}),onDismiss:i.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(B,{id:"W51Aei",defaultMessage:"Get fast answers with trusted sources. {learnMore}",values:{learnMore:e.jsx(Dl,{href:"https://openai.com/index/introducing-chatgpt-search",className:"underline",children:e.jsx(B,{id:"stA7F4",defaultMessage:"Learn more"})})}}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx(Jt,{sideOffset:0,label:o?e.jsx(B,{id:"GpDAWD",defaultMessage:"Search is unavailable"}):e.jsx(B,{id:"c+4o2s",defaultMessage:"Search the web"}),side:"right",open:s||(a?!1:void 0),onOpenChange:c=>{c&&J.logEventWithStatsig(Z.composerSearchButtonHovered,"composer_search_button_hovered",n)},children:t})})}function xh({composerController:t,clientThreadId:s}){const n=es(s),{setThreadSearchMode:a}=Bn(),r=Io().size>0,i=Do(s,io.Search),c=Fo(s),[u,m]=l.useState([]),[d,g]=l.useState(void 0),[p,f]=l.useState(0);l.useEffect(()=>{m(d?c.filter(j=>j.name.toLocaleLowerCase().startsWith(d.text.toLocaleLowerCase())||j.systemHint.toLocaleLowerCase().startsWith(d.text.toLocaleLowerCase())):[])},[d]),l.useEffect(()=>{const j=E=>{g(N=>ri(N,E)?N:E)};t.view.dispatch(Ks(t.view.state.tr,{onHintMatch:j}))},[t]);const x=r||!c.length||!u.length||!d;l.useEffect(()=>{x&&f(0)},[x]);const h=u.length,b=l.useCallback(j=>{f(E=>(j(E)%h+h)%h)},[h]),S=u[p],_=({hintToSave:j=S,expectPerfectMatch:E,appendSpace:N=!0})=>{if(!d||!S||E&&j.name.toLowerCase()!==d.text.toLowerCase())return;J.logEvent(Z.systemHintSelected,{system_hint:j.systemHint,conversation_id:n??va});const I=d.text+j.name.slice(d.text.length),L={clientThreadId:s};rm(t.view,{id:j.systemHint,hint:I},d.range,N,i,F=>a(F,L,Rn.CONVERSATION_COMPOSER_SLASH_SEARCH)),Tt(t.view)},w=l.useRef(_);w.current=_;const v=l.useRef(b);v.current=b;const C=l.useRef(d);C.current=d;const A=t.view;return l.useEffect(()=>(x||tm(A,j=>{j==="up"?v.current(E=>E-1):j==="down"?v.current(E=>E+1):j==="cancel"?(Tt(A),om(A)):j==="submit"?(w.current({expectPerfectMatch:!1}),Tt(A)):j==="checkMatch"&&w.current({expectPerfectMatch:!0,appendSpace:!1})}),()=>Tt(A)),[x,A]),l.useEffect(()=>{x||J.logEvent(Z.systemHintListOpened,{conversation_id:n??va})},[x]),x?null:e.jsx(ai,{className:"max-w-60",onMouseDown:j=>{j.preventDefault()},children:u.map((j,E)=>e.jsx("div",{onMouseOver:()=>f(E),onClick:()=>{_({hintToSave:j,expectPerfectMatch:!1}),t.focus()},children:e.jsx(oi,{autoFocus:!1,className:"group rounded-lg px-1 py-2 hover:bg-token-hint-text",$spoofHovered:E===p,children:e.jsx(vh,{title:j.name,description:j.description,icon:e.jsx(Fl,{svgString:j.logo,className:"icon-lg text-token-text-secondary group-hover:text-white"}),checked:!1})})},j.systemHint))})}function vh({title:t,description:s,icon:n,checked:a}){return e.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-1.5 pl-1.5 pr-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:n}),e.jsxs("div",{className:"shrink grow basis-0",children:[e.jsx("p",{className:"text-sm font-normal leading-tight text-token-text-primary group-hover:text-white",children:t}),!!s&&e.jsx("p",{className:"text-[13px] font-normal leading-[18px] text-token-text-secondary group-hover:text-white",children:s})]}),a&&e.jsx(xd,{className:R("icon-md text-token-text-primary",{"group-hover:hidden":!a})})]})}function Sh({composerController:t,clientThreadId:s}){return t instanceof as?e.jsx(xh,{composerController:t,clientThreadId:s}):null}function bh({suggestions:t,composerController:s,onSelect:n,onChange:a}){const o=$s(),r=l.useCallback((d,g,p)=>{n?.(d,g,p),o(d,g,p)},[n,o]),[i,c]=l.useState(-1),[u,m]=l.useState(!1);return l.useEffect(()=>{const d=g=>{if(g.key==="ArrowDown"){const p=i===t.length-1?0:i+1;c(p),a?.(p,!0,t[p])}else if(g.key==="ArrowUp"){g.preventDefault();const p=i<=0?t.length-1:i-1;c(p),a?.(p,!0,t[p])}else g.key==="Enter"&&!g.shiftKey&&t[i]&&r(t[i],t,i)};return s.subscribe("keydown",d)},[t,i,a,r,s]),l.useEffect(()=>s.subscribe("blur",()=>{c(-1),a?.(-1,!1)}),[s,a]),l.useEffect(()=>{if(!u){const d=()=>{m(!0),window.removeEventListener("mousemove",d)};return window.addEventListener("mousemove",d),()=>{window.removeEventListener("mousemove",d)}}},[u]),l.useEffect(()=>{c(-1),a?.(-1,!1),m(!1)},[t,a]),e.jsx(ne.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"hidden w-full flex-col p-2.5 group-focus-within:flex group-focus-within:max-lg:flex-col-reverse",children:t.map((d,g)=>e.jsxs(ne.li,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:g*.03},exit:{opacity:0,translateY:4},className:"w-full",children:[g>0&&e.jsx("div",{className:R("h-[1px] opacity-60 max-lg:hidden",i===g||i===g-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")}),e.jsxs("button",{className:R("flex w-full cursor-pointer items-center justify-start whitespace-pre-wrap rounded-lg px-2.5 py-3 text-start",i===g?"bg-token-main-surface-secondary":"bg-token-main-surface-primary"),onClick:p=>{p.preventDefault(),r(d,t,g)},onMouseDown:p=>{p.preventDefault()},onMouseEnter:()=>{u&&(c(g),a?.(g,!1,d))},onMouseLeave:()=>{c(-1),a?.(-1,!1,d)},children:[d.icon?e.jsx("span",{className:"mr-4 h-6 w-6 text-token-text-secondary",children:d.icon}):null,e.jsx("span",{className:"whitespace-pre-wrap",children:d.autocompletionChunks&&d.autocompletionChunks.length>0?e.jsx(e.Fragment,{children:d.autocompletionChunks.map((p,f)=>e.jsx("span",{className:R(p.isMatched?"text-token-text-tertiary":"text-token-text-primary"),children:p.text},f))}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:R(d.type===Fs.Starter?"text-token-text-secondary":"text-token-text-tertiary"),children:d.title}),e.jsx("span",{className:"text-token-text-primary",children:d.body})]})})]}),g>0&&e.jsx("div",{className:R("h-[1px] opacity-60 lg:hidden",i===g||i===g-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")})]},d.id??g))})}function yh(t,s){t=t.toLocaleLowerCase();const n=s;s=s.toLocaleLowerCase();const a=[];let o=0;for(let c=0;c<s.length&&(o<t.length&&t[o]===s[c]&&(a.push(c),o++),o!==t.length);c++);const r=[];let i=0;if(a.forEach(c=>{if(c>i){const u=n.slice(i,c);u&&r.push({text:u,isMatched:!1})}r.push({text:n[c],isMatched:!0}),i=c+1}),i<s.length){const c=n.slice(i);c&&r.push({text:c,isMatched:!1})}return wh(r)}function wh(t){if(t.length===0)return t;let s=[t[0]];for(let a=1;a<t.length;a++){const o=s[s.length-1],r=t[a];o.isMatched===r.isMatched?o.text+=r.text:s.push(r)}const n=s.filter(a=>a.isMatched).reduce((a,o)=>a+o.text.trim().length,0);return s.length<=4&&n>=2?s:[{text:s.map(a=>a.text).join(""),isMatched:!1}]}function jh({composerController:t,isDisabled:s,clientThreadId:n}){const a=Oe(),o=Hn(mt.hasSeenComposerSystemHintButtonTooltip),i=Fo(n).length>0,u=Io().size>0,m=s===!0||!i||u;if(!(t instanceof as))return null;const d=t,g={clientThreadId:n};function p(){J.logEventWithStatsig(Z.composerSearchButtonClicked,"composer_system_hint_button_clicked",g),o.markAsViewed(),d.focus(),cm(d.view)}const f=e.jsx("button",{className:R("flex h-8 min-w-8 items-center justify-center rounded-lg p-1 text-xs font-semibold",m?"opacity-30":"hover:bg-black/10 focus-visible:outline-black dark:focus-visible:outline-white"),"aria-label":a.formatMessage({id:"oDAnGy",defaultMessage:"Use a tool"}),disabled:m,onPointerDown:p,onMouseDown:x=>{x.preventDefault()},onClick:x=>{x.preventDefault(),x.detail===0&&p()},children:e.jsx(vd,{})});return!o.isLoading&&o.eligible?e.jsx(On,{announcementKey:mt.hasSeenComposerSystemHintButtonTooltip,show:!0,side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(B,{id:"tTydhk",defaultMessage:"All your tools, in one handy place"}),onDismiss:o.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(B,{id:"S+BFNe",defaultMessage:"Create a canvas, generate a picture, and more."}),children:f}):e.jsx(Jt,{side:"right",sideOffset:0,label:s?e.jsx(B,{id:"uw9x80",defaultMessage:"Tools unavailable"}):e.jsx(B,{id:"mrYNGk",defaultMessage:"View tools"}),onOpenChange:x=>{x&&J.logEventWithStatsig(Z.composerSearchButtonHovered,"composer_system_hint_button_hovered",g)},children:f})}const Th=1,Mh=3e3;function Ch({files:t,className:s,composerController:n}){const a=zo(),o=Bo(),r=fc();return e.jsxs("div",{className:s,children:[r.map(i=>{const{tempId:c,content:u}=i;return e.jsx(xc,{pastedTextdoc:i,textdocId:c,onClickSwitchToInline:()=>{n.appendText(u),n.focus(),Oo.removePastedContent(c)}},c)}),t.map(i=>e.jsx(vc,{borderRadius:"2xl",useV2Style:!0,width:a?"normal":"wide",onRemoveFileClick:()=>fn.remove(o,i.tempId,"none"),file:i.file,fileId:i.fileId??void 0,contextConnectorInfo:i.contextConnectorInfo,loadingPercentage:i.status===Sc.Uploading?i.progress:void 0},i.tempId))]})}function kh({onAbortCompletion:t,onCreateNewCompletion:s,onContinueGenerating:n,currentModelId:a,clientThreadId:o,isNewThread:r,isCompletionInProgress:i,className:c,disabled:u=!1,disabledReason:m,canPause:d=!1,canContinue:g=!1,suggestions:p,isInteractableSharedThread:f,composerContainerRef:x,composerController:h,autocompletions:b,requiresFileUpload:S,onComposerInput:_,onComposerChange:w,onAutocompleteSelect:v,headerClassName:C,hideHeader:A,setComposerBarElement:j,onTaggingDropdownOpen:E,onTaggingDropdownClose:N}){const I=zn(),L=zs(),{isUnauthenticated:F}=Ge(),T=Oe(),P=lo(),U=Bo(),k=Je(o),G=Os(o),[y]=ii(),q=li(),{gizmoEditorData:Y,mode:ee,getGizmoId:V}=Bl(),xe=co(),le=Ll(),X=ts(),ge=Lo(),oe=es(o),Te=!!ci(),ve=!!An(),[Me,Ce]=l.useState({}),{setThreadSearchMode:ke,clearSearchModeTrigger:Se,getSearchModeTrigger:De}=Bn(),ce=Ln(),[O,D]=l.useState(!1),[te,W]=l.useState(!1),H=et(),K=l.useRef(!1),pe=Un(),ae=a!==null?pe[a]:void 0,_e=ui(o);let $=Gn(o),ue=$&&"gizmo"in $?$.gizmo:void 0;const Ue=!1,[re,Ae]=l.useState(null);re!==null&&($={gizmo:re,gizmo_id:re.gizmo.id,kind:dt.GizmoInteraction},ue=re);const de=wa(ae,$);let os=!1;Hl($)&&ue?.gizmo.id===Ol&&(os=!0);const Ys=di(),gt=!u&&!os&&de!==ja.None&&!F,tt=zl(ae,$),At=Ul(ae,$);let je=Ta(M=>M.files);const[st]=l.useState(()=>Gl());ee==="magic"?je=je.filter(M=>M.gizmoId!=null):je=je.filter(M=>M.gizmoId==null);const Xs=Wl(),nt=je.length>0||Xs,Pt=Ta(Vl.hasUploadInProgress),It=h.useState(M=>{const ie=ql(M);return typeof ae?.maxTokens=="number"&&ie>ae.maxTokens}),Dt=h.useState(M=>!M.isEmpty()),pt=!It&&!Pt&&(Dt||nt);Wn(je.length>0||Pt||Dt);const rs=(de===ja.Multimodal?$l:Kl)-je.length,is=rs<=0,Pe=pt&&!u&&!i&&!ve,[Ft,Qs]=l.useState(!1),ft=Ho(),ls=a||ft.id,xt=Do(o,io.Search),vt=!u&&(!ue||Ue)&&xe?.includes(Es.SearchTool)&&(xe?.includes(Es.BrowsingAvailable)||!L?.isEnterprisey()),qe=vt&&xt,Bt=pe[ls]?.tags,{targetedContent:cs,setTargetedContent:St}=Vn(),Ee=cs?.isFocusedViewContent&&!ge?void 0:cs,{rebaseSystemMessageContent:Lt}=qn();l.useEffect(()=>{if(!I?.id)return;const M=Ma.getAndReset(I?.id,oe);M&&h.setText(M.inputText)},[I?.id,oe,h]),l.useEffect(()=>{Ft!==Pe&&(Qs(Pe),Pe&&mi(!0).then(M=>{hi.startEnforcement(M),Yl.startEnforcement(M),gi.startEnforcement(M)}))},[Pe,Ft,$?.kind,xe]);const us=Xl(ae,$),{handleFileAccepted:Zs}=Ql(T,wa(ae,$),tt,"mouse",V,us?.attachments),{getInputProps:ds,open:oa}=Zl({disabled:u||!gt||is,noClick:!0,onDropAccepted:Zs,onDropRejected:M=>Jl(M,T,P,de),multiple:!0,maxSize:ec,maxFiles:rs,...tc(At)}),ms=pi(st),hs=l.useCallback(()=>{h.eraseContent(),ms.clearMessages(),h.resize(Th),Q.clearOverrideModelId(o),sc();for(const M of je)fn.remove(U,M.tempId,"none");Oo.markAllAsSent()},[h,ms,je,U,o]),bt=async(M,ie)=>{if(M?.preventDefault(),u||!pt&&!ie||!$||Ct.isLoading(o)!==!1)return;const Ne=new qt;D(!0);const be=h.getContentToSend(),ot=bc(be.content),sn=`${k}-nextPrompt`,zt=new yc(wc.CompletionRequest,{expectedTimingLogs:[{name:"prompt_submitted",expectedInMs:3e3}]}),{content:Zr,attachments:da}=jc(U,ot,ae,$),ma=[],nn=[];Lt&&nn.push(vi(Lt));const an={...$};"gizmo"in an&&delete an.gizmo;let ys=h.getSystemHints();ce&&(ys=[qs.Search]);const ha=De(),Jr=ce?ha??Rn.CONVERSATION_COMPOSER_WEB_ICON:void 0,ga=Tc(),pa=Mc();let Ut={promptId:sn,content:Zr,eventMetadata:{eventSource:M?"mouse":"keyboard"},completionMetadata:{suggestions:p,conversationMode:an,systemHints:ys,searchSource:Jr},messageMetadata:{...da.length>0&&{attachments:da},...re&&{gizmo_id:re?.gizmo.id},...Me,...ys.length>0&&{system_hints:ys},...!!be.metadata&&{serialization_metadata:be.metadata},...ga.length>0&&{canvas:{pasted_textdocs:ga}},...Object.keys(pa).length>0&&{__internal:{search_settings:pa}}},prependMessages:ma.length>0?ma:void 0,appendMessages:nn.length>0?nn:void 0,turnTracker:Ne,profiler:zt,requestedModelId:_e};Ut=Cc(Ut),Ee?.createNewCompletionParams&&(Ut=await Ee.createNewCompletionParams(Ut)),zt.logTiming("request_params_ready"),await s(Ut),Ee?.onCreateCompletion?.({serverThreadId:oe,currentLeafId:k}),Ee?.shouldPersistAcrossMessages!==!0&&St(void 0),Bs.hideThreadHeader(),hs(),D(!1),zt.logTiming("prompt_submitted"),p!==void 0&&(he.logEvent("chatgpt_prompt_ignore_suggestions"),J.logEvent(Z.promptIgnoreSuggestions)),ce&&ha&&Se()},Js=l.useRef(bt);l.useEffect(()=>{Js.current=bt});const en=M=>{St(M.targetedReply),M.targetedReply&&(h.focus(),J.logEvent(Z.targetedReplyButtonClicked,{conversationId:oe,sourceMessageId:M.messageId}))},gs=l.useCallback(()=>{Ee?.onCleared?.({serverThreadId:oe,currentLeafId:k}),St(void 0),h.focus()},[k,oe,Ee,St,h]),ps={Enter:{validator:M=>{const ie=M.isComposing||M.keyCode===229;return!(te&&K.current)&&(M.metaKey||(le||oo)&&!M.shiftKey&&!ie)},handler:M=>{if(!Pe){It&&P.danger("The message you submitted was too long, please submit something shorter.",{hasCloseButton:!0});return}M.preventDefault(),bt()}},Escape:{validator:M=>!M.isComposing,handler:M=>{d&&i&&(t("",G),J.logEvent(Z.pauseCompletion,{threadId:Q.getServerThreadId(o),currentLeafId:Q.getTree(o).getMessageId(k),eventSource:"keyboard"})),M.target.value===""&&gs()}}},at=l.useRef(ps);at.current=ps;const fs=l.useRef(null),z=nc(Bt,$?.kind),[fe,$e]=l.useState(!1),[Ht,xs]=l.useState(!1),vs=z&&fe&&!Ue,ra=h.isReady();l.useEffect(()=>h.subscribe("keydown",M=>{h.acceptLegacyKeydown()&&at.current[M.key]?.validator(M)&&at.current[M.key].handler(M);const Ne=h.getCurrentText();if(M.key==="@"){const be=h.getSelectionStart(),ot=Ne.substring(0,be);(!ot||/\s$/.test(ot)||be===0)&&(fs.current?.handleClose(),setTimeout(()=>$e(!0),10))}else fe&&$e(!1);if(M.key==="Escape"&&(Ae(null),W(!1)),qe&&!ce){let be;M.key==="Backspace"?be=Ne.substring(0,Ne.length-1):be=Ne+M.key,/^search\s?$/i.test(be)?xs(!0):Ht&&xs(!1)}ce&&M.key==="Escape"&&ke(!1,{clientThreadId:o})}),[h,ra,fe,Ht,qe,ce,ke,o]),l.useEffect(()=>{const M=Object.fromEntries(Object.keys(at.current).map(ie=>[ie,be=>{const ot=at.current[ie];if(!ot||h.acceptLegacyKeydown())return!1;const{validator:sn,handler:zt}=ot;return sn(be)?(zt(be),!0):!1}]));h.registerKeyHandlers(M)},[h,ra]),l.useEffect(()=>h.subscribe("paste",M=>{ac({filePickerStore:U,event:M,intl:T,toaster:P,clientThreadId:o,conversationMode:$,currentModelConfig:ae,getEditorGizmoId:V,modelSupportedImageMimeTypes:tt})}),[T,o,$,ae,V,tt,h,P,U]);const Ir=M=>{Te||Ae(M),h.trimLeadingText("@"),Is(),$e(!1)},Dr=oc(o,st,tt,us?.attachments),Fr=l.useCallback(M=>{M?.preventDefault(),t("",G),J.logEvent(Z.pauseCompletion,{threadId:Q.getServerThreadId(o),currentLeafId:Q.getTree(o).getMessageId(k),eventSource:"mouse"}),Is()},[t,o,G,k]),ia=l.useCallback(()=>{Ma.set(I?.id,oe,h.getCurrentText())},[oe,I?.id,h]);l.useEffect(()=>{Y||!O&&!rc()&&h.focus()},[O,h]),l.useEffect(()=>{Y||fn.reset(U)},[a,U,Y]),l.useEffect(()=>{(!z&&re||Te)&&Ae(null)},[z,re,Te]);const[Br,Lr]=(()=>{switch(m){case"workspaceDisallowsGizmo":return[Fe.disallowedByWorkspacePlaceholder,!0];case"feedbackRequired":return[Fe.disabledFeedbackPlaceholder,!0];case"noModelsAvailable":return[Fe.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[Fe.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[Fe.loading,!0];case"noTestGizmoId":return[Fe.noTestGizmoId,!0];default:return f?[Fe.placeholderWithName,!1]:Ee?.placeholderTextOverride!=null?[Ee.placeholderTextOverride,!1]:[Fe.placeholderWithName,!1]}})(),Hr=T.formatMessage(Br,{name:Y!=null?ee==="magic"?ic:Y.name||"GPT":ue?.gizmo.display.name??"ChatGPT"});l.useEffect(()=>h.subscribe("input",()=>{$n.getState().isThreadHeaderVisible&&Bs.hideThreadHeader(),W(!0)}),[h]),l.useEffect(()=>{if(_)return h.subscribe("input",()=>{_?.()})},[h,_]),l.useEffect(()=>{if(w)return h.subscribe("change",()=>{w?.()})},[h,w]),l.useEffect(()=>h.subscribe("focus",()=>{W(!0)}),[h]);const la=$?.kind===dt.PrimaryAssistant&&!ce,{layer:Or}=Qe("4211831761"),zr=fi(Es.CanvasOptIn)||Or.get("enable",!1),Ur={clientThreadId:o,uploadType:de,modelAcceptedMimeTypes:At,modelSupportedImageMimeTypes:tt,attachmentsProductFeature:us?.attachments,getInputProps:ds,openFileDialog:oa,historyDisabled:X,onOauthRedirect:ia,highlightTooltip:S&&!nt},Ss=[],Gr=!u&&!is&&(gt||Ys!=null)&&!ce;Ss.push(e.jsx(Cm,{...Ur,isDisabled:!Gr},"file-upload-button")),zr&&Ss.push(e.jsx(jh,{composerController:h,clientThreadId:o,isDisabled:!la},"system-hint-button")),vt&&Ss.push(e.jsx(gh,{composerController:h,highlightTooltip:Ht,clientThreadId:o,isDisabled:!qe||nt},"search-button"));const Wr=nt&&e.jsxs(e.Fragment,{children:[ee==="magic"&&e.jsx("div",{className:"m-2 mb-0 rounded-lg bg-token-main-surface-secondary p-2 text-xs text-token-text-secondary",children:e.jsx(B,{...Fe.gizmoKnowledgeWarning})}),e.jsx(Ch,{files:je,className:"flex flex-nowrap gap-2 overflow-x-auto p-1.5",composerController:h})]}),Vr=Lr?"disabled":"default",qr=i&&d,$r=xi(),Kr=!Pe||O||$r,Yr=kc(Pt,Dt,It),bs=qr?"streaming":Kr?"disabled":"idle",Ot=l.useRef(null),yt=l.useRef(null),Xr=a&&a.startsWith("o1");l.useEffect(()=>{const M=()=>{Ot.current!=null&&gn.addAction("composer_state_disabled",{threadId:Q.getServerThreadId(o),disabledReason:Ot.current})};if(pt&&bs==="disabled"){let ie="unknown";u?ie=m??"component_disabled_unknown":i?ie="completion_in_progress":ve?ie="thread_hard_blocked":O&&(ie="starting_new_completion_request"),Ot.current!==ie&&(yt.current&&clearTimeout(yt.current),yt.current=setTimeout(M,Mh)),Ot.current=ie}else Ot.current=null;return()=>{yt.current&&(clearTimeout(yt.current),yt.current=null)}},[o,pt,bs,u,m,i,ve,O]);const tn=[];if(Ee?.label&&tn.push({type:Ee.type,value:Ee.label,onRemoveRegion:gs}),re!==null){const M=!!re.gizmo.tags?.includes(Kn.FirstParty);tn.push({type:"mention",value:re.gizmo.display.name,icon:e.jsx(lc,{isFirstParty:M,src:re.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{Ae(null),h.focus()}})}l.useEffect(()=>{(!b||b.length===0||!te)&&(K.current=!1)},[b,te]);const Qr=(M,ie,Ne)=>{K.current=M>=0,ie&&h.setText(Ne?`${Ne.title}${Ne.body}`:"")},ca=te&&b&&b.length>0&&!vs&&!h.hasMultipleLines()&&h.canShowAutocompletion();l.useEffect(()=>{vs?E?.():N?.()},[vs,E,N]);const ua=bs==="streaming"?Fr:bt;return e.jsxs(cc.Provider,{value:st,children:[e.jsx(uc,{onOauthRedirect:ia,children:e.jsx("form",{className:c,onSubmit:ua,children:e.jsxs("div",{className:"relative flex h-full max-w-full flex-1 flex-col",children:[!A&&!H&&e.jsx(vr,{className:C}),vs&&e.jsx("div",{className:R("absolute bottom-full my-3",r&&"lg:top-full",Ds.TagGpt),children:e.jsx(dc,{onClick:M=>Ir(M),onClose:()=>{$e(!1),h.focus()}})}),la&&e.jsx("div",{className:R("absolute bottom-full my-3",r&&"lg:top-full",Ds.TagGpt),children:e.jsx(Sh,{composerController:h,clientThreadId:o})}),e.jsxs("div",{ref:x,className:"group relative flex w-full items-center",children:[r&&y.has("from_template_row")&&e.jsx("button",{type:"button",onClick:()=>{q("/")},className:"mr-2 flex h-8 w-8 items-center justify-center text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(Sd,{className:"icon-lg"})}),z&&!!oe&&e.jsx(mc,{ref:fs}),e.jsx(Wm,{type:X?"temporary":"default",ref:j,replyRegions:tn,placeholder:Hr,inputState:Vr,composerController:h,leftSideActions:Ss,state:bs,onSubmit:ua,renderFiles:Wr,currentLeafId:k,clientThreadId:o,gizmoId:ue?.gizmo.id,disableReason:Yr,modelId:ls}),ca&&e.jsx("div",{className:"absolute left-0 z-10 box-border w-full bg-token-main-surface-primary pl-0 max-lg:bottom-full lg:top-full",children:e.jsx(bh,{suggestions:b,composerController:h,onSelect:v,onChange:Qr})})]}),e.jsx(hc,{composerController:h,parsedDocumentHandler:Dr})]})})}),e.jsx(xm,{canUseInlineTagging:z,isDisabled:u,clientThreadId:o,currentLeafId:k,currentRequestId:G,canContinue:g,composerController:h,setPromptInputMetadata:Ce,suggestions:p,isNewThread:r,onCreateNewCompletion:s,onContinueGenerating:n,onResetState:hs,conversationMode:$,isShowingAutocomplete:!!ca}),$!=null&&!Xr&&gc.includes($.kind)&&e.jsx(pc,{clientThreadId:o,onTargetedReply:en})]})}const yr=Um;function _h(t){const s=t.message?.author.role===Le.User,n=t.metadata?.err!=null&&t.metadata?.errCode!==Sa.ContentPolicy,a=t.metadata?.errCode===Sa.ModelIncompatibility;return t.metadata?.canRetry===!1||a?!1:s||n}function wr(t){return t.composerController?e.jsx(Fa,{...t,composerController:t.composerController}):e.jsx(yr,{children:s=>e.jsx(Fa,{...t,composerController:s})})}function Fa({clientThreadId:t,isNewThread:s,currentModelId:n,showPromptStarters:a,noWrap:o,onRequestCompletion:r,composerContainerRef:i,composerController:c}){const u=Pn(),m=In(),d=Dn(p=>{const f=Ct.getCurrentNode(t,p);return _h(f)});if(Uo(c),!m&&d)return e.jsx(Eh,{clientThreadId:t});const g=e.jsx(e.Fragment,{children:e.jsx(jr,{composerContainerRef:i,composerController:c,clientThreadId:t,currentModelId:n,isNewThread:s,showPromptStarters:a,onRequestCompletion:r})});return o?g:e.jsxs(e.Fragment,{children:[e.jsx(dm,{clientThreadId:t}),e.jsx(Yn,{clientThreadId:t,isStaticSharedThread:u,withVerticalPadding:!1,withHorizontalPadding:!0,children:e.jsx($t,{children:g})})]})}function Eh({clientThreadId:t}){const s=_c(t),n=Dn(r=>Ct.getCurrentNode(t,r).metadata?.errCode===Ec),a=Nc(r=>r.isoDate),o=Je(t);return n&&a!=null&&a!==""?null:e.jsxs("div",{children:[e.jsx("div",{className:"mb-3 text-center text-xs",children:e.jsx(B,{...Ba.errorGeneratingResponse})}),e.jsx("div",{className:"flex items-center md:mb-4",children:e.jsx(Nt,{as:"button",color:"primary",onClick:()=>{const r=new qt;he.logEvent("chatgpt_regenerate_due_to_error_button_clicked",void 0,Xe({clientThreadId:t})),s({id:o,eventMetadata:{eventSource:"mouse"},conversationMode:Ct.getConversationMode(t),turnTracker:r})},className:"m-auto",icon:ir,"data-testid":"regenerate-thread-error-button",children:e.jsx(B,{...Ba.regenerateResponse})})})]})}function jr({clientThreadId:t,currentModelId:s,isNewThread:n,onRequestCompletion:a,showPromptStarters:o,composerContainerRef:r,composerController:i,autocompletions:c,requiresFileUpload:u,onComposerInput:m,onComposerChange:d,onAutocompleteSelect:g,headerClassName:p,hideHeader:f,onTaggingDropdownClose:x,onTaggingDropdownOpen:h}){const b=Je(t),S=Os(t),_=xn(),{isUnauthenticated:w}=Ge(),C=uo(t)===mo.STREAMING,A=ho({clientThreadId:t,conversationLeafId:b}),j=ut(S),E=Si({clientThreadId:t}),N=!w,I=bi(),{isOpen:L,onClose:F}=Rc({type:"just-hit-rate-limit"}),T=l.useCallback((W,H)=>{J.logEvent(Z.continueCompletion),a({type:ba.Continue,promptId:W,eventMetadata:{eventSource:"mouse"},cancelActiveRequests:!1,completionMetadata:{conversationMode:Ct.getConversationMode(t)},turnTracker:H})},[a,t]),P=go(),U=l.useCallback(async(W,H)=>Ac({clientThreadId:t,currentRequestId:H,isHistoryAndTrainingDisabled:I,queryClient:P}),[t,I,P]),k=l.useCallback(async({promptId:W,content:H,eventMetadata:K,completionMetadata:pe,messageMetadata:ae,prependMessages:_e,appendMessages:$,turnTracker:ue,profiler:Ue,requestedModelId:re})=>{const Ae=Q.getThreadCurrentLeafId(t);Q.updateTree(t,de=>{de.addNode(W,H,Ae,Le.User,void 0,ae)}),await a({type:ba.Next,promptId:W,eventMetadata:K,cancelActiveRequests:!0,completionMetadata:pe,prependMessages:_e,appendMessages:$,turnTracker:ue,profiler:Ue,...re?{requestedModelId:re}:{}})},[t,a]),G=yi(t,b),y=wi(t,b),q=!A&&(j||C),Y=l.useMemo(()=>q?!1:!G&&y,[G,y,q]),ee=q&&s!=="gpt-4-pbrowse",V=Us(t),xe=He(t),le=ss(xe).data,{promptStarters:X,isSuccess:ge}=vn(n&&!V,t,4),oe=Co(),Te=(()=>{if(oe?.messageId===Q.getTree(t).getLastValidNode(b)?.message?.id)return oe?.suggestions;if(o&&!V&&ge&&!N)return X})(),ve=Pc(),Me=ji(),Ce=(()=>{if(le?.gizmo.tags?.includes(Kn.WorkspaceDisabled)&&!Me)return"workspaceDisallowsGizmo";if(ve.size){if(_.displayingSideBySideFeedback&&_.unskippable)return"feedbackRequired"}else return"noModelsAvailable";const H=Ct.getConversationMode(t);return H?.kind===dt.GizmoTest&&H.gizmo_id==null?"noTestGizmoId":null})(),ke=po(t),Se=Gs(t),De=fo("15117983")?.value,ce=Ti(),O=Ws(),D=ce.action==="moderate",{value:te}=Ze("1860647109");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center",children:O&&D&&te?e.jsx(Ic,{}):null}),L?e.jsx(Dc,{onClose:F}):null,De&&Se&&Se.kind===dt.PrimaryAssistant&&Se.plugin_ids&&Se.plugin_ids.length>0?e.jsx(Nh,{}):e.jsx(kh,{composerContainerRef:r,composerController:i,clientThreadId:t,onCreateNewCompletion:k,onAbortCompletion:U,onContinueGenerating:T,currentModelId:s,isNewThread:n,isCompletionInProgress:E,className:"w-full",canContinue:Y,suggestions:Te??[],disabled:!!Ce,disabledReason:Ce??void 0,canPause:ee,isInteractableSharedThread:ke,autocompletions:c,requiresFileUpload:u,onComposerInput:m,onComposerChange:d,onAutocompleteSelect:g,headerClassName:p,hideHeader:f,onTaggingDropdownClose:x,onTaggingDropdownOpen:h},t)]})}function Nh(){return e.jsxs("div",{className:"mx-auto flex max-w-md flex-col items-center justify-center gap-2 rounded-xl border border-token-border-light bg-token-main-surface-primary p-6 shadow-lg",children:[e.jsx("span",{className:"text-token-text-primary",children:e.jsx(B,{id:"PluginsDecrepatedNotice.pluginsDeprecationTitle",defaultMessage:"Conversations with plugins are archived"})}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(B,{id:"PluginsDecrepatedNotice.pluginsDeprecationSubtitle",defaultMessage:"Explore GPT Store to find a replacement"})}),e.jsxs("a",{href:"https://chat.openai.com/gpts",className:"text-green-500 hover:cursor-pointer dark:text-green-400",children:[e.jsx(B,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLink",defaultMessage:"Explore GPTs"}),e.jsx("span",{className:"ml-2",children:e.jsx(B,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLinkArrow",defaultMessage:"→"})})]})]})}const Ba=ze({errorGeneratingResponse:{id:"PromptTextarea.errorGeneratingResponse",defaultMessage:"There was an error generating a response"},regenerateResponse:{id:"PromptTextarea.regenerateResponse",defaultMessage:"Regenerate"}}),Tr=l.memo(function(){return e.jsxs("div",{className:`flex flex-col gap-2 ${Ds.PromptTextareaHeader}`,children:[e.jsx(Sr,{}),e.jsx(br,{})]})}),Rh=Object.freeze(Object.defineProperty({__proto__:null,ChatScreenComposerAlerts:Tr},Symbol.toStringTag,{value:"Module"})),ln=4;function Ah(t){const{layer:s}=Qe("3533083032"),{layer:n}=Mt("3533083032"),{value:a,isLoading:o}=Ze("3006519778");return o||!a?!1:t?s.get("enable_new_homepage_anon",!1):n.get("enable_new_homepage_anon",!1)}function Ph(){const{layer:t}=Mt("4031588851"),s=t.get("autocomplete_qualified_start_date","2099-09-13T00:00:00Z"),n=zn();return!!n&&n.created*1e3>=new Date(s).getTime()}function Ih(t){const{layer:s}=Qe("4031588851"),{layer:n}=Mt("4031588851"),{value:a,isLoading:o}=Ze("633009675");return o||!a?!1:t?s.get("enable_new_autocomplete_homepage",!1):n.get("enable_new_autocomplete_homepage",!1)}const cn=t=>`${t.title}${t.body}`.toLocaleLowerCase();function Mr(t){return He(t.clientThreadId),e.jsx(yr,{children:s=>e.jsx(Hh,{...t,composerController:s})})}function Dh({children:t,composerController:s}){const{store:n}=we(),[a,o]=l.useState(!1);l.useEffect(()=>s.subscribe("focus",()=>{o(!0)}),[s]),l.useEffect(()=>s.subscribe("blur",()=>{o(!1)}),[s]);const i=!!n.useSharedProps()?.isShowingAutocomplete;return t(i&&a)}function Fh({isUnauthenticated:t,shouldShowLegacyStarterPrompts:s,legacyPromptStarters:n,isSendBlocked:a,clientThreadId:o}){return e.jsxs("div",{className:R(t?"justify-end lg:justify-center":"justify-center","flex h-full flex-shrink flex-col items-center overflow-y-hidden text-token-text-primary lg:hidden"),children:[e.jsx("div",{className:R(t&&"flex sm:items-center md:flex-1","flex-shrink-0"),children:e.jsx(Zt,{className:"mb-6 h-12 w-12"})}),s&&(n&&n.length>0?e.jsx(Gh,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},promptStarters:n,isSendBlocked:a,clientThreadId:o,isSquare:t}):e.jsx(Hd,{}))]})}function Bh({composerController:t,isSendBlocked:s,clientThreadId:n,isModelLoaded:a,headlineOption:o,enableNewMobileDesign:r,shouldShowStarterPrompts:i,promptChips:c,onSelectStarterPrompt:u,starterPromptExpanded:m,setStarterPromptExpanded:d}){return e.jsx(Dh,{composerController:t,children:g=>e.jsxs(ne.div,{initial:{opacity:0},animate:{opacity:g?0:1},exit:{opacity:0},transition:{duration:.1},className:R("justify-center",g?"pointer-events-none":"","mt-[var(--screen-optical-compact-offset-amount)] flex h-full flex-shrink flex-col items-center overflow-hidden text-token-text-primary lg:hidden"),children:[o==="CHATGPT_LOGO"?e.jsx(Zt,{className:"inline-block h-12 w-12"}):e.jsx(Cr,{headlineOption:o,isModelLoaded:a}),e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:R(!r&&"lg:hidden",!m&&"h-[116px]"),children:i&&e.jsx(_r,{starterPrompts:c,onSelectStarterPrompt:u,disabled:s,clientThreadId:n,onExpand:()=>d(!0),mobileLayout:!0})})]})})}function Lh(t,s,n){const a=Ze("1468311859").value,o=Ze("3664702598").value,{layer:r}=Qe("4031588851"),i=Ph(),c=t||s,u=c&&a,m=c&&o&&i;let d="HARDCODED";if(c)if(n){const g=r.get("search_autocomplete_mode","");u&&g&&(d=g)}else m&&(d=r.get("autocomplete_mode","HARDCODED"));return d}function Hh({clientThreadId:t,currentModelId:s,isModelLoaded:n,onRequestCompletion:a,composerController:o,v2HomepageDisclaimer:r}){const i=Wt(t),c=Us(t),u=An(),[m,d]=l.useState([]),{trendingSuggestions:g,fetchTrendingSuggestions:p}=Wh(ln),f=l.useRef(!1),{isUnauthenticated:x}=Ge(),h=Fc(),[b,S]=l.useState(!1),_=Ln(),w=et();Uo(o);const v=Ze("589604007").value,{layer:C}=Mt("4031588851"),{layer:A}=Qe("4031588851"),{layer:j}=Mt("3533083032"),{layer:E}=Qe("3533083032"),{promptStarters:N,isSuccess:I}=vn(i&&!c&&n,t,8,v,!0,s??void 0),{promptStarters:L,isSuccess:F,isError:T}=vn(i&&!c&&n,t,4,void 0,void 0,s??void 0),P=h&&!!m.find(O=>!!O.requires_file_upload),U=l.useCallback(O=>{const D=o.getCurrentText();return D&&cn(O).startsWith(D.toLocaleLowerCase())},[o]),k=l.useCallback(O=>{const D=o.getCurrentText(),te=O.title+O.body;return U(O)?{...O,title:D,body:te.slice(D.length)}:{...O,title:te,body:""}},[o,U]),G=l.useCallback((O=!1)=>{d(D=>!D.some(U)&&D.length>0?[]:O?D:D.map(k))},[U,k]),y=(O,D,te)=>{const W=O.title;d([]),o.focus(),o.setText(W),requestAnimationFrame(()=>{const H=(N?.filter(K=>K.theme===O.theme)??[]).map(K=>{const pe=wt(K.oneliner),ae=pe.startsWith(K.title);return{...K,title:ae?`${K.title} `:"",body:ae?K.body:pe,autocompletionChunks:yh(W,pe),type:Fs.Autocomplete}});d(H),H.length>0&&Et(H,t),Lc(O,te,t)})};l.useEffect(()=>{const O=m.some(D=>D.theme===Sn.Search);_&&o.getCurrentText()===""?g.length>0?d(g):p():O&&!_&&d(D=>D.filter(te=>te.theme!==Sn.Search))},[m,_,g,p,o]);const q=N?.reduce((O,D)=>(D.theme&&!O[D.theme]&&(O[D.theme]=D),O),{}),Y=[];if(q)for(const O in q)Y.push(q[O]);const ee=Y&&Y.length>0,V=!!(I&&ee&&n),xe=!!((F||T)&&n),le=ln-m.filter(U).length,X=x?E.get("enable_new_mobile",!1):A.get("enable_new_mobile",!1),ge=Lh(X,h,_),oe=x?j.get("headline_option","HELP_WITH"):C.get("headline_option","HELP_WITH"),Te=C.get("autocomplete_min_char",4),ve=C.get("autocomplete_fetch_interval",200),Me=l.useRef(null),Ce=l.useCallback(Go(async O=>{const D=o.getCurrentText();if(!D||D.length<Te||D.length>80||o.hasMultipleLines()){d([]);return}if(!f.current&&!(Me.current&&Me.current.length>Te&&D.startsWith(Me.current)))try{const te=await kt.generateAutocompletions(D,O,_);if(te.completions.length===0){Me.current=D;return}const W=te.completions.map(H=>({id:Mi(),type:Fs.Autocomplete,title:H.slice(0,D.length),body:H.slice(D.length),oneliner:H,prompt:H,source:ge})).filter(U).map(k);d(H=>{const K=H.filter(U),pe=W.filter(ae=>{const _e=cn(ae);return!K.some($=>{const ue=cn($);if(_e===ue)return!0;const Ue=/[\p{P}\p{S}]$/u,re=_e.replace(Ue,""),Ae=ue.replace(Ue,"");return re===ue||_e===Ae||re===Ae})}).slice(0,ln-K.length);return[...K,...pe]}),W.length>0&&Et(W,t)}catch{}},ge==="BING"?150:ve),[o,ge,k,ve]),ke=l.useCallback(()=>{G(),le>0&&Ce(le)},[Ce,G,le]);l.useEffect(()=>{f.current&&d([])},[f]);const Se=l.useMemo(()=>ge==="HARDCODED"?G:ke,[ge,ke,G]),De=l.useCallback(()=>{o instanceof as&&G(!0),o.getCurrentText().indexOf(`
`)>0&&d([])},[o,G]),ce=l.useCallback((O,D,te)=>{D.forEach(W=>{W.id===O.id&&(W.userInput=o.getCurrentText())}),d([D[te]])},[o]);return e.jsx(e.Fragment,{children:e.jsx(ns,{children:e.jsx("div",{className:"h-full w-full lg:py-[18px]",children:e.jsx(Yn,{isStaticSharedThread:!1,withVerticalPadding:!1,withHorizontalPadding:!0,clientThreadId:t,fullHeight:!0,children:e.jsxs(Ca,{children:[e.jsx("div",{className:"mb-7 hidden text-center lg:block",children:oe==="CHATGPT_LOGO"?e.jsx(Zt,{className:"inline-block h-12 w-12"}):e.jsx(Cr,{headlineOption:oe,isModelLoaded:n})}),!X&&e.jsx(Fh,{isUnauthenticated:x,shouldShowLegacyStarterPrompts:xe,legacyPromptStarters:L,isSendBlocked:u,clientThreadId:t}),X&&e.jsx(Bh,{composerController:o,isModelLoaded:n,headlineOption:oe,enableNewMobileDesign:X,shouldShowStarterPrompts:V,promptChips:Y,onSelectStarterPrompt:y,starterPromptExpanded:b,setStarterPromptExpanded:S,isSendBlocked:u,clientThreadId:t}),e.jsx("div",{className:R("lg:w-full","lg:absolute lg:bottom-8 lg:left-0"),children:e.jsx(Ca,{children:w?e.jsx(Tr,{}):e.jsx(vr,{className:"block"})})}),e.jsx("div",{className:"w-full",children:e.jsx(jr,{clientThreadId:t,isNewThread:i,currentModelId:s,onRequestCompletion:a,showPromptStarters:!1,composerController:o,autocompletions:m,requiresFileUpload:P,onComposerInput:Se,onComposerChange:De,onAutocompleteSelect:ce,onTaggingDropdownClose:()=>{f.current=!1},onTaggingDropdownOpen:()=>{f.current=!0},hideHeader:!0})}),e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:R("hidden lg:block",r&&x&&b?"":"h-[70px]"),children:V&&e.jsx(_r,{starterPrompts:Y,onSelectStarterPrompt:y,disabled:u,clientThreadId:t,onExpand:()=>S(!0)})}),r&&e.jsx("div",{className:"w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px] lg:absolute lg:bottom-0 lg:left-0",children:e.jsx("div",{className:"min-h-4",children:r})})]})})})})})}function Cr({headlineOption:t,isModelLoaded:s}){const n=Oe(),[a,o]=l.useState(0),[r,i]=l.useState(!0),c=20,u=n.formatMessage(Vh[t]||Vt.whatCanIHelpWith);return l.useEffect(()=>{if(!s)return;let m;return a<u.length?m=setTimeout(()=>{o(a+1)},c):r&&(m=setTimeout(()=>{i(!1)},500)),()=>clearTimeout(m)},[u,a,r,s]),e.jsxs("div",{className:"relative inline-flex justify-center text-center text-2xl font-semibold leading-9",children:[e.jsx("h1",{children:u.substring(0,a)||"​"}),e.jsx("h1",{className:"result-streaming absolute left-full transition-opacity",style:{opacity:r?1:0},children:e.jsx("span",{})})]})}function kr({label:t,onClick:s,disabled:n=!1,icon:a}){return e.jsxs("button",{className:"group relative flex h-[42px] items-center gap-1.5 rounded-full border border-token-border-light px-3 py-2 text-start text-[13px] shadow-xxs transition enabled:hover:bg-token-main-surface-secondary disabled:cursor-not-allowed xl:gap-2 xl:text-[14px]",disabled:n,onClick:s,children:[a,e.jsx("span",{className:"max-w-full select-none whitespace-nowrap text-gray-600 transition group-hover:text-token-text-primary dark:text-gray-500",children:t})]})}function Oh({starterPrompt:t,starterPrompts:s,index:n,disabled:a,onSelectStarterPrompt:o}){const r=t.theme??t.title,i=$s(),{mutate:c}=Hc(),u=t.category==="onboarding"?()=>{c({key:mt.hasUsedConversationalOnboardingStarterPrompt}),i(t,s,n)}:()=>o(t,s,n);return e.jsx(kr,{disabled:a,onClick:u,icon:e.jsx(Oc,{starterPrompt:t,useV2Colors:!0}),label:r})}function La({clientThreadId:t,onClick:s}){l.useEffect(()=>{zc(t)},[t]);const n=Oe();return e.jsx(ne.div,{initial:{opacity:0,translateY:5},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:5},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(kr,{onClick:()=>{Uc(t),s()},label:n.formatMessage(Vt.moreStarterPrompts)})})}const zh=5,Uh=3;function _r({starterPrompts:t,onSelectStarterPrompt:s,disabled:n,clientThreadId:a,onExpand:o,mobileLayout:r=!1}){const i=r?Uh:zh,[c,u]=l.useState(i),[m,d]=l.useState(i),[g,p]=l.useState(!1),f=l.useRef(null),x=t.length<=c;l.useEffect(()=>{Et(t.slice(0,i),a)},[a]),l.useEffect(()=>{if(!g&&!x&&f.current){const b=f.current,S=b.getBoundingClientRect(),_=S.width,w=Array.from(b.children);let v=0;for(let C=0;C<w.length&&w[C].getBoundingClientRect().right-S.left<=_;C++)v++;u(v),d(v),p(!0)}},[t,x,g]);const h=()=>{const b=t.slice(c,t.length).map(S=>({...S,isAdditional:!0}));b.length>0&&Et(b,a),u(t.length),o()};return e.jsxs("div",{className:R("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",g&&t.length>0?"opacity-100":"opacity-[0.01]",r?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:R("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",x||r?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:f,children:[t.slice(0,c).map((b,S)=>e.jsx(ne.li,{initial:{opacity:0,...S<m?{translateY:5}:{}},animate:{opacity:1,...S<m?{translateY:0}:{}},exit:{opacity:0,...S<m?{translateY:5}:{}},transition:{duration:.3,delay:S>=m?(S-m)*.06:0,ease:"easeOut"},children:e.jsx(Oh,{starterPrompt:b,starterPrompts:t,index:S,disabled:n,onSelectStarterPrompt:s})},b.id??S)),r&&t.length>c&&e.jsx(La,{clientThreadId:a,onClick:h})]}),!r&&t.length>c&&e.jsx(La,{clientThreadId:a,onClick:h})]})}function Gh({promptStarters:t,isSendBlocked:s,clientThreadId:n,isSquare:a,...o}){l.useEffect(()=>{Et(t,n)},[n]);const r=$s();return e.jsx(e.Fragment,{children:a?e.jsx(ne.div,{...o,className:"mb-2 w-full flex-shrink overflow-y-hidden",children:e.jsx($t,{children:e.jsx(dr,{starterPrompts:t,onSelectStarterPrompt:r,disabled:s})})}):e.jsx(ne.div,{...o,className:"flex-shrink overflow-y-hidden",children:e.jsx(Od,{starterPrompts:t,onSelectStarterPrompt:r,disabled:s,cssMobileDisplayLimit:2,marginOverride:"mt-6 lg:mt-12"})})})}const Wh=t=>{const[s,n]=l.useState([]),a=l.useCallback(async()=>{const r=(await kt.generateTrendingSuggestions(t)).suggestions.map((i,c)=>({type:Fs.Starter,title:Ha(i),body:"",icon:e.jsx(bd,{}),prompt:Ha(i),id:`starter-${c}`,theme:Sn.Search}));n(r)},[t]);return{trendingSuggestions:s,fetchTrendingSuggestions:a}};function Ha(t){return t.split(" ").map(Bc).join(" ")}const Vt=ze({whatCanIHelpWith:{id:"SplashScreenV2.whatCanIHelpWith",defaultMessage:"What can I help with?"},whereShouldWeStart:{id:"SplashScreenV2.whereShouldWeStart",defaultMessage:"Where should we start?"},askChatgptAnything:{id:"SplashScreenV2.askChatgptAnything",defaultMessage:"Ask ChatGPT anything"},moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),Vh={HELP_WITH:Vt.whatCanIHelpWith,WHERE_TO_START:Vt.whereShouldWeStart,ASK_CHATGPT:Vt.askChatgptAnything},qh=We(()=>Ve(()=>import("./meqed4w7o0sk383r.js"),__vite__mapDeps([7,1,2,3,8,9,4,5,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25])).then(t=>t.GizmoUsingAsOwnerNotice)),Er=({clientThreadId:t})=>{const s=$n(m=>m.activeStageSidebar),n=Q.getServerThreadId(t),a=Gc(Es.WorkspaceShareLinks),{isUnauthenticated:o}=Ge(),r=ts(),i=a&&n&&!o&&!r,c=et(),u=!s&&!(c&&!o);return e.jsx("div",{className:R(!c&&"gap-2",c&&"@lg/screen-composer:gap-2","flex items-center pr-1 leading-[0]"),children:e.jsx(Wd,{showShareButton:i,showProfileDropdown:u,clientThreadId:t})})};function $h({clientThreadId:t,gizmoId:s}){const n=Wc(),{data:a}=ss(s),o=zs();return e.jsxs(e.Fragment,{children:[e.jsxs(Vc,{className:"max-md:hidden",children:[e.jsxs("div",{className:"absolute start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2",children:[a!=null&&o?.isWorkspaceAccount()&&a.gizmo.tags?.includes(Kn.WorkspaceDisabled)&&e.jsx(qh,{gizmo:a}),e.jsx(qc,{gizmoId:s,clientThreadId:t})]}),e.jsx($c,{children:e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden",children:[e.jsx(Vd,{clientThreadId:t}),e.jsx(Wo,{clientThreadId:t})]})}),e.jsx(Er,{clientThreadId:t})]}),n&&e.jsx(Kc,{})]})}function Nr({clientThreadId:t}){const s=He(t),n=Pn(),a=et();return n||a?null:e.jsx($h,{gizmoId:s,clientThreadId:t})}function Kh({clientThreadId:t,currentModelId:s,isModelLoaded:n,onRequestCompletion:a,enableV2Homepage:o,v2HomepageDisclaimer:r}){const i=ts();let c=e.jsx(Ud,{}),u;return i?(u=e.jsx(Yh,{}),c=e.jsx(Zt,{className:"mb-6 h-12 w-12"})):t!=null?(u=o?e.jsx(Mr,{clientThreadId:t,currentModelId:s,isModelLoaded:n,onRequestCompletion:a,v2HomepageDisclaimer:r}):e.jsx(Gd,{clientThreadId:t}),c=null):u=e.jsx(Xh,{}),e.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-token-text-primary",children:[c,u]})}function Yh({gizmo:t}){const s=Xc(),n=t?Qc(t.tools):!1,a=zs();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-5 text-2xl font-semibold","data-testid":"temporary-chat-label",children:[e.jsx(bn,{id:"temporary-chat-checkbox",name:"temporary-chat-checkbox",checked:!0}),e.jsx(B,{...it.temporaryChat})]}),e.jsxs("div",{className:"max-w-sm text-center text-sm font-normal text-token-text-tertiary",children:[e.jsx(B,{...a?.isWorkspaceAccount()?s?it.temporaryChatBizMemoryAvailable:it.temporaryChatBizMemoryUnavailable:s?it.temporaryChatDescriptionMemoryAvailable:it.temporaryChatDescriptionMemoryUnavailable}),n&&e.jsx("div",{className:"mt-3",children:e.jsx(B,{...it.temporaryChatDescriptionGptActions,values:{link:o=>e.jsx("a",{href:"https://help.openai.com/en/articles/8914046-temporary-chat-faq",target:"_blank",className:"underline",rel:"noreferrer",children:o})}})})]})]})}function Xh(){return e.jsx("div",{className:"mb-5 text-2xl font-semibold",children:e.jsx(B,{...it.howCanIHelpYouToday})})}function Rr({clientThreadId:t,currentModelId:s,isModelLoaded:n,onRequestCompletion:a,enableV2Homepage:o,v2HomepageDisclaimer:r}){const i=He(t),c=Ci(),u=An(),{data:m}=ss(i),d=Yc(),g=ki(()=>navigator.windowControlsOverlay);return(c!=null||i!=null)&&m==null?null:e.jsxs("div",{className:"relative h-full",children:[e.jsx("div",{className:g?.visible?R("absolute right-[calc(100dvw-env(titlebar-area-width,100dvw)-env(titlebar-area-x,0))]",d?"left-[env(titlebar-area-x,0)]":"left-0"):"absolute left-0 right-0",children:e.jsx(Nr,{clientThreadId:t})}),m!=null?e.jsx(zd,{gizmo:m,showStarterPrompts:!0,disableStarterPrompts:u}):e.jsx(Kh,{clientThreadId:t,currentModelId:s,isModelLoaded:n,onRequestCompletion:a,enableV2Homepage:o,v2HomepageDisclaimer:r})]})}const it=ze({temporaryChat:{id:"GizmoLanding.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatBizMemoryAvailable:{id:"g1opBW",defaultMessage:"This chat won't appear in your history and won't use or create memories."},temporaryChatBizMemoryUnavailable:{id:"fQmbtG",defaultMessage:"This chat won't appear your conversation history."},temporaryChatDescriptionMemoryAvailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryAvailable",defaultMessage:"This chat won't appear in history, use or create memories, or be used to train our models. For safety purposes, we may keep a copy for up to 30 days."},temporaryChatDescriptionMemoryUnavailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryUnavailable",defaultMessage:"This chat won't appear in history or be used to train our models. For safety purposes, we may keep a copy of this chat for up to 30 days."},temporaryChatDescriptionGptActions:{id:"GizmoLanding.temporaryChatDescriptionGptActions",defaultMessage:"Any data shared with a third party through GPT actions are subject to the third party's privacy policy. <link>Learn more</link>"},howCanIHelpYouToday:{id:"GizmoLanding.howCanIHelpYouToday",defaultMessage:"How can I help you today?"}});function Qh({className:t,clientThreadId:s,message:n,onModelSelect:a,onDropdownChange:o}){const r=Oe(),[i,c]=l.useState(null),[u,m]=l.useState(!1),[d,g]=l.useState(!1),p=Zc(),f=Vo(s),x=He(s),h=qo({clientThreadId:s,message:n}),b=n.message.metadata?.model_slug,{modelOptions:S,modelSlug:_,animateModelLabelOnRender:w,nuxProps:v,messageModelEnabledTools:C}=h,A=$o(n.message),j=C.includes(qs.Search),E=l.useMemo(()=>S.find(k=>k.value==b),[S,b]),{doesUserHaveAnyAccountsWithPlusFeatures:N}=xo(),I=l.useRef(null),L=k=>{k||setTimeout(()=>{I.current&&I.current.blur()},10)};if(l.useEffect(()=>{L(u)},[u]),!p||x)return null;const F=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:r.formatMessage(Oa.search),icon:e.jsx(Zn,{className:"icon-sm"}),condition:j&&!A,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:r.formatMessage(Oa.nosearch),icon:e.jsx(lr,{className:"icon-sm"}),condition:j&&A,eventName:"chatgpt_regenerate_without_search_button_clicked"}];let T,P;v.shouldRenderNux?(T=Jh,P={title:e.jsx(B,{id:"g/+2Hh",defaultMessage:"Optimized your response"}),description:e.jsx(B,{id:"H0Flqm",defaultMessage:"Used {usedModelName} for a faster response that saves your limited {largestModelName} messages",values:{usedModelName:v.usedModelName,largestModelName:v.largestModelName}}),markAsViewed:v.announcement.markAsViewed}):(T=Zh,P={label:f?e.jsx(B,{id:"LBYK9a",defaultMessage:"Change model"}):e.jsx(B,{id:"nygjPN",defaultMessage:"Used {modelName}",values:{modelName:v.usedModelName}})});const U=f&&S.some(k=>Qt(k,N));return e.jsxs(Re.Root,{onOpenChange:k=>{f&&(m(k),o(k),L(k)),k&&J.logEvent(Z.conversationOpenMessageModelSelector,{has_get_plus_button:U})},children:[e.jsx(T,{...P,children:e.jsx(vo,{ref:I,className:R("cursor-pointer",t),onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:e.jsx(Ar,{modelSlug:_,animateModelLabelOnRender:w,isDropdownOpen:u,isRegenerateEnabled:f,isHovered:d})})}),f&&e.jsxs(Re.Content,{className:"z-30 origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[S.map(k=>{const G=Qt(k,N),{value:y,...q}=k;return e.jsx(jt,{value:y,onSelect:()=>{he.logEvent("chatgpt_regenerate_switch_model_button_clicked",y,{requestedModelId:y,...Xe({clientThreadId:s})}),a({requestedModelId:y})},onMouseEnter:()=>c(y),onMouseLeave:()=>c(null),isHovered:i===y,messageModelSlug:n.message.metadata?.model_slug,shouldShowUpsell:G,...q},y)}),!!E&&e.jsxs(e.Fragment,{children:[e.jsx(Re.Separator,{}),F.filter(k=>k.condition).map(k=>e.jsx(jt,{onSelect:()=>{he.logEvent(k.eventName,E.value,{requestedModelId:E.value,...Xe({clientThreadId:s})}),a({requestedModelId:E.value,extraStreamParams:k.extraStreamParams})},includeRegenerate:!0,onMouseEnter:()=>c(k.key),onMouseLeave:()=>c(null),isHovered:i===k.key,messageModelSlug:b,includeCheck:!1,...E,label:k.label,subtitle:"",icon:k.icon},k.key))]})]})]})}function Ar({modelSlug:t,animateModelLabelOnRender:s,isDropdownOpen:n,isRegenerateEnabled:a,isHovered:o,isRegenLabel:r=!1,animateShortLabel:i,omitIcon:c}){const[u,m]=l.useState("initial"),{categories:d}=Jc({isRegen:!!r});l.useEffect(()=>{if(s){const S=setTimeout(()=>m("show"),500),_=setTimeout(()=>m("initial"),2e3);return()=>{clearTimeout(S),clearTimeout(_)}}m("initial")},[s]);const g=d.find(({defaultModel:S})=>S===t),p=t===tu?{categoryId:"gpt_3.5",shorterLabel:"3.5"}:{},{categoryId:f,shorterLabel:x}=g??p,h={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},b=n?"visible":o?"show":u;return e.jsxs(ne.div,{initial:"initial",animate:b,className:"flex items-center pb-0",children:[!c&&(r?e.jsx(Jn,{className:"icon-md"}):f&&e.jsx(eu,{type:"outline",categoryId:f,className:"icon-md h-4 w-4"})),(a||i)&&e.jsx(ne.span,{className:"overflow-hidden text-clip whitespace-nowrap text-sm",variants:h,transition:{type:"tween",duration:.18},children:x}),a&&e.jsx(yd,{className:R("icon-sm",{"text-token-text-quaternary":!o&&!r},{"text-token-text-secondary":o&&!r})})]})}function Zh({children:t,label:s}){return e.jsx(Jt,{label:s,sideOffset:0,children:t})}function Jh({children:t,title:s,description:n,markAsViewed:a}){return e.jsx(On,{announcementKey:mt.ModelSwitcherAutoDowngrade,show:!0,side:"bottom",sideOffset:-4,title:s,description:n,badge:"beta",onDismiss:a,dismissOnOutsideClick:!0,children:t})}function Qt(t,s){const{modelSwitcherDeny:n,subscriptionLevel:a}=t;return!!n&&n.reason===_i.RATE_LIMIT&&a===Ei.PLUS&&!s}const Oa=ze({search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),eg=l.memo(Qh),ks="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function tg({className:t,clientThreadId:s,message:n,onModelSelect:a,onDropdownChange:o,canRegenerateResponse:r}){const[c,u]=l.useState(null),[m,d]=l.useState(!1),[g,p]=l.useState(!1),f=He(s),x=qo({clientThreadId:s,message:n}),h=n.message.metadata?.model_slug,b=n.message.id,{modelOptions:S,modelSlug:_,animateModelLabelOnRender:w,messageModelEnabledTools:v}=x,C=$o(n.message),A=v.includes(qs.Search),j=l.useMemo(()=>S.find(T=>T.value===h),[S,h]),E=l.useRef(null),{doesUserHaveAnyAccountsWithPlusFeatures:N}=xo(),I=T=>{T||setTimeout(()=>{E.current&&E.current.blur()},10)};if(l.useEffect(()=>{I(m)},[m]),Ni(s))return null;const F=r&&S.some(T=>Qt(T,N));return f?null:e.jsxs(Re.Root,{onOpenChange:T=>{r&&(d(T),o(T),I(T)),T&&J.logEvent(Z.conversationOpenMessageModelSelector,{has_get_plus_button:F,is_new_regen_dropdown:!0})},children:[r?e.jsx(ng,{label:e.jsx(B,{id:"wDs5sz",defaultMessage:"Switch model"}),children:e.jsx(vo,{ref:E,className:R("cursor-pointer",t),onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),children:e.jsx(Ar,{modelSlug:_,animateModelLabelOnRender:w,isDropdownOpen:m,isRegenerateEnabled:r,isHovered:g,isRegenLabel:!0,omitIcon:!1})})}):null,r&&e.jsx(Re.Portal,{children:e.jsxs(Re.Content,{className:"z-30 min-w-fit origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[e.jsx(Re.Item,{disabled:!0,className:"pb-0 pt-2",children:e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(B,{id:"bFLh5u",defaultMessage:"Switch model"})})}),e.jsx(sg,{clientThreadId:s,messageId:b,onModelSelect:a,messageModelSlug:h,omitModelIcons:!0,modelOptions:S,setHoveredOption:u,hoveredOption:c,retryOption:j,lastResponseUsedSearch:C,modelSupportsSearch:A,doesUserHaveAnyAccountsWithPlusFeatures:N})]})})]})}function sg({clientThreadId:t,messageId:s,modelOptions:n,messageModelSlug:a,onModelSelect:o,omitModelIcons:r,setHoveredOption:i,hoveredOption:c,retryOption:u,lastResponseUsedSearch:m,modelSupportsSearch:d,doesUserHaveAnyAccountsWithPlusFeatures:g}){const p=Oe(),[f,x]=l.useMemo(()=>su(n,w=>w.subcategory),[n]),h=l.useMemo(()=>{const w=new Map;return f.forEach(v=>{const C=v.subcategory;C&&(w.has(C)||w.set(C,[]),w.get(C)?.push(v))}),w},[f]),b=R("icon-sm",r&&"order-10 ml-auto text-token-text-tertiary icon-md"),S=r?"right":"left",_=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:p.formatMessage(un.search),icon:e.jsx(Zn,{className:b}),condition:d&&!m,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:p.formatMessage(un.nosearch),icon:e.jsx(lr,{className:b}),condition:d&&m,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return e.jsxs(e.Fragment,{children:[x.map(w=>{const{value:v,...C}=w;return e.jsx(jt,{value:v,onSelect:()=>{he.logEvent("chatgpt_regenerate_switch_model_button_clicked",v,{requestedModelId:v,...Xe({clientThreadId:t,messageId:s})}),o({requestedModelId:v})},includeRegenerate:!1,onMouseEnter:()=>i(v),onMouseLeave:()=>i(null),isHovered:c===v,messageModelSlug:a,includeCheck:!1,shouldShowUpsell:Qt(w,g),className:ks,...C,icon:r?e.jsx("span",{className:b}):C.icon,justifyIcon:S,wrapIcon:!r},v)}),[...h.entries()].map(([w,v])=>e.jsxs(Re.Sub,{children:[e.jsx(Re.SubMenuTrigger,{children:e.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:w})}),e.jsx(Re.Portal,{children:e.jsx(Re.SubContent,{className:"min-w-fit",children:v.map(C=>{const{value:A,...j}=C;return e.jsx(jt,{value:A,onSelect:()=>{he.logEvent("chatgpt_regenerate_switch_model_button_clicked",A,{requestedModelId:A,...Xe({clientThreadId:t,messageId:s})}),o({requestedModelId:A})},includeRegenerate:!1,onMouseEnter:()=>i(A),onMouseLeave:()=>i(null),isHovered:c===A,messageModelSlug:a,includeCheck:!1,className:ks,...j,icon:null,justifyIcon:S,wrapIcon:!r,shouldShowUpsell:Qt(C,g)},w+"-"+A)})})})]},w)),!!u&&e.jsxs(e.Fragment,{children:[e.jsx(Re.Separator,{}),e.jsx(jt,{onSelect:()=>{he.logEvent("chatgpt_regenerate_try_again_button_clicked",u.value,{requestedModelId:u.value,...Xe({clientThreadId:t,messageId:s})}),o({requestedModelId:u.value})},includeRegenerate:!0,onMouseEnter:()=>i(u.value),onMouseLeave:()=>i(null),messageModelSlug:a,includeCheck:!1,className:ks,...u,label:p.formatMessage(un.tryAgain),subtitle:u.label,icon:e.jsx(Jn,{className:b}),justifyIcon:S,wrapIcon:!r},u.value),_.filter(w=>w.condition).map(w=>e.jsx(jt,{onSelect:()=>{he.logEvent(w.eventName,u.value,{requestedModelId:u.value,...Xe({clientThreadId:t,messageId:s})}),o({requestedModelId:u.value,extraStreamParams:w.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>i(w.key),onMouseLeave:()=>i(null),isHovered:c===w.key,messageModelSlug:a,includeCheck:!1,className:ks,...u,label:w.label,subtitle:"",icon:w.icon,justifyIcon:S,wrapIcon:!r},w.key))]})]})}function ng({children:t,label:s}){return e.jsx(Jt,{label:s,sideOffset:0,children:t})}const un=ze({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),ag=l.memo(tg),za=We(()=>Ve(()=>import("./nms257ef1lzn00g8.js").then(t=>t.oL),__vite__mapDeps([4,1,2,3,5])).then(t=>t.MemoryActionResult));function Ua(t,s,n){Q.updateTree(t,a=>{a.updateNodeMetadata(s,{inlineComparisonRating:n})})}function Ga(t){return{is_dark_mode:t==="dark",time_since_loaded:Math.floor(performance.now()/1e3),page_height:window?.innerHeight,page_width:window?.innerWidth,pixel_ratio:window?.devicePixelRatio,screen_height:window?.screen?.height,screen_width:window?.screen?.width}}const Wa=({messages:t})=>{for(const{message:{metadata:s}}of t){const{augmented_paragen_prompt_label:n}=s??{};if(n)return n}};function og(t){const s=l.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),n=l.useRef({left:null,right:null});return t.stubSideBySideFeedback?e.jsx(Pr,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:s,firstVisibleTokenTimestampsRef:n,...t}):e.jsx(rg,{...t,visibilityStateRef:s,firstVisibleTokenTimestampsRef:n})}function rg(t){const{clientThreadId:s,variantIds:n,variantsInStreamInfo:a,turnIndex:o,firstVisibleTokenTimestampsRef:r}=t;if(n.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const i=aa(),c=lg(),u=In(),{resolvedTheme:m}=Ri(),[d,g]=l.useMemo(()=>Ko(n.join(""))()<.5?[0,1]:[1,0],[n[0],n[1]]),p=d<g?"left":"right",f=p==="left"?"right":"left",x=n[d],h=n[g],b=wt(ya(s,x)).id,S=wt(ya(s,h)).id,_=wt(pn(s,o,b)),w=wt(pn(s,o,S)),v=p==="left"?_:w,C=p==="left"?w:_,A=a.display_treatment==="unskippable",j=i?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";l.useEffect(()=>(xn.setState({displayingSideBySideFeedback:!0,unskippable:A}),()=>{xn.setState({displayingSideBySideFeedback:!1,unskippable:!1})}),[A]),nu();const E=l.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});l.useEffect(()=>Ai(Pi,{requestCompletion:()=>{const I=Ke(v.messages)?.completionSampleFinishTime,L=Ke(C.messages)?.completionSampleFinishTime,F=Q.getServerThreadId(s);if(c){const P=Q.getTree(s).getParentPromptNode(b),U=[_,w].map((y,q)=>({messageId:y.messages[y.messages.length-1].message.id,loadFirstTokenTime:q===0?r.current.left:r.current.right,loadEndTime:Ke(y.messages)?.completionSampleFinishTime})),k={},G=P.metadata?.variantsInStreamInfo==null&&P.message.metadata?.paragen_variants_info!=null;for(const y of U)k[y.messageId]=G?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:y.loadFirstTokenTime,load_end_time:y.loadEndTime};_s({shouldUseNewParagenEndpoint:c,params:{conversation_id:F,displayed_message_ids:U.map(y=>y.messageId),message_metadatas:k,rating:"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:i?2:1,user_prompt_message_id:P.message.id}})}else _s({shouldUseNewParagenEndpoint:c,params:{feedback_version:j,original_message_id:v.messages[v.messages.length-1]?.message.id,new_message_id:C.messages[C.messages.length-1]?.message.id,conversation_id:F,completion_comparison_rating:"skip",new_completion_placement:f,feedback_start_time:t.conversationTurnMountTime,compare_step_start_time:t.conversationTurnMountTime,original_completion_load_start_time:t.conversationTurnMountTime,original_completion_load_end_time:I??0,new_completion_load_start_time:t.conversationTurnMountTime,new_completion_load_end_time:L??0,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:Ga(m),...E.current}})}}),[_,w,b,s,t.conversationTurnMountTime,j,f,v?.messages,C?.messages,m,c,i,r]);const N=I=>{const F=Q.getTree(s).getLeafFromNode(I);Q.setThreadCurrentLeafId(s,F.id);const T=I===x,P=T===(p==="left"),U=Ke(v.messages)?.completionSampleFinishTime,k=Ke(C.messages)?.completionSampleFinishTime;v.messages.length>0&&Ua(s,v.messages[v.messages.length-1].nodeId,P?"original":"new"),C.messages.length>0&&Ua(s,C.messages[C.messages.length-1].nodeId,P?"original":"new");let G;U==null||k==null?G=P?"partial_load_comparison_original":"partial_load_comparison_new":G=P?"original":"new";const y=Q.getServerThreadId(s);if(c){const q=[_,w].map((X,ge)=>({messageId:X.messages[X.messages.length-1].message.id,loadFirstTokenTime:ge===0?r.current.left:r.current.right,loadEndTime:Ke(X.messages)?.completionSampleFinishTime})),Y=T?q[0].messageId:q[1].messageId,V=Q.getTree(s).getParentPromptNode(b),xe={},le=V.metadata?.variantsInStreamInfo==null&&V.message.metadata?.paragen_variants_info!=null;for(const X of q)xe[X.messageId]=le?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:X.loadFirstTokenTime,load_end_time:X.loadEndTime};_s({shouldUseNewParagenEndpoint:c,params:{conversation_id:y,displayed_message_ids:q.map(X=>X.messageId),message_metadatas:xe,rating:"selected",selected_message_id:Y,source_timestamp:Date.now(),ui_variant:i?2:1,user_prompt_message_id:V.message.id}})}else _s({shouldUseNewParagenEndpoint:c,params:{feedback_version:j,original_message_id:v.messages[v.messages.length-1]?.message.id,new_message_id:C.messages[C.messages.length-1]?.message.id,conversation_id:y,completion_comparison_rating:G,new_completion_placement:f,feedback_start_time:t.conversationTurnMountTime,compare_step_start_time:t.conversationTurnMountTime,original_completion_load_start_time:t.conversationTurnMountTime,original_completion_load_end_time:U??null,new_completion_load_start_time:t.conversationTurnMountTime,new_completion_load_end_time:k??null,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:Ga(m),...E.current}})};return e.jsx(Pr,{...t,setPreferredFeedback:N,leftVariantId:x,rightVariantId:h,leftTurn:_,rightTurn:w,hasActiveRequest:u,originalTurn:v,visibilityStateRef:E})}function ig(t){if(!t.length)return!1;const s=t.filter(n=>n.type===_a.Text||n.type===_a.MultiText).filter(n=>n.message.message.status!=="finished_successfully"&&n.message.message.metadata?.snorkle_status!==void 0);return s.length>0&&s.every(n=>{const a=n.message.message.content;return a?.content_type===So.Text&&a.parts.join("")===""})}function Pr({setPreferredFeedback:t,leftVariantId:s,rightVariantId:n,leftTurn:a,rightTurn:o,hasActiveRequest:r,originalTurn:i,visibilityStateRef:c,...u}){const{defaultParagenLabel:m,shouldShowParagenLabels:d=!1}=Po(),g=a&&Wa(a)||m,p=o&&Wa(o)||m,f=l.useMemo(()=>a?.messages??[],[a?.messages]),x=l.useMemo(()=>o?.messages??[],[o?.messages]),{avatarClassName:h,firstVisibleTokenTimestampsRef:b}=u,S=l.useMemo(()=>Ls(f),[f]),_=l.useMemo(()=>Ls(x),[x]),w=jo(),[v,C]=l.useMemo(()=>[S,_].map(q=>ig(q)),[S,_]),A=ut(a?Ps.getRequestIdFromConversationTurn(a):"")||v,j=ut(o?Ps.getRequestIdFromConversationTurn(o):"")||C,E=a?.role===Le.User,N=o?.role===Le.User,I=l.useRef(null),L=l.useRef(null),F=l.useRef(null),T=u.stubSideBySideFeedback||v,P=u.stubSideBySideFeedback||C;!T&&b.current.left==null&&(b.current.left=Date.now()),!P&&b.current.right==null&&(b.current.right=Date.now()),l.useEffect(()=>{if(I.current&&L.current&&F.current){const q=Array(11).fill(0).map((ee,V)=>V/10),Y=new IntersectionObserver(ee=>ee.forEach(V=>{V.target===L.current?(c.current.left_visibility_initial==null&&(c.current.left_visibility_initial=V.intersectionRatio),c.current.left_visibility_max=Math.max(c.current.left_visibility_max??0,V.intersectionRatio)):V.target===F.current&&(c.current.right_visibility_initial==null&&(c.current.right_visibility_initial=V.intersectionRatio),c.current.right_visibility_max=Math.max(c.current.right_visibility_max??0,V.intersectionRatio))}),{root:I.current,threshold:q});return Y.observe(L.current),Y.observe(F.current),()=>Y.disconnect()}},[c]);const{data:U}=To(void 0,!1,w),k=aa(),G=e.jsx("div",{className:"text-pretty px-6 pb-5 pt-1 text-center text-sm text-token-text-secondary",children:e.jsx(B,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),y=et();return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:R("sticky z-[1] text-pretty bg-token-main-surface-primary px-6 text-center text-lg",y&&"top-[var(--thread-leading-height)] pt-3",!y&&"top-[-1px]",k&&!y?"md:top-header-height":y?"":"md:static"),"data-testid":"paragen-feedback-title",children:[e.jsx(B,{id:"JgCHDY",defaultMessage:"You’re giving feedback on a new version of ChatGPT."}),k?G:null]}),k?null:G,e.jsx("div",{className:"relative -mb-2 snap-x snap-mandatory overflow-x-auto px-3 pb-4 md:px-5 lg:px-10",ref:I,children:e.jsx("div",{className:R(!y&&"min-w-fit"),children:e.jsxs("div",{className:R("mx-auto flex max-w-6xl items-start",k&&!y&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",!k&&!y&&"gap-4 sm:gap-6",k&&y&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",y&&!k&&"gap-4 sm:gap-6"),children:[e.jsxs(Va,{horizontalScrollContainerRef:I,rootElementRef:L,onClick:()=>{t(s)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:T,children:[e.jsxs(Ka,{children:[e.jsx(yn,{messages:f,isUserTurn:E,avatarClassName:h}),e.jsx($a,{children:d?e.jsx("span",{className:"font-bold text-token-text-primary",children:g}):e.jsx(B,{...Xa.responseNumber,values:{responseIndex:1}})})]}),k&&T?e.jsx(qa,{}):e.jsxs(e.Fragment,{children:[U!=null&&!E&&e.jsx(za,{clientThreadId:u.clientThreadId,messages:f,isParagen:!0}),e.jsx(Tn,{...u,groupedMessagesToRender:S,allGroupedMessages:S,isEditing:!1,isUserTurn:E,isCompletionRequestInProgress:A,hasActiveRequest:r,handleEnterEdit:ws,handleExitEdit:ws,shouldGrowContainer:!1}),e.jsx(Ya,{clientThreadId:u.clientThreadId,conversationTurnMountTime:u.conversationTurnMountTime,turn:a,originalTurn:i})]})]}),e.jsxs(Va,{horizontalScrollContainerRef:I,rootElementRef:F,onClick:()=>{t(n)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:P,children:[e.jsxs(Ka,{children:[e.jsx(yn,{messages:x,isUserTurn:N,avatarClassName:h}),e.jsx($a,{children:d?e.jsx("span",{className:"font-bold text-token-text-primary",children:p}):e.jsx(B,{...Xa.responseNumber,values:{responseIndex:2}})})]}),k&&P?e.jsx(qa,{}):e.jsxs(e.Fragment,{children:[U!=null&&!N&&e.jsx(za,{clientThreadId:u.clientThreadId,messages:x,isParagen:!0}),e.jsx(Tn,{...u,groupedMessagesToRender:_,allGroupedMessages:_,isEditing:!1,isUserTurn:N,isCompletionRequestInProgress:j,hasActiveRequest:r,handleEnterEdit:ws,handleExitEdit:ws,shouldGrowContainer:!1}),e.jsx(Ya,{clientThreadId:u.clientThreadId,conversationTurnMountTime:u.conversationTurnMountTime,turn:o,originalTurn:i})]})]})]})})})]})}function Va({horizontalScrollContainerRef:t,rootElementRef:s,onClick:n,children:a,hasActiveRequest:o,isWaitingOnFirstUserVisibleToken:r}){const i=aa(),c=et(),{scrollX:u}=au({layoutEffect:!1,container:t,target:s}),m=ou(),d=ru(),g=l.useRef(null),p=l.useRef(null),f=l.useRef(null),[x,h]=l.useState(!1),[b,S]=l.useState(!1),[_,w]=l.useState(!1),[v,C]=l.useState(0);l.useEffect(()=>{if(!i)return;const F=new IntersectionObserver(T=>{for(const P of T)P.target===g.current?h(P.isIntersecting):P.target===f.current?w(P.isIntersecting):P.target===p.current&&S(P.isIntersecting)},{root:m?.current,rootMargin:c?`0px 0px -${v}px 0px`:void 0});return g.current&&p.current&&f.current&&(F.observe(g.current),F.observe(p.current),F.observe(f.current)),()=>{F.disconnect()}},[v,i,c,m]);const A=!_&&(b||x),j=iu(u,F=>A?-1*F:0),E=ka(0);l.useEffect(()=>{if(!i)return;const F=new ResizeObserver(T=>{js(T.length===1,"entryList.length === 1");const P=T[0];js(P.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),E.set(P.contentBoxSize[0].inlineSize)});return s.current&&F.observe(s.current),()=>{F.disconnect()}},[i,E,s]);const N=ka(0);l.useEffect(()=>{if(!i)return;const F=new ResizeObserver(T=>{js(T.length===1,"entryList.length === 1");const P=T[0];js(P.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),N.set(P.contentBoxSize[0].blockSize+16),C(P.contentBoxSize[0].blockSize)});return d.current&&F.observe(d.current),()=>{F.disconnect()}},[i,N,d]);const I=e.jsx(Nt,{className:i?"px-5":"mt-4 self-start",onClick:n,"data-testid":"paragen-prefer-response-button",children:e.jsx(B,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),L=r;return e.jsxs("div",{"data-paragen-root":!0,className:R("relative flex w-full min-w-[min(450px,80vw)] snap-center flex-col gap-1 text-left",c&&i&&"pl-3 pr-5 sm:w-[calc(100cqw-62px)] sm:pl-3 sm:pr-5 md:px-10",!c&&i&&"px-10",i?"min-h-60 py-4":"rounded-2xl border border-token-main-surface-tertiary bg-white p-5 dark:bg-gray-700"),ref:s,children:[e.jsx("div",{className:R("absolute left-0 right-0 top-48 h-px","invisible"),ref:g}),e.jsx("div",{className:R("absolute bottom-0 left-0 right-0 top-48","invisible"),ref:p}),e.jsx("div",{className:R("absolute bottom-0 left-0 right-0 h-px","invisible"),ref:f}),a,i?e.jsx("div",{className:"flex-1"}):null,i?e.jsx("div",{className:"mt-4 min-h-10",children:L?null:e.jsx(ne.div,{style:{translateX:j,width:E,bottom:N},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:R({fixed:A,"z-20 flex w-full justify-center":!0}),children:I})}):o?null:I]})}function qa(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pb-5 pt-3",children:[e.jsx(rt,{className:"h-4 w-[75%]"}),e.jsx(rt,{className:"h-4 w-[50%]"}),e.jsx(rt,{className:"h-4 w-[80%]"}),e.jsx(rt,{className:"h-4 w-[55%]"}),e.jsx(rt,{className:"h-4 w-[66%]"}),e.jsx(rt,{className:"h-4 w-[64%]"}),e.jsx(rt,{className:"h-4 w-[48%]"})]})}function aa(){const{layer:t}=Qe("3119715334");return t.get("should-enable-hojicha",!1)}const $a=ye.div`text-sm text-token-text-secondary font-semibold`,Ka=ye.div`flex gap-4 items-center mb-1`,rt=ye.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function Ya({clientThreadId:t,conversationTurnMountTime:s,turn:n,originalTurn:a}){const o=qn();if(!o.showParagenMetadata||!o.showDebugConversationTurns&&!o.forceParagen||n==null)return null;let r=n===a?"ORIGINAL":"NEW";const i=n.messages[n.messages.length-1],c=i?.message?.metadata?.__internal;if(c){const{model_id:g,model_definition_slug:p,model_definition_virtual_model_id:f,alternative_model_selection_rule:x,augmented_paragen_prompt_group_id:h,augmented_paragen_prompt_id:b,augmented_paragen_prompt:S}=c;g&&(r+=`
Model ID: ${g}`),p&&(r+=`
Model Slug: ${p}`),f&&(r+=`
Virtual Model ID: ${f}`),x&&(r+=`
Alternative Model Rule: ${x}`),h&&(r+=`
Prompt Group ID: ${h}`),b&&(r+=`
Prompt ID: ${b}`),S&&(r+=`
Prompt: ${S}`)}r+=`
Message ID: ${i.message.id}`;const m=Q.getTree(t).getParentPromptNode(n.variantIds[0]),d=m.metadata?.variantsInStreamInfo==null&&m.message.metadata?.paragen_variants_info!=null;return r+=`
User prompt message ID: ${m.message.id}`,r+=`
Is Persisted Paragen? ${d}`,r+=`
Completion Sample Finish Time: ${d?`${s} (persisted)`:Ke(n.messages)?.completionSampleFinishTime}`,e.jsx("div",{className:"whitespace-pre-wrap text-sm text-red-500",children:r})}async function _s({shouldUseNewParagenEndpoint:t,params:s}){t?await kt.submitParagenSelectionV2(s):await kt.submitMessageComparisonFeedback(s)}function lg(){const{value:t}=Ze("3894844102");return t}const Xa=ze({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}"}}),Qa=[1,2,3,4,10,20,30],cg=.5;function ug({clientThreadId:t,conversationLeafId:s}){const n=Yo(Xo.isBusinessWorkspace),a=l.useRef(!1),o=es(t),r=Gs(t),{isUnauthenticated:i}=Ge(),c=l.useMemo(()=>{if(!o)return-1;const N=Ko(o);return N()>cg?-1:Qa[Math.floor(N()*Qa.length)]},[o]),u=Ii(t,s),m=u[u.length-1],d=l.useMemo(()=>Ps.getRequestIdFromConversationTurn(m),[m]),g=ut(d),[p,f]=l.useState(null),[x,h]=l.useState(!1),[b,S]=l.useState(!1),[_,w]=l.useState(!1),v=N=>{const I=Ke(u)?.messages[0]?.message.id;f(N),j(I,N)},C=u.filter(N=>N.role===Le.Assistant).length,A=m?.role===Le.Assistant,j=l.useMemo(()=>Go((N,I)=>{o&&N&&kt.submitConversationRating({conversation_id:o,message_id:N,rating:I,shown_at_assistant_turn:c}),J.logEvent(Z.conversationRatingSubmitted,{rating:I,showAtAssistantTurn:c,conversationId:o}),h(!0),setTimeout(()=>{S(!0)},1500)},2e3),[o,c]),E=C!==c||g||!A||!!n||r?.kind!==dt.PrimaryAssistant||_||i;return l.useEffect(()=>{!E&&!a.current&&(J.logEvent(Z.conversationRatingShown,{showAtAssistantTurn:c,conversationId:o}),a.current=!0)},[E]),_||E?null:e.jsxs("div",{className:"mx-auto",children:[e.jsx(ns,{children:x&&!b&&e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(Za,{$padded:!0,children:e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(B,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!x&&e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:e.jsxs(Za,{$padded:!1,children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-secondary",children:[e.jsx(B,{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(dn,{$selected:p==="thumbsUp",onClick:()=>v("thumbsUp"),children:e.jsx(cr,{className:"icon-md"})}),e.jsx(dn,{$selected:p==="thumbsDown",onClick:()=>v("thumbsDown"),children:e.jsx(ur,{className:"icon-md"})})]})]}),e.jsx("div",{className:"w-px flex-1 self-stretch bg-token-main-surface-tertiary"}),e.jsx(dn,{className:"p-3",$selected:!1,onClick:()=>w(!0),children:e.jsx(wd,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const dn=ye.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,Za=ye.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`,dg=We(()=>Ve(()=>import("./ild7syzsaem5vtnl.js"),__vite__mapDeps([26,1,2,3,4,5,27,17])));function mg({clientThreadId:t,conversationLeafId:s,canShowInlineMessageFeedback:n,messageForRating:a,allGroupedMessages:o,currentModelId:r}){let i=null;const c=Di(t,s),u=es(t),m=$n(p=>p.voiceFeedbackThread),d=u===m,{voiceName:g}=lu();return c?null:(d&&u?(Fi.feedbackShown.success({voice:g}),i=e.jsx("div",{className:"text-center",children:e.jsx(cu,{serverThreadId:u})})):a.rating&&n?i=e.jsx(dg,{clientThreadId:t,conversationMessage:a,allGroupedMessages:o,currentModelId:r}):i=e.jsx("div",{className:"text-center",children:e.jsx(ug,{clientThreadId:t,conversationLeafId:s})}),e.jsx("div",{className:"mt-3 w-full empty:hidden",children:i}))}const hg=We(()=>Ve(()=>import("./fndx8pddxuhest4p.js"),__vite__mapDeps([28,1,2,3,4,5,29])).then(t=>t.VoicePlayButton)),Ja=128,eo={minHeight:"calc(100cqh - var(--thread-leading-height) - var(--thread-trailing-height) - var(--previous-turn-min-height))"};function gg(t){const{turnIndex:s,conversationLeafId:n,isFinalTurn:a,clientThreadId:o,onChangeItemInView:r,onChangeRating:i,currentModelId:c,avatarClassName:u,showAvatar:m=!0,scrollToMessageId:d,shouldShowDateHeader:g}=t,p=Oe(),f=zn(),x=!!f&&Li(f),h=Pn(),b=Yo(Xo.isBusinessWorkspace),S=lo(),{value:_}=Ze("2848981774"),w=Q.getServerThreadId(o),v=wt(pn(o,s,n)),{messages:C,variantIds:A,variantsInStreamInfo:j}=v,E=Ls(C),N=uu();let I=C[C.length-1];for(const z of E){const fe=Ld(z);if(fe.some($e=>N.has($e.message.id))){I=fe[fe.length-1];break}}const L=C.slice(0,C.indexOf(I)+1),F=zo(),[T,P]=l.useState(!1),[U,k]=l.useState(!1),G=A.findIndex(z=>L.some(fe=>fe.nodeId===z)),y=v.role===Le.User,q=ts(),Y=He(o),ee=ss(v.gizmoId??Y)?.data,V=Xn(c),xe=du(c),le=et(),X=Gs(o,ee?.gizmo.id),oe=uo(o)===mo.STREAMING,Te=!1,{value:ve}=fo("2291672486"),Me=L.some(z=>z.message.content.content_type===So.MultimodalText),{layer:Ce}=Qe("1547743984"),ke=w&&F&&Ce.get("show_share_button_inline",!1),{isUnauthenticated:Se}=Ge(),[De,ce]=l.useState(!1),[O,D]=l.useState(!1),te=v.messages.map(z=>z.message.id),W=l.useRef(null),H=C[C.length-1],K=H.rating,pe=(d?.length??0)>2&&d!=="finalAgentTurn"&&a&&_&&le,ae=()=>{L.length===1&&(J.logEvent(Z.editPrompt,{id:L[0].message.id,threadId:Q.getServerThreadId(o)}),he.logEvent("chatgpt_edit_prompt"),P(!0))},_e=l.useCallback(()=>{P(!1)},[]),$=l.useCallback(z=>{mu(o,s,S,z)},[o,s,S]),ue=z=>{i({nodeId:H.nodeId,messageId:H.message.id,rating:z}),J.logEvent(z==="thumbsDown"?Z.messageFeedbackThumbsDownClicked:Z.messageFeedbackThumbsUpClicked,{id:H.message.id,threadId:Q.getServerThreadId(o),model:c,rating:z}),k(!0)},[Ue]=l.useState(()=>Date.now()),re=l.useMemo(()=>Ps.getRequestIdFromConversationTurn(v),[v]),Ae=ho({clientThreadId:o,conversationLeafId:n}),de=ut(re)&&!Ae,os=In(),Ys=Ls(L),gt=l.useRef(!1);l.useEffect(()=>{if(gt.current||d===void 0||!_||!le||!W.current){d==="finalAgentTurn"&&a&&gt.current&&Q.updateScrollToMessageId(o,void 0);return}(te.includes(d)||d==="finalAgentTurn"&&a)&&(gt.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(W.current)if(d==="finalAgentTurn"&&a)W.current.scrollIntoView({behavior:"instant",block:"end"}),Q.updateScrollToMessageId(o,void 0);else{const z=W.current.offsetHeight;let fe;z>Ja?fe=Ja-z:fe=0,W.current.style.scrollMarginTop=`calc(${fe}px + 2px + var(--thread-leading-height))`,W.current.scrollIntoView({behavior:"smooth"})}})}))},[d,W.current]);const{showDebugConversationTurns:tt}=qn(),At=po(o),je=Vo(o),st=hu({clientThreadId:o,conversationMode:X}),Xs=Je(o),nt=l.useCallback(({requestedModelId:z,systemMessage:fe,juice:$e,extraStreamParams:Ht})=>{const xs=new qt;st({id:H.nodeId,eventMetadata:{eventSource:"mouse"},turnTracker:xs,requestedModelId:z,systemMessage:fe,juice:$e,extraStreamParams:Ht})},[H,st]),Pt=Te,It=!h&&!At&&!q&&!y,Dt=gu(),pt=I.message.author.role===Le.Assistant?I.message:null;pu({isCompletionRequestInProgress:de,isUserTurn:y,message:pt});const rs=Hi(o,A),{isOpen:is}=fu(),Pe=xu(X),Ft=!Dt&&!Pe&&It&&a&&j?.num_variants_in_stream===2&&!H.inlineComparisonRating&&!rs,Qs=vu(v),ft=Ft,ls=Ft&&!Qs,xt=!y&&!h&&!At&&!Pe&&!oe&&!de&&!is,vt=xt&&(!b||Pt||xe||x)&&!Pe&&!Se&&!q,qe=!h&&!((de||oe)&&a)&&A.length>1&&!T&&!ft;let Bt=!1;if(y&&L.length===1){const{shouldHideContent:z}=Su(L[0]);z&&(Bt=!0)}const cs=y&&!Pe&&!h&&!Me&&L.length===1&&!Bt&&!T&&!Se,St=z=>{r(A[z]),J.logEvent(Z.changeNode,{intent:"toggle_between"})};if(!bu(v,L,tt)&&!ft)return pe?e.jsx("div",{style:eo}):null;const Lt=L.some(({message:z})=>Oi.getAssetPointers(z).length>0),Zs=!Lt&&a&&je&&!ve?e.jsx(Ts,{onClick:()=>{he.logEvent("chatgpt_regenerate_try_again_button_clicked",c,{requestedModelId:c,...Xe({clientThreadId:o,turnIndex:s})});const z=new qt;st({id:Xs,eventMetadata:{eventSource:"mouse"},turnTracker:z}),Is()},icon:Jn,label:p.formatMessage({id:"ConversationTurn.regenerateTooltip",defaultMessage:"Regenerate"}),testId:"regenerate-turn-action-button"}):null,ds="h-[30px] rounded-md px-1 text-token-text-secondary hover:bg-token-main-surface-secondary",ms=!Lt&&ve?e.jsx(ag,{className:ds,clientThreadId:o,message:H,onModelSelect:nt,onDropdownChange:ce,canRegenerateResponse:je}):null,hs=!y&&!Bt&&(!a||!de)?e.jsx(Eu,{onClick:$}):null,bt=!y&&(!a||!de)&&(H.disclaimers??[]).length===0&&H.nodeId?e.jsx(hg,{conversationId:o,message:H,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-xs text-token-text-tertiary hover:text-token-text-primary"}):null,Js=!y&&H&&(!a||!de)?e.jsx(Nu,{message:H,isFinalTurn:a,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-token-text-tertiary hover:text-token-text-primary"}):null,en=vt&&!de?e.jsxs("div",{className:"flex",children:[K!=="thumbsDown"&&e.jsx(Ts,{onClick:()=>ue("thumbsUp"),disabled:K==="thumbsUp",icon:K==="thumbsUp"?jd:cr,label:p.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"},`thumbsUp:${H.nodeId}`),K!=="thumbsUp"&&e.jsx(Ts,{onClick:()=>ue("thumbsDown"),disabled:K==="thumbsDown",icon:K==="thumbsDown"?Td:ur,label:p.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"},`thumbsDown:${H.nodeId}`)]}):null,gs=ke&&e.jsx(Ts,{onClick:()=>{Bs.openSharingModal(w)},label:p.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:Md}),ps=!ve&&e.jsx(eg,{className:ds,clientThreadId:o,message:H,onModelSelect:nt,onDropdownChange:ce});function at(z){return le?z:e.jsx(Yn,{clientThreadId:o,isStaticSharedThread:h,withVerticalPadding:!0,withHorizontalPadding:!ft,children:z})}function fs(z){return le?z:e.jsx($t,{children:z})}return e.jsxs(e.Fragment,{children:[g&&e.jsx(yu,{turn:v}),e.jsxs("article",{className:R("w-full scroll-mb-[var(--thread-trailing-height,150px)] text-token-text-primary focus-visible:outline-2 focus-visible:outline-offset-[-4px]",d==="finalAgentTurn"&&_&&le?"opacity-0":""),style:pe?eo:void 0,ref:W,dir:"auto","data-testid":`conversation-turn-${s}`,"data-scroll-anchor":a,onMouseEnter:()=>D(!0),onMouseLeave:()=>D(!1),children:[e.jsx(wu,{role:v.role}),at(e.jsx(e.Fragment,{children:ft?e.jsx(og,{isFeedbackEnabled:vt,variantIds:A,variantsInStreamInfo:j,conversationTurnMountTime:Ue,stubSideBySideFeedback:ls,...t}):fs(e.jsxs(e.Fragment,{children:[!y&&m&&e.jsx(pg,{children:e.jsx(yn,{messages:L,isUserTurn:y,avatarClassName:u,gizmo:ee})}),e.jsx("div",{className:R("group/conversation-turn relative flex w-full min-w-0 flex-col",!y&&ju),children:e.jsx("div",{className:"flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[!y&&!h&&e.jsx(Tu,{messages:L,clientThreadId:o,gizmoId:ee?.gizmo.id}),!1,e.jsx(Tn,{groupedMessagesToRender:Ys,allGroupedMessages:E,...t,isEditing:T,isUserTurn:y,isCompletionRequestInProgress:de,isFeedbackEnabled:vt,isFinalTurn:a,hasActiveRequest:os,showEditButton:cs,handleEnterEdit:ae,handleExitEdit:_e}),V&&e.jsx("div",{className:"mb-4",children:e.jsx(Mu,{messages:L})}),(xt||qe)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:R("mb-2 flex gap-3 empty:hidden",y?"mr-1 flex-row-reverse":"-ml-2"),children:e.jsx(Cu,{alwaysShow:a,showInline:a||qe,isHovered:O||De,pagination:qe&&e.jsx(ku,{showInline:a||qe,currentPage:G,onChangeIndex:St,length:A.length,className:R("self-center",A.length>1?"visible":"!invisible")}),actions:xt&&e.jsxs(e.Fragment,{children:[bt,hs,Zs,en,Js,ps,gs,ms]})})}),xt&&!de?e.jsx("div",{className:"pr-2 lg:pr-0",children:e.jsx(_u,{message:H,isFinalTurn:a})}):null,a&&!de&&e.jsx(mg,{canShowInlineMessageFeedback:U,clientThreadId:o,conversationLeafId:n,messageForRating:H,allGroupedMessages:E,currentModelId:c})]})]})})})]}))}))]})]})}const Nn=Bi.memo(gg),pg=ye.div`flex-shrink-0 flex flex-col relative items-end`;function fg({onChangeItemInView:t,onRequestMoreCompletions:s,onChangeRating:n,onRequestCompletion:a,clientThreadId:o,conversationLeafId:r,hideHeader:i}){const c=we(),u=Ws(),m=Ru(),[d]=Au(),g=Pu(),[p]=Iu(),f=Gs(o),x=zs(),h=Du(o),b=zi(o),S=c.store.useContentAreaDimensions(_t.Header,y=>y?.height?y.height:void 0),_=c.store.useIsHeaderContentAreaPopulated(),w=bo(o),{isArchived:v}=w,C=Fu(h.id),A=f?.kind===dt.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":C,j=Vs(o,r),E=Bu(),[N,I]=l.useState(0),[L,F]=l.useState(!1);l.useEffect(()=>{u&&(N===0?I(j):!L&&j>N&&(F(!0),he.logEvent("chatgpt_continue_conversation_first_message_sent"),J.logEvent(Z.continueConversationFirstMessageSent)))},[j,N,L,u]),l.useEffect(()=>{u&&(he.logEvent("chatgpt_continue_conversation_page_loaded"),J.logEvent(Z.continueConversationPageLoaded))},[u]);const T=l.useCallback(()=>{m({behavior:"smooth"})},[m]),P=Lu(o),U=E&&!v,k=Qo(o,r),G=(y,q,Y)=>[...new Array(q-y).keys()].map(ee=>{const V=ee+y;return e.jsx(Nn,{isFinalTurn:Y(V),turnIndex:V,clientThreadId:o,conversationLeafId:r,onChangeItemInView:t,onChangeRating:n,onRequestMoreCompletions:s,onRequestCompletion:a,currentModelId:h.id,avatarClassName:A,scrollToBottom:T,shouldShowDateHeader:k(V)},V)});return e.jsxs("div",{onCopy:P,className:R("flex flex-col text-sm",U&&"pb-[120px]",S||U?null:"md:pb-9"),style:{paddingBottom:U?void 0:S},children:[!i&&x?.data&&e.jsx(Nr,{clientThreadId:o}),u&&e.jsxs(e.Fragment,{children:[e.jsx($t,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(B,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),j-N===0&&e.jsx("div",{className:"text-center text-xs font-semibold text-token-text-primary",children:e.jsx("button",{onClick:()=>{Bs.openModal(Hu.ReportConversation),he.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),J.logEvent(Z.sharedConversationReportContentClicked,{location:"Dynamic Shared Thread Page"})},children:e.jsx(B,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})}),G(0,N,y=>y===N-1),e.jsx($t,{children:e.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(Cd,{className:"icon-xs mr-2"}),e.jsx(B,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})}),G(N,j,y=>y===j-1)]}),!u&&G(0,j,y=>y===j-1),b&&d&&!p&&e.jsx(to,{className:R("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{he.logEvent("chatgpt_thread_scroll_to_top"),g({behavior:"smooth"})},children:e.jsx(kd,{className:"icon-md text-token-text-primary"})}),!d&&e.jsx(to,{className:R(S?null:"bottom-5",U?_?"translate-y-[-50px]":"translate-y-[-10px]":""),style:{bottom:E?"calc(var(--composer-bar_footer-current-height) + var(--composer-bar_current-height))":S},onClick:()=>{he.logEvent("chatgpt_thread_scroll_to_bottom"),m({behavior:"smooth"})},children:e.jsx(_d,{className:"icon-md text-token-text-primary"})})]})}const to=ye.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-light right-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`,xg=60,vg=({children:t,scrollViewClassName:s,scrollAnchorTopOffset:n=0})=>{const a=l.useRef(null);return e.jsx("div",{className:"h-full",ref:a,children:e.jsx(Fn,{children:e.jsx(Rd,{className:"h-full",followButtonClassName:"hidden",initialScrollBehavior:"auto",scrollViewClassName:s,scroller:()=>Sg(a,n)?0:1/0,children:t})})})},Sg=(t,s)=>{const n=bg(t.current);if(n==null)return!1;const a=n>s,o=n<s-xg;return!a&&!o};function bg(t){if(!t)return null;const s=t.querySelector('[data-scroll-anchor="true"]');if(!s)return null;const n=s.getBoundingClientRect().top,a=t.getBoundingClientRect().top;return n-a}const yg=We(()=>Ve(()=>import("./eoczgx28u20zdnrj.js"),__vite__mapDeps([30,1,2,3,4,5,31,32,33,34,29,35])).then(t=>t.OpenDebugSidebarButton)),wg=We(()=>Ve(()=>import("./cyrq1sz3ujh1kr9k.js"),__vite__mapDeps([36,1,2,3,4,5,37,17]))),so=ze({doNotShareSensitive:{id:"thread.modal.onboarding.title",defaultMessage:"Do not share sensitive materials with this application"},somethingWentWrong:{id:"thread.modal.unrecoverableError.title",defaultMessage:"Something went wrong"},tryAgainLater:{id:"thread.modal.unrecoverableError.description",defaultMessage:"We're sorry, but something went wrong. Please try again later."},resetThread:{id:"thread.modal.unrecoverableError.resetThread",defaultMessage:"Reset thread"},sharedConversationReportConversation:{id:"thread.sharedConversation.report",defaultMessage:"Report conversation"},latencyButton:{id:"thread.latencyButton",defaultMessage:"Latency"},archivedConversationDescription:{id:"thread.archivedConversationDescription",defaultMessage:"This conversation is archived. To continue, please unarchive it first."},unarchiveButton:{id:"thread.unarchiveButton",defaultMessage:"Unarchive"}});function jg({clientThreadId:t}){const s=go(),n=es(t),a=async()=>{n&&(await kt.patchConversation(n,{is_archived:!1}),s.invalidateQueries({queryKey:["conversation",t]}),Dn.setState(o=>{const r=o.threads[n];r!=null&&(r.initialThreadData.isArchived=!1)}),Zu(s))};return e.jsxs("div",{className:"my-6 flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"px-3 text-center text-sm text-token-text-secondary",children:e.jsx(B,{...so.archivedConversationDescription})}),e.jsx("div",{children:e.jsx(Nt,{disabled:!n,onClick:a,icon:Ed,children:e.jsx(B,{...so.unarchiveButton})})})]})}const Wg=function({clientThreadId:t,onCompletionFinished:s,onCreate:n,preRequestCompletion:a,hideHeader:o,hideMessages:r,hideFooter:i,hideToolsOverlay:c,messagesVerticalAlign:u="top",prependThreadChildren:m,renderEmptyState:d,prefetchSearch:g}){const p=co(),f=Gn(t),x=Us(t),h=Je(t),S=bo(t).isArchived;l.useEffect(()=>{x||(Wt(t)?gn.addTiming("chatgpt.web.chatPage.renderNewConversation"):gn.addTiming("chatgpt.web.chatPage.renderExistingConversation"))},[t,x]);const _=yo(t,h),w=Vs(t,h),{setTargetedContent:v}=Vn(),C=p?.includes(Ui),A=Ou(),j=w>=2;Wn(j);const E=Wt(t)&&!j&&Ns(f),N=Wt(t)&&!_&&(Ns(f)||f?.kind===dt.GizmoTest),L=Ho().id,F=Gi(t),T=F??L,P=!!F,U=Xn(T),G=Un()[T],y=zu(t,f),q=Lo();Zo(w,t,h),l.useEffect(()=>{q||v(void 0)},[t,v,q,h]);const{caModal:Y,onRequestCompletion:ee,onChangeItemInView:V,onChangeRating:xe,onRequestMoreCompletions:le}=Uu({clientThreadId:t,currentModelId:T,defaultModelId:L,onCompletionFinished:s,onThreadCreated:n,preRequestCompletion:a}),{isUnauthenticated:X,isLoading:ge}=Ge(),oe=Jo({clientThreadId:t,currentLeafId:h,handleRequestCompletion:ee,prefetchSearchPromise:g});Gu({clientThreadId:t,currentModelId:T});const Te=ue=>e.jsx(vg,{scrollAnchorTopOffset:o?0:Qu,children:u==="bottom"?e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex-1"}),ue]}):ue});l.useEffect(()=>{document.title=y??"ChatGPT"},[y]);const ve=He(t),Me=ts(),Ce=Wi(),ke=N&&!Ce&&!d&&!ve&&!U&&!Me,Se=ke&&!ge&&X,De=ke&&!ge&&!X,ce=Ah(Se),O=Ih(De),D=Se&&ce||De&&O,te=Ws(),W=Wu(),{reset:H,streamingContext:K,StreamingProvider:pe}=Vu();l.useEffect(()=>{W&&(K.setOnResetContext=()=>{H()})},[W,H,K]);const ae=l.useRef(null),_e=l.useRef(null),$=l.useMemo(()=>({threadContentScrollContainerElementRef:ae,footerRootContainerElementRef:_e}),[]);return e.jsx(er,{clientThreadId:t,currentLeafId:h,children:e.jsxs(pe,{value:K,children:[C&&e.jsx(wg,{}),e.jsx(tr,{children:y!=null&&e.jsx("title",{children:y})}),e.jsx(wo.Provider,{value:ee,children:e.jsxs(sr,{children:[e.jsxs(nr,{clientThreadId:t,currentModelConfig:G,className:"composer-parent flex h-full flex-col focus-visible:outline-0",children:[!r&&e.jsx(qu,{value:$,children:e.jsx(Tg,{ref:ae,children:!x&&!oe?N?d??e.jsx(Rr,{clientThreadId:t,currentModelId:T,isModelLoaded:P,onRequestCompletion:ee,enableV2Homepage:D,v2HomepageDisclaimer:D&&e.jsx(Kt,{clientThreadId:t})}):j?Te(e.jsxs(e.Fragment,{children:[m,e.jsx(fg,{onChangeItemInView:V,onRequestMoreCompletions:le,onChangeRating:xe,onRequestCompletion:ee,clientThreadId:t,conversationLeafId:h,hideHeader:o},t)]})):null:null})}),e.jsx(Mg,{ref:_e,children:S?e.jsx(jg,{clientThreadId:t}):e.jsxs("div",{children:[!D&&e.jsx(wr,{clientThreadId:t,isNewThread:E,showPromptStarters:E||!_,currentModelId:T,onRequestCompletion:ee}),!i&&e.jsx("div",{className:"relative w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",children:Ns(f)&&!D&&e.jsx("div",{className:"min-h-4",children:e.jsx(Kt,{clientThreadId:t})})})]})})]}),!c&&e.jsxs("div",{className:"group absolute bottom-2 end-2 z-20 flex flex-col gap-1 md:flex lg:bottom-3 lg:end-3",children:[A?e.jsxs(e.Fragment,{children:[e.jsx(yg,{}),!1]}):null,e.jsx($u,{})]}),Y,e.jsx(Ku,{clientThreadId:t,isStaticSharedThread:!1,isDynamicSharedThread:te}),e.jsx(Yu,{}),e.jsx(Xu,{conversationId:t,currentModelId:T,isActiveWindow:!Ce})]})})]})})},Tg=ye.div`grow flex-1 overflow-hidden`,Mg=ye.div`md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent w-full`;function Cg({clientThreadId:t,currentModelId:s,isModelLoaded:n,onRequestCompletion:a,v2HomepageDisclaimer:o}){return e.jsx(Mr,{clientThreadId:t,currentModelId:s,isModelLoaded:n,onRequestCompletion:a,v2HomepageDisclaimer:o})}const kg=We(()=>Ve(()=>import("./ohem3a9epca8a5wm.js"),__vite__mapDeps([38,1,2,3,39,4,5])).then(t=>t.ChatScreenContentModals));function _g({disableEmptyState:t,fullWidth:s,renderEmptyState:n}){const{clientThreadId:a,currentModelId:o,conversationLeafId:r,isCompanionWindow:i,isEmbeddedInFocusedView:c,onChangeItemInView:u,onChangeRating:m,onRequestCompletion:d,onRequestMoreCompletions:g,isModelLoaded:p,prefetchSearch:f}=l.useContext(Qn),x=Vs(a,r),h=Vi(a),b={clientThreadId:a,conversationLeafId:r,currentModelId:o,onChangeItemInView:u,onChangeRating:m,onRequestMoreCompletions:g,onRequestCompletion:d,showAvatar:!1},S=Us(a),_=Jo({clientThreadId:a,currentLeafId:r,handleRequestCompletion:d,prefetchSearchPromise:f}),w=S||_||t,v=Ws(),{initialConversationTurns:C,continuedConversationTurns:A}=Ju(x,v),{canUseNewHomepage:j,showEmptyState:E}=ar({clientThreadId:a,currentLeafId:r}),N=x>=2;Wn(N);const{setTargetedContent:I}=Vn(),L=Xn(o);Zo(x,a,r),l.useEffect(()=>{c||I(void 0)},[a,I,c]);const F=Qo(a,r);if(E){if(n!=null)return n();if(j&&!w){const T=i?null:e.jsx("div",{className:"text-center text-xs text-token-text-secondary",children:e.jsx(Kt,{clientThreadId:a})});return e.jsx(Cg,{clientThreadId:a,currentModelId:o,isModelLoaded:p,onRequestCompletion:d,v2HomepageDisclaimer:T})}else if(!j&&!w)return e.jsx(Rr,{clientThreadId:a,currentModelId:o,isModelLoaded:p,onRequestCompletion:d,enableV2Homepage:!L,v2HomepageDisclaimer:e.jsx(Kt,{clientThreadId:a})})}return e.jsxs(e.Fragment,{children:[v&&e.jsx(ed,{}),v&&A.length===0&&e.jsx(td,{}),e.jsx(Fn,{children:e.jsxs(l.Suspense,{fallback:null,children:[e.jsx(sd,{}),C.length>0&&e.jsx("ol",{className:me.conversationTurnList,children:C.map(({turnIndex:T,isFinalTurn:P})=>e.jsx("li",{className:R(me.conversationTurnWrapper,s&&"w-full"),children:l.createElement(Nn,{...b,key:`${a}-${T}`,turnIndex:T,isFinalTurn:P,scrollToMessageId:h,shouldShowDateHeader:F(T)})},T))}),v&&e.jsx(nd,{}),e.jsx("ol",{className:me.conversationTurnList,children:A.map(({turnIndex:T,isFinalTurn:P})=>e.jsx("li",{className:R(me.conversationTurnWrapper,s&&"w-full"),children:l.createElement(Nn,{...b,key:`${a}-${T}`,turnIndex:T,isFinalTurn:P,scrollToMessageId:h,shouldShowDateHeader:F(T)})},T))})]})}),e.jsx(kg,{}),x>0&&e.jsx(ad,{})]})}function Eg({renderEmptyState:t}){return e.jsx(_g,{renderEmptyState:t})}const Ng=We(()=>Ve(()=>Promise.resolve().then(()=>Rh),void 0).then(t=>t.ChatScreenComposerAlerts));function Rg(){const{clientThreadId:t,currentModelId:s,isCompanionWindow:n,onRequestCompletion:a}=l.useContext(Qn),o=Gn(t),r=Je(t),c=Vs(t,r)>=2,u=yo(t,r),m=Wt(t)&&!c&&Ns(o),{setComposerFooterElement:d}=l.useContext(or);return e.jsx("div",{className:me.footer,children:e.jsxs(od,{style:{"--bar-gap":"0.5rem","--bar-background-color":"transparent"},children:[e.jsxs(wn,{type:"secondary",className:"relative",children:[c&&e.jsx(rd,{className:me.scrollButton}),e.jsx(Ng,{})]}),e.jsxs(wn,{type:"primary",ref:d,name:"composer-bar",className:"bottom-[var(--screen-keyboard-bottom,env(keyboard-inset-bottom,0px))]",children:[e.jsx(wr,{clientThreadId:t,currentModelId:s,isNewThread:m,noWrap:!0,onRequestCompletion:a,showPromptStarters:m||!u}),!n&&e.jsx("div",{className:"text-center text-xs text-token-text-secondary",children:e.jsx(Kt,{clientThreadId:t})})]})]})})}function Ag(){const t=Oe(),{clientThreadId:s,isLoggedInUser:n,onNewThread:a}=l.useContext(Qn);return He(s),e.jsxs(wn,{leading:!0,type:"primary",className:me.header,children:[e.jsxs("div",{className:me.headerLeading,children:[n&&e.jsx(id,{}),e.jsx(Jt,{label:t.formatMessage(no.newChat),className:"hidden @lg/thread:inline-flex",children:e.jsx(qi,{to:"/",className:me.newThread,onClick:o=>{a?(o.preventDefault(),a()):he.logEvent("chatgpt_web_thread_tap_new_thread")},tabIndex:0,children:e.jsx(ld,{className:R(me.sidebarIcon),icon:e.jsx(Nd,{}),tabIndex:-1,label:t.formatMessage(no.newChat),style:{viewTransitionName:"var(--vt_new_chat_thread)"}})})}),e.jsx("div",{className:me.threadDropdown,children:e.jsx(Wo,{clientThreadId:s})})]}),e.jsx("div",{className:me.headerTrailing,children:e.jsx(Fn,{children:e.jsx(Er,{clientThreadId:s})})})]})}const no=ze({newChat:{id:"rnCpM4",defaultMessage:"New Chat"}});function Vg({hideHeader:t=!1,hideFooter:s=!1,hideTools:n=!1,embedded:a=!1,renderEmptyState:o,ref:r}){const{clientThreadId:i,currentModelId:c,conversationLeafId:u,isCompanionWindow:m,isInstalledApp:d,onRequestCompletion:g}=cd(),{canUseNewHomepage:p,showEmptyState:f}=ar({clientThreadId:i,currentLeafId:u}),x=Un()[c],[h,b]=ud({name:"composer-bar",track:"height"}),S=dd(i),_=md(),w=$i(),v=s||f&&p;return e.jsx(wo.Provider,{value:g,children:e.jsx(sr,{children:e.jsxs(er,{clientThreadId:i,currentLeafId:u,children:[e.jsx(tr,{children:S!=null&&e.jsx("title",{children:S})}),e.jsx(nr,{clientThreadId:i,className:R(a&&"h-full","flex-1"),currentModelConfig:x,children:e.jsx(or.Provider,{value:{setComposerFooterElement:b},children:e.jsxs("div",{className:"h-full",style:{container:"thread-container / inline-size"},children:[e.jsx(bn,{id:"canvas-state",name:"canvas-state",checked:_}),e.jsx(bn,{id:"thread-extended-info-sidebar-state",name:"thread-extended-info-sidebar-state",checked:w}),e.jsx(hd,{anchor:"vertical",className:R(me.screen,f&&p&&me.screenEmptyState,m&&me.screenCompanionWindow,d&&me.screenInstalledApp,a&&me.screenEmbedded),name:"thread",leading:!t&&e.jsx(Ag,{}),style:h,ref:r,trackLeading:!0,trackTrailing:!0,trailing:!v&&e.jsx(Rg,{}),children:e.jsx(Eg,{renderEmptyState:o})}),!m&&!n&&e.jsxs(e.Fragment,{children:[e.jsx(Qd,{}),e.jsx(gd,{})]})]})})})]})})})}export{Vg as C,Wg as T,vg as W,Nn as a};
//# sourceMappingURL=l2fzmhn511k4uv9b.js.map
