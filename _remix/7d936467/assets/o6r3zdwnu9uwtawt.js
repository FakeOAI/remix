import{j as e,cH as I,J as x,r as d,P as p,y as f,G as k,a6 as _,cb as R,bt as E,W as A,N as h,H as L,c as T,bi as D,K as F}from"./g7ztsvc9feyj2vte.js";import{B as P,q as H,C as U,g as q,n as z}from"./mg86rtr8x8w2dz5x.js";import{g as w}from"./kqwdyvkaaavvn8k3.js";import{u as N}from"./kml239o4lf95w74i.js";import{b as M}from"./ncyihyar27tny6sr.js";import{bx as B,bw as G,fJ as O,fK as V,bH as J,fL as K,fM as c,fN as j,A as Q}from"./gqgps9j5l5ri9xro.js";import{aS as $}from"./kndsiqxkteulvsjz.js";import{F as W}from"./ix3v9m04w4pqis0i.js";import{S as Y,a as Z}from"./bov0u07yw74li94k.js";import{m as v}from"./k1kbsv2h7548rmdr.js";import"./f2xbrl33ec700xcm.js";import"./gy0vjuxih470bquh.js";function C({children:t}){return e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 text-sm font-semibold text-token-text-tertiary",children:[e.jsx($,{className:"icon-2xl"}),t]})})}const X=({images:t,analyticsMetadata:s})=>{const a=t.map(r=>r.thumbnail_url),n=I({queries:a.map(r=>P(r)),combine:r=>{const o=new Set;return r.forEach((l,i)=>{l.isError&&o.add(a[i])}),o}});return e.jsx(e.Fragment,{children:(t==null?void 0:t.length)>0?e.jsx("div",{className:"columns-1 gap-2 px-6 py-4 xs:columns-2 md:columns-3",children:t.map((r,o)=>!n.has(r.thumbnail_url)&&e.jsx("div",{className:"relative mb-0.5 break-inside-avoid",children:e.jsx(ee,{image:r,analyticsMetadata:s})},o))}):e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(C,{children:e.jsx(x,{id:"AbVGAw",defaultMessage:"No Results"})})})})},ee=({image:t,analyticsMetadata:s})=>{const a=N(t.url).data??w(t.url,"short"),{isSuccess:n}=H(t==null?void 0:t.thumbnail_url),r={...M(s),url:t.url,title:t.title};return d.useEffect(()=>{p.logEvent(f.searchSidebarImageShown,r)},[]),e.jsx("button",{onClick:()=>{p.logEvent(f.searchSidebarImageClicked,r),B.setCurrentImage(t?{image:t,source:G.ImagesTab,turnIndex:s.turnIndex}:void 0)},children:n?e.jsxs("div",{className:"group relative h-full w-full",children:[e.jsx("img",{src:t.thumbnail_url,alt:t.content_url,className:"w-full rounded-lg hover:opacity-100 group-hover:opacity-90"}),e.jsx("div",{className:"absolute bottom-1 left-1 max-w-[75%] truncate rounded-xl bg-black/40 px-2 py-1 text-xs font-medium text-white backdrop-blur-sm",children:a})]}):e.jsx("div",{className:"aspect-square h-full w-full animate-pulse bg-token-main-surface-tertiary"})})};function te({date:t}){const s=k(),a=t instanceof Date?t:new Date(t*1e3),n=O(a,new Date);if(n<4&&n>-4){const r=s.formatRelativeTime(n,"day",{numeric:"auto"});return r.charAt(0).toUpperCase()+r.slice(1)}else return s.formatDate(a,{year:"numeric",month:"long",day:"numeric"})}var se=R,re=_,ae=V,ne=E;function oe(t,s){var a=ne(t)?se:ae;return a(t,re(s))}var le=oe,ie=J,ce=le;function ue(t,s){return ie(ce(t,s),1)}var de=ue;const me=A(de);function xe({citations:t,searchResults:s,analyticsMetadata:a}){if(t.length===0&&s.length===0)return e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(C,{children:e.jsx(x,{id:"AbVGAw",defaultMessage:"No Results"})})});const n=me(s,o=>o.entries).toSorted((o,l)=>((l==null?void 0:l.pub_date)??0)-((o==null?void 0:o.pub_date)??0)),r=t.toSorted((o,l)=>((l==null?void 0:l.pub_date)??0)-((o==null?void 0:o.pub_date)??0));return e.jsxs("div",{className:"mt-[-1px] flex w-full flex-col",children:[e.jsx(y,{title:e.jsx(x,{id:"dlVlo6",defaultMessage:"Citations"}),items:r,analyticsMetadata:a}),e.jsx(y,{title:e.jsx(x,{id:"9M0Yh6",defaultMessage:"More Links"}),items:n,analyticsMetadata:a})]})}const fe=h.div`sticky top-[-1px] text-xs font-semibold border-token-border-light text-token-text-secondary border-y py-3 px-6 bg-token-main-surface-primary`;function y({title:t,items:s,analyticsMetadata:a}){return!s||s.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx(fe,{children:t}),e.jsx("div",{className:"flex flex-col gap-6 px-6 py-4",children:s.map((n,r)=>e.jsx(he,{item:n,analyticsMetadata:a,index:r},r))})]})}function he({item:t,index:s,analyticsMetadata:a}){const n=N(t.url).data??w(t.url,"short"),r=o=>"ref_id"in o&&"content_type"in o;return e.jsx(pe,{analyticsMetadata:a,href:t.url,position:s,target:"_blank",rel:"noopener",className:"group flex gap-6",children:e.jsxs("div",{children:[e.jsxs("div",{className:"line-clamp-1 flex items-center gap-2 text-sm",children:[e.jsx(W,{url:t.url,className:"icon-sm rounded bg-token-main-surface-primary object-cover",size:32,minSize:20,fallback:e.jsx(Y,{className:"icon-sm text-token-text-quaternary"})}),n,r(t)&&e.jsx(Z,{searchResult:t,className:"inline h-4 w-4 text-token-text-tertiary"})]}),e.jsx("div",{className:"line-clamp-2 text-sm font-semibold hover:underline",children:t.title}),t.pub_date&&e.jsx("div",{className:"text-sm text-token-text-secondary",children:e.jsx(te,{date:t.pub_date})})]})})}const pe=d.forwardRef(function(s,a){const{analyticsMetadata:n,position:r,...o}=s;function l(i){s.href&&p.logEvent(i,{...M(n),url:s.href,raw_position:r})}return d.useEffect(()=>{l(f.searchLinkShown)},[]),e.jsx("a",{ref:a,...o,onClick:i=>{var u;(u=s.onClick)==null||u.call(s,i),i.stopPropagation(),l(f.searchLinkClicked)}})});function Le({clientThreadId:t}){const s=k(),{tab:a,turnIndex:n,messageId:r}=K(),o=[],l=n?U(t,n):[],i=n?q.getTurnSearchResults(t,n):[],u=n?z(t,n):[];(l.length>0||i.length>0)&&o.push(c.Sources),u.length>0&&o.push(c.Images);const b=d.useCallback(()=>{j.close(a)},[a]),g=d.useMemo(()=>({clientThreadId:t,messageId:r,turnIndex:n}),[t,r,n]);return!a||!n||o.length===0||!o.includes(a)?null:e.jsx(L,{size:"custom",noPadding:!0,isOpen:!0,onClose:b,type:"success",className:"focus-none max-w-2xl !shadow-none outline-none",children:e.jsxs("div",{className:"focus-none flex h-full flex-col items-center justify-start overflow-hidden rounded-lg outline-none",children:[e.jsxs(be,{children:[e.jsx(ge,{children:o.map(m=>e.jsx("button",{onClick:()=>{j.open(m,n,r)},className:T("mb-[-1px] border-b-2 border-solid border-transparent py-6 text-lg font-medium text-token-text-tertiary hover:text-token-text-secondary",{"!border-token-text-primary font-semibold !text-token-text-primary":a===m}),children:s.formatMessage(ve[m])},m))}),e.jsx(D,{onClick:b})]}),e.jsx(je,{children:e.jsx(Q,{children:a===c.Sources?e.jsx(v.div,{...S,children:e.jsx(xe,{citations:l,searchResults:i,analyticsMetadata:g})},"sources"):a===c.Images?e.jsx(v.div,{...S,children:e.jsx(X,{images:u,analyticsMetadata:g})},"images"):null})})]})})}const S={initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},className:"h-full overflow-y-auto relative"},be=h.div`flex w-full flex-row items-center justify-between border-b px-6 dark:border-gray-700`,ge=h.span`text-base font-semibold sm:text-base flex gap-4`,je=h.div`h-[60vh] max-h-[700px] w-full`,ve=F({[c.Images]:{id:"Z0ljgR",defaultMessage:"Images"},[c.Sources]:{id:"f0O2dC",defaultMessage:"Sources"}});export{Le as SearchResultsModal};
//# sourceMappingURL=o6r3zdwnu9uwtawt.js.map
