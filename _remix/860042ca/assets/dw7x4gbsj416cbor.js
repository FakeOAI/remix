import{bD as _,W as w,M as k,l as a,R as S,m as v,e7 as s,j as Q,a2 as E}from"./egi9yqe8h527q0wn.js";import{c2 as F,Q as T,c3 as q}from"./kovfiydeinrm6blw.js";import{p as B,t as L}from"./e6itquh41uv61tg7.js";import{p as C}from"./bue7ssrf5lr74ywi.js";import{u as N}from"./o8ef0qyen304hbei.js";import{a as h,i as D,T as O}from"./fsldftql3hgxsggg.js";import{m as W}from"./hv5dp5z9yhve225l.js";import"./d1idnzvl0pqu9wz9.js";import"./fv2lx90pr3xg3map.js";import"./mk14lgsmrpmo2zsf.js";import"./efbz2xeupq2vm8nx.js";import"./hjyufao59r59iwke.js";import"./mulk6actptn6vk4t.js";import"./fudx0zpt1yfrknlw.js";import"./er0ahr1yq57dmlc2.js";import"./z0c6vm4df23yv2bb.js";import"./i04pcwd992jm5mp6.js";import"./fkawcdcy1eq7glw1.js";import"./ed4yr7r1n1jkra8g.js";function he({messages:e,isRequestActive:t,isLastMessageInTurn:i,isRetrieval:o,isUsingGizmo:n}){const{config:g}=_("3814631162"),M=g.get("is_shimmer_enabled",!1),l=e.map(m=>m.message),d=U(l),c=d.filter(m=>V(m,!1)),p=c[c.length-1]??void 0,r=w();if(J(l).some(({content:m})=>m.content_type===k.SystemError))return null;let u=h.Running;const x={count:c.length,domain:p?C(y(p)??""):void 0,query:p?j(p):void 0};let f=o?n?r.formatMessage({id:"browsingMessage.searchingKnowledge",defaultMessage:"Searching my knowledge"}):r.formatMessage({id:"browsingMessage.startingRetrieval",defaultMessage:"Reading documents"}):r.formatMessage({id:"message.tools.browse.running",defaultMessage:"Searching the web"});return l.some(D)?(u=h.Stopped,f=o?n?r.formatMessage({id:"browsingMessage.searchingKnowledgeStopped",defaultMessage:"Stopped searching knowledge"}):r.formatMessage({id:"browsingMessage.retrievalStopped",defaultMessage:"Stopped reading documents"}):r.formatMessage({id:"message.tools.browse.stopped",defaultMessage:"Search stopped"})):!i||!t?d.length>0&&d.every(m=>m.didError)?(u=h.Error,f=o?n?r.formatMessage({id:"browsingMessage.searchingKnowledgeFailed",defaultMessage:"Error searching knowledge"}):r.formatMessage({id:"browsingMessage.retrievalFailed",defaultMessage:"Error reading documents"}):r.formatMessage({id:"message.tools.browse.failed",defaultMessage:"Search failed"})):(u=h.Finished,f=o?null:x.count===0?r.formatMessage({id:"message.tools.browse.started",defaultMessage:"Searching the web..."}):r.formatMessage({id:"message.tools.browse.finished",defaultMessage:"Searched {count, plural, =0 {0 sites} one {# site} other {# sites}}"},x)):c.length>0&&(f=H(r,x,o,n,c[c.length-1])),(c.length>0||M&&o&&i)&&u!==h.Error?a.jsx(O,{highlightedCommand:f,showWorkUserSetting:!1,status:u,children:c.length===0?null:a.jsx(K,{commands:c})}):a.jsx(X,{$isError:u===h.Error,children:f})}function b(e){return e.metadata?.command==="quote"||e.metadata?.command==="quote_full"||e.metadata?.command==="quote_lines"}function U(e){return e.map((t,i)=>{if(t.author.role!==S.Tool||i>0&&b(t)&&b(e[i-1]))return null;const o=t.metadata;if(!o)return null;const{command:n,status:g}=o;return n?{type:n,status:g,didError:t.content.content_type===k.SystemError,message:t}:null}).filter(F)}function K({commands:e}){const t=w(),i=e.map(y).filter(n=>n!=null),o=N(i);return a.jsx("div",{className:"mb-4 divide-y divide-token-border-light rounded-xl border border-token-border-light text-sm",children:a.jsx(T,{initial:!1,children:e.map((n,g)=>{const{icon:M,url:l,title:d,externalLink:c}=P(n),p=l?C(l):void 0,r=d?typeof d=="string"?d:t.formatMessage(d):null,u=l?o.get(l):null;return a.jsx(W.div,{initial:"collapsed",animate:"open",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:a.jsxs(R,{url:c??l,className:v("flex items-start gap-3 px-4 py-3",d?"text-token-text-secondary":"text-token-text-primary",g===0&&"rounded-t-xl",g===e.length-1&&"rounded-b-xl"),children:[M?a.jsx(M,{className:"icon-sm mt-0.5 flex-shrink-0 text-token-text-secondary"}):l?a.jsx(q,{url:l,className:"mt-1"}):null,a.jsxs("div",{children:[r&&a.jsxs("div",{className:"line-clamp-1 text-token-text-primary",children:[u&&`${u} — `,r]}),a.jsx("div",{children:p})]})]})},g)})})})}function R({url:e,children:t,className:i}){return e?a.jsxs("a",{href:e,target:"_blank",className:v(i,"group relative hover:bg-token-main-surface-secondary"),rel:"noreferrer",children:[t,a.jsx("div",{className:"invisible absolute right-3 bg-gradient-to-l from-token-main-surface-secondary to-transparent pl-4 group-hover:visible",children:a.jsx(B,{className:"icon-md text-token-text-secondary"})})]}):a.jsx("div",{className:i,children:t})}function $(e){const t=e.message.metadata?._cite_metadata?.metadata_list[0];return t!=null&&t.type!=="file"?t.title:null}function j(e){return e.message.metadata?.args?.[0]}function P(e){switch(e.type){case s.Search:{const t=j(e);return{icon:L,url:"bing.com",externalLink:A(e),title:t?`“${t}”`:{id:"message.tools.browse.querying",defaultMessage:"Querying",description:"Status message when issuing a query"}}}case s.Click:case s.MultiClick:case s.Lookup:case s.OpenUrl:case s.Open:case s.Quote:case s.QuoteFull:case s.QuoteLines:case s.Scroll:return{url:y(e),title:$(e)??void 0};case s.Back:return{}}}function A(e){const t=e.message.metadata?.args?.[0];return t===void 0?null:Q.getBingLink({query:t})}function H(e,t,i,o,n){switch(n?.type){case s.Click:case s.MultiClick:case s.Lookup:case s.OpenUrl:case s.Quote:case s.QuoteFull:case s.QuoteLines:case s.Scroll:case s.Open:case s.Back:return e.formatMessage({id:"message.tools.browse.reading",defaultMessage:"Browsing {domain}"},t);case s.Search:case void 0:return i?o?e.formatMessage({id:"browsingMessage.searchingKnowledge",defaultMessage:"Searching my knowledge"}):e.formatMessage({id:"browsingMessage.startingRetrieval",defaultMessage:"Reading documents"}):e.formatMessage({id:"message.tools.browse.searching",defaultMessage:'Searching "{query}"'},t)}}function I(e){const t=e.message.metadata?._cite_metadata?.metadata_list[0];return t!=null&&t.type==="file"?t.name:null}function V(e,t){switch(e.type){case s.Search:return!0;case s.Click:case s.Lookup:case s.MultiClick:case s.OpenUrl:case s.Quote:case s.QuoteFull:case s.QuoteLines:return t?I(e)!=null:y(e)!=null;case s.Open:case s.Back:case s.Scroll:return!1}}function y(e){const t=e.message.metadata?._cite_metadata?.metadata_list[0];return t!=null&&t.type!=="file"?t.url:null}function J(e){return e.filter(t=>t.author.role===S.Tool)}const X=E.p`first:mt-0 my-1.5 h-8 flex items-center ltr:mr-auto rtl:ml-auto empty:hidden
${({$isError:e})=>e?"text-token-text-error":"text-token-text-secondary"}`;export{he as BrowsingMessage,y as getVisitedUrl};
//# sourceMappingURL=dw7x4gbsj416cbor.js.map
