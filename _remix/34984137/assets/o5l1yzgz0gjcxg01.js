const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ie16vbh5ibw3sr0l.js","assets/kqqkpdulatnhj153.js","assets/nt24bg1lfwf9oh75.js","assets/root-dmul5u05.css"])))=>i.map(i=>d[i]);
import{V as A,cf as oe,eW as re,eX as G,r as x,l as a,aR as le,aS as de,aT as ce,aU as me,aW as ge,m as S,aV as ue,bc as _,a0 as J,aC as fe,aD as xe,bn as he,eY as pe,M as Ie,dY as be,eL as ve,bO as we,bS as ye,by as je,bP as B,aG as Me,a1 as Z,ao as W,a as L,P as z,aJ as Ce}from"./kqqkpdulatnhj153.js";import{a as Se,b as ke,D as Ee,aL as _e,bj as Ne,ap as ee,aq as ae,o as te,Y as Ve}from"./nt24bg1lfwf9oh75.js";import{G as De,e_ as Ae,dR as Te,e$ as Fe,d3 as U,d4 as Le,c2 as $,c1 as Pe,aP as Re,bK as $e,aO as Oe,f0 as Ge,d5 as Be,f1 as We,aQ as H,cc as ze,Y as Ue}from"./n3rs6b5m6tqfdjyk.js";import{m as D}from"./esrcc953x6z04mp9.js";import{g as V,d as He}from"./jju24ktuta94ahij.js";import{i as Ye,a as N,g as qe}from"./jjkswa78c00rb26q.js";import{b as Ke,e as Xe,l as Qe}from"./difcbbya6lgzvb2g.js";import"./m30y9cks5frdds6a.js";import"./ljkmhw662c6t9mhx.js";import"./fu8plhbz1k8c2c5r.js";import"./n9ay93jbmqoqxpuq.js";import"./cjvbiw2g5fogbi08.js";import"./gg12z91ptfq2dx0l.js";import"./ldfj18v9arqp0hlo.js";import"./niicwal2u1ktt9ga.js";import"./bcho5xlsyhfo0xx7.js";import"./jry911aolndx5jxk.js";import"./lza6m5fvykifh7pz.js";const Je={enter:e=>({zIndex:0,x:e===-1?"10%":"-10%",opacity:0}),center:{zIndex:1,x:0,opacity:1},exit:e=>({zIndex:0,x:e===1?"10%":"-10%",opacity:0})},Ze={enter:{opacity:0,y:"10%"},visible:{opacity:1,y:0},exit:{opacity:0,y:"10%"}},Y=1e3,q=1e3,K=(e,t)=>Math.abs(e)*t;function ea(e){const t=A(),s=oe(),o=re(),u=[G.Small,G.Mobile].includes(o),[h,l]=x.useState({width:0,height:0}),[d,c]=x.useState(!1),[r,m]=x.useState(e.image),[p,y]=x.useState(!1),f=h.width>0&&h.height>0,I=x.useRef(null),[C,w]=x.useState(0);x.useEffect(()=>{if(!r.url)throw new Error("ExpandableImage requires a src");const i=new Image;i.onload=()=>{l({width:i.naturalWidth,height:i.naturalHeight})},i.onerror=()=>{},i.src=r.url},[r.url]),x.useEffect(()=>{const i=I.current;if(p)return i?.addEventListener("keydown",k),()=>{i?.removeEventListener("keydown",k)};m(e.image)},[p]);function b(){m(i=>{const g=(e.images.findIndex(v=>v.url===i.url)+1)%e.images.length;return e.images[g]}),w(-1)}function j(){m(i=>{const n=e.images.findIndex(v=>v.url===i.url),g=n>0?(n-1)%e.images.length:e.images.length-1;return e.images[g]}),w(1)}function T(i){y(i),i&&e.onOpen?.(r)}function k(i){i.key==="ArrowLeft"?j():i.key==="ArrowRight"&&b()}const F=e.images.findIndex(i=>i.url===r.url);return a.jsxs(le,{onOpenChange:T,children:[a.jsx(de,{disabled:!f,className:e.className,"aria-label":t.formatMessage(E.showImage),children:e.children}),a.jsx(ce,{container:s?.document.body,children:a.jsx(me,{className:"fixed inset-0 flex items-center justify-center bg-black/90 backdrop-blur-xl radix-state-open:animate-show",children:a.jsxs(ge,{className:S("relative flex h-[100dvh] w-screen justify-stretch divide-x divide-white/10 focus:outline-none radix-state-open:animate-contentShow"),ref:I,children:[a.jsx("div",{className:S("flex flex-1 transition-[flex-basis]",!d&&"md:basis-[75vw]"),children:a.jsxs("div",{className:"flex flex-1 flex-col md:p-6",children:[a.jsxs("div",{className:"flex justify-between px-6 py-2 pt-6 text-white sm:mb-4 md:mt-2 md:px-0 md:py-2",children:[a.jsx(ue,{asChild:!0,children:a.jsx("button",{"aria-label":t.formatMessage(E.closeModal),children:a.jsx(Se,{})})}),a.jsx("div",{children:!u&&a.jsxs(a.Fragment,{children:[e.getActions?.(r)?.map((i,n)=>a.jsx(_,{color:"ghost",size:"small",onClick:i.onClick,"aria-label":i.ariaLabel,disabled:i.disabled,icon:i.icon},n)),a.jsx(_,{color:"ghost",size:"small",onClick:()=>c(i=>!i),"aria-label":t.formatMessage(E.toggleSidebar),className:"md:inline-flex",icon:ke})]})})]}),a.jsx("div",{className:"relative flex flex-1 flex-col items-center justify-center overflow-hidden",children:a.jsx(De,{initial:!1,custom:C,children:a.jsxs(D.div,{className:"absolute grid h-full w-full grid-rows-2",custom:C,variants:Je,drag:"x",dragConstraints:{left:0,right:0},dragElastic:1,onDragEnd:(i,{offset:n,velocity:g})=>{const v=K(n.x,g.x);v<-Y?b():v>Y&&j()},children:[a.jsx(D.img,{src:r.url,alt:r.alt,className:"row-span-4 mx-auto h-full object-scale-down",onPanEnd:(i,{offset:n,velocity:g})=>{const v=K(n.y,g.y);v<-q?c(!0):v>q&&c(!1)}},r.url),u&&d&&a.jsx(D.div,{className:"flex text-white",variants:Ze,initial:"enter",animate:"visible",exit:"exit",transition:{y:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2}},children:e.metadataRenderer(r)})]},r.url)})}),e.images.length>1?a.jsxs("div",{className:"flex items-center justify-center gap-4 p-8 text-white",children:[a.jsx(_,{color:"ghost",size:"small",onClick:j,"aria-label":t.formatMessage(E.previousImage),icon:Ee}),e.images.map((i,n)=>a.jsx("img",{src:i.url,alt:i.alt??"",className:S("h-12 w-12 cursor-pointer rounded object-cover transition duration-300 hover:opacity-100",i.url===r.url?"ring-2 ring-white ring-offset-4 ring-offset-black":"opacity-25"),onClick:()=>{m(i),w(n<F?1:-1)},"aria-label":t.formatMessage(E.showImage),role:"button"},i.url)),a.jsx(_,{color:"ghost",size:"small",onClick:b,"aria-label":t.formatMessage(E.nextImage),icon:_e})]}):null]})}),a.jsx("div",{className:S("hidden items-center justify-start overflow-hidden bg-gray-900 text-white transition-[flex-basis] duration-500 md:flex",d?"md:basis-[25vw]":"md:basis-0"),children:a.jsx("div",{className:"w-[25vw] min-w-[25vw]",children:e.metadataRenderer(r)})})]})})})]})}const E=J({showImage:{id:"imageViewer.showImage",defaultMessage:"Show Image"},closeModal:{id:"imageViewer.closeModal",defaultMessage:"Close Modal"},toggleSidebar:{id:"imageViewer.toggleSidebar",defaultMessage:"Toggle Sidebar"},nextImage:{id:"imageViewer.nextImage",defaultMessage:"Next Image"},previousImage:{id:"imageViewer.previousImage",defaultMessage:"Previous Image"}}),aa=25*1e3,P=new Map,ta=(e,t=aa)=>{const s=sa(e),[o,u]=x.useState(P.get(e)??0);return x.useEffect(()=>{let l=0;const d=setInterval(()=>{l+=100,u(c=>{let r=1.5;if(l<t){const p=Math.sin(s+c/100)*.1+1;r=(1-Math.log10(1+c/10))*p}const m=c+r;return m>=100?(clearInterval(d),100):(P.set(e,m),m)})},100);return()=>{clearInterval(d),P.delete(e)}},[s,e,t]),o};function sa(e){if(typeof e=="number")return e;let t=0;if(e.length===0)return t;for(let s=0;s<e.length;s++){const o=e.charCodeAt(s);t=(t<<5)-t+o,t|=0}return t}const ia=fe(()=>xe(()=>import("./ie16vbh5ibw3sr0l.js"),__vite__mapDeps([0,1,2,3])));function na(e){const t=e.matchTextColor??!0,s=x.useRef(null),[o,u]=x.useState(null);x.useEffect(()=>{if(!s.current||!t)return;const l=()=>{s.current&&u(getComputedStyle(s.current).color)},d=new MutationObserver(()=>{l()});return d.observe(window.document.documentElement,{attributes:!0,attributeFilter:["class","style"]}),d.observe(s.current,{attributes:!0,attributeFilter:["class","style"]}),l(),()=>d.disconnect()},[t]);const h=x.useMemo(()=>{if(!t)return e.animationData;const l=o?.match(/\d+/g)?.map(Number).map(c=>c/255);if(!l)return null;l.push(1);const d=e.animationData;return"layers"in d&&Array.isArray(d.layers)&&d.layers.forEach(c=>{"ty"in c&&c.ty===4&&"shapes"in c&&Array.isArray(c.shapes)&&c.shapes.forEach(r=>{"it"in r&&Array.isArray(r.it)&&r.it.forEach(m=>{m.ty==="fl"&&(m.c.k=l)})})}),d},[e.animationData,o,t]);return a.jsx("div",{ref:s,className:e.className,children:a.jsx(ia,{animationData:h,loop:!0,autoplay:!0},o)})}function oa({id:e,withLottie:t}){return a.jsxs("div",{className:"absolute left-0 top-0 flex h-full w-full items-center justify-center rounded-full",children:[t?a.jsx(na,{className:"h-6 w-6",animationData:Ae}):a.jsx(Ne,{className:"h-6 w-6"}),a.jsx(ra,{id:e})]})}function ra({id:e}){const t=ta(e);return a.jsx(Te,{percentage:t,thickness:1.25/23,className:"absolute left-1/2 top-1/2 h-10 w-10 -translate-x-1/2 -translate-y-1/2",backgroundStrokeClassName:"stroke-token-main-surface-tertiary",transitionDuration:`${(100-t)/100*.2}s`,transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"})}function Va({messages:e,clientThreadId:t}){const[s,o]=e,u=Ye(s.message),h=Fe(),l=e.some(r=>h.has(r.message.id));let d=null;o!=null&&U.isMultimodalTextMessage(o.message)&&(d=U.getImageAssetPointers(o.message));let c=N.Running;return d!=null?c=N.Finished:o!=null?c=N.Error:u&&(c=N.Stopped),a.jsx(a.Fragment,{children:!l&&a.jsx(la,{imageAssets:d??[],clientThreadId:t,toolStatus:c,toolMessage:o?.message,messageId:s.message.id})})}const la=({imageAssets:e,clientThreadId:t,toolMessage:s,toolStatus:o,messageId:u})=>{const h=A(),l=Le(e),d=he(),c=pe();if(s?.content.content_type===Ie.SystemError)return null;const r=se(e[0]),m=l.map(f=>f.data).filter(f=>f!=null),p=m.map(f=>({...f,alt:V(f)})),y=(f=0)=>`${u}-image-${f}`;return a.jsx(a.Fragment,{children:a.jsxs(ga,{$numItems:l.length,className:"my-1 transition-opacity duration-300",children:[l.length===0&&o===N.Running&&a.jsx(X,{layoutId:"loading:placeholder",shape:r,isToolRunning:!0},"loading"),l.map((f,I)=>{const{isLoading:C,data:w,error:b}=f;if(C)return a.jsx(X,{shape:r,layoutId:y(I)},I);if(b!=null||w?.url==null)return a.jsx(O,{layoutId:y(I),className:"text-sm text-token-text-tertiary",shape:r,children:a.jsx("div",{className:"flex min-h-full flex-col items-center justify-center gap-3 px-4 pb-5",children:h.formatMessage(M.imageLoadError)})},I);if(s&&w){const j={...w,alt:V(w)};return a.jsx(da,{image:j,allImages:p,clientThreadId:t,toolMessage:s,index:I,onOpenImageEditor:()=>{be&&c?(d(`/c/${t}`,{state:{focusObject:{type:$.Image,image:j,allImages:m,messageId:s.id}}}),ve(!1,{focusMainWindow:!0})):Pe.setFocusedObject({type:$.Image,image:j,allImages:m,messageId:s.id})}},I)}})]})})};function da({toolMessage:e,clientThreadId:t,allImages:s,image:o,index:u,onOpenImageEditor:h}){const l=A(),d=Ke(t),c=we(),{value:r}=ye("2189772492"),m=je(),p=qe(t),y=se(o),[f,I]=x.useState({}),C=p&&"gizmo"in p?p.gizmo:void 0,w=C?.gizmo.id===Re,b=m&&r&&!!c?.includes(B.D3Editor)&&(C==null||w||!!c?.includes(B.D3EditorAllGpts));async function j(n){He(n,d,e.id)}function T(n){W.logEvent("chatgpt_dalle_image_view_full",null,{sourceOperation:n.metadata?.dalle?.edit_op??"none",hasParent:n.metadata?.dalle?.parent_gen_id?"true":"false"}),z.logEvent(L.dalleImageViewFull,{conversationId:d,messageId:e.id,generationId:n.metadata?.dalle?.gen_id,parentGenerationId:n.metadata?.dalle?.parent_gen_id,fileId:H(n.asset_pointer),sourceOperation:n.metadata?.dalle?.edit_op})}function k(n,g){I(v=>({...v,[n.asset_pointer]:g})),W.logEvent(L.dalleImageRating,g?"like":"dislike",{liked:g?"true":"false",sourceOperation:n.metadata?.dalle?.edit_op??"none",hasParent:n.metadata?.dalle?.parent_gen_id?"true":"false"}),z.logEvent(L.dalleImageRating,{liked:g,conversationId:d,messageId:e.id,generationId:n.metadata?.dalle?.gen_id,parentGenerationId:n.metadata?.dalle?.parent_gen_id,fileId:H(n.asset_pointer),sourceOperation:n.metadata?.dalle?.edit_op})}function F(n){const g=f[n.asset_pointer],v={label:l.formatMessage(M.likeImage),onClick:()=>k(n,!0),disabled:g===!0,ariaLabel:l.formatMessage(M.likeImage),icon:ee},ie={label:l.formatMessage(M.dislikeImage),onClick:()=>k(n,!1),disabled:g===!1,ariaLabel:l.formatMessage(M.dislikeImage),icon:ae},ne={label:l.formatMessage(M.downloadImage),onClick:()=>j(n),ariaLabel:l.formatMessage(M.downloadImage),icon:te};return[g!==!1&&v,g!==!0&&ie,ne].filter(Boolean)}let i=a.jsx(ma,{image:o,shape:y,rating:f[o.asset_pointer],onDownload:()=>j(o),onRate:(n,g)=>k(n,g),clientThreadId:t,layoutId:void 0});return b?i=a.jsx("div",{role:"button",onClick:h,children:i}):i=a.jsx(ea,{image:o,images:s,metadataRenderer:n=>a.jsx(ca,{image:n}),onOpen:T,getActions:F,children:i}),a.jsx("div",{className:"flex",children:i},u)}function X({shape:e,layoutId:t,isToolRunning:s=!1}){return a.jsx(O,{shape:e,layoutId:t,children:a.jsx("div",{className:"flex min-h-full items-center justify-center",children:a.jsx(oa,{id:t,withLottie:s})})},"loading")}function ca({image:e}){const t=A(),[s,o]=x.useState(!1),u=Ce();function h(l){const d=V(e);o(!0),Ue(d,u,l),setTimeout(()=>{o(!1)},2e3)}return a.jsxs("div",{className:"flex flex-col items-start gap-3 p-6",children:[a.jsx("div",{className:"text-sm text-gray-300 sm:text-base",children:t.formatMessage(M.imageViewerMetadataTitle)}),a.jsx("div",{className:"max-h-32 overflow-y-auto text-sm md:max-h-[80vh] md:text-lg",children:V(e)}),a.jsx(_,{color:"primary",onClick:h,disabled:s,className:"hidden sm:block",icon:Ve,children:s?t.formatMessage(M.imageViewerMetadataCopyButtonCopied):t.formatMessage(M.imageViewerMetadataCopyButton)})]})}function O({children:e,shape:t,className:s,layoutId:o}){return a.jsxs(D.div,{layoutId:o,className:S("relative",s,t==="1792x1024"&&"aspect-[7/4]",t==="1024x1024"&&"aspect-square max-w-[400px]",t==="1024x1792"&&"aspect-[4/7] max-w-xs","overflow-hidden rounded-2xl"),children:[a.jsx("div",{className:"pointer-events-none absolute inset-0 bg-token-main-surface-secondary"}),a.jsx("div",{className:"relative h-full",children:e})]})}function ma({image:e,shape:t,rating:s,onDownload:o,onRate:u,clientThreadId:h,layoutId:l}){const d=Xe(),c=$e(ze.isBusinessWorkspace),r=Qe(h),m=Oe(),p=Ge(),y=p?.type===$.Image&&p.image.asset_pointer===e.asset_pointer,{url:f,width:I,height:C}=e,w=!d&&!c&&r?.kind!==Me.GizmoMagicCreate;return a.jsxs(O,{shape:t,className:"group/dalle-image",layoutId:y?void 0:l,children:[a.jsx(Be,{alt:V(e),src:f,width:I,height:C}),a.jsx("div",{className:S("pointer-events-none absolute inset-0 rounded-2xl shadow-[inset_0_0_0_1px_rgba(0,0,0,0.1)] dark:shadow-[inset_0_0_0_1px_rgba(255,255,255,0.1)]",y?"bg-black/50 group-hover/dalle-image:bg-black/70":"group-hover/dalle-image:bg-transparent")}),m?!y&&a.jsx("div",{className:"pointer-events-none invisible absolute right-3 top-3 text-white group-hover/dalle-image:visible",children:a.jsx(We,{})}):a.jsxs(a.Fragment,{children:[w&&a.jsxs(Q,{children:[s!==!1&&a.jsx(R,{icon:ee,selected:s===!0,onClick:b=>{b.stopPropagation(),u(e,!0)}}),s!==!0&&a.jsx(R,{icon:ae,selected:s===!1,onClick:b=>{b.stopPropagation(),u(e,!1)}})]}),a.jsx(Q,{$rightAlign:!0,children:a.jsx(R,{icon:te,onClick:b=>{b.stopPropagation(),o()}})})]})]})}const Q=Z.div`invisible absolute top-3 flex gap-1 group-hover/dalle-image:visible
${({$rightAlign:e})=>e?"right-3":"left-3"}`;function R({icon:e,selected:t,onClick:s}){return a.jsx("button",{className:S("flex h-8 w-8 items-center justify-center rounded",t?"bg-gray-100":"bg-black/50 hover:opacity-70"),onClick:s,disabled:t,children:a.jsx(e,{className:S("icon-md",t?"text-gray-700":"text-white")})})}const ga=Z.div`grid gap-2
${({$numItems:e})=>e<=1?"grid-cols-1":"grid-cols-2"}`;function se(e){if(!e)return"1024x1024";const{width:t,height:s}=e;return t>s?"1792x1024":t<s?"1024x1792":"1024x1024"}const M=J({creatingImages:{id:"dalleMessage.creatingImagesV2",defaultMessage:"Creating image"},stopped:{id:"dalleMessage.stoppedV3",defaultMessage:"Stopped creating image"},errorCreating:{id:"dalleMessage.errorCreatingV2",defaultMessage:"Error creating image"},imageLoadError:{id:"dalleMessage.imageLoadError",defaultMessage:"Error loading image"},imageViewerMetadataTitle:{id:"dalleMessage.imageViewerMetadataTitle",defaultMessage:"Prompt"},imageViewerMetadataCopyButton:{id:"dalleMessage.imageViewerMetadataCopyButton",defaultMessage:"Copy"},imageViewerMetadataCopyButtonCopied:{id:"dalleMessage.imageViewerMetadataCopyButtonCopied",defaultMessage:"Copied!"},imageEditButton:{id:"dalleMessage.imageEditButton",defaultMessage:"Edit"},downloadImage:{id:"imageViewer.downloadImage",defaultMessage:"Download Image"},likeImage:{id:"imageViewer.likeImage",defaultMessage:"Like Image"},dislikeImage:{id:"imageViewer.dislikeImage",defaultMessage:"Dislike Image"}});export{Va as default};
//# sourceMappingURL=o5l1yzgz0gjcxg01.js.map
