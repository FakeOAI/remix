const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/nuwv3h2ffb5rrf1b.js","assets/gdbo8e7dyfri4is1.js","assets/hx4nuyiea8nyedix.js","assets/root-vof5cayc.css","assets/g9k4dbiugr5v9x9w.js","assets/s1wp61fjxrc89se3.js","assets/lfqdgp7xsc2kl8bj.js","assets/conversation-small-eplmind9.css","assets/eldaz9nlf1ogv3i1.js","assets/gjmdn4uakoveniqh.js","assets/jjkm88pkr4s7hxuh.js","assets/kt8ugt55ef8vx1kh.js","assets/hsb3y08r32h99w5r.js","assets/itkuns8rjyiyvfqq.js","assets/l3rki3ww4npt847p.js","assets/k0zmzgl69a5movvb.js","assets/on3itl42gzbvzq7p.js","assets/nmyaen56tvaynpzw.js","assets/m70bzg2rlawuoqn7.js","assets/f1b2tkhvhrzrzimd.js","assets/h7a2i9szhr1oreez.js","assets/f1jny6qiwjj6827q.js","assets/fhjlrbr00ynohqtm.js","assets/n8rik0tqbmhjtbxa.js","assets/c2jz1rroiwne9uq1.js","assets/bowntrjrngm25caj.js","assets/c9xhpa0isto3foiv.js","assets/nxkvdrqju2o1909p.js","assets/cga8drjd1xujfimm.js","assets/jhr269i6izlz9q7b.js","assets/hb8zfhfph6rrs14f.js","assets/sso-hxpl3fvhyqxhpyph.js","assets/iku1hvjks6jipewh.js","assets/opz2usaahkrk9kvf.js","assets/f5zz87pzro0bvev0.js","assets/nflmz87cjlokmdt0.js","assets/ey1mprvze9iz6xnz.js","assets/ntmrgc3sobmhb8mg.js","assets/gojjstisjawxkhia.js","assets/dcw0gcymxixegvuz.js","assets/l03sjt55neu7ww62.js","assets/oybpw5cj3pmzp3gw.js","assets/ed9apa6nugx02p91.js","assets/kqwdyvkaaavvn8k3.js","assets/dexlmlysp8ur9tox.js","assets/ffw9r9vtjty7r6kx.js","assets/h0mtng0l3pczusw8.js","assets/o678f1kfu3dee4ks.js","assets/h3lygw5wyn2lt7cp.js","assets/hgakfx18vf4bpc0z.js","assets/gk9dcn7rszecx2d7.js","assets/mnqxdow4oxuqdqde.js","assets/flzs6tvr4tx2g7kt.js","assets/j6i8cn6u5ojkd6dc.js","assets/k0by5neu8ex3zlmc.js","assets/omcjorutnqve3rpw.js","assets/nhwwej1nq0zrd7sc.js","assets/kbz5jw0htmlxznfn.js","assets/fxv36hg0pbjigkh8.js","assets/iy79os8ixniqngii.js","assets/kl5ztq095pzskmm9.js","assets/laihi52ypml1gq21.js","assets/f13yxposwovymnz1.js","assets/ib6ql2ai8yud8sep.js","assets/mplw0hdl0rlge44m.js","assets/i1p6kd7jvrl33vd9.js","assets/isjdmfmhzv09v01t.js","assets/fe9rwf09h7ccwajf.js","assets/jq6vzxkp4vdixwi2.js","assets/dhur8i9rh66ybcbz.js","assets/c5o6bgsogsfdyj6r.js","assets/hh8phknhgxjff92m.js","assets/bjs4b78brttgb4vm.js","assets/o40czph35bynblqr.js","assets/g7xddtwyiwnrj252.js","assets/ffoaczwftegxx0l8.js","assets/i5gud42jhg06v6rj.js","assets/iej0cupg2dqkmejt.js","assets/euiaihcbgww1zqqb.js","assets/jk8w36bsokizpx57.js","assets/o7ugwr96a2j2bjba.js","assets/ntesba8l69kstc5e.js","assets/1ga05nkh0lx0d32t.js","assets/ogxr4bldmdb42m4j.js","assets/c073my5nxzva9gga.js","assets/b4k2drzdj1qawmiv.js","assets/i65j9ypr2w1hsms2.js","assets/b2bwth75e0pxwp0y.js","assets/lq2uvn0fnath586d.js","assets/cqhtiy9vf7lfo47v.js","assets/kaz1rjei96viud82.js","assets/orw2o2v5x7tvtthh.js","assets/shared-mk6ngktc.css","assets/sso-jmjhjxeo.css","assets/mxar5mbxnuehsu4r.js","assets/fs8qbp2ozlhg0mlf.js"])))=>i.map(i=>d[i]);
var ho=Object.defineProperty;var zn=t=>{throw TypeError(t)};var mo=(t,e,s)=>e in t?ho(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var X=(t,e,s)=>mo(t,typeof e!="symbol"?e+"":e,s),en=(t,e,s)=>e.has(t)||zn("Cannot "+s);var i=(t,e,s)=>(en(t,e,"read from private field"),s?s.call(t):e.get(t)),W=(t,e,s)=>e.has(t)?zn("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),N=(t,e,s,a)=>(en(t,e,"write to private field"),a?a.call(t,s):e.set(t,s),s),j=(t,e,s)=>(en(t,e,"access private method"),s);var ms=(t,e,s,a)=>({set _(o){N(t,e,o,s)},get _(){return i(t,e,a)}});import{H as Qe,cs as bt,j as n,N as Le,aC as As,eq as It,f9 as xa,bD as go,r as m,aD as ya,R as De,ag as Ns,c as te,e7 as ns,P as Z,A as ee,K as P,cm as xt,c2 as yt,as,aN as Es,B as Ft,bw as fo,aU as po,fD as bo,cN as be,cA as xo,ax as yo,bt as Tt,cq as Mn,fE as vo,L as So,ak as ze,fF as va,eb as Sa,c8 as it,cD as wo,cE as _o,cH as Xt,a7 as cn,cF as Bn,cG as Co,J as gt,fG as Mo,cK as ko,aQ as Ss,a_ as To,cz as wa,O as Ye,d9 as jo,ai as Kt,fm as Ao,cX as Qt,eh as ws,bz as No,aM as kn,bM as ie,fy as Gn,bQ as at,w as Eo,fx as Io,fH as _a,fl as Fo,u as Ro,E as Ca,dl as Po,a4 as Wn,fI as Do,fJ as Lo,bB as Oo,cx as Uo,fK as zo,cZ as Bo,c_ as Go,c$ as Wo,el as Ho,fL as Hn,fj as Vo,bA as qo,aT as $o,bo as Ko}from"./gdbo8e7dyfri4is1.js";import{d as Is,H as Ma,c as Tn,A as Qo,I as Yo,S as Xo,G as Jo,z as Zo,u as ei,a as ti,J as si,m as ni,K as ai,f as oi}from"./gjmdn4uakoveniqh.js";import{G as ii,T as ri}from"./f1jny6qiwjj6827q.js";import{hI as ka,cq as jn,cp as An,cs as Nn,n as Fs,b4 as En,hJ as li,B as Ta,eA as Vn,A as ja,eF as ci,bJ as Aa,aE as Na,gr as Ea,hK as di,dK as ui,ax as hi,hL as mi,aa as gi,cw as fi,c5 as pi,ey as bi,u as Zt,hM as _s,dO as Ia,eo as xi,a5 as yi,hN as Fa,dS as Cs,ep as vi,am as os,aY as Si,bR as dn,a8 as wi,hO as _i,r as bs,eD as Ci,aS as un,hP as Mi,hQ as ki,fU as Ti,U as ji,b3 as Ai,gp as Ni,s as Ra,hR as Pa,hS as Ei,a0 as Ii,hT as Fi,v as Ms,aq as ot,bu as ks,bY as In,eJ as Ri,hU as Pi,eG as Da,a3 as Di,hV as Li,hW as Oi,cM as Ui,F as zi,hX as Bi,hY as Gi,hZ as Wi,h_ as Hi,h$ as Vi,i0 as qi,i1 as $i,i2 as Ki,i3 as Qi,eB as Yi,k as Xi,l as Ji,i4 as Zi,ez as er,E as tr,ad as sr,cP as nr,i5 as qn,hs as $n,i6 as ar,g3 as or,bk as ir,i7 as rr,es as lr,et as cr,w as dr,i8 as ur,gy as Kn,i9 as hr,P as mr,ia as gr,ib as fr,ic as pr,id as br,ie as xr,ig as yr,ih as vr}from"./lfqdgp7xsc2kl8bj.js";import{a as Sr,t as hn,T as La,H as wr,b as _r,c as Cr,d as Mr,e as kr,M as mn}from"./f1b2tkhvhrzrzimd.js";import{P as Tr,v as jr,C as gn,w as Ar,l as Nr,x as tn,y as Er,u as Ir,z as sn,F as Fr,T as Rr}from"./fxv36hg0pbjigkh8.js";import{e as Pr,i as Jt,A as Oa,T as B,f as vt,g as Fn,u as Rn,b as Dr,L as Ua,d as Rs,c as Ps,M as Qn,j as Yn,N as Lr,q as Ds,a as Or,O as Ur,P as zr,Q as Br,k as Gr,h as Wr,R as Hr,S as Vr,U as za,D as Ba,V as qr,W as $r,w as Ga,X as Wa}from"./jjkm88pkr4s7hxuh.js";import{W as Kr,G as Qr,H as Yr,I as Pn}from"./laihi52ypml1gq21.js";import{m as Et}from"./kt8ugt55ef8vx1kh.js";import{U as Xr,b as Ha,bc as Ls,aI as Jr,ba as Zr,bP as Va,bQ as qa,a2 as el,bR as tl,bS as sl,aF as nl,bT as al,w as ol,ax as $a,ay as Ka,a as il,aw as rl,av as ll,S as cl,t as dl,bg as ul,bK as hl}from"./hx4nuyiea8nyedix.js";import{H as ml}from"./gvt8blmqiqg0upqe.js";import{G as gl,L as fl}from"./m70bzg2rlawuoqn7.js";import{d as pl,r as bl}from"./cga8drjd1xujfimm.js";import{T as xl,u as yl,M as Qa,a as vl,b as Sl,C as wl,W as _l}from"./mplw0hdl0rlge44m.js";import{b as Cl,C as Ml}from"./c9xhpa0isto3foiv.js";import"./ntmrgc3sobmhb8mg.js";import{D as ke,$ as Ya}from"./k0zmzgl69a5movvb.js";import{a as kl,G as Tl}from"./nmyaen56tvaynpzw.js";import{M as jl}from"./o7ugwr96a2j2bjba.js";import{I as Al}from"./oybpw5cj3pmzp3gw.js";function nn({label:t,tooltip:e,Icon:s}){return n.jsxs("div",{className:"flex items-center gap-1 text-sm font-semibold opacity-70",children:[s&&n.jsx(s,{className:"icon-sm"}),n.jsx("div",{children:t}),n.jsx(Fs,{label:e,children:n.jsx(Ha,{className:"icon-sm ml-1"})})]})}function Nl({clientThreadId:t,gizmoId:e}){const s=Qe(),a=ka(),o=jn(),r=An(),{data:l}=Nn(e,!1,r),c=!!e,d=bt(),h=Pr(t);return r?d&&(!h||c)?n.jsx(nn,{label:s.formatMessage(Ct.temporaryChat),tooltip:s.formatMessage(Ct.temporaryChatTooltip),Icon:Xr}):a&&!o&&!d?n.jsx(nn,{label:s.formatMessage(Ct.memoryOff),tooltip:s.formatMessage(Ct.memoryOffTooltip)}):l&&(l==null?void 0:l.memoryFullPct)>=100?n.jsx(nn,{label:s.formatMessage(Ct.memoryFull),tooltip:s.formatMessage(Ct.memoryFullTooltip)}):null:null}const Ct=Le({temporaryChat:{id:"ConversationPrivacyIndicator.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatTooltip:{id:"ConversationPrivacyIndicator.temporaryChatTooltip",defaultMessage:"Temporary Chats won't appear in your history, and ChatGPT won't remember anything you talk about."},memoryOff:{id:"ConversationPrivacyIndicator.memoryOff",defaultMessage:"Memory Off"},memoryOffTooltip:{id:"ConversationPrivacyIndicator.memoryOffTooltip",defaultMessage:"ChatGPT won't remember anything you talk about in this conversation."},memoryFull:{id:"2Eq+5y",defaultMessage:"Memory Full"},memoryFullTooltip:{id:"dNA8jQ",defaultMessage:"ChatGPT's memory is full. You can forget existing memories to make space."}}),Xn=4;function El(t){const{layer:e}=As("4031588851"),{layer:s}=It("4031588851");return t?e.get("enable_new_homepage",!1):s.get("enable_new_homepage",!1)}function Il(){const{layer:t}=It("4031588851"),e=t.get("autocomplete_qualified_start_date","2099-09-13T00:00:00Z"),s=En();return!!s&&s.created*1e3>=new Date(e).getTime()}function Fl(t){const{layer:e}=As("3533083032"),{layer:s}=It("3533083032");return t?e.get("enable_new_homepage_anon",!1):s.get("enable_new_homepage_anon",!1)}function Rl(t){const{layer:e}=As("4031588851"),{layer:s}=It("4031588851");return t?e.get("enable_new_autocomplete_homepage",!1):s.get("enable_new_autocomplete_homepage",!1)}function Pl(t){return n.jsx(Kr,{children:e=>n.jsx(Dl,{...t,composerController:e})})}function Dl({clientThreadId:t,currentModelId:e,onRequestCompletion:s,composerController:a}){const o=Jt(t),r=Oa(t),l=xa(),c=go(),[d,h]=m.useState([]),y=m.useRef(!1);li(a);const b=ya("589604007").value,{layer:p}=It("4031588851"),{promptStarters:x,isSuccess:S,isError:g}=Sr(o&&!r,t,c?4:8,b,!0,e),f=!!d.find(A=>!!A.requires_file_upload),u=m.useCallback(A=>{const R=a.getCurrentText();return R&&`${A.title}${A.body}`.toLowerCase().startsWith(R.toLowerCase())},[a]),v=m.useCallback(A=>{const R=a.getCurrentText(),M=A.title+A.body;return u(A)?{...A,title:R,body:M.slice(R.length)}:{...A,title:M,body:""}},[a,u]),w=m.useCallback((A=!1)=>{h(R=>!R.some(u)&&R.length>0?[]:A?R:R.map(v))},[u,v]),C=(A,R,M)=>{const q=`${A.title} `;h([]),a.focus(),a.setText(q),requestAnimationFrame(()=>{const H=((x==null?void 0:x.filter(G=>G.theme===A.theme))??[]).map(G=>({...G,title:`${G.title} `,type:Vn.Autocomplete}));h(H),H.length>0&&hn(H,t),_r(A,M,t)})},T=x==null?void 0:x.reduce((A,R)=>(R.theme&&!A[R.theme]&&(A[R.theme]=R),A),{}),D=[];if(T)for(const A in T)D.push(T[A]);const E=D&&D.length>0,V=!!(S&&E),O=Xn-d.filter(u).length,k=p.get("autocomplete_mode","HARDCODED"),L=m.useCallback(Ta(async A=>{const R=a.getCurrentText();if(!R||R.length<2||R.length>80){h([]);return}if(!y.current)try{const q=(await De.generateAutocompletions(R,A)).completions.map(H=>({id:Ns(),type:Vn.Autocomplete,title:R,body:H.slice(R.length),oneliner:H,prompt:H})).filter(u).map(v);h(H=>{const G=H.filter(u),J=q.filter(ve=>!G.some(Te=>Te.title===ve.title&&Te.body===ve.body)).slice(0,Xn-G.length);return[...G,...J]}),q.length>0&&hn(q,t)}catch{}},k==="BING"?150:200),[a,k,v]),U=m.useCallback(()=>{w(),O>0&&L(O)},[L,w,O]);m.useEffect(()=>{y.current&&h([])},[y]);const I=m.useMemo(()=>k==="HARDCODED"?w:U,[k,U,w]),Q=m.useCallback(()=>{a instanceof Qr&&w(!0)},[a,w]);return n.jsx(n.Fragment,{children:n.jsx(ja,{children:(g||S)&&n.jsx(n.Fragment,{children:n.jsx(La,{isStaticSharedThread:!1,showInlineEmbeddedDisplay:!1,withVerticalPadding:!0,withHorizontalPadding:!0,clientThreadId:t,children:n.jsxs(wr,{children:[n.jsx(Ll,{}),n.jsx("div",{className:"w-full",children:n.jsx(Tr,{clientThreadId:t,isNewThread:o,currentModelId:e,onRequestCompletion:s,showPromptStarters:!1,composerController:a,autocompletions:d,requiresFileUpload:f,onComposerInput:I,onComposerChange:Q,onAutocompleteSelect:(A,R,M)=>{h([R[M]])},onTaggingDropdownClose:()=>{y.current=!1},onTaggingDropdownOpen:()=>{y.current=!0},hideHeader:!0})}),V&&n.jsx(Ol,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},promptStarters:D,onSelectStarterPrompt:C,isSendBlocked:l,clientThreadId:t,className:"h-8"})]})})})})})}function Ll(){const{layer:t}=It("4031588851"),e=t.get("headline_option","HELP_WITH"),a=Qe().formatMessage(e==="WHERE_TO_START"?fn.whereShouldWeStart:fn.whatCanIHelpWith),[o,r]=m.useState(1),[l,c]=m.useState(!0),d=20;return m.useEffect(()=>{let h;return o<a.length?h=setTimeout(()=>{r(o+1)},d):l&&(h=setTimeout(()=>{c(!1)},500)),()=>clearTimeout(h)},[a,o,l]),n.jsx("div",{className:"text-center",children:n.jsxs("div",{className:"mb-7 inline-flex justify-center text-2xl font-semibold leading-9",children:[n.jsx("h1",{children:a.substring(0,o)}),n.jsx("h1",{className:"result-streaming transition-opacity",style:{opacity:l?1:0},children:n.jsx("span",{})})]})})}function Ol({promptStarters:t,onSelectStarterPrompt:e,isSendBlocked:s,clientThreadId:a,...o}){return n.jsx(Et.div,{...o,children:n.jsx(Gl,{starterPrompts:t,onSelectStarterPrompt:e,disabled:s,clientThreadId:a})})}const Ul=/\s/;function zl({starterPrompt:t,starterPrompts:e,index:s,disabled:a,onSelectStarterPrompt:o}){const r=t.theme??t.title,l=Ul.test(r);return n.jsxs("button",{className:"relative flex items-center gap-1.5 rounded-full border border-token-border-light px-3 py-2 text-start text-[13px] shadow-xxs transition enabled:hover:bg-token-main-surface-secondary disabled:cursor-not-allowed xl:gap-2 xl:text-[14px]",disabled:a,onClick:()=>o(t,e,s),children:[n.jsx(ci,{starterPrompt:t,useV2Colors:!0}),n.jsx("div",{className:te("max-w-full text-balance text-gray-600 dark:text-gray-500",l?"break-word":"break-all"),children:r})]})}function Jn({starterPrompts:t,onSelectStarterPrompt:e,disabled:s,clientThreadId:a,children:o}){return m.useEffect(()=>{hn(t,a)},[a]),n.jsxs("ul",{className:"flex max-w-3xl flex-wrap items-stretch justify-center gap-2 xl:mx-3 xl:gap-2.5",children:[t.map((r,l)=>n.jsx(Et.li,{initial:{opacity:0},animate:{opacity:1},transition:{delay:l*.03},exit:{opacity:0},children:n.jsx(zl,{starterPrompt:r,starterPrompts:t,index:l,disabled:s,onSelectStarterPrompt:e})},r.id??l)),o]})}function Bl({clientThreadId:t,onClick:e}){m.useEffect(()=>{Cr(t)},[t]);const s=Qe();return n.jsx("button",{className:"relative flex max-w-full items-center gap-2 text-balance rounded-full border border-token-border-light px-3 py-2 text-start text-[14px] text-gray-600 shadow-xxs transition enabled:hover:bg-token-main-surface-secondary disabled:cursor-not-allowed dark:text-gray-500",onClick:()=>{Mr(t),e()},children:s.formatMessage(fn.moreStarterPrompts)})}function Gl({starterPrompts:t,onSelectStarterPrompt:e,disabled:s,clientThreadId:a}){const[o,r]=m.useState(4),l=4,c=t.slice(0,l),d=t.slice(l,o).map(h=>({...h,isAdditional:!0}));return n.jsxs("div",{className:"mt-7 flex flex-col flex-wrap gap-y-2.5",children:[n.jsx("div",{children:n.jsx(Jn,{starterPrompts:c,onSelectStarterPrompt:e,disabled:s,clientThreadId:a,children:t.length>o&&n.jsx(Bl,{clientThreadId:a,onClick:()=>{r(t.length)}})})}),d&&d.length>0&&n.jsx(Jn,{starterPrompts:d,onSelectStarterPrompt:e,disabled:s,clientThreadId:a})]})}const fn=Le({whatCanIHelpWith:{id:"SplashScreenV2.whatCanIHelpWith",defaultMessage:"What can I help with?"},whereShouldWeStart:{id:"SplashScreenV2.whereShouldWeStart",defaultMessage:"Where should we start?"},moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}});function Wl({children:t}){const e=Aa(Na.AG8PqS2q),{eligible:s,isLoading:a}=pl(),{doesUserHaveAnyAccountsWithPlusFeatures:o}=ns(),r=s&&!a;if(m.useEffect(()=>{r&&Z.logEvent(ee.gpt4oNUXTooltipShown)},[r]),!r)return n.jsx(n.Fragment,{children:t});const l=()=>{Z.logEvent(ee.gpt4oNUXTooltipDismissed),e.markAsViewed()};return n.jsx(Ea,{side:"bottom",show:!0,title:n.jsx(P,{...an.title,values:{modelName:"GPT‑4o"}}),onDismiss:l,sideOffset:0,theme:"default",description:n.jsx(P,{...o?an.bodyPaidFinal:an.bodyFreeFinal,values:{modelName:"GPT‑4o",anotherModelName:"GPT‑4"}}),children:t})}const an=Le({title:{id:"1kewDD",defaultMessage:"Introducing {modelName}"},bodyPaidFinal:{id:"Z6KHqN",defaultMessage:"You can now try our newest model, {modelName}. It’s faster than {anotherModelName}, better at understanding images, and speaks more languages."},bodyFreeFinal:{id:"w8Y79o",defaultMessage:"You now have limited access to our latest model, {modelName}. It’s smarter, understands images, can browse the web, and speaks more languages."}}),Hl=xt(()=>yt(()=>import("./nuwv3h2ffb5rrf1b.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30])).then(t=>t.GizmoUsingAsOwnerNotice)),Vl=({clientThreadId:t})=>{const e=gi(d=>d.activeStageSidebar),s=B.getServerThreadId(t),a=fi(Es.WorkspaceShareLinks),{isUnauthenticated:o}=Ft(),r=bt(),l=a&&s&&!o&&!r,c=!e;return n.jsx("div",{className:"flex items-center gap-2 pr-1 leading-[0]",children:n.jsx(Ml,{showShareButton:l,showProfileDropdown:c,clientThreadId:t})})};function ql({clientThreadId:t,gizmoId:e}){var r;const s=di(),{data:a}=Is(e),o=as();return n.jsxs(n.Fragment,{children:[n.jsxs(ui,{className:"max-md:hidden",children:[n.jsxs("div",{className:"absolute start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2",children:[a!=null&&(o==null?void 0:o.isWorkspaceAccount())&&((r=a.gizmo.tags)==null?void 0:r.includes(hi.WorkspaceDisabled))&&n.jsx(Hl,{gizmo:a}),n.jsx(Nl,{gizmoId:e,clientThreadId:t})]}),n.jsx(Wl,{children:n.jsxs("div",{className:"flex items-center gap-0 overflow-hidden",children:[n.jsx(Cl,{clientThreadId:t}),n.jsx(xl,{clientThreadId:t})]})}),n.jsx(Vl,{clientThreadId:t})]}),s&&n.jsx(mi,{})]})}function Xa({clientThreadId:t}){const e=vt(t);return Fn()?null:n.jsx(ql,{gizmoId:e,clientThreadId:t})}function $l({clientThreadId:t,currentModelId:e,onRequestCompletion:s,enableV2Homepage:a}){const o=bt();let r=n.jsx(fl,{}),l;return o?(l=n.jsx(Kl,{}),r=n.jsx(po,{className:"mb-6 h-12 w-12"})):t!=null?(l=a?n.jsx(Pl,{clientThreadId:t,currentModelId:e,onRequestCompletion:s}):n.jsx(kr,{clientThreadId:t}),r=null):l=n.jsx(Ql,{}),n.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-token-text-primary",children:[r,l]})}function Kl({gizmo:t}){const e=ka(),s=t?Yr(t.tools):!1,a=as();return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"mb-5 text-2xl font-semibold",children:n.jsx(P,{...ht.temporaryChat})}),n.jsxs("div",{className:"max-w-sm text-center text-sm font-normal text-token-text-tertiary",children:[n.jsx(P,{...a!=null&&a.isWorkspaceAccount()?e?ht.temporaryChatBizMemoryAvailable:ht.temporaryChatBizMemoryUnavailable:e?ht.temporaryChatDescriptionMemoryAvailable:ht.temporaryChatDescriptionMemoryUnavailable}),s&&n.jsx("div",{className:"mt-3",children:n.jsx(P,{...ht.temporaryChatDescriptionGptActions,values:{link:o=>n.jsx("a",{href:"https://help.openai.com/en/articles/8914046-temporary-chat-faq",target:"_blank",className:"underline",rel:"noreferrer",children:o})}})})]})]})}function Ql(){return n.jsx("div",{className:"mb-5 text-2xl font-semibold",children:n.jsx(P,{...ht.howCanIHelpYouToday})})}function Yl({clientThreadId:t,currentModelId:e,onRequestCompletion:s,enableV2Homepage:a}){const o=vt(t),r=pi(),l=xa(),{data:c}=Is(o),d=bi(),h=fo(()=>navigator.windowControlsOverlay);return(r!=null||o!=null)&&c==null?null:n.jsxs("div",{className:"relative h-full",children:[n.jsx("div",{className:h!=null&&h.visible?te("absolute right-[calc(100dvw-env(titlebar-area-width,100dvw)-env(titlebar-area-x,0))]",d?"left-[env(titlebar-area-x,0)]":"left-0"):"absolute left-0 right-0",children:n.jsx(Xa,{clientThreadId:t})}),c!=null?n.jsx(gl,{gizmo:c,showStarterPrompts:!0,disableStarterPrompts:l}):n.jsx($l,{clientThreadId:t,currentModelId:e,onRequestCompletion:s,enableV2Homepage:a})]})}const ht=Le({temporaryChat:{id:"GizmoLanding.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatBizMemoryAvailable:{id:"g1opBW",defaultMessage:"This chat won't appear in your history and won't use or create memories."},temporaryChatBizMemoryUnavailable:{id:"fQmbtG",defaultMessage:"This chat won't appear your conversation history."},temporaryChatDescriptionMemoryAvailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryAvailable",defaultMessage:"This chat won't appear in history, use or create memories, or be used to train our models. For safety purposes, we may keep a copy for up to 30 days."},temporaryChatDescriptionMemoryUnavailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryUnavailable",defaultMessage:"This chat won't appear in history or be used to train our models. For safety purposes, we may keep a copy of this chat for up to 30 days."},temporaryChatDescriptionGptActions:{id:"GizmoLanding.temporaryChatDescriptionGptActions",defaultMessage:"Any data shared with a third party through GPT actions are subject to the third party's privacy policy. <link>Learn more</link>"},howCanIHelpYouToday:{id:"GizmoLanding.howCanIHelpYouToday",defaultMessage:"How can I help you today?"}});function Ja(t){const s=Rn(t)==="root",a=Dr(t),o=Zt(a),{serviceStatus:r}=m.useContext(bo),l=_s(),{isUnauthenticated:c}=Ft(),d=Ua(t);return!s&&!o&&!(r!=null&&r.oof)&&!l.displayingSideBySideFeedback&&!c&&!d}const Za=({clientThreadId:t,message:e})=>{var v,w,C,T,D,E,V,O;const s=yl(),a=Ma(),o=Aa(Na.ModelSwitcherAutoDowngrade),{categories:r}=Tn({isRegen:!0}),l=Qo({clientThreadId:t}),{doesUserHaveAnyAccountsWithPlusFeatures:c}=ns(),d=Yo()!=null,h=[];for(const k of r){if(Ia(k))continue;const{defaultModel:L,label:U,tagline:I,categoryId:Q,subscriptionLevel:A,subcategory:R}=k,M=(w=(v=l[L])==null?void 0:v.regenerate)==null?void 0:w[0];h.push({label:U,value:L,subtitle:I,icon:n.jsx(Qa,{className:"icon-md h-4 w-4",categoryId:Q,type:"filled"}),modelSwitcherDeny:M,subscriptionLevel:A,subcategory:R})}const y=Xl(t,e.nodeId),b=(C=e.message.metadata)==null?void 0:C.model_slug,p=(T=s.find(k=>k.value===b))==null?void 0:T.name,x=b!=null?a[b]:void 0,S=(x==null?void 0:x.enabledTools)||[],g=Jl(d,y,b),f=(D=e.message.metadata)==null?void 0:D.model_adjustments,u=c&&o.eligible&&!o.isLoading&&p&&((E=h[0])==null?void 0:E.label)&&p!==((V=h[0])==null?void 0:V.label)&&(f==null?void 0:f.some(k=>k.startsWith("auto:smaller_model")));return{modelOptions:h,modelSlug:b,messageModelEnabledTools:S,animateModelLabelOnRender:g,nuxProps:{shouldRenderNux:u,usedModelName:p,largestModelName:(O=h[0])==null?void 0:O.label,announcement:o}}};function Xl(t,e){var l,c;return(c=(l=B.getTree(t).getConversationTurns(e).flatMap(d=>d.messages).filter(d=>d.message.author.role===be.Assistant&&!xo(d.message)).reverse()[1])==null?void 0:l.message.metadata)==null?void 0:c.model_slug}function Jl(t,e,s){return t&&!e?!0:!!(e&&s!==e)}function Zl(){const{doesUserHaveAnyAccountsWithPlusFeatures:t}=ns(),{categories:e}=Tn();return!!t||!!e.find(Ia)}const kt=({modelSwitcherDeny:t,value:e,label:s,subtitle:a,icon:o,onMouseEnter:r,onMouseLeave:l,onSelect:c,messageModelSlug:d,isHovered:h=!1,shouldShowUpsell:y=!1,className:b,includeCheck:p,includeRegenerate:x,justifyIcon:S,wrapIcon:g=!0})=>{const f=as(),u=!t,v=!u&&!y,w=yo(),C=()=>{if(!y){c==null||c();return}Z.logEvent(ee.openModalAccountPaymentfromMessageModelPicker),Z.logRateLimitGetPlusButtonClicked({type:Mn.RATE_LIMIT,location:"message_model_switcher_dropdown",plan_type:(f==null?void 0:f.planType)??"unknown",is_hard_block:!1,hard_block_reason:"",is_new_conversation:!1}),yi(w,"Message model switcher dropdown")};return n.jsx(ke.Item,{onSelect:C,onMouseEnter:()=>u&&(r==null?void 0:r()),onMouseLeave:()=>u&&(l==null?void 0:l()),disabled:v,className:b??"radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed radix-disabled:hover:bg-transparent",children:n.jsxs(Fs,{label:t&&n.jsx(xi,{modelSwitcherDeny:t}),className:"flex w-full items-center justify-between gap-2",sideOffset:0,children:[n.jsxs("div",{className:te("flex items-center gap-3",S==="right"&&"w-full"),children:[!!o&&(g?n.jsx("span",{className:te("flex h-7 w-7 items-center justify-center rounded-full bg-token-main-surface-secondary",S==="right"&&"order-10 ml-auto"),children:o}):o),n.jsxs("div",{children:[n.jsx("div",{children:s}),n.jsx("div",{className:te({"text-sm text-token-text-secondary":!v},{"text-sm text-token-text-quaternary":v}),children:a})]})]}),y?n.jsx(Tt,{color:"secondary",size:"small",children:n.jsx(P,{id:"54fmrA",defaultMessage:"Get Plus"})}):n.jsx(ec,{messageModelSlug:d,isHovered:h,modelSwitcherDeny:t,optionModelSlug:e,includeCheck:p,includeRegenerate:x})]})})},ec=({modelSwitcherDeny:t,optionModelSlug:e,isHovered:s,messageModelSlug:a,includeRegenerate:o=!0,includeCheck:r=!0})=>{let l=null;if(t)switch(t.reason){case Mn.RATE_LIMIT:l=Zr;break;default:l=Ha;break}if(t)return n.jsx(l,{className:"icon-md"});const c=!!o&&n.jsx(Ls,{className:te("icon-md hidden text-token-text-tertiary",{"group-hover:block":s})});return a===e&&r?n.jsxs(n.Fragment,{children:[n.jsx(Jr,{className:te("icon-md text-token-text-primary",{"group-hover:hidden":s})}),c]}):c};function tc({className:t,clientThreadId:e,message:s,onModelSelect:a,onDropdownChange:o}){var R;const r=Qe(),[l,c]=m.useState(null),[d,h]=m.useState(!1),[y,b]=m.useState(!1),p=Zl(),x=Ja(e),S=vt(e),g=Za({clientThreadId:e,message:s}),f=(R=s.message.metadata)==null?void 0:R.model_slug,{modelOptions:u,modelSlug:v,animateModelLabelOnRender:w,nuxProps:C,messageModelEnabledTools:T}=g,D=Fa(s.message),E=T.includes(Cs.Search),V=m.useMemo(()=>u.find(M=>M.value==f),[u,f]),{doesUserHaveAnyAccountsWithPlusFeatures:O}=ns(),k=m.useRef(null),L=M=>{M||setTimeout(()=>{k.current&&k.current.blur()},10)};if(m.useEffect(()=>{L(d)},[d]),!p||S)return null;const U=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:r.formatMessage(Zn.search),icon:n.jsx(Va,{className:"icon-sm"}),condition:E&&!D},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:r.formatMessage(Zn.nosearch),icon:n.jsx(qa,{className:"icon-sm"}),condition:E&&D}];let I,Q;C.shouldRenderNux?(I=nc,Q={title:n.jsx(P,{id:"g/+2Hh",defaultMessage:"Optimized your response"}),description:n.jsx(P,{id:"H0Flqm",defaultMessage:"Used {usedModelName} for a faster response that saves your limited {largestModelName} messages",values:{usedModelName:C.usedModelName,largestModelName:C.largestModelName}}),markAsViewed:C.announcement.markAsViewed}):(I=sc,Q={label:x?n.jsx(P,{id:"LBYK9a",defaultMessage:"Change model"}):n.jsx(P,{id:"nygjPN",defaultMessage:"Used {modelName}",values:{modelName:C.usedModelName}})});const A=x&&u.some(M=>es(M,O));return n.jsxs(ke.Root,{onOpenChange:M=>{x&&(h(M),o(M),L(M)),M&&Z.logEvent(ee.conversationOpenMessageModelSelector,{has_get_plus_button:A})},children:[n.jsx(I,{...Q,children:n.jsx(Ya,{ref:k,className:te("cursor-pointer",t),onMouseEnter:()=>b(!0),onMouseLeave:()=>b(!1),children:n.jsx(pn,{modelSlug:v,animateModelLabelOnRender:w,isDropdownOpen:d,isRegenerateEnabled:x,isHovered:y})})}),x&&n.jsxs(ke.Content,{className:"z-30 origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[u.map(M=>{var J;const q=es(M,O),{value:H,...G}=M;return n.jsx(kt,{value:H,onSelect:()=>a({requestedModelId:H}),onMouseEnter:()=>c(H),onMouseLeave:()=>c(null),isHovered:l===H,messageModelSlug:(J=s.message.metadata)==null?void 0:J.model_slug,shouldShowUpsell:q,...G},H)}),!!V&&n.jsxs(n.Fragment,{children:[n.jsx(ke.Separator,{}),U.filter(M=>M.condition).map(M=>n.jsx(kt,{onSelect:()=>a({requestedModelId:V.value,extraStreamParams:M.extraStreamParams}),includeRegenerate:!0,onMouseEnter:()=>c(M.key),onMouseLeave:()=>c(null),isHovered:l===M.key,messageModelSlug:f,includeCheck:!1,...V,label:M.label,subtitle:"",icon:M.icon},M.key))]})]})]})}function pn({modelSlug:t,animateModelLabelOnRender:e,isDropdownOpen:s,isRegenerateEnabled:a,isHovered:o,isRegenLabel:r=!1,animateShortLabel:l,omitIcon:c}){const[d,h]=m.useState("initial"),{categories:y}=Tn({isRegen:!!r});m.useEffect(()=>{if(e){const u=setTimeout(()=>h("show"),500),v=setTimeout(()=>h("initial"),2e3);return()=>{clearTimeout(u),clearTimeout(v)}}h("initial")},[e]);const b=y.find(({defaultModel:u})=>u===t),p=t===Xo?{categoryId:"gpt_3.5",shorterLabel:"3.5"}:{},{categoryId:x,shorterLabel:S}=b??p,g={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},f=s?"visible":o?"show":d;return n.jsxs(Et.div,{initial:"initial",animate:f,className:"flex items-center pb-0",children:[!c&&(r?n.jsx(Ls,{className:"icon-md"}):x&&n.jsx(Qa,{type:"outline",categoryId:x,className:"icon-md h-4 w-4"})),(a||l)&&n.jsx(Et.span,{className:"overflow-hidden text-clip whitespace-nowrap text-sm",variants:g,transition:{type:"tween",duration:.18},children:S}),a&&n.jsx(el,{className:te("icon-sm",{"text-token-text-quaternary":!o&&!r},{"text-token-text-secondary":o&&!r})})]})}function sc({children:t,label:e}){return n.jsx(Fs,{label:e,sideOffset:0,children:t})}function nc({children:t,title:e,description:s,markAsViewed:a}){return n.jsx(Ea,{show:!0,side:"bottom",sideOffset:-4,title:e,description:s,badge:"beta",onDismiss:a,dismissOnOutsideClick:!0,children:t})}function es(t,e){const{modelSwitcherDeny:s,subscriptionLevel:a}=t;return!!s&&s.reason===Mn.RATE_LIMIT&&a===vo.PLUS&&!e}const Zn=Le({search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),ac=m.memo(tc),ea=So.IndepthFeedbackDismissedAt;function oc(){const[t,e]=m.useState(()=>{const a=localStorage.getItem(ea);return a?ic(new Date(a)):!1}),s=m.useCallback(()=>{e(!0),localStorage.setItem(ea,new Date().toISOString())},[]);return[t,s]}function ic(t){const e=new Date;return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}function rc({clientThreadId:t,conversationLeafId:e,trigger:s,variantIds:a}){const o=a.find(y=>y!==e),r=os(y=>y.forceIndepthFeedback&&y.forceIndepthFeedbackPrompt),l=ze.getExperimentValue({experimentName:"4146182738",key:s==="paragen"?"enable_indepth_feedback_paragen":"enable_indepth_feedback_thumbsdown",defaultValue:!1,shouldLogExposure:!1}),c=ze.getExperimentValue({experimentName:"4146182738",key:s==="paragen"?"indepth_feedback_paragen_prompt":"indepth_feedback_thumbsdown_prompt",defaultValue:"",shouldLogExposure:!1}),d=o?B.getTree(t).getTextFromNode(o):"NONE";return(r||(l?c:"")).replace("{paragen_losing_response}",d)}function lc({clientThreadId:t,conversationLeafId:e,trigger:s,variantIds:a}){const[o,r]=oc(),l=dc({clientThreadId:t}),c=rc({clientThreadId:t,conversationLeafId:e,trigger:s,variantIds:a}),d=()=>{r(),Z.logEventWithStatsig(ee.messageIndepthFeedbackDeclined,"chatgpt_indepth_feedback_declined",{trigger:s})},h=()=>{const y=new dn;l(e,{intent:"indepth_feedback"},c,y),Z.logEventWithStatsig(ee.messageIndepthFeedbackAccepted,"chatgpt_indepth_feedback_accepted",{trigger:s})};return o||!c?null:n.jsx(Si,{content:n.jsx(P,{...on.indepthFeedbackPrompt}),primaryCtaText:n.jsx(P,{...on.indepthFeedbackAcceptButton}),onPrimaryCtaClick:h,secondaryCtaText:n.jsx(P,{...on.indepthFeedbackRejectButton}),onSecondaryCtaClick:d})}function cc(t){const e=t.rating==="thumbsDown"?"thumbsDown":vi(["original","new"],t.inlineComparisonRating)?"paragen":void 0,s=os(o=>o.forceIndepthFeedback);if(!e||s||e==="paragen"||ze.getExperimentValue({experimentName:"4146182738",key:"enable_indepth_feedback_thumbsdown",defaultValue:!1,shouldLogExposure:!0}))return e}function dc({clientThreadId:t}){const e=m.useContext(va),s=Rs.getConversationMode(t);return(o,r,l,c)=>{e({type:Sa.Next,promptId:o,eventMetadata:r,focusOnNewCompletion:!0,cancelActiveRequests:!1,completionMetadata:{conversationMode:s},useDefaultModel:!1,appendMessages:[{id:Ns(),author:{role:be.System},content:{content_type:it.Text,parts:[l]},metadata:{is_indepth_feedback:!0,indepth_feedback_prompt:l}}],turnTracker:c})}}const on=Le({indepthFeedbackPrompt:{id:"qEHwDx",defaultMessage:"Would you like to tell ChatGPT more about your feedback, so it can improve its responses?"},indepthFeedbackAcceptButton:{id:"IeyTQ7",defaultMessage:"Continue"},indepthFeedbackRejectButton:{id:"+o5xmp",defaultMessage:"Not now"},indepthFeedbackRejectAlwaysButton:{id:"Qdko+f",defaultMessage:"Don't ask again"}});function uc({clientThreadId:t,conversationMode:e}){const s=jr(t);return({id:o,eventMetadata:r,turnTracker:l,requestedModelId:c,systemMessage:d,juice:h,extraStreamParams:y})=>{const p=B.getTree(t).getConversationTurns(o),x=p==null?void 0:p[(p==null?void 0:p.length)-1].variantIds,S=(x==null?void 0:x.length)===1&&(y==null?void 0:y.forceUseSearch)===void 0,g=S?{...r,intent:"comparison_implicit"}:r;s({id:o,requestedModelId:c,eventMetadata:g,focusOnNewCompletion:!0,variantPurpose:S?"comparison_implicit":"none",conversationMode:e??Rs.getConversationMode(t),useDefaultModel:!1,appendMessages:d?[{id:Ns(),author:{role:be.System},content:{content_type:it.Text,parts:[d]},metadata:{exclude_after_next_user_message:!0}}]:void 0,juice:h,turnTracker:l,extraStreamParams:y})}}const Mt=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,eo=new Set,bn=typeof process=="object"&&process?process:{},to=(t,e,s,a)=>{typeof bn.emitWarning=="function"?bn.emitWarning(t,e,s,a):console.error(`[${s}] ${e}: ${t}`)};let Ts=globalThis.AbortController,ta=globalThis.AbortSignal;var fa;if(typeof Ts>"u"){ta=class{constructor(){X(this,"onabort");X(this,"_onabort",[]);X(this,"reason");X(this,"aborted",!1)}addEventListener(a,o){this._onabort.push(o)}},Ts=class{constructor(){X(this,"signal",new ta);e()}abort(a){var o,r;if(!this.signal.aborted){this.signal.reason=a,this.signal.aborted=!0;for(const l of this.signal._onabort)l(a);(r=(o=this.signal).onabort)==null||r.call(o,a)}}};let t=((fa=bn.env)==null?void 0:fa.LRU_CACHE_IGNORE_AC_WARNING)!=="1";const e=()=>{t&&(t=!1,to("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}const hc=t=>!eo.has(t),et=t=>t&&t===Math.floor(t)&&t>0&&isFinite(t),so=t=>et(t)?t<=Math.pow(2,8)?Uint8Array:t<=Math.pow(2,16)?Uint16Array:t<=Math.pow(2,32)?Uint32Array:t<=Number.MAX_SAFE_INTEGER?xs:null:null;class xs extends Array{constructor(e){super(e),this.fill(0)}}var jt;const mt=class mt{constructor(e,s){X(this,"heap");X(this,"length");if(!i(mt,jt))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new s(e),this.length=0}static create(e){const s=so(e);if(!s)return[];N(mt,jt,!0);const a=new mt(e,s);return N(mt,jt,!1),a}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}};jt=new WeakMap,W(mt,jt,!1);let xn=mt;var pa,ba,je,Se,Ae,Ne,At,oe,Ee,ne,K,F,fe,we,ge,le,Ie,ce,Fe,Re,_e,Pe,nt,pe,_,vn,ft,$e,ts,Ce,no,pt,Nt,ss,tt,st,Sn,ys,vs,$,wn,Yt;const On=class On{constructor(e){W(this,_);W(this,je);W(this,Se);W(this,Ae);W(this,Ne);W(this,At);X(this,"ttl");X(this,"ttlResolution");X(this,"ttlAutopurge");X(this,"updateAgeOnGet");X(this,"updateAgeOnHas");X(this,"allowStale");X(this,"noDisposeOnSet");X(this,"noUpdateTTL");X(this,"maxEntrySize");X(this,"sizeCalculation");X(this,"noDeleteOnFetchRejection");X(this,"noDeleteOnStaleGet");X(this,"allowStaleOnFetchAbort");X(this,"allowStaleOnFetchRejection");X(this,"ignoreFetchAbort");W(this,oe);W(this,Ee);W(this,ne);W(this,K);W(this,F);W(this,fe);W(this,we);W(this,ge);W(this,le);W(this,Ie);W(this,ce);W(this,Fe);W(this,Re);W(this,_e);W(this,Pe);W(this,nt);W(this,pe);W(this,ft,()=>{});W(this,$e,()=>{});W(this,ts,()=>{});W(this,Ce,()=>!1);W(this,pt,e=>{});W(this,Nt,(e,s,a)=>{});W(this,ss,(e,s,a,o)=>{if(a||o)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0});X(this,pa,"LRUCache");const{max:s=0,ttl:a,ttlResolution:o=1,ttlAutopurge:r,updateAgeOnGet:l,updateAgeOnHas:c,allowStale:d,dispose:h,disposeAfter:y,noDisposeOnSet:b,noUpdateTTL:p,maxSize:x=0,maxEntrySize:S=0,sizeCalculation:g,fetchMethod:f,noDeleteOnFetchRejection:u,noDeleteOnStaleGet:v,allowStaleOnFetchRejection:w,allowStaleOnFetchAbort:C,ignoreFetchAbort:T}=e;if(s!==0&&!et(s))throw new TypeError("max option must be a nonnegative integer");const D=s?so(s):Array;if(!D)throw new Error("invalid max value: "+s);if(N(this,je,s),N(this,Se,x),this.maxEntrySize=S||i(this,Se),this.sizeCalculation=g,this.sizeCalculation){if(!i(this,Se)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(f!==void 0&&typeof f!="function")throw new TypeError("fetchMethod must be a function if specified");if(N(this,At,f),N(this,nt,!!f),N(this,ne,new Map),N(this,K,new Array(s).fill(void 0)),N(this,F,new Array(s).fill(void 0)),N(this,fe,new D(s)),N(this,we,new D(s)),N(this,ge,0),N(this,le,0),N(this,Ie,xn.create(s)),N(this,oe,0),N(this,Ee,0),typeof h=="function"&&N(this,Ae,h),typeof y=="function"?(N(this,Ne,y),N(this,ce,[])):(N(this,Ne,void 0),N(this,ce,void 0)),N(this,Pe,!!i(this,Ae)),N(this,pe,!!i(this,Ne)),this.noDisposeOnSet=!!b,this.noUpdateTTL=!!p,this.noDeleteOnFetchRejection=!!u,this.allowStaleOnFetchRejection=!!w,this.allowStaleOnFetchAbort=!!C,this.ignoreFetchAbort=!!T,this.maxEntrySize!==0){if(i(this,Se)!==0&&!et(i(this,Se)))throw new TypeError("maxSize must be a positive integer if specified");if(!et(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");j(this,_,no).call(this)}if(this.allowStale=!!d,this.noDeleteOnStaleGet=!!v,this.updateAgeOnGet=!!l,this.updateAgeOnHas=!!c,this.ttlResolution=et(o)||o===0?o:1,this.ttlAutopurge=!!r,this.ttl=a||0,this.ttl){if(!et(this.ttl))throw new TypeError("ttl must be a positive integer if specified");j(this,_,vn).call(this)}if(i(this,je)===0&&this.ttl===0&&i(this,Se)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!i(this,je)&&!i(this,Se)){const E="LRU_CACHE_UNBOUNDED";hc(E)&&(eo.add(E),to("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",E,On))}}static unsafeExposeInternals(e){return{starts:i(e,Re),ttls:i(e,_e),sizes:i(e,Fe),keyMap:i(e,ne),keyList:i(e,K),valList:i(e,F),next:i(e,fe),prev:i(e,we),get head(){return i(e,ge)},get tail(){return i(e,le)},free:i(e,Ie),isBackgroundFetch:s=>{var a;return j(a=e,_,$).call(a,s)},backgroundFetch:(s,a,o,r)=>{var l;return j(l=e,_,vs).call(l,s,a,o,r)},moveToTail:s=>{var a;return j(a=e,_,Yt).call(a,s)},indexes:s=>{var a;return j(a=e,_,tt).call(a,s)},rindexes:s=>{var a;return j(a=e,_,st).call(a,s)},isStale:s=>{var a;return i(a=e,Ce).call(a,s)}}}get max(){return i(this,je)}get maxSize(){return i(this,Se)}get calculatedSize(){return i(this,Ee)}get size(){return i(this,oe)}get fetchMethod(){return i(this,At)}get dispose(){return i(this,Ae)}get disposeAfter(){return i(this,Ne)}getRemainingTTL(e){return i(this,ne).has(e)?1/0:0}*entries(){for(const e of j(this,_,tt).call(this))i(this,F)[e]!==void 0&&i(this,K)[e]!==void 0&&!j(this,_,$).call(this,i(this,F)[e])&&(yield[i(this,K)[e],i(this,F)[e]])}*rentries(){for(const e of j(this,_,st).call(this))i(this,F)[e]!==void 0&&i(this,K)[e]!==void 0&&!j(this,_,$).call(this,i(this,F)[e])&&(yield[i(this,K)[e],i(this,F)[e]])}*keys(){for(const e of j(this,_,tt).call(this)){const s=i(this,K)[e];s!==void 0&&!j(this,_,$).call(this,i(this,F)[e])&&(yield s)}}*rkeys(){for(const e of j(this,_,st).call(this)){const s=i(this,K)[e];s!==void 0&&!j(this,_,$).call(this,i(this,F)[e])&&(yield s)}}*values(){for(const e of j(this,_,tt).call(this))i(this,F)[e]!==void 0&&!j(this,_,$).call(this,i(this,F)[e])&&(yield i(this,F)[e])}*rvalues(){for(const e of j(this,_,st).call(this))i(this,F)[e]!==void 0&&!j(this,_,$).call(this,i(this,F)[e])&&(yield i(this,F)[e])}[(ba=Symbol.iterator,pa=Symbol.toStringTag,ba)](){return this.entries()}find(e,s={}){for(const a of j(this,_,tt).call(this)){const o=i(this,F)[a],r=j(this,_,$).call(this,o)?o.__staleWhileFetching:o;if(r!==void 0&&e(r,i(this,K)[a],this))return this.get(i(this,K)[a],s)}}forEach(e,s=this){for(const a of j(this,_,tt).call(this)){const o=i(this,F)[a],r=j(this,_,$).call(this,o)?o.__staleWhileFetching:o;r!==void 0&&e.call(s,r,i(this,K)[a],this)}}rforEach(e,s=this){for(const a of j(this,_,st).call(this)){const o=i(this,F)[a],r=j(this,_,$).call(this,o)?o.__staleWhileFetching:o;r!==void 0&&e.call(s,r,i(this,K)[a],this)}}purgeStale(){let e=!1;for(const s of j(this,_,st).call(this,{allowStale:!0}))i(this,Ce).call(this,s)&&(this.delete(i(this,K)[s]),e=!0);return e}info(e){const s=i(this,ne).get(e);if(s===void 0)return;const a=i(this,F)[s],o=j(this,_,$).call(this,a)?a.__staleWhileFetching:a;if(o===void 0)return;const r={value:o};if(i(this,_e)&&i(this,Re)){const l=i(this,_e)[s],c=i(this,Re)[s];if(l&&c){const d=l-(Mt.now()-c);r.ttl=d,r.start=Date.now()}}return i(this,Fe)&&(r.size=i(this,Fe)[s]),r}dump(){const e=[];for(const s of j(this,_,tt).call(this,{allowStale:!0})){const a=i(this,K)[s],o=i(this,F)[s],r=j(this,_,$).call(this,o)?o.__staleWhileFetching:o;if(r===void 0||a===void 0)continue;const l={value:r};if(i(this,_e)&&i(this,Re)){l.ttl=i(this,_e)[s];const c=Mt.now()-i(this,Re)[s];l.start=Math.floor(Date.now()-c)}i(this,Fe)&&(l.size=i(this,Fe)[s]),e.unshift([a,l])}return e}load(e){this.clear();for(const[s,a]of e){if(a.start){const o=Date.now()-a.start;a.start=Mt.now()-o}this.set(s,a.value,a)}}set(e,s,a={}){var p,x,S,g,f;if(s===void 0)return this.delete(e),this;const{ttl:o=this.ttl,start:r,noDisposeOnSet:l=this.noDisposeOnSet,sizeCalculation:c=this.sizeCalculation,status:d}=a;let{noUpdateTTL:h=this.noUpdateTTL}=a;const y=i(this,ss).call(this,e,s,a.size||0,c);if(this.maxEntrySize&&y>this.maxEntrySize)return d&&(d.set="miss",d.maxEntrySizeExceeded=!0),this.delete(e),this;let b=i(this,oe)===0?void 0:i(this,ne).get(e);if(b===void 0)b=i(this,oe)===0?i(this,le):i(this,Ie).length!==0?i(this,Ie).pop():i(this,oe)===i(this,je)?j(this,_,ys).call(this,!1):i(this,oe),i(this,K)[b]=e,i(this,F)[b]=s,i(this,ne).set(e,b),i(this,fe)[i(this,le)]=b,i(this,we)[b]=i(this,le),N(this,le,b),ms(this,oe)._++,i(this,Nt).call(this,b,y,d),d&&(d.set="add"),h=!1;else{j(this,_,Yt).call(this,b);const u=i(this,F)[b];if(s!==u){if(i(this,nt)&&j(this,_,$).call(this,u)){u.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:v}=u;v!==void 0&&!l&&(i(this,Pe)&&((p=i(this,Ae))==null||p.call(this,v,e,"set")),i(this,pe)&&((x=i(this,ce))==null||x.push([v,e,"set"])))}else l||(i(this,Pe)&&((S=i(this,Ae))==null||S.call(this,u,e,"set")),i(this,pe)&&((g=i(this,ce))==null||g.push([u,e,"set"])));if(i(this,pt).call(this,b),i(this,Nt).call(this,b,y,d),i(this,F)[b]=s,d){d.set="replace";const v=u&&j(this,_,$).call(this,u)?u.__staleWhileFetching:u;v!==void 0&&(d.oldValue=v)}}else d&&(d.set="update")}if(o!==0&&!i(this,_e)&&j(this,_,vn).call(this),i(this,_e)&&(h||i(this,ts).call(this,b,o,r),d&&i(this,$e).call(this,d,b)),!l&&i(this,pe)&&i(this,ce)){const u=i(this,ce);let v;for(;v=u==null?void 0:u.shift();)(f=i(this,Ne))==null||f.call(this,...v)}return this}pop(){var e;try{for(;i(this,oe);){const s=i(this,F)[i(this,ge)];if(j(this,_,ys).call(this,!0),j(this,_,$).call(this,s)){if(s.__staleWhileFetching)return s.__staleWhileFetching}else if(s!==void 0)return s}}finally{if(i(this,pe)&&i(this,ce)){const s=i(this,ce);let a;for(;a=s==null?void 0:s.shift();)(e=i(this,Ne))==null||e.call(this,...a)}}}has(e,s={}){const{updateAgeOnHas:a=this.updateAgeOnHas,status:o}=s,r=i(this,ne).get(e);if(r!==void 0){const l=i(this,F)[r];if(j(this,_,$).call(this,l)&&l.__staleWhileFetching===void 0)return!1;if(i(this,Ce).call(this,r))o&&(o.has="stale",i(this,$e).call(this,o,r));else return a&&i(this,ft).call(this,r),o&&(o.has="hit",i(this,$e).call(this,o,r)),!0}else o&&(o.has="miss");return!1}peek(e,s={}){const{allowStale:a=this.allowStale}=s,o=i(this,ne).get(e);if(o===void 0||!a&&i(this,Ce).call(this,o))return;const r=i(this,F)[o];return j(this,_,$).call(this,r)?r.__staleWhileFetching:r}async fetch(e,s={}){const{allowStale:a=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,ttl:l=this.ttl,noDisposeOnSet:c=this.noDisposeOnSet,size:d=0,sizeCalculation:h=this.sizeCalculation,noUpdateTTL:y=this.noUpdateTTL,noDeleteOnFetchRejection:b=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:p=this.allowStaleOnFetchRejection,ignoreFetchAbort:x=this.ignoreFetchAbort,allowStaleOnFetchAbort:S=this.allowStaleOnFetchAbort,context:g,forceRefresh:f=!1,status:u,signal:v}=s;if(!i(this,nt))return u&&(u.fetch="get"),this.get(e,{allowStale:a,updateAgeOnGet:o,noDeleteOnStaleGet:r,status:u});const w={allowStale:a,updateAgeOnGet:o,noDeleteOnStaleGet:r,ttl:l,noDisposeOnSet:c,size:d,sizeCalculation:h,noUpdateTTL:y,noDeleteOnFetchRejection:b,allowStaleOnFetchRejection:p,allowStaleOnFetchAbort:S,ignoreFetchAbort:x,status:u,signal:v};let C=i(this,ne).get(e);if(C===void 0){u&&(u.fetch="miss");const T=j(this,_,vs).call(this,e,C,w,g);return T.__returned=T}else{const T=i(this,F)[C];if(j(this,_,$).call(this,T)){const k=a&&T.__staleWhileFetching!==void 0;return u&&(u.fetch="inflight",k&&(u.returnedStale=!0)),k?T.__staleWhileFetching:T.__returned=T}const D=i(this,Ce).call(this,C);if(!f&&!D)return u&&(u.fetch="hit"),j(this,_,Yt).call(this,C),o&&i(this,ft).call(this,C),u&&i(this,$e).call(this,u,C),T;const E=j(this,_,vs).call(this,e,C,w,g),O=E.__staleWhileFetching!==void 0&&a;return u&&(u.fetch=D?"stale":"refresh",O&&D&&(u.returnedStale=!0)),O?E.__staleWhileFetching:E.__returned=E}}get(e,s={}){const{allowStale:a=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,status:l}=s,c=i(this,ne).get(e);if(c!==void 0){const d=i(this,F)[c],h=j(this,_,$).call(this,d);return l&&i(this,$e).call(this,l,c),i(this,Ce).call(this,c)?(l&&(l.get="stale"),h?(l&&a&&d.__staleWhileFetching!==void 0&&(l.returnedStale=!0),a?d.__staleWhileFetching:void 0):(r||this.delete(e),l&&a&&(l.returnedStale=!0),a?d:void 0)):(l&&(l.get="hit"),h?d.__staleWhileFetching:(j(this,_,Yt).call(this,c),o&&i(this,ft).call(this,c),d))}else l&&(l.get="miss")}delete(e){var a,o,r,l;let s=!1;if(i(this,oe)!==0){const c=i(this,ne).get(e);if(c!==void 0)if(s=!0,i(this,oe)===1)this.clear();else{i(this,pt).call(this,c);const d=i(this,F)[c];if(j(this,_,$).call(this,d)?d.__abortController.abort(new Error("deleted")):(i(this,Pe)||i(this,pe))&&(i(this,Pe)&&((a=i(this,Ae))==null||a.call(this,d,e,"delete")),i(this,pe)&&((o=i(this,ce))==null||o.push([d,e,"delete"]))),i(this,ne).delete(e),i(this,K)[c]=void 0,i(this,F)[c]=void 0,c===i(this,le))N(this,le,i(this,we)[c]);else if(c===i(this,ge))N(this,ge,i(this,fe)[c]);else{const h=i(this,we)[c];i(this,fe)[h]=i(this,fe)[c];const y=i(this,fe)[c];i(this,we)[y]=i(this,we)[c]}ms(this,oe)._--,i(this,Ie).push(c)}}if(i(this,pe)&&((r=i(this,ce))!=null&&r.length)){const c=i(this,ce);let d;for(;d=c==null?void 0:c.shift();)(l=i(this,Ne))==null||l.call(this,...d)}return s}clear(){var e,s,a;for(const o of j(this,_,st).call(this,{allowStale:!0})){const r=i(this,F)[o];if(j(this,_,$).call(this,r))r.__abortController.abort(new Error("deleted"));else{const l=i(this,K)[o];i(this,Pe)&&((e=i(this,Ae))==null||e.call(this,r,l,"delete")),i(this,pe)&&((s=i(this,ce))==null||s.push([r,l,"delete"]))}}if(i(this,ne).clear(),i(this,F).fill(void 0),i(this,K).fill(void 0),i(this,_e)&&i(this,Re)&&(i(this,_e).fill(0),i(this,Re).fill(0)),i(this,Fe)&&i(this,Fe).fill(0),N(this,ge,0),N(this,le,0),i(this,Ie).length=0,N(this,Ee,0),N(this,oe,0),i(this,pe)&&i(this,ce)){const o=i(this,ce);let r;for(;r=o==null?void 0:o.shift();)(a=i(this,Ne))==null||a.call(this,...r)}}};je=new WeakMap,Se=new WeakMap,Ae=new WeakMap,Ne=new WeakMap,At=new WeakMap,oe=new WeakMap,Ee=new WeakMap,ne=new WeakMap,K=new WeakMap,F=new WeakMap,fe=new WeakMap,we=new WeakMap,ge=new WeakMap,le=new WeakMap,Ie=new WeakMap,ce=new WeakMap,Fe=new WeakMap,Re=new WeakMap,_e=new WeakMap,Pe=new WeakMap,nt=new WeakMap,pe=new WeakMap,_=new WeakSet,vn=function(){const e=new xs(i(this,je)),s=new xs(i(this,je));N(this,_e,e),N(this,Re,s),N(this,ts,(r,l,c=Mt.now())=>{if(s[r]=l!==0?c:0,e[r]=l,l!==0&&this.ttlAutopurge){const d=setTimeout(()=>{i(this,Ce).call(this,r)&&this.delete(i(this,K)[r])},l+1);d.unref&&d.unref()}}),N(this,ft,r=>{s[r]=e[r]!==0?Mt.now():0}),N(this,$e,(r,l)=>{if(e[l]){const c=e[l],d=s[l];if(!c||!d)return;r.ttl=c,r.start=d,r.now=a||o();const h=r.now-d;r.remainingTTL=c-h}});let a=0;const o=()=>{const r=Mt.now();if(this.ttlResolution>0){a=r;const l=setTimeout(()=>a=0,this.ttlResolution);l.unref&&l.unref()}return r};this.getRemainingTTL=r=>{const l=i(this,ne).get(r);if(l===void 0)return 0;const c=e[l],d=s[l];if(!c||!d)return 1/0;const h=(a||o())-d;return c-h},N(this,Ce,r=>{const l=s[r],c=e[r];return!!c&&!!l&&(a||o())-l>c})},ft=new WeakMap,$e=new WeakMap,ts=new WeakMap,Ce=new WeakMap,no=function(){const e=new xs(i(this,je));N(this,Ee,0),N(this,Fe,e),N(this,pt,s=>{N(this,Ee,i(this,Ee)-e[s]),e[s]=0}),N(this,ss,(s,a,o,r)=>{if(j(this,_,$).call(this,a))return 0;if(!et(o))if(r){if(typeof r!="function")throw new TypeError("sizeCalculation must be a function");if(o=r(a,s),!et(o))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return o}),N(this,Nt,(s,a,o)=>{if(e[s]=a,i(this,Se)){const r=i(this,Se)-e[s];for(;i(this,Ee)>r;)j(this,_,ys).call(this,!0)}N(this,Ee,i(this,Ee)+e[s]),o&&(o.entrySize=a,o.totalCalculatedSize=i(this,Ee))})},pt=new WeakMap,Nt=new WeakMap,ss=new WeakMap,tt=function*({allowStale:e=this.allowStale}={}){if(i(this,oe))for(let s=i(this,le);!(!j(this,_,Sn).call(this,s)||((e||!i(this,Ce).call(this,s))&&(yield s),s===i(this,ge)));)s=i(this,we)[s]},st=function*({allowStale:e=this.allowStale}={}){if(i(this,oe))for(let s=i(this,ge);!(!j(this,_,Sn).call(this,s)||((e||!i(this,Ce).call(this,s))&&(yield s),s===i(this,le)));)s=i(this,fe)[s]},Sn=function(e){return e!==void 0&&i(this,ne).get(i(this,K)[e])===e},ys=function(e){var r,l;const s=i(this,ge),a=i(this,K)[s],o=i(this,F)[s];return i(this,nt)&&j(this,_,$).call(this,o)?o.__abortController.abort(new Error("evicted")):(i(this,Pe)||i(this,pe))&&(i(this,Pe)&&((r=i(this,Ae))==null||r.call(this,o,a,"evict")),i(this,pe)&&((l=i(this,ce))==null||l.push([o,a,"evict"]))),i(this,pt).call(this,s),e&&(i(this,K)[s]=void 0,i(this,F)[s]=void 0,i(this,Ie).push(s)),i(this,oe)===1?(N(this,ge,N(this,le,0)),i(this,Ie).length=0):N(this,ge,i(this,fe)[s]),i(this,ne).delete(a),ms(this,oe)._--,s},vs=function(e,s,a,o){const r=s===void 0?void 0:i(this,F)[s];if(j(this,_,$).call(this,r))return r;const l=new Ts,{signal:c}=a;c==null||c.addEventListener("abort",()=>l.abort(c.reason),{signal:l.signal});const d={signal:l.signal,options:a,context:o},h=(g,f=!1)=>{const{aborted:u}=l.signal,v=a.ignoreFetchAbort&&g!==void 0;if(a.status&&(u&&!f?(a.status.fetchAborted=!0,a.status.fetchError=l.signal.reason,v&&(a.status.fetchAbortIgnored=!0)):a.status.fetchResolved=!0),u&&!v&&!f)return b(l.signal.reason);const w=x;return i(this,F)[s]===x&&(g===void 0?w.__staleWhileFetching?i(this,F)[s]=w.__staleWhileFetching:this.delete(e):(a.status&&(a.status.fetchUpdated=!0),this.set(e,g,d.options))),g},y=g=>(a.status&&(a.status.fetchRejected=!0,a.status.fetchError=g),b(g)),b=g=>{const{aborted:f}=l.signal,u=f&&a.allowStaleOnFetchAbort,v=u||a.allowStaleOnFetchRejection,w=v||a.noDeleteOnFetchRejection,C=x;if(i(this,F)[s]===x&&(!w||C.__staleWhileFetching===void 0?this.delete(e):u||(i(this,F)[s]=C.__staleWhileFetching)),v)return a.status&&C.__staleWhileFetching!==void 0&&(a.status.returnedStale=!0),C.__staleWhileFetching;if(C.__returned===C)throw g},p=(g,f)=>{var v;const u=(v=i(this,At))==null?void 0:v.call(this,e,r,d);u&&u instanceof Promise&&u.then(w=>g(w===void 0?void 0:w),f),l.signal.addEventListener("abort",()=>{(!a.ignoreFetchAbort||a.allowStaleOnFetchAbort)&&(g(void 0),a.allowStaleOnFetchAbort&&(g=w=>h(w,!0)))})};a.status&&(a.status.fetchDispatched=!0);const x=new Promise(p).then(h,y),S=Object.assign(x,{__abortController:l,__staleWhileFetching:r,__returned:void 0});return s===void 0?(this.set(e,S,{...d.options,status:void 0}),s=i(this,ne).get(e)):i(this,F)[s]=S,S},$=function(e){if(!i(this,nt))return!1;const s=e;return!!s&&s instanceof Promise&&s.hasOwnProperty("__staleWhileFetching")&&s.__abortController instanceof Ts},wn=function(e,s){i(this,we)[s]=e,i(this,fe)[e]=s},Yt=function(e){e!==i(this,le)&&(e===i(this,ge)?N(this,ge,i(this,fe)[e]):j(this,_,wn).call(this,i(this,we)[e],i(this,fe)[e]),j(this,_,wn).call(this,i(this,le),e),N(this,le,e))};let yn=On;function mc({conversationId:t,messageId:e}){const[s,a]=m.useState(!1),o=m.useRef({isMediaSourceAvailable:Dn(),mediaSourceFormat:Ln()??"n/a",playPromise:null,shouldAbortQueuedPlayback:!1}).current,r=Qe(),{voiceName:l}=wi(),c=`${t}.${e}.${l}`,d=wo(),h=_o(S=>{var g;return S.isPlaying&&S.sourceUrl===((g=Me.get(c))==null?void 0:g.src)}),y=m.useCallback(async()=>{if(!d)return;a(!0);const S={isMediaSourceAvailable:o.isMediaSourceAvailable,format:o.mediaSourceFormat};try{const g=await gc({key:c,message_id:e,conversation_id:t,voice:l,onStreamingError:f=>{Xt.readAloud.error(f,S),a(!1),cn.danger(r.formatMessage(sa.playbackError,{error:f.message}))},onStreamingStart:()=>{a(!1)}});if(o.shouldAbortQueuedPlayback){o.shouldAbortQueuedPlayback=!1;return}d.changeSource(g),o.playPromise=d.play()}catch(g){Xt.readAloud.error(g,S),a(!1),cn.danger(r.formatMessage(sa.playbackError,{error:g.message}))}},[d,c,e,t,l,o,r]),b=m.useCallback(()=>{const S=Bn();S&&(o.playPromise?o.playPromise.then(()=>{S.stop(),o.playPromise=null}):S.stop())},[o]),p=m.useCallback(()=>{var g;const S=Bn();S&&(S.state.isPlaying&&S.state.sourceUrl===((g=Me.get(c))==null?void 0:g.src)?b():(Xt.readAloud.click({isMediaSourceAvailable:o.isMediaSourceAvailable,format:o.mediaSourceFormat}),y()))},[c,o,y,b]);m.useEffect(()=>{s&&h&&a(!1)},[s,h]);const x=m.useRef(c);return m.useEffect(()=>{x.current=c}),m.useEffect(()=>(o.shouldAbortQueuedPlayback=!1,()=>{var f;const S=Co();S.isPlaying&&S.sourceUrl===((f=Me.get(x.current))==null?void 0:f.src)?b():o.shouldAbortQueuedPlayback=!0}),[o,b]),{togglePlayback:p,isPlaying:h,isLoading:s}}async function ao({message_id:t,conversation_id:e,voice:s}){const a=await De.synthesize({message_id:t,conversation_id:e,voice:s,format:Ln()}),o=a.headers.get("content-type")??"audio/aac";return{response:a,format:o}}async function gc(t){return Dn()?pc(t):fc(t)}async function fc({key:t,...e}){const s=Me.get(t);if(s!=null&&s.blob)return s.src;const{response:a,format:o}=await ao(e),r=await a.arrayBuffer(),l=new Blob([r],{type:o}),c=oo({key:t,src:URL.createObjectURL(l),format:o,blob:l});return Me.set(t,c),c.src}async function pc({key:t,onStreamingError:e,onStreamingStart:s,...a}){let o=Me.get(t);o!=null&&o.streaming&&(Me.delete(t),o=void 0);let r,l;const c=xc(),d=new c;if(o)r=o,r.src=URL.createObjectURL(d);else{const{format:b,response:p}=await ao(a);l=p,r=oo({key:t,src:URL.createObjectURL(d),format:b})}const h=bc(r.id),y={sourceopen:async()=>{var x,S;h("sourceopen");const b=d.addSourceBuffer(r.format),p=async()=>{b.updating&&await new Promise(g=>b.addEventListener("updateend",g,{once:!0}))};if(r.segments.length&&!r.streaming){h("streaming from cache"),r.streaming=!0,s();for(const g of r.segments)b.appendBuffer(g),await p();d.readyState==="open"&&d.endOfStream(),r.streaming=!1,h("done streaming from cache");return}if(l){h("fetching audio");try{const g=(x=l.body)==null?void 0:x.getReader();if(!g)return;for(;((S=Me.get(t))==null?void 0:S.id)===r.id;){const{done:f,value:u}=await g.read();if(f){h("done streaming"),r.streaming=!1,d.readyState==="open"&&d.endOfStream();break}if(!Array.from(d.sourceBuffers).includes(b)){h("stop streaming, source buffer removed"),r.streaming=!1;break}r.streaming||(h("start streaming"),r.streaming=!0,s()),b.appendBuffer(u),r.segments.push(u),await p()}}catch(g){if(h("error while streaming",g),r.streaming=!1,d.readyState==="open")try{d.endOfStream("network")}catch(f){Xt.readAloud.error(f)}Me.delete(t),e(g)}}},sourceclose:()=>{var b;h("sourceclose"),r.streaming&&(r.streaming=!1,((b=Me.get(t))==null?void 0:b.id)===r.id&&(h("sourceclosed while streaming, cleaning up cache"),Me.delete(t)))},sourceended:gt};for(const[b,p]of Object.entries(y))d.addEventListener(b,()=>{try{return p()}catch(x){Xt.readAloud.error(x)}});return Me.set(t,r),r.src}const sa=Le({playbackError:{id:"useVoiceReadAloudAudio.playbackError",defaultMessage:"Failed to play message"}}),bc=t=>gt;function xc(){return Dn()?window.MediaSource:null}function Dn(){return!!Ln()}function Ln(){if("MediaSource"in window){const t=e=>Mo(e)&&MediaSource.isTypeSupported(e);if(t("audio/aac"))return"aac";if(t("audio/mpeg"))return"mp3";if(t("audio/ogg"))return"ogg"}}const oo=t=>({id:Ns(),segments:[],streaming:!1,...t}),Me=new yn({max:50,dispose:t=>{URL.revokeObjectURL(t.src)}}),yc=m.memo(function(e){var l;const s=(l=Ss("1923022511"))==null?void 0:l.value,a=Ps(e.conversationId),{errCode:o}=Pn(e.message);if(!s||!a||o)return null;const r=ko.getAudioAssetPointers(e.message.message)[0];return r?n.jsx(vc,{audioAssetPointer:r,conversationId:a}):n.jsx(Sc,{...e,conversationId:a})});function vc({audioAssetPointer:t,conversationId:e}){const{isLoading:s,isPlaying:a,togglePlayback:o}=_i({audioAssetPointer:t,conversationId:e});return n.jsx(io,{onClick:o,isPlaying:a,isLoading:s,playText:js.replay,playIcon:tl})}function Sc({conversationId:t,message:e}){const{isLoading:s,isPlaying:a,togglePlayback:o}=mc({conversationId:t,messageId:e.message.id});return n.jsx(io,{onClick:o,isPlaying:a,isLoading:s,playText:js.play,playIcon:sl})}function io({onClick:t,isPlaying:e,isLoading:s,playText:a,playIcon:o}){let r,l;const c=Qe();return s?(r=To,l=js.loading):e?(r=nl,l=js.stop):(r=o,l=a),n.jsx(bs,{icon:r,label:l?c.formatMessage(l):void 0,disabled:s,onClick:t,style:e||s?{visibility:"visible"}:void 0,testId:"voice-play-turn-action-button"})}const js={replay:{id:"VoiceReadOutLoudButton.replay",defaultMessage:"Replay",description:"The tooltip for the replay button"},play:{id:"VoiceReadOutLoudButton.play",defaultMessage:"Read aloud",description:"The tooltip for the read aloud button"},stop:{id:"VoiceReadOutLoudButton.stop",defaultMessage:"Stop",description:"The tooltip for the stop button"},loading:{id:"VoiceReadOutLoudButton.loading",defaultMessage:"Loading",description:"The tooltip for the spinner"}},wc="bg-token-main-surface-primary text-token-text-primary",_c="openai",na=["bg-blue-300 text-white"];function Cc(t){return na[((t==null?void 0:t.charCodeAt(0))??0)%na.length]}const gs=({children:t})=>n.jsx("div",{className:"pt-0",children:n.jsx("div",{className:te(m.isValidElement(t)&&t.type===un?"gizmo-bot-avatar":"gizmo-shadow-stroke","flex h-8 w-8 items-center justify-center overflow-hidden rounded-full"),children:t})});function _n({messages:t,isUserTurn:e,avatarClassName:s,gizmo:a,showInlineEmbeddedDisplay:o=!1}){var x;const r="medium",l=t[0],c=(x=l==null?void 0:l.message.metadata)==null?void 0:x.shared_conversation_id,d=c!=null,h=En(),{gizmoEditorData:y,mode:b}=Ci();let p=n.jsx(gs,{children:n.jsx(un,{className:s??wc,iconName:_c,size:r})});return a?p=n.jsx(gs,{children:n.jsx(kl,{gizmoId:a.gizmo.id,className:"h-full w-full"})}):y!=null&&b==="test"&&(p=n.jsx(Tl,{isFirstParty:!1,src:y.profilePictureUrl,className:"h-8 w-8 first:pt-[3px]"})),n.jsx("div",{children:e?d||o?n.jsx(gs,{children:n.jsx(un,{className:Cc(c),iconName:"user",size:r})}):n.jsx(gs,{children:n.jsx(Mi,{user:h,size:r})}):p})}const fs="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function Mc({className:t,clientThreadId:e,message:s,onModelSelect:a,onDropdownChange:o,canRegenerateResponse:r}){var U;const l=ya("566128514").value,[c,d]=m.useState(null),[h,y]=m.useState(!1),[b,p]=m.useState(!1),x=vt(e),S=Za({clientThreadId:e,message:s}),g=(U=s.message.metadata)==null?void 0:U.model_slug,{modelOptions:f,modelSlug:u,animateModelLabelOnRender:v,messageModelEnabledTools:w}=S,C=Fa(s.message),T=w.includes(Cs.Search),D=m.useMemo(()=>f.find(I=>I.value===g),[f,g]),E=m.useRef(null),{doesUserHaveAnyAccountsWithPlusFeatures:V}=ns(),O=I=>{I||setTimeout(()=>{E.current&&E.current.blur()},10)};if(m.useEffect(()=>{O(h)},[h]),Ua(e))return null;const L=r&&f.some(I=>es(I,V));return x?null:n.jsxs(ke.Root,{onOpenChange:I=>{r&&(y(I),o(I),O(I)),I&&Z.logEvent(ee.conversationOpenMessageModelSelector,{has_get_plus_button:L,is_new_regen_dropdown:!0})},children:[r?n.jsx(Tc,{label:n.jsx(P,{id:"wDs5sz",defaultMessage:"Switch model"}),children:n.jsx(Ya,{ref:E,className:te("cursor-pointer",t),onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),children:n.jsx(pn,{modelSlug:u,animateModelLabelOnRender:v,isDropdownOpen:h,isRegenerateEnabled:r,isHovered:b,isRegenLabel:!0,omitIcon:!1})})}):n.jsx("button",{className:te("cursor-pointer",t),onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),children:n.jsx(pn,{modelSlug:u,animateModelLabelOnRender:v,isDropdownOpen:!1,isRegenerateEnabled:!1,isHovered:b,omitIcon:l,animateShortLabel:!0})}),r&&n.jsxs(ke.Content,{className:"z-30 min-w-fit origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[n.jsx(ke.Item,{disabled:!0,className:"pb-0 pt-2",children:n.jsx("span",{className:"text-token-text-secondary",children:n.jsx(P,{id:"bFLh5u",defaultMessage:"Switch model"})})}),n.jsx(kc,{onModelSelect:a,messageModelSlug:g,omitModelIcons:l,modelOptions:f,setHoveredOption:d,hoveredOption:c,retryOption:D,lastResponseUsedSearch:C,modelSupportsSearch:T,doesUserHaveAnyAccountsWithPlusFeatures:V})]})]})}function kc({modelOptions:t,messageModelSlug:e,onModelSelect:s,omitModelIcons:a,setHoveredOption:o,hoveredOption:r,retryOption:l,lastResponseUsedSearch:c,modelSupportsSearch:d,doesUserHaveAnyAccountsWithPlusFeatures:h}){const y=Qe(),[b,p]=m.useMemo(()=>ki(t,u=>u.subcategory),[t]),x=m.useMemo(()=>{const u=new Map;return b.forEach(v=>{var C;const w=v.subcategory;w&&(u.has(w)||u.set(w,[]),(C=u.get(w))==null||C.push(v))}),u},[b]),S=te("icon-sm",a&&"order-10 ml-auto text-token-text-tertiary icon-md"),g=a?"right":"left",f=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:y.formatMessage(rn.search),icon:n.jsx(Va,{className:S}),condition:d&&!c},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:y.formatMessage(rn.nosearch),icon:n.jsx(qa,{className:S}),condition:d&&c}];return n.jsxs(n.Fragment,{children:[p.map(u=>{const{value:v,...w}=u;return n.jsx(kt,{value:v,onSelect:()=>s({requestedModelId:v}),includeRegenerate:!1,onMouseEnter:()=>o(v),onMouseLeave:()=>o(null),isHovered:r===v,messageModelSlug:e,includeCheck:!1,shouldShowUpsell:es(u,h),className:fs,...w,icon:a?n.jsx("span",{className:S}):w.icon,justifyIcon:g,wrapIcon:!a},v)}),[...x.entries()].map(([u,v])=>n.jsxs(ke.Sub,{children:[n.jsx(ke.SubMenuTrigger,{children:n.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:u})}),n.jsx(ke.Portal,{children:n.jsx(ke.SubContent,{className:"min-w-fit",children:v.map(w=>{const{value:C,...T}=w;return n.jsx(kt,{value:C,onSelect:()=>s({requestedModelId:C}),includeRegenerate:!1,onMouseEnter:()=>o(C),onMouseLeave:()=>o(null),isHovered:r===C,messageModelSlug:e,includeCheck:!1,className:fs,...T,icon:null,justifyIcon:g,wrapIcon:!a,shouldShowUpsell:es(w,h)},u+"-"+C)})})})]},u)),!!l&&n.jsxs(n.Fragment,{children:[n.jsx(ke.Separator,{}),n.jsx(kt,{onSelect:()=>s({requestedModelId:l.value}),includeRegenerate:!0,onMouseEnter:()=>o(l.value),onMouseLeave:()=>o(null),messageModelSlug:e,includeCheck:!1,className:fs,...l,label:y.formatMessage(rn.tryAgain),subtitle:l.label,icon:n.jsx(Ls,{className:S}),justifyIcon:g,wrapIcon:!a},l.value),f.filter(u=>u.condition).map(u=>n.jsx(kt,{onSelect:()=>s({requestedModelId:l.value,extraStreamParams:u.extraStreamParams}),includeRegenerate:!1,onMouseEnter:()=>o(u.key),onMouseLeave:()=>o(null),isHovered:r===u.key,messageModelSlug:e,includeCheck:!1,className:fs,...l,label:u.label,subtitle:"",icon:u.icon,justifyIcon:g,wrapIcon:!a},u.key))]})]})}function Tc({children:t,label:e}){return n.jsx(Fs,{label:e,sideOffset:0,children:t})}const rn=Le({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),jc=m.memo(Mc);function Cn({messages:t,isMemoryEnabled:e,isMemoryFull:s,gizmoId:a,isParagen:o}){const[r,l]=m.useState(!1),[c,d]=m.useState(!1),{eligible:h,isLoading:y}=Ti(),b=e&&!s,p=t.filter((g,f)=>{const u=t[f+1],w=(u==null?void 0:u.message.recipient)==="assistant"&&(u==null?void 0:u.message.author.role)===be.Tool&&(u==null?void 0:u.message.author.name)==="bio"&&wa(u.message)==="Model set context updated."||!u&&b;return g.message.author.role===be.Assistant&&g.message.recipient==="bio"&&w}).flatMap(g=>{const f=g.message.content.content_type;return f===it.Text?g.message.content.parts:f===it.Code?[g.message.content.text]:[]}).map(Ac),x=m.useMemo(()=>p.length>0,[p]);if(m.useEffect(()=>{x&&h&&!y&&ji.openModal(Ai.GlobalMemoryOnboarding)},[x,h,y]),p.length===0)return null;const S=g=>{const f=g??!c;d(f),f&&Z.logEvent(ee.memoryUpdatePopoverShown,{updateCount:p.length})};return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"inline-block",onMouseEnter:()=>S(!0),onMouseLeave:()=>S(!1),children:n.jsxs(Ni,{open:c,sideOffset:4,side:"bottom",alignAgainstAnchor:"start",size:"none",className:"z-10 min-w-60 max-w-96 text-sm",onOpenChange:g=>S(g),disableAutofocus:!0,triggerButton:n.jsxs("button",{className:te("my-1 flex items-center gap-1 text-sm font-semibold outline-none",c?"text-token-text-secondary":"text-token-text-tertiary"),children:[n.jsx(al,{className:"mb-[-1px]"}),p.length===1?n.jsx(P,{id:"MemoryActionResult.memoryWriteSingular.1",defaultMessage:"Memory updated"}):n.jsx(P,{id:"MemoryActionResult.memoryWritePlural.1",defaultMessage:"Memories updated"})]}),children:[n.jsx("div",{className:"mb-2 rounded border border-token-border-light bg-token-main-surface-secondary",children:p.map((g,f)=>n.jsx("div",{className:"border-b border-token-border-light px-3 py-2 first-letter:uppercase last:border-b-0",children:g},f))}),o?n.jsx("div",{className:"text-xs text-token-text-tertiary",children:n.jsx(P,{id:"MemoryActionResult.paragenMessage",defaultMessage:"This memory will be saved if you choose this response."})}):n.jsxs("button",{className:"flex w-full items-center justify-between rounded px-3 py-2 font-semibold hover:bg-token-main-surface-secondary",onClick:()=>{l(!0),Z.logEvent(ee.memoryUpdatePopoverManageButtonClicked,{updateCount:p.length})},children:[n.jsx(P,{id:"MemoryActionResult.manageMemories",defaultMessage:"Manage memories"}),n.jsx(ol,{className:"icon-md -mr-1 text-token-text-tertiary"})]})]})}),r&&n.jsx(jl,{initialGizmoId:a,onClose:()=>l(!1)})]})}function Ac(t){const e=["The user ","The user's ","User ","User's "];for(const s of e)if(t.startsWith(s))return t.slice(s.length);return t}function aa(t,e,s){B.updateTree(t,a=>{a.updateNodeMetadata(e,{inlineComparisonRating:s})})}function oa(t){var a,o;return{is_dark_mode:t==="dark",time_since_loaded:Math.floor(performance.now()/1e3),page_height:window==null?void 0:window.innerHeight,page_width:window==null?void 0:window.innerWidth,pixel_ratio:window==null?void 0:window.devicePixelRatio,screen_height:(a=window==null?void 0:window.screen)==null?void 0:a.height,screen_width:(o=window==null?void 0:window.screen)==null?void 0:o.width}}const ia=({messages:t})=>{for(const{message:{metadata:e}}of t){const{augmented_paragen_prompt_label:s}=e??{};if(s)return s}};function Nc(t){const e=m.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});return t.stubSideBySideFeedback?n.jsx(ro,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:e,...t}):n.jsx(Ec,{...t,visibilityStateRef:e})}function Ec(t){const{clientThreadId:e,variantIds:s,variantsInStreamInfo:a}=t;if(s.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const[o]=m.useState(()=>Date.now()),r=Ra(),{resolvedTheme:l}=jo(),[c,d]=m.useMemo(()=>Pa(s.join(""))()<.5?[0,1]:[1,0],[s[0],s[1]]),h=c<d?"left":"right",y=h==="left"?"right":"left",b=s[c],p=s[d],x=Qn(e,b),S=Qn(e,p),g=Kt(Yn(e,Kt(x).id)),f=Kt(Yn(e,Kt(S).id)),u=h==="left"?g:f,v=h==="left"?f:g,w=a.display_treatment==="unskippable",C=w?"unskippable_parallel_2_in_stream:a:1.0":"skippable_parallel_2_in_stream:a:1.5";m.useEffect(()=>(_s.setState({displayingSideBySideFeedback:!0,unskippable:w}),()=>{_s.setState({displayingSideBySideFeedback:!1,unskippable:!1})}),[w]),Ei();const T=m.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});m.useEffect(()=>Ao(Ii,{requestCompletion:()=>{var O,k,L,U;const E=(O=Qt(u.messages))==null?void 0:O.completionSampleFinishTime,V=(k=Qt(v.messages))==null?void 0:k.completionSampleFinishTime;De.submitMessageComparisonFeedback({feedback_version:C,original_message_id:(L=u.messages[u.messages.length-1])==null?void 0:L.message.id,new_message_id:(U=v.messages[v.messages.length-1])==null?void 0:U.message.id,rating:"none",conversation_id:B.getServerThreadId(e),text:"",tags:[],completion_comparison_rating:"skip",new_completion_placement:y,feedback_start_time:o,compare_step_start_time:o,original_completion_load_start_time:o,original_completion_load_end_time:E??0,new_completion_load_start_time:o,new_completion_load_end_time:V??0,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:oa(l),...T.current})}}),[g,f,e,o,C,y,u==null?void 0:u.messages,v==null?void 0:v.messages,l]);const D=E=>{var A,R,M,q;const O=B.getTree(e).getLeafFromNode(E);B.setThreadCurrentLeafId(e,O.id);const L=E===b===(h==="left"),U=(A=Qt(u.messages))==null?void 0:A.completionSampleFinishTime,I=(R=Qt(v.messages))==null?void 0:R.completionSampleFinishTime;u.messages.length>0&&aa(e,u.messages[u.messages.length-1].nodeId,L?"original":"new"),v.messages.length>0&&aa(e,v.messages[v.messages.length-1].nodeId,L?"original":"new");let Q;U==null||I==null?Q=L?"partial_load_comparison_original":"partial_load_comparison_new":Q=L?"original":"new",De.submitMessageComparisonFeedback({feedback_version:C,original_message_id:(M=u.messages[u.messages.length-1])==null?void 0:M.message.id,new_message_id:(q=v.messages[v.messages.length-1])==null?void 0:q.message.id,rating:"none",conversation_id:B.getServerThreadId(e),text:"",tags:[],completion_comparison_rating:Q,new_completion_placement:y,feedback_start_time:o,compare_step_start_time:o,original_completion_load_start_time:o,original_completion_load_end_time:U??null,new_completion_load_start_time:o,new_completion_load_end_time:I??null,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:oa(l),...T.current})};return n.jsx(ro,{...t,setPreferredFeedback:D,leftVariantId:b,rightVariantId:p,leftTurn:g,rightTurn:f,hasActiveRequest:r,originalTurn:u,visibilityStateRef:T})}function Ic(t){if(!t.length)return!1;const e=t.filter(s=>s.type===ot.Text||s.type===ot.MultiText).filter(s=>{var a;return s.message.message.status!=="finished_successfully"&&((a=s.message.message.metadata)==null?void 0:a.snorkle_status)!==void 0});return e.length>0&&e.every(s=>{const a=s.message.message.content;return(a==null?void 0:a.content_type)===it.Text&&a.parts.join("")===""})}function ro({setPreferredFeedback:t,leftVariantId:e,rightVariantId:s,leftTurn:a,rightTurn:o,hasActiveRequest:r,originalTurn:l,visibilityStateRef:c,...d}){const{defaultParagenLabel:h,shouldShowParagenLabels:y=!1}=Fi(),b=a&&ia(a)||h,p=o&&ia(o)||h,x=m.useMemo(()=>(a==null?void 0:a.messages)??[],[a==null?void 0:a.messages]),S=m.useMemo(()=>(o==null?void 0:o.messages)??[],[o==null?void 0:o.messages]),{avatarClassName:g}=d,f=m.useMemo(()=>Ms(x),[x]),u=m.useMemo(()=>Ms(S),[S]),v=An(),w=os();function C(q){var ve,Te;if(!w.showDebugConversationTurns&&!w.forceParagen)return null;let H=q===l?"ORIGINAL":"NEW";const G=q.messages[q.messages.length-1],J=(Te=(ve=G==null?void 0:G.message)==null?void 0:ve.metadata)==null?void 0:Te.__internal;if(J){const{model_id:xe,model_definition_slug:Rt,model_definition_virtual_model_id:Be,alternative_model_selection_rule:Ge,augmented_paragen_prompt_group_id:Xe,augmented_paragen_prompt_id:rt,augmented_paragen_prompt:Je}=J;xe&&(H+=`
Model ID: ${xe}`),Rt&&(H+=`
Model Slug: ${Rt}`),Be&&(H+=`
Virtual Model ID: ${Be}`),Ge&&(H+=`
Alternative Model Rule: ${Ge}`),Xe&&(H+=`
Prompt Group ID: ${Xe}`),rt&&(H+=`
Prompt ID: ${rt}`),Je&&(H+=`
Prompt: ${Je}`)}return n.jsx("div",{className:"whitespace-pre-wrap text-sm text-red-500",children:H})}const[T,D]=m.useMemo(()=>[f,u].map(q=>Ic(q)),[f,u]),E=Zt(a?ws.getRequestIdFromConversationTurn(a):"")||T,V=Zt(o?ws.getRequestIdFromConversationTurn(o):"")||D,O=(a==null?void 0:a.role)===be.User,k=(o==null?void 0:o.role)===be.User,L=jn(),U=m.useRef(null),I=m.useRef(null),Q=m.useRef(null);m.useEffect(()=>{if(U.current&&I.current&&Q.current){const q=Array(11).fill(0).map((G,J)=>J/10),H=new IntersectionObserver(G=>G.forEach(J=>{J.target===I.current?(c.current.left_visibility_initial==null&&(c.current.left_visibility_initial=J.intersectionRatio),c.current.left_visibility_max=Math.max(c.current.left_visibility_max??0,J.intersectionRatio)):J.target===Q.current&&(c.current.right_visibility_initial==null&&(c.current.right_visibility_initial=J.intersectionRatio),c.current.right_visibility_max=Math.max(c.current.right_visibility_max??0,J.intersectionRatio))}),{root:U.current,threshold:q});return H.observe(I.current),H.observe(Q.current),()=>H.disconnect()}},[c]);const{data:A}=Nn(void 0,!1,v),R=A==null?void 0:A.memoryFullPct,M=typeof R=="number"&&R>=100;return n.jsxs("div",{className:"relative flex flex-col",children:[n.jsx("div",{className:"sticky top-[-1px] z-[1] text-pretty bg-token-main-surface-primary px-6 text-center text-lg md:static",children:n.jsx(P,{id:"JgCHDY",defaultMessage:"You’re giving feedback on a new version of ChatGPT."})}),n.jsx("div",{className:"text-pretty px-6 pb-5 pt-1 text-center text-sm text-token-text-secondary",children:n.jsx(P,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),n.jsx("div",{className:"sticky top-[calc(1.75em-1px)] z-[1] h-3 bg-gradient-to-b from-token-main-surface-primary from-50% to-transparent md:static"}),n.jsx("div",{className:"-mb-2 snap-x snap-mandatory overflow-x-auto px-3 pb-4 md:px-5 lg:px-10",ref:U,children:n.jsx("div",{className:"min-w-fit",children:n.jsxs("div",{className:"mx-auto flex max-w-6xl items-start gap-4 sm:gap-6",children:[n.jsxs(ra,{elemRef:I,onClick:()=>{t(e)},hasActiveRequest:r,children:[n.jsxs(ca,{children:[n.jsx(_n,{messages:x,isUserTurn:O,avatarClassName:g,showInlineEmbeddedDisplay:!1}),n.jsx(la,{children:y?n.jsx("span",{className:"font-bold text-token-text-primary",children:b}):n.jsx(P,{...da.responseNumber,values:{responseIndex:1}})})]}),A!=null&&!O&&n.jsx(Cn,{messages:x,isMemoryEnabled:L,isMemoryFull:M,isParagen:!0}),n.jsx(gn,{...d,groupedMessagesToRender:f,allGroupedMessages:f,isEditing:!1,isUserTurn:O,isCompletionRequestInProgress:E,hasActiveRequest:r,handleEnterEdit:gt,handleExitEdit:gt,shouldGrowContainer:!1}),!!a&&C(a)]}),n.jsxs(ra,{elemRef:Q,onClick:()=>{t(s)},hasActiveRequest:r,children:[n.jsxs(ca,{children:[n.jsx(_n,{messages:S,isUserTurn:k,avatarClassName:g,showInlineEmbeddedDisplay:!1}),n.jsx(la,{children:y?n.jsx("span",{className:"font-bold text-token-text-primary",children:p}):n.jsx(P,{...da.responseNumber,values:{responseIndex:2}})})]}),A!=null&&!k&&n.jsx(Cn,{messages:S,isMemoryEnabled:L,isMemoryFull:M,isParagen:!0}),n.jsx(gn,{...d,groupedMessagesToRender:u,allGroupedMessages:u,isEditing:!1,isUserTurn:k,isCompletionRequestInProgress:V,hasActiveRequest:r,handleEnterEdit:gt,handleExitEdit:gt,shouldGrowContainer:!1}),!!o&&C(o)]})]})})})]})}function ra({elemRef:t,onClick:e,children:s,hasActiveRequest:a}){return n.jsxs("div",{className:"relative flex w-full min-w-[min(450px,80vw)] snap-center flex-col gap-1 truncate rounded-2xl border border-token-main-surface-tertiary bg-white p-5 text-left dark:bg-gray-700",ref:t,children:[s,a?null:n.jsx(Tt,{className:"mt-4 self-start",onClick:e,children:n.jsx(P,{id:"U2EAH6",defaultMessage:"I prefer this response"})})]})}const la=Ye.div`text-sm text-token-text-tertiary font-semibold`,ca=Ye.div`flex gap-4 items-center mb-1`,da=Le({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}"},responseChoice:{id:"ConversationTurnTwoUpFeedback.responseChoice",defaultMessage:"Choose this response"}});function Fc({clientThreadId:t,messageForRating:e,variantIds:s,conversationTurnMountTime:a}){const[o]=m.useState(()=>e.message.create_time!=null?e.message.create_time*1e3:Date.now()),[r]=m.useState(()=>Date.now());function l(c){var T,D;const d=B.getTree(t),h=s[0]||"",y=(d==null?void 0:d.getConversationTurns(h))||[],b=y[y.length-1],p=(b==null?void 0:b.messages)||[],x=p[p.length-1],S=((T=x==null?void 0:x.message)==null?void 0:T.id)||"",g=s[1]||"",f=(d==null?void 0:d.getConversationTurns(g))||[],u=f[f.length-1],v=(u==null?void 0:u.messages)||[],w=v[v.length-1],C=((D=w==null?void 0:w.message)==null?void 0:D.id)||"";De.submitMessageComparisonFeedback({feedback_version:"inline_regen_feedback:a:1.0",original_message_id:S,new_message_id:C,rating:"none",conversation_id:B.getServerThreadId(t),text:"",tags:[],completion_comparison_rating:c,new_completion_placement:"not-applicable",feedback_start_time:a,compare_step_start_time:a,new_completion_load_start_time:o,new_completion_load_end_time:r,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset()}),B.updateTree(t,E=>{E.updateNodeMetadata(e.nodeId,{inlineComparisonRating:c})}),B.updateTree(t,E=>{E.updateNodeMetadata(x.nodeId,{inlineComparisonRating:"baseline"})})}return n.jsxs(Rc,{children:[n.jsx("h6",{className:"min-w-[150px] grow",children:n.jsx(P,{...ps.regenTitle})}),n.jsxs("div",{className:"flex flex-wrap items-end justify-center gap-2",children:[n.jsx(Tt,{color:"secondary",onClick:()=>l("new"),children:n.jsx(P,{...ps.regenBetterText})}),n.jsx(Tt,{color:"secondary",onClick:()=>l("original"),children:n.jsx(P,{...ps.regenWorseText})}),n.jsx(Tt,{color:"secondary",onClick:()=>l("same"),children:n.jsx(P,{...ps.regenSameText})})]}),n.jsx(No,{onClick:()=>{B.updateTree(t,c=>{c.updateNodeMetadata(e.nodeId,{inlineComparisonRating:"skip"})})}})]})}const Rc=Ye.div`flex items-center p-4 rounded-2xl bg-token-main-surface-primary text-token-text-primary text-sm border border-token-border-light gap-5 mt-3`,ps=Le({regenTitle:{id:"ConversationTurnInlineFeedback.regenTitle",defaultMessage:"Was this response better or worse?"},regenBetterText:{id:"ConversationTurnInlineFeedback.regenBetterText",defaultMessage:"Better"},regenWorseText:{id:"ConversationTurnInlineFeedback.regenWorseText",defaultMessage:"Worse"},regenSameText:{id:"ConversationTurnInlineFeedback.regenSameText",defaultMessage:"Same"}}),ua=({allGroupedMessages:t})=>t.some(e=>[ot.Browsing,ot.RetrievalBrowsing,ot.ParallelBrowsing].includes(e.type)),ha=({allGroupedMessages:t})=>t.some(e=>e.type===ot.CodeInterpreter);function Pc(t){return!t||!t.instructions?"":typeof t.instructions=="string"?t.instructions:t.instructions.filter(e=>typeof e=="string").join("")}const Dc=[{match:ua,tag:"Shouldn't have searched the web",label:ie({id:"kL047b",defaultMessage:"Shouldn't have searched the web"})},{match:ua,tag:"Don't like the source it cited",label:ie({id:"+ds/Q/",defaultMessage:"Don't like the source it cited"})},{match:ha,tag:"Shouldn't have run code",label:ie({id:"53w4ay",defaultMessage:"Shouldn't have run code"})},{match:ha,tag:"Couldn't handle my file",label:ie({id:"EkFTQ5",defaultMessage:"Couldn't handle my file"})},{match:({allGroupedMessages:t})=>t.some(e=>e.type===ot.Dalle),tag:"Shouldn't have created an image",label:ie({id:"S8FRsr",defaultMessage:"Shouldn't have created an image"})},{match:({allGroupedMessages:t})=>t.some(e=>{if(e.type!==ot.Text)return!1;const{message:s}=e.message,{content:a}=s;return a.content_type===it.Text&&wa(s).match(/^```[\S]+\n/gm)}),tag:"Code was incorrect",label:ie({id:"4EBdQk",defaultMessage:"Code was incorrect"})},{match:({systemContent:t})=>Pc(t).includes("Personality")??!1,tag:"Too chatty or casual",label:ie({id:"ATzJKW",defaultMessage:"Too chatty or casual"})},{match:({features:t})=>t.includes(Es.Sunshine),tag:"Shouldn't have used Memory",label:ie({id:"yfUEiz",defaultMessage:"Shouldn't have used Memory"})},{tag:"Don't like the style",label:ie({id:"nGxjdj",defaultMessage:"Don't like the style"})},{tag:"Not factually correct",label:ie({id:"Ke7JtQ",defaultMessage:"Not factually correct"})},{tag:"Didn't fully follow instructions",label:ie({id:"Rdlt9V",defaultMessage:"Didn't fully follow instructions"})},{tag:"Refused when it shouldn't have",label:ie({id:"2yRS/Q",defaultMessage:"Refused when it shouldn't have"})},{tag:"Being lazy",label:ie({id:"14MPmT",defaultMessage:"Being lazy"})},{tag:"Unsafe or problematic",label:ie({id:"02pXBl",defaultMessage:"Unsafe or problematic"})},{tag:"Other",label:ie({id:"WiIGE+",defaultMessage:"Other"})}],Lc=[{tag:"I disagree with the policy",label:ie({id:"oKyDLz",defaultMessage:"I disagree with the policy"})},{tag:"This didn't violate the policy",label:ie({id:"7fUkVF",defaultMessage:"This didn't violate the policy"})},{tag:"I don't understand the policy",label:ie({id:"4Cdp6N",defaultMessage:"I don't understand the policy"})},{tag:"This didn't take the full context",label:ie({id:"vnZJDP",defaultMessage:"This didn't take the full context"})}];function Oc(t,e,s){return e.filter(a=>!a.match||a.match(s)).map(a=>({value:a.tag,label:t.formatMessage(a.label)}))}function Uc(t){const e=t[t.length-1];if(!e)return!1;const s="message"in e?e.message:null;if(s){const{errCode:a}=Pn(s);return[Gn.ContentPolicy,Gn.ContentOrTos].includes(a)}else return!1}function zc({clientThreadId:t,conversationMessage:e,currentModelId:s,allGroupedMessages:a}){const o=Qe(),r=kn()??[],l=e.rating,c=Lr(t,e.message.id),d=(c==null?void 0:c.message.content.content_type)===it.SystemContent?c==null?void 0:c.message.content:null,h=m.useCallback(p=>{const x=B.getServerThreadId(t);x&&(p.tags.length===0&&!p.textFeedback||(Z.logEvent(p.source==="inline"?ee.messageFeedbackInlineSubmitted:ee.messageFeedbackDialogSubmitted,{id:e.message.id,threadId:x,tags:p.tags,content:p.textFeedback,model:s,rating:l}),l&&De.submitMessageFeedback({message_id:e.message.id,conversation_id:x,rating:l,text:p.textFeedback,tags:p.tags,tag_choices:p.tagChoices})))},[t,e.message,s,l]),y=()=>{Z.logEvent(ee.messageFeedbackMoreOptionsClicked,{id:e.message.id,threadId:B.getServerThreadId(t),model:s,rating:l})},b=Oc(o,Uc(a)?Lc:Dc,{allGroupedMessages:a,features:r,currentModelId:s,systemContent:d});return l==="thumbsUp"?null:n.jsx(Al,{tagOptions:b,onSubmit:h,onMoreClicked:y})}const ma=[1,2,3,4,10,20,30],Bc=.5;function Gc({clientThreadId:t,conversationLeafId:e}){const s=ks(In.isBusinessWorkspace),a=m.useRef(!1),o=Ps(t),r=Ds(t),{isUnauthenticated:l}=Ft(),c=m.useMemo(()=>{if(!o)return-1;const k=Pa(o);return k()>Bc?-1:ma[Math.floor(k()*ma.length)]},[o]),d=Or(t,e),h=d[d.length-1],y=m.useMemo(()=>ws.getRequestIdFromConversationTurn(h),[h]),b=Zt(y),[p,x]=m.useState(null),[S,g]=m.useState(!1),[f,u]=m.useState(!1),[v,w]=m.useState(!1),C=k=>{var U,I;const L=(I=(U=Qt(d))==null?void 0:U.messages[0])==null?void 0:I.message.id;x(k),V(L,k)},T=d.filter(k=>k.role===be.Assistant).length,D=(h==null?void 0:h.role)===be.Assistant,E=h==null?void 0:h.messages.some(k=>{var L;return(L=k.message.metadata)==null?void 0:L.is_nulligen}),V=m.useMemo(()=>Ta((k,L)=>{o&&k&&De.submitConversationRating({conversation_id:o,message_id:k,rating:L,shown_at_assistant_turn:c}),Z.logEvent(ee.conversationRatingSubmitted,{rating:L,showAtAssistantTurn:c,conversationId:o}),g(!0),setTimeout(()=>{u(!0)},1500)},2e3),[o,c]),O=T!==c||b||!D||E||!!s||(r==null?void 0:r.kind)!==at.PrimaryAssistant||v||l;return m.useEffect(()=>{!O&&!a.current&&(Z.logEvent(ee.conversationRatingShown,{showAtAssistantTurn:c,conversationId:o}),a.current=!0)},[O]),v||O?null:n.jsxs("div",{className:"mx-auto",children:[n.jsx(ja,{children:S&&!f&&n.jsx(Et.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:n.jsx(ga,{$padded:!0,children:n.jsx("span",{className:"text-sm text-token-text-tertiary",children:n.jsx(P,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!S&&n.jsx(Et.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:n.jsxs(ga,{$padded:!1,children:[n.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-secondary",children:[n.jsx(P,{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?"}),n.jsxs("div",{className:"flex items-center gap-5",children:[n.jsx(ln,{$selected:p==="thumbsUp",onClick:()=>C("thumbsUp"),children:n.jsx($a,{className:"icon-md"})}),n.jsx(ln,{$selected:p==="thumbsDown",onClick:()=>C("thumbsDown"),children:n.jsx(Ka,{className:"icon-md"})})]})]}),n.jsx("div",{className:"w-px flex-1 self-stretch bg-token-main-surface-tertiary"}),n.jsx(ln,{className:"p-3",$selected:!1,onClick:()=>w(!0),children:n.jsx(il,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const ln=Ye.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,ga=Ye.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`;function Wc({clientThreadId:t,conversationLeafId:e,canShowIndepthFeedbackType:s,canShowInlineComparisonFeedback:a,canShowInlineMessageFeedback:o,messageForRating:r,allGroupedMessages:l,currentModelId:c,conversationTurnMountTime:d,variantIds:h}){let y=null;return Ur(t,e)?null:(s!==void 0?y=n.jsx(lc,{clientThreadId:t,conversationLeafId:e,trigger:s,variantIds:h}):r.rating&&o?y=n.jsx(zc,{clientThreadId:t,conversationMessage:r,allGroupedMessages:l,currentModelId:c}):a?y=n.jsx(Fc,{clientThreadId:t,messageForRating:r,variantIds:h,conversationTurnMountTime:d}):y=n.jsx("div",{className:"text-center",children:n.jsx(Gc,{clientThreadId:t,conversationLeafId:e})}),n.jsx("div",{className:"mt-3 w-full empty:hidden",children:y}))}const Hc=xt(()=>yt(()=>import("./sso-hxpl3fvhyqxhpyph.js").then(t=>t.m),__vite__mapDeps([31,1,2,3,32,6,7,13,33,34,35,36,37,38,15,39,11,10,40,41,42,43,44,12,9,45,46,47,48,49,17,27,50,51,28,29,52,26,30,53,54,55,56,57,58,59,60,19,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,16,80,81,82,83,84,85,86,87,88,89,90,91,92,93])).then(t=>t.ContextualAnswerCitationCards).catch(()=>()=>null));function Vc(t){var hs;const{turnIndex:e,conversationLeafId:s,isFinalTurn:a,clientThreadId:o,onChangeItemInView:r,onChangeRating:l,showInlineEmbeddedDisplay:c=!1,currentModelId:d,initiallyHighlightedMessageId:h,avatarClassName:y,scrollToBottom:b}=t,p=Qe(),x=En(),S=!!x&&Io(x),g=Fn(),f=ks(In.isBusinessWorkspace),u=jn(),v=An(),w=Kt(zr(o,e,s)),{messages:C,variantIds:T,variantsInStreamInfo:D}=w,E=Ms(C),V=Ri();let O=C[C.length-1];for(const se of E){const me=Ar(se);if(me.some($t=>V.has($t.message.id))){O=me[me.length-1];break}}const k=C.slice(0,C.indexOf(O)+1),L=_a(),[U,I]=m.useState(!1),[Q,A]=m.useState(!1),R=T.findIndex(se=>k.some(me=>me.nodeId===se)),M=w.role===be.User,q=bt(),H=vt(o),G=(hs=Is(w.gizmoId??H))==null?void 0:hs.data,J=Pi(),ve=G&&J.includes(G.gizmo.id),Te=Da(d),xe=Ds(o,G==null?void 0:G.gizmo.id),Be=Br(o)===Fo.PENDING,{data:Ge}=Nn(G==null?void 0:G.gizmo.id,!1,v),Xe=Ge==null?void 0:Ge.memoryFullPct,rt=Xe!==void 0&&Xe>=100,Je=kn(),{value:is}=Ss("1410082514"),{value:St}=Ss("2291672486"),he=k.some(se=>se.message.content.content_type===it.MultimodalText),{isUnauthenticated:We}=Ft(),[rs,Pt]=m.useState(!1),[He,lt]=m.useState(!1);Di(()=>{w.role==="user"&&b&&b()});const Dt=m.useRef(null);m.useEffect(()=>{var me;if(h==null)return;w.messages.map($t=>$t.message.id).includes(h)&&((me=Dt.current)==null||me.scrollIntoView({behavior:"auto"}))},[h]);const Y=C[C.length-1],Ve=Y.rating,Os=()=>{k.length===1&&(Z.logEvent(ee.editPrompt,{id:k[0].message.id,threadId:B.getServerThreadId(o)}),ze.logEvent("chatgpt_edit_prompt"),I(!0))},Us=m.useCallback(()=>{I(!1)},[]),Lt=m.useCallback(()=>{B.copyMessageToClipboard(o,e)},[o,e]),ls=se=>{l({nodeId:Y.nodeId,messageId:Y.message.id,rating:se}),Z.logEvent(ee.messageFeedbackThumbsDownClicked,{id:Y.message.id,threadId:B.getServerThreadId(o),model:d,rating:se}),A(!0)},[Ot]=m.useState(()=>Date.now()),zs=m.useMemo(()=>ws.getRequestIdFromConversationTurn(w),[w]),Bs=Gr({clientThreadId:o,conversationLeafId:s}),ye=Zt(zs)&&!Bs,Gs=Ra(),Ws=Ms(k),{showDebugConversationTurns:Hs}=os(),Ut=Wr(o),zt=Ja(o),ct=uc({clientThreadId:o,conversationMode:xe}),cs=Rn(o),Bt=m.useCallback(({requestedModelId:se,systemMessage:me,juice:$t,extraStreamParams:co})=>{const uo=new dn;ct({id:Y.nodeId,eventMetadata:{eventSource:"mouse"},turnTracker:uo,requestedModelId:se,systemMessage:me,juice:$t,extraStreamParams:co})},[Y,ct]),Gt=is&&k.some(se=>{var me;return((me=se.message.metadata)==null?void 0:me.snorkle_status)!=null}),Wt=!g&&!Ut&&!q&&!M,Ht=Wt&&(!f||Gt),Vt=Li(),Vs=!We&&Ht&&L&&!ye&&!Be&&!c&&!U&&(xe==null?void 0:xe.kind)!==at.GizmoMagicCreate&&R===1&&a&&!Y.inlineComparisonRating&&!Ve&&T.length===2&&!Vt&&Date.now()-(Y.message.create_time??0)*1e3<1e3*60*10,ds=!We&&Ht&&!ye&&!Be&&!c&&!U&&(xe==null?void 0:xe.kind)!==at.GizmoMagicCreate&&d===Jo&&a&&u&&!rt&&Date.now()-(Y.message.create_time??0)*1e3<1e3*60*10,qs=cc(Y),dt=O.message.author.role===be.Assistant?O.message:null;Oi({isCompletionRequestInProgress:ye,isUserTurn:M,message:dt});const $s=ds?qs:void 0,Ks=Hr(o,T),wt=Ui(xe),us=!Vt&&!wt&&Wt&&a&&(D==null?void 0:D.num_variants_in_stream)===2&&!Y.inlineComparisonRating&&!Ks,z=T.length===2,de=us,re=us&&!z,ae=!M&&!c&&!g&&!Ut&&!wt&&!Be&&!ye,Oe=ae&&(!f||Gt||Te||S)&&!wt&&!We&&!q,Ue=!g&&!c&&!((ye||Be)&&a)&&T.length>1&&!U&&!de;let qe=!1;if(M&&k.length===1){const{shouldHideContent:se}=Pn(k[0]);se&&(qe=!0)}const Ze=M&&!c&&!wt&&!g&&!he&&k.length===1&&!qe&&!U&&!We,Qs=se=>{r(T[se]),Z.logEvent(ee.changeNode,{intent:"toggle_between"})};if(!(w.role===be.Root?!1:w.role===be.System||k.every(se=>{var me;return(me=se.message.metadata)==null?void 0:me.is_visually_hidden_from_conversation})?Hs:!0)&&!de)return null;const Ys=a&&zt&&!St?n.jsx(bs,{onClick:()=>{const se=new dn;ct({id:cs,eventMetadata:{eventSource:"mouse"},turnTracker:se}),zi()},icon:Ls,label:p.formatMessage({id:"ConversationTurn.regenerateTooltip",defaultMessage:"Regenerate"}),testId:"regenerate-turn-action-button"}):null,_t="h-[30px] rounded-md px-1 text-token-text-secondary hover:bg-token-main-surface-secondary",Xs=St?n.jsx(jc,{className:_t,clientThreadId:o,message:Y,onModelSelect:Bt,onDropdownChange:Pt,canRegenerateResponse:zt}):null,qt=!M&&!qe&&!c&&(!a||!ye)?n.jsx($i,{onClick:Lt}):null,ue=!M&&!c&&(!a||!ye)&&(Y.disclaimers??[]).length===0&&Y.nodeId?n.jsx(yc,{conversationId:o,message:Y,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-xs text-token-text-tertiary hover:text-token-text-primary"}):null,ut=!M&&!c&&Y&&(!a||!ye)?n.jsx(Ki,{message:Y,isFinalTurn:a,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-token-text-tertiary hover:text-token-text-primary"}):null,Js=Oe&&!ye?n.jsxs("div",{className:"flex",children:[!(Je!=null&&Je.includes(Es.ThumbsDownOnly))&&Ve!=="thumbsDown"&&n.jsx(bs,{onClick:()=>ls("thumbsUp"),disabled:Ve==="thumbsUp",icon:Ve==="thumbsUp"?rl:$a,label:p.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"},`thumbsUp:${Y.nodeId}`),Ve!=="thumbsUp"&&n.jsx(bs,{onClick:()=>ls("thumbsDown"),disabled:Ve==="thumbsDown",icon:Ve==="thumbsDown"?ll:Ka,label:p.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"},`thumbsDown:${Y.nodeId}`)]}):null,Zs=!St&&n.jsx(ac,{className:_t,clientThreadId:o,message:Y,onModelSelect:Bt,onDropdownChange:Pt});return n.jsxs("article",{className:"w-full text-token-text-primary focus-visible:outline-2 focus-visible:outline-offset-[-4px]",ref:Dt,dir:"auto","data-testid":`conversation-turn-${e}`,"data-scroll-anchor":a,onMouseEnter:()=>lt(!0),onMouseLeave:()=>lt(!1),children:[n.jsx(Bi,{role:w.role}),n.jsx(La,{clientThreadId:o,showInlineEmbeddedDisplay:c,isStaticSharedThread:g,withVerticalPadding:!0,withHorizontalPadding:!de,children:de?n.jsx(Nc,{isFeedbackEnabled:Oe,variantIds:T,variantsInStreamInfo:D,conversationTurnMountTime:Ot,stubSideBySideFeedback:re,...t}):n.jsxs(mn,{children:[!M&&n.jsx($c,{children:n.jsx(_n,{messages:k,isUserTurn:M,avatarClassName:y,showInlineEmbeddedDisplay:c,gizmo:G})}),n.jsx("div",{className:te("group/conversation-turn relative flex w-full min-w-0 flex-col",!M&&Gi),children:n.jsx("div",{className:"flex-col gap-1 md:gap-3",children:n.jsxs(n.Fragment,{children:[!M&&!g&&n.jsx(Cn,{messages:k,isMemoryEnabled:u,isMemoryFull:rt,gizmoId:G==null?void 0:G.gizmo.id}),n.jsx(gn,{groupedMessagesToRender:Ws,allGroupedMessages:E,...t,isEditing:U,isUserTurn:M,isCompletionRequestInProgress:ye,isFeedbackEnabled:Oe,isFinalTurn:a,hasActiveRequest:Gs,showEditButton:Ze,handleEnterEdit:Os,handleExitEdit:Us}),ve&&n.jsx("div",{className:"mb-4",children:n.jsx(Wi,{messages:k})}),Te&&n.jsx("div",{className:"mb-4",children:n.jsx(Hc,{messages:k})}),(ae||Ue)&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:te("mb-2 flex gap-3 empty:hidden",M?"mr-1 flex-row-reverse":"-ml-2"),children:n.jsx(Hi,{alwaysShow:a,showInline:a||Ue,isHovered:He||rs,pagination:Ue&&n.jsx(Vi,{showInline:a||Ue,currentPage:R,onChangeIndex:Qs,length:T.length,className:te("self-center",T.length>1?"visible":"!invisible")}),actions:ae&&n.jsxs(n.Fragment,{children:[ue,qt,Ys,Js,ut,Zs,Xs]})})}),ae&&!ye?n.jsx("div",{className:"pr-2 lg:pr-0",children:n.jsx(qi,{message:Y,isFinalTurn:a})}):null,a&&!ye&&n.jsx(Wc,{canShowIndepthFeedbackType:$s,canShowInlineComparisonFeedback:Vs,canShowInlineMessageFeedback:Q,clientThreadId:o,conversationLeafId:s,messageForRating:Y,allGroupedMessages:E,currentModelId:d,conversationTurnMountTime:Ot,variantIds:T})]})]})})})]})})]})}const qc=Eo.memo(Vc),$c=Ye.div`flex-shrink-0 flex flex-col relative items-end`,Kc=t=>{const e=bt();return m.useCallback(s=>{var c,d;Qi(s);const{target:a}=s;if(!(a instanceof Element))return;const o=(c=a.closest("[data-message-id]"))==null?void 0:c.getAttribute("data-message-id"),r=(d=document.getSelection())==null?void 0:d.toString(),l=B.getServerThreadId(t);!o||!r||!l||e||De.submitImplicitMessageFeedback({source:"keyboard",type:"copy",messageId:o,serverThreadId:l,selectedText:r})},[t,e])};function Qc({onChangeItemInView:t,onRequestMoreCompletions:e,onChangeRating:s,onRequestCompletion:a,clientThreadId:o,conversationLeafId:r,inlineEmbeddedDisplay:l,hideHeader:c}){const d=Yi(),h=Vr(),y=Xi(),[b]=Ji(),p=Ds(o),x=as(),S=Zo(o),g=d.store.useContentAreaDimensions(Zi.Header,I=>I!=null&&I.height?I.height:void 0),f=d.store.useIsHeaderContentAreaPopulated(),u=za(o),{isArchived:v}=u,w=vl(S.id),C=(p==null?void 0:p.kind)===at.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":w,T=Ba(o,r),D=er(),[E,V]=m.useState(0);m.useEffect(()=>{h&&(E===0?V(T):T-E===1&&(ze.logEvent("chatgpt_continue_conversation_first_message_sent"),Z.logEvent(ee.continueConversationFirstMessageSent)))},[T,E,h]),h&&(ze.logEvent("chatgpt_continue_conversation_page_loaded"),Z.logEvent(ee.continueConversationPageLoaded));const O=m.useCallback(()=>{y({behavior:"smooth"})},[y]),k=Kc(o),L=D&&!v,U=(I,Q,A)=>[...new Array(Q-I).keys()].map(R=>{const M=R+I;return n.jsx(qc,{isFinalTurn:A(M),turnIndex:M,clientThreadId:o,conversationLeafId:r,onChangeItemInView:t,onChangeRating:s,onRequestMoreCompletions:e,onRequestCompletion:a,currentModelId:S.id,showInlineEmbeddedDisplay:l,avatarClassName:C,scrollToBottom:O},M)});return n.jsxs("div",{onCopy:k,className:te("flex flex-col text-sm",L&&"pb-[120px]",g||L?null:"md:pb-9"),style:{paddingBottom:L?void 0:g},children:[!c&&(x==null?void 0:x.data)&&!l&&n.jsx(Xa,{clientThreadId:o}),h&&n.jsxs(n.Fragment,{children:[n.jsx(mn,{children:n.jsx("p",{className:"text-xs text-gray-500",children:n.jsx(P,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),U(0,E,I=>I===E-1),n.jsx(mn,{children:n.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[n.jsx(cl,{className:"icon-xs mr-2"}),n.jsx(P,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})}),U(E,T,I=>I===T-1)]}),!h&&U(0,T,I=>I===T-1),!b&&!l&&n.jsx(Yc,{className:te(g?null:"bottom-5",L?f?"translate-y-[-50px]":"translate-y-[-10px]":""),style:{bottom:D?"calc(var(--composer-bar_footer-current-height) + var(--composer-bar_current-height))":g},onClick:()=>{ze.logEvent("chatgpt_thread_scroll_to_bottom"),y({behavior:"smooth"})},children:n.jsx(dl,{className:"icon-md text-token-text-primary"})})]})}const Yc=Ye.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-light right-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`;function Xc({clientThreadId:t,currentModelId:e}){const s=Sl(e,wl.CODE_INTERPRETER);Zc(s,t)}async function Jc({queryKey:[t,e]}){return await De.getThreadInterpreterState(e).then(s=>(s.time_remaining_ms===0&&s.kernel_started&&cn.warning("This advanced data analysis (beta) chat has timed out. You may continue the conversation, but previous files, links, and code blocks below may not work as expected.",{hasCloseButton:!0,duration:0}),s))}function Zc(t,e){const s=Fn(),a=B.getServerThreadId(e);return Ro({queryKey:["interpreterState",a],queryFn:Jc,enabled:!!(t&&a&&!s),gcTime:0})}const ed=xt(()=>yt(()=>import("./mxar5mbxnuehsu4r.js"),__vite__mapDeps([94,1,2,3,10,6,7,11,9,27,71,47,48,85,64,15,37])).then(t=>t.OpenDebugSidebarButton)),td=xt(()=>yt(()=>import("./fs8qbp2ozlhg0mlf.js"),__vite__mapDeps([95,1,2,3,6,7,69,11])),{ssr:!1}),sd=xt(()=>yt(()=>import("./sso-hxpl3fvhyqxhpyph.js").then(t=>t.n),__vite__mapDeps([31,1,2,3,32,6,7,13,33,34,35,36,37,38,15,39,11,10,40,41,42,43,44,12,9,45,46,47,48,49,17,27,50,51,28,29,52,26,30,53,54,55,56,57,58,59,60,19,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,16,80,81,82,83,84,85,86,87,88,89,90,91,92,93])).catch(()=>()=>null),{ssr:!1}),nd=xt(()=>yt(()=>import("./sso-hxpl3fvhyqxhpyph.js").then(t=>t.P),__vite__mapDeps([31,1,2,3,32,6,7,13,33,34,35,36,37,38,15,39,11,10,40,41,42,43,44,12,9,45,46,47,48,49,17,27,50,51,28,29,52,26,30,53,54,55,56,57,58,59,60,19,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,16,80,81,82,83,84,85,86,87,88,89,90,91,92,93])).then(t=>t.default)),ad=xt(()=>yt(()=>import("./sso-hxpl3fvhyqxhpyph.js").then(t=>t.q),__vite__mapDeps([31,1,2,3,32,6,7,13,33,34,35,36,37,38,15,39,11,10,40,41,42,43,44,12,9,45,46,47,48,49,17,27,50,51,28,29,52,26,30,53,54,55,56,57,58,59,60,19,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,16,80,81,82,83,84,85,86,87,88,89,90,91,92,93])).then(t=>t.CAFeedbackModal).catch(()=>()=>null)),Ke=Le({doNotShareSensitive:{id:"thread.modal.onboarding.title",defaultMessage:"Do not share sensitive materials with this application"},mayProduceInaccurateInformation:{id:"thread.chatgptMayProduceInaccurateInformation-oct-30",defaultMessage:"ChatGPT can make mistakes. Check important info."},mayProduceInaccurateInformationNoAuth:{id:"thread.chatgptMayProduceInaccurateInformationNoAuth-march-27",defaultMessage:"ChatGPT can make mistakes. Check important info. Read our <termsLink>Terms</termsLink> and <privacyLink>Privacy Policy</privacyLink>."},mayProduceInaccurateInformationNoAuthV2:{id:"thread.chatgptMayProduceInaccurateInformationNoAuth-may-06",defaultMessage:"By messaging ChatGPT, you agree to our <termsLink>Terms</termsLink> and have read our <privacyLink>Privacy Policy</privacyLink>."},mayProduceInaccurateInformationNoAuthKorea:{id:"thread.chatgptMayProduceInaccurateInformationNoAuthKorea-may-06",defaultMessage:"By messaging ChatGPT, you agree to our <termsLink>Terms</termsLink> and have read our <privacyLink>Privacy Policy</privacyLink> and its <koreaAddendumLink>Korea addendum</koreaAddendumLink>."},businessDisclaimer:{id:"thread.businessDisclaimer-oct-30",defaultMessage:"{workspaceName} workspace chats aren't used to train our models. ChatGPT can make mistakes."},businessDisclaimerNoName:{id:"thread.businessDisclaimerNoName-oct-30",defaultMessage:"Your workspace chats aren'ts used to train our models. ChatGPT can make mistakes."},outdatedGptDisclaimer:{id:"thread.outdatedGptDisclaimer.0",defaultMessage:"<bold>New version of GPT available</bold> - Continue chatting to use the old version, or start a <link>new chat</link> for the latest version."},somethingWentWrong:{id:"thread.modal.unrecoverableError.title",defaultMessage:"Something went wrong"},tryAgainLater:{id:"thread.modal.unrecoverableError.description",defaultMessage:"We're sorry, but something went wrong. Please try again later."},resetThread:{id:"thread.modal.unrecoverableError.resetThread",defaultMessage:"Reset thread"},sharedConversationReportConversation:{id:"thread.sharedConversation.report",defaultMessage:"Report conversation"},latencyButton:{id:"thread.latencyButton",defaultMessage:"Latency"},archivedConversationDescription:{id:"thread.archivedConversationDescription",defaultMessage:"This conversation is archived. To continue, please unarchive it first."},unarchiveButton:{id:"thread.unarchiveButton",defaultMessage:"Unarchive"}});function od({clientThreadId:t}){const e=vt(t);return e!=null?n.jsx(id,{clientThreadId:t,gizmoId:e}):n.jsx(lo,{clientThreadId:t})}function id({clientThreadId:t,gizmoId:e}){const s=Is(e).data,a=Ga(r=>Rs.getThreadCreateTime(t,r)),o=(s==null?void 0:s.gizmo.updated_at)!=null?new Date(s.gizmo.updated_at):void 0;return(s==null?void 0:s.gizmo.short_url)==null||o==null||a==null||o<=a?n.jsx(lo,{clientThreadId:t}):n.jsxs("div",{className:"text-token-text-tertiary",children:[n.jsx(ul,{className:"text-token-secondary mb-1 mr-1 inline-block h-4 w-4 stroke-0"}),n.jsx(P,{...Ke.outdatedGptDisclaimer,values:{link:r=>n.jsx(qo,{to:oi(s.gizmo.short_url),className:"underline",children:r}),bold:r=>n.jsx("span",{className:"text-token-secondary font-semibold",children:r})}})]})}function rd({clientThreadId:t}){return yr(s=>s.hasAcceptedFooterDisclaimer)?n.jsx("div",{children:n.jsx(P,{...Ke.mayProduceInaccurateInformation})}):n.jsx(ld,{clientThreadId:t})}function lo({clientThreadId:t}){const e=ks(In.isBusinessWorkspace),s=ks(d=>d.currentWorkspace),a=s==null?void 0:s.name,{isUnauthenticated:o,isLoading:r}=Ft(),c=Wa({clientThreadId:t,role:be.User})>0;return r?null:e?n.jsx("div",{children:a!=null?n.jsx(P,{...Ke.businessDisclaimer,values:{workspaceName:a}}):n.jsx(P,{...Ke.businessDisclaimerNoName})}):o&&!c?n.jsx($o,{children:n.jsx(rd,{clientThreadId:t})}):n.jsx("div",{children:n.jsx(P,{...Ke.mayProduceInaccurateInformation})})}function ld({clientThreadId:t}){const{country:e}=Ko(),s=e==="KR"?Ke.mayProduceInaccurateInformationNoAuthKorea:Ke.mayProduceInaccurateInformationNoAuthV2,{layer:a}=As("3637408529"),o=(a==null?void 0:a.get("should_show_disclaimer_only_once_per_device",!1))??!1;return m.useEffect(()=>()=>{Wa({clientThreadId:t,role:be.User})>0&&vr.updateHasAcceptedFooterDisclaimer(o)},[t,o]),n.jsx("span",{className:"text-sm leading-none",children:n.jsx(P,{...s,values:{privacyLink:r=>n.jsx("a",{href:"https://openai.com/privacy",target:"_blank",className:"text-token-text-primary underline decoration-token-text-primary",onClick:()=>{ze.logEvent("chatgpt_footer_disclaimer_privacy_link_clicked"),Z.logEvent(ee.footerDisclaimerPrivacyLinkClicked)},rel:"noreferrer",children:r}),termsLink:r=>n.jsx("a",{href:"https://openai.com/terms",target:"_blank",className:"text-token-text-primary underline decoration-token-text-primary",onClick:()=>{ze.logEvent("chatgpt_footer_disclaimer_terms_link_clicked"),Z.logEvent(ee.footerDisclaimerTermsLinkClicked)},rel:"noreferrer",children:r}),koreaAddendumLink:r=>n.jsx("a",{href:"https://openai.com/ko/policies/kr-privacy-policy-addendum",target:"_blank",className:"text-token-text-primary underline decoration-token-text-primary",onClick:()=>{ze.logEvent("chatgpt_footer_disclaimer_korea_addendum_link_clicked"),Z.logEvent(ee.footerDisclaimerKoreaAddendumLinkClicked)},rel:"noreferrer",children:r})}})})}function cd({clientThreadId:t}){const e=Ca(),s=Ps(t),a=async()=>{s&&(await De.patchConversation(s,{is_archived:!1}),e.invalidateQueries({queryKey:["conversation",t]}),Ga.setState(o=>{const r=o.threads[s];r!=null&&(r.initialThreadData.isArchived=!1)}),bl(e))};return n.jsxs("div",{className:"my-6 flex flex-col items-center justify-center gap-4",children:[n.jsx("div",{className:"px-3 text-center text-sm text-token-text-secondary",children:n.jsx(P,{...Ke.archivedConversationDescription})}),n.jsx("div",{children:n.jsx(Tt,{disabled:!s,onClick:a,icon:hl,children:n.jsx(P,{...Ke.unarchiveButton})})})]})}function dd(t,e){const s=Jt(t),a=B.getTitle(t);return e&&e.kind===at.GizmoInteraction&&e.gizmo?s?`ChatGPT - ${e.gizmo.gizmo.display.name}`:a&&`${e.gizmo.gizmo.display.name} - ${a}`:s?"ChatGPT":a}const Dd=function({clientThreadId:t,onCompletionFinished:e,preRequestCompletion:s,hideHeader:a,hideMessages:o,hideFooter:r,hideToolsOverlay:l,messagesVerticalAlign:c="top",prependThreadChildren:d,renderEmptyState:h}){const y=Ca(),b=Po(),p=as(),x=kn(),S=_a(),g=_s(),f=Nr(t),u=Oa(t),v=Rn(t),C=za(t).isArchived;m.useEffect(()=>{u||(Jt(t)?Wn.addTiming("chatgpt.web.chatPage.renderNewConversation"):Wn.addTiming("chatgpt.web.chatPage.renderExistingConversation"))},[t,u]);const T=qr(t,v),D=Ba(t,v),{setTargetedContent:E}=tr(),V=x==null?void 0:x.includes(Do),O=sr(),k=D>=2,L=Jt(t)&&!k&&tn(f),U=Jt(t)&&!T&&(tn(f)||(f==null?void 0:f.kind)===at.GizmoTest),Q=ei().id,A=ti(t)??Q,{value:R}=Ss("4203174056"),M=si(t,Lo.Search),q=Da(A),G=Ma()[A],J=dd(t,f),ve=Ds(t),Te=nr(),xe=Er(t),{config:Rt}=Oo("1013114931"),Be=Rt.get("show_follow_ups",!1)&&(p==null?void 0:p.isPersonalAccount()),Ge=!g.displayingSideBySideFeedback&&Be,Xe=bt();m.useEffect(()=>{qn()},[]),m.useEffect(()=>{Te||E(void 0),B.getLastMessgageSystemHints(t,v).includes(Cs.Search)&&M?$n.addPersistedSystemHint(Cs.Search):$n.clear()},[t,E,Te,v,b.search,M]);const rt=m.useCallback(z=>{if(z==null||(e==null||e(z),Xe)||((ve==null?void 0:ve.kind)===at.GizmoInteraction&&ni.handleGizmoInteracted(y,ve.gizmo_id),!(xe||Ge)))return;const re=B.getThreadCurrentLeafId(z),ae=B.getTree(z).getMessage(re);Uo(ae)||zo(ae)||ar(z,ae.id,A)},[y,e,ve,xe,Ge,A,Xe]),Je=$r(t),is=Ir(t,Je,rt),St=m.useCallback(()=>{const z=B.getThreadCurrentLeafId(t);if(z==null)return;const re=B.getTree(t).getBranchFromLeaf(z);or.abortRequests(re.map(ae=>ae.id))},[t]),he=os(),{isUnauthenticated:We,isLoading:rs}=Ft(),Pt=ir(),He=m.useCallback(async({type:z,promptId:de,requestedModelId:re,eventMetadata:ae,cancelActiveRequests:Oe,focusOnNewCompletion:Ue=!0,useDefaultModel:qe,completionMetadata:Ze,appendMessages:Qs,updateTree:Un,turnTracker:Ys,extraStreamParams:_t})=>{qn(),rr.reset(),Oe&&St();const Xs=performance.now();let qt=A;re?qt=re:qe&&(qt=Q);const ue=lr({namespace:cr.CompletionRequest,key:de});ue==null||ue.logTiming("start_chat_requirements");const ut=await Bo();ue==null||ue.logTiming("fetched_chat_requirements"),ut.force_login&&Pt({authType:"login"});const Js=await Go.getEnforcementToken(ut);ue==null||ue.logTiming("fetched_arkose_token");const Zs=await dr.getEnforcementToken(ut);ue==null||ue.logTiming("fetched_turnstile_token");const hs=await Wo.getEnforcementToken(ut);ue==null||ue.logTiming("fetched_p_token"),s==null||s(t,de),is({model:qt,completionType:z,parentNodeId:de,metadata:ae,focusOnNewCompletion:Ue,completionMetadata:Ze,chatReq:ut,arkoseToken:Js??null,turnstileToken:Zs??null,proofToken:hs??null,preflightTime:performance.now()-Xs,extraStreamParams:{forceParagen:he.forceParagen,forceParagenModel:he.forceParagenModel.value,forceNulligen:he.forceNulligen,forceRateLimit:he.forceRateLimit,resetRateLimits:he.resetRateLimits,disableSystemContentToggling:he.rebaseSystemMessageContent?!0:void 0,forceUseSearch:he.forceUseSearch??(_t==null?void 0:_t.forceUseSearch)},appendMessages:Qs,updateTree:Un,turnTracker:Ys}),We&&ur.incrementUserMessageCount()},[Q,A,s,t,is,he.forceParagen,he.forceParagenModel,he.forceNulligen,he.forceRateLimit,he.resetRateLimits,he.rebaseSystemMessageContent,he.forceUseSearch,St,Pt,We]),lt=!!(p!=null&&p.features.includes(Es.SharedWebsocket));m.useEffect(()=>{lt&&sn.registerIfNotConnected()},[lt]),m.useEffect(()=>{const z=()=>{if(document.visibilityState==="visible"){if(!lt)return;sn.registerIfNotConnected()}};return document.addEventListener("visibilitychange",z),()=>{document.removeEventListener("visibilitychange",z)}},[lt]);const Dt=Ps(t);m.useEffect(()=>{const z=()=>{sn.stopConversation(Dt)};return window.addEventListener("beforeunload",z),()=>{window.removeEventListener("beforeunload",z)}},[Dt]);const Y=ai({clientThreadId:t,currentLeafId:v,handleRequestCompletion:He}),Ve=m.useCallback((z,de,re,ae=!0,Oe="none",Ue)=>{const Ze=B.getTree(t).getParentPromptNode(z).id;He({type:Sa.Variant,promptId:Ze,eventMetadata:de,cancelActiveRequests:!1,focusOnNewCompletion:ae,useDefaultModel:Ue,completionMetadata:{variantPurpose:Oe,conversationMode:Rs.getConversationMode(t)},turnTracker:re})},[He,t]),Os=m.useCallback(z=>{const re=B.getTree(t).getLeafFromNode(z);B.setThreadCurrentLeafId(t,re.id)},[t]),[Us,Lt]=m.useState(),ls=m.useCallback(({nodeId:z,messageId:de,rating:re})=>{var qe;const ae=B.getServerThreadId(t);Z.logEvent(ee.thumbRating,{id:de,threadId:ae,rating:re,model:A});const Oe=B.getTree(t),Ue=Oe.getNodeByIdOrMessageId(z);if(ae!==void 0&&(q?gt:De.submitMessageFeedback)({message_id:de,conversation_id:ae,rating:re}),B.updateTree(t,Ze=>{Ze.updateNodeMetadata(z,{rating:re})}),q){Lt(n.jsx(ad,{citations:((qe=Ue.message.metadata)==null?void 0:qe.citations)??[],rating:re,conversationId:ae??"",messageId:de,onSubmit:()=>{Lt(void 0)},onCancel:()=>Lt(void 0),conversationTree:Oe,nodeId:z},`${z}-${re}`));return}},[t,A,q]),{setShowReferralInviteModal:Ot}=Kn(z=>({setShowReferralInviteModal:z.setShowReferralInviteModal})),zs=m.useCallback(()=>{Ot(!1)},[Ot]),Bs=Kn(z=>z.showReferralInviteModal);Xc({clientThreadId:t,currentModelId:A});const ye=z=>n.jsx(_l,{scrollAnchorTopOffset:a?0:xr,children:c==="bottom"?n.jsxs("div",{className:"flex h-full flex-col",children:[n.jsx("div",{className:"flex-1"}),z]}):z});m.useEffect(()=>{document.title=J??"ChatGPT"},[J]);const Gs=vt(t),Ws=bt(),Hs=Il(),Ut=U&&!h&&S&&!Gs&&!q&&!Ws,zt=Ut&&!rs&&We,ct=Ut&&!rs&&!We,cs=ct&&Hs,Bt=Fl(zt),Gt=El(ct),Wt=Rl(cs),Ht=zt&&Bt||ct&&Gt||cs&&Wt,Vt=Bt||Gt||Wt,{composerBarSize:Vs,composerSkeleton:ds,footerBarSize:qs,isClippedComposerBar:dt,setComposerBarElement:$s,setFooterBarElement:Ks,ThreadSizeWrapper:wt}=hr({isArchived:C}),us=dt?{footerBarSize:qs,composerBarSize:Vs}:{};return n.jsxs(wt,{...us,children:[V&&n.jsx(td,{}),R&&n.jsx(nd,{}),n.jsx(Ho,{children:J!=null&&n.jsx("title",{children:J})}),(f==null?void 0:f.kind)===at.GizmoInteraction&&f.gizmo&&n.jsx(ii,{gizmo:f.gizmo}),n.jsx(va.Provider,{value:He,children:n.jsxs(mr,{children:[n.jsxs(Fr,{clientThreadId:t,currentModelConfig:G,className:"composer-parent flex h-full flex-col focus-visible:outline-0",children:[!o&&n.jsx(ud,{className:te(dt&&"masked-content"),style:{"--composer-bar_skeleton":ds},children:!u&&!Y?U?h??n.jsx(Hn,{shouldSSR:!Vt,children:n.jsx(Yl,{clientThreadId:t,currentModelId:A,onRequestCompletion:He,enableV2Homepage:Ht})}):k?ye(n.jsxs(n.Fragment,{children:[d,n.jsx(Qc,{onChangeItemInView:Os,onRequestMoreCompletions:Ve,onChangeRating:ls,onRequestCompletion:He,clientThreadId:t,inlineEmbeddedDisplay:!1,conversationLeafId:v,hideHeader:a},t)]})):null:null}),n.jsx(hd,{className:te(dt&&"mask-scrollbars absolute bottom-0 z-20"),children:C?n.jsx(cd,{clientThreadId:t}):n.jsxs("div",{className:te(dt&&"relative mx-auto flex max-w-3xl flex-1 flex-col"),children:[dt?n.jsx(gr,{skeleton:ds}):null,!Ht&&n.jsx(Hn,{shouldSSR:!Vt,children:n.jsx(Rr,{clientThreadId:t,isNewThread:L,setComposerBarElement:$s,showPromptStarters:L||!T,currentModelId:A,onRequestCompletion:He})}),!r&&n.jsx("div",{ref:Ks,className:"relative w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",children:tn(f)&&n.jsx("div",{className:"min-h-4",children:n.jsx(od,{clientThreadId:t})})})]})})]}),!l&&n.jsxs("div",{className:"group absolute bottom-2 end-2 z-20 hidden gap-1 md:flex lg:bottom-3 lg:end-3",children:[O?n.jsxs(n.Fragment,{children:[n.jsx(ed,{}),n.jsx(sd,{})]}):null,n.jsx(ml,{})]}),Us,n.jsx(ri,{clientThreadId:t,isStaticSharedThread:!1}),n.jsx(fr,{}),(x==null?void 0:x.includes(Vo))&&n.jsx(pr,{isOpen:Bs,onClose:zs}),n.jsx(br,{conversationId:t,currentModelId:A})]})})]})},ud=Ye.div`grow flex-1 overflow-hidden`,hd=Ye.div`md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent w-full`;export{qc as C,Dd as T,Qc as a,Nl as b};
//# sourceMappingURL=o86xcm59f6hb2wbh.js.map
