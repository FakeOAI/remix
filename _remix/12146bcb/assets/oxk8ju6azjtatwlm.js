const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pbta2y3e4v235x8t.js","assets/ip6o7w560sp3rlqf.js","assets/hp39gyvfk9izyswg.js","assets/j5ja7xvvykoxxcji.js","assets/d99imeng6jbz5fyz.js","assets/h11ymloodq9g1jsm.js","assets/b4lc2pk5tx9fvyxr.js","assets/root-nv4udjzh.css","assets/conversation-small-cll5buey.css","assets/bwdp3ugp1ll74h3f.js","assets/opy89b7ztw9itay4.js","assets/jw64vuuhp544up6k.js","assets/kwrfyfn5nclbwyy3.js","assets/bjn84gz6ir9jwwg5.js","assets/eq74s9a1xv98w014.js","assets/dsaua33b1n5eatnj.js","assets/fzg4ztxf1dd6k2qj.js","assets/f62aedxhypzva2sq.js","assets/la7sxhxz2eo8dk9z.js","assets/o0yhon7qg91yktpl.js","assets/geaae92xvjdyqon0.js","assets/iua4ktursgg3kvfl.js","assets/ojuvt29p72858xnp.js","assets/izfvs4rurgoo3d97.js","assets/defoobo64skv3wz9.js","assets/acd90deg0ofzrs7p.js","assets/usf7bvbexoiru8tr.js","assets/nfsy86gazuk4zu7i.js","assets/h1afof3ectxzumsq.js","assets/m7lq2n7v3ozdei0b.js","assets/cyvwqddxzqjexws2.js","assets/o8psdzckxf2917uh.js","assets/fsubiyxtoed4mcss.js","assets/j7kcq3730wwwd8dq.js","assets/c3urs27z5pfi1ach.js","assets/f6s0hck2v6skt27w.js","assets/caxqz3g7hxvtapwu.js","assets/n6xjpdi8i9v7rcdc.js"])))=>i.map(i=>d[i]);
import{a0 as N,aF as nt,i as Jt,g as Zt,fp as Qt,x as c,O as M,n as ce,r as g,Y as Me,f4 as eo,d3 as rt,aw as to,c2 as st,T as w,b8 as oo,X as at}from"./h11ymloodq9g1jsm.js";import{mH as y,mD as no,mI as ae,j6 as B,mJ as it,mK as ct,j5 as me,aI as X,fZ as j,bO as ro,eI as so,co as lt,mL as D,jn as W,jg as Ne,mM as ao,mN as io,mO as co,kO as Fe,dA as Te,ja as He,j8 as Ye,$ as lo,i as uo,j as fo,k as mo,h as po,f$ as go,ky as ho,g0 as vo}from"./d99imeng6jbz5fyz.js";import{c as Co,S as xo,H as Eo,x as bo,t as d}from"./hp39gyvfk9izyswg.js";import{E as _o,a2 as te,a1 as $,C as L,a3 as pe,a4 as yo,a5 as ge,a6 as No,b as To,u as So,e as Po,a7 as Ao,_ as V,a8 as ut,S as dt}from"./j5ja7xvvykoxxcji.js";import{m as k}from"./jw64vuuhp544up6k.js";import{c3 as Io,c4 as Oo,bT as Mo,S as wo,c5 as Ro}from"./b4lc2pk5tx9fvyxr.js";import{b as Lo}from"./b4n0k1szp5y82bgn.js";import{d as ko,P as ft,f as jo,c as Do,q as Bo,j as Go,D as $e,i as mt}from"./bwdp3ugp1ll74h3f.js";import{u as Vo}from"./n8lgruft516grh7w.js";import{i as Fo}from"./cmojh2ygd1c1e9pt.js";const Ho="_modelCursor_1mtn0_1",vs={modelCursor:Ho},Yo=(...e)=>o=>{e.forEach(t=>{if(typeof t=="function")t(o);else if(t){const n=t;n.current=o}})};function I(e){return new Co(xo.define(e))}const Ue=()=>N(()=>import("./pbl95wx6493wq92j.js"),[]).then(e=>I(e.shell)),pt={[y.bash]:Ue,[y.zsh]:Ue,[y.swift]:()=>N(()=>import("./pijqfo56g5y7ss6b.js"),[]).then(e=>I(e.swift)),[y.css]:()=>N(()=>import("./pbta2y3e4v235x8t.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24])).then(e=>e.css()),[y.html]:()=>N(()=>import("./acd90deg0ofzrs7p.js"),__vite__mapDeps([25,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,0,26])).then(e=>e.html()),[y.javascript]:()=>N(()=>import("./usf7bvbexoiru8tr.js"),__vite__mapDeps([26,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24])).then(e=>e.javascript({jsx:!0,typescript:!1})),[y.typescript]:()=>N(()=>import("./usf7bvbexoiru8tr.js"),__vite__mapDeps([26,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24])).then(e=>e.javascript({jsx:!0,typescript:!0})),[y.json]:()=>N(()=>import("./nfsy86gazuk4zu7i.js"),__vite__mapDeps([27,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24])).then(e=>e.json()),[y.python]:()=>N(()=>import("./h1afof3ectxzumsq.js"),__vite__mapDeps([28,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24])).then(e=>e.python()),[y.sql]:()=>N(()=>import("./m7lq2n7v3ozdei0b.js"),__vite__mapDeps([29,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,1])).then(e=>e.sql()),[y.go]:()=>N(()=>import("./cyvwqddxzqjexws2.js"),__vite__mapDeps([30,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24])).then(e=>e.go()),[y.yaml]:()=>N(()=>import("./o8psdzckxf2917uh.js"),__vite__mapDeps([31,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24])).then(e=>e.yaml()),[y.java]:()=>N(()=>import("./fsubiyxtoed4mcss.js"),__vite__mapDeps([32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24])).then(e=>e.java()),[y.rust]:()=>N(()=>import("./j7kcq3730wwwd8dq.js"),__vite__mapDeps([33,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24])).then(e=>e.rust()),[y.cpp]:()=>N(()=>import("./c3urs27z5pfi1ach.js"),__vite__mapDeps([34,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24])).then(e=>e.cpp()),[y.php]:()=>N(()=>import("./f6s0hck2v6skt27w.js"),__vite__mapDeps([35,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,0,26])).then(e=>e.php()),[y.xml]:()=>N(()=>import("./caxqz3g7hxvtapwu.js"),__vite__mapDeps([36,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24])).then(e=>e.xml()),[y.vue]:()=>N(()=>import("./n6xjpdi8i9v7rcdc.js"),__vite__mapDeps([37,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,1,0,26])).then(e=>e.vue()),[y.ruby]:()=>N(()=>import("./e4lhyu305wu0fcut.js"),[]).then(e=>I(e.ruby)),[y.haskell]:()=>N(()=>import("./bf6r3t2rw7f01so5.js"),[]).then(e=>I(e.haskell)),[y.kotlin]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>I(e.kotlin)),[y.csharp]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>I(e.csharp)),[y.c]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>I(e.c)),[y.objectivec]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>I(e.objectiveC)),[y.r]:()=>N(()=>import("./n0t2rpizlasjzcxa.js"),[]).then(e=>I(e.r)),[y.lua]:()=>N(()=>import("./harowmpdmpnd9wki.js"),[]).then(e=>I(e.lua)),[y.dart]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>I(e.dart)),[y.scala]:()=>N(()=>import("./rlk4qi7ndmxxmstb.js"),[]).then(e=>I(e.scala)),[y.perl]:()=>N(()=>import("./gq1ss5v2zpbborxl.js"),[]).then(e=>I(e.perl)),[y.commonlisp]:()=>N(()=>import("./jr6cjysmysifr6mr.js"),[]).then(e=>I(e.commonLisp)),[y.clojure]:()=>N(()=>import("./gf1tfl9d2himhfic.js"),[]).then(e=>I(e.clojure)),[y.ocaml]:()=>N(()=>import("./khji33iw1sxityyt.js"),[]).then(e=>I(e.oCaml)),[y.powershell]:()=>N(()=>import("./i9u5kd7kvamutmln.js"),[]).then(e=>I(e.powerShell)),[y.verilog]:()=>N(()=>import("./fix340p09fldyqxz.js"),[]).then(e=>I(e.verilog)),[y.dockerfile]:()=>N(()=>import("./cgm5tyzi32u32j10.js"),[]).then(e=>I(e.dockerFile)),[y.other]:()=>null},$o=e=>e in pt,ie={},Cs=async e=>{if(ie[e]!=null)return ie[e];if($o(e)){const o=await pt[e]();return ie[e]=o,o}return null},xs=e=>ie[e]??null;var gt=e=>{var{theme:o,settings:t={},styles:n=[]}=e,r={".cm-gutters":{}},s={};t.background&&(s.backgroundColor=t.background),t.backgroundImage&&(s.backgroundImage=t.backgroundImage),t.foreground&&(s.color=t.foreground),t.fontSize&&(s.fontSize=t.fontSize),(t.background||t.foreground)&&(r["&"]=s),t.fontFamily&&(r["&.cm-editor .cm-scroller"]={fontFamily:t.fontFamily}),t.gutterBackground&&(r[".cm-gutters"].backgroundColor=t.gutterBackground),t.gutterForeground&&(r[".cm-gutters"].color=t.gutterForeground),t.gutterBorder&&(r[".cm-gutters"].borderRightColor=t.gutterBorder),t.caret&&(r[".cm-content"]={caretColor:t.caret},r[".cm-cursor, .cm-dropCursor"]={borderLeftColor:t.caret});var a={};t.gutterActiveForeground&&(a.color=t.gutterActiveForeground),t.lineHighlight&&(r[".cm-activeLine"]={backgroundColor:t.lineHighlight},a.backgroundColor=t.lineHighlight),r[".cm-activeLineGutter"]=a,t.selection&&(r["&.cm-focused .cm-selectionBackground, & .cm-line::selection, & .cm-selectionLayer .cm-selectionBackground, .cm-content ::selection"]={background:t.selection+" !important"}),t.selectionMatch&&(r["& .cm-selectionMatch"]={backgroundColor:t.selectionMatch});var i=_o.theme(r,{dark:o==="dark"}),u=Eo.define(n),l=[i,bo(u)];return l},Uo={background:"#ffffff",foreground:"#383a42",caret:"#000",selection:"#add6ff",selectionMatch:"#a8ac94",lineHighlight:"#f0f0f0",gutterBackground:"#fff",gutterForeground:"#237893",gutterActiveForeground:"#0b216f",fontFamily:'Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace'},Ko=[{tag:[d.keyword,d.operatorKeyword,d.modifier,d.color,d.constant(d.name),d.standard(d.name),d.standard(d.tagName),d.special(d.brace),d.atom,d.bool,d.special(d.variableName)],color:"#0000ff"},{tag:[d.moduleKeyword,d.controlKeyword],color:"#af00db"},{tag:[d.name,d.deleted,d.character,d.macroName,d.propertyName,d.variableName,d.labelName,d.definition(d.name)],color:"#0070c1"},{tag:d.heading,fontWeight:"bold",color:"#0070c1"},{tag:[d.typeName,d.className,d.tagName,d.number,d.changed,d.annotation,d.self,d.namespace],color:"#267f99"},{tag:[d.function(d.variableName),d.function(d.propertyName)],color:"#795e26"},{tag:[d.number],color:"#098658"},{tag:[d.operator,d.punctuation,d.separator,d.url,d.escape,d.regexp],color:"#383a42"},{tag:[d.regexp],color:"#af00db"},{tag:[d.special(d.string),d.processingInstruction,d.string,d.inserted],color:"#a31515"},{tag:[d.angleBracket],color:"#383a42"},{tag:d.strong,fontWeight:"bold"},{tag:d.emphasis,fontStyle:"italic"},{tag:d.strikethrough,textDecoration:"line-through"},{tag:[d.meta,d.comment],color:"#008000"},{tag:d.link,color:"#4078f2",textDecoration:"underline"},{tag:d.invalid,color:"#e45649"}];function zo(e){var{theme:o="dark",settings:t={},styles:n=[]}=e||{};return gt({theme:o,settings:nt({},Uo,t),styles:[...Ko,...n]})}var Es=zo(),Xo={background:"#1e1e1e",foreground:"#9cdcfe",caret:"#c6c6c6",selection:"#6199ff2f",selectionMatch:"#72a1ff59",lineHighlight:"#ffffff0f",gutterBackground:"#1e1e1e",gutterForeground:"#838383",gutterActiveForeground:"#fff",fontFamily:'Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace'},Wo=[{tag:[d.keyword,d.operatorKeyword,d.modifier,d.color,d.constant(d.name),d.standard(d.name),d.standard(d.tagName),d.special(d.brace),d.atom,d.bool,d.special(d.variableName)],color:"#569cd6"},{tag:[d.controlKeyword,d.moduleKeyword],color:"#c586c0"},{tag:[d.name,d.deleted,d.character,d.macroName,d.propertyName,d.variableName,d.labelName,d.definition(d.name)],color:"#9cdcfe"},{tag:d.heading,fontWeight:"bold",color:"#9cdcfe"},{tag:[d.typeName,d.className,d.tagName,d.number,d.changed,d.annotation,d.self,d.namespace],color:"#4ec9b0"},{tag:[d.function(d.variableName),d.function(d.propertyName)],color:"#dcdcaa"},{tag:[d.number],color:"#b5cea8"},{tag:[d.operator,d.punctuation,d.separator,d.url,d.escape,d.regexp],color:"#d4d4d4"},{tag:[d.regexp],color:"#d16969"},{tag:[d.special(d.string),d.processingInstruction,d.string,d.inserted],color:"#ce9178"},{tag:[d.angleBracket],color:"#808080"},{tag:d.strong,fontWeight:"bold"},{tag:d.emphasis,fontStyle:"italic"},{tag:d.strikethrough,textDecoration:"line-through"},{tag:[d.meta,d.comment],color:"#6a9955"},{tag:d.link,color:"#6a9955",textDecoration:"underline"},{tag:d.invalid,color:"#ff0000"}];function qo(e){var{theme:o="dark",settings:t={},styles:n=[]}=e||{};return gt({theme:o,settings:nt({},Xo,t),styles:[...Wo,...n]})}var bs=qo(),Jo=Jt;function Zo(e){return typeof e=="function"?e:Jo}var Qo=Zo,en=Qt,tn=Qo,on=no,nn=9007199254740991,be=4294967295,rn=Math.min;function sn(e,o){if(e=on(e),e<1||e>nn)return[];var t=be,n=rn(e,be);o=tn(o),e-=be;for(var r=en(n,o);++t<e;)o(t);return r}var an=sn;const cn=Zt(an),ln=e=>c.jsx(k.div,{className:"dark:bg-white-400 aspect-square rounded-full bg-gray-400",animate:{translateY:["0%","-50%","0%","0%","0%"]},style:{translateX:.5,width:3,height:3},transition:{repeat:1/0,type:"keyframes",delay:e/10,duration:.7}},e),un=()=>c.jsx(k.div,{className:"grid h-full max-w-full flex-1 grid-cols-3 items-center gap-[0.4] p-1",children:cn(3,e=>ln(e))});function dn(e){switch(e){case"dark_gray":return{normal:"text-token-text-secondary dark:text-white-400",hover:"cursor-pointer hover:text-token-text-primary group-hover:text-token-text-primary"};case"light_gray":return{normal:"text-gray-400",hover:"cursor-pointer hover:text-token-text-secondary group-hover:text-token-text-secondary"}}}function we({children:e,className:o,onClick:t,isClickable:n=!1,theme:r="dark_gray"}){const s=dn(r),a=(t!=null||n)&&s.hover;return c.jsxs("div",{className:M("relative inline-block h-[20px] w-[20px] shrink-0 transition-opacity",o,a,s.normal),onClick:t,children:[e?c.jsx(Io,{className:"h-[20px] w-[20px] shrink-0"}):c.jsx(Oo,{className:"h-[20px] w-[20px] shrink-0"}),c.jsx("span",{className:M("absolute inset-0 flex items-center justify-center text-[8px] font-black",a,s.normal),children:e})]})}function he(){return c.jsx(we,{theme:"light_gray",children:c.jsx(un,{})})}function fn({count:e,isLoading:o,onClick:t}){return o?c.jsx(he,{}):c.jsx(we,{onClick:t,theme:"dark_gray",children:e})}function mn({isLoading:e=!1,onClick:o}){return e?c.jsx(he,{}):c.jsx(we,{isClickable:!0,onClick:o,theme:"light_gray"})}var H=(e=>(e[e.up=-1]="up",e[e.down=1]="down",e))(H||{}),le=(e=>(e.COMMENT="comment",e.COMPOSER="composer",e))(le||{}),R=(e=>(e.COLLAPSED="collapsed",e.EXPANDED="expanded",e))(R||{});const ht=([e,o],[t,n])=>{const r=e+o,s=t+n;return e<s&&t<r},Se=([e,o])=>e+o,J=e=>{if(e.type===R.COLLAPSED)return[e.offsetY??0,0];const{offsetY:o,shiftY:t=0,height:n=0}=e,r=o+t;return t<0?[r,n+Math.abs(t)]:[r,n]},pn=(e,o,t)=>{if(!ht(e,o))return null;const[n,r]=e,s=n+r,[a,i]=o,u=a+i,l=a-s,f=u-n;return t===H.up?l:f};var vt=(e=>(e.ABOVE="above",e.BELOW="below",e))(vt||{});function ee(e,o){return ce(e.coordsAtPos(o))}const Ke=360,gn=250,Ct=44,ze=.5,Xe=[.5,.9,1],hn=[1,.75,.2],vn=({onClose:e,onSubmit:o,opensOverDocument:t=!1,opensFromGutter:n=!1,gutterHasComments:r=!1},s)=>{const a=Me(),i=g.useRef(null),u=g.useRef(!1),[l,f]=g.useState(""),[m,p]=g.useState(!0),h=()=>{f(""),e?.(u.current)},v=(T=l)=>{u.current=!0,o?.(T),f("")},x=eo(({windowWidth:T})=>t?T<Ke+100?gn:Ke:ae,0),C={};n&&(C.top=-12),t&&n?C.right=0:C.left=0;let E="";n&&!t?E="8px 50%":n&&t?E="calc(100% + 8px) 50%":t&&(E="center left");let b=0;n&&!t&&r&&(b=ct);const A=T=>{const{metaKey:S,shiftKey:P,key:O}=T;O==="Enter"&&l&&!(P||S)?(v(),T.preventDefault()):O==="Escape"&&(f(""),e?.(!1))},_=a.formatMessage({id:"VvfbvY",defaultMessage:"Edit or explain..."});return c.jsx(k.div,{ref:Yo(i,s),className:M("absolute flex items-center",B.commentComposer),style:{...C,minHeight:Ct},transition:{type:"spring",bounce:.18,duration:.48},initial:{translateX:0},animate:{translateX:b},exit:{translateX:0},children:c.jsx(k.div,{className:M("no-scrollbar relative z-10 flex items-center overflow-x-hidden border border-token-border-light",it,{"rounded-full":m,"rounded-2xl":!m}),initial:{width:t?ae:24,scaleX:t?ze:void 0,scale:t?void 0:ze},animate:{width:x,scaleX:t?Xe:void 0,scale:t?void 0:Xe},exit:{filter:"blur(16px)",scale:t?void 0:hn,width:t?ae:24,opacity:t?0:[1,1,0]},transition:{type:"spring",bounce:t?.14:0,duration:.28,scale:{type:"tween",duration:.2},opacity:{type:"tween",time:[0,.95,1]}},style:{transformOrigin:E},children:c.jsxs(k.div,{className:"relative z-0 flex w-full items-center bg-token-main-surface-primary px-4 py-2.5",children:[c.jsx(k.div,{className:"backdrop-saturate-25 absolute inset-0 z-[-1] bg-gray-50/75 backdrop-blur-3xl dark:bg-gray-700/75",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.2}}),c.jsx(Fo,{"aria-placeholder":_,value:l,className:"w-full resize-none border-0 bg-transparent px-1 py-0 pr-2 text-token-text-primary outline-0 placeholder:text-token-text-secondary focus:ring-0 focus-visible:ring-0",autoFocus:!0,maxRows:4,onBlur:h,onHeightChange:(T,{rowHeight:S})=>{p(Math.floor(T/S)<=1)},onChange:({target:{value:T}})=>f(T),onKeyDown:A}),!l&&c.jsx("span",{"aria-hidden":!0,className:"absolute inline-block text-nowrap pl-1 text-token-text-secondary",children:_}),c.jsx(k.button,{className:M("-mr-1.5 h-6 w-6 rounded-full bg-black text-center dark:bg-white",{"self-end":!m}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:()=>v(),children:c.jsx(Mo,{className:"h-6 w-6 text-white dark:text-black"})})]})})})},xt=g.forwardRef(vn),Cn=(e,o)=>{if(o?.type!==$.SELECTION)return null;try{const{from:t,to:n}=o,{top:r}=e.dom.getBoundingClientRect(),{bottom:s,top:a}=ee(e,t),{bottom:i}=ee(e,n),u=pe(e)?-30:-24;let l=s-r+u;const f=a-r;return l=i-r+8,{composerTop:l,loadingTop:f}}catch(t){return j.logError("Invalid position in SelectionCommentComposer",t),null}},xn=({toolbarPosition:e,composerRect:o,view:t})=>{let{width:n,height:r}=o;if(r||=Ct,t==null||e==null)return null;const{right:s,left:a}=t.dom.getBoundingClientRect(),{left:i,top:u,aboveOrBelow:l,toolbarSize:f}=e,m=u-(l===vt.ABOVE&&r!==0?r-f.height:0),p=yo(t)?12:0;return{left:Math.min(i,s-a-n-p),composerTop:m,aboveOrBelow:l}},En=({toolbarPosition:e,commentingOn:o,isWaitingForCommentResponse:t=!1,onAddComment:n})=>{const r=te()(),[s,a]=me(),i=xn({view:r,toolbarPosition:e,composerRect:s});if(r==null||i==null)return null;const{left:u,composerTop:l}=i,f=m=>{if(o?.type!==$.SELECTION)return;const{action:p,sourceRange:h}=o;n?.(m,p,h,o.type)};return c.jsx(X,{children:o?.type===$.SELECTION&&!t&&c.jsx("div",{className:M("absolute",B.commentComposer),style:{left:u,top:l},children:c.jsx(xt,{opensOverDocument:!0,onClose:m=>{m||(L.cancelCommentingOn(),r&&pe(r)&&!r.state.selection.empty&&r.dispatch(r.state.tr.setSelection(new ko(r.state.selection.$from))),document.getSelection()?.removeAllRanges())},onSubmit:f,ref:a})},"composer")})};function Et(e,o){return o?e.getState(o)??null:null}function bn(e){return e.nodeSize-2}function _n(e,o){return o>=0&&o<=bn(e)}class U{constructor(o,t,n={}){this.match=o,this.match=o,this.handler=typeof t=="string"?yn(t):t,this.undoable=n.undoable!==!1,this.inCode=n.inCode||!1}}function yn(e){return function(o,t,n,r){let s=e;if(t[1]){let a=t[0].lastIndexOf(t[1]);s+=t[0].slice(a+t[1].length),n+=a;let i=n-r;i>0&&(s=t[0].slice(a-i,a)+s,n=r)}return o.tr.insertText(s,n,r)}}const Nn=500;function _s({rules:e}){let o=new ft({state:{init(){return null},apply(t,n){let r=t.getMeta(this);return r||(t.selectionSet||t.docChanged?null:n)}},props:{handleTextInput(t,n,r,s){return We(t,n,r,s,e,o)},handleDOMEvents:{compositionend:t=>{setTimeout(()=>{let{$cursor:n}=t.state.selection;n&&We(t,n.pos,n.pos,"",e,o)})}}},isInputRules:!0});return o}function We(e,o,t,n,r,s){if(e.composing)return!1;let a=e.state,i=a.doc.resolve(o),u=i.parent.textBetween(Math.max(0,i.parentOffset-Nn),i.parentOffset,null,"￼")+n;for(let l=0;l<r.length;l++){let f=r[l];if(i.parent.type.spec.code){if(!f.inCode)continue}else if(f.inCode==="only")continue;let m=f.match.exec(u),p=m&&f.handler(a,m,o-(m[0].length-n.length),t);if(p)return f.undoable&&p.setMeta(s,{transform:p,from:o,to:t,text:n}),e.dispatch(p),!0}return!1}new U(/--$/,"—");new U(/\.\.\.$/,"…");new U(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"“");new U(/"$/,"”");new U(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"‘");new U(/'$/,"’");function ys(e,o,t=null,n){return new U(e,(r,s,a,i)=>{let u=t instanceof Function?t(s):t,l=r.tr.delete(a,i),f=l.doc.resolve(a),m=f.blockRange(),p=m&&jo(m,o,u);if(!p)return null;l.wrap(m,p);let h=l.doc.resolve(a-1).nodeBefore;return h&&h.type==o&&Do(l.doc,a-1)&&(!n||n(s,h))&&l.join(a-1),l})}function Tn(e,o,t=null){return new U(e,(n,r,s,a)=>{let i=n.doc.resolve(s),u=t instanceof Function?t(r):t;return i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),o)?n.tr.delete(s,a).setBlockType(s,s,o,u):null})}function Re(e,o,t,n={}){if(e==null)return null;const r=(Array.isArray(t)?t:[t]).filter(ro),s=o.nodes[e].createAndFill(n,r);return s??null}const Sn={content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM(){return["p",0]}},Pn="paragraph";class bt extends ge{unistNodeName(){return Pn}static proseMirrorNodeName(){return"paragraph"}proseMirrorNodeSpec(){return Sn}unistNodeToProseMirrorNodes({schema:o,convertedChildren:t,attrs:n}){return Re(this.proseMirrorNodeName(),o,t,n)}proseMirrorNodeToUnistNodes(o,t){return[{type:this.unistNodeName(),children:t}]}}const An=(e,o,t,n)=>e.value?o.text(e.value,[o.marks.startend.create(t),...n??[]]):null;class In extends ge{unistNodeName(){return"text"}static proseMirrorNodeName(){return"text"}proseMirrorNodeSpec(){return{group:"inline"}}unistNodeToProseMirrorNodes({node:o,schema:t,attrs:n}){return An(o,t,n)}proseMirrorNodeToUnistNodes(o){return[{type:this.unistNodeName(),value:o.text??""}]}}class q extends ge{static isAtStart(o,t){return o.selection.empty?t!==void 0?t.endOfTextblock("backward",o):o.selection.$anchor.parentOffset>0:!1}static headingLevelCommandBuilder(o,t,n){return(r,s,a)=>{if(n&&!q.isAtStart(r,a))return!1;const{$anchor:i}=r.selection,u=i.parent;if(u.type.name!=="heading")return!1;const l=u.attrs.level+t;if(l<0||l>6)return!1;if(s===void 0)return!0;const f=i.before(i.depth);return l>0?s(r.tr.setNodeMarkup(f,void 0,{level:l})):s(r.tr.setNodeMarkup(f,o.nodes.paragraph)),!0}}dependencies(){return[new bt,new In]}unistNodeName(){return"heading"}static proseMirrorNodeName(){return"heading"}proseMirrorNodeSpec(){return{attrs:{level:{default:1}},content:"text*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM(o){return["h"+o.attrs.level.toString(),0]}}}proseMirrorInputRules(o){return[Tn(/^\s{0,3}(#{1,6})\s$/,o.nodes[this.proseMirrorNodeName()],t=>({level:t[1].length}))]}proseMirrorKeymap(o){const t={Tab:q.headingLevelCommandBuilder(o,1,!1),"#":q.headingLevelCommandBuilder(o,1,!0),"Shift-Tab":q.headingLevelCommandBuilder(o,-1,!1)};for(let n=1;n<=6;n++)t[`Shift-Mod-${n.toString()}`]=Lo(o.nodes[this.proseMirrorNodeName()],{level:n});return t}unistNodeToProseMirrorNodes({node:o,schema:t,convertedChildren:n,attrs:r}){const{depth:s}=o;return Re(this.proseMirrorNodeName(),t,n,{...r,level:s})}proseMirrorNodeToUnistNodes(o,t){return[{type:this.unistNodeName(),depth:o.attrs.level,children:t}]}}class On extends ge{unistNodeName(){return"root"}static proseMirrorNodeName(){return"doc"}proseMirrorNodeSpec(){return{content:"block+"}}unistNodeToProseMirrorNodes({schema:o,convertedChildren:t,attrs:n}){return Re(this.proseMirrorNodeName(),o,t,n)}proseMirrorNodeToUnistNodes(o,t){return[{type:this.unistNodeName(),children:t}]}}function Pe(e,o,t=0,n=null){let r=!1;return e.forEach((s,a)=>{Pe(s,o,t+a+(e.type.name===On.proseMirrorNodeName()?0:1),e)===!1&&(r=!0)}),r?r?!1:void 0:o(e,t,n)}function Mn(e,o){const t=new Array(o.length).fill(-1),n=()=>!t.includes(-1);let r=!1;const s=(a,i)=>{const u=No(a);if(u==null)return;const{start:l,end:f}=u;for(let m=0;m<o.length;m++){const p=o[m];t[m]===-1&&(p>=l&&p<f&&(a.type.name!=="doc"||r)||p==f&&r||p<l&&p<f&&r&&p>=0)&&(p===f&&(t[m]=i+a.nodeSize),a.content.size===0&&(a.text?.length??0)===0?t[m]=i:t[m]=Math.min(i+Math.max(p-l,0),i+a.nodeSize))}if(n())return!1};Pe(e,s),r=!0,n()||Pe(e,s);for(let a=0;a<t.length;a++)t[a]===-1&&(o[a]<=0?t[a]=0:t[a]=e.nodeSize-2);return t}function wn(e,o){const t=kn(e);if(t.length===0)return o;let n=o;return t.forEach(r=>{n=Rn(r,n)}),n}function Rn(e,o){return To(o,{start:e.from,end:e.to},Ln(e))}function Ln(e){return e.slice.size-(e.to-e.from)}function kn(e){return e.steps.filter(o=>o instanceof Bo)}const ue=new Go("comments");function qe(e,o){const t=o.map(s=>s.at.start),n=o.map(s=>s.at.end),r=Mn(e,[...t,...n]);return new Map(o.map((s,a)=>[s.id,{start:r[a],end:r[a+o.length]}]))}function jn(e,o){const{type:t}=o;if(t===$.SELECTION){const{from:s,to:a}=o;return[s,a]}const{pos:n}=o,r=n+(e.nodeAt(n)?.nodeSize??0);return[n,r]}const Je=(e,o,t=null,n=null)=>{const r=[],s=Array.from(o.entries()).reverse(),a=new Map(e.map(i=>[i.id,i]));for(const[i,u]of s){const l=a.get(i),p=Po({isHovered:t===i,isFocused:n===i,isCode:!1,diffStatus:l?.diffStatus});r.push(mt.inline(u.start,u.end,{class:p,"data-comment-id":i,nodeName:"span"}))}return r},Ns=e=>new ft({key:ue,state:{init:(o,{doc:t})=>{const n=qe(t,e);return{comments:e,commentingOn:null,hoveredOnBlock:null,hoveredCommentId:null,focusedCommentId:null,decorations:Je(e,n),positions:n}},apply:(o,t)=>{const n=o.getMeta(ue)??{},r=n.comments,s=r??t.comments,a=r!=null?qe(o.doc,s):t.positions;let i=n.commentingOn;i===void 0&&(i=t.commentingOn);let u=n.hoveredCommentId;u===void 0&&(u=t.hoveredCommentId);let l=n.focusedCommentId;l===void 0&&(l=t.focusedCommentId);const f=wn(o,a),m=So(s,f);return{comments:m,commentingOn:i,hoveredCommentId:u,focusedCommentId:l,decorations:Je(m,f,u,l),positions:f}}},props:{handleClickOn:(o,t,n,r,s)=>{const{target:a}=s;if(a instanceof HTMLElement){const{commentId:i}=a.dataset;if(!i)return;L.focusComment(i)}},handleDOMEvents:{mouseover(o,t){const{target:n}=t;if(n instanceof HTMLElement){const{commentId:r}=n.dataset;r?L.mouseEnterComment(r):L.mouseLeaveComment()}}},decorations(o){const t=this.getState(o);if(!t)return $e.empty;const{commentingOn:n,decorations:r}=t,{doc:s}=o;if(n){const[a,i]=jn(s,n);a!=null&&i!=null&&r.push(mt.inline(a,i,{class:so.document},{comment:{pattern:n}}))}return $e.create(s,r.concat())}}});function Dn(e,o,t){const n=e+o;for(const r of t.values()){const s=r.start,a=r.end;if(e<a&&s<n)return!0}return!1}const Bn=50,Gn=200,Vn=[bt.proseMirrorNodeName(),q.proseMirrorNodeName()],Fn=e=>e?e.isBlock:!1,Hn=e=>{if(!e)return!1;const{isBlock:o,type:{name:t}}=e;return o&&Vn.includes(t)},Yn=(e,o,t,n)=>{const r=e.posAtCoords({left:o,top:t});if(r==null)return;const{pos:s,inside:a}=r;if(a===-1)return;const{state:i}=e;let u=s,l=i.doc.nodeAt(u);for(;!Fn(l)&&u>=0;)u--,l=i.doc.nodeAt(u);if(!l||!Hn(l))return;const f=n!=null&&Dn(u,l.nodeSize,n);return{node:l,nodeHasComment:f,pos:u}};function $n(e,o,t){const n=Yn(e,o.x,o.y,t);if(n==null)return null;const{node:r,pos:s,nodeHasComment:a}=n,{top:i}=e.coordsAtPos(0);function u(){const h=s+1;return _n(e.state.doc,h)&&e.state.doc.nodeAt(h)?.isText?e.coordsAtPos(h).top:e.coordsAtPos(s).top}const l=u(),f=l-i;return{height:e.coordsAtPos(s+r.nodeSize-1).bottom-l,nodeHasComment:a,mouseEnteredAt:Date.now(),yOffset:f,pos:s}}function Un(e){const o=g.useRef(!1),t=g.useRef(!1),[n,r]=g.useState(null),s=Ao(),a=s()?.dom,i=g.useRef(!1),u=V(({visibleBlockCommentLauncher_DEBUG_ONLY:m})=>m),l=g.useCallback(lt(m=>{o.current=!0;const{commentingOn:p}=V.getState();if(t.current||p!=null)return;const h=s();if(h==null||!o.current)return r(null);const{dom:v,state:x}=h,C=Et(ue,x)?.positions;if(C==null)return r(null);const E=$n(h,m,C);if(E==null||E.nodeHasComment&&e===D.COLLAPSED){r(null);return}if(i.current&&E.yOffset!==n?.yOffset){r(null);return}const b=h.coordsAtPos(0),A=v.getBoundingClientRect().width,T=(m.x-b.left)/A>=Bn/100;r(T?E:null)},Gn),[s,i,n]);g.useEffect(()=>{if(a!=null)return rt(a,{mouseenter:()=>{o.current=!0,t.current=!1},mouseleave:({relatedTarget:m})=>{if(l.cancel(),m instanceof HTMLElement&&m.closest("[data-block-comment-launcher]")){t.current=!0;return}t.current=!1,o.current=!1,V.getState().commentingOn==null&&r(null)},mousemove:l})},[s,a,e,l]);const f=g.useCallback(({relatedTarget:m})=>{const{commentingOn:p}=V.getState();p==null&&m!==a&&(t.current=!1,r(null))},[a]);return{visibleBlockComment:u??n,handleMouseLeave:f,onComposerVisibleChange:m=>{i.current=m}}}const Kn=({isWaitingForCommentResponse:e=!1,opensOverDocument:o=!1,hasComments:t=!1,activeBlockComment:n,composerRef:r,onLaunchComposer:s,onMouseLeave:a,onSubmit:i})=>{const[u,l]=g.useState(!1),{yOffset:f,height:m,pos:p}=n,h=()=>{l(!0),s?.(),j.logButtonClick(W.BLOCK_COMMENT_LAUNCHER),L.startCommentingOn({type:$.BLOCK,pos:p})},v=E=>{E||(l(!1),L.cancelCommentingOn())},x=E=>{l(!1),i?.(E)};g.useEffect(()=>()=>{L.mouseLeaveBlock()},[]);const C=t&&u?o?-88:88:0;return c.jsx(k.div,{className:M("pointer-events-auto absolute flex h-6 w-5 origin-[14px_50%] items-start after:absolute after:-inset-4 after:content-['']",B.commentComposer),initial:!1,animate:{opacity:1},exit:{opacity:0},transition:{type:"spring",duration:.2,bounce:.1},style:{top:0,height:m,translateY:f},onMouseLeave:a,"data-block-comment-launcher":!0,children:c.jsxs(X,{children:[u?c.jsx(xt,{ref:r,opensFromGutter:!0,onClose:v,onSubmit:x,gutterHasComments:t,opensOverDocument:o},"composer"):null,c.jsx(k.button,{initial:{opacity:0},animate:{opacity:u?0:1,translateX:C},transition:{duration:.15,translateX:{type:"spring",bounce:.18,duration:.48}},className:"group absolute z-10 flex h-6 gap-1 bg-transparent after:absolute after:-inset-y-4 after:-left-1 after:-right-4 after:content-['']",onClick:h,onMouseEnter:()=>L.mouseEnterBlock(p),onMouseLeave:()=>L.mouseLeaveBlock(),disabled:u||e,children:c.jsx(mn,{isLoading:e})},"launcer")]})})},zn=({isWaitingForCommentResponse:e=!1,isRequestActive:o=!1,hasComments:t=!1,composerRef:n,gutterMode:r,onAddComment:s})=>{const a=ut(),{visibleBlockComment:i,handleMouseLeave:u,onComposerVisibleChange:l}=Un(r),f=m=>{if(!i||!a)return;const{doc:p}=a,{pos:h}=i,v=p.nodeAt(h);if(!v)return;const{attrs:{start:x,end:C}}=v;s?.(m,dt.ASK,{start:x,end:C},$.BLOCK)};return c.jsx(X,{onExitComplete:()=>l(!1),children:i&&a&&(e||!o)&&c.jsx(Kn,{composerRef:n,isWaitingForCommentResponse:e,opensOverDocument:r===D.COLLAPSED,activeBlockComment:i,hasComments:t,onSubmit:f,onMouseLeave:u,onLaunchComposer:()=>l(!0)},"launcher")})},_t={type:"spring",bounce:.12,duration:.5},yt="opacity-50",Xn=({count:e,offsetY:o,isLoading:t=!1,onClick:n})=>c.jsx(k.div,{className:M("absolute",B.collapsedComment),initial:{opacity:0},animate:{opacity:1},style:{translateY:o},transition:_t,exit:{opacity:0},children:c.jsx(fn,{count:e,isLoading:t,onClick:n})}),Wn=({isFocused:e,isHovered:o})=>{const t=e||o?"grow font-medium text-token-text-primary transition-colors":"grow font-medium text-token-text-secondary transition-colors",n=e||o?"opacity-100 transition":"opacity-75 transition";return c.jsxs(c.Fragment,{children:[c.jsx("div",{className:n,children:c.jsx("div",{className:"gizmo-bot-avatar rounded-full",children:c.jsx(ao,{size:"gizmoConversation",iconName:"openai"})})}),c.jsx("span",{className:t,children:"ChatGPT"})]})},qn=({comment:e,isFocused:o,isSomeCommentFocused:t,isHovered:n})=>{const r=e.diffStatus===Ne.REMOVED;return c.jsx("div",{className:M("mt-2 text-token-text-primary transition-all",{"opacity-80":!o&&!t&&!n&&!r,"opacity-40":!o&&t&&!n&&!r,[yt]:r}),children:e.content})},Jn=({left:e,right:o,comment:t,disableAnimations:n=!1,onClick:r,onMouseEnter:s,onMouseLeave:a,onAccept:i,onDismiss:u,translateY:l,isFocused:f=!1,isSomeCommentFocused:m=!1,disableActions:p=!1,isHovered:h=!1},v)=>{const[x,C]=g.useState(!1),E=t.diffStatus===Ne.ADDED,b=t.diffStatus===Ne.REMOVED,A=t.diffStatus!=null,_=()=>{C(!0),s?.()},T=()=>{C(!1),a?.()},S=Me(),P=f||x&&!m;return c.jsx(k.div,{ref:v,className:M("absolute",B.expandedComment,{"cursor-default":f,"cursor-pointer":!f,[B.expandedCommentFocused]:f,[B.expandedCommentHovered]:h}),style:{left:e,right:o},initial:n?!1:{translateY:l,scale:.85,opacity:0},animate:n?void 0:{translateY:l,scale:f?1:.97,opacity:1},exit:n?void 0:{scale:.85,opacity:0,filter:"blur(16px)"},transition:_t,onClick:r,onMouseEnter:p?void 0:_,onMouseLeave:p?void 0:T,"data-comment-id":t.id,children:c.jsxs("div",{className:M("flex min-h-8 flex-col overflow-hidden rounded-2xl border p-4 pt-2 text-left text-sm transition-all",{"border-transparent bg-gray-50 dark:bg-gray-800":!f&&!h,"border-token-border-light bg-token-main-surface-primary":h&&!f,"border-token-border-light bg-token-main-surface-primary shadow-xl":f||x&&!m,"relative after:absolute after:bottom-0 after:left-0 after:top-0 after:w-1":A,"after:bg-green-500":E,"after:bg-red-500":b}),style:{width:ae},children:[c.jsxs("div",{className:M("flex h-8 flex-row items-center gap-2.5",{[yt]:b}),children:[c.jsx(Wn,{isFocused:f,isHovered:h}),c.jsx("button",{className:M("-mr-1 rounded-full bg-transparent p-1 text-token-text-secondary",{"cursor-pointer hover:bg-gray-100 hover:text-token-text-primary dark:hover:bg-gray-700":!p,"cursor-not-allowed":p}),onClick:u,disabled:p,"aria-label":S.formatMessage({id:"fYDa3C",defaultMessage:"Dismiss comment"}),children:c.jsx(wo,{className:"icon-sm"})})]}),c.jsx(qn,{comment:t,isFocused:f,isHovered:h,isSomeCommentFocused:m}),c.jsx(X,{initial:!1,children:P&&c.jsx(k.div,{initial:n?!1:{opacity:0,height:0},animate:{opacity:1,height:"auto",transition:{opacity:{delay:.14,duration:.2},height:{bounce:0,duration:.2}}},exit:n?void 0:{opacity:0,height:0,transition:{opacity:{duration:.08},height:{bounce:0,duration:.2}}},className:"flex items-center justify-start",children:c.jsx("div",{className:"mt-2.5",children:c.jsx(to,{color:"secondary",onClick:i,disabled:p,children:S.formatMessage({id:"WIW5OL",defaultMessage:"Apply"})})})})})]})})},Nt=g.forwardRef(Jn),Zn=({offsetY:e,opensOverDocument:o=!1,disableActions:t=!1,isFocused:n=!1,isSomeCommentFocused:r=!1,onAccept:s,onClick:a,onDismiss:i,onMouseEnter:u,onMouseLeave:l,comment:f,isHovered:m=!1})=>{const p=g.useRef(null);return g.useEffect(()=>rt(document,{mousedown:({target:h})=>{h instanceof HTMLElement&&!h.closest("[data-comment-id]")&&!p.current?.contains(h)&&L.blurComment()}})),c.jsx(Nt,{ref:p,comment:f,disableActions:t,onAccept:s,onDismiss:i,onMouseEnter:u,onMouseLeave:l,isSomeCommentFocused:r,isHovered:m,onClick:a,translateY:e,isFocused:n,left:o?void 0:ct,right:o?io:void 0})},Qn=({onAcceptComment:e,onDismissComment:o,disableActions:t=!1,entry:n,isGutterCollapsed:r=!1,isHovered:s=!1,isFocused:a=!1,isSomeCommentFocused:i=!1})=>{const{offsetY:u,type:l}=n,[f,m]=co();let p=null;if(l===R.COLLAPSED)p=!a&&c.jsx(Xn,{offsetY:u,count:n.count,onClick:()=>{j.logButtonClick(W.COLLAPSED_COMMENT),L.focusComment(n.children[0])}},"collapsed");else{const{comment:h}=n;if(h==null||h.content===""||h.status===Fe.DISMISSED)p=null;else if(h.status===Fe.ACCEPT_INITIATED)p=c.jsx("div",{className:"absolute",style:{top:u},children:c.jsx(he,{})},"loading");else{const{id:v}=h;p=c.jsx(Zn,{isSomeCommentFocused:i,isHovered:s,isFocused:a,offsetY:u,disableActions:t,onClick:()=>{j.logButtonClick(W.EXPANDED_COMMENT),L.focusComment(v)},onMouseEnter:()=>L.mouseEnterComment(v),onMouseLeave:()=>L.mouseLeaveComment(),comment:h,onAccept:()=>{j.logButtonClick(W.COMMENT_ACCEPT,{commentId:v}),e?.(v)},onDismiss:()=>{j.logButtonClick(W.COMMENT_DISMISS,{commentId:v}),o?.(v)},opensOverDocument:r},"expanded")}}return c.jsx(X,{onExitComplete:()=>m?.(),children:f&&p})},Ze=({onMeasureHeight:e,comment:o,isFocused:t=!1})=>{const[{height:n},r]=me();return st(()=>{e?.(n)},[n]),c.jsx(Nt,{ref:r,comment:o,isFocused:t,disableAnimations:!0})},er=({comments:e,onMeasure:o,getStableCommentId:t})=>{const n=g.useRef(new Map),r=g.useRef(new Map),s=g.useRef(null),a=(i,u,l=!1)=>{u&&(l?r.current.set(t(i),u):n.current.set(t(i),u),s.current&&cancelAnimationFrame(s.current),s.current=requestAnimationFrame(()=>{o?.({focusedHeights:new Map(r.current),heights:new Map(n.current)}),s.current=null}))};return e?.length?c.jsxs("div",{className:"pointer-events-none invisible fixed left-0 top-0 overflow-clip","aria-hidden":"true",children:[e.map(i=>c.jsx(Ze,{comment:i,onMeasureHeight:u=>a(i.id,u)},t(i.id))),e.map(i=>c.jsx(Ze,{isFocused:!0,comment:i,onMeasureHeight:u=>a(i.id,u,!0)},`${t(i.id)}-focused`))]}):null},Qe=(e,o,t)=>{let n=t+o;for(;o===H.down?n<e.length:n>-1;){const r=e[n],s=e[n-o],a=pn(J(r),J(s),o);if(a!=null&&r.type!==R.COLLAPSED)r.shiftY+=a;else break;n+=o}},et=(e,o)=>{for(const t of o){const{index:n,amount:r}=t,s=e[n];s.type===R.EXPANDED&&(s.shiftY+=r),Qe(e,H.down,n),Qe(e,H.up,n);for(const a of e)a.type!==R.COLLAPSED&&(a.offsetY+=a.shiftY,a.shiftY=0)}},tr=(e,o)=>{const t=[],[n,r]=o,s=n+r;for(let a=0;a<e.length;a++){const i=e[a],[u]=J(i),l=[u,i.type===R.EXPANDED?i.height:0],[f,m]=l;if(ht(l,o)){const p=f+m,h=n-p,v=s-f,C=(Math.abs(h)<Math.abs(v)?H.up:H.down)===H.up?h:v;t.push({index:a,amount:C})}}return t},or=({gutterMode:e,focusedCommentId:o,gutterPositions:t,getCommentKey:n,getComment:r})=>{if(!t?.size)return[];const s=new Map,a=[];let i=null,u=-1;for(const f of t.values()){if(f.type===le.COMPOSER){i=[f.offsetY,f.height];continue}const{commentId:m,height:p,collapsedOffsetY:h,offsetY:v}=f;if(e===D.EXPANDED){const E=Te(a),b=E?Se(J(E)):0;let A=v;E&&A<=b&&(A=b),s.set(m,{originalOffsetY:v,offsetY:A}),o===m&&(u=a.length),a.push({key:n(m),comment:r(m),type:R.EXPANDED,height:p,offsetY:A,shiftY:0});continue}let x=a.findIndex(({offsetY:E,type:b})=>b===R.COLLAPSED&&E===h),C=a[x]??null;if(!C)C={key:a.length,type:R.COLLAPSED,offsetY:v,count:1,children:[m]},x=a.length,a.push(C);else{if(C.type!==R.COLLAPSED)throw new Error("Collapsed parent type expected to be collapsed");C.count+=1,C.children.push(m),C.offsetY=h}o===m&&(u=x)}const l=a[u];if(e===D.COLLAPSED&&l?.type===R.COLLAPSED){const f=[];for(let m=0;m<l.children.length;m++){const p=l.children[m];p===o&&(u+=m+1);const h=Te(f),v=h?Se(J(h)):0,x=t.get(p)?.offsetY??0,C=Math.max(v,x);s.set(p,{originalOffsetY:x,offsetY:C}),f.push({type:R.EXPANDED,key:n(p),comment:r(p),offsetY:C,height:t.get(p)?.height??0,shiftY:0})}a.splice(u,0,...f)}if(o){const f=s.get(o);if(!f)return a;const{offsetY:m,originalOffsetY:p}=f,h=p-m,v=[{amount:h,index:u}];let x=u+1;for(;x<a.length;){const C=a[x],{type:E}=C;let b=h;if(E===R.EXPANDED&&C.comment?.id){const{offsetY:A,originalOffsetY:_}=ce(s.get(C.comment.id));if(A===_)break;b=Math.max(_-A,h)}else break;v.push({amount:b,index:x}),x++}v.length&&et(a,v)}else if(e!==D.COLLAPSED&&i){const f=tr(a,i);et(a,f)}return a},nr=e=>{try{return or(e)}catch(o){return j.logError("Generating comment gutter entries",o),[]}},rr=e=>"length"in e?e.length===0:e.nodeSize===0,_e=12,sr=({composerHeight:e,getCommentHeight:o,getCollapsedStartPos:t,commentingOn:n,commentPositions:r,view:s})=>{if(!r||!s||rr(s.state.doc))return null;const{top:a}=s.dom.getBoundingClientRect(),i=Array.from(r.entries()).sort(([l,f],[m,p])=>f.start-p.start),u=new Map;for(const[l,{start:f}]of i)try{const m=t?.(f)??f,{top:p}=ee(s,m),{top:h}=ee(s,f),v=h-a,x=p-a,C=(o(l)??0)+_e;u.set(l,{commentId:l,height:C,collapsedOffsetY:x,offsetY:v,type:le.COMMENT})}catch{continue}if(n?.type===$.BLOCK){const{pos:l}=n;try{const{top:f}=ee(s,l),p=f-a-_e;u.set("block-composer",{type:le.COMPOSER,height:(e??0)+_e,offsetY:p})}catch{}}return u},Tt=(e,o)=>o.nodeAt(e)?.isBlock?e+1:Tt(e-1,o);function ar(e){const o=ut(),n=te()?.();if(!n)return null;if(pe(n)){if(!o)return null;const r=Et(ue,o);return r?r.positions:null}return new Map(e.map(r=>[r.id,r.at]))}const ir=({gutterMode:e,focusedCommentId:o,commentingOn:t,comments:n,getStableId:r})=>{const[{height:s},a]=me(),i=te(),[u,l]=g.useState(()=>new Map),[f,m]=g.useState(()=>new Map),p=g.useCallback(({focusedHeights:_,heights:T})=>{l(_),m(T)},[]),h=_=>{const T=r(_);return _===o?u.get(T)??0:f.get(T)??0},v=i(),x=v!=null&&pe(v)?_=>Tt(_,v.state.doc):void 0,C=new Map(n?.map(_=>[r(_.id),_])),E=ar(n),b=sr({composerHeight:s,commentingOn:t,getCommentHeight:h,getCollapsedStartPos:x,commentPositions:E,view:v}),A=nr({gutterMode:e,gutterPositions:b,focusedCommentId:o,getComment:_=>C.get(r(_))??null,getCommentKey:r});return{blockComposerRef:a,onMeasureComments:p,gutterEntries:A}};function cr(){const o=te()(),t=V(({commentingOn:s})=>s),r=o==null?null:Cn(o,t);return r==null?null:c.jsx(k.div,{className:"absolute",style:{top:r.loadingTop},initial:!1,animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},transition:{delay:.2},children:c.jsx(he,{})},"selection-loading")}const lr=e=>c.jsx("div",{className:"absolute",style:{top:Se(J(e))},children:c.jsx("div",{className:"h-[max(3rem,18vh)] w-1"})}),Ts=({availableWidth:e,comments:o,commentsMode:t,disableBlockComments:n=!1,isRequestActive:r=!1,isWaitingForCommentResponse:s=!1,onAddComment:a,onAcceptComment:i,onDismissComment:u,getStableCommentId:l})=>{const f=V(({focusedCommentId:P})=>P),m=V(({hoveredCommentId:P})=>P),p=V(({commentingOn:P})=>P),h=e<He?D.COLLAPSED:D.EXPANDED,{onMeasureComments:v,blockComposerRef:x,gutterEntries:C}=ir({comments:o,getStableId:l,gutterMode:h,focusedCommentId:f,commentingOn:p}),E=C.length>0,b=p!=null&&!s&&p.type!=="selection"||E,_=(()=>{if(!b)return 0;switch(h){case D.COLLAPSED:return 0;case D.EXPANDED:return He}})(),T=p?.type==="selection",S=Te(C);return c.jsxs(k.div,{className:M("pointer-events-none relative flex h-full flex-shrink-0",B.commentGutter,h===D.COLLAPSED&&_?"basis-[32px]":"basis-0"),initial:{width:0,opacity:0},animate:{width:_,opacity:1},exit:{width:0,opacity:0},children:[c.jsx(er,{getStableCommentId:l,comments:o,onMeasure:v}),c.jsxs("div",{className:M("pointer-events-auto absolute bottom-0 left-0 top-0 w-0 overflow-visible",{"pl-2":b||!n}),children:[c.jsx(X,{children:C.map(P=>{const{key:O,type:ne}=P,re=!!f&&ne===R.EXPANDED&&P.comment?.id===f,Q=!!f&&P.type===R.COLLAPSED&&P.children.includes(f);return c.jsx(Qn,{isGutterCollapsed:h===D.COLLAPSED,isSomeCommentFocused:!!p||!!f,isHovered:ne===R.EXPANDED&&P.comment?.id===m,isFocused:re||Q,entry:P,disableActions:r||s||t===Ye.COMMENTS_READONLY,onAcceptComment:K=>{try{i?.(ce(o?.find(G=>G.id===K)))}catch(G){j.logError(`Comment ${K} not found`,G)}},onDismissComment:K=>{try{u?.(ce(o?.find(G=>G.id===K)))}catch(G){j.logError(`Comment ${K} not found`,G)}}},O)})}),E&&S&&c.jsx(lr,{...S}),t===Ye.ENABLED&&!T&&!n&&c.jsx(zn,{composerRef:x,gutterMode:h,onAddComment:a,isWaitingForCommentResponse:s,isRequestActive:r,hasComments:E}),s&&T&&c.jsx(cr,{})]})]})};function Y(e,o,{checkForDefaultPrevented:t=!0}={}){return function(r){if(e?.(r),t===!1||!r.defaultPrevented)return o?.(r)}}function ve(e,o=[]){let t=[];function n(s,a){const i=g.createContext(a),u=t.length;t=[...t,a];function l(m){const{scope:p,children:h,...v}=m,x=p?.[e][u]||i,C=g.useMemo(()=>v,Object.values(v));return c.jsx(x.Provider,{value:C,children:h})}function f(m,p){const h=p?.[e][u]||i,v=g.useContext(h);if(v)return v;if(a!==void 0)return a;throw new Error(`\`${m}\` must be used within \`${s}\``)}return l.displayName=s+"Provider",[l,f]}const r=()=>{const s=t.map(a=>g.createContext(a));return function(i){const u=i?.[e]||s;return g.useMemo(()=>({[`__scope${e}`]:{...i,[e]:u}}),[i,u])}};return r.scopeName=e,[n,ur(r,...o)]}function ur(...e){const o=e[0];if(e.length===1)return o;const t=()=>{const n=e.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(s){const a=n.reduce((i,{useScope:u,scopeName:l})=>{const m=u(s)[`__scope${l}`];return{...i,...m}},{});return g.useMemo(()=>({[`__scope${o.scopeName}`]:a}),[a])}};return t.scopeName=o.scopeName,t}function dr(e,o){typeof e=="function"?e(o):e!=null&&(e.current=o)}function St(...e){return o=>e.forEach(t=>dr(t,o))}function Ae(...e){return g.useCallback(St(...e),e)}var de=g.forwardRef((e,o)=>{const{children:t,...n}=e,r=g.Children.toArray(t),s=r.find(mr);if(s){const a=s.props.children,i=r.map(u=>u===s?g.Children.count(a)>1?g.Children.only(null):g.isValidElement(a)?a.props.children:null:u);return c.jsx(Ie,{...n,ref:o,children:g.isValidElement(a)?g.cloneElement(a,void 0,i):null})}return c.jsx(Ie,{...n,ref:o,children:t})});de.displayName="Slot";var Ie=g.forwardRef((e,o)=>{const{children:t,...n}=e;if(g.isValidElement(t)){const r=gr(t);return g.cloneElement(t,{...pr(n,t.props),ref:o?St(o,r):r})}return g.Children.count(t)>1?g.Children.only(null):null});Ie.displayName="SlotClone";var fr=({children:e})=>c.jsx(c.Fragment,{children:e});function mr(e){return g.isValidElement(e)&&e.type===fr}function pr(e,o){const t={...o};for(const n in o){const r=e[n],s=o[n];/^on[A-Z]/.test(n)?r&&s?t[n]=(...i)=>{s(...i),r(...i)}:r&&(t[n]=r):n==="style"?t[n]={...r,...s}:n==="className"&&(t[n]=[r,s].filter(Boolean).join(" "))}return{...e,...t}}function gr(e){let o=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,t=o&&"isReactWarning"in o&&o.isReactWarning;return t?e.ref:(o=Object.getOwnPropertyDescriptor(e,"ref")?.get,t=o&&"isReactWarning"in o&&o.isReactWarning,t?e.props.ref:e.props.ref||e.ref)}function hr(e){const o=e+"CollectionProvider",[t,n]=ve(o),[r,s]=t(o,{collectionRef:{current:null},itemMap:new Map}),a=h=>{const{scope:v,children:x}=h,C=w.useRef(null),E=w.useRef(new Map).current;return c.jsx(r,{scope:v,itemMap:E,collectionRef:C,children:x})};a.displayName=o;const i=e+"CollectionSlot",u=w.forwardRef((h,v)=>{const{scope:x,children:C}=h,E=s(i,x),b=Ae(v,E.collectionRef);return c.jsx(de,{ref:b,children:C})});u.displayName=i;const l=e+"CollectionItemSlot",f="data-radix-collection-item",m=w.forwardRef((h,v)=>{const{scope:x,children:C,...E}=h,b=w.useRef(null),A=Ae(v,b),_=s(l,x);return w.useEffect(()=>(_.itemMap.set(b,{ref:b,...E}),()=>void _.itemMap.delete(b))),c.jsx(de,{[f]:"",ref:A,children:C})});m.displayName=l;function p(h){const v=s(e+"CollectionConsumer",h);return w.useCallback(()=>{const C=v.collectionRef.current;if(!C)return[];const E=Array.from(C.querySelectorAll(`[${f}]`));return Array.from(v.itemMap.values()).sort((_,T)=>E.indexOf(_.ref.current)-E.indexOf(T.ref.current))},[v.collectionRef,v.itemMap])}return[{Provider:a,Slot:u,ItemSlot:m},p,n]}var vr=globalThis?.document?g.useLayoutEffect:()=>{},Cr=oo.useId||(()=>{}),xr=0;function Er(e){const[o,t]=g.useState(Cr());return vr(()=>{t(n=>n??String(xr++))},[e]),o?`radix-${o}`:""}var br=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],F=br.reduce((e,o)=>{const t=g.forwardRef((n,r)=>{const{asChild:s,...a}=n,i=s?de:o;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),c.jsx(i,{...a,ref:r})});return t.displayName=`Primitive.${o}`,{...e,[o]:t}},{});function Le(e){const o=g.useRef(e);return g.useEffect(()=>{o.current=e}),g.useMemo(()=>(...t)=>o.current?.(...t),[])}function Ce({prop:e,defaultProp:o,onChange:t=()=>{}}){const[n,r]=_r({defaultProp:o,onChange:t}),s=e!==void 0,a=s?e:n,i=Le(t),u=g.useCallback(l=>{if(s){const m=typeof l=="function"?l(e):l;m!==e&&i(m)}else r(l)},[s,e,r,i]);return[a,u]}function _r({defaultProp:e,onChange:o}){const t=g.useState(e),[n]=t,r=g.useRef(n),s=Le(o);return g.useEffect(()=>{r.current!==n&&(s(n),r.current=n)},[n,r,s]),t}var yr=g.createContext(void 0);function ke(e){const o=g.useContext(yr);return e||o||"ltr"}var ye="rovingFocusGroup.onEntryFocus",Nr={bubbles:!1,cancelable:!0},xe="RovingFocusGroup",[Oe,Pt,Tr]=hr(xe),[Sr,Ee]=ve(xe,[Tr]),[Pr,Ar]=Sr(xe),At=g.forwardRef((e,o)=>c.jsx(Oe.Provider,{scope:e.__scopeRovingFocusGroup,children:c.jsx(Oe.Slot,{scope:e.__scopeRovingFocusGroup,children:c.jsx(Ir,{...e,ref:o})})}));At.displayName=xe;var Ir=g.forwardRef((e,o)=>{const{__scopeRovingFocusGroup:t,orientation:n,loop:r=!1,dir:s,currentTabStopId:a,defaultCurrentTabStopId:i,onCurrentTabStopIdChange:u,onEntryFocus:l,preventScrollOnEntryFocus:f=!1,...m}=e,p=g.useRef(null),h=Ae(o,p),v=ke(s),[x=null,C]=Ce({prop:a,defaultProp:i,onChange:u}),[E,b]=g.useState(!1),A=Le(l),_=Pt(t),T=g.useRef(!1),[S,P]=g.useState(0);return g.useEffect(()=>{const O=p.current;if(O)return O.addEventListener(ye,A),()=>O.removeEventListener(ye,A)},[A]),c.jsx(Pr,{scope:t,orientation:n,dir:v,loop:r,currentTabStopId:x,onItemFocus:g.useCallback(O=>C(O),[C]),onItemShiftTab:g.useCallback(()=>b(!0),[]),onFocusableItemAdd:g.useCallback(()=>P(O=>O+1),[]),onFocusableItemRemove:g.useCallback(()=>P(O=>O-1),[]),children:c.jsx(F.div,{tabIndex:E||S===0?-1:0,"data-orientation":n,...m,ref:h,style:{outline:"none",...e.style},onMouseDown:Y(e.onMouseDown,()=>{T.current=!0}),onFocus:Y(e.onFocus,O=>{const ne=!T.current;if(O.target===O.currentTarget&&ne&&!E){const re=new CustomEvent(ye,Nr);if(O.currentTarget.dispatchEvent(re),!re.defaultPrevented){const Q=_().filter(z=>z.focusable),K=Q.find(z=>z.active),G=Q.find(z=>z.id===x),qt=[K,G,...Q].filter(Boolean).map(z=>z.ref.current);Mt(qt,f)}}T.current=!1}),onBlur:Y(e.onBlur,()=>b(!1))})})}),It="RovingFocusGroupItem",Ot=g.forwardRef((e,o)=>{const{__scopeRovingFocusGroup:t,focusable:n=!0,active:r=!1,tabStopId:s,...a}=e,i=Er(),u=s||i,l=Ar(It,t),f=l.currentTabStopId===u,m=Pt(t),{onFocusableItemAdd:p,onFocusableItemRemove:h}=l;return g.useEffect(()=>{if(n)return p(),()=>h()},[n,p,h]),c.jsx(Oe.ItemSlot,{scope:t,id:u,focusable:n,active:r,children:c.jsx(F.span,{tabIndex:f?0:-1,"data-orientation":l.orientation,...a,ref:o,onMouseDown:Y(e.onMouseDown,v=>{n?l.onItemFocus(u):v.preventDefault()}),onFocus:Y(e.onFocus,()=>l.onItemFocus(u)),onKeyDown:Y(e.onKeyDown,v=>{if(v.key==="Tab"&&v.shiftKey){l.onItemShiftTab();return}if(v.target!==v.currentTarget)return;const x=wr(v,l.orientation,l.dir);if(x!==void 0){if(v.metaKey||v.ctrlKey||v.altKey||v.shiftKey)return;v.preventDefault();let E=m().filter(b=>b.focusable).map(b=>b.ref.current);if(x==="last")E.reverse();else if(x==="prev"||x==="next"){x==="prev"&&E.reverse();const b=E.indexOf(v.currentTarget);E=l.loop?Rr(E,b+1):E.slice(b+1)}setTimeout(()=>Mt(E))}})})})});Ot.displayName=It;var Or={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Mr(e,o){return o!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function wr(e,o,t){const n=Mr(e.key,t);if(!(o==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(o==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return Or[n]}function Mt(e,o=!1){const t=document.activeElement;for(const n of e)if(n===t||(n.focus({preventScroll:o}),document.activeElement!==t))return}function Rr(e,o){return e.map((t,n)=>e[(o+n)%e.length])}var wt=At,je=Ot,Lr="Separator",tt="horizontal",kr=["horizontal","vertical"],Rt=g.forwardRef((e,o)=>{const{decorative:t,orientation:n=tt,...r}=e,s=jr(n)?n:tt,i=t?{role:"none"}:{"aria-orientation":s==="vertical"?s:void 0,role:"separator"};return c.jsx(F.div,{"data-orientation":s,...i,...r,ref:o})});Rt.displayName=Lr;function jr(e){return kr.includes(e)}var Dr=Rt,Br="Toggle",Lt=g.forwardRef((e,o)=>{const{pressed:t,defaultPressed:n=!1,onPressedChange:r,...s}=e,[a=!1,i]=Ce({prop:t,onChange:r,defaultProp:n});return c.jsx(F.button,{type:"button","aria-pressed":a,"data-state":a?"on":"off","data-disabled":e.disabled?"":void 0,...s,ref:o,onClick:Y(e.onClick,()=>{e.disabled||i(!a)})})});Lt.displayName=Br;var Z="ToggleGroup",[kt,jt]=ve(Z,[Ee]),Dt=Ee(),De=w.forwardRef((e,o)=>{const{type:t,...n}=e;if(t==="single"){const r=n;return c.jsx(Gr,{...r,ref:o})}if(t==="multiple"){const r=n;return c.jsx(Vr,{...r,ref:o})}throw new Error(`Missing prop \`type\` expected on \`${Z}\``)});De.displayName=Z;var[Bt,Gt]=kt(Z),Gr=w.forwardRef((e,o)=>{const{value:t,defaultValue:n,onValueChange:r=()=>{},...s}=e,[a,i]=Ce({prop:t,defaultProp:n,onChange:r});return c.jsx(Bt,{scope:e.__scopeToggleGroup,type:"single",value:a?[a]:[],onItemActivate:i,onItemDeactivate:w.useCallback(()=>i(""),[i]),children:c.jsx(Vt,{...s,ref:o})})}),Vr=w.forwardRef((e,o)=>{const{value:t,defaultValue:n,onValueChange:r=()=>{},...s}=e,[a=[],i]=Ce({prop:t,defaultProp:n,onChange:r}),u=w.useCallback(f=>i((m=[])=>[...m,f]),[i]),l=w.useCallback(f=>i((m=[])=>m.filter(p=>p!==f)),[i]);return c.jsx(Bt,{scope:e.__scopeToggleGroup,type:"multiple",value:a,onItemActivate:u,onItemDeactivate:l,children:c.jsx(Vt,{...s,ref:o})})});De.displayName=Z;var[Fr,Hr]=kt(Z),Vt=w.forwardRef((e,o)=>{const{__scopeToggleGroup:t,disabled:n=!1,rovingFocus:r=!0,orientation:s,dir:a,loop:i=!0,...u}=e,l=Dt(t),f=ke(a),m={role:"group",dir:f,...u};return c.jsx(Fr,{scope:t,rovingFocus:r,disabled:n,children:r?c.jsx(wt,{asChild:!0,...l,orientation:s,dir:f,loop:i,children:c.jsx(F.div,{...m,ref:o})}):c.jsx(F.div,{...m,ref:o})})}),fe="ToggleGroupItem",Ft=w.forwardRef((e,o)=>{const t=Gt(fe,e.__scopeToggleGroup),n=Hr(fe,e.__scopeToggleGroup),r=Dt(e.__scopeToggleGroup),s=t.value.includes(e.value),a=n.disabled||e.disabled,i={...e,pressed:s,disabled:a},u=w.useRef(null);return n.rovingFocus?c.jsx(je,{asChild:!0,...r,focusable:!a,active:s,ref:u,children:c.jsx(ot,{...i,ref:o})}):c.jsx(ot,{...i,ref:o})});Ft.displayName=fe;var ot=w.forwardRef((e,o)=>{const{__scopeToggleGroup:t,value:n,...r}=e,s=Gt(fe,t),a={role:"radio","aria-checked":e.pressed,"aria-pressed":void 0},i=s.type==="single"?a:void 0;return c.jsx(Lt,{...i,...r,ref:o,onPressedChange:u=>{u?s.onItemActivate(n):s.onItemDeactivate(n)}})}),Yr=De,$r=Ft,Be="Toolbar",[Ur,Ss]=ve(Be,[Ee,jt]),Ge=Ee(),Ht=jt(),[Kr,Yt]=Ur(Be),$t=g.forwardRef((e,o)=>{const{__scopeToolbar:t,orientation:n="horizontal",dir:r,loop:s=!0,...a}=e,i=Ge(t),u=ke(r);return c.jsx(Kr,{scope:t,orientation:n,dir:u,children:c.jsx(wt,{asChild:!0,...i,orientation:n,dir:u,loop:s,children:c.jsx(F.div,{role:"toolbar","aria-orientation":n,dir:u,...a,ref:o})})})});$t.displayName=Be;var Ut="ToolbarSeparator",Kt=g.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=Yt(Ut,t);return c.jsx(Dr,{orientation:r.orientation==="horizontal"?"vertical":"horizontal",...n,ref:o})});Kt.displayName=Ut;var zr="ToolbarButton",Ve=g.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=Ge(t);return c.jsx(je,{asChild:!0,...r,focusable:!e.disabled,children:c.jsx(F.button,{type:"button",...n,ref:o})})});Ve.displayName=zr;var Xr="ToolbarLink",Wr=g.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=Ge(t);return c.jsx(je,{asChild:!0,...r,focusable:!0,children:c.jsx(F.a,{...n,ref:o,onKeyDown:Y(e.onKeyDown,s=>{s.key===" "&&s.currentTarget.click()})})})});Wr.displayName=Xr;var zt="ToolbarToggleGroup",qr=g.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=Yt(zt,t),s=Ht(t);return c.jsx(Yr,{"data-orientation":r.orientation,dir:r.dir,...s,...n,ref:o,rovingFocus:!1})});qr.displayName=zt;var Jr="ToolbarToggleItem",Zr=g.forwardRef((e,o)=>{const{__scopeToolbar:t,...n}=e,r=Ht(t),s={__scopeToolbar:e.__scopeToolbar};return c.jsx(Ve,{asChild:!0,...s,children:c.jsx($r,{...r,...n,ref:o})})});Zr.displayName=Jr;var Qr=$t,es=Kt,ts=(e=>(e.CODE="code",e.WRITING="writing",e))(ts||{});const oe=({children:e,toolbarType:o})=>c.jsx(Qr,{className:M("m-0 flex h-10 w-fit min-w-0 flex-shrink items-center overflow-hidden rounded-xl border border-token-border-light bg-token-main-surface-primary",it,o==="code"?"p-0":"p-1"),children:e}),Xt=({icon:e,hideLabel:o,label:t})=>c.jsxs(c.Fragment,{children:[c.jsx(e,{className:M("icon-sm",{"mr-0.5 text-token-text-tertiary":!o,"text-token-text-primary":o})}),!o&&c.jsx("span",{className:"truncate text-sm text-token-text-primary",children:t})]}),Wt=at(Ve)`flex h-full items-center gap-1 rounded-lg px-2.5 hover:bg-[#f5f5f5] dark:hover:bg-token-main-surface-secondary`,os=({label:e,icon:o,hideLabel:t=!1,onClick:n,onMouseDown:r})=>c.jsx(Wt,{onClick:n,"aria-label":t?e:void 0,onMouseDown:r,children:c.jsx(Xt,{icon:o,hideLabel:t,label:e})}),ns=({icon:e,hideLabel:o,label:t,children:n})=>c.jsxs(lo,{children:[c.jsx(uo,{asChild:!0,children:c.jsx(Wt,{"aria-label":o?t:void 0,children:c.jsx(Xt,{icon:e,hideLabel:o,label:t})})}),c.jsx(fo,{children:c.jsx(mo,{align:"end",className:B.toolbar,sideOffset:8,children:n})})]});oe.Separator=at(es)`mx-1 p-0 list-none h-full w-[1px] bg-token-border-light`;oe.Action=os;oe.Popover=ns;const rs=({getSelectionRange:e})=>{const o=Me(),t=()=>{const n=e();if(n==null)return;const{from:r,to:s,sourceFrom:a,sourceTo:i}=n;if(r==null||s==null||a==null||i==null){j.logError("Missing selection range on targeted edit",n);return}const u=dt.ASK;j.logButtonClick(W.TOOLBAR_ASK_CHATGPT,{action:u,sourceFrom:a,sourceTo:i}),L.startCommentingOn({type:$.SELECTION,from:r,to:s,sourceRange:{start:a,end:i},action:u})};return c.jsx(oe.Action,{label:o.formatMessage({id:"wOaJUU",defaultMessage:"Ask ChatGPT"}),onClick:t,icon:Ro})},Ps=({getEditorDom:e,getToolbarPosition:o,getSelectionRange:t,toolbarType:n,children:r,onAddComment:s,isWaitingForCommentResponse:a=!1})=>{const[{height:i,width:u},l]=me(),[f,m]=g.useState(!0),[p,h]=g.useState(!1),v=e(),x=V(({commentingOn:S})=>S),[C,E]=g.useState(null),b=g.useCallback(()=>{const S=e(),P=document.getSelection();return!P||P.type!=="Range"||P.isCollapsed||!S?.contains(P.anchorNode)},[e]);g.useEffect(()=>{const S=po(()=>{h(!0)},200,{leading:!0}),P=()=>{S.cancel(),h(!1)};return v?.addEventListener("pointerdown",S,{passive:!0}),document.addEventListener("pointerup",P,{passive:!0}),()=>{v?.removeEventListener("pointerdown",S),document.removeEventListener("pointerup",P)}},[v]),g.useEffect(()=>{const S=()=>{m(b())};return document.addEventListener("selectionchange",S,{passive:!0}),()=>{document.removeEventListener("selectionchange",S)}},[b]),st(()=>{if(f||b())return m(!0);try{const S=o({width:u,height:i});S!=null&&E(S)}catch(S){j.logError("Invalid position in getToolbarPosition",S)}},[i,u,f,b,o]);const A=c.jsxs(oe,{toolbarType:n,children:[c.jsx(rs,{getSelectionRange:t}),r]}),_=!f&&!x&&C!=null,T=Vo(_);return g.useEffect(()=>{!_&&T&&!x&&v?.focus()},[v,T,_,x]),c.jsxs(c.Fragment,{children:[c.jsx("div",{"aria-hidden":"true",className:"pointer-events-none invisible fixed left-0 top-0 h-0 overflow-clip",children:c.jsx("div",{ref:l,children:A})}),c.jsx(X,{children:_&&c.jsx(k.div,{initial:{opacity:0,scale:.95},animate:{opacity:p?0:1,scale:p?.95:1},style:{top:C.top,left:C.left},exit:{opacity:0,scale:.95},transition:{type:"spring",bounce:.1,duration:.1,delay:p?0:.1},className:M("absolute",B.toolbar,p?"pointer-events-none":"pointer-events-auto"),children:A})}),c.jsx(En,{toolbarPosition:C,commentingOn:x,isWaitingForCommentResponse:a,onAddComment:s})]})};function ss(e){let o=e;for(;o;){const n=window.getComputedStyle(o).overflowY;if(n==="auto"||n==="scroll")return o;o=o.parentElement}return null}function As(e,o){const t=te(),n=go(),r=t();g.useEffect(()=>{const s=r?.dom;if(!s||e.length===0)return;const a=()=>{if(!n)return;const{textdocId:f,history:m}=n;m?ho(f,m):vo(f)},i=ss(s),u=f=>{f.key==="Escape"&&a()};window.document.addEventListener("keydown",u,{passive:!0});const l=o?lt(o,100):null;return i&&l&&i.addEventListener("scroll",l,{passive:!0}),()=>{window.document.removeEventListener("keydown",u),l&&(i&&i.removeEventListener("scroll",l),l.cancel())}},[r,n,e,o])}let se=null;function Is(){if(se!=null)return se;if(typeof window>"u")return 0;const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.overflow="scroll",e.style.position="absolute",e.style.top="-9999px",document.body.appendChild(e);try{se=e.offsetWidth-e.clientWidth}finally{document.body.removeChild(e)}return se}function Os(e){return e==null?null:e.scrollHeight>e.clientHeight}export{vt as A,rr as B,Ts as C,oe as D,q as H,U as I,Sn as P,On as R,Ps as T,Es as a,xs as b,ts as c,Is as d,In as e,zo as f,Cs as g,bs as h,Os as i,Re as j,An as k,Pn as l,Yo as m,bt as n,_s as o,Mn as p,_n as q,Ns as r,vs as s,Tn as t,As as u,qo as v,ys as w,Et as x,ue as y,bn as z};
//# sourceMappingURL=oxk8ju6azjtatwlm.js.map
