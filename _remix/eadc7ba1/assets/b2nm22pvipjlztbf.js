import{db as S,a0 as A,bo as D,B as p,an as T,cH as _}from"./flp62uidktb7m1ug.js";import{o as w}from"./hb9t536xg0y0xszu.js";import{D as B}from"./gvolk5s4399xa3cv.js";const d=()=>{let r,s;const a=new Promise((n,e)=>{r=n,s=e});return{resolve:r,reject:s,value:a}},M=(r,s)=>{var o;const a=r.name??`batcher:${Math.random().toString(16).slice(2)})`,n=r.scheduler??y(10),e=(o=globalThis.__BATSHIT_DEVTOOLS__)==null?void 0:o.for(a);let t={seq:0,batch:new Set,currentRequest:d(),timer:void 0,start:null,latest:null};e==null||e.create({seq:t.seq});const i=()=>{t.batch=new Set,t.currentRequest=d(),t.timer=void 0,t.start=null,t.latest=null};return{fetch:c=>{t.start||(t.start=Date.now()),t.latest=Date.now(),t.batch.add(c),clearTimeout(t.timer);const b=n(t.start,t.latest,t.batch.size);e==null||e.queue({seq:t.seq,query:c,batch:[...t.batch],scheduled:b,latest:t.latest,start:t.start});const q=()=>{const u=t.seq,h=r.fetcher([...t.batch]),f=t.currentRequest;return e==null||e.fetch({seq:u,batch:[...t.batch]}),i(),h.then(l=>{e==null||e.data({seq:u,data:l}),f.resolve(l)}).catch(l=>{e==null||e.error({seq:u,error:l}),f.reject(l)}),t.seq++,h};if(b==="immediate"){const u=t.currentRequest;return q(),u.value.then(h=>r.resolver(h,c))}else return b==="never"?t.currentRequest.value.then(u=>r.resolver(u,c)):(t.timer=setTimeout(q,b),t.currentRequest.value.then(u=>r.resolver(u,c)))}}},Q=r=>(s,a)=>s.find(n=>n[r]==a),y=r=>(s,a)=>{const n=a-s;return r-n},R=S(r=>M({fetcher:async s=>{const a=new Map;for await(const n of A.streamedJsonPost(`${D}/attributions`,{urls:s}))n.attribution&&a.set(n.url,n.attribution),r.setQueryData(["attribution",{url:n.url}],n.attribution);return B(s.map(n=>{const e=a.get(n);return e&&{url:n,attribution:e}}))},resolver:Q("url"),scheduler:y(100)}));function P(r,{useBaseUrl:s=!0,enabled:a=!0}={}){const n=s?w(r):r,e=p(),t=R(e);return T({queryKey:["attribution",{url:n}],queryFn:async()=>(await t.fetch(n)).attribution,enabled:a&&!!r})}function U(r,{useBaseUrl:s=!0,enabled:a=!0}={}){const n=s?r.map(w):r,e=p(),t=R(e);return _({queries:n.map(i=>({queryKey:["attribution",{url:i}],queryFn:async()=>(await t.fetch(i)).attribution,enabled:n.length>0&&a})),combine:i=>{const m=new Map;for(let o=0;o<i.length;o++){const c=i[o].data;c&&m.set(r[o],c)}return m}})}export{U as a,M as c,Q as k,P as u,y as w};
//# sourceMappingURL=b2nm22pvipjlztbf.js.map
