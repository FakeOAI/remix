const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/edqlslde9moy2ji3.js","assets/cbv020t7gzp4f872.js","assets/kq3cjnjkkiu42wsi.js","assets/root-bcm2adyk.css","assets/gpe91l6ql3o0s610.js","assets/conversation-small-eplmind9.css","assets/eprwd5wd9a7hvvfw.js","assets/lw9lle2awfx0m3zh.js","assets/j1mltnb4g3et1nfv.js","assets/gmiirouoqe0oqavl.js","assets/cf35vab9q82m0zj4.js","assets/ihhnf33zws1gyw0j.js","assets/hte00x4vz53jf7hc.js","assets/c039xathbpqv7hjp.js","assets/emwpab8ugh2jm8tb.js","assets/jcecw02o1g7i3lgl.js","assets/fnzhfm00fqotlxu9.js","assets/l29l32kuno0zg8js.js","assets/lnjq7tpfav8s4s8h.js","assets/caan1pg3ww016xl8.js","assets/le0igyxp535xhyki.js","assets/lwyj5zt61cufjetj.js"])))=>i.map(i=>d[i]);
import{r as u,aD as W,aE as Z,S as L,P as S,a as N,a1 as F,bN as A,eK as E,eL as q,bu as ee,m as s,q as x,bq as te,W as se,u as P,bo as ae,aK as ne,Z as w,a5 as C,a6 as re}from"./cbv020t7gzp4f872.js";import{dd as ie,de as oe,df as B,dg as le,dh as de,bf as ue,a8 as ce,aU as G,T as fe,di as me,dj as Y,dk as he,dl as ye,dm as H,dn as ge,dp as pe}from"./gpe91l6ql3o0s610.js";import{b as be,g as xe}from"./eprwd5wd9a7hvvfw.js";import{b as Te,r as j,s as ve}from"./hte00x4vz53jf7hc.js";import{f as Ee}from"./ihhnf33zws1gyw0j.js";import{m as Se,n as U,o as Ne,p as we,T as $}from"./lw9lle2awfx0m3zh.js";import{G as z}from"./cf35vab9q82m0zj4.js";import{a4 as Ie}from"./kq3cjnjkkiu42wsi.js";import{m as Ce}from"./j1mltnb4g3et1nfv.js";function ke(e,t,i){const{title:a,titleSource:n}=Se(e),[r,l]=u.useState(!1),d=a??t,o=u.useRef(d);return u.useEffect(()=>(i&&n===U.Generated&&d!==o.current&&l(!0),()=>{o.current=d}),[i,d,n]),{isTypingEffect:r,resolvedTitle:d}}const je=W(()=>Z(()=>import("./edqlslde9moy2ji3.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>e.GizmoConversationOptionsDropdown)),_e=new Date(2024,8,24,13);function De(e){L.checkGate("3922476776")||ie.abortAllRequests(),S.logEvent(N.loadThread,{threadId:e})}function Me({conversation:e,conversationTitle:t,onOpenChange:i,testId:a}){const n=F(),{isUnauthenticated:r}=se(),{eligible:l,markAsViewed:d}=ue(ce.ArchiveConversationOnboarding),o=we(e.id),[h,g]=u.useState(!1),c=P(),f=ae(),T=ne();return u.useEffect(()=>q(z,{deleteChat:({serverThreadId:m})=>{m===e.id&&g(!0)},archiveChat:async({serverThreadId:m})=>{m===e.id&&(await w.patchConversation(e.id,{is_archived:!0}),j(c),L.logEvent("chatgpt_conversation_archived"),S.logEvent(N.conversationArchived),l&&(T.info(n.formatMessage({defaultMessage:"You can view archived chats in Settings",id:"HistoryGizmoItem.archiveChatOnboarding"}),{duration:10,hasCloseButton:!0}),d()),o&&G(f))}}),[f,T,c,l,e.id,n,o,d]),r?null:s.jsxs(s.Fragment,{children:[s.jsx(fe,{label:n.formatMessage({id:"tJPHEQ",defaultMessage:"Options"}),sideOffset:4,side:"top",children:s.jsx(je,{clientThreadId:e.id,onOpenChange:i,children:s.jsx("button",{className:"flex items-center justify-center text-token-text-secondary transition hover:text-token-text-primary radix-state-open:text-token-text-secondary","data-testid":a,children:s.jsx(Ie,{className:"icon-md"})})})}),h&&s.jsx(me,{title:t,handleDelete:()=>{w.patchConversation(e.id,{is_visible:!1}).then(()=>{j(c),L.logEvent("chatgpt_conversation_deleted"),S.logEvent(N.conversationDeleted)}),o&&G(f)},onClose:()=>{g(!1)}})]})}function Oe({conversation:e,onClose:t}){const[i,a]=u.useState(e.title),n=P();function r(){i!==e.title&&($.setTitle(e.id,i,U.User),S.logEvent(N.renameThread,{threadId:e.id,content:i}),w.patchConversation(e.id,{title:i}).then(()=>{j(n)}))}return s.jsx("input",{type:"text",value:i,onChange:l=>{a(l.target.value)},onKeyDown:l=>{switch(l.key){case"Escape":t();break;case"Enter":r(),t();break}},onBlur:()=>{r(),t()},autoFocus:!0,className:"w-full border border-token-border-light bg-transparent p-0 text-sm"})}const K=5,Re=3e3;function Le({threadId:e}){const t=P(),i=u.useRef(!1),a=u.useRef(null);return u.useEffect(()=>{async function n(){i.current=!0;const r=await Ee(e);if(r.async_status===E.FINISHED){j(t),$.initThreadFromServerData(e,r,!0,void 0,!0);return}if(r.async_status!==E.PENDING)return;const l=r.update_time??0;B(new Date,new Date(l*1e3))<K?a.current=window.setTimeout(n,Re):w.clearConversationStatus(e)}return i.current||n(),()=>{a.current&&window.clearTimeout(a.current)}},[t,e]),null}function Fe({conversation:e,isActive:t,elementRef:i,isPrimaryBackgroundColor:a,testId:n}){const r=F(),[l,d]=u.useState(!1),[o,h]=u.useState(!1),{value:g}=A("3922476776"),{value:c}=A("232791851"),f=Te(e.id),T=Ne(e.id),m=oe(T),y=B(new Date,new Date(e.update_time??0))<K,b=e.update_time&&le(new Date(e.update_time),_e),_=f===E.PENDING&&y,D=c&&!t&&!m&&b&&f===E.FINISHED,M=c&&!t&&(m||_),O=c&&f===E.PENDING&&!m&&y,v=u.useRef(!1);u.useEffect(()=>{!v.current&&!m&&f===E.FINISHED&&t&&g&&(async()=>(v.current=!0,await w.clearConversationStatus(e.id),ve(e.id,null),v.current=!1))()},[g,t,e.id,f,m]),u.useEffect(()=>q(z,{editTitle:({serverThreadId:p})=>{(p?p===e.id:t)&&d(!0)}}),[e.id,t]);const I=r.formatMessage({id:"mpXAeu",defaultMessage:"New chat"}),{resolvedTitle:R,isTypingEffect:V}=ke(e.id,e.title,t),X=ee(),Q=V&&t&&X,{data:J}=be(e.conversation_template_id??void 0);return s.jsxs("div",{className:x("no-draggable group relative rounded-lg active:opacity-90",t?"bg-token-sidebar-surface-secondary":"hover:bg-token-sidebar-surface-secondary",o&&!t&&"bg-token-sidebar-surface-secondary"),children:[O&&s.jsx(Le,{threadId:e.id}),s.jsx(te,{to:xe(e.id,J),onClick:p=>{p.metaKey||p.ctrlKey||t||De(e.id)},onDoubleClick:()=>{d(!0)},ref:i,className:"flex items-center gap-2 p-2",children:s.jsxs("div",{className:x("relative grow overflow-hidden whitespace-nowrap",M&&"loading-shimmer"),dir:"auto",children:[Q?s.jsx(de,{text:R||I}):R||I,s.jsx("div",{className:x("absolute bottom-0 top-0 to-transparent ltr:right-0 ltr:bg-gradient-to-l rtl:left-0 rtl:bg-gradient-to-r",a?t||!t&&o?"from-token-sidebar-surface-secondary":"from-token-main-surface-primary":!1,a?!1:t||!t&&o?"from-token-sidebar-surface-secondary":"from-token-sidebar-surface-primary",{"from-token-main-surface-primary can-hover:group-hover:from-token-sidebar-surface-secondary":a&&!t&&!o,"from-token-sidebar-surface-primary can-hover:group-hover:from-token-sidebar-surface-secondary":!a&&!t&&!o,"w-10 from-60%":t||o,"w-8 from-0% can-hover:group-hover:w-10 can-hover:group-hover:from-60%":!t&&!o})})]})}),l?s.jsx("div",{className:"absolute bottom-0 left-[7px] right-2 top-0 flex items-center bg-token-sidebar-surface-secondary",children:s.jsx(Oe,{conversation:e,onClose:()=>{d(!1)}})}):D?s.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:s.jsx("div",{className:"h-2 w-2 rounded-full bg-blue-selection"})}):s.jsx("div",{className:x("absolute bottom-0 top-0 items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",t||o?"flex":"hidden can-hover:group-hover:flex"),children:s.jsx(Me,{conversation:e,conversationTitle:R??e.title,onOpenChange:p=>{h(p),p&&S.logEvent(N.conversationHistoryItemOpenMenu,{conversationId:e.id})},testId:`${n}-options`})})]})}const Pe={initial:({isNew:e})=>e?{opacity:0,height:0,overflow:"hidden"}:{},animate:()=>({opacity:1,height:"auto"}),exit:()=>({opacity:0,height:0})};function Ae({elementRef:e,item:t,isActive:i,isFirstItem:a,isExistingItem:n,isPrimaryBackgroundColor:r,testId:l}){const d=Y();return s.jsx(Ce.li,{className:x("relative",a&&!d?"z-[15]":""),layout:"position",custom:{isNew:!n},variants:Pe,initial:"initial",animate:"animate",exit:"exit","data-testid":l,children:s.jsx(Fe,{isPrimaryBackgroundColor:r,conversation:t,isActive:i,elementRef:e,testId:l})})}const k=re({historyBucketToday:{id:"history.bucket.today",defaultMessage:"Today"},historyBucketYesterday:{id:"history.bucket.yesterday",defaultMessage:"Yesterday"},historyBucketLastSeven:{id:"history.bucket.lastSeven",defaultMessage:"Previous 7 Days"},historyBucketLastThirty:{id:"history.bucket.lastThirty",defaultMessage:"Previous 30 Days"}}),Ge=5;function Xe(e,t){const i=F();return u.useMemo(()=>e.reduce((a,n)=>{const r=new Date(n.update_time??n.create_time??0),l=he(new Date,r);if(l===0)a.recent.today.items.push(n);else if(l<=1)a.recent.yesterday.items.push(n);else if(l<=7)a.recent.lastSeven.items.push(n);else if(l<=30)a.recent.lastThirty.items.push(n);else if(ye(r)){const d=H(r),o=ge(r),h=`${d}-${o}`;a.dynamicMonths[h]?a.dynamicMonths[h].items.push(n):a.dynamicMonths[h]={label:i.formatDate(r,{month:"long"}),items:[n]}}else{const o=`${H(r)}-`;a.dynamicYears[o]?a.dynamicYears[o].items.push(n):a.dynamicYears[o]={label:i.formatDate(r,{year:"numeric"}),items:[n]}}return a},{recent:{today:{label:s.jsx(C,{...k.historyBucketToday}),items:[]},yesterday:{label:s.jsx(C,{...k.historyBucketYesterday}),items:[]},lastSeven:{label:s.jsx(C,{...k.historyBucketLastSeven}),items:[]},lastThirty:{label:s.jsx(C,{...k.historyBucketLastThirty}),items:[]}},dynamicMonths:{},dynamicYears:{}}),[t,e])}function Qe({activeId:e,bucketedItems:t,items:i,hasNextPage:a,isPrimaryBackgroundColor:n,previousItems:r,infiniteScrollTriggerElementRef:l}){const d=Y();return s.jsx(s.Fragment,{children:[t.recent,t.dynamicMonths,t.dynamicYears].flatMap((o,h)=>s.jsx(u.Fragment,{children:Object.entries(o).map(([g,{items:c,label:f}],T)=>{if(g!=="today"&&!c.length)return null;const m=!!c.find(y=>{var b;return i.length>0&&y.id===((b=i[0])==null?void 0:b.id)});return c.length>0&&s.jsxs("div",{className:x(n&&"first:mt-0","relative mt-5 first:mt-0 last:mb-5"),children:[s.jsx("div",{className:x("sticky z-20 bg-token-sidebar-surface-primary",d?"top-[--sidebar-sticky-threshold] mb-2":"top-0"),children:s.jsx("span",{className:"flex h-9 items-center",children:s.jsx(pe,{children:f})})}),s.jsx("ol",{children:c.map((y,b)=>{var v;const _=e===y.id,D=m&&b===0,M=r==null?void 0:r.find(({id:I})=>I===y.id),O=a&&((v=i[i.length-Ge-1])==null?void 0:v.id)===y.id?l:void 0;return s.jsx(Ae,{item:y,isActive:_,isFirstItem:D,isExistingItem:!!M,isPrimaryBackgroundColor:n,elementRef:O,testId:`history-item-${b}`},`history-item-${y.id}-${g}`)})})]},`${g}-${h}-${T}`)})},`category-${h}`))})}export{Qe as H,Ae as a,De as o,Xe as u};
//# sourceMappingURL=gcyfs34rqvxyqqfn.js.map
