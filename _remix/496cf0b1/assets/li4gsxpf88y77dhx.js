import{G as x,c4 as w,j as n,cI as k,c as b,d$ as s,F as C,N as j}from"./e8vun44xdcdlb616.js";import{a2 as F,A as Q}from"./ggfd01qgvnzl1dfn.js";import{F as _}from"./bnix9fyn5p6b1zka.js";import{F as E,e as L}from"./en0webbbxycrteaa.js";import{h as S}from"./ce136zqschj6e95a.js";import{a as N}from"./o4zfcaicgwghegqy.js";import{J as h,L as T,K as q}from"./ei9gbjdvy0yqzk4w.js";import{m as B}from"./bhmbk3lmmg39hscv.js";import"./8hnumlh3uw9b5jv3.js";import"./w6ck9aw2zcc1q7e6.js";import"./gc5lgszwv7xq7no3.js";import"./nsfccvo1dinxlwqu.js";import"./fdref9gqfuzocast.js";import"./li2feipvs7p7claf.js";import"./h6o9nov39g27ny11.js";import"./hpsgbx2lw63qko9d.js";import"./8dpou179vj6tbhoa.js";import"./f4i4f08lb7e9rjfr.js";import"./hh81ty3bbkmbgknd.js";import"./bquctxd2pduue2mp.js";import"./ikj88oj144cxg0fm.js";import"./bwbhbqfbelojeuef.js";import"./oc84l1wcn68jyjr7.js";import"./g08mb3zssyk7jkh1.js";import"./3ifhafjjn7zrtr7k.js";import"./cfaw94hz2qkxhisz.js";import"./ghskp9tm9w8sz1ul.js";function ke({messages:e,isRequestActive:t,isLastMessageInTurn:a,isRetrieval:r,isUsingGizmo:i}){const u=e.map(m=>m.message),p=D(u),o=p.filter(m=>O(m,!1)),c=o[o.length-1]??void 0,l=x();if(P(u).some(({content:m})=>m.content_type===w.SystemError))return null;let g=h.Running;const f={count:o.length,domain:c?S(M(c)??""):void 0,query:c?v(c):void 0};let d=r?i?l.formatMessage({id:"browsingMessage.searchingKnowledge",defaultMessage:"Searching my knowledge"}):l.formatMessage({id:"browsingMessage.startingRetrieval",defaultMessage:"Reading documents"}):l.formatMessage({id:"message.tools.browse.running",defaultMessage:"Searching the web"});return u.some(T)?(g=h.Stopped,d=r?i?l.formatMessage({id:"browsingMessage.searchingKnowledgeStopped",defaultMessage:"Stopped searching knowledge"}):l.formatMessage({id:"browsingMessage.retrievalStopped",defaultMessage:"Stopped reading documents"}):l.formatMessage({id:"message.tools.browse.stopped",defaultMessage:"Search stopped"})):!a||!t?p.length>0&&p.every(m=>m.didError)?(g=h.Error,d=r?i?l.formatMessage({id:"browsingMessage.searchingKnowledgeFailed",defaultMessage:"Error searching knowledge"}):l.formatMessage({id:"browsingMessage.retrievalFailed",defaultMessage:"Error reading documents"}):l.formatMessage({id:"message.tools.browse.failed",defaultMessage:"Search failed"})):(g=h.Finished,d=r?null:f.count===0?l.formatMessage({id:"message.tools.browse.started",defaultMessage:"Searching the web..."}):l.formatMessage({id:"message.tools.browse.finished",defaultMessage:"Searched {count, plural, =0 {0 sites} one {# site} other {# sites}}"},f)):o.length>0&&(d=R(l,f,r,i,o[o.length-1])),o.length>0&&g!==h.Error?n.jsx(q,{highlightedCommand:d,showWorkUserSetting:!1,status:g,children:o.length===0?null:n.jsx(K,{commands:o})}):n.jsx(H,{$isError:g===h.Error,children:d})}function y(e){var t,a,r;return((t=e.metadata)==null?void 0:t.command)==="quote"||((a=e.metadata)==null?void 0:a.command)==="quote_full"||((r=e.metadata)==null?void 0:r.command)==="quote_lines"}function D(e){return e.map((t,a)=>{if(t.author.role!==k.Tool||a>0&&y(t)&&y(e[a-1]))return null;const r=t.metadata;if(!r)return null;const{command:i,status:u}=r;return i?{type:i,status:u,didError:t.content.content_type===w.SystemError,message:t}:null}).filter(F)}function K({commands:e}){const t=x(),a=e.map(M).filter(i=>i!=null),r=N(a);return n.jsx("div",{className:"mb-4 divide-y divide-token-border-light rounded-xl border border-token-border-light text-sm",children:n.jsx(Q,{initial:!1,children:e.map((i,u)=>{const{icon:p,url:o,title:c,externalLink:l}=$(i),g=o?S(o):void 0,f=c?typeof c=="string"?c:t.formatMessage(c):null,d=o?r.get(o):null;return n.jsx(B.div,{initial:"collapsed",animate:"open",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:n.jsxs(U,{url:l??o,className:b("flex items-start gap-3 px-4 py-3",c?"text-token-text-secondary":"text-token-text-primary",u===0&&"rounded-t-xl",u===e.length-1&&"rounded-b-xl"),children:[p?n.jsx(p,{className:"icon-sm mt-0.5 flex-shrink-0 text-token-text-secondary"}):o?n.jsx(_,{url:o,className:"mt-1"}):null,n.jsxs("div",{children:[f&&n.jsxs("div",{className:"line-clamp-1 text-token-text-primary",children:[d&&`${d} — `,f]}),n.jsx("div",{children:g})]})]})},u)})})})}function U({url:e,children:t,className:a}){return e?n.jsxs("a",{href:e,target:"_blank",className:b(a,"group relative hover:bg-token-main-surface-secondary"),children:[t,n.jsx("div",{className:"invisible absolute right-3 bg-gradient-to-l from-token-main-surface-secondary to-transparent pl-4 group-hover:visible",children:n.jsx(E,{className:"icon-md text-token-text-secondary"})})]}):n.jsx("div",{className:a,children:t})}function W(e){var a,r;const t=(r=(a=e.message.metadata)==null?void 0:a._cite_metadata)==null?void 0:r.metadata_list[0];return t!=null&&t.type!=="file"?t.title:null}function v(e){var t,a;return(a=(t=e.message.metadata)==null?void 0:t.args)==null?void 0:a[0]}function $(e){switch(e.type){case s.Search:{const t=v(e);return{icon:L,url:"bing.com",externalLink:I(e),title:t?`“${t}”`:{id:"message.tools.browse.querying",defaultMessage:"Querying",description:"Status message when issuing a query"}}}case s.Click:case s.MultiClick:case s.Lookup:case s.OpenUrl:case s.Quote:case s.QuoteFull:case s.QuoteLines:case s.Scroll:return{url:M(e),title:W(e)??void 0};case s.Back:return{}}}function I(e){var a,r;const t=(r=(a=e.message.metadata)==null?void 0:a.args)==null?void 0:r[0];return t===void 0?null:C.getBingLink({query:t})}function R(e,t,a,r,i){switch(i==null?void 0:i.type){case s.Click:case s.MultiClick:case s.Lookup:case s.OpenUrl:case s.Quote:case s.QuoteFull:case s.QuoteLines:case s.Scroll:case s.Back:return e.formatMessage({id:"message.tools.browse.reading",defaultMessage:"Browsing {domain}"},t);case s.Search:case void 0:return a?r?e.formatMessage({id:"browsingMessage.searchingKnowledge",defaultMessage:"Searching my knowledge"}):e.formatMessage({id:"browsingMessage.startingRetrieval",defaultMessage:"Reading documents"}):e.formatMessage({id:"message.tools.browse.searching",defaultMessage:'Searching "{query}"'},t)}}function A(e){var a,r;const t=(r=(a=e.message.metadata)==null?void 0:a._cite_metadata)==null?void 0:r.metadata_list[0];return t!=null&&t.type==="file"?t.name:null}function O(e,t){switch(e.type){case s.Search:return!0;case s.Click:case s.Lookup:case s.MultiClick:case s.OpenUrl:case s.Quote:case s.QuoteFull:case s.QuoteLines:return t?A(e)!=null:M(e)!=null;case s.Back:case s.Scroll:return!1}}function M(e){var a,r;const t=(r=(a=e.message.metadata)==null?void 0:a._cite_metadata)==null?void 0:r.metadata_list[0];return t!=null&&t.type!=="file"?t.url:null}function P(e){return e.filter(t=>t.author.role===k.Tool)}const H=j.p`first:mt-0 my-1.5 h-8 flex items-center ltr:mr-auto rtl:ml-auto empty:hidden
${({$isError:e})=>e?"text-token-text-error":"text-token-text-secondary"}`;export{ke as BrowsingMessage,M as getVisitedUrl};
//# sourceMappingURL=li4gsxpf88y77dhx.js.map
