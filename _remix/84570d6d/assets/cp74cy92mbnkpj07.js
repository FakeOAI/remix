const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/lhrumd8iwzl4tc38.js","assets/lcs8amlj6u8bbv8a.js","assets/bpr39nud2l2ri9ju.js","assets/root-o2p2036q.css","assets/mx88tadiscuj24zf.js","assets/mtzax47qywij5chp.js","assets/mhenka8kv2zo8x47.js","assets/conversation-small-eplmind9.css","assets/pcv49agnj7j3pts6.js","assets/bh0082zbrhxuz40n.js","assets/da7sd4hwg4eqhiwg.js","assets/e71ale0donucmqlv.js","assets/mfdf34f1jov49oew.js","assets/ffpf4s5us4icwkru.js","assets/hqm0n2ld35codvui.js","assets/h04vyl1015sqd1gr.js","assets/cb4k7went7vwavkq.js","assets/n3joydq5axjpjkil.js","assets/n4x0fwkgh432ur0z.js","assets/loet3bipmnyhxrpc.js","assets/j54ooqo722i5ooln.js","assets/njn0f8av1tadybv7.js","assets/du9jwhsie2bwh72o.js","assets/fqlxc4pb7i3n1dey.js","assets/ct730acgo74q68te.js","assets/ds7me2mjwugiwq7i.js","assets/l7ytbj9gb513juvf.js","assets/bgw5ft2e8vcxjock.js","assets/bmtyh8d7r5fvwhhs.js","assets/acegjgh1ehwq4t7o.js","assets/hrojp06e64dmlig4.js","assets/sso-ics9m78winfyz1wy.js","assets/lm3i44fgkluqdhfa.js","assets/c5oj4prttm501969.js","assets/bo44qmnuhf5aaiy7.js","assets/bbfraejp359zh625.js","assets/ic9j2llh9qd4bt05.js","assets/ea5q0o3p88hcmcfr.js","assets/h2njzk66pfaefy7x.js","assets/nxqybqrpub4bg7qe.js","assets/gcwz227xbxgjhrq6.js","assets/fjlgvoec747liyzq.js","assets/lgv6qifx4a3nttv7.js","assets/kqwdyvkaaavvn8k3.js","assets/lp0r11m18mvlux4o.js","assets/esg6fgzi6rw0n43y.js","assets/kbzm4zrn8cd6ht9w.js","assets/lr22bfk7kqa4nsub.js","assets/ok7bzzfgfxb7cvxd.js","assets/ez2bp76v19r8fe6z.js","assets/go7l4undgduzhpu4.js","assets/6z6k4wcwlalmi1bg.js","assets/v9tq8skh492co5f7.js","assets/cvpamzns278krs3m.js","assets/iagp2jcji2t03oau.js","assets/f68k4ugryy2jpwx6.js","assets/nhwwej1nq0zrd7sc.js","assets/pe8ywbhnoyw8nh7x.js","assets/kqk364vqajm3ef4s.js","assets/bc6i8r3so3xfrbx5.js","assets/lllvts5l5s2vjiws.js","assets/edq8x536rzwy4yri.js","assets/ixm5afbeb75lko04.js","assets/kl8e1j5xz2qbnt6p.js","assets/h6tkmfeos3swk2os.js","assets/fztudpvcqhvo4u5f.js","assets/isjdmfmhzv09v01t.js","assets/iblr65f8t1ak4ylc.js","assets/hwq5di1yj8z2bv6u.js","assets/l1yl2n0b5bzaq5yo.js","assets/nop528mi40rbomk4.js","assets/g5qowqlldw3pjwq5.js","assets/3wskuqyiqfykh8r6.js","assets/gg6ciw8ontacr9zn.js","assets/fiffpp2sbjm1vd0g.js","assets/dgyx6xrb9nzwfr2e.js","assets/dt32garv6atq227d.js","assets/iej0cupg2dqkmejt.js","assets/lh2f8w3jw6gfwe8h.js","assets/jk8w36bsokizpx57.js","assets/h8iqwerlhkvc1v69.js","assets/eqg9i5jw0fdlp5vz.js","assets/eysiwnaqmmqzajxn.js","assets/kfsk6n8r7at6bl3s.js","assets/mkbb9zqmvvvwhysy.js","assets/mx0r5fx5hozf2ncz.js","assets/pdkcc38s2mn6aiw6.js","assets/l2rn92lx8yhq2aza.js","assets/jmpl8qq7stp387cb.js","assets/mwnoz9q3z3z43lze.js","assets/f0tty6e28vr4sf6x.js","assets/b1sf0q3fzcx03tca.js","assets/shared-mk6ngktc.css","assets/sso-jmjhjxeo.css","assets/1pqbzx6ftjc6o4ba.js","assets/jaw8yejxjg9ww24z.js"])))=>i.map(i=>d[i]);
var ho=Object.defineProperty;var Bn=t=>{throw TypeError(t)};var mo=(t,e,s)=>e in t?ho(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var J=(t,e,s)=>mo(t,typeof e!="symbol"?e+"":e,s),sn=(t,e,s)=>e.has(t)||Bn("Cannot "+s);var i=(t,e,s)=>(sn(t,e,"read from private field"),s?s.call(t):e.get(t)),W=(t,e,s)=>e.has(t)?Bn("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),N=(t,e,s,a)=>(sn(t,e,"write to private field"),a?a.call(t,s):e.set(t,s),s),j=(t,e,s)=>(sn(t,e,"access private method"),s);var gs=(t,e,s,a)=>({set _(o){N(t,e,o,s)},get _(){return i(t,e,a)}});import{H as $e,cs as bt,j as n,N as Le,aC as Ns,eq as Ft,fa as ya,bD as go,r as m,aD as va,R as De,ag as Es,c as se,e7 as os,P as ee,A as te,K as P,cm as xt,c2 as yt,as as is,aN as Is,B as Rt,bw as fo,aU as po,fE as bo,cN as be,cA as xo,ax as yo,bt as jt,cq as Tn,fF as vo,L as So,ak as Oe,fG as Sa,eb as wa,c8 as ot,cD as wo,cE as _o,cH as Zt,a7 as un,cF as Gn,cG as Co,J as gt,fH as Mo,cK as ko,aQ as ws,a_ as To,cz as _a,O as Ke,d9 as jo,ai as Yt,fn as Ao,cX as Xt,eh as _s,bz as No,aM as jn,bM as ie,fz as Wn,bQ as nt,w as Eo,fy as Io,fI as Ca,fm as Fo,u as Ro,E as Ma,dl as Po,a4 as Hn,fJ as Do,fK as Lo,bB as Oo,cx as Uo,fL as zo,cZ as Bo,c_ as Go,c$ as Wo,el as Ho,fM as Vn,fk as Vo,bA as qo,aT as $o,bo as Ko}from"./lcs8amlj6u8bbv8a.js";import{d as Fs,H as ka,c as An,A as Qo,I as Yo,S as Xo,G as Jo,z as Zo,u as ei,a as ti,J as si,m as ni,K as ai,f as oi}from"./bh0082zbrhxuz40n.js";import{G as ii,T as ri}from"./njn0f8av1tadybv7.js";import{hI as Ta,cq as Nn,cp as En,cs as In,n as Rs,b4 as Fn,hJ as li,B as ja,eA as qn,A as Aa,eF as ci,bJ as Na,aD as Ea,gr as Ia,hK as di,dK as ui,aw as hi,hL as mi,a9 as gi,cw as fi,c5 as pi,ey as bi,u as ts,hM as Cs,dO as Fa,eo as xi,a4 as yi,hN as Ra,dS as Ms,ep as vi,al as rs,aX as Si,bR as hn,a7 as wi,hO as _i,r as xs,eD as Ci,aR as mn,hP as Mi,hQ as ki,fU as Ti,U as ji,b3 as Ai,gp as Ni,s as Pa,hR as Da,hS as Ei,_ as Ii,hT as Fi,v as ks,ap as at,bu as Ts,bY as Rn,eJ as Ri,hU as Pi,eG as La,a2 as Di,hV as Li,hW as Oi,cM as Ui,b2 as zi,hX as Bi,hY as Gi,hZ as Wi,h_ as Hi,h$ as Vi,i0 as qi,i1 as $i,i2 as Ki,i3 as Qi,eB as Yi,k as Xi,l as Ji,i4 as Zi,ez as er,E as tr,ac as sr,cP as nr,i5 as $n,hs as Kn,i6 as ar,g3 as or,bk as ir,i7 as rr,es as lr,et as cr,w as dr,i8 as ur,gy as Qn,i9 as hr,ia as mr,ib as gr,P as fr,ic as pr,id as br,ie as xr,ig as yr,ih as vr,ii as Sr,ij as wr}from"./mhenka8kv2zo8x47.js";import{a as _r,t as gn,T as Oa,H as Cr,b as Mr,c as kr,d as Tr,e as jr,M as fn}from"./loet3bipmnyhxrpc.js";import{P as Ar,v as Nr,C as pn,w as Er,l as Ir,x as nn,y as Fr,u as Rr,z as an,F as Pr,T as Dr}from"./kqk364vqajm3ef4s.js";import{e as Lr,i as es,A as Ua,T as B,f as vt,g as Pn,u as Dn,b as Or,L as za,d as Ps,c as Ds,M as Yn,j as Xn,N as Ur,q as Ls,a as zr,O as Br,P as Gr,Q as Wr,k as Hr,h as Vr,R as qr,S as $r,U as Ba,D as Ga,V as Kr,W as Qr,w as Wa,X as Ha}from"./da7sd4hwg4eqhiwg.js";import{W as Yr,G as Xr,H as Jr,I as Ln}from"./edq8x536rzwy4yri.js";import{m as It}from"./e71ale0donucmqlv.js";import{U as Zr,b as Va,bc as Os,aI as el,ba as tl,bP as qa,bQ as $a,a2 as sl,bR as nl,bS as al,aF as ol,bT as il,w as rl,ax as Ka,ay as Qa,a as ll,aw as cl,av as dl,S as ul,t as hl,bg as ml,bK as gl}from"./bpr39nud2l2ri9ju.js";import{H as fl}from"./jjhbz2f55nra93ws.js";import{G as pl,L as bl}from"./n4x0fwkgh432ur0z.js";import{d as xl,r as yl}from"./bmtyh8d7r5fvwhhs.js";import{T as vl,u as Sl,M as Ya,a as wl,b as _l,C as Cl,W as Ml}from"./h6tkmfeos3swk2os.js";import{b as kl,C as Tl}from"./l7ytbj9gb513juvf.js";import"./ea5q0o3p88hcmcfr.js";import{D as ke,$ as Xa}from"./h04vyl1015sqd1gr.js";import{a as jl,G as Al}from"./n3joydq5axjpjkil.js";import{M as Nl}from"./h8iqwerlhkvc1v69.js";import{I as El}from"./fjlgvoec747liyzq.js";function on({label:t,tooltip:e,Icon:s}){return n.jsxs("div",{className:"flex items-center gap-1 text-sm font-semibold opacity-70",children:[s&&n.jsx(s,{className:"icon-sm"}),n.jsx("div",{children:t}),n.jsx(Rs,{label:e,children:n.jsx(Va,{className:"icon-sm ml-1"})})]})}function Il({clientThreadId:t,gizmoId:e}){const s=$e(),a=Ta(),o=Nn(),r=En(),{data:l}=In(e,!1,r),c=!!e,d=bt(),h=Lr(t);return r?d&&(!h||c)?n.jsx(on,{label:s.formatMessage(Mt.temporaryChat),tooltip:s.formatMessage(Mt.temporaryChatTooltip),Icon:Zr}):a&&!o&&!d?n.jsx(on,{label:s.formatMessage(Mt.memoryOff),tooltip:s.formatMessage(Mt.memoryOffTooltip)}):l&&(l==null?void 0:l.memoryFullPct)>=100?n.jsx(on,{label:s.formatMessage(Mt.memoryFull),tooltip:s.formatMessage(Mt.memoryFullTooltip)}):null:null}const Mt=Le({temporaryChat:{id:"ConversationPrivacyIndicator.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatTooltip:{id:"ConversationPrivacyIndicator.temporaryChatTooltip",defaultMessage:"Temporary Chats won't appear in your history, and ChatGPT won't remember anything you talk about."},memoryOff:{id:"ConversationPrivacyIndicator.memoryOff",defaultMessage:"Memory Off"},memoryOffTooltip:{id:"ConversationPrivacyIndicator.memoryOffTooltip",defaultMessage:"ChatGPT won't remember anything you talk about in this conversation."},memoryFull:{id:"2Eq+5y",defaultMessage:"Memory Full"},memoryFullTooltip:{id:"dNA8jQ",defaultMessage:"ChatGPT's memory is full. You can forget existing memories to make space."}}),Jn=4;function Fl(t){const{layer:e}=Ns("4031588851"),{layer:s}=Ft("4031588851");return t?e.get("enable_new_homepage",!1):s.get("enable_new_homepage",!1)}function Rl(){const{layer:t}=Ft("4031588851"),e=t.get("autocomplete_qualified_start_date","2099-09-13T00:00:00Z"),s=Fn();return!!s&&s.created*1e3>=new Date(e).getTime()}function Pl(t){const{layer:e}=Ns("3533083032"),{layer:s}=Ft("3533083032");return t?e.get("enable_new_homepage_anon",!1):s.get("enable_new_homepage_anon",!1)}function Dl(t){const{layer:e}=Ns("4031588851"),{layer:s}=Ft("4031588851");return t?e.get("enable_new_autocomplete_homepage",!1):s.get("enable_new_autocomplete_homepage",!1)}function Ll(t){return n.jsx(Yr,{children:e=>n.jsx(Ol,{...t,composerController:e})})}function Ol({clientThreadId:t,currentModelId:e,onRequestCompletion:s,composerController:a}){const o=es(t),r=Ua(t),l=ya(),c=go(),[d,h]=m.useState([]),y=m.useRef(!1);li(a);const b=va("589604007").value,{layer:p}=Ft("4031588851"),{promptStarters:x,isSuccess:S,isError:g}=_r(o&&!r,t,c?4:8,b,!0,e),f=!!d.find(A=>!!A.requires_file_upload),u=m.useCallback(A=>{const R=a.getCurrentText();return R&&`${A.title}${A.body}`.toLowerCase().startsWith(R.toLowerCase())},[a]),v=m.useCallback(A=>{const R=a.getCurrentText(),M=A.title+A.body;return u(A)?{...A,title:R,body:M.slice(R.length)}:{...A,title:M,body:""}},[a,u]),w=m.useCallback((A=!1)=>{h(R=>!R.some(u)&&R.length>0?[]:A?R:R.map(v))},[u,v]),C=(A,R,M)=>{const $=`${A.title} `;h([]),a.focus(),a.setText($),requestAnimationFrame(()=>{const H=((x==null?void 0:x.filter(G=>G.theme===A.theme))??[]).map(G=>({...G,title:`${G.title} `,type:qn.Autocomplete}));h(H),H.length>0&&gn(H,t),Mr(A,M,t)})},T=x==null?void 0:x.reduce((A,R)=>(R.theme&&!A[R.theme]&&(A[R.theme]=R),A),{}),D=[];if(T)for(const A in T)D.push(T[A]);const E=D&&D.length>0,q=!!(S&&E),O=Jn-d.filter(u).length,k=p.get("autocomplete_mode","HARDCODED"),L=m.useCallback(ja(async A=>{const R=a.getCurrentText();if(!R||R.length<2||R.length>80){h([]);return}if(!y.current)try{const $=(await De.generateAutocompletions(R,A)).completions.map(H=>({id:Es(),type:qn.Autocomplete,title:R,body:H.slice(R.length),oneliner:H,prompt:H})).filter(u).map(v);h(H=>{const G=H.filter(u),Z=$.filter(ve=>!G.some(Te=>Te.title===ve.title&&Te.body===ve.body)).slice(0,Jn-G.length);return[...G,...Z]}),$.length>0&&gn($,t)}catch{}},k==="BING"?150:200),[a,k,v]),z=m.useCallback(()=>{w(),O>0&&L(O)},[L,w,O]);m.useEffect(()=>{y.current&&h([])},[y]);const I=m.useMemo(()=>k==="HARDCODED"?w:z,[k,z,w]),Y=m.useCallback(()=>{a instanceof Xr&&w(!0),a.getCurrentText().indexOf(`
`)>0&&h([])},[a,w]);return n.jsx(n.Fragment,{children:n.jsx(Aa,{children:(g||S)&&n.jsx(n.Fragment,{children:n.jsx(Oa,{isStaticSharedThread:!1,showInlineEmbeddedDisplay:!1,withVerticalPadding:!0,withHorizontalPadding:!0,clientThreadId:t,children:n.jsxs(Cr,{children:[n.jsx(Ul,{}),n.jsx("div",{className:"w-full",children:n.jsx(Ar,{clientThreadId:t,isNewThread:o,currentModelId:e,onRequestCompletion:s,showPromptStarters:!1,composerController:a,autocompletions:d,requiresFileUpload:f,onComposerInput:I,onComposerChange:Y,onAutocompleteSelect:(A,R,M)=>{h([R[M]])},onTaggingDropdownClose:()=>{y.current=!1},onTaggingDropdownOpen:()=>{y.current=!0},hideHeader:!0})}),q&&n.jsx(zl,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},promptStarters:D,onSelectStarterPrompt:C,isSendBlocked:l,clientThreadId:t,className:"h-8"})]})})})})})}function Ul(){const{layer:t}=Ft("4031588851"),e=t.get("headline_option","HELP_WITH"),a=$e().formatMessage(e==="WHERE_TO_START"?bn.whereShouldWeStart:bn.whatCanIHelpWith),[o,r]=m.useState(1),[l,c]=m.useState(!0),d=20;return m.useEffect(()=>{let h;return o<a.length?h=setTimeout(()=>{r(o+1)},d):l&&(h=setTimeout(()=>{c(!1)},500)),()=>clearTimeout(h)},[a,o,l]),n.jsx("div",{className:"text-center",children:n.jsxs("div",{className:"mb-7 inline-flex justify-center text-2xl font-semibold leading-9",children:[n.jsx("h1",{children:a.substring(0,o)}),n.jsx("h1",{className:"result-streaming transition-opacity",style:{opacity:l?1:0},children:n.jsx("span",{})})]})})}function zl({promptStarters:t,onSelectStarterPrompt:e,isSendBlocked:s,clientThreadId:a,...o}){return n.jsx(It.div,{...o,children:n.jsx(Hl,{starterPrompts:t,onSelectStarterPrompt:e,disabled:s,clientThreadId:a})})}const Bl=/\s/;function Gl({starterPrompt:t,starterPrompts:e,index:s,disabled:a,onSelectStarterPrompt:o}){const r=t.theme??t.title,l=Bl.test(r);return n.jsxs("button",{className:"relative flex items-center gap-1.5 rounded-full border border-token-border-light px-3 py-2 text-start text-[13px] shadow-xxs transition enabled:hover:bg-token-main-surface-secondary disabled:cursor-not-allowed xl:gap-2 xl:text-[14px]",disabled:a,onClick:()=>o(t,e,s),children:[n.jsx(ci,{starterPrompt:t,useV2Colors:!0}),n.jsx("div",{className:se("max-w-full text-balance text-gray-600 dark:text-gray-500",l?"break-word":"break-all"),children:r})]})}function Zn({starterPrompts:t,onSelectStarterPrompt:e,disabled:s,clientThreadId:a,children:o}){return m.useEffect(()=>{gn(t,a)},[a]),n.jsxs("ul",{className:"flex max-w-3xl flex-wrap items-stretch justify-center gap-2 xl:mx-3 xl:gap-2.5",children:[t.map((r,l)=>n.jsx(It.li,{initial:{opacity:0},animate:{opacity:1},transition:{delay:l*.03},exit:{opacity:0},children:n.jsx(Gl,{starterPrompt:r,starterPrompts:t,index:l,disabled:s,onSelectStarterPrompt:e})},r.id??l)),o]})}function Wl({clientThreadId:t,onClick:e}){m.useEffect(()=>{kr(t)},[t]);const s=$e();return n.jsx("button",{className:"relative flex max-w-full items-center gap-2 text-balance rounded-full border border-token-border-light px-3 py-2 text-start text-[14px] text-gray-600 shadow-xxs transition enabled:hover:bg-token-main-surface-secondary disabled:cursor-not-allowed dark:text-gray-500",onClick:()=>{Tr(t),e()},children:s.formatMessage(bn.moreStarterPrompts)})}function Hl({starterPrompts:t,onSelectStarterPrompt:e,disabled:s,clientThreadId:a}){const[o,r]=m.useState(4),l=4,c=t.slice(0,l),d=t.slice(l,o).map(h=>({...h,isAdditional:!0}));return n.jsxs("div",{className:"mt-7 flex flex-col flex-wrap gap-y-2.5",children:[n.jsx("div",{children:n.jsx(Zn,{starterPrompts:c,onSelectStarterPrompt:e,disabled:s,clientThreadId:a,children:t.length>o&&n.jsx(Wl,{clientThreadId:a,onClick:()=>{r(t.length)}})})}),d&&d.length>0&&n.jsx(Zn,{starterPrompts:d,onSelectStarterPrompt:e,disabled:s,clientThreadId:a})]})}const bn=Le({whatCanIHelpWith:{id:"SplashScreenV2.whatCanIHelpWith",defaultMessage:"What can I help with?"},whereShouldWeStart:{id:"SplashScreenV2.whereShouldWeStart",defaultMessage:"Where should we start?"},moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}});function Vl({children:t}){const e=Na(Ea.AG8PqS2q),{eligible:s,isLoading:a}=xl(),{doesUserHaveAnyAccountsWithPlusFeatures:o}=os(),r=s&&!a;if(m.useEffect(()=>{r&&ee.logEvent(te.gpt4oNUXTooltipShown)},[r]),!r)return n.jsx(n.Fragment,{children:t});const l=()=>{ee.logEvent(te.gpt4oNUXTooltipDismissed),e.markAsViewed()};return n.jsx(Ia,{side:"bottom",show:!0,title:n.jsx(P,{...rn.title,values:{modelName:"GPT‑4o"}}),onDismiss:l,sideOffset:0,theme:"default",description:n.jsx(P,{...o?rn.bodyPaidFinal:rn.bodyFreeFinal,values:{modelName:"GPT‑4o",anotherModelName:"GPT‑4"}}),children:t})}const rn=Le({title:{id:"1kewDD",defaultMessage:"Introducing {modelName}"},bodyPaidFinal:{id:"Z6KHqN",defaultMessage:"You can now try our newest model, {modelName}. It’s faster than {anotherModelName}, better at understanding images, and speaks more languages."},bodyFreeFinal:{id:"w8Y79o",defaultMessage:"You now have limited access to our latest model, {modelName}. It’s smarter, understands images, can browse the web, and speaks more languages."}}),ql=xt(()=>yt(()=>import("./lhrumd8iwzl4tc38.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30])).then(t=>t.GizmoUsingAsOwnerNotice)),$l=({clientThreadId:t})=>{const e=gi(d=>d.activeStageSidebar),s=B.getServerThreadId(t),a=fi(Is.WorkspaceShareLinks),{isUnauthenticated:o}=Rt(),r=bt(),l=a&&s&&!o&&!r,c=!e;return n.jsx("div",{className:"flex items-center gap-2 pr-1 leading-[0]",children:n.jsx(Tl,{showShareButton:l,showProfileDropdown:c,clientThreadId:t})})};function Kl({clientThreadId:t,gizmoId:e}){var r;const s=di(),{data:a}=Fs(e),o=is();return n.jsxs(n.Fragment,{children:[n.jsxs(ui,{className:"max-md:hidden",children:[n.jsxs("div",{className:"absolute start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2",children:[a!=null&&(o==null?void 0:o.isWorkspaceAccount())&&((r=a.gizmo.tags)==null?void 0:r.includes(hi.WorkspaceDisabled))&&n.jsx(ql,{gizmo:a}),n.jsx(Il,{gizmoId:e,clientThreadId:t})]}),n.jsx(Vl,{children:n.jsxs("div",{className:"flex items-center gap-0 overflow-hidden",children:[n.jsx(kl,{clientThreadId:t}),n.jsx(vl,{clientThreadId:t})]})}),n.jsx($l,{clientThreadId:t})]}),s&&n.jsx(mi,{})]})}function Ja({clientThreadId:t}){const e=vt(t);return Pn()?null:n.jsx(Kl,{gizmoId:e,clientThreadId:t})}function Ql({clientThreadId:t,currentModelId:e,onRequestCompletion:s,enableV2Homepage:a}){const o=bt();let r=n.jsx(bl,{}),l;return o?(l=n.jsx(Yl,{}),r=n.jsx(po,{className:"mb-6 h-12 w-12"})):t!=null?(l=a?n.jsx(Ll,{clientThreadId:t,currentModelId:e,onRequestCompletion:s}):n.jsx(jr,{clientThreadId:t}),r=null):l=n.jsx(Xl,{}),n.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-token-text-primary",children:[r,l]})}function Yl({gizmo:t}){const e=Ta(),s=t?Jr(t.tools):!1,a=is();return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"mb-5 text-2xl font-semibold",children:n.jsx(P,{...ht.temporaryChat})}),n.jsxs("div",{className:"max-w-sm text-center text-sm font-normal text-token-text-tertiary",children:[n.jsx(P,{...a!=null&&a.isWorkspaceAccount()?e?ht.temporaryChatBizMemoryAvailable:ht.temporaryChatBizMemoryUnavailable:e?ht.temporaryChatDescriptionMemoryAvailable:ht.temporaryChatDescriptionMemoryUnavailable}),s&&n.jsx("div",{className:"mt-3",children:n.jsx(P,{...ht.temporaryChatDescriptionGptActions,values:{link:o=>n.jsx("a",{href:"https://help.openai.com/en/articles/8914046-temporary-chat-faq",target:"_blank",className:"underline",rel:"noreferrer",children:o})}})})]})]})}function Xl(){return n.jsx("div",{className:"mb-5 text-2xl font-semibold",children:n.jsx(P,{...ht.howCanIHelpYouToday})})}function Jl({clientThreadId:t,currentModelId:e,onRequestCompletion:s,enableV2Homepage:a}){const o=vt(t),r=pi(),l=ya(),{data:c}=Fs(o),d=bi(),h=fo(()=>navigator.windowControlsOverlay);return(r!=null||o!=null)&&c==null?null:n.jsxs("div",{className:"relative h-full",children:[n.jsx("div",{className:h!=null&&h.visible?se("absolute right-[calc(100dvw-env(titlebar-area-width,100dvw)-env(titlebar-area-x,0))]",d?"left-[env(titlebar-area-x,0)]":"left-0"):"absolute left-0 right-0",children:n.jsx(Ja,{clientThreadId:t})}),c!=null?n.jsx(pl,{gizmo:c,showStarterPrompts:!0,disableStarterPrompts:l}):n.jsx(Ql,{clientThreadId:t,currentModelId:e,onRequestCompletion:s,enableV2Homepage:a})]})}const ht=Le({temporaryChat:{id:"GizmoLanding.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatBizMemoryAvailable:{id:"g1opBW",defaultMessage:"This chat won't appear in your history and won't use or create memories."},temporaryChatBizMemoryUnavailable:{id:"fQmbtG",defaultMessage:"This chat won't appear your conversation history."},temporaryChatDescriptionMemoryAvailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryAvailable",defaultMessage:"This chat won't appear in history, use or create memories, or be used to train our models. For safety purposes, we may keep a copy for up to 30 days."},temporaryChatDescriptionMemoryUnavailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryUnavailable",defaultMessage:"This chat won't appear in history or be used to train our models. For safety purposes, we may keep a copy of this chat for up to 30 days."},temporaryChatDescriptionGptActions:{id:"GizmoLanding.temporaryChatDescriptionGptActions",defaultMessage:"Any data shared with a third party through GPT actions are subject to the third party's privacy policy. <link>Learn more</link>"},howCanIHelpYouToday:{id:"GizmoLanding.howCanIHelpYouToday",defaultMessage:"How can I help you today?"}});function Za(t){const s=Dn(t)==="root",a=Or(t),o=ts(a),{serviceStatus:r}=m.useContext(bo),l=Cs(),{isUnauthenticated:c}=Rt(),d=za(t);return!s&&!o&&!(r!=null&&r.oof)&&!l.displayingSideBySideFeedback&&!c&&!d}const eo=({clientThreadId:t,message:e})=>{var v,w,C,T,D,E,q,O;const s=Sl(),a=ka(),o=Na(Ea.ModelSwitcherAutoDowngrade),{categories:r}=An({isRegen:!0}),l=Qo({clientThreadId:t}),{doesUserHaveAnyAccountsWithPlusFeatures:c}=os(),d=Yo()!=null,h=[];for(const k of r){if(Fa(k))continue;const{defaultModel:L,label:z,tagline:I,categoryId:Y,subscriptionLevel:A,subcategory:R}=k,M=(w=(v=l[L])==null?void 0:v.regenerate)==null?void 0:w[0];h.push({label:z,value:L,subtitle:I,icon:n.jsx(Ya,{className:"icon-md h-4 w-4",categoryId:Y,type:"filled"}),modelSwitcherDeny:M,subscriptionLevel:A,subcategory:R})}const y=Zl(t,e.nodeId),b=(C=e.message.metadata)==null?void 0:C.model_slug,p=(T=s.find(k=>k.value===b))==null?void 0:T.name,x=b!=null?a[b]:void 0,S=(x==null?void 0:x.enabledTools)||[],g=ec(d,y,b),f=(D=e.message.metadata)==null?void 0:D.model_adjustments,u=c&&o.eligible&&!o.isLoading&&p&&((E=h[0])==null?void 0:E.label)&&p!==((q=h[0])==null?void 0:q.label)&&(f==null?void 0:f.some(k=>k.startsWith("auto:smaller_model")));return{modelOptions:h,modelSlug:b,messageModelEnabledTools:S,animateModelLabelOnRender:g,nuxProps:{shouldRenderNux:u,usedModelName:p,largestModelName:(O=h[0])==null?void 0:O.label,announcement:o}}};function Zl(t,e){var l,c;return(c=(l=B.getTree(t).getConversationTurns(e).flatMap(d=>d.messages).filter(d=>d.message.author.role===be.Assistant&&!xo(d.message)).reverse()[1])==null?void 0:l.message.metadata)==null?void 0:c.model_slug}function ec(t,e,s){return t&&!e?!0:!!(e&&s!==e)}function tc(){const{doesUserHaveAnyAccountsWithPlusFeatures:t}=os(),{categories:e}=An();return!!t||!!e.find(Fa)}const Tt=({modelSwitcherDeny:t,value:e,label:s,subtitle:a,icon:o,onMouseEnter:r,onMouseLeave:l,onSelect:c,messageModelSlug:d,isHovered:h=!1,shouldShowUpsell:y=!1,className:b,includeCheck:p,includeRegenerate:x,justifyIcon:S,wrapIcon:g=!0})=>{const f=is(),u=!t,v=!u&&!y,w=yo(),C=()=>{if(!y){c==null||c();return}ee.logEvent(te.openModalAccountPaymentfromMessageModelPicker),ee.logRateLimitGetPlusButtonClicked({type:Tn.RATE_LIMIT,location:"message_model_switcher_dropdown",plan_type:(f==null?void 0:f.planType)??"unknown",is_hard_block:!1,hard_block_reason:"",is_new_conversation:!1}),yi(w,"Message model switcher dropdown")};return n.jsx(ke.Item,{onSelect:C,onMouseEnter:()=>u&&(r==null?void 0:r()),onMouseLeave:()=>u&&(l==null?void 0:l()),disabled:v,className:b??"radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed radix-disabled:hover:bg-transparent",children:n.jsxs(Rs,{label:t&&n.jsx(xi,{modelSwitcherDeny:t}),className:"flex w-full items-center justify-between gap-2",sideOffset:0,children:[n.jsxs("div",{className:se("flex items-center gap-3",S==="right"&&"w-full"),children:[!!o&&(g?n.jsx("span",{className:se("flex h-7 w-7 items-center justify-center rounded-full bg-token-main-surface-secondary",S==="right"&&"order-10 ml-auto"),children:o}):o),n.jsxs("div",{children:[n.jsx("div",{children:s}),n.jsx("div",{className:se({"text-sm text-token-text-secondary":!v},{"text-sm text-token-text-quaternary":v}),children:a})]})]}),y?n.jsx(jt,{color:"secondary",size:"small",children:n.jsx(P,{id:"54fmrA",defaultMessage:"Get Plus"})}):n.jsx(sc,{messageModelSlug:d,isHovered:h,modelSwitcherDeny:t,optionModelSlug:e,includeCheck:p,includeRegenerate:x})]})})},sc=({modelSwitcherDeny:t,optionModelSlug:e,isHovered:s,messageModelSlug:a,includeRegenerate:o=!0,includeCheck:r=!0})=>{let l=null;if(t)switch(t.reason){case Tn.RATE_LIMIT:l=tl;break;default:l=Va;break}if(t)return n.jsx(l,{className:"icon-md"});const c=!!o&&n.jsx(Os,{className:se("icon-md hidden text-token-text-tertiary",{"group-hover:block":s})});return a===e&&r?n.jsxs(n.Fragment,{children:[n.jsx(el,{className:se("icon-md text-token-text-primary",{"group-hover:hidden":s})}),c]}):c};function nc({className:t,clientThreadId:e,message:s,onModelSelect:a,onDropdownChange:o}){var R;const r=$e(),[l,c]=m.useState(null),[d,h]=m.useState(!1),[y,b]=m.useState(!1),p=tc(),x=Za(e),S=vt(e),g=eo({clientThreadId:e,message:s}),f=(R=s.message.metadata)==null?void 0:R.model_slug,{modelOptions:u,modelSlug:v,animateModelLabelOnRender:w,nuxProps:C,messageModelEnabledTools:T}=g,D=Ra(s.message),E=T.includes(Ms.Search),q=m.useMemo(()=>u.find(M=>M.value==f),[u,f]),{doesUserHaveAnyAccountsWithPlusFeatures:O}=os(),k=m.useRef(null),L=M=>{M||setTimeout(()=>{k.current&&k.current.blur()},10)};if(m.useEffect(()=>{L(d)},[d]),!p||S)return null;const z=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:r.formatMessage(ea.search),icon:n.jsx(qa,{className:"icon-sm"}),condition:E&&!D},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:r.formatMessage(ea.nosearch),icon:n.jsx($a,{className:"icon-sm"}),condition:E&&D}];let I,Y;C.shouldRenderNux?(I=oc,Y={title:n.jsx(P,{id:"g/+2Hh",defaultMessage:"Optimized your response"}),description:n.jsx(P,{id:"H0Flqm",defaultMessage:"Used {usedModelName} for a faster response that saves your limited {largestModelName} messages",values:{usedModelName:C.usedModelName,largestModelName:C.largestModelName}}),markAsViewed:C.announcement.markAsViewed}):(I=ac,Y={label:x?n.jsx(P,{id:"LBYK9a",defaultMessage:"Change model"}):n.jsx(P,{id:"nygjPN",defaultMessage:"Used {modelName}",values:{modelName:C.usedModelName}})});const A=x&&u.some(M=>ss(M,O));return n.jsxs(ke.Root,{onOpenChange:M=>{x&&(h(M),o(M),L(M)),M&&ee.logEvent(te.conversationOpenMessageModelSelector,{has_get_plus_button:A})},children:[n.jsx(I,{...Y,children:n.jsx(Xa,{ref:k,className:se("cursor-pointer",t),onMouseEnter:()=>b(!0),onMouseLeave:()=>b(!1),children:n.jsx(xn,{modelSlug:v,animateModelLabelOnRender:w,isDropdownOpen:d,isRegenerateEnabled:x,isHovered:y})})}),x&&n.jsxs(ke.Content,{className:"z-30 origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[u.map(M=>{var Z;const $=ss(M,O),{value:H,...G}=M;return n.jsx(Tt,{value:H,onSelect:()=>a({requestedModelId:H}),onMouseEnter:()=>c(H),onMouseLeave:()=>c(null),isHovered:l===H,messageModelSlug:(Z=s.message.metadata)==null?void 0:Z.model_slug,shouldShowUpsell:$,...G},H)}),!!q&&n.jsxs(n.Fragment,{children:[n.jsx(ke.Separator,{}),z.filter(M=>M.condition).map(M=>n.jsx(Tt,{onSelect:()=>a({requestedModelId:q.value,extraStreamParams:M.extraStreamParams}),includeRegenerate:!0,onMouseEnter:()=>c(M.key),onMouseLeave:()=>c(null),isHovered:l===M.key,messageModelSlug:f,includeCheck:!1,...q,label:M.label,subtitle:"",icon:M.icon},M.key))]})]})]})}function xn({modelSlug:t,animateModelLabelOnRender:e,isDropdownOpen:s,isRegenerateEnabled:a,isHovered:o,isRegenLabel:r=!1,animateShortLabel:l,omitIcon:c}){const[d,h]=m.useState("initial"),{categories:y}=An({isRegen:!!r});m.useEffect(()=>{if(e){const u=setTimeout(()=>h("show"),500),v=setTimeout(()=>h("initial"),2e3);return()=>{clearTimeout(u),clearTimeout(v)}}h("initial")},[e]);const b=y.find(({defaultModel:u})=>u===t),p=t===Xo?{categoryId:"gpt_3.5",shorterLabel:"3.5"}:{},{categoryId:x,shorterLabel:S}=b??p,g={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},f=s?"visible":o?"show":d;return n.jsxs(It.div,{initial:"initial",animate:f,className:"flex items-center pb-0",children:[!c&&(r?n.jsx(Os,{className:"icon-md"}):x&&n.jsx(Ya,{type:"outline",categoryId:x,className:"icon-md h-4 w-4"})),(a||l)&&n.jsx(It.span,{className:"overflow-hidden text-clip whitespace-nowrap text-sm",variants:g,transition:{type:"tween",duration:.18},children:S}),a&&n.jsx(sl,{className:se("icon-sm",{"text-token-text-quaternary":!o&&!r},{"text-token-text-secondary":o&&!r})})]})}function ac({children:t,label:e}){return n.jsx(Rs,{label:e,sideOffset:0,children:t})}function oc({children:t,title:e,description:s,markAsViewed:a}){return n.jsx(Ia,{show:!0,side:"bottom",sideOffset:-4,title:e,description:s,badge:"beta",onDismiss:a,dismissOnOutsideClick:!0,children:t})}function ss(t,e){const{modelSwitcherDeny:s,subscriptionLevel:a}=t;return!!s&&s.reason===Tn.RATE_LIMIT&&a===vo.PLUS&&!e}const ea=Le({search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),ic=m.memo(nc),ta=So.IndepthFeedbackDismissedAt;function rc(){const[t,e]=m.useState(()=>{const a=localStorage.getItem(ta);return a?lc(new Date(a)):!1}),s=m.useCallback(()=>{e(!0),localStorage.setItem(ta,new Date().toISOString())},[]);return[t,s]}function lc(t){const e=new Date;return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}function cc({clientThreadId:t,conversationLeafId:e,trigger:s,variantIds:a}){const o=a.find(y=>y!==e),r=rs(y=>y.forceIndepthFeedback&&y.forceIndepthFeedbackPrompt),l=Oe.getExperimentValue({experimentName:"4146182738",key:s==="paragen"?"enable_indepth_feedback_paragen":"enable_indepth_feedback_thumbsdown",defaultValue:!1,shouldLogExposure:!1}),c=Oe.getExperimentValue({experimentName:"4146182738",key:s==="paragen"?"indepth_feedback_paragen_prompt":"indepth_feedback_thumbsdown_prompt",defaultValue:"",shouldLogExposure:!1}),d=o?B.getTree(t).getTextFromNode(o):"NONE";return(r||(l?c:"")).replace("{paragen_losing_response}",d)}function dc({clientThreadId:t,conversationLeafId:e,trigger:s,variantIds:a}){const[o,r]=rc(),l=hc({clientThreadId:t}),c=cc({clientThreadId:t,conversationLeafId:e,trigger:s,variantIds:a}),d=()=>{r(),ee.logEventWithStatsig(te.messageIndepthFeedbackDeclined,"chatgpt_indepth_feedback_declined",{trigger:s})},h=()=>{const y=new hn;l(e,{intent:"indepth_feedback"},c,y),ee.logEventWithStatsig(te.messageIndepthFeedbackAccepted,"chatgpt_indepth_feedback_accepted",{trigger:s})};return o||!c?null:n.jsx(Si,{content:n.jsx(P,{...ln.indepthFeedbackPrompt}),primaryCtaText:n.jsx(P,{...ln.indepthFeedbackAcceptButton}),onPrimaryCtaClick:h,secondaryCtaText:n.jsx(P,{...ln.indepthFeedbackRejectButton}),onSecondaryCtaClick:d})}function uc(t){const e=t.rating==="thumbsDown"?"thumbsDown":vi(["original","new"],t.inlineComparisonRating)?"paragen":void 0,s=rs(o=>o.forceIndepthFeedback);if(!e||s||e==="paragen"||Oe.getExperimentValue({experimentName:"4146182738",key:"enable_indepth_feedback_thumbsdown",defaultValue:!1,shouldLogExposure:!0}))return e}function hc({clientThreadId:t}){const e=m.useContext(Sa),s=Ps.getConversationMode(t);return(o,r,l,c)=>{e({type:wa.Next,promptId:o,eventMetadata:r,focusOnNewCompletion:!0,cancelActiveRequests:!1,completionMetadata:{conversationMode:s},useDefaultModel:!1,appendMessages:[{id:Es(),author:{role:be.System},content:{content_type:ot.Text,parts:[l]},metadata:{is_indepth_feedback:!0,indepth_feedback_prompt:l}}],turnTracker:c})}}const ln=Le({indepthFeedbackPrompt:{id:"qEHwDx",defaultMessage:"Would you like to tell ChatGPT more about your feedback, so it can improve its responses?"},indepthFeedbackAcceptButton:{id:"IeyTQ7",defaultMessage:"Continue"},indepthFeedbackRejectButton:{id:"+o5xmp",defaultMessage:"Not now"},indepthFeedbackRejectAlwaysButton:{id:"Qdko+f",defaultMessage:"Don't ask again"}});function mc({clientThreadId:t,conversationMode:e}){const s=Nr(t);return({id:o,eventMetadata:r,turnTracker:l,requestedModelId:c,systemMessage:d,juice:h,extraStreamParams:y})=>{const p=B.getTree(t).getConversationTurns(o),x=p==null?void 0:p[(p==null?void 0:p.length)-1].variantIds,S=(x==null?void 0:x.length)===1&&(y==null?void 0:y.forceUseSearch)===void 0,g=S?{...r,intent:"comparison_implicit"}:r;s({id:o,requestedModelId:c,eventMetadata:g,focusOnNewCompletion:!0,variantPurpose:S?"comparison_implicit":"none",conversationMode:e??Ps.getConversationMode(t),useDefaultModel:!1,appendMessages:d?[{id:Es(),author:{role:be.System},content:{content_type:ot.Text,parts:[d]},metadata:{exclude_after_next_user_message:!0}}]:void 0,juice:h,turnTracker:l,extraStreamParams:y})}}const kt=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,to=new Set,yn=typeof process=="object"&&process?process:{},so=(t,e,s,a)=>{typeof yn.emitWarning=="function"?yn.emitWarning(t,e,s,a):console.error(`[${s}] ${e}: ${t}`)};let js=globalThis.AbortController,sa=globalThis.AbortSignal;var pa;if(typeof js>"u"){sa=class{constructor(){J(this,"onabort");J(this,"_onabort",[]);J(this,"reason");J(this,"aborted",!1)}addEventListener(a,o){this._onabort.push(o)}},js=class{constructor(){J(this,"signal",new sa);e()}abort(a){var o,r;if(!this.signal.aborted){this.signal.reason=a,this.signal.aborted=!0;for(const l of this.signal._onabort)l(a);(r=(o=this.signal).onabort)==null||r.call(o,a)}}};let t=((pa=yn.env)==null?void 0:pa.LRU_CACHE_IGNORE_AC_WARNING)!=="1";const e=()=>{t&&(t=!1,so("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}const gc=t=>!to.has(t),Ze=t=>t&&t===Math.floor(t)&&t>0&&isFinite(t),no=t=>Ze(t)?t<=Math.pow(2,8)?Uint8Array:t<=Math.pow(2,16)?Uint16Array:t<=Math.pow(2,32)?Uint32Array:t<=Number.MAX_SAFE_INTEGER?ys:null:null;class ys extends Array{constructor(e){super(e),this.fill(0)}}var At;const mt=class mt{constructor(e,s){J(this,"heap");J(this,"length");if(!i(mt,At))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new s(e),this.length=0}static create(e){const s=no(e);if(!s)return[];N(mt,At,!0);const a=new mt(e,s);return N(mt,At,!1),a}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}};At=new WeakMap,W(mt,At,!1);let vn=mt;var ba,xa,je,Se,Ae,Ne,Nt,oe,Ee,ae,Q,F,fe,we,ge,ce,Ie,de,Fe,Re,_e,Pe,st,pe,_,wn,ft,Ve,ns,Ce,ao,pt,Et,as,et,tt,_n,vs,Ss,K,Cn,Jt;const zn=class zn{constructor(e){W(this,_);W(this,je);W(this,Se);W(this,Ae);W(this,Ne);W(this,Nt);J(this,"ttl");J(this,"ttlResolution");J(this,"ttlAutopurge");J(this,"updateAgeOnGet");J(this,"updateAgeOnHas");J(this,"allowStale");J(this,"noDisposeOnSet");J(this,"noUpdateTTL");J(this,"maxEntrySize");J(this,"sizeCalculation");J(this,"noDeleteOnFetchRejection");J(this,"noDeleteOnStaleGet");J(this,"allowStaleOnFetchAbort");J(this,"allowStaleOnFetchRejection");J(this,"ignoreFetchAbort");W(this,oe);W(this,Ee);W(this,ae);W(this,Q);W(this,F);W(this,fe);W(this,we);W(this,ge);W(this,ce);W(this,Ie);W(this,de);W(this,Fe);W(this,Re);W(this,_e);W(this,Pe);W(this,st);W(this,pe);W(this,ft,()=>{});W(this,Ve,()=>{});W(this,ns,()=>{});W(this,Ce,()=>!1);W(this,pt,e=>{});W(this,Et,(e,s,a)=>{});W(this,as,(e,s,a,o)=>{if(a||o)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0});J(this,ba,"LRUCache");const{max:s=0,ttl:a,ttlResolution:o=1,ttlAutopurge:r,updateAgeOnGet:l,updateAgeOnHas:c,allowStale:d,dispose:h,disposeAfter:y,noDisposeOnSet:b,noUpdateTTL:p,maxSize:x=0,maxEntrySize:S=0,sizeCalculation:g,fetchMethod:f,noDeleteOnFetchRejection:u,noDeleteOnStaleGet:v,allowStaleOnFetchRejection:w,allowStaleOnFetchAbort:C,ignoreFetchAbort:T}=e;if(s!==0&&!Ze(s))throw new TypeError("max option must be a nonnegative integer");const D=s?no(s):Array;if(!D)throw new Error("invalid max value: "+s);if(N(this,je,s),N(this,Se,x),this.maxEntrySize=S||i(this,Se),this.sizeCalculation=g,this.sizeCalculation){if(!i(this,Se)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(f!==void 0&&typeof f!="function")throw new TypeError("fetchMethod must be a function if specified");if(N(this,Nt,f),N(this,st,!!f),N(this,ae,new Map),N(this,Q,new Array(s).fill(void 0)),N(this,F,new Array(s).fill(void 0)),N(this,fe,new D(s)),N(this,we,new D(s)),N(this,ge,0),N(this,ce,0),N(this,Ie,vn.create(s)),N(this,oe,0),N(this,Ee,0),typeof h=="function"&&N(this,Ae,h),typeof y=="function"?(N(this,Ne,y),N(this,de,[])):(N(this,Ne,void 0),N(this,de,void 0)),N(this,Pe,!!i(this,Ae)),N(this,pe,!!i(this,Ne)),this.noDisposeOnSet=!!b,this.noUpdateTTL=!!p,this.noDeleteOnFetchRejection=!!u,this.allowStaleOnFetchRejection=!!w,this.allowStaleOnFetchAbort=!!C,this.ignoreFetchAbort=!!T,this.maxEntrySize!==0){if(i(this,Se)!==0&&!Ze(i(this,Se)))throw new TypeError("maxSize must be a positive integer if specified");if(!Ze(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");j(this,_,ao).call(this)}if(this.allowStale=!!d,this.noDeleteOnStaleGet=!!v,this.updateAgeOnGet=!!l,this.updateAgeOnHas=!!c,this.ttlResolution=Ze(o)||o===0?o:1,this.ttlAutopurge=!!r,this.ttl=a||0,this.ttl){if(!Ze(this.ttl))throw new TypeError("ttl must be a positive integer if specified");j(this,_,wn).call(this)}if(i(this,je)===0&&this.ttl===0&&i(this,Se)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!i(this,je)&&!i(this,Se)){const E="LRU_CACHE_UNBOUNDED";gc(E)&&(to.add(E),so("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",E,zn))}}static unsafeExposeInternals(e){return{starts:i(e,Re),ttls:i(e,_e),sizes:i(e,Fe),keyMap:i(e,ae),keyList:i(e,Q),valList:i(e,F),next:i(e,fe),prev:i(e,we),get head(){return i(e,ge)},get tail(){return i(e,ce)},free:i(e,Ie),isBackgroundFetch:s=>{var a;return j(a=e,_,K).call(a,s)},backgroundFetch:(s,a,o,r)=>{var l;return j(l=e,_,Ss).call(l,s,a,o,r)},moveToTail:s=>{var a;return j(a=e,_,Jt).call(a,s)},indexes:s=>{var a;return j(a=e,_,et).call(a,s)},rindexes:s=>{var a;return j(a=e,_,tt).call(a,s)},isStale:s=>{var a;return i(a=e,Ce).call(a,s)}}}get max(){return i(this,je)}get maxSize(){return i(this,Se)}get calculatedSize(){return i(this,Ee)}get size(){return i(this,oe)}get fetchMethod(){return i(this,Nt)}get dispose(){return i(this,Ae)}get disposeAfter(){return i(this,Ne)}getRemainingTTL(e){return i(this,ae).has(e)?1/0:0}*entries(){for(const e of j(this,_,et).call(this))i(this,F)[e]!==void 0&&i(this,Q)[e]!==void 0&&!j(this,_,K).call(this,i(this,F)[e])&&(yield[i(this,Q)[e],i(this,F)[e]])}*rentries(){for(const e of j(this,_,tt).call(this))i(this,F)[e]!==void 0&&i(this,Q)[e]!==void 0&&!j(this,_,K).call(this,i(this,F)[e])&&(yield[i(this,Q)[e],i(this,F)[e]])}*keys(){for(const e of j(this,_,et).call(this)){const s=i(this,Q)[e];s!==void 0&&!j(this,_,K).call(this,i(this,F)[e])&&(yield s)}}*rkeys(){for(const e of j(this,_,tt).call(this)){const s=i(this,Q)[e];s!==void 0&&!j(this,_,K).call(this,i(this,F)[e])&&(yield s)}}*values(){for(const e of j(this,_,et).call(this))i(this,F)[e]!==void 0&&!j(this,_,K).call(this,i(this,F)[e])&&(yield i(this,F)[e])}*rvalues(){for(const e of j(this,_,tt).call(this))i(this,F)[e]!==void 0&&!j(this,_,K).call(this,i(this,F)[e])&&(yield i(this,F)[e])}[(xa=Symbol.iterator,ba=Symbol.toStringTag,xa)](){return this.entries()}find(e,s={}){for(const a of j(this,_,et).call(this)){const o=i(this,F)[a],r=j(this,_,K).call(this,o)?o.__staleWhileFetching:o;if(r!==void 0&&e(r,i(this,Q)[a],this))return this.get(i(this,Q)[a],s)}}forEach(e,s=this){for(const a of j(this,_,et).call(this)){const o=i(this,F)[a],r=j(this,_,K).call(this,o)?o.__staleWhileFetching:o;r!==void 0&&e.call(s,r,i(this,Q)[a],this)}}rforEach(e,s=this){for(const a of j(this,_,tt).call(this)){const o=i(this,F)[a],r=j(this,_,K).call(this,o)?o.__staleWhileFetching:o;r!==void 0&&e.call(s,r,i(this,Q)[a],this)}}purgeStale(){let e=!1;for(const s of j(this,_,tt).call(this,{allowStale:!0}))i(this,Ce).call(this,s)&&(this.delete(i(this,Q)[s]),e=!0);return e}info(e){const s=i(this,ae).get(e);if(s===void 0)return;const a=i(this,F)[s],o=j(this,_,K).call(this,a)?a.__staleWhileFetching:a;if(o===void 0)return;const r={value:o};if(i(this,_e)&&i(this,Re)){const l=i(this,_e)[s],c=i(this,Re)[s];if(l&&c){const d=l-(kt.now()-c);r.ttl=d,r.start=Date.now()}}return i(this,Fe)&&(r.size=i(this,Fe)[s]),r}dump(){const e=[];for(const s of j(this,_,et).call(this,{allowStale:!0})){const a=i(this,Q)[s],o=i(this,F)[s],r=j(this,_,K).call(this,o)?o.__staleWhileFetching:o;if(r===void 0||a===void 0)continue;const l={value:r};if(i(this,_e)&&i(this,Re)){l.ttl=i(this,_e)[s];const c=kt.now()-i(this,Re)[s];l.start=Math.floor(Date.now()-c)}i(this,Fe)&&(l.size=i(this,Fe)[s]),e.unshift([a,l])}return e}load(e){this.clear();for(const[s,a]of e){if(a.start){const o=Date.now()-a.start;a.start=kt.now()-o}this.set(s,a.value,a)}}set(e,s,a={}){var p,x,S,g,f;if(s===void 0)return this.delete(e),this;const{ttl:o=this.ttl,start:r,noDisposeOnSet:l=this.noDisposeOnSet,sizeCalculation:c=this.sizeCalculation,status:d}=a;let{noUpdateTTL:h=this.noUpdateTTL}=a;const y=i(this,as).call(this,e,s,a.size||0,c);if(this.maxEntrySize&&y>this.maxEntrySize)return d&&(d.set="miss",d.maxEntrySizeExceeded=!0),this.delete(e),this;let b=i(this,oe)===0?void 0:i(this,ae).get(e);if(b===void 0)b=i(this,oe)===0?i(this,ce):i(this,Ie).length!==0?i(this,Ie).pop():i(this,oe)===i(this,je)?j(this,_,vs).call(this,!1):i(this,oe),i(this,Q)[b]=e,i(this,F)[b]=s,i(this,ae).set(e,b),i(this,fe)[i(this,ce)]=b,i(this,we)[b]=i(this,ce),N(this,ce,b),gs(this,oe)._++,i(this,Et).call(this,b,y,d),d&&(d.set="add"),h=!1;else{j(this,_,Jt).call(this,b);const u=i(this,F)[b];if(s!==u){if(i(this,st)&&j(this,_,K).call(this,u)){u.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:v}=u;v!==void 0&&!l&&(i(this,Pe)&&((p=i(this,Ae))==null||p.call(this,v,e,"set")),i(this,pe)&&((x=i(this,de))==null||x.push([v,e,"set"])))}else l||(i(this,Pe)&&((S=i(this,Ae))==null||S.call(this,u,e,"set")),i(this,pe)&&((g=i(this,de))==null||g.push([u,e,"set"])));if(i(this,pt).call(this,b),i(this,Et).call(this,b,y,d),i(this,F)[b]=s,d){d.set="replace";const v=u&&j(this,_,K).call(this,u)?u.__staleWhileFetching:u;v!==void 0&&(d.oldValue=v)}}else d&&(d.set="update")}if(o!==0&&!i(this,_e)&&j(this,_,wn).call(this),i(this,_e)&&(h||i(this,ns).call(this,b,o,r),d&&i(this,Ve).call(this,d,b)),!l&&i(this,pe)&&i(this,de)){const u=i(this,de);let v;for(;v=u==null?void 0:u.shift();)(f=i(this,Ne))==null||f.call(this,...v)}return this}pop(){var e;try{for(;i(this,oe);){const s=i(this,F)[i(this,ge)];if(j(this,_,vs).call(this,!0),j(this,_,K).call(this,s)){if(s.__staleWhileFetching)return s.__staleWhileFetching}else if(s!==void 0)return s}}finally{if(i(this,pe)&&i(this,de)){const s=i(this,de);let a;for(;a=s==null?void 0:s.shift();)(e=i(this,Ne))==null||e.call(this,...a)}}}has(e,s={}){const{updateAgeOnHas:a=this.updateAgeOnHas,status:o}=s,r=i(this,ae).get(e);if(r!==void 0){const l=i(this,F)[r];if(j(this,_,K).call(this,l)&&l.__staleWhileFetching===void 0)return!1;if(i(this,Ce).call(this,r))o&&(o.has="stale",i(this,Ve).call(this,o,r));else return a&&i(this,ft).call(this,r),o&&(o.has="hit",i(this,Ve).call(this,o,r)),!0}else o&&(o.has="miss");return!1}peek(e,s={}){const{allowStale:a=this.allowStale}=s,o=i(this,ae).get(e);if(o===void 0||!a&&i(this,Ce).call(this,o))return;const r=i(this,F)[o];return j(this,_,K).call(this,r)?r.__staleWhileFetching:r}async fetch(e,s={}){const{allowStale:a=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,ttl:l=this.ttl,noDisposeOnSet:c=this.noDisposeOnSet,size:d=0,sizeCalculation:h=this.sizeCalculation,noUpdateTTL:y=this.noUpdateTTL,noDeleteOnFetchRejection:b=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:p=this.allowStaleOnFetchRejection,ignoreFetchAbort:x=this.ignoreFetchAbort,allowStaleOnFetchAbort:S=this.allowStaleOnFetchAbort,context:g,forceRefresh:f=!1,status:u,signal:v}=s;if(!i(this,st))return u&&(u.fetch="get"),this.get(e,{allowStale:a,updateAgeOnGet:o,noDeleteOnStaleGet:r,status:u});const w={allowStale:a,updateAgeOnGet:o,noDeleteOnStaleGet:r,ttl:l,noDisposeOnSet:c,size:d,sizeCalculation:h,noUpdateTTL:y,noDeleteOnFetchRejection:b,allowStaleOnFetchRejection:p,allowStaleOnFetchAbort:S,ignoreFetchAbort:x,status:u,signal:v};let C=i(this,ae).get(e);if(C===void 0){u&&(u.fetch="miss");const T=j(this,_,Ss).call(this,e,C,w,g);return T.__returned=T}else{const T=i(this,F)[C];if(j(this,_,K).call(this,T)){const k=a&&T.__staleWhileFetching!==void 0;return u&&(u.fetch="inflight",k&&(u.returnedStale=!0)),k?T.__staleWhileFetching:T.__returned=T}const D=i(this,Ce).call(this,C);if(!f&&!D)return u&&(u.fetch="hit"),j(this,_,Jt).call(this,C),o&&i(this,ft).call(this,C),u&&i(this,Ve).call(this,u,C),T;const E=j(this,_,Ss).call(this,e,C,w,g),O=E.__staleWhileFetching!==void 0&&a;return u&&(u.fetch=D?"stale":"refresh",O&&D&&(u.returnedStale=!0)),O?E.__staleWhileFetching:E.__returned=E}}get(e,s={}){const{allowStale:a=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,status:l}=s,c=i(this,ae).get(e);if(c!==void 0){const d=i(this,F)[c],h=j(this,_,K).call(this,d);return l&&i(this,Ve).call(this,l,c),i(this,Ce).call(this,c)?(l&&(l.get="stale"),h?(l&&a&&d.__staleWhileFetching!==void 0&&(l.returnedStale=!0),a?d.__staleWhileFetching:void 0):(r||this.delete(e),l&&a&&(l.returnedStale=!0),a?d:void 0)):(l&&(l.get="hit"),h?d.__staleWhileFetching:(j(this,_,Jt).call(this,c),o&&i(this,ft).call(this,c),d))}else l&&(l.get="miss")}delete(e){var a,o,r,l;let s=!1;if(i(this,oe)!==0){const c=i(this,ae).get(e);if(c!==void 0)if(s=!0,i(this,oe)===1)this.clear();else{i(this,pt).call(this,c);const d=i(this,F)[c];if(j(this,_,K).call(this,d)?d.__abortController.abort(new Error("deleted")):(i(this,Pe)||i(this,pe))&&(i(this,Pe)&&((a=i(this,Ae))==null||a.call(this,d,e,"delete")),i(this,pe)&&((o=i(this,de))==null||o.push([d,e,"delete"]))),i(this,ae).delete(e),i(this,Q)[c]=void 0,i(this,F)[c]=void 0,c===i(this,ce))N(this,ce,i(this,we)[c]);else if(c===i(this,ge))N(this,ge,i(this,fe)[c]);else{const h=i(this,we)[c];i(this,fe)[h]=i(this,fe)[c];const y=i(this,fe)[c];i(this,we)[y]=i(this,we)[c]}gs(this,oe)._--,i(this,Ie).push(c)}}if(i(this,pe)&&((r=i(this,de))!=null&&r.length)){const c=i(this,de);let d;for(;d=c==null?void 0:c.shift();)(l=i(this,Ne))==null||l.call(this,...d)}return s}clear(){var e,s,a;for(const o of j(this,_,tt).call(this,{allowStale:!0})){const r=i(this,F)[o];if(j(this,_,K).call(this,r))r.__abortController.abort(new Error("deleted"));else{const l=i(this,Q)[o];i(this,Pe)&&((e=i(this,Ae))==null||e.call(this,r,l,"delete")),i(this,pe)&&((s=i(this,de))==null||s.push([r,l,"delete"]))}}if(i(this,ae).clear(),i(this,F).fill(void 0),i(this,Q).fill(void 0),i(this,_e)&&i(this,Re)&&(i(this,_e).fill(0),i(this,Re).fill(0)),i(this,Fe)&&i(this,Fe).fill(0),N(this,ge,0),N(this,ce,0),i(this,Ie).length=0,N(this,Ee,0),N(this,oe,0),i(this,pe)&&i(this,de)){const o=i(this,de);let r;for(;r=o==null?void 0:o.shift();)(a=i(this,Ne))==null||a.call(this,...r)}}};je=new WeakMap,Se=new WeakMap,Ae=new WeakMap,Ne=new WeakMap,Nt=new WeakMap,oe=new WeakMap,Ee=new WeakMap,ae=new WeakMap,Q=new WeakMap,F=new WeakMap,fe=new WeakMap,we=new WeakMap,ge=new WeakMap,ce=new WeakMap,Ie=new WeakMap,de=new WeakMap,Fe=new WeakMap,Re=new WeakMap,_e=new WeakMap,Pe=new WeakMap,st=new WeakMap,pe=new WeakMap,_=new WeakSet,wn=function(){const e=new ys(i(this,je)),s=new ys(i(this,je));N(this,_e,e),N(this,Re,s),N(this,ns,(r,l,c=kt.now())=>{if(s[r]=l!==0?c:0,e[r]=l,l!==0&&this.ttlAutopurge){const d=setTimeout(()=>{i(this,Ce).call(this,r)&&this.delete(i(this,Q)[r])},l+1);d.unref&&d.unref()}}),N(this,ft,r=>{s[r]=e[r]!==0?kt.now():0}),N(this,Ve,(r,l)=>{if(e[l]){const c=e[l],d=s[l];if(!c||!d)return;r.ttl=c,r.start=d,r.now=a||o();const h=r.now-d;r.remainingTTL=c-h}});let a=0;const o=()=>{const r=kt.now();if(this.ttlResolution>0){a=r;const l=setTimeout(()=>a=0,this.ttlResolution);l.unref&&l.unref()}return r};this.getRemainingTTL=r=>{const l=i(this,ae).get(r);if(l===void 0)return 0;const c=e[l],d=s[l];if(!c||!d)return 1/0;const h=(a||o())-d;return c-h},N(this,Ce,r=>{const l=s[r],c=e[r];return!!c&&!!l&&(a||o())-l>c})},ft=new WeakMap,Ve=new WeakMap,ns=new WeakMap,Ce=new WeakMap,ao=function(){const e=new ys(i(this,je));N(this,Ee,0),N(this,Fe,e),N(this,pt,s=>{N(this,Ee,i(this,Ee)-e[s]),e[s]=0}),N(this,as,(s,a,o,r)=>{if(j(this,_,K).call(this,a))return 0;if(!Ze(o))if(r){if(typeof r!="function")throw new TypeError("sizeCalculation must be a function");if(o=r(a,s),!Ze(o))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return o}),N(this,Et,(s,a,o)=>{if(e[s]=a,i(this,Se)){const r=i(this,Se)-e[s];for(;i(this,Ee)>r;)j(this,_,vs).call(this,!0)}N(this,Ee,i(this,Ee)+e[s]),o&&(o.entrySize=a,o.totalCalculatedSize=i(this,Ee))})},pt=new WeakMap,Et=new WeakMap,as=new WeakMap,et=function*({allowStale:e=this.allowStale}={}){if(i(this,oe))for(let s=i(this,ce);!(!j(this,_,_n).call(this,s)||((e||!i(this,Ce).call(this,s))&&(yield s),s===i(this,ge)));)s=i(this,we)[s]},tt=function*({allowStale:e=this.allowStale}={}){if(i(this,oe))for(let s=i(this,ge);!(!j(this,_,_n).call(this,s)||((e||!i(this,Ce).call(this,s))&&(yield s),s===i(this,ce)));)s=i(this,fe)[s]},_n=function(e){return e!==void 0&&i(this,ae).get(i(this,Q)[e])===e},vs=function(e){var r,l;const s=i(this,ge),a=i(this,Q)[s],o=i(this,F)[s];return i(this,st)&&j(this,_,K).call(this,o)?o.__abortController.abort(new Error("evicted")):(i(this,Pe)||i(this,pe))&&(i(this,Pe)&&((r=i(this,Ae))==null||r.call(this,o,a,"evict")),i(this,pe)&&((l=i(this,de))==null||l.push([o,a,"evict"]))),i(this,pt).call(this,s),e&&(i(this,Q)[s]=void 0,i(this,F)[s]=void 0,i(this,Ie).push(s)),i(this,oe)===1?(N(this,ge,N(this,ce,0)),i(this,Ie).length=0):N(this,ge,i(this,fe)[s]),i(this,ae).delete(a),gs(this,oe)._--,s},Ss=function(e,s,a,o){const r=s===void 0?void 0:i(this,F)[s];if(j(this,_,K).call(this,r))return r;const l=new js,{signal:c}=a;c==null||c.addEventListener("abort",()=>l.abort(c.reason),{signal:l.signal});const d={signal:l.signal,options:a,context:o},h=(g,f=!1)=>{const{aborted:u}=l.signal,v=a.ignoreFetchAbort&&g!==void 0;if(a.status&&(u&&!f?(a.status.fetchAborted=!0,a.status.fetchError=l.signal.reason,v&&(a.status.fetchAbortIgnored=!0)):a.status.fetchResolved=!0),u&&!v&&!f)return b(l.signal.reason);const w=x;return i(this,F)[s]===x&&(g===void 0?w.__staleWhileFetching?i(this,F)[s]=w.__staleWhileFetching:this.delete(e):(a.status&&(a.status.fetchUpdated=!0),this.set(e,g,d.options))),g},y=g=>(a.status&&(a.status.fetchRejected=!0,a.status.fetchError=g),b(g)),b=g=>{const{aborted:f}=l.signal,u=f&&a.allowStaleOnFetchAbort,v=u||a.allowStaleOnFetchRejection,w=v||a.noDeleteOnFetchRejection,C=x;if(i(this,F)[s]===x&&(!w||C.__staleWhileFetching===void 0?this.delete(e):u||(i(this,F)[s]=C.__staleWhileFetching)),v)return a.status&&C.__staleWhileFetching!==void 0&&(a.status.returnedStale=!0),C.__staleWhileFetching;if(C.__returned===C)throw g},p=(g,f)=>{var v;const u=(v=i(this,Nt))==null?void 0:v.call(this,e,r,d);u&&u instanceof Promise&&u.then(w=>g(w===void 0?void 0:w),f),l.signal.addEventListener("abort",()=>{(!a.ignoreFetchAbort||a.allowStaleOnFetchAbort)&&(g(void 0),a.allowStaleOnFetchAbort&&(g=w=>h(w,!0)))})};a.status&&(a.status.fetchDispatched=!0);const x=new Promise(p).then(h,y),S=Object.assign(x,{__abortController:l,__staleWhileFetching:r,__returned:void 0});return s===void 0?(this.set(e,S,{...d.options,status:void 0}),s=i(this,ae).get(e)):i(this,F)[s]=S,S},K=function(e){if(!i(this,st))return!1;const s=e;return!!s&&s instanceof Promise&&s.hasOwnProperty("__staleWhileFetching")&&s.__abortController instanceof js},Cn=function(e,s){i(this,we)[s]=e,i(this,fe)[e]=s},Jt=function(e){e!==i(this,ce)&&(e===i(this,ge)?N(this,ge,i(this,fe)[e]):j(this,_,Cn).call(this,i(this,we)[e],i(this,fe)[e]),j(this,_,Cn).call(this,i(this,ce),e),N(this,ce,e))};let Sn=zn;function fc({conversationId:t,messageId:e}){const[s,a]=m.useState(!1),o=m.useRef({isMediaSourceAvailable:On(),mediaSourceFormat:Un()??"n/a",playPromise:null,shouldAbortQueuedPlayback:!1}).current,r=$e(),{voiceName:l}=wi(),c=`${t}.${e}.${l}`,d=wo(),h=_o(S=>{var g;return S.isPlaying&&S.sourceUrl===((g=Me.get(c))==null?void 0:g.src)}),y=m.useCallback(async()=>{if(!d)return;a(!0);const S={isMediaSourceAvailable:o.isMediaSourceAvailable,format:o.mediaSourceFormat};try{const g=await pc({key:c,message_id:e,conversation_id:t,voice:l,onStreamingError:f=>{Zt.readAloud.error(f,S),a(!1),un.danger(r.formatMessage(na.playbackError,{error:f.message}))},onStreamingStart:()=>{a(!1)}});if(o.shouldAbortQueuedPlayback){o.shouldAbortQueuedPlayback=!1;return}d.changeSource(g),o.playPromise=d.play()}catch(g){Zt.readAloud.error(g,S),a(!1),un.danger(r.formatMessage(na.playbackError,{error:g.message}))}},[d,c,e,t,l,o,r]),b=m.useCallback(()=>{const S=Gn();S&&(o.playPromise?o.playPromise.then(()=>{S.stop(),o.playPromise=null}):S.stop())},[o]),p=m.useCallback(()=>{var g;const S=Gn();S&&(S.state.isPlaying&&S.state.sourceUrl===((g=Me.get(c))==null?void 0:g.src)?b():(Zt.readAloud.click({isMediaSourceAvailable:o.isMediaSourceAvailable,format:o.mediaSourceFormat}),y()))},[c,o,y,b]);m.useEffect(()=>{s&&h&&a(!1)},[s,h]);const x=m.useRef(c);return m.useEffect(()=>{x.current=c}),m.useEffect(()=>(o.shouldAbortQueuedPlayback=!1,()=>{var f;const S=Co();S.isPlaying&&S.sourceUrl===((f=Me.get(x.current))==null?void 0:f.src)?b():o.shouldAbortQueuedPlayback=!0}),[o,b]),{togglePlayback:p,isPlaying:h,isLoading:s}}async function oo({message_id:t,conversation_id:e,voice:s}){const a=await De.synthesize({message_id:t,conversation_id:e,voice:s,format:Un()}),o=a.headers.get("content-type")??"audio/aac";return{response:a,format:o}}async function pc(t){return On()?xc(t):bc(t)}async function bc({key:t,...e}){const s=Me.get(t);if(s!=null&&s.blob)return s.src;const{response:a,format:o}=await oo(e),r=await a.arrayBuffer(),l=new Blob([r],{type:o}),c=io({key:t,src:URL.createObjectURL(l),format:o,blob:l});return Me.set(t,c),c.src}async function xc({key:t,onStreamingError:e,onStreamingStart:s,...a}){let o=Me.get(t);o!=null&&o.streaming&&(Me.delete(t),o=void 0);let r,l;const c=vc(),d=new c;if(o)r=o,r.src=URL.createObjectURL(d);else{const{format:b,response:p}=await oo(a);l=p,r=io({key:t,src:URL.createObjectURL(d),format:b})}const h=yc(r.id),y={sourceopen:async()=>{var x,S;h("sourceopen");const b=d.addSourceBuffer(r.format),p=async()=>{b.updating&&await new Promise(g=>b.addEventListener("updateend",g,{once:!0}))};if(r.segments.length&&!r.streaming){h("streaming from cache"),r.streaming=!0,s();for(const g of r.segments)b.appendBuffer(g),await p();d.readyState==="open"&&d.endOfStream(),r.streaming=!1,h("done streaming from cache");return}if(l){h("fetching audio");try{const g=(x=l.body)==null?void 0:x.getReader();if(!g)return;for(;((S=Me.get(t))==null?void 0:S.id)===r.id;){const{done:f,value:u}=await g.read();if(f){h("done streaming"),r.streaming=!1,d.readyState==="open"&&d.endOfStream();break}if(!Array.from(d.sourceBuffers).includes(b)){h("stop streaming, source buffer removed"),r.streaming=!1;break}r.streaming||(h("start streaming"),r.streaming=!0,s()),b.appendBuffer(u),r.segments.push(u),await p()}}catch(g){if(h("error while streaming",g),r.streaming=!1,d.readyState==="open")try{d.endOfStream("network")}catch(f){Zt.readAloud.error(f)}Me.delete(t),e(g)}}},sourceclose:()=>{var b;h("sourceclose"),r.streaming&&(r.streaming=!1,((b=Me.get(t))==null?void 0:b.id)===r.id&&(h("sourceclosed while streaming, cleaning up cache"),Me.delete(t)))},sourceended:gt};for(const[b,p]of Object.entries(y))d.addEventListener(b,()=>{try{return p()}catch(x){Zt.readAloud.error(x)}});return Me.set(t,r),r.src}const na=Le({playbackError:{id:"useVoiceReadAloudAudio.playbackError",defaultMessage:"Failed to play message"}}),yc=t=>gt;function vc(){return On()?window.MediaSource:null}function On(){return!!Un()}function Un(){if("MediaSource"in window){const t=e=>Mo(e)&&MediaSource.isTypeSupported(e);if(t("audio/aac"))return"aac";if(t("audio/mpeg"))return"mp3";if(t("audio/ogg"))return"ogg"}}const io=t=>({id:Es(),segments:[],streaming:!1,...t}),Me=new Sn({max:50,dispose:t=>{URL.revokeObjectURL(t.src)}}),Sc=m.memo(function(e){var l;const s=(l=ws("1923022511"))==null?void 0:l.value,a=Ds(e.conversationId),{errCode:o}=Ln(e.message);if(!s||!a||o)return null;const r=ko.getAudioAssetPointers(e.message.message)[0];return r?n.jsx(wc,{audioAssetPointer:r,conversationId:a}):n.jsx(_c,{...e,conversationId:a})});function wc({audioAssetPointer:t,conversationId:e}){const{isLoading:s,isPlaying:a,togglePlayback:o}=_i({audioAssetPointer:t,conversationId:e});return n.jsx(ro,{onClick:o,isPlaying:a,isLoading:s,playText:As.replay,playIcon:nl})}function _c({conversationId:t,message:e}){const{isLoading:s,isPlaying:a,togglePlayback:o}=fc({conversationId:t,messageId:e.message.id});return n.jsx(ro,{onClick:o,isPlaying:a,isLoading:s,playText:As.play,playIcon:al})}function ro({onClick:t,isPlaying:e,isLoading:s,playText:a,playIcon:o}){let r,l;const c=$e();return s?(r=To,l=As.loading):e?(r=ol,l=As.stop):(r=o,l=a),n.jsx(xs,{icon:r,label:l?c.formatMessage(l):void 0,disabled:s,onClick:t,style:e||s?{visibility:"visible"}:void 0,testId:"voice-play-turn-action-button"})}const As={replay:{id:"VoiceReadOutLoudButton.replay",defaultMessage:"Replay",description:"The tooltip for the replay button"},play:{id:"VoiceReadOutLoudButton.play",defaultMessage:"Read aloud",description:"The tooltip for the read aloud button"},stop:{id:"VoiceReadOutLoudButton.stop",defaultMessage:"Stop",description:"The tooltip for the stop button"},loading:{id:"VoiceReadOutLoudButton.loading",defaultMessage:"Loading",description:"The tooltip for the spinner"}},Cc="bg-token-main-surface-primary text-token-text-primary",Mc="openai",aa=["bg-blue-300 text-white"];function kc(t){return aa[((t==null?void 0:t.charCodeAt(0))??0)%aa.length]}const fs=({children:t})=>n.jsx("div",{className:"pt-0",children:n.jsx("div",{className:se(m.isValidElement(t)&&t.type===mn?"gizmo-bot-avatar":"gizmo-shadow-stroke","flex h-8 w-8 items-center justify-center overflow-hidden rounded-full"),children:t})});function Mn({messages:t,isUserTurn:e,avatarClassName:s,gizmo:a,showInlineEmbeddedDisplay:o=!1}){var x;const r="medium",l=t[0],c=(x=l==null?void 0:l.message.metadata)==null?void 0:x.shared_conversation_id,d=c!=null,h=Fn(),{gizmoEditorData:y,mode:b}=Ci();let p=n.jsx(fs,{children:n.jsx(mn,{className:s??Cc,iconName:Mc,size:r})});return a?p=n.jsx(fs,{children:n.jsx(jl,{gizmoId:a.gizmo.id,className:"h-full w-full"})}):y!=null&&b==="test"&&(p=n.jsx(Al,{isFirstParty:!1,src:y.profilePictureUrl,className:"h-8 w-8 first:pt-[3px]"})),n.jsx("div",{children:e?d||o?n.jsx(fs,{children:n.jsx(mn,{className:kc(c),iconName:"user",size:r})}):n.jsx(fs,{children:n.jsx(Mi,{user:h,size:r})}):p})}const ps="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function Tc({className:t,clientThreadId:e,message:s,onModelSelect:a,onDropdownChange:o,canRegenerateResponse:r}){var z;const l=va("566128514").value,[c,d]=m.useState(null),[h,y]=m.useState(!1),[b,p]=m.useState(!1),x=vt(e),S=eo({clientThreadId:e,message:s}),g=(z=s.message.metadata)==null?void 0:z.model_slug,{modelOptions:f,modelSlug:u,animateModelLabelOnRender:v,messageModelEnabledTools:w}=S,C=Ra(s.message),T=w.includes(Ms.Search),D=m.useMemo(()=>f.find(I=>I.value===g),[f,g]),E=m.useRef(null),{doesUserHaveAnyAccountsWithPlusFeatures:q}=os(),O=I=>{I||setTimeout(()=>{E.current&&E.current.blur()},10)};if(m.useEffect(()=>{O(h)},[h]),za(e))return null;const L=r&&f.some(I=>ss(I,q));return x?null:n.jsxs(ke.Root,{onOpenChange:I=>{r&&(y(I),o(I),O(I)),I&&ee.logEvent(te.conversationOpenMessageModelSelector,{has_get_plus_button:L,is_new_regen_dropdown:!0})},children:[r?n.jsx(Ac,{label:n.jsx(P,{id:"wDs5sz",defaultMessage:"Switch model"}),children:n.jsx(Xa,{ref:E,className:se("cursor-pointer",t),onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),children:n.jsx(xn,{modelSlug:u,animateModelLabelOnRender:v,isDropdownOpen:h,isRegenerateEnabled:r,isHovered:b,isRegenLabel:!0,omitIcon:!1})})}):n.jsx("button",{className:se("cursor-pointer",t),onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),children:n.jsx(xn,{modelSlug:u,animateModelLabelOnRender:v,isDropdownOpen:!1,isRegenerateEnabled:!1,isHovered:b,omitIcon:l,animateShortLabel:!0})}),r&&n.jsxs(ke.Content,{className:"z-30 min-w-fit origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[n.jsx(ke.Item,{disabled:!0,className:"pb-0 pt-2",children:n.jsx("span",{className:"text-token-text-secondary",children:n.jsx(P,{id:"bFLh5u",defaultMessage:"Switch model"})})}),n.jsx(jc,{onModelSelect:a,messageModelSlug:g,omitModelIcons:l,modelOptions:f,setHoveredOption:d,hoveredOption:c,retryOption:D,lastResponseUsedSearch:C,modelSupportsSearch:T,doesUserHaveAnyAccountsWithPlusFeatures:q})]})]})}function jc({modelOptions:t,messageModelSlug:e,onModelSelect:s,omitModelIcons:a,setHoveredOption:o,hoveredOption:r,retryOption:l,lastResponseUsedSearch:c,modelSupportsSearch:d,doesUserHaveAnyAccountsWithPlusFeatures:h}){const y=$e(),[b,p]=m.useMemo(()=>ki(t,u=>u.subcategory),[t]),x=m.useMemo(()=>{const u=new Map;return b.forEach(v=>{var C;const w=v.subcategory;w&&(u.has(w)||u.set(w,[]),(C=u.get(w))==null||C.push(v))}),u},[b]),S=se("icon-sm",a&&"order-10 ml-auto text-token-text-tertiary icon-md"),g=a?"right":"left",f=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:y.formatMessage(cn.search),icon:n.jsx(qa,{className:S}),condition:d&&!c},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:y.formatMessage(cn.nosearch),icon:n.jsx($a,{className:S}),condition:d&&c}];return n.jsxs(n.Fragment,{children:[p.map(u=>{const{value:v,...w}=u;return n.jsx(Tt,{value:v,onSelect:()=>s({requestedModelId:v}),includeRegenerate:!1,onMouseEnter:()=>o(v),onMouseLeave:()=>o(null),isHovered:r===v,messageModelSlug:e,includeCheck:!1,shouldShowUpsell:ss(u,h),className:ps,...w,icon:a?n.jsx("span",{className:S}):w.icon,justifyIcon:g,wrapIcon:!a},v)}),[...x.entries()].map(([u,v])=>n.jsxs(ke.Sub,{children:[n.jsx(ke.SubMenuTrigger,{children:n.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:u})}),n.jsx(ke.Portal,{children:n.jsx(ke.SubContent,{className:"min-w-fit",children:v.map(w=>{const{value:C,...T}=w;return n.jsx(Tt,{value:C,onSelect:()=>s({requestedModelId:C}),includeRegenerate:!1,onMouseEnter:()=>o(C),onMouseLeave:()=>o(null),isHovered:r===C,messageModelSlug:e,includeCheck:!1,className:ps,...T,icon:null,justifyIcon:g,wrapIcon:!a,shouldShowUpsell:ss(w,h)},u+"-"+C)})})})]},u)),!!l&&n.jsxs(n.Fragment,{children:[n.jsx(ke.Separator,{}),n.jsx(Tt,{onSelect:()=>s({requestedModelId:l.value}),includeRegenerate:!0,onMouseEnter:()=>o(l.value),onMouseLeave:()=>o(null),messageModelSlug:e,includeCheck:!1,className:ps,...l,label:y.formatMessage(cn.tryAgain),subtitle:l.label,icon:n.jsx(Os,{className:S}),justifyIcon:g,wrapIcon:!a},l.value),f.filter(u=>u.condition).map(u=>n.jsx(Tt,{onSelect:()=>s({requestedModelId:l.value,extraStreamParams:u.extraStreamParams}),includeRegenerate:!1,onMouseEnter:()=>o(u.key),onMouseLeave:()=>o(null),isHovered:r===u.key,messageModelSlug:e,includeCheck:!1,className:ps,...l,label:u.label,subtitle:"",icon:u.icon,justifyIcon:g,wrapIcon:!a},u.key))]})]})}function Ac({children:t,label:e}){return n.jsx(Rs,{label:e,sideOffset:0,children:t})}const cn=Le({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Nc=m.memo(Tc);function kn({messages:t,isMemoryEnabled:e,isMemoryFull:s,gizmoId:a,isParagen:o}){const[r,l]=m.useState(!1),[c,d]=m.useState(!1),{eligible:h,isLoading:y}=Ti(),b=e&&!s,p=t.filter((g,f)=>{const u=t[f+1],w=(u==null?void 0:u.message.recipient)==="assistant"&&(u==null?void 0:u.message.author.role)===be.Tool&&(u==null?void 0:u.message.author.name)==="bio"&&_a(u.message)==="Model set context updated."||!u&&b;return g.message.author.role===be.Assistant&&g.message.recipient==="bio"&&w}).flatMap(g=>{const f=g.message.content.content_type;return f===ot.Text?g.message.content.parts:f===ot.Code?[g.message.content.text]:[]}).map(Ec),x=m.useMemo(()=>p.length>0,[p]);if(m.useEffect(()=>{x&&h&&!y&&ji.openModal(Ai.GlobalMemoryOnboarding)},[x,h,y]),p.length===0)return null;const S=g=>{const f=g??!c;d(f),f&&ee.logEvent(te.memoryUpdatePopoverShown,{updateCount:p.length})};return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"inline-block",onMouseEnter:()=>S(!0),onMouseLeave:()=>S(!1),children:n.jsxs(Ni,{open:c,sideOffset:4,side:"bottom",alignAgainstAnchor:"start",size:"none",className:"z-10 min-w-60 max-w-96 text-sm",onOpenChange:g=>S(g),disableAutofocus:!0,triggerButton:n.jsxs("button",{className:se("my-1 flex items-center gap-1 text-sm font-semibold outline-none",c?"text-token-text-secondary":"text-token-text-tertiary"),children:[n.jsx(il,{className:"mb-[-1px]"}),p.length===1?n.jsx(P,{id:"MemoryActionResult.memoryWriteSingular.1",defaultMessage:"Memory updated"}):n.jsx(P,{id:"MemoryActionResult.memoryWritePlural.1",defaultMessage:"Memories updated"})]}),children:[n.jsx("div",{className:"mb-2 rounded border border-token-border-light bg-token-main-surface-secondary",children:p.map((g,f)=>n.jsx("div",{className:"border-b border-token-border-light px-3 py-2 first-letter:uppercase last:border-b-0",children:g},f))}),o?n.jsx("div",{className:"text-xs text-token-text-tertiary",children:n.jsx(P,{id:"MemoryActionResult.paragenMessage",defaultMessage:"This memory will be saved if you choose this response."})}):n.jsxs("button",{className:"flex w-full items-center justify-between rounded px-3 py-2 font-semibold hover:bg-token-main-surface-secondary",onClick:()=>{l(!0),ee.logEvent(te.memoryUpdatePopoverManageButtonClicked,{updateCount:p.length})},children:[n.jsx(P,{id:"MemoryActionResult.manageMemories",defaultMessage:"Manage memories"}),n.jsx(rl,{className:"icon-md -mr-1 text-token-text-tertiary"})]})]})}),r&&n.jsx(Nl,{initialGizmoId:a,onClose:()=>l(!1)})]})}function Ec(t){const e=["The user ","The user's ","User ","User's "];for(const s of e)if(t.startsWith(s))return t.slice(s.length);return t}function oa(t,e,s){B.updateTree(t,a=>{a.updateNodeMetadata(e,{inlineComparisonRating:s})})}function ia(t){var a,o;return{is_dark_mode:t==="dark",time_since_loaded:Math.floor(performance.now()/1e3),page_height:window==null?void 0:window.innerHeight,page_width:window==null?void 0:window.innerWidth,pixel_ratio:window==null?void 0:window.devicePixelRatio,screen_height:(a=window==null?void 0:window.screen)==null?void 0:a.height,screen_width:(o=window==null?void 0:window.screen)==null?void 0:o.width}}const ra=({messages:t})=>{for(const{message:{metadata:e}}of t){const{augmented_paragen_prompt_label:s}=e??{};if(s)return s}};function Ic(t){const e=m.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});return t.stubSideBySideFeedback?n.jsx(lo,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:e,...t}):n.jsx(Fc,{...t,visibilityStateRef:e})}function Fc(t){const{clientThreadId:e,variantIds:s,variantsInStreamInfo:a}=t;if(s.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const[o]=m.useState(()=>Date.now()),r=Pa(),{resolvedTheme:l}=jo(),[c,d]=m.useMemo(()=>Da(s.join(""))()<.5?[0,1]:[1,0],[s[0],s[1]]),h=c<d?"left":"right",y=h==="left"?"right":"left",b=s[c],p=s[d],x=Yn(e,b),S=Yn(e,p),g=Yt(Xn(e,Yt(x).id)),f=Yt(Xn(e,Yt(S).id)),u=h==="left"?g:f,v=h==="left"?f:g,w=a.display_treatment==="unskippable",C=w?"unskippable_parallel_2_in_stream:a:1.0":"skippable_parallel_2_in_stream:a:1.5";m.useEffect(()=>(Cs.setState({displayingSideBySideFeedback:!0,unskippable:w}),()=>{Cs.setState({displayingSideBySideFeedback:!1,unskippable:!1})}),[w]),Ei();const T=m.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});m.useEffect(()=>Ao(Ii,{requestCompletion:()=>{var O,k,L,z;const E=(O=Xt(u.messages))==null?void 0:O.completionSampleFinishTime,q=(k=Xt(v.messages))==null?void 0:k.completionSampleFinishTime;De.submitMessageComparisonFeedback({feedback_version:C,original_message_id:(L=u.messages[u.messages.length-1])==null?void 0:L.message.id,new_message_id:(z=v.messages[v.messages.length-1])==null?void 0:z.message.id,rating:"none",conversation_id:B.getServerThreadId(e),text:"",tags:[],completion_comparison_rating:"skip",new_completion_placement:y,feedback_start_time:o,compare_step_start_time:o,original_completion_load_start_time:o,original_completion_load_end_time:E??0,new_completion_load_start_time:o,new_completion_load_end_time:q??0,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:ia(l),...T.current})}}),[g,f,e,o,C,y,u==null?void 0:u.messages,v==null?void 0:v.messages,l]);const D=E=>{var A,R,M,$;const O=B.getTree(e).getLeafFromNode(E);B.setThreadCurrentLeafId(e,O.id);const L=E===b===(h==="left"),z=(A=Xt(u.messages))==null?void 0:A.completionSampleFinishTime,I=(R=Xt(v.messages))==null?void 0:R.completionSampleFinishTime;u.messages.length>0&&oa(e,u.messages[u.messages.length-1].nodeId,L?"original":"new"),v.messages.length>0&&oa(e,v.messages[v.messages.length-1].nodeId,L?"original":"new");let Y;z==null||I==null?Y=L?"partial_load_comparison_original":"partial_load_comparison_new":Y=L?"original":"new",De.submitMessageComparisonFeedback({feedback_version:C,original_message_id:(M=u.messages[u.messages.length-1])==null?void 0:M.message.id,new_message_id:($=v.messages[v.messages.length-1])==null?void 0:$.message.id,rating:"none",conversation_id:B.getServerThreadId(e),text:"",tags:[],completion_comparison_rating:Y,new_completion_placement:y,feedback_start_time:o,compare_step_start_time:o,original_completion_load_start_time:o,original_completion_load_end_time:z??null,new_completion_load_start_time:o,new_completion_load_end_time:I??null,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:ia(l),...T.current})};return n.jsx(lo,{...t,setPreferredFeedback:D,leftVariantId:b,rightVariantId:p,leftTurn:g,rightTurn:f,hasActiveRequest:r,originalTurn:u,visibilityStateRef:T})}function Rc(t){if(!t.length)return!1;const e=t.filter(s=>s.type===at.Text||s.type===at.MultiText).filter(s=>{var a;return s.message.message.status!=="finished_successfully"&&((a=s.message.message.metadata)==null?void 0:a.snorkle_status)!==void 0});return e.length>0&&e.every(s=>{const a=s.message.message.content;return(a==null?void 0:a.content_type)===ot.Text&&a.parts.join("")===""})}function lo({setPreferredFeedback:t,leftVariantId:e,rightVariantId:s,leftTurn:a,rightTurn:o,hasActiveRequest:r,originalTurn:l,visibilityStateRef:c,...d}){const{defaultParagenLabel:h,shouldShowParagenLabels:y=!1}=Fi(),b=a&&ra(a)||h,p=o&&ra(o)||h,x=m.useMemo(()=>(a==null?void 0:a.messages)??[],[a==null?void 0:a.messages]),S=m.useMemo(()=>(o==null?void 0:o.messages)??[],[o==null?void 0:o.messages]),{avatarClassName:g}=d,f=m.useMemo(()=>ks(x),[x]),u=m.useMemo(()=>ks(S),[S]),v=En(),w=rs();function C($){var ve,Te;if(!w.showDebugConversationTurns&&!w.forceParagen)return null;let H=$===l?"ORIGINAL":"NEW";const G=$.messages[$.messages.length-1],Z=(Te=(ve=G==null?void 0:G.message)==null?void 0:ve.metadata)==null?void 0:Te.__internal;if(Z){const{model_id:xe,model_definition_slug:Pt,model_definition_virtual_model_id:Ue,alternative_model_selection_rule:ze,augmented_paragen_prompt_group_id:Qe,augmented_paragen_prompt_id:it,augmented_paragen_prompt:Ye}=Z;xe&&(H+=`
Model ID: ${xe}`),Pt&&(H+=`
Model Slug: ${Pt}`),Ue&&(H+=`
Virtual Model ID: ${Ue}`),ze&&(H+=`
Alternative Model Rule: ${ze}`),Qe&&(H+=`
Prompt Group ID: ${Qe}`),it&&(H+=`
Prompt ID: ${it}`),Ye&&(H+=`
Prompt: ${Ye}`)}return n.jsx("div",{className:"whitespace-pre-wrap text-sm text-red-500",children:H})}const[T,D]=m.useMemo(()=>[f,u].map($=>Rc($)),[f,u]),E=ts(a?_s.getRequestIdFromConversationTurn(a):"")||T,q=ts(o?_s.getRequestIdFromConversationTurn(o):"")||D,O=(a==null?void 0:a.role)===be.User,k=(o==null?void 0:o.role)===be.User,L=Nn(),z=m.useRef(null),I=m.useRef(null),Y=m.useRef(null);m.useEffect(()=>{if(z.current&&I.current&&Y.current){const $=Array(11).fill(0).map((G,Z)=>Z/10),H=new IntersectionObserver(G=>G.forEach(Z=>{Z.target===I.current?(c.current.left_visibility_initial==null&&(c.current.left_visibility_initial=Z.intersectionRatio),c.current.left_visibility_max=Math.max(c.current.left_visibility_max??0,Z.intersectionRatio)):Z.target===Y.current&&(c.current.right_visibility_initial==null&&(c.current.right_visibility_initial=Z.intersectionRatio),c.current.right_visibility_max=Math.max(c.current.right_visibility_max??0,Z.intersectionRatio))}),{root:z.current,threshold:$});return H.observe(I.current),H.observe(Y.current),()=>H.disconnect()}},[c]);const{data:A}=In(void 0,!1,v),R=A==null?void 0:A.memoryFullPct,M=typeof R=="number"&&R>=100;return n.jsxs("div",{className:"relative flex flex-col",children:[n.jsx("div",{className:"sticky top-[-1px] z-[1] text-pretty bg-token-main-surface-primary px-6 text-center text-lg md:static",children:n.jsx(P,{id:"JgCHDY",defaultMessage:"You’re giving feedback on a new version of ChatGPT."})}),n.jsx("div",{className:"text-pretty px-6 pb-5 pt-1 text-center text-sm text-token-text-secondary",children:n.jsx(P,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),n.jsx("div",{className:"sticky top-[calc(1.75em-1px)] z-[1] h-3 bg-gradient-to-b from-token-main-surface-primary from-50% to-transparent md:static"}),n.jsx("div",{className:"-mb-2 snap-x snap-mandatory overflow-x-auto px-3 pb-4 md:px-5 lg:px-10",ref:z,children:n.jsx("div",{className:"min-w-fit",children:n.jsxs("div",{className:"mx-auto flex max-w-6xl items-start gap-4 sm:gap-6",children:[n.jsxs(la,{elemRef:I,onClick:()=>{t(e)},hasActiveRequest:r,children:[n.jsxs(da,{children:[n.jsx(Mn,{messages:x,isUserTurn:O,avatarClassName:g,showInlineEmbeddedDisplay:!1}),n.jsx(ca,{children:y?n.jsx("span",{className:"font-bold text-token-text-primary",children:b}):n.jsx(P,{...ua.responseNumber,values:{responseIndex:1}})})]}),A!=null&&!O&&n.jsx(kn,{messages:x,isMemoryEnabled:L,isMemoryFull:M,isParagen:!0}),n.jsx(pn,{...d,groupedMessagesToRender:f,allGroupedMessages:f,isEditing:!1,isUserTurn:O,isCompletionRequestInProgress:E,hasActiveRequest:r,handleEnterEdit:gt,handleExitEdit:gt,shouldGrowContainer:!1}),!!a&&C(a)]}),n.jsxs(la,{elemRef:Y,onClick:()=>{t(s)},hasActiveRequest:r,children:[n.jsxs(da,{children:[n.jsx(Mn,{messages:S,isUserTurn:k,avatarClassName:g,showInlineEmbeddedDisplay:!1}),n.jsx(ca,{children:y?n.jsx("span",{className:"font-bold text-token-text-primary",children:p}):n.jsx(P,{...ua.responseNumber,values:{responseIndex:2}})})]}),A!=null&&!k&&n.jsx(kn,{messages:S,isMemoryEnabled:L,isMemoryFull:M,isParagen:!0}),n.jsx(pn,{...d,groupedMessagesToRender:u,allGroupedMessages:u,isEditing:!1,isUserTurn:k,isCompletionRequestInProgress:q,hasActiveRequest:r,handleEnterEdit:gt,handleExitEdit:gt,shouldGrowContainer:!1}),!!o&&C(o)]})]})})})]})}function la({elemRef:t,onClick:e,children:s,hasActiveRequest:a}){return n.jsxs("div",{className:"relative flex w-full min-w-[min(450px,80vw)] snap-center flex-col gap-1 truncate rounded-2xl border border-token-main-surface-tertiary bg-white p-5 text-left dark:bg-gray-700",ref:t,children:[s,a?null:n.jsx(jt,{className:"mt-4 self-start",onClick:e,children:n.jsx(P,{id:"U2EAH6",defaultMessage:"I prefer this response"})})]})}const ca=Ke.div`text-sm text-token-text-tertiary font-semibold`,da=Ke.div`flex gap-4 items-center mb-1`,ua=Le({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}"},responseChoice:{id:"ConversationTurnTwoUpFeedback.responseChoice",defaultMessage:"Choose this response"}});function Pc({clientThreadId:t,messageForRating:e,variantIds:s,conversationTurnMountTime:a}){const[o]=m.useState(()=>e.message.create_time!=null?e.message.create_time*1e3:Date.now()),[r]=m.useState(()=>Date.now());function l(c){var T,D;const d=B.getTree(t),h=s[0]||"",y=(d==null?void 0:d.getConversationTurns(h))||[],b=y[y.length-1],p=(b==null?void 0:b.messages)||[],x=p[p.length-1],S=((T=x==null?void 0:x.message)==null?void 0:T.id)||"",g=s[1]||"",f=(d==null?void 0:d.getConversationTurns(g))||[],u=f[f.length-1],v=(u==null?void 0:u.messages)||[],w=v[v.length-1],C=((D=w==null?void 0:w.message)==null?void 0:D.id)||"";De.submitMessageComparisonFeedback({feedback_version:"inline_regen_feedback:a:1.0",original_message_id:S,new_message_id:C,rating:"none",conversation_id:B.getServerThreadId(t),text:"",tags:[],completion_comparison_rating:c,new_completion_placement:"not-applicable",feedback_start_time:a,compare_step_start_time:a,new_completion_load_start_time:o,new_completion_load_end_time:r,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset()}),B.updateTree(t,E=>{E.updateNodeMetadata(e.nodeId,{inlineComparisonRating:c})}),B.updateTree(t,E=>{E.updateNodeMetadata(x.nodeId,{inlineComparisonRating:"baseline"})})}return n.jsxs(Dc,{children:[n.jsx("h6",{className:"min-w-[150px] grow",children:n.jsx(P,{...bs.regenTitle})}),n.jsxs("div",{className:"flex flex-wrap items-end justify-center gap-2",children:[n.jsx(jt,{color:"secondary",onClick:()=>l("new"),children:n.jsx(P,{...bs.regenBetterText})}),n.jsx(jt,{color:"secondary",onClick:()=>l("original"),children:n.jsx(P,{...bs.regenWorseText})}),n.jsx(jt,{color:"secondary",onClick:()=>l("same"),children:n.jsx(P,{...bs.regenSameText})})]}),n.jsx(No,{onClick:()=>{B.updateTree(t,c=>{c.updateNodeMetadata(e.nodeId,{inlineComparisonRating:"skip"})})}})]})}const Dc=Ke.div`flex items-center p-4 rounded-2xl bg-token-main-surface-primary text-token-text-primary text-sm border border-token-border-light gap-5 mt-3`,bs=Le({regenTitle:{id:"ConversationTurnInlineFeedback.regenTitle",defaultMessage:"Was this response better or worse?"},regenBetterText:{id:"ConversationTurnInlineFeedback.regenBetterText",defaultMessage:"Better"},regenWorseText:{id:"ConversationTurnInlineFeedback.regenWorseText",defaultMessage:"Worse"},regenSameText:{id:"ConversationTurnInlineFeedback.regenSameText",defaultMessage:"Same"}}),ha=({allGroupedMessages:t})=>t.some(e=>[at.Browsing,at.RetrievalBrowsing,at.ParallelBrowsing].includes(e.type)),ma=({allGroupedMessages:t})=>t.some(e=>e.type===at.CodeInterpreter);function Lc(t){return!t||!t.instructions?"":typeof t.instructions=="string"?t.instructions:t.instructions.filter(e=>typeof e=="string").join("")}const Oc=[{match:ha,tag:"Shouldn't have searched the web",label:ie({id:"kL047b",defaultMessage:"Shouldn't have searched the web"})},{match:ha,tag:"Don't like the source it cited",label:ie({id:"+ds/Q/",defaultMessage:"Don't like the source it cited"})},{match:ma,tag:"Shouldn't have run code",label:ie({id:"53w4ay",defaultMessage:"Shouldn't have run code"})},{match:ma,tag:"Couldn't handle my file",label:ie({id:"EkFTQ5",defaultMessage:"Couldn't handle my file"})},{match:({allGroupedMessages:t})=>t.some(e=>e.type===at.Dalle),tag:"Shouldn't have created an image",label:ie({id:"S8FRsr",defaultMessage:"Shouldn't have created an image"})},{match:({allGroupedMessages:t})=>t.some(e=>{if(e.type!==at.Text)return!1;const{message:s}=e.message,{content:a}=s;return a.content_type===ot.Text&&_a(s).match(/^```[\S]+\n/gm)}),tag:"Code was incorrect",label:ie({id:"4EBdQk",defaultMessage:"Code was incorrect"})},{match:({systemContent:t})=>Lc(t).includes("Personality")??!1,tag:"Too chatty or casual",label:ie({id:"ATzJKW",defaultMessage:"Too chatty or casual"})},{match:({features:t})=>t.includes(Is.Sunshine),tag:"Shouldn't have used Memory",label:ie({id:"yfUEiz",defaultMessage:"Shouldn't have used Memory"})},{tag:"Don't like the style",label:ie({id:"nGxjdj",defaultMessage:"Don't like the style"})},{tag:"Not factually correct",label:ie({id:"Ke7JtQ",defaultMessage:"Not factually correct"})},{tag:"Didn't fully follow instructions",label:ie({id:"Rdlt9V",defaultMessage:"Didn't fully follow instructions"})},{tag:"Refused when it shouldn't have",label:ie({id:"2yRS/Q",defaultMessage:"Refused when it shouldn't have"})},{tag:"Being lazy",label:ie({id:"14MPmT",defaultMessage:"Being lazy"})},{tag:"Unsafe or problematic",label:ie({id:"02pXBl",defaultMessage:"Unsafe or problematic"})},{tag:"Other",label:ie({id:"WiIGE+",defaultMessage:"Other"})}],Uc=[{tag:"I disagree with the policy",label:ie({id:"oKyDLz",defaultMessage:"I disagree with the policy"})},{tag:"This didn't violate the policy",label:ie({id:"7fUkVF",defaultMessage:"This didn't violate the policy"})},{tag:"I don't understand the policy",label:ie({id:"4Cdp6N",defaultMessage:"I don't understand the policy"})},{tag:"This didn't take the full context",label:ie({id:"vnZJDP",defaultMessage:"This didn't take the full context"})}];function zc(t,e,s){return e.filter(a=>!a.match||a.match(s)).map(a=>({value:a.tag,label:t.formatMessage(a.label)}))}function Bc(t){const e=t[t.length-1];if(!e)return!1;const s="message"in e?e.message:null;if(s){const{errCode:a}=Ln(s);return[Wn.ContentPolicy,Wn.ContentOrTos].includes(a)}else return!1}function Gc({clientThreadId:t,conversationMessage:e,currentModelId:s,allGroupedMessages:a}){const o=$e(),r=jn()??[],l=e.rating,c=Ur(t,e.message.id),d=(c==null?void 0:c.message.content.content_type)===ot.SystemContent?c==null?void 0:c.message.content:null,h=m.useCallback(p=>{const x=B.getServerThreadId(t);x&&(p.tags.length===0&&!p.textFeedback||(ee.logEvent(p.source==="inline"?te.messageFeedbackInlineSubmitted:te.messageFeedbackDialogSubmitted,{id:e.message.id,threadId:x,tags:p.tags,content:p.textFeedback,model:s,rating:l}),l&&De.submitMessageFeedback({message_id:e.message.id,conversation_id:x,rating:l,text:p.textFeedback,tags:p.tags,tag_choices:p.tagChoices})))},[t,e.message,s,l]),y=()=>{ee.logEvent(te.messageFeedbackMoreOptionsClicked,{id:e.message.id,threadId:B.getServerThreadId(t),model:s,rating:l})},b=zc(o,Bc(a)?Uc:Oc,{allGroupedMessages:a,features:r,currentModelId:s,systemContent:d});return l==="thumbsUp"?null:n.jsx(El,{tagOptions:b,onSubmit:h,onMoreClicked:y})}const ga=[1,2,3,4,10,20,30],Wc=.5;function Hc({clientThreadId:t,conversationLeafId:e}){const s=Ts(Rn.isBusinessWorkspace),a=m.useRef(!1),o=Ds(t),r=Ls(t),{isUnauthenticated:l}=Rt(),c=m.useMemo(()=>{if(!o)return-1;const k=Da(o);return k()>Wc?-1:ga[Math.floor(k()*ga.length)]},[o]),d=zr(t,e),h=d[d.length-1],y=m.useMemo(()=>_s.getRequestIdFromConversationTurn(h),[h]),b=ts(y),[p,x]=m.useState(null),[S,g]=m.useState(!1),[f,u]=m.useState(!1),[v,w]=m.useState(!1),C=k=>{var z,I;const L=(I=(z=Xt(d))==null?void 0:z.messages[0])==null?void 0:I.message.id;x(k),q(L,k)},T=d.filter(k=>k.role===be.Assistant).length,D=(h==null?void 0:h.role)===be.Assistant,E=h==null?void 0:h.messages.some(k=>{var L;return(L=k.message.metadata)==null?void 0:L.is_nulligen}),q=m.useMemo(()=>ja((k,L)=>{o&&k&&De.submitConversationRating({conversation_id:o,message_id:k,rating:L,shown_at_assistant_turn:c}),ee.logEvent(te.conversationRatingSubmitted,{rating:L,showAtAssistantTurn:c,conversationId:o}),g(!0),setTimeout(()=>{u(!0)},1500)},2e3),[o,c]),O=T!==c||b||!D||E||!!s||(r==null?void 0:r.kind)!==nt.PrimaryAssistant||v||l;return m.useEffect(()=>{!O&&!a.current&&(ee.logEvent(te.conversationRatingShown,{showAtAssistantTurn:c,conversationId:o}),a.current=!0)},[O]),v||O?null:n.jsxs("div",{className:"mx-auto",children:[n.jsx(Aa,{children:S&&!f&&n.jsx(It.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:n.jsx(fa,{$padded:!0,children:n.jsx("span",{className:"text-sm text-token-text-tertiary",children:n.jsx(P,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!S&&n.jsx(It.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:n.jsxs(fa,{$padded:!1,children:[n.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-secondary",children:[n.jsx(P,{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?"}),n.jsxs("div",{className:"flex items-center gap-5",children:[n.jsx(dn,{$selected:p==="thumbsUp",onClick:()=>C("thumbsUp"),children:n.jsx(Ka,{className:"icon-md"})}),n.jsx(dn,{$selected:p==="thumbsDown",onClick:()=>C("thumbsDown"),children:n.jsx(Qa,{className:"icon-md"})})]})]}),n.jsx("div",{className:"w-px flex-1 self-stretch bg-token-main-surface-tertiary"}),n.jsx(dn,{className:"p-3",$selected:!1,onClick:()=>w(!0),children:n.jsx(ll,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const dn=Ke.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,fa=Ke.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`;function Vc({clientThreadId:t,conversationLeafId:e,canShowIndepthFeedbackType:s,canShowInlineComparisonFeedback:a,canShowInlineMessageFeedback:o,messageForRating:r,allGroupedMessages:l,currentModelId:c,conversationTurnMountTime:d,variantIds:h}){let y=null;return Br(t,e)?null:(s!==void 0?y=n.jsx(dc,{clientThreadId:t,conversationLeafId:e,trigger:s,variantIds:h}):r.rating&&o?y=n.jsx(Gc,{clientThreadId:t,conversationMessage:r,allGroupedMessages:l,currentModelId:c}):a?y=n.jsx(Pc,{clientThreadId:t,messageForRating:r,variantIds:h,conversationTurnMountTime:d}):y=n.jsx("div",{className:"text-center",children:n.jsx(Hc,{clientThreadId:t,conversationLeafId:e})}),n.jsx("div",{className:"mt-3 w-full empty:hidden",children:y}))}const qc=xt(()=>yt(()=>import("./sso-ics9m78winfyz1wy.js").then(t=>t.m),__vite__mapDeps([31,1,2,3,32,6,7,13,33,34,35,36,37,38,15,39,11,10,40,41,42,43,44,12,9,45,46,47,48,49,17,27,50,51,28,29,52,26,30,53,54,55,56,57,58,59,60,19,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,16,80,81,82,83,84,85,86,87,88,89,90,91,92,93])).then(t=>t.ContextualAnswerCitationCards).catch(()=>()=>null));function $c(t){var re;const{turnIndex:e,conversationLeafId:s,isFinalTurn:a,clientThreadId:o,onChangeItemInView:r,onChangeRating:l,showInlineEmbeddedDisplay:c=!1,currentModelId:d,initiallyHighlightedMessageId:h,avatarClassName:y,scrollToBottom:b}=t,p=$e(),x=Fn(),S=!!x&&Io(x),g=Pn(),f=Ts(Rn.isBusinessWorkspace),u=Nn(),v=En(),w=Yt(Gr(o,e,s)),{messages:C,variantIds:T,variantsInStreamInfo:D}=w,E=ks(C),q=Ri();let O=C[C.length-1];for(const V of E){const le=Er(V);if(le.some(ut=>q.has(ut.message.id))){O=le[le.length-1];break}}const k=C.slice(0,C.indexOf(O)+1),L=Ca(),[z,I]=m.useState(!1),[Y,A]=m.useState(!1),R=T.findIndex(V=>k.some(le=>le.nodeId===V)),M=w.role===be.User,$=bt(),H=vt(o),G=(re=Fs(w.gizmoId??H))==null?void 0:re.data,Z=Pi(),ve=G&&Z.includes(G.gizmo.id),Te=La(d),xe=Ls(o,G==null?void 0:G.gizmo.id),Ue=Wr(o)===Fo.PENDING,{data:ze}=In(G==null?void 0:G.gizmo.id,!1,v),Qe=ze==null?void 0:ze.memoryFullPct,it=Qe!==void 0&&Qe>=100,Ye=jn(),{value:ls}=ws("1410082514"),{value:St}=ws("2291672486"),he=k.some(V=>V.message.content.content_type===ot.MultimodalText),{isUnauthenticated:Be}=Rt(),[cs,Dt]=m.useState(!1),[Ge,rt]=m.useState(!1);Di(()=>{w.role==="user"&&b&&b()});const Lt=m.useRef(null);m.useEffect(()=>{var le;if(h==null)return;w.messages.map(ut=>ut.message.id).includes(h)&&((le=Lt.current)==null||le.scrollIntoView({behavior:"auto"}))},[h]);const X=C[C.length-1],We=X.rating,Us=()=>{k.length===1&&(ee.logEvent(te.editPrompt,{id:k[0].message.id,threadId:B.getServerThreadId(o)}),Oe.logEvent("chatgpt_edit_prompt"),I(!0))},zs=m.useCallback(()=>{I(!1)},[]),Ot=m.useCallback(()=>{B.copyMessageToClipboard(o,e)},[o,e]),ds=V=>{l({nodeId:X.nodeId,messageId:X.message.id,rating:V}),ee.logEvent(te.messageFeedbackThumbsDownClicked,{id:X.message.id,threadId:B.getServerThreadId(o),model:d,rating:V}),A(!0)},[Ut]=m.useState(()=>Date.now()),Bs=m.useMemo(()=>_s.getRequestIdFromConversationTurn(w),[w]),Gs=Hr({clientThreadId:o,conversationLeafId:s}),ye=ts(Bs)&&!Gs,Ws=Pa(),Hs=ks(k),{showDebugConversationTurns:Vs}=rs(),zt=Vr(o),Bt=Za(o),lt=mc({clientThreadId:o,conversationMode:xe}),us=Dn(o),Gt=m.useCallback(({requestedModelId:V,systemMessage:le,juice:ut,extraStreamParams:tn})=>{const uo=new hn;lt({id:X.nodeId,eventMetadata:{eventSource:"mouse"},turnTracker:uo,requestedModelId:V,systemMessage:le,juice:ut,extraStreamParams:tn})},[X,lt]),Wt=ls&&k.some(V=>{var le;return((le=V.message.metadata)==null?void 0:le.snorkle_status)!=null}),Ht=!g&&!zt&&!$&&!M,Vt=Ht&&(!f||Wt),qt=Li(),qs=!Be&&Vt&&L&&!ye&&!Ue&&!c&&!z&&(xe==null?void 0:xe.kind)!==nt.GizmoMagicCreate&&R===1&&a&&!X.inlineComparisonRating&&!We&&T.length===2&&!qt&&Date.now()-(X.message.create_time??0)*1e3<1e3*60*10,hs=!Be&&Vt&&!ye&&!Ue&&!c&&!z&&(xe==null?void 0:xe.kind)!==nt.GizmoMagicCreate&&d===Jo&&a&&u&&!it&&Date.now()-(X.message.create_time??0)*1e3<1e3*60*10,$s=uc(X),ct=O.message.author.role===be.Assistant?O.message:null;Oi({isCompletionRequestInProgress:ye,isUserTurn:M,message:ct});const Ks=hs?$s:void 0,Qs=qr(o,T),wt=Ui(xe),$t=!qt&&!wt&&Ht&&a&&(D==null?void 0:D.num_variants_in_stream)===2&&!X.inlineComparisonRating&&!Qs,ms=T.length===2,Xe=$t,Ys=$t&&!ms,_t=!M&&!c&&!g&&!zt&&!wt&&!Ue&&!ye,U=_t&&(!f||Wt||Te||S)&&!wt&&!Be&&!$,ue=!g&&!c&&!((ye||Ue)&&a)&&T.length>1&&!z&&!Xe;let ne=!1;if(M&&k.length===1){const{shouldHideContent:V}=Ln(k[0]);V&&(ne=!0)}const me=M&&!c&&!wt&&!g&&!he&&k.length===1&&!ne&&!z&&!Be,Je=V=>{r(T[V]),ee.logEvent(te.changeNode,{intent:"toggle_between"})};if(!(w.role===be.Root?!1:w.role===be.System||k.every(V=>{var le;return(le=V.message.metadata)==null?void 0:le.is_visually_hidden_from_conversation})?Vs:!0)&&!Xe)return null;const dt=a&&Bt&&!St?n.jsx(xs,{onClick:()=>{const V=new hn;lt({id:us,eventMetadata:{eventSource:"mouse"},turnTracker:V}),zi()},icon:Os,label:p.formatMessage({id:"ConversationTurn.regenerateTooltip",defaultMessage:"Regenerate"}),testId:"regenerate-turn-action-button"}):null,He="h-[30px] rounded-md px-1 text-token-text-secondary hover:bg-token-main-surface-secondary",Xs=St?n.jsx(Nc,{className:He,clientThreadId:o,message:X,onModelSelect:Gt,onDropdownChange:Dt,canRegenerateResponse:Bt}):null,Js=!M&&!ne&&!c&&(!a||!ye)?n.jsx($i,{onClick:Ot}):null,Zs=!M&&!c&&(!a||!ye)&&(X.disclaimers??[]).length===0&&X.nodeId?n.jsx(Sc,{conversationId:o,message:X,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-xs text-token-text-tertiary hover:text-token-text-primary"}):null,Kt=!M&&!c&&X&&(!a||!ye)?n.jsx(Ki,{message:X,isFinalTurn:a,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-token-text-tertiary hover:text-token-text-primary"}):null,en=U&&!ye?n.jsxs("div",{className:"flex",children:[!(Ye!=null&&Ye.includes(Is.ThumbsDownOnly))&&We!=="thumbsDown"&&n.jsx(xs,{onClick:()=>ds("thumbsUp"),disabled:We==="thumbsUp",icon:We==="thumbsUp"?cl:Ka,label:p.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"},`thumbsUp:${X.nodeId}`),We!=="thumbsUp"&&n.jsx(xs,{onClick:()=>ds("thumbsDown"),disabled:We==="thumbsDown",icon:We==="thumbsDown"?dl:Qa,label:p.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"},`thumbsDown:${X.nodeId}`)]}):null,Qt=!St&&n.jsx(ic,{className:He,clientThreadId:o,message:X,onModelSelect:Gt,onDropdownChange:Dt});return n.jsxs("article",{className:"w-full text-token-text-primary focus-visible:outline-2 focus-visible:outline-offset-[-4px]",ref:Lt,dir:"auto","data-testid":`conversation-turn-${e}`,"data-scroll-anchor":a,onMouseEnter:()=>rt(!0),onMouseLeave:()=>rt(!1),children:[n.jsx(Bi,{role:w.role}),n.jsx(Oa,{clientThreadId:o,showInlineEmbeddedDisplay:c,isStaticSharedThread:g,withVerticalPadding:!0,withHorizontalPadding:!Xe,children:Xe?n.jsx(Ic,{isFeedbackEnabled:U,variantIds:T,variantsInStreamInfo:D,conversationTurnMountTime:Ut,stubSideBySideFeedback:Ys,...t}):n.jsxs(fn,{children:[!M&&n.jsx(Qc,{children:n.jsx(Mn,{messages:k,isUserTurn:M,avatarClassName:y,showInlineEmbeddedDisplay:c,gizmo:G})}),n.jsx("div",{className:se("group/conversation-turn relative flex w-full min-w-0 flex-col",!M&&Gi),children:n.jsx("div",{className:"flex-col gap-1 md:gap-3",children:n.jsxs(n.Fragment,{children:[!M&&!g&&n.jsx(kn,{messages:k,isMemoryEnabled:u,isMemoryFull:it,gizmoId:G==null?void 0:G.gizmo.id}),n.jsx(pn,{groupedMessagesToRender:Hs,allGroupedMessages:E,...t,isEditing:z,isUserTurn:M,isCompletionRequestInProgress:ye,isFeedbackEnabled:U,isFinalTurn:a,hasActiveRequest:Ws,showEditButton:me,handleEnterEdit:Us,handleExitEdit:zs}),ve&&n.jsx("div",{className:"mb-4",children:n.jsx(Wi,{messages:k})}),Te&&n.jsx("div",{className:"mb-4",children:n.jsx(qc,{messages:k})}),(_t||ue)&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:se("mb-2 flex gap-3 empty:hidden",M?"mr-1 flex-row-reverse":"-ml-2"),children:n.jsx(Hi,{alwaysShow:a,showInline:a||ue,isHovered:Ge||cs,pagination:ue&&n.jsx(Vi,{showInline:a||ue,currentPage:R,onChangeIndex:Je,length:T.length,className:se("self-center",T.length>1?"visible":"!invisible")}),actions:_t&&n.jsxs(n.Fragment,{children:[Zs,Js,dt,en,Kt,Qt,Xs]})})}),_t&&!ye?n.jsx("div",{className:"pr-2 lg:pr-0",children:n.jsx(qi,{message:X,isFinalTurn:a})}):null,a&&!ye&&n.jsx(Vc,{canShowIndepthFeedbackType:Ks,canShowInlineComparisonFeedback:qs,canShowInlineMessageFeedback:Y,clientThreadId:o,conversationLeafId:s,messageForRating:X,allGroupedMessages:E,currentModelId:d,conversationTurnMountTime:Ut,variantIds:T})]})]})})})]})})]})}const Kc=Eo.memo($c),Qc=Ke.div`flex-shrink-0 flex flex-col relative items-end`,Yc=t=>{const e=bt();return m.useCallback(s=>{var c,d;Qi(s);const{target:a}=s;if(!(a instanceof Element))return;const o=(c=a.closest("[data-message-id]"))==null?void 0:c.getAttribute("data-message-id"),r=(d=document.getSelection())==null?void 0:d.toString(),l=B.getServerThreadId(t);!o||!r||!l||e||De.submitImplicitMessageFeedback({source:"keyboard",type:"copy",messageId:o,serverThreadId:l,selectedText:r})},[t,e])};function Xc({onChangeItemInView:t,onRequestMoreCompletions:e,onChangeRating:s,onRequestCompletion:a,clientThreadId:o,conversationLeafId:r,inlineEmbeddedDisplay:l,hideHeader:c}){const d=Yi(),h=$r(),y=Xi(),[b]=Ji(),p=Ls(o),x=is(),S=Zo(o),g=d.store.useContentAreaDimensions(Zi.Header,I=>I!=null&&I.height?I.height:void 0),f=d.store.useIsHeaderContentAreaPopulated(),u=Ba(o),{isArchived:v}=u,w=wl(S.id),C=(p==null?void 0:p.kind)===nt.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":w,T=Ga(o,r),D=er(),[E,q]=m.useState(0);m.useEffect(()=>{h&&(E===0?q(T):T-E===1&&(Oe.logEvent("chatgpt_continue_conversation_first_message_sent"),ee.logEvent(te.continueConversationFirstMessageSent)))},[T,E,h]),h&&(Oe.logEvent("chatgpt_continue_conversation_page_loaded"),ee.logEvent(te.continueConversationPageLoaded));const O=m.useCallback(()=>{y({behavior:"smooth"})},[y]),k=Yc(o),L=D&&!v,z=(I,Y,A)=>[...new Array(Y-I).keys()].map(R=>{const M=R+I;return n.jsx(Kc,{isFinalTurn:A(M),turnIndex:M,clientThreadId:o,conversationLeafId:r,onChangeItemInView:t,onChangeRating:s,onRequestMoreCompletions:e,onRequestCompletion:a,currentModelId:S.id,showInlineEmbeddedDisplay:l,avatarClassName:C,scrollToBottom:O},M)});return n.jsxs("div",{onCopy:k,className:se("flex flex-col text-sm",L&&"pb-[120px]",g||L?null:"md:pb-9"),style:{paddingBottom:L?void 0:g},children:[!c&&(x==null?void 0:x.data)&&!l&&n.jsx(Ja,{clientThreadId:o}),h&&n.jsxs(n.Fragment,{children:[n.jsx(fn,{children:n.jsx("p",{className:"text-xs text-gray-500",children:n.jsx(P,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),z(0,E,I=>I===E-1),n.jsx(fn,{children:n.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[n.jsx(ul,{className:"icon-xs mr-2"}),n.jsx(P,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})}),z(E,T,I=>I===T-1)]}),!h&&z(0,T,I=>I===T-1),!b&&!l&&n.jsx(Jc,{className:se(g?null:"bottom-5",L?f?"translate-y-[-50px]":"translate-y-[-10px]":""),style:{bottom:D?"calc(var(--composer-bar_footer-current-height) + var(--composer-bar_current-height))":g},onClick:()=>{Oe.logEvent("chatgpt_thread_scroll_to_bottom"),y({behavior:"smooth"})},children:n.jsx(hl,{className:"icon-md text-token-text-primary"})})]})}const Jc=Ke.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-light right-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`;function Zc({clientThreadId:t,currentModelId:e}){const s=_l(e,Cl.CODE_INTERPRETER);td(s,t)}async function ed({queryKey:[t,e]}){return await De.getThreadInterpreterState(e).then(s=>(s.time_remaining_ms===0&&s.kernel_started&&un.warning("This advanced data analysis (beta) chat has timed out. You may continue the conversation, but previous files, links, and code blocks below may not work as expected.",{hasCloseButton:!0,duration:0}),s))}function td(t,e){const s=Pn(),a=B.getServerThreadId(e);return Ro({queryKey:["interpreterState",a],queryFn:ed,enabled:!!(t&&a&&!s),gcTime:0})}const sd=xt(()=>yt(()=>import("./1pqbzx6ftjc6o4ba.js"),__vite__mapDeps([94,1,2,3,10,6,7,11,9,27,71,47,48,85,64,15,37])).then(t=>t.OpenDebugSidebarButton)),nd=xt(()=>yt(()=>import("./jaw8yejxjg9ww24z.js"),__vite__mapDeps([95,1,2,3,6,7,69,11])),{ssr:!1}),ad=xt(()=>yt(()=>import("./sso-ics9m78winfyz1wy.js").then(t=>t.n),__vite__mapDeps([31,1,2,3,32,6,7,13,33,34,35,36,37,38,15,39,11,10,40,41,42,43,44,12,9,45,46,47,48,49,17,27,50,51,28,29,52,26,30,53,54,55,56,57,58,59,60,19,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,16,80,81,82,83,84,85,86,87,88,89,90,91,92,93])).catch(()=>()=>null),{ssr:!1}),od=xt(()=>yt(()=>import("./sso-ics9m78winfyz1wy.js").then(t=>t.P),__vite__mapDeps([31,1,2,3,32,6,7,13,33,34,35,36,37,38,15,39,11,10,40,41,42,43,44,12,9,45,46,47,48,49,17,27,50,51,28,29,52,26,30,53,54,55,56,57,58,59,60,19,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,16,80,81,82,83,84,85,86,87,88,89,90,91,92,93])).then(t=>t.default)),id=xt(()=>yt(()=>import("./sso-ics9m78winfyz1wy.js").then(t=>t.q),__vite__mapDeps([31,1,2,3,32,6,7,13,33,34,35,36,37,38,15,39,11,10,40,41,42,43,44,12,9,45,46,47,48,49,17,27,50,51,28,29,52,26,30,53,54,55,56,57,58,59,60,19,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,16,80,81,82,83,84,85,86,87,88,89,90,91,92,93])).then(t=>t.CAFeedbackModal).catch(()=>()=>null)),qe=Le({doNotShareSensitive:{id:"thread.modal.onboarding.title",defaultMessage:"Do not share sensitive materials with this application"},mayProduceInaccurateInformation:{id:"thread.chatgptMayProduceInaccurateInformation-oct-30",defaultMessage:"ChatGPT can make mistakes. Check important info."},mayProduceInaccurateInformationNoAuth:{id:"thread.chatgptMayProduceInaccurateInformationNoAuth-march-27",defaultMessage:"ChatGPT can make mistakes. Check important info. Read our <termsLink>Terms</termsLink> and <privacyLink>Privacy Policy</privacyLink>."},mayProduceInaccurateInformationNoAuthV2:{id:"thread.chatgptMayProduceInaccurateInformationNoAuth-may-06",defaultMessage:"By messaging ChatGPT, you agree to our <termsLink>Terms</termsLink> and have read our <privacyLink>Privacy Policy</privacyLink>."},mayProduceInaccurateInformationNoAuthKorea:{id:"thread.chatgptMayProduceInaccurateInformationNoAuthKorea-may-06",defaultMessage:"By messaging ChatGPT, you agree to our <termsLink>Terms</termsLink> and have read our <privacyLink>Privacy Policy</privacyLink> and its <koreaAddendumLink>Korea addendum</koreaAddendumLink>."},businessDisclaimer:{id:"thread.businessDisclaimer-oct-30",defaultMessage:"{workspaceName} workspace chats aren't used to train our models. ChatGPT can make mistakes."},businessDisclaimerNoName:{id:"thread.businessDisclaimerNoName-oct-30",defaultMessage:"Your workspace chats aren'ts used to train our models. ChatGPT can make mistakes."},outdatedGptDisclaimer:{id:"thread.outdatedGptDisclaimer.0",defaultMessage:"<bold>New version of GPT available</bold> - Continue chatting to use the old version, or start a <link>new chat</link> for the latest version."},somethingWentWrong:{id:"thread.modal.unrecoverableError.title",defaultMessage:"Something went wrong"},tryAgainLater:{id:"thread.modal.unrecoverableError.description",defaultMessage:"We're sorry, but something went wrong. Please try again later."},resetThread:{id:"thread.modal.unrecoverableError.resetThread",defaultMessage:"Reset thread"},sharedConversationReportConversation:{id:"thread.sharedConversation.report",defaultMessage:"Report conversation"},latencyButton:{id:"thread.latencyButton",defaultMessage:"Latency"},archivedConversationDescription:{id:"thread.archivedConversationDescription",defaultMessage:"This conversation is archived. To continue, please unarchive it first."},unarchiveButton:{id:"thread.unarchiveButton",defaultMessage:"Unarchive"}});function rd({clientThreadId:t}){const e=vt(t);return e!=null?n.jsx(ld,{clientThreadId:t,gizmoId:e}):n.jsx(co,{clientThreadId:t})}function ld({clientThreadId:t,gizmoId:e}){const s=Fs(e).data,a=Wa(r=>Ps.getThreadCreateTime(t,r)),o=(s==null?void 0:s.gizmo.updated_at)!=null?new Date(s.gizmo.updated_at):void 0;return(s==null?void 0:s.gizmo.short_url)==null||o==null||a==null||o<=a?n.jsx(co,{clientThreadId:t}):n.jsxs("div",{className:"text-token-text-tertiary",children:[n.jsx(ml,{className:"text-token-secondary mb-1 mr-1 inline-block h-4 w-4 stroke-0"}),n.jsx(P,{...qe.outdatedGptDisclaimer,values:{link:r=>n.jsx(qo,{to:oi(s.gizmo.short_url),className:"underline",children:r}),bold:r=>n.jsx("span",{className:"text-token-secondary font-semibold",children:r})}})]})}function cd({clientThreadId:t}){return Sr(s=>s.hasAcceptedFooterDisclaimer)?n.jsx("div",{children:n.jsx(P,{...qe.mayProduceInaccurateInformation})}):n.jsx(dd,{clientThreadId:t})}function co({clientThreadId:t}){const e=Ts(Rn.isBusinessWorkspace),s=Ts(d=>d.currentWorkspace),a=s==null?void 0:s.name,{isUnauthenticated:o,isLoading:r}=Rt(),c=Ha({clientThreadId:t,role:be.User})>0;return r?null:e?n.jsx("div",{children:a!=null?n.jsx(P,{...qe.businessDisclaimer,values:{workspaceName:a}}):n.jsx(P,{...qe.businessDisclaimerNoName})}):o&&!c?n.jsx($o,{children:n.jsx(cd,{clientThreadId:t})}):n.jsx("div",{children:n.jsx(P,{...qe.mayProduceInaccurateInformation})})}function dd({clientThreadId:t}){const{country:e}=Ko(),s=e==="KR"?qe.mayProduceInaccurateInformationNoAuthKorea:qe.mayProduceInaccurateInformationNoAuthV2,{layer:a}=Ns("3637408529"),o=(a==null?void 0:a.get("should_show_disclaimer_only_once_per_device",!1))??!1;return m.useEffect(()=>()=>{Ha({clientThreadId:t,role:be.User})>0&&wr.updateHasAcceptedFooterDisclaimer(o)},[t,o]),n.jsx("span",{className:"text-sm leading-none",children:n.jsx(P,{...s,values:{privacyLink:r=>n.jsx("a",{href:"https://openai.com/privacy",target:"_blank",className:"text-token-text-primary underline decoration-token-text-primary",onClick:()=>{Oe.logEvent("chatgpt_footer_disclaimer_privacy_link_clicked"),ee.logEvent(te.footerDisclaimerPrivacyLinkClicked)},rel:"noreferrer",children:r}),termsLink:r=>n.jsx("a",{href:"https://openai.com/terms",target:"_blank",className:"text-token-text-primary underline decoration-token-text-primary",onClick:()=>{Oe.logEvent("chatgpt_footer_disclaimer_terms_link_clicked"),ee.logEvent(te.footerDisclaimerTermsLinkClicked)},rel:"noreferrer",children:r}),koreaAddendumLink:r=>n.jsx("a",{href:"https://openai.com/ko/policies/kr-privacy-policy-addendum",target:"_blank",className:"text-token-text-primary underline decoration-token-text-primary",onClick:()=>{Oe.logEvent("chatgpt_footer_disclaimer_korea_addendum_link_clicked"),ee.logEvent(te.footerDisclaimerKoreaAddendumLinkClicked)},rel:"noreferrer",children:r})}})})}function ud({clientThreadId:t}){const e=Ma(),s=Ds(t),a=async()=>{s&&(await De.patchConversation(s,{is_archived:!1}),e.invalidateQueries({queryKey:["conversation",t]}),Wa.setState(o=>{const r=o.threads[s];r!=null&&(r.initialThreadData.isArchived=!1)}),yl(e))};return n.jsxs("div",{className:"my-6 flex flex-col items-center justify-center gap-4",children:[n.jsx("div",{className:"px-3 text-center text-sm text-token-text-secondary",children:n.jsx(P,{...qe.archivedConversationDescription})}),n.jsx("div",{children:n.jsx(jt,{disabled:!s,onClick:a,icon:gl,children:n.jsx(P,{...qe.unarchiveButton})})})]})}function hd(t,e){const s=es(t),a=B.getTitle(t);return e&&e.kind===nt.GizmoInteraction&&e.gizmo?s?`ChatGPT - ${e.gizmo.gizmo.display.name}`:a&&`${e.gizmo.gizmo.display.name} - ${a}`:s?"ChatGPT":a}const Od=function({clientThreadId:t,onCompletionFinished:e,preRequestCompletion:s,hideHeader:a,hideMessages:o,hideFooter:r,hideToolsOverlay:l,messagesVerticalAlign:c="top",prependThreadChildren:d,renderEmptyState:h}){const y=Ma(),b=Po(),p=is(),x=jn(),S=Ca(),g=Cs(),f=Ir(t),u=Ua(t),v=Dn(t),C=Ba(t).isArchived;m.useEffect(()=>{u||(es(t)?Hn.addTiming("chatgpt.web.chatPage.renderNewConversation"):Hn.addTiming("chatgpt.web.chatPage.renderExistingConversation"))},[t,u]);const T=Kr(t,v),D=Ga(t,v),{setTargetedContent:E}=tr(),q=x==null?void 0:x.includes(Do),O=sr(),k=D>=2,L=es(t)&&!k&&nn(f),z=es(t)&&!T&&(nn(f)||(f==null?void 0:f.kind)===nt.GizmoTest),Y=ei().id,A=ti(t)??Y,{value:R}=ws("4203174056"),M=si(t,Lo.Search),$=La(A),G=ka()[A],Z=hd(t,f),ve=Ls(t),Te=nr(),xe=Fr(t),{config:Pt}=Oo("1013114931"),Ue=Pt.get("show_follow_ups",!1)&&(p==null?void 0:p.isPersonalAccount()),ze=!g.displayingSideBySideFeedback&&Ue,Qe=bt();m.useEffect(()=>{$n()},[]),m.useEffect(()=>{Te||E(void 0),B.getLastMessgageSystemHints(t,v).includes(Ms.Search)&&M?Kn.addPersistedSystemHint(Ms.Search):Kn.clear()},[t,E,Te,v,b.search,M]);const it=m.useCallback(U=>{if(U==null||(e==null||e(U),Qe)||((ve==null?void 0:ve.kind)===nt.GizmoInteraction&&ni.handleGizmoInteracted(y,ve.gizmo_id),!(xe||ze)))return;const ne=B.getThreadCurrentLeafId(U),me=B.getTree(U).getMessage(ne);Uo(me)||zo(me)||ar(U,me.id,A)},[y,e,ve,xe,ze,A,Qe]),Ye=Qr(t),ls=Rr(t,Ye,it),St=m.useCallback(()=>{const U=B.getThreadCurrentLeafId(t);if(U==null)return;const ne=B.getTree(t).getBranchFromLeaf(U);or.abortRequests(ne.map(me=>me.id))},[t]),he=rs(),{isUnauthenticated:Be,isLoading:cs}=Rt(),Dt=ir(),Ge=m.useCallback(async({type:U,promptId:ue,requestedModelId:ne,eventMetadata:me,cancelActiveRequests:Je,focusOnNewCompletion:Ct=!0,useDefaultModel:dt,completionMetadata:He,appendMessages:Xs,updateTree:Js,turnTracker:Zs,extraStreamParams:Kt})=>{$n(),rr.reset(),Je&&St();const en=performance.now();let Qt=A;ne?Qt=ne:dt&&(Qt=Y);const re=lr({namespace:cr.CompletionRequest,key:ue});re==null||re.logTiming("start_chat_requirements");const V=await Bo();re==null||re.logTiming("fetched_chat_requirements"),V.force_login&&Dt({authType:"login"});const le=await Go.getEnforcementToken(V);re==null||re.logTiming("fetched_arkose_token");const ut=await dr.getEnforcementToken(V);re==null||re.logTiming("fetched_turnstile_token");const tn=await Wo.getEnforcementToken(V);re==null||re.logTiming("fetched_p_token"),s==null||s(t,ue),ls({model:Qt,completionType:U,parentNodeId:ue,metadata:me,focusOnNewCompletion:Ct,completionMetadata:He,chatReq:V,arkoseToken:le??null,turnstileToken:ut??null,proofToken:tn??null,preflightTime:performance.now()-en,extraStreamParams:{forceParagen:he.forceParagen,forceParagenModel:he.forceParagenModel.value,forceNulligen:he.forceNulligen,forceRateLimit:he.forceRateLimit,resetRateLimits:he.resetRateLimits,disableSystemContentToggling:he.rebaseSystemMessageContent?!0:void 0,forceUseSearch:he.forceUseSearch??(Kt==null?void 0:Kt.forceUseSearch)},appendMessages:Xs,updateTree:Js,turnTracker:Zs}),Be&&ur.incrementUserMessageCount()},[Y,A,s,t,ls,he.forceParagen,he.forceParagenModel,he.forceNulligen,he.forceRateLimit,he.resetRateLimits,he.rebaseSystemMessageContent,he.forceUseSearch,St,Dt,Be]),rt=!!(p!=null&&p.features.includes(Is.SharedWebsocket));m.useEffect(()=>{rt&&an.registerIfNotConnected()},[rt]),m.useEffect(()=>{const U=()=>{if(document.visibilityState==="visible"){if(!rt)return;an.registerIfNotConnected()}};return document.addEventListener("visibilitychange",U),()=>{document.removeEventListener("visibilitychange",U)}},[rt]);const Lt=Ds(t);m.useEffect(()=>{const U=()=>{an.stopConversation(Lt)};return window.addEventListener("beforeunload",U),()=>{window.removeEventListener("beforeunload",U)}},[Lt]);const X=ai({clientThreadId:t,currentLeafId:v,handleRequestCompletion:Ge}),We=m.useCallback((U,ue,ne,me=!0,Je="none",Ct)=>{const He=B.getTree(t).getParentPromptNode(U).id;Ge({type:wa.Variant,promptId:He,eventMetadata:ue,cancelActiveRequests:!1,focusOnNewCompletion:me,useDefaultModel:Ct,completionMetadata:{variantPurpose:Je,conversationMode:Ps.getConversationMode(t)},turnTracker:ne})},[Ge,t]),Us=m.useCallback(U=>{const ne=B.getTree(t).getLeafFromNode(U);B.setThreadCurrentLeafId(t,ne.id)},[t]),[zs,Ot]=m.useState(),ds=m.useCallback(({nodeId:U,messageId:ue,rating:ne})=>{var dt;const me=B.getServerThreadId(t);ee.logEvent(te.thumbRating,{id:ue,threadId:me,rating:ne,model:A});const Je=B.getTree(t),Ct=Je.getNodeByIdOrMessageId(U);if(me!==void 0&&($?gt:De.submitMessageFeedback)({message_id:ue,conversation_id:me,rating:ne}),B.updateTree(t,He=>{He.updateNodeMetadata(U,{rating:ne})}),$){Ot(n.jsx(id,{citations:((dt=Ct.message.metadata)==null?void 0:dt.citations)??[],rating:ne,conversationId:me??"",messageId:ue,onSubmit:()=>{Ot(void 0)},onCancel:()=>Ot(void 0),conversationTree:Je,nodeId:U},`${U}-${ne}`));return}},[t,A,$]),{setShowReferralInviteModal:Ut}=Qn(U=>({setShowReferralInviteModal:U.setShowReferralInviteModal})),Bs=m.useCallback(()=>{Ut(!1)},[Ut]),Gs=Qn(U=>U.showReferralInviteModal);Zc({clientThreadId:t,currentModelId:A});const ye=U=>n.jsx(Ml,{scrollAnchorTopOffset:a?0:vr,children:c==="bottom"?n.jsxs("div",{className:"flex h-full flex-col",children:[n.jsx("div",{className:"flex-1"}),U]}):U});m.useEffect(()=>{document.title=Z??"ChatGPT"},[Z]);const Ws=vt(t),Hs=bt(),Vs=Rl(),zt=z&&!h&&S&&!Ws&&!$&&!Hs,Bt=zt&&!cs&&Be,lt=zt&&!cs&&!Be,us=lt&&Vs,Gt=Pl(Bt),Wt=Fl(lt),Ht=Dl(us),Vt=Bt&&Gt||lt&&Wt||us&&Ht,qt=Gt||Wt||Ht,{composerBarSize:qs,composerSkeleton:hs,footerBarSize:$s,isClippedComposerBar:ct,setComposerBarElement:Ks,setFooterBarElement:Qs,ThreadSizeWrapper:wt}=hr({isArchived:C}),$t=mr(),{reset:ms,streamingContext:Xe,StreamingProvider:Ys}=gr();m.useEffect(()=>{$t&&(Xe.setOnResetContext=()=>{ms()})},[$t,ms,Xe]);const _t=ct?{footerBarSize:$s,composerBarSize:qs}:{};return n.jsx(Ys,{value:Xe,children:n.jsxs(wt,{..._t,children:[q&&n.jsx(nd,{}),R&&n.jsx(od,{}),n.jsx(Ho,{children:Z!=null&&n.jsx("title",{children:Z})}),(f==null?void 0:f.kind)===nt.GizmoInteraction&&f.gizmo&&n.jsx(ii,{gizmo:f.gizmo}),n.jsx(Sa.Provider,{value:Ge,children:n.jsxs(fr,{children:[n.jsxs(Pr,{clientThreadId:t,currentModelConfig:G,className:"composer-parent flex h-full flex-col focus-visible:outline-0",children:[!o&&n.jsx(md,{className:se(ct&&"masked-content"),style:{"--composer-bar_skeleton":hs},children:!u&&!X?z?h??n.jsx(Vn,{shouldSSR:!qt,children:n.jsx(Jl,{clientThreadId:t,currentModelId:A,onRequestCompletion:Ge,enableV2Homepage:Vt})}):k?ye(n.jsxs(n.Fragment,{children:[d,n.jsx(Xc,{onChangeItemInView:Us,onRequestMoreCompletions:We,onChangeRating:ds,onRequestCompletion:Ge,clientThreadId:t,inlineEmbeddedDisplay:!1,conversationLeafId:v,hideHeader:a},t)]})):null:null}),n.jsx(gd,{className:se(ct&&"mask-scrollbars absolute bottom-0 z-20"),children:C?n.jsx(ud,{clientThreadId:t}):n.jsxs("div",{className:se(ct&&"relative mx-auto flex max-w-3xl flex-1 flex-col"),children:[ct?n.jsx(pr,{skeleton:hs}):null,!Vt&&n.jsx(Vn,{shouldSSR:!qt,children:n.jsx(Dr,{clientThreadId:t,isNewThread:L,setComposerBarElement:Ks,showPromptStarters:L||!T,currentModelId:A,onRequestCompletion:Ge})}),!r&&n.jsx("div",{ref:Qs,className:"relative w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",children:nn(f)&&n.jsx("div",{className:"min-h-4",children:n.jsx(rd,{clientThreadId:t})})})]})})]}),!l&&n.jsxs("div",{className:"group absolute bottom-2 end-2 z-20 hidden gap-1 md:flex lg:bottom-3 lg:end-3",children:[O?n.jsxs(n.Fragment,{children:[n.jsx(sd,{}),n.jsx(ad,{})]}):null,n.jsx(fl,{})]}),zs,n.jsx(ri,{clientThreadId:t,isStaticSharedThread:!1}),n.jsx(br,{}),(x==null?void 0:x.includes(Vo))&&n.jsx(xr,{isOpen:Gs,onClose:Bs}),n.jsx(yr,{conversationId:t,currentModelId:A})]})})]})})},md=Ke.div`grow flex-1 overflow-hidden`,gd=Ke.div`md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent w-full`;export{Kc as C,Od as T,Xc as a,Il as b};
//# sourceMappingURL=cp74cy92mbnkpj07.js.map
