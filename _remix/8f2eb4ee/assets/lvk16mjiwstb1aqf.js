const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/fbc2q72tkeazln1g.js","assets/d4998ss76kiiys2a.js","assets/jgebgvmmewaiobkz.js","assets/root-iasegnfe.css","assets/bnfipyp544joa108.js","assets/lqoe6edmgg2veala.js","assets/cdlu5q20cam9cxqi.js","assets/conversation-small-eplmind9.css","assets/f9k32eka8u6kywes.js","assets/ijnl2vv7sqg077ic.js","assets/dhr22l6cwlnk6eb2.js","assets/fizvwuv456q1poqt.js","assets/m1aiqt6drgf0dgrp.js","assets/ne9wvbs62gemz5ku.js","assets/o0q8l8z2cqi8l7i6.js","assets/l0p0xoyhl72xwmj4.js","assets/monok0lr3q3dru8u.js","assets/wp5q7ppkt4ddrdq1.js","assets/dkgx35h9ryrvx1d6.js","assets/bkaw2sh00lkzz1mk.js","assets/pr5hfl21b950bafj.js","assets/hrpxk0zzejlt1zdz.js","assets/fbfwg12agjtcvtr7.js","assets/pc5rh6b4vxhm4xwu.js","assets/dviz5jgz41pujw7c.js","assets/m8tgv16u8li2vzwm.js","assets/gnxmxevehaum9r0n.js","assets/lk9nevahcpbvuzfk.js","assets/iu45fwkgaxj64iug.js","assets/crbck9stn89tcssy.js","assets/pcgxizbj57vqiyov.js","assets/sso-hexuaopvgesml5k1.js","assets/d2bl7olmygmhb3v1.js","assets/dhq76rj081844iz8.js","assets/lmmrkiog5qgqqy5h.js","assets/du2fx3py4s4s2fx3.js","assets/l60wejf2rnbgqs8b.js","assets/mqgzohfcuqsh3nsb.js","assets/iq2nectivx8oun2p.js","assets/nn5gnhedjj8rpx0v.js","assets/nzmog53ng1l24zz2.js","assets/ha6wyvptaf6ahwpe.js","assets/juplixc6gwnivx6h.js","assets/kqwdyvkaaavvn8k3.js","assets/haiakfpfaabpdpvg.js","assets/pdam2e5u3zk9nwdq.js","assets/eyf6wzu4fqqsn4mb.js","assets/kgvnaxx6rk002p3w.js","assets/f0z84s9j4soeuc0z.js","assets/nhwwej1nq0zrd7sc.js","assets/jr3n4q33u401ed1v.js","assets/mugd6ac6ijbpkvp5.js","assets/h39np7yaid1flyiv.js","assets/dtxde43hwlqoev9l.js","assets/ny02b1r0q2e9w4rr.js","assets/cabf2of8bxh0m7i2.js","assets/czx8ariycgubr29o.js","assets/clpmzqk96lyy2hhn.js","assets/lsfi6dlqht91ibg3.js","assets/klb1u1mb4gad3xsq.js","assets/isjdmfmhzv09v01t.js","assets/dn9edvm1319wl6er.js","assets/dzjq81dy7yarj83i.js","assets/i68hvh4pk2fzbj2p.js","assets/eayrjzmpo9tgf5ry.js","assets/cf81ws1iv4mdv0tz.js","assets/de1tgvcnl9dkf59f.js","assets/mjhgccj8l7975fw3.js","assets/h4hakvv935o59pfe.js","assets/db5uxxl7cilzzobq.js","assets/iahk19c8zdunaftn.js","assets/n731sdlxp1cs95zp.js","assets/xs3suco3b00if9md.js","assets/kk29uvhlmz4tok3w.js","assets/b9xr4r2juy0dou0k.js","assets/k713noxmlwk6ctbs.js","assets/f830k527qdhnsmt8.js","assets/iej0cupg2dqkmejt.js","assets/k629gpsynyv66fil.js","assets/jk8w36bsokizpx57.js","assets/dp5zy89kaoofpkts.js","assets/fwvvd437cc6hvqj1.js","assets/cizwy7pbyxy17mzg.js","assets/kfmf8e3u1ujsc42d.js","assets/glbdaczkz0i7u2v0.js","assets/bgruhbjazoh8x0i1.js","assets/l7v42hfd1olpe85x.js","assets/evrar4c70wc6aa63.js","assets/osx4aio9aflqteum.js","assets/ejosdqez3cwo070k.js","assets/hsow21nksohduv2s.js","assets/ofh5j8nbe2e91jd3.js","assets/shared-mk6ngktc.css","assets/sso-jmjhjxeo.css","assets/ogxc5713ij9jf5lb.js","assets/k33xzjzjnafnncjr.js"])))=>i.map(i=>d[i]);
var Co=Object.defineProperty;var Qn=t=>{throw TypeError(t)};var wo=(t,e,n)=>e in t?Co(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var J=(t,e,n)=>wo(t,typeof e!="symbol"?e+"":e,n),un=(t,e,n)=>e.has(t)||Qn("Cannot "+n);var r=(t,e,n)=>(un(t,e,"read from private field"),n?n.call(t):e.get(t)),H=(t,e,n)=>e.has(t)?Qn("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),A=(t,e,n,a)=>(un(t,e,"write to private field"),a?a.call(t,n):e.set(t,n),n),T=(t,e,n)=>(un(t,e,"access private method"),n);var Ss=(t,e,n,a)=>({set _(o){A(t,e,o,n)},get _(){return r(t,e,a)}});import{H as Oe,cs as bt,j as s,N as _e,aC as Ft,em as Dn,f7 as Ta,bD as Mo,r as m,aD as ja,R as Me,ag as zs,c as ee,cL as Aa,a7 as jt,a4 as As,M as hn,I as _o,as as Rt,A as K,K as R,aM as Us,bt as nt,ak as qe,P as te,e4 as ss,cm as xt,c2 as yt,aN as Bs,B as Pt,bw as ko,aU as To,fA as jo,cN as be,cA as Ao,ax as No,cq as Ln,fB as Eo,L as Io,fC as Na,e8 as Ea,c8 as it,cD as Fo,cE as Ro,cH as Qt,cF as Yn,cG as Po,J as gt,fD as Do,cK as Lo,aQ as Ns,a_ as Oo,cz as Ia,O as Ke,d8 as zo,ai as qt,fj as Uo,cX as $t,ed as Es,bz as Bo,bM as re,fv as Xn,bQ as at,w as Go,fu as Ho,fE as Fa,fi as Wo,eG as Vo,u as qo,E as Ra,dk as $o,X as Ko,fF as Qo,fG as Yo,bB as Xo,cx as Jo,fH as Zo,cZ as ei,c_ as ti,c$ as si,eh as ni,fI as ai,fJ as Jn,fg as oi,bA as ii,aT as ri,bo as li}from"./d4998ss76kiiys2a.js";import{d as ns,g as ci,H as Pa,c as On,A as di,I as ui,S as hi,G as mi,z as gi,u as fi,a as pi,J as bi,m as xi,K as yi,f as vi}from"./ijnl2vv7sqg077ic.js";import{G as Si,T as Ci}from"./hrpxk0zzejlt1zdz.js";import{hH as Da,co as zn,cn as Un,cq as Bn,n as Gs,b2 as Gn,hI as wi,B as La,eB as Zn,A as Oa,eF as Mi,be as _i,b1 as Xt,U as Hs,hJ as ki,X as mn,bj as Ti,bH as za,aF as Ua,gq as Ba,hK as ji,dK as Ai,ay as Ni,hL as Ei,a8 as Ii,cu as Fi,c3 as Ri,ez as Pi,u as Jt,hM as Is,dO as Ga,ep as Di,a3 as Li,hN as Ha,dS as Fs,eq as Oi,ak as as,bR as zi,bP as Cn,a6 as Ui,hO as Bi,p as _s,eD as Gi,aS as wn,hP as Hi,hQ as Wi,fT as Vi,go as qi,s as Wa,hR as Va,hS as $i,as as Ki,hT as Qi,v as Rs,ao as ot,bs as Ps,bX as Hn,eJ as Yi,hU as Xi,eG as qa,a1 as Ji,hV as Zi,hW as er,cM as tr,G as sr,hX as nr,hY as ar,hZ as or,h_ as ir,h$ as rr,i0 as lr,i1 as cr,i2 as dr,ei as ea,i3 as ur,eC as hr,k as mr,l as gr,i4 as fr,eA as pr,E as br,ab as xr,cP as yr,i5 as ta,hq as sa,i6 as vr,g2 as Sr,bi as Cr,i7 as wr,et as Mr,eu as _r,w as kr,i8 as Tr,gx as na,i9 as jr,P as Ar,ia as Nr,ib as Er,ic as Ir,id as Fr,ie as Rr,ig as Pr,ih as Dr,ii as Lr}from"./cdlu5q20cam9cxqi.js";import{a as Or,t as Mn,T as $a,H as zr,b as Ur,c as Br,d as Gr,e as Hr,M as Ka}from"./bkaw2sh00lkzz1mk.js";import{P as Wr,v as Vr,C as _n,w as qr,l as $r,x as gn,y as Kr,u as Qr,z as fn,F as Yr,T as Xr}from"./mugd6ac6ijbpkvp5.js";import{d as Jr,i as Yt,A as Qa,T as U,e as rt,g as Ws,u as Vs,b as Zr,I as Ya,f as os,c as qs,J as aa,j as oa,K as el,q as $s,a as Xa,L as tl,M as sl,N as nl,k as al,h as ol,O as il,P as rl,Q as Ja,w as Wn,s as ll,t as cl,R as Za,S as eo,U as dl,V as ul,W as to}from"./dhr22l6cwlnk6eb2.js";import{W as hl,C as ml,G as gl,H as Vn}from"./ny02b1r0q2e9w4rr.js";import{m as It}from"./fizvwuv456q1poqt.js";import{U as fl,b as Ds,be as Ks,aK as pl,bc as bl,bP as so,bQ as no,a4 as xl,bR as yl,bS as vl,aH as Sl,bT as Cl,w as wl,av as ao,aw as oo,a as Ml,au as _l,at as kl,t as Tl,bi as jl,bK as Al}from"./jgebgvmmewaiobkz.js";import{H as Nl}from"./ef8byfwb6jmbpt34.js";import{G as El,L as Il}from"./dkgx35h9ryrvx1d6.js";import{d as Fl,r as Rl}from"./lk9nevahcpbvuzfk.js";import{T as Pl,u as Dl,M as io,a as Ll,b as Ol,C as zl,W as Ul}from"./lsfi6dlqht91ibg3.js";import{b as Bl,C as Gl}from"./m8tgv16u8li2vzwm.js";import"./mqgzohfcuqsh3nsb.js";import{D as Te,$ as ro}from"./l0p0xoyhl72xwmj4.js";import{a as Hl,G as Wl}from"./wp5q7ppkt4ddrdq1.js";import{M as Vl}from"./dp5zy89kaoofpkts.js";import{I as ql}from"./ha6wyvptaf6ahwpe.js";import{i as $l}from"./czx8ariycgubr29o.js";function pn({label:t,tooltip:e,Icon:n}){return s.jsxs("div",{className:"flex items-center gap-1 text-sm font-semibold opacity-70",children:[n&&s.jsx(n,{className:"icon-sm"}),s.jsx("div",{children:t}),s.jsx(Gs,{label:e,children:s.jsx(Ds,{className:"icon-sm ml-1"})})]})}function Kl({clientThreadId:t,gizmoId:e}){const n=Oe(),a=Da(),o=zn(),i=Un(),{data:l}=Bn(e,!1,i),c=!!e,d=bt(),h=Jr(t);return i?d&&(!h||c)?s.jsx(pn,{label:n.formatMessage(Mt.temporaryChat),tooltip:n.formatMessage(Mt.temporaryChatTooltip),Icon:fl}):a&&!o&&!d?s.jsx(pn,{label:n.formatMessage(Mt.memoryOff),tooltip:n.formatMessage(Mt.memoryOffTooltip)}):l&&(l==null?void 0:l.memoryFullPct)>=100?s.jsx(pn,{label:n.formatMessage(Mt.memoryFull),tooltip:n.formatMessage(Mt.memoryFullTooltip)}):null:null}const Mt=_e({temporaryChat:{id:"ConversationPrivacyIndicator.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatTooltip:{id:"ConversationPrivacyIndicator.temporaryChatTooltip",defaultMessage:"Temporary Chats won't appear in your history, and ChatGPT won't remember anything you talk about."},memoryOff:{id:"ConversationPrivacyIndicator.memoryOff",defaultMessage:"Memory Off"},memoryOffTooltip:{id:"ConversationPrivacyIndicator.memoryOffTooltip",defaultMessage:"ChatGPT won't remember anything you talk about in this conversation."},memoryFull:{id:"2Eq+5y",defaultMessage:"Memory Full"},memoryFullTooltip:{id:"dNA8jQ",defaultMessage:"ChatGPT's memory is full. You can forget existing memories to make space."}}),ia=4;function Ql(t){const{layer:e}=Ft("4031588851"),{layer:n}=Dn("4031588851");return t?e.get("enable_new_homepage",!1):n.get("enable_new_homepage",!1)}function Yl(){const{layer:t}=Dn("4031588851"),e=t.get("autocomplete_qualified_start_date","2099-09-13T00:00:00Z"),n=Gn();return!!n&&n.created*1e3>=new Date(e).getTime()}function Xl(t){const{layer:e}=Ft("4031588851"),{layer:n}=Dn("4031588851");return t?e.get("enable_new_autocomplete_homepage",!1):n.get("enable_new_autocomplete_homepage",!1)}function Jl(t){return s.jsx(hl,{children:e=>s.jsx(Zl,{...t,composerController:e})})}function Zl({clientThreadId:t,currentModelId:e,onRequestCompletion:n,composerController:a}){const o=Yt(t),i=Qa(t),l=Ta(),c=Mo(),[d,h]=m.useState([]),p=m.useRef(!1);wi(a);const f=ja("589604007").value,{layer:v}=Ft("4031588851"),{promptStarters:S,isSuccess:C,isError:g}=Or(o&&!i,t,c?4:8,f,!0,e),x=!!d.find(F=>!!F.requires_file_upload),u=m.useCallback(F=>{const P=a.getCurrentText();return P&&`${F.title}${F.body}`.toLowerCase().startsWith(P.toLowerCase())},[a]),b=m.useCallback(F=>{const P=a.getCurrentText(),k=F.title+F.body;return u(F)?{...F,title:P,body:k.slice(P.length)}:{...F,title:k,body:""}},[a,u]),w=m.useCallback((F=!1)=>{h(P=>!P.some(u)&&P.length>0?[]:F?P:P.map(b))},[u,b]),y=(F,P,k)=>{const X=`${F.title} `;h([]),a.focus(),a.setText(X),requestAnimationFrame(()=>{const G=((S==null?void 0:S.filter(V=>V.theme===F.theme))??[]).map(V=>({...V,title:`${V.title} `,type:Zn.Autocomplete}));h(G),G.length>0&&Mn(G,t),Ur(F,k,t)})},j=S==null?void 0:S.reduce((F,P)=>(P.theme&&!F[P.theme]&&(F[P.theme]=P),F),{}),D=[];if(j)for(const F in j)D.push(j[F]);const N=D&&D.length>0,W=!!(C&&N),z=ia-d.filter(u).length,_=v.get("autocomplete_mode","HARDCODED"),I=m.useCallback(La(async F=>{const P=a.getCurrentText();if(!P||P.length<2||P.length>80){h([]);return}if(!p.current)try{const X=(await Me.generateAutocompletions(P,F)).completions.map(G=>({id:zs(),type:Zn.Autocomplete,title:P,body:G.slice(P.length),oneliner:G,prompt:G})).filter(u).map(b);h(G=>{const V=G.filter(u),Z=X.filter(ne=>!V.some(ze=>ze.title===ne.title&&ze.body===ne.body)).slice(0,ia-V.length);return[...V,...Z]}),X.length>0&&Mn(X,t)}catch{}},_==="BING"?150:200),[a,_,b]),q=m.useCallback(()=>{w(),z>0&&I(z)},[I,w,z]);m.useEffect(()=>{p.current&&h([])},[p]);const B=m.useMemo(()=>_==="HARDCODED"?w:q,[_,q,w]),se=m.useCallback(()=>{a instanceof ml&&w(!0)},[a,w]);return s.jsx(s.Fragment,{children:s.jsx(Oa,{children:(g||C)&&s.jsx(s.Fragment,{children:s.jsx($a,{isStaticSharedThread:!1,showInlineEmbeddedDisplay:!1,withVerticalPadding:!0,withHorizontalPadding:!0,clientThreadId:t,children:s.jsxs(zr,{children:[s.jsx(ec,{}),s.jsx("div",{className:"w-full",children:s.jsx(Wr,{clientThreadId:t,isNewThread:o,currentModelId:e,onRequestCompletion:n,showPromptStarters:!1,composerController:a,autocompletions:d,requiresFileUpload:x,onComposerInput:B,onComposerChange:se,onAutocompleteSelect:(F,P,k)=>{h([P[k]])},onTaggingDropdownClose:()=>{p.current=!1},onTaggingDropdownOpen:()=>{p.current=!0},hideHeader:!0})}),W&&s.jsx(tc,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},promptStarters:D,onSelectStarterPrompt:y,isSendBlocked:l,clientThreadId:t,className:"h-8"})]})})})})})}function ec(){const{layer:t}=Ft("4031588851"),e=t.get("headline_option","HELP_WITH"),a=Oe().formatMessage(e==="WHERE_TO_START"?kn.whereShouldWeStart:kn.whatCanIHelpWith),[o,i]=m.useState(1),[l,c]=m.useState(!0),d=20;return m.useEffect(()=>{let h;return o<a.length?h=setTimeout(()=>{i(o+1)},d):l&&(h=setTimeout(()=>{c(!1)},500)),()=>clearTimeout(h)},[a,o,l]),s.jsx("div",{className:"text-center",children:s.jsxs("div",{className:"mb-7 inline-flex justify-center text-2xl font-semibold leading-9",children:[s.jsx("h1",{children:a.substring(0,o)}),s.jsx("h1",{className:"result-streaming transition-opacity",style:{opacity:l?1:0},children:s.jsx("span",{})})]})})}function tc({promptStarters:t,onSelectStarterPrompt:e,isSendBlocked:n,clientThreadId:a,...o}){return s.jsx(It.div,{...o,children:s.jsx(oc,{starterPrompts:t,onSelectStarterPrompt:e,disabled:n,clientThreadId:a})})}const sc=/\s/;function nc({starterPrompt:t,starterPrompts:e,index:n,disabled:a,onSelectStarterPrompt:o}){const i=t.theme??t.title,l=sc.test(i);return s.jsxs("button",{className:"relative flex items-center gap-1.5 rounded-full border border-token-border-light px-3 py-2 text-start text-[13px] shadow-xxs transition enabled:hover:bg-token-main-surface-secondary disabled:cursor-not-allowed xl:gap-2 xl:text-[14px]",disabled:a,onClick:()=>o(t,e,n),children:[s.jsx(Mi,{starterPrompt:t,useV2Colors:!0}),s.jsx("div",{className:ee("max-w-full text-balance text-gray-600 dark:text-gray-500",l?"break-word":"break-all"),children:i})]})}function ra({starterPrompts:t,onSelectStarterPrompt:e,disabled:n,clientThreadId:a,children:o}){return m.useEffect(()=>{Mn(t,a)},[a]),s.jsxs("ul",{className:"flex max-w-3xl flex-wrap items-stretch justify-center gap-2 xl:mx-3 xl:gap-2.5",children:[t.map((i,l)=>s.jsx(It.li,{initial:{opacity:0},animate:{opacity:1},transition:{delay:l*.03},exit:{opacity:0},children:s.jsx(nc,{starterPrompt:i,starterPrompts:t,index:l,disabled:n,onSelectStarterPrompt:e})},i.id??l)),o]})}function ac({clientThreadId:t,onClick:e}){m.useEffect(()=>{Br(t)},[t]);const n=Oe();return s.jsx("button",{className:"relative flex max-w-full items-center gap-2 text-balance rounded-full border border-token-border-light px-3 py-2 text-start text-[14px] text-gray-600 shadow-xxs transition enabled:hover:bg-token-main-surface-secondary disabled:cursor-not-allowed dark:text-gray-500",onClick:()=>{Gr(t),e()},children:n.formatMessage(kn.moreStarterPrompts)})}function oc({starterPrompts:t,onSelectStarterPrompt:e,disabled:n,clientThreadId:a}){const[o,i]=m.useState(4),l=4,c=t.slice(0,l),d=t.slice(l,o).map(h=>({...h,isAdditional:!0}));return s.jsxs("div",{className:"mt-7 flex flex-col flex-wrap gap-y-2.5",children:[s.jsx("div",{children:s.jsx(ra,{starterPrompts:c,onSelectStarterPrompt:e,disabled:n,clientThreadId:a,children:t.length>o&&s.jsx(ac,{clientThreadId:a,onClick:()=>{i(t.length)}})})}),d&&d.length>0&&s.jsx(ra,{starterPrompts:d,onSelectStarterPrompt:e,disabled:n,clientThreadId:a})]})}const kn=_e({whatCanIHelpWith:{id:"SplashScreenV2.whatCanIHelpWith",defaultMessage:"What can I help with?"},whereShouldWeStart:{id:"SplashScreenV2.whereShouldWeStart",defaultMessage:"Where should we start?"},moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),_t=_e({submitRejectModeration:{id:"feedbackModal.moderationReject",defaultMessage:"Block Content"},submitAcceptModeration:{id:"feedbackModal.moderationAccept",defaultMessage:"Allow Content"},thumbsDownPlaceholder:{id:"feedbackModal.thumbsDownPlaceholder",defaultMessage:"What was the issue with the response? How could it be improved?"},copyrightContent:{id:"feedbackModal.copyrightContent",defaultMessage:"This content violates copyright law"},reportOtherContent:{id:"feedbackModal.reportOtherContent",defaultMessage:"I don't like this for some other reason (please describe)"},provideAdditionalFeedback:{id:"feedbackModal.provideAdditionalFeedback",defaultMessage:"Provide additional feedback"}});function ic({onClose:t,clientThreadId:e}){var u;const n=Oe(),a=U.getTree(e),o=(u=m.useContext(Aa))==null?void 0:u.serverSharedThreadId,i=U.getServerThreadId(e),l=o??i,c=m.useRef([]),d=m.useRef(""),h=m.useRef(null),p=m.useCallback(()=>{var w;const b=(w=h.current)==null?void 0:w.elements;c.current=[...b||[]].filter(y=>y.checked).map(y=>y.id).map(y=>y.replace("feedback-","")),d.current=(b==null?void 0:b["feedback-other"].value)||""},[]),f=m.useCallback((b,w)=>{if(l==null){jt.danger("Moderation NOT logged successfully! serverThreadId is null"),As.addError("Moderation: serverThreadId is null");return}const y=a.getMessageId(U.getThreadCurrentLeafId(e));Me.submitSharedConversationReportFeedback({message_id:y,shared_conversation_id:l,text:b,tags:w}).then(()=>{jt.success("Moderation logged successfully")}).catch(j=>{jt.danger("Moderation NOT logged successfully! Please try again"),As.addError(new Error("Moderation: failed to log",{cause:j}))}),t()},[a,e,t,l]),v=m.useCallback(()=>{p(),c.current.push("moderation-reject"),f(d.current,c.current)},[f,p]),S=m.useCallback(()=>{p(),c.current.push("moderation-accept"),f(d.current,c.current)},[f,p]),C=s.jsxs(s.Fragment,{children:[s.jsx(hn.Button,{title:n.formatMessage(_t.submitRejectModeration),color:"danger",onClick:v}),s.jsx(hn.Button,{title:n.formatMessage(_t.submitAcceptModeration),color:"primary",onClick:S})]}),[g,x]=m.useState([]);return m.useEffect(()=>{Me.fetchShareModerationCategories().then(b=>{const w=b.moderation_categories;x(Object.keys(w).map(y=>[y,w[y]]))})},[]),s.jsxs(_o,{isOpen:!0,onClose:t,showCloseButton:!0,size:"custom",className:"md:max-w-[672px] lg:max-w-[896px] xl:max-w-6xl",type:"success",title:n.formatMessage(_t.provideAdditionalFeedback),children:[s.jsxs("form",{ref:h,children:[s.jsx(ki,{id:"feedback-other",placeholder:n.formatMessage(_t.thumbsDownPlaceholder),rows:3,className:"mb-1 mt-4 w-full resize-none rounded-md bg-token-main-surface-primary"}),s.jsxs("div",{className:"mb-4",children:[g.map(([b,w])=>s.jsx(mn,{id:"feedback-"+b,label:w},b)),s.jsx(mn,{id:"feedback-copyright",label:n.formatMessage(_t.copyrightContent)}),s.jsx(mn,{id:"feedback-content-other",label:n.formatMessage(_t.reportOtherContent)})]})]}),s.jsx(hn.Actions,{primaryButton:C})]})}function rc({clientThreadId:t}){return _i(Xt.SharedConversationModeration)?s.jsx(ic,{onClose:()=>Hs.closeModal(Xt.SharedConversationModeration),clientThreadId:t}):null}const lc=({clientThreadId:t})=>{const e=Rt(),n=rt(t),{data:a,isLoading:o}=ns(n);if(o)return null;const i=e!=null&&e.accountUserId?a?bn.loggedInCtaGizmo:bn.loggedInCta:bn.loggedOutCta,l=e&&a?ci(a):"/";let c=K.sharedConversationLoggedOutClicked;return e&&(e!=null&&e.accountUserId)&&(e.isFree()?c=a?K.sharedConversationFreeGizmoClicked:K.sharedConversationFreeClicked:c=a?K.sharedConversationPaidGizmoClicked:K.sharedConversationPaidClicked),s.jsx("div",{className:"flex flex-col items-center gap-4",children:s.jsx(Ti,{href:l,onClickTrackingEventName:c,children:s.jsx(R,{...i,values:{name:a==null?void 0:a.gizmo.display.name}})})})},bn=_e({loggedOutCta:{id:"GizmoSharedConversationCTA.loggedOutCta",defaultMessage:"Sign up to chat"},loggedInCtaGizmo:{id:"GizmoSharedConversationCTA.loggedInCtaGizmo",defaultMessage:"Get started with {name}"},loggedInCta:{id:"GizmoSharedConversationCTA.loggedInCta",defaultMessage:"Get started with ChatGPT"}});function cc({clientThreadId:t,isModeratingThread:e,continueConversationUrl:n}){const a=Us(),o=Oe(),{layer:i}=Ft("2840731323"),l=i.get("is_continue_enabled",!1)||(a==null?void 0:a.includes("debug"));return s.jsxs("div",{className:"relative flex w-full flex-1 flex-col items-center justify-center gap-2 pt-3 empty:hidden sm:flex-row",children:[!l&&s.jsx(lc,{clientThreadId:t}),e&&s.jsx(nt,{onClick:()=>{Hs.openModal(Xt.SharedConversationModeration)},children:o.formatMessage({id:"thread.sharedConversation.moderate",defaultMessage:"Moderate conversation"})}),l&&n&&s.jsx(nt,{color:"primary",as:"link",to:n,size:"giant",onClick:()=>{qe.logEvent("chatgpt_continue_shared_conversation_click"),te.logEvent(K.sharedConversationContinueConversationClicked)},children:o.formatMessage({id:"thread.sharedConversation.continue",defaultMessage:"Continue this conversation"})})]})}function dc({children:t}){const e=za(Ua.AG8PqS2q),{eligible:n,isLoading:a}=Fl(),{doesUserHaveAnyAccountsWithPlusFeatures:o}=ss(),i=n&&!a;if(m.useEffect(()=>{i&&te.logEvent(K.gpt4oNUXTooltipShown)},[i]),!i)return s.jsx(s.Fragment,{children:t});const l=()=>{te.logEvent(K.gpt4oNUXTooltipDismissed),e.markAsViewed()};return s.jsx(Ba,{side:"bottom",show:!0,title:s.jsx(R,{...xn.title,values:{modelName:"GPT‑4o"}}),onDismiss:l,sideOffset:0,theme:"default",description:s.jsx(R,{...o?xn.bodyPaidFinal:xn.bodyFreeFinal,values:{modelName:"GPT‑4o",anotherModelName:"GPT‑4"}}),children:t})}const xn=_e({title:{id:"1kewDD",defaultMessage:"Introducing {modelName}"},bodyPaidFinal:{id:"Z6KHqN",defaultMessage:"You can now try our newest model, {modelName}. It’s faster than {anotherModelName}, better at understanding images, and speaks more languages."},bodyFreeFinal:{id:"w8Y79o",defaultMessage:"You now have limited access to our latest model, {modelName}. It’s smarter, understands images, can browse the web, and speaks more languages."}}),uc=xt(()=>yt(()=>import("./fbc2q72tkeazln1g.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30])).then(t=>t.GizmoUsingAsOwnerNotice)),hc=({clientThreadId:t})=>{const e=Ii(d=>d.activeStageSidebar),n=U.getServerThreadId(t),a=Fi(Bs.WorkspaceShareLinks),{isUnauthenticated:o}=Pt(),i=bt(),l=a&&n&&!o&&!i,c=!e;return s.jsx("div",{className:"flex items-center gap-2 pr-1 leading-[0]",children:s.jsx(Gl,{showShareButton:l,showProfileDropdown:c,clientThreadId:t})})};function mc({clientThreadId:t,gizmoId:e}){var i;const n=ji(),{data:a}=ns(e),o=Rt();return s.jsxs(s.Fragment,{children:[s.jsxs(Ai,{className:"max-md:hidden",children:[s.jsxs("div",{className:"absolute start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2",children:[a!=null&&(o==null?void 0:o.isWorkspaceAccount())&&((i=a.gizmo.tags)==null?void 0:i.includes(Ni.WorkspaceDisabled))&&s.jsx(uc,{gizmo:a}),s.jsx(Kl,{gizmoId:e,clientThreadId:t})]}),s.jsx(dc,{children:s.jsxs("div",{className:"flex items-center gap-0 overflow-hidden",children:[s.jsx(Bl,{clientThreadId:t}),s.jsx(Pl,{clientThreadId:t})]})}),s.jsx(hc,{clientThreadId:t})]}),n&&s.jsx(Ei,{})]})}function lo({clientThreadId:t}){const e=rt(t);return Ws()?null:s.jsx(mc,{gizmoId:e,clientThreadId:t})}function gc({clientThreadId:t,currentModelId:e,onRequestCompletion:n,enableV2Homepage:a}){const o=bt();let i=s.jsx(Il,{}),l;return o?(l=s.jsx(fc,{}),i=s.jsx(To,{className:"mb-6 h-12 w-12"})):t!=null?(l=a?s.jsx(Jl,{clientThreadId:t,currentModelId:e,onRequestCompletion:n}):s.jsx(Hr,{clientThreadId:t}),i=null):l=s.jsx(pc,{}),s.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-token-text-primary",children:[i,l]})}function fc({gizmo:t}){const e=Da(),n=t?gl(t.tools):!1,a=Rt();return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"mb-5 text-2xl font-semibold",children:s.jsx(R,{...ht.temporaryChat})}),s.jsxs("div",{className:"max-w-sm text-center text-sm font-normal text-token-text-tertiary",children:[s.jsx(R,{...a!=null&&a.isWorkspaceAccount()?e?ht.temporaryChatBizMemoryAvailable:ht.temporaryChatBizMemoryUnavailable:e?ht.temporaryChatDescriptionMemoryAvailable:ht.temporaryChatDescriptionMemoryUnavailable}),n&&s.jsx("div",{className:"mt-3",children:s.jsx(R,{...ht.temporaryChatDescriptionGptActions,values:{link:o=>s.jsx("a",{href:"https://help.openai.com/en/articles/8914046-temporary-chat-faq",target:"_blank",className:"underline",rel:"noreferrer",children:o})}})})]})]})}function pc(){return s.jsx("div",{className:"mb-5 text-2xl font-semibold",children:s.jsx(R,{...ht.howCanIHelpYouToday})})}function bc({clientThreadId:t,currentModelId:e,onRequestCompletion:n,enableV2Homepage:a}){const o=rt(t),i=Ri(),l=Ta(),{data:c}=ns(o),d=Pi(),h=ko(()=>navigator.windowControlsOverlay);return(i!=null||o!=null)&&c==null?null:s.jsxs("div",{className:"relative h-full",children:[s.jsx("div",{className:h!=null&&h.visible?ee("absolute right-[calc(100dvw-env(titlebar-area-width,100dvw)-env(titlebar-area-x,0))]",d?"left-[env(titlebar-area-x,0)]":"left-0"):"absolute left-0 right-0",children:s.jsx(lo,{clientThreadId:t})}),c!=null?s.jsx(El,{gizmo:c,showStarterPrompts:!0,disableStarterPrompts:l}):s.jsx(gc,{clientThreadId:t,currentModelId:e,onRequestCompletion:n,enableV2Homepage:a})]})}const ht=_e({temporaryChat:{id:"GizmoLanding.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatBizMemoryAvailable:{id:"g1opBW",defaultMessage:"This chat won't appear in your history and won't use or create memories."},temporaryChatBizMemoryUnavailable:{id:"fQmbtG",defaultMessage:"This chat won't appear your conversation history."},temporaryChatDescriptionMemoryAvailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryAvailable",defaultMessage:"This chat won't appear in history, use or create memories, or be used to train our models. For safety purposes, we may keep a copy for up to 30 days."},temporaryChatDescriptionMemoryUnavailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryUnavailable",defaultMessage:"This chat won't appear in history or be used to train our models. For safety purposes, we may keep a copy of this chat for up to 30 days."},temporaryChatDescriptionGptActions:{id:"GizmoLanding.temporaryChatDescriptionGptActions",defaultMessage:"Any data shared with a third party through GPT actions are subject to the third party's privacy policy. <link>Learn more</link>"},howCanIHelpYouToday:{id:"GizmoLanding.howCanIHelpYouToday",defaultMessage:"How can I help you today?"}});function co(t){const n=Vs(t)==="root",a=Zr(t),o=Jt(a),{serviceStatus:i}=m.useContext(jo),l=Is(),{isUnauthenticated:c}=Pt(),d=Ya(t);return!n&&!o&&!(i!=null&&i.oof)&&!l.displayingSideBySideFeedback&&!c&&!d}const uo=({clientThreadId:t,message:e})=>{var b,w,y,j,D,N,W,z;const n=Dl(),a=Pa(),o=za(Ua.ModelSwitcherAutoDowngrade),{categories:i}=On({isRegen:!0}),l=di({clientThreadId:t}),{doesUserHaveAnyAccountsWithPlusFeatures:c}=ss(),d=ui()!=null,h=[];for(const _ of i){if(Ga(_))continue;const{defaultModel:I,label:q,tagline:B,categoryId:se,subscriptionLevel:F,subcategory:P}=_,k=(w=(b=l[I])==null?void 0:b.regenerate)==null?void 0:w[0];h.push({label:q,value:I,subtitle:B,icon:s.jsx(io,{className:"icon-md h-4 w-4",categoryId:se,type:"filled"}),modelSwitcherDeny:k,subscriptionLevel:F,subcategory:P})}const p=xc(t,e.nodeId),f=(y=e.message.metadata)==null?void 0:y.model_slug,v=(j=n.find(_=>_.value===f))==null?void 0:j.name,S=f!=null?a[f]:void 0,C=(S==null?void 0:S.enabledTools)||[],g=yc(d,p,f),x=(D=e.message.metadata)==null?void 0:D.model_adjustments,u=c&&o.eligible&&!o.isLoading&&v&&((N=h[0])==null?void 0:N.label)&&v!==((W=h[0])==null?void 0:W.label)&&(x==null?void 0:x.some(_=>_.startsWith("auto:smaller_model")));return{modelOptions:h,modelSlug:f,messageModelEnabledTools:C,animateModelLabelOnRender:g,nuxProps:{shouldRenderNux:u,usedModelName:v,largestModelName:(z=h[0])==null?void 0:z.label,announcement:o}}};function xc(t,e){var l,c;return(c=(l=U.getTree(t).getConversationTurns(e).flatMap(d=>d.messages).filter(d=>d.message.author.role===be.Assistant&&!Ao(d.message)).reverse()[1])==null?void 0:l.message.metadata)==null?void 0:c.model_slug}function yc(t,e,n){return t&&!e?!0:!!(e&&n!==e)}function vc(){const{doesUserHaveAnyAccountsWithPlusFeatures:t}=ss(),{categories:e}=On();return!!t||!!e.find(Ga)}const Tt=({modelSwitcherDeny:t,value:e,label:n,subtitle:a,icon:o,onMouseEnter:i,onMouseLeave:l,onSelect:c,messageModelSlug:d,isHovered:h=!1,shouldShowUpsell:p=!1,className:f,includeCheck:v,includeRegenerate:S,justifyIcon:C,wrapIcon:g=!0})=>{const x=Rt(),u=!t,b=!u&&!p,w=No(),y=()=>{if(!p){c==null||c();return}te.logEvent(K.openModalAccountPaymentfromMessageModelPicker),te.logRateLimitGetPlusButtonClicked({type:Ln.RATE_LIMIT,location:"message_model_switcher_dropdown",plan_type:(x==null?void 0:x.planType)??"unknown",is_hard_block:!1,hard_block_reason:"",is_new_conversation:!1}),Li(w,"Message model switcher dropdown")};return s.jsx(Te.Item,{onSelect:y,onMouseEnter:()=>u&&(i==null?void 0:i()),onMouseLeave:()=>u&&(l==null?void 0:l()),disabled:b,className:f??"radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed radix-disabled:hover:bg-transparent",children:s.jsxs(Gs,{label:t&&s.jsx(Di,{modelSwitcherDeny:t}),className:"flex w-full items-center justify-between gap-2",sideOffset:0,children:[s.jsxs("div",{className:ee("flex items-center gap-3",C==="right"&&"w-full"),children:[!!o&&(g?s.jsx("span",{className:ee("flex h-7 w-7 items-center justify-center rounded-full bg-token-main-surface-secondary",C==="right"&&"order-10 ml-auto"),children:o}):o),s.jsxs("div",{children:[s.jsx("div",{children:n}),s.jsx("div",{className:ee({"text-sm text-token-text-secondary":!b},{"text-sm text-token-text-quaternary":b}),children:a})]})]}),p?s.jsx(nt,{color:"secondary",size:"small",children:s.jsx(R,{id:"54fmrA",defaultMessage:"Get Plus"})}):s.jsx(Sc,{messageModelSlug:d,isHovered:h,modelSwitcherDeny:t,optionModelSlug:e,includeCheck:v,includeRegenerate:S})]})})},Sc=({modelSwitcherDeny:t,optionModelSlug:e,isHovered:n,messageModelSlug:a,includeRegenerate:o=!0,includeCheck:i=!0})=>{let l=null;if(t)switch(t.reason){case Ln.RATE_LIMIT:l=bl;break;default:l=Ds;break}if(t)return s.jsx(l,{className:"icon-md"});const c=!!o&&s.jsx(Ks,{className:ee("icon-md hidden text-token-text-tertiary",{"group-hover:block":n})});return a===e&&i?s.jsxs(s.Fragment,{children:[s.jsx(pl,{className:ee("icon-md text-token-text-primary",{"group-hover:hidden":n})}),c]}):c};function Cc({className:t,clientThreadId:e,message:n,onModelSelect:a,onDropdownChange:o}){var P;const i=Oe(),[l,c]=m.useState(null),[d,h]=m.useState(!1),[p,f]=m.useState(!1),v=vc(),S=co(e),C=rt(e),g=uo({clientThreadId:e,message:n}),x=(P=n.message.metadata)==null?void 0:P.model_slug,{modelOptions:u,modelSlug:b,animateModelLabelOnRender:w,nuxProps:y,messageModelEnabledTools:j}=g,D=Ha(n.message),N=j.includes(Fs.Search),W=m.useMemo(()=>u.find(k=>k.value==x),[u,x]),{doesUserHaveAnyAccountsWithPlusFeatures:z}=ss(),_=m.useRef(null),I=k=>{k||setTimeout(()=>{_.current&&_.current.blur()},10)};if(m.useEffect(()=>{I(d)},[d]),!v||C)return null;const q=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:i.formatMessage(la.search),icon:s.jsx(so,{className:"icon-sm"}),condition:N&&!D},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:i.formatMessage(la.nosearch),icon:s.jsx(no,{className:"icon-sm"}),condition:N&&D}];let B,se;y.shouldRenderNux?(B=Mc,se={title:s.jsx(R,{id:"g/+2Hh",defaultMessage:"Optimized your response"}),description:s.jsx(R,{id:"H0Flqm",defaultMessage:"Used {usedModelName} for a faster response that saves your limited {largestModelName} messages",values:{usedModelName:y.usedModelName,largestModelName:y.largestModelName}}),markAsViewed:y.announcement.markAsViewed}):(B=wc,se={label:S?s.jsx(R,{id:"LBYK9a",defaultMessage:"Change model"}):s.jsx(R,{id:"nygjPN",defaultMessage:"Used {modelName}",values:{modelName:y.usedModelName}})});const F=S&&u.some(k=>Zt(k,z));return s.jsxs(Te.Root,{onOpenChange:k=>{S&&(h(k),o(k),I(k)),k&&te.logEvent(K.conversationOpenMessageModelSelector,{has_get_plus_button:F})},children:[s.jsx(B,{...se,children:s.jsx(ro,{ref:_,className:ee("cursor-pointer",t),onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:s.jsx(Tn,{modelSlug:b,animateModelLabelOnRender:w,isDropdownOpen:d,isRegenerateEnabled:S,isHovered:p})})}),S&&s.jsxs(Te.Content,{className:"z-30 origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[u.map(k=>{var Z;const X=Zt(k,z),{value:G,...V}=k;return s.jsx(Tt,{value:G,onSelect:()=>a({requestedModelId:G}),onMouseEnter:()=>c(G),onMouseLeave:()=>c(null),isHovered:l===G,messageModelSlug:(Z=n.message.metadata)==null?void 0:Z.model_slug,shouldShowUpsell:X,...V},G)}),!!W&&s.jsxs(s.Fragment,{children:[s.jsx(Te.Separator,{}),q.filter(k=>k.condition).map(k=>s.jsx(Tt,{onSelect:()=>a({requestedModelId:W.value,extraStreamParams:k.extraStreamParams}),includeRegenerate:!0,onMouseEnter:()=>c(k.key),onMouseLeave:()=>c(null),isHovered:l===k.key,messageModelSlug:x,includeCheck:!1,...W,label:k.label,subtitle:"",icon:k.icon},k.key))]})]})]})}function Tn({modelSlug:t,animateModelLabelOnRender:e,isDropdownOpen:n,isRegenerateEnabled:a,isHovered:o,isRegenLabel:i=!1,animateShortLabel:l,omitIcon:c}){const[d,h]=m.useState("initial"),{categories:p}=On({isRegen:!!i});m.useEffect(()=>{if(e){const u=setTimeout(()=>h("show"),500),b=setTimeout(()=>h("initial"),2e3);return()=>{clearTimeout(u),clearTimeout(b)}}h("initial")},[e]);const f=p.find(({defaultModel:u})=>u===t),v=t===hi?{categoryId:"gpt_3.5",shorterLabel:"3.5"}:{},{categoryId:S,shorterLabel:C}=f??v,g={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},x=n?"visible":o?"show":d;return s.jsxs(It.div,{initial:"initial",animate:x,className:"flex items-center pb-0",children:[!c&&(i?s.jsx(Ks,{className:"icon-md"}):S&&s.jsx(io,{type:"outline",categoryId:S,className:"icon-md h-4 w-4"})),(a||l)&&s.jsx(It.span,{className:"overflow-hidden text-clip whitespace-nowrap text-sm",variants:g,transition:{type:"tween",duration:.18},children:C}),a&&s.jsx(xl,{className:ee("icon-sm",{"text-token-text-quaternary":!o&&!i},{"text-token-text-secondary":o&&!i})})]})}function wc({children:t,label:e}){return s.jsx(Gs,{label:e,sideOffset:0,children:t})}function Mc({children:t,title:e,description:n,markAsViewed:a}){return s.jsx(Ba,{show:!0,side:"bottom",sideOffset:-4,title:e,description:n,badge:"beta",onDismiss:a,dismissOnOutsideClick:!0,children:t})}function Zt(t,e){const{modelSwitcherDeny:n,subscriptionLevel:a}=t;return!!n&&n.reason===Ln.RATE_LIMIT&&a===Eo.PLUS&&!e}const la=_e({search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),_c=m.memo(Cc),ca=Io.IndepthFeedbackDismissedAt;function kc(){const[t,e]=m.useState(()=>{const a=localStorage.getItem(ca);return a?Tc(new Date(a)):!1}),n=m.useCallback(()=>{e(!0),localStorage.setItem(ca,new Date().toISOString())},[]);return[t,n]}function Tc(t){const e=new Date;return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}function jc({clientThreadId:t,conversationLeafId:e,trigger:n,variantIds:a}){const o=a.find(p=>p!==e),i=as(p=>p.forceIndepthFeedback&&p.forceIndepthFeedbackPrompt),l=qe.getExperimentValue({experimentName:"4146182738",key:n==="paragen"?"enable_indepth_feedback_paragen":"enable_indepth_feedback_thumbsdown",defaultValue:!1,shouldLogExposure:!1}),c=qe.getExperimentValue({experimentName:"4146182738",key:n==="paragen"?"indepth_feedback_paragen_prompt":"indepth_feedback_thumbsdown_prompt",defaultValue:"",shouldLogExposure:!1}),d=o?U.getTree(t).getTextFromNode(o):"NONE";return(i||(l?c:"")).replace("{paragen_losing_response}",d)}function Ac({clientThreadId:t,conversationLeafId:e,trigger:n,variantIds:a}){const[o,i]=kc(),l=Ec({clientThreadId:t}),c=jc({clientThreadId:t,conversationLeafId:e,trigger:n,variantIds:a}),d=()=>{i(),te.logEventWithStatsig(K.messageIndepthFeedbackDeclined,"chatgpt_indepth_feedback_declined",{trigger:n})},h=()=>{const p=new Cn;l(e,{intent:"indepth_feedback"},c,p),te.logEventWithStatsig(K.messageIndepthFeedbackAccepted,"chatgpt_indepth_feedback_accepted",{trigger:n})};return o||!c?null:s.jsx(zi,{content:s.jsx(R,{...yn.indepthFeedbackPrompt}),primaryCtaText:s.jsx(R,{...yn.indepthFeedbackAcceptButton}),onPrimaryCtaClick:h,secondaryCtaText:s.jsx(R,{...yn.indepthFeedbackRejectButton}),onSecondaryCtaClick:d})}function Nc(t){const e=t.rating==="thumbsDown"?"thumbsDown":Oi(["original","new"],t.inlineComparisonRating)?"paragen":void 0,n=as(o=>o.forceIndepthFeedback);if(!e||n||e==="paragen"||qe.getExperimentValue({experimentName:"4146182738",key:"enable_indepth_feedback_thumbsdown",defaultValue:!1,shouldLogExposure:!0}))return e}function Ec({clientThreadId:t}){const e=m.useContext(Na),n=os.getConversationMode(t);return(o,i,l,c)=>{e({type:Ea.Next,promptId:o,eventMetadata:i,focusOnNewCompletion:!0,cancelActiveRequests:!1,completionMetadata:{conversationMode:n},useDefaultModel:!1,appendMessages:[{id:zs(),author:{role:be.System},content:{content_type:it.Text,parts:[l]},metadata:{is_indepth_feedback:!0,indepth_feedback_prompt:l}}],turnTracker:c})}}const yn=_e({indepthFeedbackPrompt:{id:"qEHwDx",defaultMessage:"Would you like to tell ChatGPT more about your feedback, so it can improve its responses?"},indepthFeedbackAcceptButton:{id:"IeyTQ7",defaultMessage:"Continue"},indepthFeedbackRejectButton:{id:"+o5xmp",defaultMessage:"Not now"},indepthFeedbackRejectAlwaysButton:{id:"Qdko+f",defaultMessage:"Don't ask again"}});function Ic({clientThreadId:t,conversationMode:e}){const n=Vr(t);return({id:o,eventMetadata:i,turnTracker:l,requestedModelId:c,systemMessage:d,juice:h,extraStreamParams:p})=>{const v=U.getTree(t).getConversationTurns(o),S=v==null?void 0:v[(v==null?void 0:v.length)-1].variantIds,C=(S==null?void 0:S.length)===1&&(p==null?void 0:p.forceUseSearch)===void 0,g=C?{...i,intent:"comparison_implicit"}:i;n({id:o,requestedModelId:c,eventMetadata:g,focusOnNewCompletion:!0,variantPurpose:C?"comparison_implicit":"none",conversationMode:e??os.getConversationMode(t),useDefaultModel:!1,appendMessages:d?[{id:zs(),author:{role:be.System},content:{content_type:it.Text,parts:[d]},metadata:{exclude_after_next_user_message:!0}}]:void 0,juice:h,turnTracker:l,extraStreamParams:p})}}const kt=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,ho=new Set,jn=typeof process=="object"&&process?process:{},mo=(t,e,n,a)=>{typeof jn.emitWarning=="function"?jn.emitWarning(t,e,n,a):console.error(`[${n}] ${e}: ${t}`)};let Ls=globalThis.AbortController,da=globalThis.AbortSignal;var Ma;if(typeof Ls>"u"){da=class{constructor(){J(this,"onabort");J(this,"_onabort",[]);J(this,"reason");J(this,"aborted",!1)}addEventListener(a,o){this._onabort.push(o)}},Ls=class{constructor(){J(this,"signal",new da);e()}abort(a){var o,i;if(!this.signal.aborted){this.signal.reason=a,this.signal.aborted=!0;for(const l of this.signal._onabort)l(a);(i=(o=this.signal).onabort)==null||i.call(o,a)}}};let t=((Ma=jn.env)==null?void 0:Ma.LRU_CACHE_IGNORE_AC_WARNING)!=="1";const e=()=>{t&&(t=!1,mo("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}const Fc=t=>!ho.has(t),Ze=t=>t&&t===Math.floor(t)&&t>0&&isFinite(t),go=t=>Ze(t)?t<=Math.pow(2,8)?Uint8Array:t<=Math.pow(2,16)?Uint16Array:t<=Math.pow(2,32)?Uint32Array:t<=Number.MAX_SAFE_INTEGER?ks:null:null;class ks extends Array{constructor(e){super(e),this.fill(0)}}var At;const mt=class mt{constructor(e,n){J(this,"heap");J(this,"length");if(!r(mt,At))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new n(e),this.length=0}static create(e){const n=go(e);if(!n)return[];A(mt,At,!0);const a=new mt(e,n);return A(mt,At,!1),a}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}};At=new WeakMap,H(mt,At,!1);let An=mt;var _a,ka,Ne,ve,Ee,Ie,Nt,ie,Fe,oe,Y,E,fe,Se,ge,de,Re,ue,Pe,De,Ce,Le,st,pe,M,En,ft,Ve,es,we,fo,pt,Et,ts,et,tt,In,Ts,js,Q,Fn,Kt;const Kn=class Kn{constructor(e){H(this,M);H(this,Ne);H(this,ve);H(this,Ee);H(this,Ie);H(this,Nt);J(this,"ttl");J(this,"ttlResolution");J(this,"ttlAutopurge");J(this,"updateAgeOnGet");J(this,"updateAgeOnHas");J(this,"allowStale");J(this,"noDisposeOnSet");J(this,"noUpdateTTL");J(this,"maxEntrySize");J(this,"sizeCalculation");J(this,"noDeleteOnFetchRejection");J(this,"noDeleteOnStaleGet");J(this,"allowStaleOnFetchAbort");J(this,"allowStaleOnFetchRejection");J(this,"ignoreFetchAbort");H(this,ie);H(this,Fe);H(this,oe);H(this,Y);H(this,E);H(this,fe);H(this,Se);H(this,ge);H(this,de);H(this,Re);H(this,ue);H(this,Pe);H(this,De);H(this,Ce);H(this,Le);H(this,st);H(this,pe);H(this,ft,()=>{});H(this,Ve,()=>{});H(this,es,()=>{});H(this,we,()=>!1);H(this,pt,e=>{});H(this,Et,(e,n,a)=>{});H(this,ts,(e,n,a,o)=>{if(a||o)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0});J(this,_a,"LRUCache");const{max:n=0,ttl:a,ttlResolution:o=1,ttlAutopurge:i,updateAgeOnGet:l,updateAgeOnHas:c,allowStale:d,dispose:h,disposeAfter:p,noDisposeOnSet:f,noUpdateTTL:v,maxSize:S=0,maxEntrySize:C=0,sizeCalculation:g,fetchMethod:x,noDeleteOnFetchRejection:u,noDeleteOnStaleGet:b,allowStaleOnFetchRejection:w,allowStaleOnFetchAbort:y,ignoreFetchAbort:j}=e;if(n!==0&&!Ze(n))throw new TypeError("max option must be a nonnegative integer");const D=n?go(n):Array;if(!D)throw new Error("invalid max value: "+n);if(A(this,Ne,n),A(this,ve,S),this.maxEntrySize=C||r(this,ve),this.sizeCalculation=g,this.sizeCalculation){if(!r(this,ve)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(x!==void 0&&typeof x!="function")throw new TypeError("fetchMethod must be a function if specified");if(A(this,Nt,x),A(this,st,!!x),A(this,oe,new Map),A(this,Y,new Array(n).fill(void 0)),A(this,E,new Array(n).fill(void 0)),A(this,fe,new D(n)),A(this,Se,new D(n)),A(this,ge,0),A(this,de,0),A(this,Re,An.create(n)),A(this,ie,0),A(this,Fe,0),typeof h=="function"&&A(this,Ee,h),typeof p=="function"?(A(this,Ie,p),A(this,ue,[])):(A(this,Ie,void 0),A(this,ue,void 0)),A(this,Le,!!r(this,Ee)),A(this,pe,!!r(this,Ie)),this.noDisposeOnSet=!!f,this.noUpdateTTL=!!v,this.noDeleteOnFetchRejection=!!u,this.allowStaleOnFetchRejection=!!w,this.allowStaleOnFetchAbort=!!y,this.ignoreFetchAbort=!!j,this.maxEntrySize!==0){if(r(this,ve)!==0&&!Ze(r(this,ve)))throw new TypeError("maxSize must be a positive integer if specified");if(!Ze(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");T(this,M,fo).call(this)}if(this.allowStale=!!d,this.noDeleteOnStaleGet=!!b,this.updateAgeOnGet=!!l,this.updateAgeOnHas=!!c,this.ttlResolution=Ze(o)||o===0?o:1,this.ttlAutopurge=!!i,this.ttl=a||0,this.ttl){if(!Ze(this.ttl))throw new TypeError("ttl must be a positive integer if specified");T(this,M,En).call(this)}if(r(this,Ne)===0&&this.ttl===0&&r(this,ve)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!r(this,Ne)&&!r(this,ve)){const N="LRU_CACHE_UNBOUNDED";Fc(N)&&(ho.add(N),mo("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",N,Kn))}}static unsafeExposeInternals(e){return{starts:r(e,De),ttls:r(e,Ce),sizes:r(e,Pe),keyMap:r(e,oe),keyList:r(e,Y),valList:r(e,E),next:r(e,fe),prev:r(e,Se),get head(){return r(e,ge)},get tail(){return r(e,de)},free:r(e,Re),isBackgroundFetch:n=>{var a;return T(a=e,M,Q).call(a,n)},backgroundFetch:(n,a,o,i)=>{var l;return T(l=e,M,js).call(l,n,a,o,i)},moveToTail:n=>{var a;return T(a=e,M,Kt).call(a,n)},indexes:n=>{var a;return T(a=e,M,et).call(a,n)},rindexes:n=>{var a;return T(a=e,M,tt).call(a,n)},isStale:n=>{var a;return r(a=e,we).call(a,n)}}}get max(){return r(this,Ne)}get maxSize(){return r(this,ve)}get calculatedSize(){return r(this,Fe)}get size(){return r(this,ie)}get fetchMethod(){return r(this,Nt)}get dispose(){return r(this,Ee)}get disposeAfter(){return r(this,Ie)}getRemainingTTL(e){return r(this,oe).has(e)?1/0:0}*entries(){for(const e of T(this,M,et).call(this))r(this,E)[e]!==void 0&&r(this,Y)[e]!==void 0&&!T(this,M,Q).call(this,r(this,E)[e])&&(yield[r(this,Y)[e],r(this,E)[e]])}*rentries(){for(const e of T(this,M,tt).call(this))r(this,E)[e]!==void 0&&r(this,Y)[e]!==void 0&&!T(this,M,Q).call(this,r(this,E)[e])&&(yield[r(this,Y)[e],r(this,E)[e]])}*keys(){for(const e of T(this,M,et).call(this)){const n=r(this,Y)[e];n!==void 0&&!T(this,M,Q).call(this,r(this,E)[e])&&(yield n)}}*rkeys(){for(const e of T(this,M,tt).call(this)){const n=r(this,Y)[e];n!==void 0&&!T(this,M,Q).call(this,r(this,E)[e])&&(yield n)}}*values(){for(const e of T(this,M,et).call(this))r(this,E)[e]!==void 0&&!T(this,M,Q).call(this,r(this,E)[e])&&(yield r(this,E)[e])}*rvalues(){for(const e of T(this,M,tt).call(this))r(this,E)[e]!==void 0&&!T(this,M,Q).call(this,r(this,E)[e])&&(yield r(this,E)[e])}[(ka=Symbol.iterator,_a=Symbol.toStringTag,ka)](){return this.entries()}find(e,n={}){for(const a of T(this,M,et).call(this)){const o=r(this,E)[a],i=T(this,M,Q).call(this,o)?o.__staleWhileFetching:o;if(i!==void 0&&e(i,r(this,Y)[a],this))return this.get(r(this,Y)[a],n)}}forEach(e,n=this){for(const a of T(this,M,et).call(this)){const o=r(this,E)[a],i=T(this,M,Q).call(this,o)?o.__staleWhileFetching:o;i!==void 0&&e.call(n,i,r(this,Y)[a],this)}}rforEach(e,n=this){for(const a of T(this,M,tt).call(this)){const o=r(this,E)[a],i=T(this,M,Q).call(this,o)?o.__staleWhileFetching:o;i!==void 0&&e.call(n,i,r(this,Y)[a],this)}}purgeStale(){let e=!1;for(const n of T(this,M,tt).call(this,{allowStale:!0}))r(this,we).call(this,n)&&(this.delete(r(this,Y)[n]),e=!0);return e}info(e){const n=r(this,oe).get(e);if(n===void 0)return;const a=r(this,E)[n],o=T(this,M,Q).call(this,a)?a.__staleWhileFetching:a;if(o===void 0)return;const i={value:o};if(r(this,Ce)&&r(this,De)){const l=r(this,Ce)[n],c=r(this,De)[n];if(l&&c){const d=l-(kt.now()-c);i.ttl=d,i.start=Date.now()}}return r(this,Pe)&&(i.size=r(this,Pe)[n]),i}dump(){const e=[];for(const n of T(this,M,et).call(this,{allowStale:!0})){const a=r(this,Y)[n],o=r(this,E)[n],i=T(this,M,Q).call(this,o)?o.__staleWhileFetching:o;if(i===void 0||a===void 0)continue;const l={value:i};if(r(this,Ce)&&r(this,De)){l.ttl=r(this,Ce)[n];const c=kt.now()-r(this,De)[n];l.start=Math.floor(Date.now()-c)}r(this,Pe)&&(l.size=r(this,Pe)[n]),e.unshift([a,l])}return e}load(e){this.clear();for(const[n,a]of e){if(a.start){const o=Date.now()-a.start;a.start=kt.now()-o}this.set(n,a.value,a)}}set(e,n,a={}){var v,S,C,g,x;if(n===void 0)return this.delete(e),this;const{ttl:o=this.ttl,start:i,noDisposeOnSet:l=this.noDisposeOnSet,sizeCalculation:c=this.sizeCalculation,status:d}=a;let{noUpdateTTL:h=this.noUpdateTTL}=a;const p=r(this,ts).call(this,e,n,a.size||0,c);if(this.maxEntrySize&&p>this.maxEntrySize)return d&&(d.set="miss",d.maxEntrySizeExceeded=!0),this.delete(e),this;let f=r(this,ie)===0?void 0:r(this,oe).get(e);if(f===void 0)f=r(this,ie)===0?r(this,de):r(this,Re).length!==0?r(this,Re).pop():r(this,ie)===r(this,Ne)?T(this,M,Ts).call(this,!1):r(this,ie),r(this,Y)[f]=e,r(this,E)[f]=n,r(this,oe).set(e,f),r(this,fe)[r(this,de)]=f,r(this,Se)[f]=r(this,de),A(this,de,f),Ss(this,ie)._++,r(this,Et).call(this,f,p,d),d&&(d.set="add"),h=!1;else{T(this,M,Kt).call(this,f);const u=r(this,E)[f];if(n!==u){if(r(this,st)&&T(this,M,Q).call(this,u)){u.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:b}=u;b!==void 0&&!l&&(r(this,Le)&&((v=r(this,Ee))==null||v.call(this,b,e,"set")),r(this,pe)&&((S=r(this,ue))==null||S.push([b,e,"set"])))}else l||(r(this,Le)&&((C=r(this,Ee))==null||C.call(this,u,e,"set")),r(this,pe)&&((g=r(this,ue))==null||g.push([u,e,"set"])));if(r(this,pt).call(this,f),r(this,Et).call(this,f,p,d),r(this,E)[f]=n,d){d.set="replace";const b=u&&T(this,M,Q).call(this,u)?u.__staleWhileFetching:u;b!==void 0&&(d.oldValue=b)}}else d&&(d.set="update")}if(o!==0&&!r(this,Ce)&&T(this,M,En).call(this),r(this,Ce)&&(h||r(this,es).call(this,f,o,i),d&&r(this,Ve).call(this,d,f)),!l&&r(this,pe)&&r(this,ue)){const u=r(this,ue);let b;for(;b=u==null?void 0:u.shift();)(x=r(this,Ie))==null||x.call(this,...b)}return this}pop(){var e;try{for(;r(this,ie);){const n=r(this,E)[r(this,ge)];if(T(this,M,Ts).call(this,!0),T(this,M,Q).call(this,n)){if(n.__staleWhileFetching)return n.__staleWhileFetching}else if(n!==void 0)return n}}finally{if(r(this,pe)&&r(this,ue)){const n=r(this,ue);let a;for(;a=n==null?void 0:n.shift();)(e=r(this,Ie))==null||e.call(this,...a)}}}has(e,n={}){const{updateAgeOnHas:a=this.updateAgeOnHas,status:o}=n,i=r(this,oe).get(e);if(i!==void 0){const l=r(this,E)[i];if(T(this,M,Q).call(this,l)&&l.__staleWhileFetching===void 0)return!1;if(r(this,we).call(this,i))o&&(o.has="stale",r(this,Ve).call(this,o,i));else return a&&r(this,ft).call(this,i),o&&(o.has="hit",r(this,Ve).call(this,o,i)),!0}else o&&(o.has="miss");return!1}peek(e,n={}){const{allowStale:a=this.allowStale}=n,o=r(this,oe).get(e);if(o===void 0||!a&&r(this,we).call(this,o))return;const i=r(this,E)[o];return T(this,M,Q).call(this,i)?i.__staleWhileFetching:i}async fetch(e,n={}){const{allowStale:a=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,ttl:l=this.ttl,noDisposeOnSet:c=this.noDisposeOnSet,size:d=0,sizeCalculation:h=this.sizeCalculation,noUpdateTTL:p=this.noUpdateTTL,noDeleteOnFetchRejection:f=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:v=this.allowStaleOnFetchRejection,ignoreFetchAbort:S=this.ignoreFetchAbort,allowStaleOnFetchAbort:C=this.allowStaleOnFetchAbort,context:g,forceRefresh:x=!1,status:u,signal:b}=n;if(!r(this,st))return u&&(u.fetch="get"),this.get(e,{allowStale:a,updateAgeOnGet:o,noDeleteOnStaleGet:i,status:u});const w={allowStale:a,updateAgeOnGet:o,noDeleteOnStaleGet:i,ttl:l,noDisposeOnSet:c,size:d,sizeCalculation:h,noUpdateTTL:p,noDeleteOnFetchRejection:f,allowStaleOnFetchRejection:v,allowStaleOnFetchAbort:C,ignoreFetchAbort:S,status:u,signal:b};let y=r(this,oe).get(e);if(y===void 0){u&&(u.fetch="miss");const j=T(this,M,js).call(this,e,y,w,g);return j.__returned=j}else{const j=r(this,E)[y];if(T(this,M,Q).call(this,j)){const _=a&&j.__staleWhileFetching!==void 0;return u&&(u.fetch="inflight",_&&(u.returnedStale=!0)),_?j.__staleWhileFetching:j.__returned=j}const D=r(this,we).call(this,y);if(!x&&!D)return u&&(u.fetch="hit"),T(this,M,Kt).call(this,y),o&&r(this,ft).call(this,y),u&&r(this,Ve).call(this,u,y),j;const N=T(this,M,js).call(this,e,y,w,g),z=N.__staleWhileFetching!==void 0&&a;return u&&(u.fetch=D?"stale":"refresh",z&&D&&(u.returnedStale=!0)),z?N.__staleWhileFetching:N.__returned=N}}get(e,n={}){const{allowStale:a=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,status:l}=n,c=r(this,oe).get(e);if(c!==void 0){const d=r(this,E)[c],h=T(this,M,Q).call(this,d);return l&&r(this,Ve).call(this,l,c),r(this,we).call(this,c)?(l&&(l.get="stale"),h?(l&&a&&d.__staleWhileFetching!==void 0&&(l.returnedStale=!0),a?d.__staleWhileFetching:void 0):(i||this.delete(e),l&&a&&(l.returnedStale=!0),a?d:void 0)):(l&&(l.get="hit"),h?d.__staleWhileFetching:(T(this,M,Kt).call(this,c),o&&r(this,ft).call(this,c),d))}else l&&(l.get="miss")}delete(e){var a,o,i,l;let n=!1;if(r(this,ie)!==0){const c=r(this,oe).get(e);if(c!==void 0)if(n=!0,r(this,ie)===1)this.clear();else{r(this,pt).call(this,c);const d=r(this,E)[c];if(T(this,M,Q).call(this,d)?d.__abortController.abort(new Error("deleted")):(r(this,Le)||r(this,pe))&&(r(this,Le)&&((a=r(this,Ee))==null||a.call(this,d,e,"delete")),r(this,pe)&&((o=r(this,ue))==null||o.push([d,e,"delete"]))),r(this,oe).delete(e),r(this,Y)[c]=void 0,r(this,E)[c]=void 0,c===r(this,de))A(this,de,r(this,Se)[c]);else if(c===r(this,ge))A(this,ge,r(this,fe)[c]);else{const h=r(this,Se)[c];r(this,fe)[h]=r(this,fe)[c];const p=r(this,fe)[c];r(this,Se)[p]=r(this,Se)[c]}Ss(this,ie)._--,r(this,Re).push(c)}}if(r(this,pe)&&((i=r(this,ue))!=null&&i.length)){const c=r(this,ue);let d;for(;d=c==null?void 0:c.shift();)(l=r(this,Ie))==null||l.call(this,...d)}return n}clear(){var e,n,a;for(const o of T(this,M,tt).call(this,{allowStale:!0})){const i=r(this,E)[o];if(T(this,M,Q).call(this,i))i.__abortController.abort(new Error("deleted"));else{const l=r(this,Y)[o];r(this,Le)&&((e=r(this,Ee))==null||e.call(this,i,l,"delete")),r(this,pe)&&((n=r(this,ue))==null||n.push([i,l,"delete"]))}}if(r(this,oe).clear(),r(this,E).fill(void 0),r(this,Y).fill(void 0),r(this,Ce)&&r(this,De)&&(r(this,Ce).fill(0),r(this,De).fill(0)),r(this,Pe)&&r(this,Pe).fill(0),A(this,ge,0),A(this,de,0),r(this,Re).length=0,A(this,Fe,0),A(this,ie,0),r(this,pe)&&r(this,ue)){const o=r(this,ue);let i;for(;i=o==null?void 0:o.shift();)(a=r(this,Ie))==null||a.call(this,...i)}}};Ne=new WeakMap,ve=new WeakMap,Ee=new WeakMap,Ie=new WeakMap,Nt=new WeakMap,ie=new WeakMap,Fe=new WeakMap,oe=new WeakMap,Y=new WeakMap,E=new WeakMap,fe=new WeakMap,Se=new WeakMap,ge=new WeakMap,de=new WeakMap,Re=new WeakMap,ue=new WeakMap,Pe=new WeakMap,De=new WeakMap,Ce=new WeakMap,Le=new WeakMap,st=new WeakMap,pe=new WeakMap,M=new WeakSet,En=function(){const e=new ks(r(this,Ne)),n=new ks(r(this,Ne));A(this,Ce,e),A(this,De,n),A(this,es,(i,l,c=kt.now())=>{if(n[i]=l!==0?c:0,e[i]=l,l!==0&&this.ttlAutopurge){const d=setTimeout(()=>{r(this,we).call(this,i)&&this.delete(r(this,Y)[i])},l+1);d.unref&&d.unref()}}),A(this,ft,i=>{n[i]=e[i]!==0?kt.now():0}),A(this,Ve,(i,l)=>{if(e[l]){const c=e[l],d=n[l];if(!c||!d)return;i.ttl=c,i.start=d,i.now=a||o();const h=i.now-d;i.remainingTTL=c-h}});let a=0;const o=()=>{const i=kt.now();if(this.ttlResolution>0){a=i;const l=setTimeout(()=>a=0,this.ttlResolution);l.unref&&l.unref()}return i};this.getRemainingTTL=i=>{const l=r(this,oe).get(i);if(l===void 0)return 0;const c=e[l],d=n[l];if(!c||!d)return 1/0;const h=(a||o())-d;return c-h},A(this,we,i=>{const l=n[i],c=e[i];return!!c&&!!l&&(a||o())-l>c})},ft=new WeakMap,Ve=new WeakMap,es=new WeakMap,we=new WeakMap,fo=function(){const e=new ks(r(this,Ne));A(this,Fe,0),A(this,Pe,e),A(this,pt,n=>{A(this,Fe,r(this,Fe)-e[n]),e[n]=0}),A(this,ts,(n,a,o,i)=>{if(T(this,M,Q).call(this,a))return 0;if(!Ze(o))if(i){if(typeof i!="function")throw new TypeError("sizeCalculation must be a function");if(o=i(a,n),!Ze(o))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return o}),A(this,Et,(n,a,o)=>{if(e[n]=a,r(this,ve)){const i=r(this,ve)-e[n];for(;r(this,Fe)>i;)T(this,M,Ts).call(this,!0)}A(this,Fe,r(this,Fe)+e[n]),o&&(o.entrySize=a,o.totalCalculatedSize=r(this,Fe))})},pt=new WeakMap,Et=new WeakMap,ts=new WeakMap,et=function*({allowStale:e=this.allowStale}={}){if(r(this,ie))for(let n=r(this,de);!(!T(this,M,In).call(this,n)||((e||!r(this,we).call(this,n))&&(yield n),n===r(this,ge)));)n=r(this,Se)[n]},tt=function*({allowStale:e=this.allowStale}={}){if(r(this,ie))for(let n=r(this,ge);!(!T(this,M,In).call(this,n)||((e||!r(this,we).call(this,n))&&(yield n),n===r(this,de)));)n=r(this,fe)[n]},In=function(e){return e!==void 0&&r(this,oe).get(r(this,Y)[e])===e},Ts=function(e){var i,l;const n=r(this,ge),a=r(this,Y)[n],o=r(this,E)[n];return r(this,st)&&T(this,M,Q).call(this,o)?o.__abortController.abort(new Error("evicted")):(r(this,Le)||r(this,pe))&&(r(this,Le)&&((i=r(this,Ee))==null||i.call(this,o,a,"evict")),r(this,pe)&&((l=r(this,ue))==null||l.push([o,a,"evict"]))),r(this,pt).call(this,n),e&&(r(this,Y)[n]=void 0,r(this,E)[n]=void 0,r(this,Re).push(n)),r(this,ie)===1?(A(this,ge,A(this,de,0)),r(this,Re).length=0):A(this,ge,r(this,fe)[n]),r(this,oe).delete(a),Ss(this,ie)._--,n},js=function(e,n,a,o){const i=n===void 0?void 0:r(this,E)[n];if(T(this,M,Q).call(this,i))return i;const l=new Ls,{signal:c}=a;c==null||c.addEventListener("abort",()=>l.abort(c.reason),{signal:l.signal});const d={signal:l.signal,options:a,context:o},h=(g,x=!1)=>{const{aborted:u}=l.signal,b=a.ignoreFetchAbort&&g!==void 0;if(a.status&&(u&&!x?(a.status.fetchAborted=!0,a.status.fetchError=l.signal.reason,b&&(a.status.fetchAbortIgnored=!0)):a.status.fetchResolved=!0),u&&!b&&!x)return f(l.signal.reason);const w=S;return r(this,E)[n]===S&&(g===void 0?w.__staleWhileFetching?r(this,E)[n]=w.__staleWhileFetching:this.delete(e):(a.status&&(a.status.fetchUpdated=!0),this.set(e,g,d.options))),g},p=g=>(a.status&&(a.status.fetchRejected=!0,a.status.fetchError=g),f(g)),f=g=>{const{aborted:x}=l.signal,u=x&&a.allowStaleOnFetchAbort,b=u||a.allowStaleOnFetchRejection,w=b||a.noDeleteOnFetchRejection,y=S;if(r(this,E)[n]===S&&(!w||y.__staleWhileFetching===void 0?this.delete(e):u||(r(this,E)[n]=y.__staleWhileFetching)),b)return a.status&&y.__staleWhileFetching!==void 0&&(a.status.returnedStale=!0),y.__staleWhileFetching;if(y.__returned===y)throw g},v=(g,x)=>{var b;const u=(b=r(this,Nt))==null?void 0:b.call(this,e,i,d);u&&u instanceof Promise&&u.then(w=>g(w===void 0?void 0:w),x),l.signal.addEventListener("abort",()=>{(!a.ignoreFetchAbort||a.allowStaleOnFetchAbort)&&(g(void 0),a.allowStaleOnFetchAbort&&(g=w=>h(w,!0)))})};a.status&&(a.status.fetchDispatched=!0);const S=new Promise(v).then(h,p),C=Object.assign(S,{__abortController:l,__staleWhileFetching:i,__returned:void 0});return n===void 0?(this.set(e,C,{...d.options,status:void 0}),n=r(this,oe).get(e)):r(this,E)[n]=C,C},Q=function(e){if(!r(this,st))return!1;const n=e;return!!n&&n instanceof Promise&&n.hasOwnProperty("__staleWhileFetching")&&n.__abortController instanceof Ls},Fn=function(e,n){r(this,Se)[n]=e,r(this,fe)[e]=n},Kt=function(e){e!==r(this,de)&&(e===r(this,ge)?A(this,ge,r(this,fe)[e]):T(this,M,Fn).call(this,r(this,Se)[e],r(this,fe)[e]),T(this,M,Fn).call(this,r(this,de),e),A(this,de,e))};let Nn=Kn;function Rc({conversationId:t,messageId:e}){const[n,a]=m.useState(!1),o=m.useRef({isMediaSourceAvailable:qn(),mediaSourceFormat:$n()??"n/a",playPromise:null,shouldAbortQueuedPlayback:!1}).current,i=Oe(),{voiceName:l}=Ui(),c=`${t}.${e}.${l}`,d=Fo(),h=Ro(C=>{var g;return C.isPlaying&&C.sourceUrl===((g=ke.get(c))==null?void 0:g.src)}),p=m.useCallback(async()=>{if(!d)return;a(!0);const C={isMediaSourceAvailable:o.isMediaSourceAvailable,format:o.mediaSourceFormat};try{const g=await Pc({key:c,message_id:e,conversation_id:t,voice:l,onStreamingError:x=>{Qt.readAloud.error(x,C),a(!1),jt.danger(i.formatMessage(ua.playbackError,{error:x.message}))},onStreamingStart:()=>{a(!1)}});if(o.shouldAbortQueuedPlayback){o.shouldAbortQueuedPlayback=!1;return}d.changeSource(g),o.playPromise=d.play()}catch(g){Qt.readAloud.error(g,C),a(!1),jt.danger(i.formatMessage(ua.playbackError,{error:g.message}))}},[d,c,e,t,l,o,i]),f=m.useCallback(()=>{const C=Yn();C&&(o.playPromise?o.playPromise.then(()=>{C.stop(),o.playPromise=null}):C.stop())},[o]),v=m.useCallback(()=>{var g;const C=Yn();C&&(C.state.isPlaying&&C.state.sourceUrl===((g=ke.get(c))==null?void 0:g.src)?f():(Qt.readAloud.click({isMediaSourceAvailable:o.isMediaSourceAvailable,format:o.mediaSourceFormat}),p()))},[c,o,p,f]);m.useEffect(()=>{n&&h&&a(!1)},[n,h]);const S=m.useRef(c);return m.useEffect(()=>{S.current=c}),m.useEffect(()=>(o.shouldAbortQueuedPlayback=!1,()=>{var x;const C=Po();C.isPlaying&&C.sourceUrl===((x=ke.get(S.current))==null?void 0:x.src)?f():o.shouldAbortQueuedPlayback=!0}),[o,f]),{togglePlayback:v,isPlaying:h,isLoading:n}}async function po({message_id:t,conversation_id:e,voice:n}){const a=await Me.synthesize({message_id:t,conversation_id:e,voice:n,format:$n()}),o=a.headers.get("content-type")??"audio/aac";return{response:a,format:o}}async function Pc(t){return qn()?Lc(t):Dc(t)}async function Dc({key:t,...e}){const n=ke.get(t);if(n!=null&&n.blob)return n.src;const{response:a,format:o}=await po(e),i=await a.arrayBuffer(),l=new Blob([i],{type:o}),c=bo({key:t,src:URL.createObjectURL(l),format:o,blob:l});return ke.set(t,c),c.src}async function Lc({key:t,onStreamingError:e,onStreamingStart:n,...a}){let o=ke.get(t);o!=null&&o.streaming&&(ke.delete(t),o=void 0);let i,l;const c=zc(),d=new c;if(o)i=o,i.src=URL.createObjectURL(d);else{const{format:f,response:v}=await po(a);l=v,i=bo({key:t,src:URL.createObjectURL(d),format:f})}const h=Oc(i.id),p={sourceopen:async()=>{var S,C;h("sourceopen");const f=d.addSourceBuffer(i.format),v=async()=>{f.updating&&await new Promise(g=>f.addEventListener("updateend",g,{once:!0}))};if(i.segments.length&&!i.streaming){h("streaming from cache"),i.streaming=!0,n();for(const g of i.segments)f.appendBuffer(g),await v();d.readyState==="open"&&d.endOfStream(),i.streaming=!1,h("done streaming from cache");return}if(l){h("fetching audio");try{const g=(S=l.body)==null?void 0:S.getReader();if(!g)return;for(;((C=ke.get(t))==null?void 0:C.id)===i.id;){const{done:x,value:u}=await g.read();if(x){h("done streaming"),i.streaming=!1,d.readyState==="open"&&d.endOfStream();break}if(!Array.from(d.sourceBuffers).includes(f)){h("stop streaming, source buffer removed"),i.streaming=!1;break}i.streaming||(h("start streaming"),i.streaming=!0,n()),f.appendBuffer(u),i.segments.push(u),await v()}}catch(g){if(h("error while streaming",g),i.streaming=!1,d.readyState==="open")try{d.endOfStream("network")}catch(x){Qt.readAloud.error(x)}ke.delete(t),e(g)}}},sourceclose:()=>{var f;h("sourceclose"),i.streaming&&(i.streaming=!1,((f=ke.get(t))==null?void 0:f.id)===i.id&&(h("sourceclosed while streaming, cleaning up cache"),ke.delete(t)))},sourceended:gt};for(const[f,v]of Object.entries(p))d.addEventListener(f,()=>{try{return v()}catch(S){Qt.readAloud.error(S)}});return ke.set(t,i),i.src}const ua=_e({playbackError:{id:"useVoiceReadAloudAudio.playbackError",defaultMessage:"Failed to play message"}}),Oc=t=>gt;function zc(){return qn()?window.MediaSource:null}function qn(){return!!$n()}function $n(){if("MediaSource"in window){const t=e=>Do(e)&&MediaSource.isTypeSupported(e);if(t("audio/aac"))return"aac";if(t("audio/mpeg"))return"mp3";if(t("audio/ogg"))return"ogg"}}const bo=t=>({id:zs(),segments:[],streaming:!1,...t}),ke=new Nn({max:50,dispose:t=>{URL.revokeObjectURL(t.src)}}),Uc=m.memo(function(e){var l;const n=(l=Ns("1923022511"))==null?void 0:l.value,a=qs(e.conversationId),{errCode:o}=Vn(e.message);if(!n||!a||o)return null;const i=Lo.getAudioAssetPointers(e.message.message)[0];return i?s.jsx(Bc,{audioAssetPointer:i,conversationId:a}):s.jsx(Gc,{...e,conversationId:a})});function Bc({audioAssetPointer:t,conversationId:e}){const{isLoading:n,isPlaying:a,togglePlayback:o}=Bi({audioAssetPointer:t,conversationId:e});return s.jsx(xo,{onClick:o,isPlaying:a,isLoading:n,playText:Os.replay,playIcon:yl})}function Gc({conversationId:t,message:e}){const{isLoading:n,isPlaying:a,togglePlayback:o}=Rc({conversationId:t,messageId:e.message.id});return s.jsx(xo,{onClick:o,isPlaying:a,isLoading:n,playText:Os.play,playIcon:vl})}function xo({onClick:t,isPlaying:e,isLoading:n,playText:a,playIcon:o}){let i,l;const c=Oe();return n?(i=Oo,l=Os.loading):e?(i=Sl,l=Os.stop):(i=o,l=a),s.jsx(_s,{icon:i,label:l?c.formatMessage(l):void 0,disabled:n,onClick:t,style:e||n?{visibility:"visible"}:void 0,testId:"voice-play-turn-action-button"})}const Os={replay:{id:"VoiceReadOutLoudButton.replay",defaultMessage:"Replay",description:"The tooltip for the replay button"},play:{id:"VoiceReadOutLoudButton.play",defaultMessage:"Read aloud",description:"The tooltip for the read aloud button"},stop:{id:"VoiceReadOutLoudButton.stop",defaultMessage:"Stop",description:"The tooltip for the stop button"},loading:{id:"VoiceReadOutLoudButton.loading",defaultMessage:"Loading",description:"The tooltip for the spinner"}},Hc="bg-token-main-surface-primary text-token-text-primary",Wc="openai",ha=["bg-blue-300 text-white"];function Vc(t){return ha[((t==null?void 0:t.charCodeAt(0))??0)%ha.length]}const Cs=({children:t})=>s.jsx("div",{className:"pt-0",children:s.jsx("div",{className:ee(m.isValidElement(t)&&t.type===wn?"gizmo-bot-avatar":"gizmo-shadow-stroke","flex h-8 w-8 items-center justify-center overflow-hidden rounded-full"),children:t})});function Rn({messages:t,isUserTurn:e,avatarClassName:n,gizmo:a,showInlineEmbeddedDisplay:o=!1}){var S;const i="medium",l=t[0],c=(S=l==null?void 0:l.message.metadata)==null?void 0:S.shared_conversation_id,d=c!=null,h=Gn(),{gizmoEditorData:p,mode:f}=Gi();let v=s.jsx(Cs,{children:s.jsx(wn,{className:n??Hc,iconName:Wc,size:i})});return a?v=s.jsx(Cs,{children:s.jsx(Hl,{gizmoId:a.gizmo.id,className:"h-full w-full"})}):p!=null&&f==="test"&&(v=s.jsx(Wl,{isFirstParty:!1,src:p.profilePictureUrl,className:"h-8 w-8 first:pt-[3px]"})),s.jsx("div",{children:e?d||o?s.jsx(Cs,{children:s.jsx(wn,{className:Vc(c),iconName:"user",size:i})}):s.jsx(Cs,{children:s.jsx(Hi,{user:h,size:i})}):v})}const ws="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function qc({className:t,clientThreadId:e,message:n,onModelSelect:a,onDropdownChange:o,canRegenerateResponse:i}){var q;const l=ja("566128514").value,[c,d]=m.useState(null),[h,p]=m.useState(!1),[f,v]=m.useState(!1),S=rt(e),C=uo({clientThreadId:e,message:n}),g=(q=n.message.metadata)==null?void 0:q.model_slug,{modelOptions:x,modelSlug:u,animateModelLabelOnRender:b,messageModelEnabledTools:w}=C,y=Ha(n.message),j=w.includes(Fs.Search),D=m.useMemo(()=>x.find(B=>B.value===g),[x,g]),N=m.useRef(null),{doesUserHaveAnyAccountsWithPlusFeatures:W}=ss(),z=B=>{B||setTimeout(()=>{N.current&&N.current.blur()},10)};if(m.useEffect(()=>{z(h)},[h]),Ya(e))return null;const I=i&&x.some(B=>Zt(B,W));return S?null:s.jsxs(Te.Root,{onOpenChange:B=>{i&&(p(B),o(B),z(B)),B&&te.logEvent(K.conversationOpenMessageModelSelector,{has_get_plus_button:I,is_new_regen_dropdown:!0})},children:[i?s.jsx(Kc,{label:s.jsx(R,{id:"wDs5sz",defaultMessage:"Switch model"}),children:s.jsx(ro,{ref:N,className:ee("cursor-pointer",t),onMouseEnter:()=>v(!0),onMouseLeave:()=>v(!1),children:s.jsx(Tn,{modelSlug:u,animateModelLabelOnRender:b,isDropdownOpen:h,isRegenerateEnabled:i,isHovered:f,isRegenLabel:!0,omitIcon:!1})})}):s.jsx("button",{className:ee("cursor-pointer",t),onMouseEnter:()=>v(!0),onMouseLeave:()=>v(!1),children:s.jsx(Tn,{modelSlug:u,animateModelLabelOnRender:b,isDropdownOpen:!1,isRegenerateEnabled:!1,isHovered:f,omitIcon:l,animateShortLabel:!0})}),i&&s.jsxs(Te.Content,{className:"z-30 min-w-fit origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[s.jsx(Te.Item,{disabled:!0,className:"pb-0 pt-2",children:s.jsx("span",{className:"text-token-text-secondary",children:s.jsx(R,{id:"bFLh5u",defaultMessage:"Switch model"})})}),s.jsx($c,{onModelSelect:a,messageModelSlug:g,omitModelIcons:l,modelOptions:x,setHoveredOption:d,hoveredOption:c,retryOption:D,lastResponseUsedSearch:y,modelSupportsSearch:j,doesUserHaveAnyAccountsWithPlusFeatures:W})]})]})}function $c({modelOptions:t,messageModelSlug:e,onModelSelect:n,omitModelIcons:a,setHoveredOption:o,hoveredOption:i,retryOption:l,lastResponseUsedSearch:c,modelSupportsSearch:d,doesUserHaveAnyAccountsWithPlusFeatures:h}){const p=Oe(),[f,v]=m.useMemo(()=>Wi(t,u=>u.subcategory),[t]),S=m.useMemo(()=>{const u=new Map;return f.forEach(b=>{var y;const w=b.subcategory;w&&(u.has(w)||u.set(w,[]),(y=u.get(w))==null||y.push(b))}),u},[f]),C=ee("icon-sm",a&&"order-10 ml-auto text-token-text-tertiary icon-md"),g=a?"right":"left",x=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:p.formatMessage(vn.search),icon:s.jsx(so,{className:C}),condition:d&&!c},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:p.formatMessage(vn.nosearch),icon:s.jsx(no,{className:C}),condition:d&&c}];return s.jsxs(s.Fragment,{children:[v.map(u=>{const{value:b,...w}=u;return s.jsx(Tt,{value:b,onSelect:()=>n({requestedModelId:b}),includeRegenerate:!1,onMouseEnter:()=>o(b),onMouseLeave:()=>o(null),isHovered:i===b,messageModelSlug:e,includeCheck:!1,shouldShowUpsell:Zt(u,h),className:ws,...w,icon:a?s.jsx("span",{className:C}):w.icon,justifyIcon:g,wrapIcon:!a},b)}),[...S.entries()].map(([u,b])=>s.jsxs(Te.Sub,{children:[s.jsx(Te.SubMenuTrigger,{children:s.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:u})}),s.jsx(Te.Portal,{children:s.jsx(Te.SubContent,{className:"min-w-fit",children:b.map(w=>{const{value:y,...j}=w;return s.jsx(Tt,{value:y,onSelect:()=>n({requestedModelId:y}),includeRegenerate:!1,onMouseEnter:()=>o(y),onMouseLeave:()=>o(null),isHovered:i===y,messageModelSlug:e,includeCheck:!1,className:ws,...j,icon:null,justifyIcon:g,wrapIcon:!a,shouldShowUpsell:Zt(w,h)},u+"-"+y)})})})]},u)),!!l&&s.jsxs(s.Fragment,{children:[s.jsx(Te.Separator,{}),s.jsx(Tt,{onSelect:()=>n({requestedModelId:l.value}),includeRegenerate:!0,onMouseEnter:()=>o(l.value),onMouseLeave:()=>o(null),messageModelSlug:e,includeCheck:!1,className:ws,...l,label:p.formatMessage(vn.tryAgain),subtitle:l.label,icon:s.jsx(Ks,{className:C}),justifyIcon:g,wrapIcon:!a},l.value),x.filter(u=>u.condition).map(u=>s.jsx(Tt,{onSelect:()=>n({requestedModelId:l.value,extraStreamParams:u.extraStreamParams}),includeRegenerate:!1,onMouseEnter:()=>o(u.key),onMouseLeave:()=>o(null),isHovered:i===u.key,messageModelSlug:e,includeCheck:!1,className:ws,...l,label:u.label,subtitle:"",icon:u.icon,justifyIcon:g,wrapIcon:!a},u.key))]})]})}function Kc({children:t,label:e}){return s.jsx(Gs,{label:e,sideOffset:0,children:t})}const vn=_e({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Qc=m.memo(qc);function Pn({messages:t,isMemoryEnabled:e,isMemoryFull:n,gizmoId:a,isParagen:o}){const[i,l]=m.useState(!1),[c,d]=m.useState(!1),{eligible:h,isLoading:p}=Vi(),f=e&&!n,v=t.filter((g,x)=>{const u=t[x+1],w=(u==null?void 0:u.message.recipient)==="assistant"&&(u==null?void 0:u.message.author.role)===be.Tool&&(u==null?void 0:u.message.author.name)==="bio"&&Ia(u.message)==="Model set context updated."||!u&&f;return g.message.author.role===be.Assistant&&g.message.recipient==="bio"&&w}).flatMap(g=>{const x=g.message.content.content_type;return x===it.Text?g.message.content.parts:x===it.Code?[g.message.content.text]:[]}).map(Yc),S=m.useMemo(()=>v.length>0,[v]);if(m.useEffect(()=>{S&&h&&!p&&Hs.openModal(Xt.GlobalMemoryOnboarding)},[S,h,p]),v.length===0)return null;const C=g=>{const x=g??!c;d(x),x&&te.logEvent(K.memoryUpdatePopoverShown,{updateCount:v.length})};return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"inline-block",onMouseEnter:()=>C(!0),onMouseLeave:()=>C(!1),children:s.jsxs(qi,{open:c,sideOffset:4,side:"bottom",alignAgainstAnchor:"start",size:"none",className:"z-10 min-w-60 max-w-96 text-sm",onOpenChange:g=>C(g),disableAutofocus:!0,triggerButton:s.jsxs("button",{className:ee("my-1 flex items-center gap-1 text-sm font-semibold outline-none",c?"text-token-text-secondary":"text-token-text-tertiary"),children:[s.jsx(Cl,{className:"mb-[-1px]"}),v.length===1?s.jsx(R,{id:"MemoryActionResult.memoryWriteSingular.1",defaultMessage:"Memory updated"}):s.jsx(R,{id:"MemoryActionResult.memoryWritePlural.1",defaultMessage:"Memories updated"})]}),children:[s.jsx("div",{className:"mb-2 rounded border border-token-border-light bg-token-main-surface-secondary",children:v.map((g,x)=>s.jsx("div",{className:"border-b border-token-border-light px-3 py-2 first-letter:uppercase last:border-b-0",children:g},x))}),o?s.jsx("div",{className:"text-xs text-token-text-tertiary",children:s.jsx(R,{id:"MemoryActionResult.paragenMessage",defaultMessage:"This memory will be saved if you choose this response."})}):s.jsxs("button",{className:"flex w-full items-center justify-between rounded px-3 py-2 font-semibold hover:bg-token-main-surface-secondary",onClick:()=>{l(!0),te.logEvent(K.memoryUpdatePopoverManageButtonClicked,{updateCount:v.length})},children:[s.jsx(R,{id:"MemoryActionResult.manageMemories",defaultMessage:"Manage memories"}),s.jsx(wl,{className:"icon-md -mr-1 text-token-text-tertiary"})]})]})}),i&&s.jsx(Vl,{initialGizmoId:a,onClose:()=>l(!1)})]})}function Yc(t){const e=["The user ","The user's ","User ","User's "];for(const n of e)if(t.startsWith(n))return t.slice(n.length);return t}function ma(t,e,n){U.updateTree(t,a=>{a.updateNodeMetadata(e,{inlineComparisonRating:n})})}function ga(t){var a,o;return{is_dark_mode:t==="dark",time_since_loaded:Math.floor(performance.now()/1e3),page_height:window==null?void 0:window.innerHeight,page_width:window==null?void 0:window.innerWidth,pixel_ratio:window==null?void 0:window.devicePixelRatio,screen_height:(a=window==null?void 0:window.screen)==null?void 0:a.height,screen_width:(o=window==null?void 0:window.screen)==null?void 0:o.width}}const fa=({messages:t})=>{for(const{message:{metadata:e}}of t){const{augmented_paragen_prompt_label:n}=e??{};if(n)return n}};function Xc(t){const e=m.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});return t.stubSideBySideFeedback?s.jsx(yo,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:e,...t}):s.jsx(Jc,{...t,visibilityStateRef:e})}function Jc(t){const{clientThreadId:e,variantIds:n,variantsInStreamInfo:a}=t;if(n.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const[o]=m.useState(()=>Date.now()),i=Wa(),{resolvedTheme:l}=zo(),[c,d]=m.useMemo(()=>Va(n.join(""))()<.5?[0,1]:[1,0],[n[0],n[1]]),h=c<d?"left":"right",p=h==="left"?"right":"left",f=n[c],v=n[d],S=aa(e,f),C=aa(e,v),g=qt(oa(e,qt(S).id)),x=qt(oa(e,qt(C).id)),u=h==="left"?g:x,b=h==="left"?x:g,w=a.display_treatment==="unskippable",y=w?"unskippable_parallel_2_in_stream:a:1.0":"skippable_parallel_2_in_stream:a:1.5";m.useEffect(()=>(Is.setState({displayingSideBySideFeedback:!0,unskippable:w}),()=>{Is.setState({displayingSideBySideFeedback:!1,unskippable:!1})}),[w]),$i();const j=m.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});m.useEffect(()=>Uo(Ki,{requestCompletion:()=>{var z,_,I,q;const N=(z=$t(u.messages))==null?void 0:z.completionSampleFinishTime,W=(_=$t(b.messages))==null?void 0:_.completionSampleFinishTime;Me.submitMessageComparisonFeedback({feedback_version:y,original_message_id:(I=u.messages[u.messages.length-1])==null?void 0:I.message.id,new_message_id:(q=b.messages[b.messages.length-1])==null?void 0:q.message.id,rating:"none",conversation_id:U.getServerThreadId(e),text:"",tags:[],completion_comparison_rating:"skip",new_completion_placement:p,feedback_start_time:o,compare_step_start_time:o,original_completion_load_start_time:o,original_completion_load_end_time:N??0,new_completion_load_start_time:o,new_completion_load_end_time:W??0,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:ga(l),...j.current})}}),[g,x,e,o,y,p,u==null?void 0:u.messages,b==null?void 0:b.messages,l]);const D=N=>{var F,P,k,X;const z=U.getTree(e).getLeafFromNode(N);U.setThreadCurrentLeafId(e,z.id);const I=N===f===(h==="left"),q=(F=$t(u.messages))==null?void 0:F.completionSampleFinishTime,B=(P=$t(b.messages))==null?void 0:P.completionSampleFinishTime;u.messages.length>0&&ma(e,u.messages[u.messages.length-1].nodeId,I?"original":"new"),b.messages.length>0&&ma(e,b.messages[b.messages.length-1].nodeId,I?"original":"new");let se;q==null||B==null?se=I?"partial_load_comparison_original":"partial_load_comparison_new":se=I?"original":"new",Me.submitMessageComparisonFeedback({feedback_version:y,original_message_id:(k=u.messages[u.messages.length-1])==null?void 0:k.message.id,new_message_id:(X=b.messages[b.messages.length-1])==null?void 0:X.message.id,rating:"none",conversation_id:U.getServerThreadId(e),text:"",tags:[],completion_comparison_rating:se,new_completion_placement:p,feedback_start_time:o,compare_step_start_time:o,original_completion_load_start_time:o,original_completion_load_end_time:q??null,new_completion_load_start_time:o,new_completion_load_end_time:B??null,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:ga(l),...j.current})};return s.jsx(yo,{...t,setPreferredFeedback:D,leftVariantId:f,rightVariantId:v,leftTurn:g,rightTurn:x,hasActiveRequest:i,originalTurn:u,visibilityStateRef:j})}function Zc(t){if(!t.length)return!1;const e=t.filter(n=>n.type===ot.Text||n.type===ot.MultiText).filter(n=>{var a;return n.message.message.status!=="finished_successfully"&&((a=n.message.message.metadata)==null?void 0:a.snorkle_status)!==void 0});return e.length>0&&e.every(n=>{const a=n.message.message.content;return(a==null?void 0:a.content_type)===it.Text&&a.parts.join("")===""})}function yo({setPreferredFeedback:t,leftVariantId:e,rightVariantId:n,leftTurn:a,rightTurn:o,hasActiveRequest:i,originalTurn:l,visibilityStateRef:c,...d}){const{defaultParagenLabel:h,shouldShowParagenLabels:p=!1}=Qi(),f=a&&fa(a)||h,v=o&&fa(o)||h,S=m.useMemo(()=>(a==null?void 0:a.messages)??[],[a==null?void 0:a.messages]),C=m.useMemo(()=>(o==null?void 0:o.messages)??[],[o==null?void 0:o.messages]),{avatarClassName:g}=d,x=m.useMemo(()=>Rs(S),[S]),u=m.useMemo(()=>Rs(C),[C]),b=Un(),w=as();function y(X){var ne,ze;if(!w.showDebugConversationTurns&&!w.forceParagen)return null;let G=X===l?"ORIGINAL":"NEW";const V=X.messages[X.messages.length-1],Z=(ze=(ne=V==null?void 0:V.message)==null?void 0:ne.metadata)==null?void 0:ze.__internal;if(Z){const{model_id:xe,model_definition_slug:Qe,model_definition_virtual_model_id:Ye,alternative_model_selection_rule:Xe,augmented_paragen_prompt_group_id:je,augmented_paragen_prompt_id:Ae,augmented_paragen_prompt:Ge}=Z;xe&&(G+=`
Model ID: ${xe}`),Qe&&(G+=`
Model Slug: ${Qe}`),Ye&&(G+=`
Virtual Model ID: ${Ye}`),Xe&&(G+=`
Alternative Model Rule: ${Xe}`),je&&(G+=`
Prompt Group ID: ${je}`),Ae&&(G+=`
Prompt ID: ${Ae}`),Ge&&(G+=`
Prompt: ${Ge}`)}return s.jsx("div",{className:"whitespace-pre-wrap text-sm text-red-500",children:G})}const[j,D]=m.useMemo(()=>[x,u].map(X=>Zc(X)),[x,u]),N=Jt(a?Es.getRequestIdFromConversationTurn(a):"")||j,W=Jt(o?Es.getRequestIdFromConversationTurn(o):"")||D,z=(a==null?void 0:a.role)===be.User,_=(o==null?void 0:o.role)===be.User,I=zn(),q=m.useRef(null),B=m.useRef(null),se=m.useRef(null);m.useEffect(()=>{if(q.current&&B.current&&se.current){const X=Array(11).fill(0).map((V,Z)=>Z/10),G=new IntersectionObserver(V=>V.forEach(Z=>{Z.target===B.current?(c.current.left_visibility_initial==null&&(c.current.left_visibility_initial=Z.intersectionRatio),c.current.left_visibility_max=Math.max(c.current.left_visibility_max??0,Z.intersectionRatio)):Z.target===se.current&&(c.current.right_visibility_initial==null&&(c.current.right_visibility_initial=Z.intersectionRatio),c.current.right_visibility_max=Math.max(c.current.right_visibility_max??0,Z.intersectionRatio))}),{root:q.current,threshold:X});return G.observe(B.current),G.observe(se.current),()=>G.disconnect()}},[c]);const{data:F}=Bn(void 0,!1,b),P=F==null?void 0:F.memoryFullPct,k=typeof P=="number"&&P>=100;return s.jsxs("div",{className:"relative flex flex-col",children:[s.jsx("div",{className:"sticky top-[-1px] z-[1] text-pretty bg-token-main-surface-primary px-6 text-center text-lg md:static",children:s.jsx(R,{id:"JgCHDY",defaultMessage:"You’re giving feedback on a new version of ChatGPT."})}),s.jsx("div",{className:"text-pretty px-6 pb-5 pt-1 text-center text-sm text-token-text-secondary",children:s.jsx(R,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),s.jsx("div",{className:"sticky top-[calc(1.75em-1px)] z-[1] h-3 bg-gradient-to-b from-token-main-surface-primary from-50% to-transparent md:static"}),s.jsx("div",{className:"-mb-2 snap-x snap-mandatory overflow-x-auto px-3 pb-4 md:px-5 lg:px-10",ref:q,children:s.jsx("div",{className:"min-w-fit",children:s.jsxs("div",{className:"mx-auto flex max-w-6xl items-start gap-4 sm:gap-6",children:[s.jsxs(pa,{elemRef:B,onClick:()=>{t(e)},hasActiveRequest:i,children:[s.jsxs(xa,{children:[s.jsx(Rn,{messages:S,isUserTurn:z,avatarClassName:g,showInlineEmbeddedDisplay:!1}),s.jsx(ba,{children:p?s.jsx("span",{className:"font-bold text-token-text-primary",children:f}):s.jsx(R,{...ya.responseNumber,values:{responseIndex:1}})})]}),F!=null&&!z&&s.jsx(Pn,{messages:S,isMemoryEnabled:I,isMemoryFull:k,isParagen:!0}),s.jsx(_n,{...d,groupedMessagesToRender:x,allGroupedMessages:x,isEditing:!1,isUserTurn:z,isCompletionRequestInProgress:N,hasActiveRequest:i,handleEnterEdit:gt,handleExitEdit:gt,shouldGrowContainer:!1}),!!a&&y(a)]}),s.jsxs(pa,{elemRef:se,onClick:()=>{t(n)},hasActiveRequest:i,children:[s.jsxs(xa,{children:[s.jsx(Rn,{messages:C,isUserTurn:_,avatarClassName:g,showInlineEmbeddedDisplay:!1}),s.jsx(ba,{children:p?s.jsx("span",{className:"font-bold text-token-text-primary",children:v}):s.jsx(R,{...ya.responseNumber,values:{responseIndex:2}})})]}),F!=null&&!_&&s.jsx(Pn,{messages:C,isMemoryEnabled:I,isMemoryFull:k,isParagen:!0}),s.jsx(_n,{...d,groupedMessagesToRender:u,allGroupedMessages:u,isEditing:!1,isUserTurn:_,isCompletionRequestInProgress:W,hasActiveRequest:i,handleEnterEdit:gt,handleExitEdit:gt,shouldGrowContainer:!1}),!!o&&y(o)]})]})})})]})}function pa({elemRef:t,onClick:e,children:n,hasActiveRequest:a}){return s.jsxs("div",{className:"relative flex w-full min-w-[min(450px,80vw)] snap-center flex-col gap-1 truncate rounded-2xl border border-token-main-surface-tertiary bg-white p-5 text-left dark:bg-gray-700",ref:t,children:[n,a?null:s.jsx(nt,{className:"mt-4 self-start",onClick:e,children:s.jsx(R,{id:"U2EAH6",defaultMessage:"I prefer this response"})})]})}const ba=Ke.div`text-sm text-token-text-tertiary font-semibold`,xa=Ke.div`flex gap-4 items-center mb-1`,ya=_e({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}"},responseChoice:{id:"ConversationTurnTwoUpFeedback.responseChoice",defaultMessage:"Choose this response"}});function ed({clientThreadId:t,messageForRating:e,variantIds:n,conversationTurnMountTime:a}){const[o]=m.useState(()=>e.message.create_time!=null?e.message.create_time*1e3:Date.now()),[i]=m.useState(()=>Date.now());function l(c){var j,D;const d=U.getTree(t),h=n[0]||"",p=(d==null?void 0:d.getConversationTurns(h))||[],f=p[p.length-1],v=(f==null?void 0:f.messages)||[],S=v[v.length-1],C=((j=S==null?void 0:S.message)==null?void 0:j.id)||"",g=n[1]||"",x=(d==null?void 0:d.getConversationTurns(g))||[],u=x[x.length-1],b=(u==null?void 0:u.messages)||[],w=b[b.length-1],y=((D=w==null?void 0:w.message)==null?void 0:D.id)||"";Me.submitMessageComparisonFeedback({feedback_version:"inline_regen_feedback:a:1.0",original_message_id:C,new_message_id:y,rating:"none",conversation_id:U.getServerThreadId(t),text:"",tags:[],completion_comparison_rating:c,new_completion_placement:"not-applicable",feedback_start_time:a,compare_step_start_time:a,new_completion_load_start_time:o,new_completion_load_end_time:i,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset()}),U.updateTree(t,N=>{N.updateNodeMetadata(e.nodeId,{inlineComparisonRating:c})}),U.updateTree(t,N=>{N.updateNodeMetadata(S.nodeId,{inlineComparisonRating:"baseline"})})}return s.jsxs(td,{children:[s.jsx("h6",{className:"min-w-[150px] grow",children:s.jsx(R,{...Ms.regenTitle})}),s.jsxs("div",{className:"flex flex-wrap items-end justify-center gap-2",children:[s.jsx(nt,{color:"secondary",onClick:()=>l("new"),children:s.jsx(R,{...Ms.regenBetterText})}),s.jsx(nt,{color:"secondary",onClick:()=>l("original"),children:s.jsx(R,{...Ms.regenWorseText})}),s.jsx(nt,{color:"secondary",onClick:()=>l("same"),children:s.jsx(R,{...Ms.regenSameText})})]}),s.jsx(Bo,{onClick:()=>{U.updateTree(t,c=>{c.updateNodeMetadata(e.nodeId,{inlineComparisonRating:"skip"})})}})]})}const td=Ke.div`flex items-center p-4 rounded-2xl bg-token-main-surface-primary text-token-text-primary text-sm border border-token-border-light gap-5 mt-3`,Ms=_e({regenTitle:{id:"ConversationTurnInlineFeedback.regenTitle",defaultMessage:"Was this response better or worse?"},regenBetterText:{id:"ConversationTurnInlineFeedback.regenBetterText",defaultMessage:"Better"},regenWorseText:{id:"ConversationTurnInlineFeedback.regenWorseText",defaultMessage:"Worse"},regenSameText:{id:"ConversationTurnInlineFeedback.regenSameText",defaultMessage:"Same"}}),va=({allGroupedMessages:t})=>t.some(e=>[ot.Browsing,ot.RetrievalBrowsing,ot.ParallelBrowsing].includes(e.type)),Sa=({allGroupedMessages:t})=>t.some(e=>e.type===ot.CodeInterpreter);function sd(t){return!t||!t.instructions?"":typeof t.instructions=="string"?t.instructions:t.instructions.filter(e=>typeof e=="string").join("")}const nd=[{match:va,tag:"Shouldn't have searched the web",label:re({id:"kL047b",defaultMessage:"Shouldn't have searched the web"})},{match:va,tag:"Don't like the source it cited",label:re({id:"+ds/Q/",defaultMessage:"Don't like the source it cited"})},{match:Sa,tag:"Shouldn't have run code",label:re({id:"53w4ay",defaultMessage:"Shouldn't have run code"})},{match:Sa,tag:"Couldn't handle my file",label:re({id:"EkFTQ5",defaultMessage:"Couldn't handle my file"})},{match:({allGroupedMessages:t})=>t.some(e=>e.type===ot.Dalle),tag:"Shouldn't have created an image",label:re({id:"S8FRsr",defaultMessage:"Shouldn't have created an image"})},{match:({allGroupedMessages:t})=>t.some(e=>{if(e.type!==ot.Text)return!1;const{message:n}=e.message,{content:a}=n;return a.content_type===it.Text&&Ia(n).match(/^```[\S]+\n/gm)}),tag:"Code was incorrect",label:re({id:"4EBdQk",defaultMessage:"Code was incorrect"})},{match:({systemContent:t})=>sd(t).includes("Personality")??!1,tag:"Too chatty or casual",label:re({id:"ATzJKW",defaultMessage:"Too chatty or casual"})},{match:({features:t})=>t.includes(Bs.Sunshine),tag:"Shouldn't have used Memory",label:re({id:"yfUEiz",defaultMessage:"Shouldn't have used Memory"})},{tag:"Don't like the style",label:re({id:"nGxjdj",defaultMessage:"Don't like the style"})},{tag:"Not factually correct",label:re({id:"Ke7JtQ",defaultMessage:"Not factually correct"})},{tag:"Didn't fully follow instructions",label:re({id:"Rdlt9V",defaultMessage:"Didn't fully follow instructions"})},{tag:"Refused when it shouldn't have",label:re({id:"2yRS/Q",defaultMessage:"Refused when it shouldn't have"})},{tag:"Being lazy",label:re({id:"14MPmT",defaultMessage:"Being lazy"})},{tag:"Unsafe or problematic",label:re({id:"02pXBl",defaultMessage:"Unsafe or problematic"})},{tag:"Other",label:re({id:"WiIGE+",defaultMessage:"Other"})}],ad=[{tag:"I disagree with the policy",label:re({id:"oKyDLz",defaultMessage:"I disagree with the policy"})},{tag:"This didn't violate the policy",label:re({id:"7fUkVF",defaultMessage:"This didn't violate the policy"})},{tag:"I don't understand the policy",label:re({id:"4Cdp6N",defaultMessage:"I don't understand the policy"})},{tag:"This didn't take the full context",label:re({id:"vnZJDP",defaultMessage:"This didn't take the full context"})}];function od(t,e,n){return e.filter(a=>!a.match||a.match(n)).map(a=>({value:a.tag,label:t.formatMessage(a.label)}))}function id(t){const e=t[t.length-1];if(!e)return!1;const n="message"in e?e.message:null;if(n){const{errCode:a}=Vn(n);return[Xn.ContentPolicy,Xn.ContentOrTos].includes(a)}else return!1}function rd({clientThreadId:t,conversationMessage:e,currentModelId:n,allGroupedMessages:a}){const o=Oe(),i=Us()??[],l=e.rating,c=el(t,e.message.id),d=(c==null?void 0:c.message.content.content_type)===it.SystemContent?c==null?void 0:c.message.content:null,h=m.useCallback(v=>{const S=U.getServerThreadId(t);S&&(v.tags.length===0&&!v.textFeedback||(te.logEvent(v.source==="inline"?K.messageFeedbackInlineSubmitted:K.messageFeedbackDialogSubmitted,{id:e.message.id,threadId:S,tags:v.tags,content:v.textFeedback,model:n,rating:l}),l&&Me.submitMessageFeedback({message_id:e.message.id,conversation_id:S,rating:l,text:v.textFeedback,tags:v.tags,tag_choices:v.tagChoices})))},[t,e.message,n,l]),p=()=>{te.logEvent(K.messageFeedbackMoreOptionsClicked,{id:e.message.id,threadId:U.getServerThreadId(t),model:n,rating:l})},f=od(o,id(a)?ad:nd,{allGroupedMessages:a,features:i,currentModelId:n,systemContent:d});return l==="thumbsUp"?null:s.jsx(ql,{tagOptions:f,onSubmit:h,onMoreClicked:p})}const Ca=[1,2,3,4,10,20,30],ld=.5;function cd({clientThreadId:t,conversationLeafId:e}){const n=Ps(Hn.isBusinessWorkspace),a=m.useRef(!1),o=qs(t),i=$s(t),{isUnauthenticated:l}=Pt(),c=m.useMemo(()=>{if(!o)return-1;const _=Va(o);return _()>ld?-1:Ca[Math.floor(_()*Ca.length)]},[o]),d=Xa(t,e),h=d[d.length-1],p=m.useMemo(()=>Es.getRequestIdFromConversationTurn(h),[h]),f=Jt(p),[v,S]=m.useState(null),[C,g]=m.useState(!1),[x,u]=m.useState(!1),[b,w]=m.useState(!1),y=_=>{var q,B;const I=(B=(q=$t(d))==null?void 0:q.messages[0])==null?void 0:B.message.id;S(_),W(I,_)},j=d.filter(_=>_.role===be.Assistant).length,D=(h==null?void 0:h.role)===be.Assistant,N=h==null?void 0:h.messages.some(_=>{var I;return(I=_.message.metadata)==null?void 0:I.is_nulligen}),W=m.useMemo(()=>La((_,I)=>{o&&_&&Me.submitConversationRating({conversation_id:o,message_id:_,rating:I,shown_at_assistant_turn:c}),te.logEvent(K.conversationRatingSubmitted,{rating:I,showAtAssistantTurn:c,conversationId:o}),g(!0),setTimeout(()=>{u(!0)},1500)},2e3),[o,c]),z=j!==c||f||!D||N||!!n||(i==null?void 0:i.kind)!==at.PrimaryAssistant||b||l;return m.useEffect(()=>{!z&&!a.current&&(te.logEvent(K.conversationRatingShown,{showAtAssistantTurn:c,conversationId:o}),a.current=!0)},[z]),b||z?null:s.jsxs("div",{className:"mx-auto",children:[s.jsx(Oa,{children:C&&!x&&s.jsx(It.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:s.jsx(wa,{$padded:!0,children:s.jsx("span",{className:"text-sm text-token-text-tertiary",children:s.jsx(R,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!C&&s.jsx(It.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:s.jsxs(wa,{$padded:!1,children:[s.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-secondary",children:[s.jsx(R,{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?"}),s.jsxs("div",{className:"flex items-center gap-5",children:[s.jsx(Sn,{$selected:v==="thumbsUp",onClick:()=>y("thumbsUp"),children:s.jsx(ao,{className:"icon-md"})}),s.jsx(Sn,{$selected:v==="thumbsDown",onClick:()=>y("thumbsDown"),children:s.jsx(oo,{className:"icon-md"})})]})]}),s.jsx("div",{className:"w-px flex-1 self-stretch bg-token-main-surface-tertiary"}),s.jsx(Sn,{className:"p-3",$selected:!1,onClick:()=>w(!0),children:s.jsx(Ml,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const Sn=Ke.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,wa=Ke.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`;function dd({clientThreadId:t,conversationLeafId:e,canShowIndepthFeedbackType:n,canShowInlineComparisonFeedback:a,canShowInlineMessageFeedback:o,messageForRating:i,allGroupedMessages:l,currentModelId:c,conversationTurnMountTime:d,variantIds:h}){let p=null;return tl(t,e)?null:(n!==void 0?p=s.jsx(Ac,{clientThreadId:t,conversationLeafId:e,trigger:n,variantIds:h}):i.rating&&o?p=s.jsx(rd,{clientThreadId:t,conversationMessage:i,allGroupedMessages:l,currentModelId:c}):a?p=s.jsx(ed,{clientThreadId:t,messageForRating:i,variantIds:h,conversationTurnMountTime:d}):p=s.jsx("div",{className:"text-center",children:s.jsx(cd,{clientThreadId:t,conversationLeafId:e})}),s.jsx("div",{className:"mt-3 w-full empty:hidden",children:p}))}const ud=xt(()=>yt(()=>import("./sso-hexuaopvgesml5k1.js").then(t=>t.j),__vite__mapDeps([31,1,2,3,32,6,7,13,33,34,35,36,37,38,15,39,11,10,40,41,42,43,44,12,9,45,46,47,48,49,50,51,52,53,17,27,28,29,19,54,55,26,56,57,58,25,30,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,16,80,81,82,83,84,85,86,87,88,89,90,91,92,93])).then(t=>t.ContextualAnswerCitationCards).catch(()=>()=>null));function hd(t){var le;const{turnIndex:e,conversationLeafId:n,isFinalTurn:a,clientThreadId:o,onChangeItemInView:i,onChangeRating:l,showInlineEmbeddedDisplay:c=!1,currentModelId:d,initiallyHighlightedMessageId:h,avatarClassName:p,scrollToBottom:f}=t,v=Oe(),S=Gn(),C=!!S&&Ho(S),g=Ws(),x=Ps(Hn.isBusinessWorkspace),u=zn(),b=Un(),w=qt(sl(o,e,n)),{messages:y,variantIds:j,variantsInStreamInfo:D}=w,N=Rs(y),W=Yi();let z=y[y.length-1];for(const $ of N){const ce=qr($);if(ce.some(ut=>W.has(ut.message.id))){z=ce[ce.length-1];break}}const _=y.slice(0,y.indexOf(z)+1),I=Fa(),[q,B]=m.useState(!1),[se,F]=m.useState(!1),P=j.findIndex($=>_.some(ce=>ce.nodeId===$)),k=w.role===be.User,X=bt(),G=rt(o),V=(le=ns(w.gizmoId??G))==null?void 0:le.data,Z=Xi(),ne=V&&Z.includes(V.gizmo.id),ze=qa(d),xe=$s(o,V==null?void 0:V.gizmo.id),Ye=nl(o)===Wo.PENDING,{data:Xe}=Bn(V==null?void 0:V.gizmo.id,!1,b),je=Xe==null?void 0:Xe.memoryFullPct,Ae=je!==void 0&&je>=100,Ge=Us(),{value:is}=Ns("1410082514"),{value:Dt}=Ns("2291672486"),Qs=_.some($=>$.message.content.content_type===it.MultimodalText),{isUnauthenticated:lt}=Pt(),[rs,ls]=m.useState(!1),[Ys,Lt]=m.useState(!1);Ji(()=>{w.role==="user"&&f&&f()});const Ot=m.useRef(null);m.useEffect(()=>{var ce;if(h==null)return;w.messages.map(ut=>ut.message.id).includes(h)&&((ce=Ot.current)==null||ce.scrollIntoView({behavior:"auto"}))},[h]);const O=y[y.length-1],Ue=O.rating,cs=()=>{_.length===1&&(te.logEvent(K.editPrompt,{id:_[0].message.id,threadId:U.getServerThreadId(o)}),qe.logEvent("chatgpt_edit_prompt"),B(!0))},He=m.useCallback(()=>{B(!1)},[]),vt=m.useCallback(()=>{U.copyMessageToClipboard(o,e)},[o,e]),zt=$=>{l({nodeId:O.nodeId,messageId:O.message.id,rating:$}),te.logEvent(K.messageFeedbackThumbsDownClicked,{id:O.message.id,threadId:U.getServerThreadId(o),model:d,rating:$}),F(!0)},[ds]=m.useState(()=>Date.now()),Xs=m.useMemo(()=>Es.getRequestIdFromConversationTurn(w),[w]),Js=al({clientThreadId:o,conversationLeafId:n}),ye=Jt(Xs)&&!Js,Ut=Wa(),Zs=Rs(_),{showDebugConversationTurns:us}=as(),hs=ol(o),ms=co(o),Bt=Ic({clientThreadId:o,conversationMode:xe}),en=Vs(o),gs=m.useCallback(({requestedModelId:$,systemMessage:ce,juice:ut,extraStreamParams:dn})=>{const So=new Cn;Bt({id:O.nodeId,eventMetadata:{eventSource:"mouse"},turnTracker:So,requestedModelId:$,systemMessage:ce,juice:ut,extraStreamParams:dn})},[O,Bt]),fs=is&&_.some($=>{var ce;return((ce=$.message.metadata)==null?void 0:ce.snorkle_status)!=null}),St=!g&&!hs&&!X&&!k,Gt=St&&(!x||fs),Ht=Zi(),ps=!lt&&Gt&&I&&!ye&&!Ye&&!c&&!q&&(xe==null?void 0:xe.kind)!==at.GizmoMagicCreate&&P===1&&a&&!O.inlineComparisonRating&&!Ue&&j.length===2&&!Ht&&Date.now()-(O.message.create_time??0)*1e3<1e3*60*10,bs=!lt&&Gt&&!ye&&!Ye&&!c&&!q&&(xe==null?void 0:xe.kind)!==at.GizmoMagicCreate&&d===mi&&a&&u&&!Ae&&Date.now()-(O.message.create_time??0)*1e3<1e3*60*10,xs=Nc(O),tn=z.message.author.role===be.Assistant?z.message:null;er({isCompletionRequestInProgress:ye,isUserTurn:k,message:tn});const ys=bs?xs:void 0,sn=il(o,j),Be=tr(xe),vs=!Ht&&!Be&&St&&a&&(D==null?void 0:D.num_variants_in_stream)===2&&!O.inlineComparisonRating&&!sn,nn=j.length===2,Ct=vs,an=vs&&!nn,ct=!k&&!c&&!g&&!hs&&!Be&&!Ye&&!ye,L=ct&&(!x||fs||ze||C)&&!Be&&!lt&&!X,he=!g&&!c&&!((ye||Ye)&&a)&&j.length>1&&!q&&!Ct;let ae=!1;if(k&&_.length===1){const{shouldHideContent:$}=Vn(_[0]);$&&(ae=!0)}const me=k&&!c&&!Be&&!g&&!Qs&&_.length===1&&!ae&&!q&&!lt,Je=$=>{i(j[$]),te.logEvent(K.changeNode,{intent:"toggle_between"})};if(!(w.role===be.Root?!1:w.role===be.System||_.every($=>{var ce;return(ce=$.message.metadata)==null?void 0:ce.is_visually_hidden_from_conversation})?us:!0)&&!Ct)return null;const dt=a&&ms&&!Dt?s.jsx(_s,{onClick:()=>{const $=new Cn;Bt({id:en,eventMetadata:{eventSource:"mouse"},turnTracker:$}),sr()},icon:Ks,label:v.formatMessage({id:"ConversationTurn.regenerateTooltip",defaultMessage:"Regenerate"}),testId:"regenerate-turn-action-button"}):null,We="h-[30px] rounded-md px-1 text-token-text-secondary hover:bg-token-main-surface-secondary",on=Dt?s.jsx(Qc,{className:We,clientThreadId:o,message:O,onModelSelect:gs,onDropdownChange:ls,canRegenerateResponse:ms}):null,rn=!k&&!ae&&!c&&(!a||!ye)?s.jsx(cr,{onClick:vt}):null,ln=!k&&!c&&(!a||!ye)&&(O.disclaimers??[]).length===0&&O.nodeId?s.jsx(Uc,{conversationId:o,message:O,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-xs text-token-text-tertiary hover:text-token-text-primary"}):null,Wt=!k&&!c&&O&&(!a||!ye)?s.jsx(dr,{message:O,isFinalTurn:a,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-token-text-tertiary hover:text-token-text-primary"}):null,cn=L&&!ye?s.jsxs("div",{className:"flex",children:[!(Ge!=null&&Ge.includes(Bs.ThumbsDownOnly))&&Ue!=="thumbsDown"&&s.jsx(_s,{onClick:()=>zt("thumbsUp"),disabled:Ue==="thumbsUp",icon:Ue==="thumbsUp"?_l:ao,label:v.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"},`thumbsUp:${O.nodeId}`),Ue!=="thumbsUp"&&s.jsx(_s,{onClick:()=>zt("thumbsDown"),disabled:Ue==="thumbsDown",icon:Ue==="thumbsDown"?kl:oo,label:v.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"},`thumbsDown:${O.nodeId}`)]}):null,Vt=!Dt&&s.jsx(_c,{className:We,clientThreadId:o,message:O,onModelSelect:gs,onDropdownChange:ls});return s.jsxs("article",{className:"w-full text-token-text-primary focus-visible:outline-2 focus-visible:outline-offset-[-4px]",ref:Ot,dir:"auto","data-testid":`conversation-turn-${e}`,"data-scroll-anchor":a,onMouseEnter:()=>Lt(!0),onMouseLeave:()=>Lt(!1),children:[s.jsx(nr,{role:w.role}),s.jsx($a,{clientThreadId:o,showInlineEmbeddedDisplay:c,isStaticSharedThread:g,withVerticalPadding:!0,withHorizontalPadding:!Ct,children:Ct?s.jsx(Xc,{isFeedbackEnabled:L,variantIds:j,variantsInStreamInfo:D,conversationTurnMountTime:ds,stubSideBySideFeedback:an,...t}):s.jsxs(Ka,{children:[!k&&s.jsx(gd,{children:s.jsx(Rn,{messages:_,isUserTurn:k,avatarClassName:p,showInlineEmbeddedDisplay:c,gizmo:V})}),s.jsx("div",{className:ee("group/conversation-turn relative flex w-full min-w-0 flex-col",!k&&ar),children:s.jsx("div",{className:"flex-col gap-1 md:gap-3",children:s.jsxs(s.Fragment,{children:[!k&&!g&&s.jsx(Pn,{messages:_,isMemoryEnabled:u,isMemoryFull:Ae,gizmoId:V==null?void 0:V.gizmo.id}),s.jsx(_n,{groupedMessagesToRender:Zs,allGroupedMessages:N,...t,isEditing:q,isUserTurn:k,isCompletionRequestInProgress:ye,isFeedbackEnabled:L,isFinalTurn:a,hasActiveRequest:Ut,showEditButton:me,handleEnterEdit:cs,handleExitEdit:He}),ne&&s.jsx("div",{className:"mb-4",children:s.jsx(or,{messages:_})}),ze&&s.jsx("div",{className:"mb-4",children:s.jsx(ud,{messages:_})}),(ct||he)&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:ee("mb-2 flex gap-3 empty:hidden",k?"mr-1 flex-row-reverse":"-ml-2"),children:s.jsx(ir,{alwaysShow:a,showInline:a||he,isHovered:Ys||rs,pagination:he&&s.jsx(rr,{showInline:a||he,currentPage:P,onChangeIndex:Je,length:j.length,className:ee("self-center",j.length>1?"visible":"!invisible")}),actions:ct&&s.jsxs(s.Fragment,{children:[ln,rn,dt,cn,Wt,Vt,on]})})}),ct&&!ye?s.jsx("div",{className:"pr-2 lg:pr-0",children:s.jsx(lr,{message:O,isFinalTurn:a})}):null,a&&!ye&&s.jsx(dd,{canShowIndepthFeedbackType:ys,canShowInlineComparisonFeedback:ps,canShowInlineMessageFeedback:se,clientThreadId:o,conversationLeafId:n,messageForRating:O,allGroupedMessages:N,currentModelId:d,conversationTurnMountTime:ds,variantIds:j})]})]})})})]})})]})}const md=Go.memo(hd),gd=Ke.div`flex-shrink-0 flex flex-col relative items-end`;function fd(t){var n,a;const e=(n=t.message.metadata)==null?void 0:n.aggregate_result;return(a=e==null?void 0:e.messages)==null?void 0:a.some($l)}function pd(t){const e=t.message.content;return("parts"in e?e.parts.join(""):"").includes("sandbox:")}function bd(t){return t.some(e=>e.messages.some(n=>fd(n)||pd(n)))}function xd({clientThreadId:t}){const e=rl(t),n=Ja(t),a=Wn(p=>os.getThreadCreateTime(t,p)),o=Vs(t),i=Xa(t,o),l=m.useMemo(()=>bd(i),[i]),c=ll(t),d=cl(t),h=c||d;return s.jsxs("div",{className:"border-b border-gray-100 px-4 pb-4 pt-3 sm:mb-2 sm:pb-6 sm:pt-8 md:px-0",children:[s.jsx("h1",{className:"text-3xl font-semibold leading-tight text-token-text-primary sm:text-4xl",children:e}),(n!=null||a!=null)&&s.jsxs("div",{className:"pt-3 text-base text-gray-400 sm:pt-4",children:[n!=null&&s.jsx("span",{children:n}),n!=null&&a!=null&&s.jsx("span",{className:"px-2",children:"•"}),a!=null&&s.jsx(Vo,{value:a,month:"long",year:"numeric",day:"numeric"})]}),s.jsx(yd,{shouldShowCodeInterpreterDisclaimer:l,shouldShowPersonalizedDataDisclaimer:h})]})}const yd=({shouldShowCodeInterpreterDisclaimer:t,shouldShowPersonalizedDataDisclaimer:e})=>s.jsxs(s.Fragment,{children:[t&&s.jsx("div",{className:"mt-4",children:s.jsx(ea,{icon:Ds,children:s.jsx(R,{id:"sharedConversation.advancedDataAnalysisSupportDisclaimer",defaultMessage:"This chat contains files or images produced by Advanced Data Analysis which are not yet visible in Shared Chats."})})}),e&&s.jsx("div",{className:"mt-4",children:s.jsx(ea,{icon:Ds,children:s.jsx(R,{id:"sharedConversation.personalizedDataDisclaimer",defaultMessage:"This conversation may reflect the link creator’s personalized data, which isn’t shared and can meaningfully change how the model responds."})})})]}),vd=t=>{const e=bt();return m.useCallback(n=>{var c,d;ur(n);const{target:a}=n;if(!(a instanceof Element))return;const o=(c=a.closest("[data-message-id]"))==null?void 0:c.getAttribute("data-message-id"),i=(d=document.getSelection())==null?void 0:d.toString(),l=U.getServerThreadId(t);!o||!i||!l||e||Me.submitImplicitMessageFeedback({source:"keyboard",type:"copy",messageId:o,serverThreadId:l,selectedText:i})},[t,e])};function Sd({onChangeItemInView:t,onRequestMoreCompletions:e,onChangeRating:n,onRequestCompletion:a,clientThreadId:o,conversationLeafId:i,inlineEmbeddedDisplay:l,initiallyHighlightedMessageId:c,hideHeader:d}){const h=hr(),p=Ws(),f=mr(),[v]=gr(),S=$s(o),C=Rt(),g=gi(o),x=h.store.useContentAreaDimensions(fr.Header,I=>I!=null&&I.height?I.height:void 0),u=h.store.useIsHeaderContentAreaPopulated(),b=Za(o),{isArchived:w}=b,y=Ll(g.id),j=(S==null?void 0:S.kind)===at.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":y,D=eo(o,i),N=pr(),W=m.useCallback(()=>{f({behavior:"smooth"})},[f]),z=vd(o),_=N&&!w;return s.jsxs("div",{onCopy:z,className:ee("flex flex-col text-sm",p&&"pt-2",_&&"pb-[120px]",x||_?null:"md:pb-9"),style:{paddingBottom:_?void 0:x},children:[!d&&(p||(C==null?void 0:C.data))&&!l&&s.jsx(lo,{clientThreadId:o}),p&&!l&&s.jsx(Ka,{children:s.jsx(xd,{clientThreadId:o})}),[...new Array(D).keys()].map(I=>s.jsx(md,{isFinalTurn:I===D-1,turnIndex:I,clientThreadId:o,conversationLeafId:i,onChangeItemInView:t,onChangeRating:n,onRequestMoreCompletions:e,onRequestCompletion:a,currentModelId:g.id,showInlineEmbeddedDisplay:l,initiallyHighlightedMessageId:c,avatarClassName:j,scrollToBottom:W},I)),!v&&!l&&s.jsx(Cd,{className:ee(x?null:"bottom-5",_?u?"translate-y-[-50px]":"translate-y-[-10px]":""),style:{bottom:N?"calc(var(--composer-bar_footer-current-height) + var(--composer-bar_current-height))":x},onClick:()=>{qe.logEvent("chatgpt_thread_scroll_to_bottom"),f({behavior:"smooth"})},children:s.jsx(Tl,{className:"icon-md text-token-text-primary"})})]})}const Cd=Ke.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-light right-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`;function wd({clientThreadId:t,currentModelId:e}){const n=Ol(e,zl.CODE_INTERPRETER);_d(n,t)}async function Md({queryKey:[t,e]}){return await Me.getThreadInterpreterState(e).then(n=>(n.time_remaining_ms===0&&n.kernel_started&&jt.warning("This advanced data analysis (beta) chat has timed out. You may continue the conversation, but previous files, links, and code blocks below may not work as expected.",{hasCloseButton:!0,duration:0}),n))}function _d(t,e){const n=Ws(),a=U.getServerThreadId(e);return qo({queryKey:["interpreterState",a],queryFn:Md,enabled:!!(t&&a&&!n),gcTime:0})}const kd=xt(()=>yt(()=>import("./ogxc5713ij9jf5lb.js"),__vite__mapDeps([94,1,2,3,10,6,7,11,9,29,71,47,48,85,58,26,15,37])).then(t=>t.OpenDebugSidebarButton)),Td=xt(()=>yt(()=>import("./k33xzjzjnafnncjr.js"),__vite__mapDeps([95,1,2,3,6,7,63,11])),{ssr:!1}),jd=xt(()=>yt(()=>import("./sso-hexuaopvgesml5k1.js").then(t=>t.k),__vite__mapDeps([31,1,2,3,32,6,7,13,33,34,35,36,37,38,15,39,11,10,40,41,42,43,44,12,9,45,46,47,48,49,50,51,52,53,17,27,28,29,19,54,55,26,56,57,58,25,30,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,16,80,81,82,83,84,85,86,87,88,89,90,91,92,93])).catch(()=>()=>null),{ssr:!1}),Ad=xt(()=>yt(()=>import("./sso-hexuaopvgesml5k1.js").then(t=>t.P),__vite__mapDeps([31,1,2,3,32,6,7,13,33,34,35,36,37,38,15,39,11,10,40,41,42,43,44,12,9,45,46,47,48,49,50,51,52,53,17,27,28,29,19,54,55,26,56,57,58,25,30,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,16,80,81,82,83,84,85,86,87,88,89,90,91,92,93])).then(t=>t.default)),Nd=xt(()=>yt(()=>import("./sso-hexuaopvgesml5k1.js").then(t=>t.l),__vite__mapDeps([31,1,2,3,32,6,7,13,33,34,35,36,37,38,15,39,11,10,40,41,42,43,44,12,9,45,46,47,48,49,50,51,52,53,17,27,28,29,19,54,55,26,56,57,58,25,30,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,16,80,81,82,83,84,85,86,87,88,89,90,91,92,93])).then(t=>t.CAFeedbackModal).catch(()=>()=>null)),$e=_e({doNotShareSensitive:{id:"thread.modal.onboarding.title",defaultMessage:"Do not share sensitive materials with this application"},mayProduceInaccurateInformation:{id:"thread.chatgptMayProduceInaccurateInformation-oct-30",defaultMessage:"ChatGPT can make mistakes. Check important info."},mayProduceInaccurateInformationNoAuth:{id:"thread.chatgptMayProduceInaccurateInformationNoAuth-march-27",defaultMessage:"ChatGPT can make mistakes. Check important info. Read our <termsLink>Terms</termsLink> and <privacyLink>Privacy Policy</privacyLink>."},mayProduceInaccurateInformationNoAuthV2:{id:"thread.chatgptMayProduceInaccurateInformationNoAuth-may-06",defaultMessage:"By messaging ChatGPT, you agree to our <termsLink>Terms</termsLink> and have read our <privacyLink>Privacy Policy</privacyLink>."},mayProduceInaccurateInformationNoAuthKorea:{id:"thread.chatgptMayProduceInaccurateInformationNoAuthKorea-may-06",defaultMessage:"By messaging ChatGPT, you agree to our <termsLink>Terms</termsLink> and have read our <privacyLink>Privacy Policy</privacyLink> and its <koreaAddendumLink>Korea addendum</koreaAddendumLink>."},businessDisclaimer:{id:"thread.businessDisclaimer-oct-30",defaultMessage:"{workspaceName} workspace chats aren't used to train our models. ChatGPT can make mistakes."},businessDisclaimerNoName:{id:"thread.businessDisclaimerNoName-oct-30",defaultMessage:"Your workspace chats aren'ts used to train our models. ChatGPT can make mistakes."},outdatedGptDisclaimer:{id:"thread.outdatedGptDisclaimer.0",defaultMessage:"<bold>New version of GPT available</bold> - Continue chatting to use the old version, or start a <link>new chat</link> for the latest version."},somethingWentWrong:{id:"thread.modal.unrecoverableError.title",defaultMessage:"Something went wrong"},tryAgainLater:{id:"thread.modal.unrecoverableError.description",defaultMessage:"We're sorry, but something went wrong. Please try again later."},resetThread:{id:"thread.modal.unrecoverableError.resetThread",defaultMessage:"Reset thread"},sharedConversationReportConversation:{id:"thread.sharedConversation.report",defaultMessage:"Report conversation"},latencyButton:{id:"thread.latencyButton",defaultMessage:"Latency"},archivedConversationDescription:{id:"thread.archivedConversationDescription",defaultMessage:"This conversation is archived. To continue, please unarchive it first."},unarchiveButton:{id:"thread.unarchiveButton",defaultMessage:"Unarchive"}});function Ed({clientThreadId:t}){const e=rt(t);return e!=null?s.jsx(Id,{clientThreadId:t,gizmoId:e}):s.jsx(vo,{clientThreadId:t})}function Id({clientThreadId:t,gizmoId:e}){const n=ns(e).data,a=Wn(i=>os.getThreadCreateTime(t,i)),o=(n==null?void 0:n.gizmo.updated_at)!=null?new Date(n.gizmo.updated_at):void 0;return(n==null?void 0:n.gizmo.short_url)==null||o==null||a==null||o<=a?s.jsx(vo,{clientThreadId:t}):s.jsxs("div",{className:"text-token-text-tertiary",children:[s.jsx(jl,{className:"text-token-secondary mb-1 mr-1 inline-block h-4 w-4 stroke-0"}),s.jsx(R,{...$e.outdatedGptDisclaimer,values:{link:i=>s.jsx(ii,{to:vi(n.gizmo.short_url),className:"underline",children:i}),bold:i=>s.jsx("span",{className:"text-token-secondary font-semibold",children:i})}})]})}function Fd({clientThreadId:t}){return Dr(n=>n.hasAcceptedFooterDisclaimer)?s.jsx("div",{children:s.jsx(R,{...$e.mayProduceInaccurateInformation})}):s.jsx(Rd,{clientThreadId:t})}function vo({clientThreadId:t}){const e=Ps(Hn.isBusinessWorkspace),n=Ps(d=>d.currentWorkspace),a=n==null?void 0:n.name,{isUnauthenticated:o,isLoading:i}=Pt(),c=to({clientThreadId:t,role:be.User})>0;return i?null:e?s.jsx("div",{children:a!=null?s.jsx(R,{...$e.businessDisclaimer,values:{workspaceName:a}}):s.jsx(R,{...$e.businessDisclaimerNoName})}):o&&!c?s.jsx(ri,{children:s.jsx(Fd,{clientThreadId:t})}):s.jsx("div",{children:s.jsx(R,{...$e.mayProduceInaccurateInformation})})}function Rd({clientThreadId:t}){const{country:e}=li(),n=e==="KR"?$e.mayProduceInaccurateInformationNoAuthKorea:$e.mayProduceInaccurateInformationNoAuthV2,{layer:a}=Ft("3637408529"),o=(a==null?void 0:a.get("should_show_disclaimer_only_once_per_device",!1))??!1;return m.useEffect(()=>()=>{to({clientThreadId:t,role:be.User})>0&&Lr.updateHasAcceptedFooterDisclaimer(o)},[t,o]),s.jsx("span",{className:"text-sm leading-none",children:s.jsx(R,{...n,values:{privacyLink:i=>s.jsx("a",{href:"https://openai.com/privacy",target:"_blank",className:"text-token-text-primary underline decoration-token-text-primary",onClick:()=>{qe.logEvent("chatgpt_footer_disclaimer_privacy_link_clicked"),te.logEvent(K.footerDisclaimerPrivacyLinkClicked)},rel:"noreferrer",children:i}),termsLink:i=>s.jsx("a",{href:"https://openai.com/terms",target:"_blank",className:"text-token-text-primary underline decoration-token-text-primary",onClick:()=>{qe.logEvent("chatgpt_footer_disclaimer_terms_link_clicked"),te.logEvent(K.footerDisclaimerTermsLinkClicked)},rel:"noreferrer",children:i}),koreaAddendumLink:i=>s.jsx("a",{href:"https://openai.com/ko/policies/kr-privacy-policy-addendum",target:"_blank",className:"text-token-text-primary underline decoration-token-text-primary",onClick:()=>{qe.logEvent("chatgpt_footer_disclaimer_korea_addendum_link_clicked"),te.logEvent(K.footerDisclaimerKoreaAddendumLinkClicked)},rel:"noreferrer",children:i})}})})}function Pd({clientThreadId:t}){const e=Ra(),n=qs(t),a=async()=>{n&&(await Me.patchConversation(n,{is_archived:!1}),e.invalidateQueries({queryKey:["conversation",t]}),Wn.setState(o=>{const i=o.threads[n];i!=null&&(i.initialThreadData.isArchived=!1)}),Rl(e))};return s.jsxs("div",{className:"my-6 flex flex-col items-center justify-center gap-4",children:[s.jsx("div",{className:"px-3 text-center text-sm text-token-text-secondary",children:s.jsx(R,{...$e.archivedConversationDescription})}),s.jsx("div",{children:s.jsx(nt,{disabled:!n,onClick:a,icon:Al,children:s.jsx(R,{...$e.unarchiveButton})})})]})}function Dd(t,e){const n=Yt(t),a=U.getTitle(t);return e&&e.kind===at.GizmoInteraction&&e.gizmo?n?`ChatGPT - ${e.gizmo.gizmo.display.name}`:a&&`${e.gizmo.gizmo.display.name} - ${a}`:n?"ChatGPT":a}const cu=function({clientThreadId:t,initiallyHighlightedMessageId:e,continueConversationUrl:n,onCompletionFinished:a,preRequestCompletion:o,hideHeader:i,hideMessages:l,hideFooter:c,hideToolsOverlay:d,messagesVerticalAlign:h="top",prependThreadChildren:p,renderEmptyState:f}){var ct;const v=Ra(),S=$o(),C=m.useContext(Aa),g=C!=null,x=Rt(),u=Us(),b=Fa(),w=Is(),y=$r(t),j=Ko(),D=g&&((ct=j.query)==null?void 0:ct.action)==="moderate",N=Qa(t),W=Vs(t),_=Za(t).isArchived;m.useEffect(()=>{N||(Yt(t)?As.addTiming("chatgpt.web.chatPage.renderNewConversation"):As.addTiming("chatgpt.web.chatPage.renderExistingConversation"))},[t,N]);const I=dl(t,W),q=eo(t,W),B=Ja(t),{setTargetedContent:se}=br(),F=u==null?void 0:u.includes(Qo),P=xr(),k=q>=2,X=Yt(t)&&!k&&gn(y),G=Yt(t)&&!I&&(gn(y)||(y==null?void 0:y.kind)===at.GizmoTest),Z=fi().id,ne=pi(t)??Z,{value:ze}=Ns("4203174056"),xe=bi(t,Yo.Search),Qe=qa(ne),Xe=Pa()[ne],je=Dd(t,y),Ae=$s(t),Ge=yr(),is=Kr(t),{config:Dt}=Xo("1013114931"),Qs=Dt.get("show_follow_ups",!1)&&(x==null?void 0:x.isPersonalAccount()),lt=!w.displayingSideBySideFeedback&&Qs,rs=bt();m.useEffect(()=>{ta()},[]),m.useEffect(()=>{Ge||se(void 0),U.getLastMessgageSystemHints(t,W).includes(Fs.Search)&&xe?sa.addPersistedSystemHint(Fs.Search):sa.clear()},[t,se,Ge,W,S.search,xe]);const ls=m.useCallback(L=>{if(L==null||(a==null||a(L),rs)||((Ae==null?void 0:Ae.kind)===at.GizmoInteraction&&xi.handleGizmoInteracted(v,Ae.gizmo_id),!(is||lt)))return;const ae=U.getThreadCurrentLeafId(L),me=U.getTree(L).getMessage(ae);Jo(me)||Zo(me)||vr(L,me.id,ne)},[v,a,Ae,is,lt,ne,rs]),Ys=ul(t),Lt=Qr(t,Ys,ls),Ot=m.useCallback(()=>{const L=U.getThreadCurrentLeafId(t);if(L==null)return;const ae=U.getTree(t).getBranchFromLeaf(L);Sr.abortRequests(ae.map(me=>me.id))},[t]),O=as(),{isUnauthenticated:Ue}=Pt(),cs=Cr(),He=m.useCallback(async({type:L,promptId:he,requestedModelId:ae,eventMetadata:me,cancelActiveRequests:Je,focusOnNewCompletion:wt=!0,useDefaultModel:dt,completionMetadata:We,appendMessages:on,updateTree:rn,turnTracker:ln,extraStreamParams:Wt})=>{ta(),wr.reset(),Je&&Ot();const cn=performance.now();let Vt=ne;ae?Vt=ae:dt&&(Vt=Z);const le=Mr({namespace:_r.CompletionRequest,key:he});le==null||le.logTiming("start_chat_requirements");const $=await ei();le==null||le.logTiming("fetched_chat_requirements"),$.force_login&&cs({authType:"login"});const ce=await ti.getEnforcementToken($);le==null||le.logTiming("fetched_arkose_token");const ut=await kr.getEnforcementToken($);le==null||le.logTiming("fetched_turnstile_token");const dn=await si.getEnforcementToken($);le==null||le.logTiming("fetched_p_token"),o==null||o(t,he),Lt({model:Vt,completionType:L,parentNodeId:he,metadata:me,focusOnNewCompletion:wt,completionMetadata:We,chatReq:$,arkoseToken:ce??null,turnstileToken:ut??null,proofToken:dn??null,preflightTime:performance.now()-cn,extraStreamParams:{forceParagen:O.forceParagen,forceParagenModel:O.forceParagenModel.value,forceNulligen:O.forceNulligen,forceRateLimit:O.forceRateLimit,resetRateLimits:O.resetRateLimits,disableSystemContentToggling:O.rebaseSystemMessageContent?!0:void 0,forceUseSearch:O.forceUseSearch??(Wt==null?void 0:Wt.forceUseSearch)},appendMessages:on,updateTree:rn,turnTracker:ln}),Ue&&Tr.incrementUserMessageCount()},[Z,ne,o,t,Lt,O.forceParagen,O.forceParagenModel,O.forceNulligen,O.forceRateLimit,O.resetRateLimits,O.rebaseSystemMessageContent,O.forceUseSearch,Ot,cs,Ue]),vt=!!(x!=null&&x.features.includes(Bs.SharedWebsocket));m.useEffect(()=>{vt&&fn.registerIfNotConnected()},[vt]),m.useEffect(()=>{const L=()=>{if(document.visibilityState==="visible"){if(!vt)return;fn.registerIfNotConnected()}};return document.addEventListener("visibilitychange",L),()=>{document.removeEventListener("visibilitychange",L)}},[vt]);const zt=qs(t);m.useEffect(()=>{const L=()=>{fn.stopConversation(zt)};return window.addEventListener("beforeunload",L),()=>{window.removeEventListener("beforeunload",L)}},[zt]);const ds=yi({clientThreadId:t,currentLeafId:W,handleRequestCompletion:He}),Xs=m.useCallback((L,he,ae,me=!0,Je="none",wt)=>{const We=U.getTree(t).getParentPromptNode(L).id;He({type:Ea.Variant,promptId:We,eventMetadata:he,cancelActiveRequests:!1,focusOnNewCompletion:me,useDefaultModel:wt,completionMetadata:{variantPurpose:Je,conversationMode:os.getConversationMode(t)},turnTracker:ae})},[He,t]),Js=m.useCallback(L=>{const ae=U.getTree(t).getLeafFromNode(L);U.setThreadCurrentLeafId(t,ae.id)},[t]),[ye,Ut]=m.useState(),Zs=m.useCallback(({nodeId:L,messageId:he,rating:ae})=>{var dt;const me=U.getServerThreadId(t);te.logEvent(K.thumbRating,{id:he,threadId:me,rating:ae,model:ne});const Je=U.getTree(t),wt=Je.getNodeByIdOrMessageId(L);if(me!==void 0&&(Qe?gt:Me.submitMessageFeedback)({message_id:he,conversation_id:me,rating:ae}),U.updateTree(t,We=>{We.updateNodeMetadata(L,{rating:ae})}),Qe){Ut(s.jsx(Nd,{citations:((dt=wt.message.metadata)==null?void 0:dt.citations)??[],rating:ae,conversationId:me??"",messageId:he,onSubmit:()=>{Ut(void 0)},onCancel:()=>Ut(void 0),conversationTree:Je,nodeId:L},`${L}-${ae}`));return}},[t,ne,Qe]),{setShowReferralInviteModal:us}=na(L=>({setShowReferralInviteModal:L.setShowReferralInviteModal})),hs=m.useCallback(()=>{us(!1)},[us]),ms=na(L=>L.showReferralInviteModal);wd({clientThreadId:t,currentModelId:ne});const Bt=L=>g?s.jsx("div",{className:"h-full overflow-auto bg-token-main-surface-primary",children:L}):s.jsx(Ul,{scrollAnchorTopOffset:i?0:Pr,children:h==="bottom"?s.jsxs("div",{className:"flex h-full flex-col",children:[s.jsx("div",{className:"flex-1"}),L]}):L});m.useEffect(()=>{document.title=je??"ChatGPT"},[je]);const en=rt(t),gs=bt(),fs=Yl(),St=G&&!f&&b&&!en&&!Qe&&!gs,Gt=St&&fs,Ht=Ql(St),ps=Xl(Gt),bs=St&&Ht||Gt&&ps,xs=Ht||ps,{composerBarSize:tn,composerSkeleton:ys,footerBarSize:sn,isClippedComposerBar:Be,setComposerBarElement:vs,setFooterBarElement:nn,ThreadSizeWrapper:Ct}=jr({isArchived:_}),an=Be?{footerBarSize:sn,composerBarSize:tn}:{};return s.jsxs(Ct,{...an,children:[F&&s.jsx(Td,{}),ze&&s.jsx(Ad,{}),s.jsxs(ni,{children:[je!=null&&s.jsx("title",{children:je}),g&&s.jsxs(s.Fragment,{children:[s.jsx("meta",{property:"og:site_name",content:"ChatGPT"}),s.jsx("meta",{name:"robots",content:C.isIndexable?"index,nofollow":"noindex,nofollow"},"robots"),s.jsx("meta",{property:"og:title",content:je??"Shared Chat on ChatGPT"},"og:title"),s.jsx("meta",{property:"og:description",content:"Shared "+(B!=null?`by ${B} `:"")+"via ChatGPT"},"og:description"),s.jsx("meta",{property:"og:image",content:ai.src},"og:image")]})]}),(y==null?void 0:y.kind)===at.GizmoInteraction&&y.gizmo&&s.jsx(Si,{gizmo:y.gizmo}),s.jsx(Na.Provider,{value:He,children:s.jsxs(Ar,{children:[s.jsxs(Yr,{clientThreadId:t,currentModelConfig:Xe,className:"composer-parent flex h-full flex-col focus-visible:outline-0",children:[!l&&s.jsx(Ld,{className:ee(Be&&"masked-content"),style:{"--composer-bar_skeleton":ys},children:!N&&!ds?G?f??s.jsx(Jn,{shouldSSR:!xs,children:s.jsx(bc,{clientThreadId:t,currentModelId:ne,onRequestCompletion:He,enableV2Homepage:bs})}):k?Bt(s.jsxs(s.Fragment,{children:[p,s.jsx(Sd,{onChangeItemInView:Js,onRequestMoreCompletions:Xs,onChangeRating:Zs,onRequestCompletion:He,clientThreadId:t,initiallyHighlightedMessageId:e,inlineEmbeddedDisplay:!1,conversationLeafId:W,hideHeader:i},t)]})):null:null}),s.jsx(Od,{className:ee(Be&&"mask-scrollbars absolute bottom-0 z-20"),children:_?s.jsx(Pd,{clientThreadId:t}):s.jsxs("div",{className:ee(Be&&"relative mx-auto flex max-w-3xl flex-1 flex-col"),children:[Be?s.jsx(Nr,{skeleton:ys}):null,g?s.jsx(cc,{clientThreadId:t,isModeratingThread:D,continueConversationUrl:n}):!bs&&s.jsx(Jn,{shouldSSR:!xs,children:s.jsx(Xr,{clientThreadId:t,isNewThread:X,setComposerBarElement:vs,showPromptStarters:X||!I,currentModelId:ne,onRequestCompletion:He})}),!c&&s.jsx("div",{ref:nn,className:"relative w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",children:g?s.jsx(Er,{onClickReportSharedConversation:()=>{Hs.openModal(Xt.ReportConversation)}}):gn(y)&&s.jsx("div",{className:"min-h-4",children:s.jsx(Ed,{clientThreadId:t})})})]})})]}),!d&&s.jsxs("div",{className:"group absolute bottom-2 end-2 z-20 hidden gap-1 md:flex lg:bottom-3 lg:end-3",children:[P?s.jsxs(s.Fragment,{children:[s.jsx(kd,{}),s.jsx(jd,{})]}):null,s.jsx(Nl,{})]}),ye,s.jsx(Ci,{serverThreadId:(C==null?void 0:C.serverSharedThreadId)??void 0,clientThreadId:t,isStaticSharedThread:g}),s.jsx(rc,{clientThreadId:t}),s.jsx(Ir,{}),(u==null?void 0:u.includes(oi))&&s.jsx(Fr,{isOpen:ms,onClose:hs}),s.jsx(Rr,{conversationId:t,currentModelId:ne})]})})]})},Ld=Ke.div`grow flex-1 overflow-hidden`,Od=Ke.div`md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent w-full`;export{Kl as C,cu as T,Sd as a,md as b,bd as m};
//# sourceMappingURL=lvk16mjiwstb1aqf.js.map
