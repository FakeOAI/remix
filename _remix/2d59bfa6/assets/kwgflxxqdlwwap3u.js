import{Y as g,x as r,a2 as E,N as _,r as w,a3 as i,a7 as y,W as b,av as N,O as j,M as m,D as p}from"./c3nnbeco67svv9me.js";import{aF as C,cQ as S,cR as v}from"./ddabru9k2rsup3m3.js";import{aJ as M}from"./zsi1dkkcij1sdsx2.js";import{c as T}from"./dxoslro1rvwd67ew.js";function k({jupyterMessage:e}){const a=T(),t=g();if(a)return r.jsxs("div",{className:"my-1 flex h-52 w-full max-w-xs flex-col items-center justify-center gap-2 rounded-md border-black/5 bg-gray-100 p-7 text-center text-token-text-tertiary dark:border-white/10",children:[r.jsx(M,{className:"icon-lg"}),r.jsx(E,{...d.imageNotSupported})]});if(e.image_payload!=null)return r.jsx("img",{className:"my-1",src:`data:image/png;base64,${e.image_payload}`,alt:t.formatMessage(d.altText)});if(e.image_url!=null){const s=C(e.image_url);return r.jsx(O,{fileId:s})}return null}const F=30*1e3,f=100,u=1.5,I=Math.log(1-F*(1-u)/f)/Math.log(u);function O({fileId:e}){const a=g(),{data:t,isLoading:s,refetch:l}=_({queryKey:["getFileDownloadLink",e],queryFn:()=>b.getFileDownloadLink(e),refetchInterval:o=>{const n=o.state.dataUpdateCount;return o.state.data?.status===i.Success||n>I||o.state.status===i.Error?!1:Math.pow(u,n)*f}});return w.useEffect(()=>{if(t?.status===i.Success){const n=new URL(t.download_url,location.toString()).searchParams.get("se");n!=null&&!s&&new Date>new Date(n)&&l()}},[t,s,l]),t?.status!==i.Success?null:r.jsx("img",{src:t.download_url,className:"my-1 max-h-full max-w-full",alt:a.formatMessage(d.altText)})}const d=y({imageNotSupported:{id:"CodeExecutionOutputImage.imageNotSupported",defaultMessage:"Image output is not supported in a shared chat"},altText:{id:"CodeExecutionOutputImage.altText",defaultMessage:"Output image"}});function H({FormattedText:e,message:a}){const{resolvedTheme:t}=N();return r.jsx(v.Provider,{value:{isWithinDataAnalysisToolMessage:!0},children:r.jsx(e,{className:j("markdown prose w-full break-words dark:prose-invert",t==="dark"?"dark":"light"),children:R(a)})})}function R(e){function a(t,s){return`\`\`\`${s}
${t}
\`\`\``}if(e.content.content_type==="code")return a(e.content.text,"python");if(e.recipient==="python"){if(e.content.content_type!=="text")throw new Error("Unexpected content type for code message");const t=e.content.parts;if(t.length!==1||typeof t[0]!="string")throw new Error("Unexpected parts for code message");return a(t[0],"python")}throw new Error("Unexpected code message format")}function X({message:e}){const a=g();if(e.content.content_type!==m.ExecutionOutput)return null;const t=e.metadata?.aggregate_result;if(!t)return p.addError("Corrupt code execution result message"),null;const s=t.messages.filter(U),l=s.length>0,o=t.final_expression_output!=null,n=t.in_kernel_exception!=null;return r.jsxs(r.Fragment,{children:[l&&r.jsx(x,{label:"STDOUT/STDERR",output:s.map((c,h)=>r.jsx("span",{className:c.stream_name==="stderr"?"text-red-500":"",children:c.text},`${h}`))}),o&&r.jsx(x,{label:a.formatMessage({id:"codeInterpreterMessage.resultLabel",defaultMessage:"Result"}),output:t.final_expression_output}),n&&r.jsx(D,{traceback:t.in_kernel_exception.traceback.join("")})]})}function x({label:e,output:a}){return r.jsxs("div",{className:"bg-gray-700 p-4 text-xs",children:[r.jsx("div",{className:"mb-1 text-gray-400",children:e}),r.jsx("div",{className:"prose flex flex-col-reverse text-white",children:r.jsx("pre",{className:"shrink-0",children:a})})]})}function D({traceback:e}){return r.jsx("div",{className:"overflow-auto border-t border-gray-500 text-white",children:r.jsx("div",{className:"border-l-4 border-red-500 p-2 text-xs",children:r.jsx("div",{className:"scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-700 flex max-h-64 flex-col-reverse",children:r.jsx("pre",{className:"shrink-0",children:e})})})})}function q({message:e}){if(e.content.content_type!==m.ExecutionOutput)return null;const a=e.metadata?.aggregate_result;return a?r.jsx(r.Fragment,{children:a.messages.filter(L).map((t,s)=>r.jsx(k,{jupyterMessage:t},s))}):(p.addError("Corrupt code execution result message"),null)}function U(e){return e.message_type==="stream"}function L(e){return e.message_type==="image"||"image_url"in e&&S(e.image_url+"")}export{q as C,H as a,X as b,k as c,R as g,L as i};
//# sourceMappingURL=kwgflxxqdlwwap3u.js.map
