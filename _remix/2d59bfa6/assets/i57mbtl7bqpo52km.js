import{Z as $,t as Q,a5 as X,S as f,r as m,P as y,b,x as a,a2 as k,aw as L,a7 as j,ah as E,eW as z,bd as Z,w as J,Y,c as ee,e as te,eg as se,bx as ne,eX as ae,eY as oe,W as ie}from"./c3nnbeco67svv9me.js";import{dq as S,W as C,eJ as ce,ae as re,eK as le,eL as de,eM as P,eN as ue}from"./ddabru9k2rsup3m3.js";import{L as I}from"./dgsuu1vhr5tghtn8.js";import{b as me}from"./kh7we7rj2rl9xdit.js";import{T as ge}from"./dxoslro1rvwd67ew.js";function ke(){return Q("437245079").value}function he(){const e=ke(),t=me(),s=$("1908072088").config.value,{eligible:n,isLoading:o}=S(C.AG8PqS2q);return{eligible:n&&e&&t&&s.blocking_modal===!0,singleButtonVariant:s.single_button_variant===!0,isLoading:o}}const G=C.UseSidekick,fe=C.SidekickLauncherOnboarding,N="https://persistent.oaistatic.com/sidekick/public/ChatGPT_Desktop_public_latest.dmg",R="download";function x(){const e=E(),t=z("1696863369").layer.get("has_sidekick_access",!1);return e!=null&&t}function ye(e){return e===R}function be(){const e=Z(),{hash:t}=J(),s=ye(t.slice(1));return{openModal:()=>{e({hash:R})},closeModal:()=>{e({hash:""})},isOpen:s}}function xe(e){const{eligible:t,isLoading:s}=he(),n=x(),{eligible:o,isLoading:r}=S(G),{eligible:u,isLoading:i}=S(fe),c=t||!o||!u||!n||e.conversationMode?.kind!==X.PrimaryAssistant,p=s||i||r;return{eligible:!c&&f.getLayerValue({layerName:"1696863369",key:"show_nux_banner",defaultValue:!1}),isLoading:p}}function Oe({onClose:e}){m.useEffect(()=>{y.logEvent(b.sidekickAnnouncementShown),f.logEvent("chatgpt_sidekick_announcement_shown")},[]);const{markAsViewed:t}=S(G),s=m.useCallback(()=>{t(),y.logEvent(b.sidekickAnnouncementDismissed),f.logEvent("chatgpt_sidekick_announcement_closed"),e&&e()},[t,e]),n=m.useCallback(()=>{y.logEvent(b.sidekickAnnouncementLinkClicked),f.logEvent("chatgpt_sidekick_announcement_download_clicked"),t(),e&&e()},[t,e]),o={downloadUrl:N,markAsDownloaded:n,markAsViewed:s,isSidekickAvailable:x()};return a.jsx(Se,{...o})}function pe(){window.open(N,"_blank")}function Me(){return E()?.isPlus()?d.bannerTitleMentioningPlus:d.bannerTitleNotMentioningPlus}function Le(){const{closeModal:e,isOpen:t}=be(),s=x(),n=m.useMemo(()=>({isDesktopAppAvailable:s}),[s]),o=()=>{y.logEvent(b.sidekickDownloadModalClosed,n),f.logEvent("chatgpt_sidekick_modal_closed"),e()},r=()=>{y.logEvent(b.sidekickDownloadModalDownloaded,n),f.logEvent("chatgpt_sidekick_modal_download_clicked"),e()};return m.useEffect(()=>{t&&(y.logEvent(b.sidekickDownloadModalShown,{...n}),f.logEvent("chatgpt_sidekick_modal_shown"))},[n,t]),t?a.jsx(ve,{downloadUrl:N,markAsDownloaded:r,markAsViewed:o,isSidekickAvailable:s}):null}function ve({downloadUrl:e,markAsDownloaded:t,markAsViewed:s,isSidekickAvailable:n}){const o=n?d.modalTitleEligible:d.modalTitleNotEligible,r=a.jsx(k,{...o}),u=a.jsx(k,{...d.modalContent}),i=n?d.disclaimer:d.comingSoonDisclaimer,c=a.jsx(k,{...i,values:{learnMoreLink:A=>a.jsx(I,{openNewTab:!0,href:"https://help.openai.com/en/articles/9275200",children:A})}}),p=a.jsxs("div",{children:[a.jsx("div",{children:u}),a.jsx("div",{className:"mt-2",children:c})]}),w=a.jsx(L,{as:"link",to:e,color:"primary",onClick:t,openNewTab:!0,children:a.jsx(k,{...d.download})}),v=a.jsx(L,{color:"secondary",onClick:s,children:a.jsx(k,{...d.close})}),_=n?w:v,T=n?v:void 0;return a.jsx(ce,{onClose:s,title:r,description:p,actionButton:_,cancelButton:T})}function Se({markAsDownloaded:e,markAsViewed:t}){const s=Y(),n=m.useCallback(()=>{pe(),e()},[e]),o=a.jsx(k,{...Me()}),r=a.jsx(k,{...d.bannerContent}),u=a.jsx(k,{...d.disclaimer,values:{learnMoreLink:c=>a.jsx(I,{openNewTab:!0,href:"https://help.openai.com/en/articles/9275200",children:c},"link")}}),i=a.jsxs("div",{className:"flex-grow",children:[a.jsx("div",{className:"mb-0.5 font-semibold",children:o}),a.jsxs("span",{className:"text-token-text-secondary",children:[r," ",u]})]});return a.jsx(re,{onPrimaryCtaClick:n,primaryCtaText:s.formatMessage(d.download),onDismiss:t,content:i})}const d=j({bannerTitleNotMentioningPlus:{id:"SidekickOnboarding.bannerTitleEnterprisey_2",defaultMessage:"ChatGPT is available for macOS 14+ with Apple Silicon"},bannerTitleMentioningPlus:{id:"SidekickOnboarding.bannerTitleMentioningPlus",defaultMessage:"ChatGPT is now available for macOSâ€”Plus users get early access"},modalTitleEligible:{id:"SidekickOnboarding.modalTitleEligible",defaultMessage:"The ChatGPT app is now available for macOS"},modalTitleNotEligible:{id:"SidekickOnboarding.modalTitleNotEligible",defaultMessage:"The ChatGPT macOS desktop app is coming soon"},modalContent:{id:"SidekickOnboarding.modal_content_eligible",defaultMessage:"Quickly access ChatGPT from anywhere on your computer with a shortcut: Option + Space. Share screenshots, upload files and photos, have voice conversations, and search through past conversations."},bannerContent:{id:"SidekickOnboarding.banner_content_3",defaultMessage:"Get faster access to ChatGPT with the Option + Space shortcut and the floating companion window."},disclaimer:{id:"SidekickOnboarding.disclaimer_3",defaultMessage:"<learnMoreLink>Learn more</learnMoreLink>."},comingSoonDisclaimer:{id:"SidekickOnboarding.coming_soon_disclaimer",defaultMessage:"The app will be available over the next couple of weeks."},download:{id:"SidekickOnboarding.download",defaultMessage:"Download"},close:{id:"SidekickOnboarding.close",defaultMessage:"Close"}}),O=ee(te(()=>({statusMap:{}}))),Pe=e=>O(t=>t.statusMap[e]),Be=(e,t)=>{O.setState(s=>{s.statusMap[e]=t;const n=ge.getServerThreadId(e);n&&(s.statusMap[n]=t)})},B=e=>{O.setState(t=>{for(const{id:s,async_status:n}of e)n!=null&&(t.statusMap[s]={source:se.SERVER,value:n})})},we=28,K="conversationHistory";function je(e={}){const{buckets:t,recentConversationLimit:s}=e,o=ne()?.includes(ae)??!1,r=E(),u=!o&&!!r?.data,i=Y(),{data:c,fetchNextPage:p,hasNextPage:w,isLoading:v,isFetchingNextPage:_,isError:T,refetch:A}=oe({queryKey:[K],queryFn:async({pageParam:l})=>{const g=await ie.getConversations({offset:l,limit:we});return B(g.items),g},initialPageParam:0,getNextPageParam:l=>{const g=l.offset+l.limit;return g<l.total?g:void 0},enabled:u}),h=m.useMemo(()=>c?.pages.flatMap(g=>g.items)??[],[c,e]);m.useEffect(()=>{B(h)},[h]);const U=m.useMemo(()=>{if(!c||!t)return[];const l=_e(h,i);return[l.recent,l.dynamicMonths,l.dynamicYears].flatMap(D=>Object.entries(D).map(([q,{items:H,label:V}],W)=>({key:`${q}-${W}`,label:V,items:H}))).filter(D=>D.items.length>0)},[h,c,i,t]),F=m.useMemo(()=>{const l=h.slice(0,s??5);return{key:"recents",label:i.formatMessage(M.historyBucketRecent),items:l}},[h,s,i]);return{buckets:U,conversations:h,data:c,fetchNextPage:p,hasNextPage:w,refetch:A,recents:F,isLoading:v,isFetchingNextPage:_,isError:T}}function _e(e,t){return e.reduce((s,n)=>{const o=new Date(n.update_time??n.create_time??0),r=le(new Date,o);if(r===0)s.recent.today.items.push(n);else if(r<=1)s.recent.yesterday.items.push(n);else if(r<=7)s.recent.lastSeven.items.push(n);else if(r<=30)s.recent.lastThirty.items.push(n);else if(de(o)){const u=P(o),i=ue(o),c=`${u}-${i}`;s.dynamicMonths[c]?s.dynamicMonths[c].items.push(n):s.dynamicMonths[c]={label:t.formatDate(o,{month:"long"}),items:[n]}}else{const i=`${P(o)}-`;s.dynamicYears[i]?s.dynamicYears[i].items.push(n):s.dynamicYears[i]={label:t.formatDate(o,{year:"numeric"}),items:[n]}}return s},{recent:{today:{label:t.formatMessage(M.historyBucketToday),items:[]},yesterday:{label:t.formatMessage(M.historyBucketYesterday),items:[]},lastSeven:{label:t.formatMessage(M.historyBucketLastSeven),items:[]},lastThirty:{label:t.formatMessage(M.historyBucketLastThirty),items:[]}},dynamicMonths:{},dynamicYears:{}})}function Ye(e){e.invalidateQueries({queryKey:[K]}),e.invalidateQueries({queryKey:["gizmoConversations"]})}const M=j({historyBucketRecent:{id:"history.bucket.recent",defaultMessage:"Recent"},historyBucketToday:{id:"history.bucket.today",defaultMessage:"Today"},historyBucketYesterday:{id:"history.bucket.yesterday",defaultMessage:"Yesterday"},historyBucketLastSeven:{id:"history.bucket.lastSeven",defaultMessage:"Previous 7 Days"},historyBucketLastThirty:{id:"history.bucket.lastThirty",defaultMessage:"Previous 30 Days"}});export{K as C,Le as D,je as a,Pe as b,x as c,be as d,xe as e,Oe as f,Ye as r,Be as s,he as u};
//# sourceMappingURL=i57mbtl7bqpo52km.js.map
