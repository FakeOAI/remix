import{r as a,H as Le,fi as D,en as $,g as HA,G as T,c2 as $A,m as n,ab as q,d3 as Xe,df as Ue,c9 as Ae,aY as ee,aD as dA,c5 as AA,aJ as Pe,D as qe,eQ as te,eR as ze,br as _e,u as Ke,cd as He,aI as $e,aR as At,hE as et}from"./lj034xtwgajnbw80.js";import{c as oe,ay as tt,a3 as ot,bI as nt,bJ as st,bK as at,bL as it,ad as rt,a9 as ct,a as NA,bM as lt,as as ut,bm as dt,G as mt,bN as ft,n as gt}from"./b6cy1eq07lpymojm.js";import{iY as ZA,bU as pt,iW as ne,bi as yA,cT as mA,aA as ht,iX as xt,cS as bt,k0 as vt,k1 as Ct,ay as L,jT as kt,k2 as Et,bu as St}from"./hwys1cva3r0syt2i.js";import{$ as Bt,C as It,_ as j,R as uA,f as O,M as Mt,m as OA,y as wt,W as eA,T as W,O as se,N as yt,S as iA,n as ae,o as BA,p as IA,q as Qt,Y as jt,F as Vt,x as Rt,b as fA,k as bA,r as vA,s as ie,l as re,a as E,t as ce,v as Dt,d as QA,e as jA,w as le,g as Tt,V as Y,X as YA,z as MA,A as Nt,E as Zt}from"./kz7qqaih92ncqym4.js";import{u as VA,a as Ot,V as Yt}from"./ic5vyrvop4o7cc62.js";import{M as ue}from"./t81xw4wuhgoq3a5i.js";import{m as w}from"./kg90shbkih4fj2ta.js";import{W as Ft}from"./ngnyriku8zz57qvh.js";import{u as Gt,s as Wt,U as Jt,a as Lt,b as Xt,c as Ut,T as Pt,n as qt,V as zt,d as _t}from"./pcf75jirhvky2693.js";import"./nhbh4xua4q3jx6sv.js";import"./e8o7cmoe8883kidw.js";import"./gctbfwgizwb8pujm.js";import"./c6m8w1xte1oeqdcv.js";import"./ooe3ps1ztatrxg1t.js";import"./g3uk1jzd5hyq3p0c.js";import"./en8vrjnuftwsyj53.js";import"./k0nl7u80h92yh4js.js";import"./bv1zj3kixgbxzevo.js";import"./c4bxzbp1808foto4.js";function de(A){var e,t,o="";if(typeof A=="string"||typeof A=="number")o+=A;else if(typeof A=="object")if(Array.isArray(A)){var s=A.length;for(e=0;e<s;e++)A[e]&&(t=de(A[e]))&&(o&&(o+=" "),o+=t)}else for(t in A)A[t]&&(o&&(o+=" "),o+=t);return o}function Kt(){for(var A,e,t=0,o="",s=arguments.length;t<s;t++)(A=arguments[t])&&(e=de(A))&&(o&&(o+=" "),o+=e);return o}function Ht(...A){return(...e)=>{for(const t of A)if(typeof t=="function")try{t(...e)}catch(o){console.error(o)}}}function me(...A){const e={...A[0]};for(let t=1;t<A.length;t++){const o=A[t];for(const s in o){const i=e[s],c=o[s];typeof i=="function"&&typeof c=="function"&&s[0]==="o"&&s[1]==="n"&&s.charCodeAt(2)>=65&&s.charCodeAt(2)<=90?e[s]=Ht(i,c):(s==="className"||s==="UNSAFE_className")&&typeof i=="string"&&typeof c=="string"?e[s]=Kt(i,c):e[s]=c!==void 0?c:i}}return e}const $t={connect:!0,audio:!1,video:!1};function Ao(A){const{token:e,serverUrl:t,options:o,room:s,connectOptions:i,connect:c,audio:r,video:l,screen:u,onConnected:m,onDisconnected:d,onError:f,onMediaDeviceFailure:b,onEncryptionError:g,simulateParticipants:p,...h}={...$t,...A};o&&s&&j.warn("when using a manually created room, the options object will be ignored. set the desired options directly when creating the room instead.");const[x,y]=a.useState();a.useEffect(()=>{y(s??new uA(o))},[s]);const B=a.useMemo(()=>{const{className:S}=wt();return me(h,{className:S})},[h]);return a.useEffect(()=>{if(!x)return;const S=()=>{const k=x.localParticipant;j.debug("trying to publish local tracks"),Promise.all([k.setMicrophoneEnabled(!!r,typeof r!="boolean"?r:void 0),k.setCameraEnabled(!!l,typeof l!="boolean"?l:void 0),k.setScreenShareEnabled(!!u,typeof u!="boolean"?u:void 0)]).catch(M=>{j.warn(M),f?.(M)})},I=k=>{const M=Mt.getFailure(k);b?.(M)},C=k=>{g?.(k)};return x.on(O.SignalConnected,S).on(O.MediaDevicesError,I).on(O.EncryptionError,C),()=>{x.off(O.SignalConnected,S).off(O.MediaDevicesError,I).off(O.EncryptionError,C)}},[x,r,l,u,f,g,b]),a.useEffect(()=>{if(x){if(p){x.simulateParticipants({participants:{count:p},publish:{audio:!0,useRealTracks:!0}});return}if(!e){j.debug("no token yet");return}if(!t){j.warn("no livekit url provided"),f?.(Error("no livekit url provided"));return}c?(j.debug("connecting"),x.connect(t,e,i).catch(S=>{j.warn(S),f?.(S)})):(j.debug("disconnecting because connect is false"),x.disconnect())}},[c,e,JSON.stringify(i),x,f,t,p]),a.useEffect(()=>{if(!x)return;const S=I=>{switch(I){case OA.Disconnected:d&&d();break;case OA.Connected:m&&m();break}};return x.on(O.ConnectionStateChanged,S),()=>{x.off(O.ConnectionStateChanged,S)}},[e,m,d,x]),a.useEffect(()=>{if(x)return()=>{j.info("disconnecting on onmount"),x.disconnect()}},[x]),{room:x,htmlProps:B}}const eo=a.forwardRef(function(A,e){const{room:t,htmlProps:o}=Ao(A);return a.createElement("div",{ref:e,...o},t&&a.createElement(Bt.Provider,{value:t},a.createElement(It.Provider,{value:A.featureFlags},A.children)))});function to(A){return A!==void 0}function oo(...A){return me(...A.filter(to))}function fe(A,e={}){const[t,o]=a.useState(Qt(A)),[s,i]=a.useState(t?.isMuted),[c,r]=a.useState(t?.isSubscribed),[l,u]=a.useState(t?.track),[m,d]=a.useState("landscape"),f=a.useRef(),{className:b,trackObserver:g}=a.useMemo(()=>jt(A),[A.participant.sid??A.participant.identity,A.source,Vt(A)&&A.publication.trackSid]);return a.useEffect(()=>{const p=g.subscribe(h=>{j.debug("update track",h),o(h),i(h?.isMuted),r(h?.isSubscribed),u(h?.track)});return()=>p?.unsubscribe()},[g]),a.useEffect(()=>{var p,h;return l&&(f.current&&l.detach(f.current),(p=e.element)!=null&&p.current&&!(se(A.participant)&&l?.kind==="audio")&&l.attach(e.element.current)),f.current=(h=e.element)==null?void 0:h.current,()=>{f.current&&l?.detach(f.current)}},[l,e.element]),a.useEffect(()=>{var p,h;if(typeof((p=t?.dimensions)==null?void 0:p.width)=="number"&&typeof((h=t?.dimensions)==null?void 0:h.height)=="number"){const x=t.dimensions.width>t.dimensions.height?"landscape":"portrait";d(x)}},[t]),{publication:t,isMuted:s,isSubscribed:c,track:l,elementProps:oo(e.props,{className:b,"data-lk-local-participant":A.participant.isLocal,"data-lk-source":t?.source,...t?.kind==="video"&&{"data-lk-orientation":m}})}}var no="Expected a function",FA=NaN,so="[object Symbol]",ao=/^\s+|\s+$/g,io=/^[-+]0x[0-9a-f]+$/i,ro=/^0b[01]+$/i,co=/^0o[0-7]+$/i,lo=parseInt,uo=typeof iA=="object"&&iA&&iA.Object===Object&&iA,mo=typeof self=="object"&&self&&self.Object===Object&&self,fo=uo||mo||Function("return this")(),go=Object.prototype,po=go.toString,ho=Math.max,xo=Math.min,CA=function(){return fo.Date.now()};function bo(A,e,t){var o,s,i,c,r,l,u=0,m=!1,d=!1,f=!0;if(typeof A!="function")throw new TypeError(no);e=GA(e)||0,wA(t)&&(m=!!t.leading,d="maxWait"in t,i=d?ho(GA(t.maxWait)||0,e):i,f="trailing"in t?!!t.trailing:f);function b(C){var k=o,M=s;return o=s=void 0,u=C,c=A.apply(M,k),c}function g(C){return u=C,r=setTimeout(x,e),m?b(C):c}function p(C){var k=C-l,M=C-u,Q=e-k;return d?xo(Q,i-M):Q}function h(C){var k=C-l,M=C-u;return l===void 0||k>=e||k<0||d&&M>=i}function x(){var C=CA();if(h(C))return y(C);r=setTimeout(x,p(C))}function y(C){return r=void 0,f&&o?b(C):(o=s=void 0,c)}function B(){r!==void 0&&clearTimeout(r),u=0,o=l=s=r=void 0}function S(){return r===void 0?c:y(CA())}function I(){var C=CA(),k=h(C);if(o=arguments,s=this,l=C,k){if(r===void 0)return g(l);if(d)return r=setTimeout(x,e),b(l)}return r===void 0&&(r=setTimeout(x,e)),c}return I.cancel=B,I.flush=S,I}function wA(A){var e=typeof A;return!!A&&(e=="object"||e=="function")}function vo(A){return!!A&&typeof A=="object"}function Co(A){return typeof A=="symbol"||vo(A)&&po.call(A)==so}function GA(A){if(typeof A=="number")return A;if(Co(A))return FA;if(wA(A)){var e=typeof A.valueOf=="function"?A.valueOf():A;A=wA(e)?e+"":e}if(typeof A!="string")return A===0?A:+A;A=A.replace(ao,"");var t=ro.test(A);return t||co.test(A)?lo(A.slice(2),t?2:8):io.test(A)?FA:+A}var ko=bo;const WA=Rt(ko);function Eo(A){const e=a.useRef(A);e.current=A,a.useEffect(()=>()=>{e.current()},[])}function So(A,e=500,t){const o=a.useRef();Eo(()=>{o.current&&o.current.cancel()});const s=a.useMemo(()=>{const i=WA(A,e,t),c=(...r)=>i(...r);return c.cancel=()=>{i.cancel()},c.isPending=()=>!!o.current,c.flush=()=>i.flush(),c},[A,e,t]);return a.useEffect(()=>{o.current=WA(A,e,t)},[A,e,t]),s}function Bo(A,e,t){const o=(u,m)=>u===m,s=A instanceof Function?A():A,[i,c]=a.useState(s),r=a.useRef(s),l=So(c,e,t);return o(r.current,s)||(l(s),r.current=s),[i,l]}function Io({threshold:A=0,root:e=null,rootMargin:t="0%",freezeOnceVisible:o=!1,initialIsIntersecting:s=!1,onChange:i}={}){var c;const[r,l]=a.useState(null),[u,m]=a.useState(()=>({isIntersecting:s,entry:void 0})),d=a.useRef();d.current=i;const f=((c=u.entry)==null?void 0:c.isIntersecting)&&o;a.useEffect(()=>{if(!r||!("IntersectionObserver"in window)||f)return;let p;const h=new IntersectionObserver(x=>{const y=Array.isArray(h.thresholds)?h.thresholds:[h.thresholds];x.forEach(B=>{const S=B.isIntersecting&&y.some(I=>B.intersectionRatio>=I);m({isIntersecting:S,entry:B}),d.current&&d.current(S,B),S&&o&&p&&(p(),p=void 0)})},{threshold:A,root:e,rootMargin:t});return h.observe(r),()=>{h.disconnect()}},[r,JSON.stringify(A),e,t,f,o]);const b=a.useRef(null);a.useEffect(()=>{var p;!r&&(p=u.entry)!=null&&p.target&&!o&&!f&&b.current!==u.entry.target&&(b.current=u.entry.target,m({isIntersecting:s,entry:void 0}))},[r,u.entry,o,f,s]);const g=[l,!!u.isIntersecting,u.entry];return g.ref=g[0],g.isIntersecting=g[1],g.entry=g[2],g}const ge=a.forwardRef(function({onTrackClick:A,onClick:e,onSubscriptionStatusChanged:t,trackRef:o,manageSubscription:s,...i},c){const r=ae(o),l=a.useRef(null);a.useImperativeHandle(c,()=>l.current);const u=Io({root:l.current}),[m]=Bo(u,3e3);a.useEffect(()=>{s&&r.publication instanceof BA&&m?.isIntersecting===!1&&u?.isIntersecting===!1&&r.publication.setSubscribed(!1)},[m,r,s]),a.useEffect(()=>{s&&r.publication instanceof BA&&u?.isIntersecting===!0&&r.publication.setSubscribed(!0)},[u,r,s]);const{elementProps:d,publication:f,isSubscribed:b}=fe(r,{element:l,props:i});a.useEffect(()=>{t?.(!!b)},[b,t]);const g=p=>{e?.(p),A?.({participant:r?.participant,track:f})};return a.createElement("video",{ref:l,...d,muted:!0,onClick:g})}),Mo=a.forwardRef(function({trackRef:A,onSubscriptionStatusChanged:e,volume:t,muted:o,...s},i){const c=ae(A),r=a.useRef(null);a.useImperativeHandle(i,()=>r.current);const{elementProps:l,isSubscribed:u,track:m,publication:d}=fe(c,{element:r,props:s});return a.useEffect(()=>{e?.(!!u)},[u,e]),a.useEffect(()=>{m===void 0||t===void 0||(m instanceof IA?m.setVolume(t):j.warn("Volume can only be set on remote audio tracks."))},[t,m]),a.useEffect(()=>{d===void 0||o===void 0||(d instanceof BA?d.setEnabled(!o):j.warn("Can only call setEnabled on remote track publications."))},[o,d,m]),a.createElement("audio",{ref:r,...l})});function wo({volume:A,muted:e}){const t=eA([W.Source.Microphone,W.Source.ScreenShareAudio,W.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0}).filter(o=>!se(o.participant)&&o.publication.kind===W.Kind.Audio);return a.createElement("div",{style:{display:"none"}},t.map(o=>a.createElement(Mo,{key:yt(o),trackRef:o,volume:A,muted:e})))}const pe=()=>{const A=Le(),e=a.useCallback(()=>fA.getState().isVoiceModeActive,[]);return a.useMemo(()=>new Proxy(A,{get(t,o){const s=t[o];return e()||o==="closeAll"?s:()=>{}}}),[e,A])};function yo(){const A=pe(),e=a.useCallback(()=>{bA.debug("disconnected from room"),vA()},[]),t=a.useCallback(s=>{A.danger("Something went wrong"),bA.error("an error occurred within the room",s);const i=ZA(fA.getState());D.voiceMode.error({...i,error:s.message}),vA()},[A]),o=a.useCallback(s=>{A.danger("Something went wrong"),bA.error("an encryption error occurred within the room",s);const i=ZA(fA.getState());D.voiceMode.error({encryptionError:s.message,eventSource:"voice-session",...i}),vA()},[A]);return{onDisconnected:e,onError:t,onEncryptionError:o}}function he({conversationId:A}){const{shouldDelayDisconnect:e,delayDisconnect:t,immediateDisconnect:o}=VA({refetchLater:!0}),{toggleMute:s}=ie(),i=$(A);return a.useCallback(async()=>{D.voiceSessionEndedByUser.click(),pt.setState({voiceFeedbackThread:i,lastVoiceSessionEndTime:new Date}),e?(await s(),t()):o()},[t,o,i,e,s])}var Qo={webm:"data:video/webm;base64,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",mp4:"data:video/mp4;base64,AAAAHGZ0eXBNNFYgAAACAGlzb21pc28yYXZjMQAAAAhmcmVlAAAGF21kYXTeBAAAbGliZmFhYyAxLjI4AABCAJMgBDIARwAAArEGBf//rdxF6b3m2Ui3lizYINkj7u94MjY0IC0gY29yZSAxNDIgcjIgOTU2YzhkOCAtIEguMjY0L01QRUctNCBBVkMgY29kZWMgLSBDb3B5bGVmdCAyMDAzLTIwMTQgLSBodHRwOi8vd3d3LnZpZGVvbGFuLm9yZy94MjY0Lmh0bWwgLSBvcHRpb25zOiBjYWJhYz0wIHJlZj0zIGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDE6MHgxMTEgbWU9aGV4IHN1Ym1lPTcgcHN5PTEgcHN5X3JkPTEuMDA6MC4wMCBtaXhlZF9yZWY9MSBtZV9yYW5nZT0xNiBjaHJvbWFfbWU9MSB0cmVsbGlzPTEgOHg4ZGN0PTAgY3FtPTAgZGVhZHpvbmU9MjEsMTEgZmFzdF9wc2tpcD0xIGNocm9tYV9xcF9vZmZzZXQ9LTIgdGhyZWFkcz02IGxvb2thaGVhZF90aHJlYWRzPTEgc2xpY2VkX3RocmVhZHM9MCBucj0wIGRlY2ltYXRlPTEgaW50ZXJsYWNlZD0wIGJsdXJheV9jb21wYXQ9MCBjb25zdHJhaW5lZF9pbnRyYT0wIGJmcmFtZXM9MCB3ZWlnaHRwPTAga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCB2YnZfbWF4cmF0ZT03NjggdmJ2X2J1ZnNpemU9MzAwMCBjcmZfbWF4PTAuMCBuYWxfaHJkPW5vbmUgZmlsbGVyPTAgaXBfcmF0aW89MS40MCBhcT0xOjEuMDAAgAAAAFZliIQL8mKAAKvMnJycnJycnJycnXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXiEASZACGQAjgCEASZACGQAjgAAAAAdBmjgX4GSAIQBJkAIZACOAAAAAB0GaVAX4GSAhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGagC/AySEASZACGQAjgAAAAAZBmqAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZrAL8DJIQBJkAIZACOAAAAABkGa4C/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmwAvwMkhAEmQAhkAI4AAAAAGQZsgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGbQC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm2AvwMkhAEmQAhkAI4AAAAAGQZuAL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGboC/AySEASZACGQAjgAAAAAZBm8AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZvgL8DJIQBJkAIZACOAAAAABkGaAC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmiAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpAL8DJIQBJkAIZACOAAAAABkGaYC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmoAvwMkhAEmQAhkAI4AAAAAGQZqgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGawC/AySEASZACGQAjgAAAAAZBmuAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZsAL8DJIQBJkAIZACOAAAAABkGbIC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm0AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZtgL8DJIQBJkAIZACOAAAAABkGbgCvAySEASZACGQAjgCEASZACGQAjgAAAAAZBm6AnwMkhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AAAAhubW9vdgAAAGxtdmhkAAAAAAAAAAAAAAAAAAAD6AAABDcAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAzB0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAABAAAAAAAAA+kAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAALAAAACQAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAPpAAAAAAABAAAAAAKobWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAB1MAAAdU5VxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRlb0hhbmRsZXIAAAACU21pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAhNzdGJsAAAAr3N0c2QAAAAAAAAAAQAAAJ9hdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAALAAkABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAALWF2Y0MBQsAN/+EAFWdCwA3ZAsTsBEAAAPpAADqYA8UKkgEABWjLg8sgAAAAHHV1aWRraEDyXyRPxbo5pRvPAyPzAAAAAAAAABhzdHRzAAAAAAAAAAEAAAAeAAAD6QAAABRzdHNzAAAAAAAAAAEAAAABAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAAIxzdHN6AAAAAAAAAAAAAAAeAAADDwAAAAsAAAALAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAAiHN0Y28AAAAAAAAAHgAAAEYAAANnAAADewAAA5gAAAO0AAADxwAAA+MAAAP2AAAEEgAABCUAAARBAAAEXQAABHAAAASMAAAEnwAABLsAAATOAAAE6gAABQYAAAUZAAAFNQAABUgAAAVkAAAFdwAABZMAAAWmAAAFwgAABd4AAAXxAAAGDQAABGh0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAABDcAAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAQkAAADcAABAAAAAAPgbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAC7gAAAykBVxAAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAADi21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAADT3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAAC7gAAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVBbjYAAu4AAAADcoFgICAAhGQBoCAgAECAAAAIHN0dHMAAAAAAAAAAgAAADIAAAQAAAAAAQAAAkAAAAFUc3RzYwAAAAAAAAAbAAAAAQAAAAEAAAABAAAAAgAAAAIAAAABAAAAAwAAAAEAAAABAAAABAAAAAIAAAABAAAABgAAAAEAAAABAAAABwAAAAIAAAABAAAACAAAAAEAAAABAAAACQAAAAIAAAABAAAACgAAAAEAAAABAAAACwAAAAIAAAABAAAADQAAAAEAAAABAAAADgAAAAIAAAABAAAADwAAAAEAAAABAAAAEAAAAAIAAAABAAAAEQAAAAEAAAABAAAAEgAAAAIAAAABAAAAFAAAAAEAAAABAAAAFQAAAAIAAAABAAAAFgAAAAEAAAABAAAAFwAAAAIAAAABAAAAGAAAAAEAAAABAAAAGQAAAAIAAAABAAAAGgAAAAEAAAABAAAAGwAAAAIAAAABAAAAHQAAAAEAAAABAAAAHgAAAAIAAAABAAAAHwAAAAQAAAABAAAA4HN0c3oAAAAAAAAAAAAAADMAAAAaAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAACMc3RjbwAAAAAAAAAfAAAALAAAA1UAAANyAAADhgAAA6IAAAO+AAAD0QAAA+0AAAQAAAAEHAAABC8AAARLAAAEZwAABHoAAASWAAAEqQAABMUAAATYAAAE9AAABRAAAAUjAAAFPwAABVIAAAVuAAAFgQAABZ0AAAWwAAAFzAAABegAAAX7AAAGFwAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTUuMzMuMTAw"};const{webm:jo,mp4:Vo}=Qo,kA=()=>typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,EA=()=>"wakeLock"in navigator;class Ro{constructor(){if(this.enabled=!1,EA()){this._wakeLock=null;const e=()=>{this._wakeLock!==null&&document.visibilityState==="visible"&&this.enable()};document.addEventListener("visibilitychange",e),document.addEventListener("fullscreenchange",e)}else kA()?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("title","No Sleep"),this.noSleepVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.noSleepVideo,"webm",jo),this._addSourceToVideo(this.noSleepVideo,"mp4",Vo),this.noSleepVideo.addEventListener("loadedmetadata",()=>{this.noSleepVideo.duration<=1?this.noSleepVideo.setAttribute("loop",""):this.noSleepVideo.addEventListener("timeupdate",()=>{this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())})}))}_addSourceToVideo(e,t,o){var s=document.createElement("source");s.src=o,s.type=`video/${t}`,e.appendChild(s)}get isEnabled(){return this.enabled}enable(){return EA()?navigator.wakeLock.request("screen").then(e=>{this._wakeLock=e,this.enabled=!0,console.log("Wake Lock active."),this._wakeLock.addEventListener("release",()=>{console.log("Wake Lock released.")})}).catch(e=>{throw this.enabled=!1,console.error(`${e.name}, ${e.message}`),e}):kA()?(this.disable(),console.warn(`
        NoSleep enabled for older iOS devices. This can interrupt
        active or long-running network requests from completing successfully.
        See https://github.com/richtr/NoSleep.js/issues/15 for more details.
      `),this.noSleepTimer=window.setInterval(()=>{document.hidden||(window.location.href=window.location.href.split("#")[0],window.setTimeout(window.stop,0))},15e3),this.enabled=!0,Promise.resolve()):this.noSleepVideo.play().then(t=>(this.enabled=!0,t)).catch(t=>{throw this.enabled=!1,t})}disable(){EA()?(this._wakeLock&&this._wakeLock.release(),this._wakeLock=null):kA()?this.noSleepTimer&&(console.warn(`
          NoSleep now disabled for older iOS devices.
        `),window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause(),this.enabled=!1}}var Do=Ro;const To=HA(Do);function No(A){const e=A.default_voice_mode,t=A.modes.find(o=>o.mode===e);if(!t)throw new Error("Voice status returned a default_voice_mode that does not exist in the modes array");return t.default_model_slug}function RA(){const A=T(),e=pe(),{startVoiceMode:t,stopVoiceMode:o,isConnected:s,isVoiceModeActive:i}=re(),c=a.useCallback(async r=>{const l={conversation_id:r.serverThreadId,parent_message_id:r.parentMessageId,model_slug:r.modelSlug,model_slug_advanced:r.isAdvancedMode?r.modelSlug:void 0,voice_mode:r.isAdvancedMode?"advanced":"standard",eventSource:r.eventSource,clientThreadId:r.clientThreadId,gizmo_id:r.gizmoId,voice:r.voice},u=A.formatMessage({id:"useVoiceModeButtonAction.error",defaultMessage:"Failed to start voice mode"});try{await t(l)}catch{if(r.isAdvancedMode&&r.retryWithStandard)try{await t({...l,voice_mode:"standard"})}catch{e.danger(u),D.voiceMode.error({error:u})}else e.danger(u),D.voiceMode.error({error:u})}},[A,t,e]);return{isVoiceModeActive:i,isConnected:s,toggleVoiceMode:c,stopVoiceMode:o}}const xe="inline-flex items-center bg-transparent text-token-text-secondary hover:text-token-text-primary",Zo=({message:A,onClick:e,type:t})=>{const o=T(),s=ne()&&$A;if(!A)return null;switch(t){case"microphone_denied":return s?n.jsxs("a",{href:"ms-settings:privacy-microphone",className:xe,children:[A,n.jsx(oe,{className:"icon-sm ml-1"})]}):n.jsx(JA,{onClick:e,message:A});case"connection_quality":return n.jsxs("div",{className:"inline-flex items-center",children:[A,n.jsx("button",{onClick:e,className:"ml-1",children:n.jsx("strong",{children:o.formatMessage(be.retry)})})]});case"normal":return n.jsx(JA,{onClick:e,message:A})}},JA=({message:A,onClick:e})=>{const t=T();return n.jsxs("button",{onClick:e,className:xe,"aria-label":t.formatMessage(be.openInfoModal),children:[A,n.jsx(oe,{className:"icon-sm ml-1"})]})},be={openInfoModal:{id:"hintMessage.openInfoModal",defaultMessage:"Open info modal",description:"Open info modal about voice mode usage"},retry:{id:"hintMessage.retry",defaultMessage:"Retry",description:"Retry text next to lost connection message"}};function Oo(A){const{button:e,conversationId:t,modelId:o,onClick:s}=A,i=$(t),c=yA(t),r=e.action==="new_chat"?c:o,{toggleVoiceMode:l}=RA(),u=a.useCallback(()=>{switch(e.action){case"new_chat":{const m=r??mA;ht(`/?model=${m}`),l({serverThreadId:void 0,modelSlug:m,isAdvancedMode:!0,eventSource:`modal_${e.action}`,parentMessageId:void 0,retryWithStandard:!1,clientThreadId:Xe(),gizmoId:void 0});break}case"switch_to_standard":i&&o&&l({serverThreadId:i,modelSlug:r??mA,isAdvancedMode:!1,eventSource:`modal_${e.action}`,parentMessageId:void 0,retryWithStandard:!1,clientThreadId:i,gizmoId:q.getGizmoId(t)});break;case"ok":break;default:return}s?.()},[e.action,t,r,o,s,i,l]);return n.jsx(Ue.Button,{onClick:u,title:e.title,color:A.color})}function ve({buttons:A,conversationId:e,modelId:t,onClick:o}){let s,i;return!A||A.length===0?{primary:void 0,secondary:void 0}:(A.forEach(c=>{const r=c.action==="new_chat",l=c.action==="switch_to_standard",u=r&&e,m=l&&e&&t,d=n.jsx(Oo,{button:c,conversationId:e,modelId:t,onClick:o,color:c.style});(u||m||c.action==="ok")&&(s?i||(i=d):s=d)}),{primary:s,secondary:i})}function Yo({conversationId:A,modelId:e,isOpen:t,onClose:o,buttons:s,title:i,description_markdown:c}){const r=ve({buttons:s,conversationId:A,modelId:e,onClick:o}),l=n.jsx(ue,{className:"markdown",urlTransform:u=>u,children:c});return n.jsx(Ae,{title:i,isOpen:t,onClose:o,size:"custom",className:"max-w-[550px]",type:"warning",showCloseButton:!0,children:n.jsxs("div",{className:"w-full",children:[n.jsx("p",{className:"mb-6 text-token-text-secondary",children:l}),n.jsx("div",{className:"flex justify-end",children:r.primary})]})})}function Fo({conversationId:A,currentModelId:e}){const t=T(),o=he({conversationId:A}),s=E(v=>v.server.usage),i=E(v=>v.server.voiceConnectionQuality),c=v=>v===le.Lost,r=E(v=>v.server.connectionState),l=ce(),[u,m]=a.useState(!1),d=E(v=>v.server.toolUpdate),[f,b]=a.useState(!1),[g,p]=a.useState(!0),[h,x]=a.useState(null),[y,B]=a.useState(null),[S,I]=a.useState(null),[C,k]=a.useState(!1),[M,Q]=a.useState(!1),oA=a.useRef(!1),X=$(A),{stopVoiceMode:z,toggleVoiceMode:G,isVoiceModeActive:N}=RA(),_=Dt();a.useEffect(()=>{M||_().then(v=>{k(v)}).finally(()=>{Q(!0)})},[_,M]);const nA=E(v=>v.dev.room?.localParticipant.isMicrophoneEnabled);a.useEffect(()=>{N&&(C&&!nA)&&(Q(!1),k(!1))},[N,nA,C]);const pA=ne()&&$A,R=N&&M&&!C,V=N&&C&&!r&&l;a.useEffect(()=>{R&&(m(!1),I(null),x(t.formatMessage(SA.hint)),B({title:t.formatMessage(SA.title),description_markdown:t.formatMessage(SA.description_markdown),buttons:[]}))},[t,pA,R]),a.useEffect(()=>{if(V&&!oA.current){oA.current=!0,x(null),B(null);const v=No(l),U=q.getCurrentNode(A)?.id,aA={serverThreadId:X,modelSlug:v,parentMessageId:U,isAdvancedMode:l.default_voice_mode==="advanced",retryWithStandard:!0,eventSource:"composer_speech_button",clientThreadId:A,gizmoId:q.getGizmoId(A)};D.voiceSessionStarted.click(),G(aA)}},[A,V,l,X,G]);const{reaching_limit_disclosure:K,exceed_limit_message:Z}=s?.rate_limit_message??{},sA=l?.modes.find(v=>v.mode===l?.default_voice_mode),hA=sA?.disclosure_message,xA=c(i)?"Lost connection.":K?.hint??Z?.title??hA?.hint??null;a.useEffect(()=>{sA&&!R&&x(sA.disclosure_message?.hint??null)},[sA,R]),a.useEffect(()=>{const v=d?.text;let U,aA,TA;return v&&(p(!1),U=setTimeout(()=>{b(!0),aA=setTimeout(()=>{b(!1),TA=setTimeout(()=>{p(!0),fA.setState(Je=>{Je.server.toolUpdate=null})},750)},3e3)},750)),()=>{clearTimeout(U),clearTimeout(aA),clearTimeout(TA)}},[d]),a.useEffect(()=>{if(!R){if(xA&&x(xA),Z&&N){z();const v={title:Z.title,description_markdown:Z.description_markdown,buttons:Z.buttons};u?I(v):(B(v),m(!0)),D.rateLimitReached.success()}else if(!y){const v=K??hA;v&&B({title:v.title,description_markdown:v.message_markdown,buttons:v.buttons})}}},[hA,Z,xA,u,N,y,K,z,R]);const Ne=a.useCallback(()=>{S&&(B(S),I(null)),m(!0)},[S]),Ze=a.useCallback(()=>{m(!1)},[]),{startVoiceMode:Oe}=re(),Ye=yA(A),Fe=E(v=>v.voiceMode),{voiceName:Ge}=xt(),We=async()=>{try{x(null),await Oe({conversation_id:X,model_slug:Ye??mA,eventSource:"lost_connection_hint_message",voice_mode:Fe,voice:Ge,clientThreadId:A,gizmo_id:q.getGizmoId(A)})}catch(v){const U=v instanceof Error?v.message:String(v);D.voiceMode.error({error:U,eventSource:"lost_connection_hint_message"})}};let H;return R?H="microphone_denied":c(i)?H="connection_quality":H="normal",n.jsxs("div",{className:"flex w-full flex-col items-center",children:[n.jsxs("div",{className:"relative mb-6 flex min-h-5 w-full items-center justify-center text-xs text-token-text-secondary",children:[d?.text&&n.jsx(w.div,{initial:{opacity:0},animate:{opacity:f?1:0},transition:{duration:.5},style:{position:"absolute",left:"50%",transform:"translateX(-50%)",textAlign:"center"},children:n.jsxs("div",{className:"flex items-center",children:[d?.text&&n.jsx(tt,{className:"icon-sm mr-1"}),d?.text]})}),n.jsx(w.div,{initial:{opacity:0},animate:{opacity:g?1:0},transition:{duration:.5},style:{position:"absolute",left:"50%",transform:"translateX(-50%)",textAlign:"center",pointerEvents:d?.text?"none":"auto",cursor:d?.text?"default":"pointer"},children:n.jsx("div",{className:"flex items-center",children:n.jsx(Zo,{type:H,message:h,onClick:H==="connection_quality"?We:Ne})})})]}),n.jsxs("div",{className:dA("flex flex-row items-center gap-6","rounded-full px-3 py-1","transition-width duration-200 ease-in-out"),children:[n.jsx(LA,{capability:"video",children:n.jsx(Go,{})}),n.jsx(Jo,{shouldQueryDevices:!!V,hideTooltip:R}),n.jsx(LA,{capability:"screenshare",children:n.jsx(Lo,{})}),n.jsx(DA,{onClick:o})]}),n.jsx(Yo,{conversationId:A,modelId:e,isOpen:u,onClose:Ze,title:y?.title,description_markdown:y?.description_markdown,buttons:y?.buttons??[]})]})}function LA({children:A,capability:e}){const t=Ot();return!t.av||!t[e]?null:n.jsx(n.Fragment,{children:A})}function Go(){const{isVideoEnabled:A,isStartingVideo:e,toggleVideo:t}=QA();let o=null;e?o=AA:o=nt;const s=A?"bg-gray-900 hover:bg-gray-800 active:bg-gray-700":"bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10",i=A?"text-token-main-surface-primary":"text-token-main-surface-primary-inverse";return n.jsx(tA,{onClick:()=>t("ControlButton"),disabled:e,icon:o,className:s,iconColor:i})}const Wo=async()=>{try{return(await Tt("audioinput"))?.label??""}catch(A){return console.warn("Error fetching default media device:",A),qe.addError("Failed to fetch default media device",{error:A}),"Error accessing microphone devices"}};function Jo({shouldQueryDevices:A,hideTooltip:e}){const{isMicrophoneEnabled:t,isMuting:o,toggleMute:s}=ie(),i=T(),{disconnectPending:c}=VA(),[r,l]=a.useState(""),u=t?st:at,m=t?"bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10":"bg-red-500/10 hover:bg-red-500/15 active:bg-red-500/20 dark:bg-red-500/10 dark:hover:bg-red-500/15 dark:active:bg-red-500/20",d=t?"text-token-main-surface-primary-inverse":"text-danger";a.useEffect(()=>{A&&Wo().then(b=>l(b))},[A]);const f=t?i.formatMessage({id:"PJzixV",defaultMessage:"Turn off microphone"}):i.formatMessage({id:"nbbUMb",defaultMessage:"Turn on microphone"});return n.jsx(tA,{"aria-label":f,onClick:s,icon:u,disabled:o||c,className:m,iconColor:d,tooltipPrimaryLabel:!e&&r?f:"",tooltipSecondaryLabel:r})}function Lo(){const{isScreenshareEnabled:A,isScreenshareStarting:e,toggleScreenShare:t}=jA();let o=null;e?o=AA:o=it;const s=A?"bg-gray-900 hover:bg-gray-800 active:bg-gray-700":"bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10",i=A?"text-token-main-surface-primary":"text-token-main-surface-primary-inverse";return n.jsx(tA,{onClick:()=>t("ControlButton"),disabled:e,icon:o,className:s,iconColor:i})}function DA({className:A,onClick:e}){const t=T(),{disconnectPending:o}=VA(),s="bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10",i=t.formatMessage({id:"9Mto0a",defaultMessage:"End"});return n.jsx(tA,{disabled:o,onClick:e,icon:o?AA:ot,iconColor:"text-token-main-surface-primary-inverse",className:A??s,"aria-label":t.formatMessage({id:"7/8k4Y",defaultMessage:"End voice mode"}),tooltipPrimaryLabel:i})}function tA(A){const{icon:e,disabled:t,className:o,iconColor:s="text-current",iconSize:i="icon-xl",buttonSize:c="h-16 w-16",tooltipPrimaryLabel:r,tooltipSecondaryLabel:l,...u}=A,[m,d]=a.useState(!1),f=a.useRef(void 0),b=a.useCallback(()=>{const h=window.setTimeout(()=>{d(!0)},bt);f.current=h},[]),g=a.useCallback(()=>{clearTimeout(f.current),d(!1)},[]),p=n.jsx(Xo,{className:dA(o,c,"overflow-hidden rounded-full border-none p-0.5 text-token-text-primary transition-colors duration-200 ease-in-out hover:text-token-text-secondary"),disabled:t,...u,children:n.jsx(e,{className:dA(i,s)})});return r?n.jsx(Pe,{sideOffset:14,label:r,secondaryLabel:l,contentClassName:"flex flex-col items-center justify-center",className:"flex",open:m,side:"top",children:n.jsx("span",{onPointerEnter:b,onPointerLeave:g,children:p})}):p}const Xo=w(ee),SA={hint:{id:"micMessages.hint",defaultMessage:"Enable microphone access in Settings",description:"Hint to the user to manually enable microphone access for voice mode"},title:{id:"micMessages.title",defaultMessage:"Microphone access required",description:"Title for modal that informs the user that microphone access is required for voice mode"},description_markdown:{id:"micMessages.description_markdown",defaultMessage:"To use voice mode, you'll need to enable your microphone and try again.",description:"Description for modal that informs the user that microphone access is required for voice mode"}};function Uo(A,e,t,o){var s=-1,i=A==null?0:A.length;for(o&&i&&(t=A[++s]);++s<i;)t=e(t,A[s],s,A);return t}var Po=Uo;function qo(A){return function(e){return A?.[e]}}var zo=qo,_o=zo,Ko={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},Ho=_o(Ko),$o=Ho,An=$o,en=te,tn=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,on="\\u0300-\\u036f",nn="\\ufe20-\\ufe2f",sn="\\u20d0-\\u20ff",an=on+nn+sn,rn="["+an+"]",cn=RegExp(rn,"g");function ln(A){return A=en(A),A&&A.replace(tn,An).replace(cn,"")}var un=ln,dn=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function mn(A){return A.match(dn)||[]}var fn=mn,gn=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function pn(A){return gn.test(A)}var hn=pn,Ce="\\ud800-\\udfff",xn="\\u0300-\\u036f",bn="\\ufe20-\\ufe2f",vn="\\u20d0-\\u20ff",Cn=xn+bn+vn,ke="\\u2700-\\u27bf",Ee="a-z\\xdf-\\xf6\\xf8-\\xff",kn="\\xac\\xb1\\xd7\\xf7",En="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Sn="\\u2000-\\u206f",Bn=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Se="A-Z\\xc0-\\xd6\\xd8-\\xde",In="\\ufe0e\\ufe0f",Be=kn+En+Sn+Bn,Ie="['’]",XA="["+Be+"]",Mn="["+Cn+"]",Me="\\d+",wn="["+ke+"]",we="["+Ee+"]",ye="[^"+Ce+Be+Me+ke+Ee+Se+"]",yn="\\ud83c[\\udffb-\\udfff]",Qn="(?:"+Mn+"|"+yn+")",jn="[^"+Ce+"]",Qe="(?:\\ud83c[\\udde6-\\uddff]){2}",je="[\\ud800-\\udbff][\\udc00-\\udfff]",P="["+Se+"]",Vn="\\u200d",UA="(?:"+we+"|"+ye+")",Rn="(?:"+P+"|"+ye+")",PA="(?:"+Ie+"(?:d|ll|m|re|s|t|ve))?",qA="(?:"+Ie+"(?:D|LL|M|RE|S|T|VE))?",Ve=Qn+"?",Re="["+In+"]?",Dn="(?:"+Vn+"(?:"+[jn,Qe,je].join("|")+")"+Re+Ve+")*",Tn="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Nn="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Zn=Re+Ve+Dn,On="(?:"+[wn,Qe,je].join("|")+")"+Zn,Yn=RegExp([P+"?"+we+"+"+PA+"(?="+[XA,P,"$"].join("|")+")",Rn+"+"+qA+"(?="+[XA,P+UA,"$"].join("|")+")",P+"?"+UA+"+"+PA,P+"+"+qA,Nn,Tn,Me,On].join("|"),"g");function Fn(A){return A.match(Yn)||[]}var Gn=Fn,Wn=fn,Jn=hn,Ln=te,Xn=Gn;function Un(A,e,t){return A=Ln(A),e=t?void 0:e,e===void 0?Jn(A)?Xn(A):Wn(A):A.match(e)||[]}var Pn=Un,qn=Po,zn=un,_n=Pn,Kn="['’]",Hn=RegExp(Kn,"g");function $n(A){return function(e){return qn(_n(zn(e).replace(Hn,"")),A,"")}}var As=$n,es=As,ts=vt,os=es(function(A,e,t){return A+(t?" ":"")+ts(e)}),ns=os;const ss=HA(ns);function as({conversationId:A}){const e=Ke("1426009137")?.value,t=$(A),o=yA(A),s=q.getCurrentNode(A)?.id,i=ce();return!e||!o?null:n.jsx(J,{conversationId:t??A,parentMessageId:s,status:i})}function J(A){const e=A?.status?.modes,[t,o]=a.useState(!1),[s,i]=a.useState(),c=a.useCallback(u=>{i(u),o(!0)},[]),r=T(),l=a.useCallback(()=>o(!1),[]);return n.jsxs(n.Fragment,{children:[n.jsx(ze,{contentAlign:"center",triggerButton:n.jsx(J.Trigger,{}),children:e?e.map(u=>{const m=u.default_model_slug;return a.createElement(J.Item,{...A,modelSlug:m,key:u.mode,voiceStatusMode:u,onShowModal:c})}):n.jsx("div",{role:"progressbar","aria-valuetext":r.formatMessage({defaultMessage:"Loading voice modes",id:"voiceModeButton.loadingModes"}),"aria-busy":"true","aria-live":"assertive","aria-valuemin":0,"aria-valuemax":100,children:n.jsx(AA,{"aria-hidden":"true",className:"my-4 min-w-full"})})}),n.jsx(J.Modal,{conversationId:A.conversationId,disabledModeMetadata:s,isOpen:t,onClose:l})]})}J.Modal=function(e){const t=e.disabledModeMetadata?.buttons??[],o=ve({buttons:t,conversationId:e.conversationId,modelId:mA,onClick:e.onClose}),s=n.jsx(ue,{children:e.disabledModeMetadata?.description_markdown});return n.jsx(Ae,{title:e.disabledModeMetadata?.title,description:s,isOpen:e.isOpen,onClose:e.onClose,type:"success",primaryButton:o.primary,secondaryButton:o.secondary})};J.Trigger=a.forwardRef(function(e,t){const o=E(s=>s.voiceMode);return n.jsxs(Ct,{ref:t,...e,children:[ss(o)??n.jsx(AA,{}),n.jsx(rt,{className:"icon-md text-token-text-tertiary"})]})});J.Item=function({conversationId:e,modelSlug:t,parentMessageId:o,voiceStatusMode:s,onShowModal:i}){const{disabled_mode_metadata:c,mode:r}=s,{toggleVoiceMode:l}=RA(),u=$(e),m=a.useCallback(async()=>{c?i(c.disabled_message):l({serverThreadId:u,modelSlug:t,parentMessageId:o,isAdvancedMode:r==="advanced"&&!c,eventSource:"voice_mode_picker",retryWithStandard:!1,clientThreadId:e,gizmoId:q.getGizmoId(e)})},[e,c,r,t,i,o,u,l]);return n.jsx(_e.Item,{onClick:m,children:n.jsxs("div",{children:[s.display_name,n.jsx("div",{className:"text-xs text-token-text-tertiary",children:s.description})]})})};function is({conversationId:A}){const e=E(o=>o.server.messages),t=E(o=>o.voiceSessionId);return n.jsx(w.div,{className:"hidden h-full max-w-[400px] overflow-y-auto border-l border-l-token-sidebar-surface-secondary bg-token-main-surface-secondary pt-16 shadow-inner md:block",initial:{opacity:0,x:420,width:"0px"},animate:{opacity:1,x:0,width:"400px"},exit:{opacity:0,x:420,width:"0px"},transition:{type:"tween"},children:n.jsxs(L,{children:[n.jsx(as,{conversationId:A}),n.jsxs("div",{className:"p-4 py-2 text-lg font-semibold",children:["Voice Session ID: ",t]}),e.length?n.jsxs(w.div,{className:"flex h-full w-full flex-col",initial:{opacity:0,x:-100},animate:{opacity:1,x:0},exit:{opacity:0,x:-100},children:[n.jsxs("div",{children:[n.jsx("h3",{className:"p-4 py-2 text-lg font-semibold text-token-text-secondary",children:"Room Stats"}),n.jsx(rs,{})]}),n.jsx("h3",{className:"p-4 py-2 text-lg font-semibold text-token-text-secondary",children:"Messages"}),n.jsx("div",{className:"grow overflow-hidden",children:n.jsx(Ft,{children:n.jsx(w.ul,{className:"pointer-events-none flex w-full flex-col gap-4 pb-24 pt-4",initial:"initial",animate:"animate",exit:"exit",variants:De,transition:{delayChildren:.25,staggerChildren:.05},children:e.map((o,s)=>n.jsx(ds,{index:s,message:o},s))})})})]}):null]})})}function rs(){const A=E(o=>o.dev.room);if(!A)return null;const e=A.numParticipants,t=A.activeSpeakers;return n.jsx("div",{className:"px-4 pb-8",children:n.jsxs("div",{className:"flex flex-col flex-nowrap gap-2",children:[n.jsx(cs,{}),n.jsx(gA,{text:"Attendees"}),n.jsx(F,{name:"Participants",text:e}),n.jsx(F,{name:"Speakers",text:t.length}),n.jsx(ls,{})]})})}function cs(){const A=E(i=>i.server.connectionState),e=E(i=>i.dev.room),[t,o]=a.useState("Unknown"),s=e?.localParticipant;return a.useEffect(()=>{if(s){const i=c=>{o(c)};return s.on("connectionQualityChanged",i),()=>{s.off("connectionQualityChanged",i)}}},[s]),n.jsxs(n.Fragment,{children:[n.jsx(gA,{text:"Connection"}),n.jsx(F,{name:"Quality",text:String(t)}),n.jsx(F,{name:"State",text:String(A)})]})}function ls(){const A=E(m=>m.dev.room),[e,t]=a.useState(null),[o,s]=a.useState(null),[i,c]=a.useState(null),r=A?.getActiveDevice("audioinput"),l=A?.getActiveDevice("audiooutput"),u=A?.getActiveDevice("videoinput");return a.useEffect(()=>{async function m(){const d=await uA.getLocalDevices("audioinput"),f=await uA.getLocalDevices("audiooutput"),b=await uA.getLocalDevices("videoinput"),g=d.find(x=>x.deviceId===r),p=f.find(x=>x.deviceId===l),h=b.find(x=>x.deviceId===u);t(g?.label??"Unknown"),s(p?.label??"Unknown"),c(h?.label??null)}m()},[r,l,u]),n.jsxs(n.Fragment,{children:[n.jsx(gA,{text:"Devices"}),i?n.jsx(F,{icon:ct,name:"Video Input",text:i}):null,n.jsx(F,{icon:NA,name:"Audio Input",text:e??"Unknown"}),n.jsx(F,{icon:lt,name:"Audio Output",text:o??"Unknown"}),n.jsx(gA,{text:"Monitors"}),n.jsx(F,{name:"Mic level",icon:NA,text:"unknown",content:n.jsx(us,{})})]})}function us(){const A=E(e=>e.dev.room?.localParticipant.audioLevel);return n.jsx("div",{className:"flex flex-row flex-nowrap items-center gap-1",children:n.jsx("div",{className:"flex flex-row flex-nowrap items-center gap-1",children:Array.from({length:10}).map((e,t)=>n.jsx("div",{className:`h-2 w-2 rounded-full ${(A??0)>t*.1?"bg-gray-500":"bg-token-main-surface-tertiary"}`},t))})})}function gA({text:A}){return n.jsx("h4",{className:"text-md font-semibold",children:A})}function F(A){return n.jsxs("div",{className:"flex flex-row flex-nowrap items-center gap-2",children:[n.jsx("span",{className:"opacity-85",children:A.icon?n.jsx(A.icon,{className:"h-[0.75rem] w-[0.75rem]"}):`${A.name}:`}),A.content??n.jsx("span",{className:"line-clamp-1 rounded-lg bg-token-main-surface-tertiary p-0.5 px-1 font-mono text-xs",children:A.text})]})}function ds({index:A,message:e}){const[t,o]=a.useState(!1),s=T();let i=null;switch(e.source){case"remote":i=mt;break;case"local":i=dt;break}return n.jsx(w.div,{className:"w-full border-t border-token-main-surface-tertiary p-4",variants:De,children:n.jsxs("div",{className:"flex w-full flex-col gap-2 rounded-lg bg-token-main-surface-secondary",children:[n.jsxs("div",{className:"font-mono text-[0.65rem] font-semibold text-token-text-secondary",children:[n.jsxs("div",{className:"flex w-full flex-row flex-nowrap items-center justify-between",children:[n.jsxs("div",{className:"flex flex-row flex-nowrap items-center gap-1",children:[n.jsx(i,{className:"h-3 w-3 text-token-text-secondary"}),n.jsx("span",{children:` | ${A+1} | ${s.formatDate(e.timestamp,{hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:2})}`})]}),n.jsx("div",{className:"flex flex-row flex-nowrap items-center gap-2",children:n.jsx(ee,{className:"rounded-full p-0.5",color:"ghost",size:"small",onClick:()=>o(c=>!c),children:n.jsx(ut,{className:`transform transition-transform ${t?"rotate-180":""}`})})})]}),n.jsx("div",{className:"mt-1 text-xs font-bold",children:e.type})]}),n.jsx(L,{children:t?n.jsx(w.pre,{initial:{opacity:0,transform:"blur(4px)"},animate:{opacity:1,transform:"blur(0px)"},exit:{opacity:0,transform:"blur(4px)"},className:"overflow-x-auto rounded-md bg-token-main-surface-tertiary p-2 text-xs text-token-text-secondary",children:JSON.stringify(e.payload,null,2)}):null})]})})}const De={hidden:{opacity:0,x:100},animate:{opacity:1,x:0},exit:{opacity:0,x:100}};function ms({children:A}){const{isVideoEnabled:e}=QA(),{isScreenshareEnabled:t}=jA(),o=e||t;return n.jsx(L,{mode:"wait",children:o?n.jsx("div",{className:"flex h-full w-full flex-nowrap items-center",children:e?n.jsx(fs,{}):n.jsx(gs,{})}):n.jsx(w.div,{className:"flex h-full w-full items-center justify-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:A},"children")})}function fs(){const{isVideoEnabled:A,isStartingVideo:e,toggleVideo:t}=QA(),s=eA([W.Source.Camera]).find(c=>c.participant.isLocal),i=A&&!e&&s;return a.useEffect(()=>{const c=s?.publication?.track;if(c){const r=()=>{t("Browser Video Controls")};return c.on("ended",r),()=>{c.off("ended",r)}}},[s,t]),n.jsx(L,{children:i&&n.jsx(Te,{children:n.jsxs("div",{className:"aspect-w-16 aspect-h-9 group relative max-h-[95%] w-fit max-w-[60%] overflow-hidden rounded-3xl shadow-md",children:[n.jsx("div",{className:"absolute right-2 top-2 z-10 opacity-0 transition-opacity group-hover:opacity-90",children:n.jsx(DA,{onClick:()=>t("StopButton"),className:"bg-gray-900 bg-opacity-20 backdrop-blur-lg hover:bg-opacity-30 dark:bg-gray-900 dark:bg-opacity-20 dark:backdrop-blur-lg dark:hover:bg-opacity-30"})}),n.jsx(ge,{className:"h-full w-full object-contain",trackRef:s})]})},"camera-renderer")})}function gs(){const{isScreenshareEnabled:A,isScreenshareStarting:e,toggleScreenShare:t}=jA(),s=eA([W.Source.ScreenShare]).find(c=>c.participant.isLocal),i=A&&!e&&s;return a.useEffect(()=>{const c=s?.publication?.track;if(c){const r=()=>{t("Browser ScreenShare Controls")};return c.on("ended",r),()=>{c.off("ended",r)}}},[s,t]),n.jsx(L,{children:i&&n.jsx(Te,{children:n.jsxs("div",{className:"aspect-w-16 aspect-h-9 group relative max-h-[95%] w-fit max-w-[60%] overflow-hidden rounded-3xl shadow-md",children:[n.jsx("div",{className:"absolute right-2 top-2 z-10 opacity-0 transition-opacity group-hover:opacity-90",children:n.jsx(DA,{onClick:()=>t("StopButton"),className:"bg-gray-900 bg-opacity-20 backdrop-blur-lg hover:bg-opacity-30 dark:bg-gray-900 dark:bg-opacity-20 dark:backdrop-blur-lg dark:hover:bg-opacity-30"})}),n.jsx(ge,{className:"h-full w-full object-contain",trackRef:s})]})},"screenshare-renderer")})}function Te({children:A,key:e}){return n.jsx(w.div,{className:"flex h-full w-full flex-col items-center justify-center gap-2 bg-token-main-surface-primary",initial:{opacity:0,transform:"blur(12px)",scale:.75},animate:{opacity:1,transform:"blur(0px)",scale:1},exit:{opacity:0,transform:"blur(12px)",scale:.75},transition:{duration:.2},children:A},e)}const rA=(A,e)=>{const[t,o]=a.useState(A===e?performance.now():0),s=a.useRef(e);a.useEffect(()=>{s.current!==e&&A===e&&o(performance.now()),s.current=e},[e,A]);const i=a.useCallback(()=>{o(0)},[]);return[A===e?1:0,t,i]},cA=([A,e,t],o=500)=>{const[s,i]=a.useState(A),c=a.useRef(A),r=a.useRef(void 0),l=a.useCallback((u,m,d)=>{const f=b=>{const g=Math.min((b-u)/o,1),p=m+g*(d-m);i(p),g<1&&(r.current=requestAnimationFrame(f))};r.current=requestAnimationFrame(f)},[o]);return a.useEffect(()=>{if(c.current!==A){c.current=A,r.current&&cancelAnimationFrame(r.current);const u=s,m=A;l(performance.now(),u,m)}},[l,s,A]),[s,e/1e3,t]},zA=A=>{const[e,t]=a.useState({audioData:[0,0,0,0],cumulativeAudioData:[0,0,0,0]}),o=a.useRef([0,0,0,0]),s=a.useRef(void 0),i=a.useRef(performance.now()),{bandMagnitudes:c,cumulativeMagnitude:r}=Gt(A,{bands:3,bins:1,gainMultipliers:[10,1,1]});o.current=[...c,r].flat();const l=a.useCallback(()=>{const u=performance.now(),m=(u-i.current)/1e3;i.current=u;const d=o.current,{audioData:f,cumulativeAudioData:b}=e,g=Wt({deltaTimeS:m,audioDataRaw:d,prevAudioData:f,prevCumulativeAudioData:b});t(g)},[e]);return a.useEffect(()=>(s.current||(s.current=window.setInterval(l,Jt)),()=>{clearInterval(s.current),s.current=void 0}),[l]),e};function _A({className:A}){return n.jsx(Es,{className:A})}const ps=1.55,hs=1.4,xs="voice-wav",bs="shout",vs="User",Cs={bands:4,loPass:0,hiPass:400},KA=[300,300];function ks(){const{resolvedTheme:A}=He(),e=A==="dark",t=E(g=>g.voiceMode==="advanced"),o=eA([W.Source.Microphone]),s=o.find(g=>g.publication.trackName===xs),i=o.find(g=>g.publication.trackName===bs);let c=YA(i?.publication.audioTrack,Cs);c.length===0&&(c=[0,0,0,0]),c.map(g=>g*hs);let r=zA(i?.publication.audioTrack),l=zA(s?.publication.audioTrack);const u=r.audioData.map((g,p)=>{const h=l.audioData[p];return g>0&&h>0?(g+h)/2:g>0?g:h}),m=r.cumulativeAudioData.map((g,p)=>{const h=l.cumulativeAudioData[p];return g>0&&h>0?(g+h)/2:g>0?g:h}),d=E(g=>g.server.remoteState),f=o.find(g=>g.participant.identity===vs),b=(YA(f,{bands:1,loPass:0,hiPass:400})[0]??0)*ps;return{remoteState:d,userVolume:b,isAdvanced:t,avgMag:u,cumulativeAudio:m,isDarkMode:e,standardBloopVolumes:c}}function Es({className:A}){const{remoteState:e,userVolume:t,isAdvanced:o,avgMag:s,cumulativeAudio:i,isDarkMode:c,standardBloopVolumes:r}=ks(),[l,u]=a.useState(KA),{canvasSizeRef:m,handleCanvasSizeUpdate:d}=kt(KA),f=a.useCallback(V=>{u([V.width,V.height])},[]),b=a.useRef([0,0,0,0]);a.useEffect(()=>{e===Y.Connecting&&(b.current=[0,0,0,0])},[e]);const g=a.useRef(performance.now());a.useEffect(()=>{const V=performance.now();e===Y.Speaking&&V-g.current>50&&(g.current=V,b.current=b.current.map((K,Z)=>K+s[Z]))},[e,s]);const[p,h]=cA(rA(Y.Listening,e)),[x,y]=cA(rA(Y.Speaking,e)),[B,S]=cA(rA(Y.Thinking,e)),[I,C]=cA(rA(Y.Halted,e)),[k,M]=a.useState(performance.now()/1e3);a.useEffect(()=>{const V=setInterval(()=>{M(performance.now()/1e3)},50);return()=>clearInterval(V)},[]);const Q=a.useMemo(()=>performance.now()/1e3,[]),[oA,X]=a.useState(1e5),z=a.useRef(e);a.useEffect(()=>{e===Y.Connecting?X(1e5):z.current===Y.Connecting&&X(k),z.current=e},[e,k]);const G=Lt(o),N=o?s:r,_=p===1||x===1,nA=Xt({viewport:l,canvasSize:m.current,shouldMeasurePerf:_,source:"VoiceMode"}),pA=Ut({shouldCalibrate:_,viewport:l,initialScale:1}),R={time:k-Q,micLevel:t,stateListen:p,listenTimestamp:Math.max(h-Q,0),stateThink:B,thinkTimestamp:Math.max(S-Q,0),stateSpeak:x,speakTimestamp:Math.max(y-Q,0),readyTimestamp:oA-Q,stateHalt:I,haltTimestamp:Math.max(C-Q,0),touchDownTimestamp:0,touchUpTimestamp:0,stateFailedToConnect:0,failedToConnectTimestamp:0,avgMag:N,cumulativeAudio:i??b.current,isNewBloop:!0,isAdvancedBloop:o,bloopColorMain:Array.from(G.bloopColorMain),bloopColorLow:Array.from(G.bloopColorLow),bloopColorMid:Array.from(G.bloopColorMid),bloopColorHigh:Array.from(G.bloopColorHigh),isDarkMode:c,screenScaleFactor:window.devicePixelRatio,viewport:l,silenceAmount:0,silenceTimestamp:0,fadeBloopWhileListening:!1};return n.jsx(Pt,{className:dA("flex items-center justify-center",A),variables:R,onViewportUpdate:f,textureImage:qt,textureName:"uTextureNoise",onGlAvailable:nA,onCanvasSizeUpdate:d,scale:pA})}const Ss=({conversationId:A})=>{const e=eA(),[t,o]=a.useState(!1),[s,i]=a.useState(!1),c=a.useCallback(()=>{e&&e.length>0&&e.forEach(m=>{const{publication:d}=m;d.audioTrack instanceof MA?(i(d.audioTrack.isMuted),d.audioTrack.mute()):d.audioTrack instanceof IA&&d.audioTrack.setMuted(!0)})},[e]),r=a.useCallback(()=>{e&&e.length>0&&e.forEach(m=>{const{publication:d}=m;d.audioTrack instanceof MA?s||d.audioTrack.unmute():d.audioTrack instanceof IA&&d.audioTrack.setMuted(!1)})},[e,s]),l=()=>{D.voiceSelectionShown.click(),c(),o(!0)},u=()=>{r(),o(!1)};return n.jsxs(n.Fragment,{children:[n.jsx(tA,{onClick:l,icon:ft,iconColor:"text-token-text-secondary",className:"h-[40px] w-[40px] bg-transparent hover:bg-black/10 active:bg-black/20 dark:bg-transparent dark:hover:bg-white/5 dark:active:bg-white/10",iconSize:"icon-md"}),t&&n.jsx(zt,{conversationId:A,onClose:u})]})};class Bs extends Worker{constructor(e,t){const o=String(e);super(o.includes("://")&&!o.startsWith(location.origin)?URL.createObjectURL(new Blob([`import("${o}")`],{type:"text/javascript"})):e,t)}}function Is(A={}){const[e,t]=a.useState(!1),[o,s]=a.useState(!1),[i,c]=a.useState(!1);let r=Nt().microphoneTrack;const[l,u]=a.useState();A.trackRef&&(r=A.trackRef.publication);const m=a.useCallback(async d=>{if(d){const{KrispNoiseFilter:f,isKrispNoiseFilterSupported:b}=await $e(async()=>{const{KrispNoiseFilter:g,isKrispNoiseFilterSupported:p}=await import("./cdeb6wdntgjfxjgj.js");return{KrispNoiseFilter:g,isKrispNoiseFilterSupported:p}},[]);if(!b()){console.warn("Krisp noise filter is not supported in this browser");return}l||u(f(A.filterOptions))}t(f=>(f!==d&&s(!0),d))},[]);return a.useEffect(()=>{var d;if(r&&r.track instanceof MA&&l){const f=r.track.getProcessor();f&&f.name==="livekit-noise-filter"?(s(!0),f.setEnabled(e).finally(()=>{s(!1),c(e)})):!f&&e&&(s(!0),(d=r?.track)==null||d.setProcessor(l).then(()=>l.setEnabled(e)).then(()=>{c(!0)}).catch(b=>{c(!1),console.error(b)}).finally(()=>{s(!1)}))}},[e,r,l]),{setNoiseFilterEnabled:m,isNoiseFilterEnabled:i,isNoiseFilterPending:o,processor:l}}const Ms=a.memo(function(){const e=At("989226566").value,{setNoiseFilterEnabled:t}=Is();return a.useEffect(()=>{t(e)},[e,t]),null}),ws=new Bs(new URL("https://cdn.oaistatic.com/assets/livekit-client.e2ee.worker-DK0iMXIf.js",import.meta.url),{type:"module"}),ys=a.memo(function({children:e}){const t=a.useRef({keyProvider:new Zt}).current,[o,s]=a.useState(!1),{token:i,url:c,e2eeKey:r}=E(d=>d.credentials),l=yo(),u=E(d=>d.isVoiceModeActive),m=E(d=>d.audioInputDevice?.deviceId);return a.useEffect(()=>{const d=i&&c&&r;!o&&d?t.keyProvider.setKey(r).then(()=>{s(!0)}):o&&!d&&s(!1)},[i,c,r,o,t]),u?n.jsxs(eo,{...l,connect:!0,token:i??void 0,serverUrl:c??void 0,audio:{deviceId:{ideal:m,exact:m},noiseSuppression:!0,echoCancellation:!0},options:{e2ee:{keyProvider:t.keyProvider,worker:ws}},children:[e,o&&i&&c&&n.jsx(Yt,{}),o&&i&&c&&n.jsx(wo,{}),o&&i&&c&&n.jsx(Ms,{})]}):null});function zs({conversationId:A,currentModelId:e,isActiveWindow:t}){const[o,s]=a.useState(!1),i=E(f=>f.isVoiceModeActive),c=E(f=>f.server.voiceConnectionQuality),r=Et(),l=E(f=>f.screenshare!=null),u=E(f=>f.video!=null),m=T(),d=he({conversationId:A});return et(d),a.useEffect(()=>{if(!t)return;const f=new To;return i?f.enable():f.disable(),()=>{f.disable()}},[i,t]),t&&n.jsxs(ys,{children:[n.jsx(L,{children:n.jsx(_t,{value:"normal",children:i?n.jsx(w.div,{className:"fixed left-0 top-0 z-50 flex h-full w-full flex-col bg-token-main-surface-primary",initial:"hidden",animate:"visible",exit:"hidden",variants:lA,children:n.jsxs(w.div,{className:"relative h-full w-full",variants:lA,children:[n.jsxs(w.div,{variants:lA,className:"flex h-full w-full flex-col justify-between gap-6",children:[n.jsxs(w.div,{className:"relative mt-6 flex w-full justify-center",children:[n.jsx("div",{className:"flex w-full items-center justify-center",children:(l||u)&&n.jsx(_A,{className:"h-16 w-16"})}),n.jsx("div",{className:"mr-4",children:n.jsx(Ss,{conversationId:A})})]}),n.jsxs("div",{className:"flex h-full min-h-0 items-center justify-center",children:[n.jsx(ms,{children:n.jsx(_A,{className:"h-max min-h-52 w-max min-w-52"})}),n.jsx(L,{children:o?n.jsx(is,{conversationId:A}):null})]}),n.jsx(w.div,{className:"mb-6 flex justify-center",children:n.jsx(Fo,{conversationId:A,currentModelId:e})})]}),n.jsx(w.div,{className:"absolute bottom-0 right-0 flex w-auto items-center justify-end p-4",variants:lA,children:r?n.jsx(St,{onClick:()=>s(f=>!f),icon:gt}):null})]})}):null})}),c===le.Poor&&n.jsx("div",{className:"absolute left-1/2 top-6 z-50 -translate-x-1/2 transform",children:n.jsx("div",{className:"inline-flex flex-col items-center rounded-full border border-token-border-light bg-token-main-surface-primary px-6 py-3",children:n.jsx("span",{className:"text-token-text-secondary",children:m.formatMessage({id:"YE2Eng",defaultMessage:"Poor connection"})})})})]})}const lA={hidden:{opacity:0,transform:"blur(4px)"},visible:{transform:"blur(0px)",opacity:1},exit:{opacity:0,transform:"blur(4px)"}};export{zs as VoiceModeLayout};
//# sourceMappingURL=e6hdg58ehjx6mkm6.js.map
