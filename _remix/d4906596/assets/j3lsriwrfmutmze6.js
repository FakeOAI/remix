const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/h169q0odqwsidwf8.js","assets/i02hakaw1yz2cb0w.js","assets/oolxnb4itrwnjqyf.js","assets/root-nervg1nc.css","assets/ckygyr7dh5h6j13j.js","assets/conversation-small-kig9eefw.css","assets/mv65vi40bwx8cy8n.js","assets/fy32gsgjnvmziir1.js","assets/j1601v2ihcbk1gfj.js","assets/j8pudfjo9hou5kw0.js","assets/bbilryt45cr5lkmt.js","assets/cpdqbxpekjursyhj.js","assets/bq32fteknutqzun6.js","assets/daq507jgc2nhxbyw.js","assets/hv7xf55q4xjiqsmg.js","assets/ivu7qbqshu9eraoy.js","assets/lznvc95l0hqf1fjq.js","assets/nq860i125dfat6cp.js"])))=>i.map(i=>d[i]);
import{r as c,aD as ie,aE as oe,X as P,bm as q,eg as v,ek as k,f2 as K,l as s,m as T,cl as le,P as x,d as C,ab as G,Q as de,a as B,bH as ce,aK as ue,j as N,$ as w,a0 as fe}from"./i02hakaw1yz2cb0w.js";import{cE as me,fg as X,fh as he,y as ye,c0 as j,es as E,fi as ge,fj as pe,cJ as be,a8 as ve,bu as V,c as Te,fk as Se,q as Ee,fl as xe,fm as Ce,fn as $,fo as Ne,aC as Ie,c6 as ke,c2 as we,Z as z,c3 as Me,et as Re}from"./ckygyr7dh5h6j13j.js";import{a as je,r as R,s as Y,u as _e}from"./cpdqbxpekjursyhj.js";import{a as De,g as Ae}from"./mv65vi40bwx8cy8n.js";import{f as Oe}from"./bbilryt45cr5lkmt.js";import{z as He,A as Q,B as Le,v as Ue,T as J}from"./fy32gsgjnvmziir1.js";import{G as Z}from"./j8pudfjo9hou5kw0.js";import{M as Ge}from"./oolxnb4itrwnjqyf.js";function Pe(e,o,t){const{title:r,titleSource:a}=He(e),[i,l]=c.useState(!1),d=r??o,n=c.useRef(d);return c.useEffect(()=>(t&&a===Q.Generated&&d!==n.current&&l(!0),()=>{n.current=d}),[t,d,a]),{isTypingEffect:i,resolvedTitle:d}}const Be=ie(()=>oe(()=>import("./h169q0odqwsidwf8.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17])).then(e=>e.GizmoConversationOptionsDropdown)),Fe=new Date(2024,9,11,0);function qe(e){G.checkGate("3922476776")||pe.abortAllRequests(),x.logEvent(C.loadThread,{threadId:e})}function Ve({conversation:e,conversationTitle:o,onOpenChange:t,testId:r}){const a=P(),{isUnauthenticated:i}=de(),{eligible:l,markAsViewed:d}=be(ve.ArchiveConversationOnboarding),n=Ue(e.id),[u,b]=c.useState(!1),y=B(),m=ce(),g=ue();return c.useEffect(()=>K(Z,{deleteChat:({serverThreadId:f})=>{f===e.id&&b(!0)},archiveChat:async({serverThreadId:f})=>{f===e.id&&(await N.patchConversation(e.id,{is_archived:!0}),R(y),G.logEvent("chatgpt_conversation_archived"),x.logEvent(C.conversationArchived),l&&(g.info(a.formatMessage({defaultMessage:"You can view archived chats in Settings",id:"HistoryGizmoItem.archiveChatOnboarding"}),{duration:10,hasCloseButton:!0}),d()),n&&V(m))}}),[m,g,y,l,e.id,a,n,d]),i?null:s.jsxs(s.Fragment,{children:[s.jsx(Te,{label:a.formatMessage({id:"tJPHEQ",defaultMessage:"Options"}),sideOffset:4,side:"top",children:s.jsx(Be,{clientThreadId:e.id,onOpenChange:t,children:s.jsx("button",{className:"flex items-center justify-center text-token-text-secondary transition hover:text-token-text-primary radix-state-open:text-token-text-secondary","data-testid":r,children:s.jsx(Ge,{className:"icon-md"})})})}),u&&s.jsx(Se,{title:o,handleDelete:()=>{N.patchConversation(e.id,{is_visible:!1}).then(()=>{R(y),G.logEvent("chatgpt_conversation_deleted"),x.logEvent(C.conversationDeleted),Ee.publish({kind:"deleteConversation",serverThreadId:e.id})}),n&&V(m)},onClose:()=>{b(!1)}})]})}function $e({conversation:e,onClose:o}){const[t,r]=c.useState(e.title),a=B();function i(){t!==e.title&&(J.setTitle(e.id,t,Q.User),x.logEvent(C.renameThread,{threadId:e.id,content:t}),N.patchConversation(e.id,{title:t}).then(()=>{R(a)}))}return s.jsx("input",{type:"text",value:t,onChange:l=>{r(l.target.value)},onKeyDown:l=>{switch(l.key){case"Escape":o();break;case"Enter":i(),o();break}},onBlur:()=>{i(),o()},autoFocus:!0,className:"w-full border border-token-border-light bg-transparent p-0 text-sm"})}const W=5,ze=3e3;function Ye({threadId:e}){const o=B(),t=c.useRef(!1),r=c.useRef(null);return c.useEffect(()=>{async function a(){t.current=!0;const i=await Oe(e);if(i.async_status===v.UNREAD){R(o),J.initThreadFromServerData(e,i,!0,void 0,!0);return}if(i.async_status!==v.STREAMING)return;const l=i.update_time??0;X(new Date,new Date(l*1e3))<W?r.current=window.setTimeout(a,ze):N.setConversationStatus(e)}return t.current||(x.logEvent(C.conversationPollingStarted),a()),()=>{r.current&&window.clearTimeout(r.current)}},[o,e]),null}function Ke({conversation:e,className:o,isActive:t,elementRef:r,isPrimaryBackgroundColor:a,testId:i}){const l=P(),[d,n]=c.useState(!1),[u,b]=c.useState(!1),{value:y}=q("3922476776"),{value:m}=q("232791851"),g=je(e.id),{value:f=null,source:S=null}=g??{},_=Le(e.id),h=me(_),I=X(new Date,new Date(e.update_time??0))<W,D=e.update_time&&he(new Date(e.update_time),Fe),A=f===v.STREAMING&&I,O=m&&!t&&!h&&D&&f===v.UNREAD,ee=m&&!t&&(h||A),te=m&&f===v.STREAMING&&S===k.SERVER&&!h&&I,H=c.useRef(!1);c.useEffect(()=>{H.current||y&&(async()=>(H.current=!0,t&&f===v.UNREAD&&(S===k.SERVER&&await N.setConversationStatus(e.id),Y(e.id,null)),!t&&S===k.CLIENT&&f===v.UNREAD&&(await N.setConversationStatus(e.id,f),Y(e.id,{value:v.UNREAD,source:k.SERVER})),H.current=!1))()},[y,t,e.id,f,S,h]),c.useEffect(()=>K(Z,{editTitle:({serverThreadId:p})=>{(p?p===e.id:t)&&n(!0)}}),[e.id,t]);const F=l.formatMessage({id:"mpXAeu",defaultMessage:"New chat"}),{resolvedTitle:L,isTypingEffect:se}=Pe(e.id,e.title,t),ae=ye(),ne=se&&t&&ae,{data:re}=De(e.conversation_template_id??void 0),U=j();return s.jsxs("div",{className:T("no-draggable group relative rounded-lg active:opacity-90",o,t?"bg-token-sidebar-surface-secondary":"hover:bg-token-sidebar-surface-secondary",u&&!t&&"bg-token-sidebar-surface-secondary",U&&[E.historyItem,E.historyItemTimeline]),children:[te&&s.jsx(Ye,{threadId:e.id}),s.jsx(le,{to:Ae(e.id,re),onClick:p=>{p.metaKey||p.ctrlKey||t||qe(e.id)},onDoubleClick:()=>{n(!0)},ref:r,className:"flex items-center gap-2 p-2",style:{maskImage:U?"var(--sidebar-mask)":void 0},children:s.jsxs("div",{className:T("relative grow overflow-hidden whitespace-nowrap",ee&&"loading-shimmer"),dir:"auto",children:[ne?s.jsx(ge,{text:L||F}):L||F,!U&&s.jsx("div",{className:T("absolute bottom-0 top-0 to-transparent ltr:right-0 ltr:bg-gradient-to-l rtl:left-0 rtl:bg-gradient-to-r",a?t||!t&&u?"from-token-sidebar-surface-secondary":"from-token-main-surface-primary":!1,a?!1:t||!t&&u?"from-token-sidebar-surface-secondary":"from-token-sidebar-surface-primary",{"from-token-main-surface-primary can-hover:group-hover:from-token-sidebar-surface-secondary":a&&!t&&!u,"from-token-sidebar-surface-primary can-hover:group-hover:from-token-sidebar-surface-secondary":!a&&!t&&!u,"w-10 from-60%":t||u,"w-8 from-0% can-hover:group-hover:w-10 can-hover:group-hover:from-60%":!t&&!u})})]})}),d?s.jsx("div",{className:"absolute bottom-0 left-[7px] right-2 top-0 flex items-center bg-token-sidebar-surface-secondary",children:s.jsx($e,{conversation:e,onClose:()=>{n(!1)}})}):O?s.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:s.jsx("div",{className:"h-2 w-2 rounded-full bg-blue-selection"})}):s.jsx("div",{className:T("absolute bottom-0 top-0 items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",t||u?"flex":"hidden can-hover:group-hover:flex"),children:s.jsx(Ve,{conversation:e,conversationTitle:L??e.title,onOpenChange:p=>{b(p),p&&x.logEvent(C.conversationHistoryItemOpenMenu,{conversationId:e.id})},testId:`${i}-options`})})]})}function Xe({className:e,elementRef:o,item:t,isActive:r,isFirstItem:a,isInRecents:i,isPrimaryBackgroundColor:l,testId:d}){const n=j();return s.jsx("li",{className:T(!n&&"relative",n&&!i&&"last:mb-4",a&&!n?"z-[15]":""),"data-testid":d,children:s.jsx(Ke,{className:e,isPrimaryBackgroundColor:l,conversation:t,isActive:r,elementRef:o,testId:d})})}function Qe(){const e=j(),{conversations:o}=_e();return{isCollapsible:e&&o.length>5,recentConversationLimit:5}}const M=fe({historyBucketToday:{id:"history.bucket.today",defaultMessage:"Today"},historyBucketYesterday:{id:"history.bucket.yesterday",defaultMessage:"Yesterday"},historyBucketLastSeven:{id:"history.bucket.lastSeven",defaultMessage:"Previous 7 Days"},historyBucketLastThirty:{id:"history.bucket.lastThirty",defaultMessage:"Previous 30 Days"}}),Je=5;function it(e,o){const t=P();return c.useMemo(()=>e.reduce((r,a)=>{const i=new Date(a.update_time??a.create_time??0),l=xe(new Date,i);if(l===0)r.recent.today.items.push(a);else if(l<=1)r.recent.yesterday.items.push(a);else if(l<=7)r.recent.lastSeven.items.push(a);else if(l<=30)r.recent.lastThirty.items.push(a);else if(Ce(i)){const d=$(i),n=Ne(i),u=`${d}-${n}`;r.dynamicMonths[u]?r.dynamicMonths[u].items.push(a):r.dynamicMonths[u]={label:t.formatDate(i,{month:"long"}),items:[a]}}else{const n=`${$(i)}-`;r.dynamicYears[n]?r.dynamicYears[n].items.push(a):r.dynamicYears[n]={label:t.formatDate(i,{year:"numeric"}),items:[a]}}return r},{recent:{today:{label:s.jsx(w,{...M.historyBucketToday}),items:[]},yesterday:{label:s.jsx(w,{...M.historyBucketYesterday}),items:[]},lastSeven:{label:s.jsx(w,{...M.historyBucketLastSeven}),items:[]},lastThirty:{label:s.jsx(w,{...M.historyBucketLastThirty}),items:[]}},dynamicMonths:{},dynamicYears:{}}),[o,e])}function ot({activeId:e,bucketedItems:o,items:t,hasNextPage:r,isPrimaryBackgroundColor:a,infiniteScrollTriggerElementRef:i}){const{isCollapsible:l}=Qe(),d=Ie(ke.isHistoryCollapsed),n=j(),[u]=we({onChange:b=>{c.startTransition(()=>{z.setHistoryShowMoreVisible(b)})}});return s.jsxs(s.Fragment,{children:[[o.recent,o.dynamicMonths,o.dynamicYears].flatMap((b,y)=>s.jsx(c.Fragment,{children:Object.entries(b).map(([m,{items:g,label:f}],S)=>{if(m!=="today"&&!g.length)return null;const _=!!g.find(h=>t.length>0&&h.id===t[0]?.id);return g.length>0&&s.jsxs("div",{className:T(a&&"first:mt-0",n&&"first:mt-1",!n&&"relative mt-5 first:mt-0 last:mb-5"),children:[s.jsx("div",{className:T("sticky",!n&&"bg-token-sidebar-surface-primary",n&&[E.historyHeading,E.historyHeadingTimeline],n?"z-5 top-[--sidebar-sticky-threshold]":"top-0 z-20"),children:s.jsx("span",{className:"flex h-9 items-center",children:s.jsx(Me,{$screenArch:n,children:f})})}),s.jsx("ol",{className:n?"flex flex-col gap-0.5":void 0,children:g.map((h,I)=>{const D=e===h.id,A=_&&I===0,O=r&&t[t.length-Je-1]?.id===h.id?i:void 0;return s.jsx(Xe,{className:T(n&&[E.historyItem,E.historyItemTimeline]),item:h,isActive:D,isFirstItem:A,isPrimaryBackgroundColor:a,elementRef:O,testId:`history-item-${I}`},`history-item-${h.id}-${m}`)})})]},`${m}-${y}-${S}`)})},`category-${y}`)),l&&!d&&s.jsx("div",{ref:u,children:s.jsx(Re,{type:"less",onClick:z.toggleHistoryCollapsed})})]})}export{ot as H,Qe as a,Xe as b,it as u};
//# sourceMappingURL=j3lsriwrfmutmze6.js.map
