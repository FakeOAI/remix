const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/sso-hokjmfw9x6zv1wd5.js","assets/b49w4g1m4rvlf13k.js","assets/eqa10itkkpekkuyz.js","assets/root-9jaremil.css","assets/dua1cjjf964x74rq.js","assets/h7m9odjd9i4xn2nr.js","assets/conversation-small-o3h1ik6j.css","assets/d8culhp0gnxyh6en.js","assets/c4bxzbp1808foto4.js","assets/drwc7kl0d6urzvme.js","assets/dlp8vj2ecea57ylq.js","assets/jotslcl5erbxvumn.js","assets/oq1az4axjii4o8sf.js","assets/ogudkc050s8yg6sz.js","assets/itghwucfyv5ciib7.js","assets/bih3aem2bbgi4ayk.js","assets/kgabwrk4bp501lpa.js","assets/fiu0d8qits1ngai7.js","assets/geqqm1lsrnyeia6y.js","assets/k3myfrovinforztc.js","assets/kmboqirrpdxl07dx.js","assets/hyq84jzq5d96nfsq.js","assets/oco8rfjyppx1v5uw.js","assets/983a0dy92b3ronpv.js","assets/mywrc0rcrsa9l0x6.js","assets/lmqmbkxdfqliy1t1.js","assets/oo90a40bf3arvc17.js","assets/kqwdyvkaaavvn8k3.js","assets/dpjwdlalymrdj5ve.js","assets/i49ydloyza8w4tji.js","assets/dpx019h2l86ol32c.js","assets/k4khkt6acwb9wlfb.js","assets/fzrn137102spawew.js","assets/e9lafxuzyeh4418f.js","assets/l1xx43017gzgzhqz.js","assets/hs4nz85f0hjl0ryz.js","assets/ib3mjhiyk6qd9ce1.js","assets/pv03nz5u4p6d7j5h.js","assets/ohmbwoip485ddsx6.js","assets/i3cqveomcqpr8agk.js","assets/ejurzivihmbq0y7c.js","assets/iej0cupg2dqkmejt.js","assets/lepjt8a6zpx491x7.js","assets/d5tyhpidpgbyeox2.js","assets/jk8w36bsokizpx57.js","assets/j61kbdr19zlf0jpc.js","assets/vrrgt1j02fsmprtt.js","assets/kficsbjfj3pmwzpc.js","assets/pe60gqq4bmdnc78v.js","assets/b0v0a7m0frriyh7f.js","assets/e4h0a9fzwibb0uia.js","assets/ir6w11med9350gpb.js","assets/mx8ks10z8e6msvoe.js","assets/gl9pn5hdn6js7p18.js","assets/k0vbuy6ljrfv1h1g.js","assets/ownxj8ojhsr6p38e.js","assets/hcof2pk6lhxjgj0y.js","assets/c67ep4ylaceyaz5k.js","assets/f5zrd49l6dssnpy7.js","assets/tq1va5cqenuhrr7q.js","assets/cec4i9eeknd5w0h2.js","assets/eeyxrw95bqzk4lvf.js","assets/jx8es1ztse3jx766.js","assets/hqi1opzfsb1mwry5.js","assets/csuxkqsltx3k5wel.js","assets/nbg1d5bqxioh3u25.js","assets/kjazgk4qsss5vinc.js"])))=>i.map(i=>d[i]);
import{r as u,ar as ve,j as s,P as ee,d as Q,aB as H,ba as pa,ga as uo,bN as xa,c as sr,f as nr,as as vn,J as Ue,I as Le,cQ as Sn,aw as Ge,cf as Pt,R as Me,ak as P,bs as ho,bk as mo,ao as Lt,ap as Bt,aQ as Ot,aA as Te,aK as De,aV as is,aF as zt,a5 as Ks,aq as Fn,a2 as fo,aE as va,f8 as ar,f6 as or,Z as Ys,K as Ln,X as ir,W as rr,ag as rs,df as lr,f5 as Bn,C as ut,dA as cr,bH as ur,bI as dr,bJ as hr,s as mr,al as He,S as fe,D as bn,A as go,$ as fr,a3 as Sa,m as po,e$ as gr,E as pr,u as On,O as dt,v as xo,n as Ct,a4 as xr,Y as vo,aW as Ie,dU as So,U as vr,gb as Sr,e2 as br,e3 as yr,e6 as Nt,e4 as ba,e5 as wr,aN as kt,gc as jr,bv as _r,bC as Mr,d4 as Tr,M as bo,an as Cr,bD as kr,aU as Ar,gd as Er,bU as Rr}from"./b49w4g1m4rvlf13k.js";import{m1 as Xs,m2 as Nr,m3 as Pr,b3 as ls,eW as Ir,m4 as Dr,m5 as Fr,gA as Qs,gB as ht,E as cs,m6 as Lr,cF as Ve,jZ as yo,k0 as wo,em as Br,W as Or,d7 as zr,jY as Hr,m7 as Se,m8 as It,m9 as Ur,ma as Wr,mb as Gr,mc as Vr,md as qr,me as $r,mf as Kr,bY as mt,mg as Yr,mh as Xr,p as J,mi as Qr,mj as Z,mk as jo,ml as _o,d1 as Zr,cY as Jr,mm as el,mn as tl,mo as Mo,l0 as sl,gr as nl,mp as al,mq as ol,mr as To,ms as il,aV as Je,mt as rl,mu as Os,n as ya,a7 as ll,cN as Dt,mv as Co,mw as ko,cJ as Zs,bZ as ss,mx as zs,my as Oe,mz as Ao,mA as cl,mB as ul,mC as Hs,mD as dl,mE as hl,mF as ml,mG as fl,mH as gl,i as pl,mI as xl,mJ as vl,mK as Sl,mL as bl,mM as Js,mN as zn,mO as yl,cu as Eo,v as Hn,cx as Ro,mP as wl,a_ as Ht,mQ as jl,iw as No,mR as _l,mS as Ml,mT as Us,bI as Un,bJ as Po,f6 as Io,du as Tl,k as Cl,dv as Do,g7 as Fo,o as kl,bL as Lo,mU as wa,mV as Al,mW as El,bQ as ja,bN as Rl,kG as Nl,ky as _a,mX as Pl,mY as Il,mZ as Dl,m_ as Fl,fS as Bo,m$ as Ll,n0 as Bl,bV as Oo,fT as zo,gX as Wn,n1 as Ma,jl as Ol,bM as zl,n2 as Hl,gg as Ul,kE as Wl,gh as Gl,gi as Vl,f$ as Ho,bO as yn,n3 as ql,n4 as $l,n5 as Kl,n6 as Yl,n7 as Xl,n8 as Ql,cB as Gn,a5 as Ws,cb as Vn,cQ as Zl,n9 as Jl,na as ec,nb as tc,nc as sc,nd as nc,ne as ac,nf as oc,cC as Uo,ng as ic,nh as rc,dr as lc,gj as cc,a1 as Ft,ni as uc,nj as dc,jj as hc,nk as mc,nl as fc,nm as gc,eP as pc,nn as xc,no as vc,np as Sc,nq as bc,dm as qn,eQ as $n,a0 as Kn,nr as Wo,ns as Yn,cO as ns,nt as yc,nu as wc,nv as jc,fL as Ze,cj as Ta,nw as wn,bB as Go,gD as Vo,bS as _c,iM as Mc,nx as Tc,ny as Cc,nz as kc,cI as Xn,cL as jn,nA as Ac,nB as qo,dn as en,cc as Qn,nC as Ec,iT as Rc,cH as Ds,nD as _n,d as $o,nE as Ca,nF as Nc,nG as Pc,nH as Ic,cG as Dc,nI as Fc,nJ as Lc,er as Bc,nK as Oc,eK as zc,j8 as Hc,nL as Uc,g6 as Wc,nM as Gc,nN as Vc,cy as qc,l_ as $c,nO as Kc,gf as Yc,nP as Xc,nQ as Ko,nR as Yo,nS as Xo,nT as At,nU as Qc,nV as Zc,nW as Jc,k6 as eu,ci as Qo,dj as Zo,nX as tu,nY as Jt,nZ as su,kH as nu,n_ as Jo,n$ as ka,o0 as Mn,o1 as au,gG as it,gU as ou,gH as Gs,kw as Vs,o2 as Tn,o3 as Cn,o4 as iu,o5 as ru,o6 as lu,o7 as cu,o8 as Aa,o9 as Es,ch as Ea,cr as ei,cs as ti,eS as uu,oa as du,ob as hu,oc as mu,gs as fu,od as gu,oe as pu,cK as si,of as xu,og as vu,oh as Su,oi as bu,oj as yu,ok as wu,bG as ju,dp as _u,gF as Mu,ol as Tu,om as Cu,on as ku,oo as Au,op as Eu,oq as Ru,or as Nu,os as Pu,ot as Iu,ou as Du,ov as Fu,bT as Lu,k9 as Bu,k8 as Ou,ow as zu,bK as Hu,ox as Uu,oy as ni,h7 as Wu,fN as ai,oz as Gu,oA as Vu,a4 as qu,g0 as $u,lt as Ku,g1 as dn,oB as Yu,oC as Xu,g2 as Qu,bX as Zu,fP as Ju,oD as ed,oE as td,oF as sd,gd as nd,cX as ad,gb as od,gc as id,ge as rd,oG as ld,fV as Ra,eM as cd,cd as ud,ce as dd,oH as hd,oI as md,jA as fd}from"./h7m9odjd9i4xn2nr.js";import{e as ft,P as Ut,d as gd,D as pd,T as kn,M as xd,g as vd,E as Sd,h as bd}from"./mso6suezaufd2zmo.js";import{p as yd,k as An,c as Na,g as wd,i as jd,n as _d}from"./1e3p1qgbzsweev7g.js";import{bW as Md,d as oi,bK as Td,aI as ii,bX as us,af as Cd,ak as kd,bY as Ad,bZ as ri,aw as Zn,ad as Ed,aY as Rd,b_ as Nd,aX as Pd,bn as li,bo as ci,b as Id,aK as Dd,aL as Fd,b9 as Ld,x as Bd,br as Od,F as zd,bF as Hd}from"./eqa10itkkpekkuyz.js";import{m as Y}from"./k3myfrovinforztc.js";import{b as Ud}from"./jhmfsyw61jtsqd29.js";import{S as ui,a as Wd,b as Gd,G as Vd,L as qd,c as $d}from"./c67ep4ylaceyaz5k.js";import{C as Kd,f as Yd}from"./mx8ks10z8e6msvoe.js";import{B as Xd}from"./kgabwrk4bp501lpa.js";const di=new ft("transactionEventPlugin"),En="prosemirrorDispatchTransaction";function Pa(t,e){const{eventTarget:n}=di.getState(t.state);return n.addEventListener(En,e),()=>{n.removeEventListener(En,e)}}function Qd(t){return new Ut({key:di,state:{init(){return{eventTarget:t}},apply(e,n){return n}}})}const Fs=new ft("customKeymapPlugin");function Zd(t,e){t.dispatch(t.state.tr.setMeta(Fs,{handlers:e}))}function Jd(t={handlers:{}}){return new Ut({key:Fs,state:{init(){return{...t}},apply(e,n){const a=e.getMeta(Fs);return a?{...n,...a}:n}},props:{handleKeyDown(e,n){const o=Fs.getState(e.state).handlers[n.key];return o?o(n):!1}}})}const lt=new ft("menuSelectorPlugin");function Et(t){t.dispatch(t.state.tr.setMeta(lt,{active:!1,onMenuAction:void 0}))}function eh(t,e){t.dispatch(t.state.tr.setMeta(lt,{active:!0,onMenuAction:e}))}function th(t={submitKeys:["Enter","Tab"],cancelKeys:["Escape"],checkStrictMatchKeys:[]}){return new Ut({key:lt,state:{init(){return{...t,active:!1}},apply(e,n){const a=e.getMeta(lt);return a?{...n,...a}:n}},props:{handleKeyDown(e,n){const a=lt.getState(e.state);return a.active?a.submitKeys.includes(n.key)?(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),a.onMenuAction?.("submit"),Et(e),!0):a.cancelKeys.includes(n.key)?(n.preventDefault(),a.onMenuAction?.("cancel"),Et(e),!0):n.key==="ArrowUp"?(n.preventDefault(),a.onMenuAction?.("up"),!0):n.key==="ArrowDown"?(n.preventDefault(),a.onMenuAction?.("down"),!0):(a.checkStrictMatchKeys.includes(n.key)&&a.onMenuAction?.("checkMatch"),!1):!1},handleDOMEvents:{blur:e=>{lt.getState(e.state).onMenuAction?.("cancel")}}}})}const es=new ft("placeholderPlugin");function sh(t){return new Ut({key:es,state:{init(){return{placeholder:t}},apply(e,n){return e.getMeta(es)?{placeholder:e.getMeta(es).placeholder}:n}},props:{decorations(e){const{doc:n}=e;if(n.childCount===1&&n.firstChild?.isTextblock&&n.firstChild.content.size===0){const o=[],{placeholder:i}=es.getState(e);return e.doc.descendants((r,l)=>{const c=gd.node(l,l+r.nodeSize,{class:"placeholder","data-placeholder":i});o.push(c)}),pd.create(n,o)}}}})}const tn="command_token",nh={group:"inline",inline:!0,atom:!0,content:"text*",attrs:{id:"",hint:""},selectable:!1,draggable:!1,toDOM:t=>["span",{"data-mention-id":t.attrs.id,"data-mention-hint":t.attrs.hint,class:"hint-pill"},t.attrs.hint],parseDOM:[{tag:"span[data-mention-id][data-mention-hint]",getAttrs:t=>{const e=t.getAttribute("data-mention-id"),n=t.getAttribute("data-mention-hint");return{id:e,hint:n}}}]};function hi(t,e){if(t.depth===0)return;const n=t.before(),o=t.doc.textBetween(n,t.pos,`
`,"\0").match(new RegExp(/(^|\s)\/(\w*)$/));if(o&&o.index!==void 0){const i=o[0].startsWith(" ")?o.index+1:o.index,r=o[0].startsWith(" ")?o[0].length-1:o[0].length,l=t.start()+i,c=l+r,m=l===e?.from;return{range:{from:l,to:c},queryText:o[2],isDismissed:m}}}const as=new ft("slashCommandPlugin");function ah(t){const n=t.state.selection.$from,a=hi(n,void 0);if(!a)return;const o=t.state.tr;t.dispatch(o.setMeta(as,{...o.getMeta(as),dismissedRange:a.range}))}function Ia(){return{queryText:"",active:!1,range:void 0}}function oh(t,e,n,a,o,i){let r;if(e.id===Xs.Search&&o)r=t.state.tr.delete(n.from,n.to),i(!0);else{const l=t.state.schema.nodes[tn].create({...e},t.state.schema.text(e.hint));r=t.state.tr.replaceWith(n.from,n.to,l),a&&r.insertText(" ",n.from+l.nodeSize)}t.dispatch(r)}function Da(t){const{active:e,range:n,queryText:a,onHintMatch:o,dismissedRange:i}=t;if(o)return!e||!n||i?.from===n.from?o(void 0):o({text:a,range:n})}function ih(t){const e=[];return t.descendants(n=>{n.type.name===tn&&typeof n.attrs?.id=="string"&&e.push(n.attrs.id)}),e}function rh(t){const e=t.state.tr;e.doc.descendants((n,a)=>{n.type.name===tn&&e.insertText(n.textContent,a,a+n.nodeSize)}),e.steps.length>0&&t.dispatch(e)}function lh(){return new Ut({key:as,state:{init(){return Ia()},apply(t,e){const n=t.getMeta(as),a=t.selection,o=a.$from,i=hi(o,e.dismissedRange),r={...Ia(),...e,...n};return a.from!==a.to?(Da(r),r):(r.active=!!i,i&&(r.queryText=i.queryText,r.range=i.range,i.isDismissed&&(i.queryText===""&&e.queryText!==""?r.dismissedRange=void 0:r.dismissedRange=i.range)),Da(r),r)}}})}class sn extends Nr{constructor(e){super(),this.view=e}get document(){return this.view.dom.ownerDocument}isEmpty(){return this.view.state.doc.textContent.trim().length===0}trimLeadingText(e){const a=this.view.state.tr;let o=!1,i=!1;return a.doc.descendants((r,l)=>{o||!r.isText||(o=!0,r.text?.startsWith(e)&&(i=!0,a.insertText(r.text.replace(e,""),l,l+r.text.length)))}),i&&this.view.dispatch(a),i}replaceAll(e,n){const o=this.view.state.tr,i=[];o.doc.descendants((r,l)=>{!r.isText||r.text===void 0||i.push({node:r,pos:l})}),i.reverse(),i.forEach(({node:r,pos:l})=>{!r.isText||r.text===void 0||r.text.includes(e)&&o.insertText(r.text.replaceAll(e,n),l,l+r.text.length)}),this.view.dispatch(o)}appendText(e){this.view.dispatch(this.view.state.tr.insertText(e))}focus(){this.view.focus(),this.view.dispatch(this.view.state.tr.setSelection(kn.atEnd(this.view.state.doc)))}setText(e){const{tr:n,schema:a}=this.view.state,o=e?a.nodes.paragraph.create(null,a.text(e)):a.nodes.paragraph.create();this.view.dispatch(n.replaceWith(0,this.view.state.doc.content.size,o)),this.view.hasFocus()&&this.view.dispatch(this.view.state.tr.setSelection(kn.atEnd(this.view.state.doc)))}getCurrentText(){return this.view.state.doc.textContent}hasMultipleLines(){let e=0;return this.view.state.doc.descendants(n=>{n.isBlock&&e++}),e>1}getContentToSend(){return yd(this.view)}resize(){}isReady(){return!!this.view.state.doc}setPlaceholder(e){this.view.dispatch(this.view.state.tr.setMeta(es,{placeholder:e}))}getSelectionStart(){return this.view.state.selection.ranges[0].$from.pos}isMenuSelectorActive(){return lt.getState(this.view.state).active}registerKeyHandlers(e){Zd(this.view,e)}acceptLegacyKeydown(){return!1}subscribe(e,n){if(e==="change"){const a=()=>n(void 0);return Pa(this.view,a)}return this.view.dom?.addEventListener(e,n),()=>{this.view.dom?.removeEventListener(e,n)}}useState(e){return u.useSyncExternalStore(n=>Pa(this.view,n),()=>e(this),()=>e(this))}getSystemHintsFromDoc(){return ih(this.view.state.tr.doc)}getSystemHints(){const e=this.getSystemHintsFromDoc();return e.length?[e[0]]:[]}replaceSlashCommandTokensWithText(){rh(this.view)}canShowAutocompletion(){return!this.isMenuSelectorActive()&&!this.getSystemHintsFromDoc().length}}const Fa=ve.div`m-8 flex flex-col items-center`;function La(t){return s.jsx(Y.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...t})}function ch({clientThreadId:t}){const n=Pr(t)?.gizmoId,{data:a}=ls(n);return n==null||a==null||!Ir(a)?null:s.jsx(uh,{gizmoId:n})}function uh({gizmoId:t}){const[e,n]=u.useState(!1),[a,o]=u.useState(!1),i=Dr(t),r=async c=>{n(!0),setTimeout(()=>{o(!0)},5e3),ee.logEvent(Q.submitInlineRating,{gizmo_id:t,rating:c}),await i.mutateAsync({rating:c})},l=async()=>{o(!0),ee.logEvent(Q.dismissInlineRating,{gizmo_id:t}),await i.mutateAsync({})};return u.useEffect(()=>{a||ee.logEvent(Q.showInlineRating,{gizmo_id:t})},[a,t]),a?null:e?s.jsx(Fa,{children:s.jsxs(La,{className:"flex flex-col items-center gap-4",children:[s.jsx("div",{className:"rounded-lg border border-token-border-heavy p-4",children:s.jsxs("div",{className:"flex justify-between gap-2",children:[s.jsx(H,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),s.jsx(pa,{onClick:()=>{o(!0)}})]})}),s.jsx("div",{className:"text-xs text-token-text-tertiary",children:s.jsx(H,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):s.jsx(Fa,{children:s.jsxs(La,{className:"flex flex-col items-center gap-4 rounded-lg border border-token-border-heavy p-4",children:[s.jsxs("div",{className:"flex justify-between gap-2",children:[s.jsx(H,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),s.jsx(pa,{onClick:l})]}),s.jsx(Fr,{rating:void 0,onRating:r})]})})}const dh=({clientThreadId:t})=>{const e=uo(),n=Qs(t),a=ht(n);u.useEffect(()=>{a&&xa.dismissBanner()},[a]);const o=e?.is_dismissible?()=>xa.dismissBanner():void 0;return s.jsx(cs,{children:e&&s.jsx(Y.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:s.jsx(Lr,{clientThreadId:t,rateLimitInfo:e,onDismiss:o})})})};function hh(t){const e=Qs(t),n=ht(e),a=uo();return!n&&a!=null}const Rn=window.sessionStorage,Nn=sr(nr(()=>({memoryFullBannerDismissed:!!Rn?.getItem(vn.MemoryFullBannerDismissed)}))),mi={dismissBanner(){Nn.setState(t=>{t.memoryFullBannerDismissed=!0}),Rn?.setItem(vn.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){Nn.setState(t=>{t.memoryFullBannerDismissed=!1}),Rn?.removeItem(vn.MemoryFullBannerDismissed)}};function mh(t){const e=Ve(t),n=yo(),{data:a}=wo(e,!1,n),o=a!=null,i=o&&a.memoryFullPct>=100,[r,l]=u.useState(!1);u.useEffect(()=>{!i&&o&&(l(!0),mi.clearDismissedBanner())},[i,o]);const c=Nn(m=>m.memoryFullBannerDismissed);return i&&r&&!c}function fh(){const t=Ue(),{openSettings:e}=Br();return s.jsx(Y.div,{initial:{opacity:0},animate:{opacity:1},children:s.jsx(Or,{title:t.formatMessage(Rs.memoryFullTitle),content:t.formatMessage(Rs.memoryFullTooltip,Rs.memoryFullTooltip.values),primaryCtaText:t.formatMessage(Rs.memoryManageButton),onPrimaryCtaClick:()=>e(zr.Personalization),onDismiss:()=>mi.dismissBanner()})})}const Rs=Le({memoryFullTitle:{id:"yRGU2/",defaultMessage:"Memory is full."},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"neUc+N",defaultMessage:"New memories won’t be created until you make space. <a>Learn more</a>",values:{a:t=>s.jsx("a",{href:Hr,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}}}),gh=u.memo(function(e){return ph(e),xh(e),vh(),null});function ph(t){const{store:e}=Se(),n=e.useSetSharedProps();Sn(()=>{n(t)},[t,n])}function xh(t){const{clientThreadId:e,canContinue:n}=t,{store:a}=Se(),o=u.useRef({top:a.useContentAreaApi(It.HeaderTop),bottom:a.useContentAreaApi(It.HeaderBottom)}).current,i=yh(t),r=Ur(e),{shouldShowBannerSignup:l,shouldShowBannerTermsDisclaimer:c}=wh(e),m=hh(e),d=Wr(t),h=Gr(t),g=Vr(t),p=mh(e),y=qr(),f=$r(t);Sn(()=>{f.eligible?o.top.set(Z.AdvancedVoiceOnMobileAnnouncement):y?o.top.set(Z.ParagenControls):c?o.top.set(Z.BannerTermsDisclaimer):m?o.top.set(Z.BannersRateLimit):d.eligible?o.top.set(Z.BannerSidekickAnnouncement):h?o.top.set(Z.SearchBrowserExtensionAnnouncement):g?o.top.set(Z.SearchBrowserExtensionReactiveAnnouncement):i?o.top.set(Z.ItemActions):n?o.top.set(Z.PromptTextareaAction):l?o.top.set(Z.BannerSignup):p?o.top.set(Z.BannerMemoryFull):o.top.set(null)},[o,i,n,c,l,m,d,p,y,f]),Sn(()=>{r&&o.bottom.set(jo.DallePromptControls)},[o,r])}function vh(){const{store:t}=Se();u.useEffect(()=>()=>{t.reset()},[t])}function Sh(t){const e=_o(),n=mt(t),a=J.getTree(t).getLastValidNode(n)?.message?.id;return e?.messageId===a?e.suggestions:[]}function bh(t){return Sh(t).length>0}function yh(t){const e=Kr(t.clientThreadId),n=bh(t.clientThreadId);return t.isDisabled?!1:t.isNewThread||e||n}function wh(t){const{isUnauthenticated:e}=Ge(),n=mt(t),{layer:a}=Pt("3637408529"),o=a.get("should_show_no_auth_signup_banner",!0),i=Yr(g=>g.bannerDisclaimerClientThreadId),r=Xr(),l={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1};if(!t)return l;const c=J.getTree(t),m=c.countMessagesByAuthor(Me.User),d=c.getNodeByIdOrMessageId(n),h=d?.message?.author.role===Me.Assistant&&Qr(d.message);return l.shouldShowBannerTermsDisclaimer=h&&e&&m===1&&!r&&(i==null||i===t),l.shouldShowBannerSignup=o&&h&&e&&m>0&&m%5===0,l}function fi({children:t,className:e,showBackground:n}){return s.jsxs("div",{className:"relative",children:[t,n&&s.jsx(Y.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:P("pointer-events-none absolute bottom-0 top-0 h-8 w-8 rounded-full",e)})]})}function jh({clientThreadId:t,uploadType:e,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:a,attachmentsProductFeature:o,getInputProps:i,openFileDialog:r,onOauthRedirect:l,historyDisabled:c,isDisabled:m,highlightTooltip:d}){const h=Zr(),{gdriveStatus:g,o365Status:p}=Jr(),y=s.jsx(Md,{className:c?"text-white":d?"text-brand-blue-800":void 0}),f=g!=="false"||p!=="false"||h;return s.jsx("div",{className:"relative",children:s.jsx(fi,{showBackground:d,className:"bg-brand-blue-800/20",children:f?s.jsx(el,{clientThreadId:t,icon:y,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:a,attachmentsProductFeature:o,onOauthRedirect:l,uploadType:e,openFileDialog:r,getInputProps:i,isDisabled:m,highlightTooltip:d}):s.jsx(tl,{clientThreadId:t,uploadType:e,openFileDialog:r,getInputProps:i,icon:y,isDisabled:m,highlightTooltip:d})})})}const _h=500;class Fe{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let a=this.items.length;for(;;a--)if(this.items.get(a-1).selection){--a;break}let o,i;n&&(o=this.remapping(a,this.items.length),i=o.maps.length);let r=e.tr,l,c,m=[],d=[];return this.items.forEach((h,g)=>{if(!h.step){o||(o=this.remapping(a,g+1),i=o.maps.length),i--,d.push(h);return}if(o){d.push(new ze(h.map));let p=h.step.map(o.slice(i)),y;p&&r.maybeStep(p).doc&&(y=r.mapping.maps[r.mapping.maps.length-1],m.push(new ze(y,void 0,void 0,m.length+d.length))),i--,y&&o.appendMap(y,i)}else r.maybeStep(h.step);if(h.selection)return l=o?h.selection.map(o.slice(i)):h.selection,c=new Fe(this.items.slice(0,a).append(d.reverse().concat(m)),this.eventCount-1),!1},this.items.length,0),{remaining:c,transform:r,selection:l}}addTransform(e,n,a,o){let i=[],r=this.eventCount,l=this.items,c=!o&&l.length?l.get(l.length-1):null;for(let d=0;d<e.steps.length;d++){let h=e.steps[d].invert(e.docs[d]),g=new ze(e.mapping.maps[d],h,n),p;(p=c&&c.merge(g))&&(g=p,d?i.pop():l=l.slice(0,l.length-1)),i.push(g),n&&(r++,n=void 0),o||(c=g)}let m=r-a.depth;return m>Th&&(l=Mh(l,m),r-=m),new Fe(l.append(i),r)}remapping(e,n){let a=new xd;return this.items.forEach((o,i)=>{let r=o.mirrorOffset!=null&&i-o.mirrorOffset>=e?a.maps.length-o.mirrorOffset:void 0;a.appendMap(o.map,r)},e,n),a}addMaps(e){return this.eventCount==0?this:new Fe(this.items.append(e.map(n=>new ze(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let a=[],o=Math.max(0,this.items.length-n),i=e.mapping,r=e.steps.length,l=this.eventCount;this.items.forEach(g=>{g.selection&&l--},o);let c=n;this.items.forEach(g=>{let p=i.getMirror(--c);if(p==null)return;r=Math.min(r,p);let y=i.maps[p];if(g.step){let f=e.steps[p].invert(e.docs[p]),v=g.selection&&g.selection.map(i.slice(c+1,p));v&&l++,a.push(new ze(y,f,v))}else a.push(new ze(y))},o);let m=[];for(let g=n;g<r;g++)m.push(new ze(i.maps[g]));let d=this.items.slice(0,o).append(m).append(a),h=new Fe(d,l);return h.emptyItemCount()>_h&&(h=h.compress(this.items.length-a.length)),h}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),a=n.maps.length,o=[],i=0;return this.items.forEach((r,l)=>{if(l>=e)o.push(r),r.selection&&i++;else if(r.step){let c=r.step.map(n.slice(a)),m=c&&c.getMap();if(a--,m&&n.appendMap(m,a),c){let d=r.selection&&r.selection.map(n.slice(a));d&&i++;let h=new ze(m.invert(),c,d),g,p=o.length-1;(g=o.length&&o[p].merge(h))?o[p]=g:o.push(h)}}else r.map&&a--},this.items.length,0),new Fe(Mo.from(o.reverse()),i)}}Fe.empty=new Fe(Mo.empty,0);function Mh(t,e){let n;return t.forEach((a,o)=>{if(a.selection&&e--==0)return n=o,!1}),t.slice(n)}class ze{constructor(e,n,a,o){this.map=e,this.step=n,this.selection=a,this.mirrorOffset=o}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new ze(n.getMap().invert(),n,this.selection)}}}class Qe{constructor(e,n,a,o,i){this.done=e,this.undone=n,this.prevRanges=a,this.prevTime=o,this.prevComposition=i}}const Th=20;function Ch(t,e,n,a){let o=n.getMeta(ct),i;if(o)return o.historyState;n.getMeta(Eh)&&(t=new Qe(t.done,t.undone,null,0,-1));let r=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(r&&r.getMeta(ct))return r.getMeta(ct).redo?new Qe(t.done.addTransform(n,void 0,a,Ls(e)),t.undone,Ba(n.mapping.maps),t.prevTime,t.prevComposition):new Qe(t.done,t.undone.addTransform(n,void 0,a,Ls(e)),null,t.prevTime,t.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(r&&r.getMeta("addToHistory")===!1)){let l=n.getMeta("composition"),c=t.prevTime==0||!r&&t.prevComposition!=l&&(t.prevTime<(n.time||0)-a.newGroupDelay||!kh(n,t.prevRanges)),m=r?hn(t.prevRanges,n.mapping):Ba(n.mapping.maps);return new Qe(t.done.addTransform(n,c?e.selection.getBookmark():void 0,a,Ls(e)),Fe.empty,m,n.time,l??t.prevComposition)}else return(i=n.getMeta("rebased"))?new Qe(t.done.rebased(n,i),t.undone.rebased(n,i),hn(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new Qe(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),hn(t.prevRanges,n.mapping),t.prevTime,t.prevComposition)}function kh(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((a,o)=>{for(let i=0;i<e.length;i+=2)a<=e[i+1]&&o>=e[i]&&(n=!0)}),n}function Ba(t){let e=[];for(let n=t.length-1;n>=0&&e.length==0;n--)t[n].forEach((a,o,i,r)=>e.push(i,r));return e}function hn(t,e){if(!t)return null;let n=[];for(let a=0;a<t.length;a+=2){let o=e.map(t[a],1),i=e.map(t[a+1],-1);o<=i&&n.push(o,i)}return n}function Ah(t,e,n){let a=Ls(e),o=ct.get(e).spec.config,i=(n?t.undone:t.done).popEvent(e,a);if(!i)return null;let r=i.selection.resolve(i.transform.doc),l=(n?t.done:t.undone).addTransform(i.transform,e.selection.getBookmark(),o,a),c=new Qe(n?l:i.remaining,n?i.remaining:l,null,0,-1);return i.transform.setSelection(r).setMeta(ct,{redo:n,historyState:c})}let mn=!1,Oa=null;function Ls(t){let e=t.plugins;if(Oa!=e){mn=!1,Oa=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){mn=!0;break}}return mn}const ct=new ft("history"),Eh=new ft("closeHistory");function Rh(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new Ut({key:ct,state:{init(){return new Qe(Fe.empty,Fe.empty,null,0,-1)},apply(e,n,a){return Ch(n,a,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let a=n.inputType,o=a=="historyUndo"?pi:a=="historyRedo"?Pn:null;return o?(n.preventDefault(),o(e.state,e.dispatch)):!1}}}})}function gi(t,e){return(n,a)=>{let o=ct.getState(n);if(!o||(t?o.undone:o.done).eventCount==0)return!1;if(a){let i=Ah(o,n,t);i&&a(e?i.scrollIntoView():i)}return!0}}const pi=gi(!1,!0),Pn=gi(!0,!0);function Nh(){return An({"Shift-Enter":(t,e)=>Na(t,e),Enter:(t,e)=>window.innerWidth>sl[nl.Medium]||ho?!1:Na(t,e)})}const Ph=["p",0],Ih=["br"],Dh=new vd({nodes:{paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p",preserveWhitespace:"full"}],toDOM(){return Ph}},text:{group:"inline"},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM(){return Ih}},[tn]:nh,doc:{content:"block+"}},marks:{}});function Fh(){const t=new EventTarget,e=new Sd(null,{state:bd.create({schema:Dh,plugins:[Rh(),th({submitKeys:["Enter","Tab"],cancelKeys:["Escape"],checkStrictMatchKeys:[" "]}),sh(""),lh(),Nh(),An({"Mod-z":pi,"Mod-y":Pn,"Mod-Shift-z":Pn}),Jd(),An(Ud),Qd(t),wd()]}),dispatchTransaction(n){const a=e.state.apply(n);e.updateState(a),n.docChanged&&t.dispatchEvent(new Event(En))},handlePaste(n,a){const o=a.clipboardData?.getData("text/plain");return o===void 0?!1:(al(o)||jd(n,o),!0)},clipboardTextSerializer(n){return _d(n.content).content}});return e}function Lh(){try{return navigator.userAgent.toLocaleLowerCase().includes("firefox")}catch{return!1}}const Bh=[P([ol["prosemirror-parent"],"text-token-text-primary","max-h-[25dvh]","max-h-52","overflow-auto",Lh()?"firefox":"default-browser"])],Oh=({children:t})=>{const[e]=u.useState(()=>new sn(Fh()));return t(e)},za=({composerController:t,placeholder:e})=>{const n=u.useContext(mo),a=u.useRef(null),o=u.useRef(null),i=u.useRef(!1);return u.useEffect(()=>{if(i.current)return;if(!(t instanceof sn))throw new Error(`Expected instance of ProseMirrorComposerController but got ${t.constructor.name}`);i.current=!0;const r=o.current;if(r!=null){const{value:l,selectionStart:c,selectionEnd:m}=r;t.view.dispatch(t.view.state.tr.insertText(l)),t.view.dispatch(t.view.state.tr.setSelection(kn.create(t.view.state.doc,c+1,m+1))),r.style.display="none",r.value=""}a.current.appendChild(t.view.dom),t.view.dom.id=To,il(t.view.dom),t.view.focus()},[t]),u.useEffect(()=>{t.setPlaceholder(e)},[e,t]),u.useEffect(()=>{t.logPageMount()},[]),s.jsxs("div",{ref:a,className:P(Bh),children:[s.jsx("textarea",{className:"block h-10 w-full resize-none border-0 bg-transparent px-0 py-2 text-token-text-primary placeholder:text-token-text-secondary",autoFocus:!0,placeholder:e,ref:o}),s.jsx("script",{nonce:n.cspScriptNonce,suppressHydrationWarning:!0,children:"window.__oai_logHTML?window.__oai_logHTML():window.__oai_SSR_HTML=window.__oai_SSR_HTML||Date.now();requestAnimationFrame((function(){window.__oai_logTTI?window.__oai_logTTI():window.__oai_SSR_TTI=window.__oai_SSR_TTI||Date.now()}))"})]})},zh=Lt(()=>Bt(()=>import("./sso-hokjmfw9x6zv1wd5.js").then(t=>t.a),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45])).then(t=>({default:t.ComposerRightActions}))),Hh=u.forwardRef(function({type:e,placeholder:n,replyRegions:a,state:o,renderFiles:i,leftSideActions:r,onSubmit:l,inputState:c,currentLeafId:m,composerController:d,clientThreadId:h,gizmoId:g,disableReason:p,modelId:y},f){const v=Je(),x=rl(),M=Ot(),S=(Te("1567586774").value||M?.includes(De.SearchTool))&&!M?.includes(De.SearchToolHoldout),{value:b}=Te("1028682714");u.useEffect(()=>{d.focus()},[x?.modelId,d]);const w=N=>{qh({target:N.target,rootId:"composer-background",additonalInteractiveIds:["reply-regions"]})||d.focus()};return s.jsxs("div",{id:"composer-background",ref:f,className:P("flex w-full flex-col transition-colors contain-inline-size",v&&"backdrop-blur-2xl no-transparency:backdrop-blur-none",v&&e!=="temporary"&&"bg-token-composer-surface",S?"cursor-text rounded-3xl px-2.5 py-1":"gap-1.5 rounded-[26px] px-2.5 py-1.5",!v&&e!=="temporary"&&"bg-[#f4f4f4] dark:bg-token-main-surface-secondary",e==="temporary"&&"dark bg-black"),onClick:w,children:[s.jsx(cs,{initial:!1,children:a.length>0&&s.jsx(Y.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0,transition:{duration:.06}},transition:{ease:"easeOut",duration:.1},id:"reply-regions",children:s.jsx(Uh,{replyRegions:a})})}),S?s.jsxs(s.Fragment,{children:[i,s.jsx("div",{className:"flex min-h-[44px] items-center px-2",children:s.jsx("div",{className:"max-w-full flex-1",children:d instanceof Os?s.jsx(Ha,{composerController:d,currentLeafId:m,placeholder:n,inputState:c}):s.jsx(za,{composerController:d,placeholder:n})})}),s.jsxs("div",{className:"flex h-[44px] items-center justify-between",children:[s.jsx("div",{className:"flex gap-x-1",children:r}),b?s.jsx(zh,{inputState:c,state:o,onSubmit:l,composerController:d,clientThreadId:h,gizmoId:g,disableReason:p,modelId:y}):s.jsx(ya,{inputState:c,state:o,onSubmit:l,composerController:d,clientThreadId:h,gizmoId:g,disableReason:p})]})]}):s.jsx(s.Fragment,{children:s.jsxs("div",{className:"flex items-end gap-1.5 pl-4 md:gap-2",children:[!!r?.length&&s.jsx(Y.div,{initial:{opacity:0},animate:{opacity:1},transition:{ease:"easeOut",duration:.06},className:"-ml-2.5 mb-1 flex",children:r},"leftSideActions"),s.jsxs(Y.div,{layout:!0,transition:{duration:.1},className:P("flex min-w-0 flex-1 flex-col"),children:[i,d instanceof Os?s.jsx(Ha,{composerController:d,currentLeafId:m,placeholder:n,inputState:c}):s.jsx(za,{composerController:d,placeholder:n})]}),s.jsx("div",{className:"mb-1 me-1",children:s.jsx(ya,{inputState:c,state:o,onSubmit:l,composerController:d,clientThreadId:h,gizmoId:g,disableReason:p})})]})})]})});function Ha({composerController:t,currentLeafId:e,placeholder:n,inputState:a}){const o=u.useContext(mo);return s.jsxs(s.Fragment,{children:[s.jsx(ll,{id:To,autoFocus:!0,tabIndex:0,"data-id":e,dir:"auto",ref:i=>{if(!(t instanceof Os))throw new Error("Expected TextAreaComposerController");i!=null&&(t.textArea=i,t.logPageMount())},rows:1,placeholder:n,disabled:a!=="default",className:P("m-0 resize-none border-0 bg-transparent px-0 text-token-text-primary focus:ring-0 focus-visible:ring-0",a==="disabled"&&"text-center",["max-h-[25dvh]","max-h-52"])}),s.jsx("script",{nonce:o.cspScriptNonce,suppressHydrationWarning:!0,children:"requestAnimationFrame((function(){window.__oai_logTTI?window.__oai_logTTI():window.__oai_SSR_TTI=window.__oai_SSR_TTI??Date.now()}))"})]})}function Uh({replyRegions:t}){return s.jsx("div",{className:"flex cursor-auto flex-col divide-y divide-token-border-light overflow-hidden rounded-b-lg rounded-t-[20px] bg-token-main-surface-primary",children:t.map((e,n)=>{switch(e.type){case"text":return s.jsx(Wh,{value:e.value,onRemoveRegion:e.onRemoveRegion},n);case"object":return s.jsx(Gh,{value:e.value,onRemoveRegion:e.onRemoveRegion},n);case"mention":case"system_hint":return s.jsx(Vh,{value:e.value,icon:e.icon,onRemoveRegion:e.onRemoveRegion},n)}})})}function Wh({value:t,onRemoveRegion:e}){return s.jsxs(ea,{className:"text-token-text-secondary",children:[s.jsx(ta,{children:s.jsx(oi,{className:"icon-lg-heavy"})}),s.jsx(sa,{children:`“${t}”`}),s.jsx(Jn,{onClick:e})]})}function Gh({value:t,onRemoveRegion:e}){return s.jsxs(ea,{className:"text-blue-selection",children:[s.jsx(ta,{children:s.jsx(oi,{className:"icon-lg-heavy"})}),s.jsx(sa,{className:"font-semibold",children:t}),s.jsx(Jn,{onClick:e})]})}function Vh({value:t,icon:e,onRemoveRegion:n}){return s.jsxs(ea,{children:[s.jsx(ta,{className:"mt-0",children:e}),s.jsx(sa,{className:"font-semibold text-token-text-primary",children:t}),s.jsx(Jn,{onClick:n})]})}function Jn({onClick:t}){return s.jsx("button",{onClick:t,type:"button",className:"flex-shrink-0 text-token-text-secondary",children:s.jsx(Td,{className:"icon-lg"})})}const ea=ve.div`flex items-start py-2.5 gap-3 pl-3 pr-1.5 text-sm`,ta=ve.span`flex-shrink-0 mt-0.5 w-7 h-6 flex justify-center items-center`,sa=ve.span`flex-1 line-clamp-3 py-0.5`;function qh({target:t,rootId:e,additonalInteractiveIds:n}){let a=t;for(;a&&a!=null;){if(a.tagName==="BUTTON"||a.tagName==="INPUT"||a.tagName==="TEXTAREA"||a.isContentEditable||n.includes(a.id))return!0;if(a.id===e)return!1;a=a.parentElement}return!1}const Ns={initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:.1},exit:{opacity:0,scale:.5,transition:{duration:.2}}},$h=({suggestions:t,onSelectingSuggestedReply:e})=>s.jsx("div",{className:"absolute bottom-full flex w-full max-w-[100vw] grow gap-2 overflow-auto px-1 pb-1 contain-inline-size sm:mb-0 sm:justify-start sm:px-2 sm:pb-0 md:static md:mb-2 md:max-w-none md:justify-center md:overflow-visible",children:t.slice(0,2).map((n,a)=>s.jsx(Y.div,{initial:Ns.initial,animate:Ns.animate,transition:{delay:(a-1)*Ns.transition.delay},exit:Ns.exit,children:s.jsx(zt,{as:"button",color:"secondary",size:"small",onClick:()=>{e(n,t,a)},className:"group whitespace-nowrap md:whitespace-normal",children:s.jsx(Yh,{suggestion:n})},a)},a))});function Kh({suggestions:t,onSelectingSuggestedReply:e,clientThreadId:n}){const a=t?.length>0;u.useEffect(()=>{a&&Dt(t,n)},[a,n]);const{isUnauthenticated:o}=Ge();return a?t.every(Co)?s.jsxs(Y.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"flex flex-col items-center",children:[o&&s.jsx(is,{className:"mb-6 h-12 w-12 sm:hidden"}),s.jsx(ui,{starterPrompts:t,onSelectStarterPrompt:e})]}):t.every(ko)?s.jsx($h,{suggestions:t,onSelectingSuggestedReply:e}):null:null}function Yh({suggestion:t}){return ko(t)?s.jsx(s.Fragment,{children:t.text}):Co(t)?s.jsxs("div",{className:"flex flex-col overflow-hidden",children:[t.title&&s.jsx("div",{className:"truncate font-semibold",children:t.title}),s.jsx("div",{className:P("truncate font-normal",t.title?"opacity-50":""),children:t.body})]}):null}function Xh(){const{store:t}=Se(),e=t.useSharedProps();return e?s.jsx(Qh,{...e}):null}function Qh({clientThreadId:t,suggestions:e}){const n=Zs();return e===void 0||e.length===0?null:s.jsx("div",{children:s.jsx(Zh,{children:s.jsx("div",{className:"grow",children:e!==void 0&&s.jsx(Kh,{suggestions:e,onSelectingSuggestedReply:n,clientThreadId:t})})})})}const Zh=ve.div`h-full flex ml-1 md:w-full md:m-auto gap-0 md:gap-2 justify-center`,xi=({className:t,children:e})=>s.jsx(Y.div,{className:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:e});function Jh({currentLeafId:t,canContinue:e,onContinueGenerating:n}){const a=u.useCallback(()=>{const i=new ss;n(t,i),zs()},[n,t]);let o=null;return e&&(o=s.jsx(tm,{onHandleContinueGenerating:a})),o&&s.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:o})}function em({className:t}){return s.jsx(ii,{className:P("-rotate-180",t)})}const tm=({onHandleContinueGenerating:t})=>s.jsx(xi,{children:s.jsx(zt,{as:"button",color:"secondary",onClick:t,className:"whitespace-nowrap py-2",icon:em,size:"small",children:s.jsx(H,{...Oe.continueGenerating})})}),sm=()=>{const{shouldShowSkipButton:t}=Ao();return t?s.jsx(xi,{className:"flex justify-center",children:s.jsx(zt,{as:"button",color:"secondary",onClick:()=>cl.skipParagen(),children:s.jsx(H,{...nm.skip})})}):null},nm=Le({skip:{id:"dvcUbp",defaultMessage:"Skip"}}),vi=u.memo(function({className:e}){const{store:n}=Se(),a=n.useIsHeaderContentAreaPopulated();return s.jsx("div",{className:P(e??"absolute bottom-full left-0 right-0",Hs.PromptTextareaHeader),children:s.jsx(ul,{shouldRender:a,contentArea:It.Header,children:s.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[s.jsx(Si,{}),s.jsx(bi,{})]})})})});function Si(){const{store:t}=Se(),e=t.useSharedProps(o=>o?.clientThreadId),n=t.useContentAreaId(It.HeaderTop);let a;switch(n){case Z.AdvancedVoiceOnMobileAnnouncement:a=s.jsx(fl,{clientThreadId:e});break;case Z.ParagenControls:a=s.jsx(sm,{});break;case Z.ItemActions:a=s.jsx(Xh,{});break;case Z.BannerSignup:a=s.jsx(om,{});break;case Z.BannerTermsDisclaimer:a=s.jsx(im,{});break;case Z.PromptTextareaAction:a=s.jsx(rm,{});break;case Z.BannersRateLimit:a=s.jsx(lm,{});break;case Z.BannerSidekickAnnouncement:a=s.jsx(ml,{});break;case Z.SearchBrowserExtensionAnnouncement:a=s.jsx(hl,{});break;case Z.SearchBrowserExtensionReactiveAnnouncement:a=s.jsx(dl,{});break;case Z.BannerMemoryFull:a=s.jsx(fh,{});break;case Z.Box:a=s.jsxs("div",{className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",s.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",s.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;default:a=null;break}return a}function bi(){const{store:t}=Se(),e=t.useContentAreaId(It.HeaderBottom);let n;switch(e){case jo.DallePromptControls:n=s.jsx(am,{});break;default:n=null;break}return n}function am(){const{store:t}=Se(),e=t.useSharedProps(n=>n?.composerController);return e?s.jsx(gl,{composerController:e}):null}function om(){const{store:t}=Se(),e=t.useSharedProps(o=>o?.clientThreadId),n=pl(),a=xl();return e?n?s.jsx(vl,{threadId:e,showSignUp:a}):s.jsx(Sl,{threadId:e,showLogin:a}):null}function im(){const{store:t}=Se(),e=t.useSharedProps(n=>n?.clientThreadId);return e?s.jsx(bl,{threadId:e}):null}function rm(){const{store:t}=Se(),e=t.useSharedProps();return e?s.jsx(Jh,{...e}):null}function lm(){const{store:t}=Se(),e=t.useSharedProps(n=>n?.clientThreadId);return e?s.jsx(dh,{clientThreadId:e}):null}function cm(t){const e=Ot();return(Te("1567586774").value||e?.includes(De.SearchTool))&&!e?.includes(De.SearchToolHoldout)?s.jsx(um,{...t}):s.jsx(dm,{...t})}function um({composerController:t,isDisabled:e,highlightTooltip:n,clientThreadId:a}){const{setThreadSearchMode:o}=Js(),i=zn(),r=yl(),[l,c]=u.useState(!1),m=Ue(),d={clientThreadId:a};return s.jsx(yi,{highlightTooltip:n,analyticsMetadata:d,isThreadUsingSearchMode:i,isDisabled:e,children:s.jsxs("button",{className:P("flex h-8 min-w-8 items-center justify-center rounded-lg p-1 text-xs font-semibold",l&&"transition-all duration-150",i||n?"!rounded-2xl bg-blue-250 text-blue-1000 hover:bg-[#BDDCF4] dark:bg-[#2A4A6D] dark:text-[#48AAFF] dark:hover:bg-[#1A416A]":e?"opacity-30":"hover:bg-black/10 focus-visible:outline-black dark:focus-visible:outline-white"),"aria-pressed":i,"aria-label":m.formatMessage({id:"Sl1VH/",defaultMessage:"Search the web"}),disabled:e,onTransitionEnd:()=>c(!1),onClick:h=>{h.stopPropagation(),h.preventDefault(),c(!0),ee.logEventWithStatsig(Q.composerSearchButtonClicked,"composer_search_button_clicked",d),o(!i,d,Ks.CONVERSATION_COMPOSER_WEB_ICON),/^search\s?$/i.test(t.getCurrentText())&&t.setText(""),t.replaceSlashCommandTokensWithText(),t.focus()},children:[s.jsx(us,{}),s.jsx(cs,{children:i&&s.jsx(Y.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:r?0:.15},children:s.jsx("div",{className:"pl-1 pr-2",children:s.jsx(H,{id:"TbHx8d",defaultMessage:"Search"})})})})]})})}function dm({composerController:t,highlightTooltip:e,clientThreadId:n,isDisabled:a}){const{setThreadSearchMode:o}=Js(),i={clientThreadId:n};return s.jsx(yi,{highlightTooltip:e,analyticsMetadata:i,isThreadUsingSearchMode:!1,isDisabled:a,children:s.jsx(fi,{showBackground:e,className:"bg-brand-purple/20",children:s.jsx("button",{className:"flex h-8 w-8 items-center justify-center text-token-text-primary disabled:opacity-30",disabled:a,onClick:()=>{ee.logEventWithStatsig(Q.composerSearchButtonClicked,"composer_search_button_clicked",i),o(!0,i,Ks.CONVERSATION_COMPOSER_WEB_ICON),/^search\s?$/i.test(t.getCurrentText())&&t.setText(""),t.replaceSlashCommandTokensWithText(),t.focus()},children:s.jsx(us,{className:P(e&&"text-brand-purple-800 dark:text-brand-purple-600")})})})})}function hm(){const t=Eo(Hn.hasSeenComposerSearchButtonTooltip);return!t.isLoading&&t.eligible}function yi({children:t,highlightTooltip:e,analyticsMetadata:n,isThreadUsingSearchMode:a,isDisabled:o}){const i=hm()&&!a,r=Eo(Hn.hasSeenComposerSearchButtonTooltip);return i?s.jsx(Ro,{side:"right",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:s.jsx(H,{id:"Yjduqi",defaultMessage:"Search the web"}),onDismiss:r.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:s.jsx(H,{id:"W51Aei",defaultMessage:"Get fast answers with trusted sources. {learnMore}",values:{learnMore:s.jsx(wl,{href:"https://openai.com/index/introducing-chatgpt-search",className:"underline",children:s.jsx(H,{id:"stA7F4",defaultMessage:"Learn more"})})}}),children:s.jsx("div",{children:t})}):s.jsx("div",{children:s.jsx(Fn,{sideOffset:0,label:o?s.jsx(H,{id:"GpDAWD",defaultMessage:"Search is unavailable"}):s.jsx(H,{id:"c+4o2s",defaultMessage:"Search the web"}),side:"right",open:e||(a?!1:void 0),onOpenChange:l=>{l&&ee.logEventWithStatsig(Q.composerSearchButtonHovered,"composer_search_button_hovered",n)},children:t})})}function mm({composerController:t,clientThreadId:e}){const n=Ht(e),{setThreadSearchMode:a}=Js(),i=jl().size>0,r=No(e,fo.Search),l=_l(e),[c,m]=u.useState([]),[d,h]=u.useState(void 0),[g,p]=u.useState(0);u.useEffect(()=>{m(d?l.filter(j=>j.name.toLocaleLowerCase().startsWith(d.text.toLocaleLowerCase())||j.systemHint.toLocaleLowerCase().startsWith(d.text.toLocaleLowerCase())):[])},[d]);const y=t.useState(j=>j.getSystemHints().length>0);u.useEffect(()=>{const j=_=>{h(A=>!A||!_?_:A.text===_.text&&A.range.from===_.range.to&&A.range.to?A:_)};t.view.dispatch(t.view.state.tr.setMeta(as,{onHintMatch:j}))},[t]);const f=i||y||!l.length||!c.length||!d;u.useEffect(()=>{f&&p(0)},[f]);const v=c.length,x=u.useCallback(j=>{p(_=>(j(_)%v+v)%v)},[v]),M=c[g],S=({hintToSave:j=M,expectPerfectMatch:_,appendSpace:A=!0})=>{if(!d||!M||_&&j.name.toLowerCase()!==d.text.toLowerCase())return;ee.logEvent(Q.systemHintSelected,{system_hint:j.systemHint,conversation_id:n??va});const O=d.text+j.name.slice(d.text.length),z={clientThreadId:e};oh(t.view,{id:j.systemHint,hint:O},d.range,A,r,k=>a(k,z,Ks.CONVERSATION_COMPOSER_SLASH_SEARCH)),Et(t.view)},b=u.useRef(S);b.current=S;const w=u.useRef(x);w.current=x;const N=u.useRef(d);N.current=d;const C=t.view;return u.useEffect(()=>(f||eh(C,j=>{j==="up"?w.current(_=>_-1):j==="down"?w.current(_=>_+1):j==="cancel"?(Et(C),ah(C)):j==="submit"?(b.current({expectPerfectMatch:!1}),Et(C)):j==="checkMatch"&&b.current({expectPerfectMatch:!0,appendSpace:!1})}),()=>Et(C)),[f,C]),u.useEffect(()=>{f||ee.logEvent(Q.systemHintListOpened,{conversation_id:n??va})},[f]),f?null:s.jsx(ar,{className:"max-w-60",onMouseDown:j=>{j.preventDefault()},children:c.map((j,_)=>s.jsx("div",{onMouseOver:()=>p(_),onClick:()=>{S({hintToSave:j,expectPerfectMatch:!1}),t.focus()},children:s.jsx(or,{autoFocus:!1,className:"group rounded-lg px-1 py-2 hover:bg-token-hint-text",spoofHovered:_===g,children:s.jsx(fm,{title:j.name,description:j.description,icon:s.jsx(Ml,{svgString:j.logo,className:"icon-lg text-token-text-secondary group-hover:text-white"}),checked:!1})})},j.systemHint))})}function fm({title:t,description:e,icon:n,checked:a}){return s.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-1.5 pl-1.5 pr-3",children:[s.jsx("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:n}),s.jsxs("div",{className:"shrink grow basis-0",children:[s.jsx("p",{className:"text-sm font-normal leading-tight text-token-text-primary group-hover:text-white",children:t}),!!e&&s.jsx("p",{className:"text-[13px] font-normal leading-[18px] text-token-text-secondary group-hover:text-white",children:e})]}),a&&s.jsx(Cd,{className:P("icon-md text-token-text-primary",{"group-hover:hidden":!a})})]})}function gm({composerController:t,clientThreadId:e}){return t instanceof sn?s.jsx(mm,{composerController:t,clientThreadId:e}):null}function pm({suggestions:t,composerController:e,onSelect:n,onChange:a}){const o=Zs(),i=u.useCallback((d,h,g)=>{n?.(d,h,g),o(d,h,g)},[n,o]),[r,l]=u.useState(-1),[c,m]=u.useState(!1);return u.useEffect(()=>{const d=h=>{if(h.key==="ArrowDown"){const g=r===t.length-1?0:r+1;l(g),a?.(g,!0,t[g])}else if(h.key==="ArrowUp"){h.preventDefault();const g=r<=0?t.length-1:r-1;l(g),a?.(g,!0,t[g])}else h.key==="Enter"&&!h.shiftKey&&t[r]&&i(t[r],t,r)};return e.subscribe("keydown",d)},[t,r,a,i,e]),u.useEffect(()=>e.subscribe("blur",()=>{l(-1),a?.(-1,!1)}),[e,a]),u.useEffect(()=>{if(!c){const d=()=>{m(!0),window.removeEventListener("mousemove",d)};return window.addEventListener("mousemove",d),()=>{window.removeEventListener("mousemove",d)}}},[c]),u.useEffect(()=>{l(-1),a?.(-1,!1),m(!1)},[t,a]),s.jsx(Y.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"hidden w-full flex-col p-2.5 group-focus-within:flex group-focus-within:max-lg:flex-col-reverse",children:t.map((d,h)=>s.jsxs(Y.li,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:h*.03},exit:{opacity:0,translateY:4},className:"w-full",children:[h>0&&s.jsx("div",{className:P("h-[1px] opacity-60 max-lg:hidden",r===h||r===h-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")}),s.jsxs("button",{className:P("flex w-full cursor-pointer items-center justify-start whitespace-pre-wrap rounded-lg px-2.5 py-3 text-start",r===h?"bg-token-main-surface-secondary":"bg-token-main-surface-primary"),onClick:g=>{g.preventDefault(),i(d,t,h)},onMouseDown:g=>{g.preventDefault()},onMouseEnter:()=>{c&&(l(h),a?.(h,!1,d))},onMouseLeave:()=>{l(-1),a?.(-1,!1,d)},children:[d.icon?s.jsx("span",{className:"mr-4 h-6 w-6 text-token-text-secondary",children:d.icon}):null,s.jsx("span",{className:"whitespace-pre-wrap",children:d.autocompletionChunks&&d.autocompletionChunks.length>0?s.jsx(s.Fragment,{children:d.autocompletionChunks.map((g,p)=>s.jsx("span",{className:P(g.isMatched?"text-token-text-tertiary":"text-token-text-primary"),children:g.text},p))}):s.jsxs(s.Fragment,{children:[s.jsx("span",{className:P(d.type===Us.Starter?"text-token-text-secondary":"text-token-text-tertiary"),children:d.title}),s.jsx("span",{className:"text-token-text-primary",children:d.body})]})})]}),h>0&&s.jsx("div",{className:P("h-[1px] opacity-60 lg:hidden",r===h||r===h-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")})]},d.id??h))})}function xm(t,e){t=t.toLocaleLowerCase();const n=e;e=e.toLocaleLowerCase();const a=[];let o=0;for(let l=0;l<e.length&&(o<t.length&&t[o]===e[l]&&(a.push(l),o++),o!==t.length);l++);const i=[];let r=0;if(a.forEach(l=>{if(l>r){const c=n.slice(r,l);c&&i.push({text:c,isMatched:!1})}i.push({text:n[l],isMatched:!0}),r=l+1}),r<e.length){const l=n.slice(r);l&&i.push({text:l,isMatched:!1})}return vm(i)}function vm(t){if(t.length===0)return t;let e=[t[0]];for(let a=1;a<t.length;a++){const o=e[e.length-1],i=t[a];o.isMatched===i.isMatched?o.text+=i.text:e.push(i)}const n=e.filter(a=>a.isMatched).reduce((a,o)=>a+o.text.trim().length,0);return e.length<=4&&n>=2?e:[{text:e.map(a=>a.text).join(""),isMatched:!1}]}const Sm=1,bm=3e3;function ym({files:t,className:e}){const n=Uo(),a=Po(),o=Ot(),i=(Te("1567586774").value||o?.includes(De.SearchTool))&&!o?.includes(De.SearchToolHoldout),r=ic();return s.jsxs("div",{className:e,children:[r.map(l=>s.jsx(rc,{pastedTextdoc:l,textdocId:l.tempId},l.tempId)),t.map(l=>s.jsx(lc,{borderRadius:i?"2xl":"xl",useV2Style:i,width:n?"normal":"wide",onRemoveFileClick:()=>yn.remove(a,l.tempId,"none"),file:l.file,fileId:l.fileId??void 0,contextConnectorInfo:l.contextConnectorInfo,loadingPercentage:l.status===cc.Uploading?l.progress:void 0},l.tempId))]})}function wm({onAbortCompletion:t,onCreateNewCompletion:e,onContinueGenerating:n,currentModelId:a,clientThreadId:o,isNewThread:i,isCompletionInProgress:r,className:l,disabled:c=!1,disabledReason:m,canPause:d=!1,canContinue:h=!1,suggestions:g,isInteractableSharedThread:p,composerContainerRef:y,composerController:f,autocompletions:v,requiresFileUpload:x,onComposerInput:M,onComposerChange:S,onAutocompleteSelect:b,headerClassName:w,hideHeader:N,setComposerBarElement:C,onTaggingDropdownOpen:j,onTaggingDropdownClose:_}){const A=Un(),O=Ys(),{isUnauthenticated:z}=Ge(),k=Ue(),F=Ln(),L=Po(),E=mt(o),R=Qs(o),[B]=ir(),$=rr(),oe=Io(),{gizmoEditorData:W,mode:de,getGizmoId:ge}=Tl(),X=Ot(),be=Cl(),re=rs(),ye=Do(),ue=Ht(o),we=!!lr(),pe=!!Bn(),[Ce,je]=u.useState({}),{setThreadSearchMode:he,clearSearchModeTrigger:Be,getSearchModeTrigger:We}=Js(),D=zn(),[I,te]=u.useState(!1),[K,V]=u.useState(!1),ne=Je(),se=u.useRef(!1),G=Fo(),ae=(Te("1567586774").value||X?.includes(De.SearchTool))&&!X?.includes(De.SearchToolHoldout),le=a!==null?G[a]:void 0,ke=kl(o);let q=Lo(o),Ae=q&&"gizmo"in q?q.gizmo:void 0;const[ie,gt]=u.useState(null);ie!==null&&(q={gizmo:ie,gizmo_id:ie.gizmo.id,kind:ut.GizmoInteraction},Ae=ie);const pt=wa(le,q);let ds=!1;Al(q)&&Ae?.gizmo.id===El&&(ds=!0);const Ee=cr(),hs=!c&&!ds&&pt!==ja.None&&!z,et=Rl(le,q),Wt=Nl(le,q);let Re=_a(T=>T.files);const[xt]=u.useState(()=>Pl());de==="magic"?Re=Re.filter(T=>T.gizmoId!=null):Re=Re.filter(T=>T.gizmoId==null);const ms=Il(),qe=Re.length>0||ms,Gt=_a(Dl.hasUploadInProgress),vt=f.useState(T=>{const ce=Fl(T);return typeof le?.maxTokens=="number"&&ce>le.maxTokens}),Vt=f.useState(T=>!T.isEmpty()),St=!vt&&!Gt&&(Vt||qe);Bo(Re.length>0||Gt||Vt);const fs=(pt===ja.Multimodal?Ll:Bl)-Re.length,gs=fs<=0,$e=St&&!c&&!r&&!pe,[ps,bt]=u.useState(!1),xs=Oo(),vs=a||xs.id,yt=No(o,fo.Search),Ss=!c&&!Ae&&X?.includes(De.SearchTool)&&(X?.includes(De.BrowsingAvailable)||!O?.isEnterprisey()),Ke=Ss&&yt,qt=G[vs]?.tags,{targetedContent:tt,setTargetedContent:Ye}=zo(),_e=tt?.isFocusedViewContent&&!ye?void 0:tt,{rebaseSystemMessageContent:bs}=Wn();u.useEffect(()=>{if(!A?.id)return;const T=Ma.getAndReset(A?.id,ue);T&&f.setText(T.inputText)},[A?.id,ue,f]),u.useEffect(()=>{ps!==$e&&(bt($e),$e&&ur(!0).then(T=>{dr.startEnforcement(T),Ol.startEnforcement(T),hr.startEnforcement(T)}))},[$e,ps,q?.kind,X]);const ys=zl(le,q),{handleFileAccepted:ws}=Hl(k,wa(le,q),et,"mouse",ge,ys?.attachments),{getInputProps:ra,open:nn}=Ul({disabled:c||!hs||gs,noClick:!0,onDropAccepted:ws,onDropRejected:T=>Wl(T,k,F,pt),multiple:!0,maxSize:Gl,maxFiles:fs,...Vl(Wt)}),$t=mr(xt),an=u.useCallback(()=>{f.eraseContent(),$t.clearMessages(),f.resize(Sm),J.clearOverrideModelId(o),Ho();for(const T of Re)yn.remove(L,T.tempId,"none");ql.markAllAsSent()},[f,$t,Re,L,o]),wt=async(T,ce)=>{if(T?.preventDefault(),c||!St&&!ce||!q||Ft.isLoading(o)!==!1)return;const Ne=new ss;te(!0);const xe=f.getContentToSend(),at=uc(xe.content),ln=`${E}-nextPrompt`,Qt=new dc(hc.CompletionRequest,{expectedTimingLogs:[{name:"prompt_submitted",expectedInMs:3e3}]}),{content:er,attachments:ha}=mc(L,at,le,q),cn=[];bs&&cn.push(fc(bs));const un={...q};"gizmo"in un&&delete un.gizmo;let As=f.getSystemHints();D&&(As=[Xs.Search]);const ma=We(),tr=D?ma??Ks.CONVERSATION_COMPOSER_WEB_ICON:void 0,fa=gc(),ga=pc();let Zt={promptId:ln,content:er,eventMetadata:{eventSource:T?"mouse":"keyboard"},completionMetadata:{suggestions:g,conversationMode:un,systemHints:As,searchSource:tr},messageMetadata:{...ha.length>0&&{attachments:ha},...ie&&{gizmo_id:ie?.gizmo.id},...Ce,...As.length>0&&{system_hints:As},...!!xe.metadata&&{serialization_metadata:xe.metadata},...fa.length>0&&{canvas:{pasted_textdocs:fa}},...Object.keys(ga).length>0&&{__internal:{search_settings:ga}}},appendMessages:cn.length>0?cn:void 0,turnTracker:Ne,profiler:Qt,requestedModelId:ke};Zt=xc(Zt),_e?.createNewCompletionParams&&(Zt=await _e.createNewCompletionParams(Zt)),Qt.logTiming("request_params_ready"),await e(Zt),_e?.onCreateCompletion?.({serverThreadId:ue,currentLeafId:E}),_e?.shouldPersistAcrossMessages!==!0&&Ye(void 0),Ws.hideThreadHeader(),an(),te(!1),Qt.logTiming("prompt_submitted"),g!==void 0&&(fe.logEvent("chatgpt_prompt_ignore_suggestions"),ee.logEvent(Q.promptIgnoreSuggestions)),D&&ma&&Be()},on=u.useRef(wt);u.useEffect(()=>{on.current=wt});const rn=T=>{Ye(T.targetedReply),T.targetedReply&&(f.focus(),ee.logEvent(Q.targetedReplyButtonClicked,{conversationId:ue,sourceMessageId:T.messageId}))},js=u.useCallback(()=>{_e?.onCleared?.({serverThreadId:ue,currentLeafId:E}),Ye(void 0),f.focus()},[E,ue,_e,Ye,f]),_s={Enter:{validator:T=>{const ce=T.isComposing||T.keyCode===229;return!(K&&se.current)&&(T.metaKey||(be||ho)&&!T.shiftKey&&!ce)},handler:T=>{if(!$e){vt&&F.danger("The message you submitted was too long, please submit something shorter.",{hasCloseButton:!0});return}T.preventDefault(),wt()}},Escape:{validator:T=>!T.isComposing,handler:T=>{d&&r&&(t("",R),ee.logEvent(Q.pauseCompletion,{threadId:J.getServerThreadId(o),currentLeafId:J.getTree(o).getMessageId(E),eventSource:"keyboard"})),T.target.value===""&&js()}}},st=u.useRef(_s);st.current=_s;const Ms=u.useRef(null),nt=$l(qt,q?.kind),[Kt,U]=u.useState(!1),[me,jt]=u.useState(!1),_t=nt&&Kt,Ts=f.isReady();u.useEffect(()=>f.subscribe("keydown",T=>{f.acceptLegacyKeydown()&&st.current[T.key]?.validator(T)&&st.current[T.key].handler(T);const Ne=f.getCurrentText();if(T.key==="@"){const xe=f.getSelectionStart(),at=Ne.substring(0,xe);(!at||/\s$/.test(at)||xe===0)&&(Ms.current?.handleClose(),setTimeout(()=>U(!0),10))}else Kt&&U(!1);if(T.key==="Escape"&&(gt(null),V(!1)),Ke&&!D){let xe;T.key==="Backspace"?xe=Ne.substring(0,Ne.length-1):xe=Ne+T.key,/^search\s?$/i.test(xe)?jt(!0):me&&jt(!1)}D&&T.key==="Escape"&&he(!1,{clientThreadId:o})}),[f,Ts,Kt,me,Ke,D,he,o]),u.useEffect(()=>{const T=Object.fromEntries(Object.keys(st.current).map(ce=>[ce,xe=>{const at=st.current[ce];if(!at||f.acceptLegacyKeydown())return!1;const{validator:ln,handler:Qt}=at;return ln(xe)?(Qt(xe),!0):!1}]));f.registerKeyHandlers(T)},[f,Ts]),u.useEffect(()=>f.subscribe("paste",T=>{Kl({filePickerStore:L,event:T,intl:k,toaster:F,clientThreadId:o,conversationMode:q,currentModelConfig:le,getEditorGizmoId:ge,modelSupportedImageMimeTypes:et})}),[k,o,q,le,ge,et,f,F,L]);const Fi=T=>{we||gt(T),f.trimLeadingText("@"),zs(),U(!1)},Li=Yl(o,xt,k,et,ys?.attachments),Bi=u.useCallback(T=>{T?.preventDefault(),t("",R),ee.logEvent(Q.pauseCompletion,{threadId:J.getServerThreadId(o),currentLeafId:J.getTree(o).getMessageId(E),eventSource:"mouse"}),zs()},[t,o,R,E]),la=u.useCallback(()=>{Ma.set(A?.id,ue,f.getCurrentText())},[ue,A?.id,f]);u.useEffect(()=>{W||!I&&!Xl()&&f.focus()},[I,f]),u.useEffect(()=>{W||yn.reset(L)},[a,L,W]),u.useEffect(()=>{(!nt&&ie||we)&&gt(null)},[nt,ie,we]);const[Oi,zi]=(()=>{switch(m){case"workspaceDisallowsGizmo":return[Oe.disallowedByWorkspacePlaceholder,!0];case"feedbackRequired":return[Oe.disabledFeedbackPlaceholder,!0];case"noModelsAvailable":return[Oe.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[Oe.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[Oe.loading,!0];case"noTestGizmoId":return[Oe.noTestGizmoId,!0];default:return p?[Oe.placeholderWithName,!1]:_e?.placeholderTextOverride!=null?[_e.placeholderTextOverride,!1]:[Oe.placeholderWithName,!1]}})(),Hi=k.formatMessage(Oi,{name:W!=null?de==="magic"?Ql:W.name||"GPT":Ae?.gizmo.display.name??"ChatGPT"});u.useEffect(()=>f.subscribe("input",()=>{Gn.getState().isThreadHeaderVisible&&Ws.hideThreadHeader(),V(!0)}),[f]),u.useEffect(()=>{if(M)return f.subscribe("input",()=>{M?.()})},[f,M]),u.useEffect(()=>{if(S)return f.subscribe("change",()=>{S?.()})},[f,S]),u.useEffect(()=>f.subscribe("focus",()=>{V(!0)}),[f]);const Ui={clientThreadId:o,uploadType:pt,modelAcceptedMimeTypes:Wt,modelSupportedImageMimeTypes:et,attachmentsProductFeature:ys?.attachments,getInputProps:ra,openFileDialog:nn,historyDisabled:re,onOauthRedirect:la,highlightTooltip:x&&!qe},Yt=[],ca=!c&&!gs&&(hs||Ee!=null)&&!D;(ae||ca)&&Yt.push(s.jsx(jh,{...Ui,isDisabled:!ca},"file-upload-button")),Ss&&(!D||ae)&&Yt.push(s.jsx(cm,{composerController:f,highlightTooltip:me,clientThreadId:o,isDisabled:!Ke||qe},"search-button"));const Wi=qe&&s.jsxs(s.Fragment,{children:[de==="magic"&&s.jsx("div",{className:"m-2 mb-0 rounded-lg bg-token-main-surface-secondary p-2 text-xs text-token-text-secondary",children:s.jsx(H,{...Oe.gizmoKnowledgeWarning})}),s.jsx(ym,{files:Re,className:P("flex flex-nowrap gap-2 overflow-x-auto",ae?"p-1.5":"pb-1.5 pt-[7px]")})]}),Gi=zi?"disabled":"default",Vi=r&&d,qi=!$e||I,$i=vc(Gt,Vt,vt),Cs=Vi?"streaming":qi?"disabled":"idle",Xt=u.useRef(null),Mt=u.useRef(null),{layer:Ki}=He("387752763"),{layer:Yi}=He("51287004"),Xi=Ki.get("enable_slash_commands",!1)&&(z||!O?.isFree()||Yi.get("enable",!1)),Qi=a&&[Sc,bc].includes(a),Zi=Xi&&q?.kind===ut.PrimaryAssistant&&!D;u.useEffect(()=>{const T=()=>{Xt.current!=null&&bn.addAction("composer_state_disabled",{threadId:J.getServerThreadId(o),disabledReason:Xt.current})};if(St&&Cs==="disabled"){let ce="unknown";c?ce=m??"component_disabled_unknown":r?ce="completion_in_progress":pe?ce="thread_hard_blocked":I&&(ce="starting_new_completion_request"),Xt.current!==ce&&(Mt.current&&clearTimeout(Mt.current),Mt.current=setTimeout(T,bm)),Xt.current=ce}else Xt.current=null;return()=>{Mt.current&&(clearTimeout(Mt.current),Mt.current=null)}},[o,St,Cs,c,m,r,pe,I]);const ks=[];if(D&&!ae&&ks.push({type:"system_hint",value:k.formatMessage(jm.searchMode),icon:s.jsx("span",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-brand-purple/15",children:s.jsx(us,{className:"h-[20px] w-[20px] shrink-0 text-[#814CFF]"})}),onRemoveRegion:()=>{he(!1,{clientThreadId:o}),f.focus()}}),_e?.label&&ks.push({type:_e.type,value:_e.label,onRemoveRegion:js}),ie!==null){const T=!!ie.gizmo.tags?.includes(Vn.FirstParty);ks.push({type:"mention",value:ie.gizmo.display.name,icon:s.jsx(Zl,{isFirstParty:T,src:ie.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{gt(null),f.focus()}})}u.useEffect(()=>{(!v||v.length===0||!K)&&(se.current=!1)},[v,K]);const Ji=(T,ce,Ne)=>{se.current=T>=0,ce&&f.setText(Ne?`${Ne.title}${Ne.body}`:"")},ua=K&&v&&v.length>0&&!_t&&!f.hasMultipleLines()&&f.canShowAutocompletion();u.useEffect(()=>{_t?j?.():_?.()},[_t,j,_]);const da=Cs==="streaming"?Bi:wt;return s.jsxs(Jl.Provider,{value:xt,children:[s.jsx(ec,{onOauthRedirect:la,children:s.jsx("form",{className:l,onSubmit:da,children:s.jsxs("div",{className:"relative flex h-full max-w-full flex-1 flex-col",children:[!N&&!ne&&s.jsx(vi,{className:w}),s.jsxs("div",{className:"relative h-0",children:[_t&&s.jsx("div",{className:P("absolute bottom-3 w-full space-y-2",Hs.TagGpt),children:s.jsx(tc,{onClick:T=>Fi(T),onClose:()=>{U(!1),f.focus()}})}),Zi&&s.jsx("div",{className:P("absolute bottom-3 space-y-2",Hs.TagGpt),children:s.jsx(gm,{composerController:f,clientThreadId:o})})]}),s.jsxs("div",{ref:y,className:"group relative flex w-full items-center",children:[i&&B.has("from_template_row")&&s.jsx("button",{type:"button",onClick:()=>{$("/")},className:"mr-2 flex h-8 w-8 items-center justify-center text-token-text-tertiary hover:text-token-text-secondary",children:s.jsx(kd,{className:"icon-lg"})}),nt&&!!ue&&s.jsx(sc,{ref:Ms}),s.jsx(Hh,{type:re?"temporary":"default",ref:C,replyRegions:ks,placeholder:Hi,inputState:Gi,composerController:f,leftSideActions:Yt,state:Cs,onSubmit:da,renderFiles:Wi,currentLeafId:E,clientThreadId:o,gizmoId:Ae?.gizmo.id,disableReason:$i,modelId:vs}),ua&&s.jsx("div",{className:P("absolute left-0 z-10 box-border w-full bg-token-main-surface-primary max-lg:bottom-full lg:top-full",Yt?.length>0&&oe&&!ae?`px-${Yt.length*8}`:"pl-0"),children:s.jsx(pm,{suggestions:v,composerController:f,onSelect:b,onChange:Ji})})]}),s.jsx(nc,{composerController:f,parsedDocumentHandler:Li})]})})}),s.jsx(gh,{canUseInlineTagging:nt,isDisabled:c,clientThreadId:o,currentLeafId:E,currentRequestId:R,canContinue:h,composerController:f,setPromptInputMetadata:je,suggestions:g,isNewThread:i,onCreateNewCompletion:e,onContinueGenerating:n,onResetState:an,conversationMode:q,isShowingAutocomplete:!!ua}),q!=null&&!Qi&&ac.includes(q.kind)&&s.jsx(oc,{onTargetedReply:rn})]})}const jm=Le({searchMode:{id:"LSO1pB",defaultMessage:"Search the web"}}),_m=({children:t})=>{const[e]=u.useState(()=>new Os);return t(e)},wi=({children:t})=>{const{layer:e}=He("387752763");return e.get("enable_rich_text_composer",!1)?s.jsx(Oh,{children:t}):s.jsx(_m,{children:t})};function Mm(t){const e=t.message?.author.role===Me.User,n=t.metadata?.err!=null&&t.metadata?.errCode!==Ta.ContentPolicy,a=t.metadata?.errCode===Ta.ModelIncompatibility;return t.metadata?.canRetry===!1||a?!1:e||n}function Tm(t){return t.composerController?s.jsx(Ua,{...t,composerController:t.composerController}):s.jsx(wi,{children:e=>s.jsx(Ua,{...t,composerController:e})})}function Ua({clientThreadId:t,isNewThread:e,currentModelId:n,showPromptStarters:a,noWrap:o,onRequestCompletion:i,composerContainerRef:r,composerController:l}){const c=qn(),m=$n(),d=Kn(g=>{const p=Ft.getCurrentNode(t,g);return Mm(p)});if(Wo(l),!m&&d)return s.jsx(Cm,{clientThreadId:t});const h=s.jsx(s.Fragment,{children:s.jsx(ji,{composerContainerRef:r,composerController:l,clientThreadId:t,currentModelId:n,isNewThread:e,showPromptStarters:a,onRequestCompletion:i})});return o?h:s.jsxs(s.Fragment,{children:[s.jsx(ch,{clientThreadId:t}),s.jsx(Yn,{clientThreadId:t,isStaticSharedThread:c,withVerticalPadding:!1,withHorizontalPadding:!0,children:s.jsx(ns,{children:h})})]})}function Cm({clientThreadId:t}){const e=yc(t),n=Kn(i=>Ft.getCurrentNode(t,i).metadata?.errCode===wc),a=jc(i=>i.isoDate),o=mt(t);return n&&a!=null&&a!==""?null:s.jsxs("div",{children:[s.jsx("div",{className:"mb-3 text-center text-xs",children:s.jsx(H,{...Wa.errorGeneratingResponse})}),s.jsx("div",{className:"flex items-center md:mb-4",children:s.jsx(zt,{as:"button",color:"primary",onClick:()=>{const i=new ss;fe.logEvent("chatgpt_regenerate_due_to_error_button_clicked",void 0,Ze({clientThreadId:t})),e({id:o,eventMetadata:{eventSource:"mouse"},conversationMode:Ft.getConversationMode(t),turnTracker:i})},className:"m-auto",icon:ii,"data-testid":"regenerate-thread-error-button",children:s.jsx(H,{...Wa.regenerateResponse})})})]})}function ji({clientThreadId:t,currentModelId:e,isNewThread:n,onRequestCompletion:a,showPromptStarters:o,composerContainerRef:i,composerController:r,autocompletions:l,requiresFileUpload:c,onComposerInput:m,onComposerChange:d,onAutocompleteSelect:h,headerClassName:g,hideHeader:p,onTaggingDropdownClose:y,onTaggingDropdownOpen:f}){const v=mt(t),x=Qs(t),M=wn(),{isUnauthenticated:S}=Ge(),w=Go(t)===go.STREAMING,N=Vo({clientThreadId:t,conversationLeafId:v}),C=ht(x),j=_c({clientThreadId:t}),_=!S,A=fr(),{isOpen:O,onClose:z}=Mc({type:"just-hit-rate-limit"}),k=u.useCallback((K,V)=>{ee.logEvent(Q.continueCompletion),a({type:Sa.Continue,promptId:K,eventMetadata:{eventSource:"mouse"},cancelActiveRequests:!1,completionMetadata:{conversationMode:Ft.getConversationMode(t)},turnTracker:V})},[a,t]),F=po(),L=u.useCallback(async(K,V)=>Tc({clientThreadId:t,currentRequestId:V,isHistoryAndTrainingDisabled:A,queryClient:F}),[t,A,F]),E=u.useCallback(async({promptId:K,content:V,eventMetadata:ne,completionMetadata:se,messageMetadata:G,appendMessages:ae,turnTracker:le,profiler:ke,requestedModelId:q})=>{const Ae=J.getThreadCurrentLeafId(t);J.updateTree(t,ie=>{ie.addNode(K,V,Ae,Me.User,void 0,G)}),await a({type:Sa.Next,promptId:K,eventMetadata:ne,cancelActiveRequests:!0,completionMetadata:se,appendMessages:ae,turnTracker:le,profiler:ke,...q?{requestedModelId:q}:{}})},[t,a]),R=Cc(t,v),B=kc(t,v),$=!N&&(C||w),oe=u.useMemo(()=>$?!1:!R&&B,[R,B,$]),W=$&&e!=="gpt-4-pbrowse",de=Xn(t),ge=Ve(t),X=ls(ge).data,{promptStarters:be,isSuccess:re}=jn(n&&!de,t,4),ye=_o(),ue=(()=>{if(ye?.messageId===J.getTree(t).getLastValidNode(v)?.message?.id)return ye?.suggestions;if(o&&!de&&re&&!_)return be})(),we=Ac(),pe=gr(),Ce=(()=>{if(X?.gizmo.tags?.includes(Vn.WorkspaceDisabled)&&!pe)return"workspaceDisallowsGizmo";if(we.size){if(M.displayingSideBySideFeedback&&M.unskippable)return"feedbackRequired"}else return"noModelsAvailable";const V=Ft.getConversationMode(t);return V?.kind===ut.GizmoTest&&V.gizmo_id==null?"noTestGizmoId":null})(),je=qo(t),he=en(t),Be=On("15117983")?.value,We=pr(),D=Qn(),I=We.action==="moderate",{value:te}=Te("1860647109");return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex justify-center",children:D&&I&&te?s.jsx(Ec,{}):null}),O?s.jsx(Rc,{onClose:z}):null,Be&&he&&he.kind===ut.PrimaryAssistant&&he.plugin_ids&&he.plugin_ids.length>0?s.jsx(km,{}):s.jsx(wm,{composerContainerRef:i,composerController:r,clientThreadId:t,onCreateNewCompletion:E,onAbortCompletion:L,onContinueGenerating:k,currentModelId:e,isNewThread:n,isCompletionInProgress:j,className:"w-full",canContinue:oe,suggestions:ue??[],disabled:!!Ce,disabledReason:Ce??void 0,canPause:W,isInteractableSharedThread:je,autocompletions:l,requiresFileUpload:c,onComposerInput:m,onComposerChange:d,onAutocompleteSelect:h,headerClassName:g,hideHeader:p,onTaggingDropdownClose:y,onTaggingDropdownOpen:f},t)]})}function km(){return s.jsxs("div",{className:"mx-auto flex max-w-md flex-col items-center justify-center gap-2 rounded-xl border border-token-border-light bg-token-main-surface-primary p-6 shadow-lg",children:[s.jsx("span",{className:"text-token-text-primary",children:s.jsx(H,{id:"PluginsDecrepatedNotice.pluginsDeprecationTitle",defaultMessage:"Conversations with plugins are archived"})}),s.jsx("span",{className:"text-token-text-secondary",children:s.jsx(H,{id:"PluginsDecrepatedNotice.pluginsDeprecationSubtitle",defaultMessage:"Explore GPT Store to find a replacement"})}),s.jsxs("a",{href:"https://chat.openai.com/gpts",className:"text-green-500 hover:cursor-pointer dark:text-green-400",children:[s.jsx(H,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLink",defaultMessage:"Explore GPTs"}),s.jsx("span",{className:"ml-2",children:s.jsx(H,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLinkArrow",defaultMessage:"→"})})]})]})}const Wa=Le({errorGeneratingResponse:{id:"PromptTextarea.errorGeneratingResponse",defaultMessage:"There was an error generating a response"},regenerateResponse:{id:"PromptTextarea.regenerateResponse",defaultMessage:"Regenerate"}}),_i=u.memo(function(){return s.jsxs("div",{className:`flex flex-col gap-2 ${Hs.PromptTextareaHeader}`,children:[s.jsx(Si,{}),s.jsx(bi,{})]})}),$f=Object.freeze(Object.defineProperty({__proto__:null,ChatScreenComposerAlerts:_i},Symbol.toStringTag,{value:"Module"})),fn=4;function Am(t){const{layer:e}=He("3533083032"),{layer:n}=Pt("3533083032"),{value:a}=Te("3006519778");return a?t?e.get("enable_new_homepage_anon",!1):n.get("enable_new_homepage_anon",!1):!1}function Em(){const{layer:t}=Pt("4031588851"),e=t.get("autocomplete_qualified_start_date","2099-09-13T00:00:00Z"),n=Un();return!!n&&n.created*1e3>=new Date(e).getTime()}function Rm(t){const{layer:e}=He("4031588851"),{layer:n}=Pt("4031588851"),{value:a}=Te("633009675");return a?t?e.get("enable_new_autocomplete_homepage",!1):n.get("enable_new_autocomplete_homepage",!1):!1}const gn=t=>`${t.title}${t.body}`.toLocaleLowerCase();function Nm(t){return Ve(t.clientThreadId),s.jsx(wi,{children:e=>s.jsx(Lm,{...t,composerController:e})})}function Pm({children:t,composerController:e}){const{store:n}=Se(),[a,o]=u.useState(!1);u.useEffect(()=>e.subscribe("focus",()=>{o(!0)}),[e]),u.useEffect(()=>e.subscribe("blur",()=>{o(!1)}),[e]);const r=!!n.useSharedProps()?.isShowingAutocomplete;return t(r&&a)}function Im({isUnauthenticated:t,shouldShowLegacyStarterPrompts:e,legacyPromptStarters:n,isSendBlocked:a,clientThreadId:o}){return s.jsxs("div",{className:P(t?"justify-end lg:justify-center":"justify-center","flex h-full flex-shrink flex-col items-center overflow-y-hidden text-token-text-primary lg:hidden"),children:[s.jsx("div",{className:P(t&&"flex sm:items-center md:flex-1","flex-shrink-0"),children:s.jsx(is,{className:"mb-6 h-12 w-12"})}),e&&(n&&n.length>0?s.jsx(Hm,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},promptStarters:n,isSendBlocked:a,clientThreadId:o,isSquare:t}):s.jsx(Wd,{}))]})}function Dm({composerController:t,isSendBlocked:e,clientThreadId:n,isModelLoaded:a,headlineOption:o,enableNewMobileDesign:i,shouldShowStarterPrompts:r,promptChips:l,onSelectStarterPrompt:c,starterPromptExpanded:m,setStarterPromptExpanded:d}){return s.jsx(Pm,{composerController:t,children:h=>s.jsxs(Y.div,{initial:{opacity:0},animate:{opacity:h?0:1},exit:{opacity:0},transition:{duration:.1},className:P("justify-center",h?"pointer-events-none":"","mt-[var(--screen-optical-compact-offset-amount)] flex h-full flex-shrink flex-col items-center overflow-hidden text-token-text-primary lg:hidden"),children:[o==="CHATGPT_LOGO"?s.jsx(is,{className:"inline-block h-12 w-12"}):s.jsx(Mi,{headlineOption:o,isModelLoaded:a}),s.jsx(Y.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:P(!i&&"lg:hidden",!m&&"h-[116px]"),children:r&&s.jsx(Ci,{starterPrompts:l,onSelectStarterPrompt:c,disabled:e,clientThreadId:n,onExpand:()=>d(!0),mobileLayout:!0})})]})})}function Fm(t,e,n){const a=Te("1468311859").value,o=Te("3664702598").value,{layer:i}=He("4031588851"),r=Em(),l=t||e,c=l&&a,m=l&&o&&r;let d="HARDCODED";if(l)if(n){const h=i.get("search_autocomplete_mode","");c&&h&&(d=h)}else m&&(d=i.get("autocomplete_mode","HARDCODED"));return d}function Lm({clientThreadId:t,currentModelId:e,isModelLoaded:n,onRequestCompletion:a,composerController:o,v2HomepageDisclaimer:i}){const r=Ds(t),l=Xn(t),c=Bn(),[m,d]=u.useState([]),{trendingSuggestions:h,fetchTrendingSuggestions:g}=Um(fn),p=u.useRef(!1),{isUnauthenticated:y}=Ge(),f=Io(),[v,x]=u.useState(!1),M=zn(),S=Je();Wo(o);const b=Te("589604007").value,{layer:w}=Pt("4031588851"),{layer:N}=He("4031588851"),{layer:C}=Pt("3533083032"),{layer:j}=He("3533083032"),{promptStarters:_,isSuccess:A}=jn(r&&!l&&n,t,8,b,!0,e??void 0),{promptStarters:O,isSuccess:z,isError:k}=jn(r&&!l&&n,t,4,void 0,void 0,e??void 0),F=f&&!!m.find(D=>!!D.requires_file_upload),L=u.useCallback(D=>{const I=o.getCurrentText();return I&&gn(D).startsWith(I.toLocaleLowerCase())},[o]),E=u.useCallback(D=>{const I=o.getCurrentText(),te=D.title+D.body;return L(D)?{...D,title:I,body:te.slice(I.length)}:{...D,title:te,body:""}},[o,L]),R=u.useCallback((D=!1)=>{d(I=>!I.some(L)&&I.length>0?[]:D?I:I.map(E))},[L,E]),B=(D,I,te)=>{const K=D.title;d([]),o.focus(),o.setText(K),requestAnimationFrame(()=>{const V=(_?.filter(ne=>ne.theme===D.theme)??[]).map(ne=>{const se=Ct(ne.oneliner),G=se.startsWith(ne.title);return{...ne,title:G?`${ne.title} `:"",body:G?ne.body:se,autocompletionChunks:xm(K,se),type:Us.Autocomplete}});d(V),V.length>0&&Dt(V,t),Pc(D,te,t)})};u.useEffect(()=>{const D=m.some(I=>I.theme===_n.Search);M&&o.getCurrentText()===""?h.length>0?d(h):g():D&&!M&&d(I=>I.filter(te=>te.theme!==_n.Search))},[m,M,h,g,o]);const $=_?.reduce((D,I)=>(I.theme&&!D[I.theme]&&(D[I.theme]=I),D),{}),oe=[];if($)for(const D in $)oe.push($[D]);const W=oe&&oe.length>0,de=!!(A&&W&&n),ge=!!((z||k)&&n),X=fn-m.filter(L).length,be=y?j.get("enable_new_mobile",!1):N.get("enable_new_mobile",!1),re=Fm(be,f,M),ye=y?C.get("headline_option","HELP_WITH"):w.get("headline_option","HELP_WITH"),ue=w.get("autocomplete_min_char",4),we=w.get("autocomplete_fetch_interval",200),pe=u.useRef(null),Ce=u.useCallback($o(async D=>{const I=o.getCurrentText();if(!I||I.length<ue||I.length>80||o.hasMultipleLines()){d([]);return}if(!p.current&&!(pe.current&&pe.current.length>ue&&I.startsWith(pe.current)))try{const te=await dt.generateAutocompletions(I,D,M);if(te.completions.length===0){pe.current=I;return}const K=te.completions.map(V=>({id:xo(),type:Us.Autocomplete,title:V.slice(0,I.length),body:V.slice(I.length),oneliner:V,prompt:V,source:re})).filter(L).map(E);d(V=>{const ne=V.filter(L),se=K.filter(G=>{const ae=gn(G);return!ne.some(le=>{const ke=gn(le);if(ae===ke)return!0;const q=/[\p{P}\p{S}]$/u,Ae=ae.replace(q,""),ie=ke.replace(q,"");return Ae===ke||ae===ie||Ae===ie})}).slice(0,fn-ne.length);return[...ne,...se]}),K.length>0&&Dt(K,t)}catch{}},re==="BING"?150:we),[o,re,E,we]),je=u.useCallback(()=>{R(),X>0&&Ce(X)},[Ce,R,X]);u.useEffect(()=>{p.current&&d([])},[p]);const he=u.useMemo(()=>re==="HARDCODED"?R:je,[re,je,R]),Be=u.useCallback(()=>{o instanceof sn&&R(!0),o.getCurrentText().indexOf(`
`)>0&&d([])},[o,R]),We=u.useCallback((D,I,te)=>{I.forEach(K=>{K.id===D.id&&(K.userInput=o.getCurrentText())}),d([I[te]])},[o]);return s.jsx(s.Fragment,{children:s.jsx(cs,{children:s.jsx("div",{className:"h-full w-full lg:py-[18px]",children:s.jsx(Yn,{isStaticSharedThread:!1,withVerticalPadding:!1,withHorizontalPadding:!0,clientThreadId:t,fullHeight:!0,children:s.jsxs(Ca,{children:[s.jsx("div",{className:"mb-7 hidden text-center lg:block",children:ye==="CHATGPT_LOGO"?s.jsx(is,{className:"inline-block h-12 w-12"}):s.jsx(Mi,{headlineOption:ye,isModelLoaded:n})}),!be&&s.jsx(Im,{isUnauthenticated:y,shouldShowLegacyStarterPrompts:ge,legacyPromptStarters:O,isSendBlocked:c,clientThreadId:t}),be&&s.jsx(Dm,{composerController:o,isModelLoaded:n,headlineOption:ye,enableNewMobileDesign:be,shouldShowStarterPrompts:de,promptChips:oe,onSelectStarterPrompt:B,starterPromptExpanded:v,setStarterPromptExpanded:x,isSendBlocked:c,clientThreadId:t}),s.jsx("div",{className:P("lg:w-full","lg:absolute lg:bottom-8 lg:left-0"),children:s.jsx(Ca,{children:S?s.jsx(_i,{}):s.jsx(vi,{className:"block"})})}),s.jsx("div",{className:"w-full",children:s.jsx(ji,{clientThreadId:t,isNewThread:r,currentModelId:e,onRequestCompletion:a,showPromptStarters:!1,composerController:o,autocompletions:m,requiresFileUpload:F,onComposerInput:he,onComposerChange:Be,onAutocompleteSelect:We,onTaggingDropdownClose:()=>{p.current=!1},onTaggingDropdownOpen:()=>{p.current=!0},hideHeader:!0})}),s.jsx(Y.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:P("hidden lg:block",i&&y&&v?"":"h-[70px]"),children:de&&s.jsx(Ci,{starterPrompts:oe,onSelectStarterPrompt:B,disabled:c,clientThreadId:t,onExpand:()=>x(!0)})}),i&&s.jsx("div",{className:"w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px] lg:absolute lg:bottom-0 lg:left-0",children:s.jsx("div",{className:"min-h-4",children:i})})]})})})})})}function Mi({headlineOption:t,isModelLoaded:e}){const n=Ue(),[a,o]=u.useState(0),[i,r]=u.useState(!0),l=20,c=n.formatMessage(Wm[t]||ts.whatCanIHelpWith);return u.useEffect(()=>{if(!e)return;let m;return a<c.length?m=setTimeout(()=>{o(a+1)},l):i&&(m=setTimeout(()=>{r(!1)},500)),()=>clearTimeout(m)},[c,a,i,e]),s.jsxs("div",{className:"relative inline-flex justify-center text-center text-2xl font-semibold leading-9",children:[s.jsx("h1",{children:c.substring(0,a)||"​"}),s.jsx("h1",{className:"result-streaming absolute left-full transition-opacity",style:{opacity:i?1:0},children:s.jsx("span",{})})]})}function Ti({label:t,onClick:e,disabled:n=!1,icon:a}){return s.jsxs("button",{className:"group relative flex h-[42px] items-center gap-1.5 rounded-full border border-token-border-light px-3 py-2 text-start text-[13px] shadow-xxs transition enabled:hover:bg-token-main-surface-secondary disabled:cursor-not-allowed xl:gap-2 xl:text-[14px]",disabled:n,onClick:e,children:[a,s.jsx("span",{className:"max-w-full select-none whitespace-nowrap text-gray-600 transition group-hover:text-token-text-primary dark:text-gray-500",children:t})]})}function Bm({starterPrompt:t,starterPrompts:e,index:n,disabled:a,onSelectStarterPrompt:o}){const i=t.theme??t.title,r=Zs(),{mutate:l}=Ic(),c=t.category==="onboarding"?()=>{l({key:Hn.hasUsedConversationalOnboardingStarterPrompt}),r(t,e,n)}:()=>o(t,e,n);return s.jsx(Ti,{disabled:a,onClick:c,icon:s.jsx(Dc,{starterPrompt:t,useV2Colors:!0}),label:i})}function Ga({clientThreadId:t,onClick:e}){u.useEffect(()=>{Fc(t)},[t]);const n=Ue();return s.jsx(Y.div,{initial:{opacity:0,translateY:5},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:5},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:s.jsx(Ti,{onClick:()=>{Lc(t),e()},label:n.formatMessage(ts.moreStarterPrompts)})})}const Om=5,zm=3;function Ci({starterPrompts:t,onSelectStarterPrompt:e,disabled:n,clientThreadId:a,onExpand:o,mobileLayout:i=!1}){const r=i?zm:Om,[l,c]=u.useState(r),[m,d]=u.useState(r),[h,g]=u.useState(!1),p=u.useRef(null),y=t.length<=l;u.useEffect(()=>{Dt(t.slice(0,r),a)},[a]),u.useEffect(()=>{if(!h&&!y&&p.current){const v=p.current,x=v.getBoundingClientRect(),M=x.width,S=Array.from(v.children);let b=0;for(let w=0;w<S.length&&S[w].getBoundingClientRect().right-x.left<=M;w++)b++;c(b),d(b),g(!0)}},[t,y,h]);const f=()=>{const v=t.slice(l,t.length).map(x=>({...x,isAdditional:!0}));v.length>0&&Dt(v,a),c(t.length),o()};return s.jsxs("div",{className:P("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",h&&t.length>0?"opacity-100":"opacity-[0.01]",i?"flex-wrap":"flex-nowrap"),children:[s.jsxs("ul",{className:P("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",y||i?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:p,children:[t.slice(0,l).map((v,x)=>s.jsx(Y.li,{initial:{opacity:0,...x<m?{translateY:5}:{}},animate:{opacity:1,...x<m?{translateY:0}:{}},exit:{opacity:0,...x<m?{translateY:5}:{}},transition:{duration:.3,delay:x>=m?(x-m)*.06:0,ease:"easeOut"},children:s.jsx(Bm,{starterPrompt:v,starterPrompts:t,index:x,disabled:n,onSelectStarterPrompt:e})},v.id??x)),i&&t.length>l&&s.jsx(Ga,{clientThreadId:a,onClick:f})]}),!i&&t.length>l&&s.jsx(Ga,{clientThreadId:a,onClick:f})]})}function Hm({promptStarters:t,isSendBlocked:e,clientThreadId:n,isSquare:a,...o}){u.useEffect(()=>{Dt(t,n)},[n]);const i=Zs();return s.jsx(s.Fragment,{children:a?s.jsx(Y.div,{...o,className:"mb-2 w-full flex-shrink overflow-y-hidden",children:s.jsx(ns,{children:s.jsx(ui,{starterPrompts:t,onSelectStarterPrompt:i,disabled:e})})}):s.jsx(Y.div,{...o,className:"flex-shrink overflow-y-hidden",children:s.jsx(Gd,{starterPrompts:t,onSelectStarterPrompt:i,disabled:e,cssMobileDisplayLimit:2,marginOverride:"mt-6 lg:mt-12"})})})}const Um=t=>{const[e,n]=u.useState([]),a=u.useCallback(async()=>{const i=(await dt.generateTrendingSuggestions(t)).suggestions.map((r,l)=>({type:Us.Starter,title:Va(r),body:"",icon:s.jsx(Ad,{}),prompt:Va(r),id:`starter-${l}`,theme:_n.Search}));n(i)},[t]);return{trendingSuggestions:e,fetchTrendingSuggestions:a}};function Va(t){return t.split(" ").map(Nc).join(" ")}const ts=Le({whatCanIHelpWith:{id:"SplashScreenV2.whatCanIHelpWith",defaultMessage:"What can I help with?"},whereShouldWeStart:{id:"SplashScreenV2.whereShouldWeStart",defaultMessage:"Where should we start?"},askChatgptAnything:{id:"SplashScreenV2.askChatgptAnything",defaultMessage:"Ask ChatGPT anything"},moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),Wm={HELP_WITH:ts.whatCanIHelpWith,WHERE_TO_START:ts.whereShouldWeStart,ASK_CHATGPT:ts.askChatgptAnything},Gm=Lt(()=>Bt(()=>import("./vrrgt1j02fsmprtt.js"),__vite__mapDeps([46,1,2,3,47,48,5,6,49,7,8,50,51,52,53,19,54,55,56,57,58,59,60,61])).then(t=>t.GizmoUsingAsOwnerNotice)),Vm=({clientThreadId:t})=>{const e=Gn(m=>m.activeStageSidebar),n=J.getServerThreadId(t),a=Bc(De.WorkspaceShareLinks),{isUnauthenticated:o}=Ge(),i=rs(),r=a&&n&&!o&&!i,l=Je(),c=!e&&!(l&&!o);return s.jsx("div",{className:P(!l&&"gap-2",l&&"@lg/screen-composer:gap-2","flex items-center pr-1 leading-[0]"),children:s.jsx(Kd,{showShareButton:r,showProfileDropdown:c,clientThreadId:t})})};function qm({clientThreadId:t,gizmoId:e}){const n=Oc(),{data:a}=ls(e),o=Ys();return s.jsxs(s.Fragment,{children:[s.jsxs(zc,{className:"max-md:hidden",children:[s.jsxs("div",{className:"absolute start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2",children:[a!=null&&o?.isWorkspaceAccount()&&a.gizmo.tags?.includes(Vn.WorkspaceDisabled)&&s.jsx(Gm,{gizmo:a}),s.jsx(Hc,{gizmoId:e,clientThreadId:t})]}),s.jsx(Uc,{children:s.jsxs("div",{className:"flex items-center gap-0 overflow-hidden",children:[s.jsx(Yd,{clientThreadId:t}),s.jsx(Wc,{clientThreadId:t})]})}),s.jsx(Vm,{clientThreadId:t})]}),n&&s.jsx(Gc,{})]})}function ki({clientThreadId:t}){const e=Ve(t),n=qn(),a=Je();return n||a?null:s.jsx(qm,{gizmoId:e,clientThreadId:t})}function $m({clientThreadId:t,currentModelId:e,isModelLoaded:n,onRequestCompletion:a,enableV2Homepage:o,v2HomepageDisclaimer:i}){const r=rs();let l=s.jsx(qd,{}),c;return r?(c=s.jsx(Km,{}),l=s.jsx(is,{className:"mb-6 h-12 w-12"})):t!=null?(c=o?s.jsx(Nm,{clientThreadId:t,currentModelId:e,isModelLoaded:n,onRequestCompletion:a,v2HomepageDisclaimer:i}):s.jsx($d,{clientThreadId:t}),l=null):c=s.jsx(Ym,{}),s.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-token-text-primary",children:[l,c]})}function Km({gizmo:t}){const e=$c(),n=t?Kc(t.tools):!1,a=Ys();return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-5 text-2xl font-semibold","data-testid":"temporary-chat-label",children:[s.jsx(Yc,{id:"temporary-chat-checkbox",name:"temporary-chat-checkbox",checked:!0}),s.jsx(H,{...rt.temporaryChat})]}),s.jsxs("div",{className:"max-w-sm text-center text-sm font-normal text-token-text-tertiary",children:[s.jsx(H,{...a?.isWorkspaceAccount()?e?rt.temporaryChatBizMemoryAvailable:rt.temporaryChatBizMemoryUnavailable:e?rt.temporaryChatDescriptionMemoryAvailable:rt.temporaryChatDescriptionMemoryUnavailable}),n&&s.jsx("div",{className:"mt-3",children:s.jsx(H,{...rt.temporaryChatDescriptionGptActions,values:{link:o=>s.jsx("a",{href:"https://help.openai.com/en/articles/8914046-temporary-chat-faq",target:"_blank",className:"underline",rel:"noreferrer",children:o})}})})]})]})}function Ym(){return s.jsx("div",{className:"mb-5 text-2xl font-semibold",children:s.jsx(H,{...rt.howCanIHelpYouToday})})}function Xm({clientThreadId:t,currentModelId:e,isModelLoaded:n,onRequestCompletion:a,enableV2Homepage:o,v2HomepageDisclaimer:i}){const r=Ve(t),l=Vc(),c=Bn(),{data:m}=ls(r),d=qc(),h=xr(()=>navigator.windowControlsOverlay);return(l!=null||r!=null)&&m==null?null:s.jsxs("div",{className:"relative h-full",children:[s.jsx("div",{className:h?.visible?P("absolute right-[calc(100dvw-env(titlebar-area-width,100dvw)-env(titlebar-area-x,0))]",d?"left-[env(titlebar-area-x,0)]":"left-0"):"absolute left-0 right-0",children:s.jsx(ki,{clientThreadId:t})}),m!=null?s.jsx(Vd,{gizmo:m,showStarterPrompts:!0,disableStarterPrompts:c}):s.jsx($m,{clientThreadId:t,currentModelId:e,isModelLoaded:n,onRequestCompletion:a,enableV2Homepage:o,v2HomepageDisclaimer:i})]})}const rt=Le({temporaryChat:{id:"GizmoLanding.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatBizMemoryAvailable:{id:"g1opBW",defaultMessage:"This chat won't appear in your history and won't use or create memories."},temporaryChatBizMemoryUnavailable:{id:"fQmbtG",defaultMessage:"This chat won't appear your conversation history."},temporaryChatDescriptionMemoryAvailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryAvailable",defaultMessage:"This chat won't appear in history, use or create memories, or be used to train our models. For safety purposes, we may keep a copy for up to 30 days."},temporaryChatDescriptionMemoryUnavailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryUnavailable",defaultMessage:"This chat won't appear in history or be used to train our models. For safety purposes, we may keep a copy of this chat for up to 30 days."},temporaryChatDescriptionGptActions:{id:"GizmoLanding.temporaryChatDescriptionGptActions",defaultMessage:"Any data shared with a third party through GPT actions are subject to the third party's privacy policy. <link>Learn more</link>"},howCanIHelpYouToday:{id:"GizmoLanding.howCanIHelpYouToday",defaultMessage:"How can I help you today?"}});function Qm({className:t,clientThreadId:e,message:n,onModelSelect:a,onDropdownChange:o}){const i=Ue(),[r,l]=u.useState(null),[c,m]=u.useState(!1),[d,h]=u.useState(!1),g=Xc(),p=Ko(e),y=Ve(e),f=Yo({clientThreadId:e,message:n}),v=n.message.metadata?.model_slug,{modelOptions:x,modelSlug:M,animateModelLabelOnRender:S,nuxProps:b,messageModelEnabledTools:w}=f,N=Xo(n.message),C=w.includes(Xs.Search),j=u.useMemo(()=>x.find(E=>E.value==v),[x,v]),{doesUserHaveAnyAccountsWithPlusFeatures:_}=vo(),A=u.useRef(null),O=E=>{E||setTimeout(()=>{A.current&&A.current.blur()},10)};if(u.useEffect(()=>{O(c)},[c]),!g||y)return null;const z=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:i.formatMessage(qa.search),icon:s.jsx(us,{className:"icon-sm"}),condition:C&&!N,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:i.formatMessage(qa.nosearch),icon:s.jsx(ri,{className:"icon-sm"}),condition:C&&N,eventName:"chatgpt_regenerate_without_search_button_clicked"}];let k,F;b.shouldRenderNux?(k=Jm,F={title:s.jsx(H,{id:"g/+2Hh",defaultMessage:"Optimized your response"}),description:s.jsx(H,{id:"H0Flqm",defaultMessage:"Used {usedModelName} for a faster response that saves your limited {largestModelName} messages",values:{usedModelName:b.usedModelName,largestModelName:b.largestModelName}}),markAsViewed:b.announcement.markAsViewed}):(k=Zm,F={label:p?s.jsx(H,{id:"LBYK9a",defaultMessage:"Change model"}):s.jsx(H,{id:"nygjPN",defaultMessage:"Used {modelName}",values:{modelName:b.usedModelName}})});const L=p&&x.some(E=>os(E,_));return s.jsxs(Ie.Root,{onOpenChange:E=>{p&&(m(E),o(E),O(E)),E&&ee.logEvent(Q.conversationOpenMessageModelSelector,{has_get_plus_button:L})},children:[s.jsx(k,{...F,children:s.jsx(So,{ref:A,className:P("cursor-pointer",t),onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),children:s.jsx(In,{modelSlug:M,animateModelLabelOnRender:S,isDropdownOpen:c,isRegenerateEnabled:p,isHovered:d})})}),p&&s.jsxs(Ie.Content,{className:"z-30 origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[x.map(E=>{const R=os(E,_),{value:B,...$}=E;return s.jsx(At,{value:B,onSelect:()=>{fe.logEvent("chatgpt_regenerate_switch_model_button_clicked",B,{requestedModelId:B,...Ze({clientThreadId:e})}),a({requestedModelId:B})},onMouseEnter:()=>l(B),onMouseLeave:()=>l(null),isHovered:r===B,messageModelSlug:n.message.metadata?.model_slug,shouldShowUpsell:R,...$},B)}),!!j&&s.jsxs(s.Fragment,{children:[s.jsx(Ie.Separator,{}),z.filter(E=>E.condition).map(E=>s.jsx(At,{onSelect:()=>{fe.logEvent(E.eventName,j.value,{requestedModelId:j.value,...Ze({clientThreadId:e})}),a({requestedModelId:j.value,extraStreamParams:E.extraStreamParams})},includeRegenerate:!0,onMouseEnter:()=>l(E.key),onMouseLeave:()=>l(null),isHovered:r===E.key,messageModelSlug:v,includeCheck:!1,...j,label:E.label,subtitle:"",icon:E.icon},E.key))]})]})]})}function In({modelSlug:t,animateModelLabelOnRender:e,isDropdownOpen:n,isRegenerateEnabled:a,isHovered:o,isRegenLabel:i=!1,animateShortLabel:r,omitIcon:l}){const[c,m]=u.useState("initial"),{categories:d}=Qc({isRegen:!!i});u.useEffect(()=>{if(e){const x=setTimeout(()=>m("show"),500),M=setTimeout(()=>m("initial"),2e3);return()=>{clearTimeout(x),clearTimeout(M)}}m("initial")},[e]);const h=d.find(({defaultModel:x})=>x===t),g=t===Jc?{categoryId:"gpt_3.5",shorterLabel:"3.5"}:{},{categoryId:p,shorterLabel:y}=h??g,f={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},v=n?"visible":o?"show":c;return s.jsxs(Y.div,{initial:"initial",animate:v,className:"flex items-center pb-0",children:[!l&&(i?s.jsx(Zn,{className:"icon-md"}):p&&s.jsx(Zc,{type:"outline",categoryId:p,className:"icon-md h-4 w-4"})),(a||r)&&s.jsx(Y.span,{className:"overflow-hidden text-clip whitespace-nowrap text-sm",variants:f,transition:{type:"tween",duration:.18},children:y}),a&&s.jsx(Ed,{className:P("icon-sm",{"text-token-text-quaternary":!o&&!i},{"text-token-text-secondary":o&&!i})})]})}function Zm({children:t,label:e}){return s.jsx(Fn,{label:e,sideOffset:0,children:t})}function Jm({children:t,title:e,description:n,markAsViewed:a}){return s.jsx(Ro,{show:!0,side:"bottom",sideOffset:-4,title:e,description:n,badge:"beta",onDismiss:a,dismissOnOutsideClick:!0,children:t})}function os(t,e){const{modelSwitcherDeny:n,subscriptionLevel:a}=t;return!!n&&n.reason===vr.RATE_LIMIT&&a===Sr.PLUS&&!e}const qa=Le({search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),ef=u.memo(Qm),Tt=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,Ai=new Set,Dn=typeof process=="object"&&process?process:{},Ei=(t,e,n,a)=>{typeof Dn.emitWarning=="function"?Dn.emitWarning(t,e,n,a):console.error(`[${n}] ${e}: ${t}`)};let qs=globalThis.AbortController,$a=globalThis.AbortSignal;if(typeof qs>"u"){$a=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(a,o){this._onabort.push(o)}},qs=class{constructor(){e()}signal=new $a;abort(a){if(!this.signal.aborted){this.signal.reason=a,this.signal.aborted=!0;for(const o of this.signal._onabort)o(a);this.signal.onabort?.(a)}}};let t=Dn.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1";const e=()=>{t&&(t=!1,Ei("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}const tf=t=>!Ai.has(t),Xe=t=>t&&t===Math.floor(t)&&t>0&&isFinite(t),Ri=t=>Xe(t)?t<=Math.pow(2,8)?Uint8Array:t<=Math.pow(2,16)?Uint16Array:t<=Math.pow(2,32)?Uint32Array:t<=Number.MAX_SAFE_INTEGER?Bs:null:null;class Bs extends Array{constructor(e){super(e),this.fill(0)}}class Rt{heap;length;static#l=!1;static create(e){const n=Ri(e);if(!n)return[];Rt.#l=!0;const a=new Rt(e,n);return Rt.#l=!1,a}constructor(e,n){if(!Rt.#l)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new n(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}}class na{#l;#d;#g;#p;#A;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#a;#x;#n;#s;#e;#c;#h;#r;#o;#v;#i;#S;#b;#m;#y;#M;#u;static unsafeExposeInternals(e){return{starts:e.#b,ttls:e.#m,sizes:e.#S,keyMap:e.#n,keyList:e.#s,valList:e.#e,next:e.#c,prev:e.#h,get head(){return e.#r},get tail(){return e.#o},free:e.#v,isBackgroundFetch:n=>e.#t(n),backgroundFetch:(n,a,o,i)=>e.#N(n,a,o,i),moveToTail:n=>e.#k(n),indexes:n=>e.#w(n),rindexes:n=>e.#j(n),isStale:n=>e.#f(n)}}get max(){return this.#l}get maxSize(){return this.#d}get calculatedSize(){return this.#x}get size(){return this.#a}get fetchMethod(){return this.#A}get dispose(){return this.#g}get disposeAfter(){return this.#p}constructor(e){const{max:n=0,ttl:a,ttlResolution:o=1,ttlAutopurge:i,updateAgeOnGet:r,updateAgeOnHas:l,allowStale:c,dispose:m,disposeAfter:d,noDisposeOnSet:h,noUpdateTTL:g,maxSize:p=0,maxEntrySize:y=0,sizeCalculation:f,fetchMethod:v,noDeleteOnFetchRejection:x,noDeleteOnStaleGet:M,allowStaleOnFetchRejection:S,allowStaleOnFetchAbort:b,ignoreFetchAbort:w}=e;if(n!==0&&!Xe(n))throw new TypeError("max option must be a nonnegative integer");const N=n?Ri(n):Array;if(!N)throw new Error("invalid max value: "+n);if(this.#l=n,this.#d=p,this.maxEntrySize=y||this.#d,this.sizeCalculation=f,this.sizeCalculation){if(!this.#d&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(v!==void 0&&typeof v!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#A=v,this.#M=!!v,this.#n=new Map,this.#s=new Array(n).fill(void 0),this.#e=new Array(n).fill(void 0),this.#c=new N(n),this.#h=new N(n),this.#r=0,this.#o=0,this.#v=Rt.create(n),this.#a=0,this.#x=0,typeof m=="function"&&(this.#g=m),typeof d=="function"?(this.#p=d,this.#i=[]):(this.#p=void 0,this.#i=void 0),this.#y=!!this.#g,this.#u=!!this.#p,this.noDisposeOnSet=!!h,this.noUpdateTTL=!!g,this.noDeleteOnFetchRejection=!!x,this.allowStaleOnFetchRejection=!!S,this.allowStaleOnFetchAbort=!!b,this.ignoreFetchAbort=!!w,this.maxEntrySize!==0){if(this.#d!==0&&!Xe(this.#d))throw new TypeError("maxSize must be a positive integer if specified");if(!Xe(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#B()}if(this.allowStale=!!c,this.noDeleteOnStaleGet=!!M,this.updateAgeOnGet=!!r,this.updateAgeOnHas=!!l,this.ttlResolution=Xe(o)||o===0?o:1,this.ttlAutopurge=!!i,this.ttl=a||0,this.ttl){if(!Xe(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#P()}if(this.#l===0&&this.ttl===0&&this.#d===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#l&&!this.#d){const C="LRU_CACHE_UNBOUNDED";tf(C)&&(Ai.add(C),Ei("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",C,na))}}getRemainingTTL(e){return this.#n.has(e)?1/0:0}#P(){const e=new Bs(this.#l),n=new Bs(this.#l);this.#m=e,this.#b=n,this.#I=(i,r,l=Tt.now())=>{if(n[i]=r!==0?l:0,e[i]=r,r!==0&&this.ttlAutopurge){const c=setTimeout(()=>{this.#f(i)&&this.delete(this.#s[i])},r+1);c.unref&&c.unref()}},this.#T=i=>{n[i]=e[i]!==0?Tt.now():0},this.#_=(i,r)=>{if(e[r]){const l=e[r],c=n[r];if(!l||!c)return;i.ttl=l,i.start=c,i.now=a||o();const m=i.now-c;i.remainingTTL=l-m}};let a=0;const o=()=>{const i=Tt.now();if(this.ttlResolution>0){a=i;const r=setTimeout(()=>a=0,this.ttlResolution);r.unref&&r.unref()}return i};this.getRemainingTTL=i=>{const r=this.#n.get(i);if(r===void 0)return 0;const l=e[r],c=n[r];if(!l||!c)return 1/0;const m=(a||o())-c;return l-m},this.#f=i=>{const r=n[i],l=e[i];return!!l&&!!r&&(a||o())-r>l}}#T=()=>{};#_=()=>{};#I=()=>{};#f=()=>!1;#B(){const e=new Bs(this.#l);this.#x=0,this.#S=e,this.#C=n=>{this.#x-=e[n],e[n]=0},this.#D=(n,a,o,i)=>{if(this.#t(a))return 0;if(!Xe(o))if(i){if(typeof i!="function")throw new TypeError("sizeCalculation must be a function");if(o=i(a,n),!Xe(o))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return o},this.#E=(n,a,o)=>{if(e[n]=a,this.#d){const i=this.#d-e[n];for(;this.#x>i;)this.#R(!0)}this.#x+=e[n],o&&(o.entrySize=a,o.totalCalculatedSize=this.#x)}}#C=e=>{};#E=(e,n,a)=>{};#D=(e,n,a,o)=>{if(a||o)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#w({allowStale:e=this.allowStale}={}){if(this.#a)for(let n=this.#o;!(!this.#F(n)||((e||!this.#f(n))&&(yield n),n===this.#r));)n=this.#h[n]}*#j({allowStale:e=this.allowStale}={}){if(this.#a)for(let n=this.#r;!(!this.#F(n)||((e||!this.#f(n))&&(yield n),n===this.#o));)n=this.#c[n]}#F(e){return e!==void 0&&this.#n.get(this.#s[e])===e}*entries(){for(const e of this.#w())this.#e[e]!==void 0&&this.#s[e]!==void 0&&!this.#t(this.#e[e])&&(yield[this.#s[e],this.#e[e]])}*rentries(){for(const e of this.#j())this.#e[e]!==void 0&&this.#s[e]!==void 0&&!this.#t(this.#e[e])&&(yield[this.#s[e],this.#e[e]])}*keys(){for(const e of this.#w()){const n=this.#s[e];n!==void 0&&!this.#t(this.#e[e])&&(yield n)}}*rkeys(){for(const e of this.#j()){const n=this.#s[e];n!==void 0&&!this.#t(this.#e[e])&&(yield n)}}*values(){for(const e of this.#w())this.#e[e]!==void 0&&!this.#t(this.#e[e])&&(yield this.#e[e])}*rvalues(){for(const e of this.#j())this.#e[e]!==void 0&&!this.#t(this.#e[e])&&(yield this.#e[e])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(e,n={}){for(const a of this.#w()){const o=this.#e[a],i=this.#t(o)?o.__staleWhileFetching:o;if(i!==void 0&&e(i,this.#s[a],this))return this.get(this.#s[a],n)}}forEach(e,n=this){for(const a of this.#w()){const o=this.#e[a],i=this.#t(o)?o.__staleWhileFetching:o;i!==void 0&&e.call(n,i,this.#s[a],this)}}rforEach(e,n=this){for(const a of this.#j()){const o=this.#e[a],i=this.#t(o)?o.__staleWhileFetching:o;i!==void 0&&e.call(n,i,this.#s[a],this)}}purgeStale(){let e=!1;for(const n of this.#j({allowStale:!0}))this.#f(n)&&(this.delete(this.#s[n]),e=!0);return e}info(e){const n=this.#n.get(e);if(n===void 0)return;const a=this.#e[n],o=this.#t(a)?a.__staleWhileFetching:a;if(o===void 0)return;const i={value:o};if(this.#m&&this.#b){const r=this.#m[n],l=this.#b[n];if(r&&l){const c=r-(Tt.now()-l);i.ttl=c,i.start=Date.now()}}return this.#S&&(i.size=this.#S[n]),i}dump(){const e=[];for(const n of this.#w({allowStale:!0})){const a=this.#s[n],o=this.#e[n],i=this.#t(o)?o.__staleWhileFetching:o;if(i===void 0||a===void 0)continue;const r={value:i};if(this.#m&&this.#b){r.ttl=this.#m[n];const l=Tt.now()-this.#b[n];r.start=Math.floor(Date.now()-l)}this.#S&&(r.size=this.#S[n]),e.unshift([a,r])}return e}load(e){this.clear();for(const[n,a]of e){if(a.start){const o=Date.now()-a.start;a.start=Tt.now()-o}this.set(n,a.value,a)}}set(e,n,a={}){if(n===void 0)return this.delete(e),this;const{ttl:o=this.ttl,start:i,noDisposeOnSet:r=this.noDisposeOnSet,sizeCalculation:l=this.sizeCalculation,status:c}=a;let{noUpdateTTL:m=this.noUpdateTTL}=a;const d=this.#D(e,n,a.size||0,l);if(this.maxEntrySize&&d>this.maxEntrySize)return c&&(c.set="miss",c.maxEntrySizeExceeded=!0),this.delete(e),this;let h=this.#a===0?void 0:this.#n.get(e);if(h===void 0)h=this.#a===0?this.#o:this.#v.length!==0?this.#v.pop():this.#a===this.#l?this.#R(!1):this.#a,this.#s[h]=e,this.#e[h]=n,this.#n.set(e,h),this.#c[this.#o]=h,this.#h[h]=this.#o,this.#o=h,this.#a++,this.#E(h,d,c),c&&(c.set="add"),m=!1;else{this.#k(h);const g=this.#e[h];if(n!==g){if(this.#M&&this.#t(g)){g.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:p}=g;p!==void 0&&!r&&(this.#y&&this.#g?.(p,e,"set"),this.#u&&this.#i?.push([p,e,"set"]))}else r||(this.#y&&this.#g?.(g,e,"set"),this.#u&&this.#i?.push([g,e,"set"]));if(this.#C(h),this.#E(h,d,c),this.#e[h]=n,c){c.set="replace";const p=g&&this.#t(g)?g.__staleWhileFetching:g;p!==void 0&&(c.oldValue=p)}}else c&&(c.set="update")}if(o!==0&&!this.#m&&this.#P(),this.#m&&(m||this.#I(h,o,i),c&&this.#_(c,h)),!r&&this.#u&&this.#i){const g=this.#i;let p;for(;p=g?.shift();)this.#p?.(...p)}return this}pop(){try{for(;this.#a;){const e=this.#e[this.#r];if(this.#R(!0),this.#t(e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(e!==void 0)return e}}finally{if(this.#u&&this.#i){const e=this.#i;let n;for(;n=e?.shift();)this.#p?.(...n)}}}#R(e){const n=this.#r,a=this.#s[n],o=this.#e[n];return this.#M&&this.#t(o)?o.__abortController.abort(new Error("evicted")):(this.#y||this.#u)&&(this.#y&&this.#g?.(o,a,"evict"),this.#u&&this.#i?.push([o,a,"evict"])),this.#C(n),e&&(this.#s[n]=void 0,this.#e[n]=void 0,this.#v.push(n)),this.#a===1?(this.#r=this.#o=0,this.#v.length=0):this.#r=this.#c[n],this.#n.delete(a),this.#a--,n}has(e,n={}){const{updateAgeOnHas:a=this.updateAgeOnHas,status:o}=n,i=this.#n.get(e);if(i!==void 0){const r=this.#e[i];if(this.#t(r)&&r.__staleWhileFetching===void 0)return!1;if(this.#f(i))o&&(o.has="stale",this.#_(o,i));else return a&&this.#T(i),o&&(o.has="hit",this.#_(o,i)),!0}else o&&(o.has="miss");return!1}peek(e,n={}){const{allowStale:a=this.allowStale}=n,o=this.#n.get(e);if(o===void 0||!a&&this.#f(o))return;const i=this.#e[o];return this.#t(i)?i.__staleWhileFetching:i}#N(e,n,a,o){const i=n===void 0?void 0:this.#e[n];if(this.#t(i))return i;const r=new qs,{signal:l}=a;l?.addEventListener("abort",()=>r.abort(l.reason),{signal:r.signal});const c={signal:r.signal,options:a,context:o},m=(f,v=!1)=>{const{aborted:x}=r.signal,M=a.ignoreFetchAbort&&f!==void 0;if(a.status&&(x&&!v?(a.status.fetchAborted=!0,a.status.fetchError=r.signal.reason,M&&(a.status.fetchAbortIgnored=!0)):a.status.fetchResolved=!0),x&&!M&&!v)return h(r.signal.reason);const S=p;return this.#e[n]===p&&(f===void 0?S.__staleWhileFetching?this.#e[n]=S.__staleWhileFetching:this.delete(e):(a.status&&(a.status.fetchUpdated=!0),this.set(e,f,c.options))),f},d=f=>(a.status&&(a.status.fetchRejected=!0,a.status.fetchError=f),h(f)),h=f=>{const{aborted:v}=r.signal,x=v&&a.allowStaleOnFetchAbort,M=x||a.allowStaleOnFetchRejection,S=M||a.noDeleteOnFetchRejection,b=p;if(this.#e[n]===p&&(!S||b.__staleWhileFetching===void 0?this.delete(e):x||(this.#e[n]=b.__staleWhileFetching)),M)return a.status&&b.__staleWhileFetching!==void 0&&(a.status.returnedStale=!0),b.__staleWhileFetching;if(b.__returned===b)throw f},g=(f,v)=>{const x=this.#A?.(e,i,c);x&&x instanceof Promise&&x.then(M=>f(M===void 0?void 0:M),v),r.signal.addEventListener("abort",()=>{(!a.ignoreFetchAbort||a.allowStaleOnFetchAbort)&&(f(void 0),a.allowStaleOnFetchAbort&&(f=M=>m(M,!0)))})};a.status&&(a.status.fetchDispatched=!0);const p=new Promise(g).then(m,d),y=Object.assign(p,{__abortController:r,__staleWhileFetching:i,__returned:void 0});return n===void 0?(this.set(e,y,{...c.options,status:void 0}),n=this.#n.get(e)):this.#e[n]=y,y}#t(e){if(!this.#M)return!1;const n=e;return!!n&&n instanceof Promise&&n.hasOwnProperty("__staleWhileFetching")&&n.__abortController instanceof qs}async fetch(e,n={}){const{allowStale:a=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,ttl:r=this.ttl,noDisposeOnSet:l=this.noDisposeOnSet,size:c=0,sizeCalculation:m=this.sizeCalculation,noUpdateTTL:d=this.noUpdateTTL,noDeleteOnFetchRejection:h=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:g=this.allowStaleOnFetchRejection,ignoreFetchAbort:p=this.ignoreFetchAbort,allowStaleOnFetchAbort:y=this.allowStaleOnFetchAbort,context:f,forceRefresh:v=!1,status:x,signal:M}=n;if(!this.#M)return x&&(x.fetch="get"),this.get(e,{allowStale:a,updateAgeOnGet:o,noDeleteOnStaleGet:i,status:x});const S={allowStale:a,updateAgeOnGet:o,noDeleteOnStaleGet:i,ttl:r,noDisposeOnSet:l,size:c,sizeCalculation:m,noUpdateTTL:d,noDeleteOnFetchRejection:h,allowStaleOnFetchRejection:g,allowStaleOnFetchAbort:y,ignoreFetchAbort:p,status:x,signal:M};let b=this.#n.get(e);if(b===void 0){x&&(x.fetch="miss");const w=this.#N(e,b,S,f);return w.__returned=w}else{const w=this.#e[b];if(this.#t(w)){const A=a&&w.__staleWhileFetching!==void 0;return x&&(x.fetch="inflight",A&&(x.returnedStale=!0)),A?w.__staleWhileFetching:w.__returned=w}const N=this.#f(b);if(!v&&!N)return x&&(x.fetch="hit"),this.#k(b),o&&this.#T(b),x&&this.#_(x,b),w;const C=this.#N(e,b,S,f),_=C.__staleWhileFetching!==void 0&&a;return x&&(x.fetch=N?"stale":"refresh",_&&N&&(x.returnedStale=!0)),_?C.__staleWhileFetching:C.__returned=C}}get(e,n={}){const{allowStale:a=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,status:r}=n,l=this.#n.get(e);if(l!==void 0){const c=this.#e[l],m=this.#t(c);return r&&this.#_(r,l),this.#f(l)?(r&&(r.get="stale"),m?(r&&a&&c.__staleWhileFetching!==void 0&&(r.returnedStale=!0),a?c.__staleWhileFetching:void 0):(i||this.delete(e),r&&a&&(r.returnedStale=!0),a?c:void 0)):(r&&(r.get="hit"),m?c.__staleWhileFetching:(this.#k(l),o&&this.#T(l),c))}else r&&(r.get="miss")}#L(e,n){this.#h[n]=e,this.#c[e]=n}#k(e){e!==this.#o&&(e===this.#r?this.#r=this.#c[e]:this.#L(this.#h[e],this.#c[e]),this.#L(this.#o,e),this.#o=e)}delete(e){let n=!1;if(this.#a!==0){const a=this.#n.get(e);if(a!==void 0)if(n=!0,this.#a===1)this.clear();else{this.#C(a);const o=this.#e[a];if(this.#t(o)?o.__abortController.abort(new Error("deleted")):(this.#y||this.#u)&&(this.#y&&this.#g?.(o,e,"delete"),this.#u&&this.#i?.push([o,e,"delete"])),this.#n.delete(e),this.#s[a]=void 0,this.#e[a]=void 0,a===this.#o)this.#o=this.#h[a];else if(a===this.#r)this.#r=this.#c[a];else{const i=this.#h[a];this.#c[i]=this.#c[a];const r=this.#c[a];this.#h[r]=this.#h[a]}this.#a--,this.#v.push(a)}}if(this.#u&&this.#i?.length){const a=this.#i;let o;for(;o=a?.shift();)this.#p?.(...o)}return n}clear(){for(const e of this.#j({allowStale:!0})){const n=this.#e[e];if(this.#t(n))n.__abortController.abort(new Error("deleted"));else{const a=this.#s[e];this.#y&&this.#g?.(n,a,"delete"),this.#u&&this.#i?.push([n,a,"delete"])}}if(this.#n.clear(),this.#e.fill(void 0),this.#s.fill(void 0),this.#m&&this.#b&&(this.#m.fill(0),this.#b.fill(0)),this.#S&&this.#S.fill(0),this.#r=0,this.#o=0,this.#v.length=0,this.#x=0,this.#a=0,this.#u&&this.#i){const e=this.#i;let n;for(;n=e?.shift();)this.#p?.(...n)}}}function sf({conversationId:t,messageId:e}){const[n,a]=u.useState(!1),o=u.useRef({isMediaSourceAvailable:aa(),mediaSourceFormat:oa()??"n/a",playPromise:null,shouldAbortQueuedPlayback:!1}).current,i=Ue(),r=Ln(),{voiceName:l}=eu(),c=`${t}.${e}.${l}`,m=br(),d=yr(f=>f.isPlaying&&f.sourceUrl===Pe.get(c)?.src),h=u.useCallback(async()=>{if(!m)return;a(!0);const f={isMediaSourceAvailable:o.isMediaSourceAvailable,format:o.mediaSourceFormat};try{const v=await nf({key:c,message_id:e,conversation_id:t,voice:l,onStreamingError:x=>{Nt.readAloud.error(x,f),a(!1),r.danger(i.formatMessage(Ka.playbackError,{error:x.message}))},onStreamingStart:()=>{a(!1)}});if(o.shouldAbortQueuedPlayback){o.shouldAbortQueuedPlayback=!1;return}m.changeSource(v),o.playPromise=m.play()}catch(v){Nt.readAloud.error(v,f),a(!1),r.danger(i.formatMessage(Ka.playbackError,{error:v.message}))}},[m,o,c,e,t,l,r,i]),g=u.useCallback(()=>{const f=ba();f&&(o.playPromise?o.playPromise.then(()=>{f.stop(),o.playPromise=null}):f.stop())},[o]),p=u.useCallback(()=>{const f=ba();f&&(f.state.isPlaying&&f.state.sourceUrl===Pe.get(c)?.src?g():(Nt.readAloud.click({isMediaSourceAvailable:o.isMediaSourceAvailable,format:o.mediaSourceFormat}),h()))},[c,o,h,g]);u.useEffect(()=>{n&&d&&a(!1)},[n,d]);const y=u.useRef(c);return u.useEffect(()=>{y.current=c}),u.useEffect(()=>(o.shouldAbortQueuedPlayback=!1,()=>{const f=wr();f.isPlaying&&f.sourceUrl===Pe.get(y.current)?.src?g():o.shouldAbortQueuedPlayback=!0}),[o,g]),{togglePlayback:p,isPlaying:d,isLoading:n}}async function Ni({message_id:t,conversation_id:e,voice:n}){const a=await dt.synthesize({message_id:t,conversation_id:e,voice:n,format:oa()}),o=a.headers.get("content-type")??"audio/aac";return{response:a,format:o}}async function nf(t){return aa()?of(t):af(t)}async function af({key:t,...e}){const n=Pe.get(t);if(n?.blob)return n.src;const{response:a,format:o}=await Ni(e),i=await a.arrayBuffer(),r=new Blob([i],{type:o}),l=Pi({key:t,src:URL.createObjectURL(r),format:o,blob:r});return Pe.set(t,l),l.src}async function of({key:t,onStreamingError:e,onStreamingStart:n,...a}){let o=Pe.get(t);o?.streaming&&(Pe.delete(t),o=void 0);let i,r;const l=lf(),c=new l;if(o)i=o,i.src=URL.createObjectURL(c);else{const{format:h,response:g}=await Ni(a);r=g,i=Pi({key:t,src:URL.createObjectURL(c),format:h})}const m=rf(i.id),d={sourceopen:async()=>{m("sourceopen");const h=c.addSourceBuffer(i.format),g=async()=>{h.updating&&await new Promise(p=>h.addEventListener("updateend",p,{once:!0}))};if(i.segments.length&&!i.streaming){m("streaming from cache"),i.streaming=!0,n();for(const p of i.segments)h.appendBuffer(p),await g();c.readyState==="open"&&c.endOfStream(),i.streaming=!1,m("done streaming from cache");return}if(r){m("fetching audio");try{const p=r.body?.getReader();if(!p)return;for(;Pe.get(t)?.id===i.id;){const{done:y,value:f}=await p.read();if(y){m("done streaming"),i.streaming=!1,c.readyState==="open"&&c.endOfStream();break}if(!Array.from(c.sourceBuffers).includes(h)){m("stop streaming, source buffer removed"),i.streaming=!1;break}i.streaming||(m("start streaming"),i.streaming=!0,n()),h.appendBuffer(f),i.segments.push(f),await g()}}catch(p){if(m("error while streaming",p),i.streaming=!1,c.readyState==="open")try{c.endOfStream("network")}catch(y){Nt.readAloud.error(y)}Pe.delete(t),e(p)}}},sourceclose:()=>{m("sourceclose"),i.streaming&&(i.streaming=!1,Pe.get(t)?.id===i.id&&(m("sourceclosed while streaming, cleaning up cache"),Pe.delete(t)))},sourceended:kt};for(const[h,g]of Object.entries(d))c.addEventListener(h,()=>{try{return g()}catch(p){Nt.readAloud.error(p)}});return Pe.set(t,i),i.src}const Ka=Le({playbackError:{id:"useVoiceReadAloudAudio.playbackError",defaultMessage:"Failed to play message"}}),rf=t=>kt;function lf(){return aa()?window.MediaSource:null}function aa(){return!!oa()}function oa(){if("MediaSource"in window){const t=e=>jr(e)&&MediaSource.isTypeSupported(e);if(t("audio/aac"))return"aac";if(t("audio/mpeg"))return"mp3";if(t("audio/ogg"))return"ogg"}}const Pi=t=>({id:xo(),segments:[],streaming:!1,...t}),Pe=new na({max:50,dispose:t=>{URL.revokeObjectURL(t.src)}}),cf=u.memo(function(e){const n=On("1923022511")?.value,a=Ht(e.conversationId),{errCode:o}=Qo(e.message);if(!n||!a||o)return null;const i=Zo.getAudioAssetPointers(e.message.message)[0];return i?s.jsx(uf,{audioAssetPointer:i,conversationId:a}):s.jsx(df,{...e,conversationId:a})});function uf({audioAssetPointer:t,conversationId:e}){const{isLoading:n,isPlaying:a,togglePlayback:o}=tu({audioAssetPointer:t,conversationId:e});return s.jsx(Ii,{onClick:o,isPlaying:a,isLoading:n,playText:$s.replay,playIcon:Rd})}function df({conversationId:t,message:e}){const{isLoading:n,isPlaying:a,togglePlayback:o}=sf({conversationId:t,messageId:e.message.id});return s.jsx(Ii,{onClick:o,isPlaying:a,isLoading:n,playText:$s.play,playIcon:Nd})}function Ii({onClick:t,isPlaying:e,isLoading:n,playText:a,playIcon:o}){let i,r;const l=Ue();return n?(i=_r,r=$s.loading):e?(i=Pd,r=$s.stop):(i=o,r=a),s.jsx(Jt,{icon:i,label:r?l.formatMessage(r):void 0,disabled:n,onClick:t,style:e||n?{visibility:"visible"}:void 0,testId:"voice-play-turn-action-button"})}const $s={replay:{id:"VoiceReadOutLoudButton.replay",defaultMessage:"Replay",description:"The tooltip for the replay button"},play:{id:"VoiceReadOutLoudButton.play",defaultMessage:"Read aloud",description:"The tooltip for the read aloud button"},stop:{id:"VoiceReadOutLoudButton.stop",defaultMessage:"Stop",description:"The tooltip for the stop button"},loading:{id:"VoiceReadOutLoudButton.loading",defaultMessage:"Loading",description:"The tooltip for the spinner"}},Ps="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function hf({className:t,clientThreadId:e,message:n,onModelSelect:a,onDropdownChange:o,canRegenerateResponse:i}){const[l,c]=u.useState(null),[m,d]=u.useState(!1),[h,g]=u.useState(!1),p=Ve(e),y=Yo({clientThreadId:e,message:n}),f=n.message.metadata?.model_slug,v=n.message.id,{modelOptions:x,modelSlug:M,animateModelLabelOnRender:S,messageModelEnabledTools:b}=y,w=Xo(n.message),N=b.includes(Xs.Search),C=u.useMemo(()=>x.find(k=>k.value===f),[x,f]),j=u.useRef(null),{doesUserHaveAnyAccountsWithPlusFeatures:_}=vo(),A=k=>{k||setTimeout(()=>{j.current&&j.current.blur()},10)};if(u.useEffect(()=>{A(m)},[m]),su(e))return null;const z=i&&x.some(k=>os(k,_));return p?null:s.jsxs(Ie.Root,{onOpenChange:k=>{i&&(d(k),o(k),A(k)),k&&ee.logEvent(Q.conversationOpenMessageModelSelector,{has_get_plus_button:z,is_new_regen_dropdown:!0})},children:[i?s.jsx(ff,{label:s.jsx(H,{id:"wDs5sz",defaultMessage:"Switch model"}),children:s.jsx(So,{ref:j,className:P("cursor-pointer",t),onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:s.jsx(In,{modelSlug:M,animateModelLabelOnRender:S,isDropdownOpen:m,isRegenerateEnabled:i,isHovered:h,isRegenLabel:!0,omitIcon:!1})})}):s.jsx("button",{className:P("cursor-pointer",t),onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:s.jsx(In,{modelSlug:M,animateModelLabelOnRender:S,isDropdownOpen:!1,isRegenerateEnabled:!1,isHovered:h,omitIcon:!0,animateShortLabel:!0})}),i&&s.jsx(Ie.Portal,{children:s.jsxs(Ie.Content,{className:"z-30 min-w-fit origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[s.jsx(Ie.Item,{disabled:!0,className:"pb-0 pt-2",children:s.jsx("span",{className:"text-token-text-secondary",children:s.jsx(H,{id:"bFLh5u",defaultMessage:"Switch model"})})}),s.jsx(mf,{clientThreadId:e,messageId:v,onModelSelect:a,messageModelSlug:f,omitModelIcons:!0,modelOptions:x,setHoveredOption:c,hoveredOption:l,retryOption:C,lastResponseUsedSearch:w,modelSupportsSearch:N,doesUserHaveAnyAccountsWithPlusFeatures:_})]})})]})}function mf({clientThreadId:t,messageId:e,modelOptions:n,messageModelSlug:a,onModelSelect:o,omitModelIcons:i,setHoveredOption:r,hoveredOption:l,retryOption:c,lastResponseUsedSearch:m,modelSupportsSearch:d,doesUserHaveAnyAccountsWithPlusFeatures:h}){const g=Ue(),[p,y]=u.useMemo(()=>nu(n,S=>S.subcategory),[n]),f=u.useMemo(()=>{const S=new Map;return p.forEach(b=>{const w=b.subcategory;w&&(S.has(w)||S.set(w,[]),S.get(w)?.push(b))}),S},[p]),v=P("icon-sm",i&&"order-10 ml-auto text-token-text-tertiary icon-md"),x=i?"right":"left",M=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:g.formatMessage(pn.search),icon:s.jsx(us,{className:v}),condition:d&&!m,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:g.formatMessage(pn.nosearch),icon:s.jsx(ri,{className:v}),condition:d&&m,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return s.jsxs(s.Fragment,{children:[y.map(S=>{const{value:b,...w}=S;return s.jsx(At,{value:b,onSelect:()=>{fe.logEvent("chatgpt_regenerate_switch_model_button_clicked",b,{requestedModelId:b,...Ze({clientThreadId:t,messageId:e})}),o({requestedModelId:b})},includeRegenerate:!1,onMouseEnter:()=>r(b),onMouseLeave:()=>r(null),isHovered:l===b,messageModelSlug:a,includeCheck:!1,shouldShowUpsell:os(S,h),className:Ps,...w,icon:i?s.jsx("span",{className:v}):w.icon,justifyIcon:x,wrapIcon:!i},b)}),[...f.entries()].map(([S,b])=>s.jsxs(Ie.Sub,{children:[s.jsx(Ie.SubMenuTrigger,{children:s.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:S})}),s.jsx(Ie.Portal,{children:s.jsx(Ie.SubContent,{className:"min-w-fit",children:b.map(w=>{const{value:N,...C}=w;return s.jsx(At,{value:N,onSelect:()=>{fe.logEvent("chatgpt_regenerate_switch_model_button_clicked",N,{requestedModelId:N,...Ze({clientThreadId:t,messageId:e})}),o({requestedModelId:N})},includeRegenerate:!1,onMouseEnter:()=>r(N),onMouseLeave:()=>r(null),isHovered:l===N,messageModelSlug:a,includeCheck:!1,className:Ps,...C,icon:null,justifyIcon:x,wrapIcon:!i,shouldShowUpsell:os(w,h)},S+"-"+N)})})})]},S)),!!c&&s.jsxs(s.Fragment,{children:[s.jsx(Ie.Separator,{}),s.jsx(At,{onSelect:()=>{fe.logEvent("chatgpt_regenerate_try_again_button_clicked",c.value,{requestedModelId:c.value,...Ze({clientThreadId:t,messageId:e})}),o({requestedModelId:c.value})},includeRegenerate:!0,onMouseEnter:()=>r(c.value),onMouseLeave:()=>r(null),messageModelSlug:a,includeCheck:!1,className:Ps,...c,label:g.formatMessage(pn.tryAgain),subtitle:c.label,icon:s.jsx(Zn,{className:v}),justifyIcon:x,wrapIcon:!i},c.value),M.filter(S=>S.condition).map(S=>s.jsx(At,{onSelect:()=>{fe.logEvent(S.eventName,c.value,{requestedModelId:c.value,...Ze({clientThreadId:t,messageId:e})}),o({requestedModelId:c.value,extraStreamParams:S.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>r(S.key),onMouseLeave:()=>r(null),isHovered:l===S.key,messageModelSlug:a,includeCheck:!1,className:Ps,...c,label:S.label,subtitle:"",icon:S.icon,justifyIcon:x,wrapIcon:!i},S.key))]})]})}function ff({children:t,label:e}){return s.jsx(Fn,{label:e,sideOffset:0,children:t})}const pn=Le({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),gf=u.memo(hf),Ya=Lt(()=>Bt(()=>import("./h7m9odjd9i4xn2nr.js").then(t=>t.qS),__vite__mapDeps([5,1,2,3,6])).then(t=>t.MemoryActionResult));function Xa(t,e,n){J.updateTree(t,a=>{a.updateNodeMetadata(e,{inlineComparisonRating:n})})}function Qa(t){return{is_dark_mode:t==="dark",time_since_loaded:Math.floor(performance.now()/1e3),page_height:window?.innerHeight,page_width:window?.innerWidth,pixel_ratio:window?.devicePixelRatio,screen_height:window?.screen?.height,screen_width:window?.screen?.width}}const Za=({messages:t})=>{for(const{message:{metadata:e}}of t){const{augmented_paragen_prompt_label:n}=e??{};if(n)return n}};function pf(t){const e=u.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});return t.stubSideBySideFeedback?s.jsx(Di,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:e,...t}):s.jsx(xf,{...t,visibilityStateRef:e})}function xf(t){const{clientThreadId:e,variantIds:n,variantsInStreamInfo:a,turnIndex:o}=t;if(n.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const i=ia(),r=Sf(),[l]=u.useState(()=>Date.now()),c=$n(),{resolvedTheme:m}=Mr(),[d,h]=u.useMemo(()=>Jo(n.join(""))()<.5?[0,1]:[1,0],[n[0],n[1]]),g=d<h?"left":"right",p=g==="left"?"right":"left",y=n[d],f=n[h],v=Ct(ka(e,y)).id,x=Ct(ka(e,f)).id,M=Ct(Mn(e,o,v)),S=Ct(Mn(e,o,x)),b=g==="left"?M:S,w=g==="left"?S:M,N=a.display_treatment==="unskippable",C=i?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";u.useEffect(()=>(wn.setState({displayingSideBySideFeedback:!0,unskippable:N}),()=>{wn.setState({displayingSideBySideFeedback:!1,unskippable:!1})}),[N]),au();const j=u.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});u.useEffect(()=>Tr(ou,{requestCompletion:()=>{const A=it(b.messages)?.completionSampleFinishTime,O=it(w.messages)?.completionSampleFinishTime,z=J.getServerThreadId(e);if(r){const F=J.getTree(e).getParentPromptNode(v),L=[M,S].map(R=>({messageId:R.messages[R.messages.length-1].message.id,loadEndTime:it(R.messages)?.completionSampleFinishTime})),E={};for(const R of L)E[R.messageId]={load_first_token_time:l,load_end_time:R.loadEndTime};Is({shouldUseNewParagenEndpoint:r,params:{conversation_id:z,displayed_message_ids:L.map(R=>R.messageId),message_metadatas:E,rating:"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:i?2:1,user_prompt_message_id:F.message.id}})}else Is({shouldUseNewParagenEndpoint:r,params:{feedback_version:C,original_message_id:b.messages[b.messages.length-1]?.message.id,new_message_id:w.messages[w.messages.length-1]?.message.id,conversation_id:z,completion_comparison_rating:"skip",new_completion_placement:p,feedback_start_time:l,compare_step_start_time:l,original_completion_load_start_time:l,original_completion_load_end_time:A??0,new_completion_load_start_time:l,new_completion_load_end_time:O??0,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:Qa(m),...j.current}})}}),[M,S,v,e,l,C,p,b?.messages,w?.messages,m,r,i]);const _=A=>{const z=J.getTree(e).getLeafFromNode(A);J.setThreadCurrentLeafId(e,z.id);const k=A===y,F=k===(g==="left"),L=it(b.messages)?.completionSampleFinishTime,E=it(w.messages)?.completionSampleFinishTime;b.messages.length>0&&Xa(e,b.messages[b.messages.length-1].nodeId,F?"original":"new"),w.messages.length>0&&Xa(e,w.messages[w.messages.length-1].nodeId,F?"original":"new");let R;L==null||E==null?R=F?"partial_load_comparison_original":"partial_load_comparison_new":R=F?"original":"new";const B=J.getServerThreadId(e);if(r){const $=[M,S].map(X=>({messageId:X.messages[X.messages.length-1].message.id,loadEndTime:it(X.messages)?.completionSampleFinishTime})),oe=k?$[0].messageId:$[1].messageId,de=J.getTree(e).getParentPromptNode(v),ge={};for(const X of $)ge[X.messageId]={load_first_token_time:l,load_end_time:X.loadEndTime};Is({shouldUseNewParagenEndpoint:r,params:{conversation_id:B,displayed_message_ids:$.map(X=>X.messageId),message_metadatas:ge,rating:"selected",selected_message_id:oe,source_timestamp:Date.now(),ui_variant:i?2:1,user_prompt_message_id:de.message.id}})}else Is({shouldUseNewParagenEndpoint:r,params:{feedback_version:C,original_message_id:b.messages[b.messages.length-1]?.message.id,new_message_id:w.messages[w.messages.length-1]?.message.id,conversation_id:B,completion_comparison_rating:R,new_completion_placement:p,feedback_start_time:l,compare_step_start_time:l,original_completion_load_start_time:l,original_completion_load_end_time:L??null,new_completion_load_start_time:l,new_completion_load_end_time:E??null,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:Qa(m),...j.current}})};return s.jsx(Di,{...t,setPreferredFeedback:_,leftVariantId:y,rightVariantId:f,leftTurn:M,rightTurn:S,hasActiveRequest:c,originalTurn:b,visibilityStateRef:j})}function vf(t){if(!t.length)return!1;const e=t.filter(n=>n.type===Ea.Text||n.type===Ea.MultiText).filter(n=>n.message.message.status!=="finished_successfully"&&n.message.message.metadata?.snorkle_status!==void 0);return e.length>0&&e.every(n=>{const a=n.message.message.content;return a?.content_type===bo.Text&&a.parts.join("")===""})}function Di({setPreferredFeedback:t,leftVariantId:e,rightVariantId:n,leftTurn:a,rightTurn:o,hasActiveRequest:i,originalTurn:r,visibilityStateRef:l,...c}){const{defaultParagenLabel:m,shouldShowParagenLabels:d=!1}=Ao(),h=a&&Za(a)||m,g=o&&Za(o)||m,p=u.useMemo(()=>a?.messages??[],[a?.messages]),y=u.useMemo(()=>o?.messages??[],[o?.messages]),{avatarClassName:f}=c,v=u.useMemo(()=>Gs(p),[p]),x=u.useMemo(()=>Gs(y),[y]),M=yo(),[S,b]=u.useMemo(()=>[v,x].map(B=>vf(B)),[v,x]),w=ht(a?Vs.getRequestIdFromConversationTurn(a):"")||S,N=ht(o?Vs.getRequestIdFromConversationTurn(o):"")||b,C=a?.role===Me.User,j=o?.role===Me.User,_=u.useRef(null),A=u.useRef(null),O=u.useRef(null),z=c.stubSideBySideFeedback||S,k=c.stubSideBySideFeedback||b;u.useEffect(()=>{if(_.current&&A.current&&O.current){const B=Array(11).fill(0).map((oe,W)=>W/10),$=new IntersectionObserver(oe=>oe.forEach(W=>{W.target===A.current?(l.current.left_visibility_initial==null&&(l.current.left_visibility_initial=W.intersectionRatio),l.current.left_visibility_max=Math.max(l.current.left_visibility_max??0,W.intersectionRatio)):W.target===O.current&&(l.current.right_visibility_initial==null&&(l.current.right_visibility_initial=W.intersectionRatio),l.current.right_visibility_max=Math.max(l.current.right_visibility_max??0,W.intersectionRatio))}),{root:_.current,threshold:B});return $.observe(A.current),$.observe(O.current),()=>$.disconnect()}},[l]);const{data:F}=wo(void 0,!1,M),L=ia(),E=s.jsx("div",{className:"text-pretty px-6 pb-5 pt-1 text-center text-sm text-token-text-secondary",children:s.jsx(H,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),R=Je();return s.jsxs("div",{className:"relative flex flex-col",children:[s.jsxs("div",{className:P("sticky z-[1] text-pretty bg-token-main-surface-primary px-6 text-center text-lg",R&&"top-[var(--thread-leading-height)] pt-3",!R&&"top-[-1px]",L&&!R?"md:top-header-height":R?"":"md:static"),"data-testid":"paragen-feedback-title",children:[s.jsx(H,{id:"JgCHDY",defaultMessage:"You’re giving feedback on a new version of ChatGPT."}),L?E:null]}),L?null:E,s.jsx("div",{className:"relative -mb-2 snap-x snap-mandatory overflow-x-auto px-3 pb-4 md:px-5 lg:px-10",ref:_,children:s.jsx("div",{className:P(!R&&"min-w-fit"),children:s.jsxs("div",{className:P("mx-auto flex max-w-6xl items-start",L&&!R&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",!L&&!R&&"gap-4 sm:gap-6",L&&R&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",R&&!L&&"gap-4 sm:gap-6"),children:[s.jsxs(Ja,{horizontalScrollContainerRef:_,rootElementRef:A,onClick:()=>{t(e)},hasActiveRequest:i,isWaitingOnFirstUserVisibleToken:z,children:[s.jsxs(so,{children:[s.jsx(Tn,{messages:p,isUserTurn:C,avatarClassName:f}),s.jsx(to,{children:d?s.jsx("span",{className:"font-bold text-token-text-primary",children:h}):s.jsx(H,{...ao.responseNumber,values:{responseIndex:1}})})]}),L&&z?s.jsx(eo,{}):s.jsxs(s.Fragment,{children:[F!=null&&!C&&s.jsx(Ya,{clientThreadId:c.clientThreadId,messages:p,isParagen:!0}),s.jsx(Cn,{...c,groupedMessagesToRender:v,allGroupedMessages:v,isEditing:!1,isUserTurn:C,isCompletionRequestInProgress:w,hasActiveRequest:i,handleEnterEdit:kt,handleExitEdit:kt,shouldGrowContainer:!1}),s.jsx(no,{turn:a,originalTurn:r})]})]}),s.jsxs(Ja,{horizontalScrollContainerRef:_,rootElementRef:O,onClick:()=>{t(n)},hasActiveRequest:i,isWaitingOnFirstUserVisibleToken:k,children:[s.jsxs(so,{children:[s.jsx(Tn,{messages:y,isUserTurn:j,avatarClassName:f}),s.jsx(to,{children:d?s.jsx("span",{className:"font-bold text-token-text-primary",children:g}):s.jsx(H,{...ao.responseNumber,values:{responseIndex:2}})})]}),L&&k?s.jsx(eo,{}):s.jsxs(s.Fragment,{children:[F!=null&&!j&&s.jsx(Ya,{clientThreadId:c.clientThreadId,messages:y,isParagen:!0}),s.jsx(Cn,{...c,groupedMessagesToRender:x,allGroupedMessages:x,isEditing:!1,isUserTurn:j,isCompletionRequestInProgress:N,hasActiveRequest:i,handleEnterEdit:kt,handleExitEdit:kt,shouldGrowContainer:!1}),s.jsx(no,{turn:o,originalTurn:r})]})]})]})})})]})}function Ja({horizontalScrollContainerRef:t,rootElementRef:e,onClick:n,children:a,hasActiveRequest:o,isWaitingOnFirstUserVisibleToken:i}){const r=ia(),l=Je(),{scrollX:c}=iu({layoutEffect:!1,container:t,target:e}),m=ru(),d=lu(),h=u.useRef(null),g=u.useRef(null),p=u.useRef(null),[y,f]=u.useState(!1),[v,x]=u.useState(!1),[M,S]=u.useState(!1),[b,w]=u.useState(0);u.useEffect(()=>{if(!r)return;const z=new IntersectionObserver(k=>{for(const F of k)F.target===h.current?f(F.isIntersecting):F.target===p.current?S(F.isIntersecting):F.target===g.current&&x(F.isIntersecting)},{root:m?.current,rootMargin:l?`0px 0px -${b}px 0px`:void 0});return h.current&&g.current&&p.current&&(z.observe(h.current),z.observe(g.current),z.observe(p.current)),()=>{z.disconnect()}},[b,r,l,m]);const N=!M&&(v||y),C=cu(c,z=>N?-1*z:0),j=Aa(0);u.useEffect(()=>{if(!r)return;const z=new ResizeObserver(k=>{Es(k.length===1,"entryList.length === 1");const F=k[0];Es(F.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),j.set(F.contentBoxSize[0].inlineSize)});return e.current&&z.observe(e.current),()=>{z.disconnect()}},[r,j,e]);const _=Aa(0);u.useEffect(()=>{if(!r)return;const z=new ResizeObserver(k=>{Es(k.length===1,"entryList.length === 1");const F=k[0];Es(F.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),_.set(F.contentBoxSize[0].blockSize+16),w(F.contentBoxSize[0].blockSize)});return d.current&&z.observe(d.current),()=>{z.disconnect()}},[r,_,d]);const A=s.jsx(zt,{className:r?"px-5":"mt-4 self-start",onClick:n,"data-testid":"paragen-prefer-response-button",children:s.jsx(H,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),O=i;return s.jsxs("div",{"data-paragen-root":!0,className:P("relative flex w-full min-w-[min(450px,80vw)] snap-center flex-col gap-1 text-left",l&&r&&"pl-3 pr-5 sm:w-[calc(100cqw-62px)] sm:pl-3 sm:pr-5 md:px-10",!l&&r&&"px-10",r?"min-h-60 py-4":"rounded-2xl border border-token-main-surface-tertiary bg-white p-5 dark:bg-gray-700"),ref:e,children:[s.jsx("div",{className:P("absolute left-0 right-0 top-48 h-px","invisible"),ref:h}),s.jsx("div",{className:P("absolute bottom-0 left-0 right-0 top-48","invisible"),ref:g}),s.jsx("div",{className:P("absolute bottom-0 left-0 right-0 h-px","invisible"),ref:p}),a,r?s.jsx("div",{className:"flex-1"}):null,r?s.jsx("div",{className:"mt-4 min-h-10",children:O?null:s.jsx(Y.div,{style:{translateX:C,width:j,bottom:_},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:P({fixed:N,"z-20 flex w-full justify-center":!0}),children:A})}):o?null:A]})}function eo(){return s.jsxs("div",{className:"flex w-full flex-col gap-4 pb-5 pt-3",children:[s.jsx(ot,{className:"h-4 w-[75%]"}),s.jsx(ot,{className:"h-4 w-[50%]"}),s.jsx(ot,{className:"h-4 w-[80%]"}),s.jsx(ot,{className:"h-4 w-[55%]"}),s.jsx(ot,{className:"h-4 w-[66%]"}),s.jsx(ot,{className:"h-4 w-[64%]"}),s.jsx(ot,{className:"h-4 w-[48%]"})]})}function ia(){const{layer:t}=He("3119715334");return t.get("should-enable-hojicha",!1)}const to=ve.div`text-sm text-token-text-secondary font-semibold`,so=ve.div`flex gap-4 items-center mb-1`,ot=ve.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function no({turn:t,originalTurn:e}){const n=Wn();if(!n.showParagenMetadata||!n.showDebugConversationTurns&&!n.forceParagen||t==null)return null;let a=t===e?"ORIGINAL":"NEW";const i=t.messages[t.messages.length-1]?.message?.metadata?.__internal;if(i){const{model_id:r,model_definition_slug:l,model_definition_virtual_model_id:c,alternative_model_selection_rule:m,augmented_paragen_prompt_group_id:d,augmented_paragen_prompt_id:h,augmented_paragen_prompt:g}=i;r&&(a+=`
Model ID: ${r}`),l&&(a+=`
Model Slug: ${l}`),c&&(a+=`
Virtual Model ID: ${c}`),m&&(a+=`
Alternative Model Rule: ${m}`),d&&(a+=`
Prompt Group ID: ${d}`),h&&(a+=`
Prompt ID: ${h}`),g&&(a+=`
Prompt: ${g}`)}return s.jsx("div",{className:"whitespace-pre-wrap text-sm text-red-500",children:a})}async function Is({shouldUseNewParagenEndpoint:t,params:e}){t?await dt.submitParagenSelectionV2(e):await dt.submitMessageComparisonFeedback(e)}function Sf(){const{value:t}=Te("3894844102");return t}const ao=Le({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}"}}),oo=[1,2,3,4,10,20,30],bf=.5;function yf({clientThreadId:t,conversationLeafId:e}){const n=ei(ti.isBusinessWorkspace),a=u.useRef(!1),o=Ht(t),i=en(t),{isUnauthenticated:r}=Ge(),l=u.useMemo(()=>{if(!o)return-1;const _=Jo(o);return _()>bf?-1:oo[Math.floor(_()*oo.length)]},[o]),c=uu(t,e),m=c[c.length-1],d=u.useMemo(()=>Vs.getRequestIdFromConversationTurn(m),[m]),h=ht(d),[g,p]=u.useState(null),[y,f]=u.useState(!1),[v,x]=u.useState(!1),[M,S]=u.useState(!1),b=_=>{const A=it(c)?.messages[0]?.message.id;p(_),C(A,_)},w=c.filter(_=>_.role===Me.Assistant).length,N=m?.role===Me.Assistant,C=u.useMemo(()=>$o((_,A)=>{o&&_&&dt.submitConversationRating({conversation_id:o,message_id:_,rating:A,shown_at_assistant_turn:l}),ee.logEvent(Q.conversationRatingSubmitted,{rating:A,showAtAssistantTurn:l,conversationId:o}),f(!0),setTimeout(()=>{x(!0)},1500)},2e3),[o,l]),j=w!==l||h||!N||!!n||i?.kind!==ut.PrimaryAssistant||M||r;return u.useEffect(()=>{!j&&!a.current&&(ee.logEvent(Q.conversationRatingShown,{showAtAssistantTurn:l,conversationId:o}),a.current=!0)},[j]),M||j?null:s.jsxs("div",{className:"mx-auto",children:[s.jsx(cs,{children:y&&!v&&s.jsx(Y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:s.jsx(io,{$padded:!0,children:s.jsx("span",{className:"text-sm text-token-text-tertiary",children:s.jsx(H,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!y&&s.jsx(Y.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:s.jsxs(io,{$padded:!1,children:[s.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-secondary",children:[s.jsx(H,{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?"}),s.jsxs("div",{className:"flex items-center gap-5",children:[s.jsx(xn,{$selected:g==="thumbsUp",onClick:()=>b("thumbsUp"),children:s.jsx(li,{className:"icon-md"})}),s.jsx(xn,{$selected:g==="thumbsDown",onClick:()=>b("thumbsDown"),children:s.jsx(ci,{className:"icon-md"})})]})]}),s.jsx("div",{className:"w-px flex-1 self-stretch bg-token-main-surface-tertiary"}),s.jsx(xn,{className:"p-3",$selected:!1,onClick:()=>S(!0),children:s.jsx(Id,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const xn=ve.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,io=ve.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`,wf=Lt(()=>Bt(()=>import("./jx8es1ztse3jx766.js"),__vite__mapDeps([62,1,2,3,5,6,24,19])));function jf({clientThreadId:t,conversationLeafId:e,canShowInlineMessageFeedback:n,messageForRating:a,allGroupedMessages:o,currentModelId:i}){let r=null;const l=du(t,e),c=Ht(t),m=Gn(h=>h.voiceFeedbackThread),d=c===m;return l?null:(d&&c?(Nt.feedbackShown.success(),r=s.jsx("div",{className:"text-center",children:s.jsx(hu,{serverThreadId:c})})):a.rating&&n?r=s.jsx(wf,{clientThreadId:t,conversationMessage:a,allGroupedMessages:o,currentModelId:i}):r=s.jsx("div",{className:"text-center",children:s.jsx(yf,{clientThreadId:t,conversationLeafId:e})}),s.jsx("div",{className:"mt-3 w-full empty:hidden",children:r}))}const ro=128;function _f(t){const{turnIndex:e,conversationLeafId:n,isFinalTurn:a,clientThreadId:o,onChangeItemInView:i,onChangeRating:r,currentModelId:l,avatarClassName:c,showAvatar:m=!0,scrollToMessageId:d}=t,h=Ue(),g=Un(),p=!!g&&kr(g),y=qn(),f=ei(ti.isBusinessWorkspace),v=Ln(),{value:x}=Te("2848981774"),M=J.getServerThreadId(o),S=Ct(Mn(o,e,n)),b=mu(S,e,o,n),{messages:w,variantIds:N,variantsInStreamInfo:C}=S,j=Gs(w),_=fu();let A=w[w.length-1];for(const U of j){const me=gu(U);if(me.some(jt=>_.has(jt.message.id))){A=me[me.length-1];break}}const O=w.slice(0,w.indexOf(A)+1),z=Uo(),[k,F]=u.useState(!1),[L,E]=u.useState(!1),R=N.findIndex(U=>O.some(me=>me.nodeId===U)),B=S.role===Me.User,$=rs(),oe=Ve(o),W=ls(S.gizmoId??oe)?.data,de=pu(),ge=W&&de.includes(W.gizmo.id),X=si(l),be=xu(l),re=Je(),ye=en(o,W?.gizmo.id),we=Go(o)===go.STREAMING,pe=Ot(),Ce=!1,{value:je}=On("2291672486"),he=O.some(U=>U.message.content.content_type===bo.MultimodalText),{layer:Be}=He("1547743984"),We=M&&z&&Be.get("show_share_button_inline",!1),{isUnauthenticated:D}=Ge(),[I,te]=u.useState(!1),[K,V]=u.useState(!1),ne=S.messages.map(U=>U.message.id),se=u.useRef(null),G=w[w.length-1],ae=G.rating,le=(d?.length??0)>2&&d!=="finalAgentTurn"&&a&&x&&re,ke=()=>{O.length===1&&(ee.logEvent(Q.editPrompt,{id:O[0].message.id,threadId:J.getServerThreadId(o)}),fe.logEvent("chatgpt_edit_prompt"),F(!0))},q=u.useCallback(()=>{F(!1)},[]),Ae=u.useCallback(U=>{vu(o,e,v,U)},[o,e,v]),ie=U=>{r({nodeId:G.nodeId,messageId:G.message.id,rating:U}),ee.logEvent(U==="thumbsDown"?Q.messageFeedbackThumbsDownClicked:Q.messageFeedbackThumbsUpClicked,{id:G.message.id,threadId:J.getServerThreadId(o),model:l,rating:U}),E(!0)},[gt]=u.useState(()=>Date.now()),pt=u.useMemo(()=>Vs.getRequestIdFromConversationTurn(S),[S]),ds=Vo({clientThreadId:o,conversationLeafId:n}),Ee=ht(pt)&&!ds,hs=$n(),et=Gs(O),Wt=u.useRef(!1);u.useEffect(()=>{Wt.current||d===void 0||!x||!re||!se.current||(ne.includes(d)||d==="finalAgentTurn"&&a)&&(Wt.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(se.current)if(d==="finalAgentTurn"&&a)se.current.scrollIntoView({behavior:"instant",block:"end"}),J.updateScrollToMessageId(o,void 0);else{const U=se.current.offsetHeight;let me;U>ro?me=ro-U:me=0,se.current.style.scrollMarginTop=`calc(${me}px + 2px + var(--thread-leading-height))`,se.current.scrollIntoView({behavior:"smooth"})}})}))},[d,se.current]);const{showDebugConversationTurns:Re}=Wn(),xt=qo(o),ms=Ko(o),qe=Su({clientThreadId:o,conversationMode:ye}),Gt=mt(o),vt=u.useCallback(({requestedModelId:U,systemMessage:me,juice:jt,extraStreamParams:_t})=>{const Ts=new ss;qe({id:G.nodeId,eventMetadata:{eventSource:"mouse"},turnTracker:Ts,requestedModelId:U,systemMessage:me,juice:jt,extraStreamParams:_t})},[G,qe]),Vt=Ce,St=!y&&!xt&&!$&&!B,fs=bu(),gs=A.message.author.role===Me.Assistant?A.message:null;yu({isCompletionRequestInProgress:Ee,isUserTurn:B,message:gs});const $e=wu(o,N),{isOpen:ps}=ju(),bt=_u(ye),xs=!fs&&!bt&&St&&a&&C?.num_variants_in_stream===2&&!G.inlineComparisonRating&&!$e,vs=Mu(S),yt=xs,Ss=xs&&!vs,Ke=!B&&!y&&!xt&&!bt&&!we&&!Ee&&!ps,qt=Ke&&(!f||Vt||be||p)&&!bt&&!D&&!$,tt=!y&&!((Ee||we)&&a)&&N.length>1&&!k&&!yt;let Ye=!1;if(B&&O.length===1){const{shouldHideContent:U}=Qo(O[0]);U&&(Ye=!0)}const _e=B&&!bt&&!y&&!he&&O.length===1&&!Ye&&!k&&!D,bs=U=>{i(N[U]),ee.logEvent(Q.changeNode,{intent:"toggle_between"})};if(!(S.role===Me.Root?!1:S.role===Me.System||S.role===Me.Developer||O.every(U=>U.message.metadata?.is_visually_hidden_from_conversation)?Re:!0)&&!yt)return s.jsx("div",{className:P(le?"min-h-[calc(100cqh-var(--thread-leading-height)-var(--thread-trailing-height)-var(--previous-turn-min-height))]":"")});const ws=O.some(({message:U})=>Zo.getAssetPointers(U).length>0),nn=!ws&&a&&ms&&!je?s.jsx(Jt,{onClick:()=>{fe.logEvent("chatgpt_regenerate_try_again_button_clicked",l,{requestedModelId:l,...Ze({clientThreadId:o,turnIndex:e})});const U=new ss;qe({id:Gt,eventMetadata:{eventSource:"mouse"},turnTracker:U}),zs()},icon:Zn,label:h.formatMessage({id:"ConversationTurn.regenerateTooltip",defaultMessage:"Regenerate"}),testId:"regenerate-turn-action-button"}):null,$t="h-[30px] rounded-md px-1 text-token-text-secondary hover:bg-token-main-surface-secondary",wt=!ws&&je?s.jsx(gf,{className:$t,clientThreadId:o,message:G,onModelSelect:vt,onDropdownChange:te,canRegenerateResponse:ms}):null,on=!B&&!Ye&&(!a||!Ee)?s.jsx(Du,{onClick:Ae}):null,rn=!B&&(!a||!Ee)&&(G.disclaimers??[]).length===0&&G.nodeId?s.jsx(cf,{conversationId:o,message:G,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-xs text-token-text-tertiary hover:text-token-text-primary"}):null,js=!B&&G&&(!a||!Ee)?s.jsx(Fu,{message:G,isFinalTurn:a,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-token-text-tertiary hover:text-token-text-primary"}):null,_s=qt&&!Ee?s.jsxs("div",{className:"flex",children:[!pe?.includes(De.ThumbsDownOnly)&&ae!=="thumbsDown"&&s.jsx(Jt,{onClick:()=>ie("thumbsUp"),disabled:ae==="thumbsUp",icon:ae==="thumbsUp"?Dd:li,label:h.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"},`thumbsUp:${G.nodeId}`),ae!=="thumbsUp"&&s.jsx(Jt,{onClick:()=>ie("thumbsDown"),disabled:ae==="thumbsDown",icon:ae==="thumbsDown"?Fd:ci,label:h.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"},`thumbsDown:${G.nodeId}`)]}):null,st=We&&s.jsx(Jt,{onClick:()=>{Ws.openSharingModal(M)},label:h.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:Ld}),Ms=!je&&s.jsx(ef,{className:$t,clientThreadId:o,message:G,onModelSelect:vt,onDropdownChange:te});function nt(U){return re?U:s.jsx(Yn,{clientThreadId:o,isStaticSharedThread:y,withVerticalPadding:!0,withHorizontalPadding:!yt,children:U})}function Kt(U){return re?U:s.jsx(ns,{children:U})}return s.jsxs(s.Fragment,{children:[b&&s.jsx(Tu,{dateString:b}),s.jsxs("article",{className:P("w-full scroll-mb-[var(--thread-trailing-height,150px)] text-token-text-primary focus-visible:outline-2 focus-visible:outline-offset-[-4px]",le?"min-h-[calc(100cqh-var(--thread-leading-height)-var(--thread-trailing-height)-var(--previous-turn-min-height))]":"",d==="finalAgentTurn"&&x&&re?"opacity-0":""),ref:se,dir:"auto","data-testid":`conversation-turn-${e}`,"data-scroll-anchor":a,onMouseEnter:()=>V(!0),onMouseLeave:()=>V(!1),children:[s.jsx(Cu,{role:S.role}),nt(s.jsx(s.Fragment,{children:yt?s.jsx(pf,{isFeedbackEnabled:qt,variantIds:N,variantsInStreamInfo:C,conversationTurnMountTime:gt,stubSideBySideFeedback:Ss,...t}):Kt(s.jsxs(s.Fragment,{children:[!B&&m&&s.jsx(Tf,{children:s.jsx(Tn,{messages:O,isUserTurn:B,avatarClassName:c,gizmo:W})}),s.jsx("div",{className:P("group/conversation-turn relative flex w-full min-w-0 flex-col",!B&&ku),children:s.jsx("div",{className:"flex-col gap-1 md:gap-3",children:s.jsxs(s.Fragment,{children:[!B&&!y&&s.jsx(Au,{messages:O,clientThreadId:o,gizmoId:W?.gizmo.id}),s.jsx(Cn,{groupedMessagesToRender:et,allGroupedMessages:j,...t,isEditing:k,isUserTurn:B,isCompletionRequestInProgress:Ee,isFeedbackEnabled:qt,isFinalTurn:a,hasActiveRequest:hs,showEditButton:_e,handleEnterEdit:ke,handleExitEdit:q}),ge&&s.jsx("div",{className:"mb-4",children:s.jsx(Eu,{messages:O})}),X&&s.jsx("div",{className:"mb-4",children:s.jsx(Ru,{messages:O})}),(Ke||tt)&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:P("mb-2 flex gap-3 empty:hidden",B?"mr-1 flex-row-reverse":"-ml-2"),children:s.jsx(Nu,{alwaysShow:a,showInline:a||tt,isHovered:K||I,pagination:tt&&s.jsx(Pu,{showInline:a||tt,currentPage:R,onChangeIndex:bs,length:N.length,className:P("self-center",N.length>1?"visible":"!invisible")}),actions:Ke&&s.jsxs(s.Fragment,{children:[rn,on,nn,_s,js,Ms,st,wt]})})}),Ke&&!Ee?s.jsx("div",{className:"pr-2 lg:pr-0",children:s.jsx(Iu,{message:G,isFinalTurn:a})}):null,a&&!Ee&&s.jsx(jf,{canShowInlineMessageFeedback:L,clientThreadId:o,conversationLeafId:n,messageForRating:G,allGroupedMessages:j,currentModelId:l})]})]})})})]}))}))]})]})}const Mf=Cr.memo(_f),Tf=ve.div`flex-shrink-0 flex flex-col relative items-end`;function Cf({onChangeItemInView:t,onRequestMoreCompletions:e,onChangeRating:n,onRequestCompletion:a,clientThreadId:o,conversationLeafId:i,hideHeader:r}){const l=Se(),c=Qn(),m=Lu(),[d]=Bu(),h=Ou(),[g]=zu(),p=en(o),y=Ys(),f=Hu(o),v=Uu(o),x=l.store.useContentAreaDimensions(It.Header,R=>R?.height?R.height:void 0),M=l.store.useIsHeaderContentAreaPopulated(),S=ni(o),{isArchived:b}=S,w=Wu(f.id),N=p?.kind===ut.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":w,C=ai(o,i),j=Gu(),[_,A]=u.useState(0),[O,z]=u.useState(!1);u.useEffect(()=>{c&&(_===0?A(C):!O&&C>_&&(z(!0),fe.logEvent("chatgpt_continue_conversation_first_message_sent"),ee.logEvent(Q.continueConversationFirstMessageSent)))},[C,_,O,c]),c&&(fe.logEvent("chatgpt_continue_conversation_page_loaded"),ee.logEvent(Q.continueConversationPageLoaded));const k=u.useCallback(()=>{m({behavior:"smooth"})},[m]),F=Vu(o),L=j&&!b,E=(R,B,$)=>[...new Array(B-R).keys()].map(oe=>{const W=oe+R;return s.jsx(Mf,{isFinalTurn:$(W),turnIndex:W,clientThreadId:o,conversationLeafId:i,onChangeItemInView:t,onChangeRating:n,onRequestMoreCompletions:e,onRequestCompletion:a,currentModelId:f.id,avatarClassName:N,scrollToBottom:k},W)});return s.jsxs("div",{onCopy:F,className:P("flex flex-col text-sm",L&&"pb-[120px]",x||L?null:"md:pb-9"),style:{paddingBottom:L?void 0:x},children:[!r&&y?.data&&s.jsx(ki,{clientThreadId:o}),c&&s.jsxs(s.Fragment,{children:[s.jsx(ns,{children:s.jsx("p",{className:"text-xs text-gray-500",children:s.jsx(H,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),C-_===0&&s.jsx("div",{className:"text-center text-xs font-semibold text-token-text-primary",children:s.jsx("button",{onClick:()=>{Ws.openModal(qu.ReportConversation),fe.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),ee.logEvent(Q.sharedConversationReportContentClicked,{location:"Dynamic Shared Thread Page"})},children:s.jsx(H,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})}),E(0,_,R=>R===_-1),s.jsx(ns,{children:s.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[s.jsx(Bd,{className:"icon-xs mr-2"}),s.jsx(H,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})}),E(_,C,R=>R===C-1)]}),!c&&E(0,C,R=>R===C-1),v&&d&&!g&&s.jsx(lo,{className:P("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{fe.logEvent("chatgpt_thread_scroll_to_top"),h({behavior:"smooth"})},children:s.jsx(Od,{className:"icon-md text-token-text-primary"})}),!d&&s.jsx(lo,{className:P(x?null:"bottom-5",L?M?"translate-y-[-50px]":"translate-y-[-10px]":""),style:{bottom:j?"calc(var(--composer-bar_footer-current-height) + var(--composer-bar_current-height))":x},onClick:()=>{fe.logEvent("chatgpt_thread_scroll_to_bottom"),m({behavior:"smooth"})},children:s.jsx(zd,{className:"icon-md text-token-text-primary"})})]})}const lo=ve.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-light right-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`,kf=60,Af=({children:t,scrollViewClassName:e,scrollAnchorTopOffset:n=0})=>{const a=u.useRef(null);return s.jsx("div",{className:"h-full",ref:a,children:s.jsx(Ar,{children:s.jsx(Xd,{className:"h-full",followButtonClassName:"hidden",initialScrollBehavior:"auto",scrollViewClassName:e,scroller:()=>Ef(a,n)?0:1/0,children:t})})})},Ef=(t,e)=>{const n=Rf(t.current);if(n==null)return!1;const a=n>e,o=n<e-kf;return!a&&!o};function Rf(t){if(!t)return null;const e=t.querySelector('[data-scroll-anchor="true"]');if(!e)return null;const n=e.getBoundingClientRect().top,a=t.getBoundingClientRect().top;return n-a}const Nf=Lt(()=>Bt(()=>import("./hqi1opzfsb1mwry5.js"),__vite__mapDeps([63,1,2,3,5,6,31,32,33,34,35,64])).then(t=>t.OpenDebugSidebarButton)),Pf=Lt(()=>Bt(()=>import("./nbg1d5bqxioh3u25.js"),__vite__mapDeps([65,1,2,3,5,6,66,19]))),co=Le({doNotShareSensitive:{id:"thread.modal.onboarding.title",defaultMessage:"Do not share sensitive materials with this application"},somethingWentWrong:{id:"thread.modal.unrecoverableError.title",defaultMessage:"Something went wrong"},tryAgainLater:{id:"thread.modal.unrecoverableError.description",defaultMessage:"We're sorry, but something went wrong. Please try again later."},resetThread:{id:"thread.modal.unrecoverableError.resetThread",defaultMessage:"Reset thread"},sharedConversationReportConversation:{id:"thread.sharedConversation.report",defaultMessage:"Report conversation"},latencyButton:{id:"thread.latencyButton",defaultMessage:"Latency"},archivedConversationDescription:{id:"thread.archivedConversationDescription",defaultMessage:"This conversation is archived. To continue, please unarchive it first."},unarchiveButton:{id:"thread.unarchiveButton",defaultMessage:"Unarchive"}});function If({clientThreadId:t}){const e=po(),n=Ht(t),a=async()=>{n&&(await dt.patchConversation(n,{is_archived:!1}),e.invalidateQueries({queryKey:["conversation",t]}),Kn.setState(o=>{const i=o.threads[n];i!=null&&(i.initialThreadData.isArchived=!1)}),fd(e))};return s.jsxs("div",{className:"my-6 flex flex-col items-center justify-center gap-4",children:[s.jsx("div",{className:"px-3 text-center text-sm text-token-text-secondary",children:s.jsx(H,{...co.archivedConversationDescription})}),s.jsx("div",{children:s.jsx(zt,{disabled:!n,onClick:a,icon:Hd,children:s.jsx(H,{...co.unarchiveButton})})})]})}const Xf=function({clientThreadId:t,onCompletionFinished:e,onCreate:n,preRequestCompletion:a,hideHeader:o,hideMessages:i,hideFooter:r,hideToolsOverlay:l,messagesVerticalAlign:c="top",prependThreadChildren:m,renderEmptyState:d,prefetchSearch:h}){const g=Ot(),p=Lo(t),y=Xn(t),f=mt(t),x=ni(t).isArchived;u.useEffect(()=>{y||(Ds(t)?bn.addTiming("chatgpt.web.chatPage.renderNewConversation"):bn.addTiming("chatgpt.web.chatPage.renderExistingConversation"))},[t,y]);const M=$u(t,f),S=ai(t,f),{setTargetedContent:b}=zo(),w=g?.includes(Er),N=Ku(),C=S>=2;Bo(C);const j=Ds(t)&&!C&&dn(p),_=Ds(t)&&!M&&(dn(p)||p?.kind===ut.GizmoTest),O=Oo().id,z=Yu(t),k=z??O,F=!!z,L=si(k),R=Fo()[k],B=Xu(t,p),$=Do();Qu(S,t,f,j),u.useEffect(()=>{Ho()},[]),u.useEffect(()=>{$||b(void 0)},[t,b,$,f]);const{caModal:oe,onRequestCompletion:W,onChangeItemInView:de,onChangeRating:ge,onRequestMoreCompletions:X}=Zu({clientThreadId:t,currentModelId:k,defaultModelId:O,onCompletionFinished:e,onThreadCreated:n,preRequestCompletion:a}),{isUnauthenticated:be,isLoading:re}=Ge(),ye=Ju({clientThreadId:t,currentLeafId:f,handleRequestCompletion:W,prefetchSearchPromise:h});ed({clientThreadId:t,currentModelId:k});const ue=ke=>s.jsx(Af,{scrollAnchorTopOffset:o?0:md,children:c==="bottom"?s.jsxs("div",{className:"flex h-full flex-col",children:[s.jsx("div",{className:"flex-1"}),ke]}):ke});u.useEffect(()=>{document.title=B??"ChatGPT"},[B]);const we=Ve(t),pe=rs(),Ce=Rr(),je=_&&!Ce&&!d&&!we&&!L&&!pe,he=je&&!re&&be,Be=je&&!re&&!be,We=Am(he),D=Rm(Be),I=he&&We||Be&&D,te=Qn(),K=td(),{reset:V,streamingContext:ne,StreamingProvider:se}=sd();u.useEffect(()=>{K&&(ne.setOnResetContext=()=>{V()})},[K,V,ne]);const G=u.useRef(null),ae=u.useRef(null),le=u.useMemo(()=>({threadContentScrollContainerElementRef:G,footerRootContainerElementRef:ae}),[]);return s.jsx(nd,{clientThreadId:t,currentLeafId:f,children:s.jsxs(se,{value:ne,children:[w&&s.jsx(Pf,{}),s.jsx(ad,{children:B!=null&&s.jsx("title",{children:B})}),s.jsx(od.Provider,{value:W,children:s.jsxs(id,{children:[s.jsxs(rd,{clientThreadId:t,currentModelConfig:R,className:"composer-parent flex h-full flex-col focus-visible:outline-0",children:[!i&&s.jsx(ld,{value:le,children:s.jsx(Df,{ref:G,children:!y&&!ye?_?d??s.jsx(Xm,{clientThreadId:t,currentModelId:k,isModelLoaded:F,onRequestCompletion:W,enableV2Homepage:I,v2HomepageDisclaimer:I&&s.jsx(Ra,{clientThreadId:t})}):C?ue(s.jsxs(s.Fragment,{children:[m,s.jsx(Cf,{onChangeItemInView:de,onRequestMoreCompletions:X,onChangeRating:ge,onRequestCompletion:W,clientThreadId:t,conversationLeafId:f,hideHeader:o},t)]})):null:null})}),s.jsx(Ff,{ref:ae,children:x?s.jsx(If,{clientThreadId:t}):s.jsxs("div",{children:[!I&&s.jsx(Tm,{clientThreadId:t,isNewThread:j,showPromptStarters:j||!M,currentModelId:k,onRequestCompletion:W}),!r&&s.jsx("div",{className:"relative w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",children:dn(p)&&!I&&s.jsx("div",{className:"min-h-4",children:s.jsx(Ra,{clientThreadId:t})})})]})})]}),!l&&s.jsxs("div",{className:"group absolute bottom-2 end-2 z-20 flex flex-col gap-1 md:flex lg:bottom-3 lg:end-3",children:[N?s.jsxs(s.Fragment,{children:[s.jsx(Nf,{}),!1]}):null,s.jsx(cd,{})]}),oe,s.jsx(ud,{clientThreadId:t,isStaticSharedThread:!1,isDynamicSharedThread:te}),s.jsx(dd,{}),s.jsx(hd,{conversationId:t,currentModelId:k,isActiveWindow:!Ce})]})})]})})},Df=ve.div`grow flex-1 overflow-hidden`,Ff=ve.div`md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent w-full`;export{Mf as C,Xm as E,Nm as S,Xf as T,Af as W,Tm as a,Vm as b,$f as c};
//# sourceMappingURL=kpxy6xc28m0cob8k.js.map
