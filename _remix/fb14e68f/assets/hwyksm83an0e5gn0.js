import{j as s,ar as L,r as h,z,eh as F,b as M,cm as j,b2 as _}from"./b49w4g1m4rvlf13k.js";import{F as D}from"./oo90a40bf3arvc17.js";import{b as P,aS as O}from"./eqa10itkkpekkuyz.js";import{a1 as N,c2 as A,c3 as q,c4 as f,c5 as p,c6 as v,E as y}from"./h7m9odjd9i4xn2nr.js";import{g as G}from"./kqwdyvkaaavvn8k3.js";import{a as Q}from"./dpjwdlalymrdj5ve.js";import{u as B,a as U,g as X,b as C}from"./hyq84jzq5d96nfsq.js";import{m as S}from"./k3myfrovinforztc.js";import"./drwc7kl0d6urzvme.js";import"./kmboqirrpdxl07dx.js";function $(e,t){const n=N.getTurnContentReferences(e,t);return A(n)}function H(e,t){const n=$(e,t),a=N.getTurnImageSearchResults(e,t);return q(n.concat(a),"content_url")}function ue({clientThreadId:e}){const t=f.useCurrentImage();if(!t)return null;const{image:n,source:a,turnIndex:o}=t;if(a==null||e==null||o==null)return s.jsx(g,{image:n});const l=H(e,o);return s.jsx(g,{image:n,group:l,turnIndex:o,groupSource:a})}function me(){const e=f.useCurrentImage();if(!e)return null;const{image:t,source:n}=e;if(n==null)return s.jsx(g,{image:t});switch(n){case p.ImagesTab:return s.jsx(J,{image:t});case p.Turn:return s.jsx(K,{image:t})}}function J({image:e}){const{imageResults:t}=B();return s.jsx(g,{image:e,group:t,groupSource:p.ImagesTab})}function K({image:e}){const{imageResults:t}=U();return s.jsx(g,{image:e,group:t,groupSource:p.Turn})}const R=L.div`grow flex items-start p-8`,V={enter:e=>({x:e>0?1e3:-1e3,opacity:0}),center:{zIndex:1,x:0,opacity:1},exit:e=>({zIndex:0,x:e<0?1e3:-1e3,opacity:0})},k=1e4,W=(e,t)=>Math.abs(e)*t;function g({image:e,group:t,groupSource:n,turnIndex:a}){const o=Q(e?.url??""),l=f.useCurrentImage(),i=f.useStore(),w=l?.mountDirection;h.useEffect(()=>{window?.history?.state?.imageModalOpen||window.history.pushState({imageModalOpen:!0},"",window.location.href);const r=()=>{window?.history?.state?.imageModalOpen||i.setCurrentImage(void 0)};return window.addEventListener("popstate",r),()=>window.removeEventListener("popstate",r)},[i]);const b=()=>{window.history.go(-1),i.setCurrentImage(void 0)},c=t?.findIndex(r=>z(e,r)),u=t?.length??1,m=c!=null&&u>1,x=h.useCallback(()=>{!m||t==null||i.setCurrentImage({image:t[(c+1)%t.length],source:n,mountDirection:v.FromRight,turnIndex:a})},[m,t,i,c,n,a]);F({queries:(t??[]).map(r=>X(r.thumbnail_url))});const d=h.useCallback(()=>{!m||t==null||i.setCurrentImage({image:t[(c-1+t.length)%t.length],source:n,mountDirection:v.FromLeft,turnIndex:a})},[m,t,i,c,n,a]);return h.useEffect(()=>M(document,{keydown:r=>{r.key==="ArrowRight"?x():r.key==="ArrowLeft"&&d()}}),[x,d]),s.jsx(y,{children:e&&s.jsx(j.Root,{isOpen:!0,onClose:b,children:s.jsx(j.Overlay,{children:s.jsxs(_,{className:"flex h-full w-full flex-col bg-black/95",children:[s.jsxs("div",{className:"relative flex w-full grow justify-center overflow-hidden",children:[s.jsxs("div",{className:"absolute right-4 top-4 flex items-center sm:right-6 sm:top-6",children:[m&&s.jsxs("div",{className:"shrink-0 px-4 py-2 text-token-text-tertiary",children:[c+1," / ",u]}),s.jsx("button",{onClick:r=>{r.stopPropagation(),b()},className:"flex h-9 w-9 items-center justify-center outline-none hover:opacity-70",children:s.jsx(P,{className:"h-6 w-6 text-gray-400"})})]}),u>1&&s.jsx(R,{className:"cursor-w-resize",onClick:r=>{r.stopPropagation(),d()}}),s.jsx(y,{initial:!1,custom:w,children:s.jsx(S.div,{variants:V,custom:w??0,className:"absolute bottom-4 top-24",initial:"enter",animate:"center",exit:"exit",transition:{x:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2}},drag:u>1?"x":!1,dragConstraints:{left:0,right:0},dragElastic:1,onDragEnd:(r,{offset:T,velocity:E})=>{const I=W(T.x,E.x);I<-k?x():I>k&&d()},children:s.jsx(Y,{image:e})},c)}),u>1&&s.jsx(R,{className:"cursor-e-resize",onClick:r=>{r.stopPropagation(),x()}})]}),s.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"flex min-h-20 w-full shrink-0 items-center gap-8 px-6 pb-3 pt-8 text-sm hover:opacity-70 sm:px-8 sm:pb-8",children:s.jsxs("div",{className:"flex grow flex-col gap-0.5 overflow-hidden pr-2",children:[s.jsxs("div",{className:"flex items-center gap-2 truncate text-token-text-tertiary",children:[s.jsx(D,{url:e.content_url,className:"rounded",size:16}),o.data??G(e.url)]}),s.jsx("div",{className:"truncate font-semibold text-white",children:e.title})]})})]})})})})}function Y({image:e}){const t=e.content_url.replace(/^http:\/\//,"https://"),n=e.thumbnail_url.replace(/^http:\/\//,"https://"),a=e.content_size.width/e.content_size.height,{isError:o}=C(t),{isError:l}=C(n);return!l||!o?s.jsx(S.img,{src:o?n:t,alt:e.title,style:{backgroundImage:n?`url(${n})`:void 0,backgroundSize:"contain",aspectRatio:a,backgroundPosition:"center",backgroundRepeat:"no-repeat"},initial:{opacity:0},animate:{opacity:1},className:"h-full max-w-[100vw] object-contain sm:max-w-[calc(100vw-10rem)]"}):s.jsx("div",{className:"flex h-full grow items-center justify-center",children:s.jsx("div",{className:"flex h-96 w-96 items-center justify-center bg-white/10",children:s.jsx(O,{className:"h-12 w-12 text-token-text-tertiary"})})})}export{ue as ImageLightbox,me as ImageLightboxSearchGPT,g as ImageResultModal,$ as getThreadTurnContentReferenceImages,H as getThreadTurnImages};
//# sourceMappingURL=hwyksm83an0e5gn0.js.map
