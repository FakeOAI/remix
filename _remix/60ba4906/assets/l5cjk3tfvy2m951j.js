import{f4 as E,T as _,r as c,m as n,cv as q,f5 as B,q as P,f6 as $}from"./eljox9y9liclbxjs.js";import{fp as Y,eL as J,ar as v,fq as K,de as X,fr as Z,fs as Q,ft as tt,fu as et,fv as st,fw as at,fx as ot,fy as it,fz as nt,fA as D,fB as rt,fC as L,fD as ct,D as F,fE as lt,fF as dt,fG as ut,ap as ft,fH as pt,fI as W,Z as R,G as mt,fJ as j}from"./q02ioa5nz1msdn73.js";import{T as ht}from"./b7w9m1pv5sv73e9x.js";import{o as xt,q as gt,G as vt,H as Ct}from"./ei22way1wz63smda.js";import{m as p}from"./gej2wzszabjtgedr.js";import"./mov0dqfy71k4mkbp.js";import"./bpx8yk8lhvr4hu9a.js";import"./m2j9a5yzu7labkem.js";import"./i4lebxob07xbpc6p.js";import"./l0xkd1ou0a6b53wu.js";import"./btkmfibrorj6h94u.js";import"./gs0p62cga8ydkujk.js";import"./d0c0dt6og7lcobfn.js";import"./fjii1rhgftspjqgz.js";import"./d6zp3a3jsn0b88yi.js";import"./pc41wgyozijgyqnw.js";import"./m6ilxompj3fnes7l.js";import"./ow04wph7q6xkuj3u.js";import"./c4b6lf0gasvdk5f8.js";import"./ctv5zl6thp0tttje.js";import"./i0hzoutiwdqlll20.js";import"./g55wszzvw80ez5vs.js";import"./grq6wh9rfw6h032k.js";import"./ffm0ki31s7071ctc.js";const M="oai/apps/canmoreSidebarWidth",bt=.25,wt=400,G=400;function H(t){return t-wt}function S(t,s){return J(G,H(t),s??bt*t)}function yt(){const t=E.useState(E.selectWindowWidth),s=S(t,Y(_.DANGER_SECRET_FOLDERS_ONLY_getItem(M))),a=A(),[e,o]=c.useState(s);c.useEffect(()=>{(e<G||e>H(t))&&o(S(t,e))},[t]);function i(r){o(m=>S(t,m+=r.delta.x))}function l(r){o(r),_.DANGER_SECRET_FOLDERS_ONLY_setItem(M,r)}function d(){const r=S(t,void 0);l(r)}const f=`calc(100vw - ${e}px)`;return a?{chatWidth:e,canvasWidth:t-e,canvasWidthCalc:f,viewportWidth:t,handleDrag:i,handleDoubleClick:d,persist:l}:{chatWidth:0,canvasWidth:t,canvasWidthCalc:"100vw",viewportWidth:t,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function A(){return E.useState(t=>E.selectWindowWidth(t)>1e3)}const St=t=>{const s=c.useRef();return c.useEffect(()=>{s.current=t},[t]),s.current};function Tt(t,s){let a;return(s==null?void 0:s.type)===v.Textdoc&&(a={type:"canvas_textdoc",id:s.textdocId}),{...t,messageMetadata:{...t.messageMetadata,open_in_canvas_view:a}}}const O=({isFullScreen:t=!1,clientThreadId:s,focusedObject:a,onClose:e,isAnimating:o=!1,width:i})=>{const{setTargetedContent:l}=K(),d=c.useRef(!1);if(c.useEffect(()=>(d.current&&l(void 0),d.current=!0,()=>{d.current=!1}),[a]),a==null)return null;switch(a.type){case v.Textdoc:return n.jsx(ht,{isFullScreen:t,onClose:e,clientThreadId:s,focusedTextdoc:a,isAnimating:o,width:i});case v.ADAVisualization:return null}},Et=300,It=t=>(t==null?void 0:t.type)===v.Textdoc?t.textdocId:null;function At(t){const s=xt(t),a=X(s),e=gt(t),o=vt(t,e),i=Ct({clientThreadId:t,conversationLeafId:e}),l=Z(),[d,f]=c.useMemo(()=>{let x;return!i&&o&&(x=Q(tt(o.messages))),Nt(a,l,x)},[i,o,a,l]),r=f!=null,m=It(f);c.useEffect(()=>{if(f&&d&&(et(f,d),f.type===v.Textdoc)){const{textdocId:x}=f,I=rt(x);st(document.getElementById(I))}},[r,m])}function Nt(t,s,a){switch(a==null?void 0:a.type){case at.Canmore:{const[e,o]=a.messages;if(!ot(e==null?void 0:e.message))break;const i=it(t,e.message,(o==null?void 0:o.message)??null),l=i.textdocId??s;if(l&&(i.function===nt.CreateTextdoc?(i.content??"").length>Et||i.status===D.WAITING:i.status===D.STREAMING))return[i.messageId,{type:v.Textdoc,textdocId:l}];break}}return[void 0,null]}const _t=260,T={type:"spring",bounce:.12,duration:.64},k={type:"spring",bounce:0,duration:.58},Dt=({clientThreadId:t,focusedObject:s,onClose:a})=>{const{chatWidth:e,canvasWidthCalc:o,handleDrag:i,handleDoubleClick:l,persist:d}=yt(),[f,r]=c.useState(!0),[m,x]=c.useState(!1),I=F(u=>u.activeSidebar),C=lt(({rect:u})=>u),{windowHeight:b,windowWidth:w}=B(u=>u,{windowWidth:0,windowHeight:0});let h=C??{top:0,left:e,width:w-e,height:b},N=!1;if(C&&(h.top<0||h.top+h.height>b)){N=!0;const u={width:(w-e)*.75,height:b*.75};h={top:b/2-u.height/2,left:(w-e-u.width)/2+e,width:u.width,height:u.height}}const y=C==null?void 0:C.borderRadius,g=dt(),z=(g==null?void 0:g.history)!=null||(g==null?void 0:g.showChangesAtVersion)!=null,U=F(u=>u.isDesktopNavCollapsed);return n.jsxs(n.Fragment,{children:[z&&n.jsx(p.div,{className:"fixed inset-0 z-20 bg-gray-50/50 dark:bg-black/50",initial:{opacity:0},animate:{opacity:1},onClick:()=>ut(g.textdocId)}),n.jsxs(p.div,{initial:{marginRight:U?0:-_t},animate:{marginRight:0},transition:k,children:[n.jsx(p.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:{...T,delay:.22},className:"pointer-events-none absolute left-0 top-0 z-20 h-full w-full bg-token-main-surface-primary"}),n.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"pointer-events-none absolute left-0 top-0 z-10 h-full w-full bg-black/[0.025] dark:bg-transparent"}),n.jsx(p.div,{className:"relative z-20 h-full",initial:!1,style:{width:o},exit:{width:0,transition:{duration:0}},transition:k})]}),n.jsx(p.div,{className:P("absolute z-20 h-full overflow-hidden transition-shadow",I==="debug"?"md:left-[-250px] lg:left-[-300px] xl:left-[-350px] 2xl:left-[-400px]":"left-0"),initial:{opacity:N?0:1,x:h.left,y:h.top,width:h.width,height:h.height,borderRadius:y,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},animate:{opacity:1,x:e,y:0,width:o,height:"100%",borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:{opacity:{duration:.14,bounce:.1}},borderRadius:y,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:m?{duration:0}:T,onAnimationComplete:()=>r(!1),children:n.jsx(p.div,{className:"h-full overflow-hidden border-l border-gray-100 dark:border-token-border-medium",initial:{borderRadius:y},animate:{borderRadius:0},exit:{borderRadius:y},transition:T,children:n.jsxs("div",{className:"h-full",children:[n.jsx(p.div,{drag:"x",className:"absolute left-[-2px] z-10 h-full w-[4px] cursor-ew-resize bg-token-text-quaternary opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onDrag:(u,V)=>{x(!0),i(V)},onDragEnd:()=>{x(!1),d(e)},onDoubleClick:()=>l()}),n.jsx(O,{onClose:a,clientThreadId:t,isAnimating:f,focusedObject:s,width:w-e})]})})})]})},Ft=c.memo(Dt),Wt=({clientThreadId:t,focusedObject:s,onClose:a})=>{const e=A();return n.jsx($,{children:n.jsx(p.div,{className:"fixed inset-0 z-20 overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},exit:e?void 0:{opacity:0,scale:.98},transition:T,children:n.jsx(O,{isFullScreen:!0,clientThreadId:t,focusedObject:s,onClose:a})})})},Rt=({clientThreadId:t})=>{const s=A(),a=St(t);At(t);const e=ft(),o=pt(({resolveTempTextdocId:r})=>r),i=c.useMemo(()=>{let r=e;if((e==null?void 0:e.type)===v.Textdoc){const m=o==null?void 0:o[e.textdocId];m&&(r={...e,textdocId:m})}return r},[e,o]);c.useEffect(()=>{L()},[t]);const l=i&&(s?n.jsx(Ft,{clientThreadId:t,onClose:j,focusedObject:i},"canvas-sidebar"):n.jsx(Wt,{clientThreadId:t,onClose:j,focusedObject:i},"canvas-modal"));c.useEffect(()=>{if(i)return W(r=>Tt(r,i)),()=>W(null)},[i,o]);const d=l!=null;return c.useEffect(()=>(R.setActiveStageSidebar(d),()=>R.setActiveStageSidebar(!1)),[d]),a!==t?null:n.jsx(mt,{initial:!1,children:l})},oe=t=>{const s=c.useRef(null);return n.jsx(q,{ref:s,onError:(a,e)=>{L(),setTimeout(()=>{var o;(o=s.current)==null||o.resetErrorBoundary()}),ct.logError("Error boundary hit",a,{componentStack:e})},name:"canmore-focused-view",children:n.jsx(Rt,{...t})})};export{oe as CanvasFocusedViewManager};
//# sourceMappingURL=l5cjk3tfvy2m951j.js.map
