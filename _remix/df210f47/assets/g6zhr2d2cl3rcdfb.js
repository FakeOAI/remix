import{r as C,a3 as U,t as d,aU as et,by as z,R as tt,T as Y,ag as Yt,e0 as Jt,ad as Oe,c_ as Qt,c$ as Xt,d0 as Zt,ea as Kt,b as yt,h as en,fv as nt,d7 as st,a as Tt,dk as tn,dS as nn}from"./in4yvrl95oipp0rj.js";import{em as sn,ff as on,jv as rn,ag as xt,jw as ge,jx as X,jf as ot,c as Ce,N as Z,fp as O,hA as K,U as an,jy as ye,jz as Et,fr as ee,jA as un,j8 as wt,hb as bt,jl as ln,ao as N,bW as cn,cm as fn,jB as dn,jC as mn,jD as A,jE as hn,hs as Mt,jF as pn,jG as gn,e as vn,jH as Cn,jI as yn,jJ as Tn,fe as xn,h8 as En,fa as wn,h9 as bn,fc as Mn,cB as Sn,jK as An,jL as In,ap as rt,jM as Dn,jN as kn,jO as Ln,jP as Nn,jQ as at,jb as G}from"./k2c8mioruw1313fx.js";import{C as _n,s as J,g as jn,t as Rn,v as On,w as Pn,O as Hn,x as qn,y as $n}from"./fotsgb5wumgx6r1a.js";import{e as Un,C as Bn}from"./j53s1j4mmx3gatxj.js";import{C as Te,B as Fn,H as St,S as F,f as Vn,I as it}from"./byduzog9468h5uc4.js";import{m as Q}from"./g02lxz7bgcnq5b5k.js";import{D as zn}from"./n8ci4pqy6pykjz59.js";import{bI as Gn,bv as Wn,_ as Yn,bK as Jn,bL as Qn,an as Xn,y as Zn}from"./ejbuirid83yf5ft7.js";import{i as Kn}from"./c2vll5zvtcgigx2l.js";import{i as es,r as ts,T as ns,B as ss,d as os}from"./kvl7elfd8vvqbpqv.js";import{L as rs,l as as,m as is,n as us,o as ls}from"./ecoy77jpxx1awqn8.js";import{P as cs}from"./kmimmx4g2q9qglcg.js";import{q as fs,r as ds,K as ms}from"./jpr7bvq7i0xc2okp.js";import{u as hs}from"./eddtow8pmk30ok2r.js";var ke=(t=>(t.Close="close",t.Loaded="loaded",t.Streaming="streaming",t.Download="download",t))(ke||{});const ps=({isTextdocStreaming:t,isRequestActive:e,value:n,comments:s})=>{const[o,r]=C.useState(!1);return C.useEffect(()=>{t&&o&&(r(!1),Te.reset())},[n,s]),C.useEffect(()=>{e||(r(!1),Te.reset())},[e]),[o,r]};function gs({onClickRestore:t,onClickResetLatest:e}){const n=U();return d.jsx(Q.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{bounce:0,duration:.24},className:"absolute bottom-0 left-0 z-30 w-full items-center border-t border-gray-100 bg-token-main-surface-primary p-6 shadow-[0_-4px_32px_rgba(0,0,0,0.08)] @container dark:border-token-border-xlight dark:shadow-[0_-4px_32px_rgba(0,0,0,0.12)] lg:border-l",children:d.jsxs("div",{className:"mx-auto flex max-w-[48rem] flex-col flex-wrap justify-center gap-5 @2xl:flex-row @2xl:justify-between",children:[d.jsxs("div",{className:"flex flex-col px-2 text-center @2xl:text-start",children:[d.jsx("span",{className:"text-md text-wrap font-semibold",children:n.formatMessage({id:"gt23pb",defaultMessage:"You are viewing a previous version"})}),d.jsx("span",{className:"text-wrap text-sm text-token-text-secondary",children:n.formatMessage({id:"sAlUJn",defaultMessage:"Restore this version to make edits"})})]}),d.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4",children:[d.jsx(et,{as:"button",color:"primary",onClick:t,children:n.formatMessage({id:"+cddAb",defaultMessage:"Restore this version"})}),d.jsx(et,{as:"button",color:"secondary",onClick:e,children:n.formatMessage({id:"qCD3eu",defaultMessage:"Back to latest version"})})]})]})})}const vs={type:"spring",damping:35,stiffness:300},Cs=({clientThreadId:t,turn:e})=>{const n=sn(),s=on(e.messages);return d.jsxs(Q.div,{className:"absolute left-0 right-0 top-0 z-10 -translate-y-full",children:[d.jsx(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-vert-light-gradient dark:bg-vert-dark-gradient"}),d.jsx(Q.div,{className:"flex items-center px-6 py-2",initial:{opacity:.75,translateX:-50,translateY:"100%"},animate:{opacity:1,translateX:0,translateY:"0"},exit:{opacity:0,translateY:20},transition:vs,children:d.jsx(_n,{clientThreadId:t,onChangeItemInView:z,onRequestCompletion:async o=>z(o),onRequestMoreCompletions:z,groupedMessagesToRender:s,allGroupedMessages:s,isEditing:!1,isUserTurn:!0,turnIndex:0,isCompletionRequestInProgress:!1,isFeedbackEnabled:!1,isFinalTurn:!1,hasActiveRequest:n,showEditButton:!1,handleEnterEdit:z,handleExitEdit:z})})]},"user-message")},ys=({clientThreadId:t})=>{const e=es(t),n=ts(t,e),{lastUserTurn:s,lastAssistantTurn:o}=C.useMemo(()=>{let a=null,i=null;for(let l=n.length-1;l>0;l--){const u=n[l];if(!a&&u.role===tt.User?a=u:!i&&u.role===tt.Assistant&&(i=u),a&&i)break}return{lastUserTurn:a,lastAssistantTurn:i}},[n]),r=s&&!o?.messages.find(({message:a})=>a.recipient?.startsWith(rn));return d.jsx(xt,{initial:!1,children:r&&d.jsx(Cs,{turn:s,clientThreadId:t})})},Ts=({isRequestActive:t=!1,clientThreadId:e,onCancel:n,onAcceleratorsExpandedChange:s,onSubmit:o,onSubmitAccelerator:r,acceleratorActions:a=[]})=>{const[i,l]=C.useState(""),[u,f]=C.useState(!0),c=U(),[p,y]=C.useState(!1),g=()=>{o?.(i),l("")},h=m=>{const{metaKey:v,shiftKey:E,key:b}=m;b==="Enter"&&i.trim()&&!(E||v)&&(g(),m.preventDefault())};return d.jsxs("div",{className:"relative mb-3 flex max-w-2xl flex-1 justify-center",children:[d.jsx(ys,{clientThreadId:e}),d.jsx("div",{className:"flex flex-auto items-start",children:d.jsx("div",{className:Y("mx-6 flex min-h-12 flex-auto items-center bg-[#f4f4f4] py-1 pl-6 pr-2 dark:bg-token-main-surface-secondary",{"rounded-full":u,"rounded-2xl":!u,"bg-transparent":p}),children:d.jsxs("div",{className:"relative flex flex-auto items-center self-stretch",children:[d.jsx(Kn,{placeholder:c.formatMessage({id:"zrUbTJ",defaultMessage:"Ask ChatGPT to edit"}),disabled:t,value:i,className:Y("w-full resize-none border-0 bg-transparent p-0 text-token-text-primary outline-0 placeholder:text-token-text-secondary focus:ring-0 focus-visible:ring-0",{"opacity-0":p}),maxRows:4,onChange:({target:{value:m}})=>l(m),onKeyDown:h,onHeightChange:(m,{rowHeight:v})=>f(Math.floor(m/v)<=1)}),i?d.jsx(Q.button,{className:Y("dark h-8 w-8 rounded-full bg-token-main-surface-primary text-center dark:bg-token-main-surface-primary",{"self-end":!u}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:()=>g(),children:d.jsx(Gn,{className:"h-8 w-8 text-token-text-primary"})}):(a?.length??0)>0&&d.jsx(Fn,{disableHint:!0,isEmbeddedInPromptArea:!0,isRequestActive:t,actions:a,onCancel:n,onExpandedChange:m=>{St()||y(m),s?.(m)},onSubmit:r,right:0,bottom:4})]})})})]})};function _(){}_.prototype={diff:function(e,n){var s,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=o.callback;typeof o=="function"&&(r=o,o={});var a=this;function i(T){return T=a.postProcess(T,o),r?(setTimeout(function(){r(T)},0),!0):T}e=this.castInput(e,o),n=this.castInput(n,o),e=this.removeEmpty(this.tokenize(e,o)),n=this.removeEmpty(this.tokenize(n,o));var l=n.length,u=e.length,f=1,c=l+u;o.maxEditLength!=null&&(c=Math.min(c,o.maxEditLength));var p=(s=o.timeout)!==null&&s!==void 0?s:1/0,y=Date.now()+p,g=[{oldPos:-1,lastComponent:void 0}],h=this.extractCommon(g[0],n,e,0,o);if(g[0].oldPos+1>=u&&h+1>=l)return i(ut(a,g[0].lastComponent,n,e,a.useLongestToken));var m=-1/0,v=1/0;function E(){for(var T=Math.max(m,-f);T<=Math.min(v,f);T+=2){var I=void 0,D=g[T-1],M=g[T+1];D&&(g[T-1]=void 0);var P=!1;if(M){var j=M.oldPos-T;P=M&&0<=j&&j<l}var re=D&&D.oldPos+1<u;if(!P&&!re){g[T]=void 0;continue}if(!re||P&&D.oldPos<M.oldPos?I=a.addToPath(M,!0,!1,0,o):I=a.addToPath(D,!1,!0,1,o),h=a.extractCommon(I,n,e,T,o),I.oldPos+1>=u&&h+1>=l)return i(ut(a,I.lastComponent,n,e,a.useLongestToken));g[T]=I,I.oldPos+1>=u&&(v=Math.min(v,T-1)),h+1>=l&&(m=Math.max(m,T+1))}f++}if(r)(function T(){setTimeout(function(){if(f>c||Date.now()>y)return r();E()||T()},0)})();else for(;f<=c&&Date.now()<=y;){var b=E();if(b)return b}},addToPath:function(e,n,s,o,r){var a=e.lastComponent;return a&&!r.oneChangePerToken&&a.added===n&&a.removed===s?{oldPos:e.oldPos+o,lastComponent:{count:a.count+1,added:n,removed:s,previousComponent:a.previousComponent}}:{oldPos:e.oldPos+o,lastComponent:{count:1,added:n,removed:s,previousComponent:a}}},extractCommon:function(e,n,s,o,r){for(var a=n.length,i=s.length,l=e.oldPos,u=l-o,f=0;u+1<a&&l+1<i&&this.equals(s[l+1],n[u+1],r);)u++,l++,f++,r.oneChangePerToken&&(e.lastComponent={count:1,previousComponent:e.lastComponent,added:!1,removed:!1});return f&&!r.oneChangePerToken&&(e.lastComponent={count:f,previousComponent:e.lastComponent,added:!1,removed:!1}),e.oldPos=l,u},equals:function(e,n,s){return s.comparator?s.comparator(e,n):e===n||s.ignoreCase&&e.toLowerCase()===n.toLowerCase()},removeEmpty:function(e){for(var n=[],s=0;s<e.length;s++)e[s]&&n.push(e[s]);return n},castInput:function(e){return e},tokenize:function(e){return Array.from(e)},join:function(e){return e.join("")},postProcess:function(e){return e}};function ut(t,e,n,s,o){for(var r=[],a;e;)r.push(e),a=e.previousComponent,delete e.previousComponent,e=a;r.reverse();for(var i=0,l=r.length,u=0,f=0;i<l;i++){var c=r[i];if(c.removed)c.value=t.join(s.slice(f,f+c.count)),f+=c.count;else{if(!c.added&&o){var p=n.slice(u,u+c.count);p=p.map(function(y,g){var h=s[f+g];return h.length>y.length?h:y}),c.value=t.join(p)}else c.value=t.join(n.slice(u,u+c.count));u+=c.count,c.added||(f+=c.count)}}return r}function lt(t,e){var n;for(n=0;n<t.length&&n<e.length;n++)if(t[n]!=e[n])return t.slice(0,n);return t.slice(0,n)}function ct(t,e){var n;if(!t||!e||t[t.length-1]!=e[e.length-1])return"";for(n=0;n<t.length&&n<e.length;n++)if(t[t.length-(n+1)]!=e[e.length-(n+1)])return t.slice(-n);return t.slice(-n)}function Le(t,e,n){if(t.slice(0,e.length)!=e)throw Error("string ".concat(JSON.stringify(t)," doesn't start with prefix ").concat(JSON.stringify(e),"; this is a bug"));return n+t.slice(e.length)}function Ne(t,e,n){if(!e)return t+n;if(t.slice(-e.length)!=e)throw Error("string ".concat(JSON.stringify(t)," doesn't end with suffix ").concat(JSON.stringify(e),"; this is a bug"));return t.slice(0,-e.length)+n}function W(t,e){return Le(t,e,"")}function pe(t,e){return Ne(t,e,"")}function ft(t,e){return e.slice(0,xs(t,e))}function xs(t,e){var n=0;t.length>e.length&&(n=t.length-e.length);var s=e.length;t.length<e.length&&(s=t.length);var o=Array(s),r=0;o[0]=0;for(var a=1;a<s;a++){for(e[a]==e[r]?o[a]=o[r]:o[a]=r;r>0&&e[a]!=e[r];)r=o[r];e[a]==e[r]&&r++}r=0;for(var i=n;i<t.length;i++){for(;r>0&&t[i]!=e[r];)r=o[r];t[i]==e[r]&&r++}return r}var xe="a-zA-Z0-9_\\u{C0}-\\u{FF}\\u{D8}-\\u{F6}\\u{F8}-\\u{2C6}\\u{2C8}-\\u{2D7}\\u{2DE}-\\u{2FF}\\u{1E00}-\\u{1EFF}",Es=new RegExp("[".concat(xe,"]+|\\s+|[^").concat(xe,"]"),"ug"),Ee=new _;Ee.equals=function(t,e,n){return n.ignoreCase&&(t=t.toLowerCase(),e=e.toLowerCase()),t.trim()===e.trim()};Ee.tokenize=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n;if(e.intlSegmenter){if(e.intlSegmenter.resolvedOptions().granularity!="word")throw new Error('The segmenter passed must have a granularity of "word"');n=Array.from(e.intlSegmenter.segment(t),function(r){return r.segment})}else n=t.match(Es)||[];var s=[],o=null;return n.forEach(function(r){/\s/.test(r)?o==null?s.push(r):s.push(s.pop()+r):/\s/.test(o)?s[s.length-1]==o?s.push(s.pop()+r):s.push(o+r):s.push(r),o=r}),s};Ee.join=function(t){return t.map(function(e,n){return n==0?e:e.replace(/^\s+/,"")}).join("")};Ee.postProcess=function(t,e){if(!t||e.oneChangePerToken)return t;var n=null,s=null,o=null;return t.forEach(function(r){r.added?s=r:r.removed?o=r:((s||o)&&dt(n,o,s,r),n=r,s=null,o=null)}),(s||o)&&dt(n,o,s,null),t};function dt(t,e,n,s){if(e&&n){var o=e.value.match(/^\s*/)[0],r=e.value.match(/\s*$/)[0],a=n.value.match(/^\s*/)[0],i=n.value.match(/\s*$/)[0];if(t){var l=lt(o,a);t.value=Ne(t.value,a,l),e.value=W(e.value,l),n.value=W(n.value,l)}if(s){var u=ct(r,i);s.value=Le(s.value,i,u),e.value=pe(e.value,u),n.value=pe(n.value,u)}}else if(n)t&&(n.value=n.value.replace(/^\s*/,"")),s&&(s.value=s.value.replace(/^\s*/,""));else if(t&&s){var f=s.value.match(/^\s*/)[0],c=e.value.match(/^\s*/)[0],p=e.value.match(/\s*$/)[0],y=lt(f,c);e.value=W(e.value,y);var g=ct(W(f,y),p);e.value=pe(e.value,g),s.value=Le(s.value,f,g),t.value=Ne(t.value,f,f.slice(0,f.length-g.length))}else if(s){var h=s.value.match(/^\s*/)[0],m=e.value.match(/\s*$/)[0],v=ft(m,h);e.value=pe(e.value,v)}else if(t){var E=t.value.match(/\s*$/)[0],b=e.value.match(/^\s*/)[0],T=ft(E,b);e.value=W(e.value,T)}}var ws=new _;ws.tokenize=function(t){var e=new RegExp("(\\r?\\n)|[".concat(xe,"]+|[^\\S\\n\\r]+|[^").concat(xe,"]"),"ug");return t.match(e)||[]};var we=new _;we.tokenize=function(t,e){e.stripTrailingCr&&(t=t.replace(/\r\n/g,`
`));var n=[],s=t.split(/(\n|\r\n)/);s[s.length-1]||s.pop();for(var o=0;o<s.length;o++){var r=s[o];o%2&&!e.newlineIsToken?n[n.length-1]+=r:n.push(r)}return n};we.equals=function(t,e,n){return n.ignoreWhitespace?((!n.newlineIsToken||!t.includes(`
`))&&(t=t.trim()),(!n.newlineIsToken||!e.includes(`
`))&&(e=e.trim())):n.ignoreNewlineAtEof&&!n.newlineIsToken&&(t.endsWith(`
`)&&(t=t.slice(0,-1)),e.endsWith(`
`)&&(e=e.slice(0,-1))),_.prototype.equals.call(this,t,e,n)};function bs(t,e,n){return we.diff(t,e,n)}var Ms=new _;Ms.tokenize=function(t){return t.split(/(\S.+?[.!?])(?=\s+|$)/)};var Ss=new _;Ss.tokenize=function(t){return t.split(/([{}:;,]|\s+)/)};function _e(t){"@babel/helpers - typeof";return _e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_e(t)}var te=new _;te.useLongestToken=!0;te.tokenize=we.tokenize;te.castInput=function(t,e){var n=e.undefinedReplacement,s=e.stringifyReplacer,o=s===void 0?function(r,a){return typeof a>"u"?n:a}:s;return typeof t=="string"?t:JSON.stringify(je(t,null,null,o),o,"  ")};te.equals=function(t,e,n){return _.prototype.equals.call(te,t.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"),n)};function je(t,e,n,s,o){e=e||[],n=n||[],s&&(t=s(o,t));var r;for(r=0;r<e.length;r+=1)if(e[r]===t)return n[r];var a;if(Object.prototype.toString.call(t)==="[object Array]"){for(e.push(t),a=new Array(t.length),n.push(a),r=0;r<t.length;r+=1)a[r]=je(t[r],e,n,s,o);return e.pop(),n.pop(),a}if(t&&t.toJSON&&(t=t.toJSON()),_e(t)==="object"&&t!==null){e.push(t),a={},n.push(a);var i=[],l;for(l in t)Object.prototype.hasOwnProperty.call(t,l)&&i.push(l);for(i.sort(),r=0;r<i.length;r+=1)l=i[r],a[l]=je(t[l],e,n,s,l);e.pop(),n.pop()}else a=t;return a}var Re=new _;Re.tokenize=function(t){return t.slice()};Re.join=Re.removeEmpty=function(t){return t};var ve=(t=>(t.ADDED="added",t.REMOVED="removed",t.UNCHANGED="unchanged",t))(ve||{});function Pe(t){if(t==="")return 0;const e=t.split(`
`).length;return t.endsWith(`
`)?e-1:e}function As(t,e){return bs(t,e,{newlineIsToken:!0}).map(s=>({count:s.count??Pe(s.value),value:s.value,type:s.added?"added":s.removed?"removed":"unchanged"}))}function Is(t){let e="";for(const{type:n,value:s}of t)(n==="added"||n==="unchanged")&&(e+=s);return e}function Ds(t,e){const n=Pe(e),s=Ns(t,n);return{changes:As(s,e),numLinesDiffed:n}}function ks(t){const e=[...t],n=[],s=[];for(;e.length>0;){const o=e[e.length-1];if(o.type===ve.REMOVED)e.pop(),o.type===ve.REMOVED&&n.unshift(o);else if(o.type===ve.ADDED)e.pop(),s.unshift(o);else break}return{prunedChanges:[...e,...s],prunedRemovedChanges:n}}function Ls(t,e){const{changes:n,numLinesDiffed:s}=Ds(t,e),{prunedChanges:o,prunedRemovedChanges:r}=ks(n),a=Is(o),i=r.map(u=>u.value).join(`
`),l=At(t,s,"start");return{content:a+i+l,numLinesDiffed:Pe(a)}}function Ns(t,e){if(e<=0)return"";let n=0,s=t.length;for(let o=0;o<t.length;o++)if(t[o]===`
`&&(n++,n===e)){s=o+1;break}return t.substring(0,s)}function At(t,e,n="start"){if(e<=0)return t;if(n==="start"){let a=0;for(let i=0;i<t.length;i++)if(t[i]===`
`&&(a++,a===e))return t.substring(i+1);return""}let s=0,o=-1;const r=t.endsWith(`
`)?e+1:e;for(let a=t.length-1;a>=0;a--)if(t[a]===`
`&&(s++,s===r)){o=a;break}return o===-1?"":t.substring(0,o+1)}function _s(t,e){const n=t?.type??ge.LOADING,s=t?.content??"",o=!!t?.isPartial;if(!X(n)||e==null||!o||t?.isRewriting!==!0)return{content:s,currentlyStreamingLineIndex:null};const r=At(s,1,"end");if(r==="")return{content:e.content,currentlyStreamingLineIndex:0};const a=Ls(e.content,r);return{content:a.content,currentlyStreamingLineIndex:a.numLinesDiffed}}function js(t,e){const n=new Set(t.map(i=>i.id)),s=new Set(e.map(i=>i.id)),o=t.filter(i=>!s.has(i.id)).map(i=>({...i,diffStatus:ot.REMOVED})),r=e.filter(i=>!n.has(i.id)).map(i=>({...i,diffStatus:ot.ADDED})),a=t.filter(i=>s.has(i.id));return o.concat(r,a)}function Rs({textdocVersion:t}){const e=U(),n=Yt(),[s,o]=C.useState(!1),r=Jt(),a=C.useRef(t?.content??"");C.useEffect(()=>{a.current=t?.content??""},[t]);const i=l=>{s||(r(()=>{O.logButtonClick(K.COPY,{contentLength:a.current.length,textdocType:t?.type}),an(a.current,n,l)},0),o(!0),r(()=>o(!1),2e3))};return d.jsx(Ce,{label:e.formatMessage(Os.copy),children:d.jsx(Z,{icon:s?Wn:Yn,onClick:i})})}const Os=Oe({copy:{id:"rbIYfo",defaultMessage:"Copy"}});function Ps({textdocId:t,version:e,isHistorical:n,isShowingChanges:s,latestVersionInt:o,nextVersion:r,previousVersion:a,onHoverPrevious:i,textdocType:l}){const u=U(),f=e==null||e===1,c=e!=null&&e>1;return f&&!n?null:d.jsxs("div",{className:"flex items-center gap-1.5",children:[d.jsx(Ce,{label:c&&u.formatMessage({id:"PoD5+8",defaultMessage:"Previous version"}),children:d.jsx(Z,{disabled:!c,icon:Jn,onMouseOver:i,onClick:()=>{O.logButtonClick(K.HISTORY_PREVIOUS,{textdocType:l,isShowingChanges:s,textdocId:t,versionInt:e}),t&&e&&c&&ye(t,{beforeVersion:e},s&&a!=null?a:void 0)}})}),d.jsx(Ce,{label:n&&u.formatMessage({id:"PJ8YVJ",defaultMessage:"Next version"}),children:d.jsx(Z,{disabled:!n,icon:Qn,onClick:()=>{O.logButtonClick(K.HISTORY_NEXT,{textdocType:l,isShowingChanges:s,textdocId:t,versionInt:e}),n&&(r?ye(t,{version:r},s?r:void 0):s&&o?Et(t,o,null):ee(t))}})})]})}function Hs({textdocId:t,textdocType:e,history:n,version:s,isShowingChanges:o,latestVersionInt:r,onMouseEnter:a}){const i=U(),[l,u]=C.useState(!1),f=()=>{n?ye(t,n):ee(t)},c=(s?.versionInt??0)>1,p=()=>{O.logButtonClick(K.SHOW_CHANGES,{textdocType:e,textdocId:t,versionInt:s?.versionInt,latestVersionInt:r}),s?.versionInt!=null&&Et(t,s.versionInt,n)},y=()=>{u(!0),a?.()},g=()=>{u(!1)};return d.jsx(Ce,{label:c&&i.formatMessage(o?mt.hideChanges:mt.showChanges),children:d.jsx(Z,{icon:Xn,disabled:!c,onClick:o?f:p,onMouseEnter:y,onMouseLeave:g,className:Y("transition-colors",{"!bg-blue-400/20 !text-blue-400 transition-colors":l&&o&&c,"!bg-blue-400/15 !text-blue-400 transition-colors":!l&&o&&c,"!bg-transparent":!l&&!o&&c})})})}const mt=Oe({done:{id:"0MCBfo",defaultMessage:"Done"},showChanges:{id:"3jMGNS",defaultMessage:"Show changes"},hideChanges:{id:"HWiQSk",defaultMessage:"Hide changes"}}),qs=800,$s=100,ht=100,Us=({textdocId:t,isHistoricalVersion:e,nextHistoricalTextdocVersion:n,previousHistoricalTextdocVersion:s,textdocVersion:o,readonlyReason:r,history:a,latestVersionInt:i,hasDebug:l,contentWidth:u,isEmbedded:f,isPersisting:c,isShowChangesFeatureEnabled:p,isShowingChanges:y,hideHistoryActions:g=!1,prefetchHistoricalTextdocVersion:h,restoreHistoricalTextdocVersion:m,setShowDebugView:v,onClose:E})=>{const b=un(o?.title??""),[{width:T},I]=wt(),D=u-T-$s-ht>0,M=bt();return d.jsxs(J.Header,{children:[d.jsxs("div",{className:"flex flex-1 items-center leading-[0]",children:[d.jsx(J.CloseButton,{onClick:E}),D&&d.jsx("div",{className:"flex flex-row items-center gap-2.5",children:d.jsx(J.Title,{style:{maxWidth:u-T-ht},children:b||d.jsx("div",{className:"w-52",children:d.jsx(cs,{lines:1,size:"base",width:100,widthVariance:0})})})}),c&&d.jsx(ln,{size:12,className:"pl-2 text-token-text-secondary"})]}),d.jsxs("div",{className:"flex select-none items-center gap-2 leading-[0]",ref:I,children:[d.jsxs("div",{className:Y("flex items-center gap-2 transition-opacity duration-500",r===N.Streaming&&"pointer-events-none opacity-0"),children:[l&&u>qs&&d.jsx(Z,{icon:Zn,onClick:()=>v(P=>!P)}),!g&&d.jsx(Ps,{textdocId:t,isHistorical:e,isShowingChanges:y,version:o?.versionInt,previousVersion:s?.versionInt,nextVersion:n?.versionInt,readonlyReason:r,onHoverPrevious:h,onClickRestore:m,textdocType:o?.type,latestVersionInt:i}),!g&&p&&d.jsx(Hs,{textdocId:t,textdocType:o?.type,history:a,version:o,isShowingChanges:y,latestVersionInt:i,onMouseEnter:()=>{o?.versionInt&&M(t,o.versionInt),h()}}),d.jsx(Rs,{textdocVersion:o})]}),!f&&d.jsx(rs,{})]})]})},Bs=/\s/,Fs=30;function pt(t,e){const n=t.indexOf(e);return n===-1?!1:t.indexOf(e,n+e.length)===-1}function q(t,e){return Bs.test(t[e])}function gt(t,e,n=!1){if(e===0||n&&q(t,e-1))return e;for(;e>0&&q(t,e-1);)e--;for(;e>0&&!q(t,e-1);)e--;return q(t,e)&&e++,e}function vt(t,e,n=!1){if(e===t.length||n&&q(t,e))return e;for(;e<t.length&&q(t,e);)e++;for(;e<t.length&&!q(t,e);)e++;return q(t,e-1)&&e--,e}function Vs(t,e,n=!0,s=Fs){if(t.start<0||t.end>e.length||t.start>t.end)throw new Error("Invalid commentSourceRange provided.");const o=e.substring(t.start,t.end);let r=t.start,a=t.end;n&&(r=gt(e,r,!0),a=vt(e,a,!0));let i=e.substring(r,t.start),l=e.substring(t.end,a),u=`${i}${o}${l}`;if(pt(e,u)&&(s==null||u.length>=s))return{before:i,after:l,allSurrounding:u};let f=r,c=a,p=!0;for(;p&&(s==null||u.length<s);){let y=!1;const g=f>0?gt(e,f):f;g<f&&(f=g,y=!0);const h=c<e.length?vt(e,c):c;if(h>c&&(c=h,y=!0),y){const m=e.substring(f,t.start),v=e.substring(t.end,c),E=`${m}${o}${v}`;if(pt(e,E)&&(s==null||E.length>=s))return{before:m,after:v,allSurrounding:E};i=m,l=v,u=E}else p=!1}return{before:i,after:l,allSurrounding:u}}const ne="# Context",se="# Instructions";function oe(t,e,n){if(e==null||n==null)return`The user is referring to the entire text of "${t}".`;const s=`
## Selected Text
The user has selected this text in "${t}" in particular:
${e}
`.trim();return n.allSurrounding===e?s:`
${s}

## Surrounding Context
Here is the surrounding context:
${n.allSurrounding}
`.trim()}function It(t,e){return t==null||e==null?"entire document":t===e.allSurrounding?"selected text":"surrounding context"}function Dt(t){return`For the update pattern, create a regex which exactly matches the ${t}. Edit just this string in order to fullfill the user's request. NEVER rewrite the entire document. Instead, ALWAYS edit ONLY the ${t}. The only exception to this rule is if the ${t} includes markdown lists or tables. In that case, fully rewrite the document using ".*" as the regex update pattern.`.trim()}function zs(t,e,n,s){if(!X(e)&&n&&s){const o=It(n,s);return`
${ne}
The user requests that you directly edit the document.

${oe(t,n,s)}

${se}
Use the update_textdoc tool to make this edit. ${Dt(o)}`.trim()}return`
${ne}
The user requests that you directly edit the document.

${oe(t,n,s)}

${se}
Use the update_textdoc tool to make this edit. You MUST fully rewrite the entire document by using ".*" as the update regex pattern.`.trim()}function Gs(t,e,n){return`
${ne}
The user requests that you add comments about some text.

${oe(t,e,n)}

${se}
Do not respond to the user's question directly, just leave comments.`.trim()}function Ws(t,e){return X(t)?e==="entire document"?` If you choose to update the ${e}, you MUST fully rewrite the ${e} by using ".*" as the update regex pattern.`:` If you choose to update the ${e}, you MUST fully rewrite the entire document by using ".*" as the update regex pattern. When you do so, ONLY modify the ${e} and rewrite other sections exactly as is, except for parts that must change based on this update`:e==="entire document"?"":` If you choose to update the ${e}, follow these instructions: ${Dt(e)}`}function Ys(t,e,n,s){const o=It(n,s),r=Ws(e,o);return`
${ne}
${oe(t,n,s)}

${se}
The user would like you perform one of the following actions:
- Update the ${o} via the \`update_textdoc\` tool.${r}
- Explain the selected text via chat, or answer a general question about the selected text (no tool call required).
- Comment on the ${o} with feedback via the \`comment_textdoc\` tool. This should only be used if the user very explicitly asks for feedback, critique, or comments.

Based on the user's request, choose the appropriate action.
`.trim()}function Js(t,e,n){return`
${ne}
${oe(t,e,n)}

${se}
The user would like you to create a new textdoc.
`.trim()}function Qs(t,e,n,s=null,o=null){switch(n){case F.ASK:return Ys(t,e,s,o);case F.CREATE_TEXTDOC:return Js(t,s,o);case F.EDIT:return zs(t,e,s,o);case F.COMMENT:return Gs(t,s,o)}}function Xs(t){const e=fs(),n=jn(t),s=ds(t)??e.id,o=Rn({clientThreadId:t});return async function(r){const a=new cn,i=ns.getThreadCurrentLeafId(t),l=performance.now(),u=await Qt(),[f,c,p]=await Promise.all([Xt.getEnforcementToken(u),fn.getEnforcementToken(u),Zt.getEnforcementToken(u)]);o({model:s,completionType:Kt.Next,parentNodeId:i,metadata:{eventSource:"mouse"},completionMetadata:{conversationMode:n},chatReq:u,arkoseToken:f??null,turnstileToken:c??null,proofToken:p??null,preflightTime:performance.now()-l,appendMessages:r,turnTracker:a})}}function Zs(t){switch(t){case A.ACCELERATOR:case A.ACCEPT_COMMENT:return!0;case A.ASK_CHATGPT:case A.FULL_SCREEN_SUBMIT:return!1}}function Ks(t,e){switch(e){case A.ASK_CHATGPT:case A.ACCEPT_COMMENT:case A.FULL_SCREEN_SUBMIT:return t.formatMessage(to.askChatGPT);case A.ACCELERATOR:return}}const eo=(t,e)=>{const n=Xs(t),s=U(),{tags:o}=ms(t);return C.useCallback(({content:r,sourceRange:a,action:i,userMessageType:l,acceleratorMetadata:u,selectionMetadata:f})=>{if(e?.versionInt==null)return;const{textdocId:c,type:p,versionInt:y,content:g}=e;let h,m=null;a&&a.start!==a.end&&(h=g.slice(a.start,a.end),m=Vs(a,g));const v=Qs(c,p,i,h,m),b=dn(v,{exclude_after_next_user_message:!0});n([mn([r],{canvas:{textdoc_id:c,textdoc_type:p,version:y,textdoc_content_length:g.length,user_message_type:l,accelerator_metadata:u,selection_metadata:f},is_visually_hidden_from_conversation:Zs(l),targeted_reply:h,targeted_reply_label:Ks(s,l),open_in_canvas_view:{type:"canvas_textdoc",id:c}}),b])},[n,s,e,o])},to=Oe({askChatGPT:{id:"h5ANdM",defaultMessage:"Asked ChatGPT"}});function no(t){const e=/\[([^\]]+)\]\((https?:\/\/[^\s)]+|www\.[^\s)]+)\)/gi,n=new Set,s=t.matchAll(e);for(const o of s){const r=o[2];try{let a=r;a.startsWith("www.")&&(a="http://"+r),new URL(a),n.add(r)}catch{}}return n}const so=async({lastVersion:t,textdocId:e,content:n,comments:s})=>{const o=hn(s,n);return(await yt.safePost("/textdoc/{textdoc_id}",{parameters:{path:{textdoc_id:e}},requestBody:{version:t,content:n,comments:o}})).version},oo=()=>{const t=C.useRef([]),e=C.useRef(null),{mutateAsync:n,isPending:s}=en({mutationKey:["canvas","textdoc","persist"],mutationFn:so});return[C.useCallback(async(r,a,i)=>{const l=new AbortController,f=(async()=>{const[g]=t.current;try{await g?.promise}catch(h){O.logError("Saving document",h)}if(!l.signal.aborted)try{const h=Math.max(e.current??0,r.versionInt??Mt);let m="";try{nt(a)?m=a():m=a}catch(T){O.logError("Serializing document",T)}let v=[];try{nt(i)?v=i():v=i}catch(T){O.logError("Adjusting comments",T)}const{textdocId:E}=r;pn({textdocId:E,basedOnVersionInt:h,content:m,comments:v});const b=await n({textdocId:E,lastVersion:h,content:m,comments:v});gn({textdocId:E,basedOnVersionInt:h,newVersion:b}),e.current=b}catch(h){O.logError("Error saving document",h)}finally{t.current.shift()}})(),c={abort:()=>l.abort(),promise:f},[p,y]=t.current;return y&&(y.abort(),t.current=p?[p]:[]),t.current=p?[p,c]:[c],f},[n]),t,s]},ro=3e3,ao=t=>{const[e,n,s]=oo(),o=U(),r=C.useRef(null),a=C.useCallback(vn(e,ro,{leading:!1}),[e]),i=Cn(t);return C.useEffect(()=>{if(!i)return;const u=st(window,{pagehide:()=>a.flush(),beforeunload:c=>{a.flush(),c.returnValue=o.formatMessage({id:"QZrKwi",defaultMessage:"You have a canvas save in progress."})}}),f=st(document,{visibilitychange:()=>a.flush(),keydown:()=>{r.current="keyboard"},mousemove:()=>{r.current!=="mouse"&&a.flush(),r.current="mouse"}});return()=>{r.current=null,f(),u()}},[o,i,a]),C.useEffect(()=>()=>{a.flush()},[t,a]),yn(async()=>{await a.flush(),await Promise.allSettled(n.current?.map(({promise:u})=>u)??[])}),[C.useCallback((u,f,c)=>{const{textdocId:p}=u;return Tn(p),a(u,f,c)},[a]),a.flush,s||i]};function io(t,e,n){const s=Tt(),o=n!=null&&e!=null,{data:r,error:a,fetchNextPage:i,hasNextPage:l,isFetching:u}=tn(Ct(t,e,o)),f=C.useCallback(async()=>{const h=e!=null;await s.prefetchInfiniteQuery(Ct(t,e,h))},[s,t,e]);C.useEffect(()=>{const h=e;return()=>{s.removeQueries({queryKey:kt(t,h),exact:!0})}},[s,t,e]);const[c,p,y,g]=C.useMemo(()=>{if(r&&n){const m=r.pages.flatMap(E=>E),v=m.findIndex(E=>"beforeVersion"in n?(E.versionInt??Mt)<n.beforeVersion:E.versionInt===n.version);if(v!==-1)return[v===m.length-1,m[v],v>0?m[v-1]:null,v<m.length-1?m[v+1]:null]}const h=r?.pages.flatMap(m=>m)??[];return[!0,null,null,h.length===0?null:h[0]]},[r,n]);return C.useEffect(()=>{!u&&o&&l&&c&&i()},[u,o,l,c,i]),C.useEffect(()=>{!p&&a&&ee(t)},[p,a,t]),{historicalTextdocVersion:p,nextHistoricalTextdocVersion:y,prefetchHistoricalTextdocVersion:f,previousHistoricalTextdocVersion:g}}function kt(t,e=null){return["textdocHistory",t,e]}function Ct(t,e,n=!0){return{queryKey:kt(t,e),queryFn:({pageParam:s})=>uo(t,s),initialPageParam:e??void 0,getNextPageParam:s=>{const o=xn(s)?.versionInt;if(o&&o>1)return o},enabled:n,staleTime:1/0,retry:2}}async function uo(t,e){return e===void 0?[]:(await yt.safeGet("/textdoc/{textdoc_id}/history",{parameters:{path:{textdoc_id:t},query:{before_version:e}}})).previous_doc_states.map(({id:s,version:o,textdoc_type:r,title:a,content:i,updated_at:l,comments:u})=>({textdocId:s,versionInt:o,messageId:null,title:a,type:En(r),content:i,createdAt:wn(l),comments:bn(u,i)}))}const So=({isFullScreen:t=!1,isEmbedded:e=!1,hideHeader:n=!1,readonlyReason:s,clientThreadId:o,focusedTextdoc:r,onClose:a,isAnimating:i=!1,width:l,hideBottomComposer:u=!1})=>{const{textdocId:f,history:c,showChangesAtVersion:p=null}=r,[y,g]=C.useState(!1),[h,m,v]=ao(f),{targetedContent:E}=Mn(),b=as(),[T,I]=C.useState(!1),D=is(f),M=us(),P=ss(o),j=Sn(P),[re,Lt]=wt(),ae=An(),{data:H,isLoading:Nt}=In(f,ae?p:null),R=D?.versions??[],He=R[0]?.versionInt,{historicalTextdocVersion:ie,nextHistoricalTextdocVersion:_t,previousHistoricalTextdocVersion:qe,prefetchHistoricalTextdocVersion:jt}=io(f,He,c),Rt=bt();C.useEffect(()=>{Te.reset()},[f]),C.useEffect(()=>{D?.metadata?.textdocId&&rt().sendMessage({type:ke.Loaded})},[D?.metadata?.textdocId]);const $e=R.length>0?R[R.length-1]:null,be=R.length>1?R[R.length-2]:null,Ue=os(o),{restoreHistoricalTextdocVersion:Be,optimisticRestoredTextdocVersion:Ot}=Dn(Ue,$e,ie),V=c!=null,w=V?ie:$e,ue=ae&&p!=null,le=eo(o,w),Fe=i||!ae?null:H,ce=(()=>{if(i)return[];const x=w?.comments.filter(L=>L.status!==Nn.DISMISSED)??[];return w==null?x:!ue&&ie!=null?ie.comments:!ue||H==null?x:H.contentBefore!==H.contentAfter?[]:js(H.commentsBefore,H.commentsAfter)})(),fe=w?.type??ge.LOADING,$=!!w?.isPartial,Pt=Vn(M);C.useEffect(()=>{R.length===0&&!M&&Pt&&a?.()},[R.length,M]);const Ht=!!s&&s!==N.OldVersion,Me=$&&!!w?.isRewriting,qt=$&&!!w?.isCreation,{content:de,currentlyStreamingLineIndex:Ve}=H?.contentBefore!=null&&!X(fe)?{content:H.contentBefore,currentlyStreamingLineIndex:null}:_s(w,be),$t=hs(Ue,Array.from(no(de))),[me,Se]=ps({value:de,isRequestActive:j,isTextdocStreaming:$,comments:ce}),ze=kn(w),Ge=$||j||me||v;C.useEffect(()=>{rt().sendMessage({type:ke.Streaming,streaming:Ge})},[Ge]);const Ut=({getSerializedDocument:x,getAdjustedComments:k})=>{w&&h(w,x,k)},Bt=x=>{if(!w)return;const k=x.doc.toString();h(w,k,x.field(Un,!1)??[])},We=(x,k,L,B)=>{Se(!0),le({action:k,content:x,userMessageType:A.ASK_CHATGPT,sourceRange:L,selectionMetadata:{selection_type:B,selection_position_range:L}})},Ye=({id:x})=>{ze(x,at.DISMISS),Te.reset()},Je=async x=>{Se(!0);const{id:k,at:L,content:B}=x;if(await ze(k,at.ACCEPT)===!1)return Se(!1);le({content:B,userMessageType:A.ACCEPT_COMMENT,sourceRange:L,action:F.EDIT,selectionMetadata:{selection_type:it.SELECTION,selection_position_range:L}})},Ae=(x,k,L)=>{const{action:B}=L;le({action:B,content:k,sourceRange:x,userMessageType:A.ACCELERATOR,acceleratorMetadata:{action:B,id:L.id,prompt:k},selectionMetadata:x!=null?{selection_type:it.SELECTION,selection_position_range:x}:void 0})},Ft=x=>{le({action:F.EDIT,content:x,userMessageType:A.FULL_SCREEN_SUBMIT})},Vt=nn(),zt=Tt(),Gt=ls(),Qe=x=>Gt?.[x]??x,Ie=()=>qn({clientThreadId:o,currentRequestId:P,queryClient:zt,isHistoryAndTrainingDisabled:Vt}),Wt=()=>{c?ye(f,c):ee(f)};let S=s;V?S=N.OldVersion:ue?S=N.ShowingChanges:Ot!=null?S=N.Restoring:($||j)&&(S=N.Streaming);let he=null;const Xe=i||S!=null||me,Ze=()=>{if(i&&ce.length>0)return G.ALL_HIDDEN;if(S==null)return G.ENABLED;switch(S){case N.Streaming:return G.ENABLED;case N.ShowingChanges:case N.OldVersion:return G.COMMENTS_READONLY;default:return G.ALL_HIDDEN}},Ke=t||i;let De=[];switch(fe){case ge.LOADING:he=d.jsx($n,{});break;case ge.DOCUMENT:he=d.jsx(Pn,{value:de,comments:ce,previousValue:be?.content,previousComments:be?.comments,isRewriting:Me,isAnimatingFromPreview:i,getStableCommentId:Qe,diff:Fe,isRequestActive:j,isDisabled:S!=null||M,isWaitingForCommentResponse:me,hideAccelerators:Ke,hideToolbar:Xe,hideEditOverlay:i,commentsMode:Ze(),readonlyReason:S,onBlur:m,onSave:m,onChange:Ut,onCancelRequest:Ie,targetedContent:E,onAddComment:We,onAcceptComment:Je,onDismissComment:Ye,onSubmitAccelerator:Ae,onExitShowChanges:Wt,safeUrls:$t,width:l,modelCursor:$&&!Me?w?.modelCursor:void 0,shouldResetSelection:w?.versionInt===1}),De=zn;break;default:X(fe)&&(he=d.jsx(On,{id:"codemirror",getStableCommentId:Qe,language:Ln(fe),value:de,comments:ce,hideAccelerators:Ke,commentsMode:Ze(),hideToolbar:Xe,onSubmitAccelerator:Ae,currentlyStreamingLineIndex:Ve??null,readonlyReason:S,isRequestActive:j,isWaitingForCommentResponse:me,onChange:Bt,onCancelRequest:Ie,onAddComment:We,onDismissComment:Ye,onAcceptComment:Je,textdocDiff:Fe??void 0,modelCursor:$&&Ve==null?w?.modelCursor:void 0}),De=Bn)}return d.jsxs(J,{children:[y&&d.jsx(Hn,{zIndexKey:"acceleratorsOverlay",className:"bg-white/95 dark:bg-black/85"}),!n&&d.jsx(Us,{textdocId:f,isHistoricalVersion:V,nextHistoricalTextdocVersion:_t,previousHistoricalTextdocVersion:qe,textdocVersion:w,readonlyReason:S,history:c,hasDebug:b,contentWidth:re.width,isEmbedded:e,isPersisting:v,isShowChangesFeatureEnabled:ae,isShowingChanges:ue,latestVersionInt:He,hideHistoryActions:S===N.QueryParam,prefetchHistoricalTextdocVersion:()=>{jt();const x=qe?.versionInt;x!=null&&Rt(f,x)},restoreHistoricalTextdocVersion:Be,setShowDebugView:I,onClose:()=>{O.logButtonClick(K.CLOSE_TEXTDOC,{textdocType:w?.type}),a?.()}}),d.jsxs(J.Content,{ref:Lt,scrollToBottomMode:qt?"bottom":"top",shouldScrollToTop:Me,isLoading:Nt,children:[!1,he]}),d.jsx(xt,{children:V&&!Ht&&d.jsx(gs,{onClickRestore:Be,onClickResetLatest:()=>ee(f)})}),t&&!V&&!u&&d.jsx("div",{className:"relative flex items-center justify-center pb-3",children:d.jsx(Ts,{isRequestActive:j,clientThreadId:o,onSubmitAccelerator:Ae,onSubmit:Ft,onCancel:Ie,acceleratorActions:De,onAcceleratorsExpandedChange:x=>{St()||g(x)}})})]})};export{ke as C,So as T};
//# sourceMappingURL=g6zhr2d2cl3rcdfb.js.map
