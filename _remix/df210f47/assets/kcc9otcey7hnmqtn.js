import{c as R,f as C,em as D,bD as N,en as _,aj as L,a3 as P,dk as x,j as H,r as l,ad as F}from"./in4yvrl95oipp0rj.js";import{T as O}from"./kvl7elfd8vvqbpqv.js";import{cG as K,cH as $,cI as p,cJ as q}from"./k2c8mioruw1313fx.js";const h=R(C(()=>({statusMap:{}}))),J=a=>h(s=>s.statusMap[a]),Z=(a,s)=>{h.setState(t=>{t.statusMap[a]=s;const e=O.getServerThreadId(a);e&&(t.statusMap[e]=s)})},M=a=>{h.setState(s=>{for(const{id:t,async_status:e}of a)e!=null&&(s.statusMap[t]={source:D.SERVER,value:e})})},U=28,g="conversationHistory";function z({buckets:a,recentConversationLimit:s}={}){const e=N()?.includes(_)??!1,o=L(),c=!e&&!!o?.data,i=P(),{data:r,fetchNextPage:m,hasNextPage:k,isInitialLoading:b,isFetchingNextPage:v,isError:S}=x({queryKey:[g],queryFn:async({pageParam:n})=>{const y=await H.getConversations({offset:n,limit:U});return M(y.items),y},initialPageParam:0,getNextPageParam:n=>{const y=n.offset+n.limit;return y<n.total?y:void 0},enabled:c}),u=l.useMemo(()=>r?.pages.flatMap(n=>n.items)??[],[r]);l.useEffect(()=>{M(u)},[u]);const T=l.useMemo(()=>{if(!r||!a)return[];const n=j(u,i);return[n.recent,n.dynamicMonths,n.dynamicYears].flatMap(f=>Object.entries(f).map(([E,{items:Y,label:A}],I)=>({key:`${E}-${I}`,label:A,items:Y}))).filter(f=>f.items.length>0)},[u,r,i,a]),B=l.useMemo(()=>{const n=u.slice(0,s??5);return{key:"recents",label:i.formatMessage(d.historyBucketRecent),items:n}},[u,s,i]);return{buckets:T,conversations:u,data:r,fetchNextPage:m,hasNextPage:k,recents:B,isLoading:b,isFetchingNextPage:v,isError:S}}function j(a,s){return a.reduce((t,e)=>{const o=new Date(e.update_time??e.create_time??0),c=K(new Date,o);if(c===0)t.recent.today.items.push(e);else if(c<=1)t.recent.yesterday.items.push(e);else if(c<=7)t.recent.lastSeven.items.push(e);else if(c<=30)t.recent.lastThirty.items.push(e);else if($(o)){const i=p(o),r=q(o),m=`${i}-${r}`;t.dynamicMonths[m]?t.dynamicMonths[m].items.push(e):t.dynamicMonths[m]={label:s.formatDate(o,{month:"long"}),items:[e]}}else{const r=`${p(o)}-`;t.dynamicYears[r]?t.dynamicYears[r].items.push(e):t.dynamicYears[r]={label:s.formatDate(o,{year:"numeric"}),items:[e]}}return t},{recent:{today:{label:s.formatMessage(d.historyBucketToday),items:[]},yesterday:{label:s.formatMessage(d.historyBucketYesterday),items:[]},lastSeven:{label:s.formatMessage(d.historyBucketLastSeven),items:[]},lastThirty:{label:s.formatMessage(d.historyBucketLastThirty),items:[]}},dynamicMonths:{},dynamicYears:{}})}function W(a){a.invalidateQueries({queryKey:[g]})}const d=F({historyBucketRecent:{id:"history.bucket.recent",defaultMessage:"Recent"},historyBucketToday:{id:"history.bucket.today",defaultMessage:"Today"},historyBucketYesterday:{id:"history.bucket.yesterday",defaultMessage:"Yesterday"},historyBucketLastSeven:{id:"history.bucket.lastSeven",defaultMessage:"Previous 7 Days"},historyBucketLastThirty:{id:"history.bucket.lastThirty",defaultMessage:"Previous 30 Days"}});export{g as C,J as a,W as r,Z as s,z as u};
//# sourceMappingURL=kcc9otcey7hnmqtn.js.map
