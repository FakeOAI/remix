const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/nrl3pe170g06mu87.js","assets/nqo5y2f0dorhrqsr.js","assets/cupmtu2e3gr6f9u2.js","assets/root-dt9dgne1.css","assets/ob2kjer3jenmmp3x.js","assets/conversation-small-kq10986g.css","assets/e01y006cn48hetpv.js","assets/gcybe0ob8mhl2p7i.js","assets/jujg8edbx5xm3whm.js","assets/djpe2ctqrsum97u7.js","assets/lcg8hjmelswuvhqa.js","assets/jia4v37079g3n9z8.js","assets/koia3902t4l8lyfh.js","assets/ii1en7yhpim8b8zk.js","assets/jxshyg1alk4w8lqr.js","assets/mmw9wxod0h4xgm2y.js","assets/jb5zz6jl59vinlgp.js","assets/idhuzjvknqt51bsj.js","assets/fyalkbpdxo2bs0y4.js","assets/k1be5rttbtwhuw32.js","assets/c4bxzbp1808foto4.js","assets/ma7zq7og4qe95610.js","assets/gi7s3ts4iagluxq1.js","assets/mh3yx47r4jrjug1i.js","assets/oym1mrmwdfsve1vx.js","assets/acameby5mv3yop0n.js","assets/ktnfigx603oszyd9.js","assets/jvrp94ci4w0cp0zy.js","assets/bjv4hkrbkpjeaqnz.js","assets/c6vdn1q94ovnhwdl.js","assets/ofbzcc0yjqzl1nev.js","assets/mav83crfduvkg85m.js","assets/dmpkn2gqs9jol5uj.js","assets/i4tmz4dvnws9kwne.js","assets/mp8r2ngjjyd39sle.js","assets/jigpaeexz9arl6io.js","assets/l35pvk6j2ug7fgbc.js","assets/oe9cfjaq1efams39.js","assets/55lgxun9vzd2pqcf.js","assets/ftys3ya0ll88cgvi.js","assets/hifxaxopvmjhgnfa.js","assets/ks68szyxqhrfk19r.js","assets/fzrn137102spawew.js","assets/e9lafxuzyeh4418f.js","assets/jduckhgljimdwo8y.js","assets/jorn5slrl8ic18o0.js","assets/jw78725ze0inrzp9.js","assets/ibg9ije9qbdb8ju7.js","assets/n6j5rjf4ph5lr0lr.js"])))=>i.map(i=>d[i]);
import{av as pe,cF as Ze,P as K,e as X,bB as pa,a$ as Ie,ax as Kt,bo as It,as as P,aq as Ps,ar as rt,gX as to,cL as fa,c as Yr,d as Kr,d4 as Te,bD as an,B as Pe,aR as Oe,aS as ze,dQ as on,ao as lt,d6 as kt,r as Z,o as Ue,bq as Xr,a7 as jn,bd as Xt,ej as Qt,a2 as rn,bn as xa,fO as Qr,fM as Zr,el as Jr,cy as ei,dV as De,c9 as ti,j as Ds,F as so,aU as no,ak as ct,ea as si,fK as Cn,ah as Je,et as ni,m as ws,cI as ai,cJ as oi,b7 as ri,bp as ii,bQ as Ve,u as Cs,gY as li,a6 as Nt,gZ as ci,S as de,ce as di,D as ln,fV as ao,ai as oo,dP as ro,e$ as ui,W as mi,a4 as va,dF as Zt,fA as hi,g_ as io,aT as Ls,fz as Bs,bl as qe,al as Mn,g9 as Tn,s as _n,a1 as Qe,b8 as Sa,an as _t,J as At,n as Mt,a3 as lo,dW as gi,aW as pi,bb as fi,cz as co,bR as re,cg as xi,fE as vi,g$ as Si,Y as kn,Z as Js,e0 as bi,h0 as ba,d3 as yi,a5 as wi,eT as uo,O as ji,h1 as Ci,eX as Mi,bE as Ti,dN as cn,dY as _i,l as Xe,cQ as ki,dO as Ms,bv as ms,M as mo,ap as Ni,bf as Ai,h2 as Ei,eH as Ri,cE as Ii,be as Pi,dG as Di,h3 as ho,fI as Nn,N as An,fJ as Li,h4 as Bi,X as Fi,cX as Hi,ba as Ui,h5 as Oi,f2 as He}from"./cupmtu2e3gr6f9u2.js";import{j as e,r as i,M as U,ae as ne,af as Jt,c as xe,az as zi,f as go,e as En,a as po,Z as Gi,v as Wi,L as Ts,R as fo,aA as Vi,aB as qi,aC as ya}from"./nqo5y2f0dorhrqsr.js";import{aL as Pt,gY as $i,lb as Yi,lc as Ki,cR as Et,ld as xo,le as vo,lf as ye,cN as Fs,bE as qt,lg as _s,lh as Fe,hv as So,li as Xi,iW as bo,iZ as yo,ew as Qi,B as Zi,fv as Ji,iV as el,lj as wo,lk as tl,ll as sl,lm as Rt,ln as se,lo as jo,lp as ks,lq as nl,lr as al,ls as ol,lt as rl,ey as il,lu as ll,lv as cl,lw as dl,lx as ul,ly as ml,lz as hl,lA as gl,lB as pl,lC as fl,lD as xl,lE as vl,lF as Sl,lG as bl,lH as Co,lI as Rn,fC as In,lJ as Pn,hn as Dn,ho as it,hp as Ln,bO as yl,lK as Mo,kT as dn,lL as To,lM as wl,d4 as jl,f6 as Cl,lN as Ml,lO as Tl,lP as _l,lQ as Ns,lR as kl,kS as Nl,lS as _o,lT as Al,z as El,kQ as Rl,jW as ko,hI as Il,lU as Pl,bq as Bn,br as No,dz as Dl,dc as Ll,dA as Ao,c6 as Eo,bt as Fn,h1 as es,lV as wa,lW as Bl,lX as Fl,by as ja,bv as Hl,hM as Ul,j3 as Ca,lY as Ol,lZ as zl,l_ as Gl,l$ as Hn,m0 as Wl,m1 as Vl,bC as Ro,gh as Un,fR as On,m2 as Ma,ix as ql,bu as $l,m3 as Yl,hP as Kl,j9 as Xl,hQ as Ql,hN as Zl,m4 as Jl,bw as un,m5 as ec,m6 as tc,m7 as sc,m8 as nc,cr as ac,b8 as mn,m9 as oc,ck as zn,U as As,cM as Es,bR as Gn,cU as rc,ma as ic,mb as lc,mc as cc,hq as dc,md as uc,me as mc,mf as hc,mg as gc,mh as pc,mi as fc,dq as xc,hH as vc,kc as Sc,mj as bc,mk as yc,ml as wc,cz as Io,mm as jc,fE as Wn,mn as Cc,fD as Mc,mo as Tc,mp as _c,mq as hn,mr as kc,ms as Nc,cP as gn,mt as Ac,mu as Ec,mv as Rc,mw as Po,i0 as Vn,cS as $t,mx as Ic,my as Pc,mz as Dc,w as Lc,mA as pn,k as Do,mB as qn,mC as Ta,mD as Bc,mE as Fc,mF as Hc,mG as Uc,cL as Oc,mH as zc,mI as Gc,cO as Hs,cE as js,cg as Wc,i3 as Vc,mJ as qc,aS as _a,dH as Lo,dm as $c,eV as Yc,mK as Kc,aY as $n,mL as Yn,bs as Kn,hx as Xc,cy as Qc,dI as Zc,mM as Jc,mN as ed,aD as td,mO as Ke,aW as sd,mP as nd,mQ as fn,mR as ad,mS as hs,mT as Bo,mU as od,gL as rd,mV as id,iy as gs,mW as ld,aU as cd,d1 as dd,mX as ud,fr as md,q as hd,mY as gd,mZ as pd,fn as fd,m_ as xd,m$ as vd,cc as Sd,n0 as bd,n1 as Fo,n2 as Ho,n3 as Uo,n4 as Oo,n5 as Tt,eZ as Xn,n6 as yd,jb as wd,n7 as zo,n8 as jd,gk as Rs,n9 as xn,na as Cd,nb as Md,nc as ps,bS as ka,c4 as Go,c5 as Wo,gx as Vo,gz as qo,gV as Td,nd as _d,gQ as kd,ne as Nd,nf as Ad,ng as Ed,nh as Rd,ni as Id,bp as Pd,dp as Dd,gj as Ld,bT as Bd,nj as Fd,gW as fs,gw as Hd,gy as Ud,gH as Od,nk as zd,nl as Gd,nm as Wd,nn as Vd,no as qd,np as $d,nq as Yd,nr as Kd,ns as Xd,nt as Qd,bA as Zd,jQ as Jd,jP as eu,nu as tu,h6 as su,nv as nu,nw as au,nx as $o,y as ou,g6 as ru,hf as iu,hg as lu,ny as cu,nz as du,nA as Yo,bD as uu,nB as Ko,nC as mu,nD as hu,nE as gu,ca as pu,cb as fu,c9 as xu,ce as vu,nF as Su,cI as Is,ft as bu,bW as yu,bX as wu,is as ju,jU as Cu,nG as Mu,hk as Tu,nH as _u,nI as ku,nJ as Nu,nK as Au,nL as Eu,nM as Ru,aF as Iu,fo as Pu,bY as Du}from"./ob2kjer3jenmmp3x.js";import{B as Lu}from"./djpe2ctqrsum97u7.js";import{C as vn,g as Bu}from"./lcg8hjmelswuvhqa.js";import{S as Xo,a as Fu,b as Hu,G as Uu,L as Ou,c as zu}from"./jia4v37079g3n9z8.js";import{h as Qn,s as Gu,i as Wu,j as xs,k as Vu,l as qu,m as $u,t as Yu,n as Us,C as Qo,u as Zo,o as Ku,p as Jo,c as er}from"./koia3902t4l8lyfh.js";const Na=pe.div`m-8 flex flex-col items-center`;function Aa(t){return e.jsx(ne.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...t})}function Xu({clientThreadId:t}){const a=Ze(t,o=>o?.promptGptRating)?.gizmoId,{data:n}=Pt(a);return a==null||n==null||!$i(n)?null:e.jsx(Qu,{gizmoId:a})}function Qu({gizmoId:t}){const[s,a]=i.useState(!1),[n,o]=i.useState(!1),r=Yi(t),c=async u=>{a(!0),setTimeout(()=>{o(!0)},5e3),K.logEvent(X.submitInlineRating,{gizmo_id:t,rating:u}),await r.mutateAsync({rating:u})},l=async()=>{o(!0),K.logEvent(X.dismissInlineRating,{gizmo_id:t}),await r.mutateAsync({})};return i.useEffect(()=>{n||K.logEvent(X.showInlineRating,{gizmo_id:t})},[n,t]),n?null:s?e.jsx(Na,{children:e.jsxs(Aa,{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"rounded-lg border border-token-border-heavy p-4",children:e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(U,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),e.jsx(pa,{onClick:()=>{o(!0)}})]})}),e.jsx("div",{className:"text-xs text-token-text-tertiary",children:e.jsx(U,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):e.jsx(Na,{children:e.jsxs(Aa,{className:"flex flex-col items-center gap-4 rounded-lg border border-token-border-heavy p-4",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(U,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),e.jsx(pa,{onClick:l})]}),e.jsx(Ki,{rating:void 0,onRating:c})]})})}const vs={initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:.1},exit:{opacity:0,scale:.5,transition:{duration:.2}}},Zu=({suggestions:t,onSelectingSuggestedReply:s})=>e.jsx("div",{className:"absolute bottom-full flex w-full max-w-[100vw] grow gap-2 overflow-auto px-1 pb-1 contain-inline-size sm:mb-0 sm:justify-start sm:px-2 sm:pb-0 md:static md:mb-2 md:max-w-none md:justify-center md:overflow-visible",children:t.slice(0,2).map((a,n)=>e.jsx(ne.div,{initial:vs.initial,animate:vs.animate,transition:{delay:(n-1)*vs.transition.delay},exit:vs.exit,children:e.jsx(It,{as:"button",color:"secondary",size:"small",onClick:()=>{s(a,t,n)},className:"group whitespace-nowrap md:whitespace-normal",children:e.jsx(em,{suggestion:a})},n)},n))});function Ju({suggestions:t,onSelectingSuggestedReply:s,clientThreadId:a}){const n=t?.length>0;i.useEffect(()=>{n&&Et(t,a)},[n,a]);const{isUnauthenticated:o}=Ie();return n?t.every(xo)?e.jsxs(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"flex flex-col items-center",children:[o&&e.jsx(Kt,{className:"mb-6 h-12 w-12 sm:hidden"}),e.jsx(Xo,{starterPrompts:t,onSelectStarterPrompt:s})]}):t.every(vo)?e.jsx(Zu,{suggestions:t,onSelectingSuggestedReply:s}):null:null}function em({suggestion:t}){return vo(t)?e.jsx(e.Fragment,{children:t.text}):xo(t)?e.jsxs("div",{className:"flex flex-col overflow-hidden",children:[t.title&&e.jsx("div",{className:"truncate font-semibold",children:t.title}),e.jsx("div",{className:P("truncate font-normal",t.title?"opacity-50":""),children:t.body})]}):null}function tm(){const{store:t}=ye(),s=t.useSharedProps();return s?e.jsx(sm,{...s}):null}function sm({clientThreadId:t,suggestions:s}){const a=Fs();return s===void 0||s.length===0?null:e.jsx("div",{children:e.jsx(nm,{children:e.jsx("div",{className:"grow",children:s!==void 0&&e.jsx(Ju,{suggestions:s,onSelectingSuggestedReply:a,clientThreadId:t})})})})}const nm=pe.div`h-full flex ml-1 md:w-full md:m-auto gap-0 md:gap-2 justify-center`,tr=({className:t,children:s})=>e.jsx(ne.div,{className:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:s});function am({currentLeafId:t,canContinue:s,onContinueGenerating:a}){const n=i.useCallback(()=>{const r=new qt;a(t,r),_s()},[a,t]);let o=null;return s&&(o=e.jsx(rm,{onHandleContinueGenerating:n})),o&&e.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:o})}function om({className:t}){return e.jsx(So,{className:P("-rotate-180",t)})}const rm=({onHandleContinueGenerating:t})=>e.jsx(tr,{children:e.jsx(It,{as:"button",color:"secondary",onClick:t,className:"whitespace-nowrap py-2",icon:om,size:"small",children:e.jsx(U,{...Fe.continueGenerating})})}),im=({clientThreadId:t})=>{const s=to(),a=Ps(t),n=rt(a);i.useEffect(()=>{n&&fa.dismissBanner()},[n]);const o=s?.is_dismissible?()=>fa.dismissBanner():void 0;return e.jsx(Jt,{children:s&&e.jsx(ne.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(Xi,{clientThreadId:t,rateLimitInfo:s,onDismiss:o})})})};function lm(t){const s=Ps(t),a=rt(s),n=to();return!a&&n!=null}const Sn=window.sessionStorage,bn=Yr(Kr(()=>({memoryFullBannerDismissed:!!Sn?.getItem(an.MemoryFullBannerDismissed)}))),sr={dismissBanner(){bn.setState(t=>{t.memoryFullBannerDismissed=!0}),Sn?.setItem(an.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){bn.setState(t=>{t.memoryFullBannerDismissed=!1}),Sn?.removeItem(an.MemoryFullBannerDismissed)}};function cm(t){const s=Te(t),a=bo(),{data:n}=yo(s,!1,a),o=n!=null,r=o&&n.memoryFullPct>=100,[c,l]=i.useState(!1);i.useEffect(()=>{!r&&o&&(l(!0),sr.clearDismissedBanner())},[r,o]);const u=bn(m=>m.memoryFullBannerDismissed);return r&&c&&!u}function dm(){const t=xe(),{openSettings:s}=Qi();return e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(Zi,{title:t.formatMessage(Ss.memoryFullTitle),content:t.formatMessage(Ss.memoryFullTooltip,Ss.memoryFullTooltip.values),primaryCtaText:t.formatMessage(Ss.memoryManageButton),onPrimaryCtaClick:()=>s(Ji.Personalization),onDismiss:()=>sr.dismissBanner()})})}const Ss=Pe({memoryFullTitle:{id:"yRGU2/",defaultMessage:"Memory is full."},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"neUc+N",defaultMessage:"New memories won’t be created until you make space. <a>Learn more</a>",values:{a:t=>e.jsx("a",{href:el,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}}}),um=()=>{const{shouldShowSkipButton:t}=wo();return t?e.jsx(tr,{className:"flex justify-center",children:e.jsx(It,{as:"button",color:"secondary",onClick:()=>tl.skipParagen(),children:e.jsx(U,{...mm.skip})})}):null},mm=Pe({skip:{id:"dvcUbp",defaultMessage:"Skip"}}),nr=i.memo(function({className:s}){const{store:a}=ye(),n=a.useIsHeaderContentAreaPopulated();return e.jsx("div",{className:P(s??"absolute bottom-full left-0 right-0",ks.PromptTextareaHeader),children:e.jsx(sl,{shouldRender:n,contentArea:Rt.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(ar,{}),e.jsx(or,{})]})})})});function ar(){const{store:t}=ye(),s=t.useSharedProps(o=>o?.clientThreadId),a=t.useContentAreaId(Rt.HeaderTop);let n;switch(a){case se.AdvancedVoiceOnMobileAnnouncement:n=e.jsx(rl,{clientThreadId:s});break;case se.ParagenControls:n=e.jsx(um,{});break;case se.ItemActions:n=e.jsx(tm,{});break;case se.BannerSignup:n=e.jsx(pm,{});break;case se.BannerTermsDisclaimer:n=e.jsx(fm,{});break;case se.PromptTextareaAction:n=e.jsx(xm,{});break;case se.BannersRateLimit:n=e.jsx(vm,{});break;case se.BannerSidekickAnnouncement:n=e.jsx(ol,{});break;case se.SearchBrowserExtensionAnnouncement:n=e.jsx(al,{});break;case se.SearchBrowserExtensionReactiveAnnouncement:n=e.jsx(nl,{});break;case se.BannerMemoryFull:n=e.jsx(dm,{});break;case se.Box:n=e.jsxs("div",{className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;default:n=null;break}return n}function or(){const{store:t}=ye(),s=t.useContentAreaId(Rt.HeaderBottom);let a;switch(s){case jo.DallePromptControls:a=e.jsx(gm,{});break;default:a=null;break}return a}const hm=Oe(()=>ze(()=>import("./nrl3pe170g06mu87.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.default));function gm(){const{store:t}=ye(),s=t.useSharedProps(a=>a?.composerController);return s?e.jsx(hm,{composerController:s}):null}function pm(){const{store:t}=ye(),s=t.useSharedProps(o=>o?.clientThreadId),a=il(),n=ll();return s?a?e.jsx(cl,{threadId:s,showSignUp:n}):e.jsx(dl,{threadId:s,showLogin:n}):null}function fm(){const{store:t}=ye(),s=t.useSharedProps(a=>a?.clientThreadId);return s?e.jsx(ul,{threadId:s}):null}function xm(){const{store:t}=ye(),s=t.useSharedProps();return s?e.jsx(am,{...s}):null}function vm(){const{store:t}=ye(),s=t.useSharedProps(a=>a?.clientThreadId);return s?e.jsx(im,{clientThreadId:s}):null}const Sm=i.memo(function(s){return bm(s),ym(s),wm(),null});function bm(t){const{store:s}=ye(),a=s.useSetSharedProps();on(()=>{a(t)},[t,a])}function ym(t){const{clientThreadId:s,canContinue:a}=t,{store:n}=ye(),o=i.useRef({top:n.useContentAreaApi(Rt.HeaderTop),bottom:n.useContentAreaApi(Rt.HeaderBottom)}).current,r=Mm(t),c=ml(s),{shouldShowBannerSignup:l,shouldShowBannerTermsDisclaimer:u}=Tm(s),m=lm(s),d=hl(t),h=gl(t),g=pl(t),S=cm(s),x=fl(),f=xl(t);on(()=>{f.eligible?o.top.set(se.AdvancedVoiceOnMobileAnnouncement):x?o.top.set(se.ParagenControls):u?o.top.set(se.BannerTermsDisclaimer):m?o.top.set(se.BannersRateLimit):d.eligible?o.top.set(se.BannerSidekickAnnouncement):h?o.top.set(se.SearchBrowserExtensionAnnouncement):g?o.top.set(se.SearchBrowserExtensionReactiveAnnouncement):r?o.top.set(se.ItemActions):a?o.top.set(se.PromptTextareaAction):l?o.top.set(se.BannerSignup):S?o.top.set(se.BannerMemoryFull):o.top.set(null)},[o,r,a,u,l,m,d,S,x,f]),on(()=>{c&&o.bottom.set(jo.DallePromptControls)},[o,c])}function wm(){const{store:t}=ye();i.useEffect(()=>()=>{t.reset()},[t])}function jm(t){const s=Co(),a=lt(t),n=Z.getTree(t).getLastValidNode(a)?.message?.id;return s?.messageId===n?s.suggestions:[]}function Cm(t){return jm(t).length>0}function Mm(t){const s=vl(t.clientThreadId),a=Cm(t.clientThreadId);return t.isDisabled?!1:t.isNewThread||s||a}function Tm(t){const{isUnauthenticated:s}=Ie(),a=lt(t),{layer:n}=kt("3637408529"),o=n.get("should_show_no_auth_signup_banner",!0),r=Sl(g=>g.bannerDisclaimerClientThreadId),c=bl(),l={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1};if(!t)return l;const u=Z.getTree(t),m=u.countMessagesByAuthor(Ue.User),d=u.getNodeByIdOrMessageId(a),h=d?.message?.author.role===Ue.Assistant&&Xr(d.message);return l.shouldShowBannerTermsDisclaimer=h&&s&&m===1&&!c&&(r==null||r===t),l.shouldShowBannerSignup=o&&h&&s&&m>0&&m%5===0,l}function _m({composerController:t,isDisabled:s,highlightTooltip:a,clientThreadId:n}){const{setThreadSearchMode:o}=Rn(),r=In(),c=zi(),[l,u]=i.useState(!1),m=xe(),d={clientThreadId:n};return e.jsx(Nm,{highlightTooltip:a,analyticsMetadata:d,isThreadUsingSearchMode:r,isDisabled:s,children:e.jsxs("button",{className:P("flex h-8 min-w-8 items-center justify-center rounded-lg p-1 text-xs font-semibold",l&&"transition-all duration-150",r||a?"!rounded-2xl bg-blue-250 text-blue-1000 hover:bg-[#BDDCF4] dark:bg-[#2A4A6D] dark:text-[#48AAFF] dark:hover:bg-[#1A416A]":s?"opacity-30":"hover:bg-black/10 focus-visible:outline-black dark:focus-visible:outline-white"),"aria-pressed":r,"aria-label":m.formatMessage({id:"Sl1VH/",defaultMessage:"Search the web"}),disabled:s,onTransitionEnd:()=>u(!1),onClick:h=>{h.stopPropagation(),h.preventDefault(),u(!0),K.logEventWithStatsig(X.composerSearchButtonClicked,"composer_search_button_clicked",d),o(!r,d,jn.CONVERSATION_COMPOSER_WEB_ICON),/^search\s?$/i.test(t.getCurrentText())&&t.setText(""),t.replaceSlashCommandTokensWithText(),t.focus()},children:[e.jsx(Pn,{}),e.jsx(Jt,{children:r&&e.jsx(ne.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:c?0:.15},children:e.jsx("div",{className:"whitespace-nowrap pl-1 pr-2",children:e.jsx(U,{id:"TbHx8d",defaultMessage:"Search"})})})})]})})}function km(){const t=Dn(it.hasSeenComposerSearchButtonTooltip);return!t.isLoading&&t.eligible}function Nm({children:t,highlightTooltip:s,analyticsMetadata:a,isThreadUsingSearchMode:n,isDisabled:o}){const r=km()&&!n,c=Dn(it.hasSeenComposerSearchButtonTooltip);return r?e.jsx(Ln,{announcementKey:it.hasSeenComposerSearchButtonTooltip,side:"right",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(U,{id:"Yjduqi",defaultMessage:"Search the web"}),onDismiss:c.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(U,{id:"W51Aei",defaultMessage:"Get fast answers with trusted sources. {learnMore}",values:{learnMore:e.jsx(yl,{href:"https://openai.com/index/introducing-chatgpt-search",className:"underline",children:e.jsx(U,{id:"stA7F4",defaultMessage:"Learn more"})})}}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx(Xt,{sideOffset:0,label:o?e.jsx(U,{id:"GpDAWD",defaultMessage:"Search is unavailable"}):e.jsx(U,{id:"c+4o2s",defaultMessage:"Search the web"}),side:"right",open:s||(n?!1:void 0),onOpenChange:l=>{l&&K.logEventWithStatsig(X.composerSearchButtonHovered,"composer_search_button_hovered",a)},children:t})})}function Am({composerController:t,clientThreadId:s}){const a=Qt(s),{setThreadSearchMode:n}=Rn(),r=Mo().size>0,c=dn(s,rn.Search),l=To(s),[u,m]=i.useState([]),[d,h]=i.useState(void 0),[g,S]=i.useState(0);i.useEffect(()=>{m(d?l.filter(T=>T.name.toLocaleLowerCase().startsWith(d.text.toLocaleLowerCase())||T.systemHint.toLocaleLowerCase().startsWith(d.text.toLocaleLowerCase())):[])},[d]),i.useEffect(()=>{const T=C=>{h(E=>ei(E,C)?E:C)};t.view.dispatch(Gu(t.view.state.tr,{onHintMatch:T}))},[t]);const x=r||!l.length||!u.length||!d;i.useEffect(()=>{x&&S(0)},[x]);const f=u.length,R=i.useCallback(T=>{S(C=>(T(C)%f+f)%f)},[f]),j=u[g],M=({hintToSave:T=j,expectPerfectMatch:C,appendSpace:E=!0})=>{if(!d||!j||C&&T.name.toLowerCase()!==d.text.toLowerCase())return;K.logEvent(X.systemHintSelected,{system_hint:T.systemHint,conversation_id:a??xa});const A=d.text+T.name.slice(d.text.length),p={clientThreadId:s};Vu(t.view,{id:T.systemHint,hint:A},d.range,E,c,B=>n(B,p,jn.CONVERSATION_COMPOSER_SLASH_SEARCH)),xs(t.view)},y=i.useRef(M);y.current=M;const v=i.useRef(R);v.current=R;const N=i.useRef(d);N.current=d;const D=t.view;return i.useEffect(()=>(x||Wu(D,T=>{T==="up"?v.current(C=>C-1):T==="down"?v.current(C=>C+1):T==="cancel"?(xs(D),qu(D)):T==="submit"?(y.current({expectPerfectMatch:!1}),xs(D)):T==="checkMatch"&&y.current({expectPerfectMatch:!0,appendSpace:!1})}),()=>xs(D)),[x,D]),i.useEffect(()=>{x||K.logEvent(X.systemHintListOpened,{conversation_id:a??xa})},[x]),x?null:e.jsx(Qr,{className:"max-w-60",onMouseDown:T=>{T.preventDefault()},children:u.map((T,C)=>e.jsx("div",{onMouseOver:()=>S(C),onClick:()=>{M({hintToSave:T,expectPerfectMatch:!1}),t.focus()},children:e.jsx(Zr,{autoFocus:!1,className:"group rounded-lg px-1 py-2 hover:bg-token-hint-text",$spoofHovered:C===g,children:e.jsx(Em,{title:T.name,description:T.description,icon:e.jsx(wl,{svgString:T.logo,className:"icon-lg text-token-text-secondary group-hover:text-white"}),checked:!1})})},T.systemHint))})}function Em({title:t,description:s,icon:a,checked:n}){return e.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-1.5 pl-1.5 pr-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:a}),e.jsxs("div",{className:"shrink grow basis-0",children:[e.jsx("p",{className:"text-sm font-normal leading-tight text-token-text-primary group-hover:text-white",children:t}),!!s&&e.jsx("p",{className:"text-[13px] font-normal leading-[18px] text-token-text-secondary group-hover:text-white",children:s})]}),n&&e.jsx(Jr,{className:P("icon-md text-token-text-primary",{"group-hover:hidden":!n})})]})}function Rm({composerController:t,clientThreadId:s}){return t instanceof Qn?e.jsx(Am,{composerController:t,clientThreadId:s}):null}function Im({children:t,className:s,showBackground:a}){return e.jsxs("div",{className:"relative",children:[t,a&&e.jsx(ne.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:P("pointer-events-none absolute bottom-0 top-0 h-8 w-8 rounded-full",s)})]})}function Pm({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:a,modelSupportedImageMimeTypes:n,attachmentsProductFeature:o,getInputProps:r,openFileDialog:c,onOauthRedirect:l,historyDisabled:u,isDisabled:m,highlightTooltip:d}){const h=jl(),{gdriveStatus:g,o365Status:S}=Cl(),x=e.jsx(_l,{className:u?"text-white":d?"text-brand-blue-800":void 0}),f=g!=="false"||S!=="false"||h;return e.jsx("div",{className:"relative",children:e.jsx(Im,{showBackground:d,className:"bg-brand-blue-800/20",children:f?e.jsx(Ml,{clientThreadId:t,icon:x,modelAcceptedMimeTypes:a,modelSupportedImageMimeTypes:n,attachmentsProductFeature:o,onOauthRedirect:l,uploadType:s,openFileDialog:c,getInputProps:r,isDisabled:m,highlightTooltip:d}):e.jsx(Tl,{clientThreadId:t,uploadType:s,openFileDialog:c,getInputProps:r,icon:x,isDisabled:m,highlightTooltip:d})})})}function Dm({suggestions:t,composerController:s,onSelect:a,onChange:n}){const o=Fs(),r=i.useCallback((d,h,g)=>{a?.(d,h,g),o(d,h,g)},[a,o]),[c,l]=i.useState(-1),[u,m]=i.useState(!1);return i.useEffect(()=>{const d=h=>{if(h.key==="ArrowDown"){const g=c===t.length-1?0:c+1;l(g),n?.(g,!0,t[g])}else if(h.key==="ArrowUp"){h.preventDefault();const g=c<=0?t.length-1:c-1;l(g),n?.(g,!0,t[g])}else h.key==="Enter"&&!h.shiftKey&&t[c]&&r(t[c],t,c)};return s.subscribe("keydown",d)},[t,c,n,r,s]),i.useEffect(()=>s.subscribe("blur",()=>{l(-1),n?.(-1,!1)}),[s,n]),i.useEffect(()=>{if(!u){const d=()=>{m(!0),window.removeEventListener("mousemove",d)};return window.addEventListener("mousemove",d),()=>{window.removeEventListener("mousemove",d)}}},[u]),i.useEffect(()=>{l(-1),n?.(-1,!1),m(!1)},[t,n]),e.jsx(ne.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"hidden w-full flex-col p-2.5 group-focus-within:flex group-focus-within:max-lg:flex-col-reverse",children:t.map((d,h)=>e.jsxs(ne.li,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:h*.03},exit:{opacity:0,translateY:4},className:"w-full",children:[h>0&&e.jsx("div",{className:P("h-[1px] opacity-60 max-lg:hidden",c===h||c===h-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")}),e.jsxs("button",{className:P("flex w-full cursor-pointer items-center justify-start whitespace-pre-wrap rounded-lg px-2.5 py-3 text-start",c===h?"bg-token-main-surface-secondary":"bg-token-main-surface-primary"),onClick:g=>{g.preventDefault(),r(d,t,h)},onMouseDown:g=>{g.preventDefault()},onMouseEnter:()=>{u&&(l(h),n?.(h,!1,d))},onMouseLeave:()=>{l(-1),n?.(-1,!1,d)},children:[d.icon?e.jsx("span",{className:"mr-4 h-6 w-6 text-token-text-secondary",children:d.icon}):null,e.jsx("span",{className:"whitespace-pre-wrap",children:d.autocompletionChunks&&d.autocompletionChunks.length>0?e.jsx(e.Fragment,{children:d.autocompletionChunks.map((g,S)=>e.jsx("span",{className:P(g.isMatched?"text-token-text-tertiary":"text-token-text-primary"),children:g.text},S))}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:P(d.type===Ns.Starter?"text-token-text-secondary":"text-token-text-tertiary"),children:d.title}),e.jsx("span",{className:"text-token-text-primary",children:d.body})]})})]}),h>0&&e.jsx("div",{className:P("h-[1px] opacity-60 lg:hidden",c===h||c===h-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")})]},d.id??h))})}function Lm(t,s){t=t.toLocaleLowerCase();const a=s;s=s.toLocaleLowerCase();const n=[];let o=0;for(let l=0;l<s.length&&(o<t.length&&t[o]===s[l]&&(n.push(l),o++),o!==t.length);l++);const r=[];let c=0;if(n.forEach(l=>{if(l>c){const u=a.slice(c,l);u&&r.push({text:u,isMatched:!1})}r.push({text:a[l],isMatched:!0}),c=l+1}),c<s.length){const l=a.slice(c);l&&r.push({text:l,isMatched:!1})}return Bm(r)}function Bm(t){if(t.length===0)return t;let s=[t[0]];for(let n=1;n<t.length;n++){const o=s[s.length-1],r=t[n];o.isMatched===r.isMatched?o.text+=r.text:s.push(r)}const a=s.filter(n=>n.isMatched).reduce((n,o)=>n+o.text.trim().length,0);return s.length<=4&&a>=2?s:[{text:s.map(n=>n.text).join(""),isMatched:!1}]}const Fm=i.forwardRef(function({type:s,placeholder:a,replyRegions:n,state:o,renderFiles:r,leftSideActions:c,topRightAction:l,onSubmit:u,inputState:m,currentLeafId:d,composerController:h,clientThreadId:g,gizmoId:S,disableReason:x},f){const R=De(),j=kl();let M=null;const{isLoading:y}=j;y||(M=j.modelId),i.useEffect(()=>{y||Nl()||h.focus()},[M,h,y]);const v=N=>{Wm({target:N.target,rootId:"composer-background",additonalInteractiveIds:["reply-regions"]})||h.focus()};return e.jsxs("div",{id:"composer-background",ref:f,className:P("flex w-full cursor-text flex-col rounded-3xl px-2.5 py-1 transition-colors contain-inline-size",R&&"backdrop-blur-2xl no-transparency:backdrop-blur-none",R&&s!=="temporary"&&"bg-token-composer-surface",!R&&s!=="temporary"&&"bg-[#f4f4f4] dark:bg-token-main-surface-secondary",s==="temporary"&&"dark bg-black"),onClick:v,children:[e.jsx(Jt,{initial:!1,children:n.length>0&&e.jsx(ne.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0,transition:{duration:.06}},transition:{ease:"easeOut",duration:.1},id:"reply-regions",children:e.jsx(Um,{replyRegions:n})})}),e.jsxs(e.Fragment,{children:[r,e.jsxs("div",{className:"flex min-h-[44px] items-start pl-2",children:[e.jsx("div",{className:"min-w-0 max-w-full flex-1",children:h instanceof _o?e.jsx(Hm,{composerController:h,currentLeafId:d,placeholder:a,inputState:m}):e.jsx($u,{composerController:h,placeholder:a})}),e.jsx("div",{className:"w-[32px] pt-1",children:l})]}),e.jsxs("div",{className:"flex h-[44px] items-center justify-between",children:[e.jsx("div",{className:"flex gap-x-1",children:c}),e.jsx(Al,{inputState:m,state:o,onSubmit:u,composerController:h,clientThreadId:g,gizmoId:S,disableReason:x})]})]})]})});function Hm({composerController:t,currentLeafId:s,placeholder:a,inputState:n}){const o=i.useContext(ti);return e.jsxs(e.Fragment,{children:[e.jsx(El,{id:Rl,autoFocus:!0,tabIndex:0,"data-id":s,dir:"auto",ref:r=>{if(!(t instanceof _o))throw new Error("Expected TextAreaComposerController");r!=null&&(t.textArea=r,t.logPageMount())},rows:1,placeholder:a,disabled:n!=="default",className:P("m-0 resize-none border-0 bg-transparent px-0 text-token-text-primary focus:ring-0 focus-visible:ring-0",n==="disabled"&&"text-center",["max-h-[25dvh]","max-h-52"])}),e.jsx("script",{nonce:o.cspScriptNonce,suppressHydrationWarning:!0,children:"requestAnimationFrame((function(){window.__oai_logTTI?window.__oai_logTTI():window.__oai_SSR_TTI=window.__oai_SSR_TTI??Date.now()}))"})]})}function Um({replyRegions:t}){return e.jsx("div",{className:"flex cursor-auto flex-col divide-y divide-token-border-light overflow-hidden rounded-b-lg rounded-t-[20px] bg-token-main-surface-primary",children:t.map((s,a)=>{switch(s.type){case"text":return e.jsx(Om,{value:s.value,onRemoveRegion:s.onRemoveRegion},a);case"object":return e.jsx(zm,{value:s.value,onRemoveRegion:s.onRemoveRegion},a);case"mention":case"system_hint":return e.jsx(Gm,{value:s.value,icon:s.icon,onRemoveRegion:s.onRemoveRegion},a)}})})}function Om({value:t,onRemoveRegion:s}){return e.jsxs(Jn,{className:"text-token-text-secondary",children:[e.jsx(ea,{children:e.jsx(ko,{className:"icon-lg-heavy"})}),e.jsx(ta,{children:`“${t}”`}),e.jsx(Zn,{onClick:s})]})}function zm({value:t,onRemoveRegion:s}){return e.jsxs(Jn,{className:"text-blue-selection",children:[e.jsx(ea,{children:e.jsx(ko,{className:"icon-lg-heavy"})}),e.jsx(ta,{className:"font-semibold",children:t}),e.jsx(Zn,{onClick:s})]})}function Gm({value:t,icon:s,onRemoveRegion:a}){return e.jsxs(Jn,{children:[e.jsx(ea,{className:"mt-0",children:s}),e.jsx(ta,{className:"font-semibold text-token-text-primary",children:t}),e.jsx(Zn,{onClick:a})]})}function Zn({onClick:t}){return e.jsx("button",{onClick:t,type:"button",className:"flex-shrink-0 text-token-text-secondary",children:e.jsx(Il,{className:"icon-lg"})})}const Jn=pe.div`flex items-start py-2.5 gap-3 pl-3 pr-1.5 text-sm`,ea=pe.span`flex-shrink-0 mt-0.5 w-7 h-6 flex justify-center items-center`,ta=pe.span`flex-1 line-clamp-3 py-0.5`;function Wm({target:t,rootId:s,additonalInteractiveIds:a}){let n=t;for(;n&&n!=null;){if(n.tagName==="BUTTON"||n.tagName==="INPUT"||n.tagName==="TEXTAREA"||n.isContentEditable||a.includes(n.id))return!0;if(n.id===s)return!1;n=n.parentElement}return!1}function Vm({composerController:t,isDisabled:s,clientThreadId:a}){const n=xe(),o=Dn(it.hasSeenComposerSystemHintButtonTooltip),c=To(a).length>0,u=Mo().size>0,m=s===!0||!c||u;if(!(t instanceof Qn))return null;const d=t,h={clientThreadId:a};function g(){K.logEventWithStatsig(X.composerSystemHintButtonClicked,"composer_system_hint_button_clicked",h),o.markAsViewed(),d.focus(),Yu(d.view)}const S=e.jsx("button",{className:P("flex h-8 min-w-8 items-center justify-center rounded-lg p-1 text-xs font-semibold",m?"opacity-30":"hover:bg-black/10 focus-visible:outline-black dark:focus-visible:outline-white"),"aria-label":n.formatMessage({id:"oDAnGy",defaultMessage:"Use a tool"}),disabled:m,onPointerDown:g,onMouseDown:x=>{x.preventDefault()},onClick:x=>{x.preventDefault(),x.detail===0&&g()},children:e.jsx(Pl,{})});return!o.isLoading&&o.eligible?e.jsx(Ln,{announcementKey:it.hasSeenComposerSystemHintButtonTooltip,show:!0,side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(U,{id:"tTydhk",defaultMessage:"All your tools, in one handy place"}),onDismiss:o.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(U,{id:"S+BFNe",defaultMessage:"Create a canvas, generate a picture, and more."}),children:S}):e.jsx(Xt,{side:"right",sideOffset:0,label:s?e.jsx(U,{id:"uw9x80",defaultMessage:"Tools unavailable"}):e.jsx(U,{id:"mrYNGk",defaultMessage:"View tools"}),onOpenChange:x=>{x&&K.logEventWithStatsig(X.composerSystemHintButtonHovered,"composer_system_hint_button_hovered",h)},children:S})}const qm=1,$m=3e3;function Ym({files:t,className:s}){const a=Es(),n=No(),o=pc();return e.jsxs("div",{className:s,children:[o.map(r=>e.jsx(fc,{textdocId:r.tempTextdocId,userCreatedTextdoc:r},r.tempTextdocId)),t.map(r=>e.jsx(xc,{borderRadius:"2xl",useV2Style:!0,width:a?"normal":"wide",onRemoveFileClick:()=>un.remove(n,r.tempId,"none"),file:r.file,fileId:r.fileId??void 0,contextConnectorInfo:r.contextConnectorInfo,loadingPercentage:r.status===vc.Uploading?r.progress:void 0},r.tempId))]})}function Km({onAbortCompletion:t,onCreateNewCompletion:s,onContinueGenerating:a,currentModelId:n,clientThreadId:o,isNewThread:r,isCompletionInProgress:c,className:l,disabled:u=!1,disabledReason:m,canPause:d=!1,canContinue:h=!1,suggestions:g,isInteractableSharedThread:S,composerContainerRef:x,autocompletions:f,requiresFileUpload:R,onComposerInput:j,onComposerChange:M,onAutocompleteSelect:y,headerClassName:v,hideHeader:N,setComposerBarElement:D,onTaggingDropdownOpen:T,onTaggingDropdownClose:C}){const E=i.useRef(null),A=Sc(E,D),p=Us(),B=Bn(),w=Ds(),{isUnauthenticated:H}=Ie(),G=xe(),_=so(),I=No(),b=lt(o),F=Ps(o),[Y]=go(),te=En(),{gizmoEditorData:q,mode:ie,getGizmoId:le}=Dl(),J=no(),he=Ll(),we=ct(),Le=Ao(),ce=Qt(o),fe=!!si(),je=!!Cn(),[ve,Ae]=i.useState({}),{setThreadSearchMode:Ee,clearSearchModeTrigger:Be,getSearchModeTrigger:Ce}=Rn(),O=In(),[L,V]=i.useState(!1),[W,Q]=i.useState(!1),ae=De(),ge=i.useRef(!1),Se=Eo(),oe=n!==null?Se[n]:void 0,Re=Ze(o,k=>k?.overrideModelId);let $=Fn(o),Me=$&&"gizmo"in $?$.gizmo:void 0;const Ge=es(Me?.gizmo.id),[ee,dt]=i.useState(null);ee!==null&&($={gizmo:ee,gizmo_id:ee.gizmo.id,kind:Je.GizmoInteraction},Me=ee);const ut=wa(oe,$);let mt=!1;Bl($)&&Me?.gizmo.id===Fl&&(mt=!0);const Os=ni(),Dt=!u&&!mt&&ut!==ja.None&&!H,$e=Hl(oe,$),ht=Ul(oe,$);let _e=Ca(k=>k.files);const[gt]=i.useState(()=>Ol());ie==="magic"?_e=_e.filter(k=>k.gizmoId!=null):_e=_e.filter(k=>k.gizmoId==null);const ts=zl(),pt=_e.length>0||ts,Lt=Ca(bc.hasUploadInProgress),Bt=p.useState(k=>{const me=Gl(k);return typeof oe?.maxTokens=="number"&&me>oe.maxTokens}),Ft=p.useState(k=>!k.isEmpty()),ft=!Bt&&!Lt&&(Ft||pt);Hn(_e.length>0||Lt||Ft);const et=(ut===ja.Multimodal?Wl:Vl)-_e.length,Ht=et<=0,Ye=ft&&!u&&!c&&!je,[tt,zs]=i.useState(!1),xt=Ro(),vt=n||xt.id,St=dn(o,rn.Search),bt=!u&&!Me&&J?.includes(ws.SearchTool)&&(J?.includes(ws.BrowsingAvailable)||!w?.isEnterprisey()),Ut=bt&&St,Gs=Se[vt]?.tags,{targetedContent:Ws,setTargetedContent:st}=Un(),ke=Ws?.isFocusedViewContent&&!Le?void 0:Ws,{rebaseSystemMessageContent:ss}=On();i.useEffect(()=>{if(!B?.id)return;const k=Ma.getAndReset(B?.id,ce);k&&p.setText(k.inputText)},[B?.id,ce,p]),i.useEffect(()=>{tt!==Ye&&(zs(Ye),Ye&&ai(!0).then(k=>{ql.startEnforcement(k),oi.startEnforcement(k)}))},[Ye,tt,$?.kind,J]);const yt=$l(oe,$),{handleFileAccepted:na}=Yl(G,wa(oe,$),$e,"mouse",le,yt?.attachments),{getInputProps:Vs,open:qs}=Kl({disabled:u||!Dt||Ht,noClick:!0,onDropAccepted:na,onDropRejected:k=>Xl(k,G,_,ut),multiple:!0,maxSize:Ql,maxFiles:et,...Zl(ht)}),ns=ri(gt),as=i.useCallback(()=>{p.eraseContent(),ns.clearMessages(),p.resize(qm),Z.clearOverrideModelId(o),Jl();for(const k of _e)un.remove(I,k.tempId,"none");ec.markAllAsSent()},[p,ns,_e,I,o]),wt=async(k,me)=>{if(k?.preventDefault(),u||!ft&&!me||!$||Nt.isLoading(o)!==!1)return;const Ne=new qt;V(!0);const be=p.getContentToSend(),nt=yc(be.content),Xs=`${b}-nextPrompt`,Gt=new wc(Io.CompletionRequest,{expectedTimingLogs:[{name:"prompt_submitted",expectedInMs:3e3}]}),{content:qr,attachments:da}=jc(I,nt,oe,$),ua=[],Qs=[];ss&&Qs.push(ci(ss));const Zs={...$};"gizmo"in Zs&&delete Zs.gizmo;let ds=p.getSystemHints();O&&(ds=[Wn.Search]);const ma=Ce(),$r=O?ma??jn.CONVERSATION_COMPOSER_WEB_ICON:void 0,ha=Cc(),ga=Mc();let Wt={promptId:Xs,content:qr,eventMetadata:{eventSource:k?"mouse":"keyboard"},completionMetadata:{suggestions:g,conversationMode:Zs,systemHints:ds,searchSource:$r},messageMetadata:{...da.length>0&&{attachments:da},...ee&&{gizmo_id:ee?.gizmo.id},...ve,...ds.length>0&&{system_hints:ds},...!!be.metadata&&{serialization_metadata:be.metadata},...ha.length>0&&{canvas:{user_created_textdocs:ha.map(us=>({user_created_temp_textdoc_id:us.tempTextdocId,type:us.type,title:us.title,content:us.content}))}},...Object.keys(ga).length>0&&{__internal:{search_settings:ga}}},prependMessages:ua.length>0?ua:void 0,appendMessages:Qs.length>0?Qs:void 0,turnTracker:Ne,profiler:Gt,requestedModelId:Re};Wt=Tc(Wt),ke?.createNewCompletionParams&&(Wt=await ke.createNewCompletionParams(Wt)),Gt.logTiming("request_params_ready"),await s(Wt),ke?.onCreateCompletion?.({serverThreadId:ce,currentLeafId:b}),ke?.shouldPersistAcrossMessages!==!0&&st(void 0),As.hideThreadHeader(),as(),V(!1),Gt.logTiming("prompt_submitted"),g!==void 0&&(de.logEvent("chatgpt_prompt_ignore_suggestions"),K.logEvent(X.promptIgnoreSuggestions)),O&&ma&&Be()},$s=i.useRef(wt);i.useEffect(()=>{$s.current=wt});const Ys=k=>{st(k.targetedReply),k.targetedReply&&(p.focus(),K.logEvent(X.targetedReplyButtonClicked,{conversationId:ce,sourceMessageId:k.messageId}))},os=i.useCallback(()=>{ke?.onCleared?.({serverThreadId:ce,currentLeafId:b}),st(void 0),p.focus()},[b,ce,ke,st,p]),rs={Enter:{validator:k=>{const me=k.isComposing||k.keyCode===229;return!(W&&ge.current)&&(k.metaKey||(he||di)&&!k.shiftKey&&!me)},handler:k=>{if(!Ye){Bt&&_.danger("The message you submitted was too long, please submit something shorter.",{hasCloseButton:!0});return}k.preventDefault(),wt()}},Escape:{validator:k=>!k.isComposing,handler:k=>{d&&c&&(t("",F),K.logEvent(X.pauseCompletion,{threadId:Z.getServerThreadId(o),currentLeafId:Z.getTree(o).getMessageId(b),eventSource:"keyboard"})),k.target.value===""&&os()}}},z=i.useRef(rs);z.current=rs;const ue=tc(Gs,$?.kind),[We,jt]=i.useState(!1),[Ot,aa]=i.useState(!1),is=ue&&We&&!Ge,oa=p.isReady();i.useEffect(()=>p.subscribe("keydown",k=>{p.acceptLegacyKeydown()&&z.current[k.key]?.validator(k)&&z.current[k.key].handler(k);const Ne=p.getCurrentText();if(k.key==="@"){const be=p.getSelectionStart(),nt=Ne.substring(0,be);(!nt||/\s$/.test(nt)||be===0)&&setTimeout(()=>jt(!0),10)}else We&&jt(!1);if(k.key==="Escape"&&(dt(null),Q(!1)),Ut&&!O){let be;k.key==="Backspace"?be=Ne.substring(0,Ne.length-1):be=Ne+k.key,/^search\s?$/i.test(be)?aa(!0):Ot&&aa(!1)}O&&k.key==="Escape"&&Ee(!1,{clientThreadId:o})}),[p,oa,We,Ot,Ut,O,Ee,o]),i.useEffect(()=>{const k=Object.fromEntries(Object.keys(z.current).map(me=>[me,be=>{const nt=z.current[me];if(!nt||p.acceptLegacyKeydown())return!1;const{validator:Xs,handler:Gt}=nt;return Xs(be)?(Gt(be),!0):!1}]));p.registerKeyHandlers(k)},[p,oa]),i.useEffect(()=>p.subscribe("paste",k=>{sc({filePickerStore:I,event:k,intl:G,toaster:_,clientThreadId:o,conversationMode:$,currentModelConfig:oe,getEditorGizmoId:le,modelSupportedImageMimeTypes:$e})}),[G,o,$,oe,le,$e,p,_,I]);const wr=k=>{fe||dt(k),p.trimLeadingText("@"),_s(),jt(!1)},jr=nc(o,gt,$e,yt?.attachments),Cr=i.useCallback(k=>{k?.preventDefault(),t("",F),K.logEvent(X.pauseCompletion,{threadId:Z.getServerThreadId(o),currentLeafId:Z.getTree(o).getMessageId(b),eventSource:"mouse"}),_s()},[t,o,F,b]),ra=i.useCallback(()=>{Ma.set(B?.id,ce,p.getCurrentText())},[ce,B?.id,p]);i.useEffect(()=>{q||!L&&!ac()&&p.focus()},[L,p]),i.useEffect(()=>{q||un.reset(I)},[n,I,q]),i.useEffect(()=>{(!ue&&ee||fe)&&dt(null)},[ue,ee,fe]);const[Mr,Tr]=(()=>{switch(m){case"workspaceDisallowsGizmo":return[Fe.disallowedByWorkspacePlaceholder,!0];case"feedbackRequired":return[Fe.disabledFeedbackPlaceholder,!0];case"noModelsAvailable":return[Fe.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[Fe.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[Fe.loading,!0];case"noTestGizmoId":return[Fe.noTestGizmoId,!0];default:return S?[Fe.placeholderWithName,!1]:ke?.placeholderTextOverride!=null?[ke.placeholderTextOverride,!1]:[Fe.placeholderWithName,!1]}})(),_r=Ge&&r?G.formatMessage(mn.newChatInProject):G.formatMessage(Mr,{name:q!=null?ie==="magic"?oc:q.name||"GPT":Me?.gizmo.display.name??"ChatGPT"});i.useEffect(()=>p.subscribe("input",()=>{zn.getState().isThreadHeaderVisible&&As.hideThreadHeader(),Q(!0)}),[p]),i.useEffect(()=>{if(j)return p.subscribe("input",()=>{j?.()})},[p,j]),i.useEffect(()=>{if(M)return p.subscribe("change",()=>{M?.()})},[p,M]),i.useEffect(()=>p.subscribe("focus",()=>{Q(!0)}),[p]);const ia=$?.kind===Je.PrimaryAssistant&&!O,kr=ii(ws.CanvasOptIn),{layer:Nr}=Ve("4211831761"),{value:Ar}=Cs("3131522605"),Er=!Es()&&(Ar||Nr.get("enable",!1)||kr),Rr={clientThreadId:o,uploadType:ut,modelAcceptedMimeTypes:ht,modelSupportedImageMimeTypes:$e,attachmentsProductFeature:yt?.attachments,getInputProps:Vs,openFileDialog:qs,historyDisabled:we,onOauthRedirect:ra,highlightTooltip:R&&!pt},ls=[],Ir=!u&&!Ht&&(Dt||Os!=null)&&!O;ls.push(e.jsx(Pm,{...Rr,isDisabled:!Ir},"file-upload-button")),Er&&ls.push(e.jsx(Vm,{composerController:p,clientThreadId:o,isDisabled:!ia},"system-hint-button")),bt&&ls.push(e.jsx(_m,{composerController:p,highlightTooltip:Ot,clientThreadId:o,isDisabled:!Ut||pt},"search-button"));const Pr=pt&&e.jsxs(e.Fragment,{children:[ie==="magic"&&e.jsx("div",{className:"m-2 mb-0 rounded-lg bg-token-main-surface-secondary p-2 text-xs text-token-text-secondary",children:e.jsx(U,{...Fe.gizmoKnowledgeWarning})}),e.jsx(Ym,{files:_e,className:"flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),Dr=Tr?"disabled":"default",Lr=c&&d,Br=li(),Fr=!Ye||L||Br,Hr=_c(Lt,Ft,Bt),cs=Lr?"streaming":Fr?"disabled":"idle",zt=i.useRef(null),Ct=i.useRef(null),Ur=n&&n.startsWith("o1");i.useEffect(()=>{const k=()=>{zt.current!=null&&ln.addAction("composer_state_disabled",{threadId:Z.getServerThreadId(o),disabledReason:zt.current})};if(ft&&cs==="disabled"){let me="unknown";u?me=m??"component_disabled_unknown":c?me="completion_in_progress":je?me="thread_hard_blocked":L&&(me="starting_new_completion_request"),zt.current!==me&&(Ct.current&&clearTimeout(Ct.current),Ct.current=setTimeout(k,$m)),zt.current=me}else zt.current=null;return()=>{Ct.current&&(clearTimeout(Ct.current),Ct.current=null)}},[o,ft,cs,u,m,c,je,L]);const Ks=[];if(ke?.label&&Ks.push({type:ke.type,value:ke.label,onRemoveRegion:os}),ee!==null){const k=!!ee.gizmo.tags?.includes(Gn.FirstParty);Ks.push({type:"mention",value:ee.gizmo.display.name,icon:e.jsx(rc,{isFirstParty:k,src:ee.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{dt(null),p.focus()}})}i.useEffect(()=>{(!f||f.length===0||!W)&&(ge.current=!1)},[f,W]);const Or=(k,me,Ne)=>{ge.current=k>=0,me&&p.setText(Ne?`${Ne.title}${Ne.body}`:"")},la=W&&f&&f.length>0&&!is&&!p.hasMultipleLines()&&p.canShowAutocompletion();i.useEffect(()=>{is?T?.():C?.()},[is,T,C]);const ca=cs==="streaming"?Cr:wt,zr=dn(o,rn.Canvas),{value:Gr}=Cs("61299031"),Wr=Es(),Vr=zr&&Gr&&!ts&&!Wr;return e.jsxs(ic.Provider,{value:gt,children:[e.jsx(lc,{onOauthRedirect:ra,children:e.jsx("form",{className:l,onSubmit:ca,children:e.jsxs("div",{className:"relative flex h-full max-w-full flex-1 flex-col",children:[!N&&!ae&&e.jsx(nr,{className:v}),is&&e.jsx("div",{className:P("absolute bottom-full my-3",r&&"lg:top-full",ks.TagGpt),children:e.jsx(cc,{onClick:k=>wr(k),onClose:()=>{jt(!1),p.focus()}})}),ia&&e.jsx("div",{className:P("absolute bottom-full my-3",r&&"lg:top-full",ks.TagGpt),children:e.jsx(Rm,{composerController:p,clientThreadId:o})}),e.jsxs("div",{ref:x,className:"group relative flex w-full items-center",children:[r&&Y.has("from_template_row")&&e.jsx("button",{type:"button",onClick:()=>{te("/")},className:"mr-2 flex h-8 w-8 items-center justify-center text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(dc,{className:"icon-lg"})}),e.jsx(Fm,{type:we?"temporary":"default",ref:A,replyRegions:Ks,placeholder:_r,inputState:Dr,composerController:p,leftSideActions:ls,topRightAction:Vr&&e.jsx(uc,{composerRef:E,composerController:p,clientThreadId:o}),state:cs,onSubmit:ca,renderFiles:Pr,currentLeafId:b,clientThreadId:o,gizmoId:Me?.gizmo.id,disableReason:Hr,modelId:vt}),la&&e.jsx("div",{className:"absolute left-0 z-10 box-border w-full bg-token-main-surface-primary pl-0 max-lg:bottom-full lg:top-full",children:e.jsx(Dm,{suggestions:f,composerController:p,onSelect:y,onChange:Or})})]}),e.jsx(mc,{composerController:p,parsedDocumentHandler:jr})]})})}),e.jsx(Sm,{canUseInlineTagging:ue,isDisabled:u,clientThreadId:o,currentLeafId:b,currentRequestId:F,canContinue:h,composerController:p,setPromptInputMetadata:Ae,suggestions:g,isNewThread:r,onCreateNewCompletion:s,onContinueGenerating:a,onResetState:as,conversationMode:$,isShowingAutocomplete:!!la}),$!=null&&!Ur&&hc.includes($.kind)&&e.jsx(gc,{clientThreadId:o,onTargetedReply:Ys})]})}function Xm(t){const s=t.message?.author.role===Ue.User,a=t.metadata?.err!=null&&t.metadata?.errCode!==Sa.ContentPolicy,n=t.metadata?.errCode===Sa.ModelIncompatibility;return t.metadata?.canRetry===!1||n?!1:s||a}function Qm(t){return e.jsx(Qo,{clientThreadId:t.clientThreadId,children:e.jsx(Zm,{...t})})}function Zm({clientThreadId:t,isNewThread:s,currentModelId:a,showPromptStarters:n,noWrap:o,onRequestCompletion:r,composerContainerRef:c}){const l=Us(),u=Mn(),m=Tn(),d=_n(g=>{const S=Nt.getCurrentNode(t,g);return Xm(S)});if(Po(l),!m&&d)return e.jsx(Jm,{clientThreadId:t});const h=e.jsx(e.Fragment,{children:e.jsx(rr,{composerContainerRef:c,clientThreadId:t,currentModelId:a,isNewThread:s,showPromptStarters:n,onRequestCompletion:r})});return o?h:e.jsxs(e.Fragment,{children:[e.jsx(Xu,{clientThreadId:t}),e.jsx(Vn,{clientThreadId:t,isStaticSharedThread:u,withVerticalPadding:!1,withHorizontalPadding:!0,children:e.jsx($t,{children:h})})]})}function Jm({clientThreadId:t}){const s=Ic(t),a=_n(r=>Nt.getCurrentNode(t,r).metadata?.errCode===Pc),n=Dc(r=>r.isoDate),o=lt(t);return a&&n!=null&&n!==""?null:e.jsxs("div",{children:[e.jsx("div",{className:"mb-3 text-center text-xs",children:e.jsx(U,{...Ea.errorGeneratingResponse})}),e.jsx("div",{className:"flex items-center md:mb-4",children:e.jsx(It,{as:"button",color:"primary",onClick:()=>{const r=new qt;de.logEvent("chatgpt_regenerate_due_to_error_button_clicked",void 0,Qe({clientThreadId:t})),s({id:o,eventMetadata:{eventSource:"mouse"},conversationMode:Nt.getConversationMode(t),turnTracker:r})},className:"m-auto",icon:So,"data-testid":"regenerate-thread-error-button",children:e.jsx(U,{...Ea.regenerateResponse})})})]})}function rr({clientThreadId:t,currentModelId:s,isNewThread:a,onRequestCompletion:n,showPromptStarters:o,composerContainerRef:r,autocompletions:c,requiresFileUpload:l,onComposerInput:u,onComposerChange:m,onAutocompleteSelect:d,headerClassName:h,hideHeader:g,onTaggingDropdownClose:S,onTaggingDropdownOpen:x}){const f=lt(t),R=Ps(t),j=hn(),{isUnauthenticated:M}=Ie(),v=ao(t)===oo.STREAMING,N=ro({clientThreadId:t,conversationLeafId:f}),D=rt(R),T=ui({clientThreadId:t}),C=!M,E=mi(),{isOpen:A,onClose:p}=kc({type:"just-hit-rate-limit"}),B=i.useCallback((L,V)=>{K.logEvent(X.continueCompletion),n({type:va.Continue,promptId:L,eventMetadata:{eventSource:"mouse"},cancelActiveRequests:!1,completionMetadata:{conversationMode:Nt.getConversationMode(t)},turnTracker:V})},[n,t]),w=po(),H=i.useCallback(async(L,V)=>Nc({clientThreadId:t,currentRequestId:V,isHistoryAndTrainingDisabled:E,queryClient:w}),[t,E,w]),G=i.useCallback(async({promptId:L,content:V,eventMetadata:W,completionMetadata:Q,messageMetadata:ae,prependMessages:ge,appendMessages:Se,turnTracker:oe,profiler:Re,requestedModelId:$})=>{const Me=Z.getThreadCurrentLeafId(t);Z.updateTree(t,Ge=>{Ge.addNode(L,V,Me,Ue.User,void 0,ae)}),await n({type:va.Next,promptId:L,eventMetadata:W,cancelActiveRequests:!0,completionMetadata:Q,prependMessages:ge,appendMessages:Se,turnTracker:oe,profiler:Re,...$?{requestedModelId:$}:{}})},[t,n]),_=Ze(t,L=>L?.tree.getHasErrorFromNode(f)??!1),I=Ze(t,L=>L?.tree.isMessageIncomplete(f)??!1),b=!N&&(D||v),F=i.useMemo(()=>b?!1:!_&&I,[_,I,b]),Y=b&&s!=="gpt-4-pbrowse",te=Zt(t),q=Te(t),ie=Pt(q).data,{promptStarters:le,isSuccess:J}=gn(a&&!te,t,4),he=Co(),we=(()=>{if(he?.messageId===Z.getTree(t).getLastValidNode(f)?.message?.id)return he?.suggestions;if(o&&!te&&J&&!C)return le})(),Le=Ac(),ce=hi(),fe=(()=>{if(ie?.gizmo.tags?.includes(Gn.WorkspaceDisabled)&&!ce)return"workspaceDisallowsGizmo";if(Le.size){if(j.displayingSideBySideFeedback&&j.unskippable)return"feedbackRequired"}else return"noModelsAvailable";const V=Nt.getConversationMode(t);return V?.kind===Je.GizmoTest&&V.gizmo_id==null?"noTestGizmoId":null})(),je=io(t),ve=Ls(t),Ae=Cs("15117983")?.value,Ee=Gi(),Be=Bs(),Ce=Ee.action==="moderate",{value:O}=qe("1860647109");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center",children:Be&&Ce&&O?e.jsx(Ec,{}):null}),A?e.jsx(Rc,{onClose:p}):null,Ae&&ve&&ve.kind===Je.PrimaryAssistant&&ve.plugin_ids&&ve.plugin_ids.length>0?e.jsx(eh,{}):e.jsx(Km,{composerContainerRef:r,clientThreadId:t,onCreateNewCompletion:G,onAbortCompletion:H,onContinueGenerating:B,currentModelId:s,isNewThread:a,isCompletionInProgress:T,className:"w-full",canContinue:F,suggestions:we??[],disabled:!!fe,disabledReason:fe??void 0,canPause:Y,isInteractableSharedThread:je,autocompletions:c,requiresFileUpload:l,onComposerInput:u,onComposerChange:m,onAutocompleteSelect:d,headerClassName:h,hideHeader:g,onTaggingDropdownClose:S,onTaggingDropdownOpen:x},t)]})}function eh(){return e.jsxs("div",{className:"mx-auto flex max-w-md flex-col items-center justify-center gap-2 rounded-xl border border-token-border-light bg-token-main-surface-primary p-6 shadow-lg",children:[e.jsx("span",{className:"text-token-text-primary",children:e.jsx(U,{id:"PluginsDecrepatedNotice.pluginsDeprecationTitle",defaultMessage:"Conversations with plugins are archived"})}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(U,{id:"PluginsDecrepatedNotice.pluginsDeprecationSubtitle",defaultMessage:"Explore GPT Store to find a replacement"})}),e.jsxs("a",{href:"https://chat.openai.com/gpts",className:"text-green-500 hover:cursor-pointer dark:text-green-400",children:[e.jsx(U,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLink",defaultMessage:"Explore GPTs"}),e.jsx("span",{className:"ml-2",children:e.jsx(U,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLinkArrow",defaultMessage:"→"})})]})]})}const Ea=Pe({errorGeneratingResponse:{id:"PromptTextarea.errorGeneratingResponse",defaultMessage:"There was an error generating a response"},regenerateResponse:{id:"PromptTextarea.regenerateResponse",defaultMessage:"Regenerate"}}),ir=i.memo(function(){return e.jsxs("div",{className:`flex flex-col gap-2 ${ks.PromptTextareaHeader}`,children:[e.jsx(ar,{}),e.jsx(or,{})]})}),fg=Object.freeze(Object.defineProperty({__proto__:null,ChatScreenComposerAlerts:ir},Symbol.toStringTag,{value:"Module"})),Ra=Oe(()=>ze(()=>import("./gcybe0ob8mhl2p7i.js"),__vite__mapDeps([7,1,4,2,3,5,8,9,10,11,12])).then(t=>t.SnorlaxSplashScreen)),en=4;function th(t){const{layer:s}=Ve("3533083032"),{layer:a}=kt("3533083032"),{value:n,isLoading:o}=qe("3006519778");return o||!n?!1:t?s.get("enable_new_homepage_anon",!1):a.get("enable_new_homepage_anon",!1)}function sh(){const{layer:t}=kt("4031588851"),s=t.get("autocomplete_qualified_start_date","2099-09-13T00:00:00Z"),a=Bn();return!!a&&a.created*1e3>=new Date(s).getTime()}function nh(t){const{layer:s}=Ve("4031588851"),{layer:a}=kt("4031588851"),{value:n,isLoading:o}=qe("633009675");return o||!n?!1:t?s.get("enable_new_autocomplete_homepage",!1):a.get("enable_new_autocomplete_homepage",!1)}const tn=t=>`${t.title}${t.body}`.toLocaleLowerCase();function lr(t){const s=Te(t.clientThreadId),a=es(s);return e.jsx(Qo,{clientThreadId:t.clientThreadId,children:a&&s&&Ra?e.jsx(Ra,{clientThreadId:t.clientThreadId,gizmoId:s,currentModelId:t.currentModelId,onRequestCompletion:t.onRequestCompletion}):e.jsx(lh,{...t})})}function ah({children:t}){const{store:s}=ye(),[a,n]=i.useState(!1),o=Us();i.useEffect(()=>o.subscribe("focus",()=>{n(!0)}),[o]),i.useEffect(()=>o.subscribe("blur",()=>{n(!1)}),[o]);const c=!!s.useSharedProps()?.isShowingAutocomplete;return t(c&&a)}function oh({isUnauthenticated:t,shouldShowLegacyStarterPrompts:s,legacyPromptStarters:a,isSendBlocked:n,clientThreadId:o}){return e.jsxs("div",{className:P(t?"justify-end lg:justify-center":"justify-center","flex h-full flex-shrink flex-col items-center overflow-y-hidden text-token-text-primary lg:hidden"),children:[e.jsx("div",{className:P(t&&"flex sm:items-center md:flex-1","flex-shrink-0"),children:e.jsx(Kt,{className:"mb-6 h-12 w-12"})}),s&&(a&&a.length>0?e.jsx(mh,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},promptStarters:a,isSendBlocked:n,clientThreadId:o,isSquare:t}):e.jsx(Fu,{}))]})}function rh({isSendBlocked:t,clientThreadId:s,headlineOption:a,enableNewMobileDesign:n,shouldShowStarterPrompts:o,promptChips:r,onSelectStarterPrompt:c,starterPromptExpanded:l,setStarterPromptExpanded:u}){const m=qn();return e.jsx(ah,{children:d=>e.jsxs(ne.div,{initial:{opacity:0},animate:{opacity:d?0:1},exit:{opacity:0},transition:{duration:.1},className:P("justify-center",d?"pointer-events-none":"","mt-[var(--screen-optical-compact-offset-amount)] flex h-full flex-shrink flex-col items-center overflow-hidden text-token-text-primary",m?"@lg/thread:hidden":"lg:hidden"),children:[a==="CHATGPT_LOGO"?e.jsx(Kt,{className:"inline-block h-12 w-12"}):e.jsx(cr,{headlineOption:a}),e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:P(!n&&(m?"@lg/thread:hidden":"lg:hidden"),!l&&"h-[116px]"),children:o&&e.jsx(ur,{starterPrompts:r,onSelectStarterPrompt:c,disabled:t,clientThreadId:s,onExpand:()=>u(!0),mobileLayout:!0})})]})})}function ih(t,s,a){const n=qe("1468311859").value,o=qe("3664702598").value,{layer:r}=Ve("4031588851"),c=sh(),l=t||s,u=l&&n,m=l&&o&&c;let d="HARDCODED";if(l)if(a){const h=r.get("search_autocomplete_mode","");u&&h&&(d=h)}else m&&(d=r.get("autocomplete_mode","HARDCODED"));return d}function lh({clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:n,v2HomepageDisclaimer:o}){const r=Us(),c=_t(t),l=Zt(t),u=Cn(),[m,d]=i.useState([]),{trendingSuggestions:h,fetchTrendingSuggestions:g}=hh(en),S=i.useRef(!1),{isUnauthenticated:x}=Ie(),f=Lc(),[R,j]=i.useState(!1),M=In(),y=De();Po(r);const v=qe("589604007").value,{layer:N}=kt("4031588851"),{layer:D}=Ve("4031588851"),{layer:T}=kt("3533083032"),{layer:C}=Ve("3533083032"),{promptStarters:E,isSuccess:A}=gn(c&&!l&&a,t,8,v,!0,s??void 0),{promptStarters:p,isSuccess:B,isError:w}=gn(c&&!l&&a,t,4,void 0,void 0,s??void 0),H=f&&!!m.find(O=>!!O.requires_file_upload),G=i.useCallback(O=>{const L=r.getCurrentText();return L&&tn(O).startsWith(L.toLocaleLowerCase())},[r]),_=i.useCallback(O=>{const L=r.getCurrentText(),V=O.title+O.body;return G(O)?{...O,title:L,body:V.slice(L.length)}:{...O,title:V,body:""}},[r,G]),I=i.useCallback((O=!1)=>{d(L=>!L.some(G)&&L.length>0?[]:O?L:L.map(_))},[G,_]),b=(O,L,V)=>{const W=O.title;d([]),r.focus(),r.setText(W),requestAnimationFrame(()=>{const Q=(E?.filter(ae=>ae.theme===O.theme)??[]).map(ae=>{const ge=Mt(ae.oneliner),Se=ge.startsWith(ae.title);return{...ae,title:Se?`${ae.title} `:"",body:Se?ae.body:ge,autocompletionChunks:Lm(W,ge),type:Ns.Autocomplete}});d(Q),Q.length>0&&Et(Q,t),Hc(O,V,t)})};i.useEffect(()=>{const O=m.some(L=>L.theme===pn.Search);M&&r.getCurrentText()===""?h.length>0?d(h):g():O&&!M&&d(L=>L.filter(V=>V.theme!==pn.Search))},[m,M,h,g,r]);const F=E?.reduce((O,L)=>(L.theme&&!O[L.theme]&&(O[L.theme]=L),O),{}),Y=[];if(F)for(const O in F)Y.push(F[O]);const te=Y&&Y.length>0,q=!!(A&&te&&a),ie=!!((B||w)&&a),le=en-m.filter(G).length,J=x?C.get("enable_new_mobile",!1):D.get("enable_new_mobile",!1),he=ih(J,f,M),we=x?T.get("headline_option","HELP_WITH"):N.get("headline_option","HELP_WITH"),Le=N.get("autocomplete_min_char",4),ce=N.get("autocomplete_fetch_interval",200),fe=i.useRef(null),je=i.useCallback(Do(async O=>{const L=r.getCurrentText();if(!L||L.length<Le||L.length>80||r.hasMultipleLines()){d([]);return}if(!S.current&&!(fe.current&&fe.current.length>Le&&L.startsWith(fe.current)))try{const V=await At.generateAutocompletions(L,O,M);if(V.completions.length===0){fe.current=L;return}const W=V.completions.map(Q=>({id:Wi(),type:Ns.Autocomplete,title:Q.slice(0,L.length),body:Q.slice(L.length),oneliner:Q,prompt:Q,source:he})).filter(G).map(_);d(Q=>{const ae=Q.filter(G),ge=W.filter(Se=>{const oe=tn(Se);return!ae.some(Re=>{const $=tn(Re);if(oe===$)return!0;const Me=/[\p{P}\p{S}]$/u,Ge=oe.replace(Me,""),ee=$.replace(Me,"");return Ge===$||oe===ee||Ge===ee})}).slice(0,en-ae.length);return[...ae,...ge]}),W.length>0&&Et(W,t)}catch{}},he==="BING"?150:ce),[r,he,_,ce]),ve=i.useCallback(()=>{I(),le>0&&je(le)},[je,I,le]);i.useEffect(()=>{S.current&&d([])},[S]);const Ae=i.useMemo(()=>he==="HARDCODED"?I:ve,[he,ve,I]),Ee=i.useCallback(()=>{r instanceof Qn&&I(!0),r.getCurrentText().indexOf(`
`)>0&&d([])},[r,I]),Be=i.useCallback((O,L,V)=>{L.forEach(W=>{W.id===O.id&&(W.userInput=r.getCurrentText())}),d([L[V]])},[r]),Ce=qn();return e.jsx(e.Fragment,{children:e.jsx(Jt,{children:e.jsx("div",{className:P("h-full w-full",Ce?"@lg/thread:py-[18px]":"lg:py-[18px]"),children:e.jsx(Vn,{isStaticSharedThread:!1,withVerticalPadding:!1,withHorizontalPadding:!0,clientThreadId:t,fullHeight:!0,children:e.jsxs(Ta,{children:[e.jsx("div",{className:P("mb-7 hidden text-center",Ce?"@lg/thread:block":"lg:block"),children:we==="CHATGPT_LOGO"?e.jsx(Kt,{className:"inline-block h-12 w-12"}):e.jsx(cr,{headlineOption:we})}),!J&&e.jsx(oh,{isUnauthenticated:x,shouldShowLegacyStarterPrompts:ie,legacyPromptStarters:p,isSendBlocked:u,clientThreadId:t}),J&&e.jsx(rh,{headlineOption:we,enableNewMobileDesign:J,shouldShowStarterPrompts:q,promptChips:Y,onSelectStarterPrompt:b,starterPromptExpanded:R,setStarterPromptExpanded:j,isSendBlocked:u,clientThreadId:t}),e.jsx("div",{className:P(Ce?"@lg/thread:absolute @lg/thread:bottom-8 @lg/thread:left-0 @lg/thread:w-full":"lg:absolute lg:bottom-8 lg:left-0 lg:w-full"),children:e.jsx(Ta,{children:y?e.jsx(ir,{}):e.jsx(nr,{className:"block"})})}),e.jsx("div",{className:"w-full",children:e.jsx(rr,{clientThreadId:t,isNewThread:c,currentModelId:s,onRequestCompletion:n,showPromptStarters:!1,autocompletions:m,requiresFileUpload:H,onComposerInput:Ae,onComposerChange:Ee,onAutocompleteSelect:Be,onTaggingDropdownClose:()=>{S.current=!1},onTaggingDropdownOpen:()=>{S.current=!0},hideHeader:!0})}),e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:P("hidden",Ce?"@lg/thread:block":"lg:block",o&&x&&R?"":"h-[70px]"),children:q&&e.jsx(ur,{starterPrompts:Y,onSelectStarterPrompt:b,disabled:u,clientThreadId:t,onExpand:()=>j(!0)})}),o&&e.jsx("div",{className:P("w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",Ce?"@lg/thread:absolute @lg/thread:bottom-0 @lg/thread:left-0":"lg:absolute lg:bottom-0 lg:left-0"),children:e.jsx("div",{className:"min-h-4",children:o})})]})})})})})}function cr({headlineOption:t}){const a=xe().formatMessage(gh[t]||Vt.whatCanIHelpWith);return e.jsx("div",{className:"relative inline-flex justify-center text-center text-2xl font-semibold leading-9",children:e.jsx("h1",{children:a})})}function dr({label:t,onClick:s,disabled:a=!1,icon:n}){return e.jsxs("button",{className:"group relative flex h-[42px] items-center gap-1.5 rounded-full border border-token-border-light px-3 py-2 text-start text-[13px] shadow-xxs transition enabled:hover:bg-token-main-surface-secondary disabled:cursor-not-allowed xl:gap-2 xl:text-[14px]",disabled:a,onClick:s,children:[n,e.jsx("span",{className:"max-w-full select-none whitespace-nowrap text-gray-600 transition group-hover:text-token-text-primary dark:text-gray-500",children:t})]})}function ch({starterPrompt:t,starterPrompts:s,index:a,disabled:n,onSelectStarterPrompt:o}){const r=t.theme??t.title,c=Fs(),{mutate:l}=Uc(),u=t.category==="onboarding"?()=>{l({key:it.hasUsedConversationalOnboardingStarterPrompt}),c(t,s,a)}:()=>o(t,s,a);return e.jsx(dr,{disabled:n,onClick:u,icon:e.jsx(Oc,{starterPrompt:t,useV2Colors:!0}),label:r})}function Ia({clientThreadId:t,onClick:s}){i.useEffect(()=>{zc(t)},[t]);const a=xe();return e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(dr,{onClick:()=>{Gc(t),s()},label:a.formatMessage(Vt.moreStarterPrompts)})})}const dh=5,uh=3;function ur({starterPrompts:t,onSelectStarterPrompt:s,disabled:a,clientThreadId:n,onExpand:o,mobileLayout:r=!1}){const c=r?uh:dh,[l,u]=i.useState(c),[m,d]=i.useState(!1),h=i.useRef(null),g=t.length<=l;i.useEffect(()=>{Et(t.slice(0,c),n)},[n]),i.useEffect(()=>{if(!m&&!g&&h.current){const x=h.current,f=x.getBoundingClientRect(),R=f.width,j=Array.from(x.children);let M=0;for(let y=0;y<j.length&&j[y].getBoundingClientRect().right-f.left<=R;y++)M++;u(M),d(!0)}},[t,g,m]);const S=()=>{const x=t.slice(l,t.length).map(f=>({...f,isAdditional:!0}));x.length>0&&Et(x,n),u(t.length),o()};return e.jsxs("div",{className:P("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",m&&t.length>0?"opacity-100":"opacity-[0.01]",r?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:P("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",g||r?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:h,children:[t.slice(0,l).map((x,f)=>e.jsx(ne.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:e.jsx(ch,{starterPrompt:x,starterPrompts:t,index:f,disabled:a,onSelectStarterPrompt:s})},x.id??f)),r&&t.length>l&&e.jsx(Ia,{clientThreadId:n,onClick:S})]}),!r&&t.length>l&&e.jsx(Ia,{clientThreadId:n,onClick:S})]})}function mh({promptStarters:t,isSendBlocked:s,clientThreadId:a,isSquare:n,...o}){i.useEffect(()=>{Et(t,a)},[a]);const r=Fs(),c=qn();return e.jsx(e.Fragment,{children:n?e.jsx(ne.div,{...o,className:"mb-2 w-full flex-shrink overflow-y-hidden",children:e.jsx($t,{children:e.jsx(Xo,{starterPrompts:t,onSelectStarterPrompt:r,disabled:s})})}):e.jsx(ne.div,{...o,className:"flex-shrink overflow-y-hidden",children:e.jsx(Hu,{starterPrompts:t,onSelectStarterPrompt:r,disabled:s,cssMobileDisplayLimit:2,marginOverride:P("mt-6",c?"@lg/thread:mt-12":"lg:mt-12")})})})}const hh=t=>{const[s,a]=i.useState([]),n=i.useCallback(async()=>{const r=(await At.generateTrendingSuggestions(t)).suggestions.map((c,l)=>({type:Ns.Starter,title:Pa(c),body:"",icon:e.jsx(Bc,{}),prompt:Pa(c),id:`starter-${l}`,theme:pn.Search}));a(r)},[t]);return{trendingSuggestions:s,fetchTrendingSuggestions:n}};function Pa(t){return t.split(" ").map(Fc).join(" ")}const Vt=Pe({whatCanIHelpWith:{id:"SplashScreenV2.whatCanIHelpWith",defaultMessage:"What can I help with?"},whereShouldWeStart:{id:"SplashScreenV2.whereShouldWeStart",defaultMessage:"Where should we start?"},askChatgptAnything:{id:"SplashScreenV2.askChatgptAnything",defaultMessage:"Ask ChatGPT anything"},moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),gh={HELP_WITH:Vt.whatCanIHelpWith,WHERE_TO_START:Vt.whereShouldWeStart,ASK_CHATGPT:Vt.askChatgptAnything};function mr({clientThreadId:t,currentLeafId:s}){const{currentModelId:a}=Zo(),n=Fn(t),o=lo(t,s),r=Te(t),c=ct(),l=Hs(a),u=_t(t)&&!o&&(js(n)||n?.kind===Je.GizmoTest),m=es(r);return{showEmptyState:u,canUseNewHomepage:u&&m||u&&!r&&!l&&!c}}const Da=pe.button`max-w-28 xs:max-w-40 sm:max-w-60 md:max-w-none group flex cursor-pointer items-center gap-1 rounded-lg py-1.5 ${({$shimmer:t})=>t?"loading-shimmer":""} ${({$isScreenArch:t})=>t?"text-md px-2":"px-3 text-lg"} hover:bg-token-main-surface-secondary radix-state-open:bg-token-main-surface-secondary font-semibold text-token-text-secondary overflow-hidden whitespace-nowrap`;function ph({conversation:t,gizmoResource:s,elementRef:a}){const n=vi(t.id)??t.title;return e.jsx(Ts,{to:$c(t.id,s),children:e.jsx(re.Item,{icon:Yc,children:e.jsx("div",{ref:a,children:n})},t.id)})}function fh({gizmoId:t,clientThreadId:s,inMobileHeader:a}){const n=xe(),{data:o}=Pt(t),{items:r,hasNextPage:c,fetchNextPage:l,isLoading:u,isFetchingNextPage:m}=Wc(t),d=i.useRef(null),h=i.useCallback(E=>{u||E==null||(d.current?.disconnect(),d.current=new IntersectionObserver(A=>{A[0].isIntersecting&&c&&l()}),d.current.observe(E))},[u,c,l]);i.useEffect(()=>()=>{d.current?.disconnect()},[]);const{title:g,titleSource:S}=gi(s),x=De(),{conversationLeafId:f}=Zo(),{showEmptyState:R}=mr({clientThreadId:s,currentLeafId:f}),j=Zt(s),M=Vc(),y=n.formatMessage(mn.newChatTitle),{resolvedTitle:v,isTypingEffect:N}=qc(s,g??null,!0);if(!o||R)return null;const D=v==null&&(_t(s)||S===pi.NewChat),T=j?e.jsx(e.Fragment,{}):e.jsxs(Da,{$isScreenArch:x,$shimmer:D,children:[e.jsx("div",{className:"truncate",children:N?e.jsx(Kc,{text:v??""}):v??y}),e.jsx($n,{className:"icon-md text-token-text-tertiary"})]}),C=M&&o.gizmo.display.emoji?e.jsxs(e.Fragment,{children:[o.gizmo.display.emoji," ",o.gizmo.display.name]}):o.gizmo.display.name;return e.jsxs("div",{className:"flex items-center gap-1 overflow-hidden whitespace-nowrap px-2 py-1.5",children:[e.jsx(Da,{$isScreenArch:x,children:e.jsx(Ts,{className:"truncate",to:_a(o),children:C})}),e.jsxs(e.Fragment,{children:[e.jsx(fi,{className:"icon-md text-token-text-tertiary"}),e.jsxs(co,{contentAlign:a?"center":"start",size:"small",triggerButton:T,contentClassName:"max-h-[50dvh] overflow-y-scroll",children:[e.jsx(Ts,{to:_a(o),children:e.jsx(re.Item,{icon:Lo,children:e.jsx(U,{...mn.newChatProjectDropdownItem,values:{name:`"${o.gizmo.display.name}"`}})},"new-chat")}),r.filter(E=>E.id!==s).map((E,A)=>{const p=c&&A===r.length-4?h:void 0;return e.jsx(ph,{elementRef:p,conversation:E,gizmoResource:o},E.id)}),m&&e.jsx("div",{className:"m-4 mb-5 flex justify-center",children:e.jsx(xi,{})})]})]})]})}const xh=Oe(()=>ze(()=>import("./ii1en7yhpim8b8zk.js"),__vite__mapDeps([13,2,1,3,4,5,14])).then(t=>t.ThreadHeaderGizmoDropdown)),La=pe.button`group flex cursor-pointer items-center gap-1 rounded-lg py-1.5 ${({$isScreenArch:t})=>t?"h-[44px] @lg/screen-composer:pl-3 [line-height:26px] [font-size:17px] pl-1 pr-3":"px-3 text-lg"} hover:bg-token-main-surface-secondary radix-state-open:bg-token-main-surface-secondary font-semibold text-token-text-secondary overflow-hidden whitespace-nowrap`;function vh({clientThreadId:t}){const s=xe(),a=ct(),n=bi(t),o=En(),[,r]=go(),c=()=>{!n&&!a?o({pathname:"/",search:new URLSearchParams({[gs]:"true"}).toString()}):r(l=>(l.get(gs)==="true"?l.delete(gs):l.set(gs,"true"),l),{replace:n,state:ld()})};return e.jsx(re.Item,{size:"large",className:"!pr-3",onClick:c,icon:od,children:e.jsxs("div",{className:"flex grow items-center justify-between gap-2",children:[e.jsx("div",{className:"flex flex-1 items-center gap-3",children:e.jsx(U,{...fr.temporaryChat})}),e.jsx(rd,{enabled:a,label:s.formatMessage({defaultMessage:"Temporary",id:"temporaryChatToggleLabel"}),testId:"temporary-chat-toggle"})]})})}function hr(t,s,a){let n=t;if(t===ba.AUTO){const c=s.filter(({defaultModel:l})=>l!==ba.AUTO);c.length===1&&(n=c[0].defaultModel)}const o=s.find(({defaultModel:c})=>c===n);if(o){const{categoryId:c,shortLabel:l}=o;return{selectedCategory:c,modelLabel:l}}const r=a.find(({modelIds:c})=>c.includes(n));if(r){const{group:c,shortLabel:l}=r;return{selectedCategory:c,modelLabel:l}}return{selectedCategory:null,modelLabel:null}}function Sh({modelLabel:t}){return e.jsx("span",{className:"overflow-x-clip text-ellipsis text-token-text-secondary",children:t})}function bh({clientThreadId:t,inMobileHeader:s}){const{isLoading:a,categories:n,groups:o}=Yn(),r=Si(),l=Kn(t).id,u=Xc(),{modelLabel:m}=hr(l,n,o),d=wh(t,u),h=xe(),{isUnauthenticated:g}=Ie(),S=gr(),x=(!g||!S)&&!r;i.useEffect(()=>{a||Qc({namespace:Io.ChatPageLoad})?.logTiming("render_model_switcher")},[a]);const f=De(),R=e.jsxs("div",{className:P(f?"overflow-x-hidden text-ellipsis":"text-token-text-secondary"),children:[Zc," ",x?e.jsx("span",{className:"text-token-text-secondary",children:m}):g&&m?e.jsx(Sh,{modelLabel:m}):null]});return d.length?a?null:e.jsx(co,{sideOffset:8,size:"large",triggerButton:e.jsxs(La,{$isScreenArch:f,"aria-label":m?h.formatMessage({id:"JrtGPQ",defaultMessage:"Model selector, current model is {modelLabel}"},{modelLabel:m}):"",children:[R,f?e.jsx(Jc,{className:"icon-md text-token-text-tertiary"}):e.jsx($n,{className:"icon-md text-token-text-tertiary"})]}),onOpenChange:j=>{K.logEvent(X.toggleModelSwitcher,{isOpen:j}),de.logEvent("toggle_model_switcher",null,{isOpen:String(j)})},contentAlign:s?"center":"start",testId:"model-switcher-dropdown",children:e.jsx(Ch,{sections:d})}):e.jsx(La,{className:"cursor-default",children:R})}function gr(){return qe("462735957").value}function yh({category:t,modelSwitcherDenialsBySlug:s,currentGizmoId:a,currentModelId:n,omitIcon:o,testId:r}){const{defaultModel:c,label:l,categoryId:u,description:m,isBeta:d}=t;return e.jsx(fn,{value:c,currentModelId:n,modelSwitcherDenialsBySlug:s,renderName:h=>e.jsx(yn,{categoryId:u,name:l,description:m,isDisabled:h,omitIcon:o,isBeta:d}),isSelected:!a&&n===c,testId:r},c)}function wh(t,s){const a=Kn(t),n=a.id,o=Te(t),{categories:r,groups:c}=Yn(),{doesUserHaveAnyAccountsWithPlusFeatures:l}=kn(),u=Z.getServerThreadId(t),m=ed({clientThreadId:t}),d=xe(),h=!u,{isUnauthenticated:g}=Ie(),S=td(),{layer:x}=Ve("2723963139"),f=x.get("is_dynamic_model_enabled",!1),R=gr(),j=s.find(({categoryId:I})=>I===Ke.ALPHA),M=s.find(({categoryId:I})=>I===Ke.DATA_CAMPAIGNS),y=s.find(({categoryId:I})=>I===Ke.EXPERIMENTS),v=s.find(({categoryId:I})=>I===Ke.MAINLINE),N=!0,D=!!j?.options?.length,T=!!M?.options?.length,C=!!y?.options?.length,E=!!v?.options?.length,A=En(),p=i.useCallback(()=>{K.logEvent(X.openModalAccountPaymentfromModelPicker,{content:"gizmo-button"}),sd(A,"Thread header dropdown")},[A]),B=()=>{de.logEvent("chatgpt_model_switcher_plus_upgrade_button_clicked"),K.logEvent(X.modelSwitcherPlusUpgradeButtonClicked),g?S({shouldOpenPaymentModalOnAuth:!0,callback:I=>{K.logSignUpButtonClicked({location:"Model switcher GPT-4 upsell",provider:I})}}):p()},w=[],H=e.jsxs("div",{className:"mb-1 flex items-center justify-between px-5 pt-2",children:[e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(U,{id:"ilkdMh",defaultMessage:"Model"})}),e.jsx("a",{href:f?"https://help.openai.com/en/articles/9155758-what-is-the-chatgpt-plus-model-selector":"https://help.openai.com/en/articles/7102672-how-can-i-access-gpt-4",target:"_blank",rel:"noreferrer",children:e.jsx(cd,{className:"icon-md h-5 w-5 pl-0.5 text-token-text-tertiary"})})]},"header");if(R&&g){const I={id:"modelSection",content:[]};I.content.push(e.jsx(nd,{},"noAuthUpsell")),w.push(I)}else if(l){const I={id:"modelSection",content:[]};r.length&&I.content.push(H);const b=new Map;r.forEach(F=>{const Y=e.jsx(yh,{category:F,currentGizmoId:o,currentModelId:n,modelSwitcherDenialsBySlug:m,omitIcon:N,testId:`model-switcher-${F.defaultModel}`},F.categoryId);F.subcategory?(b.has(F.subcategory)||b.set(F.subcategory,[]),b.get(F.subcategory)?.push(Y)):I.content.push(Y)}),b.forEach((F,Y)=>{const te=r.find(q=>q.subcategory===Y&&q.defaultModel===a.id);I.content.push(e.jsxs(re.Sub,{children:[e.jsx(re.SubMenuTrigger,{"data-testid":Y==="More models"?"more-models-submenu":void 0,children:e.jsxs("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:[Y,!!te&&e.jsx("div",{className:"truncate text-token-text-tertiary",children:te.label})]})}),e.jsx(re.Portal,{children:e.jsx(re.SubContent,{className:"min-w-72",children:F})})]},Y))}),w.push(I)}else{const I={id:"modelSection",content:[]};I.content.push(e.jsx(fn,{value:"",currentModelId:n,onClick:B,modelSwitcherDenialsBySlug:m,isUpgradeUpsell:!0,renderName:b=>e.jsx(yn,{icon:id,isDisabled:b,name:d.formatMessage({id:"mzDzkX",defaultMessage:"ChatGPT Plus"}),description:d.formatMessage({id:"bqTHri",defaultMessage:"Our smartest model & more"}),omitIcon:!1}),isSelected:!1,showNewChatHint:!1},"plusUpgrade")),I.content.push(e.jsx(fn,{value:Js.AUTO,currentModelId:n,modelSwitcherDenialsBySlug:m,renderName:b=>e.jsx(yn,{icon:ad,name:d.formatMessage({id:"U9E7Rx",defaultMessage:"ChatGPT"}),description:d.formatMessage({id:"n96qML",defaultMessage:"Great for everyday tasks"}),isDisabled:b,omitIcon:!1}),isSelected:!o&&n===Js.AUTO,showNewChatHint:!0},Js.AUTO)),w.push(I)}const G={id:"otherOptionsSection",content:[]},{selectedCategory:_}=hr(n,r,c);return h&&(D&&G.content.push(e.jsx(hs,{isSelected:_===Ke.ALPHA,currentModel:a,option:j,modelSwitcherDenialsBySlug:m,displayInFull_INTERNAL_USE_ONLY:!0},j.value)),T&&G.content.push(e.jsx(hs,{isSelected:_===Ke.DATA_CAMPAIGNS,currentModel:a,option:M,modelSwitcherDenialsBySlug:m,displayInFull_INTERNAL_USE_ONLY:!0},M.value)),C&&G.content.push(e.jsx(hs,{currentModel:a,isSelected:_===Ke.EXPERIMENTS,option:y,modelSwitcherDenialsBySlug:m,displayInFull_INTERNAL_USE_ONLY:!0},y.value)),E&&G.content.push(e.jsx(hs,{isSelected:_===Ke.MAINLINE,currentModel:a,option:v,modelSwitcherDenialsBySlug:m,displayInFull_INTERNAL_USE_ONLY:!0},v.value))),G.content.length&&w.push(G),g||w.push({id:"temporaryChatSection",content:[e.jsx(vh,{clientThreadId:t},"tempChat")]}),w}function jh(){const t=xe();return e.jsx("div",{className:"border-token-text-quartenary items-center rounded-full border px-1 py-0.5 text-[8px] font-semibold uppercase leading-3 text-token-text-secondary dark:border-token-border-heavy dark:text-token-text-tertiary",children:t.formatMessage(fr.beta)})}function yn({isDisabled:t,name:s,icon:a,categoryId:n,description:o,extra:r,omitIcon:c,isBeta:l=!1}){let u=s;return l&&(u=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),e.jsx(jh,{})]})),e.jsxs("div",{className:"flex items-center gap-3",children:[!c&&e.jsx("span",{className:"flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-full bg-token-main-surface-secondary",children:a?e.jsx(a,{className:"h-4 w-4 text-token-text-primary"}):n&&e.jsx(Bo,{type:"filled",className:P("h-4 w-4",t&&"text-gray-300",!t&&"text-token-text-primary"),categoryId:n})}),e.jsxs("div",{children:[u,e.jsxs("div",{className:P(!t&&"text-token-text-secondary","text-xs"),children:[o,r]})]})]})}function Ch({sections:t}){return e.jsx(e.Fragment,{children:t.map((s,a)=>e.jsxs(fo.Fragment,{children:[a!==0?e.jsx(re.Separator,{}):null,s.content]},s.id))})}function pr({clientThreadId:t,inMobileHeader:s=!1}){const a=Te(t),n=es(a);return a==null?e.jsx(bh,{clientThreadId:t,inMobileHeader:s}):n?e.jsx(fh,{gizmoId:a,clientThreadId:t,inMobileHeader:s}):e.jsx(xh,{clientThreadId:t,gizmoId:a,inMobileHeader:s})}const fr=Pe({beta:{id:"XZwFET",defaultMessage:"Beta"},gpt35ShortExplainer:{defaultMessage:"Great for everyday tasks",id:"ModelSwitcher.gpt35ShortExplainer"},modelTunerSmartSelectionTitle:{id:"czjW8I",defaultMessage:"Dynamic"},modelTunerSmartSelectionExplainer:{id:"gp/YH1",defaultMessage:"Optimized for speed and intelligence"},gpt4ShortExplainer:{defaultMessage:"With DALL·E, browsing and analysis",id:"ModelSwitcher.gpt4ShortExplainer"},gpt4ShortExplainerWithoutBrowse:{defaultMessage:"With DALL·E and analysis",id:"ModelSwitcher.gpt4ShortExplainerWithoutBrowse"},gpt4UpsellExplainer:{id:"ModelSwitcher.gpt4Upsell",defaultMessage:"Our smartest and most capable model. Includes DALL·E, browsing and more."},userUpgrade:{id:"ModelSwithcer.upgradeButton",defaultMessage:"Upgrade to Plus"},userUpgradeSignup:{id:"ModelSwitcher.signupUpgradeButton",defaultMessage:"Sign up for ChatGPT Plus"},temporaryChat:{id:"ModelSwitcher.temporaryChat",defaultMessage:"Temporary chat"},shareChat:{id:"ModelSwitcher.shareChat",defaultMessage:"Share chat"}}),Mh=Oe(()=>ze(()=>import("./mmw9wxod0h4xgm2y.js"),__vite__mapDeps([15,1,2,3,16,17,4,5,18,19,20,21,22,23,24,12,25,26,27,28,11,14,29,30,31,32])).then(t=>t.GizmoUsingAsOwnerNotice)),xr=({clientThreadId:t})=>{const s=zn(m=>m.activeStageSidebar),a=Z.getServerThreadId(t),n=dd(ws.WorkspaceShareLinks),{isUnauthenticated:o}=Ie(),r=ct(),c=n&&a&&!o&&!r,l=De(),u=!s&&!(l&&!o);return e.jsx("div",{className:P(!l&&"gap-2",l&&"@lg/screen-composer:gap-2","flex items-center pr-1 leading-[0]"),children:e.jsx(Ku,{showShareButton:c,showProfileDropdown:u,clientThreadId:t})})};function Th({clientThreadId:t,gizmoId:s}){const a=ud(),{data:n}=Pt(s),o=Ds();return e.jsxs(e.Fragment,{children:[e.jsxs(md,{className:"max-md:hidden",children:[e.jsxs("div",{className:"absolute start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2",children:[n!=null&&o?.isWorkspaceAccount()&&n.gizmo.tags?.includes(Gn.WorkspaceDisabled)&&e.jsx(Mh,{gizmo:n}),e.jsx(hd,{gizmoId:s,clientThreadId:t})]}),e.jsx(gd,{children:e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden",children:[e.jsx(Jo,{clientThreadId:t}),e.jsx(pr,{clientThreadId:t})]})}),e.jsx(xr,{clientThreadId:t})]}),a&&e.jsx(pd,{})]})}function vr({clientThreadId:t}){const s=Te(t),a=Mn(),n=De();return a||n?null:e.jsx(Th,{gizmoId:s,clientThreadId:t})}function _h({clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:n,enableV2Homepage:o,v2HomepageDisclaimer:r}){const c=ct();let l=e.jsx(Ou,{}),u;return c?(u=e.jsx(kh,{}),l=e.jsx(Kt,{className:"mb-6 h-12 w-12"})):t!=null?(u=o?e.jsx(lr,{clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:n,v2HomepageDisclaimer:r}):e.jsx(zu,{clientThreadId:t}),l=null):u=e.jsx(Nh,{}),e.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-token-text-primary",children:[l,u]})}function kh({gizmo:t}){const s=xd(),a=t?vd(t.tools):!1,n=Ds();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-5 text-2xl font-semibold","data-testid":"temporary-chat-label",children:[e.jsx(Sd,{id:"temporary-chat-checkbox",name:"temporary-chat-checkbox",checked:!0}),e.jsx(U,{...ot.temporaryChat})]}),e.jsxs("div",{className:"max-w-sm text-center text-sm font-normal text-token-text-tertiary",children:[e.jsx(U,{...n?.isWorkspaceAccount()?s?ot.temporaryChatBizMemoryAvailable:ot.temporaryChatBizMemoryUnavailable:s?ot.temporaryChatDescriptionMemoryAvailable:ot.temporaryChatDescriptionMemoryUnavailable}),a&&e.jsx("div",{className:"mt-3",children:e.jsx(U,{...ot.temporaryChatDescriptionGptActions,values:{link:o=>e.jsx("a",{href:"https://help.openai.com/en/articles/8914046-temporary-chat-faq",target:"_blank",className:"underline",rel:"noreferrer",children:o})}})})]})]})}function Nh(){return e.jsx("div",{className:"mb-5 text-2xl font-semibold",children:e.jsx(U,{...ot.howCanIHelpYouToday})})}function Sr({clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:n,enableV2Homepage:o,v2HomepageDisclaimer:r}){const c=Te(t),l=yi(),u=Cn(),{data:m}=Pt(c),d=fd(),h=wi(()=>navigator.windowControlsOverlay);return(l!=null||c!=null)&&m==null?null:e.jsxs("div",{className:"relative h-full",children:[e.jsx("div",{className:h?.visible?P("absolute right-[calc(100dvw-env(titlebar-area-width,100dvw)-env(titlebar-area-x,0))]",d?"left-[env(titlebar-area-x,0)]":"left-0"):"absolute left-0 right-0",children:e.jsx(vr,{clientThreadId:t})}),m!=null?e.jsx(Uu,{gizmo:m,showStarterPrompts:!0,disableStarterPrompts:u}):e.jsx(_h,{clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:n,enableV2Homepage:o,v2HomepageDisclaimer:r})]})}const ot=Pe({temporaryChat:{id:"GizmoLanding.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatBizMemoryAvailable:{id:"g1opBW",defaultMessage:"This chat won't appear in your history and won't use or create memories."},temporaryChatBizMemoryUnavailable:{id:"fQmbtG",defaultMessage:"This chat won't appear your conversation history."},temporaryChatDescriptionMemoryAvailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryAvailable",defaultMessage:"This chat won't appear in history, use or create memories, or be used to train our models. For safety purposes, we may keep a copy for up to 30 days."},temporaryChatDescriptionMemoryUnavailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryUnavailable",defaultMessage:"This chat won't appear in history or be used to train our models. For safety purposes, we may keep a copy of this chat for up to 30 days."},temporaryChatDescriptionGptActions:{id:"GizmoLanding.temporaryChatDescriptionGptActions",defaultMessage:"Any data shared with a third party through GPT actions are subject to the third party's privacy policy. <link>Learn more</link>"},howCanIHelpYouToday:{id:"GizmoLanding.howCanIHelpYouToday",defaultMessage:"How can I help you today?"}});function Ah({className:t,clientThreadId:s,message:a,onModelSelect:n,onDropdownChange:o}){const r=xe(),[c,l]=i.useState(null),[u,m]=i.useState(!1),[d,h]=i.useState(!1),g=bd(),S=Fo(s),x=Te(s),f=Ho({clientThreadId:s,message:a}),R=a.message.metadata?.model_slug,{modelOptions:j,modelSlug:M,animateModelLabelOnRender:y,nuxProps:v,messageModelEnabledTools:N}=f,D=Uo(a.message),T=N.includes(Wn.Search),C=i.useMemo(()=>j.find(_=>_.value==R),[j,R]),{doesUserHaveAnyAccountsWithPlusFeatures:E}=kn(),A=i.useRef(null),p=_=>{_||setTimeout(()=>{A.current&&A.current.blur()},10)};if(i.useEffect(()=>{p(u)},[u]),!g||x)return null;const B=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:r.formatMessage(Ba.search),icon:e.jsx(Pn,{className:"icon-sm"}),condition:T&&!D,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:r.formatMessage(Ba.nosearch),icon:e.jsx(Oo,{className:"icon-sm"}),condition:T&&D,eventName:"chatgpt_regenerate_without_search_button_clicked"}];let w,H;v.shouldRenderNux?(w=Rh,H={title:e.jsx(U,{id:"g/+2Hh",defaultMessage:"Optimized your response"}),description:e.jsx(U,{id:"H0Flqm",defaultMessage:"Used {usedModelName} for a faster response that saves your limited {largestModelName} messages",values:{usedModelName:v.usedModelName,largestModelName:v.largestModelName}}),markAsViewed:v.announcement.markAsViewed}):(w=Eh,H={label:S?e.jsx(U,{id:"LBYK9a",defaultMessage:"Change model"}):e.jsx(U,{id:"nygjPN",defaultMessage:"Used {modelName}",values:{modelName:v.usedModelName}})});const G=S&&j.some(_=>Yt(_,E));return e.jsxs(re.Root,{onOpenChange:_=>{S&&(m(_),o(_),p(_)),_&&K.logEvent(X.conversationOpenMessageModelSelector,{has_get_plus_button:G})},children:[e.jsx(w,{...H,children:e.jsx(uo,{ref:A,className:P("cursor-pointer",t),onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),children:e.jsx(br,{modelSlug:M,animateModelLabelOnRender:y,isDropdownOpen:u,isRegenerateEnabled:S,isHovered:d})})}),S&&e.jsxs(re.Content,{className:"z-30 origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[j.map(_=>{const I=Yt(_,E),{value:b,...F}=_;return e.jsx(Tt,{value:b,onSelect:()=>{de.logEvent("chatgpt_regenerate_switch_model_button_clicked",b,{requestedModelId:b,...Qe({clientThreadId:s})}),n({requestedModelId:b})},onMouseEnter:()=>l(b),onMouseLeave:()=>l(null),isHovered:c===b,messageModelSlug:a.message.metadata?.model_slug,shouldShowUpsell:I,...F},b)}),!!C&&e.jsxs(e.Fragment,{children:[e.jsx(re.Separator,{}),B.filter(_=>_.condition).map(_=>e.jsx(Tt,{onSelect:()=>{de.logEvent(_.eventName,C.value,{requestedModelId:C.value,...Qe({clientThreadId:s})}),n({requestedModelId:C.value,extraStreamParams:_.extraStreamParams})},includeRegenerate:!0,onMouseEnter:()=>l(_.key),onMouseLeave:()=>l(null),isHovered:c===_.key,messageModelSlug:R,includeCheck:!1,...C,label:_.label,subtitle:"",icon:_.icon},_.key))]})]})]})}function br({modelSlug:t,animateModelLabelOnRender:s,isDropdownOpen:a,isRegenerateEnabled:n,isHovered:o,isRegenLabel:r=!1,animateShortLabel:c,omitIcon:l}){const[u,m]=i.useState("initial"),{categories:d}=Yn({isRegen:!!r});i.useEffect(()=>{if(s){const j=setTimeout(()=>m("show"),500),M=setTimeout(()=>m("initial"),2e3);return()=>{clearTimeout(j),clearTimeout(M)}}m("initial")},[s]);const h=d.find(({defaultModel:j})=>j===t),g=t===yd?{categoryId:"gpt_3.5",shorterLabel:"3.5"}:{},{categoryId:S,shorterLabel:x}=h??g,f={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},R=a?"visible":o?"show":u;return e.jsxs(ne.div,{initial:"initial",animate:R,className:"flex items-center pb-0",children:[!l&&(r?e.jsx(Xn,{className:"icon-md"}):S&&e.jsx(Bo,{type:"outline",categoryId:S,className:"icon-md h-4 w-4"})),(n||c)&&e.jsx(ne.span,{className:"overflow-hidden text-clip whitespace-nowrap text-sm",variants:f,transition:{type:"tween",duration:.18},children:x}),n&&e.jsx($n,{className:P("icon-sm",{"text-token-text-quaternary":!o&&!r},{"text-token-text-secondary":o&&!r})})]})}function Eh({children:t,label:s}){return e.jsx(Xt,{label:s,sideOffset:0,children:t})}function Rh({children:t,title:s,description:a,markAsViewed:n}){return e.jsx(Ln,{announcementKey:it.ModelSwitcherAutoDowngrade,show:!0,side:"bottom",sideOffset:-4,title:s,description:a,badge:"beta",onDismiss:n,dismissOnOutsideClick:!0,children:t})}function Yt(t,s){const{modelSwitcherDeny:a,subscriptionLevel:n}=t;return!!a&&a.reason===ji.RATE_LIMIT&&n===Ci.PLUS&&!s}const Ba=Pe({search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Ih=i.memo(Ah),bs="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function Ph({className:t,clientThreadId:s,message:a,onModelSelect:n,onDropdownChange:o,canRegenerateResponse:r}){const[l,u]=i.useState(null),[m,d]=i.useState(!1),[h,g]=i.useState(!1),S=Te(s),x=Ho({clientThreadId:s,message:a}),f=a.message.metadata?.model_slug,R=a.message.id,{modelOptions:j,modelSlug:M,animateModelLabelOnRender:y,messageModelEnabledTools:v}=x,N=Uo(a.message),D=v.includes(Wn.Search),T=i.useMemo(()=>j.find(w=>w.value===f),[j,f]),C=i.useRef(null),{doesUserHaveAnyAccountsWithPlusFeatures:E}=kn(),A=w=>{w||setTimeout(()=>{C.current&&C.current.blur()},10)};if(i.useEffect(()=>{A(m)},[m]),Mi(s))return null;const B=r&&j.some(w=>Yt(w,E));return S?null:e.jsxs(re.Root,{onOpenChange:w=>{r&&(d(w),o(w),A(w)),w&&K.logEvent(X.conversationOpenMessageModelSelector,{has_get_plus_button:B,is_new_regen_dropdown:!0})},children:[r?e.jsx(Lh,{label:e.jsx(U,{id:"wDs5sz",defaultMessage:"Switch model"}),children:e.jsx(uo,{ref:C,className:P("cursor-pointer",t),onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:e.jsx(br,{modelSlug:M,animateModelLabelOnRender:y,isDropdownOpen:m,isRegenerateEnabled:r,isHovered:h,isRegenLabel:!0,omitIcon:!1})})}):null,r&&e.jsx(re.Portal,{children:e.jsxs(re.Content,{className:"z-30 min-w-fit origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[e.jsx(re.Item,{disabled:!0,className:"pb-0 pt-2",children:e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(U,{id:"bFLh5u",defaultMessage:"Switch model"})})}),e.jsx(Dh,{clientThreadId:s,messageId:R,onModelSelect:n,messageModelSlug:f,omitModelIcons:!0,modelOptions:j,setHoveredOption:u,hoveredOption:l,retryOption:T,lastResponseUsedSearch:N,modelSupportsSearch:D,doesUserHaveAnyAccountsWithPlusFeatures:E})]})})]})}function Dh({clientThreadId:t,messageId:s,modelOptions:a,messageModelSlug:n,onModelSelect:o,omitModelIcons:r,setHoveredOption:c,hoveredOption:l,retryOption:u,lastResponseUsedSearch:m,modelSupportsSearch:d,doesUserHaveAnyAccountsWithPlusFeatures:h}){const g=xe(),[S,x]=i.useMemo(()=>wd(a,y=>y.subcategory),[a]),f=i.useMemo(()=>{const y=new Map;return S.forEach(v=>{const N=v.subcategory;N&&(y.has(N)||y.set(N,[]),y.get(N)?.push(v))}),y},[S]),R=P("icon-sm",r&&"order-10 ml-auto text-token-text-tertiary icon-md"),j=r?"right":"left",M=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:g.formatMessage(sn.search),icon:e.jsx(Pn,{className:R}),condition:d&&!m,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:g.formatMessage(sn.nosearch),icon:e.jsx(Oo,{className:R}),condition:d&&m,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return e.jsxs(e.Fragment,{children:[x.map(y=>{const{value:v,...N}=y;return e.jsx(Tt,{value:v,onSelect:()=>{de.logEvent("chatgpt_regenerate_switch_model_button_clicked",v,{requestedModelId:v,...Qe({clientThreadId:t,messageId:s})}),o({requestedModelId:v})},includeRegenerate:!1,onMouseEnter:()=>c(v),onMouseLeave:()=>c(null),isHovered:l===v,messageModelSlug:n,includeCheck:!1,shouldShowUpsell:Yt(y,h),className:bs,...N,icon:r?e.jsx("span",{className:R}):N.icon,justifyIcon:j,wrapIcon:!r},v)}),[...f.entries()].map(([y,v])=>e.jsxs(re.Sub,{children:[e.jsx(re.SubMenuTrigger,{children:e.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:y})}),e.jsx(re.Portal,{children:e.jsx(re.SubContent,{className:"min-w-fit",children:v.map(N=>{const{value:D,...T}=N;return e.jsx(Tt,{value:D,onSelect:()=>{de.logEvent("chatgpt_regenerate_switch_model_button_clicked",D,{requestedModelId:D,...Qe({clientThreadId:t,messageId:s})}),o({requestedModelId:D})},includeRegenerate:!1,onMouseEnter:()=>c(D),onMouseLeave:()=>c(null),isHovered:l===D,messageModelSlug:n,includeCheck:!1,className:bs,...T,icon:null,justifyIcon:j,wrapIcon:!r,shouldShowUpsell:Yt(N,h)},y+"-"+D)})})})]},y)),!!u&&e.jsxs(e.Fragment,{children:[e.jsx(re.Separator,{}),e.jsx(Tt,{onSelect:()=>{de.logEvent("chatgpt_regenerate_try_again_button_clicked",u.value,{requestedModelId:u.value,...Qe({clientThreadId:t,messageId:s})}),o({requestedModelId:u.value})},includeRegenerate:!0,onMouseEnter:()=>c(u.value),onMouseLeave:()=>c(null),messageModelSlug:n,includeCheck:!1,className:bs,...u,label:g.formatMessage(sn.tryAgain),subtitle:u.label,icon:e.jsx(Xn,{className:R}),justifyIcon:j,wrapIcon:!r},u.value),M.filter(y=>y.condition).map(y=>e.jsx(Tt,{onSelect:()=>{de.logEvent(y.eventName,u.value,{requestedModelId:u.value,...Qe({clientThreadId:t,messageId:s})}),o({requestedModelId:u.value,extraStreamParams:y.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>c(y.key),onMouseLeave:()=>c(null),isHovered:l===y.key,messageModelSlug:n,includeCheck:!1,className:bs,...u,label:y.label,subtitle:"",icon:y.icon,justifyIcon:j,wrapIcon:!r},y.key))]})]})}function Lh({children:t,label:s}){return e.jsx(Xt,{label:s,sideOffset:0,children:t})}const sn=Pe({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Bh=i.memo(Ph),Fa=Oe(()=>ze(()=>import("./ob2kjer3jenmmp3x.js").then(t=>t.qa),__vite__mapDeps([4,2,1,3,5])).then(t=>t.MemoryActionResult));function Ha(t,s,a){Z.updateTree(t,n=>{n.updateNodeMetadata(s,{inlineComparisonRating:a})})}function Ua(t){return{is_dark_mode:t,time_since_loaded:Math.floor(performance.now()/1e3),page_height:window?.innerHeight,page_width:window?.innerWidth,pixel_ratio:window?.devicePixelRatio,screen_height:window?.screen?.height,screen_width:window?.screen?.width}}const Oa=({messages:t})=>{for(const{message:{metadata:s}}of t){const{augmented_paragen_prompt_label:a}=s??{};if(a)return a}};function Fh(t){const s=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),a=i.useRef({left:null,right:null});return t.stubSideBySideFeedback?e.jsx(yr,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:s,firstVisibleTokenTimestampsRef:a,...t}):e.jsx(Hh,{...t,visibilityStateRef:s,firstVisibleTokenTimestampsRef:a})}function Hh(t){const{clientThreadId:s,variantIds:a,variantsInStreamInfo:n,turnIndex:o,firstVisibleTokenTimestampsRef:r}=t;if(a.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const c=sa(),l=Oh(),u=Tn(),m=Ti(),[d,h]=i.useMemo(()=>zo(a.join(""))()<.5?[0,1]:[1,0],[a[0],a[1]]),g=d<h?"left":"right",S=g==="left"?"right":"left",x=a[d],f=a[h],R=Mt(Ze(s,A=>A?.tree.getLeafFromNode(x))).id,j=Mt(Ze(s,A=>A?.tree.getLeafFromNode(f))).id,M=Mt(cn(s,o,R)),y=Mt(cn(s,o,j)),v=g==="left"?M:y,N=g==="left"?y:M,D=n.display_treatment==="unskippable",T=c?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";i.useEffect(()=>(hn.setState({displayingSideBySideFeedback:!0,unskippable:D}),()=>{hn.setState({displayingSideBySideFeedback:!1,unskippable:!1})}),[D]),jd();const C=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});i.useEffect(()=>_i(ki,{requestCompletion:()=>{const A=Xe(v.messages)?.completionSampleFinishTime,p=Xe(N.messages)?.completionSampleFinishTime,B=Z.getServerThreadId(s);if(l){const H=Z.getTree(s).getParentPromptNode(R),G=[M,y].map((b,F)=>({messageId:b.messages[b.messages.length-1].message.id,loadFirstTokenTime:F===0?r.current.left:r.current.right,loadEndTime:Xe(b.messages)?.completionSampleFinishTime})),_={},I=H.metadata?.variantsInStreamInfo==null&&H.message.metadata?.paragen_variants_info!=null;for(const b of G)_[b.messageId]=I?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:b.loadFirstTokenTime,load_end_time:b.loadEndTime};ys({shouldUseNewParagenEndpoint:l,params:{conversation_id:B,displayed_message_ids:G.map(b=>b.messageId),message_metadatas:_,rating:"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:c?2:1,user_prompt_message_id:H.message.id}})}else ys({shouldUseNewParagenEndpoint:l,params:{feedback_version:T,original_message_id:v.messages[v.messages.length-1]?.message.id,new_message_id:N.messages[N.messages.length-1]?.message.id,conversation_id:B,completion_comparison_rating:"skip",new_completion_placement:S,feedback_start_time:t.conversationTurnMountTime,compare_step_start_time:t.conversationTurnMountTime,original_completion_load_start_time:t.conversationTurnMountTime,original_completion_load_end_time:A??0,new_completion_load_start_time:t.conversationTurnMountTime,new_completion_load_end_time:p??0,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:Ua(m),...C.current}})}}),[M,y,R,s,t.conversationTurnMountTime,T,S,v?.messages,N?.messages,m,l,c,r]);const E=A=>{const B=Z.getTree(s).getLeafFromNode(A);Z.setThreadCurrentLeafId(s,B.id);const w=A===x,H=w===(g==="left"),G=Xe(v.messages)?.completionSampleFinishTime,_=Xe(N.messages)?.completionSampleFinishTime;v.messages.length>0&&Ha(s,v.messages[v.messages.length-1].nodeId,H?"original":"new"),N.messages.length>0&&Ha(s,N.messages[N.messages.length-1].nodeId,H?"original":"new");let I;G==null||_==null?I=H?"partial_load_comparison_original":"partial_load_comparison_new":I=H?"original":"new";const b=Z.getServerThreadId(s);if(l){const F=[M,y].map((J,he)=>({messageId:J.messages[J.messages.length-1].message.id,loadFirstTokenTime:he===0?r.current.left:r.current.right,loadEndTime:Xe(J.messages)?.completionSampleFinishTime})),Y=w?F[0].messageId:F[1].messageId,q=Z.getTree(s).getParentPromptNode(R),ie={},le=q.metadata?.variantsInStreamInfo==null&&q.message.metadata?.paragen_variants_info!=null;for(const J of F)ie[J.messageId]=le?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:J.loadFirstTokenTime,load_end_time:J.loadEndTime};ys({shouldUseNewParagenEndpoint:l,params:{conversation_id:b,displayed_message_ids:F.map(J=>J.messageId),message_metadatas:ie,rating:"selected",selected_message_id:Y,source_timestamp:Date.now(),ui_variant:c?2:1,user_prompt_message_id:q.message.id}})}else ys({shouldUseNewParagenEndpoint:l,params:{feedback_version:T,original_message_id:v.messages[v.messages.length-1]?.message.id,new_message_id:N.messages[N.messages.length-1]?.message.id,conversation_id:b,completion_comparison_rating:I,new_completion_placement:S,feedback_start_time:t.conversationTurnMountTime,compare_step_start_time:t.conversationTurnMountTime,original_completion_load_start_time:t.conversationTurnMountTime,original_completion_load_end_time:G??null,new_completion_load_start_time:t.conversationTurnMountTime,new_completion_load_end_time:_??null,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:Ua(m),...C.current}})};return e.jsx(yr,{...t,setPreferredFeedback:E,leftVariantId:x,rightVariantId:f,leftTurn:M,rightTurn:y,hasActiveRequest:u,originalTurn:v,visibilityStateRef:C})}function Uh(t){if(!t.length)return!1;const s=t.filter(a=>a.type===ka.Text||a.type===ka.MultiText).filter(a=>a.message.message.status!=="finished_successfully"&&a.message.message.metadata?.snorkle_status!==void 0);return s.length>0&&s.every(a=>{const n=a.message.message.content;return n?.content_type===mo.Text&&n.parts.join("")===""})}function yr({setPreferredFeedback:t,leftVariantId:s,rightVariantId:a,leftTurn:n,rightTurn:o,hasActiveRequest:r,originalTurn:c,visibilityStateRef:l,...u}){const{defaultParagenLabel:m,shouldShowParagenLabels:d=!1}=wo(),h=n&&Oa(n)||m,g=o&&Oa(o)||m,S=i.useMemo(()=>n?.messages??[],[n?.messages]),x=i.useMemo(()=>o?.messages??[],[o?.messages]),{avatarClassName:f,firstVisibleTokenTimestampsRef:R}=u,j=i.useMemo(()=>Rs(S),[S]),M=i.useMemo(()=>Rs(x),[x]),y=bo(),[v,N]=i.useMemo(()=>[j,M].map(F=>Uh(F)),[j,M]),D=rt(n?Ms.getRequestIdFromConversationTurn(n):"")||v,T=rt(o?Ms.getRequestIdFromConversationTurn(o):"")||N,C=n?.role===Ue.User,E=o?.role===Ue.User,A=i.useRef(null),p=i.useRef(null),B=i.useRef(null),w=u.stubSideBySideFeedback||v,H=u.stubSideBySideFeedback||N;!w&&R.current.left==null&&(R.current.left=Date.now()),!H&&R.current.right==null&&(R.current.right=Date.now()),i.useEffect(()=>{if(A.current&&p.current&&B.current){const F=Array(11).fill(0).map((te,q)=>q/10),Y=new IntersectionObserver(te=>te.forEach(q=>{q.target===p.current?(l.current.left_visibility_initial==null&&(l.current.left_visibility_initial=q.intersectionRatio),l.current.left_visibility_max=Math.max(l.current.left_visibility_max??0,q.intersectionRatio)):q.target===B.current&&(l.current.right_visibility_initial==null&&(l.current.right_visibility_initial=q.intersectionRatio),l.current.right_visibility_max=Math.max(l.current.right_visibility_max??0,q.intersectionRatio))}),{root:A.current,threshold:F});return Y.observe(p.current),Y.observe(B.current),()=>Y.disconnect()}},[l]);const{data:G}=yo(void 0,!1,y),_=sa(),I=e.jsx("div",{className:"text-pretty px-6 pb-5 pt-1 text-center text-sm text-token-text-secondary",children:e.jsx(U,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),b=De();return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:P("sticky z-[1] text-pretty bg-token-main-surface-primary px-6 text-center text-lg",b&&"top-[var(--thread-leading-height)] pt-3",!b&&"top-[-1px]",_&&!b?"md:top-header-height":b?"":"md:static"),"data-testid":"paragen-feedback-title",children:[e.jsx(U,{id:"JgCHDY",defaultMessage:"You’re giving feedback on a new version of ChatGPT."}),_?I:null]}),_?null:I,e.jsx("div",{className:"relative -mb-2 snap-x snap-mandatory overflow-x-auto px-3 pb-4 md:px-5 lg:px-10",ref:A,children:e.jsx("div",{className:P(!b&&"min-w-fit"),children:e.jsxs("div",{className:P("mx-auto flex max-w-6xl items-start",_&&!b&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",!_&&!b&&"gap-4 sm:gap-6",_&&b&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",b&&!_&&"gap-4 sm:gap-6"),children:[e.jsxs(za,{horizontalScrollContainerRef:A,rootElementRef:p,onClick:()=>{t(s)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:w,children:[e.jsxs(Va,{children:[e.jsx(xn,{messages:S,isUserTurn:C,avatarClassName:f}),e.jsx(Wa,{children:d?e.jsx("span",{className:"font-bold text-token-text-primary",children:h}):e.jsx(U,{...$a.responseNumber,values:{responseIndex:1}})})]}),_&&w?e.jsx(Ga,{}):e.jsxs(e.Fragment,{children:[G!=null&&!C&&e.jsx(Fa,{clientThreadId:u.clientThreadId,messages:S,isParagen:!0}),e.jsx(vn,{...u,groupedMessagesToRender:j,allGroupedMessages:j,isEditing:!1,isUserTurn:C,isCompletionRequestInProgress:D,hasActiveRequest:r,handleEnterEdit:ms,handleExitEdit:ms,shouldGrowContainer:!1}),e.jsx(qa,{clientThreadId:u.clientThreadId,conversationTurnMountTime:u.conversationTurnMountTime,turn:n,originalTurn:c})]})]}),e.jsxs(za,{horizontalScrollContainerRef:A,rootElementRef:B,onClick:()=>{t(a)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:H,children:[e.jsxs(Va,{children:[e.jsx(xn,{messages:x,isUserTurn:E,avatarClassName:f}),e.jsx(Wa,{children:d?e.jsx("span",{className:"font-bold text-token-text-primary",children:g}):e.jsx(U,{...$a.responseNumber,values:{responseIndex:2}})})]}),_&&H?e.jsx(Ga,{}):e.jsxs(e.Fragment,{children:[G!=null&&!E&&e.jsx(Fa,{clientThreadId:u.clientThreadId,messages:x,isParagen:!0}),e.jsx(vn,{...u,groupedMessagesToRender:M,allGroupedMessages:M,isEditing:!1,isUserTurn:E,isCompletionRequestInProgress:T,hasActiveRequest:r,handleEnterEdit:ms,handleExitEdit:ms,shouldGrowContainer:!1}),e.jsx(qa,{clientThreadId:u.clientThreadId,conversationTurnMountTime:u.conversationTurnMountTime,turn:o,originalTurn:c})]})]})]})})})]})}function za({horizontalScrollContainerRef:t,rootElementRef:s,onClick:a,children:n,hasActiveRequest:o,isWaitingOnFirstUserVisibleToken:r}){const c=sa(),l=De(),{scrollX:u}=Vi({layoutEffect:!1,container:t,target:s}),m=Cd(),d=Md(),h=i.useRef(null),g=i.useRef(null),S=i.useRef(null),[x,f]=i.useState(!1),[R,j]=i.useState(!1),[M,y]=i.useState(!1),[v,N]=i.useState(0);i.useEffect(()=>{if(!c)return;const B=new IntersectionObserver(w=>{for(const H of w)H.target===h.current?f(H.isIntersecting):H.target===S.current?y(H.isIntersecting):H.target===g.current&&j(H.isIntersecting)},{root:m?.current,rootMargin:l?`0px 0px -${v}px 0px`:void 0});return h.current&&g.current&&S.current&&(B.observe(h.current),B.observe(g.current),B.observe(S.current)),()=>{B.disconnect()}},[v,c,l,m]);const D=!M&&(R||x),T=qi(u,B=>D?-1*B:0),C=ya(0);i.useEffect(()=>{if(!c)return;const B=new ResizeObserver(w=>{ps(w.length===1,"entryList.length === 1");const H=w[0];ps(H.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),C.set(H.contentBoxSize[0].inlineSize)});return s.current&&B.observe(s.current),()=>{B.disconnect()}},[c,C,s]);const E=ya(0);i.useEffect(()=>{if(!c)return;const B=new ResizeObserver(w=>{ps(w.length===1,"entryList.length === 1");const H=w[0];ps(H.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),E.set(H.contentBoxSize[0].blockSize+16),N(H.contentBoxSize[0].blockSize)});return d.current&&B.observe(d.current),()=>{B.disconnect()}},[c,E,d]);const A=e.jsx(It,{className:c?"px-5":"mt-4 self-start",onClick:a,"data-testid":"paragen-prefer-response-button",children:e.jsx(U,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),p=r;return e.jsxs("div",{"data-paragen-root":!0,className:P("relative flex w-full min-w-[min(450px,80vw)] snap-center flex-col gap-1 text-left",l&&c&&"pl-3 pr-5 sm:w-[calc(100cqw-62px)] sm:pl-3 sm:pr-5 md:px-10",!l&&c&&"px-10",c?"min-h-60 py-4":"rounded-2xl border border-token-main-surface-tertiary bg-white p-5 dark:bg-gray-700"),ref:s,children:[e.jsx("div",{className:P("absolute left-0 right-0 top-48 h-px","invisible"),ref:h}),e.jsx("div",{className:P("absolute bottom-0 left-0 right-0 top-48","invisible"),ref:g}),e.jsx("div",{className:P("absolute bottom-0 left-0 right-0 h-px","invisible"),ref:S}),n,c?e.jsx("div",{className:"flex-1"}):null,c?e.jsx("div",{className:"mt-4 min-h-10",children:p?null:e.jsx(ne.div,{style:{translateX:T,width:C,bottom:E},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:P({fixed:D,"z-20 flex w-full justify-center":!0}),children:A})}):o?null:A]})}function Ga(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pb-5 pt-3",children:[e.jsx(at,{className:"h-4 w-[75%]"}),e.jsx(at,{className:"h-4 w-[50%]"}),e.jsx(at,{className:"h-4 w-[80%]"}),e.jsx(at,{className:"h-4 w-[55%]"}),e.jsx(at,{className:"h-4 w-[66%]"}),e.jsx(at,{className:"h-4 w-[64%]"}),e.jsx(at,{className:"h-4 w-[48%]"})]})}function sa(){const{layer:t}=Ve("3119715334");return t.get("should-enable-hojicha",!1)}const Wa=pe.div`text-sm text-token-text-secondary font-semibold`,Va=pe.div`flex gap-4 items-center mb-1`,at=pe.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function qa({clientThreadId:t,conversationTurnMountTime:s,turn:a,originalTurn:n}){const o=On();if(!o.showParagenMetadata||!o.showDebugConversationTurns&&!o.forceParagen||a==null)return null;let r=a===n?"ORIGINAL":"NEW";const c=a.messages[a.messages.length-1],l=c?.message?.metadata?.__internal;if(l){const{model_id:h,model_definition_slug:g,model_definition_virtual_model_id:S,alternative_model_selection_rule:x,augmented_paragen_prompt_group_id:f,augmented_paragen_prompt_id:R,augmented_paragen_prompt:j}=l;h&&(r+=`
Model ID: ${h}`),g&&(r+=`
Model Slug: ${g}`),S&&(r+=`
Virtual Model ID: ${S}`),x&&(r+=`
Alternative Model Rule: ${x}`),f&&(r+=`
Prompt Group ID: ${f}`),R&&(r+=`
Prompt ID: ${R}`),j&&(r+=`
Prompt: ${j}`)}r+=`
Message ID: ${c.message.id}`;const m=Z.getTree(t).getParentPromptNode(a.variantIds[0]),d=m.metadata?.variantsInStreamInfo==null&&m.message.metadata?.paragen_variants_info!=null;return r+=`
User prompt message ID: ${m.message.id}`,r+=`
Is Persisted Paragen? ${d}`,r+=`
Completion Sample Finish Time: ${d?`${s} (persisted)`:Xe(a.messages)?.completionSampleFinishTime}`,e.jsx("div",{className:"whitespace-pre-wrap text-sm text-red-500",children:r})}async function ys({shouldUseNewParagenEndpoint:t,params:s}){t?await At.submitParagenSelectionV2(s):await At.submitMessageComparisonFeedback(s)}function Oh(){const{value:t}=qe("3894844102");return t}const $a=Pe({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}"}}),Ya=[1,2,3,4,10,20,30],zh=.5;function Gh({clientThreadId:t,conversationLeafId:s}){const a=Go(Wo.isBusinessWorkspace),n=i.useRef(!1),o=Qt(t),r=Ls(t),{isUnauthenticated:c}=Ie(),l=i.useMemo(()=>{if(!o)return-1;const E=zo(o);return E()>zh?-1:Ya[Math.floor(E()*Ya.length)]},[o]),u=Ni(t,s),m=u[u.length-1],d=i.useMemo(()=>Ms.getRequestIdFromConversationTurn(m),[m]),h=rt(d),[g,S]=i.useState(null),[x,f]=i.useState(!1),[R,j]=i.useState(!1),[M,y]=i.useState(!1),v=E=>{const A=Xe(u)?.messages[0]?.message.id;S(E),T(A,E)},N=u.filter(E=>E.role===Ue.Assistant).length,D=m?.role===Ue.Assistant,T=i.useMemo(()=>Do((E,A)=>{o&&E&&At.submitConversationRating({conversation_id:o,message_id:E,rating:A,shown_at_assistant_turn:l}),K.logEvent(X.conversationRatingSubmitted,{rating:A,showAtAssistantTurn:l,conversationId:o}),f(!0),setTimeout(()=>{j(!0)},1500)},2e3),[o,l]),C=N!==l||h||!D||!!a||r?.kind!==Je.PrimaryAssistant||M||c;return i.useEffect(()=>{!C&&!n.current&&(K.logEvent(X.conversationRatingShown,{showAtAssistantTurn:l,conversationId:o}),n.current=!0)},[C]),M||C?null:e.jsxs("div",{className:"mx-auto",children:[e.jsx(Jt,{children:x&&!R&&e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(Ka,{$padded:!0,children:e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(U,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!x&&e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:e.jsxs(Ka,{$padded:!1,children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-secondary",children:[e.jsx(U,{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(nn,{$selected:g==="thumbsUp",onClick:()=>v("thumbsUp"),children:e.jsx(Vo,{className:"icon-md"})}),e.jsx(nn,{$selected:g==="thumbsDown",onClick:()=>v("thumbsDown"),children:e.jsx(qo,{className:"icon-md"})})]})]}),e.jsx("div",{className:"w-px flex-1 self-stretch bg-token-main-surface-tertiary"}),e.jsx(nn,{className:"p-3",$selected:!1,onClick:()=>y(!0),children:e.jsx(Ai,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const nn=pe.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,Ka=pe.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`,Wh=Oe(()=>ze(()=>import("./i4tmz4dvnws9kwne.js"),__vite__mapDeps([33,1,2,3,4,5,34])));function Vh({clientThreadId:t,conversationLeafId:s,canShowInlineMessageFeedback:a,messageForRating:n,allGroupedMessages:o,currentModelId:r}){let c=null;const l=Ei(t,s),u=Qt(t),m=zn(g=>g.voiceFeedbackThread),d=u===m,{voiceName:h}=Td();return l?null:(d&&u?(Ri.feedbackShown.success({voice:h}),c=e.jsx("div",{className:"text-center",children:e.jsx(_d,{serverThreadId:u})})):n.rating&&a?c=e.jsx(Wh,{clientThreadId:t,conversationMessage:n,allGroupedMessages:o,currentModelId:r}):c=e.jsx("div",{className:"text-center",children:e.jsx(Gh,{clientThreadId:t,conversationLeafId:s})}),e.jsx("div",{className:"mt-3 w-full empty:hidden",children:c}))}const qh=Oe(()=>ze(()=>import("./jigpaeexz9arl6io.js"),__vite__mapDeps([35,1,2,3,36,37,4,5,38])).then(t=>t.VoicePlayButton)),Xa=128,Qa={minHeight:"calc(100cqh - var(--thread-leading-height) - var(--thread-trailing-height) - var(--previous-turn-min-height))"};function $h(t){const{turnIndex:s,conversationLeafId:a,isFinalTurn:n,clientThreadId:o,onChangeItemInView:r,onChangeRating:c,currentModelId:l,avatarClassName:u,showAvatar:m=!0,scrollToMessageId:d,shouldShowDateHeader:h}=t,g=xe(),S=Bn(),x=!!S&&Ii(S),f=Mn(),R=Go(Wo.isBusinessWorkspace),j=so(),{value:M}=qe("2848981774"),y=Z.getServerThreadId(o),v=Mt(cn(o,s,a)),{messages:N,variantIds:D,variantsInStreamInfo:T}=v,C=Rs(N),E=kd();let A=N[N.length-1];for(const z of C){const ue=Bu(z);if(ue.some(We=>E.has(We.message.id))){A=ue[ue.length-1];break}}const p=N.slice(0,N.indexOf(A)+1),B=Es(),[w,H]=i.useState(!1),[G,_]=i.useState(!1),I=D.findIndex(z=>p.some(ue=>ue.nodeId===z)),b=v.role===Ue.User,F=ct(),Y=Te(o),te=Pt(v.gizmoId??Y)?.data,q=Hs(l),ie=Nd(l),le=De(),J=Ls(o,te?.gizmo.id),we=ao(o)===oo.STREAMING,Le=!1,{value:ce}=Cs("2291672486"),fe=p.some(z=>z.message.content.content_type===mo.MultimodalText),{layer:je}=Ve("1547743984"),ve=y&&B&&je.get("show_share_button_inline",!1),{isUnauthenticated:Ae}=Ie(),[Ee,Be]=i.useState(!1),[Ce,O]=i.useState(!1),L=v.messages.map(z=>z.message.id),V=i.useRef(null),W=N[N.length-1],Q=W.rating,ae=(d?.length??0)>2&&d!=="finalAgentTurn"&&n&&M&&le,ge=()=>{p.length===1&&(K.logEvent(X.editPrompt,{id:p[0].message.id,threadId:Z.getServerThreadId(o)}),de.logEvent("chatgpt_edit_prompt"),H(!0))},Se=i.useCallback(()=>{H(!1)},[]),oe=i.useCallback(z=>{Ad(o,s,j,z)},[o,s,j]),Re=z=>{c({nodeId:W.nodeId,messageId:W.message.id,rating:z}),K.logEvent(z==="thumbsDown"?X.messageFeedbackThumbsDownClicked:X.messageFeedbackThumbsUpClicked,{id:W.message.id,threadId:Z.getServerThreadId(o),model:l,rating:z}),_(!0)},[$]=i.useState(()=>Date.now()),Me=i.useMemo(()=>Ms.getRequestIdFromConversationTurn(v),[v]),Ge=ro({clientThreadId:o,conversationLeafId:a}),ee=rt(Me)&&!Ge,dt=Tn(),ut=Rs(p),mt=i.useRef(!1);i.useEffect(()=>{if(mt.current||d===void 0||!M||!le||!V.current){d==="finalAgentTurn"&&n&&mt.current&&Z.updateScrollToMessageId(o,void 0);return}(L.includes(d)||d==="finalAgentTurn"&&n)&&(mt.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(V.current)if(d==="finalAgentTurn"&&n)V.current.scrollIntoView({behavior:"instant",block:"end"}),Z.updateScrollToMessageId(o,void 0);else{const z=V.current.offsetHeight;let ue;z>Xa?ue=Xa-z:ue=0,V.current.style.scrollMarginTop=`calc(${ue}px + 2px + var(--thread-leading-height))`,V.current.scrollIntoView({behavior:"smooth"})}})}))},[d,V.current]);const{showDebugConversationTurns:Os}=On(),Dt=io(o),$e=Fo(o),ht=Ed({clientThreadId:o,conversationMode:J}),_e=lt(o),gt=i.useCallback(({requestedModelId:z,systemMessage:ue,juice:We,extraStreamParams:jt})=>{const Ot=new qt;ht({id:W.nodeId,eventMetadata:{eventSource:"mouse"},turnTracker:Ot,requestedModelId:z,systemMessage:ue,juice:We,extraStreamParams:jt})},[W,ht]),ts=Le,pt=!f&&!Dt&&!F&&!b,Lt=Rd(),Bt=A.message.author.role===Ue.Assistant?A.message:null;Id({isCompletionRequestInProgress:ee,isUserTurn:b,message:Bt});const Ft=Ze(o,z=>z?.tree!=null&&D.some(ue=>{const We=z.tree.getLeafFromNode(ue);return z.tree.getHasErrorFromNode(We.id)})),{isOpen:ft}=Pd(),et=Dd(J),Ht=!Lt&&!et&&pt&&n&&T?.num_variants_in_stream===2&&!W.inlineComparisonRating&&!Ft,Ye=Ld(v),tt=Ht,zs=Ht&&!Ye,xt=!b&&!f&&!Dt&&!et&&!we&&!ee&&!ft,vt=xt&&(!R||ts||ie||x)&&!et&&!Ae&&!F,St=!f&&!((ee||we)&&n)&&D.length>1&&!w&&!tt;let bt=!1;if(b&&p.length===1){const{shouldHideContent:z}=Bd(p[0]);z&&(bt=!0)}const Ut=b&&!et&&!f&&!fe&&p.length===1&&!bt&&!w&&!Ae,Gs=z=>{r(D[z]),K.logEvent(X.changeNode,{intent:"toggle_between"})};if(!Fd(v,p,Os)&&!tt)return ae?e.jsx("div",{style:Qa}):null;const st=p.some(({message:z})=>Pi.getAssetPointers(z).length>0),ss=!st&&n&&$e&&!ce?e.jsx(fs,{onClick:()=>{de.logEvent("chatgpt_regenerate_try_again_button_clicked",l,{requestedModelId:l,...Qe({clientThreadId:o,turnIndex:s})});const z=new qt;ht({id:_e,eventMetadata:{eventSource:"mouse"},turnTracker:z}),_s()},icon:Xn,label:g.formatMessage({id:"ConversationTurn.regenerateTooltip",defaultMessage:"Regenerate"}),testId:"regenerate-turn-action-button"}):null,yt="h-[30px] rounded-md px-1 text-token-text-secondary hover:bg-token-main-surface-secondary",Vs=!st&&ce?e.jsx(Bh,{className:yt,clientThreadId:o,message:W,onModelSelect:gt,onDropdownChange:Be,canRegenerateResponse:$e}):null,qs=!b&&!bt&&(!n||!ee)?e.jsx(Xd,{onClick:oe}):null,ns=!b&&(!n||!ee)&&(W.disclaimers??[]).length===0&&W.nodeId?e.jsx(qh,{conversationId:o,message:W,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-xs text-token-text-tertiary hover:text-token-text-primary"}):null,as=!b&&W&&(!n||!ee)?e.jsx(Qd,{message:W,isFinalTurn:n,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-token-text-tertiary hover:text-token-text-primary"}):null,wt=vt&&!ee?e.jsxs("div",{className:"flex",children:[Q!=="thumbsDown"&&e.jsx(fs,{onClick:()=>Re("thumbsUp"),disabled:Q==="thumbsUp",icon:Q==="thumbsUp"?Hd:Vo,label:g.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"},`thumbsUp:${W.nodeId}`),Q!=="thumbsUp"&&e.jsx(fs,{onClick:()=>Re("thumbsDown"),disabled:Q==="thumbsDown",icon:Q==="thumbsDown"?Ud:qo,label:g.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"},`thumbsDown:${W.nodeId}`)]}):null,$s=ve&&e.jsx(fs,{onClick:()=>{As.openSharingModal(y)},label:g.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:Od}),Ys=!ce&&e.jsx(Ih,{className:yt,clientThreadId:o,message:W,onModelSelect:gt,onDropdownChange:Be});function os(z){return le?z:e.jsx(Vn,{clientThreadId:o,isStaticSharedThread:f,withVerticalPadding:!0,withHorizontalPadding:!tt,children:z})}function rs(z){return le?z:e.jsx($t,{children:z})}return e.jsxs(e.Fragment,{children:[h&&e.jsx(zd,{turn:v}),e.jsxs("article",{className:P("w-full scroll-mb-[var(--thread-trailing-height,150px)] text-token-text-primary focus-visible:outline-2 focus-visible:outline-offset-[-4px]",d==="finalAgentTurn"&&M&&le?"opacity-0":""),style:ae?Qa:void 0,ref:V,dir:"auto","data-testid":`conversation-turn-${s}`,"data-scroll-anchor":n,onMouseEnter:()=>O(!0),onMouseLeave:()=>O(!1),children:[e.jsx(Gd,{role:v.role}),os(e.jsx(e.Fragment,{children:tt?e.jsx(Fh,{isFeedbackEnabled:vt,variantIds:D,variantsInStreamInfo:T,conversationTurnMountTime:$,stubSideBySideFeedback:zs,...t}):rs(e.jsxs(e.Fragment,{children:[!b&&m&&e.jsx(Yh,{children:e.jsx(xn,{messages:p,isUserTurn:b,avatarClassName:u,gizmo:te})}),e.jsx("div",{className:P("group/conversation-turn relative flex w-full min-w-0 flex-col",!b&&Wd),children:e.jsx("div",{className:"flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[!b&&!f&&e.jsx(Vd,{messages:p,clientThreadId:o,gizmoId:te?.gizmo.id}),!1,e.jsx(vn,{groupedMessagesToRender:ut,allGroupedMessages:C,...t,isEditing:w,isUserTurn:b,isCompletionRequestInProgress:ee,isFeedbackEnabled:vt,isFinalTurn:n,hasActiveRequest:dt,showEditButton:Ut,handleEnterEdit:ge,handleExitEdit:Se}),q&&e.jsx("div",{className:"mb-4",children:e.jsx(qd,{messages:p})}),(xt||St)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:P("mb-2 flex gap-3 empty:hidden",b?"mr-1 flex-row-reverse":"-ml-2"),children:e.jsx($d,{alwaysShow:n,showInline:n||St,isHovered:Ce||Ee,pagination:St&&e.jsx(Yd,{showInline:n||St,currentPage:I,onChangeIndex:Gs,length:D.length,className:P("self-center",D.length>1?"visible":"!invisible")}),actions:xt&&e.jsxs(e.Fragment,{children:[ns,qs,ss,wt,as,Ys,$s,Vs]})})}),xt&&!ee?e.jsx("div",{className:"pr-2 lg:pr-0",children:e.jsx(Kd,{message:W,isFinalTurn:n})}):null,n&&!ee&&e.jsx(Vh,{canShowInlineMessageFeedback:G,clientThreadId:o,conversationLeafId:a,messageForRating:W,allGroupedMessages:C,currentModelId:l})]})]})})})]}))}))]})]})}const wn=fo.memo($h),Yh=pe.div`flex-shrink-0 flex flex-col relative items-end`;function Kh({onChangeItemInView:t,onRequestMoreCompletions:s,onChangeRating:a,onRequestCompletion:n,clientThreadId:o,conversationLeafId:r,hideHeader:c}){const l=ye(),u=Bs(),m=Zd(),[d]=Jd(),h=eu(),[g]=tu(),S=Ls(o),x=Ds(),f=Kn(o),j=Z.getConversationOrigin(o)===Di.APPLE,M=l.store.useContentAreaDimensions(Rt.Header,F=>F?.height?F.height:void 0),y=l.store.useIsHeaderContentAreaPopulated(),v=ho(o),{isArchived:N}=v,D=su(f.id),T=S?.kind===Je.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":D,C=Nn(o,r),E=nu(),[A,p]=i.useState(0),[B,w]=i.useState(!1);i.useEffect(()=>{u&&(A===0?p(C):!B&&C>A&&(w(!0),de.logEvent("chatgpt_continue_conversation_first_message_sent"),K.logEvent(X.continueConversationFirstMessageSent),de.logEvent("chatgpt_conversation_share_page_loaded"),K.logEvent(X.sharedConversationPageLoaded)))},[C,A,B,u]),i.useEffect(()=>{u&&(de.logEvent("chatgpt_continue_conversation_page_loaded"),K.logEvent(X.continueConversationPageLoaded))},[u]);const H=i.useCallback(()=>{m({behavior:"smooth"})},[m]),G=au(o),_=E&&!N,I=$o(o,r),b=(F,Y,te)=>[...new Array(Y-F).keys()].map(q=>{const ie=q+F;return e.jsx(wn,{isFinalTurn:te(ie),turnIndex:ie,clientThreadId:o,conversationLeafId:r,onChangeItemInView:t,onChangeRating:a,onRequestMoreCompletions:s,onRequestCompletion:n,currentModelId:f.id,avatarClassName:T,scrollToBottom:H,shouldShowDateHeader:I(ie)},ie)});return e.jsxs("div",{onCopy:G,className:P("flex flex-col text-sm",_&&"pb-[120px]",M||_?null:"md:pb-9"),style:{paddingBottom:_?void 0:M},children:[!c&&x?.data&&e.jsx(vr,{clientThreadId:o}),u&&e.jsxs(e.Fragment,{children:[e.jsx($t,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(U,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),C-A===0&&e.jsx("div",{className:"text-center text-xs font-semibold text-token-text-primary",children:e.jsx("button",{onClick:()=>{As.openModal(ou.ReportConversation),de.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),K.logEvent(X.sharedConversationReportContentClicked,{location:"Dynamic Shared Thread Page"})},children:e.jsx(U,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})}),b(0,A,F=>F===A-1),e.jsx($t,{children:e.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(ru,{className:"icon-xs mr-2"}),e.jsx(U,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})}),b(A,C,F=>F===C-1)]}),!u&&b(0,C,F=>F===C-1),j&&d&&!g&&e.jsx(Za,{className:P("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{de.logEvent("chatgpt_thread_scroll_to_top"),h({behavior:"smooth"})},children:e.jsx(iu,{className:"icon-md text-token-text-primary"})}),!d&&e.jsx(Za,{className:P(M?null:"bottom-5",_?y?"translate-y-[-50px]":"translate-y-[-10px]":""),style:{bottom:E?"calc(var(--composer-bar_footer-current-height) + var(--composer-bar_current-height))":M},onClick:()=>{de.logEvent("chatgpt_thread_scroll_to_bottom"),m({behavior:"smooth"})},children:e.jsx(lu,{className:"icon-md text-token-text-primary"})})]})}const Za=pe.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-light right-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`,Xh=60,Qh=({children:t,scrollViewClassName:s,scrollAnchorTopOffset:a=0})=>{const n=i.useRef(null);return e.jsx("div",{className:"h-full",ref:n,children:e.jsx(An,{children:e.jsx(Lu,{className:"h-full",followButtonClassName:"hidden",initialScrollBehavior:"auto",scrollViewClassName:s,scroller:()=>Zh(n,a)?0:1/0,children:t})})})},Zh=(t,s)=>{const a=Jh(t.current);if(a==null)return!1;const n=a>s,o=a<s-Xh;return!n&&!o};function Jh(t){if(!t)return null;const s=t.querySelector('[data-scroll-anchor="true"]');if(!s)return null;const a=s.getBoundingClientRect().top,n=t.getBoundingClientRect().top;return a-n}const eg=Oe(()=>ze(()=>import("./ftys3ya0ll88cgvi.js"),__vite__mapDeps([39,2,1,3,4,5,40,41,42,43,44,38,45])).then(t=>t.OpenDebugSidebarButton)),tg=Oe(()=>ze(()=>import("./jw78725ze0inrzp9.js"),__vite__mapDeps([46,1,4,2,3,5]))),Ja=Pe({doNotShareSensitive:{id:"thread.modal.onboarding.title",defaultMessage:"Do not share sensitive materials with this application"},somethingWentWrong:{id:"thread.modal.unrecoverableError.title",defaultMessage:"Something went wrong"},tryAgainLater:{id:"thread.modal.unrecoverableError.description",defaultMessage:"We're sorry, but something went wrong. Please try again later."},resetThread:{id:"thread.modal.unrecoverableError.resetThread",defaultMessage:"Reset thread"},sharedConversationReportConversation:{id:"thread.sharedConversation.report",defaultMessage:"Report conversation"},latencyButton:{id:"thread.latencyButton",defaultMessage:"Latency"},archivedConversationDescription:{id:"thread.archivedConversationDescription",defaultMessage:"This conversation is archived. To continue, please unarchive it first."},unarchiveButton:{id:"thread.unarchiveButton",defaultMessage:"Unarchive"}});function sg({clientThreadId:t}){const s=po(),a=Qt(t),n=async()=>{a&&(await At.patchConversation(a,{is_archived:!1}),s.invalidateQueries({queryKey:["conversation",t]}),_n.setState(o=>{const r=o.threads[a];r!=null&&(r.initialThreadData.isArchived=!1)}),Tu(s))};return e.jsxs("div",{className:"my-6 flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"px-3 text-center text-sm text-token-text-secondary",children:e.jsx(U,{...Ja.archivedConversationDescription})}),e.jsx("div",{children:e.jsx(It,{disabled:!a,onClick:n,icon:Cu,children:e.jsx(U,{...Ja.unarchiveButton})})})]})}const xg=function({clientThreadId:t,onCompletionFinished:s,onCreate:a,preRequestCompletion:n,hideHeader:o,hideMessages:r,hideFooter:c,hideToolsOverlay:l,messagesVerticalAlign:u="top",prependThreadChildren:m,renderEmptyState:d,prefetchSearch:h}){const g=no(),S=Fn(t),x=Zt(t),f=lt(t),j=ho(t).isArchived;Li(t),i.useEffect(()=>{x||(_t(t)?ln.addTiming("chatgpt.web.chatPage.renderNewConversation"):ln.addTiming("chatgpt.web.chatPage.renderExistingConversation"))},[t,x]);const M=lo(t,f),y=Nn(t,f),{setTargetedContent:v}=Un(),N=g?.includes(Bi),D=cu(),T=y>=2;Hn(T);const C=_t(t)&&!T&&js(S),E=_t(t)&&!M&&(js(S)||S?.kind===Je.GizmoTest),p=Ro().id,B=Fi(t),w=B??p,H=!!B,G=Hs(w),I=Eo()[w],b=du(t,S),F=Ao();Yo(y,t,f),i.useEffect(()=>{F||v(void 0)},[t,v,F,f]);const{caModal:Y,onRequestCompletion:te,onChangeItemInView:q,onChangeRating:ie,onRequestMoreCompletions:le}=uu({clientThreadId:t,currentModelId:w,defaultModelId:p,onCompletionFinished:s,onThreadCreated:a,preRequestCompletion:n}),{isUnauthenticated:J,isLoading:he}=Ie(),we=Ko({clientThreadId:t,currentLeafId:f,handleRequestCompletion:te,prefetchSearchPromise:h});mu({clientThreadId:t,currentModelId:w});const Le=Re=>e.jsx(Qh,{scrollAnchorTopOffset:o?0:Mu,children:u==="bottom"?e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex-1"}),Re]}):Re});i.useEffect(()=>{document.title=b??"ChatGPT"},[b]);const ce=Te(t),fe=ct(),je=Hi(),ve=E&&!je&&!d&&!ce&&!G&&!fe,Ae=ve&&!he&&J,Ee=ve&&!he&&!J,Be=th(Ae),Ce=nh(Ee),O=Ae&&Be||Ee&&Ce,L=Bs(),V=hu(),{reset:W,streamingContext:Q,StreamingProvider:ae}=gu();i.useEffect(()=>{V&&(Q.setOnResetContext=()=>{W()})},[V,W,Q]);const ge=i.useRef(null),Se=i.useRef(null),oe=i.useMemo(()=>({threadContentScrollContainerElementRef:ge,footerRootContainerElementRef:Se}),[]);return e.jsx(pu,{clientThreadId:t,currentLeafId:f,children:e.jsxs(ae,{value:Q,children:[N&&e.jsx(tg,{}),e.jsx(fu,{children:b!=null&&e.jsx("title",{children:b})}),e.jsx(Ui.Provider,{value:te,children:e.jsxs(xu,{children:[e.jsxs(vu,{clientThreadId:t,currentModelConfig:I,className:"composer-parent flex h-full flex-col focus-visible:outline-0",children:[!r&&e.jsx(Su,{value:oe,children:e.jsx(ng,{ref:ge,children:!x&&!we?E?d??e.jsx(Sr,{clientThreadId:t,currentModelId:w,isModelLoaded:H,onRequestCompletion:te,enableV2Homepage:O,v2HomepageDisclaimer:O&&e.jsx(Is,{clientThreadId:t})}):T?Le(e.jsxs(e.Fragment,{children:[m,e.jsx(Kh,{onChangeItemInView:q,onRequestMoreCompletions:le,onChangeRating:ie,onRequestCompletion:te,clientThreadId:t,conversationLeafId:f,hideHeader:o},t)]})):null:null})}),e.jsx(ag,{ref:Se,children:j?e.jsx(sg,{clientThreadId:t}):e.jsxs("div",{children:[!O&&e.jsx(Qm,{clientThreadId:t,isNewThread:C,showPromptStarters:C||!M,currentModelId:w,onRequestCompletion:te}),!c&&e.jsx("div",{className:"relative w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",children:js(S)&&!O&&e.jsx("div",{className:"min-h-4",children:e.jsx(Is,{clientThreadId:t})})})]})})]}),!l&&e.jsxs("div",{className:"group absolute bottom-2 end-2 z-20 flex flex-col gap-1 md:flex lg:bottom-3 lg:end-3",children:[D?e.jsxs(e.Fragment,{children:[e.jsx(eg,{}),!1]}):null,e.jsx(bu,{})]}),Y,e.jsx(yu,{clientThreadId:t,isStaticSharedThread:!1,isDynamicSharedThread:L}),e.jsx(wu,{}),e.jsx(ju,{conversationId:t,currentModelId:w,isActiveWindow:!je})]})})]})})},ng=pe.div`grow flex-1 overflow-hidden @container/thread`,ag=pe.div`md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent w-full`;function og({clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:n,v2HomepageDisclaimer:o}){return e.jsx(lr,{clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:n,v2HomepageDisclaimer:o})}const rg=Oe(()=>ze(()=>import("./ibg9ije9qbdb8ju7.js"),__vite__mapDeps([47,1,48,4,2,3,5,12])).then(t=>t.ChatScreenContentModals));function ig({disableEmptyState:t,fullWidth:s,renderEmptyState:a}){const{clientThreadId:n,currentModelId:o,conversationLeafId:r,isCompanionWindow:c,isEmbeddedInFocusedView:l,onChangeItemInView:u,onChangeRating:m,onRequestCompletion:d,onRequestMoreCompletions:h,isModelLoaded:g,prefetchSearch:S}=i.useContext(er),x=Nn(n,r),f=Ze(n,Oi.getScrollToMessageId),R={clientThreadId:n,conversationLeafId:r,currentModelId:o,onChangeItemInView:u,onChangeRating:m,onRequestMoreCompletions:h,onRequestCompletion:d,showAvatar:!1},j=Zt(n),M=Ko({clientThreadId:n,currentLeafId:r,handleRequestCompletion:d,prefetchSearchPromise:S}),y=j||M||t,v=Bs(),{initialConversationTurns:N,continuedConversationTurns:D}=_u(x,v),{canUseNewHomepage:T,showEmptyState:C}=mr({clientThreadId:n,currentLeafId:r}),E=x>=2;Hn(E);const{setTargetedContent:A}=Un(),p=Hs(o);Yo(x,n,r),i.useEffect(()=>{l||A(void 0)},[n,A,l]);const B=$o(n,r);if(C){if(a!=null)return a();if(T&&!y){const w=c?null:e.jsx("div",{className:"text-center text-xs text-token-text-secondary",children:e.jsx(Is,{clientThreadId:n})});return e.jsx(og,{clientThreadId:n,currentModelId:o,isModelLoaded:g,onRequestCompletion:d,v2HomepageDisclaimer:w})}else if(!T&&!y)return e.jsx(Sr,{clientThreadId:n,currentModelId:o,isModelLoaded:g,onRequestCompletion:d,enableV2Homepage:!p,v2HomepageDisclaimer:e.jsx(Is,{clientThreadId:n})})}return e.jsxs(e.Fragment,{children:[v&&e.jsx(ku,{}),v&&D.length===0&&e.jsx(Nu,{}),e.jsx(An,{children:e.jsxs(i.Suspense,{fallback:null,children:[e.jsx(Au,{}),N.length>0&&e.jsx("ol",{className:He.conversationTurnList,children:N.map(({turnIndex:w,isFinalTurn:H})=>e.jsx("li",{className:P(He.conversationTurnWrapper,s&&"w-full"),children:i.createElement(wn,{...R,key:`${n}-${w}`,turnIndex:w,isFinalTurn:H,scrollToMessageId:f,shouldShowDateHeader:B(w)})},w))}),v&&e.jsx(Eu,{}),e.jsx("ol",{className:He.conversationTurnList,children:D.map(({turnIndex:w,isFinalTurn:H})=>e.jsx("li",{className:P(He.conversationTurnWrapper,s&&"w-full"),children:i.createElement(wn,{...R,key:`${n}-${w}`,turnIndex:w,isFinalTurn:H,scrollToMessageId:f,shouldShowDateHeader:B(w)})},w))})]})}),e.jsx(rg,{}),x>0&&e.jsx(Ru,{})]})}function vg({renderEmptyState:t}){return e.jsx(ig,{renderEmptyState:t})}function Sg(){const t=xe(),{clientThreadId:s,isLoggedInUser:a,onNewThread:n}=i.useContext(er),o=Te(s),r=es(o),c=De();return e.jsxs(Iu,{leading:!0,type:"primary",className:He.header,children:[e.jsxs("div",{className:He.headerLeading,children:[!c&&r&&e.jsx(Jo,{clientThreadId:s,hideNewChat:!0}),a&&e.jsx(Pu,{}),!r&&e.jsx(Xt,{label:t.formatMessage(eo.newChat),className:"hidden @lg/thread:inline-flex",children:e.jsx(Ts,{to:"/",className:He.newThread,onClick:l=>{n?(l.preventDefault(),n()):de.logEvent("chatgpt_web_thread_tap_new_thread")},tabIndex:0,children:e.jsx(Du,{className:P(He.sidebarIcon),icon:e.jsx(Lo,{}),tabIndex:-1,label:t.formatMessage(eo.newChat),style:{viewTransitionName:"var(--vt_new_chat_thread)"}})})}),e.jsx("div",{className:He.threadDropdown,children:e.jsx(pr,{clientThreadId:s})})]}),e.jsx("div",{className:He.headerTrailing,children:e.jsx(An,{children:e.jsx(xr,{clientThreadId:s})})})]})}const eo=Pe({newChat:{id:"rnCpM4",defaultMessage:"New Chat"}});export{Sg as C,La as G,rr as P,pr as T,Qh as W,xg as a,vr as b,vg as c,Qm as d,wn as e,fg as f,mr as u};
//# sourceMappingURL=nh1qwxf7uo20o2cg.js.map
