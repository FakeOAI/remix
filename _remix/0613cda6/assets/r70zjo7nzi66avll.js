const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/e77rxfelnbn6252r.js","assets/j2kz7iekbuf2lk7j.js","assets/i82yi0xftw7xnu8c.js","assets/root-pepj1ul4.css","assets/4vylp69vgeqwcqq1.js","assets/do8518u43szfxnij.js","assets/le0rdv0puybx8i2m.js","assets/conversation-small-cll5buey.css","assets/16qiumnq05saksju.js","assets/l3k0q6i660cci9gs.js","assets/edsbbff3hjliwmsy.js","assets/la9ho9khwsle3ipj.js","assets/htup5dwnbax7b6kd.js","assets/k7ijapezwxn0gldf.js","assets/kfxda6hmufssgqha.js","assets/e9lafxuzyeh4418f.js","assets/jw599pz8489v1ojp.js","assets/hb1hje06k9b62bkr.js","assets/b62ru5xazts15yo7.js","assets/k3f9f9w3dyathkrt.js","assets/obzqpqgxugpntpyu.js","assets/m915zcyv891bnbyo.js","assets/ealecef5wv7wy2ad.js","assets/e6rd3uhbyhaywebc.js","assets/mc5sptj4mkj9uxem.js","assets/ni3b6td4z56jwe2m.js","assets/jpjqqpbn30fko74f.js","assets/eyqsg3qqtdkfk98w.js","assets/ja1b9jvth2p43ta6.js","assets/j7mq5nf1vxeg7fkq.js","assets/ewb0evhr38szdnyo.js","assets/b7blrmw2f2rsy4xk.js","assets/m6ja8i3ndb249mop.js","assets/iwalt63h1v4xvqgr.js","assets/ebyv7xemoskqzdop.js","assets/bei6thylcevdeq42.js","assets/bfbfsb70l0vf4jxg.js","assets/imolwwc9blvlxicq.js","assets/c5szd8ql34jskuew.js","assets/kawvie7nhoy7b5xf.js","assets/e7t3tykg4v6613sg.js","assets/lzalebmf9rqaga2z.js","assets/mzkxlhrlmxhntkvn.js","assets/ne0zcvs11g6szhoe.js","assets/ip01kcxiw5xjk5r6.js","assets/fsddy3bxlesj6ecw.js","assets/kh7bmp14bzbciz04.js","assets/5821z8v8ay0x2u7p.js","assets/gqtwr9j7xr7wx3og.js"])))=>i.map(i=>d[i]);
import{a9 as Ge,y as e,ae as c,L as vs,r as h,au as O,a0 as V,j as Ue,$ as Ce,bt as le,bF as ye,bu as Oe,fB as st,a3 as da,k as tt,fC as at,_ as ua,fD as ga,fE as pa,fF as ma,cv as fa,z as it,fG as xa,dS as ha,dQ as ys,c_ as nt,c$ as rt,cA as ot,fH as va,dR as ya,fI as ja,fJ as ba,a2 as wa,g as ka,dV as te,ab as Qe,ac as Ye,al as ge,C as je,aA as de,a4 as ie,cj as ds,u as Ma,N as Re,a1 as xe,bA as lt,be as js,aw as bs,bq as ct,ai as es,P as dt,d as ut,bB as gt,af as ws,as as pt,ax as Ta,eV as mt,a6 as ft,dK as Be,ah as Me,ea as Sa,v as Ie,R as ce,M as _a,bk as xt,bl as ht,bm as vt,ev as yt,D as us,fK as Pa,fc as Na,bn as Cs,bj as Is,f4 as Ca}from"./j2kz7iekbuf2lk7j.js";import{bm as u,kB as jt,am as Ne,kC as bt,kD as wt,kE as kt,ge as z,ab as Mt,kF as Tt,kG as Ia,kH as gs,kI as Aa,kJ as X,kK as $e,aa as La,K as Ga,kL as Ae,c7 as qe,c8 as St,cd as Ua,l as _t,m as Pt,fk as Ra,kM as za,dy as we,fx as Nt,hU as Ea,fy as Ct,fz as It,fC as Fa,fA as ae,kN as Oa,fB as Ba,fD as $a,au as ps,fE as Wa,kO as Da,kP as As,kQ as ss,at as qa,dc as Ls,dw as At,c as ks,dx as Ha,bE as Ka,cP as Va,kR as Gs,dq as Qa,kS as Lt,de as Gt,kT as Ya,cb as Ut,cj as Pe,d5 as Xa,as as Ja,kU as Za,cT as ei,d as si,gd as ti}from"./le0rdv0puybx8i2m.js";import{b as Rt,L as zt,M as Et,r as Ms,N as ai,E as Ft,K as ii,n as ni,O as ri,Q as oi,R as li,S as ci,T as di,U as Us}from"./l3k0q6i660cci9gs.js";import{m as ui,G as gi,T as R}from"./do8518u43szfxnij.js";import{U as Le,c as Ot}from"./k7ijapezwxn0gldf.js";import{G as pi,u as mi}from"./ebyv7xemoskqzdop.js";import{_ as fi}from"./fsddy3bxlesj6ecw.js";import{G as Ts}from"./ni3b6td4z56jwe2m.js";import{G as xi}from"./kh7bmp14bzbciz04.js";import{D as E,B as Ss}from"./eyqsg3qqtdkfk98w.js";import{aT as ms,P as Bt,a0 as We,s as hi,ag as vi,Q as yi,ay as ts,aV as He,aH as $t,aD as Wt,a1 as Dt,ab as ji,aC as bi,al as wi,ak as ki,K as Mi,J as Ti,bT as Si,b as _i,c as Pi,ad as Ni,by as Ci}from"./i82yi0xftw7xnu8c.js";import{S as B}from"./j7mq5nf1vxeg7fkq.js";import{W as ze,P as Ii,X as Ai,u as qt,K as Ht}from"./jpjqqpbn30fko74f.js";import{a as Rs}from"./5821z8v8ay0x2u7p.js";import{i as Li,b as Gi,T as Kt,W as Ui}from"./k3f9f9w3dyathkrt.js";import{F as pe,a as me,b as as,c as Ri,G as zi,d as Ei}from"./ip01kcxiw5xjk5r6.js";import{m as Vt}from"./16qiumnq05saksju.js";import{G as Fi}from"./mc5sptj4mkj9uxem.js";import{i as fs}from"./gqtwr9j7xr7wx3og.js";function Qt(s){return s==u.User||s==u.Group?u.Private:s==u.WorkspaceLink?u.Workspace:s}function oe(s,t){return s=Qt(s),t===void 0?!1:t.some(a=>a.recipient===s&&a.allowed)}function _s(s,t){return t===void 0?[]:(s=Qt(s),t.find(i=>i.recipient===s)?.moderated_fields)}function is(s,t){const a=_s(s,t);return a&&a.length>0}const zs=Ge.a`bold underline`,Oi=Ge.textarea`w-full text-sm overflow-y-auto rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400 border-token-border-medium bg-token-main-surface-primary h-32`;var be=(s=>(s[s.None=0]="None",s[s.AppealAvailable=1]="AppealAvailable",s[s.AppealSent=2]="AppealSent",s))(be||{}),Xe=(s=>(s[s.None=0]="None",s[s.PublishBlocked=1]="PublishBlocked",s[s.RemovedFromMarketplace=2]="RemovedFromMarketplace",s[s.RemovedFromPublic=3]="RemovedFromPublic",s[s.RemovedFromPrivate=4]="RemovedFromPrivate",s[s.Recategorized=5]="Recategorized",s))(Xe||{});function Bi(s){if(!s)return;const t=s.gizmo.appeal_info?.state.kind==="appeal_sent",a=$i(s.gizmo.share_recipient,s.gizmo.sharing_targets);return{sharingRecipient:s.gizmo.share_recipient,categories:s.gizmo.categories,gizmoId:s.gizmo.id,moderationType:a,sharingTargets:s.gizmo.sharing_targets,showModal:t?2:a!==0?1:0}}const Es={[u.User]:u.Private,[u.Group]:u.Private,[u.WorkspaceLink]:u.Workspace};function $i(s,t=[]){const a=new Set(t.filter(o=>o.allowed).map(o=>o.recipient));if(!s||(s in Es&&(s=Es[s]),a.has(s)))return 0;const i=a.has(u.Private)||a.has(u.Workspace),n=a.has(u.Link)||a.has(u.Marketplace);return s===u.Marketplace&&n?2:!n&&i?3:4}function Fs(s){switch(s){case 0:case 1:return O({id:"gizmo.appeals.publishBlockedTitle",defaultMessage:"Your changes couldn’t be published"});case 2:return O({id:"gizmo.appeals.removedFromMarketplaceTitle",defaultMessage:"Your GPT has been removed from the marketplace"});case 3:return O({id:"gizmo.appeals.removedFromPublicTitle",defaultMessage:"Your GPT has been removed from public view"});case 5:return O({id:"gizmo.appeals.recategorizedTitle",defaultMessage:"Your GPT has been recategorized"});default:jt(s)}}function Wi(s){switch(s){case"profile_picture":return O({id:"gizmo.appeals.profilePictureFieldName",defaultMessage:"Profile Picture"});case"gizmo_name":return O({id:"gizmo.appeals.gizmoNameFieldName",defaultMessage:"Name"});case"gizmo_description":return O({id:"gizmo.appeals.gizmoDescriptionFieldName",defaultMessage:"Description"});case"gizmo_instructions":return O({id:"gizmo.appeals.gizmoInstructionsFieldName",defaultMessage:"Instructions"});case"gizmo_welcome_message":return O({id:"gizmo.appeals.gizmoWelcomeMessageFieldName",defaultMessage:"Welcome Message"});case"custom_actions":return O({id:"gizmo.appeals.customActionsFieldName",defaultMessage:"Custom Actions"});case"conversation_starter":return O({id:"gizmo.appeals.conversationStarterFieldName",defaultMessage:"Conversation Starter"});case"file":return O({id:"gizmo.appeals.fileFieldName",defaultMessage:"File"});case"gizmo_combined_content":return O({id:"gizmo.appeals.gizmoCombinedContentFieldName",defaultMessage:"Overall GPT Config"})}}function Di(s){switch(s){case u.Private:case u.Workspace:return O({id:"gizmo.appeals.privateRecipientModerationText",defaultMessage:"Your GPT can’t be updated because it violates our {usagePolicyLink}Usage Policies{usagePolicyLink}."});case u.Link:return O({id:"gizmo.appeals.linkRecipientModerationText",defaultMessage:"Your GPT can’t be shared publicly because it violates our {usagePolicyLink}Usage Policies{usagePolicyLink}."});case u.Marketplace:return O({id:"gizmo.appeals.marketplaceRecipientModerationText",defaultMessage:"Your GPT can’t appear in the Explore GPTs page because it violates our {usagePolicyLink}Usage Policies{usagePolicyLink}."});default:jt(s)}}function Yt({sharingRecipient:s,moderatedFields:t,appealAvailable:a}){const i=t.length;return e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx(c,{...Di(s),values:{usagePolicyLink:n=>e.jsx(zs,{target:"_blank",href:"https://openai.com/policies/usage-policies",rel:"noreferrer",children:n})}})," ",i>0&&e.jsx(c,{id:"gizmo.appeals.seeBelowForSpecificIssues",defaultMessage:`{numModeratedFields, plural,
              one {See below for the specific issue:}
              other {See below for the specific issues:}
            }`,values:{numModeratedFields:i}})]}),i>0&&t?.map(n=>e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-bold",children:e.jsx(c,{...Wi(n.name)})}),e.jsx("ul",{className:"list-disc pl-5",children:n.reasons.map(o=>e.jsxs("li",{children:[o.description," ",o.link?e.jsx(zs,{href:o.link,target:"_blank",rel:"noreferrer",children:e.jsx(c,{id:"gizmo.appeals.learnMore",defaultMessage:"Learn more"})}):""]},o.description))})]})),a&&e.jsx("p",{children:e.jsx(c,{id:"gizmo.appeals.appealAvailableText",defaultMessage:"Alternatively you may appeal this decision and we will get back to you as soon as possible. Or you can publish to “Only me” and use this GPT privately."})})]})}function qi({gizmoId:s,sharingRecipient:t,categories:a,moderationType:i,sharingTargets:n,appealAvailable:o,onClose:r,onAppealSubmitted:d}){const l=V(),[m,y]=h.useState(""),[v,g]=h.useState(0),f=Ue(),p=async()=>{await Ne.postGizmoAppeal(f,s,m,t,a),g(2),d?.()},x=_s(t,n),j=x?.length??0,M=Ce();if(j==0&&M?.isEnterprisey())return e.jsx(le,{title:l.formatMessage(Fs(i)),isOpen:!0,onClose:r,showCloseButton:!0,type:"warning",primaryButton:e.jsx(ye.Button,{color:"primary",onClick:r,children:e.jsx(c,{id:"wEsAOU",defaultMessage:"OK"})}),children:e.jsx("p",{className:"text-sm",children:e.jsx(c,{id:"gizmo.appeals.workspaceSettingsMessage",defaultMessage:"Access to your GPT has been reduced by your workspace's GPT sharing settings. An owner of the workspace can change these settings in the workspace settings page."})})});switch(v){case 0:return e.jsx(le,{title:l.formatMessage(Fs(i)),isOpen:!0,onClose:r,showCloseButton:!0,primaryButton:e.jsx(ye.Button,{color:"primary",onClick:r,children:e.jsx(c,{id:"gizmo.appeals.contunueButton",defaultMessage:"Continue"})}),secondaryButton:o?e.jsx(ye.Button,{onClick:()=>g(1),children:e.jsx(c,{id:"gizmo.appeals.appealButton",defaultMessage:"Appeal"})}):void 0,type:"warning",children:e.jsx("div",{className:"flex flex-col gap-2 text-sm",children:e.jsx(Yt,{sharingRecipient:t,moderatedFields:x??[],appealAvailable:o})})});case 1:return e.jsx(le,{title:l.formatMessage({id:"gizmo.appeals.appealModalTitle",defaultMessage:"Appeal"}),isOpen:!0,onClose:r,showCloseButton:!0,shouldIgnoreClickOutside:!0,primaryButton:e.jsx(ye.Button,{color:"primary",onClick:p,disabled:m.trim().length===0,children:e.jsx(c,{id:"gizmo.appeals.submitAppealButton",defaultMessage:"Submit"})}),secondaryButton:e.jsx(ye.Button,{onClick:()=>g(0),children:e.jsx(c,{id:"gizmo.appeals.backButton",defaultMessage:"Back"})}),type:"warning",children:e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsx("p",{children:e.jsx(c,{id:"gizmo.appeals.appealReasonText",defaultMessage:"Please provide a reason for why you believe this GPT doesn’t violate our policies and should be published"})}),e.jsx(Oi,{value:m,onChange:P=>y(P.target.value)})]})});case 2:return e.jsx(e.Fragment,{})}}function Hi({onClose:s}){const t=V();return e.jsx(le,{title:t.formatMessage({id:"gizmo.appeals.appealSubmittedModalTitle",defaultMessage:"Appeal submitted"}),isOpen:!0,onClose:s,showCloseButton:!0,primaryButton:e.jsx(ye.Button,{color:"primary",onClick:s,children:e.jsx(c,{id:"gizmo.appeals.closeButton",defaultMessage:"Close"})}),type:"success",children:e.jsx("div",{className:"flex flex-col gap-2 text-sm",children:e.jsx("div",{children:e.jsx(c,{id:"gizmo.appeals.appealSubmittedText",defaultMessage:"Your appeal has been submitted. We will get back to you as soon as possible."})})})})}function Ki({gizmoId:s,onClose:t}){const{data:a}=Rt(s,!0),i=Ue(),n=async()=>{await Ne.postGizmoCancelAppeal(i,s)};return e.jsx(le,{isOpen:!0,onClose:Oe,primaryButton:e.jsx(ye.Button,{color:"primary",onClick:()=>{n(),t?.()},children:e.jsx(c,{id:"gizmo.appeals.cancelAppealButton",defaultMessage:"Cancel appeal"})}),type:"warning",children:e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsx("h2",{className:"text-lg font-semibold",children:e.jsx(c,{id:"gizmo.appeals.appealReviewingHeader",defaultMessage:"Reviewing your appeal"})}),e.jsx("p",{children:e.jsx(c,{id:"gizmo.appeals.appealSentModalText",defaultMessage:"During the review you can continue using “{gizmoName}” as your private GPT, but won’t be able to update it or share it with others.",values:{gizmoName:a?.gizmo.display.name}})})]})})}function Vi({appealState:s,onAppealClose:t,onAppealSubmitted:a}){const{value:i}=vs("4226692983"),[n,o]=h.useState(!1);return n?e.jsx(Hi,{onClose:()=>{o(!1),a?.()}}):e.jsxs(e.Fragment,{children:[s?.showModal==2&&e.jsx(Ki,{gizmoId:s.gizmoId,onClose:t}),s?.showModal==1&&e.jsx(qi,{gizmoId:s.gizmoId,sharingRecipient:s.sharingRecipient,categories:s.categories,moderationType:s.moderationType,sharingTargets:s.sharingTargets,appealAvailable:i,onClose:()=>t?.(),onAppealSubmitted:()=>o(!0)})]})}function Qi(s,t){for(var a=-1,i=s==null?0:s.length;++a<i&&t(s[a],a,s)!==!1;);return s}var Yi=Qi,Xi=st,Ji=da;function Zi(s,t,a,i){var n=!a;a||(a={});for(var o=-1,r=t.length;++o<r;){var d=t[o],l=i?i(a[d],s[d],d,a,s):void 0;l===void 0&&(l=s[d]),n?Ji(a,d,l):Xi(a,d,l)}return a}var Je=Zi,en=Je,sn=tt;function tn(s,t){return s&&en(t,sn(t),s)}var an=tn,nn=Je,rn=at;function on(s,t){return s&&nn(t,rn(t),s)}var ln=on,Ke={exports:{}};Ke.exports;(function(s,t){var a=ua,i=t&&!t.nodeType&&t,n=i&&!0&&s&&!s.nodeType&&s,o=n&&n.exports===i,r=o?a.Buffer:void 0,d=r?r.allocUnsafe:void 0;function l(m,y){if(y)return m.slice();var v=m.length,g=d?d(v):new m.constructor(v);return m.copy(g),g}s.exports=l})(Ke,Ke.exports);var cn=Ke.exports,dn=Je,un=ga;function gn(s,t){return dn(s,un(s),t)}var pn=gn,mn=Je,fn=pa;function xn(s,t){return mn(s,fn(s),t)}var hn=xn,vn=Object.prototype,yn=vn.hasOwnProperty;function jn(s){var t=s.length,a=new s.constructor(t);return t&&typeof s[0]=="string"&&yn.call(s,"index")&&(a.index=s.index,a.input=s.input),a}var bn=jn,Os=ma;function wn(s){var t=new s.constructor(s.byteLength);return new Os(t).set(new Os(s)),t}var Ps=wn,kn=Ps;function Mn(s,t){var a=t?kn(s.buffer):s.buffer;return new s.constructor(a,s.byteOffset,s.byteLength)}var Tn=Mn,Sn=/\w*$/;function _n(s){var t=new s.constructor(s.source,Sn.exec(s));return t.lastIndex=s.lastIndex,t}var Pn=_n,Bs=fa,$s=Bs?Bs.prototype:void 0,Ws=$s?$s.valueOf:void 0;function Nn(s){return Ws?Object(Ws.call(s)):{}}var Cn=Nn,In=Ps;function An(s,t){var a=t?In(s.buffer):s.buffer;return new s.constructor(a,s.byteOffset,s.length)}var Ln=An,Gn=Ps,Un=Tn,Rn=Pn,zn=Cn,En=Ln,Fn="[object Boolean]",On="[object Date]",Bn="[object Map]",$n="[object Number]",Wn="[object RegExp]",Dn="[object Set]",qn="[object String]",Hn="[object Symbol]",Kn="[object ArrayBuffer]",Vn="[object DataView]",Qn="[object Float32Array]",Yn="[object Float64Array]",Xn="[object Int8Array]",Jn="[object Int16Array]",Zn="[object Int32Array]",er="[object Uint8Array]",sr="[object Uint8ClampedArray]",tr="[object Uint16Array]",ar="[object Uint32Array]";function ir(s,t,a){var i=s.constructor;switch(t){case Kn:return Gn(s);case Fn:case On:return new i(+s);case Vn:return Un(s,a);case Qn:case Yn:case Xn:case Jn:case Zn:case er:case sr:case tr:case ar:return En(s,a);case Bn:return new i;case $n:case qn:return new i(s);case Wn:return Rn(s);case Dn:return new i;case Hn:return zn(s)}}var nr=ir,rr=it,Ds=Object.create,or=function(){function s(){}return function(t){if(!rr(t))return{};if(Ds)return Ds(t);s.prototype=t;var a=new s;return s.prototype=void 0,a}}(),lr=or,cr=lr,dr=xa,ur=ha;function gr(s){return typeof s.constructor=="function"&&!ur(s)?cr(dr(s)):{}}var pr=gr,mr=ys,fr=nt,xr="[object Map]";function hr(s){return fr(s)&&mr(s)==xr}var vr=hr,yr=vr,jr=ot,qs=rt,Hs=qs&&qs.isMap,br=Hs?jr(Hs):yr,wr=br,kr=ys,Mr=nt,Tr="[object Set]";function Sr(s){return Mr(s)&&kr(s)==Tr}var _r=Sr,Pr=_r,Nr=ot,Ks=rt,Vs=Ks&&Ks.isSet,Cr=Vs?Nr(Vs):Pr,Ir=Cr,Ar=va,Lr=Yi,Gr=st,Ur=an,Rr=ln,zr=cn,Er=fi,Fr=pn,Or=hn,Br=ja,$r=ba,Wr=ys,Dr=bn,qr=nr,Hr=pr,Kr=wa,Vr=ya,Qr=wr,Yr=it,Xr=Ir,Jr=tt,Zr=at,eo=1,so=2,to=4,Xt="[object Arguments]",ao="[object Array]",io="[object Boolean]",no="[object Date]",ro="[object Error]",Jt="[object Function]",oo="[object GeneratorFunction]",lo="[object Map]",co="[object Number]",Zt="[object Object]",uo="[object RegExp]",go="[object Set]",po="[object String]",mo="[object Symbol]",fo="[object WeakMap]",xo="[object ArrayBuffer]",ho="[object DataView]",vo="[object Float32Array]",yo="[object Float64Array]",jo="[object Int8Array]",bo="[object Int16Array]",wo="[object Int32Array]",ko="[object Uint8Array]",Mo="[object Uint8ClampedArray]",To="[object Uint16Array]",So="[object Uint32Array]",L={};L[Xt]=L[ao]=L[xo]=L[ho]=L[io]=L[no]=L[vo]=L[yo]=L[jo]=L[bo]=L[wo]=L[lo]=L[co]=L[Zt]=L[uo]=L[go]=L[po]=L[mo]=L[ko]=L[Mo]=L[To]=L[So]=!0;L[ro]=L[Jt]=L[fo]=!1;function De(s,t,a,i,n,o){var r,d=t&eo,l=t&so,m=t&to;if(a&&(r=n?a(s,i,n,o):a(s)),r!==void 0)return r;if(!Yr(s))return s;var y=Kr(s);if(y){if(r=Dr(s),!d)return Er(s,r)}else{var v=Wr(s),g=v==Jt||v==oo;if(Vr(s))return zr(s,d);if(v==Zt||v==Xt||g&&!n){if(r=l||g?{}:Hr(s),!d)return l?Or(s,Rr(r,s)):Fr(s,Ur(r,s))}else{if(!L[v])return n?s:{};r=qr(s,v,d)}}o||(o=new Ar);var f=o.get(s);if(f)return f;o.set(s,r),Xr(s)?s.forEach(function(j){r.add(De(j,t,a,j,s,o))}):Qr(s)&&s.forEach(function(j,M){r.set(M,De(j,t,a,M,s,o))});var p=m?l?$r:Br:l?Zr:Jr,x=y?void 0:p(s);return Lr(x||s,function(j,M){x&&(M=j,j=s[M]),Gr(r,M,De(j,t,a,M,s,o))}),r}var _o=De,Po=_o,No=1,Co=4;function Io(s){return Po(s,No|Co)}var Ao=Io;const _e=ka(Ao);function Lo(s,t){if(t==null)return s;function a(i){return typeof i=="object"&&i!=null?Array.isArray(i)?i.map(a):Object.fromEntries(Object.entries(i).map(([n,o])=>[n,a(o)])):i===null?void 0:i}return t=a(t),{...s,...t}}var ue=(s=>(s[s.Loading=0]="Loading",s[s.UploadingProfilePic=1]="UploadingProfilePic",s[s.GeneratingProfilePic=2]="GeneratingProfilePic",s[s.GizmoNameTooLong=3]="GizmoNameTooLong",s[s.GizmoDescriptionTooLong=4]="GizmoDescriptionTooLong",s[s.GizmoInstructionsTooLong=5]="GizmoInstructionsTooLong",s[s.NameEmpty=6]="NameEmpty",s[s.MissingPublicActionPrivacyPolicyURL=7]="MissingPublicActionPrivacyPolicyURL",s[s.MissingCategory=8]="MissingCategory",s))(ue||{});function xs(s){switch(s){case 0:return"Loading";case 1:return"Uploading profile picture";case 2:return"Generating profile picture";case 3:return"GPT name too long";case 4:return"GPT description too long";case 5:return"GPT instructions too long";case 6:return"GPT name cannot be empty";case 7:return"Public actions require valid privacy policy URLs";case 8:return"Public GPTs must have a category"}}function Go(s){return s==="link"||s==="marketplace"}function Uo(s){try{return new URL(s),!0}catch{return!1}}function Ee(s,t,a){const i=s.name.length>bt,n=(s.description?.length??0)>wt,o=(s.instructions?.length??0)>kt,r=[];if(s?.name===""&&r.push(6),i&&r.push(3),n&&r.push(4),o&&r.push(5),t!=null&&Go(t)){const d=s.tools?.filter(l=>l.type===te.JIT_PLUGIN);for(const l of d){const m=l.metadata?.privacy_policy_url;if(m==null||!Uo(m)){r.push(7);break}}}return t===u.Marketplace&&a==null&&r.push(8),r}const ea=Qe(()=>Ye(()=>import("./e77rxfelnbn6252r.js"),__vite__mapDeps([0,1,2,3])).then(s=>s.DirectorySyncResourceManagedIndication)),Ro=[X,$e];function zo(s,t){return s.type===z.USER?s.user_id===t.user_id:s.type===z.GROUP?s.group_id===t.group_id:s.type===t.type}const Eo={[z.USER]:u.User,[z.GROUP]:u.Group,[z.WORKSPACE]:u.Workspace,[z.ALL]:u.Marketplace};function sa(s){const t=Eo[s.type];if(!t)throw new Error("Unknown sharing subject type: "+s.type);return{...s,type:t}}function Fo({gizmo:s,publishedGizmo:t,updateGizmo:a,promoteGizmo:i,appealGizmo:n,setAppealState:o,showActionsModal:r,shareOnly:d,onClose:l,workspaceOwner:m=!1}){const y=V(),v=ge(),g=Ce(),f=g?.data?.name??"your workspace",p=Mt(),x=zt(),[j,M]=h.useState(void 0);h.useEffect(()=>{if(j==null)if(t?.gizmo.display.categories&&t?.gizmo.display.categories.length>0){const w=x.data?.categories.find(A=>A.id===t?.gizmo.display.categories[0]);w&&M(w)}else x.data!=null&&M(x.data.categories[x.data.categories.length-1])},[x.data,j,t]);const[b,P]=h.useState(s.sharingRecipient??u.Private),[N,T]=h.useState(s.sharing?.subjects??[]),[k,I]=h.useState(null),[U,Q]=h.useState(!1),G=h.useCallback(()=>!je(s.sharing?.subjects,N)||s.sharingRecipient!==b,[s.sharing,s.sharingRecipient,b,N]),F=Ue(),J=Ee(s,b,j?.id??void 0),ee=J.includes(ue.MissingPublicActionPrivacyPolicyURL),$=s.tools.find(w=>w.type===te.JIT_PLUGIN&&!w.metadata.privacy_policy_url);if(k)return e.jsx(aa,{publishedGizmo:k,sharing:{recipient:b,subjects:N},workspaceName:f,onClose:l});function H(w){N.find(A=>zo(A,w))||T([...N,w])}const se=Tt(N);function he(w){const A=N.filter(Y=>[z.WORKSPACE,z.ALL].indexOf(Y.type)===-1);w!=null&&A.push(w),T(A)}function Z(w){switch(P(w),w){case u.Marketplace:case u.Link:he({type:z.ALL,capabilities:X});break;case u.Workspace:case u.WorkspaceLink:he({type:z.WORKSPACE,capabilities:X});break;default:he(null)}}function _(w){se!=null&&T(N.map(A=>A===se?{...A,capabilities:w}:A))}function W(w,A,Y){return w.type===z.USER&&w.user_id.indexOf("__")===-1?{...w,user_id:w.user_id+"__"+g?.getWorkspaceId()}:w}async function Ze(w,A){if(U)return;if(w&&!A)throw new Error("Cannot share a gizmo that hasn't been promoted before");if(!j)return;Q(!0);let ne=N.map(W).map(sa);if(ne=Ae(b,ne,se?.capabilities??X),m)return!g||!A?(v.warning("Unable to change sharing settings"),l()):(await Re.updateWorkspaceGPTSharing(g.id,A,ne),v.success(y.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),F.invalidateQueries({queryKey:["workspace"]}),l());if(w){if(!A||!t)throw new Error("No gizmo ID to share");try{const K={sharing:ne};j&&(K.categories=[j.id]);const S=await Ne.shareGizmo(A,K);S.error?is(b,S.sharing_targets)?(o({gizmoId:t.gizmo.id,sharingRecipient:b,categories:t.gizmo.display.categories,moderationType:Xe.PublishBlocked,sharingTargets:S.sharing_targets,showModal:be.AppealAvailable}),l()):v.warning(y.formatMessage({id:"tmIKmp",defaultMessage:"Unable to share GPT"})):(F.setQueryData(["gizmo",{gizmoId:t.gizmo.id},{draft:!1}],C=>S.resource),a(C=>({...C,sharingRecipient:b})),v.success(y.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),l())}catch{return v.warning(y.formatMessage({id:"dKC65l",defaultMessage:"Failed to update sharing settings"})),l()}}else{const K=await i({subjects:ne,recipient:b},j.id);A||(A=K?.gizmo.id),I(K??null),a({liveVersion:K?.gizmo.live_version??void 0}),F.invalidateQueries({queryKey:["gizmo",{gizmoId:A}]})}Q(!1),F.invalidateQueries({queryKey:["gizmos"]}),F.invalidateQueries({queryKey:["gizmo","userActionSettings",{gizmoId:A}]}),F.invalidateQueries({queryKey:["workspace"]}),a({sharing:{recipient:b,subjects:N},sharingRecipient:b},!1)}return e.jsx(le,{type:"success",className:"max-w-[555px]",size:"custom",isOpen:!0,onClose:l,primaryButton:is(b,s.sharingTargets)?e.jsx(de,{onClick:()=>n(b,j?.id),children:e.jsx(c,{id:"HRzqKK",defaultMessage:"Appeal"})}):e.jsx(de,{onClick:()=>Ze(d,t?.gizmo.id),loading:U,disabled:J.length>0||!oe(b,s.sharingTargets),children:d?e.jsx(c,{id:"BEKjVh",defaultMessage:"Save"}):e.jsx(c,{id:"24j5ts",defaultMessage:"Update"})}),secondaryButton:e.jsxs(e.Fragment,{children:[G()&&e.jsx("div",{className:"absolute bottom-8 left-6 text-sm text-token-text-secondary",children:e.jsx(c,{id:"9CkgC4",defaultMessage:"Unsaved changes"})}),t&&e.jsx(de,{color:"secondary",onClick:w=>ze(t,v,w,y.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:e.jsx(c,{id:"wvL15a",defaultMessage:"Copy link"})})]}),title:y.formatMessage({id:"7JggXH",defaultMessage:"Share GPT"}),showCloseButton:!0,children:e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsx(Bo,{onAdd:w=>H(w),publishedGizmo:t}),e.jsx("h3",{className:"text-base font-semibold",children:e.jsx(c,{id:"bNQXcV",defaultMessage:"Share with..."})}),e.jsxs("div",{className:"max-h-[200px] space-y-2 overflow-y-auto",children:[e.jsxs("div",{className:"mb-4 flex flex-row items-center justify-between space-x-3",children:[e.jsx("div",{className:"shrink-0 grow-0 self-start",children:e.jsx(Ia,{user:p,size:"gizmoConversation",roundedStyle:"rounded-full"})}),e.jsx("div",{className:"grow",children:!t||$o(t?.gizmo.author.user_id.split("__")[0],p?.id)?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-base font-semibold",children:e.jsx(c,{id:"U7tzof",defaultMessage:"{userName} (you)",values:{userName:p?.name}})}),e.jsx("span",{className:"-mt-1 text-sm text-token-text-secondary",children:p?.email})]}):e.jsx("span",{className:"text-base font-semibold",children:e.jsx(c,{id:"scRZqV",defaultMessage:"{userName} (builder)",values:{userName:t?.gizmo.author.display_name}})})})]}),N.map((w,A)=>gs(w)&&e.jsxs("div",{className:"mb-4 flex flex-row items-center justify-between space-x-3",children:[e.jsx(Aa,{name:w.type===z.GROUP?w.group_name:`${w.user_name} ${w.user_email}`,initialsCount:w.type===z.USER?2:1,size:"gizmoConversation",className:ie("shrink-0 grow-0",w.type===z.USER&&"self-start")}),e.jsxs("div",{className:"flex grow flex-col",children:[e.jsxs("span",{className:"flex flex-row",children:[e.jsx("span",{className:"mr-2 text-base font-semibold",children:w.type===z.GROUP?w.group_name:w.user_name}),w.type===z.GROUP&&w.is_scim_managed&&e.jsx(ea,{})]}),w.type===z.USER&&e.jsx("span",{className:"-mt-1 text-sm text-token-text-secondary",children:w.user_email})]}),e.jsxs(E.Root,{children:[e.jsxs(E.Trigger,{className:"whitespace-nowrap text-base text-token-text-secondary",children:[e.jsx(c,{...ke(w.capabilities)}),e.jsx(ms,{className:"icon-md"})]}),e.jsx(E.Portal,{children:e.jsxs(E.Content,{className:"max-w-[280px]",children:[Ro.map((Y,ne)=>e.jsx(ns,{caps:Y,selected:je(Y,w.capabilities),onClick:()=>{T(N.map(K=>K===w?{...K,capabilities:Y}:K))}},ne)),e.jsx(E.Separator,{}),e.jsx(E.Item,{onClick:()=>T(N.filter(Y=>Y!==w)),color:"danger",icon:Bt,children:e.jsx(c,{id:"NU0BOB",defaultMessage:"Remove"})})]})})]})]},A))]}),e.jsx("hr",{className:"border-token-border-medium"}),e.jsx("h3",{className:"text-base font-semibold",children:e.jsx(c,{id:"uqD7Y8",defaultMessage:"Access"})}),e.jsxs("div",{className:"-ms-3.5 flex flex-row items-center justify-between space-x-3",children:[e.jsxs(B.Root,{value:b,onValueChange:w=>Z(w),children:[e.jsxs(B.Trigger,{children:[e.jsx(B.Value,{}),e.jsx(B.Icon,{})]}),e.jsx(B.Portal,{children:e.jsxs(B.Content,{children:[e.jsxs(B.Group,{children:[e.jsx(B.Label,{children:e.jsx(c,{id:"YIQwaP",defaultMessage:"Private"})}),e.jsx(B.Item,{value:u.Private,children:e.jsx(Se,{shareLevel:u.Private,workspaceName:f})})]}),e.jsx(B.Separator,{}),e.jsx(ds,{label:y.formatMessage({id:"n0m61x",defaultMessage:"Your workspace has disabled sharing with the workspace."}),side:"bottom",disabled:oe("workspace",s.sharingTargets),children:e.jsxs(B.Group,{children:[e.jsx(B.Label,{children:f}),e.jsx(B.Item,{value:u.WorkspaceLink,disabled:!oe(u.WorkspaceLink,s.sharingTargets)&&!oe(u.Workspace,s.sharingTargets),children:e.jsx(Se,{shareLevel:u.WorkspaceLink,workspaceName:f})}),e.jsx(B.Item,{value:u.Workspace,disabled:!oe("workspace",s.sharingTargets),children:e.jsx(Se,{shareLevel:u.Workspace,workspaceName:f})})]})}),e.jsx(B.Separator,{}),e.jsx(ds,{label:y.formatMessage({id:"IHnort",defaultMessage:"Your workspace has disabled public sharing."}),side:"bottom",disabled:oe("marketplace",s.sharingTargets),children:e.jsxs(B.Group,{children:[e.jsx(B.Label,{children:e.jsx(c,{id:"PjY9bi",defaultMessage:"Public"})}),e.jsx(B.Item,{value:u.Link,disabled:!oe("link",s.sharingTargets),children:e.jsx(Se,{shareLevel:u.Link,workspaceName:f})}),e.jsx(B.Item,{disabled:!oe("marketplace",s.sharingTargets),value:u.Marketplace,children:e.jsx(Se,{shareLevel:u.Marketplace,workspaceName:f})})]})})]})})]}),b!==u.Private&&b!==u.User&&e.jsxs(E.Root,{children:[e.jsxs(E.Trigger,{className:"whitespace-nowrap text-base text-token-text-secondary",children:[se==null?e.jsx(c,{...ke(X)}):e.jsx(c,{...ke(se.capabilities)}),e.jsx(ms,{className:"icon-md"})]}),e.jsx(E.Portal,{children:e.jsxs(E.Content,{className:"max-w-[280px]",children:[e.jsx(ns,{onClick:()=>_(X),caps:X,selected:je(se?.capabilities,X)}),b!==u.Marketplace&&b!==u.Link&&e.jsx(ns,{onClick:()=>_($e),caps:$e,selected:je(se?.capabilities,$e)})]})})]})]}),ee&&e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(c,{id:"/iw1Iv",defaultMessage:"Public actions require valid privacy policy URLs. Click <fixlink>here</fixlink> to update.",values:{fixlink:w=>e.jsx("button",{onClick:()=>{r($?.metadata.action_id),l()},className:"underline",children:w})}})}),(b===u.Marketplace||b===u.Workspace)&&(oe(b,s.sharingTargets)?e.jsx(Ns,{gizmo:s,category:j?.id,categories:x.data?.categories,onCategoryChange:w=>M(w)}):is(b,s.sharingTargets)?e.jsx("div",{className:"pb-2 text-xs text-red-500",children:e.jsx(Yt,{sharingRecipient:b,moderatedFields:_s(b,s.sharingTargets)??[],appealAvailable:!0})}):e.jsx("div",{className:"pb-2 text-xs text-red-500",children:e.jsx(c,{id:"BzqqKH",defaultMessage:"Your workspace's settings don't allow this level of access. An owner of the workspace can change this setting in the workspace's GPTs settings."})}))]})})}const ta=xe({private:{id:"pSXBWQ",defaultMessage:"Invite-only"},user:{id:"pSXBWQ",defaultMessage:"Invite-only"},group:{id:"pSXBWQ",defaultMessage:"Invite-only"},workspace_link:{id:"Giaxt1",defaultMessage:"Anyone at {workspaceName} with the link"},workspace:{id:"XLHaTU",defaultMessage:"{workspaceName}"},link:{id:"uP1+Ri",defaultMessage:"Anyone with the link"},marketplace:{id:"82Ilac",defaultMessage:"GPT Store"}}),Oo=xe({workspace:{id:"1kpopF",defaultMessage:"Published to {workspaceName}"},marketplace:{id:"hdTRpJ",defaultMessage:"Published to GPT Store"}});function ke(s){return s.can_write?O({id:"SubCqD",defaultMessage:"Can edit"}):s.can_view_config?O({id:"ud3lp4",defaultMessage:"Can view configuration"}):s.can_read?O({id:"/0j34W",defaultMessage:"Can chat"}):O({id:"x2E8ET",defaultMessage:"Unknown"})}function ns({caps:s,selected:t,onClick:a}){let i=hi;return s.can_view_config?i=vi:s.can_read&&(i=yi),e.jsx(E.Item,{className:"flex h-auto flex-row items-start space-x-3 px-3 py-3",onClick:a,icon:i,children:s.can_write?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex grow flex-col",children:e.jsx("span",{className:"text-base font-semibold leading-tight",children:e.jsx(c,{...ke(s)})})}),e.jsx(We,{className:ie("icon-lg shrink-0",!t&&"invisible")})]}):s.can_view_config?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex grow flex-col",children:[e.jsx("span",{className:"align-baseline text-base font-semibold leading-tight",children:e.jsx(c,{...ke(s)})}),e.jsx("span",{className:"text-xs text-token-text-secondary",children:e.jsx(c,{id:"fL1rWw",defaultMessage:"View configuration settings, duplicate, and chat"})})]}),e.jsx(We,{className:ie("icon-lg shrink-0",!t&&"invisible")})]}):s.can_read?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex grow flex-col",children:[e.jsx("span",{className:"text-base font-semibold leading-tight",children:e.jsx(c,{...ke(s)})}),e.jsx("span",{className:"text-xs text-token-text-secondary",children:e.jsx(c,{id:"tx5q1o",defaultMessage:"Users can only chat with this GPT"})})]}),e.jsx(We,{className:ie("icon-lg shrink-0",!t&&"invisible")})]}):null})}const Ve={private:ts,user:ts,group:ts,workspace_link:He,workspace:$t,link:He,marketplace:Wt};function Se({shareLevel:s,workspaceName:t,hasInviteSharing:a=!0}){(s===u.User||s===u.Group)&&(s=u.Private);const i=Ve[s];return e.jsxs("div",{className:"flex flex-row items-center gap-3 text-base",children:[e.jsx(i,{className:"icon-lg"}),e.jsx("div",{className:"line-clamp-1 pt-px text-start font-semibold",children:!a&&s===u.Private?e.jsx(c,{id:"vVJhYB",defaultMessage:"Only me"}):e.jsx(c,{...ta[s],values:{workspaceName:t}})})]})}function aa({publishedGizmo:s,sharing:t,workspaceName:a,onClose:i}){const n=t.recipient,o=Ve[n],r=V(),d=ge();return e.jsxs(le,{isOpen:!0,onClose:i,showCloseButton:!0,className:"w-[304px]",title:e.jsx(c,{id:"5CEceY",defaultMessage:"GPT Updated"}),primaryButton:e.jsx(de,{onClick:()=>{window.location.href=`/g/${s.gizmo.id}`},children:e.jsx(c,{id:"RF75o5",defaultMessage:"View GPT"})}),secondaryButton:e.jsx(de,{color:"secondary",onClick:l=>ze(s,d,l,r.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:e.jsx(c,{id:"9hLOl9",defaultMessage:"Copy link"})}),type:"success",children:[e.jsx(Ns,{gizmo:{profilePictureUrl:s.gizmo.display.profile_picture_url??void 0,name:s.gizmo.display.name}}),t.subjects.filter(l=>gs(l)).length>0&&e.jsxs("div",{className:"my-4",children:[e.jsx("h4",{className:"text-xs font-semibold text-token-text-secondary",children:e.jsx(c,{id:"/paYH9",defaultMessage:"Shared with"})}),t.subjects&&t.subjects.map((l,m)=>gs(l)&&e.jsxs("div",{className:"flex flex-row items-center justify-between space-x-3 py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-base font-semibold",children:l.type===z.GROUP?l.group_name:l.user_name}),l.type===z.USER&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{className:"text-sm text-token-text-secondary",children:l.user_email})]})]}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(c,{...ke(l.capabilities)})})]},m))]}),e.jsxs("div",{className:"my-4",children:[e.jsx("h4",{className:"text-xs font-semibold text-token-text-secondary",children:e.jsx(c,{id:"q9XNZ7",defaultMessage:"Access"})}),e.jsxs("div",{className:"ml-[3px] flex flex-row items-center py-3 text-left text-base font-semibold",children:[e.jsx(o,{className:"md:icon-lg mr-3 h-6 w-6 shrink-0"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(c,{...Oo[n]??ta[n],values:{workspaceName:a}})}),(n===u.Workspace||n===u.Marketplace)&&e.jsx("span",{className:"text-xs text-token-text-secondary"})]})]})]})]})}function Ns({gizmo:s,category:t,categories:a,onCategoryChange:i}){const{data:n,isLoading:o}=Et(),r=a?.find(d=>d.id===t);return e.jsxs("div",{children:[e.jsxs("div",{className:ie("mb-[1px] flex flex-row items-center space-x-2 bg-token-main-surface-secondary p-4",o&&"invisible",a?"rounded-t-lg":"rounded-lg"),children:[e.jsx(Ts,{isFirstParty:!1,className:"h-11 w-11",src:s.profilePictureUrl}),e.jsxs("div",{className:"flex grow flex-col space-y-0",children:[e.jsx("span",{className:"text-base font-semibold",children:s.name}),e.jsx(pi,{builderName:n?.display_name,builderUrl:n?.website_url,socials:[n?.socials.linkedin,n?.socials.github,n?.socials.twitter].filter(d=>d!=null),className:"text-xs text-token-text-secondary"})]})]}),a&&e.jsxs("div",{className:"flex min-h-[56px] flex-row items-center justify-between space-x-2 rounded-b-lg bg-token-main-surface-secondary px-4 text-base",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(c,{id:"JcA4/t",defaultMessage:"Category"})}),e.jsx("div",{className:"text-token-text-secondary",children:i?e.jsx(Ss,{size:"small",triggerButton:e.jsxs("button",{className:"flex items-center gap-1",children:[r?.title,e.jsx(ms,{className:"icon-md"})]}),children:a.map((d,l)=>e.jsx(E.Item,{onClick:()=>i(d),children:d.title},l))}):e.jsx("span",{className:"text-token-text-secondary",children:r?.title})})]})]})}const Qs=Ge.li`flex flex-col rounded-sm p-1 hover:bg-token-main-surface-secondary`;function Bo({onAdd:s,publishedGizmo:t}){const a=V(),i=Ce(),[n,o]=h.useState(""),d=La(i?.id,0,n,5).data?.items.filter(p=>p.id!==t?.gizmo.author.user_id.split("__")[0]),{data:l}=Ma({queryKey:[i?.id,"groups","filtered",n],queryFn:()=>Re.getWorkspaceGroups(i.id,{query:n,orderby:"@score"}),enabled:n.trim()!==""&&i!=null&&!!i.getWorkspaceId()}),m=(d?.length??0)>0||(l?.items.length??0)>0,[y,v]=h.useState(!1);function g(p,x,j){s({type:z.GROUP,group_id:p,group_name:x,capabilities:{...X},is_scim_managed:j}),o("")}function f(p,x,j){i&&(s({type:z.USER,user_id:p+"__"+i.getWorkspaceId(),user_name:x,user_email:j,capabilities:{...X}}),o(""))}return e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex w-full flex-row space-x-3",children:e.jsxs(Rs,{as:"div",className:"group relative z-10 grow",children:[e.jsx(Ga,{list:"suggested-choices",name:"share-with-input",placeholder:i?.isEnterprisey()?a.formatMessage({id:"xy/AMO",defaultMessage:"Add people and groups from your workspace"}):a.formatMessage({id:"Lh9njB",defaultMessage:"Add people from your workspace"}),value:n,onChange:p=>o(p.target.value),onFocus:()=>v(!0),onBlur:()=>v(!1)}),e.jsx(Ii,{show:n.trim()!==""&&m&&y,children:e.jsx(Rs.Panel,{static:!0,className:"absolute top-8 ml-0 w-full cursor-pointer overflow-y-auto rounded-lg rounded-t-none border border-t-0 border-token-border-light bg-token-main-surface-primary px-1 py-1 group-has-[:focus]:border-token-border-xheavy",children:n.trim()!==""&&e.jsxs("ul",{id:"suggested-choices",children:[d&&d.map(p=>e.jsxs(Qs,{tabIndex:0,className:"rounded-sm p-1 text-sm hover:bg-token-main-surface-secondary",onClick:()=>f(p.id,p.name,p.email??""),children:[e.jsx("span",{className:"w-full font-semibold",children:p.name}),e.jsx("span",{className:"text-sm text-token-text-secondary",children:p.email})]},p.id)),l?.items&&l.items.slice(0,5).map(p=>e.jsx(Qs,{tabIndex:0,onClick:()=>g(p.id,p.name,p.is_scim_managed??!1),children:e.jsxs("span",{className:"flex flex-col",children:[e.jsxs("span",{className:"flex flex-row",children:[e.jsx("span",{className:"mr-2 font-semibold",children:p.name}),p.is_scim_managed&&e.jsx(ea,{})]}),e.jsx("span",{className:"text-sm text-token-text-secondary",children:e.jsx(c,{id:"r3Rx6X",defaultMessage:"{numMembers, plural, one {1 member} other {# members}}",values:{numMembers:p.num_members}})})]})},p.id))]})})})]})})})}function $o(s,t){return s===void 0||t===void 0?!1:s.split("__")[0]===t.split("__")[0]}function Wo({gizmo:s,updateGizmo:t,publishedGizmo:a,promoteGizmo:i,appealGizmo:n,setAppealState:o,showActionsModal:r,shareOnly:d,onClose:l}){const[m,y]=h.useState({type:"privacy"});return m.type==="privacy"?e.jsx(qo,{gizmo:s,updateGizmo:t,publishedGizmo:a,promoteGizmo:i,appealGizmo:n,setAppealState:o,setStep:y,showActionsModal:r,shareOnly:d,onClose:l}):e.jsx(Ho,{publishedGizmo:m.publishedGizmo,onClose:l})}function Do(s){return s?u.Workspace:u.Link}function qo({gizmo:s,publishedGizmo:t,updateGizmo:a,promoteGizmo:i,appealGizmo:n,setAppealState:o,setStep:r,showActionsModal:d,shareOnly:l,onClose:m}){const[y,v]=h.useState(!1),g=qe(St.isBusinessWorkspace),f=V(),p=ge(),[x,j]=h.useState(Ms(s)?Do(!!g):s.sharingRecipient),M=Ue(),b=oe(x,s.sharingTargets),{data:P,isLoading:N}=Et(),T=zt(),[k,I]=h.useState(t!=null&&t.gizmo.display.categories.length>0?T.data?.categories.find(_=>_.id===t.gizmo.display.categories[0])?.id:void 0);h.useEffect(()=>{I(t?.gizmo.display.categories[0])},[t?.gizmo.display.categories]);const[U,Q]=h.useState(void 0),G=h.useRef(Ua((_,W)=>Ne.generateCategory(_,W),1e3)),F=P?.is_verified?void 0:f.formatMessage({id:"qEQtmt",defaultMessage:"To publish your GPTs to the Explore GPTs page, set up your builder profile."});x===u.Marketplace&&F!=null&&!N&&j(u.Link);const J=g&&!s.sharingTargets?.some(_=>_.recipient===u.Link),ee=Ee(s,x,k),$=ee.includes(ue.MissingPublicActionPrivacyPolicyURL),H=s.tools.find(_=>_.type===te.JIT_PLUGIN&&!_.metadata.privacy_policy_url),se=qe(_=>_.currentWorkspace),he=lt();h.useEffect(()=>{let _=!0;return(async()=>{try{if(k!=null)return;const W=await G.current(s.name,s.instructions);_&&k==null&&(W?I(W.id):Q(!0))}catch{_&&k==null&&Q(!0)}})(),()=>{_=!1}},[s.instructions,s.name,he,k]);const{value:Z}=vs("4226692983");return e.jsx(le,{type:"success",isOpen:!0,onClose:m,title:e.jsx(c,{id:"9viumf",defaultMessage:"Share GPT"}),showCloseButton:!0,primaryButton:b?e.jsx(de,{color:"primary",disabled:ee.length>0,loading:y,onClick:async()=>{try{if(v(!0),l){if(!t?.gizmo.id){p.danger(f.formatMessage({id:"QYVEx8",defaultMessage:"Error sharing GPT"}));return}const _=await Ne.shareGizmo(t.gizmo.id,k?{sharing:Ae(x,[],X),categories:[k]}:{sharing:Ae(x,[],X)});_.error?(p.warning(f.formatMessage({id:"tmIKmp",defaultMessage:"Unable to share GPT"})),a({sharingTargets:_.sharing_targets}),o({gizmoId:t.gizmo.id,sharingRecipient:x,categories:t.gizmo.display.categories,moderationType:Xe.PublishBlocked,sharingTargets:_.sharing_targets,showModal:be.AppealAvailable})):(M.setQueryData(["gizmo",{gizmoId:t.gizmo.id},{draft:!1}],W=>_.resource),a(W=>({...W,sharingRecipient:x})),p.success(f.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),m())}else{const _=await i({recipient:x,subjects:Ae(x,[],X)},k);_?(r({type:"published",publishedGizmo:_}),a(W=>({...W,id:_.gizmo.id,sharingRecipient:x})),_.gizmo.live_version!=null&&a({liveVersion:_.gizmo.live_version}),p.success(f.formatMessage({id:"R5zko1",defaultMessage:"GPT published"}),{testId:"gpt-published-toast"})):(p.warning(f.formatMessage({id:"uf7WYw",defaultMessage:"Unable to publish GPT"})),m())}}finally{v(!1)}},"data-testid":"save-gizmo-button",children:e.jsx(c,{id:"SW4DG4",defaultMessage:"Save"})}):Z?e.jsx(e.Fragment,{children:e.jsx(de,{color:"primary",onClick:async()=>{await n(x,k)},children:e.jsx(c,{id:"bBmLUr",defaultMessage:"Appeal"})})}):null,secondaryButton:t?e.jsx(de,{color:"secondary",onClick:_=>ze(t,p,_,f.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:e.jsx(c,{id:"wvL15a",defaultMessage:"Copy link"})}):null,children:e.jsxs("div",{className:"mx-[-16px] flex flex-col gap-3 text-sm",children:[e.jsx("div",{className:"space-y-1.5",children:e.jsxs(_t,{value:x,onValueChange:_=>j(_),children:[s.sharingTargets&&s.sharingTargets.map((_,W)=>e.jsx(rs,{value:_.recipient,disabled:_.recipient===u.Marketplace&&F!=null,tooltipText:_.recipient===u.Marketplace?F??f.formatMessage({id:"0Rcb4e",defaultMessage:"Your GPT will appear in the Explore GPTs page"}):void 0,shareLevel:_.recipient},W)),J&&e.jsxs(e.Fragment,{children:[e.jsx(rs,{value:u.Link,disabled:!0,tooltipText:f.formatMessage(Ys.workspaceDisabledHint),shareLevel:u.Link,workspaceName:se?.name}),e.jsx(rs,{value:u.Link,disabled:!0,tooltipText:f.formatMessage(Ys.workspaceDisabledHint),shareLevel:u.Marketplace,workspaceName:se?.name})]})]})}),$&&e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(c,{id:"/iw1Iv",defaultMessage:"Public actions require valid privacy policy URLs. Click <fixlink>here</fixlink> to update.",values:{fixlink:_=>e.jsx("button",{onClick:()=>{d(H?.metadata.action_id)},className:"underline",children:_})}})}),x!==u.Private&&e.jsx(Ns,{gizmo:s,category:k,categories:x===u.Marketplace?T.data?.categories??[]:void 0,onCategoryChange:x===u.Marketplace?_=>I(_.id):void 0}),x===u.Marketplace&&(U?e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(c,{id:"tpC3ui",defaultMessage:"There was an error updating the list of categories"})}):null),!b&&Z&&e.jsx("div",{className:"flex items-center justify-between text-sm text-token-text-secondary",children:e.jsx(c,{id:"jLCMMV",defaultMessage:"Because this GPT previously may have violated our policies, you will have to submit an appeal to make it available at this level."})})]})})}function Ho({publishedGizmo:s,onClose:t}){const a=Ai(s),i=V(),n=ge();return e.jsx(le,{type:"success",isOpen:!0,onClose:t,title:e.jsx(c,{id:"rCRRmx",defaultMessage:"Settings Saved"}),showCloseButton:!0,primaryButton:e.jsx(de,{color:"primary",as:"link",to:a,children:e.jsx(c,{id:"lyZz44",defaultMessage:"View GPT"})}),children:e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex gap-1 rounded bg-token-main-surface-secondary px-2 py-1",children:[e.jsx("div",{className:"line-clamp-1 text-ellipsis break-all",children:a}),e.jsx("button",{onClick:o=>{ze(s,n,o,i.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"}))},className:"text-token-text-secondary transition hover:text-token-text-primary","data-testid":"copy-saved-gpt-url-button",children:e.jsx(Dt,{className:"icon-sm"})})]})})})}const Ys=xe({workspaceDisabledHint:{id:"gizmo.workspaceDisabledHint",defaultMessage:"Your workspace administrator has disabled this setting"}});function rs({shareLevel:s,workspaceName:t,value:a,disabled:i=!1,tooltipText:n}){const o=h.useId();return e.jsx(ds,{disabled:n==null,label:n,side:"top",children:e.jsxs(Pt,{id:o,value:a,disabled:i,className:"flex h-14 w-full cursor-pointer flex-row items-center justify-between gap-2 rounded-md px-3 py-4 font-semibold hover:bg-token-main-surface-secondary",children:[e.jsx("label",{htmlFor:o,className:"flex cursor-pointer items-center gap-1",children:e.jsx(Se,{shareLevel:s,workspaceName:t??"",hasInviteSharing:!1})}),e.jsx(Ra,{children:e.jsx(We,{className:"icon-lg mr-1"})})]})})}function ia(s){window.history.length>1?s(-1):s(ai())}function Ko({gizmo:s,publishedGizmo:t,isLoading:a,isUploadingProfilePic:i,isGeneratingProfilePic:n,updateGizmo:o,promoteGizmo:r,appealGizmo:d,setAppealState:l,showActionsModal:m}){const y=Ce(),v=s!=null?Ee(s):[];(s==null||a)&&v.push(ue.Loading),i&&v.push(ue.UploadingProfilePic),n&&v.push(ue.GeneratingProfilePic);const g=Ms(s),[f,p]=h.useState(!1),[x,j]=h.useState(!1),M=s.sharingRecipient?Ve[s.sharingRecipient]:Ve.private;return e.jsxs(e.Fragment,{children:[g?e.jsx(we,{color:"primary",onClick:()=>p("promote"),loading:a,disabled:s.id===void 0||v.length>0,tooltip:v.length>0?v.map(xs).join(`
`):void 0,testId:"gizmo-editor-create-gpt-button",children:e.jsx(c,{id:"svUGIb",defaultMessage:"Create"})}):e.jsxs(e.Fragment,{children:[e.jsxs(we,{color:"secondary",loading:a||!t,onClick:()=>p("share"),children:[e.jsx(M,{className:"icon-sm shrink-0"}),e.jsx(c,{id:"aXKW4G",defaultMessage:"Share"})]}),e.jsx(we,{color:"primary",onClick:async()=>{let b=s.sharing.subjects.map(sa);const P=Tt(s.sharing.subjects);b=Ae(s.sharing.recipient,b,P?.capabilities??X),await r({recipient:s.sharing.recipient,subjects:b},t?.gizmo.display.categories[0])&&j(!0)},loading:a||!t,disabled:v.length>0,tooltip:v.length>0?v.map(xs).join(`
`):void 0,children:e.jsx(c,{id:"84QVoj",defaultMessage:"Update"})})]}),f&&(y?.getWorkspaceId()==null?e.jsx(Wo,{gizmo:s,publishedGizmo:t,promoteGizmo:r,appealGizmo:d,setAppealState:l,showActionsModal:m,updateGizmo:o,shareOnly:f==="share",onClose:()=>p(!1)}):e.jsx(Fo,{gizmo:s,publishedGizmo:t,promoteGizmo:r,appealGizmo:d,setAppealState:l,showActionsModal:m,updateGizmo:o,onClose:()=>p(!1),shareOnly:f==="share"})),x&&e.jsx(aa,{publishedGizmo:t,sharing:t.gizmo.sharing,onClose:()=>j(!1),workspaceName:y?.data.name??""})]})}function Vo({gizmoEditorData:s,publishedGizmo:t,revertDraft:a}){const i=V(),n=ge(),o=js(),[r,d]=h.useState(!1),l=lt(),{value:m}=vs("3645668434");return!l?.includes("debug")&&s?.id==null?null:e.jsxs(e.Fragment,{children:[e.jsxs(Ss,{side:"top",contentAlign:"end",sideOffset:8,triggerButton:e.jsx(we,{color:"ghost",icon:ji}),children:[t!=null&&e.jsxs(E.Item,{onClick:y=>{ze(t,n,y)},children:[e.jsx(He,{className:"icon-sm"}),e.jsx(c,{...fe.copyLink})]}),a!=null&&e.jsxs(E.Item,{onClick:()=>{window.confirm(i.formatMessage(fe.revertConfirm))&&a()},children:[e.jsx(bi,{className:"icon-sm"}),e.jsx(c,{id:"W2blnV",defaultMessage:"Revert..."})]}),s?.id!=null&&m&&s.liveVersion>0&&e.jsxs(e.Fragment,{children:[e.jsxs(E.Item,{onClick:()=>{o(`/g/${s.id}/view`)},children:[e.jsx(wi,{className:"icon-sm"}),e.jsx(c,{id:"gizmo.versionHistory",defaultMessage:"Version History"})]}),e.jsxs(E.Item,{onClick:async()=>{const y=await Ne.copyGizmo({gizmoId:s.id});y.gizmo.id&&o(`/gpts/editor/${y.gizmo.id}`)},children:[e.jsx(Dt,{className:"icon-sm"}),e.jsx(c,{id:"GizmoInformation.copyGizmoLabel",defaultMessage:"Duplicate GPT"})]})]}),s?.id!=null&&e.jsxs(E.Item,{color:"danger",onClick:()=>{d(!0)},children:[e.jsx(Bt,{className:"icon-sm"}),e.jsx(c,{id:"tNrOLG",defaultMessage:"Delete GPT"})]}),l?.includes("debug")&&e.jsxs(e.Fragment,{children:[e.jsx(E.Separator,{}),e.jsxs(E.Item,{onClick:()=>{Le.toggleActiveSidebar("debug")},children:[e.jsx(ki,{className:"icon-sm"}),"Debug (Internal only)"]})]})]}),r&&e.jsx(xi,{gizmoId:s.id,onSuccess:()=>ia(o),onClose:()=>{d(!1)}})]})}const Fe=Ge.div`flex items-center gap-1`;function Qo({gizmoEditorData:s}){const t=qe(a=>a.currentWorkspace?.name);switch(s.sharingRecipient){case u.Private:return e.jsxs(Fe,{children:[e.jsx(Mi,{className:"icon-xs"}),e.jsx(c,{...fe.onlyMe})]});case u.Link:return e.jsxs(Fe,{children:[e.jsx(He,{className:"icon-xs"}),e.jsx(c,{...fe.anyoneWithLink})]});case u.Workspace:return e.jsxs(Fe,{children:[e.jsx($t,{className:"icon-xs"}),t]});case u.Marketplace:return e.jsxs(Fe,{children:[e.jsx(Wt,{className:"icon-xs"}),e.jsx(c,{...fe.public})]});default:return e.jsx("div",{})}}function Yo({gizmoEditorData:s}){return e.jsxs("div",{className:"flex items-center gap-2",children:[s.profilePictureUrl!=null?e.jsx(Ts,{isFirstParty:!1,src:s.profilePictureUrl,className:"h-8 w-8"}):e.jsx("div",{className:"h-8 w-8 rounded-full border-2 border-dashed border-token-border-medium"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:s.name||e.jsx(c,{...fe.newGPT})}),e.jsx("div",{className:"text-xs text-token-text-secondary",children:Ms(s)?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-token-text-tertiary"}),e.jsx(c,{...fe.draft})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-brand-green"}),s.sharingRecipient===u.Marketplace?e.jsx(c,{...fe.published}):e.jsx(c,{id:"gizmoEditorHeader.live",defaultMessage:"Live"})," · ",e.jsx(Qo,{gizmoEditorData:s})]})})]})]})}function Xo({gizmoEditorData:s,isLoading:t,isUploadingProfilePic:a,isGeneratingProfilePic:i,publishedGizmo:n,updateGizmo:o,promoteGizmo:r,appealGizmo:d,setAppealState:l,revertDraft:m,draftMessage:y,className:v,hasUnpublishedChanges:g,showActionsModal:f}){const p=js();return e.jsxs("div",{className:ie("relative flex h-14 w-full items-center justify-between gap-2 border-b border-token-border-medium px-3",v),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{className:"cursor-pointer text-token-text-primary",onClick:()=>ia(p),children:e.jsx(za,{className:"icon-lg"})}),e.jsx(Yo,{gizmoEditorData:s})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[y,e.jsx(Vo,{gizmoEditorData:s,publishedGizmo:n,revertDraft:m}),e.jsx(Ko,{gizmo:s,publishedGizmo:n,isLoading:t,isUploadingProfilePic:a,isGeneratingProfilePic:i,updateGizmo:o,promoteGizmo:r,appealGizmo:d,setAppealState:l,hasUnpublishedChanges:g,showActionsModal:f})]})]})}const fe=xe({onlyMe:{id:"gizmo.onlyMe",defaultMessage:"Only me"},anyoneWithLink:{id:"gizmo.anyoneWithLink",defaultMessage:"Anyone with a link"},public:{id:"gizmo.public",defaultMessage:"Everyone"},newGPT:{id:"gizmo.newGPT",defaultMessage:"New GPT"},draft:{id:"gizmo.draft",defaultMessage:"Draft"},published:{id:"gizmo.published",defaultMessage:"Published"},revertConfirm:{id:"gizmo.revertConfirm",defaultMessage:"Are you sure you want to revert to the last saved version?"},copyLink:{id:"gizmo.copyLink",defaultMessage:"Copy link"}}),Jo=512;function Zo(){return e.jsx("div",{className:"relative flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-token-border-medium",children:e.jsx(bs,{className:"h-1/4 w-1/4"})})}function el({gizmoEditorData:s,onFileChange:t,generateProfilePic:a,isGeneratingProfilePic:i,setIsGeneratingProfilePic:n}){const o=V(),r=ge(),[d,l]=h.useState(void 0),m=h.useRef(t);h.useEffect(()=>{m.current=t});async function y(f){if(f.length>0){n(!1);const p=await $a(f[0],Jo),x=ps(p);l({tempId:x,file:p,status:ae.Uploading,progress:1,fileId:null,cdnUrl:null}),m.current("uploading"),Wa(x,p,o,r,ct.ProfilePicture,{onFileCreated(j,M,b){l(P=>P!=="initial"&&P?.tempId===j&&P.status===ae.Uploading?{...P,progress:10,fileId:M,cdnUrl:b}:P)},onFileUploadProgress(j,M){l(b=>b!=="initial"&&b?.tempId===j&&b.status===ae.Uploading?{...b,progress:M}:b)},onFileUploaded(j,M,b){l(P=>P!=="initial"&&P?.tempId===j?(m.current(P),{...P,status:ae.Ready,progress:100,fileSpec:{name:P.file.name,id:P.fileId,size:P.file.size,...b??{}}}):P)},onError(j){l(M=>{if(M!=="initial"&&M?.tempId===j){m.current(void 0);return}return M})}})}}const{open:v,getInputProps:g}=Nt({disabled:!1,noClick:!0,onDropAccepted:y,onDropRejected:f=>Li(f,o,r,Ea.ProfilePicture),multiple:!0,maxSize:Ct,...It(Fa)});return e.jsxs("div",{className:"flex w-full items-center justify-center gap-4",children:[e.jsxs(Ss,{sideOffset:8,triggerButton:e.jsx("button",{className:"h-20 w-20",children:i?e.jsx(Zo,{}):d!=null&&d!="initial"&&d.status!=ae.Ready?e.jsxs("div",{className:"relative h-full w-full overflow-hidden rounded-full",children:[e.jsx(Oa,{file:d.file}),d.status===ae.Uploading&&d.progress<90?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:e.jsx(Ba,{percentage:d.progress,className:"h-6 w-6"})}):null]}):s?.profilePictureUrl!=null&&s?.profilePictureUrl!==""?e.jsx(Ts,{isFirstParty:!1,src:s.profilePictureUrl}):e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-token-border-medium",children:e.jsx(Ti,{className:"text-4xl"})})}),children:[e.jsx(E.Item,{onClick:v,children:e.jsx(c,{id:"ERQwXg",defaultMessage:"Upload Photo"})}),e.jsx(E.Item,{onClick:a,children:e.jsx(c,{id:"NXAog/",defaultMessage:"Use DALL·E"})})]}),e.jsx("input",{...g()})]})}function sl({gizmoEditorData:s,requireGizmoId:t,currentModelConfig:a,updateGizmo:i}){const n=V(),o=ge(),[r,d]=h.useState(0),l=h.useRef(new Map),m=Da(a,void 0),y=async k=>{dt.logEvent(ut.uploadFile,{client:"web",eventSource:"mouse",intent:"gizmo"});const I=await t();k.length>0&&await Promise.all(k.map(U=>{const Q=ps(U);l.current.set(Q,{tempId:Q,gizmoId:I,file:U,status:ae.Uploading,progress:1,fileId:null,cdnUrl:null}),qa(ps(U),U,n,o,{kind:ct.Gizmo,gizmoId:I},{onFileUploaded:(G,F,J,ee)=>{const $=l.current.get(G);$==null||$.fileId==null||(i(H=>({...H,files:[...H.files??[],{file_id:$.fileId,name:$.file.name,size:$.file.size,type:$.file.type,last_modified:$.file.lastModified,file_size_tokens:ee?.fileTokenSize}]})),l.current.delete(G),d(H=>H+1))},onFileCreated:(G,F,J)=>{l.current.set(G,{tempId:G,gizmoId:I,file:U,status:ae.Uploading,progress:1,...l.current.get(G),fileId:F,cdnUrl:J}),d(ee=>ee+1)},onFileUploadProgress:(G,F)=>{const J=l.current.get(G);J?.status===ae.Uploading&&l.current.set(G,{...J,progress:F}),d(ee=>ee+1)},onError:G=>{l.current.delete(G)}},{usesRetrievalIndex:a!=null&&ss(a,U.type,U.name)===es.Retrieval})}))},{getInputProps:v,open:g}=Nt({disabled:!1,noClick:!0,onDropAccepted:y,multiple:!0,maxSize:Ct,maxFiles:10,...It(m)}),f=s?.files??[];function p(k){return e.jsx(Ls,{onRemoveFileClick:()=>{l.current.delete(k.tempId),d(I=>I+1)},file:k.file,loadingPercentage:k.status===ae.Uploading?k.progress:void 0},k.tempId)}function x(k){return e.jsx(Ls,{file:k.name,fileId:k.file_id,onRemoveFileClick:()=>i(I=>({...I,files:I?.files?.filter(U=>U.file_id!==k.file_id)})),gizmoId:s?.id},k.file_id)}const j=Array.from(l.current.values()).filter(k=>f.every(I=>I.file_id!==k.fileId)),[M,b]=As(j,k=>a!=null&&ss(a,k.file.type,k.file.name)===es.CodeInterpreter),[P,N]=As(f,k=>a!=null&&k.type!=null&&ss(a,k.type,k.name)===es.CodeInterpreter),T=h.useRef(P.length);return h.useEffect(()=>{P.length>T.current&&i(k=>k.tools?.some(I=>I.type===te.PYTHON)?k:{...k,tools:[...k.tools??[],{type:te.PYTHON}]}),T.current=P.length},[P.length]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"rounded-lg text-token-text-tertiary",children:e.jsx(c,{...tl.knowledgeWarning})}),b.length>0||N.length>0?e.jsxs("div",{className:"flex flex-wrap gap-2",children:[b.map(p),N.map(x)]}):null,M.length>0||P.length>0?e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs text-token-text-tertiary",children:e.jsx(c,{id:"i/QurZ",defaultMessage:"The following files are only available for Code Interpreter:"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[M.map(p),P.map(x)]})]}):null,e.jsx("div",{children:e.jsxs(we,{onClick:g,children:[e.jsx("input",{...v()}),e.jsx(c,{id:"sr8Qp/",defaultMessage:"Upload files"})]})})]})}const tl=xe({knowledgeWarning:{id:"gizmo.knowledgeWarning",defaultMessage:"If you upload files under Knowledge, conversations with your GPT may include file contents. Files can be downloaded when Code Interpreter is enabled"}});function al({placeholder:s,text:t,onChange:a,onClose:i}){return e.jsx(le,{className:"!max-h-[100vh] !max-w-[80vw]",type:"success",isOpen:!0,onClose:i,primaryButton:e.jsx(we,{onClick:i,children:e.jsx(c,{id:"FeFVdS",defaultMessage:"Close"})}),children:e.jsx("textarea",{className:"h-[70vh] w-full resize-none rounded-lg bg-token-main-surface-primary dark:border-gray-700",value:t,onChange:n=>{a(n.target.value)},placeholder:s})})}const os=Ge.div`text-sm text-red-500`;function il({children:s,collapsed:t,initial:a}){return e.jsx(Ka,{initial:a,children:!t&&e.jsx(Vt.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:s})})}function nl({gizmo:s,onShowActionsEditor:t,isDisabled:a}){const i=V(),n=ge(),o=e.jsxs("div",{className:"space-y-1",children:[s?.tools?.map((r,d)=>r.type!==te.JIT_PLUGIN?null:e.jsxs("div",{children:[e.jsx(Ei,{isDisabled:a,actionTool:r,onShowActionsEditor:()=>t(r.metadata.domain)}),r.metadata.auth?.type==="oauth"&&e.jsx(Va,{label:i.formatMessage(q.callbackUrlLabel),value:`https://chat.openai.com/aip/${r.metadata.action_id}/oauth/callback`,onCopied:()=>{n.success("Copied to clipboard",{duration:3})}})]},d)),(s?.tools?.filter(r=>r.type===te.JIT_PLUGIN)??[]).length>=Gs?e.jsx("div",{children:i.formatMessage(q.maxActionsReached,{number:Gs})}):e.jsx(we,{disabled:a,onClick:()=>{t("Unknown domain")},className:"mt-2",children:e.jsx(c,{...q.createActionLabel})})]});return a?e.jsx(pt,{side:"top",label:i.formatMessage(q.disabledCustomActionsTooltip),children:o}):o}function rl(s){return(s.files?.length??0)>0||s?.tools?.some(t=>t.type===te.JIT_PLUGIN)}const ol=12;function ll({gizmoEditorData:s,updateGizmo:t,currentModelConfig:a,generateProfilePic:i,setIsUploadingProfilePic:n,isGeneratingProfilePic:o,setIsGeneratingProfilePic:r,requireGizmoId:d,onShowActionsEditor:l}){const m=s?.tools??[],[y,v]=h.useState(!1),[g,f]=h.useState(!0),p=s?.promptStarters??[],x=[...p,...p.length<ol?[""]:[]],j=Ee(s),b=Ce()?.isWorkspaceAccount(),P=At(gt.WorkspaceGPTCustomActions),N=V();return e.jsxs("div",{className:"flex h-full grow flex-col overflow-y-auto px-2 pt-6 text-sm",children:[e.jsxs("div",{className:"grow",children:[e.jsxs(pe,{children:[e.jsx(el,{gizmoEditorData:s,generateProfilePic:i,isGeneratingProfilePic:o,setIsGeneratingProfilePic:r,onFileChange:async T=>{if(T!=null&&T!=="uploading"&&T.fileId!=null){const k=await Re.getFileDownloadLink(T.fileId);k.status===ws.Success&&t({profilePictureId:T.fileId!=null?T.fileId:void 0,profilePictureUrl:k.download_url})}else t({profilePictureId:void 0,profilePictureUrl:void 0});n(T==="uploading")}}),e.jsx(me,{label:e.jsx(c,{id:"M4dZms",defaultMessage:"Name"}),description:e.jsx(c,{id:"+Gkni2",defaultMessage:"The name of your GPT"})}),e.jsx(as,{type:"text",placeholder:N.formatMessage(q.gptNamePlaceholder),value:s?.name??"",onChange:T=>{t({name:T.target.value})},onBlurCapture:()=>t(T=>({...T,name:T.name.trim()})),"data-testid":"gizmo-name-input"}),j.includes(ue.GizmoNameTooLong)?e.jsx(os,{className:"mt-1",children:e.jsx(c,{...q.nameTooLong,values:{length:bt}})}):null]}),e.jsxs(pe,{className:"mt-4",children:[e.jsx(me,{label:e.jsx(c,{id:"YDzNvf",defaultMessage:"Description"}),description:e.jsx(c,{id:"dpxCw8",defaultMessage:"Short description of what this GPT does"})}),e.jsx(as,{type:"text",placeholder:N.formatMessage(q.descriptionPlaceholder),value:s?.description??"",onChange:T=>t({description:T.target.value}),onBlurCapture:()=>t(T=>({...T,description:T.description?.trim()??""})),"data-testid":"gizmo-description-input"}),j.includes(ue.GizmoDescriptionTooLong)?e.jsx(os,{className:"mt-1",children:e.jsx(c,{...q.descriptionTooLong,values:{length:wt}})}):null]}),e.jsxs(pe,{children:[e.jsx(me,{label:e.jsx(c,{id:"2SO0RJ",defaultMessage:"Instructions"}),description:N.formatMessage(q.instructionsSubtitle)}),e.jsxs("div",{className:"relative",children:[e.jsx(Ri,{className:"resize-none",rows:8,value:s?.instructions,onChange:T=>t({instructions:T.target.value}),onBlurCapture:()=>t(T=>({...T,instructions:T.instructions.trim()})),placeholder:N.formatMessage(q.instructionsSubtitle),"data-testid":"gizmo-instructions-input"}),e.jsx("button",{className:"absolute bottom-3 right-2 text-token-text-tertiary",onClick:()=>v(!0),children:e.jsx(Si,{className:"icon-sm"})})]}),j.includes(ue.GizmoInstructionsTooLong)?e.jsx(os,{className:"mt-1",children:e.jsx(c,{...q.instructionsTooLong,values:{length:kt}})}):null]}),e.jsxs(pe,{children:[e.jsx(me,{label:e.jsx(c,{id:"6rfYOX",defaultMessage:"Conversation starters"}),description:e.jsx(c,{id:"OSOIpd",defaultMessage:"Examples for the user to start the conversation"})}),e.jsx("div",{className:"flex flex-col gap-1",children:x.map((T,k)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(as,{className:"rounded-r-none",value:T,type:"text",onChange:I=>{const U=I.target.value;t(Q=>({...Q,promptStarters:ks(k>=(p.length??0)?[...p??[],U]:p.map((G,F)=>F===k?U===""?void 0:U:G))}))}}),e.jsx("button",{className:"flex h-9 w-9 items-center justify-center rounded-lg rounded-l-none border border-l-0 border-token-border-medium",onClick:()=>t(I=>({...I,promptStarters:p.filter((U,Q)=>Q!==k)})),children:e.jsx(_i,{className:"icon-sm"})})]},k))})]}),e.jsxs(pe,{children:[e.jsx(me,{label:e.jsx(c,{id:"bwXSkU",defaultMessage:"Knowledge"}),description:N.formatMessage(q.knowledgeExplanation)}),e.jsx(sl,{gizmoEditorData:s,requireGizmoId:d,currentModelConfig:a,updateGizmo:t})]}),e.jsxs(pe,{children:[e.jsx(me,{label:e.jsx(c,{id:"mcAwDU",defaultMessage:"Capabilities"}),description:e.jsx(c,{id:"2exQT6",defaultMessage:"Functionality this GPT can use"})}),e.jsx(zi,{enabledTools:m,onEnabledToolsChange:T=>t({tools:T})})]}),e.jsxs(pe,{children:[e.jsx(me,{label:e.jsx(c,{id:"7r7v+u",defaultMessage:"Actions"}),description:e.jsx(c,{id:"fBln7I",defaultMessage:"APIs this GPT can use"})}),e.jsx(nl,{isDisabled:!!(b&&!P),gizmo:s,onShowActionsEditor:l})]}),!b&&rl(s)&&e.jsxs(pe,{children:[e.jsx(me,{label:e.jsx(c,{id:"R3KeU7",defaultMessage:"Additional Settings"}),collapsed:!!g,onClick:()=>{f(T=>!T)}}),e.jsx(il,{collapsed:g,initial:!1,children:e.jsx(Ha,{className:"mx-3 my-1",labelClassName:"w-full cursor-pointer",label:e.jsx(c,{id:"tZgwFW",defaultMessage:"Use conversation data in your GPT to improve our models"}),id:"improve-chatgpt",checked:!s.trainingDisabled,onChange:()=>{t({trainingDisabled:!s.trainingDisabled})}})})]})]}),y&&e.jsx(al,{text:s.instructions??"",onChange:T=>{t({instructions:T})},onClose:()=>v(!1),placeholder:N.formatMessage(q.instructionsSubtitle)})]})}const q=xe({nameTooLong:{id:"gizmo.nameTooLong",defaultMessage:"GPT names cannot be longer than {length} characters."},knowledgeExplanation:{id:"gizmo.knowledgeExplanation",defaultMessage:"Additional files for this GPT to reference."},descriptionTooLong:{id:"gizmo.descriptionTooLong",defaultMessage:"GPT descriptions cannot be longer than {length} characters."},instructionsTooLong:{id:"gizmo.instructionsTooLong",defaultMessage:"GPT instructions cannot be longer than {length} characters."},disabledCustomActionsTooltip:{id:"gizmo.disabledCustomActionsTooltip",defaultMessage:"Custom actions are disabled for your workspace. Contact your admin to enable them."},createActionLabel:{id:"gizmo.createActionLabel",defaultMessage:"Create new action"},maxActionsReached:{id:"gizmo.maxActionsReached",defaultMessage:"GPTs can have a maximum of {number} actions"},descriptionPlaceholder:{id:"gizmo.descriptionPlaceholder",defaultMessage:"Add a short description about what this GPT does"},instructionsSubtitle:{id:"gizmo.instructionsSubtitle",defaultMessage:"What does this GPT do? How does it behave? What should it avoid doing?"},gptNamePlaceholder:{id:"gizmo.gptNamePlaceholder",defaultMessage:"Name your GPT"},callbackUrlLabel:{id:"gizmo.callbackUrlLabel",defaultMessage:"Callback URL"}});function cl(s,t){const a=mt(s);if(!Array.isArray(s.detail))return a;const i=ks(s.detail.map(n=>{if(n.type==="value_error.any_str.max_length")switch(n.loc[1]){case"display":{switch(n.loc[2]){case"name":return t.formatMessage(q.nameTooLong,{length:n.ctx.limit_value});case"description":return t.formatMessage(q.descriptionTooLong,{length:n.ctx.limit_value})}break}case"instructions":return t.formatMessage(q.instructionsTooLong,{length:n.ctx.limit_value})}if(typeof n.msg=="string")return n.msg}));return i.length>0?i.join(`
`):a}function dl({upsertDraftError:s}){const t=V(),a=cl(s,t);return e.jsxs("div",{className:"flex items-center gap-2 text-red-500",children:[e.jsx("div",{children:e.jsx(c,{...na.errorSavingDraft})}),a!=null&&e.jsx(pt,{label:a,children:e.jsx(Pi,{className:"icon-sm"})})]})}function ul({isPublished:s,isSavingDraft:t,hasUnpublishedChanges:a,upsertDraftError:i,className:n}){return i instanceof Ta?e.jsx(dl,{upsertDraftError:i}):a?e.jsxs("div",{className:ie("flex items-center gap-2",n),children:[e.jsx("span",{className:"text-token-text-secondary",children:s?e.jsx(c,{id:"gizmoEditor.draftUnpublished",defaultMessage:"Unpublished changes"}):e.jsx(c,{id:"gizmoEditor.draftPending",defaultMessage:"Updates pending"})}),e.jsx("div",{className:"w-4 text-token-text-tertiary",children:t&&e.jsx(bs,{})})]}):null}const na=xe({errorSavingDraft:{id:"gizmo.errorSavingDraft",defaultMessage:"Error saving draft"}});async function gl(){}function pl({clientThreadId:s}){const t=ui(s),a=Ft(s),i=gi(s,t),n=[...new Array(i).keys()].map(o=>e.jsx(Gi,{isFinalTurn:o===i-1,turnIndex:o,clientThreadId:s,conversationLeafId:t,onChangeItemInView:Oe,onChangeRating:Oe,onRequestMoreCompletions:Oe,onRequestCompletion:gl,currentModelId:a??""},o));return e.jsx(e.Fragment,{children:n})}function Xs({clientThreadIds:s}){return e.jsx(e.Fragment,{children:s.map(t=>e.jsx(pl,{clientThreadId:t},t))})}const ml=Qe(()=>Ye(()=>import("./4vylp69vgeqwcqq1.js"),__vite__mapDeps([4,1,2,3,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40])).then(s=>s.DebugConversationSidebar));function Js(){return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"border-token-border-secondary flex-grow border-b"}),e.jsxs("div",{className:"flex flex-shrink-0 items-center gap-2 px-2 py-6 text-sm text-token-text-tertiary",children:[e.jsx(Ci,{className:"icon-sm"}),e.jsx(c,{id:"qtaMEG",defaultMessage:"GPT updated"})]}),e.jsx("div",{className:"border-token-border-secondary flex-grow border-b"})]})}var fl=(s=>(s.TestGizmoAction="test_gizmo_action",s))(fl||{});const xl=new Qa;function hl({gizmoEditorData:s,isSavingDraft:t,currentModelConfig:a,showTitle:i=!0}){const[n,o]=h.useState(()=>Be()),[r,d]=h.useState([]);h.useEffect(()=>{d(M=>M[M.length-1]===n?M:[...M,n])},[n]);const l=r.slice(0,-1);qt(n,{kind:Me.GizmoTest,gizmo_id:s.id}),h.useEffect(()=>{R.updateConversationMode(n,{kind:Me.GizmoTest,gizmo_id:s.id})},[n,s.id]);const m=s.files?.map(M=>M.file_id).join();h.useEffect(()=>{R.getServerThreadId(n)!=null&&o(Be())},[s.id,s.instructions,s.tools,m,n]);const y=Ot(M=>M.activeSidebar),v=h.useMemo(()=>({gizmoEditorData:s,mode:"test"}),[s]),[g,f]=h.useState(0),p=()=>{f(M=>M-360)},x=s.id,j=vl(n,a);return h.useEffect(()=>Sa(xl,{test_gizmo_action:({rootDomain:M,operationName:b})=>{x&&j(x,M,b)}}),[j,x]),e.jsx(Lt.Provider,{value:v,children:e.jsxs("div",{className:ie("flex h-full w-full",t&&"cursor-wait opacity-80 transition"),children:[e.jsxs("div",{className:"flex grow flex-col",children:[e.jsx("div",{className:"relative mb-2 flex-shrink-0",children:e.jsx("div",{className:"flex justify-center py-1",children:i&&e.jsxs("div",{className:"group flex items-center gap-2 text-lg font-semibold",children:[e.jsx("div",{className:"icon-md"}),e.jsxs("button",{onClick:()=>{p(),d([]),o(Be())},className:"flex items-center gap-2",children:[e.jsx(c,{id:"2u/6Ja",defaultMessage:"Preview"}),e.jsx(Vt.div,{className:"text-token-text-primary",animate:{rotate:g},transition:{duration:.3},children:e.jsx(Ni,{className:"icon-md invisible group-hover:visible"})})]})]})})}),e.jsx("div",{className:ie("relative grow overflow-auto px-2",t&&"pointer-events-none"),children:e.jsx(Kt,{clientThreadId:n,hideHeader:!0,renderEmptyState:e.jsxs("div",{className:"relative h-full w-full",children:[l!=null&&l.length>0&&e.jsx("div",{className:"h-full w-full opacity-20",children:e.jsxs(Ui,{children:[e.jsx(Xs,{clientThreadIds:l}),e.jsx(Js,{})]})}),e.jsx("div",{className:"absolute left-0 top-0 h-full w-full",children:e.jsx(Fi,{gizmo:s,hideOwner:!0,showStarterPrompts:!0})})]}),prependThreadChildren:l.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"opacity-50",children:e.jsx(Xs,{clientThreadIds:l})}),e.jsx(Js,{})]})})})]}),y==="debug"&&e.jsx(ml,{clientThreadId:n,slideOver:!1,onClose:()=>Le.toggleActiveSidebar("debug"),isOpen:!0})]})})}const Zs=ft.memo(hl);function vl(s,t){const a=Ht({clientThreadId:s});return h.useCallback(async(n,o,r)=>{if(!t)return;const d=new Gt,l=R.getThreadCurrentLeafId(s),m=Ie(),y=Ya(o);R.updateTree(s,j=>{j.addNodeToEnd(l,{id:m,children:[],parentId:l,message:{id:m,author:{role:ce.User},content:{content_type:_a.Text,parts:[`Call the ${o} API with the ${r} operation`]},recipient:"all",metadata:{jit_plugin_data:{from_client:{type:"test",operation:r,tool_name:y}}}}})});const v={conversationMode:{kind:Me.GizmoTest,gizmo_id:n}},g=await xt(),[f,p,x]=await Promise.all([ht.getEnforcementToken(g),Ut.getEnforcementToken(g),vt.getEnforcementToken(g)]);a({model:t.id,completionType:yt.Next,parentNodeId:m,metadata:{},focusOnNewCompletion:!0,chatReq:g,arkoseToken:f,turnstileToken:p,proofToken:x,preflightTime:0,completionMetadata:v,turnTracker:d})},[s,a,t])}function yl(s,t){const a=R.getThreadCurrentLeafId(s),i=R.getTree(s),n=[];let o=i.getNodeByIdOrMessageId(a);for(;o!=null&&(t==null||o.id!==t);)n.unshift(o.message),o=o.parentId!==""?i.getNodeByIdOrMessageId(o.parentId):void 0;return n}function jl(s){return s.filter(i=>i.recipient==="gizmo_editor.update_behavior").flatMap(i=>i.content.content_type==="text"?i.content.parts:i.content.content_type==="code"?[i.content.text]:[]).map(i=>JSON.parse(i)).reduce((i,n)=>({...i,...n}),{})}async function bl(s){let t;for(const a of s)if(a.author.name==="gizmo_editor.generate_profile_pic"){const i=Xa.getImageAssetPointers(a);i.length>0&&(t=i.at(-1))}if(t!=null){const a=Ja(t.asset_pointer),i=await Re.getFileDownloadLink(a);if(i.status===ws.Success)return{id:a,permalink:i.download_url}}}async function wl(s,t,a,i){const n=yl(t,i),o=jl(n);let r=await bl(n);if(fs(o)&&r==null)return;const{name:d,context:l,description:m,profile_pic_file_id:y,prompt_starters:v}=o;if(y!=null)try{const f=await Re.getFileDownloadLink(y,s.id);f.status===ws.Success&&(r={id:y,permalink:f.download_url})}catch(f){us.addError(new Error("Error while retrieving profile pic in update",{cause:f})),a.warning("Something went wrong updating your GPT's profile picture.",{duration:3})}const g={name:typeof d=="string"?d:void 0,description:typeof m=="string"?m:void 0,instructions:typeof l=="string"?l:void 0,promptStarters:Array.isArray(v)?v:void 0,profilePictureId:r?.id,profilePictureUrl:r?.permalink};return Pa(g,f=>f!=null)}function kl(s){const t=new Set;for(const l of s.tools)t.add(l.type);const a=s.name??"",i=s.description??"",n=s.instructions??"",o=Array.from(t).join(","),r=a===""&&i===""&&n==="",d=s.profilePictureUrl!=null;return r?`The GPT you are about to has the following abilities: ${o}.`:`This is the GPT's current set of fields:

name: ${a}

description: ${i}

context: ${n}

abilities: ${o}

${d?"The GPT has a profile picture.":"This GPT does not have a profile picture. You must generate a profile picture when you next update your behavior."}
`}function ra(s,t,a,i){const n=a.current,o=i.current;if(je(n,o))return;const r={};n.name!==o?.name&&(r.name=n.name),(n.description??"")!==(o?.description??"")&&(r.description=n.description??""),n.instructions!==(o?.instructions??"")&&(r.context=n.instructions??"");const d=new Set(o?.files?.map(g=>g.file_id)??[]),l=new Set(n.files?.map(g=>g.file_id)??[]),m=(n.files??[]).filter(g=>!d.has(g.file_id)),y=(o?.files??[]).filter(g=>!l.has(g.file_id));if(fs(r)&&m.length===0&&y.length===0)return;const v=[];if(!fs(r)){const g=`Explicitly update the GPT's behavior to the following exact fields:

    ${JSON.stringify(r,null,2)}

    "Do not call update_behavior yet. Instead, use these updated fields as the GPT's current behavior, and in the next call to update_behavior, incorporate these changes."
    `;v.push(Pe.getTextAsMessage(g,ce.System))}y.length>0&&v.push(Pe.getTextAsMessage(`The user has removed the following files from the GPT. You can no longer reference these files: ${y.map(g=>g.file_id).join(", ")}`,ce.System)),m.length>0&&v.push(Pe.getTextAsMessage(`The user is adding these files to the GPT. The GPT may reference these files. The file IDs are: ${m.map(g=>g.file_id).join(", ")}`,ce.System,{attachments:m.map(g=>({id:g.file_id,name:g.name,size:g.size}))})),v.length>0&&R.updateTree(s,g=>{let f=g.getNodeByIdOrMessageId(t).parentId;for(const p of v){const x=Ie();g.insertNodeBefore(t,{id:x,children:[],parentId:f,message:p,metadata:{isClientCreatedSystemMessage:!0}}),f=x}})}function Ml(s,t,a){if(a.length===0)return;const i=Ie(),n=`The user is uploading files in their next message. If you need to reference these in calls to update_behavior, you will use the following File ID(s), in order: ${a.map(o=>`"${o.fileId}"`).join(", ")}`;R.updateTree(s,o=>{const r=o.getNodeByIdOrMessageId(t).parentId;o.insertNodeBefore(t,{id:i,children:[],parentId:r,message:Pe.getTextAsMessage(n,ce.System),metadata:{isClientCreatedSystemMessage:!0}})})}function Tl(s,t){const a="Remember, you should be calling either update_behavior or generate_profile_pic after most messages from the user. Your personality should be neutral and separate from the GPT you are creating.",i=R.getThreadCurrentLeafId(s),n=R.getTree(s);let o=n.getNodeByIdOrMessageId(i);for(;o!=null&&o.message.author.role!==ce.User;){if(o.message.content.content_type==="text"&&o.message.content.parts[0]===a)return;o=o.parentId!==""?n.getNodeByIdOrMessageId(o.parentId):void 0}R.updateTree(s,r=>{const d=r.getNodeByIdOrMessageId(t).parentId;r.insertNodeBefore(t,{id:Ie(),children:[],parentId:d,message:Pe.getTextAsMessage(a,ce.System,{exclude_after_next_user_message:!0}),metadata:{isClientCreatedSystemMessage:!0}})})}function Sl(s,t,a){R.initThread(s,{kind:Me.GizmoMagicCreate,gizmo_id:void 0,behavior_overrides:a});const n=ii().id,o=Ft(s)??n,r=Ht({clientThreadId:s,onCompletionFinished:t});return async(l,m,y)=>{if(y.length===0)return;const v=new Gt;let g=R.getThreadCurrentLeafId(s);for(const P of y){const N=Ie();R.updateTree(s,T=>{T.addNodeToEnd(g,{id:N,children:[],parentId:g,message:Pe.getTextAsMessage(P,ce.System),metadata:{isClientCreatedSystemMessage:!0}})}),R.setThreadCurrentLeafId(s,N),g=N}const f=g;ra(s,f,l,m);const p={conversationMode:{kind:Me.GizmoMagicCreate,gizmo_id:l.current.id,behavior_overrides:a}},x=await xt(),[j,M,b]=await Promise.all([ht.getEnforcementToken(x),Ut.getEnforcementToken(x),vt.getEnforcementToken(x)]);r({model:o,completionType:yt.Next,parentNodeId:f,metadata:{},focusOnNewCompletion:!0,chatReq:x,arkoseToken:j,turnstileToken:M,proofToken:b,preflightTime:0,completionMetadata:p,turnTracker:v})}}const _l="Generate a new profile picture for this GPT using gizmo_editor generate_profile_pic. Do not prompt the user for any clarification. Do not send extra text outside of the tool function call. DO NOT CALL update_behavior or otherwise update GPT behavior in your response.",Pl=Qe(()=>Ye(()=>import("./4vylp69vgeqwcqq1.js"),__vite__mapDeps([4,1,2,3,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40])).then(s=>s.DebugConversationSidebar));function Nl(s,t){h.useEffect(()=>{const a=R.getTree(s);if(a.findNode(r=>r.message.author.role===ce.User||r.metadata?.isClientCreatedSystemMessage===!0)||(R.deleteNodesByFilter(s,r=>r.metadata?.isPlaceholderTemplateAssistantWelcomeMessage===!0),t==null||t.length===0))return;const n=R.getThreadCurrentLeafId(s);if(!a.hasNodeOrMessageId(n))return;const o=Ie();R.updateTree(s,r=>{r.addNode(o,t,n,ce.Assistant,{isPlaceholderTemplateAssistantWelcomeMessage:!0})}),R.setThreadCurrentLeafId(s,o)},[s,t])}function Cl(s,t,a){qt(s,{kind:Me.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:a}),h.useEffect(()=>{R.updateConversationMode(s,{kind:Me.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:a})},[s,t.id,a]);const[i]=h.useState(()=>{const n=t.id==null,o=t.id!=null&&t.name!==""&&t.description!=null&&t.instructions!==""&&t.profilePictureUrl!=null;return n?`Hi! I'll help you build a new GPT. You can say something like, "make a creative who helps generate visuals for new products" or "make a software engineer who helps format my code."

What would you like to make?`:o?`Welcome back! Is there anything ${t.name} should be doing better? Anything you'd like to change?`:"You're back! Let's continue where we left off..."});Nl(s,i)}function Il({gizmoEditorData:s,updateGizmo:t,clientThreadId:a,completionCallbackResponse:i,gizmoEditorDataRef:n,magicMakerBehaviorOverrides:o,magicMakerConversationGizmoEditorDataRef:r,requireGizmoId:d}){const l=h.useMemo(()=>({gizmoEditorData:s,gizmoId:s.id,mode:"magic",behaviorOverrides:o,getGizmoId:d}),[d,s,o]),m=Za(g=>g.files.filter(f=>f.status===ae.Ready&&f.gizmoId!=null)),y=h.useCallback((g,f)=>{Ml(g,f,m),ra(g,f,n,r),Tl(g,f),t(p=>({...p,files:[...p.files??[],...ks(m.map(x=>x.fileId!=null&&{file_id:x.fileId,name:x.file.name,size:x.file.size,type:x.file.type,last_modified:x.file.lastModified,file_size_tokens:x.fileSpec?.fileTokenSize}))]})),r.current=_e(n.current)},[n,r,m,t]),v=Ot(g=>g.activeSidebar);return e.jsx(Lt.Provider,{value:l,children:e.jsxs("div",{className:"relative flex h-full grow overflow-auto",children:[e.jsx("div",{className:"grow",children:e.jsx(Kt,{clientThreadId:a,onCompletionFinished:i,preRequestCompletion:y,hideHeader:!0,prependThreadChildren:e.jsx("div",{className:"h-8"})})}),v==="debug"&&e.jsx(Pl,{clientThreadId:a,slideOver:!1,onClose:()=>Le.toggleActiveSidebar("debug"),isOpen:!0})]})})}const Al=ft.memo(Il),Ll=Qe(()=>Ye(()=>import("./lzalebmf9rqaga2z.js"),__vite__mapDeps([41,1,2,3,6,7,42,43,44,9,5,8,10,13,34,11,12,27,45,25,46,29,26,28,30,31,32,33,47,19,20,21,22,23,24,35,36,37,38,39,40,48])).then(s=>s.GizmoActionsEditor));var oa=(s=>(s.MAGIC_MAKER="magic",s.ADVANCED="advanced",s.PREVIEW="preview",s))(oa||{});function ls({value:s,label:t,testId:a}){return e.jsx(Pt,{value:s,className:"text-md w-1/3 flex-grow rounded-lg border-token-border-light p-1.5 font-semibold text-token-text-tertiary transition hover:text-token-text-primary radix-state-checked:border radix-state-checked:bg-token-main-surface-primary radix-state-checked:text-token-text-primary radix-state-checked:shadow-[0_0_2px_rgba(0,0,0,.03)] md:w-1/2","data-testid":a,children:t})}function Gl({className:s,editorTab:t,setEditorTab:a}){const i=V();return e.jsxs(_t,{className:ie("flex w-full overflow-hidden rounded-xl bg-token-main-surface-secondary p-1.5 md:w-1/2",s),value:t,onValueChange:n=>{a(n)},children:[e.jsx(ls,{value:"magic",label:i.formatMessage(cs.magicMakerLabel)}),e.jsx(ls,{value:"advanced",label:i.formatMessage(cs.configureLabel),testId:"gizmo-editor-configure-button"}),e.jsx("div",{className:"flex w-1/3 md:hidden",children:e.jsx(ls,{value:"preview",label:i.formatMessage(cs.previewLabel)})})]})}function Ul(s,t){return s.length!==t.length?!1:s.every(a=>t.some(i=>i.type===a.type))}function Rl(s,t){return s.name===t.gizmo.display.name&&s.description===t.gizmo.display.description&&s.instructions===t.gizmo.instructions&&Ul(s.tools,t.tools)&&je(s.files?.map(a=>a.file_id)??[],t.files?.map(a=>a.file_id)??[])&&s.profilePictureUrl==t.gizmo.display.profile_picture_url&&s.profilePictureId==t.gizmo.display.profile_pic_id}const hs={id:void 0,instructions:"",name:"",description:"",profilePictureId:void 0,profilePictureUrl:void 0,promptStarters:[],sharing:{recipient:u.Private,subjects:[]},tools:[{type:te.DALLE}],files:[],trainingDisabled:!1,liveVersion:0,contextStuffingBudget:null},zl={...hs,tools:[...hs.tools,{type:te.BROWSER}]};function et(s){return{id:s.gizmo.id,instructions:s.gizmo.instructions,name:s.gizmo.display.name,description:s.gizmo.display.description??"",profilePictureId:s.gizmo.display.profile_pic_id??void 0,profilePictureUrl:s.gizmo.display.profile_picture_url??void 0,promptStarters:s.gizmo.display.prompt_starters??[],tools:_e(s.tools),files:_e(s.files),sharing:s.gizmo.sharing?_e(s.gizmo.sharing):{subjects:[],recipient:s.gizmo.share_recipient},trainingDisabled:s.gizmo.training_disabled??!1,sharingRecipient:s.gizmo.share_recipient,sharingTargets:_e(s.gizmo.sharing_targets),liveVersion:s.gizmo.live_version??0,contextStuffingBudget:s.gizmo.context_stuffing_budget}}const la=({gizmo:s,onNewGizmoId:t})=>{const a=Ue(),i=At(gt.BrowsingAvailable),n=V(),o=ge(),r=h.useRef(s!=null?et(s):i?zl:hs),d=h.useRef(s),l=h.useRef(r.current),[m,y]=h.useState(()=>r.current),[v,g]=h.useState(()=>Be()),[f]=h.useState(()=>({context_message:kl(r.current),model_slug:"unused",enabled_tools:[{tool_id:s!=null?"gizmo_editor":"gizmo_creator"}]}));Cl(v,l.current,f);const{data:p}=oi(),x=p?.modelsList.find(S=>S.tags.includes(Na.GPT_4))??p?.modelsList.find(S=>S.id===li),{data:j}=Rt(r.current.id),M=ci(),{isPending:b,error:P}=M,N=di(),T=h.useMemo(()=>j!=null&&!Rl(m,j),[m,j]),k=async()=>{const S=r.current;try{const C=await M.mutateAsync({editorData:S,gizmoId:S.id});if(d.current=C,r.current.id==null){const D=C.gizmo.id;r.current={...r.current,id:D,sharingTargets:C.gizmo.sharing_targets},y(r.current),t?.(D)}for(const D of C.tools.filter(re=>re.type===te.JIT_PLUGIN)){const re=r.current.tools.find(ve=>ve.type===te.JIT_PLUGIN&&ve.metadata.domain===D.metadata.domain);re&&re.metadata.action_id!==D.metadata.action_id&&(re.metadata={...re.metadata,action_id:D.metadata.action_id},y(r.current))}return C}catch(C){const D=mt(C)??n.formatMessage(na.errorSavingDraft);throw o.warning(D,{duration:2}),C}},I=h.useRef(void 0),U=async()=>r.current.id!=null?r.current.id:(I.current==null&&(I.current=k().then(S=>S.gizmo.id).catch(S=>{throw I.current=void 0,S})),I.current),[Q]=h.useState(()=>si(()=>k(),2e3,{trailing:!0}));function G(S,C=!0){const D=typeof S=="function"?S(r.current):Lo(r.current,S);je(D,r.current)||(r.current=D,y(r.current),C&&Q())}const F=h.useRef(void 0),J=async S=>{if(S==null){Y(!1);return}try{const C=await wl(r.current,S,o,F.current);C!=null&&(G(C),l.current=_e(r.current))}catch(C){us.addError(C),o.warning("Something went wrong generating your GPT",{duration:3})}finally{F.current=R.getThreadCurrentLeafId(S),Y(!1)}},ee=Sl(v,J,f),[$,H]=h.useState(void 0);h.useEffect(()=>{H(Bi(s))},[s?.gizmo.id]);const se=async(S,C)=>{const D=Ee(r.current,S.recipient,C);if(D.length>0){o.warning(`Could not save GPT:

${D.map(Te=>`- ${xs(Te)}`).join(`
`)}`,{duration:3});return}const re=await k(),ve=re.gizmo.id;try{return dt.logEvent(ut.promoteGizmo,{gizmo_id:re.gizmo.id,sharing_recipient:S.recipient,editor_tab:Z}),await N.mutateAsync({gizmoId:re.gizmo.id,data:{sharingSubjects:S.subjects,sharingRecipient:S.recipient,categories:C==null?void 0:[C]}},{onSuccess(ca){a.setQueryData(Us(a,ve).queryKey,ca),a.invalidateQueries({queryKey:["gizmos"]}),a.invalidateQueries({queryKey:["gizmo",{gizmoId:ve}]}),a.invalidateQueries({queryKey:["gizmo","userActionSettings",{gizmoId:ve}]})}})}catch(Te){Te instanceof ti?H({gizmoId:ve,sharingRecipient:S.recipient,moderationType:Xe.PublishBlocked,sharingTargets:Te.response.sharing_targets,showModal:be.AppealAvailable}):(us.addError(Te),o.warning("Error saving GPT",{duration:2}))}},he=M.isPending||N.isPending,[Z,_]=h.useState(()=>{const S=Cs.getItem(Is.GizmoEditorTab);return Object.values(oa).includes(S)?S:"magic"}),W=Ca.useState(({windowWidth:S})=>S);h.useEffect(()=>{W!=null&&W>=768&&Z==="preview"&&_("magic")},[W,Z]);const[Ze,w]=h.useState(!1),[A,Y]=h.useState(!1),[ne,K]=h.useState(void 0);return e.jsxs("div",{className:"flex h-screen w-full flex-col items-center",children:[e.jsx(Xo,{gizmoEditorData:m,isLoading:he,hasUnpublishedChanges:T,isUploadingProfilePic:Ze,isGeneratingProfilePic:A,publishedGizmo:j,updateGizmo:G,promoteGizmo:async(S,C)=>{const D=await se(S,C);return r.current={...r.current,sharingRecipient:S.recipient},y(r.current),Cs.setItem(Is.GizmoEditorTab,Z),D},appealGizmo:async(S,C)=>{$!=null&&H({...$,sharingRecipient:S,categories:C==null?void 0:[C],showModal:be.AppealAvailable})},setAppealState:H,revertDraft:j!=null&&T?()=>{const S=a.getQueryData(Us(a,r.current.id).queryKey);if(S!=null){const C=et(S);r.current=C,y(C),k()}}:void 0,draftMessage:e.jsx(ul,{isPublished:j!=null&&(j.gizmo.share_recipient==="marketplace"||j.gizmo.share_recipient==="workspace"),hasUnpublishedChanges:T,isSavingDraft:b,upsertDraftError:P,className:"text-sm"}),showActionsModal:S=>{K(S)},className:"flex-shrink-0"}),$&&e.jsx(Vi,{appealState:$,onAppealClose:()=>H({...$,showModal:be.None}),onAppealSubmitted:()=>H({...$,showModal:be.AppealSent})}),e.jsxs("div",{className:"relative flex w-full grow overflow-hidden",children:[e.jsx("div",{className:"flex w-full justify-center md:w-1/2",children:e.jsx("div",{className:"h-full grow overflow-hidden",children:ne!==void 0?e.jsx(Ll,{currentlyEditingActionDomain:ne,gizmoEditorData:m,updateGizmo:G,onClose:()=>{K(void 0)}}):e.jsxs("div",{className:"flex h-full flex-col px-2 pt-2",children:[e.jsx("div",{className:"flex w-full flex-row justify-center",children:e.jsx(Gl,{editorTab:Z,setEditorTab:_,className:"mb-2 flex-shrink-0 self-center"})}),e.jsx("div",{className:"grow overflow-hidden",children:Z==="magic"?e.jsx("div",{className:"h-full w-full pb-5",children:e.jsx(Al,{gizmoEditorData:m,updateGizmo:G,completionCallbackResponse:J,clientThreadId:v,gizmoEditorDataRef:r,magicMakerBehaviorOverrides:f,magicMakerConversationGizmoEditorDataRef:l,requireGizmoId:U},v)}):Z==="advanced"?e.jsx(ll,{gizmoEditorData:m,updateGizmo:G,currentModelConfig:x,generateProfilePic:()=>{Y(!0),ee(r,l,[_l])},setIsUploadingProfilePic:w,isGeneratingProfilePic:A,setIsGeneratingProfilePic:Y,requireGizmoId:U,onShowActionsEditor:S=>{K(S)}}):e.jsx(Zs,{gizmoEditorData:m,currentModelConfig:x,isSavingDraft:b,showTitle:!1})})]})})}),e.jsx("div",{className:ie("hidden w-1/2 justify-center border-l border-token-border-medium bg-token-main-surface-secondary pt-4",Z!=="preview"&&"md:flex"),children:e.jsx("div",{className:"flex-grow pb-5",children:e.jsx("div",{className:"h-full",children:e.jsx(Zs,{gizmoEditorData:m,currentModelConfig:x,isSavingDraft:b})})})})]})]})};function El({gizmoId:s,version:t}){const{data:a}=ri({gizmoId:s,draft:!0,version:t}),i=qe(St.accountUserId),o=Mt()?.id,r=a!=null&&i!=null&&o!=null&&ei(a);return a!=null&&r?e.jsx(la,{gizmo:a}):null}function Fl({onNewGizmoId:s}){return e.jsx(la,{gizmo:void 0,onNewGizmoId:s})}function nc({gizmoId:s,remixSourceId:t,version:a}){const i=js(),n=Ce(),o=h.useRef(void 0);h.useEffect(()=>(Le.enterGizmoEditor(),()=>{Le.exitGizmoEditor()}),[]);let r=s;return s!=null&&o.current===s&&(r=void 0),mi({resetThreadAction:()=>{i("/")}}),e.jsx("div",{children:n?.data?e.jsx("div",{children:r!=null?e.jsx(El,{gizmoId:r,version:a},r):e.jsx(Fl,{remixSourceId:t,onNewGizmoId:d=>{o.current=d,window.history.replaceState(window.history.state,"",ni(d))}})}):e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx(bs,{})})})}const cs=xe({magicMakerLabel:{id:"gizmo.magicMakerLabel",defaultMessage:"Create"},configureLabel:{id:"gizmo.advancedLabel",defaultMessage:"Configure"},previewLabel:{id:"gizmo.previewLabel",defaultMessage:"Preview"}});export{nc as G,Fo as S,xl as a,fl as b,et as c};
//# sourceMappingURL=r70zjo7nzi66avll.js.map
