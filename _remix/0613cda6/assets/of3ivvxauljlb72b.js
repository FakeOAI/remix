import{f4 as E,bn as R,r as u,y as n,cD as q,f5 as $,a4 as Y,f6 as K}from"./j2kz7iekbuf2lk7j.js";import{fN as Q,fO as X,Y as b,fP as Z,cu as J,fQ as tt,dQ as et,dO as st,fR as at,fS as ot,fT as it,fU as nt,fV as rt,fW as ct,fX as dt,fY as W,fZ as lt,f_ as F,f$ as ut,bS as L,g0 as pt,g1 as mt,g2 as ft,W as ht,g3 as gt,g4 as N,bE as xt,g5 as O,g6 as bt,g7 as vt}from"./le0rdv0puybx8i2m.js";import{L as Ct}from"./jpjqqpbn30fko74f.js";import{u as St}from"./nhstxjm9fm2wwq1z.js";import{c as D,U as j}from"./k7ijapezwxn0gldf.js";import{u as wt}from"./ipsw910ertn2na1c.js";import{T as Tt}from"./d2638audhe4gxv60.js";import{s as yt,m as It,B as Et,C as At}from"./do8518u43szfxnij.js";import{m as x}from"./16qiumnq05saksju.js";import"./i82yi0xftw7xnu8c.js";import"./eyqsg3qqtdkfk98w.js";import"./la9ho9khwsle3ipj.js";import"./htup5dwnbax7b6kd.js";import"./l3k0q6i660cci9gs.js";import"./edsbbff3hjliwmsy.js";import"./ja1b9jvth2p43ta6.js";import"./j7mq5nf1vxeg7fkq.js";import"./ewb0evhr38szdnyo.js";import"./b7blrmw2f2rsy4xk.js";import"./m6ja8i3ndb249mop.js";import"./iwalt63h1v4xvqgr.js";import"./7ipsxb1ziflxxehx.js";import"./kawvie7nhoy7b5xf.js";import"./ebyv7xemoskqzdop.js";import"./eaaoouesduey4ffk.js";import"./h0azweck97u45dr6.js";import"./k3f9f9w3dyathkrt.js";import"./obzqpqgxugpntpyu.js";import"./m915zcyv891bnbyo.js";import"./ealecef5wv7wy2ad.js";import"./e6rd3uhbyhaywebc.js";import"./mc5sptj4mkj9uxem.js";import"./ni3b6td4z56jwe2m.js";import"./bei6thylcevdeq42.js";import"./bfbfsb70l0vf4jxg.js";import"./imolwwc9blvlxicq.js";import"./c5szd8ql34jskuew.js";import"./e7t3tykg4v6613sg.js";import"./lmjygzt103a8qxof.js";import"./hh4jf2kl0zghf52u.js";import"./en3g75iynq2rt808.js";import"./bnfarm88x21grgf5.js";import"./jxqa0hw8e95bn5qb.js";import"./c83mqmt44trq2hud.js";import"./iyh6rz3uu1kh4fq5.js";import"./gi0gm0lgz9wdkksb.js";import"./oc5adbkmhd29y471.js";import"./jw599pz8489v1ojp.js";import"./fhik259j3s851psh.js";const M="oai/apps/canmoreSidebarWidth",_t=.25,Rt=400,k=400;function H(t){return t-Rt}function y(t,a){return X(k,H(t),a??_t*t)}function Wt(){const t=E.useState(E.selectWindowWidth),a=y(t,Q(R.DANGER_SECRET_FOLDERS_ONLY_getItem(M))),s=U(),[e,r]=u.useState(a);u.useEffect(()=>{(e<k||e>H(t))&&r(y(t,e))},[t]);function o(l){r(g=>y(t,g+=l.delta.x))}function d(l){r(l),R.DANGER_SECRET_FOLDERS_ONLY_setItem(M,l)}function c(){const l=y(t,void 0);d(l)}const i=`calc(100vw - ${e}px)`;return s?{chatWidth:e,canvasWidth:t-e,canvasWidthCalc:i,viewportWidth:t,handleDrag:o,handleDoubleClick:c,persist:d}:{chatWidth:0,canvasWidth:t,canvasWidthCalc:"100vw",viewportWidth:t,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function U(){return E.useState(t=>E.selectWindowWidth(t)>1e3)}function Nt(t,a){let s;return a?.type===b.Textdoc&&(s={type:"canvas_textdoc",id:a.textdocId}),{...t,messageMetadata:{...t.messageMetadata,open_in_canvas_view:s}}}const V=({isFullScreen:t=!1,clientThreadId:a,focusedObject:s,onClose:e,isAnimating:r=!1,width:o})=>{const{setTargetedContent:d}=Z(),c=u.useRef(!1);if(u.useEffect(()=>(c.current&&d(void 0),c.current=!0,()=>{c.current=!1}),[s]),s==null)return null;switch(s.type){case b.Textdoc:return n.jsx(Tt,{isFullScreen:t,onClose:e,clientThreadId:a,focusedTextdoc:s,isAnimating:r,width:o});case b.ADAVisualization:return null}},Ot=300,Dt=t=>t?.type===b.Textdoc?t.textdocId:null;function jt(t){const a=yt(t),s=J(a),e=It(t),r=Et(t,e),o=At({clientThreadId:t,conversationLeafId:e}),d=tt(),[c,i]=u.useMemo(()=>{if(r&&et(r))return[void 0,null];let m;return!o&&r&&(m=st(at(r.messages))),Mt(s,d,m)},[o,r,s,d]),l=i!=null,g=Dt(i);u.useEffect(()=>{if(i&&c&&(ot(i,c),i.type===b.Textdoc)){const{textdocId:m}=i,C=lt(m);it(document.getElementById(C))}},[l,g])}function Mt(t,a,s){switch(s?.type){case nt.Canmore:{const[e,r]=s.messages;if(!rt(e?.message))break;const o=ct(t,e.message,r?.message??null),d=o.textdocId??a;if(d&&(o.function===dt.CreateTextdoc?(o.content??"").length>Ot||o.status===W.WAITING:o.status===W.STREAMING))return[o.messageId,{type:b.Textdoc,textdocId:d}];break}}return[void 0,null]}const Ft=260,G=280,I={type:"spring",bounce:.12,duration:.64},Lt={type:"spring",bounce:0,duration:.58},kt=({clientThreadId:t,focusedObject:a,onClose:s})=>{const{chatWidth:e,canvasWidthCalc:r,handleDrag:o,handleDoubleClick:d,persist:c}=Wt(),i=L(),[l,g]=u.useState(!0),[m,C]=u.useState(!1),f=D(p=>p.activeSidebar),v=pt(({rect:p})=>p),{windowHeight:S,windowWidth:w}=$(p=>p,{windowWidth:0,windowHeight:0});let h=v??{top:0,left:e,width:w-e,height:S},_=!1;if(v&&(h.top<0||h.top+h.height>S)){_=!0;const p={width:(w-e)*.75,height:S*.75};h={top:S/2-p.height/2,left:(w-e-p.width)/2+e,width:p.width,height:p.height}}i&&(h.left-=G+e/2);const T=v?.borderRadius,A=mt(),z=A?.history!=null||A?.showChangesAtVersion!=null,B=D(p=>p.isDesktopNavCollapsed);return n.jsxs(n.Fragment,{children:[z&&n.jsx(Ct,{onClick:()=>ft(A.textdocId),zIndexKey:"chatOverlay"}),n.jsxs(x.div,{initial:!i&&{marginRight:B?0:-Ft},animate:!i&&{marginRight:0},transition:Lt,children:[n.jsx(x.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:{...I,delay:.22},className:"pointer-events-none absolute left-0 top-0 z-20 h-full w-full bg-token-main-surface-primary"}),!i&&n.jsx(x.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"pointer-events-none absolute left-0 top-0 z-10 h-full w-full bg-black/[0.025] dark:bg-transparent"}),n.jsx(x.div,{className:"relative z-20 h-full",style:{width:r},exit:{width:0},transition:{type:"spring",bounce:0,duration:.1}})]}),n.jsx(x.div,{className:Y("absolute z-20 h-full transition-shadow",i&&"right-0 max-h-[100cqh] max-w-[var(--available-details-width)] overflow-y-auto overflow-x-clip",!i&&"overflow-hidden",!i&&(f==="debug"?"md:left-[-250px] lg:left-[-300px] xl:left-[-350px] 2xl:left-[-400px]":"left-0")),initial:{borderRadius:T,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)",opacity:_?0:1,x:h.left,y:h.top,height:h.height,width:h.width},animate:{opacity:1,x:i?0:e,y:0,width:i?`calc(100cqw - ${e}px)`:r,height:"100%",borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:{opacity:{duration:.14,bounce:.1}},borderRadius:T,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:m?{duration:0}:I,onAnimationComplete:()=>g(!1),children:n.jsx(x.div,{className:"h-full overflow-hidden border-l border-gray-100 dark:border-token-border-medium",initial:{borderRadius:T},animate:{borderRadius:0},exit:{borderRadius:T},transition:I,children:n.jsxs("div",{className:"h-full",children:[n.jsx(x.div,{drag:"x",className:"absolute left-[-2px] z-10 h-full w-[4px] cursor-ew-resize bg-token-text-quaternary opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onDrag:(p,P)=>{C(!0),o(P)},onDragEnd:()=>{C(!1),c(e)},onDoubleClick:()=>d()}),n.jsx(V,{onClose:s,clientThreadId:t,isAnimating:l,focusedObject:a,width:w-e})]})})})]})},Ht=u.memo(kt),Ut=({clientThreadId:t,focusedObject:a,onClose:s})=>n.jsx(K,{children:n.jsx(x.div,{className:"fixed inset-0 z-20 overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:I,children:n.jsx(V,{isFullScreen:!0,clientThreadId:t,focusedObject:a,onClose:s})})}),Vt=({clientThreadId:t})=>{const{store:a,actions:s}=St(),e=U(),r=wt(t);jt(t);const o=ht(),d=gt(),c=u.useMemo(()=>{let f=o;if(o?.type===b.Textdoc){const v=d?.[o.textdocId];v&&(f={...o,textdocId:v})}return f},[o,d]);u.useEffect(()=>{F()},[t]);const i=c&&(e?n.jsx(Ht,{clientThreadId:t,onClose:O,focusedObject:c},"canvas-sidebar"):n.jsx(Ut,{clientThreadId:t,onClose:O,focusedObject:c},"canvas-modal"));u.useEffect(()=>{if(c)return N(f=>Nt(f,c)),()=>N(null)},[c,d]);const l=L(),g=G+400+64+bt+vt,m=i!=null;return u.useEffect(()=>{const f=l&&a.getState().isSidebarOpen&&window.innerWidth<g;return f&&s.closeSidebar(),j.setActiveStageSidebar(m),()=>{m&&(l&&f&&s.openSidebar(),j.setActiveStageSidebar(!1))}},[m,a,s,l,g]),r!==t?null:n.jsx(xt,{children:i})},Le=t=>{const a=u.useRef(null);return n.jsx(q,{ref:a,onError:(s,e)=>{F(),setTimeout(()=>{a.current?.resetErrorBoundary()}),ut.logError("Error boundary hit",s,{componentStack:e})},name:"canmore-focused-view",children:n.jsx(Vt,{...t})})};export{Le as CanvasFocusedViewManager};
//# sourceMappingURL=of3ivvxauljlb72b.js.map
