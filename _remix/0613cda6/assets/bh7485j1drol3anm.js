const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/c424gp9lvng76a4b.js","assets/j2kz7iekbuf2lk7j.js","assets/i82yi0xftw7xnu8c.js","assets/root-pepj1ul4.css","assets/le0rdv0puybx8i2m.js","assets/conversation-small-cll5buey.css","assets/g59jik8o4uv6iu87.js","assets/dw3m8v3hmso7u4e9.js"])))=>i.map(i=>d[i]);
import{a0 as R,r as h,y as e,ae as i,aA as B,a1 as F,bF as D,bt as z,a4 as K,al as ee,ax as Q,ab as te,ac as se,L as ne,j as oe,cG as ae,e9 as ie}from"./j2kz7iekbuf2lk7j.js";import{ds as re,G as f,f3 as le,dt as de,u as Z,f4 as ce,f5 as ue,f6 as J,f7 as me,K as ge,cP as U,f8 as fe,f9 as pe,fa as xe,i as E,cD as ye}from"./le0rdv0puybx8i2m.js";import{j as he}from"./jk8w36bsokizpx57.js";import{J as Se,ab as be,a_ as Me,b7 as je,ay as ve,b8 as Ie,K as $}from"./i82yi0xftw7xnu8c.js";import{a as we,b as Ce,u as De,d as Ae}from"./j55e4qg7crv0luth.js";import{D as w}from"./eyqsg3qqtdkfk98w.js";import{f as H,a as Te,d as q,e as V}from"./dw3m8v3hmso7u4e9.js";import"./7ipsxb1ziflxxehx.js";import"./k7ijapezwxn0gldf.js";import"./edsbbff3hjliwmsy.js";import"./do8518u43szfxnij.js";import"./16qiumnq05saksju.js";import"./jpjqqpbn30fko74f.js";import"./la9ho9khwsle3ipj.js";import"./htup5dwnbax7b6kd.js";import"./l3k0q6i660cci9gs.js";import"./ja1b9jvth2p43ta6.js";import"./j7mq5nf1vxeg7fkq.js";import"./ewb0evhr38szdnyo.js";import"./b7blrmw2f2rsy4xk.js";import"./m6ja8i3ndb249mop.js";import"./iwalt63h1v4xvqgr.js";import"./kawvie7nhoy7b5xf.js";import"./j5m94m0btwkvs4eg.js";import"./ef9tjz29a74xkoxe.js";function ke({onRemoveDomainClick:t,onVerifyDomainClick:n}){return e.jsxs(w.Root,{children:[e.jsx(w.Trigger,{children:e.jsx(be,{className:"icon-sm"})}),e.jsx(w.Portal,{children:e.jsxs(w.Content,{children:[e.jsx(w.Item,{onClick:t,children:e.jsx(i,{...A.ssoDropdownRemoveButtonText})}),e.jsx(w.Item,{onClick:n,children:e.jsx(i,{...A.ssoDropdownVerifyButtonText})})]})})]})}function Le({domains:t,workspaceId:n}){const o=R(),{mutateAsync:a}=re(n),[s,c]=h.useState(!1),[u,p]=h.useState();return e.jsxs(e.Fragment,{children:[e.jsxs(f.Root,{className:"w-full table-auto",children:[e.jsxs(f.Header,{children:[e.jsx(f.HeaderCell,{className:"bg-token-main-surface-primary",children:e.jsx(i,{...A.domainTableHeader})}),e.jsx(f.HeaderCell,{className:"bg-token-main-surface-primary",children:e.jsx(i,{...A.statusTableHeader})}),e.jsx(f.HeaderCell,{className:"bg-token-main-surface-primary"})]}),e.jsx(f.Body,{children:t.map((m,j)=>e.jsxs("tr",{onClick:()=>p(m),className:"cursor-pointer",children:[e.jsx(f.Cell,{children:m.hostname}),e.jsx(f.Cell,{children:o.formatMessage(le[m.status])}),e.jsx(f.Cell,{textAlign:"right",children:e.jsx("div",{onClick:v=>v.stopPropagation(),children:e.jsx(ke,{onRemoveDomainClick:()=>{a({domainId:m.id})},onVerifyDomainClick:()=>{p(m)}})})})]},j))})]}),e.jsx(B,{color:"secondary",className:"mt-6",onClick:()=>{c(!0)},icon:Se,children:e.jsx(i,{...A.addDomainButton})}),e.jsx(de,{isOpen:s||u!==void 0,onClose:()=>{c(!1),p(void 0)},workspaceId:n,currentDomain:s?void 0:u,domains:t},u?.id)]})}const A=F({ssoDropdownRemoveButtonText:{id:"workspaceIdentity.ssoDropdownRemoveButtonText",defaultMessage:"Remove Domain"},ssoDropdownVerifyButtonText:{id:"workspaceIdentity.ssoDropdownVerifyButtonText",defaultMessage:"Verify"},domainTableHeader:{id:"workspaceIdentity.domainTableHeader",defaultMessage:"Domain"},statusTableHeader:{id:"workspaceIdentity.statusTableHeader",defaultMessage:"Status"},addDomainButton:{id:"workspaceIdentity.addDomainButton.0",defaultMessage:"Add domain"}}),Ee=async t=>new Promise((n,o)=>{const a=new FileReader;a.readAsText(t),a.onload=function(s){n(s.target?.result)},a.onerror=o});function Be({acsId:t,hasSSO:n}){const o=`https://auth0.openai.com/login/callback?connection=${t}`,a=`urn:auth0:openai:${t}`,s=`${location.host}/auth/login?sso=true&connection=${t}`,c=R(),u=ee();return e.jsxs(e.Fragment,{children:[e.jsx(H,{children:e.jsx(i,{...d.setupSSOContent})}),e.jsxs("div",{className:"mb-6 flex flex-col space-y-4",children:[e.jsx(U,{label:"Assertion Consumer Service (ACS) URL",value:o,onCopied:()=>{u.success(c.formatMessage(d.copiedACSToClipboard),{duration:3})}}),e.jsx(U,{label:"Entity ID",value:a,onCopied:()=>{u.success(c.formatMessage(d.copiedEntityToClipboard),{duration:3})}}),n&&e.jsx(U,{label:c.formatMessage(d.idpSignInURL),value:s,onCopied:()=>{u.success(c.formatMessage(d.copiedIDPUrlToClipboard),{duration:3})}})]})]})}function Re({workspaceId:t,data:n,isOpen:o,onClose:a}){const s=R(),c=Z(),{mutateAsync:u}=ce(t),{mutateAsync:p}=ue(t),{mutateAsync:m}=J(t),j=h.useRef(null),v=n?.connection,[S,C]=h.useState(v?.sign_in_endpoint),[X,x]=h.useState(!1),[b,T]=h.useState(v?.cert),y=n===null?1:2,O=async(l,g)=>{let L;try{L=await u({signInEndpoint:l,cert:g})}catch(I){if(I instanceof Q&&I.code==="reauth_required"){x(!0);return}throw I}await m({connectionId:L.id,active:!0}),a()},k=y===1?e.jsx(D.Button,{title:s.formatMessage(d.doneButton),color:"primary",disabled:S===void 0||b===void 0,onClick:async()=>{S===void 0||b===void 0||await O(S,b)}}):n&&e.jsx(D.Button,{title:s.formatMessage(d.doneButton),color:"primary",onClick:async()=>{await m({connectionId:n?.id,cert:b,signInEndpoint:S,active:!0}),a()}}),P=n===null?e.jsx(D.Button,{title:s.formatMessage(d.cancelButton),color:"secondary",onClick:()=>a()}):e.jsx(B,{as:"link",color:"danger-outline",onClick:async()=>{await p({connectionId:n?.id}),a()},children:s.formatMessage(d.deleteButton)});return e.jsx(z,{isOpen:o,type:"success",title:s.formatMessage(y===1?d.createTitle:d.editTitle),primaryButton:k,secondaryButton:P,onClose:a,children:e.jsxs("form",{onSubmit:l=>l.preventDefault(),children:[e.jsx(me,{children:e.jsx(i,{...d.createInstructionsManual})}),e.jsx("label",{className:"mb-2 flex items-center text-sm",children:e.jsx(i,{...d.signInLabel})}),e.jsx("div",{className:"mb-4",children:e.jsx(ge,{className:"w-full appearance-none rounded border px-3 py-2",name:"Sign-In URL",type:"text",placeholder:"https://your.idp.here/saml2?idpid=123456",value:S??"",onChange:l=>{C(l.target.value)}})}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("label",{className:"text-sm",children:e.jsx(i,{...d.certLabel})}),e.jsx("input",{ref:j,type:"file",accept:".csv,.cer,.pem,text/plain",className:"hidden",onChange:async l=>{if(l.target.files?.[0]){const g=await Ee(l.target.files[0]);T(g)}}}),e.jsx(B,{color:"secondary",onClick:()=>j.current?.click(),icon:Me})]}),e.jsx("textarea",{rows:10,className:K("w-full resize-none overflow-y-auto rounded border border-gray-300 px-3 py-2","outline-none focus-within:border-green-600 focus-within:ring-1 focus-within:ring-green-600","text-token-text-primary placeholder-gray-500 dark:bg-gray-700"),placeholder:"-----BEGIN CERTIFICATE-----",value:b??"",onChange:l=>{T(l.target.value)}})]}),X&&e.jsx("label",{className:"text-token-text-error",children:e.jsx(i,{id:"ZfFabW",defaultMessage:"You need to re-authenticate to access this page. Please <login>log in</login> before continuing.",values:{login:l=>e.jsx("a",{href:"#",className:"text-token-text-primary underline",onClick:g=>{g.preventDefault(),c({authType:"login",callbackUrl:"/admin/identity"})},children:l})}})})]})})}const d=F({setupSSOContent:{id:"workspaceIdentity.setupSSOContent",defaultMessage:"Anyone using email addresses with a verified domain can log in via SAML SSO."},createInstructionsXML:{id:"ssoModal.createInstructionsXML",defaultMessage:"If your Identity Provider offers a metadata URL or an XML file, add it here for the quickest setup option."},createInstructionsManual:{id:"ssoModal.createInstructionsManual",defaultMessage:"Copy your Sign-in endpoint (SSO URL) and the public X.509 certificate from your Identity Provider."},createTitle:{id:"ssoModal.createTitle",defaultMessage:"Create SAML SSO Configuration"},editTitle:{id:"ssoModal.editTitle",defaultMessage:"Edit SAML SSO Configuration"},ssoMetadataLabel:{id:"ssoModal.ssoMetadataLabel",defaultMessage:"App Federation Metadata URL"},signInLabel:{id:"ssoModal.signInLabel",defaultMessage:"SSO URL"},certLabel:{id:"ssoModal.certLabel",defaultMessage:"X.509 Signing Certificate"},doneButton:{id:"ssoModal.doneButton",defaultMessage:"Done"},nextButton:{id:"ssoModal.nextButton",defaultMessage:"Next"},deleteButton:{id:"ssoModal.deleteButton",defaultMessage:"Delete configuration"},cancelButton:{id:"ssoModal.cancelButton",defaultMessage:"Cancel"},acsURLLabel:{id:"workspaceIdentity.acsURLLabel",defaultMessage:"Assertion Consumer Service (ACS) URL"},entityIDLabel:{id:"workspaceIdentity.entityIDLabel",defaultMessage:"Entity ID"},idpSignInURL:{id:"workspaceIdentity.idpSignInURL",defaultMessage:"IDP Tile URL"},copiedACSToClipboard:{id:"workspaceIdentity.copiedACSToClipboard",defaultMessage:"Copied ACS URL to clipboard"},copiedEntityToClipboard:{id:"workspaceIdentity.copiedEntityToClipboard",defaultMessage:"Copied entity ID to clipboard"},copiedIDPUrlToClipboard:{id:"workspaceIdentity.copiedIDPUrlToClipboard",defaultMessage:"Copied IDP URL to clipboard"},orDivider:{id:"workspaceIdentity.orDivider",defaultMessage:"or"},certExtractFailed:{id:"workspaceIdentity.certExtractFailed",defaultMessage:"Unable to find X.509 Certificate in provided XML"},ssoUrlExtractFailed:{id:"workspaceIdentity.ssoUrlExtractFailed",defaultMessage:"Unable to find Entity ID (sign-in endpoint) in provided XML"},ssoLearnMoreLink:{id:"workspaceIdentity.ssoLearnMoreLink",defaultMessage:"Learn more"}}),Oe=te(()=>se(()=>import("./c424gp9lvng76a4b.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(t=>t.DirectorySyncSection)),Pe=({title:t,footer:n,children:o})=>e.jsxs(q,{children:[e.jsx(V,{children:e.jsx(i,{...t})}),e.jsx("div",{children:o}),e.jsx(H,{children:n})]}),N=({icon:t,title:n,body:o,toggle:a})=>e.jsxs(q,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{className:"icon-sm"}),e.jsx(V,{children:e.jsx(i,{...n})})]}),e.jsx("div",{children:a})]}),e.jsx(H,{children:o})]});function _e({currentWorkspaceId:t}){const{value:n}=ne("3999712942"),o=R(),a=oe(),{data:s,isLoading:c}=fe(t),u=Z(),{mutateAsync:p}=J(t),{variables:m,mutateAsync:j}=pe(t),{variables:v,mutateAsync:S}=xe(t),C=s?.sso_connection!=null,x=!!s?.domains?.some(M=>M.status===ae.VERIFIED),b=C?r.ssoEditButton:r.ssoAddButton,[T,y]=h.useState(!1),[O,k]=h.useState(!1),P=s?.sso_connection?.status==="ACTIVE",l=s?.sso_connection?.connection?.enabled_client_names?.includes("chat")??!1,g=P&&l,L=s?.sso_connection?.id,I=v?.shouldAllowExternalDomainInvites??s?.allow_external_domain_invites??!0,Y=x,W=s?e.jsxs(Te,{children:[n&&e.jsx(Oe,{workspaceId:t}),e.jsx(Pe,{title:r.domainSubtitle,footer:e.jsx(e.Fragment,{children:e.jsx(i,{...r.verifyDomainInfoText})}),children:e.jsx(Le,{domains:s.domains,workspaceId:t})}),e.jsx(N,{icon:je,title:r.autoProvisionTitle,body:e.jsx(e.Fragment,{children:e.jsx(i,{...r.autoProvisionBody})}),toggle:e.jsx(E,{disabled:!x,enabled:m?.shouldAutoProvision??s.should_auto_provision,onChange:M=>{j({shouldAutoProvision:M})},label:o.formatMessage(r.toggleAutoProvisionLabel)})}),Y&&e.jsx(N,{icon:ve,title:r.allowExternalDomainInvitesTitle,body:e.jsx(e.Fragment,{children:e.jsx(i,{...r.allowExternalDomainInvitesBody})}),toggle:e.jsx(E,{disabled:!x&&I,enabled:I,onChange:M=>{S({shouldAllowExternalDomainInvites:M})},label:o.formatMessage(r.toggleDisableExternalDomainInvitesLabel)})}),e.jsxs(q,{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:K("icon-sm",g?"text-blue-600":"text-token-text-tertiary")}),e.jsx(V,{children:e.jsx(i,{...r.ssoTitle})})]}),C&&e.jsx("div",{children:e.jsx(E,{enabled:g,onChange:()=>{p({connectionId:L,active:!g})},label:o.formatMessage(r.ssoToggleActive)})})]}),x&&e.jsx(Be,{acsId:s.acs_id,hasSSO:C}),e.jsxs("div",{children:[e.jsx(B,{as:"button",color:"primary",disabled:!x,onClick:()=>{G(a)?k(!0):y(!0)},children:e.jsx(i,{...b})}),e.jsx(Re,{workspaceId:t,data:s.sso_connection,isOpen:O,onClose:()=>{k(!1)}}),e.jsx(z,{isOpen:T,onClose:()=>y(!1),type:"warning",title:o.formatMessage(r.reauthRequiredTitle),icon:$,primaryButton:e.jsx(D.Button,{onClick:()=>{u({authType:"login",callbackUrl:"/admin/identity"})},color:"primary",children:e.jsx(i,{id:"qcl4gn",defaultMessage:"Login"})}),secondaryButton:e.jsx(D.Button,{onClick:()=>y(!1),children:e.jsx(i,{id:"E1vtdZ",defaultMessage:"Close"})}),children:e.jsx("label",{className:"mb-2 flex items-center text-sm",children:o.formatMessage(r.reauthRequiredExplanation)})})]})]}),s.sso_connection&&e.jsx(N,{icon:$,title:r.enforceSSOTitle,body:e.jsx(e.Fragment,{children:e.jsx(i,{...r.enforceSSOBody})}),toggle:e.jsx(E,{disabled:!x,enabled:s.sso_connection.auth0_enforced_clients?.includes("chat"),onChange:M=>{!G(a)||!s.sso_connection?y(!0):p({connectionId:s.sso_connection.id,enforcedClients:M?["chat"]:[]}).catch(_=>{throw _ instanceof Q&&_.status===401&&y(!0),_})},label:o.formatMessage(r.enforceSSOLabel)})})]}):null;return e.jsxs(e.Fragment,{children:[e.jsx(ye,{children:e.jsx("title",{children:o.formatMessage(r.title)})}),e.jsx(we,{title:o.formatMessage(r.title)}),e.jsx(Ce,{showSpinner:c,children:W})]})}const r=F({title:{id:"workspaceIdentity.title",defaultMessage:"Identity & Provisioning"},domainSubtitle:{id:"workspaceIdentity.domainSubtitle",defaultMessage:"Domain management"},ssoTitle:{id:"workspaceIdentity.ssoTitle",defaultMessage:"Single Sign On"},ssoToggleActive:{id:"WorkspaceIdentityPage.ssoToggleActive",defaultMessage:"Enable SSO for this workspace"},ssoAddButton:{id:"workspaceIdentity.ssoAddButton",defaultMessage:"Add SAML SSO"},ssoEditButton:{id:"workspaceIdentity.ssoEditButton",defaultMessage:"Edit SAML SSO"},autoProvisionTitle:{id:"workspaceIdentity.autoProvisionSubtitle",defaultMessage:"Automatic account creation"},autoProvisionBody:{id:"workspaceIdentity.autoProvisionBody",defaultMessage:"Automatically create workspace accounts for new users who log in with a verified domain."},toggleAutoProvisionLabel:{id:"workspaceIdentity.toggleAutoProvisionLabel",defaultMessage:"Toggle to enable or disable auto provisioning"},allowExternalDomainInvitesTitle:{id:"RQGwuu",defaultMessage:"Allow External Domain Invites"},allowExternalDomainInvitesBody:{id:"7KRqHk",defaultMessage:"If not checked, future invitations to this workspace will be limited to users from this organization's verified domains"},toggleDisableExternalDomainInvitesLabel:{id:"bQy24Z",defaultMessage:"Toggle to enable or disable external domain invites"},enforceSSOTitle:{id:"workspaceIdentity.enforceSSOTitle",defaultMessage:"Enforce SSO log in"},enforceSSOBody:{id:"workspaceIdentity.enforceSSOBody",defaultMessage:"When SSO is active, users will no longer be able to use social logins and will be redirected to your SSO portal."},enforceSSOLabel:{id:"workspaceIdentity.enforceSSOLabel",defaultMessage:"Toggle to enable or disable SSO enforcement"},verifyDomainInfoText:{id:"workspaceIdentity.verifyDomainInfoText",defaultMessage:"Verify ownership of an email domain to access advanced security features including single sign-on."},learnMoreLink:{id:"workspaceIdentity.learnMoreLink",defaultMessage:"Learn more"},reauthRequiredTitle:{id:"workspaceIdentity.reauthRequiredTitle",defaultMessage:"Please login again"},reauthRequiredExplanation:{id:"workspaceIdentity.reauthRequiredExplanation",defaultMessage:"For security reasons, we need you to reauthenticate before making changes to SSO settings."}});function G(t){const n=ie(t)?.accessToken,a=(n?he(n):null)?.pwd_auth_time;return a==null?!1:Date.now()-a<6e4}function dt(){const t=De();return Ae(),e.jsx(_e,{...t})}export{dt as default};
//# sourceMappingURL=bh7485j1drol3anm.js.map
