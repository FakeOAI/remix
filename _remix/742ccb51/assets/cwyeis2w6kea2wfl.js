const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/t7ec6vag48x6aig7.js","assets/hzfabz2o8ombe5jw.js","assets/e50u68bunhmm6ifm.js","assets/root-vof5cayc.css","assets/i2j9kju29g786wqn.js","assets/ey0gcr5p6gxkaaov.js","assets/fk2on43rkvczq1b9.js","assets/conversation-small-eplmind9.css","assets/kw2fehsuj8pswi8v.js","assets/irzndtt8vp8asixn.js","assets/iing67ocwnwqhcj6.js","assets/hq883kjug2canm9r.js","assets/e78lqi6zd0w8e9e2.js","assets/fn9vn6zf2cy4gvb8.js","assets/nf4smlh8jgg9vqdx.js","assets/jyem616os9v6pvci.js","assets/hlqnx05o8mk1fkdn.js","assets/p40rplitvwe5wrs5.js","assets/f5oehfbcbky1xftj.js","assets/blijo2l4axfx8qll.js","assets/fawtfeghyg52yiqv.js","assets/m4ydchv9pwda8q8j.js","assets/ijzjkfnofkdg46xh.js","assets/kc1c7mnswsegcavx.js","assets/cvqslbpmoxjv3o3u.js","assets/hxhkjo1bo8kdzzw0.js","assets/hpzh4a2s0lujy0x2.js","assets/ofosodv3ao9jq0q5.js","assets/oikdp1odqae9j9am.js","assets/f9zbh5kr0w936l1j.js","assets/bp4id39vxnfirfjf.js","assets/sso-da2v16cola0b6d9b.js","assets/cx9iqieff3d5lozo.js","assets/dd6uhnn1vl27vlhq.js","assets/im28ivob0v4ras8n.js","assets/cbixnm84ireosly0.js","assets/ca6pihfn4nzu2hr0.js","assets/ljqk1ti0cdzpv7jp.js","assets/l20xuoh86vt5ltp3.js","assets/jrcn5pgxy87monl2.js","assets/fryg4d75k4u8c8g2.js","assets/ewcgetmyikugir9f.js","assets/eityua6nlv5j6zok.js","assets/kqwdyvkaaavvn8k3.js","assets/c1vhlymatzbrjjbv.js","assets/eci6p55lfimvbrx2.js","assets/cs1pbjud5beqmvob.js","assets/frmfbpruf1qisqhy.js","assets/m2sizihdyfg2gu3v.js","assets/00nn36n4egzr2nxv.js","assets/oxp2by0qo126nz59.js","assets/e6o3332cngm3w6wm.js","assets/l74dsvahvjko7x2l.js","assets/ichnffdslcmsb0or.js","assets/0qw1jhy087yufhi6.js","assets/jkonglxztpn5ee12.js","assets/nhwwej1nq0zrd7sc.js","assets/e3ygs2v36ydwizmu.js","assets/gcuqrnunbiet9qgw.js","assets/irlfwpllnqf5cc7o.js","assets/gljffeltmjrphbu7.js","assets/palr457pmwp2eo4q.js","assets/kidi4l5ce906yp53.js","assets/oee1jj3teyc36auu.js","assets/9zpogk6h5akl73bx.js","assets/nx3l3hp1lv6ydgza.js","assets/isjdmfmhzv09v01t.js","assets/nknjtrw58f7sj49v.js","assets/knl1rcx3vtbv6j5b.js","assets/dddo62xabqbk9f31.js","assets/k4ajx5lgdjzcvr8x.js","assets/d2bzhwoj671nm961.js","assets/jtn6511x7p3193oe.js","assets/m4twnw270ztnlmiz.js","assets/3hvo7nk5lthtt35t.js","assets/g2v6xabl9buinz5s.js","assets/oupfz0i0b4mb7gjz.js","assets/iej0cupg2dqkmejt.js","assets/o691e2lbzvmjn1c6.js","assets/jk8w36bsokizpx57.js","assets/jyu8zm911rprort0.js","assets/j1p0cnz4usckac9e.js","assets/ig8f6p5ucsumlhm4.js","assets/iz2mhlbiobeqe8he.js","assets/b2tciqdnf8m38qqo.js","assets/jpqsqnjtzaisfhgh.js","assets/ekec56inzvbn2coh.js","assets/clwolutsbvhxp28s.js","assets/zf6i5c345fifunq4.js","assets/b1szi5jvhen4gvnt.js","assets/mqp3qnuxehs7tnfk.js","assets/dh0f8516gl7ic2m5.js","assets/shared-mk6ngktc.css","assets/sso-jmjhjxeo.css","assets/fbe67wq9353lif06.js","assets/tgg9e4jo52j4ehc0.js"])))=>i.map(i=>d[i]);
var _o=Object.defineProperty;var Jn=t=>{throw TypeError(t)};var ko=(t,e,n)=>e in t?_o(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Z=(t,e,n)=>ko(t,typeof e!="symbol"?e+"":e,n),gn=(t,e,n)=>e.has(t)||Jn("Cannot "+n);var r=(t,e,n)=>(gn(t,e,"read from private field"),n?n.call(t):e.get(t)),V=(t,e,n)=>e.has(t)?Jn("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),E=(t,e,n,a)=>(gn(t,e,"write to private field"),a?a.call(t,n):e.set(t,n),n),j=(t,e,n)=>(gn(t,e,"access private method"),n);var As=(t,e,n,a)=>({set _(o){E(t,e,o,n)},get _(){return r(t,e,a)}});import{H as ze,cs as vt,j as s,N as _e,aC as is,ep as Pt,f8 as Aa,bD as To,r as m,aD as Na,R as Me,ag as Ks,c as se,cL as Ea,a7 as Nt,a4 as Os,M as fn,I as jo,as as Dt,A as $,K as F,aM as Qs,bt as nt,ak as Ue,P as ee,e5 as rs,cm as St,c2 as Ct,aN as Ys,B as Lt,bw as Ao,aU as No,fB as Eo,cN as pe,cA as Io,ax as Fo,cq as Un,fC as Ro,L as Po,fD as Ia,e9 as Fa,c8 as it,cD as Do,cE as Lo,cH as Zt,cF as Xn,cG as Oo,J as xt,fE as Uo,cK as zo,aQ as Us,a_ as Bo,cz as Ra,O as $e,d9 as Go,ai as Yt,fk as Ho,cX as Jt,eg as zs,bz as Wo,bM as ie,fw as Zn,bQ as at,w as Vo,fv as qo,fF as Pa,fj as $o,eH as Ko,u as Qo,E as Da,dl as Yo,X as Jo,fG as Xo,fH as Zo,bB as ei,cx as ti,fI as si,cZ as ni,c_ as ai,c$ as oi,ek as ii,fJ as ri,fK as ea,fh as li,bA as ci,aT as di,bo as ui}from"./hzfabz2o8ombe5jw.js";import{d as ls,g as hi,H as La,c as zn,A as mi,I as gi,S as fi,G as pi,z as xi,u as bi,a as yi,J as vi,m as Si,K as Ci,f as wi}from"./irzndtt8vp8asixn.js";import{G as Mi,T as _i}from"./m4ydchv9pwda8q8j.js";import{hJ as Oa,cr as Bn,cq as Gn,ct as Hn,n as Js,b2 as Wn,hK as ki,B as Ua,eC as ta,A as za,eG as Ti,be as ji,b1 as ts,U as Xs,hL as Ai,W as pn,bj as Ni,bJ as Ba,aE as Ga,gr as Ha,hM as Ei,dL as Ii,ax as Fi,hN as Ri,aa as Pi,cx as Di,c6 as Li,eA as Oi,u as ss,hO as Bs,dP as Wa,eq as Ui,a5 as zi,hP as Va,dT as Gs,er as Bi,am as cs,bT as Gi,bR as _n,a8 as Hi,hQ as Wi,r as Fs,eE as Vi,aR as kn,hR as qi,hS as $i,fU as Ki,gp as Qi,s as qa,hT as $a,hU as Yi,a0 as Ji,hV as Xi,v as Hs,aq as ot,bt as Ws,bZ as Vn,eK as Zi,hW as er,eH as Ka,a3 as tr,hX as sr,hY as nr,cN as ar,F as or,hZ as ir,h_ as rr,h$ as lr,i0 as cr,i1 as dr,i2 as ur,i3 as hr,i4 as mr,ej as sa,i5 as gr,eD as fr,k as pr,l as xr,i6 as br,eB as yr,E as vr,ad as Sr,cQ as Cr,i7 as na,hs as aa,i8 as wr,g3 as Mr,bi as _r,i9 as kr,eu as Tr,ev as jr,w as Ar,ia as Nr,gy as oa,ib as Er,P as Ir,ic as Fr,id as Rr,ie as Pr,ig as Dr,ih as Lr,ii as Or,ij as Ur,ik as zr}from"./fk2on43rkvczq1b9.js";import{a as Br,t as Tn,T as Qa,H as Gr,b as Hr,c as Wr,d as Vr,e as qr,M as Rs}from"./blijo2l4axfx8qll.js";import{P as $r,v as Kr,C as jn,w as Qr,l as Yr,x as xn,y as Jr,u as Xr,z as bn,F as Zr,T as el}from"./gcuqrnunbiet9qgw.js";import{e as tl,i as es,A as Ya,T as G,f as rt,g as Zs,u as en,b as sl,I as Ja,d as ds,c as tn,J as ia,j as ra,K as nl,q as sn,a as Xa,L as al,M as ol,N as il,k as rl,h as ll,O as cl,P as dl,Q as Za,w as qn,s as ul,t as hl,R as ml,S as eo,U as to,V as gl,W as fl,X as so}from"./iing67ocwnwqhcj6.js";import{W as pl,C as xl,G as bl,H as $n}from"./palr457pmwp2eo4q.js";import{m as Rt}from"./hq883kjug2canm9r.js";import{U as yl,b as Vs,bc as nn,aI as vl,ba as Sl,bP as no,bQ as ao,a2 as Cl,bR as wl,bS as Ml,aF as _l,bT as kl,w as Tl,ax as oo,ay as io,a as jl,aw as Al,av as Nl,S as El,t as Il,bg as Fl,bK as Rl}from"./e50u68bunhmm6ifm.js";import{H as Pl}from"./l7vevmmfmylbk0cs.js";import{G as Dl,L as Ll}from"./f5oehfbcbky1xftj.js";import{d as Ol,r as Ul}from"./ofosodv3ao9jq0q5.js";import{T as zl,u as Bl,M as ro,a as Gl,b as Hl,C as Wl,W as Vl}from"./9zpogk6h5akl73bx.js";import{b as ql,C as $l}from"./hxhkjo1bo8kdzzw0.js";import"./ljqk1ti0cdzpv7jp.js";import{D as je,$ as lo}from"./jyem616os9v6pvci.js";import{a as Kl,G as Ql}from"./p40rplitvwe5wrs5.js";import{M as Yl}from"./jyu8zm911rprort0.js";import{I as Jl}from"./ewcgetmyikugir9f.js";import{i as Xl}from"./kidi4l5ce906yp53.js";function yn({label:t,tooltip:e,Icon:n}){return s.jsxs("div",{className:"flex items-center gap-1 text-sm font-semibold opacity-70",children:[n&&s.jsx(n,{className:"icon-sm"}),s.jsx("div",{children:t}),s.jsx(Js,{label:e,children:s.jsx(Vs,{className:"icon-sm ml-1"})})]})}function Zl({clientThreadId:t,gizmoId:e}){const n=ze(),a=Oa(),o=Bn(),i=Gn(),{data:l}=Hn(e,!1,i),c=!!e,d=vt(),h=tl(t);return i?d&&(!h||c)?s.jsx(yn,{label:n.formatMessage(kt.temporaryChat),tooltip:n.formatMessage(kt.temporaryChatTooltip),Icon:yl}):a&&!o&&!d?s.jsx(yn,{label:n.formatMessage(kt.memoryOff),tooltip:n.formatMessage(kt.memoryOffTooltip)}):l&&(l==null?void 0:l.memoryFullPct)>=100?s.jsx(yn,{label:n.formatMessage(kt.memoryFull),tooltip:n.formatMessage(kt.memoryFullTooltip)}):null:null}const kt=_e({temporaryChat:{id:"ConversationPrivacyIndicator.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatTooltip:{id:"ConversationPrivacyIndicator.temporaryChatTooltip",defaultMessage:"Temporary Chats won't appear in your history, and ChatGPT won't remember anything you talk about."},memoryOff:{id:"ConversationPrivacyIndicator.memoryOff",defaultMessage:"Memory Off"},memoryOffTooltip:{id:"ConversationPrivacyIndicator.memoryOffTooltip",defaultMessage:"ChatGPT won't remember anything you talk about in this conversation."},memoryFull:{id:"2Eq+5y",defaultMessage:"Memory Full"},memoryFullTooltip:{id:"dNA8jQ",defaultMessage:"ChatGPT's memory is full. You can forget existing memories to make space."}}),la=4;function ec(t){const{layer:e}=is("4031588851"),{layer:n}=Pt("4031588851");return t?e.get("enable_new_homepage",!1):n.get("enable_new_homepage",!1)}function tc(){const{layer:t}=Pt("4031588851"),e=t.get("autocomplete_qualified_start_date","2099-09-13T00:00:00Z"),n=Wn();return!!n&&n.created*1e3>=new Date(e).getTime()}function sc(t){const{layer:e}=is("3533083032"),{layer:n}=Pt("3533083032");return t?e.get("enable_new_homepage_anon",!1):n.get("enable_new_homepage_anon",!1)}function nc(t){const{layer:e}=is("4031588851"),{layer:n}=Pt("4031588851");return t?e.get("enable_new_autocomplete_homepage",!1):n.get("enable_new_autocomplete_homepage",!1)}function ac(t){return s.jsx(pl,{children:e=>s.jsx(oc,{...t,composerController:e})})}function oc({clientThreadId:t,currentModelId:e,onRequestCompletion:n,composerController:a}){const o=es(t),i=Ya(t),l=Aa(),c=To(),[d,h]=m.useState([]),p=m.useRef(!1);ki(a);const f=Na("589604007").value,{layer:y}=Pt("4031588851"),{promptStarters:S,isSuccess:C,isError:g}=Br(o&&!i,t,c?4:8,f,!0,e),b=!!d.find(T=>!!T.requires_file_upload),u=m.useCallback(T=>{const R=a.getCurrentText();return R&&`${T.title}${T.body}`.toLowerCase().startsWith(R.toLowerCase())},[a]),x=m.useCallback(T=>{const R=a.getCurrentText(),k=T.title+T.body;return u(T)?{...T,title:R,body:k.slice(R.length)}:{...T,title:k,body:""}},[a,u]),w=m.useCallback((T=!1)=>{h(R=>!R.some(u)&&R.length>0?[]:T?R:R.map(x))},[u,x]),v=(T,R,k)=>{const K=`${T.title} `;h([]),a.focus(),a.setText(K),requestAnimationFrame(()=>{const O=((S==null?void 0:S.filter(q=>q.theme===T.theme))??[]).map(q=>({...q,title:`${q.title} `,type:ta.Autocomplete}));h(O),O.length>0&&Tn(O,t),Hr(T,k,t)})},A=S==null?void 0:S.reduce((T,R)=>(R.theme&&!T[R.theme]&&(T[R.theme]=R),T),{}),L=[];if(A)for(const T in A)L.push(A[T]);const N=L&&L.length>0,H=!!(C&&N),P=la-d.filter(u).length,_=y.get("autocomplete_mode","HARDCODED"),z=m.useCallback(Ua(async T=>{const R=a.getCurrentText();if(!R||R.length<2||R.length>80){h([]);return}if(!p.current)try{const K=(await Me.generateAutocompletions(R,T)).completions.map(O=>({id:Ks(),type:ta.Autocomplete,title:R,body:O.slice(R.length),oneliner:O,prompt:O})).filter(u).map(x);h(O=>{const q=O.filter(u),te=K.filter(ne=>!q.some(Be=>Be.title===ne.title&&Be.body===ne.body)).slice(0,la-q.length);return[...q,...te]}),K.length>0&&Tn(K,t)}catch{}},_==="BING"?150:200),[a,_,x]),W=m.useCallback(()=>{w(),P>0&&z(P)},[z,w,P]);m.useEffect(()=>{p.current&&h([])},[p]);const D=m.useMemo(()=>_==="HARDCODED"?w:W,[_,W,w]),Q=m.useCallback(()=>{a instanceof xl&&w(!0)},[a,w]);return s.jsx(s.Fragment,{children:s.jsx(za,{children:(g||C)&&s.jsx(s.Fragment,{children:s.jsx(Qa,{isStaticSharedThread:!1,showInlineEmbeddedDisplay:!1,withVerticalPadding:!0,withHorizontalPadding:!0,clientThreadId:t,children:s.jsxs(Gr,{children:[s.jsx(ic,{}),s.jsx("div",{className:"w-full",children:s.jsx($r,{clientThreadId:t,isNewThread:o,currentModelId:e,onRequestCompletion:n,showPromptStarters:!1,composerController:a,autocompletions:d,requiresFileUpload:b,onComposerInput:D,onComposerChange:Q,onAutocompleteSelect:(T,R,k)=>{h([R[k]])},onTaggingDropdownClose:()=>{p.current=!1},onTaggingDropdownOpen:()=>{p.current=!0},hideHeader:!0})}),H&&s.jsx(rc,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},promptStarters:L,onSelectStarterPrompt:v,isSendBlocked:l,clientThreadId:t,className:"h-8"})]})})})})})}function ic(){const{layer:t}=Pt("4031588851"),e=t.get("headline_option","HELP_WITH"),a=ze().formatMessage(e==="WHERE_TO_START"?An.whereShouldWeStart:An.whatCanIHelpWith),[o,i]=m.useState(1),[l,c]=m.useState(!0),d=20;return m.useEffect(()=>{let h;return o<a.length?h=setTimeout(()=>{i(o+1)},d):l&&(h=setTimeout(()=>{c(!1)},500)),()=>clearTimeout(h)},[a,o,l]),s.jsx("div",{className:"text-center",children:s.jsxs("div",{className:"mb-7 inline-flex justify-center text-2xl font-semibold leading-9",children:[s.jsx("h1",{children:a.substring(0,o)}),s.jsx("h1",{className:"result-streaming transition-opacity",style:{opacity:l?1:0},children:s.jsx("span",{})})]})})}function rc({promptStarters:t,onSelectStarterPrompt:e,isSendBlocked:n,clientThreadId:a,...o}){return s.jsx(Rt.div,{...o,children:s.jsx(uc,{starterPrompts:t,onSelectStarterPrompt:e,disabled:n,clientThreadId:a})})}const lc=/\s/;function cc({starterPrompt:t,starterPrompts:e,index:n,disabled:a,onSelectStarterPrompt:o}){const i=t.theme??t.title,l=lc.test(i);return s.jsxs("button",{className:"relative flex items-center gap-1.5 rounded-full border border-token-border-light px-3 py-2 text-start text-[13px] shadow-xxs transition enabled:hover:bg-token-main-surface-secondary disabled:cursor-not-allowed xl:gap-2 xl:text-[14px]",disabled:a,onClick:()=>o(t,e,n),children:[s.jsx(Ti,{starterPrompt:t,useV2Colors:!0}),s.jsx("div",{className:se("max-w-full text-balance text-gray-600 dark:text-gray-500",l?"break-word":"break-all"),children:i})]})}function ca({starterPrompts:t,onSelectStarterPrompt:e,disabled:n,clientThreadId:a,children:o}){return m.useEffect(()=>{Tn(t,a)},[a]),s.jsxs("ul",{className:"flex max-w-3xl flex-wrap items-stretch justify-center gap-2 xl:mx-3 xl:gap-2.5",children:[t.map((i,l)=>s.jsx(Rt.li,{initial:{opacity:0},animate:{opacity:1},transition:{delay:l*.03},exit:{opacity:0},children:s.jsx(cc,{starterPrompt:i,starterPrompts:t,index:l,disabled:n,onSelectStarterPrompt:e})},i.id??l)),o]})}function dc({clientThreadId:t,onClick:e}){m.useEffect(()=>{Wr(t)},[t]);const n=ze();return s.jsx("button",{className:"relative flex max-w-full items-center gap-2 text-balance rounded-full border border-token-border-light px-3 py-2 text-start text-[14px] text-gray-600 shadow-xxs transition enabled:hover:bg-token-main-surface-secondary disabled:cursor-not-allowed dark:text-gray-500",onClick:()=>{Vr(t),e()},children:n.formatMessage(An.moreStarterPrompts)})}function uc({starterPrompts:t,onSelectStarterPrompt:e,disabled:n,clientThreadId:a}){const[o,i]=m.useState(4),l=4,c=t.slice(0,l),d=t.slice(l,o).map(h=>({...h,isAdditional:!0}));return s.jsxs("div",{className:"mt-7 flex flex-col flex-wrap gap-y-2.5",children:[s.jsx("div",{children:s.jsx(ca,{starterPrompts:c,onSelectStarterPrompt:e,disabled:n,clientThreadId:a,children:t.length>o&&s.jsx(dc,{clientThreadId:a,onClick:()=>{i(t.length)}})})}),d&&d.length>0&&s.jsx(ca,{starterPrompts:d,onSelectStarterPrompt:e,disabled:n,clientThreadId:a})]})}const An=_e({whatCanIHelpWith:{id:"SplashScreenV2.whatCanIHelpWith",defaultMessage:"What can I help with?"},whereShouldWeStart:{id:"SplashScreenV2.whereShouldWeStart",defaultMessage:"Where should we start?"},moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),Tt=_e({submitRejectModeration:{id:"feedbackModal.moderationReject",defaultMessage:"Block Content"},submitAcceptModeration:{id:"feedbackModal.moderationAccept",defaultMessage:"Allow Content"},thumbsDownPlaceholder:{id:"feedbackModal.thumbsDownPlaceholder",defaultMessage:"What was the issue with the response? How could it be improved?"},copyrightContent:{id:"feedbackModal.copyrightContent",defaultMessage:"This content violates copyright law"},reportOtherContent:{id:"feedbackModal.reportOtherContent",defaultMessage:"I don't like this for some other reason (please describe)"},provideAdditionalFeedback:{id:"feedbackModal.provideAdditionalFeedback",defaultMessage:"Provide additional feedback"}});function hc({onClose:t,clientThreadId:e}){var u;const n=ze(),a=G.getTree(e),o=(u=m.useContext(Ea))==null?void 0:u.serverSharedThreadId,i=G.getServerThreadId(e),l=o??i,c=m.useRef([]),d=m.useRef(""),h=m.useRef(null),p=m.useCallback(()=>{var w;const x=(w=h.current)==null?void 0:w.elements;c.current=[...x||[]].filter(v=>v.checked).map(v=>v.id).map(v=>v.replace("feedback-","")),d.current=(x==null?void 0:x["feedback-other"].value)||""},[]),f=m.useCallback((x,w)=>{if(l==null){Nt.danger("Moderation NOT logged successfully! serverThreadId is null"),Os.addError("Moderation: serverThreadId is null");return}const v=a.getMessageId(G.getThreadCurrentLeafId(e));Me.submitSharedConversationReportFeedback({message_id:v,shared_conversation_id:l,text:x,tags:w}).then(()=>{Nt.success("Moderation logged successfully")}).catch(A=>{Nt.danger("Moderation NOT logged successfully! Please try again"),Os.addError(new Error("Moderation: failed to log",{cause:A}))}),t()},[a,e,t,l]),y=m.useCallback(()=>{p(),c.current.push("moderation-reject"),f(d.current,c.current)},[f,p]),S=m.useCallback(()=>{p(),c.current.push("moderation-accept"),f(d.current,c.current)},[f,p]),C=s.jsxs(s.Fragment,{children:[s.jsx(fn.Button,{title:n.formatMessage(Tt.submitRejectModeration),color:"danger",onClick:y}),s.jsx(fn.Button,{title:n.formatMessage(Tt.submitAcceptModeration),color:"primary",onClick:S})]}),[g,b]=m.useState([]);return m.useEffect(()=>{Me.fetchShareModerationCategories().then(x=>{const w=x.moderation_categories;b(Object.keys(w).map(v=>[v,w[v]]))})},[]),s.jsxs(jo,{isOpen:!0,onClose:t,showCloseButton:!0,size:"custom",className:"md:max-w-[672px] lg:max-w-[896px] xl:max-w-6xl",type:"success",title:n.formatMessage(Tt.provideAdditionalFeedback),children:[s.jsxs("form",{ref:h,children:[s.jsx(Ai,{id:"feedback-other",placeholder:n.formatMessage(Tt.thumbsDownPlaceholder),rows:3,className:"mb-1 mt-4 w-full resize-none rounded-md bg-token-main-surface-primary"}),s.jsxs("div",{className:"mb-4",children:[g.map(([x,w])=>s.jsx(pn,{id:"feedback-"+x,label:w},x)),s.jsx(pn,{id:"feedback-copyright",label:n.formatMessage(Tt.copyrightContent)}),s.jsx(pn,{id:"feedback-content-other",label:n.formatMessage(Tt.reportOtherContent)})]})]}),s.jsx(fn.Actions,{primaryButton:C})]})}function mc({clientThreadId:t}){return ji(ts.SharedConversationModeration)?s.jsx(hc,{onClose:()=>Xs.closeModal(ts.SharedConversationModeration),clientThreadId:t}):null}const gc=({clientThreadId:t})=>{const e=Dt(),n=rt(t),{data:a,isLoading:o}=ls(n);if(o)return null;const i=e!=null&&e.accountUserId?a?vn.loggedInCtaGizmo:vn.loggedInCta:vn.loggedOutCta,l=e&&a?hi(a):"/";let c=$.sharedConversationLoggedOutClicked;return e&&(e!=null&&e.accountUserId)&&(e.isFree()?c=a?$.sharedConversationFreeGizmoClicked:$.sharedConversationFreeClicked:c=a?$.sharedConversationPaidGizmoClicked:$.sharedConversationPaidClicked),s.jsx("div",{className:"flex flex-col items-center gap-4",children:s.jsx(Ni,{href:l,onClickTrackingEventName:c,children:s.jsx(F,{...i,values:{name:a==null?void 0:a.gizmo.display.name}})})})},vn=_e({loggedOutCta:{id:"GizmoSharedConversationCTA.loggedOutCta",defaultMessage:"Sign up to chat"},loggedInCtaGizmo:{id:"GizmoSharedConversationCTA.loggedInCtaGizmo",defaultMessage:"Get started with {name}"},loggedInCta:{id:"GizmoSharedConversationCTA.loggedInCta",defaultMessage:"Get started with ChatGPT"}});function fc({clientThreadId:t,isModeratingThread:e,continueConversationUrl:n}){const a=Qs(),o=ze(),{layer:i}=is("2840731323"),l=i.get("is_continue_enabled",!1)||(a==null?void 0:a.includes("debug"));return s.jsxs("div",{className:"relative flex w-full flex-1 flex-col items-center justify-center gap-2 pt-3 empty:hidden sm:flex-row",children:[!l&&s.jsx(gc,{clientThreadId:t}),e&&s.jsx(nt,{onClick:()=>{Xs.openModal(ts.SharedConversationModeration)},children:o.formatMessage({id:"thread.sharedConversation.moderate",defaultMessage:"Moderate conversation"})}),l&&n&&s.jsx(nt,{color:"primary",as:"link",to:n,size:"giant",onClick:()=>{Ue.logEvent("chatgpt_continue_shared_conversation_click"),ee.logEvent($.sharedConversationContinueConversationClicked)},children:o.formatMessage({id:"thread.sharedConversation.continue",defaultMessage:"Continue this conversation"})})]})}function pc({children:t}){const e=Ba(Ga.AG8PqS2q),{eligible:n,isLoading:a}=Ol(),{doesUserHaveAnyAccountsWithPlusFeatures:o}=rs(),i=n&&!a;if(m.useEffect(()=>{i&&ee.logEvent($.gpt4oNUXTooltipShown)},[i]),!i)return s.jsx(s.Fragment,{children:t});const l=()=>{ee.logEvent($.gpt4oNUXTooltipDismissed),e.markAsViewed()};return s.jsx(Ha,{side:"bottom",show:!0,title:s.jsx(F,{...Sn.title,values:{modelName:"GPT‑4o"}}),onDismiss:l,sideOffset:0,theme:"default",description:s.jsx(F,{...o?Sn.bodyPaidFinal:Sn.bodyFreeFinal,values:{modelName:"GPT‑4o",anotherModelName:"GPT‑4"}}),children:t})}const Sn=_e({title:{id:"1kewDD",defaultMessage:"Introducing {modelName}"},bodyPaidFinal:{id:"Z6KHqN",defaultMessage:"You can now try our newest model, {modelName}. It’s faster than {anotherModelName}, better at understanding images, and speaks more languages."},bodyFreeFinal:{id:"w8Y79o",defaultMessage:"You now have limited access to our latest model, {modelName}. It’s smarter, understands images, can browse the web, and speaks more languages."}}),xc=St(()=>Ct(()=>import("./t7ec6vag48x6aig7.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30])).then(t=>t.GizmoUsingAsOwnerNotice)),bc=({clientThreadId:t})=>{const e=Pi(d=>d.activeStageSidebar),n=G.getServerThreadId(t),a=Di(Ys.WorkspaceShareLinks),{isUnauthenticated:o}=Lt(),i=vt(),l=a&&n&&!o&&!i,c=!e;return s.jsx("div",{className:"flex items-center gap-2 pr-1 leading-[0]",children:s.jsx($l,{showShareButton:l,showProfileDropdown:c,clientThreadId:t})})};function yc({clientThreadId:t,gizmoId:e}){var i;const n=Ei(),{data:a}=ls(e),o=Dt();return s.jsxs(s.Fragment,{children:[s.jsxs(Ii,{className:"max-md:hidden",children:[s.jsxs("div",{className:"absolute start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2",children:[a!=null&&(o==null?void 0:o.isWorkspaceAccount())&&((i=a.gizmo.tags)==null?void 0:i.includes(Fi.WorkspaceDisabled))&&s.jsx(xc,{gizmo:a}),s.jsx(Zl,{gizmoId:e,clientThreadId:t})]}),s.jsx(pc,{children:s.jsxs("div",{className:"flex items-center gap-0 overflow-hidden",children:[s.jsx(ql,{clientThreadId:t}),s.jsx(zl,{clientThreadId:t})]})}),s.jsx(bc,{clientThreadId:t})]}),n&&s.jsx(Ri,{})]})}function co({clientThreadId:t}){const e=rt(t);return Zs()?null:s.jsx(yc,{gizmoId:e,clientThreadId:t})}function vc({clientThreadId:t,currentModelId:e,onRequestCompletion:n,enableV2Homepage:a}){const o=vt();let i=s.jsx(Ll,{}),l;return o?(l=s.jsx(Sc,{}),i=s.jsx(No,{className:"mb-6 h-12 w-12"})):t!=null?(l=a?s.jsx(ac,{clientThreadId:t,currentModelId:e,onRequestCompletion:n}):s.jsx(qr,{clientThreadId:t}),i=null):l=s.jsx(Cc,{}),s.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-token-text-primary",children:[i,l]})}function Sc({gizmo:t}){const e=Oa(),n=t?bl(t.tools):!1,a=Dt();return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"mb-5 text-2xl font-semibold",children:s.jsx(F,{...ft.temporaryChat})}),s.jsxs("div",{className:"max-w-sm text-center text-sm font-normal text-token-text-tertiary",children:[s.jsx(F,{...a!=null&&a.isWorkspaceAccount()?e?ft.temporaryChatBizMemoryAvailable:ft.temporaryChatBizMemoryUnavailable:e?ft.temporaryChatDescriptionMemoryAvailable:ft.temporaryChatDescriptionMemoryUnavailable}),n&&s.jsx("div",{className:"mt-3",children:s.jsx(F,{...ft.temporaryChatDescriptionGptActions,values:{link:o=>s.jsx("a",{href:"https://help.openai.com/en/articles/8914046-temporary-chat-faq",target:"_blank",className:"underline",rel:"noreferrer",children:o})}})})]})]})}function Cc(){return s.jsx("div",{className:"mb-5 text-2xl font-semibold",children:s.jsx(F,{...ft.howCanIHelpYouToday})})}function wc({clientThreadId:t,currentModelId:e,onRequestCompletion:n,enableV2Homepage:a}){const o=rt(t),i=Li(),l=Aa(),{data:c}=ls(o),d=Oi(),h=Ao(()=>navigator.windowControlsOverlay);return(i!=null||o!=null)&&c==null?null:s.jsxs("div",{className:"relative h-full",children:[s.jsx("div",{className:h!=null&&h.visible?se("absolute right-[calc(100dvw-env(titlebar-area-width,100dvw)-env(titlebar-area-x,0))]",d?"left-[env(titlebar-area-x,0)]":"left-0"):"absolute left-0 right-0",children:s.jsx(co,{clientThreadId:t})}),c!=null?s.jsx(Dl,{gizmo:c,showStarterPrompts:!0,disableStarterPrompts:l}):s.jsx(vc,{clientThreadId:t,currentModelId:e,onRequestCompletion:n,enableV2Homepage:a})]})}const ft=_e({temporaryChat:{id:"GizmoLanding.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatBizMemoryAvailable:{id:"g1opBW",defaultMessage:"This chat won't appear in your history and won't use or create memories."},temporaryChatBizMemoryUnavailable:{id:"fQmbtG",defaultMessage:"This chat won't appear your conversation history."},temporaryChatDescriptionMemoryAvailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryAvailable",defaultMessage:"This chat won't appear in history, use or create memories, or be used to train our models. For safety purposes, we may keep a copy for up to 30 days."},temporaryChatDescriptionMemoryUnavailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryUnavailable",defaultMessage:"This chat won't appear in history or be used to train our models. For safety purposes, we may keep a copy of this chat for up to 30 days."},temporaryChatDescriptionGptActions:{id:"GizmoLanding.temporaryChatDescriptionGptActions",defaultMessage:"Any data shared with a third party through GPT actions are subject to the third party's privacy policy. <link>Learn more</link>"},howCanIHelpYouToday:{id:"GizmoLanding.howCanIHelpYouToday",defaultMessage:"How can I help you today?"}});function uo(t){const n=en(t)==="root",a=sl(t),o=ss(a),{serviceStatus:i}=m.useContext(Eo),l=Bs(),{isUnauthenticated:c}=Lt(),d=Ja(t);return!n&&!o&&!(i!=null&&i.oof)&&!l.displayingSideBySideFeedback&&!c&&!d}const ho=({clientThreadId:t,message:e})=>{var x,w,v,A,L,N,H,P;const n=Bl(),a=La(),o=Ba(Ga.ModelSwitcherAutoDowngrade),{categories:i}=zn({isRegen:!0}),l=mi({clientThreadId:t}),{doesUserHaveAnyAccountsWithPlusFeatures:c}=rs(),d=gi()!=null,h=[];for(const _ of i){if(Wa(_))continue;const{defaultModel:z,label:W,tagline:D,categoryId:Q,subscriptionLevel:T,subcategory:R}=_,k=(w=(x=l[z])==null?void 0:x.regenerate)==null?void 0:w[0];h.push({label:W,value:z,subtitle:D,icon:s.jsx(ro,{className:"icon-md h-4 w-4",categoryId:Q,type:"filled"}),modelSwitcherDeny:k,subscriptionLevel:T,subcategory:R})}const p=Mc(t,e.nodeId),f=(v=e.message.metadata)==null?void 0:v.model_slug,y=(A=n.find(_=>_.value===f))==null?void 0:A.name,S=f!=null?a[f]:void 0,C=(S==null?void 0:S.enabledTools)||[],g=_c(d,p,f),b=(L=e.message.metadata)==null?void 0:L.model_adjustments,u=c&&o.eligible&&!o.isLoading&&y&&((N=h[0])==null?void 0:N.label)&&y!==((H=h[0])==null?void 0:H.label)&&(b==null?void 0:b.some(_=>_.startsWith("auto:smaller_model")));return{modelOptions:h,modelSlug:f,messageModelEnabledTools:C,animateModelLabelOnRender:g,nuxProps:{shouldRenderNux:u,usedModelName:y,largestModelName:(P=h[0])==null?void 0:P.label,announcement:o}}};function Mc(t,e){var l,c;return(c=(l=G.getTree(t).getConversationTurns(e).flatMap(d=>d.messages).filter(d=>d.message.author.role===pe.Assistant&&!Io(d.message)).reverse()[1])==null?void 0:l.message.metadata)==null?void 0:c.model_slug}function _c(t,e,n){return t&&!e?!0:!!(e&&n!==e)}function kc(){const{doesUserHaveAnyAccountsWithPlusFeatures:t}=rs(),{categories:e}=zn();return!!t||!!e.find(Wa)}const At=({modelSwitcherDeny:t,value:e,label:n,subtitle:a,icon:o,onMouseEnter:i,onMouseLeave:l,onSelect:c,messageModelSlug:d,isHovered:h=!1,shouldShowUpsell:p=!1,className:f,includeCheck:y,includeRegenerate:S,justifyIcon:C,wrapIcon:g=!0})=>{const b=Dt(),u=!t,x=!u&&!p,w=Fo(),v=()=>{if(!p){c==null||c();return}ee.logEvent($.openModalAccountPaymentfromMessageModelPicker),ee.logRateLimitGetPlusButtonClicked({type:Un.RATE_LIMIT,location:"message_model_switcher_dropdown",plan_type:(b==null?void 0:b.planType)??"unknown",is_hard_block:!1,hard_block_reason:"",is_new_conversation:!1}),zi(w,"Message model switcher dropdown")};return s.jsx(je.Item,{onSelect:v,onMouseEnter:()=>u&&(i==null?void 0:i()),onMouseLeave:()=>u&&(l==null?void 0:l()),disabled:x,className:f??"radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed radix-disabled:hover:bg-transparent",children:s.jsxs(Js,{label:t&&s.jsx(Ui,{modelSwitcherDeny:t}),className:"flex w-full items-center justify-between gap-2",sideOffset:0,children:[s.jsxs("div",{className:se("flex items-center gap-3",C==="right"&&"w-full"),children:[!!o&&(g?s.jsx("span",{className:se("flex h-7 w-7 items-center justify-center rounded-full bg-token-main-surface-secondary",C==="right"&&"order-10 ml-auto"),children:o}):o),s.jsxs("div",{children:[s.jsx("div",{children:n}),s.jsx("div",{className:se({"text-sm text-token-text-secondary":!x},{"text-sm text-token-text-quaternary":x}),children:a})]})]}),p?s.jsx(nt,{color:"secondary",size:"small",children:s.jsx(F,{id:"54fmrA",defaultMessage:"Get Plus"})}):s.jsx(Tc,{messageModelSlug:d,isHovered:h,modelSwitcherDeny:t,optionModelSlug:e,includeCheck:y,includeRegenerate:S})]})})},Tc=({modelSwitcherDeny:t,optionModelSlug:e,isHovered:n,messageModelSlug:a,includeRegenerate:o=!0,includeCheck:i=!0})=>{let l=null;if(t)switch(t.reason){case Un.RATE_LIMIT:l=Sl;break;default:l=Vs;break}if(t)return s.jsx(l,{className:"icon-md"});const c=!!o&&s.jsx(nn,{className:se("icon-md hidden text-token-text-tertiary",{"group-hover:block":n})});return a===e&&i?s.jsxs(s.Fragment,{children:[s.jsx(vl,{className:se("icon-md text-token-text-primary",{"group-hover:hidden":n})}),c]}):c};function jc({className:t,clientThreadId:e,message:n,onModelSelect:a,onDropdownChange:o}){var R;const i=ze(),[l,c]=m.useState(null),[d,h]=m.useState(!1),[p,f]=m.useState(!1),y=kc(),S=uo(e),C=rt(e),g=ho({clientThreadId:e,message:n}),b=(R=n.message.metadata)==null?void 0:R.model_slug,{modelOptions:u,modelSlug:x,animateModelLabelOnRender:w,nuxProps:v,messageModelEnabledTools:A}=g,L=Va(n.message),N=A.includes(Gs.Search),H=m.useMemo(()=>u.find(k=>k.value==b),[u,b]),{doesUserHaveAnyAccountsWithPlusFeatures:P}=rs(),_=m.useRef(null),z=k=>{k||setTimeout(()=>{_.current&&_.current.blur()},10)};if(m.useEffect(()=>{z(d)},[d]),!y||C)return null;const W=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:i.formatMessage(da.search),icon:s.jsx(no,{className:"icon-sm"}),condition:N&&!L},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:i.formatMessage(da.nosearch),icon:s.jsx(ao,{className:"icon-sm"}),condition:N&&L}];let D,Q;v.shouldRenderNux?(D=Nc,Q={title:s.jsx(F,{id:"g/+2Hh",defaultMessage:"Optimized your response"}),description:s.jsx(F,{id:"H0Flqm",defaultMessage:"Used {usedModelName} for a faster response that saves your limited {largestModelName} messages",values:{usedModelName:v.usedModelName,largestModelName:v.largestModelName}}),markAsViewed:v.announcement.markAsViewed}):(D=Ac,Q={label:S?s.jsx(F,{id:"LBYK9a",defaultMessage:"Change model"}):s.jsx(F,{id:"nygjPN",defaultMessage:"Used {modelName}",values:{modelName:v.usedModelName}})});const T=S&&u.some(k=>ns(k,P));return s.jsxs(je.Root,{onOpenChange:k=>{S&&(h(k),o(k),z(k)),k&&ee.logEvent($.conversationOpenMessageModelSelector,{has_get_plus_button:T})},children:[s.jsx(D,{...Q,children:s.jsx(lo,{ref:_,className:se("cursor-pointer",t),onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:s.jsx(Nn,{modelSlug:x,animateModelLabelOnRender:w,isDropdownOpen:d,isRegenerateEnabled:S,isHovered:p})})}),S&&s.jsxs(je.Content,{className:"z-30 origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[u.map(k=>{var te;const K=ns(k,P),{value:O,...q}=k;return s.jsx(At,{value:O,onSelect:()=>a({requestedModelId:O}),onMouseEnter:()=>c(O),onMouseLeave:()=>c(null),isHovered:l===O,messageModelSlug:(te=n.message.metadata)==null?void 0:te.model_slug,shouldShowUpsell:K,...q},O)}),!!H&&s.jsxs(s.Fragment,{children:[s.jsx(je.Separator,{}),W.filter(k=>k.condition).map(k=>s.jsx(At,{onSelect:()=>a({requestedModelId:H.value,extraStreamParams:k.extraStreamParams}),includeRegenerate:!0,onMouseEnter:()=>c(k.key),onMouseLeave:()=>c(null),isHovered:l===k.key,messageModelSlug:b,includeCheck:!1,...H,label:k.label,subtitle:"",icon:k.icon},k.key))]})]})]})}function Nn({modelSlug:t,animateModelLabelOnRender:e,isDropdownOpen:n,isRegenerateEnabled:a,isHovered:o,isRegenLabel:i=!1,animateShortLabel:l,omitIcon:c}){const[d,h]=m.useState("initial"),{categories:p}=zn({isRegen:!!i});m.useEffect(()=>{if(e){const u=setTimeout(()=>h("show"),500),x=setTimeout(()=>h("initial"),2e3);return()=>{clearTimeout(u),clearTimeout(x)}}h("initial")},[e]);const f=p.find(({defaultModel:u})=>u===t),y=t===fi?{categoryId:"gpt_3.5",shorterLabel:"3.5"}:{},{categoryId:S,shorterLabel:C}=f??y,g={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},b=n?"visible":o?"show":d;return s.jsxs(Rt.div,{initial:"initial",animate:b,className:"flex items-center pb-0",children:[!c&&(i?s.jsx(nn,{className:"icon-md"}):S&&s.jsx(ro,{type:"outline",categoryId:S,className:"icon-md h-4 w-4"})),(a||l)&&s.jsx(Rt.span,{className:"overflow-hidden text-clip whitespace-nowrap text-sm",variants:g,transition:{type:"tween",duration:.18},children:C}),a&&s.jsx(Cl,{className:se("icon-sm",{"text-token-text-quaternary":!o&&!i},{"text-token-text-secondary":o&&!i})})]})}function Ac({children:t,label:e}){return s.jsx(Js,{label:e,sideOffset:0,children:t})}function Nc({children:t,title:e,description:n,markAsViewed:a}){return s.jsx(Ha,{show:!0,side:"bottom",sideOffset:-4,title:e,description:n,badge:"beta",onDismiss:a,dismissOnOutsideClick:!0,children:t})}function ns(t,e){const{modelSwitcherDeny:n,subscriptionLevel:a}=t;return!!n&&n.reason===Un.RATE_LIMIT&&a===Ro.PLUS&&!e}const da=_e({search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Ec=m.memo(jc),ua=Po.IndepthFeedbackDismissedAt;function Ic(){const[t,e]=m.useState(()=>{const a=localStorage.getItem(ua);return a?Fc(new Date(a)):!1}),n=m.useCallback(()=>{e(!0),localStorage.setItem(ua,new Date().toISOString())},[]);return[t,n]}function Fc(t){const e=new Date;return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}function Rc({clientThreadId:t,conversationLeafId:e,trigger:n,variantIds:a}){const o=a.find(p=>p!==e),i=cs(p=>p.forceIndepthFeedback&&p.forceIndepthFeedbackPrompt),l=Ue.getExperimentValue({experimentName:"4146182738",key:n==="paragen"?"enable_indepth_feedback_paragen":"enable_indepth_feedback_thumbsdown",defaultValue:!1,shouldLogExposure:!1}),c=Ue.getExperimentValue({experimentName:"4146182738",key:n==="paragen"?"indepth_feedback_paragen_prompt":"indepth_feedback_thumbsdown_prompt",defaultValue:"",shouldLogExposure:!1}),d=o?G.getTree(t).getTextFromNode(o):"NONE";return(i||(l?c:"")).replace("{paragen_losing_response}",d)}function Pc({clientThreadId:t,conversationLeafId:e,trigger:n,variantIds:a}){const[o,i]=Ic(),l=Lc({clientThreadId:t}),c=Rc({clientThreadId:t,conversationLeafId:e,trigger:n,variantIds:a}),d=()=>{i(),ee.logEventWithStatsig($.messageIndepthFeedbackDeclined,"chatgpt_indepth_feedback_declined",{trigger:n})},h=()=>{const p=new _n;l(e,{intent:"indepth_feedback"},c,p),ee.logEventWithStatsig($.messageIndepthFeedbackAccepted,"chatgpt_indepth_feedback_accepted",{trigger:n})};return o||!c?null:s.jsx(Gi,{content:s.jsx(F,{...Cn.indepthFeedbackPrompt}),primaryCtaText:s.jsx(F,{...Cn.indepthFeedbackAcceptButton}),onPrimaryCtaClick:h,secondaryCtaText:s.jsx(F,{...Cn.indepthFeedbackRejectButton}),onSecondaryCtaClick:d})}function Dc(t){const e=t.rating==="thumbsDown"?"thumbsDown":Bi(["original","new"],t.inlineComparisonRating)?"paragen":void 0,n=cs(o=>o.forceIndepthFeedback);if(!e||n||e==="paragen"||Ue.getExperimentValue({experimentName:"4146182738",key:"enable_indepth_feedback_thumbsdown",defaultValue:!1,shouldLogExposure:!0}))return e}function Lc({clientThreadId:t}){const e=m.useContext(Ia),n=ds.getConversationMode(t);return(o,i,l,c)=>{e({type:Fa.Next,promptId:o,eventMetadata:i,focusOnNewCompletion:!0,cancelActiveRequests:!1,completionMetadata:{conversationMode:n},useDefaultModel:!1,appendMessages:[{id:Ks(),author:{role:pe.System},content:{content_type:it.Text,parts:[l]},metadata:{is_indepth_feedback:!0,indepth_feedback_prompt:l}}],turnTracker:c})}}const Cn=_e({indepthFeedbackPrompt:{id:"qEHwDx",defaultMessage:"Would you like to tell ChatGPT more about your feedback, so it can improve its responses?"},indepthFeedbackAcceptButton:{id:"IeyTQ7",defaultMessage:"Continue"},indepthFeedbackRejectButton:{id:"+o5xmp",defaultMessage:"Not now"},indepthFeedbackRejectAlwaysButton:{id:"Qdko+f",defaultMessage:"Don't ask again"}});function Oc({clientThreadId:t,conversationMode:e}){const n=Kr(t);return({id:o,eventMetadata:i,turnTracker:l,requestedModelId:c,systemMessage:d,juice:h,extraStreamParams:p})=>{const y=G.getTree(t).getConversationTurns(o),S=y==null?void 0:y[(y==null?void 0:y.length)-1].variantIds,C=(S==null?void 0:S.length)===1&&(p==null?void 0:p.forceUseSearch)===void 0,g=C?{...i,intent:"comparison_implicit"}:i;n({id:o,requestedModelId:c,eventMetadata:g,focusOnNewCompletion:!0,variantPurpose:C?"comparison_implicit":"none",conversationMode:e??ds.getConversationMode(t),useDefaultModel:!1,appendMessages:d?[{id:Ks(),author:{role:pe.System},content:{content_type:it.Text,parts:[d]},metadata:{exclude_after_next_user_message:!0}}]:void 0,juice:h,turnTracker:l,extraStreamParams:p})}}const jt=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,mo=new Set,En=typeof process=="object"&&process?process:{},go=(t,e,n,a)=>{typeof En.emitWarning=="function"?En.emitWarning(t,e,n,a):console.error(`[${n}] ${e}: ${t}`)};let qs=globalThis.AbortController,ha=globalThis.AbortSignal;var ka;if(typeof qs>"u"){ha=class{constructor(){Z(this,"onabort");Z(this,"_onabort",[]);Z(this,"reason");Z(this,"aborted",!1)}addEventListener(a,o){this._onabort.push(o)}},qs=class{constructor(){Z(this,"signal",new ha);e()}abort(a){var o,i;if(!this.signal.aborted){this.signal.reason=a,this.signal.aborted=!0;for(const l of this.signal._onabort)l(a);(i=(o=this.signal).onabort)==null||i.call(o,a)}}};let t=((ka=En.env)==null?void 0:ka.LRU_CACHE_IGNORE_AC_WARNING)!=="1";const e=()=>{t&&(t=!1,go("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}const Uc=t=>!mo.has(t),Ze=t=>t&&t===Math.floor(t)&&t>0&&isFinite(t),fo=t=>Ze(t)?t<=Math.pow(2,8)?Uint8Array:t<=Math.pow(2,16)?Uint16Array:t<=Math.pow(2,32)?Uint32Array:t<=Number.MAX_SAFE_INTEGER?Ps:null:null;class Ps extends Array{constructor(e){super(e),this.fill(0)}}var Et;const pt=class pt{constructor(e,n){Z(this,"heap");Z(this,"length");if(!r(pt,Et))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new n(e),this.length=0}static create(e){const n=fo(e);if(!n)return[];E(pt,Et,!0);const a=new pt(e,n);return E(pt,Et,!1),a}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}};Et=new WeakMap,V(pt,Et,!1);let In=pt;var Ta,ja,Ee,ve,Ie,Fe,It,oe,Re,ae,X,I,ge,Se,me,ce,Pe,de,De,Le,Ce,Oe,st,fe,M,Rn,bt,Ve,as,we,po,yt,Ft,os,et,tt,Pn,Ds,Ls,J,Dn,Xt;const Yn=class Yn{constructor(e){V(this,M);V(this,Ee);V(this,ve);V(this,Ie);V(this,Fe);V(this,It);Z(this,"ttl");Z(this,"ttlResolution");Z(this,"ttlAutopurge");Z(this,"updateAgeOnGet");Z(this,"updateAgeOnHas");Z(this,"allowStale");Z(this,"noDisposeOnSet");Z(this,"noUpdateTTL");Z(this,"maxEntrySize");Z(this,"sizeCalculation");Z(this,"noDeleteOnFetchRejection");Z(this,"noDeleteOnStaleGet");Z(this,"allowStaleOnFetchAbort");Z(this,"allowStaleOnFetchRejection");Z(this,"ignoreFetchAbort");V(this,oe);V(this,Re);V(this,ae);V(this,X);V(this,I);V(this,ge);V(this,Se);V(this,me);V(this,ce);V(this,Pe);V(this,de);V(this,De);V(this,Le);V(this,Ce);V(this,Oe);V(this,st);V(this,fe);V(this,bt,()=>{});V(this,Ve,()=>{});V(this,as,()=>{});V(this,we,()=>!1);V(this,yt,e=>{});V(this,Ft,(e,n,a)=>{});V(this,os,(e,n,a,o)=>{if(a||o)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0});Z(this,Ta,"LRUCache");const{max:n=0,ttl:a,ttlResolution:o=1,ttlAutopurge:i,updateAgeOnGet:l,updateAgeOnHas:c,allowStale:d,dispose:h,disposeAfter:p,noDisposeOnSet:f,noUpdateTTL:y,maxSize:S=0,maxEntrySize:C=0,sizeCalculation:g,fetchMethod:b,noDeleteOnFetchRejection:u,noDeleteOnStaleGet:x,allowStaleOnFetchRejection:w,allowStaleOnFetchAbort:v,ignoreFetchAbort:A}=e;if(n!==0&&!Ze(n))throw new TypeError("max option must be a nonnegative integer");const L=n?fo(n):Array;if(!L)throw new Error("invalid max value: "+n);if(E(this,Ee,n),E(this,ve,S),this.maxEntrySize=C||r(this,ve),this.sizeCalculation=g,this.sizeCalculation){if(!r(this,ve)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(b!==void 0&&typeof b!="function")throw new TypeError("fetchMethod must be a function if specified");if(E(this,It,b),E(this,st,!!b),E(this,ae,new Map),E(this,X,new Array(n).fill(void 0)),E(this,I,new Array(n).fill(void 0)),E(this,ge,new L(n)),E(this,Se,new L(n)),E(this,me,0),E(this,ce,0),E(this,Pe,In.create(n)),E(this,oe,0),E(this,Re,0),typeof h=="function"&&E(this,Ie,h),typeof p=="function"?(E(this,Fe,p),E(this,de,[])):(E(this,Fe,void 0),E(this,de,void 0)),E(this,Oe,!!r(this,Ie)),E(this,fe,!!r(this,Fe)),this.noDisposeOnSet=!!f,this.noUpdateTTL=!!y,this.noDeleteOnFetchRejection=!!u,this.allowStaleOnFetchRejection=!!w,this.allowStaleOnFetchAbort=!!v,this.ignoreFetchAbort=!!A,this.maxEntrySize!==0){if(r(this,ve)!==0&&!Ze(r(this,ve)))throw new TypeError("maxSize must be a positive integer if specified");if(!Ze(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");j(this,M,po).call(this)}if(this.allowStale=!!d,this.noDeleteOnStaleGet=!!x,this.updateAgeOnGet=!!l,this.updateAgeOnHas=!!c,this.ttlResolution=Ze(o)||o===0?o:1,this.ttlAutopurge=!!i,this.ttl=a||0,this.ttl){if(!Ze(this.ttl))throw new TypeError("ttl must be a positive integer if specified");j(this,M,Rn).call(this)}if(r(this,Ee)===0&&this.ttl===0&&r(this,ve)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!r(this,Ee)&&!r(this,ve)){const N="LRU_CACHE_UNBOUNDED";Uc(N)&&(mo.add(N),go("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",N,Yn))}}static unsafeExposeInternals(e){return{starts:r(e,Le),ttls:r(e,Ce),sizes:r(e,De),keyMap:r(e,ae),keyList:r(e,X),valList:r(e,I),next:r(e,ge),prev:r(e,Se),get head(){return r(e,me)},get tail(){return r(e,ce)},free:r(e,Pe),isBackgroundFetch:n=>{var a;return j(a=e,M,J).call(a,n)},backgroundFetch:(n,a,o,i)=>{var l;return j(l=e,M,Ls).call(l,n,a,o,i)},moveToTail:n=>{var a;return j(a=e,M,Xt).call(a,n)},indexes:n=>{var a;return j(a=e,M,et).call(a,n)},rindexes:n=>{var a;return j(a=e,M,tt).call(a,n)},isStale:n=>{var a;return r(a=e,we).call(a,n)}}}get max(){return r(this,Ee)}get maxSize(){return r(this,ve)}get calculatedSize(){return r(this,Re)}get size(){return r(this,oe)}get fetchMethod(){return r(this,It)}get dispose(){return r(this,Ie)}get disposeAfter(){return r(this,Fe)}getRemainingTTL(e){return r(this,ae).has(e)?1/0:0}*entries(){for(const e of j(this,M,et).call(this))r(this,I)[e]!==void 0&&r(this,X)[e]!==void 0&&!j(this,M,J).call(this,r(this,I)[e])&&(yield[r(this,X)[e],r(this,I)[e]])}*rentries(){for(const e of j(this,M,tt).call(this))r(this,I)[e]!==void 0&&r(this,X)[e]!==void 0&&!j(this,M,J).call(this,r(this,I)[e])&&(yield[r(this,X)[e],r(this,I)[e]])}*keys(){for(const e of j(this,M,et).call(this)){const n=r(this,X)[e];n!==void 0&&!j(this,M,J).call(this,r(this,I)[e])&&(yield n)}}*rkeys(){for(const e of j(this,M,tt).call(this)){const n=r(this,X)[e];n!==void 0&&!j(this,M,J).call(this,r(this,I)[e])&&(yield n)}}*values(){for(const e of j(this,M,et).call(this))r(this,I)[e]!==void 0&&!j(this,M,J).call(this,r(this,I)[e])&&(yield r(this,I)[e])}*rvalues(){for(const e of j(this,M,tt).call(this))r(this,I)[e]!==void 0&&!j(this,M,J).call(this,r(this,I)[e])&&(yield r(this,I)[e])}[(ja=Symbol.iterator,Ta=Symbol.toStringTag,ja)](){return this.entries()}find(e,n={}){for(const a of j(this,M,et).call(this)){const o=r(this,I)[a],i=j(this,M,J).call(this,o)?o.__staleWhileFetching:o;if(i!==void 0&&e(i,r(this,X)[a],this))return this.get(r(this,X)[a],n)}}forEach(e,n=this){for(const a of j(this,M,et).call(this)){const o=r(this,I)[a],i=j(this,M,J).call(this,o)?o.__staleWhileFetching:o;i!==void 0&&e.call(n,i,r(this,X)[a],this)}}rforEach(e,n=this){for(const a of j(this,M,tt).call(this)){const o=r(this,I)[a],i=j(this,M,J).call(this,o)?o.__staleWhileFetching:o;i!==void 0&&e.call(n,i,r(this,X)[a],this)}}purgeStale(){let e=!1;for(const n of j(this,M,tt).call(this,{allowStale:!0}))r(this,we).call(this,n)&&(this.delete(r(this,X)[n]),e=!0);return e}info(e){const n=r(this,ae).get(e);if(n===void 0)return;const a=r(this,I)[n],o=j(this,M,J).call(this,a)?a.__staleWhileFetching:a;if(o===void 0)return;const i={value:o};if(r(this,Ce)&&r(this,Le)){const l=r(this,Ce)[n],c=r(this,Le)[n];if(l&&c){const d=l-(jt.now()-c);i.ttl=d,i.start=Date.now()}}return r(this,De)&&(i.size=r(this,De)[n]),i}dump(){const e=[];for(const n of j(this,M,et).call(this,{allowStale:!0})){const a=r(this,X)[n],o=r(this,I)[n],i=j(this,M,J).call(this,o)?o.__staleWhileFetching:o;if(i===void 0||a===void 0)continue;const l={value:i};if(r(this,Ce)&&r(this,Le)){l.ttl=r(this,Ce)[n];const c=jt.now()-r(this,Le)[n];l.start=Math.floor(Date.now()-c)}r(this,De)&&(l.size=r(this,De)[n]),e.unshift([a,l])}return e}load(e){this.clear();for(const[n,a]of e){if(a.start){const o=Date.now()-a.start;a.start=jt.now()-o}this.set(n,a.value,a)}}set(e,n,a={}){var y,S,C,g,b;if(n===void 0)return this.delete(e),this;const{ttl:o=this.ttl,start:i,noDisposeOnSet:l=this.noDisposeOnSet,sizeCalculation:c=this.sizeCalculation,status:d}=a;let{noUpdateTTL:h=this.noUpdateTTL}=a;const p=r(this,os).call(this,e,n,a.size||0,c);if(this.maxEntrySize&&p>this.maxEntrySize)return d&&(d.set="miss",d.maxEntrySizeExceeded=!0),this.delete(e),this;let f=r(this,oe)===0?void 0:r(this,ae).get(e);if(f===void 0)f=r(this,oe)===0?r(this,ce):r(this,Pe).length!==0?r(this,Pe).pop():r(this,oe)===r(this,Ee)?j(this,M,Ds).call(this,!1):r(this,oe),r(this,X)[f]=e,r(this,I)[f]=n,r(this,ae).set(e,f),r(this,ge)[r(this,ce)]=f,r(this,Se)[f]=r(this,ce),E(this,ce,f),As(this,oe)._++,r(this,Ft).call(this,f,p,d),d&&(d.set="add"),h=!1;else{j(this,M,Xt).call(this,f);const u=r(this,I)[f];if(n!==u){if(r(this,st)&&j(this,M,J).call(this,u)){u.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:x}=u;x!==void 0&&!l&&(r(this,Oe)&&((y=r(this,Ie))==null||y.call(this,x,e,"set")),r(this,fe)&&((S=r(this,de))==null||S.push([x,e,"set"])))}else l||(r(this,Oe)&&((C=r(this,Ie))==null||C.call(this,u,e,"set")),r(this,fe)&&((g=r(this,de))==null||g.push([u,e,"set"])));if(r(this,yt).call(this,f),r(this,Ft).call(this,f,p,d),r(this,I)[f]=n,d){d.set="replace";const x=u&&j(this,M,J).call(this,u)?u.__staleWhileFetching:u;x!==void 0&&(d.oldValue=x)}}else d&&(d.set="update")}if(o!==0&&!r(this,Ce)&&j(this,M,Rn).call(this),r(this,Ce)&&(h||r(this,as).call(this,f,o,i),d&&r(this,Ve).call(this,d,f)),!l&&r(this,fe)&&r(this,de)){const u=r(this,de);let x;for(;x=u==null?void 0:u.shift();)(b=r(this,Fe))==null||b.call(this,...x)}return this}pop(){var e;try{for(;r(this,oe);){const n=r(this,I)[r(this,me)];if(j(this,M,Ds).call(this,!0),j(this,M,J).call(this,n)){if(n.__staleWhileFetching)return n.__staleWhileFetching}else if(n!==void 0)return n}}finally{if(r(this,fe)&&r(this,de)){const n=r(this,de);let a;for(;a=n==null?void 0:n.shift();)(e=r(this,Fe))==null||e.call(this,...a)}}}has(e,n={}){const{updateAgeOnHas:a=this.updateAgeOnHas,status:o}=n,i=r(this,ae).get(e);if(i!==void 0){const l=r(this,I)[i];if(j(this,M,J).call(this,l)&&l.__staleWhileFetching===void 0)return!1;if(r(this,we).call(this,i))o&&(o.has="stale",r(this,Ve).call(this,o,i));else return a&&r(this,bt).call(this,i),o&&(o.has="hit",r(this,Ve).call(this,o,i)),!0}else o&&(o.has="miss");return!1}peek(e,n={}){const{allowStale:a=this.allowStale}=n,o=r(this,ae).get(e);if(o===void 0||!a&&r(this,we).call(this,o))return;const i=r(this,I)[o];return j(this,M,J).call(this,i)?i.__staleWhileFetching:i}async fetch(e,n={}){const{allowStale:a=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,ttl:l=this.ttl,noDisposeOnSet:c=this.noDisposeOnSet,size:d=0,sizeCalculation:h=this.sizeCalculation,noUpdateTTL:p=this.noUpdateTTL,noDeleteOnFetchRejection:f=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:y=this.allowStaleOnFetchRejection,ignoreFetchAbort:S=this.ignoreFetchAbort,allowStaleOnFetchAbort:C=this.allowStaleOnFetchAbort,context:g,forceRefresh:b=!1,status:u,signal:x}=n;if(!r(this,st))return u&&(u.fetch="get"),this.get(e,{allowStale:a,updateAgeOnGet:o,noDeleteOnStaleGet:i,status:u});const w={allowStale:a,updateAgeOnGet:o,noDeleteOnStaleGet:i,ttl:l,noDisposeOnSet:c,size:d,sizeCalculation:h,noUpdateTTL:p,noDeleteOnFetchRejection:f,allowStaleOnFetchRejection:y,allowStaleOnFetchAbort:C,ignoreFetchAbort:S,status:u,signal:x};let v=r(this,ae).get(e);if(v===void 0){u&&(u.fetch="miss");const A=j(this,M,Ls).call(this,e,v,w,g);return A.__returned=A}else{const A=r(this,I)[v];if(j(this,M,J).call(this,A)){const _=a&&A.__staleWhileFetching!==void 0;return u&&(u.fetch="inflight",_&&(u.returnedStale=!0)),_?A.__staleWhileFetching:A.__returned=A}const L=r(this,we).call(this,v);if(!b&&!L)return u&&(u.fetch="hit"),j(this,M,Xt).call(this,v),o&&r(this,bt).call(this,v),u&&r(this,Ve).call(this,u,v),A;const N=j(this,M,Ls).call(this,e,v,w,g),P=N.__staleWhileFetching!==void 0&&a;return u&&(u.fetch=L?"stale":"refresh",P&&L&&(u.returnedStale=!0)),P?N.__staleWhileFetching:N.__returned=N}}get(e,n={}){const{allowStale:a=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,status:l}=n,c=r(this,ae).get(e);if(c!==void 0){const d=r(this,I)[c],h=j(this,M,J).call(this,d);return l&&r(this,Ve).call(this,l,c),r(this,we).call(this,c)?(l&&(l.get="stale"),h?(l&&a&&d.__staleWhileFetching!==void 0&&(l.returnedStale=!0),a?d.__staleWhileFetching:void 0):(i||this.delete(e),l&&a&&(l.returnedStale=!0),a?d:void 0)):(l&&(l.get="hit"),h?d.__staleWhileFetching:(j(this,M,Xt).call(this,c),o&&r(this,bt).call(this,c),d))}else l&&(l.get="miss")}delete(e){var a,o,i,l;let n=!1;if(r(this,oe)!==0){const c=r(this,ae).get(e);if(c!==void 0)if(n=!0,r(this,oe)===1)this.clear();else{r(this,yt).call(this,c);const d=r(this,I)[c];if(j(this,M,J).call(this,d)?d.__abortController.abort(new Error("deleted")):(r(this,Oe)||r(this,fe))&&(r(this,Oe)&&((a=r(this,Ie))==null||a.call(this,d,e,"delete")),r(this,fe)&&((o=r(this,de))==null||o.push([d,e,"delete"]))),r(this,ae).delete(e),r(this,X)[c]=void 0,r(this,I)[c]=void 0,c===r(this,ce))E(this,ce,r(this,Se)[c]);else if(c===r(this,me))E(this,me,r(this,ge)[c]);else{const h=r(this,Se)[c];r(this,ge)[h]=r(this,ge)[c];const p=r(this,ge)[c];r(this,Se)[p]=r(this,Se)[c]}As(this,oe)._--,r(this,Pe).push(c)}}if(r(this,fe)&&((i=r(this,de))!=null&&i.length)){const c=r(this,de);let d;for(;d=c==null?void 0:c.shift();)(l=r(this,Fe))==null||l.call(this,...d)}return n}clear(){var e,n,a;for(const o of j(this,M,tt).call(this,{allowStale:!0})){const i=r(this,I)[o];if(j(this,M,J).call(this,i))i.__abortController.abort(new Error("deleted"));else{const l=r(this,X)[o];r(this,Oe)&&((e=r(this,Ie))==null||e.call(this,i,l,"delete")),r(this,fe)&&((n=r(this,de))==null||n.push([i,l,"delete"]))}}if(r(this,ae).clear(),r(this,I).fill(void 0),r(this,X).fill(void 0),r(this,Ce)&&r(this,Le)&&(r(this,Ce).fill(0),r(this,Le).fill(0)),r(this,De)&&r(this,De).fill(0),E(this,me,0),E(this,ce,0),r(this,Pe).length=0,E(this,Re,0),E(this,oe,0),r(this,fe)&&r(this,de)){const o=r(this,de);let i;for(;i=o==null?void 0:o.shift();)(a=r(this,Fe))==null||a.call(this,...i)}}};Ee=new WeakMap,ve=new WeakMap,Ie=new WeakMap,Fe=new WeakMap,It=new WeakMap,oe=new WeakMap,Re=new WeakMap,ae=new WeakMap,X=new WeakMap,I=new WeakMap,ge=new WeakMap,Se=new WeakMap,me=new WeakMap,ce=new WeakMap,Pe=new WeakMap,de=new WeakMap,De=new WeakMap,Le=new WeakMap,Ce=new WeakMap,Oe=new WeakMap,st=new WeakMap,fe=new WeakMap,M=new WeakSet,Rn=function(){const e=new Ps(r(this,Ee)),n=new Ps(r(this,Ee));E(this,Ce,e),E(this,Le,n),E(this,as,(i,l,c=jt.now())=>{if(n[i]=l!==0?c:0,e[i]=l,l!==0&&this.ttlAutopurge){const d=setTimeout(()=>{r(this,we).call(this,i)&&this.delete(r(this,X)[i])},l+1);d.unref&&d.unref()}}),E(this,bt,i=>{n[i]=e[i]!==0?jt.now():0}),E(this,Ve,(i,l)=>{if(e[l]){const c=e[l],d=n[l];if(!c||!d)return;i.ttl=c,i.start=d,i.now=a||o();const h=i.now-d;i.remainingTTL=c-h}});let a=0;const o=()=>{const i=jt.now();if(this.ttlResolution>0){a=i;const l=setTimeout(()=>a=0,this.ttlResolution);l.unref&&l.unref()}return i};this.getRemainingTTL=i=>{const l=r(this,ae).get(i);if(l===void 0)return 0;const c=e[l],d=n[l];if(!c||!d)return 1/0;const h=(a||o())-d;return c-h},E(this,we,i=>{const l=n[i],c=e[i];return!!c&&!!l&&(a||o())-l>c})},bt=new WeakMap,Ve=new WeakMap,as=new WeakMap,we=new WeakMap,po=function(){const e=new Ps(r(this,Ee));E(this,Re,0),E(this,De,e),E(this,yt,n=>{E(this,Re,r(this,Re)-e[n]),e[n]=0}),E(this,os,(n,a,o,i)=>{if(j(this,M,J).call(this,a))return 0;if(!Ze(o))if(i){if(typeof i!="function")throw new TypeError("sizeCalculation must be a function");if(o=i(a,n),!Ze(o))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return o}),E(this,Ft,(n,a,o)=>{if(e[n]=a,r(this,ve)){const i=r(this,ve)-e[n];for(;r(this,Re)>i;)j(this,M,Ds).call(this,!0)}E(this,Re,r(this,Re)+e[n]),o&&(o.entrySize=a,o.totalCalculatedSize=r(this,Re))})},yt=new WeakMap,Ft=new WeakMap,os=new WeakMap,et=function*({allowStale:e=this.allowStale}={}){if(r(this,oe))for(let n=r(this,ce);!(!j(this,M,Pn).call(this,n)||((e||!r(this,we).call(this,n))&&(yield n),n===r(this,me)));)n=r(this,Se)[n]},tt=function*({allowStale:e=this.allowStale}={}){if(r(this,oe))for(let n=r(this,me);!(!j(this,M,Pn).call(this,n)||((e||!r(this,we).call(this,n))&&(yield n),n===r(this,ce)));)n=r(this,ge)[n]},Pn=function(e){return e!==void 0&&r(this,ae).get(r(this,X)[e])===e},Ds=function(e){var i,l;const n=r(this,me),a=r(this,X)[n],o=r(this,I)[n];return r(this,st)&&j(this,M,J).call(this,o)?o.__abortController.abort(new Error("evicted")):(r(this,Oe)||r(this,fe))&&(r(this,Oe)&&((i=r(this,Ie))==null||i.call(this,o,a,"evict")),r(this,fe)&&((l=r(this,de))==null||l.push([o,a,"evict"]))),r(this,yt).call(this,n),e&&(r(this,X)[n]=void 0,r(this,I)[n]=void 0,r(this,Pe).push(n)),r(this,oe)===1?(E(this,me,E(this,ce,0)),r(this,Pe).length=0):E(this,me,r(this,ge)[n]),r(this,ae).delete(a),As(this,oe)._--,n},Ls=function(e,n,a,o){const i=n===void 0?void 0:r(this,I)[n];if(j(this,M,J).call(this,i))return i;const l=new qs,{signal:c}=a;c==null||c.addEventListener("abort",()=>l.abort(c.reason),{signal:l.signal});const d={signal:l.signal,options:a,context:o},h=(g,b=!1)=>{const{aborted:u}=l.signal,x=a.ignoreFetchAbort&&g!==void 0;if(a.status&&(u&&!b?(a.status.fetchAborted=!0,a.status.fetchError=l.signal.reason,x&&(a.status.fetchAbortIgnored=!0)):a.status.fetchResolved=!0),u&&!x&&!b)return f(l.signal.reason);const w=S;return r(this,I)[n]===S&&(g===void 0?w.__staleWhileFetching?r(this,I)[n]=w.__staleWhileFetching:this.delete(e):(a.status&&(a.status.fetchUpdated=!0),this.set(e,g,d.options))),g},p=g=>(a.status&&(a.status.fetchRejected=!0,a.status.fetchError=g),f(g)),f=g=>{const{aborted:b}=l.signal,u=b&&a.allowStaleOnFetchAbort,x=u||a.allowStaleOnFetchRejection,w=x||a.noDeleteOnFetchRejection,v=S;if(r(this,I)[n]===S&&(!w||v.__staleWhileFetching===void 0?this.delete(e):u||(r(this,I)[n]=v.__staleWhileFetching)),x)return a.status&&v.__staleWhileFetching!==void 0&&(a.status.returnedStale=!0),v.__staleWhileFetching;if(v.__returned===v)throw g},y=(g,b)=>{var x;const u=(x=r(this,It))==null?void 0:x.call(this,e,i,d);u&&u instanceof Promise&&u.then(w=>g(w===void 0?void 0:w),b),l.signal.addEventListener("abort",()=>{(!a.ignoreFetchAbort||a.allowStaleOnFetchAbort)&&(g(void 0),a.allowStaleOnFetchAbort&&(g=w=>h(w,!0)))})};a.status&&(a.status.fetchDispatched=!0);const S=new Promise(y).then(h,p),C=Object.assign(S,{__abortController:l,__staleWhileFetching:i,__returned:void 0});return n===void 0?(this.set(e,C,{...d.options,status:void 0}),n=r(this,ae).get(e)):r(this,I)[n]=C,C},J=function(e){if(!r(this,st))return!1;const n=e;return!!n&&n instanceof Promise&&n.hasOwnProperty("__staleWhileFetching")&&n.__abortController instanceof qs},Dn=function(e,n){r(this,Se)[n]=e,r(this,ge)[e]=n},Xt=function(e){e!==r(this,ce)&&(e===r(this,me)?E(this,me,r(this,ge)[e]):j(this,M,Dn).call(this,r(this,Se)[e],r(this,ge)[e]),j(this,M,Dn).call(this,r(this,ce),e),E(this,ce,e))};let Fn=Yn;function zc({conversationId:t,messageId:e}){const[n,a]=m.useState(!1),o=m.useRef({isMediaSourceAvailable:Kn(),mediaSourceFormat:Qn()??"n/a",playPromise:null,shouldAbortQueuedPlayback:!1}).current,i=ze(),{voiceName:l}=Hi(),c=`${t}.${e}.${l}`,d=Do(),h=Lo(C=>{var g;return C.isPlaying&&C.sourceUrl===((g=Te.get(c))==null?void 0:g.src)}),p=m.useCallback(async()=>{if(!d)return;a(!0);const C={isMediaSourceAvailable:o.isMediaSourceAvailable,format:o.mediaSourceFormat};try{const g=await Bc({key:c,message_id:e,conversation_id:t,voice:l,onStreamingError:b=>{Zt.readAloud.error(b,C),a(!1),Nt.danger(i.formatMessage(ma.playbackError,{error:b.message}))},onStreamingStart:()=>{a(!1)}});if(o.shouldAbortQueuedPlayback){o.shouldAbortQueuedPlayback=!1;return}d.changeSource(g),o.playPromise=d.play()}catch(g){Zt.readAloud.error(g,C),a(!1),Nt.danger(i.formatMessage(ma.playbackError,{error:g.message}))}},[d,c,e,t,l,o,i]),f=m.useCallback(()=>{const C=Xn();C&&(o.playPromise?o.playPromise.then(()=>{C.stop(),o.playPromise=null}):C.stop())},[o]),y=m.useCallback(()=>{var g;const C=Xn();C&&(C.state.isPlaying&&C.state.sourceUrl===((g=Te.get(c))==null?void 0:g.src)?f():(Zt.readAloud.click({isMediaSourceAvailable:o.isMediaSourceAvailable,format:o.mediaSourceFormat}),p()))},[c,o,p,f]);m.useEffect(()=>{n&&h&&a(!1)},[n,h]);const S=m.useRef(c);return m.useEffect(()=>{S.current=c}),m.useEffect(()=>(o.shouldAbortQueuedPlayback=!1,()=>{var b;const C=Oo();C.isPlaying&&C.sourceUrl===((b=Te.get(S.current))==null?void 0:b.src)?f():o.shouldAbortQueuedPlayback=!0}),[o,f]),{togglePlayback:y,isPlaying:h,isLoading:n}}async function xo({message_id:t,conversation_id:e,voice:n}){const a=await Me.synthesize({message_id:t,conversation_id:e,voice:n,format:Qn()}),o=a.headers.get("content-type")??"audio/aac";return{response:a,format:o}}async function Bc(t){return Kn()?Hc(t):Gc(t)}async function Gc({key:t,...e}){const n=Te.get(t);if(n!=null&&n.blob)return n.src;const{response:a,format:o}=await xo(e),i=await a.arrayBuffer(),l=new Blob([i],{type:o}),c=bo({key:t,src:URL.createObjectURL(l),format:o,blob:l});return Te.set(t,c),c.src}async function Hc({key:t,onStreamingError:e,onStreamingStart:n,...a}){let o=Te.get(t);o!=null&&o.streaming&&(Te.delete(t),o=void 0);let i,l;const c=Vc(),d=new c;if(o)i=o,i.src=URL.createObjectURL(d);else{const{format:f,response:y}=await xo(a);l=y,i=bo({key:t,src:URL.createObjectURL(d),format:f})}const h=Wc(i.id),p={sourceopen:async()=>{var S,C;h("sourceopen");const f=d.addSourceBuffer(i.format),y=async()=>{f.updating&&await new Promise(g=>f.addEventListener("updateend",g,{once:!0}))};if(i.segments.length&&!i.streaming){h("streaming from cache"),i.streaming=!0,n();for(const g of i.segments)f.appendBuffer(g),await y();d.readyState==="open"&&d.endOfStream(),i.streaming=!1,h("done streaming from cache");return}if(l){h("fetching audio");try{const g=(S=l.body)==null?void 0:S.getReader();if(!g)return;for(;((C=Te.get(t))==null?void 0:C.id)===i.id;){const{done:b,value:u}=await g.read();if(b){h("done streaming"),i.streaming=!1,d.readyState==="open"&&d.endOfStream();break}if(!Array.from(d.sourceBuffers).includes(f)){h("stop streaming, source buffer removed"),i.streaming=!1;break}i.streaming||(h("start streaming"),i.streaming=!0,n()),f.appendBuffer(u),i.segments.push(u),await y()}}catch(g){if(h("error while streaming",g),i.streaming=!1,d.readyState==="open")try{d.endOfStream("network")}catch(b){Zt.readAloud.error(b)}Te.delete(t),e(g)}}},sourceclose:()=>{var f;h("sourceclose"),i.streaming&&(i.streaming=!1,((f=Te.get(t))==null?void 0:f.id)===i.id&&(h("sourceclosed while streaming, cleaning up cache"),Te.delete(t)))},sourceended:xt};for(const[f,y]of Object.entries(p))d.addEventListener(f,()=>{try{return y()}catch(S){Zt.readAloud.error(S)}});return Te.set(t,i),i.src}const ma=_e({playbackError:{id:"useVoiceReadAloudAudio.playbackError",defaultMessage:"Failed to play message"}}),Wc=t=>xt;function Vc(){return Kn()?window.MediaSource:null}function Kn(){return!!Qn()}function Qn(){if("MediaSource"in window){const t=e=>Uo(e)&&MediaSource.isTypeSupported(e);if(t("audio/aac"))return"aac";if(t("audio/mpeg"))return"mp3";if(t("audio/ogg"))return"ogg"}}const bo=t=>({id:Ks(),segments:[],streaming:!1,...t}),Te=new Fn({max:50,dispose:t=>{URL.revokeObjectURL(t.src)}}),qc=m.memo(function(e){var l;const n=(l=Us("1923022511"))==null?void 0:l.value,a=tn(e.conversationId),{errCode:o}=$n(e.message);if(!n||!a||o)return null;const i=zo.getAudioAssetPointers(e.message.message)[0];return i?s.jsx($c,{audioAssetPointer:i,conversationId:a}):s.jsx(Kc,{...e,conversationId:a})});function $c({audioAssetPointer:t,conversationId:e}){const{isLoading:n,isPlaying:a,togglePlayback:o}=Wi({audioAssetPointer:t,conversationId:e});return s.jsx(yo,{onClick:o,isPlaying:a,isLoading:n,playText:$s.replay,playIcon:wl})}function Kc({conversationId:t,message:e}){const{isLoading:n,isPlaying:a,togglePlayback:o}=zc({conversationId:t,messageId:e.message.id});return s.jsx(yo,{onClick:o,isPlaying:a,isLoading:n,playText:$s.play,playIcon:Ml})}function yo({onClick:t,isPlaying:e,isLoading:n,playText:a,playIcon:o}){let i,l;const c=ze();return n?(i=Bo,l=$s.loading):e?(i=_l,l=$s.stop):(i=o,l=a),s.jsx(Fs,{icon:i,label:l?c.formatMessage(l):void 0,disabled:n,onClick:t,style:e||n?{visibility:"visible"}:void 0,testId:"voice-play-turn-action-button"})}const $s={replay:{id:"VoiceReadOutLoudButton.replay",defaultMessage:"Replay",description:"The tooltip for the replay button"},play:{id:"VoiceReadOutLoudButton.play",defaultMessage:"Read aloud",description:"The tooltip for the read aloud button"},stop:{id:"VoiceReadOutLoudButton.stop",defaultMessage:"Stop",description:"The tooltip for the stop button"},loading:{id:"VoiceReadOutLoudButton.loading",defaultMessage:"Loading",description:"The tooltip for the spinner"}},Qc="bg-token-main-surface-primary text-token-text-primary",Yc="openai",ga=["bg-blue-300 text-white"];function Jc(t){return ga[((t==null?void 0:t.charCodeAt(0))??0)%ga.length]}const Ns=({children:t})=>s.jsx("div",{className:"pt-0",children:s.jsx("div",{className:se(m.isValidElement(t)&&t.type===kn?"gizmo-bot-avatar":"gizmo-shadow-stroke","flex h-8 w-8 items-center justify-center overflow-hidden rounded-full"),children:t})});function Ln({messages:t,isUserTurn:e,avatarClassName:n,gizmo:a,showInlineEmbeddedDisplay:o=!1}){var S;const i="medium",l=t[0],c=(S=l==null?void 0:l.message.metadata)==null?void 0:S.shared_conversation_id,d=c!=null,h=Wn(),{gizmoEditorData:p,mode:f}=Vi();let y=s.jsx(Ns,{children:s.jsx(kn,{className:n??Qc,iconName:Yc,size:i})});return a?y=s.jsx(Ns,{children:s.jsx(Kl,{gizmoId:a.gizmo.id,className:"h-full w-full"})}):p!=null&&f==="test"&&(y=s.jsx(Ql,{isFirstParty:!1,src:p.profilePictureUrl,className:"h-8 w-8 first:pt-[3px]"})),s.jsx("div",{children:e?d||o?s.jsx(Ns,{children:s.jsx(kn,{className:Jc(c),iconName:"user",size:i})}):s.jsx(Ns,{children:s.jsx(qi,{user:h,size:i})}):y})}const Es="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function Xc({className:t,clientThreadId:e,message:n,onModelSelect:a,onDropdownChange:o,canRegenerateResponse:i}){var W;const l=Na("566128514").value,[c,d]=m.useState(null),[h,p]=m.useState(!1),[f,y]=m.useState(!1),S=rt(e),C=ho({clientThreadId:e,message:n}),g=(W=n.message.metadata)==null?void 0:W.model_slug,{modelOptions:b,modelSlug:u,animateModelLabelOnRender:x,messageModelEnabledTools:w}=C,v=Va(n.message),A=w.includes(Gs.Search),L=m.useMemo(()=>b.find(D=>D.value===g),[b,g]),N=m.useRef(null),{doesUserHaveAnyAccountsWithPlusFeatures:H}=rs(),P=D=>{D||setTimeout(()=>{N.current&&N.current.blur()},10)};if(m.useEffect(()=>{P(h)},[h]),Ja(e))return null;const z=i&&b.some(D=>ns(D,H));return S?null:s.jsxs(je.Root,{onOpenChange:D=>{i&&(p(D),o(D),P(D)),D&&ee.logEvent($.conversationOpenMessageModelSelector,{has_get_plus_button:z,is_new_regen_dropdown:!0})},children:[i?s.jsx(ed,{label:s.jsx(F,{id:"wDs5sz",defaultMessage:"Switch model"}),children:s.jsx(lo,{ref:N,className:se("cursor-pointer",t),onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1),children:s.jsx(Nn,{modelSlug:u,animateModelLabelOnRender:x,isDropdownOpen:h,isRegenerateEnabled:i,isHovered:f,isRegenLabel:!0,omitIcon:!1})})}):s.jsx("button",{className:se("cursor-pointer",t),onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1),children:s.jsx(Nn,{modelSlug:u,animateModelLabelOnRender:x,isDropdownOpen:!1,isRegenerateEnabled:!1,isHovered:f,omitIcon:l,animateShortLabel:!0})}),i&&s.jsxs(je.Content,{className:"z-30 min-w-fit origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[s.jsx(je.Item,{disabled:!0,className:"pb-0 pt-2",children:s.jsx("span",{className:"text-token-text-secondary",children:s.jsx(F,{id:"bFLh5u",defaultMessage:"Switch model"})})}),s.jsx(Zc,{onModelSelect:a,messageModelSlug:g,omitModelIcons:l,modelOptions:b,setHoveredOption:d,hoveredOption:c,retryOption:L,lastResponseUsedSearch:v,modelSupportsSearch:A,doesUserHaveAnyAccountsWithPlusFeatures:H})]})]})}function Zc({modelOptions:t,messageModelSlug:e,onModelSelect:n,omitModelIcons:a,setHoveredOption:o,hoveredOption:i,retryOption:l,lastResponseUsedSearch:c,modelSupportsSearch:d,doesUserHaveAnyAccountsWithPlusFeatures:h}){const p=ze(),[f,y]=m.useMemo(()=>$i(t,u=>u.subcategory),[t]),S=m.useMemo(()=>{const u=new Map;return f.forEach(x=>{var v;const w=x.subcategory;w&&(u.has(w)||u.set(w,[]),(v=u.get(w))==null||v.push(x))}),u},[f]),C=se("icon-sm",a&&"order-10 ml-auto text-token-text-tertiary icon-md"),g=a?"right":"left",b=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:p.formatMessage(wn.search),icon:s.jsx(no,{className:C}),condition:d&&!c},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:p.formatMessage(wn.nosearch),icon:s.jsx(ao,{className:C}),condition:d&&c}];return s.jsxs(s.Fragment,{children:[y.map(u=>{const{value:x,...w}=u;return s.jsx(At,{value:x,onSelect:()=>n({requestedModelId:x}),includeRegenerate:!1,onMouseEnter:()=>o(x),onMouseLeave:()=>o(null),isHovered:i===x,messageModelSlug:e,includeCheck:!1,shouldShowUpsell:ns(u,h),className:Es,...w,icon:a?s.jsx("span",{className:C}):w.icon,justifyIcon:g,wrapIcon:!a},x)}),[...S.entries()].map(([u,x])=>s.jsxs(je.Sub,{children:[s.jsx(je.SubMenuTrigger,{children:s.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:u})}),s.jsx(je.Portal,{children:s.jsx(je.SubContent,{className:"min-w-fit",children:x.map(w=>{const{value:v,...A}=w;return s.jsx(At,{value:v,onSelect:()=>n({requestedModelId:v}),includeRegenerate:!1,onMouseEnter:()=>o(v),onMouseLeave:()=>o(null),isHovered:i===v,messageModelSlug:e,includeCheck:!1,className:Es,...A,icon:null,justifyIcon:g,wrapIcon:!a,shouldShowUpsell:ns(w,h)},u+"-"+v)})})})]},u)),!!l&&s.jsxs(s.Fragment,{children:[s.jsx(je.Separator,{}),s.jsx(At,{onSelect:()=>n({requestedModelId:l.value}),includeRegenerate:!0,onMouseEnter:()=>o(l.value),onMouseLeave:()=>o(null),messageModelSlug:e,includeCheck:!1,className:Es,...l,label:p.formatMessage(wn.tryAgain),subtitle:l.label,icon:s.jsx(nn,{className:C}),justifyIcon:g,wrapIcon:!a},l.value),b.filter(u=>u.condition).map(u=>s.jsx(At,{onSelect:()=>n({requestedModelId:l.value,extraStreamParams:u.extraStreamParams}),includeRegenerate:!1,onMouseEnter:()=>o(u.key),onMouseLeave:()=>o(null),isHovered:i===u.key,messageModelSlug:e,includeCheck:!1,className:Es,...l,label:u.label,subtitle:"",icon:u.icon,justifyIcon:g,wrapIcon:!a},u.key))]})]})}function ed({children:t,label:e}){return s.jsx(Js,{label:e,sideOffset:0,children:t})}const wn=_e({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),td=m.memo(Xc);function On({messages:t,isMemoryEnabled:e,isMemoryFull:n,gizmoId:a,isParagen:o}){const[i,l]=m.useState(!1),[c,d]=m.useState(!1),{eligible:h,isLoading:p}=Ki(),f=e&&!n,y=t.filter((g,b)=>{const u=t[b+1],w=(u==null?void 0:u.message.recipient)==="assistant"&&(u==null?void 0:u.message.author.role)===pe.Tool&&(u==null?void 0:u.message.author.name)==="bio"&&Ra(u.message)==="Model set context updated."||!u&&f;return g.message.author.role===pe.Assistant&&g.message.recipient==="bio"&&w}).flatMap(g=>{const b=g.message.content.content_type;return b===it.Text?g.message.content.parts:b===it.Code?[g.message.content.text]:[]}).map(sd),S=m.useMemo(()=>y.length>0,[y]);if(m.useEffect(()=>{S&&h&&!p&&Xs.openModal(ts.GlobalMemoryOnboarding)},[S,h,p]),y.length===0)return null;const C=g=>{const b=g??!c;d(b),b&&ee.logEvent($.memoryUpdatePopoverShown,{updateCount:y.length})};return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"inline-block",onMouseEnter:()=>C(!0),onMouseLeave:()=>C(!1),children:s.jsxs(Qi,{open:c,sideOffset:4,side:"bottom",alignAgainstAnchor:"start",size:"none",className:"z-10 min-w-60 max-w-96 text-sm",onOpenChange:g=>C(g),disableAutofocus:!0,triggerButton:s.jsxs("button",{className:se("my-1 flex items-center gap-1 text-sm font-semibold outline-none",c?"text-token-text-secondary":"text-token-text-tertiary"),children:[s.jsx(kl,{className:"mb-[-1px]"}),y.length===1?s.jsx(F,{id:"MemoryActionResult.memoryWriteSingular.1",defaultMessage:"Memory updated"}):s.jsx(F,{id:"MemoryActionResult.memoryWritePlural.1",defaultMessage:"Memories updated"})]}),children:[s.jsx("div",{className:"mb-2 rounded border border-token-border-light bg-token-main-surface-secondary",children:y.map((g,b)=>s.jsx("div",{className:"border-b border-token-border-light px-3 py-2 first-letter:uppercase last:border-b-0",children:g},b))}),o?s.jsx("div",{className:"text-xs text-token-text-tertiary",children:s.jsx(F,{id:"MemoryActionResult.paragenMessage",defaultMessage:"This memory will be saved if you choose this response."})}):s.jsxs("button",{className:"flex w-full items-center justify-between rounded px-3 py-2 font-semibold hover:bg-token-main-surface-secondary",onClick:()=>{l(!0),ee.logEvent($.memoryUpdatePopoverManageButtonClicked,{updateCount:y.length})},children:[s.jsx(F,{id:"MemoryActionResult.manageMemories",defaultMessage:"Manage memories"}),s.jsx(Tl,{className:"icon-md -mr-1 text-token-text-tertiary"})]})]})}),i&&s.jsx(Yl,{initialGizmoId:a,onClose:()=>l(!1)})]})}function sd(t){const e=["The user ","The user's ","User ","User's "];for(const n of e)if(t.startsWith(n))return t.slice(n.length);return t}function fa(t,e,n){G.updateTree(t,a=>{a.updateNodeMetadata(e,{inlineComparisonRating:n})})}function pa(t){var a,o;return{is_dark_mode:t==="dark",time_since_loaded:Math.floor(performance.now()/1e3),page_height:window==null?void 0:window.innerHeight,page_width:window==null?void 0:window.innerWidth,pixel_ratio:window==null?void 0:window.devicePixelRatio,screen_height:(a=window==null?void 0:window.screen)==null?void 0:a.height,screen_width:(o=window==null?void 0:window.screen)==null?void 0:o.width}}const xa=({messages:t})=>{for(const{message:{metadata:e}}of t){const{augmented_paragen_prompt_label:n}=e??{};if(n)return n}};function nd(t){const e=m.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});return t.stubSideBySideFeedback?s.jsx(vo,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:e,...t}):s.jsx(ad,{...t,visibilityStateRef:e})}function ad(t){const{clientThreadId:e,variantIds:n,variantsInStreamInfo:a}=t;if(n.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const[o]=m.useState(()=>Date.now()),i=qa(),{resolvedTheme:l}=Go(),[c,d]=m.useMemo(()=>$a(n.join(""))()<.5?[0,1]:[1,0],[n[0],n[1]]),h=c<d?"left":"right",p=h==="left"?"right":"left",f=n[c],y=n[d],S=ia(e,f),C=ia(e,y),g=Yt(ra(e,Yt(S).id)),b=Yt(ra(e,Yt(C).id)),u=h==="left"?g:b,x=h==="left"?b:g,w=a.display_treatment==="unskippable",v=w?"unskippable_parallel_2_in_stream:a:1.0":"skippable_parallel_2_in_stream:a:1.5";m.useEffect(()=>(Bs.setState({displayingSideBySideFeedback:!0,unskippable:w}),()=>{Bs.setState({displayingSideBySideFeedback:!1,unskippable:!1})}),[w]),Yi();const A=m.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});m.useEffect(()=>Ho(Ji,{requestCompletion:()=>{var P,_,z,W;const N=(P=Jt(u.messages))==null?void 0:P.completionSampleFinishTime,H=(_=Jt(x.messages))==null?void 0:_.completionSampleFinishTime;Me.submitMessageComparisonFeedback({feedback_version:v,original_message_id:(z=u.messages[u.messages.length-1])==null?void 0:z.message.id,new_message_id:(W=x.messages[x.messages.length-1])==null?void 0:W.message.id,rating:"none",conversation_id:G.getServerThreadId(e),text:"",tags:[],completion_comparison_rating:"skip",new_completion_placement:p,feedback_start_time:o,compare_step_start_time:o,original_completion_load_start_time:o,original_completion_load_end_time:N??0,new_completion_load_start_time:o,new_completion_load_end_time:H??0,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:pa(l),...A.current})}}),[g,b,e,o,v,p,u==null?void 0:u.messages,x==null?void 0:x.messages,l]);const L=N=>{var T,R,k,K;const P=G.getTree(e).getLeafFromNode(N);G.setThreadCurrentLeafId(e,P.id);const z=N===f===(h==="left"),W=(T=Jt(u.messages))==null?void 0:T.completionSampleFinishTime,D=(R=Jt(x.messages))==null?void 0:R.completionSampleFinishTime;u.messages.length>0&&fa(e,u.messages[u.messages.length-1].nodeId,z?"original":"new"),x.messages.length>0&&fa(e,x.messages[x.messages.length-1].nodeId,z?"original":"new");let Q;W==null||D==null?Q=z?"partial_load_comparison_original":"partial_load_comparison_new":Q=z?"original":"new",Me.submitMessageComparisonFeedback({feedback_version:v,original_message_id:(k=u.messages[u.messages.length-1])==null?void 0:k.message.id,new_message_id:(K=x.messages[x.messages.length-1])==null?void 0:K.message.id,rating:"none",conversation_id:G.getServerThreadId(e),text:"",tags:[],completion_comparison_rating:Q,new_completion_placement:p,feedback_start_time:o,compare_step_start_time:o,original_completion_load_start_time:o,original_completion_load_end_time:W??null,new_completion_load_start_time:o,new_completion_load_end_time:D??null,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:pa(l),...A.current})};return s.jsx(vo,{...t,setPreferredFeedback:L,leftVariantId:f,rightVariantId:y,leftTurn:g,rightTurn:b,hasActiveRequest:i,originalTurn:u,visibilityStateRef:A})}function od(t){if(!t.length)return!1;const e=t.filter(n=>n.type===ot.Text||n.type===ot.MultiText).filter(n=>{var a;return n.message.message.status!=="finished_successfully"&&((a=n.message.message.metadata)==null?void 0:a.snorkle_status)!==void 0});return e.length>0&&e.every(n=>{const a=n.message.message.content;return(a==null?void 0:a.content_type)===it.Text&&a.parts.join("")===""})}function vo({setPreferredFeedback:t,leftVariantId:e,rightVariantId:n,leftTurn:a,rightTurn:o,hasActiveRequest:i,originalTurn:l,visibilityStateRef:c,...d}){const{defaultParagenLabel:h,shouldShowParagenLabels:p=!1}=Xi(),f=a&&xa(a)||h,y=o&&xa(o)||h,S=m.useMemo(()=>(a==null?void 0:a.messages)??[],[a==null?void 0:a.messages]),C=m.useMemo(()=>(o==null?void 0:o.messages)??[],[o==null?void 0:o.messages]),{avatarClassName:g}=d,b=m.useMemo(()=>Hs(S),[S]),u=m.useMemo(()=>Hs(C),[C]),x=Gn(),w=cs();function v(K){var ne,Be;if(!w.showDebugConversationTurns&&!w.forceParagen)return null;let O=K===l?"ORIGINAL":"NEW";const q=K.messages[K.messages.length-1],te=(Be=(ne=q==null?void 0:q.message)==null?void 0:ne.metadata)==null?void 0:Be.__internal;if(te){const{model_id:xe,model_definition_slug:Ke,model_definition_virtual_model_id:Qe,alternative_model_selection_rule:Ye,augmented_paragen_prompt_group_id:Ae,augmented_paragen_prompt_id:Ne,augmented_paragen_prompt:Ge}=te;xe&&(O+=`
Model ID: ${xe}`),Ke&&(O+=`
Model Slug: ${Ke}`),Qe&&(O+=`
Virtual Model ID: ${Qe}`),Ye&&(O+=`
Alternative Model Rule: ${Ye}`),Ae&&(O+=`
Prompt Group ID: ${Ae}`),Ne&&(O+=`
Prompt ID: ${Ne}`),Ge&&(O+=`
Prompt: ${Ge}`)}return s.jsx("div",{className:"whitespace-pre-wrap text-sm text-red-500",children:O})}const[A,L]=m.useMemo(()=>[b,u].map(K=>od(K)),[b,u]),N=ss(a?zs.getRequestIdFromConversationTurn(a):"")||A,H=ss(o?zs.getRequestIdFromConversationTurn(o):"")||L,P=(a==null?void 0:a.role)===pe.User,_=(o==null?void 0:o.role)===pe.User,z=Bn(),W=m.useRef(null),D=m.useRef(null),Q=m.useRef(null);m.useEffect(()=>{if(W.current&&D.current&&Q.current){const K=Array(11).fill(0).map((q,te)=>te/10),O=new IntersectionObserver(q=>q.forEach(te=>{te.target===D.current?(c.current.left_visibility_initial==null&&(c.current.left_visibility_initial=te.intersectionRatio),c.current.left_visibility_max=Math.max(c.current.left_visibility_max??0,te.intersectionRatio)):te.target===Q.current&&(c.current.right_visibility_initial==null&&(c.current.right_visibility_initial=te.intersectionRatio),c.current.right_visibility_max=Math.max(c.current.right_visibility_max??0,te.intersectionRatio))}),{root:W.current,threshold:K});return O.observe(D.current),O.observe(Q.current),()=>O.disconnect()}},[c]);const{data:T}=Hn(void 0,!1,x),R=T==null?void 0:T.memoryFullPct,k=typeof R=="number"&&R>=100;return s.jsxs("div",{className:"relative flex flex-col",children:[s.jsx("div",{className:"sticky top-[-1px] z-[1] text-pretty bg-token-main-surface-primary px-6 text-center text-lg md:static",children:s.jsx(F,{id:"JgCHDY",defaultMessage:"You’re giving feedback on a new version of ChatGPT."})}),s.jsx("div",{className:"text-pretty px-6 pb-5 pt-1 text-center text-sm text-token-text-secondary",children:s.jsx(F,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),s.jsx("div",{className:"sticky top-[calc(1.75em-1px)] z-[1] h-3 bg-gradient-to-b from-token-main-surface-primary from-50% to-transparent md:static"}),s.jsx("div",{className:"-mb-2 snap-x snap-mandatory overflow-x-auto px-3 pb-4 md:px-5 lg:px-10",ref:W,children:s.jsx("div",{className:"min-w-fit",children:s.jsxs("div",{className:"mx-auto flex max-w-6xl items-start gap-4 sm:gap-6",children:[s.jsxs(ba,{elemRef:D,onClick:()=>{t(e)},hasActiveRequest:i,children:[s.jsxs(va,{children:[s.jsx(Ln,{messages:S,isUserTurn:P,avatarClassName:g,showInlineEmbeddedDisplay:!1}),s.jsx(ya,{children:p?s.jsx("span",{className:"font-bold text-token-text-primary",children:f}):s.jsx(F,{...Sa.responseNumber,values:{responseIndex:1}})})]}),T!=null&&!P&&s.jsx(On,{messages:S,isMemoryEnabled:z,isMemoryFull:k,isParagen:!0}),s.jsx(jn,{...d,groupedMessagesToRender:b,allGroupedMessages:b,isEditing:!1,isUserTurn:P,isCompletionRequestInProgress:N,hasActiveRequest:i,handleEnterEdit:xt,handleExitEdit:xt,shouldGrowContainer:!1}),!!a&&v(a)]}),s.jsxs(ba,{elemRef:Q,onClick:()=>{t(n)},hasActiveRequest:i,children:[s.jsxs(va,{children:[s.jsx(Ln,{messages:C,isUserTurn:_,avatarClassName:g,showInlineEmbeddedDisplay:!1}),s.jsx(ya,{children:p?s.jsx("span",{className:"font-bold text-token-text-primary",children:y}):s.jsx(F,{...Sa.responseNumber,values:{responseIndex:2}})})]}),T!=null&&!_&&s.jsx(On,{messages:C,isMemoryEnabled:z,isMemoryFull:k,isParagen:!0}),s.jsx(jn,{...d,groupedMessagesToRender:u,allGroupedMessages:u,isEditing:!1,isUserTurn:_,isCompletionRequestInProgress:H,hasActiveRequest:i,handleEnterEdit:xt,handleExitEdit:xt,shouldGrowContainer:!1}),!!o&&v(o)]})]})})})]})}function ba({elemRef:t,onClick:e,children:n,hasActiveRequest:a}){return s.jsxs("div",{className:"relative flex w-full min-w-[min(450px,80vw)] snap-center flex-col gap-1 truncate rounded-2xl border border-token-main-surface-tertiary bg-white p-5 text-left dark:bg-gray-700",ref:t,children:[n,a?null:s.jsx(nt,{className:"mt-4 self-start",onClick:e,children:s.jsx(F,{id:"U2EAH6",defaultMessage:"I prefer this response"})})]})}const ya=$e.div`text-sm text-token-text-tertiary font-semibold`,va=$e.div`flex gap-4 items-center mb-1`,Sa=_e({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}"},responseChoice:{id:"ConversationTurnTwoUpFeedback.responseChoice",defaultMessage:"Choose this response"}});function id({clientThreadId:t,messageForRating:e,variantIds:n,conversationTurnMountTime:a}){const[o]=m.useState(()=>e.message.create_time!=null?e.message.create_time*1e3:Date.now()),[i]=m.useState(()=>Date.now());function l(c){var A,L;const d=G.getTree(t),h=n[0]||"",p=(d==null?void 0:d.getConversationTurns(h))||[],f=p[p.length-1],y=(f==null?void 0:f.messages)||[],S=y[y.length-1],C=((A=S==null?void 0:S.message)==null?void 0:A.id)||"",g=n[1]||"",b=(d==null?void 0:d.getConversationTurns(g))||[],u=b[b.length-1],x=(u==null?void 0:u.messages)||[],w=x[x.length-1],v=((L=w==null?void 0:w.message)==null?void 0:L.id)||"";Me.submitMessageComparisonFeedback({feedback_version:"inline_regen_feedback:a:1.0",original_message_id:C,new_message_id:v,rating:"none",conversation_id:G.getServerThreadId(t),text:"",tags:[],completion_comparison_rating:c,new_completion_placement:"not-applicable",feedback_start_time:a,compare_step_start_time:a,new_completion_load_start_time:o,new_completion_load_end_time:i,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset()}),G.updateTree(t,N=>{N.updateNodeMetadata(e.nodeId,{inlineComparisonRating:c})}),G.updateTree(t,N=>{N.updateNodeMetadata(S.nodeId,{inlineComparisonRating:"baseline"})})}return s.jsxs(rd,{children:[s.jsx("h6",{className:"min-w-[150px] grow",children:s.jsx(F,{...Is.regenTitle})}),s.jsxs("div",{className:"flex flex-wrap items-end justify-center gap-2",children:[s.jsx(nt,{color:"secondary",onClick:()=>l("new"),children:s.jsx(F,{...Is.regenBetterText})}),s.jsx(nt,{color:"secondary",onClick:()=>l("original"),children:s.jsx(F,{...Is.regenWorseText})}),s.jsx(nt,{color:"secondary",onClick:()=>l("same"),children:s.jsx(F,{...Is.regenSameText})})]}),s.jsx(Wo,{onClick:()=>{G.updateTree(t,c=>{c.updateNodeMetadata(e.nodeId,{inlineComparisonRating:"skip"})})}})]})}const rd=$e.div`flex items-center p-4 rounded-2xl bg-token-main-surface-primary text-token-text-primary text-sm border border-token-border-light gap-5 mt-3`,Is=_e({regenTitle:{id:"ConversationTurnInlineFeedback.regenTitle",defaultMessage:"Was this response better or worse?"},regenBetterText:{id:"ConversationTurnInlineFeedback.regenBetterText",defaultMessage:"Better"},regenWorseText:{id:"ConversationTurnInlineFeedback.regenWorseText",defaultMessage:"Worse"},regenSameText:{id:"ConversationTurnInlineFeedback.regenSameText",defaultMessage:"Same"}}),Ca=({allGroupedMessages:t})=>t.some(e=>[ot.Browsing,ot.RetrievalBrowsing,ot.ParallelBrowsing].includes(e.type)),wa=({allGroupedMessages:t})=>t.some(e=>e.type===ot.CodeInterpreter);function ld(t){return!t||!t.instructions?"":typeof t.instructions=="string"?t.instructions:t.instructions.filter(e=>typeof e=="string").join("")}const cd=[{match:Ca,tag:"Shouldn't have searched the web",label:ie({id:"kL047b",defaultMessage:"Shouldn't have searched the web"})},{match:Ca,tag:"Don't like the source it cited",label:ie({id:"+ds/Q/",defaultMessage:"Don't like the source it cited"})},{match:wa,tag:"Shouldn't have run code",label:ie({id:"53w4ay",defaultMessage:"Shouldn't have run code"})},{match:wa,tag:"Couldn't handle my file",label:ie({id:"EkFTQ5",defaultMessage:"Couldn't handle my file"})},{match:({allGroupedMessages:t})=>t.some(e=>e.type===ot.Dalle),tag:"Shouldn't have created an image",label:ie({id:"S8FRsr",defaultMessage:"Shouldn't have created an image"})},{match:({allGroupedMessages:t})=>t.some(e=>{if(e.type!==ot.Text)return!1;const{message:n}=e.message,{content:a}=n;return a.content_type===it.Text&&Ra(n).match(/^```[\S]+\n/gm)}),tag:"Code was incorrect",label:ie({id:"4EBdQk",defaultMessage:"Code was incorrect"})},{match:({systemContent:t})=>ld(t).includes("Personality")??!1,tag:"Too chatty or casual",label:ie({id:"ATzJKW",defaultMessage:"Too chatty or casual"})},{match:({features:t})=>t.includes(Ys.Sunshine),tag:"Shouldn't have used Memory",label:ie({id:"yfUEiz",defaultMessage:"Shouldn't have used Memory"})},{tag:"Don't like the style",label:ie({id:"nGxjdj",defaultMessage:"Don't like the style"})},{tag:"Not factually correct",label:ie({id:"Ke7JtQ",defaultMessage:"Not factually correct"})},{tag:"Didn't fully follow instructions",label:ie({id:"Rdlt9V",defaultMessage:"Didn't fully follow instructions"})},{tag:"Refused when it shouldn't have",label:ie({id:"2yRS/Q",defaultMessage:"Refused when it shouldn't have"})},{tag:"Being lazy",label:ie({id:"14MPmT",defaultMessage:"Being lazy"})},{tag:"Unsafe or problematic",label:ie({id:"02pXBl",defaultMessage:"Unsafe or problematic"})},{tag:"Other",label:ie({id:"WiIGE+",defaultMessage:"Other"})}],dd=[{tag:"I disagree with the policy",label:ie({id:"oKyDLz",defaultMessage:"I disagree with the policy"})},{tag:"This didn't violate the policy",label:ie({id:"7fUkVF",defaultMessage:"This didn't violate the policy"})},{tag:"I don't understand the policy",label:ie({id:"4Cdp6N",defaultMessage:"I don't understand the policy"})},{tag:"This didn't take the full context",label:ie({id:"vnZJDP",defaultMessage:"This didn't take the full context"})}];function ud(t,e,n){return e.filter(a=>!a.match||a.match(n)).map(a=>({value:a.tag,label:t.formatMessage(a.label)}))}function hd(t){const e=t[t.length-1];if(!e)return!1;const n="message"in e?e.message:null;if(n){const{errCode:a}=$n(n);return[Zn.ContentPolicy,Zn.ContentOrTos].includes(a)}else return!1}function md({clientThreadId:t,conversationMessage:e,currentModelId:n,allGroupedMessages:a}){const o=ze(),i=Qs()??[],l=e.rating,c=nl(t,e.message.id),d=(c==null?void 0:c.message.content.content_type)===it.SystemContent?c==null?void 0:c.message.content:null,h=m.useCallback(y=>{const S=G.getServerThreadId(t);S&&(y.tags.length===0&&!y.textFeedback||(ee.logEvent(y.source==="inline"?$.messageFeedbackInlineSubmitted:$.messageFeedbackDialogSubmitted,{id:e.message.id,threadId:S,tags:y.tags,content:y.textFeedback,model:n,rating:l}),l&&Me.submitMessageFeedback({message_id:e.message.id,conversation_id:S,rating:l,text:y.textFeedback,tags:y.tags,tag_choices:y.tagChoices})))},[t,e.message,n,l]),p=()=>{ee.logEvent($.messageFeedbackMoreOptionsClicked,{id:e.message.id,threadId:G.getServerThreadId(t),model:n,rating:l})},f=ud(o,hd(a)?dd:cd,{allGroupedMessages:a,features:i,currentModelId:n,systemContent:d});return l==="thumbsUp"?null:s.jsx(Jl,{tagOptions:f,onSubmit:h,onMoreClicked:p})}const Ma=[1,2,3,4,10,20,30],gd=.5;function fd({clientThreadId:t,conversationLeafId:e}){const n=Ws(Vn.isBusinessWorkspace),a=m.useRef(!1),o=tn(t),i=sn(t),{isUnauthenticated:l}=Lt(),c=m.useMemo(()=>{if(!o)return-1;const _=$a(o);return _()>gd?-1:Ma[Math.floor(_()*Ma.length)]},[o]),d=Xa(t,e),h=d[d.length-1],p=m.useMemo(()=>zs.getRequestIdFromConversationTurn(h),[h]),f=ss(p),[y,S]=m.useState(null),[C,g]=m.useState(!1),[b,u]=m.useState(!1),[x,w]=m.useState(!1),v=_=>{var W,D;const z=(D=(W=Jt(d))==null?void 0:W.messages[0])==null?void 0:D.message.id;S(_),H(z,_)},A=d.filter(_=>_.role===pe.Assistant).length,L=(h==null?void 0:h.role)===pe.Assistant,N=h==null?void 0:h.messages.some(_=>{var z;return(z=_.message.metadata)==null?void 0:z.is_nulligen}),H=m.useMemo(()=>Ua((_,z)=>{o&&_&&Me.submitConversationRating({conversation_id:o,message_id:_,rating:z,shown_at_assistant_turn:c}),ee.logEvent($.conversationRatingSubmitted,{rating:z,showAtAssistantTurn:c,conversationId:o}),g(!0),setTimeout(()=>{u(!0)},1500)},2e3),[o,c]),P=A!==c||f||!L||N||!!n||(i==null?void 0:i.kind)!==at.PrimaryAssistant||x||l;return m.useEffect(()=>{!P&&!a.current&&(ee.logEvent($.conversationRatingShown,{showAtAssistantTurn:c,conversationId:o}),a.current=!0)},[P]),x||P?null:s.jsxs("div",{className:"mx-auto",children:[s.jsx(za,{children:C&&!b&&s.jsx(Rt.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:s.jsx(_a,{$padded:!0,children:s.jsx("span",{className:"text-sm text-token-text-tertiary",children:s.jsx(F,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!C&&s.jsx(Rt.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:s.jsxs(_a,{$padded:!1,children:[s.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-secondary",children:[s.jsx(F,{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?"}),s.jsxs("div",{className:"flex items-center gap-5",children:[s.jsx(Mn,{$selected:y==="thumbsUp",onClick:()=>v("thumbsUp"),children:s.jsx(oo,{className:"icon-md"})}),s.jsx(Mn,{$selected:y==="thumbsDown",onClick:()=>v("thumbsDown"),children:s.jsx(io,{className:"icon-md"})})]})]}),s.jsx("div",{className:"w-px flex-1 self-stretch bg-token-main-surface-tertiary"}),s.jsx(Mn,{className:"p-3",$selected:!1,onClick:()=>w(!0),children:s.jsx(jl,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const Mn=$e.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,_a=$e.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`;function pd({clientThreadId:t,conversationLeafId:e,canShowIndepthFeedbackType:n,canShowInlineComparisonFeedback:a,canShowInlineMessageFeedback:o,messageForRating:i,allGroupedMessages:l,currentModelId:c,conversationTurnMountTime:d,variantIds:h}){let p=null;return al(t,e)?null:(n!==void 0?p=s.jsx(Pc,{clientThreadId:t,conversationLeafId:e,trigger:n,variantIds:h}):i.rating&&o?p=s.jsx(md,{clientThreadId:t,conversationMessage:i,allGroupedMessages:l,currentModelId:c}):a?p=s.jsx(id,{clientThreadId:t,messageForRating:i,variantIds:h,conversationTurnMountTime:d}):p=s.jsx("div",{className:"text-center",children:s.jsx(fd,{clientThreadId:t,conversationLeafId:e})}),s.jsx("div",{className:"mt-3 w-full empty:hidden",children:p}))}const xd=St(()=>Ct(()=>import("./sso-da2v16cola0b6d9b.js").then(t=>t.m),__vite__mapDeps([31,1,2,3,32,6,7,13,33,34,35,36,37,38,15,39,11,10,40,41,42,43,44,12,9,45,46,47,48,49,17,29,50,51,27,28,52,25,26,30,53,54,55,56,57,58,59,60,19,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,16,80,81,82,83,84,85,86,87,88,89,90,91,92,93])).then(t=>t.ContextualAnswerCitationCards).catch(()=>()=>null));function bd(t){var js;const{turnIndex:e,conversationLeafId:n,isFinalTurn:a,clientThreadId:o,onChangeItemInView:i,onChangeRating:l,showInlineEmbeddedDisplay:c=!1,currentModelId:d,initiallyHighlightedMessageId:h,avatarClassName:p,scrollToBottom:f}=t,y=ze(),S=Wn(),C=!!S&&qo(S),g=Zs(),b=Ws(Vn.isBusinessWorkspace),u=Bn(),x=Gn(),w=Yt(ol(o,e,n)),{messages:v,variantIds:A,variantsInStreamInfo:L}=w,N=Hs(v),H=Zi();let P=v[v.length-1];for(const Y of N){const le=Qr(Y);if(le.some(We=>H.has(We.message.id))){P=le[le.length-1];break}}const _=v.slice(0,v.indexOf(P)+1),z=Pa(),[W,D]=m.useState(!1),[Q,T]=m.useState(!1),R=A.findIndex(Y=>_.some(le=>le.nodeId===Y)),k=w.role===pe.User,K=vt(),O=rt(o),q=(js=ls(w.gizmoId??O))==null?void 0:js.data,te=er(),ne=q&&te.includes(q.gizmo.id),Be=Ka(d),xe=sn(o,q==null?void 0:q.gizmo.id),Qe=il(o)===$o.PENDING,{data:Ye}=Hn(q==null?void 0:q.gizmo.id,!1,x),Ae=Ye==null?void 0:Ye.memoryFullPct,Ne=Ae!==void 0&&Ae>=100,Ge=Qs(),{value:us}=Us("1410082514"),{value:Ot}=Us("2291672486"),an=_.some(Y=>Y.message.content.content_type===it.MultimodalText),{isUnauthenticated:lt}=Lt(),[hs,ms]=m.useState(!1),[on,Ut]=m.useState(!1);tr(()=>{w.role==="user"&&f&&f()});const zt=m.useRef(null);m.useEffect(()=>{var le;if(h==null)return;w.messages.map(We=>We.message.id).includes(h)&&((le=zt.current)==null||le.scrollIntoView({behavior:"auto"}))},[h]);const U=v[v.length-1],ke=U.rating,gs=()=>{_.length===1&&(ee.logEvent($.editPrompt,{id:_[0].message.id,threadId:G.getServerThreadId(o)}),Ue.logEvent("chatgpt_edit_prompt"),D(!0))},fs=m.useCallback(()=>{D(!1)},[]),He=m.useCallback(()=>{G.copyMessageToClipboard(o,e)},[o,e]),ct=Y=>{l({nodeId:U.nodeId,messageId:U.message.id,rating:Y}),ee.logEvent($.messageFeedbackThumbsDownClicked,{id:U.message.id,threadId:G.getServerThreadId(o),model:d,rating:Y}),T(!0)},[Bt]=m.useState(()=>Date.now()),rn=m.useMemo(()=>zs.getRequestIdFromConversationTurn(w),[w]),ln=rl({clientThreadId:o,conversationLeafId:n}),be=ss(rn)&&!ln,cn=qa(),Gt=Hs(_),{showDebugConversationTurns:dn}=cs(),Ht=ll(o),ps=uo(o),Wt=Oc({clientThreadId:o,conversationMode:xe}),un=en(o),xs=m.useCallback(({requestedModelId:Y,systemMessage:le,juice:We,extraStreamParams:he})=>{const gt=new _n;Wt({id:U.nodeId,eventMetadata:{eventSource:"mouse"},turnTracker:gt,requestedModelId:Y,systemMessage:le,juice:We,extraStreamParams:he})},[U,Wt]),bs=us&&_.some(Y=>{var le;return((le=Y.message.metadata)==null?void 0:le.snorkle_status)!=null}),ys=!g&&!Ht&&!K&&!k,Vt=ys&&(!b||bs),qt=sr(),$t=!lt&&Vt&&z&&!be&&!Qe&&!c&&!W&&(xe==null?void 0:xe.kind)!==at.GizmoMagicCreate&&R===1&&a&&!U.inlineComparisonRating&&!ke&&A.length===2&&!qt&&Date.now()-(U.message.create_time??0)*1e3<1e3*60*10,vs=!lt&&Vt&&!be&&!Qe&&!c&&!W&&(xe==null?void 0:xe.kind)!==at.GizmoMagicCreate&&d===pi&&a&&u&&!Ne&&Date.now()-(U.message.create_time??0)*1e3<1e3*60*10,Ss=Dc(U),Cs=P.message.author.role===pe.Assistant?P.message:null;nr({isCompletionRequestInProgress:be,isUserTurn:k,message:Cs});const ws=vs?Ss:void 0,Ms=cl(o,A),dt=ar(xe),_s=!qt&&!dt&&ys&&a&&(L==null?void 0:L.num_variants_in_stream)===2&&!U.inlineComparisonRating&&!Ms,ks=A.length===2,wt=_s,ut=_s&&!ks,Mt=!k&&!c&&!g&&!Ht&&!dt&&!Qe&&!be,Kt=Mt&&(!b||bs||Be||C)&&!dt&&!lt&&!K,_t=!g&&!c&&!((be||Qe)&&a)&&A.length>1&&!W&&!wt;let Qt=!1;if(k&&_.length===1){const{shouldHideContent:Y}=$n(_[0]);Y&&(Qt=!0)}const Ts=k&&!c&&!dt&&!g&&!an&&_.length===1&&!Qt&&!W&&!lt,B=Y=>{i(A[Y]),ee.logEvent($.changeNode,{intent:"toggle_between"})};if(!(w.role===pe.Root?!1:w.role===pe.System||_.every(Y=>{var le;return(le=Y.message.metadata)==null?void 0:le.is_visually_hidden_from_conversation})?dn:!0)&&!wt)return null;const re=a&&ps&&!Ot?s.jsx(Fs,{onClick:()=>{const Y=new _n;Wt({id:un,eventMetadata:{eventSource:"mouse"},turnTracker:Y}),or()},icon:nn,label:y.formatMessage({id:"ConversationTurn.regenerateTooltip",defaultMessage:"Regenerate"}),testId:"regenerate-turn-action-button"}):null,ue="h-[30px] rounded-md px-1 text-token-text-secondary hover:bg-token-main-surface-secondary",Je=Ot?s.jsx(td,{className:ue,clientThreadId:o,message:U,onModelSelect:xs,onDropdownChange:ms,canRegenerateResponse:ps}):null,ht=!k&&!Qt&&!c&&(!a||!be)?s.jsx(hr,{onClick:He}):null,mt=!k&&!c&&(!a||!be)&&(U.disclaimers??[]).length===0&&U.nodeId?s.jsx(qc,{conversationId:o,message:U,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-xs text-token-text-tertiary hover:text-token-text-primary"}):null,Xe=!k&&!c&&U&&(!a||!be)?s.jsx(mr,{message:U,isFinalTurn:a,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-token-text-tertiary hover:text-token-text-primary"}):null,hn=Kt&&!be?s.jsxs("div",{className:"flex",children:[!(Ge!=null&&Ge.includes(Ys.ThumbsDownOnly))&&ke!=="thumbsDown"&&s.jsx(Fs,{onClick:()=>ct("thumbsUp"),disabled:ke==="thumbsUp",icon:ke==="thumbsUp"?Al:oo,label:y.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"},`thumbsUp:${U.nodeId}`),ke!=="thumbsUp"&&s.jsx(Fs,{onClick:()=>ct("thumbsDown"),disabled:ke==="thumbsDown",icon:ke==="thumbsDown"?Nl:io,label:y.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"},`thumbsDown:${U.nodeId}`)]}):null,mn=!Ot&&s.jsx(Ec,{className:ue,clientThreadId:o,message:U,onModelSelect:xs,onDropdownChange:ms});return s.jsxs("article",{className:"w-full text-token-text-primary focus-visible:outline-2 focus-visible:outline-offset-[-4px]",ref:zt,dir:"auto","data-testid":`conversation-turn-${e}`,"data-scroll-anchor":a,onMouseEnter:()=>Ut(!0),onMouseLeave:()=>Ut(!1),children:[s.jsx(ir,{role:w.role}),s.jsx(Qa,{clientThreadId:o,showInlineEmbeddedDisplay:c,isStaticSharedThread:g,withVerticalPadding:!0,withHorizontalPadding:!wt,children:wt?s.jsx(nd,{isFeedbackEnabled:Kt,variantIds:A,variantsInStreamInfo:L,conversationTurnMountTime:Bt,stubSideBySideFeedback:ut,...t}):s.jsxs(Rs,{children:[!k&&s.jsx(vd,{children:s.jsx(Ln,{messages:_,isUserTurn:k,avatarClassName:p,showInlineEmbeddedDisplay:c,gizmo:q})}),s.jsx("div",{className:se("group/conversation-turn relative flex w-full min-w-0 flex-col",!k&&rr),children:s.jsx("div",{className:"flex-col gap-1 md:gap-3",children:s.jsxs(s.Fragment,{children:[!k&&!g&&s.jsx(On,{messages:_,isMemoryEnabled:u,isMemoryFull:Ne,gizmoId:q==null?void 0:q.gizmo.id}),s.jsx(jn,{groupedMessagesToRender:Gt,allGroupedMessages:N,...t,isEditing:W,isUserTurn:k,isCompletionRequestInProgress:be,isFeedbackEnabled:Kt,isFinalTurn:a,hasActiveRequest:cn,showEditButton:Ts,handleEnterEdit:gs,handleExitEdit:fs}),ne&&s.jsx("div",{className:"mb-4",children:s.jsx(lr,{messages:_})}),Be&&s.jsx("div",{className:"mb-4",children:s.jsx(xd,{messages:_})}),(Mt||_t)&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:se("mb-2 flex gap-3 empty:hidden",k?"mr-1 flex-row-reverse":"-ml-2"),children:s.jsx(cr,{alwaysShow:a,showInline:a||_t,isHovered:on||hs,pagination:_t&&s.jsx(dr,{showInline:a||_t,currentPage:R,onChangeIndex:B,length:A.length,className:se("self-center",A.length>1?"visible":"!invisible")}),actions:Mt&&s.jsxs(s.Fragment,{children:[mt,ht,re,hn,Xe,mn,Je]})})}),Mt&&!be?s.jsx("div",{className:"pr-2 lg:pr-0",children:s.jsx(ur,{message:U,isFinalTurn:a})}):null,a&&!be&&s.jsx(pd,{canShowIndepthFeedbackType:ws,canShowInlineComparisonFeedback:$t,canShowInlineMessageFeedback:Q,clientThreadId:o,conversationLeafId:n,messageForRating:U,allGroupedMessages:N,currentModelId:d,conversationTurnMountTime:Bt,variantIds:A})]})]})})})]})})]})}const yd=Vo.memo(bd),vd=$e.div`flex-shrink-0 flex flex-col relative items-end`;function Sd(t){var n,a;const e=(n=t.message.metadata)==null?void 0:n.aggregate_result;return(a=e==null?void 0:e.messages)==null?void 0:a.some(Xl)}function Cd(t){const e=t.message.content;return("parts"in e?e.parts.join(""):"").includes("sandbox:")}function wd(t){return t.some(e=>e.messages.some(n=>Sd(n)||Cd(n)))}function Md({clientThreadId:t}){const e=dl(t),n=Za(t),a=qn(p=>ds.getThreadCreateTime(t,p)),o=en(t),i=Xa(t,o),l=m.useMemo(()=>wd(i),[i]),c=ul(t),d=hl(t),h=c||d;return s.jsxs("div",{className:"border-b border-gray-100 px-4 pb-4 pt-3 sm:mb-2 sm:pb-6 sm:pt-8 md:px-0",children:[s.jsx("h1",{className:"text-3xl font-semibold leading-tight text-token-text-primary sm:text-4xl",children:e}),(n!=null||a!=null)&&s.jsxs("div",{className:"pt-3 text-base text-gray-400 sm:pt-4",children:[n!=null&&s.jsx("span",{children:n}),n!=null&&a!=null&&s.jsx("span",{className:"px-2",children:"•"}),a!=null&&s.jsx(Ko,{value:a,month:"long",year:"numeric",day:"numeric"})]}),s.jsx(_d,{shouldShowCodeInterpreterDisclaimer:l,shouldShowPersonalizedDataDisclaimer:h})]})}const _d=({shouldShowCodeInterpreterDisclaimer:t,shouldShowPersonalizedDataDisclaimer:e})=>s.jsxs(s.Fragment,{children:[t&&s.jsx("div",{className:"mt-4",children:s.jsx(sa,{icon:Vs,children:s.jsx(F,{id:"sharedConversation.advancedDataAnalysisSupportDisclaimer",defaultMessage:"This chat contains files or images produced by Advanced Data Analysis which are not yet visible in Shared Chats."})})}),e&&s.jsx("div",{className:"mt-4",children:s.jsx(sa,{icon:Vs,children:s.jsx(F,{id:"sharedConversation.personalizedDataDisclaimer",defaultMessage:"This conversation may reflect the link creator’s personalized data, which isn’t shared and can meaningfully change how the model responds."})})})]}),kd=t=>{const e=vt();return m.useCallback(n=>{var c,d;gr(n);const{target:a}=n;if(!(a instanceof Element))return;const o=(c=a.closest("[data-message-id]"))==null?void 0:c.getAttribute("data-message-id"),i=(d=document.getSelection())==null?void 0:d.toString(),l=G.getServerThreadId(t);!o||!i||!l||e||Me.submitImplicitMessageFeedback({source:"keyboard",type:"copy",messageId:o,serverThreadId:l,selectedText:i})},[t,e])};function Td({onChangeItemInView:t,onRequestMoreCompletions:e,onChangeRating:n,onRequestCompletion:a,clientThreadId:o,conversationLeafId:i,inlineEmbeddedDisplay:l,initiallyHighlightedMessageId:c,hideHeader:d}){const h=fr(),p=Zs(),f=ml(),y=pr(),[S]=xr(),C=sn(o),g=Dt(),b=xi(o),u=h.store.useContentAreaDimensions(br.Header,T=>T!=null&&T.height?T.height:void 0),x=h.store.useIsHeaderContentAreaPopulated(),w=eo(o),{isArchived:v}=w,A=Gl(b.id),L=(C==null?void 0:C.kind)===at.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":A,N=to(o,i),H=yr(),[P,_]=m.useState(0);m.useEffect(()=>{f&&(P===0?_(N):N-P===1&&(Ue.logEvent("chatgpt_continue_conversation_first_message_sent"),ee.logEvent($.continueConversationFirstMessageSent)))},[N,P,f]),f&&(Ue.logEvent("chatgpt_continue_conversation_page_loaded"),ee.logEvent($.continueConversationPageLoaded));const z=m.useCallback(()=>{y({behavior:"smooth"})},[y]),W=kd(o),D=H&&!v,Q=(T,R,k)=>[...new Array(R-T).keys()].map(K=>{const O=K+T;return s.jsx(yd,{isFinalTurn:k(O),turnIndex:O,clientThreadId:o,conversationLeafId:i,onChangeItemInView:t,onChangeRating:n,onRequestMoreCompletions:e,onRequestCompletion:a,currentModelId:b.id,showInlineEmbeddedDisplay:l,initiallyHighlightedMessageId:c,avatarClassName:L,scrollToBottom:z},O)});return s.jsxs("div",{onCopy:W,className:se("flex flex-col text-sm",p&&"pt-2",D&&"pb-[120px]",u||D?null:"md:pb-9"),style:{paddingBottom:D?void 0:u},children:[!d&&(p||(g==null?void 0:g.data))&&!l&&s.jsx(co,{clientThreadId:o}),p&&!l&&s.jsx(Rs,{children:s.jsx(Md,{clientThreadId:o})}),f&&s.jsxs(s.Fragment,{children:[s.jsx(Rs,{children:s.jsx("p",{className:"text-xs text-gray-500",children:s.jsx(F,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),Q(0,P,T=>T===P-1),s.jsx(Rs,{children:s.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[s.jsx(El,{className:"icon-xs mr-2"}),s.jsx(F,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})}),Q(P,N,T=>T===N-1)]}),!f&&Q(0,N,T=>T===N-1),!S&&!l&&s.jsx(jd,{className:se(u?null:"bottom-5",D?x?"translate-y-[-50px]":"translate-y-[-10px]":""),style:{bottom:H?"calc(var(--composer-bar_footer-current-height) + var(--composer-bar_current-height))":u},onClick:()=>{Ue.logEvent("chatgpt_thread_scroll_to_bottom"),y({behavior:"smooth"})},children:s.jsx(Il,{className:"icon-md text-token-text-primary"})})]})}const jd=$e.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-light right-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`;function Ad({clientThreadId:t,currentModelId:e}){const n=Hl(e,Wl.CODE_INTERPRETER);Ed(n,t)}async function Nd({queryKey:[t,e]}){return await Me.getThreadInterpreterState(e).then(n=>(n.time_remaining_ms===0&&n.kernel_started&&Nt.warning("This advanced data analysis (beta) chat has timed out. You may continue the conversation, but previous files, links, and code blocks below may not work as expected.",{hasCloseButton:!0,duration:0}),n))}function Ed(t,e){const n=Zs(),a=G.getServerThreadId(e);return Qo({queryKey:["interpreterState",a],queryFn:Nd,enabled:!!(t&&a&&!n),gcTime:0})}const Id=St(()=>Ct(()=>import("./fbe67wq9353lif06.js"),__vite__mapDeps([94,1,2,3,10,6,7,11,9,29,71,47,48,85,64,26,15,37])).then(t=>t.OpenDebugSidebarButton)),Fd=St(()=>Ct(()=>import("./tgg9e4jo52j4ehc0.js"),__vite__mapDeps([95,1,2,3,6,7,69,11])),{ssr:!1}),Rd=St(()=>Ct(()=>import("./sso-da2v16cola0b6d9b.js").then(t=>t.n),__vite__mapDeps([31,1,2,3,32,6,7,13,33,34,35,36,37,38,15,39,11,10,40,41,42,43,44,12,9,45,46,47,48,49,17,29,50,51,27,28,52,25,26,30,53,54,55,56,57,58,59,60,19,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,16,80,81,82,83,84,85,86,87,88,89,90,91,92,93])).catch(()=>()=>null),{ssr:!1}),Pd=St(()=>Ct(()=>import("./sso-da2v16cola0b6d9b.js").then(t=>t.P),__vite__mapDeps([31,1,2,3,32,6,7,13,33,34,35,36,37,38,15,39,11,10,40,41,42,43,44,12,9,45,46,47,48,49,17,29,50,51,27,28,52,25,26,30,53,54,55,56,57,58,59,60,19,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,16,80,81,82,83,84,85,86,87,88,89,90,91,92,93])).then(t=>t.default)),Dd=St(()=>Ct(()=>import("./sso-da2v16cola0b6d9b.js").then(t=>t.q),__vite__mapDeps([31,1,2,3,32,6,7,13,33,34,35,36,37,38,15,39,11,10,40,41,42,43,44,12,9,45,46,47,48,49,17,29,50,51,27,28,52,25,26,30,53,54,55,56,57,58,59,60,19,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,16,80,81,82,83,84,85,86,87,88,89,90,91,92,93])).then(t=>t.CAFeedbackModal).catch(()=>()=>null)),qe=_e({doNotShareSensitive:{id:"thread.modal.onboarding.title",defaultMessage:"Do not share sensitive materials with this application"},mayProduceInaccurateInformation:{id:"thread.chatgptMayProduceInaccurateInformation-oct-30",defaultMessage:"ChatGPT can make mistakes. Check important info."},mayProduceInaccurateInformationNoAuth:{id:"thread.chatgptMayProduceInaccurateInformationNoAuth-march-27",defaultMessage:"ChatGPT can make mistakes. Check important info. Read our <termsLink>Terms</termsLink> and <privacyLink>Privacy Policy</privacyLink>."},mayProduceInaccurateInformationNoAuthV2:{id:"thread.chatgptMayProduceInaccurateInformationNoAuth-may-06",defaultMessage:"By messaging ChatGPT, you agree to our <termsLink>Terms</termsLink> and have read our <privacyLink>Privacy Policy</privacyLink>."},mayProduceInaccurateInformationNoAuthKorea:{id:"thread.chatgptMayProduceInaccurateInformationNoAuthKorea-may-06",defaultMessage:"By messaging ChatGPT, you agree to our <termsLink>Terms</termsLink> and have read our <privacyLink>Privacy Policy</privacyLink> and its <koreaAddendumLink>Korea addendum</koreaAddendumLink>."},businessDisclaimer:{id:"thread.businessDisclaimer-oct-30",defaultMessage:"{workspaceName} workspace chats aren't used to train our models. ChatGPT can make mistakes."},businessDisclaimerNoName:{id:"thread.businessDisclaimerNoName-oct-30",defaultMessage:"Your workspace chats aren'ts used to train our models. ChatGPT can make mistakes."},outdatedGptDisclaimer:{id:"thread.outdatedGptDisclaimer.0",defaultMessage:"<bold>New version of GPT available</bold> - Continue chatting to use the old version, or start a <link>new chat</link> for the latest version."},somethingWentWrong:{id:"thread.modal.unrecoverableError.title",defaultMessage:"Something went wrong"},tryAgainLater:{id:"thread.modal.unrecoverableError.description",defaultMessage:"We're sorry, but something went wrong. Please try again later."},resetThread:{id:"thread.modal.unrecoverableError.resetThread",defaultMessage:"Reset thread"},sharedConversationReportConversation:{id:"thread.sharedConversation.report",defaultMessage:"Report conversation"},latencyButton:{id:"thread.latencyButton",defaultMessage:"Latency"},archivedConversationDescription:{id:"thread.archivedConversationDescription",defaultMessage:"This conversation is archived. To continue, please unarchive it first."},unarchiveButton:{id:"thread.unarchiveButton",defaultMessage:"Unarchive"}});function Ld({clientThreadId:t}){const e=rt(t);return e!=null?s.jsx(Od,{clientThreadId:t,gizmoId:e}):s.jsx(So,{clientThreadId:t})}function Od({clientThreadId:t,gizmoId:e}){const n=ls(e).data,a=qn(i=>ds.getThreadCreateTime(t,i)),o=(n==null?void 0:n.gizmo.updated_at)!=null?new Date(n.gizmo.updated_at):void 0;return(n==null?void 0:n.gizmo.short_url)==null||o==null||a==null||o<=a?s.jsx(So,{clientThreadId:t}):s.jsxs("div",{className:"text-token-text-tertiary",children:[s.jsx(Fl,{className:"text-token-secondary mb-1 mr-1 inline-block h-4 w-4 stroke-0"}),s.jsx(F,{...qe.outdatedGptDisclaimer,values:{link:i=>s.jsx(ci,{to:wi(n.gizmo.short_url),className:"underline",children:i}),bold:i=>s.jsx("span",{className:"text-token-secondary font-semibold",children:i})}})]})}function Ud({clientThreadId:t}){return Ur(n=>n.hasAcceptedFooterDisclaimer)?s.jsx("div",{children:s.jsx(F,{...qe.mayProduceInaccurateInformation})}):s.jsx(zd,{clientThreadId:t})}function So({clientThreadId:t}){const e=Ws(Vn.isBusinessWorkspace),n=Ws(d=>d.currentWorkspace),a=n==null?void 0:n.name,{isUnauthenticated:o,isLoading:i}=Lt(),c=so({clientThreadId:t,role:pe.User})>0;return i?null:e?s.jsx("div",{children:a!=null?s.jsx(F,{...qe.businessDisclaimer,values:{workspaceName:a}}):s.jsx(F,{...qe.businessDisclaimerNoName})}):o&&!c?s.jsx(di,{children:s.jsx(Ud,{clientThreadId:t})}):s.jsx("div",{children:s.jsx(F,{...qe.mayProduceInaccurateInformation})})}function zd({clientThreadId:t}){const{country:e}=ui(),n=e==="KR"?qe.mayProduceInaccurateInformationNoAuthKorea:qe.mayProduceInaccurateInformationNoAuthV2,{layer:a}=is("3637408529"),o=(a==null?void 0:a.get("should_show_disclaimer_only_once_per_device",!1))??!1;return m.useEffect(()=>()=>{so({clientThreadId:t,role:pe.User})>0&&zr.updateHasAcceptedFooterDisclaimer(o)},[t,o]),s.jsx("span",{className:"text-sm leading-none",children:s.jsx(F,{...n,values:{privacyLink:i=>s.jsx("a",{href:"https://openai.com/privacy",target:"_blank",className:"text-token-text-primary underline decoration-token-text-primary",onClick:()=>{Ue.logEvent("chatgpt_footer_disclaimer_privacy_link_clicked"),ee.logEvent($.footerDisclaimerPrivacyLinkClicked)},rel:"noreferrer",children:i}),termsLink:i=>s.jsx("a",{href:"https://openai.com/terms",target:"_blank",className:"text-token-text-primary underline decoration-token-text-primary",onClick:()=>{Ue.logEvent("chatgpt_footer_disclaimer_terms_link_clicked"),ee.logEvent($.footerDisclaimerTermsLinkClicked)},rel:"noreferrer",children:i}),koreaAddendumLink:i=>s.jsx("a",{href:"https://openai.com/ko/policies/kr-privacy-policy-addendum",target:"_blank",className:"text-token-text-primary underline decoration-token-text-primary",onClick:()=>{Ue.logEvent("chatgpt_footer_disclaimer_korea_addendum_link_clicked"),ee.logEvent($.footerDisclaimerKoreaAddendumLinkClicked)},rel:"noreferrer",children:i})}})})}function Bd({clientThreadId:t}){const e=Da(),n=tn(t),a=async()=>{n&&(await Me.patchConversation(n,{is_archived:!1}),e.invalidateQueries({queryKey:["conversation",t]}),qn.setState(o=>{const i=o.threads[n];i!=null&&(i.initialThreadData.isArchived=!1)}),Ul(e))};return s.jsxs("div",{className:"my-6 flex flex-col items-center justify-center gap-4",children:[s.jsx("div",{className:"px-3 text-center text-sm text-token-text-secondary",children:s.jsx(F,{...qe.archivedConversationDescription})}),s.jsx("div",{children:s.jsx(nt,{disabled:!n,onClick:a,icon:Rl,children:s.jsx(F,{...qe.unarchiveButton})})})]})}function Gd(t,e){const n=es(t),a=G.getTitle(t);return e&&e.kind===at.GizmoInteraction&&e.gizmo?n?`ChatGPT - ${e.gizmo.gizmo.display.name}`:a&&`${e.gizmo.gizmo.display.name} - ${a}`:n?"ChatGPT":a}const fu=function({clientThreadId:t,initiallyHighlightedMessageId:e,continueConversationUrl:n,onCompletionFinished:a,preRequestCompletion:o,hideHeader:i,hideMessages:l,hideFooter:c,hideToolsOverlay:d,messagesVerticalAlign:h="top",prependThreadChildren:p,renderEmptyState:f}){var Ts;const y=Da(),S=Yo(),C=m.useContext(Ea),g=C!=null,b=Dt(),u=Qs(),x=Pa(),w=Bs(),v=Yr(t),A=Jo(),L=g&&((Ts=A.query)==null?void 0:Ts.action)==="moderate",N=Ya(t),H=en(t),_=eo(t).isArchived;m.useEffect(()=>{N||(es(t)?Os.addTiming("chatgpt.web.chatPage.renderNewConversation"):Os.addTiming("chatgpt.web.chatPage.renderExistingConversation"))},[t,N]);const z=gl(t,H),W=to(t,H),D=Za(t),{setTargetedContent:Q}=vr(),T=u==null?void 0:u.includes(Xo),R=Sr(),k=W>=2,K=es(t)&&!k&&xn(v),O=es(t)&&!z&&(xn(v)||(v==null?void 0:v.kind)===at.GizmoTest),te=bi().id,ne=yi(t)??te,{value:Be}=Us("4203174056"),xe=vi(t,Zo.Search),Ke=Ka(ne),Ye=La()[ne],Ae=Gd(t,v),Ne=sn(t),Ge=Cr(),us=Jr(t),{config:Ot}=ei("1013114931"),an=Ot.get("show_follow_ups",!1)&&(b==null?void 0:b.isPersonalAccount()),lt=!w.displayingSideBySideFeedback&&an,hs=vt();m.useEffect(()=>{na()},[]),m.useEffect(()=>{Ge||Q(void 0),G.getLastMessgageSystemHints(t,H).includes(Gs.Search)&&xe?aa.addPersistedSystemHint(Gs.Search):aa.clear()},[t,Q,Ge,H,S.search,xe]);const ms=m.useCallback(B=>{if(B==null||(a==null||a(B),hs)||((Ne==null?void 0:Ne.kind)===at.GizmoInteraction&&Si.handleGizmoInteracted(y,Ne.gizmo_id),!(us||lt)))return;const re=G.getThreadCurrentLeafId(B),ue=G.getTree(B).getMessage(re);ti(ue)||si(ue)||wr(B,ue.id,ne)},[y,a,Ne,us,lt,ne,hs]),on=fl(t),Ut=Xr(t,on,ms),zt=m.useCallback(()=>{const B=G.getThreadCurrentLeafId(t);if(B==null)return;const re=G.getTree(t).getBranchFromLeaf(B);Mr.abortRequests(re.map(ue=>ue.id))},[t]),U=cs(),{isUnauthenticated:ke,isLoading:gs}=Lt(),fs=_r(),He=m.useCallback(async({type:B,promptId:ye,requestedModelId:re,eventMetadata:ue,cancelActiveRequests:Je,focusOnNewCompletion:ht=!0,useDefaultModel:mt,completionMetadata:Xe,appendMessages:hn,updateTree:mn,turnTracker:js,extraStreamParams:Y})=>{na(),kr.reset(),Je&&zt();const le=performance.now();let We=ne;re?We=re:mt&&(We=te);const he=Tr({namespace:jr.CompletionRequest,key:ye});he==null||he.logTiming("start_chat_requirements");const gt=await ni();he==null||he.logTiming("fetched_chat_requirements"),gt.force_login&&fs({authType:"login"});const Co=await ai.getEnforcementToken(gt);he==null||he.logTiming("fetched_arkose_token");const wo=await Ar.getEnforcementToken(gt);he==null||he.logTiming("fetched_turnstile_token");const Mo=await oi.getEnforcementToken(gt);he==null||he.logTiming("fetched_p_token"),o==null||o(t,ye),Ut({model:We,completionType:B,parentNodeId:ye,metadata:ue,focusOnNewCompletion:ht,completionMetadata:Xe,chatReq:gt,arkoseToken:Co??null,turnstileToken:wo??null,proofToken:Mo??null,preflightTime:performance.now()-le,extraStreamParams:{forceParagen:U.forceParagen,forceParagenModel:U.forceParagenModel.value,forceNulligen:U.forceNulligen,forceRateLimit:U.forceRateLimit,resetRateLimits:U.resetRateLimits,disableSystemContentToggling:U.rebaseSystemMessageContent?!0:void 0,forceUseSearch:U.forceUseSearch??(Y==null?void 0:Y.forceUseSearch)},appendMessages:hn,updateTree:mn,turnTracker:js}),ke&&Nr.incrementUserMessageCount()},[te,ne,o,t,Ut,U.forceParagen,U.forceParagenModel,U.forceNulligen,U.forceRateLimit,U.resetRateLimits,U.rebaseSystemMessageContent,U.forceUseSearch,zt,fs,ke]),ct=!!(b!=null&&b.features.includes(Ys.SharedWebsocket));m.useEffect(()=>{ct&&bn.registerIfNotConnected()},[ct]),m.useEffect(()=>{const B=()=>{if(document.visibilityState==="visible"){if(!ct)return;bn.registerIfNotConnected()}};return document.addEventListener("visibilitychange",B),()=>{document.removeEventListener("visibilitychange",B)}},[ct]);const Bt=tn(t);m.useEffect(()=>{const B=()=>{bn.stopConversation(Bt)};return window.addEventListener("beforeunload",B),()=>{window.removeEventListener("beforeunload",B)}},[Bt]);const rn=Ci({clientThreadId:t,currentLeafId:H,handleRequestCompletion:He}),ln=m.useCallback((B,ye,re,ue=!0,Je="none",ht)=>{const Xe=G.getTree(t).getParentPromptNode(B).id;He({type:Fa.Variant,promptId:Xe,eventMetadata:ye,cancelActiveRequests:!1,focusOnNewCompletion:ue,useDefaultModel:ht,completionMetadata:{variantPurpose:Je,conversationMode:ds.getConversationMode(t)},turnTracker:re})},[He,t]),be=m.useCallback(B=>{const re=G.getTree(t).getLeafFromNode(B);G.setThreadCurrentLeafId(t,re.id)},[t]),[cn,Gt]=m.useState(),dn=m.useCallback(({nodeId:B,messageId:ye,rating:re})=>{var mt;const ue=G.getServerThreadId(t);ee.logEvent($.thumbRating,{id:ye,threadId:ue,rating:re,model:ne});const Je=G.getTree(t),ht=Je.getNodeByIdOrMessageId(B);if(ue!==void 0&&(Ke?xt:Me.submitMessageFeedback)({message_id:ye,conversation_id:ue,rating:re}),G.updateTree(t,Xe=>{Xe.updateNodeMetadata(B,{rating:re})}),Ke){Gt(s.jsx(Dd,{citations:((mt=ht.message.metadata)==null?void 0:mt.citations)??[],rating:re,conversationId:ue??"",messageId:ye,onSubmit:()=>{Gt(void 0)},onCancel:()=>Gt(void 0),conversationTree:Je,nodeId:B},`${B}-${re}`));return}},[t,ne,Ke]),{setShowReferralInviteModal:Ht}=oa(B=>({setShowReferralInviteModal:B.setShowReferralInviteModal})),ps=m.useCallback(()=>{Ht(!1)},[Ht]),Wt=oa(B=>B.showReferralInviteModal);Ad({clientThreadId:t,currentModelId:ne});const un=B=>g?s.jsx("div",{className:"h-full overflow-auto bg-token-main-surface-primary",children:B}):s.jsx(Vl,{scrollAnchorTopOffset:i?0:Or,children:h==="bottom"?s.jsxs("div",{className:"flex h-full flex-col",children:[s.jsx("div",{className:"flex-1"}),B]}):B});m.useEffect(()=>{document.title=Ae??"ChatGPT"},[Ae]);const xs=rt(t),bs=vt(),ys=tc(),Vt=O&&!f&&x&&!xs&&!Ke&&!bs,qt=Vt&&!gs&&ke,$t=Vt&&!gs&&!ke,vs=$t&&ys,Ss=sc(qt),Cs=ec($t),ws=nc(vs),Ms=qt&&Ss||$t&&Cs||vs&&ws,dt=Ss||Cs||ws,{composerBarSize:_s,composerSkeleton:ks,footerBarSize:wt,isClippedComposerBar:ut,setComposerBarElement:Mt,setFooterBarElement:Kt,ThreadSizeWrapper:_t}=Er({isArchived:_}),Qt=ut?{footerBarSize:wt,composerBarSize:_s}:{};return s.jsxs(_t,{...Qt,children:[T&&s.jsx(Fd,{}),Be&&s.jsx(Pd,{}),s.jsxs(ii,{children:[Ae!=null&&s.jsx("title",{children:Ae}),g&&s.jsxs(s.Fragment,{children:[s.jsx("meta",{property:"og:site_name",content:"ChatGPT"}),s.jsx("meta",{name:"robots",content:C.isIndexable?"index,nofollow":"noindex,nofollow"},"robots"),s.jsx("meta",{property:"og:title",content:Ae??"Shared Chat on ChatGPT"},"og:title"),s.jsx("meta",{property:"og:description",content:"Shared "+(D!=null?`by ${D} `:"")+"via ChatGPT"},"og:description"),s.jsx("meta",{property:"og:image",content:ri.src},"og:image")]})]}),(v==null?void 0:v.kind)===at.GizmoInteraction&&v.gizmo&&s.jsx(Mi,{gizmo:v.gizmo}),s.jsx(Ia.Provider,{value:He,children:s.jsxs(Ir,{children:[s.jsxs(Zr,{clientThreadId:t,currentModelConfig:Ye,className:"composer-parent flex h-full flex-col focus-visible:outline-0",children:[!l&&s.jsx(Hd,{className:se(ut&&"masked-content"),style:{"--composer-bar_skeleton":ks},children:!N&&!rn?O?f??s.jsx(ea,{shouldSSR:!dt,children:s.jsx(wc,{clientThreadId:t,currentModelId:ne,onRequestCompletion:He,enableV2Homepage:Ms})}):k?un(s.jsxs(s.Fragment,{children:[p,s.jsx(Td,{onChangeItemInView:be,onRequestMoreCompletions:ln,onChangeRating:dn,onRequestCompletion:He,clientThreadId:t,initiallyHighlightedMessageId:e,inlineEmbeddedDisplay:!1,conversationLeafId:H,hideHeader:i},t)]})):null:null}),s.jsx(Wd,{className:se(ut&&"mask-scrollbars absolute bottom-0 z-20"),children:_?s.jsx(Bd,{clientThreadId:t}):s.jsxs("div",{className:se(ut&&"relative mx-auto flex max-w-3xl flex-1 flex-col"),children:[ut?s.jsx(Fr,{skeleton:ks}):null,g?s.jsx(fc,{clientThreadId:t,isModeratingThread:L,continueConversationUrl:n}):!Ms&&s.jsx(ea,{shouldSSR:!dt,children:s.jsx(el,{clientThreadId:t,isNewThread:K,setComposerBarElement:Mt,showPromptStarters:K||!z,currentModelId:ne,onRequestCompletion:He})}),!c&&s.jsx("div",{ref:Kt,className:"relative w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",children:g?s.jsx(Rr,{onClickReportSharedConversation:()=>{Xs.openModal(ts.ReportConversation)}}):xn(v)&&s.jsx("div",{className:"min-h-4",children:s.jsx(Ld,{clientThreadId:t})})})]})})]}),!d&&s.jsxs("div",{className:"group absolute bottom-2 end-2 z-20 hidden gap-1 md:flex lg:bottom-3 lg:end-3",children:[R?s.jsxs(s.Fragment,{children:[s.jsx(Id,{}),s.jsx(Rd,{})]}):null,s.jsx(Pl,{})]}),cn,s.jsx(_i,{serverThreadId:(C==null?void 0:C.serverSharedThreadId)??void 0,clientThreadId:t,isStaticSharedThread:g}),s.jsx(mc,{clientThreadId:t}),s.jsx(Pr,{}),(u==null?void 0:u.includes(li))&&s.jsx(Dr,{isOpen:Wt,onClose:ps}),s.jsx(Lr,{conversationId:t,currentModelId:ne})]})})]})},Hd=$e.div`grow flex-1 overflow-hidden`,Wd=$e.div`md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent w-full`;export{Zl as C,fu as T,Td as a,yd as b,wd as m};
//# sourceMappingURL=cwyeis2w6kea2wfl.js.map
