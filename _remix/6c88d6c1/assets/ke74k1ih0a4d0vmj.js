const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/fpd5vvj4wix5kt97.js","assets/gkip3s8xpilxjlzw.js","assets/dlpb2yv5mb3tebui.js","assets/root-k8yvx6b6.css","assets/n766k8stggevg9f9.js","assets/conversation-small-lkohtmkm.css","assets/mws8ez1ajglpz42u.js","assets/fzrn137102spawew.js","assets/e9lafxuzyeh4418f.js","assets/j3b8n4zxfeupyk44.js","assets/eal163hph4mmv9xy.js","assets/gw079avgdfmxa4n6.js","assets/lanrgm65dquwirhw.js","assets/mzkxlhrlmxhntkvn.js","assets/blplysrfffl13ibt.js","assets/npdllztobztvt45m.js","assets/bskdnb56jx9fuuwl.js","assets/c4bxzbp1808foto4.js","assets/coatal4tjz6bpdr6.js","assets/jgurbidx2oosikw9.js","assets/bd718h5b83o2acjn.js","assets/lm3r8g1khxq680lr.js","assets/h2wh3lo1pha4b8r2.js","assets/jdwwosck1eac76ro.js","assets/n4hvmre64pu13d7d.js","assets/nht4y32i33ww444c.js","assets/lkkrxz1zfvp0rlmy.js","assets/jilzytsduxcss3z2.js","assets/gap205x8uwry16xb.js","assets/my433o6kws59bdqf.js"])))=>i.map(i=>d[i]);
import{cQ as Ue,e0 as ne,q,o as N,v as oe,at as ie,W as Fe,be as Oe,D as Ae,e_ as Xs,cv as Be,cw as De,cx as We,af as ds,b6 as Js,b3 as He,b4 as $e,aI as us,r as d,b8 as qe,bE as ms,m as e,L as Q,O as ae,w as gs,db as X,bB as fs,u as be,co as Qe,bd as f,bj as pe,K as le,ed as et,aJ as ps,a9 as ue,aE as re,hz as st,a4 as ye,f2 as hs,bQ as V,ck as Ve,di as xs,bk as ke,P as vs,d as js,bo as bs,b5 as ys,cC as tt,gI as Ms,e3 as it,dg as he,e9 as at,M as nt,a1 as rt,bH as es,bI as ss,gZ as ot,dB as lt,dC as ct,f$ as dt,aa as ut,gL as mt,g0 as gt}from"./gkip3s8xpilxjlzw.js";import{bp as ft,bo as pt,iS as ws,b6 as Ts,hx as Ke,aQ as ht,iT as xt,iU as Ps,iV as ks,c0 as Ss,iW as Cs,bd as Is,U as de,fg as W,b as Ns,bR as je,bS as _s,e_ as Ye,eI as vt,eA as jt,cr as bt,cO as Le,aB as A,eK as xe,eG as ve,eC as Ze,hE as Gs,iX as yt,hY as As,hZ as Mt,iY as wt,d$ as se,eB as Tt,ce as Ls,fd as zs,iZ as Pt,bl as kt,fe as Rs,ff as Es,fh as St,i_ as Ct,cU as It,fi as Nt,bk as ze,fj as _t,i$ as Gt,j0 as ts,j1 as Se,j2 as At,cQ as is,dW as Us,ew as Lt,ex as zt,ey as Rt,dX as Et,aC as Ut,co as Ft,j3 as as,j4 as Ot,cJ as Bt,e0 as Dt,j5 as Wt,bb as Ht,en as $t,fS as ns,j6 as qt,j7 as Qt,ax as Vt,j8 as Kt,j9 as Yt,n as Zt,ja as rs,jb as Xt,cG as Jt}from"./n766k8stggevg9f9.js";import{i as ei,c as Me,C as te,M as Fs,A as ce,G as si,a as ti,b as os,s as ii,r as Re,S as ai,d as ni,E as ri,e as oi,g as li,f as ci,h as di}from"./npdllztobztvt45m.js";import{C as Os,T as Bs}from"./bd718h5b83o2acjn.js";import{i as Ee}from"./gap205x8uwry16xb.js";import{ai as Ds,ah as ui,M as mi,aW as Ws,az as gi,bC as fi,G as pi,b3 as hi,b7 as xi,z as vi,A as ji,v as bi,bv as yi,m as Mi,n as wi,bw as Ti}from"./dlpb2yv5mb3tebui.js";import{G as Pi}from"./my433o6kws59bdqf.js";import{F as K,a as Y,b as Ce,c as ki,G as Si,d as Ci}from"./blplysrfffl13ibt.js";import{m as Hs}from"./h2wh3lo1pha4b8r2.js";import{G as Ii}from"./n4hvmre64pu13d7d.js";function Ni(s,t){const i=N.getThreadCurrentLeafId(s),r=N.getTree(s),n=[];let o=r.getNodeByIdOrMessageId(i);for(;o!=null&&(t==null||o.id!==t);)n.unshift(o.message),o=o.parentId!==""?r.getNodeByIdOrMessageId(o.parentId):void 0;return n}function _i(s){return s.filter(r=>r.recipient==="gizmo_editor.update_behavior").flatMap(r=>r.content.content_type==="text"?r.content.parts:r.content.content_type==="code"?[r.content.text]:[]).map(r=>JSON.parse(r)).reduce((r,n)=>({...r,...n}),{})}async function Gi(s){let t;for(const i of s)if(i.author.name==="gizmo_editor.generate_profile_pic"){const r=Js.getImageAssetPointers(i);r.length>0&&(t=r.at(-1))}if(t!=null){const i=ht(t.asset_pointer),r=await Fe.getFileDownloadLink(i);if(r.status===Oe.Success)return{id:i,permalink:r.download_url}}}async function Ai(s,t,i,r){const n=Ni(t,r),o=_i(n);let a=await Gi(n);if(Ee(o)&&a==null)return;const{name:m,context:c,description:p,profile_pic_file_id:b,prompt_starters:w}=o;if(b!=null)try{const u=await Fe.getFileDownloadLink(b,s.id);u.status===Oe.Success&&(a={id:b,permalink:u.download_url})}catch(u){Ae.addError(new Error("Error while retrieving profile pic in update",{cause:u})),i.warning("Something went wrong updating your GPT's profile picture.",{duration:3})}const l={name:typeof m=="string"?m:void 0,description:typeof p=="string"?p:void 0,instructions:typeof c=="string"?c:void 0,promptStarters:Array.isArray(w)?w:void 0,profilePictureId:a?.id,profilePictureUrl:a?.permalink};return Xs(l,u=>u!=null)}function Li(s){const t=new Set;for(const c of s.tools)t.add(c.type);const i=s.name??"",r=s.description??"",n=s.instructions??"",o=Array.from(t).join(","),a=i===""&&r===""&&n==="",m=s.profilePictureUrl!=null;return a?`The GPT you are about to has the following abilities: ${o}.`:`This is the GPT's current set of fields:

name: ${i}

description: ${r}

context: ${n}

abilities: ${o}

${m?"The GPT has a profile picture.":"This GPT does not have a profile picture. You must generate a profile picture when you next update your behavior."}
`}function $s(s,t,i,r){const n=i.current,o=r.current;if(Ue(n,o))return;const a={};n.name!==o?.name&&(a.name=n.name),(n.description??"")!==(o?.description??"")&&(a.description=n.description??""),n.instructions!==(o?.instructions??"")&&(a.context=n.instructions??"");const m=new Set(o?.files?.map(l=>l.file_id)??[]),c=new Set(n.files?.map(l=>l.file_id)??[]),p=(n.files??[]).filter(l=>!m.has(l.file_id)),b=(o?.files??[]).filter(l=>!c.has(l.file_id));if(Ee(a)&&p.length===0&&b.length===0)return;const w=[];if(!Ee(a)){const l=`Explicitly update the GPT's behavior to the following exact fields:

    ${JSON.stringify(a,null,2)}

    "Do not call update_behavior yet. Instead, use these updated fields as the GPT's current behavior, and in the next call to update_behavior, incorporate these changes."
    `;w.push(ne.getTextAsMessage(l,q.System))}b.length>0&&w.push(ne.getTextAsMessage(`The user has removed the following files from the GPT. You can no longer reference these files: ${b.map(l=>l.file_id).join(", ")}`,q.System)),p.length>0&&w.push(ne.getTextAsMessage(`The user is adding these files to the GPT. The GPT may reference these files. The file IDs are: ${p.map(l=>l.file_id).join(", ")}`,q.System,{attachments:p.map(l=>({id:l.file_id,name:l.name,size:l.size}))})),w.length>0&&N.updateTree(s,l=>{let u=l.getNodeByIdOrMessageId(t).parentId;for(const v of w){const h=oe();l.insertNodeBefore(t,{id:h,children:[],parentId:u,message:v,metadata:{isClientCreatedSystemMessage:!0}}),u=h}})}function zi(s,t,i){if(i.length===0)return;const r=oe(),n=`The user is uploading files in their next message. If you need to reference these in calls to update_behavior, you will use the following File ID(s), in order: ${i.map(o=>`"${o.fileId}"`).join(", ")}`;N.updateTree(s,o=>{const a=o.getNodeByIdOrMessageId(t).parentId;o.insertNodeBefore(t,{id:r,children:[],parentId:a,message:ne.getTextAsMessage(n,q.System),metadata:{isClientCreatedSystemMessage:!0}})})}function Ri(s,t){const i="Remember, you should be calling either update_behavior or generate_profile_pic after most messages from the user. Your personality should be neutral and separate from the GPT you are creating.",r=N.getThreadCurrentLeafId(s),n=N.getTree(s);let o=n.getNodeByIdOrMessageId(r);for(;o!=null&&o.message.author.role!==q.User;){if(o.message.content.content_type==="text"&&o.message.content.parts[0]===i)return;o=o.parentId!==""?n.getNodeByIdOrMessageId(o.parentId):void 0}N.updateTree(s,a=>{const m=a.getNodeByIdOrMessageId(t).parentId;a.insertNodeBefore(t,{id:oe(),children:[],parentId:m,message:ne.getTextAsMessage(i,q.System,{exclude_after_next_user_message:!0}),metadata:{isClientCreatedSystemMessage:!0}})})}function Ei(s,t,i){N.initThread(s,{kind:ie.GizmoMagicCreate,gizmo_id:void 0,behavior_overrides:i});const n=ft().id,o=pt(s)??n,a=ws({clientThreadId:s,onCompletionFinished:t});return async(c,p,b)=>{if(b.length===0)return;const w=new Ts;let l=N.getThreadCurrentLeafId(s);for(const T of b){const I=oe();N.updateTree(s,j=>{j.addNodeToEnd(l,{id:I,children:[],parentId:l,message:ne.getTextAsMessage(T,q.System),metadata:{isClientCreatedSystemMessage:!0}})}),N.setThreadCurrentLeafId(s,I),l=I}const u=l;$s(s,u,c,p);const v={conversationMode:{kind:ie.GizmoMagicCreate,gizmo_id:c.current.id,behavior_overrides:i}},h=await Be(),[x,S,k]=await Promise.all([De.getEnforcementToken(h),Ke.getEnforcementToken(h),We.getEnforcementToken(h)]);a({model:o,completionType:ds.Next,parentNodeId:u,metadata:{},focusOnNewCompletion:!0,chatReq:h,arkoseToken:x,turnstileToken:S,proofToken:k,preflightTime:0,completionMetadata:v,turnTracker:w})}}const Ui="Generate a new profile picture for this GPT using gizmo_editor generate_profile_pic. Do not prompt the user for any clarification. Do not send extra text outside of the tool function call. DO NOT CALL update_behavior or otherwise update GPT behavior in your response.",Fi=He(()=>$e(()=>import("./fpd5vvj4wix5kt97.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])).then(s=>s.DebugConversationSidebar));function Oi(s,t){d.useEffect(()=>{const i=N.getTree(s);if(i.findNode(a=>a.message.author.role===q.User||a.metadata?.isClientCreatedSystemMessage===!0)||(N.deleteNodesByFilter(s,a=>a.metadata?.isPlaceholderTemplateAssistantWelcomeMessage===!0),t==null||t.length===0))return;const n=N.getThreadCurrentLeafId(s);if(!i.hasNodeOrMessageId(n))return;const o=oe();N.updateTree(s,a=>{a.addNode(o,t,n,q.Assistant,{isPlaceholderTemplateAssistantWelcomeMessage:!0})}),N.setThreadCurrentLeafId(s,o)},[s,t])}function Bi(s,t,i){Ns(s,{kind:ie.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:i}),d.useEffect(()=>{N.updateConversationMode(s,{kind:ie.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:i})},[s,t.id,i]);const[r]=d.useState(()=>{const n=t.id==null,o=t.id!=null&&t.name!==""&&t.description!=null&&t.instructions!==""&&t.profilePictureUrl!=null;return n?`Hi! I'll help you build a new GPT. You can say something like, "make a creative who helps generate visuals for new products" or "make a software engineer who helps format my code."

What would you like to make?`:o?`Welcome back! Is there anything ${t.name} should be doing better? Anything you'd like to change?`:"You're back! Let's continue where we left off..."});Oi(s,r)}function Di({gizmoEditorData:s,updateGizmo:t,clientThreadId:i,completionCallbackResponse:r,gizmoEditorDataRef:n,magicMakerBehaviorOverrides:o,magicMakerConversationGizmoEditorDataRef:a,requireGizmoId:m}){const c=d.useMemo(()=>({gizmoEditorData:s,gizmoId:s.id,mode:"magic",behaviorOverrides:o,getGizmoId:m}),[m,s,o]),p=xt(u=>u.files.filter(v=>v.status===W.Ready&&v.gizmoId!=null)),b=d.useCallback((u,v)=>{zi(u,v,p),$s(u,v,n,a),Ri(u,v),t(h=>({...h,files:[...h.files??[],...qe(p.map(x=>x.fileId!=null&&{file_id:x.fileId,name:x.file.name,size:x.file.size,type:Ps(x.file),last_modified:x.file.lastModified,file_size_tokens:x.fileSpec?.fileTokenSize}))]})),a.current=ks(n.current)},[n,a,p,t]),w=Ss(u=>u.activeSidebar),l=ms();return e.jsx(Cs.Provider,{value:c,children:e.jsxs("div",{className:"relative flex h-full grow overflow-auto",children:[e.jsx("div",{className:"grow",children:l?e.jsx("div",{className:"contents",style:{"--screen-height-override":"100%"},children:e.jsx(Is,{clientThreadId:i,preRequestCompletion:b,onCompletionFinished:r,children:e.jsx(Os,{hideHeader:!0,embedded:!0})})}):e.jsx(Bs,{clientThreadId:i,onCompletionFinished:r,preRequestCompletion:b,hideHeader:!0,prependThreadChildren:e.jsx("div",{className:"h-8"})})}),w==="debug"&&e.jsx(Fi,{clientThreadId:i,slideOver:!1,onClose:()=>de.toggleActiveSidebar("debug"),isOpen:!0})]})})}const Wi=us.memo(Di);function Hi({gizmo:s,updateGizmo:t,publishedGizmo:i,promoteGizmo:r,appealGizmo:n,setAppealState:o,showActionsModal:a,shareOnly:m,onClose:c}){const[p,b]=d.useState({type:"privacy"});return p.type==="privacy"?e.jsx(qi,{gizmo:s,updateGizmo:t,publishedGizmo:i,promoteGizmo:r,appealGizmo:n,setAppealState:o,setStep:b,showActionsModal:a,shareOnly:m,onClose:c}):e.jsx(Qi,{publishedGizmo:p.publishedGizmo,onClose:c})}function $i(s){return s?A.Workspace:A.Link}function qi({gizmo:s,publishedGizmo:t,updateGizmo:i,promoteGizmo:r,appealGizmo:n,setAppealState:o,setStep:a,showActionsModal:m,shareOnly:c,onClose:p}){const[b,w]=d.useState(!1),l=je(_s.isBusinessWorkspace),u=Q(),v=ae(),[h,x]=d.useState(Ye(s)?$i(!!l):s.sharingRecipient),S=gs(),k=ei(h,s.sharingTargets),{data:T,isLoading:I}=vt(),j=jt(),[g,C]=d.useState(t!=null&&t.gizmo.display.categories.length>0?j.data?.categories.find(y=>y.id===t.gizmo.display.categories[0])?.id:void 0);d.useEffect(()=>{C(t?.gizmo.display.categories[0])},[t?.gizmo.display.categories]);const[G,O]=d.useState(void 0),_=d.useRef(bt((y,L)=>Le.generateCategory(y,L),1e3)),U=T?.is_verified?void 0:u.formatMessage({id:"qUMu4e",defaultMessage:"To publish your GPTs to the Explore GPTs page, set up your builder profile in the user settings page."});h===A.Marketplace&&U!=null&&!I&&x(A.Link);const H=l&&!s.sharingTargets?.some(y=>y.recipient===A.Link),B=Me(s,h,g),E=B.includes(te.MissingPublicActionPrivacyPolicyURL),F=s.tools.find(y=>y.type===X.JIT_PLUGIN&&!y.metadata.privacy_policy_url),me=je(y=>y.currentWorkspace),we=fs();d.useEffect(()=>{let y=!0;return(async()=>{try{if(g!=null)return;const L=await _.current(s.name,s.instructions);y&&g==null&&(L?C(L.id):O(!0))}catch{y&&g==null&&O(!0)}})(),()=>{y=!1}},[s.instructions,s.name,we,g]);const{value:D}=be("4226692983");return e.jsx(Qe,{type:"success",isOpen:!0,onClose:p,title:e.jsx(f,{id:"9viumf",defaultMessage:"Share GPT"}),showCloseButton:!0,primaryButton:k?e.jsx(pe,{color:"primary",disabled:B.length>0,loading:b,onClick:async()=>{try{if(w(!0),c){if(!t?.gizmo.id){v.danger(u.formatMessage({id:"QYVEx8",defaultMessage:"Error sharing GPT"}));return}const y=await Le.shareGizmo(t.gizmo.id,g?{sharing:xe(h,[],ve),categories:[g]}:{sharing:xe(h,[],ve)});y.error?(v.warning(u.formatMessage({id:"tmIKmp",defaultMessage:"Unable to share GPT"})),i({sharingTargets:y.sharing_targets}),o({gizmoId:t.gizmo.id,sharingRecipient:h,categories:t.gizmo.display.categories,moderationType:Fs.PublishBlocked,sharingTargets:y.sharing_targets,showModal:ce.AppealAvailable})):(S.setQueryData(["gizmo",{gizmoId:t.gizmo.id},{draft:!1}],L=>y.resource),i(L=>({...L,sharingRecipient:h})),v.success(u.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),p())}else{const y=await r({recipient:h,subjects:xe(h,[],ve)},g);y?(a({type:"published",publishedGizmo:y}),i(L=>({...L,id:y.gizmo.id,sharingRecipient:h})),y.gizmo.live_version!=null&&i({liveVersion:y.gizmo.live_version}),v.success(u.formatMessage({id:"R5zko1",defaultMessage:"GPT published"}),{testId:"gpt-published-toast"})):(v.warning(u.formatMessage({id:"uf7WYw",defaultMessage:"Unable to publish GPT"})),p())}}finally{w(!1)}},"data-testid":"save-gizmo-button",children:e.jsx(f,{id:"SW4DG4",defaultMessage:"Save"})}):D?e.jsx(e.Fragment,{children:e.jsx(pe,{color:"primary",onClick:async()=>{await n(h,g)},children:e.jsx(f,{id:"bBmLUr",defaultMessage:"Appeal"})})}):null,secondaryButton:t?e.jsx(pe,{color:"secondary",onClick:y=>Ze(t,v,y,u.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:e.jsx(f,{id:"wvL15a",defaultMessage:"Copy link"})}):null,children:e.jsxs("div",{className:"mx-[-16px] flex flex-col gap-3 text-sm",children:[e.jsx("div",{className:"space-y-1.5",children:e.jsxs(Gs,{value:h,onValueChange:y=>x(y),children:[s.sharingTargets&&s.sharingTargets.map((y,L)=>e.jsx(Ie,{value:y.recipient,disabled:y.recipient===A.Marketplace&&U!=null,tooltipText:y.recipient===A.Marketplace?U??u.formatMessage({id:"0Rcb4e",defaultMessage:"Your GPT will appear in the Explore GPTs page"}):void 0,shareLevel:y.recipient},L)),H&&e.jsxs(e.Fragment,{children:[e.jsx(Ie,{value:A.Link,disabled:!0,tooltipText:u.formatMessage(ls.workspaceDisabledHint),shareLevel:A.Link,workspaceName:me?.name}),e.jsx(Ie,{value:A.Link,disabled:!0,tooltipText:u.formatMessage(ls.workspaceDisabledHint),shareLevel:A.Marketplace,workspaceName:me?.name})]})]})}),E&&e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(f,{id:"/iw1Iv",defaultMessage:"Public actions require valid privacy policy URLs. Click <fixlink>here</fixlink> to update.",values:{fixlink:y=>e.jsx("button",{onClick:()=>{m(F?.metadata.action_id)},className:"underline",children:y})}})}),h!==A.Private&&e.jsx(si,{gizmo:s,category:g,categories:h===A.Marketplace?j.data?.categories??[]:void 0,onCategoryChange:h===A.Marketplace?y=>C(y.id):void 0}),h===A.Marketplace&&(G?e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(f,{id:"tpC3ui",defaultMessage:"There was an error updating the list of categories"})}):null),!k&&D&&e.jsx("div",{className:"flex items-center justify-between text-sm text-token-text-secondary",children:e.jsx(f,{id:"jLCMMV",defaultMessage:"Because this GPT previously may have violated our policies, you will have to submit an appeal to make it available at this level."})})]})})}function Qi({publishedGizmo:s,onClose:t}){const i=yt(s),r=Q(),n=ae();return e.jsx(Qe,{type:"success",isOpen:!0,onClose:t,title:e.jsx(f,{id:"rCRRmx",defaultMessage:"Settings Saved"}),showCloseButton:!0,primaryButton:e.jsx(pe,{color:"primary",as:"link",to:i,children:e.jsx(f,{id:"lyZz44",defaultMessage:"View GPT"})}),children:e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex gap-1 rounded bg-token-main-surface-secondary px-2 py-1",children:[e.jsx("div",{className:"line-clamp-1 text-ellipsis break-all",children:i}),e.jsx("button",{onClick:o=>{Ze(s,n,o,r.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"}))},className:"text-token-text-secondary transition hover:text-token-text-primary","data-testid":"copy-saved-gpt-url-button",children:e.jsx(Ds,{className:"icon-sm"})})]})})})}const ls=le({workspaceDisabledHint:{id:"gizmo.workspaceDisabledHint",defaultMessage:"Your workspace administrator has disabled this setting"}});function Ie({shareLevel:s,workspaceName:t,value:i,disabled:r=!1,tooltipText:n}){const o=d.useId();return e.jsx(et,{disabled:n==null,label:n,side:"top",children:e.jsxs(As,{id:o,value:i,disabled:r,className:"flex h-14 w-full cursor-pointer flex-row items-center justify-between gap-2 rounded-md px-3 py-4 font-semibold hover:bg-token-main-surface-secondary",children:[e.jsx("label",{htmlFor:o,className:"flex cursor-pointer items-center gap-1",children:e.jsx(ti,{shareLevel:s,workspaceName:t??"",hasInviteSharing:!1})}),e.jsx(Mt,{children:e.jsx(ui,{className:"icon-lg mr-1"})})]})})}function qs(s){window.history.length>1?s(-1):s(wt())}function Vi({gizmo:s,publishedGizmo:t,isUpsertLoading:i,isPromoteLoading:r,isUploadingProfilePic:n,isGeneratingProfilePic:o,updateGizmo:a,promoteGizmo:m,appealGizmo:c,setAppealState:p,showActionsModal:b}){const w=ye(),l=s!=null?Me(s):[];(s==null||r||i)&&l.push(te.Loading),n&&l.push(te.UploadingProfilePic),o&&l.push(te.GeneratingProfilePic);const u=Ye(s),[v,h]=d.useState(!1),[x,S]=d.useState(!1),k=s.sharingRecipient?os[s.sharingRecipient]:os.private,T=r||i;return e.jsxs(e.Fragment,{children:[u?e.jsx(se,{color:"primary",onClick:()=>h("promote"),loading:i,disabled:T||s.id===void 0||l.length>0,tooltip:l.length>0?l.map(Re).join(`
`):void 0,testId:"gizmo-editor-create-gpt-button",children:e.jsx(f,{id:"svUGIb",defaultMessage:"Create"})}):e.jsxs(e.Fragment,{children:[e.jsx(se,{color:"secondary",loading:r||!t,disabled:T,icon:k,onClick:()=>h("share"),children:e.jsx(f,{id:"aXKW4G",defaultMessage:"Share"})}),e.jsx(se,{color:"primary",onClick:async()=>{let I=s.sharing.subjects.map(ii);const j=Tt(s.sharing.subjects);I=xe(s.sharing.recipient,I,j?.capabilities??ve),await m({recipient:s.sharing.recipient,subjects:I},t?.gizmo.display.categories[0])&&S(!0)},loading:i||!t,disabled:T||l.length>0,tooltip:l.length>0?l.map(Re).join(`
`):void 0,children:e.jsx(f,{id:"84QVoj",defaultMessage:"Update"})})]}),v&&(w?.getWorkspaceId()==null?e.jsx(Hi,{gizmo:s,publishedGizmo:t,promoteGizmo:m,appealGizmo:c,setAppealState:p,showActionsModal:b,updateGizmo:a,shareOnly:v==="share",onClose:()=>h(!1)}):e.jsx(ai,{gizmo:s,publishedGizmo:t,promoteGizmo:m,appealGizmo:c,setAppealState:p,showActionsModal:b,updateGizmo:a,onClose:()=>h(!1),shareOnly:v==="share"})),x&&e.jsx(ni,{publishedGizmo:t,sharing:t.gizmo.sharing,onClose:()=>S(!1),workspaceName:w?.data.name??""})]})}function Ki({gizmoEditorData:s,publishedGizmo:t,revertDraft:i}){const r=Q(),n=ae(),o=ue(),[a,m]=d.useState(!1),c=fs(),{value:p}=be("3645668434");return!c?.includes("debug")&&s?.id==null?null:e.jsxs(e.Fragment,{children:[e.jsxs(hs,{side:"top",contentAlign:"end",sideOffset:8,triggerButton:e.jsx(se,{color:"ghost",icon:mi}),children:[t!=null&&e.jsxs(V.Item,{onClick:b=>{Ze(t,n,b)},children:[e.jsx(Ws,{className:"icon-sm"}),e.jsx(f,{...Z.copyLink})]}),i!=null&&e.jsxs(V.Item,{onClick:()=>{window.confirm(r.formatMessage(Z.revertConfirm))&&i()},children:[e.jsx(gi,{className:"icon-sm"}),e.jsx(f,{id:"W2blnV",defaultMessage:"Revert..."})]}),s?.id!=null&&p&&s.liveVersion>0&&e.jsxs(e.Fragment,{children:[e.jsxs(V.Item,{onClick:()=>{o(`/g/${s.id}/view`)},children:[e.jsx(fi,{className:"icon-sm"}),e.jsx(f,{id:"gizmo.versionHistory",defaultMessage:"Version History"})]}),e.jsxs(V.Item,{onClick:async()=>{const b=await Le.copyGizmo({gizmoId:s.id});b.gizmo.id&&o(`/gpts/editor/${b.gizmo.id}`)},children:[e.jsx(Ds,{className:"icon-sm"}),e.jsx(f,{id:"GizmoInformation.copyGizmoLabel",defaultMessage:"Duplicate GPT"})]})]}),s?.id!=null&&e.jsxs(V.Item,{color:"danger",onClick:()=>{m(!0)},children:[e.jsx(pi,{className:"icon-sm"}),e.jsx(f,{id:"tNrOLG",defaultMessage:"Delete GPT"})]}),c?.includes("debug")&&e.jsxs(e.Fragment,{children:[e.jsx(V.Separator,{}),e.jsxs(V.Item,{onClick:()=>{de.toggleActiveSidebar("debug")},children:[e.jsx(hi,{className:"icon-sm"}),"Debug (Internal only)"]})]})]}),a&&e.jsx(Pi,{gizmoId:s.id,onSuccess:()=>qs(o),onClose:()=>{m(!1)}})]})}const fe=ps.div`flex items-center gap-1`;function Yi({gizmoEditorData:s}){const t=je(i=>i.currentWorkspace?.name);switch(s.sharingRecipient){case A.Private:return e.jsxs(fe,{children:[e.jsx(ji,{className:"icon-xs"}),e.jsx(f,{...Z.onlyMe})]});case A.Link:return e.jsxs(fe,{children:[e.jsx(Ws,{className:"icon-xs"}),e.jsx(f,{...Z.anyoneWithLink})]});case A.Workspace:return e.jsxs(fe,{children:[e.jsx(vi,{className:"icon-xs"}),t]});case A.Marketplace:return e.jsxs(fe,{children:[e.jsx(xi,{className:"icon-xs"}),e.jsx(f,{...Z.public})]});default:return e.jsx("div",{})}}function Zi({gizmoEditorData:s}){return e.jsxs("div",{className:"flex items-center gap-2",children:[s.profilePictureUrl!=null?e.jsx(Ls,{isFirstParty:!1,src:s.profilePictureUrl,className:"h-8 w-8"}):e.jsx("div",{className:"h-8 w-8 rounded-full border-2 border-dashed border-token-border-medium"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:s.name||e.jsx(f,{...Z.newGPT})}),e.jsx("div",{className:"text-xs text-token-text-secondary",children:Ye(s)?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-token-text-tertiary"}),e.jsx(f,{...Z.draft})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-brand-green"}),s.sharingRecipient===A.Marketplace?e.jsx(f,{...Z.published}):e.jsx(f,{id:"gizmoEditorHeader.live",defaultMessage:"Live"})," · ",e.jsx(Yi,{gizmoEditorData:s})]})})]})]})}function Xi({gizmoEditorData:s,isUpsertLoading:t,isPromoteLoading:i,isUploadingProfilePic:r,isGeneratingProfilePic:n,publishedGizmo:o,updateGizmo:a,promoteGizmo:m,appealGizmo:c,setAppealState:p,revertDraft:b,draftMessage:w,className:l,hasUnpublishedChanges:u,showActionsModal:v}){const h=ue();return e.jsxs("div",{className:re("relative flex h-14 w-full items-center justify-between gap-2 border-b border-token-border-medium px-3",l),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{className:"cursor-pointer text-token-text-primary",onClick:()=>qs(h),children:e.jsx(st,{className:"icon-lg"})}),e.jsx(Zi,{gizmoEditorData:s})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[w,e.jsx(Ki,{gizmoEditorData:s,publishedGizmo:o,revertDraft:b}),e.jsx(Vi,{gizmo:s,publishedGizmo:o,isUpsertLoading:t,isPromoteLoading:i,isUploadingProfilePic:r,isGeneratingProfilePic:n,updateGizmo:a,promoteGizmo:m,appealGizmo:c,setAppealState:p,hasUnpublishedChanges:u,showActionsModal:v})]})]})}const Z=le({onlyMe:{id:"gizmo.onlyMe",defaultMessage:"Only me"},anyoneWithLink:{id:"gizmo.anyoneWithLink",defaultMessage:"Anyone with a link"},public:{id:"gizmo.public",defaultMessage:"Everyone"},newGPT:{id:"gizmo.newGPT",defaultMessage:"New GPT"},draft:{id:"gizmo.draft",defaultMessage:"Draft"},published:{id:"gizmo.published",defaultMessage:"Published"},revertConfirm:{id:"gizmo.revertConfirm",defaultMessage:"Are you sure you want to revert to the last saved version?"},copyLink:{id:"gizmo.copyLink",defaultMessage:"Copy link"}}),Ji=512;function ea(){return e.jsx("div",{className:"relative flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-token-border-medium",children:e.jsx(Ve,{className:"h-1/4 w-1/4"})})}function sa({gizmoEditorData:s,onFileChange:t,generateProfilePic:i,isGeneratingProfilePic:r,setIsGeneratingProfilePic:n}){const o=Q(),a=ae(),[m,c]=d.useState(void 0),p=d.useRef(t);d.useEffect(()=>{p.current=t});async function b(u){if(u.length>0){n(!1);const v=await Nt(u[0],Ji),h=ze(v);c({tempId:h,file:v,status:W.Uploading,progress:1,fileId:null,cdnUrl:null}),p.current("uploading"),_t(h,v,o,a,xs.ProfilePicture,{onFileCreated(x,S,k){c(T=>T!=="initial"&&T?.tempId===x&&T.status===W.Uploading?{...T,progress:10,fileId:S,cdnUrl:k}:T)},onFileUploadProgress(x,S){c(k=>k!=="initial"&&k?.tempId===x&&k.status===W.Uploading?{...k,progress:S}:k)},onFileUploaded(x,S,k){c(T=>T!=="initial"&&T?.tempId===x?(p.current(T),{...T,status:W.Ready,progress:100,fileSpec:{name:T.file.name,id:T.fileId,size:T.file.size,...k??{}}}):T)},onError(x){c(S=>{if(S!=="initial"&&S?.tempId===x){p.current(void 0);return}return S})}})}}const{open:w,getInputProps:l}=zs({disabled:!1,noClick:!0,onDropAccepted:b,onDropRejected:u=>Pt(u,o,a,kt.ProfilePicture),multiple:!0,maxSize:Rs,...Es(St)});return e.jsxs("div",{className:"flex w-full items-center justify-center gap-4",children:[e.jsxs(hs,{sideOffset:8,triggerButton:e.jsx("button",{className:"h-20 w-20",children:r?e.jsx(ea,{}):m!=null&&m!="initial"&&m.status!=W.Ready?e.jsxs("div",{className:"relative h-full w-full overflow-hidden rounded-full",children:[e.jsx(Ct,{file:m.file}),m.status===W.Uploading&&m.progress<90?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:e.jsx(It,{percentage:m.progress,className:"h-6 w-6"})}):null]}):s?.profilePictureUrl!=null&&s?.profilePictureUrl!==""?e.jsx(Ls,{isFirstParty:!1,src:s.profilePictureUrl}):e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-token-border-medium",children:e.jsx(bi,{className:"text-4xl"})})}),children:[e.jsx(V.Item,{onClick:w,children:e.jsx(f,{id:"ERQwXg",defaultMessage:"Upload Photo"})}),e.jsx(V.Item,{onClick:i,children:e.jsx(f,{id:"NXAog/",defaultMessage:"Use DALL·E"})})]}),e.jsx("input",{...l()})]})}function ta({gizmoEditorData:s,requireGizmoId:t,currentModelConfig:i,updateGizmo:r}){const n=Q(),o=ae(),[a,m]=d.useState(0),c=d.useRef(new Map),p=Gt(i,void 0),b=async g=>{vs.logEvent(js.uploadFile,{client:"web",eventSource:"mouse",intent:"gizmo"});const C=await t();g.length>0&&await Promise.all(g.map(G=>{const O=ze(G);c.current.set(O,{tempId:O,gizmoId:C,file:G,status:W.Uploading,progress:1,fileId:null,cdnUrl:null}),At(ze(G),G,n,o,{kind:xs.Gizmo,gizmoId:C},{onFileUploaded:(_,U,H,B)=>{const E=c.current.get(_);E==null||E.fileId==null||(r(F=>({...F,files:[...F.files??[],{file_id:E.fileId,name:E.file.name,size:E.file.size,type:B?.mimeType??Ps(G),last_modified:E.file.lastModified,file_size_tokens:B?.fileTokenSize}]})),c.current.delete(_),m(F=>F+1))},onFileCreated:(_,U,H)=>{c.current.set(_,{tempId:_,gizmoId:C,file:G,status:W.Uploading,progress:1,...c.current.get(_),fileId:U,cdnUrl:H}),m(B=>B+1)},onFileUploadProgress:(_,U)=>{const H=c.current.get(_);H?.status===W.Uploading&&c.current.set(_,{...H,progress:U}),m(B=>B+1)},onError:_=>{c.current.delete(_)}},{usesRetrievalIndex:i!=null&&Se(i,G.type,G.name)===ke.Retrieval})}))},{getInputProps:w,open:l}=zs({disabled:!1,noClick:!0,onDropAccepted:b,multiple:!0,maxSize:Rs,maxFiles:10,...Es(p)}),u=s?.files??[];function v(g){return e.jsx(is,{onRemoveFileClick:()=>{c.current.delete(g.tempId),m(C=>C+1)},file:g.file,loadingPercentage:g.status===W.Uploading?g.progress:void 0},g.tempId)}function h(g){return e.jsx(is,{file:g.name,fileId:g.file_id,onRemoveFileClick:()=>r(C=>({...C,files:C?.files?.filter(G=>G.file_id!==g.file_id)})),gizmoId:s?.id},g.file_id)}const x=Array.from(c.current.values()).filter(g=>u.every(C=>C.file_id!==g.fileId)),[S,k]=ts(x,g=>i!=null&&Se(i,g.file.type,g.file.name)===ke.CodeInterpreter),[T,I]=ts(u,g=>i!=null&&g.type!=null&&Se(i,g.type,g.name)===ke.CodeInterpreter),j=d.useRef(T.length);return d.useEffect(()=>{T.length>j.current&&r(g=>g.tools?.some(C=>C.type===X.PYTHON)?g:{...g,tools:[...g.tools??[],{type:X.PYTHON}]}),j.current=T.length},[T.length]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"rounded-lg text-token-text-tertiary",children:e.jsx(f,{...ia.knowledgeWarning})}),k.length>0||I.length>0?e.jsxs("div",{className:"flex flex-wrap gap-2",children:[k.map(v),I.map(h)]}):null,S.length>0||T.length>0?e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs text-token-text-tertiary",children:e.jsx(f,{id:"i/QurZ",defaultMessage:"The following files are only available for Code Interpreter:"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[S.map(v),T.map(h)]})]}):null,e.jsx("div",{children:e.jsxs(se,{onClick:l,children:[e.jsx("input",{...w()}),e.jsx(f,{id:"sr8Qp/",defaultMessage:"Upload files"})]})})]})}const ia=le({knowledgeWarning:{id:"gizmo.knowledgeWarning",defaultMessage:"If you upload files under Knowledge, conversations with your GPT may include file contents. Files can be downloaded when Code Interpreter is enabled"}});function aa({placeholder:s,text:t,onChange:i,onClose:r}){return e.jsx(Qe,{className:"!max-h-[100vh] !max-w-[80vw]",type:"success",isOpen:!0,onClose:r,primaryButton:e.jsx(se,{onClick:r,children:e.jsx(f,{id:"FeFVdS",defaultMessage:"Close"})}),children:e.jsx("textarea",{className:"h-[70vh] w-full resize-none rounded-lg bg-token-main-surface-primary dark:border-gray-700",value:t,onChange:n=>{i(n.target.value)},placeholder:s})})}const Ne=ps.div`text-sm text-red-500`;function na({children:s,collapsed:t,initial:i}){return e.jsx(Ut,{initial:i,children:!t&&e.jsx(Hs.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:s})})}function ra({gizmo:s,onShowActionsEditor:t,isDisabled:i}){const r=Q(),n=ae(),o=e.jsxs("div",{className:"space-y-1",children:[s?.tools?.map((a,m)=>a.type!==X.JIT_PLUGIN?null:e.jsxs("div",{children:[e.jsx(Ci,{isDisabled:i,actionTool:a,onShowActionsEditor:()=>t(a.metadata.domain)}),a.metadata.auth?.type==="oauth"&&e.jsx(Ft,{label:r.formatMessage(R.callbackUrlLabel),value:`https://chat.openai.com/aip/${a.metadata.action_id}/oauth/callback`,onCopied:()=>{n.success("Copied to clipboard",{duration:3})}})]},m)),(s?.tools?.filter(a=>a.type===X.JIT_PLUGIN)??[]).length>=as?e.jsx("div",{children:r.formatMessage(R.maxActionsReached,{number:as})}):e.jsx(se,{disabled:i,onClick:()=>{t("Unknown domain")},className:"mt-2",children:e.jsx(f,{...R.createActionLabel})})]});return i?e.jsx(ys,{side:"top",label:r.formatMessage(R.disabledCustomActionsTooltip),children:o}):o}function oa(s){return(s.files?.length??0)>0||s?.tools?.some(t=>t.type===X.JIT_PLUGIN)}const la=12;function ca({gizmoEditorData:s,updateGizmo:t,currentModelConfig:i,generateProfilePic:r,setIsUploadingProfilePic:n,isGeneratingProfilePic:o,setIsGeneratingProfilePic:a,requireGizmoId:m,onShowActionsEditor:c}){const p=s?.tools??[],[b,w]=d.useState(!1),[l,u]=d.useState(!0),v=s?.promptStarters??[],h=[...v,...v.length<la?[""]:[]],x=Me(s),k=ye()?.isWorkspaceAccount(),T=Us(bs.WorkspaceGPTCustomActions),I=Q();return e.jsxs("div",{className:"flex h-full grow flex-col overflow-y-auto px-2 pt-6 text-sm",children:[e.jsxs("div",{className:"grow",children:[e.jsxs(K,{children:[e.jsx(sa,{gizmoEditorData:s,generateProfilePic:r,isGeneratingProfilePic:o,setIsGeneratingProfilePic:a,onFileChange:async j=>{if(j!=null&&j!=="uploading"&&j.fileId!=null){const g=await Fe.getFileDownloadLink(j.fileId);g.status===Oe.Success&&t({profilePictureId:j.fileId!=null?j.fileId:void 0,profilePictureUrl:g.download_url})}else t({profilePictureId:void 0,profilePictureUrl:void 0});n(j==="uploading")}}),e.jsx(Y,{label:e.jsx(f,{id:"M4dZms",defaultMessage:"Name"}),description:e.jsx(f,{id:"+Gkni2",defaultMessage:"The name of your GPT"})}),e.jsx(Ce,{type:"text",placeholder:I.formatMessage(R.gptNamePlaceholder),value:s?.name??"",onChange:j=>{t({name:j.target.value})},onBlurCapture:()=>t(j=>({...j,name:j.name.trim()})),"data-testid":"gizmo-name-input"}),x.includes(te.GizmoNameTooLong)?e.jsx(Ne,{className:"mt-1",children:e.jsx(f,{...R.nameTooLong,values:{length:Lt}})}):null]}),e.jsxs(K,{className:"mt-4",children:[e.jsx(Y,{label:e.jsx(f,{id:"YDzNvf",defaultMessage:"Description"}),description:e.jsx(f,{id:"dpxCw8",defaultMessage:"Short description of what this GPT does"})}),e.jsx(Ce,{type:"text",placeholder:I.formatMessage(R.descriptionPlaceholder),value:s?.description??"",onChange:j=>t({description:j.target.value}),onBlurCapture:()=>t(j=>({...j,description:j.description?.trim()??""})),"data-testid":"gizmo-description-input"}),x.includes(te.GizmoDescriptionTooLong)?e.jsx(Ne,{className:"mt-1",children:e.jsx(f,{...R.descriptionTooLong,values:{length:zt}})}):null]}),e.jsxs(K,{children:[e.jsx(Y,{label:e.jsx(f,{id:"2SO0RJ",defaultMessage:"Instructions"}),description:I.formatMessage(R.instructionsSubtitle)}),e.jsxs("div",{className:"relative",children:[e.jsx(ki,{className:"resize-none",rows:8,value:s?.instructions,onChange:j=>t({instructions:j.target.value}),onBlurCapture:()=>t(j=>({...j,instructions:j.instructions.trim()})),placeholder:I.formatMessage(R.instructionsSubtitle),"data-testid":"gizmo-instructions-input"}),e.jsx("button",{className:"absolute bottom-3 right-2 text-token-text-tertiary",onClick:()=>w(!0),children:e.jsx(yi,{className:"icon-sm"})})]}),x.includes(te.GizmoInstructionsTooLong)?e.jsx(Ne,{className:"mt-1",children:e.jsx(f,{...R.instructionsTooLong,values:{length:Rt}})}):null]}),e.jsxs(K,{children:[e.jsx(Y,{label:e.jsx(f,{id:"6rfYOX",defaultMessage:"Conversation starters"}),description:e.jsx(f,{id:"OSOIpd",defaultMessage:"Examples for the user to start the conversation"})}),e.jsx("div",{className:"flex flex-col gap-1",children:h.map((j,g)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ce,{className:"rounded-r-none",value:j,type:"text",onChange:C=>{const G=C.target.value;t(O=>({...O,promptStarters:qe(g>=(v.length??0)?[...v??[],G]:v.map((_,U)=>U===g?G===""?void 0:G:_))}))}}),e.jsx("button",{className:"flex h-9 w-9 items-center justify-center rounded-lg rounded-l-none border border-l-0 border-token-border-medium",onClick:()=>t(C=>({...C,promptStarters:v.filter((G,O)=>O!==g)})),children:e.jsx(Mi,{className:"icon-sm"})})]},g))})]}),e.jsxs(K,{children:[e.jsx(Y,{label:e.jsx(f,{id:"bwXSkU",defaultMessage:"Knowledge"}),description:I.formatMessage(R.knowledgeExplanation)}),e.jsx(ta,{gizmoEditorData:s,requireGizmoId:m,currentModelConfig:i,updateGizmo:t})]}),e.jsxs(K,{children:[e.jsx(Y,{label:e.jsx(f,{id:"mcAwDU",defaultMessage:"Capabilities"}),description:e.jsx(f,{id:"2exQT6",defaultMessage:"Functionality this GPT can use"})}),e.jsx(Si,{enabledTools:p,onEnabledToolsChange:j=>t({tools:j})})]}),e.jsxs(K,{children:[e.jsx(Y,{label:e.jsx(f,{id:"7r7v+u",defaultMessage:"Actions"}),description:e.jsx(f,{id:"fBln7I",defaultMessage:"APIs this GPT can use"})}),e.jsx(ra,{isDisabled:!!(k&&!T),gizmo:s,onShowActionsEditor:c})]}),!k&&oa(s)&&e.jsxs(K,{children:[e.jsx(Y,{label:e.jsx(f,{id:"R3KeU7",defaultMessage:"Additional Settings"}),collapsed:!!l,onClick:()=>{u(j=>!j)}}),e.jsx(na,{collapsed:l,initial:!1,children:e.jsx(Et,{className:"mx-3 my-1",labelClassName:"w-full cursor-pointer",label:e.jsx(f,{id:"tZgwFW",defaultMessage:"Use conversation data in your GPT to improve our models"}),id:"improve-chatgpt",checked:!s.trainingDisabled,onChange:()=>{t({trainingDisabled:!s.trainingDisabled})}})})]})]}),b&&e.jsx(aa,{text:s.instructions??"",onChange:j=>{t({instructions:j})},onClose:()=>w(!1),placeholder:I.formatMessage(R.instructionsSubtitle)})]})}const R=le({nameTooLong:{id:"gizmo.nameTooLong",defaultMessage:"GPT names cannot be longer than {length} characters."},knowledgeExplanation:{id:"gizmo.knowledgeExplanation",defaultMessage:"Additional files for this GPT to reference."},descriptionTooLong:{id:"gizmo.descriptionTooLong",defaultMessage:"GPT descriptions cannot be longer than {length} characters."},instructionsTooLong:{id:"gizmo.instructionsTooLong",defaultMessage:"GPT instructions cannot be longer than {length} characters."},disabledCustomActionsTooltip:{id:"gizmo.disabledCustomActionsTooltip",defaultMessage:"Custom actions are disabled for your workspace. Contact your admin to enable them."},createActionLabel:{id:"gizmo.createActionLabel",defaultMessage:"Create new action"},maxActionsReached:{id:"gizmo.maxActionsReached",defaultMessage:"GPTs can have a maximum of {number} actions"},descriptionPlaceholder:{id:"gizmo.descriptionPlaceholder",defaultMessage:"Add a short description about what this GPT does"},instructionsSubtitle:{id:"gizmo.instructionsSubtitle",defaultMessage:"What does this GPT do? How does it behave? What should it avoid doing?"},gptNamePlaceholder:{id:"gizmo.gptNamePlaceholder",defaultMessage:"Name your GPT"},callbackUrlLabel:{id:"gizmo.callbackUrlLabel",defaultMessage:"Callback URL"}});function da(s,t){const i=Ms(s);if(!Array.isArray(s.detail))return i;const r=qe(s.detail.map(n=>{if(n.type==="value_error.any_str.max_length")switch(n.loc[1]){case"display":{switch(n.loc[2]){case"name":return t.formatMessage(R.nameTooLong,{length:n.ctx.limit_value});case"description":return t.formatMessage(R.descriptionTooLong,{length:n.ctx.limit_value})}break}case"instructions":return t.formatMessage(R.instructionsTooLong,{length:n.ctx.limit_value})}if(typeof n.msg=="string")return n.msg}));return r.length>0?r.join(`
`):i}function ua({upsertDraftError:s}){const t=Q(),i=da(s,t);return e.jsxs("div",{className:"flex items-center gap-2 text-red-500",children:[e.jsx("div",{children:e.jsx(f,{...Qs.errorSavingDraft})}),i!=null&&e.jsx(ys,{label:i,children:e.jsx(wi,{className:"icon-sm"})})]})}function ma({isPublished:s,isSavingDraft:t,hasUnpublishedChanges:i,upsertDraftError:r,className:n}){return r instanceof tt?e.jsx(ua,{upsertDraftError:r}):i?e.jsxs("div",{className:re("flex items-center gap-2",n),children:[e.jsx("span",{className:"text-token-text-secondary",children:s?e.jsx(f,{id:"gizmoEditor.draftUnpublished",defaultMessage:"Unpublished changes"}):e.jsx(f,{id:"gizmoEditor.draftPending",defaultMessage:"Updates pending"})}),e.jsx("div",{className:"w-4 text-token-text-tertiary",children:t&&e.jsx(Ve,{})})]}):null}const Qs=le({errorSavingDraft:{id:"gizmo.errorSavingDraft",defaultMessage:"Error saving draft"}}),ga=He(()=>$e(()=>import("./fpd5vvj4wix5kt97.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])).then(s=>s.DebugConversationSidebar));var fa=(s=>(s.TestGizmoAction="test_gizmo_action",s))(fa||{});const pa=new it;function ha({gizmoEditorData:s,isSavingDraft:t,currentModelConfig:i,showTitle:r=!0}){const[n,o]=d.useState(()=>he());Ns(n,{kind:ie.GizmoTest,gizmo_id:s.id}),d.useEffect(()=>{N.updateConversationMode(n,{kind:ie.GizmoTest,gizmo_id:s.id})},[n,s.id]);const a=s.files?.map(x=>x.file_id).join();d.useEffect(()=>{N.getServerThreadId(n)!=null&&o(he())},[s.id,s.instructions,s.tools,a,n]);const m=Ss(x=>x.activeSidebar),c=d.useMemo(()=>({gizmoEditorData:s,mode:"test"}),[s]),[p,b]=d.useState(0),w=()=>{b(x=>x-360)},l=s.id,u=xa(n,i);d.useEffect(()=>at(pa,{test_gizmo_action:({rootDomain:x,operationName:S})=>{l&&u(l,x,S)}}),[u,l]);const v=ms(),h=d.useCallback(()=>e.jsx("div",{className:"h-full w-full",children:e.jsx(Ii,{gizmo:s,hideOwner:!0,showStarterPrompts:!0})}),[s]);return e.jsx(Cs.Provider,{value:c,children:e.jsxs("div",{className:re("flex h-full w-full",t&&"cursor-wait opacity-80 transition"),children:[e.jsxs("div",{className:"flex grow flex-col",children:[e.jsx("div",{className:"relative mb-2 flex-shrink-0",children:e.jsx("div",{className:"flex justify-center py-1",children:r&&e.jsxs("div",{className:"group flex items-center gap-2 text-lg font-semibold",children:[e.jsx("div",{className:"icon-md"}),e.jsxs("button",{onClick:()=>{w(),o(he())},className:"flex items-center gap-2",children:[e.jsx(f,{id:"2u/6Ja",defaultMessage:"Preview"}),e.jsx(Hs.div,{className:"text-token-text-primary",animate:{rotate:p},transition:{duration:.3},children:e.jsx(Ti,{className:"icon-md invisible group-hover:visible"})})]})]})})}),e.jsx("div",{className:re("relative grow overflow-auto px-2",t&&"pointer-events-none"),children:v?e.jsx("div",{className:"contents",style:{"--screen-height-override":"100%","--chat-screen-thread-parent-background":"var(--main-surface-secondary)"},children:e.jsx(Is,{clientThreadId:n,children:e.jsx(Os,{hideHeader:!0,embedded:!0,renderEmptyState:h})})}):e.jsx(Bs,{clientThreadId:n,hideHeader:!0,renderEmptyState:h()})})]}),m==="debug"&&e.jsx(ga,{clientThreadId:n,slideOver:!1,onClose:()=>de.toggleActiveSidebar("debug"),isOpen:!0})]})})}const cs=us.memo(ha);function xa(s,t){const i=ws({clientThreadId:s});return d.useCallback(async(n,o,a)=>{if(!t)return;const m=new Ts,c=N.getThreadCurrentLeafId(s),p=oe(),b=Ot(o);N.updateTree(s,x=>{x.addNodeToEnd(c,{id:p,children:[],parentId:c,message:{id:p,author:{role:q.User},content:{content_type:nt.Text,parts:[`Call the ${o} API with the ${a} operation`]},recipient:"all",metadata:{jit_plugin_data:{from_client:{type:"test",operation:a,tool_name:b}}}}})});const w={conversationMode:{kind:ie.GizmoTest,gizmo_id:n}},l=await Be(),[u,v,h]=await Promise.all([De.getEnforcementToken(l),Ke.getEnforcementToken(l),We.getEnforcementToken(l)]);i({model:t.id,completionType:ds.Next,parentNodeId:p,metadata:{},focusOnNewCompletion:!0,chatReq:l,arkoseToken:u,turnstileToken:v,proofToken:h,preflightTime:0,completionMetadata:w,turnTracker:m})},[s,i,t])}const va=He(()=>$e(()=>import("./gw079avgdfmxa4n6.js"),__vite__mapDeps([11,1,2,3,12,4,5,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29])).then(s=>s.GizmoActionsEditor));var Vs=(s=>(s.MAGIC_MAKER="magic",s.ADVANCED="advanced",s.PREVIEW="preview",s))(Vs||{});function _e({value:s,label:t,testId:i}){return e.jsx(As,{value:s,className:"text-md w-1/3 flex-grow rounded-lg border-token-border-light p-1.5 font-semibold text-token-text-tertiary transition hover:text-token-text-primary radix-state-checked:border radix-state-checked:bg-token-main-surface-primary radix-state-checked:text-token-text-primary radix-state-checked:shadow-[0_0_2px_rgba(0,0,0,.03)] md:w-1/2","data-testid":i,children:t})}function ja({className:s,editorTab:t,setEditorTab:i}){const r=Q(),{value:n}=be("1393076427");return e.jsxs(Gs,{className:re("flex w-full overflow-hidden rounded-xl bg-token-main-surface-secondary p-1.5 md:w-1/2",s),value:t,onValueChange:o=>{i(o)},children:[n&&e.jsx(_e,{value:"magic",label:r.formatMessage(Ge.magicMakerLabel)}),e.jsx(_e,{value:"advanced",label:r.formatMessage(Ge.configureLabel),testId:"gizmo-editor-configure-button"}),e.jsx("div",{className:"flex w-1/3 md:hidden",children:e.jsx(_e,{value:"preview",label:r.formatMessage(Ge.previewLabel)})})]})}function ba(s,t){return s.length!==t.length?!1:s.every(i=>t.some(r=>r.type===i.type))}function ya(s,t){return s.name===t.gizmo.display.name&&s.description===t.gizmo.display.description&&s.instructions===t.gizmo.instructions&&ba(s.tools,t.tools)&&Ue(s.files?.map(i=>i.file_id)??[],t.files?.map(i=>i.file_id)??[])&&s.profilePictureUrl==t.gizmo.display.profile_picture_url&&s.profilePictureId==t.gizmo.display.profile_pic_id}const Ks=({gizmo:s,onNewGizmoId:t})=>{const i=gs(),r=Us(bs.BrowsingAvailable),n=Q(),o=ae(),a=d.useRef(s!=null?ns(s):r?ri:oi),m=d.useRef(s),c=d.useRef(a.current),[p,b]=d.useState(()=>a.current),[w,l]=d.useState(()=>he()),[u]=d.useState(()=>({context_message:Li(a.current),model_slug:"unused",enabled_tools:[{tool_id:s!=null?"gizmo_editor":"gizmo_creator"}]}));Bi(w,c.current,u);const{data:v}=qt(),h=v?.modelsList.find(M=>M.tags.includes(rt.GPT_4))??v?.modelsList.find(M=>M.id===Qt),{data:x}=Vt(a.current.id),S=Kt(),{isPending:k,error:T}=S,I=Yt(),j=d.useMemo(()=>x!=null&&!ya(p,x),[p,x]),g=async()=>{const M=a.current;try{const P=await S.mutateAsync({editorData:M,gizmoId:M.id});if(m.current=P,a.current.id==null){const z=P.gizmo.id;a.current={...a.current,id:z,sharingTargets:P.gizmo.sharing_targets},b(a.current),t?.(z)}for(const z of P.tools.filter($=>$.type===X.JIT_PLUGIN)){const $=a.current.tools.find(J=>J.type===X.JIT_PLUGIN&&J.metadata.domain===z.metadata.domain);$&&$.metadata.action_id!==z.metadata.action_id&&($.metadata={...$.metadata,action_id:z.metadata.action_id},b(a.current))}return P}catch(P){const z=Ms(P)??n.formatMessage(Qs.errorSavingDraft);throw o.warning(z,{duration:2}),P}},C=d.useRef(void 0),G=async()=>a.current.id!=null?a.current.id:(C.current==null&&(C.current=g().then(M=>M.gizmo.id).catch(M=>{throw C.current=void 0,M})),C.current),[O]=d.useState(()=>Zt(()=>g(),2e3,{trailing:!0}));function _(M,P=!0){const z=typeof M=="function"?M(a.current):di(a.current,M);Ue(z,a.current)||(a.current=z,b(a.current),P&&O())}const U=d.useRef(void 0),H=async M=>{if(M==null){ge(!1);return}try{const P=await Ai(a.current,M,o,U.current);P!=null&&(_(P),c.current=ks(a.current))}catch(P){Ae.addError(P),o.warning("Something went wrong generating your GPT",{duration:3})}finally{U.current=N.getThreadCurrentLeafId(M),ge(!1)}},B=Ei(w,H,u),[E,F]=d.useState(void 0);d.useEffect(()=>{F(li(s))},[s?.gizmo.id]);const me=async(M,P)=>{const z=Me(a.current,M.recipient,P);if(z.length>0){o.warning(`Could not save GPT:

${z.map(ee=>`- ${Re(ee)}`).join(`
`)}`,{duration:3});return}const $=await g(),J=$.gizmo.id;try{return vs.logEvent(js.promoteGizmo,{gizmo_id:$.gizmo.id,sharing_recipient:M.recipient,editor_tab:D}),await I.mutateAsync({gizmoId:$.gizmo.id,data:{sharingSubjects:M.subjects,sharingRecipient:M.recipient,categories:P==null?void 0:[P]}},{onSuccess(Pe){i.setQueryData(rs(i,J).queryKey,Pe),i.invalidateQueries({queryKey:["gizmos"]}),i.invalidateQueries({queryKey:["gizmo",{gizmoId:J}]}),i.invalidateQueries({queryKey:["gizmo","userActionSettings",{gizmoId:J}]})}})}catch(ee){if(ee instanceof Xt)F({gizmoId:J,sharingRecipient:M.recipient,moderationType:Fs.PublishBlocked,sharingTargets:ee.response?.sharing_targets,showModal:ce.AppealAvailable});else{Ae.addError(ee);const Pe=ee.detail??"An unknown error occurred";o.warning("Error saving GPT - "+Pe,{duration:6})}}},{value:we}=be("1393076427"),[D,y]=d.useState(()=>{if(!we)return"advanced";const M=es.getItem(ss.GizmoEditorTab);return Object.values(Vs).includes(M)?M:"magic"}),L=ot.useState(({windowWidth:M})=>M);d.useEffect(()=>{L!=null&&L>=768&&D==="preview"&&y("magic")},[L,D]);const[Ys,Zs]=d.useState(!1),[Xe,ge]=d.useState(!1),[Je,Te]=d.useState(void 0);return e.jsxs("div",{className:"flex h-screen w-full flex-col items-center",children:[e.jsx(Xi,{gizmoEditorData:p,isUpsertLoading:S.isPending,isPromoteLoading:I.isPending,hasUnpublishedChanges:j,isUploadingProfilePic:Ys,isGeneratingProfilePic:Xe,publishedGizmo:x,updateGizmo:_,promoteGizmo:async(M,P)=>{const z=await me(M,P);return a.current={...a.current,sharingRecipient:M.recipient},b(a.current),es.setItem(ss.GizmoEditorTab,D),z},appealGizmo:async(M,P)=>{E!=null&&F({...E,sharingRecipient:M,categories:P==null?void 0:[P],showModal:ce.AppealAvailable})},setAppealState:F,revertDraft:x!=null&&j?()=>{const M=i.getQueryData(rs(i,a.current.id).queryKey);if(M!=null){const P=ns(M);a.current=P,b(P),g()}}:void 0,draftMessage:e.jsx(ma,{isPublished:x!=null&&(x.gizmo.share_recipient==="marketplace"||x.gizmo.share_recipient==="workspace"),hasUnpublishedChanges:j,isSavingDraft:k,upsertDraftError:T,className:"text-sm"}),showActionsModal:M=>{Te(M)},className:"flex-shrink-0"}),E&&e.jsx(ci,{appealState:E,onAppealClose:()=>F({...E,showModal:ce.None}),onAppealSubmitted:()=>F({...E,showModal:ce.AppealSent})}),e.jsxs("div",{className:"relative flex w-full grow overflow-hidden",children:[e.jsx("div",{className:"flex w-full justify-center md:w-1/2",children:e.jsx("div",{className:"h-full grow overflow-hidden",children:Je!==void 0?e.jsx(va,{currentlyEditingActionDomain:Je,gizmoEditorData:p,updateGizmo:_,onClose:()=>{Te(void 0)}}):e.jsxs("div",{className:"flex h-full flex-col px-2 pt-2",children:[e.jsx("div",{className:"flex w-full flex-row justify-center",children:e.jsx(ja,{editorTab:D,setEditorTab:y,className:"mb-2 flex-shrink-0 self-center"})}),e.jsx("div",{className:"grow overflow-hidden",children:D==="magic"?e.jsx("div",{className:"h-full w-full pb-5",children:e.jsx(Wi,{gizmoEditorData:p,updateGizmo:_,completionCallbackResponse:H,clientThreadId:w,gizmoEditorDataRef:a,magicMakerBehaviorOverrides:u,magicMakerConversationGizmoEditorDataRef:c,requireGizmoId:G},w)}):D==="advanced"?e.jsx(ca,{gizmoEditorData:p,updateGizmo:_,currentModelConfig:h,generateProfilePic:()=>{ge(!0),B(a,c,[Ui])},setIsUploadingProfilePic:Zs,isGeneratingProfilePic:Xe,setIsGeneratingProfilePic:ge,requireGizmoId:G,onShowActionsEditor:M=>{Te(M)}}):e.jsx(cs,{gizmoEditorData:p,currentModelConfig:h,isSavingDraft:k,showTitle:!1})})]})})}),e.jsx("div",{className:re("hidden w-1/2 justify-center border-l border-token-border-medium bg-token-main-surface-secondary pt-4",D!=="preview"&&"md:flex"),children:e.jsx("div",{className:"flex-grow pb-5",children:e.jsx("div",{className:"h-full",children:e.jsx(cs,{gizmoEditorData:p,currentModelConfig:h,isSavingDraft:k})})})})]})]})};function Ma({gizmoId:s,version:t}){const{data:i}=Wt({gizmoId:s,draft:!0,version:t}),r=je(_s.accountUserId),o=Ht()?.id,a=i!=null&&r!=null&&o!=null&&$t(i);return i==null||!a?null:e.jsx(Ks,{gizmo:i})}function wa({onNewGizmoId:s}){return e.jsx(Ks,{onNewGizmoId:s})}const Ta=({gizmoId:s,remixSourceId:t,version:i})=>{const r=ue(),n=ye(),o=d.useRef(void 0);d.useEffect(()=>(de.enterGizmoEditor(),()=>{de.exitGizmoEditor()}),[]);let a=s;return s!=null&&o.current===s&&(a=void 0),Bt({resetThreadAction:()=>{r("/")}}),n?.data?a!==void 0?e.jsx(Ma,{gizmoId:a,version:i},a):e.jsx(wa,{remixSourceId:t,onNewGizmoId:m=>{o.current=m,window.history.replaceState(window.history.state,"",Dt(m))}}):e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx(Ve,{})})},Ge=le({magicMakerLabel:{id:"gizmo.magicMakerLabel",defaultMessage:"Create"},configureLabel:{id:"gizmo.advancedLabel",defaultMessage:"Configure"},previewLabel:{id:"gizmo.previewLabel",defaultMessage:"Preview"}});function Pa(s){const t=ue();d.useEffect(()=>{s||t(lt(ct.NO_ACCESS))},[s,t])}const Ra=()=>(gt(),null);function Ea(){const s=ye();Pa(s==null||s.canCreateGizmos());const t=dt(),[i]=ut(),r=ue(),n=t.slug,o=i.get("version"),a=n?mt(n):void 0,m=i.get("remixFrom");return d.useEffect(()=>{Be(!0).then(c=>{De.initializeAndGatherData(c),Ke.initializeAndGatherData(c),We.initializeAndGatherData(c)})},[]),d.useEffect(()=>{s!=null&&!s.canCreateGizmos()&&r("/")},[s,r]),s?.canCreateGizmos()?e.jsx(Jt,{children:e.jsx(Ta,{gizmoId:a,remixSourceId:m??void 0,version:o!=null?Number(o):void 0})}):null}export{pa as G,fa as a,Ea as b,Ra as c};
//# sourceMappingURL=ke74k1ih0a4d0vmj.js.map
