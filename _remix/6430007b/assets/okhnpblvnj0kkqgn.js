import{f5 as ce,f6 as W,cr as le,f7 as T,r as y,dq as de,ay as fe,f8 as ye,P as $,d9 as me,u as f,au as K,R as J,e5 as U,aq as Z,X as ge,b4 as x,cO as pe,e9 as he,bw as Me,ag as _e,d8 as X,E as z,F as C,bF as j}from"./7q6a9ksdf0pmxyke.js";import{c6 as ee,a9 as N,bK as ze,dG as Se,dH as Ge,dI as Pe,dJ as Ce,dK as V,bR as qe,dL as Fe,dM as E,aJ as a,dN as ve,dO as Ee,dP as Te,dQ as Le,dR as Re}from"./g61cr21b5136jq6j.js";import{T as w,s as De,f as Qe}from"./mbounqbdqvic35ki.js";function be({clientThreadId:e}){var i;const t=w.getThreadCurrentLeafId(e),n=((i=w.getTree(e).getMessage(t).metadata)==null?void 0:i.model_switcher_deny)??[],s={};n.forEach(u=>{const{slug:d,context:c,reason:l,description:g}=u,m=s[d]??{},F=m[c]??[];F.push({reason:l,description:g}),m[c]=F,s[d]=m});const o=ce();for(const{resets_after:u,model_slug:d}of o)[W.CONVERSATION,W.REGENERATE].forEach(c=>{const l=s[d]??{},g=l[c]??[],m={reason:le.RATE_LIMIT,resetsAfter:u};g.push(m),l[c]=g,s[d]=l});return s}const Je="text-davinci-002-render-sha",Ze="gpt-4",Xe="gpt-4o",et="o1-preview",tt="o1-mini",A=ee({slug:N,max_tokens:4097,title:"Default",description:"",tags:[T.GPT_3_5],product_features:{}}),we=({default_model:e,tagline:t,color:r,human_category_name:n,category:s,human_category_short_name:o,human_category_shorter_name:i,subscription_level:u,short_explainer:d,subcategory:c,...l})=>({color:r,tagline:t,defaultModel:e,label:n,shortLabel:o,description:d,shorterLabel:i??o,subscriptionLevel:u,categoryId:s,subcategory:c,...l}),Ae=({icon:e,icon_filled_src:t,icon_outline_src:r})=>({iconName:e,iconFilledSrc:t,iconOutlineSrc:r}),Ke=({group:e,human_group_name:t,human_group_short_name:r,model_ids:n})=>({group:e,label:t,shortLabel:r,modelIds:n});function Ie(){return K({retry:5,queryKey:["modelIcons"],queryFn:async()=>await J.getModelIcons().then(e=>Object.fromEntries(Object.entries(e).map(([t,r])=>[t,Ae(r)])))})}function Oe(e){return K({retry:5,queryKey:["models",{isHistoryDisabled:e}],queryFn:async()=>await J.getModels(e).then(t=>{const{models:r,internal_groups:n,categories:s}=t,o=r.map(ee);return{categories:s.concat().reverse().map(we),groups:(n==null?void 0:n.map(Ke))??[],modelsList:o,modelsMap:Object.fromEntries(o.map(i=>[i.id,i]))}})})}function q(){const e=me();return f(Oe(e))}function rt(){return f(Ie())}function Ue({isRegen:e=!1}={}){const{isLoading:t,data:{categories:r=[],groups:n=[]}={}}=q(),s=y.useMemo(()=>e?r.filter(o=>o.is_regenerate_category!==!1):r.filter(o=>!o.is_regenerate_category),[r,e]);return{isLoading:t,categories:s,groups:n??[]}}function nt(){const{categories:e}=Ue();return!!e.find(({categoryId:t})=>t===ze.GPT4o)}function st(){const{data:e}=q();return y.useMemo(()=>e?new Set(Object.keys(e.modelsMap)):new Set([N]),[e])}const xe={[N]:A};function Ne(){const{data:e}=q();return(e==null?void 0:e.modelsMap)??xe}function te(e,t,r){let n=T.GPT_3_5;return r?n=T.GPT_4:t&&(n=T.GPT_4o),(e==null?void 0:e.modelsList.find(s=>s.tags.includes(n)))??(e==null?void 0:e.modelsList[0])??A}function ot(e=!1){const t=de(),r=fe(),[,n]=ye();return y.useCallback(({location:s,modelId:o})=>{const i=t.pathname.includes("/g/");e||i?($.logNewChatButtonClicked({location:s}),r({pathname:"/",search:`?model=${encodeURIComponent(o)}`})):(n(u=>(u.set("model",encodeURIComponent(o)),u)),$.logNewChatButtonClicked({location:s}))},[e,t,r,n])}function it(){const{data:{categories:e=[]}={}}=q(),{doesUserHaveAnyAccountsWithPlusFeatures:t}=U();if(t)return null;const r=e.find(Se);return(r==null?void 0:r.defaultModel)??null}function He(e){return De(e)}function re(e){const t=He(e),r=Ne();return y.useMemo(()=>t==null?A:r[t]??A,[t,r])}function ut(e,t){var n;return((n=re(e).enabledTools)==null?void 0:n.includes(t))??!1}function at(e){const t=Ge(),r=re(e),n=y.useMemo(()=>!t.isSuccess||!t.data?[]:t.data,[t.data,t.isSuccess]),s=be({clientThreadId:e});return y.useMemo(()=>{const i=new Set(r.enabledTools||[]);return n.filter(u=>!(!(u.requiredFeatures.length===0||u.requiredFeatures.every(l=>i.has(l)))||!(u.requiredModels.length===0||u.requiredModels.some(l=>!s[l]))))},[n,r,s])}function ct(e){return decodeURIComponent(e.model??"")||null}function lt(){const{data:e}=q(),{doesUserHaveAnyAccountsWithPlusFeatures:t}=U(),r=Z();return te(e,!!t,!!(r!=null&&r.isEnterprise()))}const ne="q",ke="m";function dt(e){const{clientThreadId:t,currentLeafId:r,handleRequestCompletion:n}=e,s=y.useRef(!1),{isLoading:o,data:i}=q(),{doesUserHaveAnyAccountsWithPlusFeatures:u,isLoading:d}=U(),c=Z(),l=ge(),g=x(),m=y.useCallback((h,S,M,G)=>{w.updateTree(t,P=>{P.addNode(h,M,S,pe.User,void 0,G)})},[t]),F=y.useCallback(async(h,{content:S,attachments:M},G,P,v,Q)=>{const O=r,p=M.length>0?{attachments:M}:{};p.system_hints=P.systemHints,m(h,O,S,p),n({type:he.Next,promptId:h,requestedModelId:Q,eventMetadata:G,cancelActiveRequests:!0,completionMetadata:P,turnTracker:v})},[m,n,r]),R=Me(()=>window.location.pathname)??null,H=Pe();let k=!o&&!d&&R!=null;const[I,D]=y.useState(!0);return y.useEffect(()=>{if(!I||s.current)return;const h=Qe.getConversationMode(t);if(!k||h==null)return;if(!We(R)||Be(R)&&H===void 0||w.getServerThreadId(t)!=null){D(!1);return}const{[ne]:S,[ke]:M,[Fe]:G,...P}=l.query,v=(typeof S=="string"?S:null)??(typeof M=="string"?M:null);if(!v||!v.trim()){D(!1);return}const Q=Ce(G),O=_e();s.current=!0;let p=i==null?void 0:i.modelsList;Q.has(V.Search)&&(p=p==null?void 0:p.filter(ae=>{var B;return(B=ae.enabledTools)==null?void 0:B.includes(V.Search)}));const b=i&&te({...i,modelsList:p??[]},!!u,!!(c!=null&&c.isEnterprise()));if(l.replace({query:P},void 0,{shallow:!0}),b==null){g.warning("No model available for this request"),D(!1);return}const ue=new qe;F(O,{content:v,attachments:[]},{eventSource:"url"},{conversationMode:h,source:"instant-query",systemHints:G?Array.from(Q):void 0},ue,b==null?void 0:b.id),D(!1)},[o,d,k,R,l,i,u,c,F,I,t,H,g]),I}function Be(e){return se(e)}function se(e){return e==null?!1:/^\/g\/[\w-]+$/.test(e)}function We(e){return e==null?!1:e==="/"||se(e)}const ft="GPT Builder";function yt(e){if(e)return`ChatGPT - ${e}`}function oe(e){return e.gizmo.short_url??e.gizmo.id??"-"}function ie(e){return`/g/${e}`}function mt(e){return`https://chatgpt.com${ie(e)}`}function $e(e){return ie(oe(e))}function gt(e,t){const r=new URLSearchParams;return t!=null&&r.set(ne,t),ve(new URL(`${$e(e)}?${r}`,"https://chatgpt.com"))}function pt(e){return`/g/${oe(e)}`}function ht(e){return Ee(e)&&e.gizmo.live_version===0||Te(e)&&e.liveVersion===0}function Mt(e,t){return f({queryKey:["gizmos","discovery",{locale:e,isAnon:t}],queryFn:async()=>a.getGizmoDiscovery(e,t)})}function _t({cutId:e,locale:t,limit:r,cursor:n,enabled:s=!0}){return X({queryKey:["gizmos","discovery",{cutId:e,locale:t,limit:r}],queryFn:async({pageParam:o})=>a.getGizmoDiscoveryCut(e,{locale:t,cursor:o,limit:r}),initialPageParam:n,getNextPageParam:o=>o.list.cursor??void 0,enabled:s})}function zt(){return f({queryKey:["gizmos","pinned"],queryFn:async()=>a.getGizmoPinned()})}function L(){return K({queryKey:["gizmos","bootstrap"],queryFn:async()=>a.getGizmoBootstrap().then(e=>({gizmos:e.gizmos.map(t=>({resource:t.resource,flair:t.flair}))}))})}function St(){return f(L())}function Y(e,t){const r=e.filter(s=>s.resource.gizmo.id!==t.resource.gizmo.id);let n=r.findIndex(s=>s.flair.kind===E.Recent);return n===-1&&(n=r.length),r.splice(n,0,t),r}const Gt={handleGizmoInteracted(e,t){const r=e.getQueryData(_(e,t).queryKey);r!=null&&e.setQueryData(L().queryKey,n=>{if(n==null)return n;const s=n.gizmos.find(o=>o.resource.gizmo.id===t);return(s==null?void 0:s.flair.kind)===E.FirstParty||(s==null?void 0:s.flair.kind)===E.SidebarKeep?n:{gizmos:Y(n.gizmos,{resource:r,flair:{kind:E.Recent}})}})},handleGizmoSidebarKeep(e,t){const r=e.getQueryData(_(e,t).queryKey);r!=null&&e.setQueryData(L().queryKey,n=>n==null?n:{gizmos:Y(n.gizmos,{resource:r,flair:{kind:E.SidebarKeep}})})},handleGizmoSidebarHide(e,t){e.setQueryData(L().queryKey,r=>r!=null&&r.gizmos.some(n=>n.resource.gizmo.id===t)?{gizmos:r.gizmos.filter(n=>n.resource.gizmo.id!==t)}:r)}};function Pt(e,t=!1){const r=z();return f(_(r,e,t))}function Ct({gizmoId:e,draft:t,version:r}){const n=z(),s=r?{queryKey:["gizmo","version",{gizmoId:e,version:r}],queryFn:async()=>a.getVersion({gizmoId:e,version:r}),enabled:e!=null}:_(n,e,t);return f(s)}function qt(e,t){return f({queryKey:["gizmo","userActionSettings",{gizmoId:e}],queryFn:async()=>a.getUserActionSettings(e),enabled:e!=null&&t})}function _(e,t,r=!1){return K({queryKey:["gizmo",{gizmoId:t},{draft:r}],queryFn:async()=>a.getGizmo(t,r),enabled:t!=null,initialData:()=>{var o,i;if(r===!0)return;const n=e.getQueryData(L().queryKey);if(n!=null)return(o=n.gizmos.find(u=>u.resource.gizmo.id===t))==null?void 0:o.resource;const s=e.getQueryData(["gizmos","discovery"]);if(s!=null)for(const u of s.cuts){const d=(i=u.list.items.find(c=>c.resource.gizmo.id===t))==null?void 0:i.resource;if(d!=null)return d}}})}function Ft(e,t){return e.fetchQuery(_(e,t))}function vt(e){return f({queryKey:["gizmo",{search:e}],queryFn:async()=>a.getGizmoSearch(e),enabled:e.length>0})}function Et(e,t){return f({queryKey:["gizmo-search-workspace",{search:e}],queryFn:async()=>a.getGizmoSearchForWorkspace(e),enabled:e.length>0&&t})}function Tt(e,t=!1,r=!1,n=null){return X({queryKey:[r?"gizmo-search-workspace":"gizmo",{query:e,cursor:n}],queryFn:async({pageParam:s})=>r?a.getGizmoSearchForWorkspace(e,n=s):a.getGizmoSearch(e,n=s),initialPageParam:n,getNextPageParam:s=>s.cursor??void 0,enabled:t})}function Lt(){const e=z();return C({mutationFn:async({gizmoId:t,editorData:r})=>{const{instructions:n,name:s,description:o,profilePictureId:i,profilePictureUrl:u,promptStarters:d,tools:c,files:l,trainingDisabled:g}=r;return a.upsertDraft({instructions:n,display:{name:s,description:o,profile_pic_id:i,profile_picture_url:u,prompt_starters:d},tools:c,files:l.map(m=>({...m,location:Le.FILE_SERVICE})),training_disabled:g},t)},onSettled:t=>{t&&(e.setQueryData(_(e,t.gizmo.id,!0).queryKey,t),e.invalidateQueries({queryKey:["gizmos","mine"],refetchType:"none"}))}})}function Rt(){const e=z();return C({mutationFn:async({gizmoId:t,data:r})=>{const{sharingRecipient:n,categories:s}=r,o=await a.promoteDraft({sharing:r.sharingSubjects&&r.sharingSubjects.length>0?r.sharingSubjects:{recipient:n},categories:s},t);if(o.error)throw new Re(o);return o.resource},onSettled:t=>{e.invalidateQueries({queryKey:["gizmos"],refetchType:"all"}),e.invalidateQueries({queryKey:["gizmos","pinned"],refetchType:"none"}),t&&e.setQueryData(_(e,t.gizmo.id,!1).queryKey,t)}})}function Dt(){const e=z();return C({mutationFn:async({gizmoId:t})=>a.deleteGizmo(t),onSettled:()=>{e.invalidateQueries({queryKey:["gizmos"],refetchType:"all"})}})}function Qt(){const e=z(),t=x();return C({mutationFn:async({name:r,hideName:n,websiteUrl:s,willReceiveSupportEmails:o})=>a.updateBuilderProfile({name:r,hide_name:n,website_url:s,will_receive_support_emails:o}),onSuccess:r=>{e.setQueryData(["builderProfile"],r)},onError:r=>{t.warning(r.message)}})}function bt(){return f({queryKey:["builderProfile"],queryFn:async()=>a.getBuilderProfile()})}function wt(){return C({mutationFn:async({gizmoId:e})=>a.copyGizmo({gizmoId:e})})}function At(){return f({queryKey:["gizmoCategories"],queryFn:async()=>a.getCategories()})}function Kt(e,t){return!!(t!=null&&[j.PrimaryAssistant,j.GizmoInteraction].includes(t)&&(e!=null&&e.includes(T.GPT_4)))}function It(e,t){const r=z(),n=x();return C({mutationFn:async({rating:s,message:o,includeFrom:i})=>{await a.upsertUserReview(e,s,o,i)},onSuccess:async()=>{r.invalidateQueries({queryKey:["gizmo","review",{gizmoId:e}]})},onError:s=>{n.danger(s.message)}})}export{Et as A,Tt as B,Mt as C,Ft as D,bt as E,Qt as F,Xe as G,At as H,Ct as I,q as J,Ze as K,Lt as L,Rt as M,_ as N,ut as O,at as P,Ne as Q,Kt as R,ft as S,et as T,tt as U,rt as V,be as W,it as X,Je as Y,dt as Z,He as a,Ue as b,Pt as c,nt as d,ie as e,It as f,$e as g,Dt as h,pt as i,ht as j,lt as k,St as l,Gt as m,_t as n,zt as o,yt as p,mt as q,gt as r,oe as s,wt as t,ot as u,qt as v,st as w,ct as x,re as y,vt as z};
//# sourceMappingURL=okhnpblvnj0kkqgn.js.map
