const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/9oep91wig5v7nbxi.js","assets/hwf9zvd1aw2q6bni.js","assets/o9jymz7vdhi3lqx8.js","assets/root-ln1yae7t.css","assets/ic9v3ekos3e47rwz.js","assets/mmx5fwpsjnyps8fm.js","assets/gcq6nq5ilw3cni50.js","assets/conversation-small-c8xg50op.css","assets/grm2hqg2r379yuc9.js","assets/d2enjwn8b6jly1r9.js","assets/hpsvd424sjrdhlcq.js","assets/iifiuc3nib6ssn9e.js","assets/on5i6wiudhy03n19.js","assets/oj1bhdun86139hql.js","assets/i2qxjm7ksuhoez8f.js","assets/dulogrhomd7ury1d.js","assets/g94gjpa24d3dgkvc.js","assets/wx7snc14ve0jovkm.js","assets/lzjpn68pe1mv84wv.js","assets/cr9rnw1iy6gknfzn.js","assets/e2kkvbg1i6izzv9a.js","assets/oeursaybce9lihvu.js","assets/lwz1f455hysr17f3.js","assets/cqeq9bdh5k1hh7cr.js","assets/h40i7iwsro901e1b.js","assets/i9f38ysiidtdks5t.js","assets/c8pe8tpqkw1fjx23.js","assets/cqk6btirean3jhb2.js","assets/orl0zybyxtbw697s.js","assets/kpo9x19oorjkm66p.js","assets/et5vszokekahe2km.js","assets/sso-dlecoq29tbbucwzg.js","assets/gt0q5h2rq8bab6mk.js","assets/bt4k0k8i77cxp76b.js","assets/ijiluygl0s0dhnj2.js","assets/2wm59teo35cqbdt1.js","assets/mtj6k2f8ve73w700.js","assets/mqj72pi2q2nphcdc.js","assets/1tm7s25tu0rcb1ao.js","assets/eoz02xxdbtlgnzui.js","assets/dbotdrhrkzcmepf8.js","assets/i8haxpriu70qoghy.js","assets/ctoq8lt2wcc1zt24.js","assets/hlp37ore79yxrotf.js","assets/b4s9ag5fqi92ivok.js","assets/evreryivkx03kiru.js","assets/h00uks2015m2626y.js","assets/jzhnik2dwoiq17kj.js","assets/bn0yn2an269lopsa.js","assets/g5dhaop2jzbfqw8o.js","assets/i5pk7xnq5wd6zbwm.js","assets/ndz9xyu0gzys1ltc.js","assets/mchebjgauimbna10.js","assets/ks31cwicy53kvdgr.js","assets/4dvgwa0oluu8ol5a.js","assets/kqwdyvkaaavvn8k3.js","assets/ilb5ktb37u71728e.js","assets/icw4oecl8vdgiw9h.js","assets/n667hftkiiftqmcp.js","assets/i9492jucznoqt7zq.js","assets/hbi8yge20ub5awhz.js","assets/nhwwej1nq0zrd7sc.js","assets/nhu8fej1h0ggf510.js","assets/lyni056hl6jy3n02.js","assets/d0g8ptgc5gcqjwyj.js","assets/j7phn6jkfp370rph.js","assets/isjdmfmhzv09v01t.js","assets/frhx66adsy7ij3wf.js","assets/gr4xpg7wa57x2uqj.js","assets/hizb1jv4u9gtdqdl.js","assets/b2ql00e3j8xnu33y.js","assets/grt4hlp4k5c4kxar.js","assets/ks402f7dn9mvtrb1.js","assets/ejn53uisfp14bkeb.js","assets/dqoeogg3yjw041er.js","assets/fxolzsu9v2t96ojq.js","assets/kvnjdr94x3wz3db4.js","assets/ooms65c6ollmf9pn.js","assets/iej0cupg2dqkmejt.js","assets/jc7bgpaw0qkg3jjz.js","assets/flc79b0l9xqcxtxq.js","assets/gjdk1jlcjn7sf5mt.js","assets/k8wo5wv9rjmp61bm.js","assets/d43u2na4qorz1obq.js","assets/dwqs41wa5ufncm86.js","assets/shared-mk6ngktc.css","assets/sso-46pn026z.css","assets/b5nc20t88ec5fpfz.js","assets/cgcmm2ma1bm07z0x.js"])))=>i.map(i=>d[i]);
var co=Object.defineProperty;var Hn=t=>{throw TypeError(t)};var uo=(t,e,s)=>e in t?co(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var Y=(t,e,s)=>uo(t,typeof e!="symbol"?e+"":e,s),nn=(t,e,s)=>e.has(t)||Hn("Cannot "+s);var r=(t,e,s)=>(nn(t,e,"read from private field"),s?s.call(t):e.get(t)),G=(t,e,s)=>e.has(t)?Hn("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),A=(t,e,s,a)=>(nn(t,e,"write to private field"),a?a.call(t,s):e.set(t,s),s),_=(t,e,s)=>(nn(t,e,"access private method"),s);var bs=(t,e,s,a)=>({set _(o){A(t,e,o,s)},get _(){return r(t,e,a)}});import{F as qe,cq as St,j as n,J as Ae,aA as wt,fg as ho,eM as ya,bw as mo,r as u,aC as go,E as be,ad as Is,c as se,cG as va,a4 as Ft,a1 as Ms,M as an,G as fo,aq as Ot,y as q,I as E,aK as Fs,bn as at,dI as os,P as Z,ck as Mt,c0 as _t,aL as Ps,bM as zt,bq as po,fh as bo,cI as ve,cw as xo,av as yo,co as En,fi as vo,L as So,ah as ot,fj as Sa,e1 as Ca,c6 as lt,cy as Co,cz as wo,cC as Zt,cA as Vn,cB as Mo,H as bt,fk as _o,d8 as ko,aO as Ct,aW as To,cv as wa,K as Je,af as Yt,e$ as jo,cS as Qt,e7 as _s,c8 as Ao,bt as No,bJ as oe,fb as qn,bO as it,u as Eo,f6 as Io,fl as Ma,db as Fo,er as Po,an as Ro,A as _a,dg as Do,U as Lo,fm as Oo,bv as zo,ct as Bo,fn as Uo,cW as Go,cX as Wo,cY as Ho,ec as Vo,fo as qo,fp as $o,eY as Ko,bu as Yo,aQ as Qo,bi as Jo}from"./hwf9zvd1aw2q6bni.js";import{u as is,g as Xo,G as Zo,t as ei,r as ti}from"./d2enjwn8b6jly1r9.js";import{G as si,T as ni}from"./lwz1f455hysr17f3.js";import{hA as ka,co as In,cn as Fn,cq as Pn,j as Rs,l as Ta,ej as $n,A as ja,en as ai,bb as oi,aZ as ts,U as Ds,hB as ii,Y as on,bg as ri,bD as Aa,aD as Na,gr as Ea,hC as li,dK as ci,aw as di,hD as ui,aa as hi,cv as mi,bY as gi,eg as fi,b0 as pi,u as ss,hE as ks,aV as Ia,fp as bi,a5 as xi,fq as yi,e1 as rs,c4 as vi,bK as fn,a8 as Si,hF as Ci,n as vs,a_ as Fa,el as wi,B as pn,hG as Mi,fI as _i,gp as ki,p as Pa,hH as Ra,hI as Ti,aq as ji,hJ as Ai,q as Ts,am as rt,bp as js,bQ as Rn,ez as Ni,hK as Ei,eo as Da,a3 as Ii,hL as Fi,hM as Pi,cJ as Ri,G as Di,hN as Li,hO as Oi,hP as zi,hQ as Bi,hR as Ui,hS as Gi,hT as Wi,hU as Hi,d_ as Kn,hV as Vi,ek as qi,gZ as $i,hW as Ki,hX as Yi,ei as Qi,E as Ji,ac as Xi,cM as Zi,hY as Yn,hZ as rn,h_ as er,h$ as Qn,i0 as tr,fT as sr,bf as nr,i1 as ar,fu as or,fv as ir,r as rr,i2 as lr,g4 as Jn,i3 as cr,P as dr,i4 as ur,i5 as hr,i6 as mr,i7 as gr,i8 as fr,i9 as pr,ia as br,ib as xr,a9 as yr}from"./gcq6nq5ilw3cni50.js";import{a as vr,t as bn,T as La,H as Sr,b as Cr,c as wr,d as Mr,e as _r,M as Oa}from"./e2kkvbg1i6izzv9a.js";import{P as kr,v as Tr,C as xn,w as jr,q as Ar,x as ln,y as Nr,u as Er,z as cn,F as Ir,T as Fr}from"./ijiluygl0s0dhnj2.js";import{d as Pr,i as es,A as za,T as B,e as ct,l as Ls,u as Os,b as Rr,g as ls,c as zs,I as Xn,h as Zn,J as Dr,r as Bs,a as Ba,K as Lr,L as Or,M as zr,j as Br,N as Ur,O as Gr,P as Wr,Q as Ua,w as Dn,s as Hr,t as Vr,R as Ga,S as Wa,U as qr,V as $r,W as Ha}from"./iifiuc3nib6ssn9e.js";import{W as Kr,o as Yr,p as Qr,q as Ln}from"./mqj72pi2q2nphcdc.js";import{m as Lt}from"./on5i6wiudhy03n19.js";import{U as Jr,b as As,aE as Xr,b9 as Us,a1 as Zr,b7 as el,a4 as tl,bL as sl,bM as nl,aK as al,bN as ol,w as il,ay as Va,az as qa,a as rl,ax as ll,aw as cl,t as dl,bd as ul,bI as hl}from"./o9jymz7vdhi3lqx8.js";import{H as ml}from"./feb7uen1emmpiu1v.js";import{G as gl,L as fl}from"./cr9rnw1iy6gknfzn.js";import{c as pl}from"./orl0zybyxtbw697s.js";import{T as bl,u as xl,a as yl,M as $a,b as vl,c as Sl,C as Cl,W as wl}from"./lyni056hl6jy3n02.js";import{b as Ml,C as _l}from"./c8pe8tpqkw1fjx23.js";import"./g5dhaop2jzbfqw8o.js";import{c as On,j as kl,S as Tl,G as jl,f as Al,u as Nl,a as El,k as Il}from"./hpsvd424sjrdhlcq.js";import{D as xt,$ as Ka}from"./g94gjpa24d3dgkvc.js";import{a as Fl,G as Pl}from"./lzjpn68pe1mv84wv.js";import{M as Rl}from"./flc79b0l9xqcxtxq.js";import{I as Dl}from"./mchebjgauimbna10.js";import{i as Ll}from"./1tm7s25tu0rcb1ao.js";function dn({label:t,tooltip:e,Icon:s}){return n.jsxs("div",{className:"flex items-center gap-1 text-sm font-semibold opacity-70",children:[s&&n.jsx(s,{className:"icon-sm"}),n.jsx("div",{children:t}),n.jsx(Rs,{label:e,children:n.jsx(As,{className:"icon-sm ml-1"})})]})}function Ol({clientThreadId:t,gizmoId:e}){const s=qe(),a=ka(),o=In(),i=Fn(),{data:l}=Pn(e,!1,i),d=!!e,c=St(),m=Pr(t);return i?c&&(!m||d)?n.jsx(dn,{label:s.formatMessage(Nt.temporaryChat),tooltip:s.formatMessage(Nt.temporaryChatTooltip),Icon:Jr}):a&&!o&&!c?n.jsx(dn,{label:s.formatMessage(Nt.memoryOff),tooltip:s.formatMessage(Nt.memoryOffTooltip)}):l&&(l==null?void 0:l.memoryFullPct)>=100?n.jsx(dn,{label:s.formatMessage(Nt.memoryFull),tooltip:s.formatMessage(Nt.memoryFullTooltip)}):null:null}const Nt=Ae({temporaryChat:{id:"ConversationPrivacyIndicator.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatTooltip:{id:"ConversationPrivacyIndicator.temporaryChatTooltip",defaultMessage:"Temporary Chats won't appear in your history, and ChatGPT won't remember anything you talk about."},memoryOff:{id:"ConversationPrivacyIndicator.memoryOff",defaultMessage:"Memory Off"},memoryOffTooltip:{id:"ConversationPrivacyIndicator.memoryOffTooltip",defaultMessage:"ChatGPT won't remember anything you talk about in this conversation."},memoryFull:{id:"2Eq+5y",defaultMessage:"Memory Full"},memoryFullTooltip:{id:"dNA8jQ",defaultMessage:"ChatGPT's memory is full. You can forget existing memories to make space."}}),ea=4;function zl(t){const{layer:e}=wt("4031588851"),{layer:s}=ho("4031588851");return t?e.get("enable_new_homepage",!1):s.get("enable_new_homepage",!1)}function Bl(t){return n.jsx(Kr,{children:e=>n.jsx(Ul,{...t,composerController:e})})}function Ul({clientThreadId:t,currentModelId:e,onRequestCompletion:s,composerController:a}){const o=es(t),i=za(t),l=ya(),d=mo(),[c,m]=u.useState([]),p=u.useRef(!1),f=go("589604007").value,{layer:S}=wt("4031588851"),C=S.get("filter_starter_prompt_by_model",!1),{promptStarters:x,isSuccess:g,isError:b}=vr(o&&!i,t,d?4:8,f,!0,C?e:void 0),h=!!c.find(L=>!!L.requires_file_upload),y=u.useCallback(L=>{const N=a.getCurrentText();return N&&`${L.title}${L.body}`.toLowerCase().startsWith(N.toLowerCase())},[a]),w=u.useCallback(L=>{const N=a.getCurrentText(),ee=L.title+L.body;return y(L)?{...L,title:N,body:ee.slice(N.length)}:{...L,title:ee,body:""}},[a,y]),v=u.useCallback((L=!1)=>{m(N=>!N.some(y)&&N.length>0?[]:L?N:N.map(w))},[y,w]),k=(L,N,ee)=>{const Ce=`${L.title} `;m([]),a.focus(),a.setText(Ce),requestAnimationFrame(()=>{const H=((x==null?void 0:x.filter(ne=>ne.theme===L.theme))??[]).map(ne=>({...ne,title:`${ne.title} `,type:$n.Autocomplete}));m(H),H.length>0&&bn(H,t),Cr(L,ee,t)})},R=x==null?void 0:x.reduce((L,N)=>(N.theme&&!L[N.theme]&&(L[N.theme]=N),L),{}),j=[];if(R)for(const L in R)j.push(R[L]);const W=j&&j.length>0,T=!!(g&&W),I=ea-c.filter(y).length,P=S.get("autocomplete_mode","HARDCODED"),D=u.useCallback(Ta(async L=>{const N=a.getCurrentText();if(!N||N.length<2||N.length>80){m([]);return}if(!p.current)try{const Ce=(await be.generateAutocompletions(N,L)).completions.map(H=>({id:Is(),type:$n.Autocomplete,title:N,body:H.slice(N.length),oneliner:H,prompt:H})).filter(y).map(w);m(H=>{const ne=H.filter(y),Q=Ce.filter(he=>!ne.some(V=>V.title===he.title&&V.body===he.body)).slice(0,ea-ne.length);return[...ne,...Q]}),Ce.length>0&&bn(Ce,t)}catch{}},P==="BING"?150:200),[a,P,w]),U=u.useCallback(()=>{v(),I>0&&D(I)},[D,v,I]);u.useEffect(()=>{p.current&&m([])},[p]);const ie=u.useMemo(()=>P==="HARDCODED"?v:U,[P,U,v]),ue=u.useCallback(()=>{a instanceof Yr&&v(!0)},[a,v]);return n.jsx(n.Fragment,{children:n.jsx(ja,{children:(b||g)&&n.jsx(n.Fragment,{children:n.jsx(La,{isStaticSharedThread:!1,showInlineEmbeddedDisplay:!1,withVerticalPadding:!0,withHorizontalPadding:!0,clientThreadId:t,children:n.jsxs(Sr,{children:[n.jsx(Gl,{}),n.jsx("div",{className:"w-full",children:n.jsx(kr,{clientThreadId:t,isNewThread:o,currentModelId:e,onRequestCompletion:s,showPromptStarters:!1,composerController:a,autocompletions:c,requiresFileUpload:h,onComposerInput:ie,onComposerChange:ue,onAutocompleteSelect:(L,N,ee)=>{m([N[ee]])},onTaggingDropdownClose:()=>{p.current=!1},onTaggingDropdownOpen:()=>{p.current=!0},hideHeader:!0})}),T&&n.jsx(Wl,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},promptStarters:j,onSelectStarterPrompt:k,isSendBlocked:l,clientThreadId:t,className:"h-8"})]})})})})})}function Gl(){const{layer:t}=wt("4031588851"),e=t.get("headline_option","HELP_WITH"),a=qe().formatMessage(e==="WHERE_TO_START"?yn.whereShouldWeStart:yn.whatCanIHelpWith),[o,i]=u.useState(1),[l,d]=u.useState(!0),c=20;return u.useEffect(()=>{let m;return o<a.length?m=setTimeout(()=>{i(o+1)},c):l&&(m=setTimeout(()=>{d(!1)},500)),()=>clearTimeout(m)},[a,o,l]),n.jsx("div",{className:"text-center",children:n.jsxs("div",{className:"mb-7 inline-flex justify-center text-2xl font-semibold leading-9",children:[n.jsx("h1",{children:a.substring(0,o)}),n.jsx("h1",{className:"result-streaming transition-opacity",style:{opacity:l?1:0},children:n.jsx("span",{})})]})})}function Wl({promptStarters:t,onSelectStarterPrompt:e,isSendBlocked:s,clientThreadId:a,...o}){return n.jsx(Lt.div,{...o,children:n.jsx($l,{starterPrompts:t,onSelectStarterPrompt:e,disabled:s,clientThreadId:a})})}const Hl=/\s/;function Vl({starterPrompt:t,starterPrompts:e,index:s,disabled:a,onSelectStarterPrompt:o}){const i=t.theme??t.title,l=Hl.test(i);return n.jsxs("button",{className:"relative flex items-center gap-1.5 rounded-full border border-token-border-light px-3 py-2 text-start text-[13px] shadow-xxs transition enabled:hover:bg-token-main-surface-secondary disabled:cursor-not-allowed xl:gap-2 xl:text-[14px]",disabled:a,onClick:()=>o(t,e,s),children:[n.jsx(ai,{starterPrompt:t,useV2Colors:!0}),n.jsx("div",{className:se("max-w-full text-balance text-gray-600 dark:text-gray-500",l?"break-word":"break-all"),children:i})]})}function ta({starterPrompts:t,onSelectStarterPrompt:e,disabled:s,clientThreadId:a,children:o}){return u.useEffect(()=>{bn(t,a)},[a]),n.jsxs("ul",{className:"flex max-w-3xl flex-wrap items-stretch justify-center gap-2 xl:mx-3 xl:gap-2.5",children:[t.map((i,l)=>n.jsx(Lt.li,{initial:{opacity:0},animate:{opacity:1},transition:{delay:l*.03},exit:{opacity:0},children:n.jsx(Vl,{starterPrompt:i,starterPrompts:t,index:l,disabled:s,onSelectStarterPrompt:e})},i.id??l)),o]})}function ql({clientThreadId:t,onClick:e}){u.useEffect(()=>{wr(t)},[t]);const s=qe();return n.jsx("button",{className:"relative flex max-w-full items-center gap-2 text-balance rounded-full border border-token-border-light px-3 py-2 text-start text-[14px] text-gray-600 shadow-xxs transition enabled:hover:bg-token-main-surface-secondary disabled:cursor-not-allowed dark:text-gray-500",onClick:()=>{Mr(t),e()},children:s.formatMessage(yn.moreStarterPrompts)})}function $l({starterPrompts:t,onSelectStarterPrompt:e,disabled:s,clientThreadId:a}){const[o,i]=u.useState(4),l=4,d=t.slice(0,l),c=t.slice(l,o).map(m=>({...m,isAdditional:!0}));return n.jsxs("div",{className:"mt-7 flex flex-col flex-wrap gap-y-2.5",children:[n.jsx("div",{children:n.jsx(ta,{starterPrompts:d,onSelectStarterPrompt:e,disabled:s,clientThreadId:a,children:t.length>o&&n.jsx(ql,{clientThreadId:a,onClick:()=>{i(t.length)}})})}),c&&c.length>0&&n.jsx(ta,{starterPrompts:c,onSelectStarterPrompt:e,disabled:s,clientThreadId:a})]})}const yn=Ae({whatCanIHelpWith:{id:"SplashScreenV2.whatCanIHelpWith",defaultMessage:"What can I help with?"},whereShouldWeStart:{id:"SplashScreenV2.whereShouldWeStart",defaultMessage:"Where should we start?"},moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),Et=Ae({submitRejectModeration:{id:"feedbackModal.moderationReject",defaultMessage:"Block Content"},submitAcceptModeration:{id:"feedbackModal.moderationAccept",defaultMessage:"Allow Content"},thumbsDownPlaceholder:{id:"feedbackModal.thumbsDownPlaceholder",defaultMessage:"What was the issue with the response? How could it be improved?"},copyrightContent:{id:"feedbackModal.copyrightContent",defaultMessage:"This content violates copyright law"},reportOtherContent:{id:"feedbackModal.reportOtherContent",defaultMessage:"I don't like this for some other reason (please describe)"},provideAdditionalFeedback:{id:"feedbackModal.provideAdditionalFeedback",defaultMessage:"Provide additional feedback"}});function Kl({onClose:t,clientThreadId:e}){var h;const s=qe(),a=B.getTree(e),o=(h=u.useContext(va))==null?void 0:h.serverSharedThreadId,i=B.getServerThreadId(e),l=o??i,d=u.useRef([]),c=u.useRef(""),m=u.useRef(null),p=u.useCallback(()=>{var w;const y=(w=m.current)==null?void 0:w.elements;d.current=[...y||[]].filter(v=>v.checked).map(v=>v.id).map(v=>v.replace("feedback-","")),c.current=(y==null?void 0:y["feedback-other"].value)||""},[]),f=u.useCallback((y,w)=>{if(l==null){Ft.danger("Moderation NOT logged successfully! serverThreadId is null"),Ms.addError("Moderation: serverThreadId is null");return}const v=a.getMessageId(B.getThreadCurrentLeafId(e));be.submitSharedConversationReportFeedback({message_id:v,shared_conversation_id:l,text:y,tags:w}).then(()=>{Ft.success("Moderation logged successfully")}).catch(k=>{Ft.danger("Moderation NOT logged successfully! Please try again"),Ms.addError(new Error("Moderation: failed to log",{cause:k}))}),t()},[a,e,t,l]),S=u.useCallback(()=>{p(),d.current.push("moderation-reject"),f(c.current,d.current)},[f,p]),C=u.useCallback(()=>{p(),d.current.push("moderation-accept"),f(c.current,d.current)},[f,p]),x=n.jsxs(n.Fragment,{children:[n.jsx(an.Button,{title:s.formatMessage(Et.submitRejectModeration),color:"danger",onClick:S}),n.jsx(an.Button,{title:s.formatMessage(Et.submitAcceptModeration),color:"primary",onClick:C})]}),[g,b]=u.useState([]);return u.useEffect(()=>{be.fetchShareModerationCategories().then(y=>{const w=y.moderation_categories;b(Object.keys(w).map(v=>[v,w[v]]))})},[]),n.jsxs(fo,{isOpen:!0,onClose:t,showCloseButton:!0,size:"custom",className:"md:max-w-[672px] lg:max-w-[896px] xl:max-w-6xl",type:"success",title:s.formatMessage(Et.provideAdditionalFeedback),children:[n.jsxs("form",{ref:m,children:[n.jsx(ii,{id:"feedback-other",placeholder:s.formatMessage(Et.thumbsDownPlaceholder),rows:3,className:"mb-1 mt-4 w-full resize-none rounded-md bg-token-main-surface-primary"}),n.jsxs("div",{className:"mb-4",children:[g.map(([y,w])=>n.jsx(on,{id:"feedback-"+y,label:w},y)),n.jsx(on,{id:"feedback-copyright",label:s.formatMessage(Et.copyrightContent)}),n.jsx(on,{id:"feedback-content-other",label:s.formatMessage(Et.reportOtherContent)})]})]}),n.jsx(an.Actions,{primaryButton:x})]})}function Yl({clientThreadId:t}){return oi(ts.SharedConversationModeration)?n.jsx(Kl,{onClose:()=>Ds.closeModal(ts.SharedConversationModeration),clientThreadId:t}):null}const Ql=({clientThreadId:t})=>{const e=Ot(),s=ct(t),{data:a,isLoading:o}=is(s);if(o)return null;const i=e!=null&&e.accountUserId?a?un.loggedInCtaGizmo:un.loggedInCta:un.loggedOutCta,l=e&&a?Xo(a):"/";let d=q.sharedConversationLoggedOutClicked;return e&&(e!=null&&e.accountUserId)&&(e.isFree()?d=a?q.sharedConversationFreeGizmoClicked:q.sharedConversationFreeClicked:d=a?q.sharedConversationPaidGizmoClicked:q.sharedConversationPaidClicked),n.jsx("div",{className:"flex flex-col items-center gap-4",children:n.jsx(ri,{href:l,onClickTrackingEventName:d,children:n.jsx(E,{...i,values:{name:a==null?void 0:a.gizmo.display.name}})})})},un=Ae({loggedOutCta:{id:"GizmoSharedConversationCTA.loggedOutCta",defaultMessage:"Sign up to chat"},loggedInCtaGizmo:{id:"GizmoSharedConversationCTA.loggedInCtaGizmo",defaultMessage:"Get started with {name}"},loggedInCta:{id:"GizmoSharedConversationCTA.loggedInCta",defaultMessage:"Get started with ChatGPT"}});function Jl({clientThreadId:t,isModeratingThread:e,continueConversationUrl:s}){const a=Fs(),o=qe(),{layer:i}=wt("1547743984"),l=i.get("is_continue_enabled",!1);return n.jsxs("div",{className:"relative flex w-full flex-1 flex-col items-center justify-center gap-2 pt-3 empty:hidden sm:flex-row",children:[n.jsx(Ql,{clientThreadId:t}),e&&n.jsx(at,{onClick:()=>{Ds.openModal(ts.SharedConversationModeration)},children:o.formatMessage({id:"thread.sharedConversation.moderate",defaultMessage:"Moderate conversation"})}),(l||(a==null?void 0:a.includes("debug")))&&s&&n.jsx(at,{color:"secondary",as:"link",to:s,icon:Xr,size:"giant",children:o.formatMessage({id:"thread.sharedConversation.continue",defaultMessage:"Continue this conversation"})})]})}function Xl({children:t}){const e=Aa(Na.AG8PqS2q),{eligible:s,isLoading:a}=pl(),{doesUserHaveAnyAccountsWithPlusFeatures:o}=os(),i=s&&!a;if(u.useEffect(()=>{i&&Z.logEvent(q.gpt4oNUXTooltipShown)},[i]),!i)return n.jsx(n.Fragment,{children:t});const l=()=>{Z.logEvent(q.gpt4oNUXTooltipDismissed),e.markAsViewed()};return n.jsx(Ea,{side:"bottom",show:!0,title:n.jsx(E,{...hn.title,values:{modelName:"GPT‑4o"}}),onDismiss:l,sideOffset:0,theme:"default",description:n.jsx(E,{...o?hn.bodyPaidFinal:hn.bodyFreeFinal,values:{modelName:"GPT‑4o",anotherModelName:"GPT‑4"}}),children:t})}const hn=Ae({title:{id:"1kewDD",defaultMessage:"Introducing {modelName}"},bodyPaidFinal:{id:"Z6KHqN",defaultMessage:"You can now try our newest model, {modelName}. It’s faster than {anotherModelName}, better at understanding images, and speaks more languages."},bodyFreeFinal:{id:"w8Y79o",defaultMessage:"You now have limited access to our latest model, {modelName}. It’s smarter, understands images, can browse the web, and speaks more languages."}}),Zl=Mt(()=>_t(()=>import("./9oep91wig5v7nbxi.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30])).then(t=>t.GizmoUsingAsOwnerNotice)),ec=({clientThreadId:t})=>{const e=hi(c=>c.activeStageSidebar),s=B.getServerThreadId(t),a=mi(Ps.WorkspaceShareLinks),{isUnauthenticated:o}=zt(),i=St(),l=a&&s&&!o&&!i,d=!e;return n.jsx("div",{className:"flex items-center gap-2 pr-1 leading-[0]",children:n.jsx(_l,{showShareButton:l,showProfileDropdown:d,clientThreadId:t})})};function tc({clientThreadId:t,gizmoId:e}){var i;const s=li(),{data:a}=is(e),o=Ot();return n.jsxs(n.Fragment,{children:[n.jsxs(ci,{className:"max-md:hidden",children:[n.jsxs("div",{className:"absolute start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2",children:[a!=null&&(o==null?void 0:o.isWorkspaceAccount())&&((i=a.gizmo.tags)==null?void 0:i.includes(di.WorkspaceDisabled))&&n.jsx(Zl,{gizmo:a}),n.jsx(Ol,{gizmoId:e,clientThreadId:t})]}),n.jsx(Xl,{children:n.jsxs("div",{className:"flex items-center gap-0 overflow-hidden",children:[n.jsx(Ml,{clientThreadId:t}),n.jsx(bl,{clientThreadId:t})]})}),n.jsx(ec,{clientThreadId:t})]}),s&&n.jsx(ui,{})]})}function Ya({clientThreadId:t}){const e=ct(t);return Ls()?null:n.jsx(tc,{gizmoId:e,clientThreadId:t})}function sc({clientThreadId:t,currentModelId:e,onRequestCompletion:s,enableV2Homepage:a}){const o=St();let i=n.jsx(fl,{}),l;return o?(l=n.jsx(nc,{}),i=n.jsx(pi,{className:"mb-6 h-12 w-12"})):t!=null?(l=a?n.jsx(Bl,{clientThreadId:t,currentModelId:e,onRequestCompletion:s}):n.jsx(_r,{clientThreadId:t}),i=null):l=n.jsx(ac,{}),n.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-token-text-primary",children:[i,l]})}function nc({gizmo:t}){const e=ka(),s=t?Qr(t.tools):!1,a=Ot();return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"mb-5 text-2xl font-semibold",children:n.jsx(E,{...ft.temporaryChat})}),n.jsxs("div",{className:"max-w-sm text-center text-sm font-normal text-token-text-tertiary",children:[n.jsx(E,{...a!=null&&a.isWorkspaceAccount()?e?ft.temporaryChatBizMemoryAvailable:ft.temporaryChatBizMemoryUnavailable:e?ft.temporaryChatDescriptionMemoryAvailable:ft.temporaryChatDescriptionMemoryUnavailable}),s&&n.jsx("div",{className:"mt-3",children:n.jsx(E,{...ft.temporaryChatDescriptionGptActions,values:{link:o=>n.jsx("a",{href:"https://help.openai.com/en/articles/8914046-temporary-chat-faq",target:"_blank",className:"underline",rel:"noreferrer",children:o})}})})]})]})}function ac(){return n.jsx("div",{className:"mb-5 text-2xl font-semibold",children:n.jsx(E,{...ft.howCanIHelpYouToday})})}function oc({clientThreadId:t,currentModelId:e,onRequestCompletion:s,enableV2Homepage:a}){const o=ct(t),i=gi(),l=ya(),{data:d}=is(o),c=fi(),m=po(()=>navigator.windowControlsOverlay);return(i!=null||o!=null)&&d==null?null:n.jsxs("div",{className:"relative h-full",children:[n.jsx("div",{className:m!=null&&m.visible?se("absolute right-[calc(100dvw-env(titlebar-area-width,100dvw)-env(titlebar-area-x,0))]",c?"left-[env(titlebar-area-x,0)]":"left-0"):"absolute left-0 right-0",children:n.jsx(Ya,{clientThreadId:t})}),d!=null?n.jsx(gl,{gizmo:d,showStarterPrompts:!0,disableStarterPrompts:l}):n.jsx(sc,{clientThreadId:t,currentModelId:e,onRequestCompletion:s,enableV2Homepage:a})]})}const ft=Ae({temporaryChat:{id:"GizmoLanding.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatBizMemoryAvailable:{id:"g1opBW",defaultMessage:"This chat won't appear in your history and won't use or create memories."},temporaryChatBizMemoryUnavailable:{id:"fQmbtG",defaultMessage:"This chat won't appear your conversation history."},temporaryChatDescriptionMemoryAvailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryAvailable",defaultMessage:"This chat won't appear in history, use or create memories, or be used to train our models. For safety purposes, we may keep a copy for up to 30 days."},temporaryChatDescriptionMemoryUnavailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryUnavailable",defaultMessage:"This chat won't appear in history or be used to train our models. For safety purposes, we may keep a copy of this chat for up to 30 days."},temporaryChatDescriptionGptActions:{id:"GizmoLanding.temporaryChatDescriptionGptActions",defaultMessage:"Any data shared with a third party through GPT actions are subject to the third party's privacy policy. <link>Learn more</link>"},howCanIHelpYouToday:{id:"GizmoLanding.howCanIHelpYouToday",defaultMessage:"How can I help you today?"}});function Qa(t){const s=Os(t)==="root",a=Rr(t),o=ss(a),{serviceStatus:i}=u.useContext(bo),l=ks(),{isUnauthenticated:d}=zt();return!s&&!o&&!(i!=null&&i.oof)&&!l.displayingSideBySideFeedback&&!d}const Ja=({clientThreadId:t,message:e})=>{var g,b,h,y,w,v,k,R;const s=xl(),a=Aa(Na.ModelSwitcherAutoDowngrade),{categories:o}=On({isRegen:!0}),i=yl({clientThreadId:t}),{doesUserHaveAnyAccountsWithPlusFeatures:l}=os(),d=kl()!=null,c=[];for(const j of o){if(Ia(j))continue;const{defaultModel:W,label:T,tagline:I,categoryId:P,subscriptionLevel:D}=j,U=(b=(g=i[W])==null?void 0:g.regenerate)==null?void 0:b[0];c.push({label:T,value:W,subtitle:I,icon:n.jsx($a,{className:"icon-md h-4 w-4",categoryId:P,type:"filled"}),modelSwitcherDeny:U,subscriptionLevel:D})}const m=ic(t,e.nodeId),p=(h=e.message.metadata)==null?void 0:h.model_slug,f=(y=s.find(j=>j.value===p))==null?void 0:y.name,S=rc(d,m,p),C=(w=e.message.metadata)==null?void 0:w.model_adjustments,x=l&&a.eligible&&!a.isLoading&&f&&((v=c[0])==null?void 0:v.label)&&f!==((k=c[0])==null?void 0:k.label)&&(C==null?void 0:C.some(j=>j.startsWith("auto:smaller_model")));return{modelOptions:c,modelSlug:p,animateModelLabelOnRender:S,nuxProps:{shouldRenderNux:x,usedModelName:f,largestModelName:(R=c[0])==null?void 0:R.label,announcement:a}}};function ic(t,e){var l,d;return(d=(l=B.getTree(t).getConversationTurns(e).flatMap(c=>c.messages).filter(c=>c.message.author.role===ve.Assistant&&!xo(c.message)).reverse()[1])==null?void 0:l.message.metadata)==null?void 0:d.model_slug}function rc(t,e,s){return t&&!e?!0:!!(e&&s!==e)}function lc(){const{doesUserHaveAnyAccountsWithPlusFeatures:t}=os(),{categories:e}=On();return!!t||!!e.find(Ia)}const vn=({modelSwitcherDeny:t,value:e,label:s,subtitle:a,icon:o,onMouseEnter:i,onMouseLeave:l,onSelect:d,messageModelSlug:c,isHovered:m=!1,shouldShowUpsell:p=!1,className:f,includeCheck:S,includeRegenerate:C})=>{const x=Ot(),g=!t,b=!g&&!p,h=yo(),y=()=>{if(!p){d==null||d();return}Z.logEvent(q.openModalAccountPaymentfromMessageModelPicker),Z.logRateLimitGetPlusButtonClicked({type:En.RATE_LIMIT,location:"message_model_switcher_dropdown",plan_type:(x==null?void 0:x.planType)??"unknown",is_hard_block:!1,hard_block_reason:"",is_new_conversation:!1}),xi(h,"Message model switcher dropdown")};return n.jsx(xt.Item,{onSelect:y,onMouseEnter:()=>g&&(i==null?void 0:i()),onMouseLeave:()=>g&&(l==null?void 0:l()),disabled:b,className:f??"radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed radix-disabled:hover:bg-transparent",children:n.jsxs(Rs,{label:t&&n.jsx(bi,{modelSwitcherDeny:t}),className:"flex w-full items-center justify-between gap-2",sideOffset:0,children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("span",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-token-main-surface-secondary",children:o}),n.jsxs("div",{children:[n.jsx("div",{children:s}),n.jsx("div",{className:se({"text-sm text-token-text-secondary":!b},{"text-sm text-token-text-quaternary":b}),children:a})]})]}),p?n.jsx(at,{color:"secondary",size:"small",children:n.jsx(E,{id:"54fmrA",defaultMessage:"Get Plus"})}):n.jsx(cc,{messageModelSlug:c,isHovered:m,modelSwitcherDeny:t,optionModelSlug:e,includeCheck:S,includeRegenerate:C})]})})},cc=({modelSwitcherDeny:t,optionModelSlug:e,isHovered:s,messageModelSlug:a,includeRegenerate:o=!0,includeCheck:i=!0})=>{let l=null;if(t)switch(t.reason){case En.RATE_LIMIT:l=el;break;default:l=As;break}if(t)return n.jsx(l,{className:"icon-md"});const d=!!o&&n.jsx(Us,{className:se("icon-md hidden text-token-text-tertiary",{"group-hover:block":s})});return a===e&&i?n.jsxs(n.Fragment,{children:[n.jsx(Zr,{className:se("icon-md text-token-text-primary",{"group-hover:hidden":s})}),d]}):d};function dc({className:t,clientThreadId:e,message:s,onModelSelect:a,onDropdownChange:o}){const[i,l]=u.useState(null),[d,c]=u.useState(!1),[m,p]=u.useState(!1),f=lc(),S=Qa(e),C=ct(e),x=Ja({clientThreadId:e,message:s}),{doesUserHaveAnyAccountsWithPlusFeatures:g}=os(),b=u.useRef(null),h=T=>{T||setTimeout(()=>{b.current&&b.current.blur()},10)};if(u.useEffect(()=>{h(d)},[d]),!f||C)return null;const{modelOptions:y,modelSlug:w,animateModelLabelOnRender:v,nuxProps:k}=x;let R,j;k.shouldRenderNux?(R=hc,j={title:n.jsx(E,{id:"g/+2Hh",defaultMessage:"Optimized your response"}),description:n.jsx(E,{id:"H0Flqm",defaultMessage:"Used {usedModelName} for a faster response that saves your limited {largestModelName} messages",values:{usedModelName:k.usedModelName,largestModelName:k.largestModelName}}),markAsViewed:k.announcement.markAsViewed}):(R=uc,j={label:S?n.jsx(E,{id:"LBYK9a",defaultMessage:"Change model"}):n.jsx(E,{id:"nygjPN",defaultMessage:"Used {modelName}",values:{modelName:k.usedModelName}})});const W=S&&y.some(T=>Cn(T,g));return n.jsxs(xt.Root,{onOpenChange:T=>{S&&(c(T),o(T),h(T)),T&&Z.logEvent(q.conversationOpenMessageModelSelector,{has_get_plus_button:W})},children:[n.jsx(R,{...j,children:n.jsx(Ka,{ref:b,className:se("cursor-pointer",t),onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),children:n.jsx(Sn,{modelSlug:w,animateModelLabelOnRender:v,isDropdownOpen:d,isRegenerateEnabled:S,isHovered:m})})}),S&&n.jsx(xt.Content,{className:"z-30 origin-top-right text-token-text-primary",side:"bottom",align:"start",children:y.map(T=>{var U;const I=Cn(T,g),{value:P,...D}=T;return n.jsx(vn,{value:P,onSelect:()=>a(P),onMouseEnter:()=>l(P),onMouseLeave:()=>l(null),isHovered:i===P,messageModelSlug:(U=s.message.metadata)==null?void 0:U.model_slug,shouldShowUpsell:I,...D},P)})})]})}function Sn({modelSlug:t,animateModelLabelOnRender:e,isDropdownOpen:s,isRegenerateEnabled:a,isHovered:o,isRegenLabel:i=!1,animateShortLabel:l}){const[d,c]=u.useState("initial"),{categories:m}=On({isRegen:!!i});u.useEffect(()=>{if(e){const b=setTimeout(()=>c("show"),500),h=setTimeout(()=>c("initial"),2e3);return()=>{clearTimeout(b),clearTimeout(h)}}c("initial")},[e]);const p=m.find(({defaultModel:b})=>b===t),f=t===Tl?{categoryId:"gpt_3.5",shorterLabel:"3.5"}:{},{categoryId:S,shorterLabel:C}=p??f,x={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},g=s?"visible":o?"show":d;return n.jsxs(Lt.div,{initial:"initial",animate:g,className:"flex items-center pb-0",children:[i?n.jsx(Us,{className:"icon-md"}):S&&n.jsx($a,{type:"outline",categoryId:S,className:"icon-md h-4 w-4"}),(a||l)&&n.jsx(Lt.span,{className:"overflow-hidden text-clip whitespace-nowrap text-sm",variants:x,transition:{type:"tween",duration:.18},children:C}),a&&n.jsx(tl,{className:se("icon-sm",{"text-token-text-quaternary":!o&&!i},{"text-token-text-secondary":o&&!i})})]})}function uc({children:t,label:e}){return n.jsx(Rs,{label:e,sideOffset:0,children:t})}function hc({children:t,title:e,description:s,markAsViewed:a}){return n.jsx(Ea,{show:!0,side:"bottom",sideOffset:-4,title:e,description:s,badge:"beta",onDismiss:a,dismissOnOutsideClick:!0,children:t})}function Cn(t,e){const{modelSwitcherDeny:s,subscriptionLevel:a}=t;return!!s&&s.reason===En.RATE_LIMIT&&a===vo.PLUS&&!e}const mc=u.memo(dc),sa=So.IndepthFeedbackDismissedAt;function gc(){const[t,e]=u.useState(()=>{const a=localStorage.getItem(sa);return a?fc(new Date(a)):!1}),s=u.useCallback(()=>{e(!0),localStorage.setItem(sa,new Date().toISOString())},[]);return[t,s]}function fc(t){const e=new Date;return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}function pc({clientThreadId:t,conversationLeafId:e,trigger:s,variantIds:a}){const o=a.find(p=>p!==e),i=rs(p=>p.forceIndepthFeedback&&p.forceIndepthFeedbackPrompt),l=ot.getExperimentValue({experimentName:"4146182738",key:s==="paragen"?"enable_indepth_feedback_paragen":"enable_indepth_feedback_thumbsdown",defaultValue:!1,shouldLogExposure:!1}),d=ot.getExperimentValue({experimentName:"4146182738",key:s==="paragen"?"indepth_feedback_paragen_prompt":"indepth_feedback_thumbsdown_prompt",defaultValue:"",shouldLogExposure:!1}),c=o?B.getTree(t).getTextFromNode(o):"NONE";return(i||(l?d:"")).replace("{paragen_losing_response}",c)}function bc({clientThreadId:t,conversationLeafId:e,trigger:s,variantIds:a}){const[o,i]=gc(),l=yc({clientThreadId:t}),d=pc({clientThreadId:t,conversationLeafId:e,trigger:s,variantIds:a}),c=()=>{i(),Z.logEventWithStatsig(q.messageIndepthFeedbackDeclined,"chatgpt_indepth_feedback_declined",{trigger:s})},m=()=>{const p=new fn;l(e,{intent:"indepth_feedback"},d,p),Z.logEventWithStatsig(q.messageIndepthFeedbackAccepted,"chatgpt_indepth_feedback_accepted",{trigger:s})};return o||!d?null:n.jsx(vi,{content:n.jsx(E,{...mn.indepthFeedbackPrompt}),primaryCtaText:n.jsx(E,{...mn.indepthFeedbackAcceptButton}),onPrimaryCtaClick:m,secondaryCtaText:n.jsx(E,{...mn.indepthFeedbackRejectButton}),onSecondaryCtaClick:c})}function xc(t){const e=t.rating==="thumbsDown"?"thumbsDown":yi(["original","new"],t.inlineComparisonRating)?"paragen":void 0,s=rs(o=>o.forceIndepthFeedback);if(!e||s||e==="paragen"||ot.getExperimentValue({experimentName:"4146182738",key:"enable_indepth_feedback_thumbsdown",defaultValue:!1,shouldLogExposure:!0}))return e}function yc({clientThreadId:t}){const e=u.useContext(Sa),s=ls.getConversationMode(t);return(o,i,l,d)=>{e({type:Ca.Next,promptId:o,eventMetadata:i,focusOnNewCompletion:!0,cancelActiveRequests:!1,completionMetadata:{conversationMode:s},useDefaultModel:!1,appendMessages:[{id:Is(),author:{role:ve.System},content:{content_type:lt.Text,parts:[l]},metadata:{is_indepth_feedback:!0,indepth_feedback_prompt:l}}],turnTracker:d})}}const mn=Ae({indepthFeedbackPrompt:{id:"qEHwDx",defaultMessage:"Would you like to tell ChatGPT more about your feedback, so it can improve its responses?"},indepthFeedbackAcceptButton:{id:"IeyTQ7",defaultMessage:"Continue"},indepthFeedbackRejectButton:{id:"+o5xmp",defaultMessage:"Not now"},indepthFeedbackRejectAlwaysButton:{id:"Qdko+f",defaultMessage:"Don't ask again"}});function vc({clientThreadId:t,conversationMode:e}){const s=Tr(t);return(o,i,l,d,c,m)=>{const f=B.getTree(t).getConversationTurns(o),S=f==null?void 0:f[(f==null?void 0:f.length)-1].variantIds,C=(S==null?void 0:S.length)===1,x=C?{...i,intent:"comparison_implicit"}:i;s({id:o,requestedModelId:d,eventMetadata:x,focusOnNewCompletion:!0,variantPurpose:C?"comparison_implicit":"none",conversationMode:e??ls.getConversationMode(t),useDefaultModel:!1,appendMessages:c?[{id:Is(),author:{role:ve.System},content:{content_type:lt.Text,parts:[c]},metadata:{exclude_after_next_user_message:!0}}]:void 0,juice:m,turnTracker:l})}}const It=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,Xa=new Set,wn=typeof process=="object"&&process?process:{},Za=(t,e,s,a)=>{typeof wn.emitWarning=="function"?wn.emitWarning(t,e,s,a):console.error(`[${s}] ${e}: ${t}`)};let Ns=globalThis.AbortController,na=globalThis.AbortSignal;var pa;if(typeof Ns>"u"){na=class{constructor(){Y(this,"onabort");Y(this,"_onabort",[]);Y(this,"reason");Y(this,"aborted",!1)}addEventListener(a,o){this._onabort.push(o)}},Ns=class{constructor(){Y(this,"signal",new na);e()}abort(a){var o,i;if(!this.signal.aborted){this.signal.reason=a,this.signal.aborted=!0;for(const l of this.signal._onabort)l(a);(i=(o=this.signal).onabort)==null||i.call(o,a)}}};let t=((pa=wn.env)==null?void 0:pa.LRU_CACHE_IGNORE_AC_WARNING)!=="1";const e=()=>{t&&(t=!1,Za("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}const Sc=t=>!Xa.has(t),et=t=>t&&t===Math.floor(t)&&t>0&&isFinite(t),eo=t=>et(t)?t<=Math.pow(2,8)?Uint8Array:t<=Math.pow(2,16)?Uint16Array:t<=Math.pow(2,32)?Uint32Array:t<=Number.MAX_SAFE_INTEGER?Ss:null:null;class Ss extends Array{constructor(e){super(e),this.fill(0)}}var Pt;const pt=class pt{constructor(e,s){Y(this,"heap");Y(this,"length");if(!r(pt,Pt))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new s(e),this.length=0}static create(e){const s=eo(e);if(!s)return[];A(pt,Pt,!0);const a=new pt(e,s);return A(pt,Pt,!1),a}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}};Pt=new WeakMap,G(pt,Pt,!1);let Mn=pt;var ba,xa,Fe,we,Pe,Re,Rt,ae,De,te,K,F,xe,Me,pe,re,Le,le,Oe,ze,_e,Be,nt,ye,M,kn,yt,Ye,ns,ke,to,vt,Dt,as,tt,st,Tn,Cs,ws,$,jn,Jt;const Un=class Un{constructor(e){G(this,M);G(this,Fe);G(this,we);G(this,Pe);G(this,Re);G(this,Rt);Y(this,"ttl");Y(this,"ttlResolution");Y(this,"ttlAutopurge");Y(this,"updateAgeOnGet");Y(this,"updateAgeOnHas");Y(this,"allowStale");Y(this,"noDisposeOnSet");Y(this,"noUpdateTTL");Y(this,"maxEntrySize");Y(this,"sizeCalculation");Y(this,"noDeleteOnFetchRejection");Y(this,"noDeleteOnStaleGet");Y(this,"allowStaleOnFetchAbort");Y(this,"allowStaleOnFetchRejection");Y(this,"ignoreFetchAbort");G(this,ae);G(this,De);G(this,te);G(this,K);G(this,F);G(this,xe);G(this,Me);G(this,pe);G(this,re);G(this,Le);G(this,le);G(this,Oe);G(this,ze);G(this,_e);G(this,Be);G(this,nt);G(this,ye);G(this,yt,()=>{});G(this,Ye,()=>{});G(this,ns,()=>{});G(this,ke,()=>!1);G(this,vt,e=>{});G(this,Dt,(e,s,a)=>{});G(this,as,(e,s,a,o)=>{if(a||o)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0});Y(this,ba,"LRUCache");const{max:s=0,ttl:a,ttlResolution:o=1,ttlAutopurge:i,updateAgeOnGet:l,updateAgeOnHas:d,allowStale:c,dispose:m,disposeAfter:p,noDisposeOnSet:f,noUpdateTTL:S,maxSize:C=0,maxEntrySize:x=0,sizeCalculation:g,fetchMethod:b,noDeleteOnFetchRejection:h,noDeleteOnStaleGet:y,allowStaleOnFetchRejection:w,allowStaleOnFetchAbort:v,ignoreFetchAbort:k}=e;if(s!==0&&!et(s))throw new TypeError("max option must be a nonnegative integer");const R=s?eo(s):Array;if(!R)throw new Error("invalid max value: "+s);if(A(this,Fe,s),A(this,we,C),this.maxEntrySize=x||r(this,we),this.sizeCalculation=g,this.sizeCalculation){if(!r(this,we)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(b!==void 0&&typeof b!="function")throw new TypeError("fetchMethod must be a function if specified");if(A(this,Rt,b),A(this,nt,!!b),A(this,te,new Map),A(this,K,new Array(s).fill(void 0)),A(this,F,new Array(s).fill(void 0)),A(this,xe,new R(s)),A(this,Me,new R(s)),A(this,pe,0),A(this,re,0),A(this,Le,Mn.create(s)),A(this,ae,0),A(this,De,0),typeof m=="function"&&A(this,Pe,m),typeof p=="function"?(A(this,Re,p),A(this,le,[])):(A(this,Re,void 0),A(this,le,void 0)),A(this,Be,!!r(this,Pe)),A(this,ye,!!r(this,Re)),this.noDisposeOnSet=!!f,this.noUpdateTTL=!!S,this.noDeleteOnFetchRejection=!!h,this.allowStaleOnFetchRejection=!!w,this.allowStaleOnFetchAbort=!!v,this.ignoreFetchAbort=!!k,this.maxEntrySize!==0){if(r(this,we)!==0&&!et(r(this,we)))throw new TypeError("maxSize must be a positive integer if specified");if(!et(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");_(this,M,to).call(this)}if(this.allowStale=!!c,this.noDeleteOnStaleGet=!!y,this.updateAgeOnGet=!!l,this.updateAgeOnHas=!!d,this.ttlResolution=et(o)||o===0?o:1,this.ttlAutopurge=!!i,this.ttl=a||0,this.ttl){if(!et(this.ttl))throw new TypeError("ttl must be a positive integer if specified");_(this,M,kn).call(this)}if(r(this,Fe)===0&&this.ttl===0&&r(this,we)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!r(this,Fe)&&!r(this,we)){const j="LRU_CACHE_UNBOUNDED";Sc(j)&&(Xa.add(j),Za("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",j,Un))}}static unsafeExposeInternals(e){return{starts:r(e,ze),ttls:r(e,_e),sizes:r(e,Oe),keyMap:r(e,te),keyList:r(e,K),valList:r(e,F),next:r(e,xe),prev:r(e,Me),get head(){return r(e,pe)},get tail(){return r(e,re)},free:r(e,Le),isBackgroundFetch:s=>{var a;return _(a=e,M,$).call(a,s)},backgroundFetch:(s,a,o,i)=>{var l;return _(l=e,M,ws).call(l,s,a,o,i)},moveToTail:s=>{var a;return _(a=e,M,Jt).call(a,s)},indexes:s=>{var a;return _(a=e,M,tt).call(a,s)},rindexes:s=>{var a;return _(a=e,M,st).call(a,s)},isStale:s=>{var a;return r(a=e,ke).call(a,s)}}}get max(){return r(this,Fe)}get maxSize(){return r(this,we)}get calculatedSize(){return r(this,De)}get size(){return r(this,ae)}get fetchMethod(){return r(this,Rt)}get dispose(){return r(this,Pe)}get disposeAfter(){return r(this,Re)}getRemainingTTL(e){return r(this,te).has(e)?1/0:0}*entries(){for(const e of _(this,M,tt).call(this))r(this,F)[e]!==void 0&&r(this,K)[e]!==void 0&&!_(this,M,$).call(this,r(this,F)[e])&&(yield[r(this,K)[e],r(this,F)[e]])}*rentries(){for(const e of _(this,M,st).call(this))r(this,F)[e]!==void 0&&r(this,K)[e]!==void 0&&!_(this,M,$).call(this,r(this,F)[e])&&(yield[r(this,K)[e],r(this,F)[e]])}*keys(){for(const e of _(this,M,tt).call(this)){const s=r(this,K)[e];s!==void 0&&!_(this,M,$).call(this,r(this,F)[e])&&(yield s)}}*rkeys(){for(const e of _(this,M,st).call(this)){const s=r(this,K)[e];s!==void 0&&!_(this,M,$).call(this,r(this,F)[e])&&(yield s)}}*values(){for(const e of _(this,M,tt).call(this))r(this,F)[e]!==void 0&&!_(this,M,$).call(this,r(this,F)[e])&&(yield r(this,F)[e])}*rvalues(){for(const e of _(this,M,st).call(this))r(this,F)[e]!==void 0&&!_(this,M,$).call(this,r(this,F)[e])&&(yield r(this,F)[e])}[(xa=Symbol.iterator,ba=Symbol.toStringTag,xa)](){return this.entries()}find(e,s={}){for(const a of _(this,M,tt).call(this)){const o=r(this,F)[a],i=_(this,M,$).call(this,o)?o.__staleWhileFetching:o;if(i!==void 0&&e(i,r(this,K)[a],this))return this.get(r(this,K)[a],s)}}forEach(e,s=this){for(const a of _(this,M,tt).call(this)){const o=r(this,F)[a],i=_(this,M,$).call(this,o)?o.__staleWhileFetching:o;i!==void 0&&e.call(s,i,r(this,K)[a],this)}}rforEach(e,s=this){for(const a of _(this,M,st).call(this)){const o=r(this,F)[a],i=_(this,M,$).call(this,o)?o.__staleWhileFetching:o;i!==void 0&&e.call(s,i,r(this,K)[a],this)}}purgeStale(){let e=!1;for(const s of _(this,M,st).call(this,{allowStale:!0}))r(this,ke).call(this,s)&&(this.delete(r(this,K)[s]),e=!0);return e}info(e){const s=r(this,te).get(e);if(s===void 0)return;const a=r(this,F)[s],o=_(this,M,$).call(this,a)?a.__staleWhileFetching:a;if(o===void 0)return;const i={value:o};if(r(this,_e)&&r(this,ze)){const l=r(this,_e)[s],d=r(this,ze)[s];if(l&&d){const c=l-(It.now()-d);i.ttl=c,i.start=Date.now()}}return r(this,Oe)&&(i.size=r(this,Oe)[s]),i}dump(){const e=[];for(const s of _(this,M,tt).call(this,{allowStale:!0})){const a=r(this,K)[s],o=r(this,F)[s],i=_(this,M,$).call(this,o)?o.__staleWhileFetching:o;if(i===void 0||a===void 0)continue;const l={value:i};if(r(this,_e)&&r(this,ze)){l.ttl=r(this,_e)[s];const d=It.now()-r(this,ze)[s];l.start=Math.floor(Date.now()-d)}r(this,Oe)&&(l.size=r(this,Oe)[s]),e.unshift([a,l])}return e}load(e){this.clear();for(const[s,a]of e){if(a.start){const o=Date.now()-a.start;a.start=It.now()-o}this.set(s,a.value,a)}}set(e,s,a={}){var S,C,x,g,b;if(s===void 0)return this.delete(e),this;const{ttl:o=this.ttl,start:i,noDisposeOnSet:l=this.noDisposeOnSet,sizeCalculation:d=this.sizeCalculation,status:c}=a;let{noUpdateTTL:m=this.noUpdateTTL}=a;const p=r(this,as).call(this,e,s,a.size||0,d);if(this.maxEntrySize&&p>this.maxEntrySize)return c&&(c.set="miss",c.maxEntrySizeExceeded=!0),this.delete(e),this;let f=r(this,ae)===0?void 0:r(this,te).get(e);if(f===void 0)f=r(this,ae)===0?r(this,re):r(this,Le).length!==0?r(this,Le).pop():r(this,ae)===r(this,Fe)?_(this,M,Cs).call(this,!1):r(this,ae),r(this,K)[f]=e,r(this,F)[f]=s,r(this,te).set(e,f),r(this,xe)[r(this,re)]=f,r(this,Me)[f]=r(this,re),A(this,re,f),bs(this,ae)._++,r(this,Dt).call(this,f,p,c),c&&(c.set="add"),m=!1;else{_(this,M,Jt).call(this,f);const h=r(this,F)[f];if(s!==h){if(r(this,nt)&&_(this,M,$).call(this,h)){h.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:y}=h;y!==void 0&&!l&&(r(this,Be)&&((S=r(this,Pe))==null||S.call(this,y,e,"set")),r(this,ye)&&((C=r(this,le))==null||C.push([y,e,"set"])))}else l||(r(this,Be)&&((x=r(this,Pe))==null||x.call(this,h,e,"set")),r(this,ye)&&((g=r(this,le))==null||g.push([h,e,"set"])));if(r(this,vt).call(this,f),r(this,Dt).call(this,f,p,c),r(this,F)[f]=s,c){c.set="replace";const y=h&&_(this,M,$).call(this,h)?h.__staleWhileFetching:h;y!==void 0&&(c.oldValue=y)}}else c&&(c.set="update")}if(o!==0&&!r(this,_e)&&_(this,M,kn).call(this),r(this,_e)&&(m||r(this,ns).call(this,f,o,i),c&&r(this,Ye).call(this,c,f)),!l&&r(this,ye)&&r(this,le)){const h=r(this,le);let y;for(;y=h==null?void 0:h.shift();)(b=r(this,Re))==null||b.call(this,...y)}return this}pop(){var e;try{for(;r(this,ae);){const s=r(this,F)[r(this,pe)];if(_(this,M,Cs).call(this,!0),_(this,M,$).call(this,s)){if(s.__staleWhileFetching)return s.__staleWhileFetching}else if(s!==void 0)return s}}finally{if(r(this,ye)&&r(this,le)){const s=r(this,le);let a;for(;a=s==null?void 0:s.shift();)(e=r(this,Re))==null||e.call(this,...a)}}}has(e,s={}){const{updateAgeOnHas:a=this.updateAgeOnHas,status:o}=s,i=r(this,te).get(e);if(i!==void 0){const l=r(this,F)[i];if(_(this,M,$).call(this,l)&&l.__staleWhileFetching===void 0)return!1;if(r(this,ke).call(this,i))o&&(o.has="stale",r(this,Ye).call(this,o,i));else return a&&r(this,yt).call(this,i),o&&(o.has="hit",r(this,Ye).call(this,o,i)),!0}else o&&(o.has="miss");return!1}peek(e,s={}){const{allowStale:a=this.allowStale}=s,o=r(this,te).get(e);if(o===void 0||!a&&r(this,ke).call(this,o))return;const i=r(this,F)[o];return _(this,M,$).call(this,i)?i.__staleWhileFetching:i}async fetch(e,s={}){const{allowStale:a=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,ttl:l=this.ttl,noDisposeOnSet:d=this.noDisposeOnSet,size:c=0,sizeCalculation:m=this.sizeCalculation,noUpdateTTL:p=this.noUpdateTTL,noDeleteOnFetchRejection:f=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:S=this.allowStaleOnFetchRejection,ignoreFetchAbort:C=this.ignoreFetchAbort,allowStaleOnFetchAbort:x=this.allowStaleOnFetchAbort,context:g,forceRefresh:b=!1,status:h,signal:y}=s;if(!r(this,nt))return h&&(h.fetch="get"),this.get(e,{allowStale:a,updateAgeOnGet:o,noDeleteOnStaleGet:i,status:h});const w={allowStale:a,updateAgeOnGet:o,noDeleteOnStaleGet:i,ttl:l,noDisposeOnSet:d,size:c,sizeCalculation:m,noUpdateTTL:p,noDeleteOnFetchRejection:f,allowStaleOnFetchRejection:S,allowStaleOnFetchAbort:x,ignoreFetchAbort:C,status:h,signal:y};let v=r(this,te).get(e);if(v===void 0){h&&(h.fetch="miss");const k=_(this,M,ws).call(this,e,v,w,g);return k.__returned=k}else{const k=r(this,F)[v];if(_(this,M,$).call(this,k)){const I=a&&k.__staleWhileFetching!==void 0;return h&&(h.fetch="inflight",I&&(h.returnedStale=!0)),I?k.__staleWhileFetching:k.__returned=k}const R=r(this,ke).call(this,v);if(!b&&!R)return h&&(h.fetch="hit"),_(this,M,Jt).call(this,v),o&&r(this,yt).call(this,v),h&&r(this,Ye).call(this,h,v),k;const j=_(this,M,ws).call(this,e,v,w,g),T=j.__staleWhileFetching!==void 0&&a;return h&&(h.fetch=R?"stale":"refresh",T&&R&&(h.returnedStale=!0)),T?j.__staleWhileFetching:j.__returned=j}}get(e,s={}){const{allowStale:a=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,status:l}=s,d=r(this,te).get(e);if(d!==void 0){const c=r(this,F)[d],m=_(this,M,$).call(this,c);return l&&r(this,Ye).call(this,l,d),r(this,ke).call(this,d)?(l&&(l.get="stale"),m?(l&&a&&c.__staleWhileFetching!==void 0&&(l.returnedStale=!0),a?c.__staleWhileFetching:void 0):(i||this.delete(e),l&&a&&(l.returnedStale=!0),a?c:void 0)):(l&&(l.get="hit"),m?c.__staleWhileFetching:(_(this,M,Jt).call(this,d),o&&r(this,yt).call(this,d),c))}else l&&(l.get="miss")}delete(e){var a,o,i,l;let s=!1;if(r(this,ae)!==0){const d=r(this,te).get(e);if(d!==void 0)if(s=!0,r(this,ae)===1)this.clear();else{r(this,vt).call(this,d);const c=r(this,F)[d];if(_(this,M,$).call(this,c)?c.__abortController.abort(new Error("deleted")):(r(this,Be)||r(this,ye))&&(r(this,Be)&&((a=r(this,Pe))==null||a.call(this,c,e,"delete")),r(this,ye)&&((o=r(this,le))==null||o.push([c,e,"delete"]))),r(this,te).delete(e),r(this,K)[d]=void 0,r(this,F)[d]=void 0,d===r(this,re))A(this,re,r(this,Me)[d]);else if(d===r(this,pe))A(this,pe,r(this,xe)[d]);else{const m=r(this,Me)[d];r(this,xe)[m]=r(this,xe)[d];const p=r(this,xe)[d];r(this,Me)[p]=r(this,Me)[d]}bs(this,ae)._--,r(this,Le).push(d)}}if(r(this,ye)&&((i=r(this,le))!=null&&i.length)){const d=r(this,le);let c;for(;c=d==null?void 0:d.shift();)(l=r(this,Re))==null||l.call(this,...c)}return s}clear(){var e,s,a;for(const o of _(this,M,st).call(this,{allowStale:!0})){const i=r(this,F)[o];if(_(this,M,$).call(this,i))i.__abortController.abort(new Error("deleted"));else{const l=r(this,K)[o];r(this,Be)&&((e=r(this,Pe))==null||e.call(this,i,l,"delete")),r(this,ye)&&((s=r(this,le))==null||s.push([i,l,"delete"]))}}if(r(this,te).clear(),r(this,F).fill(void 0),r(this,K).fill(void 0),r(this,_e)&&r(this,ze)&&(r(this,_e).fill(0),r(this,ze).fill(0)),r(this,Oe)&&r(this,Oe).fill(0),A(this,pe,0),A(this,re,0),r(this,Le).length=0,A(this,De,0),A(this,ae,0),r(this,ye)&&r(this,le)){const o=r(this,le);let i;for(;i=o==null?void 0:o.shift();)(a=r(this,Re))==null||a.call(this,...i)}}};Fe=new WeakMap,we=new WeakMap,Pe=new WeakMap,Re=new WeakMap,Rt=new WeakMap,ae=new WeakMap,De=new WeakMap,te=new WeakMap,K=new WeakMap,F=new WeakMap,xe=new WeakMap,Me=new WeakMap,pe=new WeakMap,re=new WeakMap,Le=new WeakMap,le=new WeakMap,Oe=new WeakMap,ze=new WeakMap,_e=new WeakMap,Be=new WeakMap,nt=new WeakMap,ye=new WeakMap,M=new WeakSet,kn=function(){const e=new Ss(r(this,Fe)),s=new Ss(r(this,Fe));A(this,_e,e),A(this,ze,s),A(this,ns,(i,l,d=It.now())=>{if(s[i]=l!==0?d:0,e[i]=l,l!==0&&this.ttlAutopurge){const c=setTimeout(()=>{r(this,ke).call(this,i)&&this.delete(r(this,K)[i])},l+1);c.unref&&c.unref()}}),A(this,yt,i=>{s[i]=e[i]!==0?It.now():0}),A(this,Ye,(i,l)=>{if(e[l]){const d=e[l],c=s[l];if(!d||!c)return;i.ttl=d,i.start=c,i.now=a||o();const m=i.now-c;i.remainingTTL=d-m}});let a=0;const o=()=>{const i=It.now();if(this.ttlResolution>0){a=i;const l=setTimeout(()=>a=0,this.ttlResolution);l.unref&&l.unref()}return i};this.getRemainingTTL=i=>{const l=r(this,te).get(i);if(l===void 0)return 0;const d=e[l],c=s[l];if(!d||!c)return 1/0;const m=(a||o())-c;return d-m},A(this,ke,i=>{const l=s[i],d=e[i];return!!d&&!!l&&(a||o())-l>d})},yt=new WeakMap,Ye=new WeakMap,ns=new WeakMap,ke=new WeakMap,to=function(){const e=new Ss(r(this,Fe));A(this,De,0),A(this,Oe,e),A(this,vt,s=>{A(this,De,r(this,De)-e[s]),e[s]=0}),A(this,as,(s,a,o,i)=>{if(_(this,M,$).call(this,a))return 0;if(!et(o))if(i){if(typeof i!="function")throw new TypeError("sizeCalculation must be a function");if(o=i(a,s),!et(o))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return o}),A(this,Dt,(s,a,o)=>{if(e[s]=a,r(this,we)){const i=r(this,we)-e[s];for(;r(this,De)>i;)_(this,M,Cs).call(this,!0)}A(this,De,r(this,De)+e[s]),o&&(o.entrySize=a,o.totalCalculatedSize=r(this,De))})},vt=new WeakMap,Dt=new WeakMap,as=new WeakMap,tt=function*({allowStale:e=this.allowStale}={}){if(r(this,ae))for(let s=r(this,re);!(!_(this,M,Tn).call(this,s)||((e||!r(this,ke).call(this,s))&&(yield s),s===r(this,pe)));)s=r(this,Me)[s]},st=function*({allowStale:e=this.allowStale}={}){if(r(this,ae))for(let s=r(this,pe);!(!_(this,M,Tn).call(this,s)||((e||!r(this,ke).call(this,s))&&(yield s),s===r(this,re)));)s=r(this,xe)[s]},Tn=function(e){return e!==void 0&&r(this,te).get(r(this,K)[e])===e},Cs=function(e){var i,l;const s=r(this,pe),a=r(this,K)[s],o=r(this,F)[s];return r(this,nt)&&_(this,M,$).call(this,o)?o.__abortController.abort(new Error("evicted")):(r(this,Be)||r(this,ye))&&(r(this,Be)&&((i=r(this,Pe))==null||i.call(this,o,a,"evict")),r(this,ye)&&((l=r(this,le))==null||l.push([o,a,"evict"]))),r(this,vt).call(this,s),e&&(r(this,K)[s]=void 0,r(this,F)[s]=void 0,r(this,Le).push(s)),r(this,ae)===1?(A(this,pe,A(this,re,0)),r(this,Le).length=0):A(this,pe,r(this,xe)[s]),r(this,te).delete(a),bs(this,ae)._--,s},ws=function(e,s,a,o){const i=s===void 0?void 0:r(this,F)[s];if(_(this,M,$).call(this,i))return i;const l=new Ns,{signal:d}=a;d==null||d.addEventListener("abort",()=>l.abort(d.reason),{signal:l.signal});const c={signal:l.signal,options:a,context:o},m=(g,b=!1)=>{const{aborted:h}=l.signal,y=a.ignoreFetchAbort&&g!==void 0;if(a.status&&(h&&!b?(a.status.fetchAborted=!0,a.status.fetchError=l.signal.reason,y&&(a.status.fetchAbortIgnored=!0)):a.status.fetchResolved=!0),h&&!y&&!b)return f(l.signal.reason);const w=C;return r(this,F)[s]===C&&(g===void 0?w.__staleWhileFetching?r(this,F)[s]=w.__staleWhileFetching:this.delete(e):(a.status&&(a.status.fetchUpdated=!0),this.set(e,g,c.options))),g},p=g=>(a.status&&(a.status.fetchRejected=!0,a.status.fetchError=g),f(g)),f=g=>{const{aborted:b}=l.signal,h=b&&a.allowStaleOnFetchAbort,y=h||a.allowStaleOnFetchRejection,w=y||a.noDeleteOnFetchRejection,v=C;if(r(this,F)[s]===C&&(!w||v.__staleWhileFetching===void 0?this.delete(e):h||(r(this,F)[s]=v.__staleWhileFetching)),y)return a.status&&v.__staleWhileFetching!==void 0&&(a.status.returnedStale=!0),v.__staleWhileFetching;if(v.__returned===v)throw g},S=(g,b)=>{var y;const h=(y=r(this,Rt))==null?void 0:y.call(this,e,i,c);h&&h instanceof Promise&&h.then(w=>g(w===void 0?void 0:w),b),l.signal.addEventListener("abort",()=>{(!a.ignoreFetchAbort||a.allowStaleOnFetchAbort)&&(g(void 0),a.allowStaleOnFetchAbort&&(g=w=>m(w,!0)))})};a.status&&(a.status.fetchDispatched=!0);const C=new Promise(S).then(m,p),x=Object.assign(C,{__abortController:l,__staleWhileFetching:i,__returned:void 0});return s===void 0?(this.set(e,x,{...c.options,status:void 0}),s=r(this,te).get(e)):r(this,F)[s]=x,x},$=function(e){if(!r(this,nt))return!1;const s=e;return!!s&&s instanceof Promise&&s.hasOwnProperty("__staleWhileFetching")&&s.__abortController instanceof Ns},jn=function(e,s){r(this,Me)[s]=e,r(this,xe)[e]=s},Jt=function(e){e!==r(this,re)&&(e===r(this,pe)?A(this,pe,r(this,xe)[e]):_(this,M,jn).call(this,r(this,Me)[e],r(this,xe)[e]),_(this,M,jn).call(this,r(this,re),e),A(this,re,e))};let _n=Un;function Cc({conversationId:t,messageId:e}){const[s,a]=u.useState(!1),o=u.useRef({isMediaSourceAvailable:zn(),mediaSourceFormat:Bn()??"n/a",playPromise:null,shouldAbortQueuedPlayback:!1}).current,i=qe(),{voiceName:l}=Si(),d=`${t}.${e}.${l}`,c=Co(),m=wo(x=>{var g;return x.isPlaying&&x.sourceUrl===((g=je.get(d))==null?void 0:g.src)}),p=u.useCallback(async()=>{if(!c)return;a(!0);const x={isMediaSourceAvailable:o.isMediaSourceAvailable,format:o.mediaSourceFormat};try{const g=await wc({key:d,message_id:e,conversation_id:t,voice:l,onStreamingError:b=>{Zt.readAloud.error(b,x),a(!1),Ft.danger(i.formatMessage(aa.playbackError,{error:b.message}))},onStreamingStart:()=>{a(!1)}});if(o.shouldAbortQueuedPlayback){o.shouldAbortQueuedPlayback=!1;return}c.changeSource(g),o.playPromise=c.play()}catch(g){Zt.readAloud.error(g,x),a(!1),Ft.danger(i.formatMessage(aa.playbackError,{error:g.message}))}},[c,d,e,t,l,o,i]),f=u.useCallback(()=>{const x=Vn();x&&(o.playPromise?o.playPromise.then(()=>{x.stop(),o.playPromise=null}):x.stop())},[o]),S=u.useCallback(()=>{var g;const x=Vn();x&&(x.state.isPlaying&&x.state.sourceUrl===((g=je.get(d))==null?void 0:g.src)?f():(Zt.readAloud.click({isMediaSourceAvailable:o.isMediaSourceAvailable,format:o.mediaSourceFormat}),p()))},[d,o,p,f]);u.useEffect(()=>{s&&m&&a(!1)},[s,m]);const C=u.useRef(d);return u.useEffect(()=>{C.current=d}),u.useEffect(()=>(o.shouldAbortQueuedPlayback=!1,()=>{var b;const x=Mo();x.isPlaying&&x.sourceUrl===((b=je.get(C.current))==null?void 0:b.src)?f():o.shouldAbortQueuedPlayback=!0}),[o,f]),{togglePlayback:S,isPlaying:m,isLoading:s}}async function so({message_id:t,conversation_id:e,voice:s}){const a=await be.synthesize({message_id:t,conversation_id:e,voice:s,format:Bn()}),o=a.headers.get("content-type")??"audio/aac";return{response:a,format:o}}async function wc(t){return zn()?_c(t):Mc(t)}async function Mc({key:t,...e}){const s=je.get(t);if(s!=null&&s.blob)return s.src;const{response:a,format:o}=await so(e),i=await a.arrayBuffer(),l=new Blob([i],{type:o}),d=no({key:t,src:URL.createObjectURL(l),format:o,blob:l});return je.set(t,d),d.src}async function _c({key:t,onStreamingError:e,onStreamingStart:s,...a}){let o=je.get(t);o!=null&&o.streaming&&(je.delete(t),o=void 0);let i,l;const d=Tc(),c=new d;if(o)i=o,i.src=URL.createObjectURL(c);else{const{format:f,response:S}=await so(a);l=S,i=no({key:t,src:URL.createObjectURL(c),format:f})}const m=kc(i.id),p={sourceopen:async()=>{var C,x;m("sourceopen");const f=c.addSourceBuffer(i.format),S=async()=>{f.updating&&await new Promise(g=>f.addEventListener("updateend",g,{once:!0}))};if(i.segments.length&&!i.streaming){m("streaming from cache"),i.streaming=!0,s();for(const g of i.segments)f.appendBuffer(g),await S();c.readyState==="open"&&c.endOfStream(),i.streaming=!1,m("done streaming from cache");return}if(l){m("fetching audio");try{const g=(C=l.body)==null?void 0:C.getReader();if(!g)return;for(;((x=je.get(t))==null?void 0:x.id)===i.id;){const{done:b,value:h}=await g.read();if(b){m("done streaming"),i.streaming=!1,c.readyState==="open"&&c.endOfStream();break}if(!Array.from(c.sourceBuffers).includes(f)){m("stop streaming, source buffer removed"),i.streaming=!1;break}i.streaming||(m("start streaming"),i.streaming=!0,s()),f.appendBuffer(h),i.segments.push(h),await S()}}catch(g){if(m("error while streaming",g),i.streaming=!1,c.readyState==="open")try{c.endOfStream("network")}catch(b){Zt.readAloud.error(b)}je.delete(t),e(g)}}},sourceclose:()=>{var f;m("sourceclose"),i.streaming&&(i.streaming=!1,((f=je.get(t))==null?void 0:f.id)===i.id&&(m("sourceclosed while streaming, cleaning up cache"),je.delete(t)))},sourceended:bt};for(const[f,S]of Object.entries(p))c.addEventListener(f,()=>{try{return S()}catch(C){Zt.readAloud.error(C)}});return je.set(t,i),i.src}const aa=Ae({playbackError:{id:"useVoiceReadAloudAudio.playbackError",defaultMessage:"Failed to play message"}}),kc=t=>bt;function Tc(){return zn()?window.MediaSource:null}function zn(){return!!Bn()}function Bn(){if("MediaSource"in window){const t=e=>_o(e)&&MediaSource.isTypeSupported(e);if(t("audio/aac"))return"aac";if(t("audio/mpeg"))return"mp3";if(t("audio/ogg"))return"ogg"}}const no=t=>({id:Is(),segments:[],streaming:!1,...t}),je=new _n({max:50,dispose:t=>{URL.revokeObjectURL(t.src)}}),jc=u.memo(function(e){var l;const s=(l=Ct("1923022511"))==null?void 0:l.value,a=zs(e.conversationId),{errCode:o}=Ln(e.message);if(!s||!a||o)return null;const i=ko.getAudioAssetPointers(e.message.message)[0];return i?n.jsx(Ac,{audioAssetPointer:i}):n.jsx(Nc,{...e,conversationId:a})});function Ac({audioAssetPointer:t}){const{isLoading:e,isPlaying:s,togglePlayback:a}=Ci({audioAssetPointer:t});return n.jsx(ao,{onClick:a,isPlaying:s,isLoading:e,playText:Es.replay,playIcon:sl})}function Nc({conversationId:t,message:e}){const{isLoading:s,isPlaying:a,togglePlayback:o}=Cc({conversationId:t,messageId:e.message.id});return n.jsx(ao,{onClick:o,isPlaying:a,isLoading:s,playText:Es.play,playIcon:nl})}function ao({onClick:t,isPlaying:e,isLoading:s,playText:a,playIcon:o}){let i,l;const d=qe();return s?(i=To,l=Es.loading):e?(i=al,l=Es.stop):(i=o,l=a),n.jsx(vs,{icon:i,label:l?d.formatMessage(l):void 0,disabled:s,onClick:t,style:e||s?{visibility:"visible"}:void 0,testId:"voice-play-turn-action-button"})}const Es={replay:{id:"VoiceReadOutLoudButton.replay",defaultMessage:"Replay",description:"The tooltip for the replay button"},play:{id:"VoiceReadOutLoudButton.play",defaultMessage:"Read Aloud",description:"The tooltip for the read aloud button"},stop:{id:"VoiceReadOutLoudButton.stop",defaultMessage:"Stop",description:"The tooltip for the stop button"},loading:{id:"VoiceReadOutLoudButton.loading",defaultMessage:"Loading",description:"The tooltip for the spinner"}},Ec="bg-token-main-surface-primary text-token-text-primary",Ic="openai",oa=["bg-blue-300 text-white"];function Fc(t){return oa[((t==null?void 0:t.charCodeAt(0))??0)%oa.length]}const xs=({children:t})=>n.jsx("div",{className:"pt-0",children:n.jsx("div",{className:se(u.isValidElement(t)&&t.type===pn?"gizmo-bot-avatar":"gizmo-shadow-stroke","flex h-8 w-8 items-center justify-center overflow-hidden rounded-full"),children:t})});function An({messages:t,isUserTurn:e,avatarClassName:s,gizmo:a,showInlineEmbeddedDisplay:o=!1}){var C;const i="medium",l=t[0],d=(C=l==null?void 0:l.message.metadata)==null?void 0:C.shared_conversation_id,c=d!=null,m=Fa(),{gizmoEditorData:p,mode:f}=wi();let S=n.jsx(xs,{children:n.jsx(pn,{className:s??Ec,iconName:Ic,size:i})});return a?S=n.jsx(xs,{children:n.jsx(Fl,{gizmoId:a.gizmo.id,className:"h-full w-full"})}):p!=null&&f==="test"&&(S=n.jsx(Pl,{isFirstParty:!1,src:p.profilePictureUrl,className:"h-8 w-8 first:pt-[3px]"})),n.jsx("div",{children:e?c||o?n.jsx(xs,{children:n.jsx(pn,{className:Fc(d),iconName:"user",size:i})}):n.jsx(xs,{children:n.jsx(Mi,{user:m,size:i})}):S})}const ia="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function Pc({className:t,clientThreadId:e,message:s,onModelSelect:a,onDropdownChange:o,canRegenerateResponse:i}){var W;const l=qe(),[d,c]=u.useState(null),[m,p]=u.useState(!1),[f,S]=u.useState(!1),C=ct(e),x=Ja({clientThreadId:e,message:s}),g=(W=s.message.metadata)==null?void 0:W.model_slug,{modelOptions:b,modelSlug:h,animateModelLabelOnRender:y}=x,w=u.useMemo(()=>b.find(T=>T.value==g),[b,g]),v=u.useRef(null),{doesUserHaveAnyAccountsWithPlusFeatures:k}=os(),R=T=>{T||setTimeout(()=>{v.current&&v.current.blur()},10)};u.useEffect(()=>{R(m)},[m]);const j=i&&b.some(T=>Cn(T,k));return C?null:n.jsxs(xt.Root,{onOpenChange:T=>{i&&(p(T),o(T),R(T)),T&&Z.logEvent(q.conversationOpenMessageModelSelector,{has_get_plus_button:j,is_new_regen_dropdown:!0})},children:[i?n.jsx(Rc,{label:n.jsx(E,{id:"wDs5sz",defaultMessage:"Switch model"}),children:n.jsx(Ka,{ref:v,className:se("cursor-pointer",t),onMouseEnter:()=>S(!0),onMouseLeave:()=>S(!1),children:n.jsx(Sn,{modelSlug:h,animateModelLabelOnRender:y,isDropdownOpen:m,isRegenerateEnabled:i,isHovered:f,isRegenLabel:!0})})}):n.jsx("button",{className:se("cursor-pointer",t),onMouseEnter:()=>S(!0),onMouseLeave:()=>S(!1),children:n.jsx(Sn,{modelSlug:h,animateModelLabelOnRender:y,isDropdownOpen:!1,isRegenerateEnabled:!1,isHovered:f,animateShortLabel:!0})}),i&&n.jsxs(xt.Content,{className:"z-30 origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[n.jsx(xt.Item,{disabled:!0,className:"pb-0",children:n.jsx("span",{className:"text-token-text-secondary",children:n.jsx(E,{id:"bFLh5u",defaultMessage:"Switch model"})})}),b.map(({value:T,...I})=>n.jsx(vn,{value:T,onSelect:()=>a(T),includeRegenerate:!1,onMouseEnter:()=>c(T),onMouseLeave:()=>c(null),isHovered:d===T,messageModelSlug:g,includeCheck:!1,className:ia,...I},T)),!!w&&n.jsxs(n.Fragment,{children:[n.jsx(xt.Separator,{}),n.jsx(vn,{onSelect:()=>a(w.value),includeRegenerate:!0,onMouseEnter:()=>c(w.value),onMouseLeave:()=>c(null),messageModelSlug:g,includeCheck:!1,className:ia,...w,label:l.formatMessage(Dc.tryAgain),subtitle:w.label,icon:n.jsx(Us,{className:"icon-sm"})},w.value)]})]})]})}function Rc({children:t,label:e}){return n.jsx(Rs,{label:e,sideOffset:0,children:t})}const Dc=Ae({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"}}),Lc=u.memo(Pc);function Nn({messages:t,isMemoryEnabled:e,isMemoryFull:s,gizmoId:a,isParagen:o}){const[i,l]=u.useState(!1),[d,c]=u.useState(!1),{eligible:m,isLoading:p}=_i(),f=e&&!s,S=t.filter((g,b)=>{const h=t[b+1],w=(h==null?void 0:h.message.recipient)==="assistant"&&(h==null?void 0:h.message.author.role)===ve.Tool&&(h==null?void 0:h.message.author.name)==="bio"&&wa(h.message)==="Model set context updated."||!h&&f;return g.message.author.role===ve.Assistant&&g.message.recipient==="bio"&&w}).flatMap(g=>{const b=g.message.content.content_type;return b===lt.Text?g.message.content.parts:b===lt.Code?[g.message.content.text]:[]}).map(Oc),C=u.useMemo(()=>S.length>0,[S]);if(u.useEffect(()=>{C&&m&&!p&&Ds.openModal(ts.GlobalMemoryOnboarding)},[C,m,p]),S.length===0)return null;const x=g=>{const b=g??!d;c(b),b&&Z.logEvent(q.memoryUpdatePopoverShown,{updateCount:S.length})};return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"inline-block",onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),children:n.jsxs(ki,{open:d,sideOffset:4,side:"bottom",alignAgainstAnchor:"start",size:"none",className:"z-10 min-w-60 max-w-96 text-sm",onOpenChange:g=>x(g),disableAutofocus:!0,triggerButton:n.jsxs("button",{className:se("my-1 flex items-center gap-1 text-sm font-semibold outline-none",d?"text-token-text-secondary":"text-token-text-tertiary"),children:[n.jsx(ol,{className:"mb-[-1px]"}),S.length===1?n.jsx(E,{id:"MemoryActionResult.memoryWriteSingular.1",defaultMessage:"Memory updated"}):n.jsx(E,{id:"MemoryActionResult.memoryWritePlural.1",defaultMessage:"Memories updated"})]}),children:[n.jsx("div",{className:"mb-2 rounded border border-token-border-light bg-token-main-surface-secondary",children:S.map((g,b)=>n.jsx("div",{className:"border-b border-token-border-light px-3 py-2 first-letter:uppercase last:border-b-0",children:g},b))}),o?n.jsx("div",{className:"text-xs text-token-text-tertiary",children:n.jsx(E,{id:"MemoryActionResult.paragenMessage",defaultMessage:"This memory will be saved if you choose this response."})}):n.jsxs("button",{className:"flex w-full items-center justify-between rounded px-3 py-2 font-semibold hover:bg-token-main-surface-secondary",onClick:()=>{l(!0),Z.logEvent(q.memoryUpdatePopoverManageButtonClicked,{updateCount:S.length})},children:[n.jsx(E,{id:"MemoryActionResult.manageMemories",defaultMessage:"Manage memories"}),n.jsx(il,{className:"icon-md -mr-1 text-token-text-tertiary"})]})]})}),i&&n.jsx(Rl,{initialGizmoId:a,onClose:()=>l(!1)})]})}function Oc(t){const e=["The user ","The user's ","User ","User's "];for(const s of e)if(t.startsWith(s))return t.slice(s.length);return t}function ra(t,e,s){B.updateTree(t,a=>{a.updateNodeMetadata(e,{inlineComparisonRating:s})})}const la=({messages:t})=>{for(const{message:{metadata:e}}of t){const{augmented_paragen_prompt_label:s}=e??{};if(s)return s}};function zc(t){const e=Hc(),s=u.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});return t.stubSideBySideFeedback?n.jsx(oo,{shouldEnableUnifiedDesign:e,setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:s,...t}):n.jsx(Bc,{...t,shouldEnableUnifiedDesign:e,visibilityStateRef:s})}function Bc({shouldEnableUnifiedDesign:t,...e}){const{clientThreadId:s,variantIds:a,variantsInStreamInfo:o}=e;if(a.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const[i]=u.useState(()=>Date.now()),l=Pa(),[d,c]=u.useMemo(()=>Ra(a.join(""))()<.5?[0,1]:[1,0],[a[0],a[1]]),m=d<c?"left":"right",p=m==="left"?"right":"left",f=a[d],S=a[c],C=Xn(s,f),x=Xn(s,S),g=Yt(Zn(s,Yt(C).id)),b=Yt(Zn(s,Yt(x).id)),h=m==="left"?g:b,y=m==="left"?b:g,w=o.display_treatment==="unskippable",v=w?"unskippable_parallel_2_in_stream:a:1.0":t?"skippable_parallel_2_in_stream:a:1.5":"skippable_parallel_2_in_stream:a:1.0";u.useEffect(()=>(ks.setState({displayingSideBySideFeedback:!0,unskippable:w}),()=>{ks.setState({displayingSideBySideFeedback:!1,unskippable:!1})}),[w]),Ti();const k=u.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});u.useEffect(()=>jo(ji,{requestCompletion:()=>{var T,I,P,D;const j=(T=Qt(h.messages))==null?void 0:T.completionSampleFinishTime,W=(I=Qt(y.messages))==null?void 0:I.completionSampleFinishTime;be.submitMessageComparisonFeedback({feedback_version:v,original_message_id:(P=h.messages[h.messages.length-1])==null?void 0:P.message.id,new_message_id:(D=y.messages[y.messages.length-1])==null?void 0:D.message.id,rating:"none",conversation_id:B.getServerThreadId(s),text:"",tags:[],completion_comparison_rating:"skip",new_completion_placement:p,feedback_start_time:i,compare_step_start_time:i,original_completion_load_start_time:i,original_completion_load_end_time:j??0,new_completion_load_start_time:i,new_completion_load_end_time:W??0,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),...k.current})}}),[g,b,s,i,v,p,h==null?void 0:h.messages,y==null?void 0:y.messages]);const R=j=>{var ue,L,N,ee;const T=B.getTree(s).getLeafFromNode(j);B.setThreadCurrentLeafId(s,T.id);const P=j===f===(m==="left"),D=(ue=Qt(h.messages))==null?void 0:ue.completionSampleFinishTime,U=(L=Qt(y.messages))==null?void 0:L.completionSampleFinishTime;h.messages.length>0&&ra(s,h.messages[h.messages.length-1].nodeId,P?"original":"new"),y.messages.length>0&&ra(s,y.messages[y.messages.length-1].nodeId,P?"original":"new");let ie;D==null||U==null?ie=P?"partial_load_comparison_original":"partial_load_comparison_new":ie=P?"original":"new",be.submitMessageComparisonFeedback({feedback_version:v,original_message_id:(N=h.messages[h.messages.length-1])==null?void 0:N.message.id,new_message_id:(ee=y.messages[y.messages.length-1])==null?void 0:ee.message.id,rating:"none",conversation_id:B.getServerThreadId(s),text:"",tags:[],completion_comparison_rating:ie,new_completion_placement:p,feedback_start_time:i,compare_step_start_time:i,original_completion_load_start_time:i,original_completion_load_end_time:D??null,new_completion_load_start_time:i,new_completion_load_end_time:U??null,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),...k.current})};return n.jsx(oo,{...e,setPreferredFeedback:R,leftVariantId:f,rightVariantId:S,leftTurn:g,rightTurn:b,hasActiveRequest:l,shouldEnableUnifiedDesign:t,originalTurn:h,visibilityStateRef:k})}function Uc(t){if(!t.length)return!1;const e=t.filter(s=>s.type===rt.Text||s.type===rt.MultiText).filter(s=>{var a;return s.message.message.status!=="finished_successfully"&&((a=s.message.message.metadata)==null?void 0:a.snorkle_status)!==void 0});return e.length>0&&e.every(s=>{const a=s.message.message.content;return(a==null?void 0:a.content_type)===lt.Text&&a.parts.join("")===""})}function oo({setPreferredFeedback:t,shouldEnableUnifiedDesign:e,leftVariantId:s,rightVariantId:a,leftTurn:o,rightTurn:i,hasActiveRequest:l,originalTurn:d,visibilityStateRef:c,...m}){const{defaultParagenLabel:p,shouldShowParagenLabels:f=!1}=Ai(),S=o&&la(o)||p,C=i&&la(i)||p,x=u.useMemo(()=>(o==null?void 0:o.messages)??[],[o==null?void 0:o.messages]),g=u.useMemo(()=>(i==null?void 0:i.messages)??[],[i==null?void 0:i.messages]),{avatarClassName:b}=m,h=u.useMemo(()=>Ts(x),[x]),y=u.useMemo(()=>Ts(g),[g]),w=Fn(),v=rs();function k(he){var Xe,Ne;if(!v.showDebugConversationTurns&&!v.forceParagen)return null;let V=he===d?"ORIGINAL":"NEW";const Te=he.messages[he.messages.length-1],ce=(Ne=(Xe=Te==null?void 0:Te.message)==null?void 0:Xe.metadata)==null?void 0:Ne.__internal;if(ce){const{model_id:Ee,model_definition_slug:$e,model_definition_virtual_model_id:dt,alternative_model_selection_rule:Ze,augmented_paragen_prompt_group_id:kt,augmented_paragen_prompt_id:Ue,augmented_paragen_prompt:ut}=ce;Ee&&(V+=`
Model ID: ${Ee}`),$e&&(V+=`
Model Slug: ${$e}`),dt&&(V+=`
Virtual Model ID: ${dt}`),Ze&&(V+=`
Alternative Model Rule: ${Ze}`),kt&&(V+=`
Prompt Group ID: ${kt}`),Ue&&(V+=`
Prompt ID: ${Ue}`),ut&&(V+=`
Prompt: ${ut}`)}return n.jsx("div",{className:"whitespace-pre-wrap text-sm text-red-500",children:V})}const[R,j]=u.useMemo(()=>[h,y].map(he=>Uc(he)),[h,y]),W=ss(o?_s.getRequestIdFromConversationTurn(o):"")||R,T=ss(i?_s.getRequestIdFromConversationTurn(i):"")||j,I=(o==null?void 0:o.role)===ve.User,P=(i==null?void 0:i.role)===ve.User,D=In(),U=u.useRef(null),ie=u.useRef(null),ue=u.useRef(null);u.useEffect(()=>{if(U.current&&ie.current&&ue.current){const he=Array(11).fill(0).map((Te,ce)=>ce/10),V=new IntersectionObserver(Te=>Te.forEach(ce=>{ce.target===ie.current?(c.current.left_visibility_initial==null&&(c.current.left_visibility_initial=ce.intersectionRatio),c.current.left_visibility_max=Math.max(c.current.left_visibility_max??0,ce.intersectionRatio)):ce.target===ue.current&&(c.current.right_visibility_initial==null&&(c.current.right_visibility_initial=ce.intersectionRatio),c.current.right_visibility_max=Math.max(c.current.right_visibility_max??0,ce.intersectionRatio))}),{root:U.current,threshold:he});return V.observe(ie.current),V.observe(ue.current),()=>V.disconnect()}},[c]);const{data:L}=Pn(void 0,!1,w),N=Vc(),ee=L==null?void 0:L.memoryFullPct,Ce=typeof ee=="number"&&ee>=100,H=n.jsx(E,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."});let ne,Q;switch(N){case 1:{ne=n.jsx(E,{id:"JgCHDY",defaultMessage:"You’re giving feedback on a new version of ChatGPT."}),Q=H;break}case 2:{ne=n.jsx(E,{id:"AOeHRv",defaultMessage:"You’re giving feedback on an experimental version of ChatGPT."}),Q=H;break}case 0:default:{ne=n.jsx(E,{...Xt.responsePrompt}),Q=n.jsx(E,{...Xt.responsePromptExplanation});break}}return n.jsxs("div",{className:"relative flex flex-col",children:[n.jsx("div",{className:"sticky top-[-1px] z-[1] text-pretty bg-token-main-surface-primary px-6 text-center text-lg md:static",children:ne}),n.jsx("div",{className:"text-pretty px-6 pb-5 pt-1 text-center text-sm text-token-text-secondary",children:Q}),n.jsx("div",{className:"sticky top-[calc(1.75em-1px)] z-[1] h-3 bg-gradient-to-b from-token-main-surface-primary from-50% to-transparent md:static"}),n.jsx("div",{className:"-mb-2 snap-x snap-mandatory overflow-x-auto px-3 pb-4 md:px-5 lg:px-10",ref:U,children:n.jsx("div",{className:"min-w-fit",children:n.jsxs("div",{className:se({"mx-auto flex max-w-6xl":!0,"gap-2 sm:gap-3":!e,"items-start gap-4 sm:gap-6":e}),children:[n.jsxs(ca,{elemRef:ie,onClick:()=>{t(s)},shouldEnableUnifiedDesign:e,hasActiveRequest:l,children:[n.jsxs(ua,{children:[n.jsx(An,{messages:x,isUserTurn:I,avatarClassName:b,showInlineEmbeddedDisplay:!1}),n.jsx(da,{children:f?n.jsx("span",{className:"font-bold text-token-text-primary",children:S}):n.jsx(E,{...Xt.responseNumber,values:{responseIndex:1}})})]}),L!=null&&!I&&n.jsx(Nn,{messages:x,isMemoryEnabled:D,isMemoryFull:Ce,isParagen:!0}),n.jsx(xn,{...m,groupedMessagesToRender:h,allGroupedMessages:h,isEditing:!1,isUserTurn:I,isCompletionRequestInProgress:W,hasActiveRequest:l,handleEnterEdit:bt,handleExitEdit:bt,shouldGrowContainer:!e}),!!o&&k(o)]}),n.jsxs(ca,{elemRef:ue,onClick:()=>{t(a)},shouldEnableUnifiedDesign:e,hasActiveRequest:l,children:[n.jsxs(ua,{children:[n.jsx(An,{messages:g,isUserTurn:P,avatarClassName:b,showInlineEmbeddedDisplay:!1}),n.jsx(da,{children:f?n.jsx("span",{className:"font-bold text-token-text-primary",children:C}):n.jsx(E,{...Xt.responseNumber,values:{responseIndex:2}})})]}),L!=null&&!P&&n.jsx(Nn,{messages:g,isMemoryEnabled:D,isMemoryFull:Ce,isParagen:!0}),n.jsx(xn,{...m,groupedMessagesToRender:y,allGroupedMessages:y,isEditing:!1,isUserTurn:P,isCompletionRequestInProgress:T,hasActiveRequest:l,handleEnterEdit:bt,handleExitEdit:bt,shouldGrowContainer:!e}),!!i&&k(i)]})]})})})]})}function ca({shouldEnableUnifiedDesign:t,...e}){return t?n.jsx(Gc,{...e}):n.jsx(Wc,{...e})}function Gc({elemRef:t,onClick:e,children:s,hasActiveRequest:a}){return n.jsxs("div",{className:"relative flex w-full min-w-[min(450px,80vw)] snap-center flex-col gap-1 truncate rounded-2xl border border-token-main-surface-tertiary bg-white p-5 text-left dark:bg-gray-700",ref:t,children:[s,a?null:n.jsx(at,{className:"mt-4 self-start",onClick:e,children:n.jsx(E,{id:"U2EAH6",defaultMessage:"I prefer this response"})})]})}function Wc({elemRef:t,onClick:e,children:s}){const a=Ao(),o="relative flex w-full flex-col gap-1 bg-white cursor-pointer truncate rounded-lg border border-token-main-surface-tertiary text-left dark:bg-gray-700 p-3 sm:py-4 sm:px-5 hover:border-gray-300 min-w-[min(450px,80vw)] snap-center";return a?n.jsx("button",{className:o,onClick:e,ref:t,children:s}):n.jsxs("div",{className:o,ref:t,children:[s,n.jsx("button",{className:"mt-4 rounded-full bg-token-main-surface-primary p-2",onClick:e,children:n.jsx(E,{...Xt.responseChoice})})]})}const da=Je.div`text-sm text-token-text-tertiary font-semibold`,ua=Je.div`flex gap-4 items-center mb-1`,Xt=Ae({responsePrompt:{id:"ConversationTurnTwoUpFeedback.responsePrompt",defaultMessage:"Which response do you prefer?"},responsePromptExplanation:{id:"ConversationTurnTwoUpFeedback.responsePromptExplanation",defaultMessage:"Your choice will help make ChatGPT better."},responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}"},responseChoice:{id:"ConversationTurnTwoUpFeedback.responseChoice",defaultMessage:"Choose this response"}});function Hc(){const{layer:t}=wt("229662723");return t.get("should-enable-chair",!1)}function Vc(){const{layer:t}=wt("229662723");return t.get("bread-version",0)}function qc({clientThreadId:t,messageForRating:e,variantIds:s,conversationTurnMountTime:a}){const[o]=u.useState(()=>e.message.create_time!=null?e.message.create_time*1e3:Date.now()),[i]=u.useState(()=>Date.now());function l(d){var k,R;const c=B.getTree(t),m=s[0]||"",p=(c==null?void 0:c.getConversationTurns(m))||[],f=p[p.length-1],S=(f==null?void 0:f.messages)||[],C=S[S.length-1],x=((k=C==null?void 0:C.message)==null?void 0:k.id)||"",g=s[1]||"",b=(c==null?void 0:c.getConversationTurns(g))||[],h=b[b.length-1],y=(h==null?void 0:h.messages)||[],w=y[y.length-1],v=((R=w==null?void 0:w.message)==null?void 0:R.id)||"";be.submitMessageComparisonFeedback({feedback_version:"inline_regen_feedback:a:1.0",original_message_id:x,new_message_id:v,rating:"none",conversation_id:B.getServerThreadId(t),text:"",tags:[],completion_comparison_rating:d,new_completion_placement:"not-applicable",feedback_start_time:a,compare_step_start_time:a,new_completion_load_start_time:o,new_completion_load_end_time:i,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset()}),B.updateTree(t,j=>{j.updateNodeMetadata(e.nodeId,{inlineComparisonRating:d})}),B.updateTree(t,j=>{j.updateNodeMetadata(C.nodeId,{inlineComparisonRating:"baseline"})})}return n.jsxs($c,{children:[n.jsx("h6",{className:"min-w-[150px] grow",children:n.jsx(E,{...ys.regenTitle})}),n.jsxs("div",{className:"flex flex-wrap items-end justify-center gap-2",children:[n.jsx(at,{color:"secondary",onClick:()=>l("new"),children:n.jsx(E,{...ys.regenBetterText})}),n.jsx(at,{color:"secondary",onClick:()=>l("original"),children:n.jsx(E,{...ys.regenWorseText})}),n.jsx(at,{color:"secondary",onClick:()=>l("same"),children:n.jsx(E,{...ys.regenSameText})})]}),n.jsx(No,{onClick:()=>{B.updateTree(t,d=>{d.updateNodeMetadata(e.nodeId,{inlineComparisonRating:"skip"})})}})]})}const $c=Je.div`flex items-center p-4 rounded-2xl bg-token-main-surface-primary text-token-text-primary text-sm border border-token-border-light gap-5 mt-3`,ys=Ae({regenTitle:{id:"ConversationTurnInlineFeedback.regenTitle",defaultMessage:"Was this response better or worse?"},regenBetterText:{id:"ConversationTurnInlineFeedback.regenBetterText",defaultMessage:"Better"},regenWorseText:{id:"ConversationTurnInlineFeedback.regenWorseText",defaultMessage:"Worse"},regenSameText:{id:"ConversationTurnInlineFeedback.regenSameText",defaultMessage:"Same"}}),ha=({allGroupedMessages:t})=>t.some(e=>[rt.Browsing,rt.RetrievalBrowsing,rt.ParallelBrowsing].includes(e.type)),ma=({allGroupedMessages:t})=>t.some(e=>e.type===rt.CodeInterpreter);function Kc(t){return!t||!t.instructions?"":typeof t.instructions=="string"?t.instructions:t.instructions.filter(e=>typeof e=="string").join("")}const Yc=[{match:ha,tag:"Shouldn't have searched the web",label:oe({id:"kL047b",defaultMessage:"Shouldn't have searched the web"})},{match:ha,tag:"Don't like the source it cited",label:oe({id:"+ds/Q/",defaultMessage:"Don't like the source it cited"})},{match:ma,tag:"Shouldn't have run code",label:oe({id:"53w4ay",defaultMessage:"Shouldn't have run code"})},{match:ma,tag:"Couldn't handle my file",label:oe({id:"EkFTQ5",defaultMessage:"Couldn't handle my file"})},{match:({allGroupedMessages:t})=>t.some(e=>e.type===rt.Dalle),tag:"Shouldn't have created an image",label:oe({id:"S8FRsr",defaultMessage:"Shouldn't have created an image"})},{match:({allGroupedMessages:t})=>t.some(e=>{if(e.type!==rt.Text)return!1;const{message:s}=e.message,{content:a}=s;return a.content_type===lt.Text&&wa(s).match(/^```[\S]+\n/gm)}),tag:"Code was incorrect",label:oe({id:"4EBdQk",defaultMessage:"Code was incorrect"})},{match:({systemContent:t})=>Kc(t).includes("Personality")??!1,tag:"Too chatty or casual",label:oe({id:"ATzJKW",defaultMessage:"Too chatty or casual"})},{match:({features:t})=>t.includes(Ps.Sunshine),tag:"Shouldn't have used Memory",label:oe({id:"yfUEiz",defaultMessage:"Shouldn't have used Memory"})},{tag:"Don't like the style",label:oe({id:"nGxjdj",defaultMessage:"Don't like the style"})},{tag:"Not factually correct",label:oe({id:"Ke7JtQ",defaultMessage:"Not factually correct"})},{tag:"Didn't fully follow instructions",label:oe({id:"Rdlt9V",defaultMessage:"Didn't fully follow instructions"})},{tag:"Refused when it shouldn't have",label:oe({id:"2yRS/Q",defaultMessage:"Refused when it shouldn't have"})},{tag:"Being lazy",label:oe({id:"14MPmT",defaultMessage:"Being lazy"})},{tag:"Unsafe or problematic",label:oe({id:"02pXBl",defaultMessage:"Unsafe or problematic"})},{tag:"Other",label:oe({id:"WiIGE+",defaultMessage:"Other"})}],Qc=[{tag:"I disagree with the policy",label:oe({id:"oKyDLz",defaultMessage:"I disagree with the policy"})},{tag:"This didn't violate the policy",label:oe({id:"7fUkVF",defaultMessage:"This didn't violate the policy"})},{tag:"I don't understand the policy",label:oe({id:"4Cdp6N",defaultMessage:"I don't understand the policy"})},{tag:"This didn't take the full context",label:oe({id:"vnZJDP",defaultMessage:"This didn't take the full context"})}];function Jc(t,e,s){return e.filter(a=>!a.match||a.match(s)).map(a=>({value:a.tag,label:t.formatMessage(a.label)}))}function Xc(t){const e=t[t.length-1];if(!e)return!1;const s="message"in e?e.message:null;if(s){const{errCode:a}=Ln(s);return[qn.ContentPolicy,qn.ContentOrTos].includes(a)}else return!1}function Zc({clientThreadId:t,conversationMessage:e,currentModelId:s,allGroupedMessages:a}){const o=qe(),i=Fs()??[],l=e.rating,{value:d}=Ct("1410082514"),c=Dr(t,e.message.id),m=(c==null?void 0:c.message.content.content_type)===lt.SystemContent?c==null?void 0:c.message.content:null,p=u.useCallback(C=>{var h;const x=B.getServerThreadId(t);if(!x||C.tags.length===0&&!C.textFeedback)return;Z.logEvent(C.source==="inline"?q.messageFeedbackInlineSubmitted:q.messageFeedbackDialogSubmitted,{id:e.message.id,threadId:x,tags:C.tags,content:C.textFeedback,model:s,rating:l});const b=d&&((h=e.message.metadata)==null?void 0:h.snorkle_status)!=null?be.submitSnorkleFeedback:be.submitMessageFeedback;l&&b({message_id:e.message.id,conversation_id:x,rating:l,text:C.textFeedback,tags:C.tags,tag_choices:C.tagChoices})},[t,e.message,s,l,d]),f=()=>{Z.logEvent(q.messageFeedbackMoreOptionsClicked,{id:e.message.id,threadId:B.getServerThreadId(t),model:s,rating:l})},S=Jc(o,Xc(a)?Qc:Yc,{allGroupedMessages:a,features:i,currentModelId:s,systemContent:m});return l==="thumbsUp"?null:n.jsx(Dl,{tagOptions:S,onSubmit:p,onMoreClicked:f})}const ga=[1,2,3,4,10,20,30],ed=.5;function td({clientThreadId:t,conversationLeafId:e}){const s=js(Rn.isBusinessWorkspace),a=u.useRef(!1),o=zs(t),i=Bs(t),{isUnauthenticated:l}=zt(),{value:d}=Ct("1410082514"),c=u.useMemo(()=>{if(!o)return-1;const D=Ra(o);return D()>ed?-1:ga[Math.floor(D()*ga.length)]},[o]),m=Ba(t,e),p=m[m.length-1],f=u.useMemo(()=>_s.getRequestIdFromConversationTurn(p),[p]),S=ss(f),[C,x]=u.useState(null),[g,b]=u.useState(!1),[h,y]=u.useState(!1),[w,v]=u.useState(!1),k=D=>{var ie,ue;const U=(ue=(ie=Qt(m))==null?void 0:ie.messages[0])==null?void 0:ue.message.id;x(D),I(U,D)},R=m.filter(D=>D.role===ve.Assistant).length,j=(p==null?void 0:p.role)===ve.Assistant,W=p==null?void 0:p.messages.some(D=>{var U;return(U=D.message.metadata)==null?void 0:U.is_nulligen}),T=d&&(p==null?void 0:p.messages.some(D=>{var U;return((U=D.message.metadata)==null?void 0:U.snorkle_status)!=null})),I=u.useMemo(()=>Ta((D,U)=>{o&&D&&(T?be.submitSnorkleFeedback({conversation_id:o,message_id:D,rating:U}):be.submitConversationRating({conversation_id:o,message_id:D,rating:U,shown_at_assistant_turn:c})),Z.logEvent(q.conversationRatingSubmitted,{rating:U,showAtAssistantTurn:c,conversationId:o}),b(!0),setTimeout(()=>{y(!0)},1500)},2e3),[o,c,T]),P=R!==c||S||!j||W||!!s||(i==null?void 0:i.kind)!==it.PrimaryAssistant||w||l;return u.useEffect(()=>{!P&&!a.current&&(Z.logEvent(q.conversationRatingShown,{showAtAssistantTurn:c,conversationId:o}),a.current=!0)},[P]),w||P&&!T?null:n.jsxs("div",{className:"mx-auto",children:[n.jsx(ja,{children:g&&!h&&n.jsx(Lt.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:n.jsx(fa,{$padded:!0,children:n.jsx("span",{className:"text-sm text-token-text-tertiary",children:n.jsx(E,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!g&&n.jsx(Lt.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:n.jsxs(fa,{$padded:!1,children:[n.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-secondary",children:[n.jsx(E,{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?"}),n.jsxs("div",{className:"flex items-center gap-5",children:[n.jsx(gn,{$selected:C==="thumbsUp",onClick:()=>k("thumbsUp"),children:n.jsx(Va,{className:"icon-md"})}),n.jsx(gn,{$selected:C==="thumbsDown",onClick:()=>k("thumbsDown"),children:n.jsx(qa,{className:"icon-md"})})]})]}),n.jsx("div",{className:"w-px flex-1 self-stretch bg-token-main-surface-tertiary"}),n.jsx(gn,{className:"p-3",$selected:!1,onClick:()=>v(!0),children:n.jsx(rl,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const gn=Je.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,fa=Je.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`;function sd({clientThreadId:t,conversationLeafId:e,canShowIndepthFeedbackType:s,canShowInlineComparisonFeedback:a,canShowInlineMessageFeedback:o,messageForRating:i,allGroupedMessages:l,currentModelId:d,conversationTurnMountTime:c,variantIds:m}){let p=null;return Lr(t,e)?null:(s!==void 0?p=n.jsx(bc,{clientThreadId:t,conversationLeafId:e,trigger:s,variantIds:m}):i.rating&&o?p=n.jsx(Zc,{clientThreadId:t,conversationMessage:i,allGroupedMessages:l,currentModelId:d}):a?p=n.jsx(qc,{clientThreadId:t,messageForRating:i,variantIds:m,conversationTurnMountTime:c}):p=n.jsx("div",{className:"text-center",children:n.jsx(td,{clientThreadId:t,conversationLeafId:e})}),n.jsx("div",{className:"mt-3 w-full empty:hidden",children:p}))}const nd=Mt(()=>_t(()=>import("./sso-dlecoq29tbbucwzg.js").then(t=>t.h),__vite__mapDeps([31,1,2,3,27,10,11,6,7,12,26,16,28,29,30,14,13,9,32,33,34,35,36,18,20,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,17,80,81,82,83,84,85,86])).then(t=>t.ContextualAnswerCitationCards).catch(()=>()=>null));function ad(t){var Wn;const{turnIndex:e,conversationLeafId:s,isFinalTurn:a,clientThreadId:o,onChangeItemInView:i,onChangeRating:l,showInlineEmbeddedDisplay:d=!1,currentModelId:c,initiallyHighlightedMessageId:m,avatarClassName:p,scrollToBottom:f}=t,S=qe(),C=Fa(),x=!!C&&Io(C),g=Ls(),b=js(Rn.isBusinessWorkspace),h=In(),y=Fn(),w=Yt(Or(o,e,s)),{messages:v,variantIds:k,variantsInStreamInfo:R}=w,j=Ts(v),W=Ni();let T=v[v.length-1];for(const X of j){const fe=jr(X);if(fe.some(Kt=>W.has(Kt.message.id))){T=fe[fe.length-1];break}}const I=v.slice(0,v.indexOf(T)+1),P=Ma(),[D,U]=u.useState(!1),[ie,ue]=u.useState(!1),L=k.findIndex(X=>I.some(fe=>fe.nodeId===X)),N=w.role===ve.User,ee=St(),Ce=ct(o),H=(Wn=is(w.gizmoId??Ce))==null?void 0:Wn.data,ne=Ei(),Q=H&&ne.includes(H.gizmo.id),he=Da(c),V=Bs(o,H==null?void 0:H.gizmo.id),ce=zr(o)===Fo.PENDING,{data:Xe}=Pn(H==null?void 0:H.gizmo.id,!1,y),Ne=Xe==null?void 0:Xe.memoryFullPct,Ee=Ne!==void 0&&Ne>=100,$e=Fs(),{value:dt}=Ct("1410082514"),{value:Ze}=Ct("2291672486"),kt=I.some(X=>X.message.content.content_type===lt.MultimodalText),{isUnauthenticated:Ue}=zt(),[ut,cs]=u.useState(!1),[Gs,Bt]=u.useState(!1);Ii(()=>{w.role==="user"&&f&&f()});const Ut=u.useRef(null);u.useEffect(()=>{var fe;if(m==null)return;w.messages.map(Kt=>Kt.message.id).includes(m)&&((fe=Ut.current)==null||fe.scrollIntoView({behavior:"auto"}))},[m]);const O=v[v.length-1],Ge=O.rating,ds=()=>{I.length===1&&(Z.logEvent(q.editPrompt,{id:I[0].message.id,threadId:B.getServerThreadId(o)}),ot.logEvent("chatgpt_edit_prompt"),U(!0))},Ke=u.useCallback(()=>{U(!1)},[]),Tt=u.useCallback(()=>{B.copyMessageToClipboard(o,e)},[o,e]),Gt=X=>{l({nodeId:O.nodeId,messageId:O.message.id,rating:X}),Z.logEvent(q.messageFeedbackThumbsDownClicked,{id:O.message.id,threadId:B.getServerThreadId(o),model:c,rating:X}),ue(!0)},[us]=u.useState(()=>Date.now()),Ws=u.useMemo(()=>_s.getRequestIdFromConversationTurn(w),[w]),Hs=Br({clientThreadId:o,conversationLeafId:s}),me=ss(Ws)&&!Hs,Vs=Pa(),hs=Ts(I),{showDebugConversationTurns:qs}=rs(),ms=Ur(o),gs=Qa(o),Wt=vc({clientThreadId:o,conversationMode:V}),$s=Os(o),Ht=u.useCallback((X,fe,Kt)=>{const lo=new fn;Wt(O.nodeId,{eventSource:"mouse"},lo,X,fe,Kt)},[O,Wt]),Vt=dt&&I.some(X=>{var fe;return((fe=X.message.metadata)==null?void 0:fe.snorkle_status)!=null}),qt=!g&&!ms&&!ee&&!N,fs=qt&&(!b||Vt),$t=Fi(),Ks=!Ue&&fs&&P&&!me&&!ce&&!d&&!D&&(V==null?void 0:V.kind)!==it.GizmoMagicCreate&&L===1&&a&&!O.inlineComparisonRating&&!Ge&&k.length===2&&!$t&&Date.now()-(O.message.create_time??0)*1e3<1e3*60*10,ht=!Ue&&fs&&!me&&!ce&&!d&&!D&&(V==null?void 0:V.kind)!==it.GizmoMagicCreate&&c===jl&&a&&h&&!Ee&&Date.now()-(O.message.create_time??0)*1e3<1e3*60*10,Ys=xc(O),Qs=T.message.author.role===ve.Assistant?T.message:null;Pi({isCompletionRequestInProgress:me,isUserTurn:N,message:Qs});const Js=ht?Ys:void 0,Xs=Gr(o,k),mt=Ri(V),z=!$t&&!mt&&qt&&a&&(R==null?void 0:R.num_variants_in_stream)===2&&!O.inlineComparisonRating&&!Xs,Se=k.length===2,J=z,ge=z&&!Se,Ie=!N&&!d&&!g&&!ms&&!mt&&!ce&&!me,We=Ie&&(!b||Vt||he||x)&&!mt&&!Ue&&!ee,He=!g&&!d&&!((me||ce)&&a)&&k.length>1&&!D&&!J;let Ve=!1;if(N&&I.length===1){const{shouldHideContent:X}=Ln(I[0]);X&&(Ve=!0)}const jt=N&&!d&&!mt&&!g&&!kt&&I.length===1&&!Ve&&!D&&!Ue,ps=X=>{i(k[X]),Z.logEvent(q.changeNode,{intent:"toggle_between"})};if(!(w.role===ve.Root?!1:w.role===ve.System||I.every(X=>{var fe;return(fe=X.message.metadata)==null?void 0:fe.is_visually_hidden_from_conversation})?qs:!0)&&!J)return null;const Zs=a&&gs&&!Ze?n.jsx(vs,{onClick:()=>{const X=new fn;Wt($s,{eventSource:"mouse"},X),Di()},icon:Us,label:S.formatMessage({id:"ConversationTurn.regenerateTooltip",defaultMessage:"Regenerate"}),testId:"regenerate-turn-action-button"}):null,At="h-[30px] rounded-md px-1 text-token-text-secondary hover:bg-token-main-surface-secondary",de=Ze?n.jsx(Lc,{className:At,clientThreadId:o,message:O,onModelSelect:Ht,onDropdownChange:cs,canRegenerateResponse:gs}):null,gt=!N&&!Ve&&!d&&(!a||!me)?n.jsx(Wi,{onClick:Tt}):null,en=!N&&!d&&(!a||!me)&&(O.disclaimers??[]).length===0&&O.nodeId?n.jsx(jc,{conversationId:o,message:O,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-xs text-token-text-tertiary hover:text-token-text-primary"}):null,tn=!N&&!d&&O&&(!a||!me)?n.jsx(Hi,{message:O,isFinalTurn:a,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-token-text-tertiary hover:text-token-text-primary"}):null,sn=We&&!me?n.jsxs("div",{className:"flex",children:[!($e!=null&&$e.includes(Ps.ThumbsDownOnly))&&Ge!=="thumbsDown"&&n.jsx(vs,{onClick:()=>Gt("thumbsUp"),disabled:Ge==="thumbsUp",icon:Ge==="thumbsUp"?ll:Va,label:S.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"},`thumbsUp:${O.nodeId}`),Ge!=="thumbsUp"&&n.jsx(vs,{onClick:()=>Gt("thumbsDown"),disabled:Ge==="thumbsDown",icon:Ge==="thumbsDown"?cl:qa,label:S.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"},`thumbsDown:${O.nodeId}`)]}):null,ro=!Ze&&n.jsx(mc,{className:At,clientThreadId:o,message:O,onModelSelect:Ht,onDropdownChange:cs});return n.jsxs("article",{className:"w-full text-token-text-primary focus-visible:outline-2 focus-visible:outline-offset-[-4px]",ref:Ut,dir:"auto","data-testid":`conversation-turn-${e}`,"data-scroll-anchor":a,onMouseEnter:()=>Bt(!0),onMouseLeave:()=>Bt(!1),children:[n.jsx(Li,{role:w.role}),n.jsx(La,{clientThreadId:o,showInlineEmbeddedDisplay:d,isStaticSharedThread:g,withVerticalPadding:!0,withHorizontalPadding:!J,children:J?n.jsx(zc,{isFeedbackEnabled:We,variantIds:k,variantsInStreamInfo:R,conversationTurnMountTime:us,stubSideBySideFeedback:ge,...t}):n.jsxs(Oa,{children:[!N&&n.jsx(id,{children:n.jsx(An,{messages:I,isUserTurn:N,avatarClassName:p,showInlineEmbeddedDisplay:d,gizmo:H})}),n.jsx("div",{className:se("group/conversation-turn relative flex w-full min-w-0 flex-col",!N&&Oi),children:n.jsx("div",{className:"flex-col gap-1 md:gap-3",children:n.jsxs(n.Fragment,{children:[!N&&!g&&n.jsx(Nn,{messages:I,isMemoryEnabled:h,isMemoryFull:Ee,gizmoId:H==null?void 0:H.gizmo.id}),n.jsx(xn,{groupedMessagesToRender:hs,allGroupedMessages:j,...t,isEditing:D,isUserTurn:N,isCompletionRequestInProgress:me,isFeedbackEnabled:We,isFinalTurn:a,hasActiveRequest:Vs,showEditButton:jt,handleEnterEdit:ds,handleExitEdit:Ke}),Q&&n.jsx("div",{className:"mb-4",children:n.jsx(zi,{messages:I})}),he&&n.jsx("div",{className:"mb-4",children:n.jsx(nd,{messages:I})}),(Ie||He)&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:se("mt-1 flex gap-3 empty:hidden",N?"mr-1 flex-row-reverse":"-ml-2"),children:n.jsx(Bi,{alwaysShow:a,showInline:a||He,isHovered:Gs||ut,pagination:He&&n.jsx(Ui,{showInline:a||He,currentPage:L,onChangeIndex:ps,length:k.length,className:se("self-center",k.length>1?"visible":"!invisible")}),actions:Ie&&n.jsxs(n.Fragment,{children:[en,gt,Zs,sn,tn,ro,de]})})}),Ie&&!me?n.jsx("div",{className:"pr-2 lg:pr-0",children:n.jsx(Gi,{message:O,isFinalTurn:a})}):null,a&&!me&&n.jsx(sd,{canShowIndepthFeedbackType:Js,canShowInlineComparisonFeedback:Ks,canShowInlineMessageFeedback:ie,clientThreadId:o,conversationLeafId:s,messageForRating:O,allGroupedMessages:j,currentModelId:c,conversationTurnMountTime:us,variantIds:k})]})]})})})]})})]})}const od=Eo.memo(ad),id=Je.div`flex-shrink-0 flex flex-col relative items-end`;function rd(t){var s,a;const e=(s=t.message.metadata)==null?void 0:s.aggregate_result;return(a=e==null?void 0:e.messages)==null?void 0:a.some(Ll)}function ld(t){const e=t.message.content;return("parts"in e?e.parts.join(""):"").includes("sandbox:")}function cd(t){return t.some(e=>e.messages.some(s=>rd(s)||ld(s)))}function dd({clientThreadId:t}){const e=Wr(t),s=Ua(t),a=Dn(p=>ls.getThreadCreateTime(t,p)),o=Os(t),i=Ba(t,o),l=u.useMemo(()=>cd(i),[i]),d=Hr(t),c=Vr(t),m=d||c;return n.jsxs("div",{className:"border-b border-gray-100 px-4 pb-4 pt-3 sm:mb-2 sm:pb-6 sm:pt-8 md:px-0",children:[n.jsx("h1",{className:"text-3xl font-semibold leading-tight text-token-text-primary sm:text-4xl",children:e}),(s!=null||a!=null)&&n.jsxs("div",{className:"pt-3 text-base text-gray-400 sm:pt-4",children:[s!=null&&n.jsx("span",{children:s}),s!=null&&a!=null&&n.jsx("span",{className:"px-2",children:"•"}),a!=null&&n.jsx(Po,{value:a,month:"long",year:"numeric",day:"numeric"})]}),n.jsx(ud,{shouldShowCodeInterpreterDisclaimer:l,shouldShowPersonalizedDataDisclaimer:m})]})}const ud=({shouldShowCodeInterpreterDisclaimer:t,shouldShowPersonalizedDataDisclaimer:e})=>n.jsxs(n.Fragment,{children:[t&&n.jsx("div",{className:"mt-4",children:n.jsx(Kn,{icon:As,children:n.jsx(E,{id:"sharedConversation.advancedDataAnalysisSupportDisclaimer",defaultMessage:"This chat contains files or images produced by Advanced Data Analysis which are not yet visible in Shared Chats."})})}),e&&n.jsx("div",{className:"mt-4",children:n.jsx(Kn,{icon:As,children:n.jsx(E,{id:"sharedConversation.personalizedDataDisclaimer",defaultMessage:"This conversation may reflect the link creator’s personalized data, which isn’t shared and can meaningfully change how the model responds."})})})]}),hd=t=>{const e=St();return u.useCallback(s=>{var d,c;Vi(s);const{target:a}=s;if(!(a instanceof Element))return;const o=(d=a.closest("[data-message-id]"))==null?void 0:d.getAttribute("data-message-id"),i=(c=document.getSelection())==null?void 0:c.toString(),l=B.getServerThreadId(t);!o||!i||!l||e||be.submitImplicitMessageFeedback({source:"keyboard",type:"copy",messageId:o,serverThreadId:l,selectedText:i})},[t,e])};function md({onChangeItemInView:t,onRequestMoreCompletions:e,onChangeRating:s,onRequestCompletion:a,clientThreadId:o,conversationLeafId:i,inlineEmbeddedDisplay:l,initiallyHighlightedMessageId:d,hideHeader:c}){const m=qi(),p=Ls(),f=$i(),[S]=Ki(),C=Bs(o),x=Ot(),g=Al(o),b=m.store.useContentAreaDimensions(Yi.Header,P=>P!=null&&P.height?P.height:void 0),h=m.store.useIsHeaderContentAreaPopulated(),y=Ga(o),{isArchived:w}=y,v=vl(g.id),k=(C==null?void 0:C.kind)===it.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":v,R=Wa(o,i),j=Qi(),W=u.useCallback(()=>{f({behavior:"smooth"})},[f]),T=hd(o),I=j&&!w;return n.jsxs("div",{onCopy:T,className:se("flex flex-col text-sm",p&&"pt-2",I&&"pb-[120px]",b||I?null:"md:pb-9"),style:{paddingBottom:I?void 0:b},children:[!c&&(p||(x==null?void 0:x.data))&&!l&&n.jsx(Ya,{clientThreadId:o}),p&&!l&&n.jsx(Oa,{children:n.jsx(dd,{clientThreadId:o})}),[...new Array(R).keys()].map(P=>n.jsx(od,{isFinalTurn:P===R-1,turnIndex:P,clientThreadId:o,conversationLeafId:i,onChangeItemInView:t,onChangeRating:s,onRequestMoreCompletions:e,onRequestCompletion:a,currentModelId:g.id,showInlineEmbeddedDisplay:l,initiallyHighlightedMessageId:d,avatarClassName:k,scrollToBottom:W},P)),!S&&!l&&n.jsx(gd,{className:se(b?null:"bottom-5",I?h?"translate-y-[-50px]":"translate-y-[-10px]":""),style:{bottom:j?"calc(var(--composer-bar_footer-current-height) + var(--composer-bar_current-height))":b},onClick:()=>{ot.logEvent("chatgpt_thread_scroll_to_bottom"),f({behavior:"smooth"})},children:n.jsx(dl,{className:"icon-md text-token-text-primary"})})]})}const gd=Je.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-light right-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`;function fd({clientThreadId:t,currentModelId:e}){const s=Sl(e,Cl.CODE_INTERPRETER);bd(s,t)}async function pd({queryKey:[t,e]}){return await be.getThreadInterpreterState(e).then(s=>(s.time_remaining_ms===0&&s.kernel_started&&Ft.warning("This advanced data analysis (beta) chat has timed out. You may continue the conversation, but previous files, links, and code blocks below may not work as expected.",{hasCloseButton:!0,duration:0}),s))}function bd(t,e){const s=Ls(),a=B.getServerThreadId(e);return Ro({queryKey:["interpreterState",a],queryFn:pd,enabled:!!(t&&a&&!s),gcTime:0})}const xd=Mt(()=>_t(()=>import("./b5nc20t88ec5fpfz.js"),__vite__mapDeps([87,1,2,3,11,6,7,12,10,73,59,60,41,63,27,16,49])).then(t=>t.OpenDebugSidebarButton)),yd=Mt(()=>_t(()=>import("./cgcmm2ma1bm07z0x.js"),__vite__mapDeps([88,1,2,3,6,7,42,12])),{ssr:!1}),vd=Mt(()=>_t(()=>import("./sso-dlecoq29tbbucwzg.js").then(t=>t.j),__vite__mapDeps([31,1,2,3,27,10,11,6,7,12,26,16,28,29,30,14,13,9,32,33,34,35,36,18,20,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,17,80,81,82,83,84,85,86])).catch(()=>()=>null),{ssr:!1}),Sd=Mt(()=>_t(()=>import("./sso-dlecoq29tbbucwzg.js").then(t=>t.P),__vite__mapDeps([31,1,2,3,27,10,11,6,7,12,26,16,28,29,30,14,13,9,32,33,34,35,36,18,20,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,17,80,81,82,83,84,85,86])).then(t=>t.default)),Cd=Mt(()=>_t(()=>import("./sso-dlecoq29tbbucwzg.js").then(t=>t.k),__vite__mapDeps([31,1,2,3,27,10,11,6,7,12,26,16,28,29,30,14,13,9,32,33,34,35,36,18,20,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,17,80,81,82,83,84,85,86])).then(t=>t.CAFeedbackModal).catch(()=>()=>null)),Qe=Ae({doNotShareSensitive:{id:"thread.modal.onboarding.title",defaultMessage:"Do not share sensitive materials with this application"},mayProduceInaccurateInformation:{id:"thread.chatgptMayProduceInaccurateInformation-oct-30",defaultMessage:"ChatGPT can make mistakes. Check important info."},mayProduceInaccurateInformationNoAuth:{id:"thread.chatgptMayProduceInaccurateInformationNoAuth-march-27",defaultMessage:"ChatGPT can make mistakes. Check important info. Read our <termsLink>Terms</termsLink> and <privacyLink>Privacy Policy</privacyLink>."},mayProduceInaccurateInformationNoAuthV2:{id:"thread.chatgptMayProduceInaccurateInformationNoAuth-may-06",defaultMessage:"By messaging ChatGPT, you agree to our <termsLink>Terms</termsLink> and have read our <privacyLink>Privacy Policy</privacyLink>."},mayProduceInaccurateInformationNoAuthKorea:{id:"thread.chatgptMayProduceInaccurateInformationNoAuthKorea-may-06",defaultMessage:"By messaging ChatGPT, you agree to our <termsLink>Terms</termsLink> and have read our <privacyLink>Privacy Policy</privacyLink> and its <koreaAddendumLink>Korea addendum</koreaAddendumLink>."},businessDisclaimer:{id:"thread.businessDisclaimer-oct-30",defaultMessage:"{workspaceName} workspace chats aren't used to train our models. ChatGPT can make mistakes."},businessDisclaimerNoName:{id:"thread.businessDisclaimerNoName-oct-30",defaultMessage:"Your workspace chats aren'ts used to train our models. ChatGPT can make mistakes."},outdatedGptDisclaimer:{id:"thread.outdatedGptDisclaimer.0",defaultMessage:"<bold>New version of GPT available</bold> - Continue chatting to use the old version, or start a <link>new chat</link> for the latest version."},somethingWentWrong:{id:"thread.modal.unrecoverableError.title",defaultMessage:"Something went wrong"},tryAgainLater:{id:"thread.modal.unrecoverableError.description",defaultMessage:"We're sorry, but something went wrong. Please try again later."},resetThread:{id:"thread.modal.unrecoverableError.resetThread",defaultMessage:"Reset thread"},sharedConversationReportConversation:{id:"thread.sharedConversation.report",defaultMessage:"Report conversation"},latencyButton:{id:"thread.latencyButton",defaultMessage:"Latency"},archivedConversationDescription:{id:"thread.archivedConversationDescription",defaultMessage:"This conversation is archived. To continue, please unarchive it first."},unarchiveButton:{id:"thread.unarchiveButton",defaultMessage:"Unarchive"}});function wd({clientThreadId:t}){const e=ct(t);return e!=null?n.jsx(Md,{clientThreadId:t,gizmoId:e}):n.jsx(io,{clientThreadId:t})}function Md({clientThreadId:t,gizmoId:e}){const s=is(e).data,a=Dn(i=>ls.getThreadCreateTime(t,i)),o=(s==null?void 0:s.gizmo.updated_at)!=null?new Date(s.gizmo.updated_at):void 0;return(s==null?void 0:s.gizmo.short_url)==null||o==null||a==null||o<=a?n.jsx(io,{clientThreadId:t}):n.jsxs("span",{className:"text-token-text-tertiary",children:[n.jsx(ul,{className:"text-token-secondary mb-1 mr-1 inline-block h-4 w-4 stroke-0"}),n.jsx(E,{...Qe.outdatedGptDisclaimer,values:{link:i=>n.jsx(Yo,{to:ti(s.gizmo.short_url),className:"underline",children:i}),bold:i=>n.jsx("span",{className:"text-token-secondary font-semibold",children:i})}})]})}function _d({clientThreadId:t}){return br(s=>s.hasAcceptedFooterDisclaimer)?n.jsx("span",{children:n.jsx(E,{...Qe.mayProduceInaccurateInformation})}):n.jsx(kd,{clientThreadId:t})}function io({clientThreadId:t}){const e=js(Rn.isBusinessWorkspace),s=js(c=>c.currentWorkspace),a=s==null?void 0:s.name,{isUnauthenticated:o,isLoading:i}=zt(),d=Ha({clientThreadId:t,role:ve.User})>0;return i?null:e?n.jsx("span",{children:a!=null?n.jsx(E,{...Qe.businessDisclaimer,values:{workspaceName:a}}):n.jsx(E,{...Qe.businessDisclaimerNoName})}):o&&!d?n.jsx(Qo,{children:n.jsx(_d,{clientThreadId:t})}):n.jsx("span",{children:n.jsx(E,{...Qe.mayProduceInaccurateInformation})})}function kd({clientThreadId:t}){const{country:e}=Jo(),s=e==="KR"?Qe.mayProduceInaccurateInformationNoAuthKorea:Qe.mayProduceInaccurateInformationNoAuthV2,{layer:a}=wt("3637408529"),o=(a==null?void 0:a.get("should_show_disclaimer_only_once_per_device",!1))??!1;return u.useEffect(()=>()=>{Ha({clientThreadId:t,role:ve.User})>0&&xr.updateHasAcceptedFooterDisclaimer(o)},[t,o]),n.jsx("span",{className:"text-sm",children:n.jsx(E,{...s,values:{privacyLink:i=>n.jsx("a",{href:"https://openai.com/privacy",target:"_blank",className:"text-token-text-primary underline decoration-token-text-primary",onClick:()=>{ot.logEvent("chatgpt_footer_disclaimer_privacy_link_clicked"),Z.logEvent(q.footerDisclaimerPrivacyLinkClicked)},rel:"noreferrer",children:i}),termsLink:i=>n.jsx("a",{href:"https://openai.com/terms",target:"_blank",className:"text-token-text-primary underline decoration-token-text-primary",onClick:()=>{ot.logEvent("chatgpt_footer_disclaimer_terms_link_clicked"),Z.logEvent(q.footerDisclaimerTermsLinkClicked)},rel:"noreferrer",children:i}),koreaAddendumLink:i=>n.jsx("a",{href:"https://openai.com/ko/policies/kr-privacy-policy-addendum",target:"_blank",className:"text-token-text-primary underline decoration-token-text-primary",onClick:()=>{ot.logEvent("chatgpt_footer_disclaimer_korea_addendum_link_clicked"),Z.logEvent(q.footerDisclaimerKoreaAddendumLinkClicked)},rel:"noreferrer",children:i})}})})}function Td({clientThreadId:t}){const e=_a(),s=zs(t),a=async()=>{s&&(await be.patchConversation(s,{is_archived:!1}),e.invalidateQueries({queryKey:["conversation",t]}),Dn.setState(o=>{const i=o.threads[s];i!=null&&(i.initialThreadData.isArchived=!1)}),yr(e))};return n.jsxs("div",{className:"my-6 flex flex-col items-center justify-center gap-4",children:[n.jsx("div",{className:"px-3 text-center text-sm text-token-text-secondary",children:n.jsx(E,{...Qe.archivedConversationDescription})}),n.jsx("div",{children:n.jsx(at,{disabled:!s,onClick:a,icon:hl,children:n.jsx(E,{...Qe.unarchiveButton})})})]})}function jd(t,e){const s=es(t),a=B.getTitle(t);return e&&e.kind===it.GizmoInteraction&&e.gizmo?s?`ChatGPT - ${e.gizmo.gizmo.display.name}`:a&&`${e.gizmo.gizmo.display.name} - ${a}`:s?"ChatGPT":a}const su=function({clientThreadId:t,initiallyHighlightedMessageId:e,continueConversationUrl:s,onCompletionFinished:a,preRequestCompletion:o,hideHeader:i,hideMessages:l,hideFooter:d,hideToolsOverlay:c,messagesVerticalAlign:m="top",prependThreadChildren:p,renderEmptyState:f}){var mt;const S=_a(),C=Do(),x=u.useContext(va),g=x!=null,b=Ot(),h=Fs(),y=Ma(),w=ks(),v=Ar(t),k=Lo(),R=g&&((mt=k.query)==null?void 0:mt.action)==="moderate",j=za(t),W=Os(t),I=Ga(t).isArchived;u.useEffect(()=>{j||(es(t)?Ms.addTiming("chatgpt.web.chatPage.renderNewConversation"):Ms.addTiming("chatgpt.web.chatPage.renderExistingConversation"))},[t,j]);const P=qr(t,W),D=Wa(t,W),U=Ua(t),{setTargetedContent:ie}=Ji(),ue=h==null?void 0:h.includes(Oo),L=Xi(),N=D>=2,ee=es(t)&&!N&&ln(v),Ce=es(t)&&!P&&(ln(v)||(v==null?void 0:v.kind)===it.GizmoTest),ne=Nl().id,Q=El(t)??ne,{value:he}=Ct("1410082514"),{value:V}=Ct("4203174056"),Te=Da(Q),Xe=Il()[Q],Ne=jd(t,v),Ee=Bs(t),$e=Zi(),dt=Nr(t),{config:Ze}=zo("1013114931"),kt=Ze.get("show_follow_ups",!1)&&(b==null?void 0:b.isPersonalAccount()),Ue=!w.displayingSideBySideFeedback&&kt,ut=St();u.useEffect(()=>{Yn()},[]),u.useEffect(()=>{$e||ie(void 0),B.getLastMessgageSystemHints(t,W).includes(rn.Search)||er(C.search).has(rn.Search)?Qn.addPersistedSystemHint(rn.Search):Qn.clear()},[t,ie,$e,W,C.search]);const cs=u.useCallback(z=>{if(z==null||(a==null||a(z),ut)||((Ee==null?void 0:Ee.kind)===it.GizmoInteraction&&Zo.handleGizmoInteracted(S,Ee.gizmo_id),!(dt||Ue)))return;const J=B.getThreadCurrentLeafId(z),ge=B.getTree(z).getMessage(J);Bo(ge)||Uo(ge)||tr(z,ge.id,Q)},[S,a,Ee,dt,Ue,Q,ut]),Gs=$r(t),Bt=Er(t,Gs,cs),Ut=u.useCallback(()=>{const z=B.getThreadCurrentLeafId(t);if(z==null)return;const J=B.getTree(t).getBranchFromLeaf(z);sr.abortRequests(J.map(ge=>ge.id))},[t]),O=rs(),{isUnauthenticated:Ge}=zt(),ds=nr(),Ke=u.useCallback(async({type:z,promptId:Se,requestedModelId:J,eventMetadata:ge,cancelActiveRequests:Ie,focusOnNewCompletion:We=!0,useDefaultModel:He,completionMetadata:Ve,appendMessages:jt,updateTree:ps,turnTracker:Gn})=>{Yn(),ar.reset(),Ie&&Ut();const Zs=performance.now();let At=Q;J?At=J:He&&(At=ne);const de=or({namespace:ir.CompletionRequest,key:Se});de==null||de.logTiming("start_chat_requirements");const gt=await Go();de==null||de.logTiming("fetched_chat_requirements"),gt.force_login&&ds({authType:"login"});const en=await Wo.getEnforcementToken(gt);de==null||de.logTiming("fetched_arkose_token");const tn=await rr.getEnforcementToken(gt);de==null||de.logTiming("fetched_turnstile_token");const sn=await Ho.getEnforcementToken(gt);de==null||de.logTiming("fetched_p_token"),o==null||o(t,Se),Bt({model:At,completionType:z,parentNodeId:Se,metadata:ge,focusOnNewCompletion:We,completionMetadata:Ve,chatReq:gt,arkoseToken:en??null,turnstileToken:tn??null,proofToken:sn??null,preflightTime:performance.now()-Zs,extraStreamParams:{forceParagen:O.forceParagen,forceParagenModel:O.forceParagenModel.value,forceNulligen:O.forceNulligen,forceRateLimit:O.forceRateLimit,resetRateLimits:O.resetRateLimits,disableSystemContentToggling:O.rebaseSystemMessageContent?!0:void 0,forceUseSearch:O.forceUseSearch??void 0},appendMessages:jt,updateTree:ps,turnTracker:Gn}),Ge&&lr.incrementUserMessageCount()},[ne,Q,o,t,Bt,O.forceParagen,O.forceParagenModel,O.forceNulligen,O.forceRateLimit,O.resetRateLimits,O.rebaseSystemMessageContent,O.forceUseSearch,Ut,ds,Ge]),Tt=!!(b!=null&&b.features.includes(Ps.SharedWebsocket));u.useEffect(()=>{Tt&&cn.registerIfNotConnected()},[Tt]),u.useEffect(()=>{const z=()=>{if(document.visibilityState==="visible"){if(!Tt)return;cn.registerIfNotConnected()}};return document.addEventListener("visibilitychange",z),()=>{document.removeEventListener("visibilitychange",z)}},[Tt]);const Gt=zs(t);u.useEffect(()=>{const z=()=>{cn.stopConversation(Gt)};return window.addEventListener("beforeunload",z),()=>{window.removeEventListener("beforeunload",z)}},[Gt]),ei({clientThreadId:t,currentLeafId:W,handleRequestCompletion:Ke});const us=u.useCallback((z,Se,J,ge=!0,Ie="none",We)=>{const Ve=B.getTree(t).getParentPromptNode(z).id;Ke({type:Ca.Variant,promptId:Ve,eventMetadata:Se,cancelActiveRequests:!1,focusOnNewCompletion:ge,useDefaultModel:We,completionMetadata:{variantPurpose:Ie,conversationMode:ls.getConversationMode(t)},turnTracker:J})},[Ke,t]),Ws=u.useCallback(z=>{const J=B.getTree(t).getLeafFromNode(z);B.setThreadCurrentLeafId(t,J.id)},[t]),[Hs,me]=u.useState(),Vs=u.useCallback(({nodeId:z,messageId:Se,rating:J})=>{var He,Ve;const ge=B.getServerThreadId(t);Z.logEvent(q.thumbRating,{id:Se,threadId:ge,rating:J,model:Q});const Ie=B.getTree(t),We=Ie.getNodeByIdOrMessageId(z);if(ge!==void 0&&(he&&((He=We.message.metadata)==null?void 0:He.snorkle_status)!=null?be.submitSnorkleFeedback:Te?bt:be.submitMessageFeedback)({message_id:Se,conversation_id:ge,rating:J}),B.updateTree(t,jt=>{jt.updateNodeMetadata(z,{rating:J})}),Te){me(n.jsx(Cd,{citations:((Ve=We.message.metadata)==null?void 0:Ve.citations)??[],rating:J,conversationId:ge??"",messageId:Se,onSubmit:()=>{me(void 0)},onCancel:()=>me(void 0),conversationTree:Ie,nodeId:z},`${z}-${J}`));return}},[t,Q,Te,he]),{setShowReferralInviteModal:hs}=Jn(z=>({setShowReferralInviteModal:z.setShowReferralInviteModal})),qs=u.useCallback(()=>{hs(!1)},[hs]),ms=Jn(z=>z.showReferralInviteModal);fd({clientThreadId:t,currentModelId:Q});const gs=z=>g?n.jsx("div",{className:"h-full overflow-auto bg-token-main-surface-primary",children:z}):n.jsx(wl,{scrollAnchorTopOffset:i?0:pr,children:m==="bottom"?n.jsxs("div",{className:"flex h-full flex-col",children:[n.jsx("div",{className:"flex-1"}),z]}):z});u.useEffect(()=>{document.title=Ne??"ChatGPT"},[Ne]);const Wt=ct(t),$s=St(),Ht=Ce&&!f&&y&&!Wt&&!Te&&!$s,Vt=zl(Ht),qt=Ht&&Vt,{composerBarSize:fs,composerSkeleton:$t,footerBarSize:Ks,isClippedComposerBar:ht,setComposerBarElement:Ys,setFooterBarElement:Qs,ThreadSizeWrapper:Js}=cr({isArchived:I}),Xs=ht?{footerBarSize:Ks,composerBarSize:fs}:{};return n.jsxs(Js,{...Xs,children:[ue&&n.jsx(yd,{}),V&&n.jsx(Sd,{}),n.jsxs(Vo,{children:[Ne!=null&&n.jsx("title",{children:Ne}),g&&n.jsxs(n.Fragment,{children:[n.jsx("meta",{property:"og:site_name",content:"ChatGPT"}),n.jsx("meta",{name:"robots",content:x.isIndexable?"index,nofollow":"noindex,nofollow"},"robots"),n.jsx("meta",{property:"og:title",content:Ne??"Shared Chat on ChatGPT"},"og:title"),n.jsx("meta",{property:"og:description",content:"Shared "+(U!=null?`by ${U} `:"")+"via ChatGPT"},"og:description"),n.jsx("meta",{property:"og:image",content:qo.src},"og:image")]})]}),(v==null?void 0:v.kind)===it.GizmoInteraction&&v.gizmo&&n.jsx(si,{gizmo:v.gizmo}),n.jsx(Sa.Provider,{value:Ke,children:n.jsxs(dr,{children:[n.jsxs(Ir,{clientThreadId:t,currentModelConfig:Xe,className:"composer-parent flex h-full flex-col focus-visible:outline-0",children:[!l&&n.jsx(Ad,{className:se(ht&&"masked-content"),style:{"--composer-bar_skeleton":$t},children:j?null:Ce?f??n.jsx($o,{shouldSSR:!Vt,children:n.jsx(oc,{clientThreadId:t,currentModelId:Q,onRequestCompletion:Ke,enableV2Homepage:qt})}):N?gs(n.jsxs(n.Fragment,{children:[p,n.jsx(md,{onChangeItemInView:Ws,onRequestMoreCompletions:us,onChangeRating:Vs,onRequestCompletion:Ke,clientThreadId:t,initiallyHighlightedMessageId:e,inlineEmbeddedDisplay:!1,conversationLeafId:W,hideHeader:i},t)]})):null}),n.jsx(Nd,{className:se(ht&&"mask-scrollbars absolute bottom-0 z-20"),children:I?n.jsx(Td,{clientThreadId:t}):n.jsxs("div",{className:se(ht&&"relative mx-auto flex max-w-3xl flex-1 flex-col"),children:[ht?n.jsx(ur,{skeleton:$t}):null,g?n.jsx(Jl,{clientThreadId:t,isModeratingThread:R,continueConversationUrl:s}):!qt&&n.jsx(Fr,{clientThreadId:t,isNewThread:ee,setComposerBarElement:Ys,showPromptStarters:ee||!P,currentModelId:Q,onRequestCompletion:Ke}),!d&&n.jsx("div",{ref:Qs,className:"relative w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",children:g?n.jsx(hr,{onClickReportSharedConversation:()=>{Ds.openModal(ts.ReportConversation)}}):ln(v)&&n.jsx(wd,{clientThreadId:t})})]})})]}),!c&&n.jsxs("div",{className:"group absolute bottom-2 end-2 z-20 hidden gap-1 md:flex lg:bottom-3 lg:end-3",children:[L?n.jsxs(n.Fragment,{children:[n.jsx(xd,{}),n.jsx(vd,{})]}):null,n.jsx(ml,{})]}),Hs,n.jsx(ni,{serverThreadId:(x==null?void 0:x.serverSharedThreadId)??void 0,clientThreadId:t,isStaticSharedThread:g}),n.jsx(Yl,{clientThreadId:t}),n.jsx(mr,{}),(h==null?void 0:h.includes(Ko))&&n.jsx(gr,{isOpen:ms,onClose:qs}),n.jsx(fr,{conversationId:t,currentModelId:Q})]})})]})},Ad=Je.div`grow flex-1 overflow-hidden`,Nd=Je.div`md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent w-full`;export{Ol as C,su as T,md as a,od as b,cd as m};
//# sourceMappingURL=l0hizc65fv5mapy4.js.map
