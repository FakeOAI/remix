import{r as b,U as L,cI as N,e1 as A,bq as x,ad as $,bD as C,A as f,an as u,au as w,B as h,a4 as T,bO as F,dF as O}from"./hwf9zvd1aw2q6bni.js";import{b_ as I,bK as j,b$ as Q,aL as s,c0 as V,b1 as Y,b2 as W,c1 as H,c2 as Z}from"./gcq6nq5ilw3cni50.js";import{e as J}from"./hpsvd424sjrdhlcq.js";import{T as D,g as X}from"./iifiuc3nib6ssn9e.js";const E="q",ee="m";function ae(e){const{clientThreadId:r,currentLeafId:n,handleRequestCompletion:t}=e,i=b.useRef(!1),{isLoading:o}=J(),a=L(),c=b.useCallback((y,d,p,z)=>{D.updateTree(r,v=>{v.addNode(y,p,d,N.User,void 0,z)})},[r]),l=b.useCallback(async(y,{content:d,attachments:p},z,v,K)=>{const k=n,B=p.length>0?{attachments:p}:{};c(y,k,d,B),t({type:A.Next,promptId:y,eventMetadata:z,cancelActiveRequests:!0,completionMetadata:v,turnTracker:K})},[c,t,n]),g=x(()=>window.location.pathname)??null;let G=!o&&ne(g);const q=X.getConversationMode(r),P=I();re(g)&&P===void 0&&(G=!1),b.useEffect(()=>{if(!G||i.current)return;const{[E]:y,[ee]:d,...p}=a.query,z=(typeof y=="string"?y:null)??(typeof d=="string"?d:null);if(!z||D.getServerThreadId(r)!=null||q==null)return;const v=$();i.current=!0,a.replace({query:p},void 0,{shallow:!0});const K=new j;l(v,{content:z,attachments:[]},{eventSource:"url"},{conversationMode:q,source:"instant-query"},K)},[G,a,l,r,q])}function re(e){return _(e)}function _(e){return e==null?!1:/^\/g\/[\w-]+$/.test(e)}function ne(e){return e==null?!1:e==="/"||_(e)}const ce="GPT Builder";function le(e){if(e)return`ChatGPT - ${e}`}function U(e){return e.gizmo.short_url??e.gizmo.id??"-"}function M(e){return`/g/${e}`}function ye(e){return`https://chatgpt.com${M(e)}`}function te(e){return M(U(e))}function me(e,r){const n=new URLSearchParams;return r!=null&&n.set(E,r),V(new URL(`${te(e)}?${n}`,"https://chatgpt.com"))}function fe(e){return`/g/${U(e)}`}function ge(e){return Y(e)&&e.gizmo.live_version===0||W(e)&&e.liveVersion===0}function de(e,r){return u({queryKey:["gizmos","discovery",{locale:e,isAnon:r}],queryFn:async()=>s.getGizmoDiscovery(e,r)})}function pe({cutId:e,locale:r,limit:n,cursor:t,enabled:i=!0}){return C({queryKey:["gizmos","discovery",{cutId:e,locale:r,limit:n}],queryFn:async({pageParam:o})=>s.getGizmoDiscoveryCut(e,{locale:r,cursor:o,limit:n}),initialPageParam:t,getNextPageParam:o=>o.list.cursor??void 0,enabled:i})}function ze(){return u({queryKey:["gizmos","pinned"],queryFn:async()=>s.getGizmoPinned()})}function S(){return w({queryKey:["gizmos","bootstrap"],queryFn:async()=>s.getGizmoBootstrap().then(e=>({gizmos:e.gizmos.map(r=>({resource:r.resource,flair:r.flair}))}))})}function he(){return u(S())}function R(e,r){const n=e.filter(i=>i.resource.gizmo.id!==r.resource.gizmo.id);let t=n.findIndex(i=>i.flair.kind===Q.Recent);return t===-1&&(t=n.length),n.splice(t,0,r),n}const Ge={handleGizmoInteracted(e,r){const n=e.getQueryData(m(e,r).queryKey);n!=null&&e.setQueryData(S().queryKey,t=>{if(t==null)return t;const i=t.gizmos.find(o=>o.resource.gizmo.id===r);return(i==null?void 0:i.flair.kind)===Q.FirstParty||(i==null?void 0:i.flair.kind)===Q.SidebarKeep?t:{gizmos:R(t.gizmos,{resource:n,flair:{kind:Q.Recent}})}})},handleGizmoSidebarKeep(e,r){const n=e.getQueryData(m(e,r).queryKey);n!=null&&e.setQueryData(S().queryKey,t=>t==null?t:{gizmos:R(t.gizmos,{resource:n,flair:{kind:Q.SidebarKeep}})})},handleGizmoSidebarHide(e,r){e.setQueryData(S().queryKey,n=>n!=null&&n.gizmos.some(t=>t.resource.gizmo.id===r)?{gizmos:n.gizmos.filter(t=>t.resource.gizmo.id!==r)}:n)}};function qe(e,r=!1){const n=f();return u(m(n,e,r))}function ve({gizmoId:e,draft:r,version:n}){const t=f(),i=n?{queryKey:["gizmo","version",{gizmoId:e,version:n}],queryFn:async()=>s.getVersion({gizmoId:e,version:n}),enabled:e!=null}:m(t,e,r);return u(i)}function Qe(e,r){return u({queryKey:["gizmo","userActionSettings",{gizmoId:e}],queryFn:async()=>s.getUserActionSettings(e),enabled:e!=null&&r})}function m(e,r,n=!1){return w({queryKey:["gizmo",{gizmoId:r},{draft:n}],queryFn:async()=>s.getGizmo(r,n),enabled:r!=null,initialData:()=>{var o,a;if(n===!0)return;const t=e.getQueryData(S().queryKey);if(t!=null)return(o=t.gizmos.find(c=>c.resource.gizmo.id===r))==null?void 0:o.resource;const i=e.getQueryData(["gizmos","discovery"]);if(i!=null)for(const c of i.cuts){const l=(a=c.list.items.find(g=>g.resource.gizmo.id===r))==null?void 0:a.resource;if(l!=null)return l}}})}function Se(e,r){return e.fetchQuery(m(e,r))}function be(e){return u({queryKey:["gizmo",{search:e}],queryFn:async()=>s.getGizmoSearch(e),enabled:e.length>0})}function Pe(e,r){return u({queryKey:["gizmo-search-workspace",{search:e}],queryFn:async()=>s.getGizmoSearchForWorkspace(e),enabled:e.length>0&&r})}function Ke(e,r=!1,n=!1,t=null){return C({queryKey:[n?"gizmo-search-workspace":"gizmo",{query:e,cursor:t}],queryFn:async({pageParam:i})=>n?s.getGizmoSearchForWorkspace(e,t=i):s.getGizmoSearch(e,t=i),initialPageParam:t,getNextPageParam:i=>i.cursor??void 0,enabled:r})}function Fe(){const e=f();return h({mutationFn:async({gizmoId:r,editorData:n})=>{const{instructions:t,name:i,description:o,profilePictureId:a,profilePictureUrl:c,promptStarters:l,tools:g,files:G,trainingDisabled:q}=n;return s.upsertDraft({instructions:t,display:{name:i,description:o,profile_pic_id:a,profile_picture_url:c,prompt_starters:l},tools:g,files:G.map(P=>({...P,location:H.FILE_SERVICE})),training_disabled:q},r)},onSettled:r=>{r&&(e.setQueryData(m(e,r.gizmo.id,!0).queryKey,r),e.invalidateQueries({queryKey:["gizmos","mine"],refetchType:"none"}))}})}function De(){const e=f();return h({mutationFn:async({gizmoId:r,data:n})=>{const{sharingRecipient:t,categories:i}=n,o=await s.promoteDraft({sharing:n.sharingSubjects&&n.sharingSubjects.length>0?n.sharingSubjects:{recipient:t},categories:i},r);if(o.error)throw new Z(o);return o.resource},onSettled:r=>{e.invalidateQueries({queryKey:["gizmos"],refetchType:"all"}),e.invalidateQueries({queryKey:["gizmos","pinned"],refetchType:"none"}),r&&e.setQueryData(m(e,r.gizmo.id,!1).queryKey,r)}})}function Re(){const e=f();return h({mutationFn:async({gizmoId:r})=>s.deleteGizmo(r),onSettled:()=>{e.invalidateQueries({queryKey:["gizmos"],refetchType:"all"})}})}function Ce(){const e=f();return h({mutationFn:async({name:r,hideName:n,websiteUrl:t,willReceiveSupportEmails:i})=>s.updateBuilderProfile({name:r,hide_name:n,website_url:t,will_receive_support_emails:i}),onSuccess:r=>{e.setQueryData(["builderProfile"],r)},onError:r=>{T.warning(r.message)}})}function we(){return u({queryKey:["builderProfile"],queryFn:async()=>s.getBuilderProfile()})}function Te(){return h({mutationFn:async({gizmoId:e})=>s.copyGizmo({gizmoId:e})})}function Ee(){return u({queryKey:["gizmoCategories"],queryFn:async()=>s.getCategories()})}function _e(e,r){return!!(r!=null&&[F.PrimaryAssistant,F.GizmoInteraction].includes(r)&&(e!=null&&e.includes(O.GPT_4)))}function Ue(e,r){const n=f();return h({mutationFn:async({rating:t,message:i,includeFrom:o})=>{await s.upsertUserReview(e,t,i,o)},onSuccess:async()=>{n.invalidateQueries({queryKey:["gizmo","review",{gizmoId:e}]})},onError:t=>{T.danger(t.message)}})}export{De as A,m as B,Se as C,_e as D,ce as E,Ge as G,Ue as a,Re as b,fe as c,he as d,pe as e,ze as f,te as g,ye as h,ge as i,me as j,Te as k,Qe as l,be as m,Pe as n,Ke as o,le as p,de as q,M as r,U as s,ae as t,qe as u,we as v,Ce as w,Ee as x,ve as y,Fe as z};
//# sourceMappingURL=d2enjwn8b6jly1r9.js.map
