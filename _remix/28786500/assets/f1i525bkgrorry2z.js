import{X as P,r as u,l as e,m as Z,a0 as de,aK as J,aA as ce,bg as V,$ as m,aQ as O,a as ue,h as ge,j as fe}from"./fdeezme0a1kjg5dr.js";import{c as pe,cf as he,ce as xe,a3 as S,I as ve,j as w,m as be,bL as Me,d as je,c_ as Se}from"./ogztjg6i1ufex94l.js";import{V as ee}from"./d3y72ugnrmac5z1v.js";import{S as we,c as Ee}from"./ldjt4f6cu7p4unqs.js";import{a as Ce,q as Ie,R as Ne}from"./l2x363deltqu16i4.js";function K(a){return a.split(/[\s,]+/)}function Re({value:a,onChange:n,className:M}){const g=P(),[o,d]=u.useState(""),E=u.useCallback(j=>{if(o)switch(j.key){case"Enter":case",":case" ":{const h=K(o);n([...a,...h.map(Q)]),d(""),j.preventDefault()}}},[o,n,a]),p=j=>{if(o){const h=K(o);n([...a,...h.map(Q)]),d(o),j.preventDefault()}};return e.jsx(we,{className:Z("react-select-container",M),isMulti:!0,onBlur:p,classNamePrefix:"react-select",components:ke,inputValue:o,isClearable:!0,menuIsOpen:!1,onChange:n,onInputChange:d,onKeyDown:E,placeholder:g.formatMessage(H.placeholder),value:a,"aria-labelledby":"add-emails-label",name:"add-member-emails"})}const Q=a=>({label:a,value:a,isValid:ee.test(a)}),ye=a=>{const n=P(),M=e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{children:a.children}),e.jsx(Ce,{className:"icon-sm"})]}),g=a.data.isValid?M:e.jsx(pe,{label:n.formatMessage(H.tooltipInvalidEmail,{email:a.data.value}),side:"top",children:M});return e.jsx(Ee.MultiValue,{...a,children:e.jsx("button",{className:Z("m-1 cursor-pointer rounded-full border border-transparent py-1 pl-3 pr-2 text-sm text-token-text-primary",a.data.isValid?"bg-token-main-surface-secondary hover:border-token-border-medium hover:bg-token-main-surface-tertiary":"bg-red-200 text-red-500"),onClick:o=>{a.removeProps.onClick?.(o),o.preventDefault()},"aria-label":n.formatMessage(H.removeMember,{member:a.data.value}),children:g})})},ke={DropdownIndicator:()=>null,IndicatorsContainer:()=>null,ClearIndicator:()=>null,MultiValueRemove:()=>null,MultiValue:ye},H=de({membersAdded:{id:"emailsTextarea.membersAdded",defaultMessage:"+{count} {count, plural, one {member} other {members}}"},removeMember:{id:"emailsTextarea.removeMember",defaultMessage:"Remove {member}"},tooltipInvalidEmail:{id:"emailsTextarea.tooltipInvalidEmail",defaultMessage:'"{email}" may not be a valid email'},clearAllEntries:{id:"emailsTextarea.clearAllEntries",defaultMessage:"Clear all"},placeholder:{id:"emailsTextarea.placeholder",defaultMessage:"Type an email and press enter..."}}),Te=`email,role
user1@company.com,member
admin@company.com,admin
it@company.com,owner`,ae=25,Y=[];function Oe({workspace:a,canResendInviteEmails:n,onCancel:M,cancelButtonText:g,onSuccess:o,fullWidthButtons:d=!1}){const E=a.isOwnerOfAccount(),[p,j]=u.useState(!1),[h,C]=u.useState(!1),R=u.useRef(null),c=a.isTeam(),l=P(),x=J(),{value:I}=ce("1666487044"),[k,z]=u.useState(!0),[W,A]=u.useState(!1),[N,T]=u.useState(0),[v,y]=u.useState([]),[B,U]=u.useState([]),{mutateAsync:te}=Ve(a.id,o),D=he(),q=xe()??!0,[_,X]=u.useState(Y);u.useEffect(()=>{if(!v?.length||!D?.length||q){X(Y);return}const s=D.map(t=>"@"+t.hostname.toLowerCase()),r=v.map(({email:t})=>t.toLowerCase()).filter(t=>!s.some(b=>t.endsWith(b)));X(r)},[D,q,v]);const f=Ae(E),ie=async s=>{const r=s.target.files?.[0];if(r){const t=await Pe(r,f,h);t.status==="success"?(y(t.newRows),T(1),C(t.hasWarning)):t.reason==="file_too_large"?x.danger(l.formatMessage(i.fileTooLargeWarning,{maxSize:`${ae}MB`}),{duration:5}):t.reason==="invalid_file_type"&&x.danger(l.formatMessage(i.fileIncorrectTypeWarning),{duration:5})}},F=(s,r,t)=>{const b=[...v];b[s]={...b[s],[r]:t},y(b)},se=s=>{const r=[...v.slice(0,s),...v.slice(s+1)];y(r)},$=u.useCallback(()=>{y([]),T(0),A(!1),U([])},[]),ne=async()=>{A(!0);try{v.length>5&&x.info(l.formatMessage(i.inviteMessageLoading,{numRows:v.length}),{hasCloseButton:!0});const s=[["admin",O.ADMIN],["owner",O.OWNER],["member",O.STANDARD]],t=(await Promise.all(je(s.map(([b,me])=>{const G=v.filter(L=>L.role===b).map(L=>L.email);return G.length>0&&te({emails:G,role:me,resendEmails:k})})))).flat().length;t>0&&x.success(l.formatMessage(i.inviteSuccessToast,{numRows:t,userStr:t===1?"user":"users",workspaceName:Se(l,a)})),o?.(),$()}finally{A(!1)}},le=()=>{const s=new Set,r=B.reduce((t,b)=>(s.has(b.value)||t.push(b.value),s.add(b.value),t),[]);y(r.map(t=>({email:t,role:f.member}))),T(1)},re=e.jsx(V,{color:"primary",size:d?"large":"medium",disabled:W||v.length===0||_.length>0,onClick:ne,children:W?l.formatMessage(i.inviteMemberInviteSubmitButtonLoading):l.formatMessage(i.inviteMemberInviteSubmitButton)}),oe=e.jsx(V,{color:"primary",size:d?"large":"medium",disabled:B.length===0,onClick:le,children:l.formatMessage(i.inviteMemberInviteNextButton)});return e.jsxs("div",{className:"flex flex-col gap-2",children:[N===0&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{htmlFor:"upload-csv",id:"upload-csv-label",children:e.jsx(m,{...i.importCSVLabel})}),e.jsxs("span",{className:"text-sm text-token-text-tertiary",children:[e.jsx(m,{...p?i.helperCSVFormatHide:i.helperCSVFormatShow,values:{link:s=>e.jsx("button",{className:"underline",onClick:()=>{j(!p)},children:s})}}),p&&e.jsx("pre",{className:"mt-4",children:Te})]})]}),e.jsx("input",{ref:R,type:"file",accept:".csv,text/csv",id:"upload-csv",className:"hidden",onChange:ie}),e.jsx(V,{color:"secondary",onClick:()=>R.current?.click(),children:e.jsx(m,{...i.importCSVButton})})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"add-member-emails",id:"add-emails-label",children:e.jsx(m,{...i.addEmailsFieldName})}),e.jsx(Re,{value:B,onChange:U})]})]}),N===1&&e.jsxs(e.Fragment,{children:[h&&e.jsxs("div",{className:"flex w-full items-center bg-yellow-100 p-4",children:[e.jsx(Ie,{className:"icon-sm mr-2 text-yellow-700"}),e.jsx("div",{className:"flex-grow text-yellow-700",children:e.jsx(m,{...i.unspecifiedRoleDescription})})]}),_.length>0&&e.jsx("div",{className:"flex w-full items-center bg-red-100 p-4",children:e.jsxs("div",{className:"flex-grow text-red-700",children:[e.jsx(m,{...i.prohibitedExternalEmailDescription}),e.jsx("pre",{className:"my-1",children:_.join(", ")}),e.jsx(m,{...i.prohibitedExternalEmailResolution})]})}),e.jsxs(S.Root,{size:"normal",children:[e.jsxs(S.Header,{children:[e.jsx(S.HeaderCell,{children:e.jsx(m,{...i.inviteTableHeaderEmail})}),e.jsx(S.HeaderCell,{className:"pl-3 dark:bg-gray-900",children:e.jsx(m,{...i.inviteTableHeaderRole})}),e.jsx(S.HeaderCell,{})]}),e.jsx(S.Body,{children:v.map((s,r)=>e.jsxs(S.Row,{children:[e.jsx(S.Cell,{children:e.jsx(ve,{name:"email",type:"email",value:s.email,onChange:t=>F(r,"email",t.target.value),color:"neutral"})}),e.jsx(S.Cell,{children:I?e.jsxs("select",{value:s.role,onChange:t=>F(r,"role",t.target.value),children:[e.jsx("option",{value:f.member,children:e.jsx(m,{...i.inviteRoleMember})}),f.admin&&e.jsx("option",{value:f.admin,children:e.jsx(m,{...i.inviteRoleAdmin})}),f.owner&&e.jsx("option",{value:f.owner,children:e.jsx(m,{...i.inviteRoleOwner})})]}):e.jsxs(w.Root,{value:s.role,onValueChange:t=>F(r,"role",t),children:[e.jsxs(w.Trigger,{children:[e.jsx(w.Value,{}),e.jsx(w.Icon,{})]}),e.jsx(w.Portal,{children:e.jsxs(w.Content,{className:"border border-token-main-surface-secondary",children:[e.jsx(w.Item,{value:f.member,children:e.jsx(m,{...i.inviteRoleMember})}),f.admin&&e.jsx(w.Item,{value:f.admin,children:e.jsx(m,{...i.inviteRoleAdmin})}),f.owner&&e.jsx(w.Item,{value:f.owner,children:e.jsx(m,{...i.inviteRoleOwner})})]})})]})}),e.jsx(S.Cell,{textAlign:"right",children:e.jsx(Ne,{onClick:()=>se(r),className:"icon-sm mr-2 cursor-pointer text-token-text-secondary"})})]},r))})]})]}),n&&z&&e.jsx("div",{className:"mt-2 flex items-center text-left text-token-text-secondary",children:e.jsx(be,{id:"resend-emails",checked:k,onChange:s=>z(s.currentTarget.checked),label:l.formatMessage(i.resendEmailsFieldName)})}),N===0&&c&&e.jsx("div",{className:"mb-4",children:e.jsx(Me,{children:e.jsx(m,{...i.teamInviteModalNote})})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(V,{color:"secondary",size:d?"large":"medium",onClick:()=>{N!==0?T(0):($(),M())},children:N===0?g:l.formatMessage(i.inviteMemberInviteBackButton)}),N===0?oe:re]})]})}function Ve(a,n){const M=P(),g=J(),o=ue();return ge({mutationFn:async({emails:d,role:E,resendEmails:p})=>{const j=[],h=Math.max(5,Math.round(d.length/10));for(let c=0;c<d.length;c+=h)j.push(d.slice(c,c+h));const C=async c=>fe.addWorkspaceUsers(a,c,E,p).then(l=>(l.errored_emails.length>0&&g.danger(M.formatMessage(i.inviteMessageFailure,{emailsStr:l.errored_emails.map(({email_address:x,error:I})=>`${x}: ${I}`).join(", ")})),l.account_invites)).catch(l=>{throw g.danger(l.message),l});return(await Promise.all(j.map(c=>C(c)))).flat()},onSuccess:()=>{o.invalidateQueries({queryKey:["workspace","invites",a]}),n?.()}})}function Pe(a,n,M){return new Promise(g=>{if(a.size/1048576>ae)g({status:"error",reason:"file_too_large"});else if(a.type!=="text/csv")g({status:"error",reason:"invalid_file_type"});else{const d=new FileReader;d.readAsText(a),d.onload=function(E){let p=M;const h=(E.target?.result).split(`
`),C=new Set,R=h.reduce((c,l)=>{const[x,I]=l.split(",").map(k=>k.trim());return ee.test(x)&&!C.has(x)&&(n[I]===void 0&&!p&&(p=!0),c.push({email:x,role:n[I]??n.member})),C.add(x),c},[]);g({status:"success",newRows:R,hasWarning:p})}}})}const Ae=a=>{const n={member:"member"};return a&&(n.admin="admin",n.owner="owner"),n},i={importCSVLabel:{id:"adminPage.importCSVLabel",defaultMessage:"Import from CSV",description:"Name of label for import from CSV button"},helperCSVFormatHide:{id:"adminPage.helperCSVFormat",defaultMessage:'The file must include email and an optional role on each line. Roles can be "member", "admin", or "owner". <link>Hide Example</link>',description:"Instructions for formatting the import CSV, with a link to hide the example"},helperCSVFormatShow:{id:"adminPage.helperCSVFormat",defaultMessage:'The file must include email and an optional role on each line. Roles can be "member", "admin", or "owner". <link>Show Example</link>',description:"Instructions for formatting the import CSV, with a link to show an example"},importCSVButton:{id:"adminPage.importCSVButton",defaultMessage:"Upload",description:"Name of upload from CSV button"},addEmailsFieldName:{id:"adminPage.addEmailsFieldName.0",defaultMessage:"Emails",description:"Name of input for adding emails to workspace"},unspecifiedRoleDescription:{id:"adminPage.unspecifiedRoleDescription",defaultMessage:"Roles that were unspecified have been changed to Member.",description:"Description text for defaulting invite roles to member"},prohibitedExternalEmailDescription:{id:"adminPage.prohibitedExternalEmailDescription",defaultMessage:"The following emails are not a part of your organization's verified domains:",description:"Description text for error message"},prohibitedExternalEmailResolution:{id:"adminPage.prohibitedExternalEmailResolution",defaultMessage:'Either remove these emails, enable "Allow External Domain Invites" from your workspace settings, or verify these email domains.',description:"Description text for error message"},inviteTableHeaderEmail:{id:"adminPage.inviteTableHeaderEmail",defaultMessage:"Email",description:"Label for email column of invite table header"},inviteTableHeaderRole:{id:"adminPage.inviteTableHeaderRole",defaultMessage:"Role",description:"Label for role column of invite table header"},inviteRoleMember:{id:"adminPage.inviteRoleMember",defaultMessage:"Member",description:"Member role for workspace invite"},inviteRoleAdmin:{id:"adminPage.inviteRoleAdmin",defaultMessage:"Admin",description:"Admin role for workspace invite"},inviteRoleOwner:{id:"adminPage.inviteRoleOwner",defaultMessage:"Owner",description:"Owner role for workspace invite"},fileTooLargeWarning:{id:"adminPage",defaultMessage:"File is too large. Please upload a CSV file smaller than {maxSize}.",description:"Error when uploading a file that is too large"},fileIncorrectTypeWarning:{id:"adminPage",defaultMessage:"Please upload a CSV file.",description:"Error when uploading a file that is not a CSV"},resendEmailsFieldName:{id:"adminPage.resendEmailsFieldName",defaultMessage:"Resend emails for existing invites",description:"Name of checkbox input for resending emails to workspace"},teamInviteModalNote:{id:"adminPage.teamInviteModalNote",defaultMessage:"Users that accept invites will be included as additional seats on your next invoice.",description:"Note for team plan invites that additional seats will be charged"},inviteMessageLoading:{id:"adminPage.inviteMessageLoading",defaultMessage:"Sending out {numRows} invites, this may take a minute...",description:"Loading message when invites are being sent"},inviteSuccessToast:{id:"adminPage.inviteSuccessToast",defaultMessage:"Invited {numRows} {userStr} to {workspaceName}",description:"Message on successfully sending out invites"},inviteMemberInviteNextButton:{id:"adminPage.inviteMemberInviteNextButton",defaultMessage:"Next",description:"The title of the invite member modal next button"},inviteMemberInviteSubmitButton:{id:"adminPage.inviteMemberInviteSubmitButton",defaultMessage:"Send invites",description:"The title of the invite member modal submit button"},inviteMemberInviteSubmitButtonLoading:{id:"adminPage.inviteMemberInviteSubmitButtonLoading",defaultMessage:"Sending invites...",description:"Button label while inviting members"},inviteMemberInviteBackButton:{id:"adminPage.inviteMemberInviteBackButton",defaultMessage:"Back",description:"The title of the invite member modal back button"},inviteMessageFailure:{id:"adminPage.inviteMessageFailure",defaultMessage:"Unable to invite {emailsStr}",description:"Message that shows which emails were unsuccessful at being invited"}};export{Oe as A};
//# sourceMappingURL=f1i525bkgrorry2z.js.map
