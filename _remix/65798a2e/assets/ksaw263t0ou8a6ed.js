const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/gqa89l3bi0a4s01z.js","assets/m3881aktdta1pmc9.js","assets/n08taxuyverhgw48.js","assets/root-ie6krroj.css","assets/okmdvzkaebtartz7.js","assets/conversation-small-nydj7mps.css","assets/fzrn137102spawew.js"])))=>i.map(i=>d[i]);
import{gy as R,aG as z,aH as D,m as e,c8 as E,aK as P,r as x,aW as F,bG as H,aC as N,H as A}from"./m3881aktdta1pmc9.js";import{C as L}from"./dth71ee1c9ir3pi8.js";import{a4 as U}from"./n08taxuyverhgw48.js";import{D as $}from"./fo8h1fudd51ycc31.js";import{a as I,U as B,b as M}from"./ji8co3lt7ifa0jjz.js";import{a as J}from"./f4h93d6f92v4wlrs.js";import{cS as G,cT as W,cU as b,cV as _,cW as X,cX as K}from"./okmdvzkaebtartz7.js";import"./lx0tnz3gus66xrl0.js";import"./c4bxzbp1808foto4.js";import"./npaasg82f36eft31.js";import"./hgpkzi331bvjoltd.js";import"./ctfc6epnqodujrj5.js";function q(s){return R({tag:"svg",attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{d:"M9 9H4v1h5V9z"}},{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M5 3l1-1h7l1 1v7l-1 1h-2v2l-1 1H3l-1-1V6l1-1h2V3zm1 2h4l1 1v4h2V3H6v2zm4 1H3v7h7V6z"}}]})(s)}function Q(s){return R({tag:"svg",attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{d:"M9 9H4v1h5V9z"}},{tag:"path",attr:{d:"M7 12V7H6v5h1z"}},{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M5 3l1-1h7l1 1v7l-1 1h-2v2l-1 1H3l-1-1V6l1-1h2V3zm1 2h4l1 1v4h2V3H6v2zm4 1H3v7h7V6z"}}]})(s)}const Y=z(()=>D(()=>import("./gqa89l3bi0a4s01z.js"),__vite__mapDeps([0,1,2,3,4,5,6])));function pe({threadId:s,threadUserId:a}){return I(B.isDebugModalOpen)&&e.jsx(E,{isOpen:!0,onClose:()=>M.toggleDebugModalOpen(),type:"success",size:"fullscreen",noPadding:!0,rootClassName:"z-50",children:e.jsx(te,{threadId:s,threadUserId:a??void 0,onClose:()=>M.toggleDebugModalOpen()})})}const Z=(s,a)=>{const l=JSON.stringify(a,null,2),o=new Blob([l],{type:"application/json"}),r=window.URL.createObjectURL(o),c=document.createElement("a");c.href=r,c.download=s,c.click(),window.URL.revokeObjectURL(r)},S="<|im_start|>",V="<|im_sep|>",T="<|im_end|>",ee="<|fim_suffix|>";function se({prompt:s}){const[a,l]=x.useState({}),o=[],r=[];let c=0;for(;;){const n=s.indexOf(S,c);if(n===-1)break;const i=s.indexOf(V,n);if(i===-1)break;let t=s.indexOf(T,i);const h=s.indexOf(ee,i);if(h!==-1&&(t===-1||h<t)&&(t=h),t===-1)break;const u=s.substring(n+S.length,i),g=s.substring(i+V.length,t);r.push(n),o.push(e.jsxs("button",{onClick:()=>l(f=>({...f,[n]:!f[n]})),className:"text-left",children:[e.jsxs("span",{className:"font-semibold",children:["[",u,"]"]}),e.jsx("div",{className:N("whitespace-pre-wrap",a[n]&&"line-clamp-2 truncate"),children:g})]},n)),c=t+T.length}function p(n){const i={};for(const t of r)i[t]=n;l(i)}return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"absolute right-0 top-0 flex items-center gap-2 text-xs font-semibold",children:[e.jsx("button",{className:"underline",onClick:()=>p(!0),children:"Collapse All"}),"/",e.jsx("button",{className:"underline",onClick:()=>p(!1),children:"Expand All"})]}),e.jsx("div",{className:"flex flex-col gap-3",children:o})]})}const j=P.div`mb-[-5px] pb-0.5 font-semibold uppercase border-b-2 ${({$isSelected:s})=>s?"border-black dark:border-white":"border-transparent"}`;function te({threadId:s,threadUserId:a,message:l,onClose:o}){const[r,c]=x.useState(l?"message":"json"),{data:p,isLoading:n,refetch:i}=J({threadId:s,threadUserId:a,refetchOnMount:"always"}),t=p?.thread;if(x.useEffect(()=>{c(l?"message":t?.turns.length?`turn${t?.turns.length-1}`:"thread")},[t?.turns.length,l]),!n&&!t&&!l)return e.jsxs($,{onClickRetry:()=>i(),children:["Failed to load."," "]});if(n)return e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:"Loading..."});const h=t?.turns,u=t?.turns[t.turns.length-1],g=u?.artifacts__?.model_snapshots?.default_id,f=u?.artifacts__?.settings?.model_response?.completion_model?.model,C=g??f,v=u?.artifacts__?.eval_preset,k=a&&s?K(a,s):null;return e.jsx("div",{className:"flex flex-col gap-2 break-words font-mono text-xs",children:e.jsxs(G,{orientation:"vertical",value:r,onValueChange:m=>c(m),children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs(W,{className:"flex items-center justify-start gap-3 p-2",children:[l&&e.jsx(b,{value:"message",children:e.jsx(j,{$isSelected:r==="message",children:"Message"})},"message"),t&&e.jsx(b,{value:"thread",children:e.jsx(j,{$isSelected:r==="thread",children:"Thread"})},"thread"),h?.map((m,d)=>e.jsxs(x.Fragment,{children:[e.jsx(b,{value:`turn${d}`,children:e.jsxs(j,{$isSelected:r===`turn${d}`,children:["Turn[",d,"]"]})},d),m.artifacts__?.debug_ddtrace_urls?.map(y=>e.jsx(j,{$isSelected:!1,children:e.jsxs("a",{target:"_blank",href:y,className:"text-nowrap",rel:"noreferrer",children:["Trace[",d,"] â†—"]})},y))]},d))]}),e.jsxs("div",{className:"flex items-center justify-end",children:[t&&e.jsxs(F,{size:"xs",color:"secondary",onClick:()=>Z("thread.json",t),children:[e.jsx(U,{className:"icon-sm"})," thread.json"]}),e.jsx(H,{onClick:o})]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-2",children:[C&&e.jsxs(e.Fragment,{children:[e.jsx(w,{name:"Model",id:C,className:"flex-shrink-0"})," ",e.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),v&&v!=="production"&&e.jsxs(e.Fragment,{children:[e.jsx(w,{name:"Eval Preset",id:v,className:"flex-shrink-0"}),e.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),k&&e.jsx(e.Fragment,{children:e.jsx(w,{name:"Permalink",id:k,className:"flex-shrink-1"})})]}),h?.map((m,d)=>e.jsxs(_,{value:`turn${d}`,className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth",children:[e.jsxs("div",{className:N("flex flex-col gap-2 p-2",(m.index??0)%2===0&&"bg-token-main-surface-secondary"),children:[e.jsx(se,{prompt:m.artifacts__?.debug_info?.main_model_response?.prompt_string??""}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"[assistant]"}),e.jsx("div",{"data-testid":"assistant-response",className:"whitespace-pre-wrap",children:m.model_response?.text})]})]})," "]},d)),t&&e.jsx(_,{value:"thread",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:e.jsx(O,{data:t,collapsed:4})}),l&&e.jsx(_,{value:"message",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:e.jsx(O,{data:l,collapsed:4})})]},t?.turns.length??"message")})}function O({data:s,collapsed:a}){const[l,o]=x.useState(a??!0);return e.jsxs("div",{className:"flex flex-col items-start gap-1",children:[e.jsx("button",{onClick:()=>o(!l),className:"flex items-center gap-1",children:l?e.jsxs(e.Fragment,{children:[e.jsx(Q,{size:14})," Expand all"]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{size:14})," Collapse all"]})}),e.jsx("div",{className:"w-full",children:e.jsx(Y,{json:s,jsonViewProps:{collapsed:l,shortenTextAfterLength:0}},String(l))})]})}function w({name:s,id:a,className:l}){const o=A(),r=x.useCallback(c=>{X(a,o,c)},[a,o]);return e.jsxs("div",{className:N("flex items-center gap-2 truncate",l),children:[e.jsxs("span",{className:"text-nowrap font-semibold",children:[s,":"]}),e.jsx("span",{title:a,className:"truncate text-gray-500 dark:text-white",children:a}),e.jsx(L,{onCopy:r})]})}export{O as DebugJsonViewer,pe as DebugModal,te as DebugModalContents};
//# sourceMappingURL=ksaw263t0ou8a6ed.js.map
