import{a4 as B,r as j,c5 as b,j as e,ay as p,t as h,ax as V,T as M,u as D,a as N,I as X,R as E,G as C}from"./hc9xxm00a3r3byem.js";import{C as S}from"./hdncrjsjzzuve3ru.js";import{I as z,z as c}from"./ozzpumen10p6g0yq.js";import{a1 as Q}from"./fga5qe14lr2llx8v.js";import{u as K}from"./cj3cq0j3ew1e2kbz.js";function G(t){const d=D();return N({mutationFn:({hostname:i})=>E.addDomainToWorkspace(t,i),onSuccess:()=>{d.invalidateQueries({queryKey:["workspace/identity",t]}),d.invalidateQueries({queryKey:["builderProfile"]})},onError:i=>{h.danger(i.message)}})}function Y(t){const d=D();return N({mutationFn:({domainId:i})=>E.checkDomainForWorkspace(t,i),onSuccess:()=>{d.invalidateQueries({queryKey:["workspace/identity",t]}),d.invalidateQueries({queryKey:["builderProfile"]})},onError:i=>{h.danger(i.message)}})}function P({workspaceId:t,isOpen:d,onClose:i,currentDomain:s,domains:r=[],showUnverifiedDomains:T=!1,onVerifyDomain:x}){const n=B(),{mutateAsync:_,isPending:R}=G(t),{mutateAsync:A,isPending:F}=Y(t),[a,v]=j.useState(s??void 0),[m,H]=j.useState(s==null?void 0:s.hostname),[u,f]=j.useState((s==null?void 0:s.status)===void 0?0:(s==null?void 0:s.status)===b.PENDING?1:2),y=()=>{s||(v(void 0),f(0))},k=async()=>{if(m===void 0)return;const l=r.find(g=>g.hostname===m&&g.status===b.PENDING);if(l)v(l),f(1);else{const g=await _({hostname:m});"id"in g&&v(g),f(1)}},I=e.jsx(p.Button,{title:n.formatMessage(o.check),color:"primary",disabled:(a==null?void 0:a.id)===void 0||F,onClick:async()=>{if(a!=null&&a.id){const l=await A({domainId:a.id});"error"in l&&h.danger(n.formatMessage(o.domainCheckError,{message:l.error.message})),"id"in l&&(x&&x(l),l.status===b.VERIFIED&&f(2))}}}),w=e.jsx(p.Button,{title:n.formatMessage(o.submit),color:"primary",disabled:m===void 0||R,onClick:k}),q=e.jsx(p.Button,{title:n.formatMessage(o.done),color:"primary",onClick:()=>{y(),i()}});return e.jsxs(V,{isOpen:d,onClose:()=>{y(),i()},type:"success",className:"text-token-text-secondary",title:n.formatMessage(u===0?o.newTitle:o.editTitle),primaryButton:u===0?w:u===1?I:q,secondaryButton:e.jsx(p.Button,{title:n.formatMessage(o.cancel),color:"secondary",onClick:()=>{y(),i()}}),children:[u===0&&e.jsx(O,{hostname:m,onSetHostname:H,onSubmit:k,unverifiedDomains:T?r:[],onVerifyDomain:l=>{f(1),v(l)},workspaceId:t}),u===1&&e.jsxs("div",{className:"flex flex-col gap-3",children:[n.formatMessage(o.verificationTokenMessage,{hostname:a==null?void 0:a.hostname}),(a==null?void 0:a.dns_verification_token_string)&&e.jsx(S,{value:a.dns_verification_token_string,onCopied:()=>{h.success(n.formatMessage(o.copiedTXTRecordToClipboard),{duration:3})}}),e.jsx(M,{...o.verificationTokenFooter})]}),u===2&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(M,{...o.successfulVerification,values:{hostname:a==null?void 0:a.hostname}}),(a==null?void 0:a.dns_verification_token_string)&&e.jsx(S,{value:a.dns_verification_token_string,onCopied:()=>{h.success(n.formatMessage(o.copiedTXTRecordToClipboard),{duration:3})}})]})]})}function W({unverifiedDomains:t,onVerifyDomain:d,workspaceId:i}){const{mutateAsync:s}=K(i);return e.jsxs(c.Root,{fixed:!0,size:"compact",className:"mb-6 border-b border-token-border-light",children:[e.jsxs(c.Header,{children:[e.jsx(c.HeaderCell,{children:e.jsx(M,{...o.unverifiedDomainsTableHeader})}),e.jsx(c.HeaderCell,{textAlign:"right"})]}),t.map(r=>e.jsxs(c.Row,{children:[e.jsx(c.Cell,{children:r.hostname}),e.jsx(c.Cell,{textAlign:"right",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{color:"secondary",size:"small",onClick:()=>d(r),children:e.jsx(M,{...o.verifyDomainButton})}),e.jsx(C,{color:"secondary",size:"small",onClick:()=>s({domainId:r.id}),icon:Q})]})})]},r.id))]})}function O({hostname:t,onSetHostname:d,onSubmit:i,unverifiedDomains:s,onVerifyDomain:r,workspaceId:T}){const x=B();return e.jsxs(e.Fragment,{children:[s&&s.length>0&&e.jsx(W,{workspaceId:T,unverifiedDomains:s,onVerifyDomain:r}),e.jsx("form",{onSubmit:n=>{n.preventDefault(),i()},children:e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 flex items-center text-sm font-semibold",children:e.jsx(M,{...o.domainInput})}),e.jsx(z,{name:"hostname",placeholder:x.formatMessage(o.placeholder),value:t??"",onChange:n=>{d(n.target.value)}})]})})]})}const o=X({newTitle:{id:"domainModal.newTitle.0",defaultMessage:"Verify a new domain"},editTitle:{id:"domainModal.editTitle",defaultMessage:"Manage Domain"},submit:{id:"domainModal.submit",defaultMessage:"Submit"},check:{id:"domainModal.check",defaultMessage:"Check"},done:{id:"domainModal.done",defaultMessage:"Done"},cancel:{id:"domainModal.cancel",defaultMessage:"Cancel"},domainInput:{id:"domainModal.domainInput.0",defaultMessage:"Add a new domain"},placeholder:{id:"domainModal.placeholder",defaultMessage:"openai.com"},domainCheckError:{id:"domainModal.domainCheckError",defaultMessage:"Your domain could not be verified: {message}"},verificationTokenMessage:{id:"domainModal.verificationTokenMessage",defaultMessage:"To verify ownership of {hostname}, navigate to your DNS provider and add a TXT record with this value:"},verificationTokenFooter:{id:"domainModal.verificationTokenFooter",defaultMessage:"Then, check the record to complete the verification."},successfulVerification:{id:"domainModal.successfulVerification.0",defaultMessage:'Your domain, "{hostname}" has been successfully verified'},copiedTXTRecordToClipboard:{id:"domainModal.copiedTXTRecordToClipboard",defaultMessage:"Copied DNS TXT record to clipboard"},verifyDomainButton:{id:"domainModal.verifyDomainButton",defaultMessage:"Verify"},unverifiedDomainsTableHeader:{id:"domainModal.unverifiedDomainsTableHeader",defaultMessage:"Your unverified domains"}});export{P as D};
//# sourceMappingURL=j8vh1bvwq2thm6el.js.map
