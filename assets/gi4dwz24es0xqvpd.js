import{r as e}from"./hc9xxm00a3r3byem.js";import{u as w,f as O}from"./ovjwzbtdrcsgos3a.js";import{be as L,bf as U,bg as A,bh as B,bi as G}from"./ozzpumen10p6g0yq.js";function K(){const t=e.useRef(!1);return w(()=>(t.current=!0,()=>{t.current=!1}),[]),t}function S(){const t=K(),[u,r]=e.useState(0),c=e.useCallback(()=>{t.current&&r(u+1)},[u]);return[e.useCallback(()=>O.postRender(c),[c]),u]}const k=({children:t,initial:u,isPresent:r,onExitComplete:c,custom:h,presenceAffectsLayout:m,mode:l})=>{const i=L(T),R=e.useId(),d=e.useMemo(()=>({id:R,initial:u,isPresent:r,custom:h,onExitComplete:n=>{i.set(n,!0);for(const o of i.values())if(!o)return;c&&c()},register:n=>(i.set(n,!1),()=>i.delete(n))}),m?void 0:[r]);return e.useMemo(()=>{i.forEach((n,o)=>i.set(o,!1))},[r]),e.useEffect(()=>{!r&&!i.size&&c&&c()},[r]),l==="popLayout"&&(t=e.createElement(U,{isPresent:r},t)),e.createElement(A.Provider,{value:d},t)};function T(){return new Map}const f=t=>t.key||"";function V(t,u){t.forEach(r=>{const c=f(r);u.set(c,r)})}function _(t){const u=[];return e.Children.forEach(t,r=>{e.isValidElement(r)&&u.push(r)}),u}const H=({children:t,custom:u,initial:r=!0,onExitComplete:c,exitBeforeEnter:h,presenceAffectsLayout:m=!0,mode:l="sync"})=>{const i=e.useContext(B).forceRender||S()[0],R=K(),d=_(t);let n=d;const o=e.useRef(new Map).current,y=e.useRef(n),p=e.useRef(new Map).current,x=e.useRef(!0);if(w(()=>{x.current=!1,V(d,p),y.current=n}),G(()=>{x.current=!0,p.clear(),o.clear()}),x.current)return e.createElement(e.Fragment,null,n.map(s=>e.createElement(k,{key:f(s),isPresent:!0,initial:r?void 0:!1,presenceAffectsLayout:m,mode:l},s)));n=[...n];const g=y.current.map(f),M=d.map(f),P=g.length;for(let s=0;s<P;s++){const a=g[s];M.indexOf(a)===-1&&!o.has(a)&&o.set(a,void 0)}return l==="wait"&&o.size&&(n=[]),o.forEach((s,a)=>{if(M.indexOf(a)!==-1)return;const b=p.get(a);if(!b)return;const z=g.indexOf(a);let E=s;if(!E){const I=()=>{o.delete(a);const v=Array.from(p.keys()).filter(C=>!M.includes(C));if(v.forEach(C=>p.delete(C)),y.current=d.filter(C=>{const F=f(C);return F===a||v.includes(F)}),!o.size){if(R.current===!1)return;i(),c&&c()}};E=e.createElement(k,{key:f(b),isPresent:!1,onExitComplete:I,custom:u,presenceAffectsLayout:m,mode:l},b),o.set(a,E)}n.splice(z,0,E)}),n=n.map(s=>{const a=s.key;return o.has(a)?s:e.createElement(k,{key:f(s),isPresent:!0,presenceAffectsLayout:m,mode:l},s)}),e.createElement(e.Fragment,null,o.size?n:n.map(s=>e.cloneElement(s)))};export{H as A,S as u};
//# sourceMappingURL=gi4dwz24es0xqvpd.js.map
