import{r as P,S as k,cC as N,dT as A,b9 as $,c3 as x,bs as C,z as m,af as u,am as F,A as h,a2 as D,bH as K,dz as O}from"./jeen44fo1keunqlc.js";import{cs as H,ct as S,aB as i,cu as j,cv as V,cw as Y,cx as W,cy as I}from"./osf8maqq52t0ie0w.js";import{e as J}from"./ca4desjes5mv8zbl.js";import{T as R,g as Z}from"./h2ieknsganxwp6x6.js";const E="q",X="m";function ce(e){const{clientThreadId:r,currentLeafId:t,handleRequestCompletion:n}=e,s=P.useRef(!1),{isLoading:o}=J(),a=k(),c=P.useCallback((y,d,p,z)=>{R.updateTree(r,v=>{v.addNode(y,p,d,N.User,void 0,z)})},[r]),l=P.useCallback(async(y,{content:d,attachments:p},z,v)=>{const L=t,B=p.length>0?{attachments:p}:{};c(y,L,d,B),n({type:A.Next,promptId:y,eventMetadata:z,cancelActiveRequests:!0,completionMetadata:v})},[c,n,t]),g=$(()=>window.location.pathname)??null;let G=!o&&re(g);const q=Z.getConversationMode(r),Q=H();ee(g)&&Q===void 0&&(G=!1),P.useEffect(()=>{if(!G||s.current)return;const{[E]:y,[X]:d,...p}=a.query,z=(typeof y=="string"?y:null)??(typeof d=="string"?d:null);if(!z||R.getServerThreadId(r)!=null||q==null)return;const v=x();s.current=!0,a.replace({query:p},void 0,{shallow:!0}),l(v,{content:z,attachments:[]},{eventSource:"url"},{conversationMode:q,source:"instant-query"})},[G,a,l,r,q])}function ee(e){return T(e)}function T(e){return e==null?!1:/^\/g\/[\w-]+$/.test(e)}function re(e){return e==null?!1:e==="/"||T(e)}const le="GPT Builder";function ye(e){if(e)return`ChatGPT - ${e}`}function b(e){return e.gizmo.short_url??e.gizmo.id??"-"}function _(e){return`/g/${e}`}function fe(e){return`https://chatgpt.com${_(e)}`}function te(e){return _(b(e))}function me(e,r){const t=new URLSearchParams;return r!=null&&t.set(E,r),j(new URL(`${te(e)}?${t}`,"https://chatgpt.com"))}function ge(e){return`/g/${b(e)}`}function de(e){return V(e)&&e.gizmo.live_version===0||Y(e)&&e.liveVersion===0}function pe(e,r){return u({queryKey:["gizmos","discovery",{locale:e,isAnon:r}],queryFn:async()=>i.getGizmoDiscovery(e,r)})}function ze({cutId:e,locale:r,limit:t,cursor:n,enabled:s=!0}){return C({queryKey:["gizmos","discovery",{cutId:e,locale:r,limit:t}],queryFn:async({pageParam:o})=>i.getGizmoDiscoveryCut(e,{locale:r,cursor:o,limit:t}),initialPageParam:n,getNextPageParam:o=>o.list.cursor??void 0,enabled:s})}function he(){return u({queryKey:["gizmos","pinned"],queryFn:async()=>i.getGizmoPinned()})}function w(){return F({queryKey:["gizmos","bootstrap"],queryFn:async()=>i.getGizmoBootstrap().then(e=>({gizmos:e.gizmos.map(r=>({resource:r.resource,flair:r.flair}))}))})}function Ge(){return u(w())}function U(e,r){const t=e.filter(s=>s.resource.gizmo.id!==r.resource.gizmo.id);let n=t.findIndex(s=>s.flair.kind===S.Recent);return n===-1&&(n=t.length),t.splice(n,0,r),t}const qe={handleGizmoInteracted(e,r){const t=e.getQueryData(f(e,r).queryKey);t!=null&&e.setQueryData(w().queryKey,n=>{if(n==null)return n;const s=n.gizmos.find(o=>o.resource.gizmo.id===r);return(s==null?void 0:s.flair.kind)===S.FirstParty||(s==null?void 0:s.flair.kind)===S.SidebarKeep?n:{gizmos:U(n.gizmos,{resource:t,flair:{kind:S.Recent}})}})},handleGizmoSidebarKeep(e,r){const t=e.getQueryData(f(e,r).queryKey);t!=null&&e.setQueryData(w().queryKey,n=>n==null?n:{gizmos:U(n.gizmos,{resource:t,flair:{kind:S.SidebarKeep}})})},handleGizmoSidebarHide(e,r){e.setQueryData(w().queryKey,t=>t!=null&&t.gizmos.some(n=>n.resource.gizmo.id===r)?{gizmos:t.gizmos.filter(n=>n.resource.gizmo.id!==r)}:t)}};function ve(e,r=!1){const t=m();return u(f(t,e,r))}function Se({gizmoId:e,draft:r,version:t}){const n=m(),s=t?{queryKey:["gizmo","version",{gizmoId:e,version:t}],queryFn:async()=>i.getVersion({gizmoId:e,version:t}),enabled:e!=null}:f(n,e,r);return u(s)}function we(e,r){return u({queryKey:["gizmo","userActionSettings",{gizmoId:e}],queryFn:async()=>i.getUserActionSettings(e),enabled:e!=null&&r})}function f(e,r,t=!1){return F({queryKey:["gizmo",{gizmoId:r},{draft:t}],queryFn:async()=>i.getGizmo(r,t),enabled:r!=null,initialData:()=>{var o,a;if(t===!0)return;const n=e.getQueryData(w().queryKey);if(n!=null)return(o=n.gizmos.find(c=>c.resource.gizmo.id===r))==null?void 0:o.resource;const s=e.getQueryData(["gizmos","discovery"]);if(s!=null)for(const c of s.cuts){const l=(a=c.list.items.find(g=>g.resource.gizmo.id===r))==null?void 0:a.resource;if(l!=null)return l}}})}function Pe(e,r){return e.fetchQuery(f(e,r))}function Qe(e){return u({queryKey:["gizmo",{search:e}],queryFn:async()=>i.getGizmoSearch(e),enabled:e.length>0})}function be(e,r){return u({queryKey:["gizmo-search-workspace",{search:e}],queryFn:async()=>i.getGizmoSearchForWorkspace(e),enabled:e.length>0&&r})}function Ke(e,r=!1,t=!1,n=null){return C({queryKey:[t?"gizmo-search-workspace":"gizmo",{query:e,cursor:n}],queryFn:async({pageParam:s})=>t?i.getGizmoSearchForWorkspace(e,n=s):i.getGizmoSearch(e,n=s),initialPageParam:n,getNextPageParam:s=>s.cursor??void 0,enabled:r})}function Re(){const e=m();return h({mutationFn:async({gizmoId:r,editorData:t})=>{const{instructions:n,name:s,description:o,profilePictureId:a,profilePictureUrl:c,promptStarters:l,tools:g,files:G,trainingDisabled:q}=t;return i.upsertDraft({instructions:n,display:{name:s,description:o,profile_pic_id:a,profile_picture_url:c,prompt_starters:l},tools:g,files:G.map(Q=>({...Q,location:W.FILE_SERVICE})),training_disabled:q},r)},onSettled:r=>{r&&(e.setQueryData(f(e,r.gizmo.id,!0).queryKey,r),e.invalidateQueries({queryKey:["gizmos","mine"],refetchType:"none"}))}})}function Ue(){const e=m();return h({mutationFn:async({gizmoId:r,data:t})=>{const{sharingRecipient:n,categories:s}=t,o=await i.promoteDraft({sharing:t.sharingSubjects&&t.sharingSubjects.length>0?t.sharingSubjects:{recipient:n},categories:s},r);if(o.error)throw new I(o);return o.resource},onSettled:r=>{e.invalidateQueries({queryKey:["gizmos"],refetchType:"all"}),e.invalidateQueries({queryKey:["gizmos","pinned"],refetchType:"none"}),r&&e.setQueryData(f(e,r.gizmo.id,!1).queryKey,r)}})}function Ce(){const e=m();return h({mutationFn:async({gizmoId:r})=>i.deleteGizmo(r),onSettled:()=>{e.invalidateQueries({queryKey:["gizmos"],refetchType:"all"})}})}function Fe(){const e=m();return h({mutationFn:async({name:r,hideName:t,websiteUrl:n,willReceiveSupportEmails:s})=>i.updateBuilderProfile({name:r,hide_name:t,website_url:n,will_receive_support_emails:s}),onSuccess:r=>{e.setQueryData(["builderProfile"],r)},onError:r=>{D.warning(r.message)}})}function De(){return u({queryKey:["builderProfile"],queryFn:async()=>i.getBuilderProfile()})}function Ee(){return h({mutationFn:async({gizmoId:e})=>i.copyGizmo({gizmoId:e})})}function Te(){return u({queryKey:["gizmoCategories"],queryFn:async()=>i.getCategories()})}function _e(e,r){return!!(r!=null&&[K.PrimaryAssistant,K.GizmoInteraction].includes(r)&&(e!=null&&e.includes(O.GPT_4)))}function Me(e,r){const t=m();return h({mutationFn:async({rating:n,message:s,includeFrom:o})=>{await i.upsertUserReview(e,n,s,o)},onSuccess:async()=>{t.invalidateQueries({queryKey:["gizmo","review",{gizmoId:e}]})},onError:n=>{D.danger(n.message)}})}function Le(e,r){return r?`/g/${b(r)}/c/${e}`:`/c/${e}`}function Be(){return"/gpts"}function ke(){return"/gpts/mine"}function M(e){return e?`/gpts/editor/${e}`:"/gpts/editor"}function Ne(e){const r=ne();return e==null?r:M(e)}function ne(e){return M(e)}function Ae(e){try{const r=new URL(e);return r.hostname=r.hostname.replace(/^(www\.|web\.|mbasic\.|mobile\.)(secure\.)?/,""),r.pathname="",[...r.searchParams.keys()].forEach(t=>r.searchParams.delete(t)),r.toString()}catch{return e}}function se(e){if(!e)return null;try{return new URL(e).hostname}catch{return null}}function $e(e){const r=se(e);return r?r.replace(/^www\./,""):e}export{Te as A,De as B,Se as C,Re as D,Ue as E,f as F,qe as G,Fe as H,_ as I,Pe as J,_e as K,le as L,ce as M,Me as a,Ce as b,ge as c,M as d,te as e,ne as f,Le as g,$e as h,de as i,Ge as j,ze as k,he as l,fe as m,me as n,Ae as o,ye as p,we as q,Ne as r,Ee as s,ke as t,ve as u,Be as v,Qe as w,be as x,Ke as y,pe as z};
//# sourceMappingURL=iw6awycy9wj28390.js.map
