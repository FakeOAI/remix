const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/l0ck5iwhjqvqib0b.js","assets/hc9xxm00a3r3byem.js","assets/fga5qe14lr2llx8v.js","assets/root-gxieg4k5.css","assets/hzcrrlyorrog0p41.js","assets/ozzpumen10p6g0yq.js","assets/index-small-c8xg50op.css","assets/e70ig0kgiu5e598s.js","assets/bhuxwenpl900hvjj.js"])))=>i.map(i=>d[i]);
import{a4 as P,r as h,j as e,T as a,G as O,I as q,ay as T,ax as Y,c as ee,t as N,bQ as ae,aj as re,ak as le,E as de,u as ce,c5 as ue,d3 as me,dW as ge}from"./hc9xxm00a3r3byem.js";import{a as pe,b as fe,A as xe}from"./lmryd6g8vt3gp93f.js";import{u as te}from"./nug034oo81goid6a.js";import{T as R}from"./hzcrrlyorrog0p41.js";import{a2 as ye,a0 as he,W as be,b5 as Se,at as Me,b3 as je,aq as J}from"./fga5qe14lr2llx8v.js";import{D as C}from"./i9qil017zb3p1czr.js";import{z as f,I as ve}from"./ozzpumen10p6g0yq.js";import{D as Ie}from"./j8vh1bvwq2thm6el.js";import{u as we,D as Ce,c as Ae,d as ke,e as se,I as De,f as Te,g as Le,h as Ee}from"./cj3cq0j3ew1e2kbz.js";import{C as F}from"./hdncrjsjzzuve3ru.js";import{f as $,a as Be,d as V,e as X}from"./bhuxwenpl900hvjj.js";import{u as Re,b as Oe}from"./fdepw20m3sce5u4k.js";import"./lxui8l23v2tzixf9.js";import"./facz9srd4e5z6fv5.js";import"./olkgl1p4p1b910lq.js";import"./guykwp3ov0cliuel.js";import"./fi9p3eeu24b9vfd1.js";import"./cqwvbnjobeewuxnd.js";import"./iyldmwu8ywhos7ff.js";import"./ovjwzbtdrcsgos3a.js";import"./eq9w2mijkl5gcncq.js";import"./k0a5tmklve7lhdwt.js";import"./io7lyk89lbveno1g.js";import"./kwn3fefba30wvgsb.js";import"./jt3dvx97wm610wtl.js";import"./caxkuyopolf76hse.js";import"./exuoj3g9rvnr47xj.js";import"./c6gg5hubzrgc52sj.js";import"./o65h1gsmgo0mfsrq.js";import"./nbrfb6b5fqz7ea4t.js";import"./lyr64vj216kc7moh.js";import"./l02mntsvyz06f5g3.js";import"./dkb2noz4qv6snkbi.js";import"./do5dtfxps7uqtxpp.js";import"./fr59f31fg6jwe2u4.js";import"./b2rny0kod41myp87.js";import"./kptbw01pxwd1ocyc.js";import"./cm4yp0pj7foedy4v.js";import"./dsvckya76mm06sjp.js";import"./iej0cupg2dqkmejt.js";class D extends Error{}D.prototype.name="InvalidTokenError";function Pe(s){return decodeURIComponent(atob(s).replace(/(.)/g,(o,n)=>{let i=n.charCodeAt(0).toString(16).toUpperCase();return i.length<2&&(i="0"+i),"%"+i}))}function Ue(s){let o=s.replace(/-/g,"+").replace(/_/g,"/");switch(o.length%4){case 0:break;case 2:o+="==";break;case 3:o+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return Pe(o)}catch{return atob(o)}}function _e(s,o){if(typeof s!="string")throw new D("Invalid token specified: must be a string");o||(o={});const n=o.header===!0?0:1,i=s.split(".")[n];if(typeof i!="string")throw new D(`Invalid token specified: missing part #${n+1}`);let t;try{t=Ue(i)}catch(l){throw new D(`Invalid token specified: invalid base64 for part #${n+1} (${l.message})`)}try{return JSON.parse(t)}catch(l){throw new D(`Invalid token specified: invalid json for part #${n+1} (${l.message})`)}}function Ne({onRemoveDomainClick:s,onVerifyDomainClick:o}){return e.jsxs(C.Root,{children:[e.jsx(C.Trigger,{children:e.jsx(he,{className:"icon-sm"})}),e.jsx(C.Portal,{children:e.jsxs(C.Content,{children:[e.jsx(C.Item,{onClick:s,children:e.jsx(a,{...L.ssoDropdownRemoveButtonText})}),e.jsx(C.Item,{onClick:o,children:e.jsx(a,{...L.ssoDropdownVerifyButtonText})})]})})]})}function Fe({domains:s,workspaceId:o}){const n=P(),{mutateAsync:i}=we(o),[t,l]=h.useState(!1),[p,x]=h.useState();return e.jsxs(e.Fragment,{children:[e.jsxs(f.Root,{className:"w-full table-auto",children:[e.jsxs(f.Header,{children:[e.jsx(f.HeaderCell,{className:"bg-token-main-surface-primary",children:e.jsx(a,{...L.domainTableHeader})}),e.jsx(f.HeaderCell,{className:"bg-token-main-surface-primary",children:e.jsx(a,{...L.statusTableHeader})}),e.jsx(f.HeaderCell,{className:"bg-token-main-surface-primary"})]}),e.jsx(f.Body,{children:s.map((u,j)=>e.jsxs("tr",{onClick:()=>x(u),className:"cursor-pointer",children:[e.jsx(f.Cell,{children:u.hostname}),e.jsx(f.Cell,{children:n.formatMessage(Ce[u.status])}),e.jsx(f.Cell,{textAlign:"right",children:e.jsx("div",{onClick:m=>m.stopPropagation(),children:e.jsx(Ne,{onRemoveDomainClick:()=>{i({domainId:u.id})},onVerifyDomainClick:()=>{x(u)}})})})]},j))})]}),e.jsx(O,{color:"secondary",className:"mt-6",onClick:()=>{l(!0)},icon:ye,children:e.jsx(a,{...L.addDomainButton})}),e.jsx(Ie,{isOpen:t||p!==void 0,onClose:()=>{l(!1),x(void 0)},workspaceId:o,currentDomain:t?void 0:p,domains:s},p==null?void 0:p.id)]})}const L=q({ssoDropdownRemoveButtonText:{id:"workspaceIdentity.ssoDropdownRemoveButtonText",defaultMessage:"Remove Domain"},ssoDropdownVerifyButtonText:{id:"workspaceIdentity.ssoDropdownVerifyButtonText",defaultMessage:"Verify"},domainTableHeader:{id:"workspaceIdentity.domainTableHeader",defaultMessage:"Domain"},statusTableHeader:{id:"workspaceIdentity.statusTableHeader",defaultMessage:"Status"},addDomainButton:{id:"workspaceIdentity.addDomainButton.0",defaultMessage:"Add domain"}}),He=async s=>new Promise((o,n)=>{const i=new FileReader;i.readAsText(s),i.onload=function(t){var l;o((l=t.target)==null?void 0:l.result)},i.onerror=n});function qe({acsId:s,hasSSO:o}){const n=`https://auth0.openai.com/login/callback?connection=${s}`,i=`urn:auth0:openai:${s}`,t=`${location.host}/auth/login?sso=true&connection=${s}`,l=P();return e.jsxs(e.Fragment,{children:[e.jsx($,{children:e.jsx(a,{...c.setupSSOContent})}),e.jsxs("div",{className:"mb-6 flex flex-col space-y-4",children:[e.jsx(F,{label:"Assertion Consumer Service (ACS) URL",value:n,onCopied:()=>{N.success(l.formatMessage(c.copiedACSToClipboard),{duration:3})}}),e.jsx(F,{label:"Entity ID",value:i,onCopied:()=>{N.success(l.formatMessage(c.copiedEntityToClipboard),{duration:3})}}),o&&e.jsx(F,{label:l.formatMessage(c.idpSignInURL),value:t,onCopied:()=>{N.success(l.formatMessage(c.copiedIDPUrlToClipboard),{duration:3})}})]})]})}function $e({workspaceId:s,data:o,isOpen:n,onClose:i}){const t=P(),l=te(),{mutateAsync:p}=Ae(s),{mutateAsync:x}=ke(s),{mutateAsync:u}=se(s),j=h.useRef(null),m=o==null?void 0:o.connection,[b,A]=h.useState(m==null?void 0:m.sign_in_endpoint),[k,y]=h.useState(!1),[S,E]=h.useState(m==null?void 0:m.cert),v=o===null?1:2,U=async(d,g)=>{let I;try{I=await p({signInEndpoint:d,cert:g})}catch(w){if(w instanceof ae&&w.code==="reauth_required"){y(!0);return}throw w}await u({connectionId:I.id,active:!0}),i()},B=v===1?e.jsx(T.Button,{title:t.formatMessage(c.doneButton),color:"primary",disabled:b===void 0||S===void 0,onClick:async()=>{b===void 0||S===void 0||await U(b,S)}}):o&&e.jsx(T.Button,{title:t.formatMessage(c.doneButton),color:"primary",onClick:async()=>{await u({connectionId:o==null?void 0:o.id,cert:S,signInEndpoint:b,active:!0}),i()}}),_=o===null?e.jsx(T.Button,{title:t.formatMessage(c.cancelButton),color:"secondary",onClick:()=>i()}):e.jsx(O,{as:"link",color:"danger-outline",onClick:async()=>{await x({connectionId:o==null?void 0:o.id}),i()},children:t.formatMessage(c.deleteButton)});return e.jsx(Y,{isOpen:n,type:"success",title:t.formatMessage(v===1?c.createTitle:c.editTitle),primaryButton:B,secondaryButton:_,onClose:i,children:e.jsxs("form",{onSubmit:d=>d.preventDefault(),children:[e.jsx(De,{children:e.jsx(a,{...c.createInstructionsManual})}),e.jsx("label",{className:"mb-2 flex items-center text-sm",children:e.jsx(a,{...c.signInLabel})}),e.jsx("div",{className:"mb-4",children:e.jsx(ve,{className:"w-full appearance-none rounded border px-3 py-2",name:"Sign-In URL",type:"text",placeholder:"https://your.idp.here/saml2?idpid=123456",value:b??"",onChange:d=>{A(d.target.value)}})}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("label",{className:"text-sm",children:e.jsx(a,{...c.certLabel})}),e.jsx("input",{ref:j,type:"file",accept:".csv,.cer,.pem,text/plain",className:"hidden",onChange:async d=>{var g;if((g=d.target.files)!=null&&g[0]){const I=await He(d.target.files[0]);E(I)}}}),e.jsx(O,{color:"secondary",onClick:()=>{var d;return(d=j.current)==null?void 0:d.click()},icon:be})]}),e.jsx("textarea",{rows:10,className:ee("w-full resize-none overflow-y-auto rounded border border-gray-300 px-3 py-2","outline-none focus-within:border-green-600 focus-within:ring-1 focus-within:ring-green-600","text-token-text-primary placeholder-gray-500 dark:bg-gray-700"),placeholder:"-----BEGIN CERTIFICATE-----",value:S??"",onChange:d=>{E(d.target.value)}})]}),k&&e.jsx("label",{className:"text-token-text-error",children:e.jsx(a,{id:"ZfFabW",defaultMessage:"You need to re-authenticate to access this page. Please <login>log in</login> before continuing.",values:{login:d=>e.jsx("a",{href:"#",className:"text-token-text-primary underline",onClick:g=>{g.preventDefault(),l({authType:"login",callbackUrl:"/admin/identity"})},children:d})}})})]})})}const c=q({setupSSOContent:{id:"workspaceIdentity.setupSSOContent",defaultMessage:"Anyone using email addresses with a verified domain can log in via SAML SSO."},createInstructionsXML:{id:"ssoModal.createInstructionsXML",defaultMessage:"If your Identity Provider offers a metadata URL or an XML file, add it here for the quickest setup option."},createInstructionsManual:{id:"ssoModal.createInstructionsManual",defaultMessage:"Copy your Sign-in endpoint (SSO URL) and the public X.509 certificate from your Identity Provider."},createTitle:{id:"ssoModal.createTitle",defaultMessage:"Create SAML SSO Configuration"},editTitle:{id:"ssoModal.editTitle",defaultMessage:"Edit SAML SSO Configuration"},ssoMetadataLabel:{id:"ssoModal.ssoMetadataLabel",defaultMessage:"App Federation Metadata URL"},signInLabel:{id:"ssoModal.signInLabel",defaultMessage:"SSO URL"},certLabel:{id:"ssoModal.certLabel",defaultMessage:"X.509 Signing Certificate"},doneButton:{id:"ssoModal.doneButton",defaultMessage:"Done"},nextButton:{id:"ssoModal.nextButton",defaultMessage:"Next"},deleteButton:{id:"ssoModal.deleteButton",defaultMessage:"Delete configuration"},cancelButton:{id:"ssoModal.cancelButton",defaultMessage:"Cancel"},acsURLLabel:{id:"workspaceIdentity.acsURLLabel",defaultMessage:"Assertion Consumer Service (ACS) URL"},entityIDLabel:{id:"workspaceIdentity.entityIDLabel",defaultMessage:"Entity ID"},idpSignInURL:{id:"workspaceIdentity.idpSignInURL",defaultMessage:"IDP Tile URL"},copiedACSToClipboard:{id:"workspaceIdentity.copiedACSToClipboard",defaultMessage:"Copied ACS URL to clipboard"},copiedEntityToClipboard:{id:"workspaceIdentity.copiedEntityToClipboard",defaultMessage:"Copied entity ID to clipboard"},copiedIDPUrlToClipboard:{id:"workspaceIdentity.copiedIDPUrlToClipboard",defaultMessage:"Copied IDP URL to clipboard"},orDivider:{id:"workspaceIdentity.orDivider",defaultMessage:"or"},certExtractFailed:{id:"workspaceIdentity.certExtractFailed",defaultMessage:"Unable to find X.509 Certificate in provided XML"},ssoUrlExtractFailed:{id:"workspaceIdentity.ssoUrlExtractFailed",defaultMessage:"Unable to find Entity ID (sign-in endpoint) in provided XML"},ssoLearnMoreLink:{id:"workspaceIdentity.ssoLearnMoreLink",defaultMessage:"Learn more"}}),Ve=re(()=>le(()=>import("./l0ck5iwhjqvqib0b.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(s=>s.DirectorySyncSection)),Xe=({title:s,footer:o,children:n})=>e.jsxs(V,{children:[e.jsx(X,{children:e.jsx(a,{...s})}),e.jsx("div",{children:n}),e.jsx($,{children:o})]}),H=({icon:s,title:o,body:n,toggle:i})=>e.jsxs(V,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s,{className:"icon-sm"}),e.jsx(X,{children:e.jsx(a,{...o})})]}),e.jsx("div",{children:i})]}),e.jsx($,{children:n})]});function ze({currentWorkspaceId:s}){var z,Q,G,Z,K,W;const{value:o}=de("3999712942"),n=P(),i=ce(),{data:t,isLoading:l}=Te(s),p=te(),{mutateAsync:x}=se(s),{variables:u,mutateAsync:j}=Le(s),{variables:m,mutateAsync:b}=Ee(s),A=(t==null?void 0:t.sso_connection)!=null,k=t==null?void 0:t.domains,y=!!(k!=null&&k.some(M=>M.status===ue.VERIFIED)),S=A?r.ssoEditButton:r.ssoAddButton,[E,v]=h.useState(!1),[U,B]=h.useState(!1),_=((z=t==null?void 0:t.sso_connection)==null?void 0:z.status)==="ACTIVE",d=((Z=(G=(Q=t==null?void 0:t.sso_connection)==null?void 0:Q.connection)==null?void 0:G.enabled_client_names)==null?void 0:Z.includes("chat"))??!1,g=_&&d,I=(K=t==null?void 0:t.sso_connection)==null?void 0:K.id,w=(m==null?void 0:m.shouldAllowExternalDomainInvites)??(t==null?void 0:t.allow_external_domain_invites)??!0,ne=y,ie=t?e.jsxs(Be,{children:[o&&e.jsx(Ve,{workspaceId:s}),e.jsx(Xe,{title:r.domainSubtitle,footer:e.jsx(e.Fragment,{children:e.jsx(a,{...r.verifyDomainInfoText})}),children:e.jsx(Fe,{domains:t.domains,workspaceId:s})}),e.jsx(H,{icon:Se,title:r.autoProvisionTitle,body:e.jsx(e.Fragment,{children:e.jsx(a,{...r.autoProvisionBody})}),toggle:e.jsx(R,{disabled:!y,enabled:(u==null?void 0:u.shouldAutoProvision)??t.should_auto_provision,onChange:M=>{j({shouldAutoProvision:M})},label:n.formatMessage(r.toggleAutoProvisionLabel)})}),ne&&e.jsx(H,{icon:Me,title:r.allowExternalDomainInvitesTitle,body:e.jsx(e.Fragment,{children:e.jsx(a,{...r.allowExternalDomainInvitesBody})}),toggle:e.jsx(R,{disabled:!y&&w,enabled:w,onChange:M=>{b({shouldAllowExternalDomainInvites:M})},label:n.formatMessage(r.toggleDisableExternalDomainInvitesLabel)})}),e.jsxs(V,{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:ee("icon-sm",g?"text-blue-600":"text-token-text-tertiary")}),e.jsx(X,{children:e.jsx(a,{...r.ssoTitle})})]}),A&&e.jsx("div",{children:e.jsx(R,{enabled:g,onChange:()=>{x({connectionId:I,active:!g})},label:n.formatMessage(r.ssoToggleActive)})})]}),y&&e.jsx(qe,{acsId:t.acs_id,hasSSO:A}),e.jsxs("div",{children:[e.jsx(O,{as:"button",color:"primary",disabled:!y,onClick:()=>{Qe(i)?B(!0):v(!0)},children:e.jsx(a,{...S})}),e.jsx($e,{workspaceId:s,data:t.sso_connection,isOpen:U,onClose:()=>{B(!1)}}),e.jsx(Y,{isOpen:E,onClose:()=>v(!1),type:"warning",title:n.formatMessage(r.reauthRequiredTitle),icon:J,primaryButton:e.jsx(T.Button,{onClick:()=>{p({authType:"login",callbackUrl:"/admin/identity"})},color:"primary",children:e.jsx(a,{id:"qcl4gn",defaultMessage:"Login"})}),secondaryButton:e.jsx(T.Button,{onClick:()=>v(!1),children:e.jsx(a,{id:"E1vtdZ",defaultMessage:"Close"})}),children:e.jsx("label",{className:"mb-2 flex items-center text-sm",children:n.formatMessage(r.reauthRequiredExplanation)})})]})]}),t.sso_connection&&e.jsx(H,{icon:J,title:r.enforceSSOTitle,body:e.jsx(e.Fragment,{children:e.jsx(a,{...r.enforceSSOBody})}),toggle:e.jsx(R,{disabled:!y,enabled:(W=t.sso_connection.auth0_enforced_clients)==null?void 0:W.includes("chat"),onChange:M=>{x({connectionId:t.sso_connection.id,enforcedClients:M?["chat"]:[]})},label:n.formatMessage(r.enforceSSOLabel)})})]}):null;return e.jsxs(e.Fragment,{children:[e.jsx(me,{children:e.jsx("title",{children:n.formatMessage(r.title)})}),e.jsx(pe,{title:n.formatMessage(r.title)}),e.jsx(fe,{showSpinner:l,children:ie})]})}const r=q({title:{id:"workspaceIdentity.title",defaultMessage:"Identity & Provisioning"},domainSubtitle:{id:"workspaceIdentity.domainSubtitle",defaultMessage:"Domain management"},ssoTitle:{id:"workspaceIdentity.ssoTitle",defaultMessage:"Single Sign On"},ssoToggleActive:{id:"WorkspaceIdentityPage.ssoToggleActive",defaultMessage:"Enable SSO for this workspace"},ssoAddButton:{id:"workspaceIdentity.ssoAddButton",defaultMessage:"Add SAML SSO"},ssoEditButton:{id:"workspaceIdentity.ssoEditButton",defaultMessage:"Edit SAML SSO"},autoProvisionTitle:{id:"workspaceIdentity.autoProvisionSubtitle",defaultMessage:"Automatic account creation"},autoProvisionBody:{id:"workspaceIdentity.autoProvisionBody",defaultMessage:"Automatically create workspace accounts for new users who log in with a verified domain."},toggleAutoProvisionLabel:{id:"workspaceIdentity.toggleAutoProvisionLabel",defaultMessage:"Toggle to enable or disable auto provisioning"},allowExternalDomainInvitesTitle:{id:"RQGwuu",defaultMessage:"Allow External Domain Invites"},allowExternalDomainInvitesBody:{id:"7KRqHk",defaultMessage:"If not checked, future invitations to this workspace will be limited to users from this organization's verified domains"},toggleDisableExternalDomainInvitesLabel:{id:"bQy24Z",defaultMessage:"Toggle to enable or disable external domain invites"},enforceSSOTitle:{id:"workspaceIdentity.enforceSSOTitle",defaultMessage:"Enforce SSO log in"},enforceSSOBody:{id:"workspaceIdentity.enforceSSOBody",defaultMessage:"When SSO is active, users will no longer be able to use social logins and will be redirected to your SSO portal."},enforceSSOLabel:{id:"workspaceIdentity.enforceSSOLabel",defaultMessage:"Toggle to enable or disable SSO enforcement"},verifyDomainInfoText:{id:"workspaceIdentity.verifyDomainInfoText",defaultMessage:"Verify ownership of an email domain to access advanced security features including single sign-on."},learnMoreLink:{id:"workspaceIdentity.learnMoreLink",defaultMessage:"Learn more"},reauthRequiredTitle:{id:"workspaceIdentity.reauthRequiredTitle",defaultMessage:"Please login again"},reauthRequiredExplanation:{id:"workspaceIdentity.reauthRequiredExplanation",defaultMessage:"For security reasons, we need you to reauthenticate before making changes to SSO settings."}});function Qe(s){var t;const o=(t=ge(s))==null?void 0:t.accessToken,n=o?_e(o):null,i=n==null?void 0:n.pwd_auth_time;return i==null?!1:Date.now()-i<6e4}function oe(s){return e.jsx(ze,{...s})}oe.getLayout=function(o){return e.jsx(xe,{mobilePageTitle:"Identity",requireOwnerPrivileges:!0,children:o})};function Rt(){const s=Re();return Oe(),e.jsx(oe,{...s})}export{Rt as default};
//# sourceMappingURL=bkl3fd3z1p06355h.js.map
