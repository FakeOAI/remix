import{w as b,ai as T,dD as V,dE as g,ar as _,L as h,r as u,v as p,af as w,C as c,bI as S,bS as I}from"./ofly9yrztlesgrye.js";import{aD as A,aP as v,aQ as C,i as D,aR as E}from"./nqzijea2w2642vxo.js";import{k as y,T as l}from"./hgskjx43egewob6w.js";import{i as L}from"./dqjxcbzr89kaex61.js";function x(){return g(_.DataAnalysisV2)}function K(){const e=A(),a=T();return a&&e&&!V(e)&&a.isEnterprise()}function P(){return g(_.ChartSerialization)}function j(e,a){const t=e==="chart"?h.HasSeenAdaInteractiveChart:h.HasSeenAdaInteractiveTable,[s,n]=u.useState(p.getItem(t,{userId:a})??!1),r=u.useCallback(()=>{n(!0),p.setItem(t,!0,{userId:a})},[t,a]);return[s,r]}function O(e){const[a,t]=u.useState([]),s=y(()=>{const n=l.resolveThreadId(e),r=l.getThreadCurrentLeafId(e);return l.getTree(n).getBranchFromLeaf(r)});return u.useEffect(()=>{const n=F(s);n.length!==a.length&&t(n)},[a.length,e,s]),a}function z(e){return y(()=>{const a=l.resolveThreadId(e),t=l.getThreadCurrentLeafId(e),n=l.getTree(a).getBranchFromLeaf(t);return F(n).length>0})}function k(e){var r,i,d,f;const a=((i=(r=e.metadata)==null?void 0:r.aggregate_result)==null?void 0:i.messages.filter(L))??[];let t=0;const s=(((d=e.metadata)==null?void 0:d.ada_visualizations)??[]).map(o=>{let m=o;return o.type=="chart"&&(m={...o,fallback_image:a[t++]}),m}),n=(((f=e.metadata)==null?void 0:f.attachments)??[]).filter(o=>D(o.name)).map(o=>({type:"table",file_id:o.id??"",title:E(o),file_name:o.name,context_connector_info:o.context_connector_info}));return[...s,...n]}function F(e){return e.filter(t=>{var s,n,r,i;return((s=t.message)==null?void 0:s.author.role)==="tool"&&((n=t.message)==null?void 0:n.author.name)==="python"||(((i=(r=t.message)==null?void 0:r.metadata)==null?void 0:i.attachments)??[]).length>0}).flatMap(t=>k(t.message))}b(e=>({selectedSpreadsheet:null,setSelectedSpreadsheet:a=>e({selectedSpreadsheet:a})}));async function H(e,a,t){const s=await e.text(),{parse:n}=await I(async()=>{const{parse:i}=await import("./oeujip5i1ptrxie5.js");return{parse:i}},[]),r=n(s);return{content:{columnNames:r.shift(),columnTypes:r[0].map(()=>"string"),rows:r},file_name:a,download_url:t}}function M(e){const a=e[0].values.length,t=[];for(let s=0;s<a;s++){const n=e.map(r=>r.values[s]);t.push(n)}return t}function Q(e){return w({queryKey:["ada-visualization","chart",e.file_id],queryFn:async()=>{const a=await c.getFileDownloadLink(e.file_id);if(a.status===S.Success){const s=await(await fetch(a.download_url)).json();return{content:{chart_type:s.type,title:s.title,labels:s.labels,datasets:s.datasets,x_label:s.x_label,y_label:s.y_label},file_name:a.file_name??"",download_url:a.download_url}}else throw new Error("Failed to download chart json from interpreter")}})}function W(e){return w({queryKey:["ada-visualization","table",e.file_id],queryFn:async()=>{if(e.file_name&&v(e.file_name)){const a=await c.getAdaExcelFileContents(e.file_id);return{content:a.sheets.map(t=>({name:t.name,columnNames:t.columns.map(s=>s.name),columnTypes:t.columns.map(()=>"string"),rows:M(t.columns)})),download_url:a.download_url,file_name:e.file_name}}else{const a=await c.getFileDownloadLink(e.file_id);if(a.status===S.Success){const t=await fetch(a.download_url);return H(t,a.file_name??"",a.download_url)}else throw new Error("Failed to download from interpreter")}}})}function J(e){const a=C(),t=z(e),s=x();return t&&s&&!a.displayingSideBySideFeedback}export{K as a,P as b,Q as c,O as d,j as e,J as f,k as g,x as h,W as u};
//# sourceMappingURL=du2biz3bflj3ny15.js.map
