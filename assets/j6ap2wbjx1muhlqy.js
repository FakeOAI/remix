const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/sso-ihqxdzxswuiox36n.js","assets/hc9xxm00a3r3byem.js","assets/fga5qe14lr2llx8v.js","assets/root-gxieg4k5.css","assets/ozzpumen10p6g0yq.js","assets/index-small-c8xg50op.css","assets/guykwp3ov0cliuel.js","assets/eq9w2mijkl5gcncq.js","assets/k0a5tmklve7lhdwt.js","assets/io7lyk89lbveno1g.js","assets/kwn3fefba30wvgsb.js","assets/hzcrrlyorrog0p41.js","assets/jt3dvx97wm610wtl.js","assets/iyldmwu8ywhos7ff.js","assets/ovjwzbtdrcsgos3a.js","assets/cqwvbnjobeewuxnd.js","assets/c4ub15ug1kevxj8w.js","assets/g8nlf109ai64grtj.js","assets/facz9srd4e5z6fv5.js","assets/lyr64vj216kc7moh.js","assets/cpyn50o38nwfhwhi.js","assets/lgu0ki3gruqsdrdd.js","assets/l02mntsvyz06f5g3.js","assets/i9qil017zb3p1czr.js","assets/fi9p3eeu24b9vfd1.js","assets/lxui8l23v2tzixf9.js","assets/caxkuyopolf76hse.js","assets/exuoj3g9rvnr47xj.js","assets/c6gg5hubzrgc52sj.js","assets/o65h1gsmgo0mfsrq.js","assets/nbrfb6b5fqz7ea4t.js","assets/nug034oo81goid6a.js","assets/gi4dwz24es0xqvpd.js","assets/h3k8refrd2si6yl9.js","assets/mafougdlzkh8qo68.js","assets/lqlcwrsq68jkt57a.js","assets/eozgrwgbmz9gatod.js","assets/m0hxapdm52wypf6x.js","assets/fr59f31fg6jwe2u4.js","assets/d0g8ptgc5gcqjwyj.js","assets/ldsypk8ae9f813gj.js","assets/j6bclhc7cbp7p32x.js","assets/isjdmfmhzv09v01t.js","assets/gr8wto7g581ivnj9.js","assets/b2rny0kod41myp87.js","assets/j1lknt8seu6gd994.js","assets/eptaxtrdc5yo19ql.js","assets/mivz1ihv23m4q321.js","assets/mnfbtuy5shn7j7rh.js","assets/ejr5bx585q00u2xr.js","assets/exmmesynbikjnder.js","assets/hgnflhls3cvgkj18.js","assets/qknnp5ml7bnljg47.js","assets/orzvve5u2p4b12ln.js","assets/e70ig0kgiu5e598s.js","assets/jrqybevk2xmg1j7t.js","assets/eaz86xbejavxr5kl.js","assets/d5gp1p3nlkkh1n5f.js","assets/oz2p01rklj1p4n8d.js","assets/btg2u9gpl3szhq0h.js","assets/6tjupkkyx0z5k2fa.js","assets/j8vh1bvwq2thm6el.js","assets/hdncrjsjzzuve3ru.js","assets/cj3cq0j3ew1e2kbz.js","assets/clqpk0txvmrxgdlw.js","assets/clolni79kv2kq9pa.js","assets/nxwz9vaydgrnlkdl.js","assets/ed0icvfo2r5i5rtx.js","assets/kqwdyvkaaavvn8k3.js","assets/mc2unsdb4z4goxuv.js","assets/j10j4o3neo99b7zs.js","assets/do5dtfxps7uqtxpp.js","assets/kg9nkh26be0hgljf.js","assets/iv4ixuukcg9wgx9n.js","assets/flu5midy8l1pp37c.js","assets/jivegfkq3c3y773c.js","assets/hmu1ot8fm4uszmig.js","assets/lqbe15vkljpbygph.js","assets/c42bkcuslwv6041k.js","assets/ml6caj8ci8ergnrl.js","assets/o1ngi5g6kc1pvwll.js","assets/k9btfb42xrk56ut9.js","assets/shared-mk6ngktc.css","assets/n3ty0r2frjejpyv8.js","assets/fsddy3bxlesj6ecw.js","assets/gbhwfxebtmzdjc5b.js","assets/b15s8fk5jsrtemdo.js","assets/g38016pkmz5kqvdj.js","assets/os9q9b6j79v07zj6.js","assets/btkpb7dih1nft29s.js","assets/cudyehvey3vajzc8.js","assets/fentbcf1kft3zbjx.js","assets/gqw4n5vk4ei2sng7.js","assets/hd1qgib7s68j49he.js","assets/hjr2ka8peesj2qf7.js","assets/gfds12tx8qpu0ipq.js","assets/dsvckya76mm06sjp.js","assets/iej0cupg2dqkmejt.js","assets/gi3tzluaomiird95.js","assets/nhwwej1nq0zrd7sc.js","assets/sso-bmfhfemd.css","assets/bbqvjx94pawdyae1.js","assets/k6kl8m1o5r79l67s.js","assets/n1uzh05qecnh8ko6.js","assets/le2xruw7cnm9ag5m.js","assets/kptbw01pxwd1ocyc.js","assets/isu9bse2a2oa6tex.js","assets/bdei09nh6a4fidtg.js","assets/i0420t4q4x9i8gsb.js","assets/e1mzt3krac2ynvw2.js","assets/br9a1av9voo62vec.js","assets/ncn9hh8scg46yn3g.js","assets/bndy98029e5l14vk.js","assets/feif6oz75iaq3hwp.js","assets/jk75a2w0m5kujdnq.js","assets/i6z7gagoqkwvcqcz.js","assets/ep4yxennpm3bmzsr.js","assets/jw65xsfufdcj9cuy.js","assets/kjmxh82h04idd7tm.js","assets/nh0xrpjs4anr1mol.js","assets/it7h829f0ifo3smd.js","assets/nu37d9sbnx63000i.js","assets/c1hyxnl6kpsjtl7u.js","assets/digczro7gxkpswto.js","assets/d86ggbbqvfoy1ksr.js","assets/mpt09otgmtef4exw.js","assets/lig9eswxocc0gjns.js","assets/j6ctad4z1l2dr1m8.js","assets/cm4yp0pj7foedy4v.js","assets/dg9zyoagslpqr7lk.js","assets/ss6ebzpmrb7u9y0k.js","assets/d6p9qwxebyx8lv0e.js","assets/lk8bqzua7fjya6ep.js","assets/h603pj0ovegt4tgz.js","assets/gd8pozsaf0jikwjx.js","assets/iqvwu2kwo3fu70ma.js","assets/lp0skyh0p8bkybfk.js"])))=>i.map(i=>d[i]);
var Cx=Object.defineProperty;var vu=n=>{throw TypeError(n)};var Mx=(n,e,t)=>e in n?Cx(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var se=(n,e,t)=>Mx(n,typeof e!="symbol"?e+"":e,t),hl=(n,e,t)=>e.has(n)||vu("Cannot "+t);var C=(n,e,t)=>(hl(n,e,"read from private field"),t?t.call(n):e.get(n)),Le=(n,e,t)=>e.has(n)?vu("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),de=(n,e,t,s)=>(hl(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t),ae=(n,e,t)=>(hl(n,e,"access private method"),t);var Co=(n,e,t,s)=>({set _(i){de(n,e,i,t)},get _(){return C(n,e,s)}});import{h as Qc,i as Tx,j as Qh,c as Zc,e as Zh,k as Ex,b as ro,l as _x,S as Ax,u as ep,G as Nx,f as ed,a as Ix}from"./cqwvbnjobeewuxnd.js";import{fc as Wo,fd as Rx,D as et,N as aa,O as Xn,r as k,h as vi,bH as ys,p as Vs,t as xt,bc as Dx,R as _e,fe as Gr,J as Gs,ff as jx,fg as tp,a4 as ye,j as c,I as Ce,dz as np,G as Xe,T as j,ax as Zi,a3 as vt,X as W,Y as G,aB as Ae,bU as Dt,o as oo,cX as Wn,fh as rc,aA as Px,aN as tt,eE as Pa,fi as sp,eI as ip,F as Ke,H as la,i as Oa,l as Ox,d8 as Fx,a2 as ao,dC as Wt,dH as pl,dJ as Ho,dI as Lx,bQ as Ns,ab as ms,aa as Se,c as J,c6 as N,bI as cr,eX as td,e8 as Bx,a5 as lo,fj as rp,a7 as op,eH as ap,v as Ln,f3 as lp,eZ as cp,B as Si,as as nd,ak as Ue,eo as Ux,at as $e,fk as sd,Q as dp,an as oc,aD as Ht,e as up,f as fp,g as hp,$ as pp,aJ as zx,fl as id,fb as Vx,cw as Gx,K as co,aC as dr,dt as $x,dv as Wx,dw as Hx,b2 as qx,ap as Kx,d0 as uo,aO as Fa,dX as Jx,dY as Yx,fm as Su,al as Xx,aj as Ve,z as ur,dA as Qx,eh as rd,aZ as od,a_ as $r,a$ as ca,cu as Zx,fn as ey,E as fs,fo as ty,fp as ny,fq as ad,cI as Jn,a6 as La,fr as mp,M as sy,u as fr,fs as bn,cJ as iy,ft as ry,fu as Cu,fv as fo,fw as oy,bG as ay,ds as gp,fx as xp,fy as Tr,fz as ly,e6 as ht,e5 as cy,fA as yp,fB as dy,aF as hr,fC as uy,b as fy,fD as bp,dB as hy,aL as py,et as kp,eu as wp,fE as ac,fF as vp,ev as Vi,fG as my,aP as Sp,fH as gy,cM as Ba,b5 as xy,fI as yy,b7 as Cp,C as by,U as ky,az as Ci,dS as wy,y as Ar,eG as vy,aG as Nr,ej as Wr,dy as Sy,ay as Cn,e9 as Cy,a as My,fJ as Ty,fK as Mu,a8 as Ey,a9 as _y,dD as Ay,fL as Ny,fM as Iy,fN as Ry,fO as Dy,fP as jy,fQ as Mp,aK as Tu,fR as Py,fS as Eu,fT as _u,fU as Oy,fV as Fy,fW as Ly,fX as By,d3 as Uy,fY as zy,ea as Vy,V as Gy,bN as $y}from"./hc9xxm00a3r3byem.js";import{a1 as Tp,j as Ep,u as $s,a2 as Wy,g as Au,v as Hy,b as qy,D as Ky,a3 as Jy,a4 as Yy,a5 as Xy,G as ld,o as Qy,a6 as Zy}from"./lyr64vj216kc7moh.js";import{aX as _p,a_ as e1,V as pr,X as mi,gw as t1,k as Ap,U as cd,cf as dd,ce as Ua,ch as za,T as bs,bZ as Va,bo as n1,gx as s1,gy as Nu,gz as Iu,gA as i1,gB as Ga,gC as ud,gD as fd,gE as r1,gF as Mo,aj as Ru,gG as Hr,gH as da,gI as o1,H as a1,gJ as l1,gK as Rt,gL as Np,gM as si,gN as Ip,gO as ua,S as Mi,D as Ws,gP as Sn,gQ as c1,gR as d1,gS as u1,gT as f1,gU as h1,gV as p1,gW as m1,gX as g1,gY as x1,gZ as y1,g_ as b1,g$ as k1,h0 as w1,h1 as v1,h2 as S1,h3 as C1,h4 as M1,h5 as T1,h6 as E1,h7 as _1,h8 as A1,h9 as N1,ha as I1,hb as R1,hc as D1,hd as j1,he as P1,hf as O1,hg as F1,hh as L1,hi as B1,hj as U1,hk as z1,hl as V1,hm as G1,hn as $1,ho as W1,hp as H1,hq as q1,hr as K1,hs as J1,ht as Y1,hu as X1,hv as Q1,hw as Z1,hx as eb,hy as tb,hz as nb,hA as sb,hB as ib,hC as rb,hD as ob,hE as ab,hF as lb,hG as cb,hH as db,hI as ub,hJ as fb,hK as hb,hL as pb,hM as mb,hN as gb,hO as xb,hP as yb,hQ as bb,hR as kb,hS as wb,hT as vb,hU as Sb,hV as Cb,hW as Mb,hX as Tb,hY as Eb,hZ as _b,h_ as Ab,h$ as Nb,i0 as Ib,i1 as Rb,i2 as Db,i3 as jb,i4 as Pb,i5 as Ob,i6 as Fb,i7 as Lb,i8 as Bb,i9 as Ub,ia as zb,ib as Vb,ic as Gb,id as $b,ie as Wb,ig as Hb,ih as qb,ii as Kb,ij as Jb,ik as Yb,aO as mr,A as Rp,ae as qr,il as Dp,aJ as jp,aR as $a,u as gs,cd as Xb,e as Pp,b1 as lc,im as er,cn as Op,io as Fp,ip as hd,co as gr,iq as Lp,ir as pd,bl as Bp,is as Qb,it as Zb,iu as Up,iv as zp,iw as Vp,ix as ek,iy as tk,iz as Du,iA as Gp,dG as nk,dH as sk,iB as ik,iC as rk,g as $p,iD as ok,iE as ak,q as Wp,bp as Ti,iF as ju,iG as lk,cS as ck,cR as fa,iH as dk,x as md,iI as ha,iJ as gd,l as Pu,cN as Wa,iK as Hp,Y as Ha,ax as qp,iL as uk,R as Kp,G as X,M as fk,a7 as hk,iM as pk,f as mk,dO as qa,iN as gk,iO as xk,iP as yk,iQ as bk,dN as To,dM as kk,iR as Lr,iS as wk,cz as Jp,bj as vk,iT as Sk,i as Ck,iU as Mk,iV as Tk,iW as xd,iX as yd,iY as bd,iZ as kd,i_ as wd,i$ as vd,j0 as Yp,j1 as Eo,bX as Ek,j2 as _k,o as mn,J as Ak,cQ as Xp,Q as ml,df as Nk,aL as Ik,cy as Rk,bn as Ou,j3 as Dk,j4 as jk,dw as Qp,dv as Pk,j5 as Fu,j6 as Ok,j7 as Fk,j8 as Ka,j9 as Lk,ja as Bk,jb as Uk,ci as zk,jc as Vk,jd as Gk,je as $k,jf as Wk,jg as Hk,c2 as Lu,jh as qk,ji as Kk,W as Jk}from"./ozzpumen10p6g0yq.js";import{s as xr,f as Yk,i as hs,a6 as Xk,T as z,c as Sd,A as Hs,P as Zp,g as qt,a7 as Qk,u as ho,e as Bn,F as xs,a as Qn,d as po,a8 as em,a9 as Zk,aa as ew,K as Cd,ab as tm,h as Md,ac as Bu,H as Uu,ad as tw,b as nm,ae as nw,af as sw,ag as iw,ah as rw,ai as sm,C as ow,D as aw,aj as im,R as rm,ak as lw,al as cw,am as dw,an as om}from"./iyldmwu8ywhos7ff.js";import{G as uw,T as fw}from"./k6kl8m1o5r79l67s.js";import{b as hw,d as pw}from"./hmu1ot8fm4uszmig.js";import{u as am,t as lm,i as cm,S as mw,a as dm,b as en,c as tr,d as Nt,e as um,f as Ja,T as Td,M as Ed,g as fm,H as gw,h as hm,G as xw,L as yw,j as bw,k as kw,l as ww,P as vw}from"./oz2p01rklj1p4n8d.js";import{S as Sw,B as cc,U as Cw}from"./lxui8l23v2tzixf9.js";import{u as yr}from"./nug034oo81goid6a.js";import{E as Mw,U as Tw}from"./n1uzh05qecnh8ko6.js";import{r as _d}from"./l02mntsvyz06f5g3.js";import{bL as Ad,f as nr,h as Ew,k as _w,i as Aw,j as Nw,l as Iw,o as Rw,m as Dw,n as jw,w as mo,b7 as Pw,a5 as pm,ae as Ow,bM as Fw,p as Lw,aZ as mm,bN as Bw,q as Nd,bF as Uw,bO as zw,ac as Vw,ag as Gw,H as Id,ad as gm,aY as $w,a9 as Ww,M as Hw,bl as qw,bm as Kw,t as Jw,a4 as Yw,Z as xm,bP as Xw,S as Qw,T as Rd,U as Dd,e as Zw,R as ev,Q as tv,u as nv,a7 as sv,aL as iv,N as rv,bQ as ov,bR as av,bS as lv,bC as cv,E as dv,bo as uv}from"./fga5qe14lr2llx8v.js";import{a as fv}from"./le2xruw7cnm9ag5m.js";import{m as yt}from"./ovjwzbtdrcsgos3a.js";import{u as hv,b as pv,I as mv}from"./c4ub15ug1kevxj8w.js";import{v as Ya,w as gv,x as xv,z as yv,A as bv,B as kv}from"./fi9p3eeu24b9vfd1.js";import{u as ym}from"./btkpb7dih1nft29s.js";import{g as bm,_ as wv}from"./flu5midy8l1pp37c.js";import{a as vv}from"./m0hxapdm52wypf6x.js";import{F as Is,m as Sv,r as Cv,U as Tt,n as Mv,f as Tv,o as sr,p as jd,q as Ev,i as km,t as wm,b as gi,v as Pd,w as _v,u as vm,d as Sm,c as Av}from"./b2rny0kod41myp87.js";import{l as zu,b as Cm,p as Nv,m as Iv,d as Rv,g as Kr,E as Vu,u as Mm}from"./kptbw01pxwd1ocyc.js";import{c as Tm,a as Xa,b as Dv}from"./os9q9b6j79v07zj6.js";import{g as Qa,_ as jv,o as Od}from"./k9btfb42xrk56ut9.js";import{$ as Pv,a as Gu,b as Ov,c as Fv}from"./lqlcwrsq68jkt57a.js";import{c as Lv,U as xi,u as Fd,G as Jr,b as Bv}from"./guykwp3ov0cliuel.js";import{t as Uv,A as Za}from"./mafougdlzkh8qo68.js";import{D as Oe,$ as zv,B as Vv}from"./i9qil017zb3p1czr.js";import{I as Un,O as Em,B as Gv,G as dc,N as $v}from"./facz9srd4e5z6fv5.js";import{u as Wv,d as Hv,m as qv,n as Kv,s as go,o as Jv}from"./eq9w2mijkl5gcncq.js";import{A as yi}from"./gi4dwz24es0xqvpd.js";import{D as Ld,M as Yv,B as Xv,F as Qv,G as Zv,a as eS,b as tS}from"./mnfbtuy5shn7j7rh.js";import{n as nS,f as sS,s as _m,i as iS,p as rS,P as oS,C as aS,I as lS,u as cS,o as dS}from"./h3k8refrd2si6yl9.js";import{D as uS,F as Am,E as fS}from"./isu9bse2a2oa6tex.js";import{a as hS,b as Nm,p as pS,t as mS,g as gS}from"./btg2u9gpl3szhq0h.js";import{G as Im,a as xS}from"./g8nlf109ai64grtj.js";import{M as yS}from"./caxkuyopolf76hse.js";import{u as bS}from"./cpyn50o38nwfhwhi.js";import{u as kS}from"./gi3tzluaomiird95.js";import{H as wS}from"./bdei09nh6a4fidtg.js";import{T as vS}from"./hzcrrlyorrog0p41.js";const SS="https://challenges.cloudflare.com/turnstile/v0/api.js",CS={[Wo.PAID]:"0x4AAAAAAASbFNinhLLnW5f1",[Wo.FREEACCOUNT]:"0x4AAAAAAACPe2BTwOIpYk6H",[Wo.NOAUTH]:"0x4AAAAAAASbHVR44GU82lOI"};class pa{toString(){return JSON.stringify(this.toJSON())}}class gl extends pa{constructor(e){super(),this.message=e,this.message=e}toJSON(){return{"Turnstile-Internal-Error":this.message}}}class MS extends pa{constructor(e){super(),this.errorCode=e,this.errorCode=e}toJSON(){return{"Turnstile-Client-Error":this.errorCode}}}class TS{constructor(){se(this,"app",Wo.NOAUTH);se(this,"status","idle");se(this,"turnstileInstancePromise",null);se(this,"enforcementTokenPromise",null);se(this,"requestStartTimeMs",0);se(this,"_onCompleted");se(this,"_onError")}async initializeAndGatherData(e){this._getOrCreateInstance(e)}async _getOrCreateInstance(e){var t,s;return!((t=e.turnstile)!=null&&t.required)||(s=e.turnstile)!=null&&s.dx?null:(this.app!==e.persona&&(this.app=e.persona,this.turnstileInstancePromise=this._getTurnstileInstancePromise()),this.turnstileInstancePromise??new gl("Turnstile instance not initialized."))}async getEnforcementToken(e){var t;return(t=e.turnstile)!=null&&t.dx?Rx(e.turnstile.dx):this.startEnforcement(e).then(s=>(this.enforcementTokenPromise=null,s?s.toString():null))}async startEnforcement(e){var t;return(t=e.turnstile)!=null&&t.required?this.enforcementTokenPromise!==null?this.enforcementTokenPromise:this.enforcementTokenPromise=this._getEnforcementToken(e):null}async _getEnforcementToken(e,t){const s=await this._getOrCreateInstance(e);return s instanceof pa||s===null?s:new Promise((i,r)=>{this.setOnCompleted(o=>{const a=performance.now()-this.requestStartTimeMs;et.addAction("turnstile_get_token_success",{app:this.app.toString(),durationMs:a}),i(o)}),this.setOnError(o=>{if(!t)this._getEnforcementToken(e,!0).then(i,r);else{const a=performance.now()-this.requestStartTimeMs;et.addAction("turnstile_get_token_error",{app_release:"d4924c616406842ad12514cc09907714b3e36f51",error:o,app:this.app.toString(),durationMs:a}),i(new MS(o))}}),this.setStatus("ready"),this.requestStartTimeMs=performance.now(),s.reset(),s.execute()})}setStatus(e){this.status=e}onCompleted(e){var t;(t=this._onCompleted)==null||t.call(this,e)}setOnCompleted(e){this._onCompleted=e}onError(e){var t;(t=this._onError)==null||t.call(this,e)}setOnError(e){this._onError=e}onExpired(){this.enforcementTokenPromise=null}_getTurnstileInstancePromise(e){if(this.turnstileInstancePromise!==null)if(e)this.turnstileInstancePromise.then(t=>{t instanceof pa||t.remove()}),this.turnstileInstancePromise=null;else return this.turnstileInstancePromise;return this.turnstileInstancePromise=new Promise((t,s)=>{var d,u;const i="onloadTurnstileCallback";Object.defineProperty(window,i,{value:()=>{if(this.status==="ready")return;this.setStatus("script_loaded");const{turnstile:f}=window;if(f===null){this.setStatus("error"),e?(et.addAction("turnstile_instance_missing",{app_release:"d4924c616406842ad12514cc09907714b3e36f51",app:this.app.toString()}),t(new gl("Turnstile instance missing"))):this._getTurnstileInstancePromise(!0).then(t,s);return}f.render("#"+r,{sitekey:CS[this.app],execution:"execute",callback:this.onCompleted.bind(this),"error-callback":this.onError.bind(this),"expired-callback":this.onExpired.bind(this)}),t(f)}});const r="cf-turnstile",o="cf-turnstile-script";(d=document.getElementById(r))==null||d.remove(),(u=document.getElementById(o))==null||u.remove();const a=document.createElement("div");a.id=r,a.hidden=!0,document.body.appendChild(a),this.setStatus("loading");const l=document.createElement("script");l.id=o,l.src=SS+`?onload=${i}`,l.async=!0,l.defer=!0,l.onerror=()=>{this.setStatus("error"),e?(et.addAction("turnstile_script_load_error",{app_release:"d4924c616406842ad12514cc09907714b3e36f51",app:this.app.toString()}),t(new gl("Turnstile script failed to load"))):this._getTurnstileInstancePromise(!0).then(t,s)},document.body.appendChild(l)}),this.turnstileInstancePromise}}const ma=new TS;function ES(n,e){_p(2,arguments);var t=Uv(n),s=e1(e);return isNaN(s)?new Date(NaN):(s&&t.setDate(t.getDate()+s),t)}function _S(n){return _p(1,arguments),nS(n,ES(Date.now(),1))}function Rm(){const n=pr(),e=n==null?void 0:n.id,{currentWorkspace:t}=mi(({currentWorkspace:r})=>({currentWorkspace:r})),s=t==null?void 0:t.id;return aa.getItem(Xn.LastUsedModel,{workspaceId:s,userId:e})}function AS(){const n=pr(),e=n==null?void 0:n.id,{currentWorkspace:t}=mi(({currentWorkspace:r})=>({currentWorkspace:r})),s=t==null?void 0:t.id;return k.useCallback(r=>{if(!r)return null;const o=Date.now(),a={modelId:r,updatedAt:o};aa.setItem(Xn.LastUsedModel,a,{workspaceId:s,userId:e})},[s,e])}const NS=n=>{const{asPath:e,replace:t}=vi(),s=ys(),i=xr();Vs({queryKey:["conversation",n],queryFn:()=>Yk(n).catch(r=>{const o=t1(e),a=o!=null?Tp(o):"/";throw t(a,void 0,{shallow:!0}),xt.danger(`Unable to load conversation ${n}`),r}),enabled:!hs(n)&&!s&&!i})};function IS(n){return`https://chatgpt.com${Ep(n)}`}function I5(n,e){Ap(IS(n)),e&&xt.info(e)}function RS(n){return n.some(e=>e.type===Dx.JIT_PLUGIN)}function DS(n){return"gizmo_id"in n?n.gizmo_id??null:null}const jS=n=>["conversation","init",n],PS=({clientThreadId:n,conversationMode:e,clientModelId:t})=>{const s=DS(e),i=hs(n)?null:n;return{gcTime:0,refetchOnWindowFocus:!0,refetchOnMount:"always",queryKey:jS(n),queryFn:()=>_e.getConversationDetails({conversationId:i,gizmoId:s,requestedDefaultModel:t})}},OS=n=>Vs(PS(n)),FS=(n,e)=>{const t=(typeof n=="string"?[n]:n)??[];for(const s of t)if(s&&e.has(s))return s;return null},R5=(n,e)=>{const t=Qc(),{query:s}=vi(),i=Tx(s),{modelId:r=null}=Rm()??{};NS(n);const o=Xk(n)??null,a=[i,o,r],l=FS(a,t);k.useEffect(()=>{z.initThread(n,e,l),Gr.reset()},[n]);const d=Gs(),u=k.useCallback(()=>{const x={...s};delete x.model;const y=jx.stringify(x);d({search:y.length>0?`?${y}`:""})},[s,d]),{isLoading:f,data:h}=OS({clientThreadId:n,clientModelId:a.find(x=>!!x)??null,conversationMode:e}),g=tp();k.useEffect(()=>{if(!(!i||f)){if(!t.has(i)||g.find(x=>x.model_slug===i))return u();z.setThreadModelId(n,i)}},[i,g,t,n]),k.useEffect(()=>{if(f||!h)return;const{default_model_slug:x}=h;i&&x&&i!==x&&u(),Gr.updateDetails(h),x&&z.setThreadModelId(n,x)},[f,h])};function xl({label:n,tooltip:e,Icon:t}){return c.jsxs("div",{className:"flex items-center gap-1 text-sm font-semibold opacity-70",children:[t&&c.jsx(t,{className:"icon-sm"}),c.jsx("div",{children:n}),c.jsx(bs,{label:e,children:c.jsx(nr,{className:"icon-sm ml-1"})})]})}function LS({clientThreadId:n,gizmoId:e}){const t=ye(),s=cd(),i=dd(),r=Ua(),{data:o}=za(e,!1,r),a=!!e,l=ys(),d=Sd(n);return r?l&&(!d||a)?c.jsx(xl,{label:t.formatMessage(Ri.temporaryChat),tooltip:t.formatMessage(Ri.temporaryChatTooltip),Icon:Ad}):s&&!i&&!l?c.jsx(xl,{label:t.formatMessage(Ri.memoryOff),tooltip:t.formatMessage(Ri.memoryOffTooltip)}):o&&(o==null?void 0:o.memoryFullPct)>=100?c.jsx(xl,{label:t.formatMessage(Ri.memoryFull),tooltip:t.formatMessage(Ri.memoryFullTooltip)}):null:null}const Ri=Ce({temporaryChat:{id:"ConversationPrivacyIndicator.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatTooltip:{id:"ConversationPrivacyIndicator.temporaryChatTooltip",defaultMessage:"Temporary Chats won't appear in your history, and ChatGPT won't remember anything you talk about."},memoryOff:{id:"ConversationPrivacyIndicator.memoryOff",defaultMessage:"Memory Off"},memoryOffTooltip:{id:"ConversationPrivacyIndicator.memoryOffTooltip",defaultMessage:"ChatGPT won't remember anything you talk about in this conversation."},memoryFull:{id:"2Eq+5y",defaultMessage:"Memory Full"},memoryFullTooltip:{id:"dNA8jQ",defaultMessage:"ChatGPT's memory is full. You can forget existing memories to make space."}}),BS=({dismissLink:n,onLogInButtonClick:e,onSignUpButtonClick:t,subtitle:s,title:i})=>{const o=np()?"center":"bottom",a=Va(),l=c.jsx(Xe,{as:"button",size:"large",color:a?"secondary":"primary",onClick:t,fullWidth:!0,children:c.jsx(j,{...$u.signUpCta})}),d=c.jsx(Xe,{as:"button",size:"large",color:a?"primary":"secondary",fullWidth:!0,onClick:e,children:c.jsx(j,{...$u.logInCta})}),u=a?[d,l]:[l,d];return c.jsx(Zi,{isOpen:!0,onClose:vt,shouldIgnoreClickOutside:!0,showCloseButton:!1,type:"success",noPadding:!0,position:o,size:"custom",className:"max-w-[373px] sm:max-w-[400px]",children:c.jsxs("div",{className:"flex flex-col items-center justify-center px-6 py-8 sm:px-10 sm:pb-10 sm:pt-12",children:[c.jsx("p",{className:"mb-1 text-center text-2xl font-semibold",children:c.jsx(j,{...i})}),c.jsx("p",{className:"mb-6 text-center text-token-text-secondary",children:c.jsx(j,{...s})}),c.jsx("div",{className:"flex w-full flex-col gap-2 sm:gap-2.5",children:u}),n?c.jsx("a",{href:"#",className:"mt-5 cursor-pointer text-sm font-semibold text-token-text-secondary underline",onClick:f=>{f.preventDefault(),n.onClick()},children:c.jsx(j,{...n.text})}):null]})})},$u=Ce({signUpCta:{id:"NoAuthModal.signUpCta",defaultMessage:"Sign up"},logInCta:{id:"NoAuthModal.logInCta",defaultMessage:"Log in"}}),US=({onClose:n})=>{const e=yr(),t=Va();return k.useEffect(()=>{W.logEvent(G.noAuthSoftRateLimitModalShown),Ae.logEvent("chatgpt_no_auth_soft_rate_limit_modal_shown")},[]),c.jsx(BS,{dismissLink:{text:_o.stayLoggedOutLink,onClick:()=>{W.logEvent(G.noAuthSoftRateLimitModalStayLoggedOutLinkClicked),Ae.logEvent("chatgpt_no_auth_soft_rate_limit_modal_stay_logged_out_link_clicked"),n()}},onLogInButtonClick:()=>{const s=e({authType:"login"});W.logLogInButtonClicked({provider:s,location:"No Auth Soft Rate Limit Modal"})},onSignUpButtonClick:()=>{const s=e({authType:"signup"});W.logSignUpButtonClicked({provider:s,location:"No Auth Soft Rate Limit Modal"})},subtitle:t?_o.logInSubtitle:_o.signUpSubtitle,title:_o.title})},_o=Ce({title:{id:"NoAuthSoftRateLimitModal.title",defaultMessage:"Thanks for trying ChatGPT"},signUpSubtitle:{id:"zpngdW",defaultMessage:"Sign up or log in to get smarter responses, upload files and images, and more."},logInSubtitle:{id:"iVew+I",defaultMessage:"Log in or sign up to get smarter responses, upload files and images, and more."},stayLoggedOutLink:{id:"NoAuthWelcomeBackModal.stayLoggedOut",defaultMessage:"Stay logged out"}}),zS=!1,VS=10,GS=()=>{const[n,e]=k.useState(()=>sessionStorage.getItem(Xn.NoAuthHasDismissedSoftRateLimitModal)!=null),{isUnauthenticated:t,isLoading:s}=Dt(),i=n1(),r=s1(u=>u.userMessageCount),{layer:o}=oo("3637408529"),a=o.get("no_auth_soft_rate_limit",VS),l=o.get("is_no_auth_soft_rate_limit_modal_enabled",zS),d=()=>{e(!0),sessionStorage.setItem(Xn.NoAuthHasDismissedSoftRateLimitModal,"true")};return{isOpen:!s&&t&&l&&r>=a&&!n&&!i,onClose:d}};class uc extends Error{constructor(e){super(e),this.name="AbortError"}}let Dm=class{constructor(e){if(this._signal=new Nu,!!e){Array.isArray(e)||(e=arguments);for(const t of e)t.aborted?this.abort():t.addEventListener("abort",()=>{this.abort()})}}get signal(){return this._signal}abort(){Iu(this._signal)}static timeout(e){const t=new Nu,s=setTimeout(Iu,e,t);return typeof s.unref=="function"&&s.unref(),t}};function $S(n,e){const{cleanupBeforeAbort:t,abortSignal:s,abortErrorMsg:i}=e??{};return new Promise((r,o)=>{function a(){o(new uc(i??"The operation was aborted."))}function l(){s==null||s.removeEventListener("abort",d)}function d(){t==null||t(),l(),a()}if(s!=null&&s.aborted)return a();try{n(u=>{l(),r(u)},u=>{l(),o(u)})}catch(u){o(u)}s==null||s.addEventListener("abort",d)})}const WS="The delay was aborted.";function qo(n,e){let t;const{abortSignal:s,abortErrorMsg:i}={};return $S(r=>{t=setTimeout(r,n)},{cleanupBeforeAbort:()=>clearTimeout(t),abortSignal:s,abortErrorMsg:i??WS})}var Wu={};const Hu=typeof process<"u"&&Wu&&Wu.DEBUG||void 0;let jm,fc=[],hc=[];const ga=[];Hu&&Bd(Hu);const ir=Object.assign(n=>Pm(n),{enable:Bd,enabled:Ud,disable:HS,log:i1});function Bd(n){jm=n,fc=[],hc=[];const e=/\*/g,t=n.split(",").map(s=>s.trim().replace(e,".*?"));for(const s of t)s.startsWith("-")?hc.push(new RegExp(`^${s.substr(1)}$`)):fc.push(new RegExp(`^${s}$`));for(const s of ga)s.enabled=Ud(s.namespace)}function Ud(n){if(n.endsWith("*"))return!0;for(const e of hc)if(e.test(n))return!1;for(const e of fc)if(e.test(n))return!0;return!1}function HS(){const n=jm||"";return Bd(""),n}function Pm(n){const e=Object.assign(t,{enabled:Ud(n),destroy:qS,log:ir.log,namespace:n,extend:KS});function t(...s){e.enabled&&(s.length>0&&(s[0]=`${n} ${s[0]}`),e.log(...s))}return ga.push(e),e}function qS(){const n=ga.indexOf(this);return n>=0?(ga.splice(n,1),!0):!1}function KS(n){const e=Pm(`${this.namespace}:${n}`);return e.log=this.log,e}var qu={};const Om=new Set,Ao=typeof process<"u"&&qu&&qu.AZURE_LOG_LEVEL||void 0;let pc;const mc=ir("azure");mc.log=(...n)=>{ir.log(...n)};const zd=["verbose","info","warning","error"];Ao&&(Bm(Ao)?JS(Ao):console.error(`AZURE_LOG_LEVEL set to unknown log level '${Ao}'; logging is not enabled. Acceptable values: ${zd.join(", ")}.`));function JS(n){if(n&&!Bm(n))throw new Error(`Unknown log level '${n}'. Acceptable values: ${zd.join(",")}`);pc=n;const e=[];for(const t of Om)Lm(t)&&e.push(t.namespace);ir.enable(e.join(","))}const Ku={verbose:400,info:300,warning:200,error:100};function YS(n){const e=mc.extend(n);return Fm(mc,e),{error:No(e,"error"),warning:No(e,"warning"),info:No(e,"info"),verbose:No(e,"verbose")}}function Fm(n,e){e.log=(...t)=>{n.log(...t)}}function No(n,e){const t=Object.assign(n.extend(e),{level:e});if(Fm(n,t),Lm(t)){const s=ir.disable();ir.enable(s+","+t.namespace)}return Om.add(t),t}function Lm(n){return!!(pc&&Ku[n.level]<=Ku[pc])}function Bm(n){return zd.includes(n)}const jt=YS("web-pubsub-client");Ga.byteLength=ZS;Ga.toByteArray=tC;Ga.fromByteArray=iC;var Hn=[],gn=[],XS=typeof Uint8Array<"u"?Uint8Array:Array,yl="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Di=0,QS=yl.length;Di<QS;++Di)Hn[Di]=yl[Di],gn[yl.charCodeAt(Di)]=Di;gn[45]=62;gn[95]=63;function Um(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var s=t===e?0:4-t%4;return[t,s]}function ZS(n){var e=Um(n),t=e[0],s=e[1];return(t+s)*3/4-s}function eC(n,e,t){return(e+t)*3/4-t}function tC(n){var e,t=Um(n),s=t[0],i=t[1],r=new XS(eC(n,s,i)),o=0,a=i>0?s-4:s,l;for(l=0;l<a;l+=4)e=gn[n.charCodeAt(l)]<<18|gn[n.charCodeAt(l+1)]<<12|gn[n.charCodeAt(l+2)]<<6|gn[n.charCodeAt(l+3)],r[o++]=e>>16&255,r[o++]=e>>8&255,r[o++]=e&255;return i===2&&(e=gn[n.charCodeAt(l)]<<2|gn[n.charCodeAt(l+1)]>>4,r[o++]=e&255),i===1&&(e=gn[n.charCodeAt(l)]<<10|gn[n.charCodeAt(l+1)]<<4|gn[n.charCodeAt(l+2)]>>2,r[o++]=e>>8&255,r[o++]=e&255),r}function nC(n){return Hn[n>>18&63]+Hn[n>>12&63]+Hn[n>>6&63]+Hn[n&63]}function sC(n,e,t){for(var s,i=[],r=e;r<t;r+=3)s=(n[r]<<16&16711680)+(n[r+1]<<8&65280)+(n[r+2]&255),i.push(nC(s));return i.join("")}function iC(n){for(var e,t=n.length,s=t%3,i=[],r=16383,o=0,a=t-s;o<a;o+=r)i.push(sC(n,o,o+r>a?a:o+r));return s===1?(e=n[t-1],i.push(Hn[e>>2]+Hn[e<<4&63]+"==")):s===2&&(e=(n[t-2]<<8)+n[t-1],i.push(Hn[e>>10]+Hn[e>>4&63]+Hn[e<<2&63]+"=")),i.join("")}/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ud.read=function(n,e,t,s,i){var r,o,a=i*8-s-1,l=(1<<a)-1,d=l>>1,u=-7,f=t?i-1:0,h=t?-1:1,g=n[e+f];for(f+=h,r=g&(1<<-u)-1,g>>=-u,u+=a;u>0;r=r*256+n[e+f],f+=h,u-=8);for(o=r&(1<<-u)-1,r>>=-u,u+=s;u>0;o=o*256+n[e+f],f+=h,u-=8);if(r===0)r=1-d;else{if(r===l)return o?NaN:(g?-1:1)*(1/0);o=o+Math.pow(2,s),r=r-d}return(g?-1:1)*o*Math.pow(2,r-s)};ud.write=function(n,e,t,s,i,r){var o,a,l,d=r*8-i-1,u=(1<<d)-1,f=u>>1,h=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,g=s?0:r-1,x=s?1:-1,y=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+f>=1?e+=h/l:e+=h*Math.pow(2,1-f),e*l>=2&&(o++,l/=2),o+f>=u?(a=0,o=u):o+f>=1?(a=(e*l-1)*Math.pow(2,i),o=o+f):(a=e*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;n[t+g]=a&255,g+=x,a/=256,i-=8);for(o=o<<i|a,d+=i;d>0;n[t+g]=o&255,g+=x,o/=256,d-=8);n[t+g-x]|=y*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(n){const e=Ga,t=ud,s=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=a,n.SlowBuffer=_,n.INSPECT_MAX_BYTES=50;const i=2147483647;n.kMaxLength=i,a.TYPED_ARRAY_SUPPORT=r(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function r(){try{const b=new Uint8Array(1),p={foo:function(){return 42}};return Object.setPrototypeOf(p,Uint8Array.prototype),Object.setPrototypeOf(b,p),b.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function o(b){if(b>i)throw new RangeError('The value "'+b+'" is invalid for option "size"');const p=new Uint8Array(b);return Object.setPrototypeOf(p,a.prototype),p}function a(b,p,m){if(typeof b=="number"){if(typeof p=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return f(b)}return l(b,p,m)}a.poolSize=8192;function l(b,p,m){if(typeof b=="string")return h(b,p);if(ArrayBuffer.isView(b))return x(b);if(b==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof b);if(Ie(b,ArrayBuffer)||b&&Ie(b.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Ie(b,SharedArrayBuffer)||b&&Ie(b.buffer,SharedArrayBuffer)))return y(b,p,m);if(typeof b=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const v=b.valueOf&&b.valueOf();if(v!=null&&v!==b)return a.from(v,p,m);const M=w(b);if(M)return M;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof b[Symbol.toPrimitive]=="function")return a.from(b[Symbol.toPrimitive]("string"),p,m);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof b)}a.from=function(b,p,m){return l(b,p,m)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function d(b){if(typeof b!="number")throw new TypeError('"size" argument must be of type number');if(b<0)throw new RangeError('The value "'+b+'" is invalid for option "size"')}function u(b,p,m){return d(b),b<=0?o(b):p!==void 0?typeof m=="string"?o(b).fill(p,m):o(b).fill(p):o(b)}a.alloc=function(b,p,m){return u(b,p,m)};function f(b){return d(b),o(b<0?0:S(b)|0)}a.allocUnsafe=function(b){return f(b)},a.allocUnsafeSlow=function(b){return f(b)};function h(b,p){if((typeof p!="string"||p==="")&&(p="utf8"),!a.isEncoding(p))throw new TypeError("Unknown encoding: "+p);const m=O(b,p)|0;let v=o(m);const M=v.write(b,p);return M!==m&&(v=v.slice(0,M)),v}function g(b){const p=b.length<0?0:S(b.length)|0,m=o(p);for(let v=0;v<p;v+=1)m[v]=b[v]&255;return m}function x(b){if(Ie(b,Uint8Array)){const p=new Uint8Array(b);return y(p.buffer,p.byteOffset,p.byteLength)}return g(b)}function y(b,p,m){if(p<0||b.byteLength<p)throw new RangeError('"offset" is outside of buffer bounds');if(b.byteLength<p+(m||0))throw new RangeError('"length" is outside of buffer bounds');let v;return p===void 0&&m===void 0?v=new Uint8Array(b):m===void 0?v=new Uint8Array(b,p):v=new Uint8Array(b,p,m),Object.setPrototypeOf(v,a.prototype),v}function w(b){if(a.isBuffer(b)){const p=S(b.length)|0,m=o(p);return m.length===0||b.copy(m,0,0,p),m}if(b.length!==void 0)return typeof b.length!="number"||nt(b.length)?o(0):g(b);if(b.type==="Buffer"&&Array.isArray(b.data))return g(b.data)}function S(b){if(b>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return b|0}function _(b){return+b!=b&&(b=0),a.alloc(+b)}a.isBuffer=function(p){return p!=null&&p._isBuffer===!0&&p!==a.prototype},a.compare=function(p,m){if(Ie(p,Uint8Array)&&(p=a.from(p,p.offset,p.byteLength)),Ie(m,Uint8Array)&&(m=a.from(m,m.offset,m.byteLength)),!a.isBuffer(p)||!a.isBuffer(m))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(p===m)return 0;let v=p.length,M=m.length;for(let A=0,P=Math.min(v,M);A<P;++A)if(p[A]!==m[A]){v=p[A],M=m[A];break}return v<M?-1:M<v?1:0},a.isEncoding=function(p){switch(String(p).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(p,m){if(!Array.isArray(p))throw new TypeError('"list" argument must be an Array of Buffers');if(p.length===0)return a.alloc(0);let v;if(m===void 0)for(m=0,v=0;v<p.length;++v)m+=p[v].length;const M=a.allocUnsafe(m);let A=0;for(v=0;v<p.length;++v){let P=p[v];if(Ie(P,Uint8Array))A+P.length>M.length?(a.isBuffer(P)||(P=a.from(P)),P.copy(M,A)):Uint8Array.prototype.set.call(M,P,A);else if(a.isBuffer(P))P.copy(M,A);else throw new TypeError('"list" argument must be an Array of Buffers');A+=P.length}return M};function O(b,p){if(a.isBuffer(b))return b.length;if(ArrayBuffer.isView(b)||Ie(b,ArrayBuffer))return b.byteLength;if(typeof b!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof b);const m=b.length,v=arguments.length>2&&arguments[2]===!0;if(!v&&m===0)return 0;let M=!1;for(;;)switch(p){case"ascii":case"latin1":case"binary":return m;case"utf8":case"utf-8":return Xt(b).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return m*2;case"hex":return m>>>1;case"base64":return qe(b).length;default:if(M)return v?-1:Xt(b).length;p=(""+p).toLowerCase(),M=!0}}a.byteLength=O;function T(b,p,m){let v=!1;if((p===void 0||p<0)&&(p=0),p>this.length||((m===void 0||m>this.length)&&(m=this.length),m<=0)||(m>>>=0,p>>>=0,m<=p))return"";for(b||(b="utf8");;)switch(b){case"hex":return L(this,p,m);case"utf8":case"utf-8":return Y(this,p,m);case"ascii":return pe(this,p,m);case"latin1":case"binary":return H(this,p,m);case"base64":return V(this,p,m);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ue(this,p,m);default:if(v)throw new TypeError("Unknown encoding: "+b);b=(b+"").toLowerCase(),v=!0}}a.prototype._isBuffer=!0;function E(b,p,m){const v=b[p];b[p]=b[m],b[m]=v}a.prototype.swap16=function(){const p=this.length;if(p%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let m=0;m<p;m+=2)E(this,m,m+1);return this},a.prototype.swap32=function(){const p=this.length;if(p%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let m=0;m<p;m+=4)E(this,m,m+3),E(this,m+1,m+2);return this},a.prototype.swap64=function(){const p=this.length;if(p%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let m=0;m<p;m+=8)E(this,m,m+7),E(this,m+1,m+6),E(this,m+2,m+5),E(this,m+3,m+4);return this},a.prototype.toString=function(){const p=this.length;return p===0?"":arguments.length===0?Y(this,0,p):T.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(p){if(!a.isBuffer(p))throw new TypeError("Argument must be a Buffer");return this===p?!0:a.compare(this,p)===0},a.prototype.inspect=function(){let p="";const m=n.INSPECT_MAX_BYTES;return p=this.toString("hex",0,m).replace(/(.{2})/g,"$1 ").trim(),this.length>m&&(p+=" ... "),"<Buffer "+p+">"},s&&(a.prototype[s]=a.prototype.inspect),a.prototype.compare=function(p,m,v,M,A){if(Ie(p,Uint8Array)&&(p=a.from(p,p.offset,p.byteLength)),!a.isBuffer(p))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof p);if(m===void 0&&(m=0),v===void 0&&(v=p?p.length:0),M===void 0&&(M=0),A===void 0&&(A=this.length),m<0||v>p.length||M<0||A>this.length)throw new RangeError("out of range index");if(M>=A&&m>=v)return 0;if(M>=A)return-1;if(m>=v)return 1;if(m>>>=0,v>>>=0,M>>>=0,A>>>=0,this===p)return 0;let P=A-M,ce=v-m;const Te=Math.min(P,ce),oe=this.slice(M,A),De=p.slice(m,v);for(let fe=0;fe<Te;++fe)if(oe[fe]!==De[fe]){P=oe[fe],ce=De[fe];break}return P<ce?-1:ce<P?1:0};function R(b,p,m,v,M){if(b.length===0)return-1;if(typeof m=="string"?(v=m,m=0):m>2147483647?m=2147483647:m<-2147483648&&(m=-2147483648),m=+m,nt(m)&&(m=M?0:b.length-1),m<0&&(m=b.length+m),m>=b.length){if(M)return-1;m=b.length-1}else if(m<0)if(M)m=0;else return-1;if(typeof p=="string"&&(p=a.from(p,v)),a.isBuffer(p))return p.length===0?-1:F(b,p,m,v,M);if(typeof p=="number")return p=p&255,typeof Uint8Array.prototype.indexOf=="function"?M?Uint8Array.prototype.indexOf.call(b,p,m):Uint8Array.prototype.lastIndexOf.call(b,p,m):F(b,[p],m,v,M);throw new TypeError("val must be string, number or Buffer")}function F(b,p,m,v,M){let A=1,P=b.length,ce=p.length;if(v!==void 0&&(v=String(v).toLowerCase(),v==="ucs2"||v==="ucs-2"||v==="utf16le"||v==="utf-16le")){if(b.length<2||p.length<2)return-1;A=2,P/=2,ce/=2,m/=2}function Te(De,fe){return A===1?De[fe]:De.readUInt16BE(fe*A)}let oe;if(M){let De=-1;for(oe=m;oe<P;oe++)if(Te(b,oe)===Te(p,De===-1?0:oe-De)){if(De===-1&&(De=oe),oe-De+1===ce)return De*A}else De!==-1&&(oe-=oe-De),De=-1}else for(m+ce>P&&(m=P-ce),oe=m;oe>=0;oe--){let De=!0;for(let fe=0;fe<ce;fe++)if(Te(b,oe+fe)!==Te(p,fe)){De=!1;break}if(De)return oe}return-1}a.prototype.includes=function(p,m,v){return this.indexOf(p,m,v)!==-1},a.prototype.indexOf=function(p,m,v){return R(this,p,m,v,!0)},a.prototype.lastIndexOf=function(p,m,v){return R(this,p,m,v,!1)};function D(b,p,m,v){m=Number(m)||0;const M=b.length-m;v?(v=Number(v),v>M&&(v=M)):v=M;const A=p.length;v>A/2&&(v=A/2);let P;for(P=0;P<v;++P){const ce=parseInt(p.substr(P*2,2),16);if(nt(ce))return P;b[m+P]=ce}return P}function I(b,p,m,v){return kt(Xt(p,b.length-m),b,m,v)}function $(b,p,m,v){return kt(He(p),b,m,v)}function B(b,p,m,v){return kt(qe(p),b,m,v)}function U(b,p,m,v){return kt(ft(p,b.length-m),b,m,v)}a.prototype.write=function(p,m,v,M){if(m===void 0)M="utf8",v=this.length,m=0;else if(v===void 0&&typeof m=="string")M=m,v=this.length,m=0;else if(isFinite(m))m=m>>>0,isFinite(v)?(v=v>>>0,M===void 0&&(M="utf8")):(M=v,v=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const A=this.length-m;if((v===void 0||v>A)&&(v=A),p.length>0&&(v<0||m<0)||m>this.length)throw new RangeError("Attempt to write outside buffer bounds");M||(M="utf8");let P=!1;for(;;)switch(M){case"hex":return D(this,p,m,v);case"utf8":case"utf-8":return I(this,p,m,v);case"ascii":case"latin1":case"binary":return $(this,p,m,v);case"base64":return B(this,p,m,v);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return U(this,p,m,v);default:if(P)throw new TypeError("Unknown encoding: "+M);M=(""+M).toLowerCase(),P=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function V(b,p,m){return p===0&&m===b.length?e.fromByteArray(b):e.fromByteArray(b.slice(p,m))}function Y(b,p,m){m=Math.min(b.length,m);const v=[];let M=p;for(;M<m;){const A=b[M];let P=null,ce=A>239?4:A>223?3:A>191?2:1;if(M+ce<=m){let Te,oe,De,fe;switch(ce){case 1:A<128&&(P=A);break;case 2:Te=b[M+1],(Te&192)===128&&(fe=(A&31)<<6|Te&63,fe>127&&(P=fe));break;case 3:Te=b[M+1],oe=b[M+2],(Te&192)===128&&(oe&192)===128&&(fe=(A&15)<<12|(Te&63)<<6|oe&63,fe>2047&&(fe<55296||fe>57343)&&(P=fe));break;case 4:Te=b[M+1],oe=b[M+2],De=b[M+3],(Te&192)===128&&(oe&192)===128&&(De&192)===128&&(fe=(A&15)<<18|(Te&63)<<12|(oe&63)<<6|De&63,fe>65535&&fe<1114112&&(P=fe))}}P===null?(P=65533,ce=1):P>65535&&(P-=65536,v.push(P>>>10&1023|55296),P=56320|P&1023),v.push(P),M+=ce}return ne(v)}const te=4096;function ne(b){const p=b.length;if(p<=te)return String.fromCharCode.apply(String,b);let m="",v=0;for(;v<p;)m+=String.fromCharCode.apply(String,b.slice(v,v+=te));return m}function pe(b,p,m){let v="";m=Math.min(b.length,m);for(let M=p;M<m;++M)v+=String.fromCharCode(b[M]&127);return v}function H(b,p,m){let v="";m=Math.min(b.length,m);for(let M=p;M<m;++M)v+=String.fromCharCode(b[M]);return v}function L(b,p,m){const v=b.length;(!p||p<0)&&(p=0),(!m||m<0||m>v)&&(m=v);let M="";for(let A=p;A<m;++A)M+=Re[b[A]];return M}function ue(b,p,m){const v=b.slice(p,m);let M="";for(let A=0;A<v.length-1;A+=2)M+=String.fromCharCode(v[A]+v[A+1]*256);return M}a.prototype.slice=function(p,m){const v=this.length;p=~~p,m=m===void 0?v:~~m,p<0?(p+=v,p<0&&(p=0)):p>v&&(p=v),m<0?(m+=v,m<0&&(m=0)):m>v&&(m=v),m<p&&(m=p);const M=this.subarray(p,m);return Object.setPrototypeOf(M,a.prototype),M};function le(b,p,m){if(b%1!==0||b<0)throw new RangeError("offset is not uint");if(b+p>m)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(p,m,v){p=p>>>0,m=m>>>0,v||le(p,m,this.length);let M=this[p],A=1,P=0;for(;++P<m&&(A*=256);)M+=this[p+P]*A;return M},a.prototype.readUintBE=a.prototype.readUIntBE=function(p,m,v){p=p>>>0,m=m>>>0,v||le(p,m,this.length);let M=this[p+--m],A=1;for(;m>0&&(A*=256);)M+=this[p+--m]*A;return M},a.prototype.readUint8=a.prototype.readUInt8=function(p,m){return p=p>>>0,m||le(p,1,this.length),this[p]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(p,m){return p=p>>>0,m||le(p,2,this.length),this[p]|this[p+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(p,m){return p=p>>>0,m||le(p,2,this.length),this[p]<<8|this[p+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(p,m){return p=p>>>0,m||le(p,4,this.length),(this[p]|this[p+1]<<8|this[p+2]<<16)+this[p+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(p,m){return p=p>>>0,m||le(p,4,this.length),this[p]*16777216+(this[p+1]<<16|this[p+2]<<8|this[p+3])},a.prototype.readBigUInt64LE=st(function(p){p=p>>>0,Ee(p,"offset");const m=this[p],v=this[p+7];(m===void 0||v===void 0)&&ut(p,this.length-8);const M=m+this[++p]*2**8+this[++p]*2**16+this[++p]*2**24,A=this[++p]+this[++p]*2**8+this[++p]*2**16+v*2**24;return BigInt(M)+(BigInt(A)<<BigInt(32))}),a.prototype.readBigUInt64BE=st(function(p){p=p>>>0,Ee(p,"offset");const m=this[p],v=this[p+7];(m===void 0||v===void 0)&&ut(p,this.length-8);const M=m*2**24+this[++p]*2**16+this[++p]*2**8+this[++p],A=this[++p]*2**24+this[++p]*2**16+this[++p]*2**8+v;return(BigInt(M)<<BigInt(32))+BigInt(A)}),a.prototype.readIntLE=function(p,m,v){p=p>>>0,m=m>>>0,v||le(p,m,this.length);let M=this[p],A=1,P=0;for(;++P<m&&(A*=256);)M+=this[p+P]*A;return A*=128,M>=A&&(M-=Math.pow(2,8*m)),M},a.prototype.readIntBE=function(p,m,v){p=p>>>0,m=m>>>0,v||le(p,m,this.length);let M=m,A=1,P=this[p+--M];for(;M>0&&(A*=256);)P+=this[p+--M]*A;return A*=128,P>=A&&(P-=Math.pow(2,8*m)),P},a.prototype.readInt8=function(p,m){return p=p>>>0,m||le(p,1,this.length),this[p]&128?(255-this[p]+1)*-1:this[p]},a.prototype.readInt16LE=function(p,m){p=p>>>0,m||le(p,2,this.length);const v=this[p]|this[p+1]<<8;return v&32768?v|4294901760:v},a.prototype.readInt16BE=function(p,m){p=p>>>0,m||le(p,2,this.length);const v=this[p+1]|this[p]<<8;return v&32768?v|4294901760:v},a.prototype.readInt32LE=function(p,m){return p=p>>>0,m||le(p,4,this.length),this[p]|this[p+1]<<8|this[p+2]<<16|this[p+3]<<24},a.prototype.readInt32BE=function(p,m){return p=p>>>0,m||le(p,4,this.length),this[p]<<24|this[p+1]<<16|this[p+2]<<8|this[p+3]},a.prototype.readBigInt64LE=st(function(p){p=p>>>0,Ee(p,"offset");const m=this[p],v=this[p+7];(m===void 0||v===void 0)&&ut(p,this.length-8);const M=this[p+4]+this[p+5]*2**8+this[p+6]*2**16+(v<<24);return(BigInt(M)<<BigInt(32))+BigInt(m+this[++p]*2**8+this[++p]*2**16+this[++p]*2**24)}),a.prototype.readBigInt64BE=st(function(p){p=p>>>0,Ee(p,"offset");const m=this[p],v=this[p+7];(m===void 0||v===void 0)&&ut(p,this.length-8);const M=(m<<24)+this[++p]*2**16+this[++p]*2**8+this[++p];return(BigInt(M)<<BigInt(32))+BigInt(this[++p]*2**24+this[++p]*2**16+this[++p]*2**8+v)}),a.prototype.readFloatLE=function(p,m){return p=p>>>0,m||le(p,4,this.length),t.read(this,p,!0,23,4)},a.prototype.readFloatBE=function(p,m){return p=p>>>0,m||le(p,4,this.length),t.read(this,p,!1,23,4)},a.prototype.readDoubleLE=function(p,m){return p=p>>>0,m||le(p,8,this.length),t.read(this,p,!0,52,8)},a.prototype.readDoubleBE=function(p,m){return p=p>>>0,m||le(p,8,this.length),t.read(this,p,!1,52,8)};function Q(b,p,m,v,M,A){if(!a.isBuffer(b))throw new TypeError('"buffer" argument must be a Buffer instance');if(p>M||p<A)throw new RangeError('"value" argument is out of bounds');if(m+v>b.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(p,m,v,M){if(p=+p,m=m>>>0,v=v>>>0,!M){const ce=Math.pow(2,8*v)-1;Q(this,p,m,v,ce,0)}let A=1,P=0;for(this[m]=p&255;++P<v&&(A*=256);)this[m+P]=p/A&255;return m+v},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(p,m,v,M){if(p=+p,m=m>>>0,v=v>>>0,!M){const ce=Math.pow(2,8*v)-1;Q(this,p,m,v,ce,0)}let A=v-1,P=1;for(this[m+A]=p&255;--A>=0&&(P*=256);)this[m+A]=p/P&255;return m+v},a.prototype.writeUint8=a.prototype.writeUInt8=function(p,m,v){return p=+p,m=m>>>0,v||Q(this,p,m,1,255,0),this[m]=p&255,m+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(p,m,v){return p=+p,m=m>>>0,v||Q(this,p,m,2,65535,0),this[m]=p&255,this[m+1]=p>>>8,m+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(p,m,v){return p=+p,m=m>>>0,v||Q(this,p,m,2,65535,0),this[m]=p>>>8,this[m+1]=p&255,m+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(p,m,v){return p=+p,m=m>>>0,v||Q(this,p,m,4,4294967295,0),this[m+3]=p>>>24,this[m+2]=p>>>16,this[m+1]=p>>>8,this[m]=p&255,m+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(p,m,v){return p=+p,m=m>>>0,v||Q(this,p,m,4,4294967295,0),this[m]=p>>>24,this[m+1]=p>>>16,this[m+2]=p>>>8,this[m+3]=p&255,m+4};function Ge(b,p,m,v,M){ve(p,v,M,b,m,7);let A=Number(p&BigInt(4294967295));b[m++]=A,A=A>>8,b[m++]=A,A=A>>8,b[m++]=A,A=A>>8,b[m++]=A;let P=Number(p>>BigInt(32)&BigInt(4294967295));return b[m++]=P,P=P>>8,b[m++]=P,P=P>>8,b[m++]=P,P=P>>8,b[m++]=P,m}function ze(b,p,m,v,M){ve(p,v,M,b,m,7);let A=Number(p&BigInt(4294967295));b[m+7]=A,A=A>>8,b[m+6]=A,A=A>>8,b[m+5]=A,A=A>>8,b[m+4]=A;let P=Number(p>>BigInt(32)&BigInt(4294967295));return b[m+3]=P,P=P>>8,b[m+2]=P,P=P>>8,b[m+1]=P,P=P>>8,b[m]=P,m+8}a.prototype.writeBigUInt64LE=st(function(p,m=0){return Ge(this,p,m,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=st(function(p,m=0){return ze(this,p,m,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(p,m,v,M){if(p=+p,m=m>>>0,!M){const Te=Math.pow(2,8*v-1);Q(this,p,m,v,Te-1,-Te)}let A=0,P=1,ce=0;for(this[m]=p&255;++A<v&&(P*=256);)p<0&&ce===0&&this[m+A-1]!==0&&(ce=1),this[m+A]=(p/P>>0)-ce&255;return m+v},a.prototype.writeIntBE=function(p,m,v,M){if(p=+p,m=m>>>0,!M){const Te=Math.pow(2,8*v-1);Q(this,p,m,v,Te-1,-Te)}let A=v-1,P=1,ce=0;for(this[m+A]=p&255;--A>=0&&(P*=256);)p<0&&ce===0&&this[m+A+1]!==0&&(ce=1),this[m+A]=(p/P>>0)-ce&255;return m+v},a.prototype.writeInt8=function(p,m,v){return p=+p,m=m>>>0,v||Q(this,p,m,1,127,-128),p<0&&(p=255+p+1),this[m]=p&255,m+1},a.prototype.writeInt16LE=function(p,m,v){return p=+p,m=m>>>0,v||Q(this,p,m,2,32767,-32768),this[m]=p&255,this[m+1]=p>>>8,m+2},a.prototype.writeInt16BE=function(p,m,v){return p=+p,m=m>>>0,v||Q(this,p,m,2,32767,-32768),this[m]=p>>>8,this[m+1]=p&255,m+2},a.prototype.writeInt32LE=function(p,m,v){return p=+p,m=m>>>0,v||Q(this,p,m,4,2147483647,-2147483648),this[m]=p&255,this[m+1]=p>>>8,this[m+2]=p>>>16,this[m+3]=p>>>24,m+4},a.prototype.writeInt32BE=function(p,m,v){return p=+p,m=m>>>0,v||Q(this,p,m,4,2147483647,-2147483648),p<0&&(p=4294967295+p+1),this[m]=p>>>24,this[m+1]=p>>>16,this[m+2]=p>>>8,this[m+3]=p&255,m+4},a.prototype.writeBigInt64LE=st(function(p,m=0){return Ge(this,p,m,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=st(function(p,m=0){return ze(this,p,m,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function me(b,p,m,v,M,A){if(m+v>b.length)throw new RangeError("Index out of range");if(m<0)throw new RangeError("Index out of range")}function we(b,p,m,v,M){return p=+p,m=m>>>0,M||me(b,p,m,4),t.write(b,p,m,v,23,4),m+4}a.prototype.writeFloatLE=function(p,m,v){return we(this,p,m,!0,v)},a.prototype.writeFloatBE=function(p,m,v){return we(this,p,m,!1,v)};function Fe(b,p,m,v,M){return p=+p,m=m>>>0,M||me(b,p,m,8),t.write(b,p,m,v,52,8),m+8}a.prototype.writeDoubleLE=function(p,m,v){return Fe(this,p,m,!0,v)},a.prototype.writeDoubleBE=function(p,m,v){return Fe(this,p,m,!1,v)},a.prototype.copy=function(p,m,v,M){if(!a.isBuffer(p))throw new TypeError("argument should be a Buffer");if(v||(v=0),!M&&M!==0&&(M=this.length),m>=p.length&&(m=p.length),m||(m=0),M>0&&M<v&&(M=v),M===v||p.length===0||this.length===0)return 0;if(m<0)throw new RangeError("targetStart out of bounds");if(v<0||v>=this.length)throw new RangeError("Index out of range");if(M<0)throw new RangeError("sourceEnd out of bounds");M>this.length&&(M=this.length),p.length-m<M-v&&(M=p.length-m+v);const A=M-v;return this===p&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(m,v,M):Uint8Array.prototype.set.call(p,this.subarray(v,M),m),A},a.prototype.fill=function(p,m,v,M){if(typeof p=="string"){if(typeof m=="string"?(M=m,m=0,v=this.length):typeof v=="string"&&(M=v,v=this.length),M!==void 0&&typeof M!="string")throw new TypeError("encoding must be a string");if(typeof M=="string"&&!a.isEncoding(M))throw new TypeError("Unknown encoding: "+M);if(p.length===1){const P=p.charCodeAt(0);(M==="utf8"&&P<128||M==="latin1")&&(p=P)}}else typeof p=="number"?p=p&255:typeof p=="boolean"&&(p=Number(p));if(m<0||this.length<m||this.length<v)throw new RangeError("Out of range index");if(v<=m)return this;m=m>>>0,v=v===void 0?this.length:v>>>0,p||(p=0);let A;if(typeof p=="number")for(A=m;A<v;++A)this[A]=p;else{const P=a.isBuffer(p)?p:a.from(p,M),ce=P.length;if(ce===0)throw new TypeError('The value "'+p+'" is invalid for argument "value"');for(A=0;A<v-m;++A)this[A+m]=P[A%ce]}return this};const q={};function Z(b,p,m){q[b]=class extends m{constructor(){super(),Object.defineProperty(this,"message",{value:p.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${b}]`,this.stack,delete this.name}get code(){return b}set code(M){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:M,writable:!0})}toString(){return`${this.name} [${b}]: ${this.message}`}}}Z("ERR_BUFFER_OUT_OF_BOUNDS",function(b){return b?`${b} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Z("ERR_INVALID_ARG_TYPE",function(b,p){return`The "${b}" argument must be of type number. Received type ${typeof p}`},TypeError),Z("ERR_OUT_OF_RANGE",function(b,p,m){let v=`The value of "${b}" is out of range.`,M=m;return Number.isInteger(m)&&Math.abs(m)>2**32?M=Me(String(m)):typeof m=="bigint"&&(M=String(m),(m>BigInt(2)**BigInt(32)||m<-(BigInt(2)**BigInt(32)))&&(M=Me(M)),M+="n"),v+=` It must be ${p}. Received ${M}`,v},RangeError);function Me(b){let p="",m=b.length;const v=b[0]==="-"?1:0;for(;m>=v+4;m-=3)p=`_${b.slice(m-3,m)}${p}`;return`${b.slice(0,m)}${p}`}function be(b,p,m){Ee(p,"offset"),(b[p]===void 0||b[p+m]===void 0)&&ut(p,b.length-(m+1))}function ve(b,p,m,v,M,A){if(b>m||b<p){const P=typeof p=="bigint"?"n":"";let ce;throw p===0||p===BigInt(0)?ce=`>= 0${P} and < 2${P} ** ${(A+1)*8}${P}`:ce=`>= -(2${P} ** ${(A+1)*8-1}${P}) and < 2 ** ${(A+1)*8-1}${P}`,new q.ERR_OUT_OF_RANGE("value",ce,b)}be(v,M,A)}function Ee(b,p){if(typeof b!="number")throw new q.ERR_INVALID_ARG_TYPE(p,"number",b)}function ut(b,p,m){throw Math.floor(b)!==b?(Ee(b,m),new q.ERR_OUT_OF_RANGE("offset","an integer",b)):p<0?new q.ERR_BUFFER_OUT_OF_BOUNDS:new q.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${p}`,b)}const ke=/[^+/0-9A-Za-z-_]/g;function bt(b){if(b=b.split("=")[0],b=b.trim().replace(ke,""),b.length<2)return"";for(;b.length%4!==0;)b=b+"=";return b}function Xt(b,p){p=p||1/0;let m;const v=b.length;let M=null;const A=[];for(let P=0;P<v;++P){if(m=b.charCodeAt(P),m>55295&&m<57344){if(!M){if(m>56319){(p-=3)>-1&&A.push(239,191,189);continue}else if(P+1===v){(p-=3)>-1&&A.push(239,191,189);continue}M=m;continue}if(m<56320){(p-=3)>-1&&A.push(239,191,189),M=m;continue}m=(M-55296<<10|m-56320)+65536}else M&&(p-=3)>-1&&A.push(239,191,189);if(M=null,m<128){if((p-=1)<0)break;A.push(m)}else if(m<2048){if((p-=2)<0)break;A.push(m>>6|192,m&63|128)}else if(m<65536){if((p-=3)<0)break;A.push(m>>12|224,m>>6&63|128,m&63|128)}else if(m<1114112){if((p-=4)<0)break;A.push(m>>18|240,m>>12&63|128,m>>6&63|128,m&63|128)}else throw new Error("Invalid code point")}return A}function He(b){const p=[];for(let m=0;m<b.length;++m)p.push(b.charCodeAt(m)&255);return p}function ft(b,p){let m,v,M;const A=[];for(let P=0;P<b.length&&!((p-=2)<0);++P)m=b.charCodeAt(P),v=m>>8,M=m%256,A.push(M),A.push(v);return A}function qe(b){return e.toByteArray(bt(b))}function kt(b,p,m,v){let M;for(M=0;M<v&&!(M+m>=p.length||M>=b.length);++M)p[M+m]=b[M];return M}function Ie(b,p){return b instanceof p||b!=null&&b.constructor!=null&&b.constructor.name!=null&&b.constructor.name===p.name}function nt(b){return b!==b}const Re=function(){const b="0123456789abcdef",p=new Array(256);for(let m=0;m<16;++m){const v=m*16;for(let M=0;M<16;++M)p[v+M]=b[m]+b[M]}return p}();function st(b){return typeof BigInt>"u"?at:b}function at(){throw new Error("BigInt not supported")}})(fd);function rC(n){if(typeof n!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!n)throw new Error("No input");const e=JSON.parse(n),t=e;let s;if(t.type==="system")if(t.event==="connected")s=Object.assign(Object.assign({},e),{kind:"connected"});else if(t.event==="disconnected")s=Object.assign(Object.assign({},e),{kind:"disconnected"});else return null;else if(t.type==="message")if(t.from==="group"){const i=Yu(e.data,e.dataType);if(i===null)return null;s=Object.assign(Object.assign({},e),{data:i,kind:"groupData"})}else if(t.from==="server"){const i=Yu(e.data,e.dataType);if(i===null)return null;s=Object.assign(Object.assign({},e),{data:i,kind:"serverData"})}else return null;else if(t.type==="ack")s=Object.assign(Object.assign({},e),{kind:"ack"});else return null;return s}function oC(n){let e;switch(n.kind){case"joinGroup":{e={type:"joinGroup",group:n.group,ackId:n.ackId};break}case"leaveGroup":{e={type:"leaveGroup",group:n.group,ackId:n.ackId};break}case"sendEvent":{e={type:"event",event:n.event,ackId:n.ackId,dataType:n.dataType,data:Ju(n.data,n.dataType)};break}case"sendToGroup":{e={type:"sendToGroup",group:n.group,ackId:n.ackId,dataType:n.dataType,data:Ju(n.data,n.dataType),noEcho:n.noEcho};break}case"sequenceAck":{e={type:"sequenceAck",sequenceId:n.sequenceId};break}default:throw new Error(`Unsupported type: ${n.kind}`)}return JSON.stringify(e)}function Ju(n,e){switch(e){case"text":{if(typeof n!="string")throw new TypeError("Message must be a string.");return n}case"json":return n;case"binary":case"protobuf":{if(n instanceof ArrayBuffer)return fd.Buffer.from(n).toString("base64");throw new TypeError("Message must be a ArrayBuffer")}}}function Yu(n,e){if(e==="text"){if(typeof n!="string")throw new TypeError("Message must be a string when dataType is text");return n}else{if(e==="json")return n;if(e==="binary"||e==="protobuf"){const t=fd.Buffer.from(n,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}else return null}}class aC{constructor(){this.isReliableSubProtocol=!0,this.name="json.reliable.webpubsub.azure.v1"}parseMessages(e){return rC(e)}writeMessage(e){return oC(e)}}const lC=()=>new aC;async function cC(n,e){if(e.aborted)throw new uc("The operation was aborted.");let t;const s=new Promise((i,r)=>{t=()=>{r(new uc("The operation was aborted."))},e.addEventListener("abort",t)});try{return await Promise.race([n,s])}finally{e.removeEventListener("abort",t)}}var Qt;(function(n){n.Stopped="Stopped",n.Disconnected="Disconnected",n.Connecting="Connecting",n.Connected="Connected",n.Recovering="Recovering"})(Qt||(Qt={}));class dC{nextAckId(){return this._ackId=this._ackId+1,this._ackId}constructor(e,t){this._quickSequenceAckDiff=300,this._activeTimeoutInMs=2e4,this._emitter=new Mw,this._isStopping=!1,this._isInitialConnected=!1,typeof e=="string"?this._credential={getClientAccessUrl:e}:this._credential=e,t==null&&(t={}),this._buildDefaultOptions(t),this._options=t,this._messageRetryPolicy=new Xu(this._options.messageRetryOptions),this._reconnectRetryPolicy=new Xu(this._options.reconnectRetryOptions),this._protocol=this._options.protocol,this._groupMap=new Map,this._ackMap=new Map,this._sequenceId=new hC,this._state=Qt.Stopped,this._ackId=0}async start(e){if(this._isStopping)throw new Error("Can't start a client during stopping");if(this._state!==Qt.Stopped)throw new Error("Client can be only started when it's Stopped");let t;e&&(t=e.abortSignal),this._activeKeepaliveTask||(this._activeKeepaliveTask=this._getActiveKeepaliveTask());try{await this._startCore(t)}catch(s){throw this._changeState(Qt.Stopped),this._activeKeepaliveTask&&(this._activeKeepaliveTask.abort(),this._activeKeepaliveTask=void 0),this._isStopping=!1,s}}async _startFromRestarting(e){if(this._state!==Qt.Disconnected)throw new Error("Client can be only restarted when it's Disconnected");try{jt.verbose("Staring reconnecting."),await this._startCore(e)}catch(t){throw this._changeState(Qt.Disconnected),t}}async _startCore(e){if(this._changeState(Qt.Connecting),jt.info("Staring a new connection"),this._sequenceId.reset(),this._isInitialConnected=!1,this._lastCloseEvent=void 0,this._lastDisconnectedMessage=void 0,this._connectionId=void 0,this._reconnectionToken=void 0,this._uri=void 0,typeof this._credential.getClientAccessUrl=="string"?this._uri=this._credential.getClientAccessUrl:this._uri=await this._credential.getClientAccessUrl({abortSignal:e}),typeof this._uri!="string")throw new Error(`The clientAccessUrl must be a string but currently it's ${typeof this._uri}`);await this._connectCore(this._uri)}stop(){this._state===Qt.Stopped||this._isStopping||(this._isStopping=!0,this._wsClient&&this._wsClient.isOpen()?this._wsClient.close():this._isStopping=!1,this._activeKeepaliveTask&&(this._activeKeepaliveTask.abort(),this._activeKeepaliveTask=void 0))}on(e,t){this._emitter.on(e,t)}off(e,t){this._emitter.removeListener(e,t)}_emitEvent(e,t){this._emitter.emit(e,t)}async sendEvent(e,t,s,i){return await this._operationExecuteWithRetry(()=>this._sendEventAttempt(e,t,s,i),i==null?void 0:i.abortSignal)}async _sendEventAttempt(e,t,s,i){var r;if(!((r=i==null?void 0:i.fireAndForget)!==null&&r!==void 0?r:!1))return await this._sendMessageWithAckId(l=>({kind:"sendEvent",dataType:s,data:t,ackId:l,event:e}),i==null?void 0:i.ackId,i==null?void 0:i.abortSignal);const a={kind:"sendEvent",dataType:s,data:t,event:e};return await this._sendMessage(a,i==null?void 0:i.abortSignal),{isDuplicated:!1}}async joinGroup(e,t){return await this._operationExecuteWithRetry(()=>this._joinGroupAttempt(e,t),t==null?void 0:t.abortSignal)}async _joinGroupAttempt(e,t){const s=this._getOrAddGroup(e),i=await this._joinGroupCore(e,t);return s.isJoined=!0,i}async _joinGroupCore(e,t){return await this._sendMessageWithAckId(s=>({group:e,ackId:s,kind:"joinGroup"}),t==null?void 0:t.ackId,t==null?void 0:t.abortSignal)}async leaveGroup(e,t){return await this._operationExecuteWithRetry(()=>this._leaveGroupAttempt(e,t),t==null?void 0:t.abortSignal)}async _leaveGroupAttempt(e,t){const s=this._getOrAddGroup(e),i=await this._sendMessageWithAckId(r=>({group:e,ackId:r,kind:"leaveGroup"}),t==null?void 0:t.ackId,t==null?void 0:t.abortSignal);return s.isJoined=!1,i}async sendToGroup(e,t,s,i){return await this._operationExecuteWithRetry(()=>this._sendToGroupAttempt(e,t,s,i),i==null?void 0:i.abortSignal)}async _sendToGroupAttempt(e,t,s,i){var r,o;const a=(r=i==null?void 0:i.fireAndForget)!==null&&r!==void 0?r:!1,l=(o=i==null?void 0:i.noEcho)!==null&&o!==void 0?o:!1;if(!a)return await this._sendMessageWithAckId(u=>({kind:"sendToGroup",group:e,dataType:s,data:t,ackId:u,noEcho:l}),i==null?void 0:i.ackId,i==null?void 0:i.abortSignal);const d={kind:"sendToGroup",group:e,dataType:s,data:t,noEcho:l};return await this._sendMessage(d,i==null?void 0:i.abortSignal),{isDuplicated:!1}}_getWebSocketClientFactory(){return new r1}async _trySendSequenceAck(){if(!this._protocol.isReliableSubProtocol)return;const[e,t]=this._sequenceId.tryGetSequenceId();if(e&&t){const s={kind:"sequenceAck",sequenceId:t};try{await this._sendMessage(s)}catch{this._sequenceId.tryUpdate(t)}}}_connectCore(e){if(this._isStopping)throw new Error("Can't start a client during stopping");return new Promise((t,s)=>{const i=this._wsClient=this._getWebSocketClientFactory().create(e,this._protocol.name);i.onopen(()=>{if(this._isStopping){try{i.close()}catch{}s(new Error("The client is stopped"))}jt.verbose("WebSocket connection has opened"),this._changeState(Qt.Connected),this._protocol.isReliableSubProtocol&&(this._sequenceAckTask!=null&&this._sequenceAckTask.abort(),this._sequenceAckTask=new Qu(async()=>{await this._trySendSequenceAck()},1e3)),t()}),i.onerror(r=>{this._sequenceAckTask!=null&&this._sequenceAckTask.abort(),s(r)}),i.onclose((r,o)=>{this._state===Qt.Connected?(jt.verbose("WebSocket closed after open"),this._sequenceAckTask!=null&&this._sequenceAckTask.abort(),jt.info(`WebSocket connection closed. Code: ${r}, Reason: ${o}`),this._lastCloseEvent={code:r,reason:o},this._handleConnectionClose.call(this)):(jt.verbose("WebSocket closed before open"),s(new Error(`Failed to start WebSocket: ${r}`)))}),i.onmessage(r=>{const o=h=>{if(this._ackMap.has(h.ackId)){const g=this._ackMap.get(h.ackId);this._ackMap.delete(h.ackId);const x=h.error!=null&&h.error.name==="Duplicate";h.success||x?g.resolve({ackId:h.ackId,isDuplicated:x}):g.reject(new Mo("Failed to send message.",{ackId:h.ackId,errorDetail:h.error}))}},a=async h=>{if(this._connectionId=h.connectionId,this._reconnectionToken=h.reconnectionToken,!this._isInitialConnected){if(this._isInitialConnected=!0,this._options.autoRejoinGroups){const g=[];this._groupMap.forEach(x=>{x.isJoined&&g.push((async()=>{try{await this._joinGroupCore(x.name)}catch(y){this._safeEmitRejoinGroupFailed(x.name,y)}})())});try{await Promise.all(g)}catch{}}this._safeEmitConnected(h.connectionId,h.userId)}},l=h=>{this._lastDisconnectedMessage=h},d=h=>{if(h.sequenceId!=null){const g=this._sequenceId.tryUpdate(h.sequenceId);if(g===0)return;g>this._quickSequenceAckDiff&&this._trySendSequenceAck()}this._safeEmitGroupMessage(h)},u=h=>{if(h.sequenceId!=null){const g=this._sequenceId.tryUpdate(h.sequenceId);if(g===0)return;g>this._quickSequenceAckDiff&&this._trySendSequenceAck()}this._safeEmitServerMessage(h)};let f;try{let h;if(Array.isArray(r)?h=Buffer.concat(r):h=r,f=this._protocol.parseMessages(h),f===null)return}catch(h){throw jt.warning("An error occurred while parsing the message from service",h),h}Array.isArray(f)||(f=[f]),f.forEach(h=>{try{switch(h.kind){case"ack":{o(h);break}case"connected":{a(h);break}case"disconnected":{l(h);break}case"groupData":{d(h);break}case"serverData":{u(h);break}}}catch(g){jt.warning(`An error occurred while handling the message with kind: ${h.kind} from service`,g)}})})})}async _handleConnectionCloseAndNoRecovery(){this._state=Qt.Disconnected,this._safeEmitDisconnected(this._connectionId,this._lastDisconnectedMessage),this._options.autoReconnect?await this._autoReconnect():await this._handleConnectionStopped()}async _autoReconnect(){let e=!1,t=0;try{for(;!this._isStopping;)try{await this._startFromRestarting(),e=!0;break}catch(s){jt.warning("An attempt to reconnect connection failed.",s),t++;const i=this._reconnectRetryPolicy.nextRetryDelayInMs(t);if(i==null)break;try{jt.verbose(`Delay time for reconnect attempt ${t}: ${i}`),await qo(i)}catch{}}}finally{e||this._handleConnectionStopped()}}_handleConnectionStopped(){this._isStopping=!1,this._state=Qt.Stopped,this._safeEmitStopped()}_getActiveKeepaliveTask(){return new Qu(async()=>{this._sequenceId.tryUpdate(0)},this._activeTimeoutInMs)}async _sendMessage(e,t){if(!this._wsClient||!this._wsClient.isOpen())throw new Error("The connection is not connected.");const s=this._protocol.writeMessage(e);await this._wsClient.send(s,t)}async _sendMessageWithAckId(e,t,s){t==null&&(t=this.nextAckId());const i=e(t);this._ackMap.has(t)||this._ackMap.set(t,new fC(t));const r=this._ackMap.get(t);try{await this._sendMessage(i,s)}catch(o){this._ackMap.delete(t);let a="";throw o instanceof Error&&(a=o.message),new Mo(a,{ackId:t})}if(s)try{return await cC(r.promise(),s)}catch(o){throw o instanceof Error&&o.name==="AbortError"?new Mo("Cancelled by abortSignal",{ackId:t}):o}return await r.promise()}async _handleConnectionClose(){if(this._ackMap.forEach((i,r)=>{this._ackMap.delete(r)&&i.reject(new Mo("Connection is disconnected before receive ack from the service",{ackId:i.ackId}))}),this._isStopping){jt.warning("The client is stopping state. Stop recovery."),this._handleConnectionCloseAndNoRecovery();return}if(this._lastCloseEvent&&this._lastCloseEvent.code===1008){jt.warning("The websocket close with status code 1008. Stop recovery."),this._handleConnectionCloseAndNoRecovery();return}if(!this._protocol.isReliableSubProtocol){jt.warning("The protocol is not reliable, recovery is not applicable"),this._handleConnectionCloseAndNoRecovery();return}const e=this._buildRecoveryUri();if(!e){jt.warning("Connection id or reconnection token is not available"),this._handleConnectionCloseAndNoRecovery();return}let t=!1;this._state=Qt.Recovering;const s=Dm.timeout(30*1e3);try{for(;!s.aborted||this._isStopping;)try{await this._connectCore.call(this,e),t=!0;return}catch{await qo(1e3)}}finally{t||(jt.warning("Recovery attempts failed more then 30 seconds or the client is stopping"),this._handleConnectionCloseAndNoRecovery())}}_safeEmitConnected(e,t){this._emitEvent("connected",{connectionId:e,userId:t})}_safeEmitDisconnected(e,t){this._emitEvent("disconnected",{connectionId:e,message:t})}_safeEmitGroupMessage(e){this._emitEvent("group-message",{message:e})}_safeEmitServerMessage(e){this._emitEvent("server-message",{message:e})}_safeEmitStopped(){this._emitEvent("stopped",{})}_safeEmitRejoinGroupFailed(e,t){this._emitEvent("rejoin-group-failed",{group:e,error:t})}_buildDefaultOptions(e){return e.autoReconnect==null&&(e.autoReconnect=!0),e.autoRejoinGroups==null&&(e.autoRejoinGroups=!0),e.protocol==null&&(e.protocol=lC()),this._buildMessageRetryOptions(e),this._buildReconnectRetryOptions(e),e}_buildMessageRetryOptions(e){e.messageRetryOptions||(e.messageRetryOptions={}),(e.messageRetryOptions.maxRetries==null||e.messageRetryOptions.maxRetries<0)&&(e.messageRetryOptions.maxRetries=3),(e.messageRetryOptions.retryDelayInMs==null||e.messageRetryOptions.retryDelayInMs<0)&&(e.messageRetryOptions.retryDelayInMs=1e3),(e.messageRetryOptions.maxRetryDelayInMs==null||e.messageRetryOptions.maxRetryDelayInMs<0)&&(e.messageRetryOptions.maxRetryDelayInMs=3e4),e.messageRetryOptions.mode==null&&(e.messageRetryOptions.mode="Fixed")}_buildReconnectRetryOptions(e){e.reconnectRetryOptions||(e.reconnectRetryOptions={}),(e.reconnectRetryOptions.maxRetries==null||e.reconnectRetryOptions.maxRetries<0)&&(e.reconnectRetryOptions.maxRetries=Number.MAX_VALUE),(e.reconnectRetryOptions.retryDelayInMs==null||e.reconnectRetryOptions.retryDelayInMs<0)&&(e.reconnectRetryOptions.retryDelayInMs=1e3),(e.reconnectRetryOptions.maxRetryDelayInMs==null||e.reconnectRetryOptions.maxRetryDelayInMs<0)&&(e.reconnectRetryOptions.maxRetryDelayInMs=3e4),e.reconnectRetryOptions.mode==null&&(e.reconnectRetryOptions.mode="Fixed")}_buildRecoveryUri(){if(this._connectionId&&this._reconnectionToken&&this._uri){const e=new URL(this._uri);return e.searchParams.append("awps_connection_id",this._connectionId),e.searchParams.append("awps_reconnection_token",this._reconnectionToken),e.toString()}return null}_getOrAddGroup(e){return this._groupMap.has(e)||this._groupMap.set(e,new uC(e)),this._groupMap.get(e)}_changeState(e){jt.verbose(`The client state transfer from ${this._state.toString()} to ${e.toString()}`),this._state=e}async _operationExecuteWithRetry(e,t){let s=0;for(;;)try{return await e.call(this)}catch(i){s++;const r=this._messageRetryPolicy.nextRetryDelayInMs(s);if(r==null||(await qo(r),t!=null&&t.aborted))throw i}}}class Xu{constructor(e){this._retryOptions=e,this._maxRetriesToGetMaxDelay=Math.ceil(Math.log2(this._retryOptions.maxRetryDelayInMs)-Math.log2(this._retryOptions.retryDelayInMs)+1)}nextRetryDelayInMs(e){return e>this._retryOptions.maxRetries?null:this._retryOptions.mode==="Fixed"?this._retryOptions.retryDelayInMs:this._calculateExponentialDelay(e)}_calculateExponentialDelay(e){return e>=this._maxRetriesToGetMaxDelay?this._retryOptions.maxRetryDelayInMs:(1<<e-1)*this._retryOptions.retryDelayInMs}}class uC{constructor(e){this.isJoined=!1,this.name=e}}class fC{constructor(e){this._promise=new Promise((t,s)=>{this._resolve=t,this._reject=s}),this.ackId=e}promise(){return this._promise}resolve(e){this._resolve(e)}reject(e){this._reject(e)}}class hC{constructor(){this._sequenceId=0,this._isUpdate=!1}tryUpdate(e){if(this._isUpdate=!0,e>this._sequenceId){const t=e-this._sequenceId;return this._sequenceId=e,t}return 0}tryGetSequenceId(){return this._isUpdate?(this._isUpdate=!1,[!0,this._sequenceId]):[!1,null]}reset(){this._sequenceId=0,this._isUpdate=!1}}class Qu{constructor(e,t,s){this._func=e,this._abortController=new Dm,this._interval=t,this._obj=s,this._start()}abort(){try{this._abortController.abort()}catch{}}async _start(){const e=this._abortController.signal;for(;!e.aborted;)try{await this._func(this._obj)}catch{}finally{await qo(this._interval)}}}const pC=1e3*60*60,mC=1e3*30;class gC{constructor(e,t,s,i=null,r=new Map){se(this,"client");se(this,"handler");se(this,"terminationTimeout",null);se(this,"connectionUrl");se(this,"expiresAt");se(this,"connected",!1);se(this,"websocketRequestId",null);se(this,"conversationId",null);se(this,"secondaryTypeBasedHandlers",new Map);this.connectionUrl=t,this.expiresAt=s,this.client=new dC({getClientAccessUrl:()=>e(this.connectionUrl,this.expiresAt)},{autoReconnect:!0,reconnectRetryOptions:{maxRetries:5,retryDelayInMs:100,maxRetryDelayInMs:1e4,mode:"Exponential"}}),this.handler=i,this.secondaryTypeBasedHandlers=r}async start(){const e=t=>{if(this.secondaryTypeBasedHandlers.has(t.message.data.type)){const s=this.secondaryTypeBasedHandlers.get(t.message.data.type);if(!s)return;s(t.message.data)}else{const s=t.message.data.body,i=atob(s).trim();if(i.startsWith("data: ")){const r=i.replace("data: ",""),o=this.handler;if(!o)return;o({conversationId:t.message.data.conversation_id,responseId:t.message.data.response_id,message:{id:"",event:"",data:r},websocketRequestId:t.message.data.websocket_request_id})}}};this.client.on("group-message",t=>e(t)),this.client.on("server-message",t=>e(t)),this.client.on("connected",()=>{this.connected=!0}),this.client.on("disconnected",()=>{this.connected=!1}),await this.client.start()}addSecondaryTypeHandler(e,t){this.secondaryTypeBasedHandlers.set(e,t)}isConnected(){return this.connected}async stop(e){e&&this.conversationId!==e||this.websocketRequestId&&await _e.stopWebsocketConversation(this.websocketRequestId)}setHandler(e,t,s,i){!this.handler&&this.websocketRequestId===s||(this.handler!=null&&this.websocketRequestId!==s&&(Px.warn("[websockets] Overwriting existing handler without silencing. This may indicate a race condition."),W.logEvent(G.asyncHandlerOverwritten,{originalWebsocketRequestId:this.websocketRequestId,newWebsocketRequestId:s,conversationId:e,responseId:t})),this.websocketRequestId=s,this.conversationId=e,this.handler=r=>{(r.websocketRequestId===s||r.conversationId===e&&r.responseId===t)&&i(r.message)})}silence(){this.handler=null}close(){this.client.stop()}scheduleForTermination(e){this.terminationTimeout=setTimeout(()=>{this.close(),e()},pC)}preventTermination(){this.terminationTimeout&&(clearTimeout(this.terminationTimeout),this.terminationTimeout=null)}updateConnectionUrl(e,t){this.connectionUrl=e,this.expiresAt=t}}class xC{constructor(){se(this,"activeSocketMap",new Map);se(this,"secondaryTypeBasedHandlers",new Map)}async register(){const e=await _e.postRegisterWebsocket();e.wss_url&&(this.getOrCreateSocket(e.wss_url,new Date(e.expires_at),!0),e.fallback_wss_url&&this.getOrCreateSocket(e.fallback_wss_url,new Date(e.expires_at),!1))}async registerIfNotConnected(){if(this.activeSocketMap.size===0){await this.register();return}for(const e of this.activeSocketMap.values())if(!e.isConnected()){await this.register();return}}isWebsocketConnected(){for(const e of this.activeSocketMap.values())if(e.isConnected())return!0;return this.activeSocketMap.size>0&&et.addError("Cannot connect to any websocket."),!1}async getOrCreateSocket(e,t,s){const i=e.split("?")[0];let r;const o=this.activeSocketMap.get(i);if(o&&o.isConnected())o.preventTermination(),o.updateConnectionUrl(e,t),r=o;else{o&&o.close(),r=new gC(async(a,l)=>{if(new Date<new Date(l.getTime()-5*1e3))return a;const d=await _e.postRegisterWebsocket();return s?d.wss_url:d.fallback_wss_url??""},e,t,null,this.secondaryTypeBasedHandlers),this.activeSocketMap.set(i,r);try{await r.start()}catch(a){throw et.addError(new Error("Error occurred while starting websocket: ",{cause:a})),a}}return r}preSetupWebsocket(e,t,s){for(const i of this.activeSocketMap.values())this.setupWebSocketHandler(i,null,null,null,e,t,s)}addSecondaryTypeHandler(e,t){this.secondaryTypeBasedHandlers.set(e,t);for(const s of this.activeSocketMap.values())s.addSecondaryTypeHandler(e,t)}hasSecondaryTypeHandler(e){return this.secondaryTypeBasedHandlers.has(e)}async processWebSocketConversationStream(e,t,s,i,r,o,a,l,d){const u=[this.getOrCreateSocket(e,s,!0)];t&&u.push(this.getOrCreateSocket(t,s,!1));const f=await Promise.allSettled(u),h=f[0].status==="fulfilled"?f[0].value:null,g=f.length>1&&f[1].status==="fulfilled"?f[1].value:null;if((!h||!h.isConnected())&&et.addError(`Cannot connect to primary websocket, websocketRequestId: ${o}, token: ${e.substring(0,e.indexOf("access_token="))}`),(!h||!h.isConnected())&&(!g||!g.isConnected()))throw t&&et.addError(`Cannot connect to fallback websocket, websocketRequestId: ${o}, token: ${t.substring(0,t.indexOf("access_token="))}`),new Wn(`An error occurred while connecting to the websocket. ${rc}`);let x=setTimeout(()=>{et.addError(`WebSocket took too long to respond: ${r}, ${i}, ${o}, ${e.substring(0,60)}...${e.slice(-20)}`,{supportsWebSockets:"WebSocket"in window&&window.WebSocket.CLOSING===2})},mC);const y=w=>(d&&(clearTimeout(d),d=null),x&&(clearTimeout(x),x=null),a(w));h&&this.setupWebSocketHandler(h,e,i,r,o,y,l),g&&t&&this.setupWebSocketHandler(g,t,i,r,o,y,l)}async stopConversation(e){for(const t of this.activeSocketMap.values())await t.stop(e)}setupWebSocketHandler(e,t,s,i,r,o,a){e.setHandler(s,i,r,o),this.secondaryTypeBasedHandlers.forEach((d,u)=>{e.addSecondaryTypeHandler(u,d)});const l=()=>{t?e.scheduleForTermination(()=>{this.activeSocketMap.delete(t.split("?")[0])}):(this.stopConversation(s),e.silence())};a.addEventListener("abort",l)}}const Fs=new xC;function yC(n){return{webSocketUrl:n.wss_url,fallbackWebSocketUrl:n.fallback_wss_url,conversationId:n.conversation_id,responseId:n.response_id,expiresAt:n.expires_at&&new Date(n.expires_at),websocketRequestId:n.websocket_request_id}}async function bC(n,e,t){return Fs.preSetupWebsocket(n,e,t)}async function kC(n,e,t,s,i,r,o,a,l){return Fs.processWebSocketConversationStream(n,e,t,s,i,r,o,a,l)}function Ko(n){return n==null||[tt.PrimaryAssistant,tt.GizmoInteraction].includes(n.kind)}function el(n,e){const t=Hs(n,e),{data:s}=$s(t!=null&&"gizmo_id"in t?t.gizmo_id:void 0,(t==null?void 0:t.kind)===tt.GizmoTest);if(t!=null)switch(t.kind){case tt.GizmoInteraction:case tt.GizmoMagicCreate:case tt.GizmoTest:return{gizmo:s,...t};case tt.PrimaryAssistant:return t}}function wC(n,e,t){const i=z.getTree(e).getMessageId(z.getThreadCurrentLeafId(e));_e.generateTitle(e,i,t).then(({title:r})=>{z.setTitle(e,r,Zp.Generated),_d(n),W.logEvent(G.renameThread,{threadId:e,content:r,model:t})}).catch(et.addError)}function vC(n,e,t){const s=()=>{const r=Au(t);Ru(r)},i=qt.getGizmoId(t);i!=null?Wy(e,i).then(r=>{Ru(Au(t,r))}).catch(r=>{et.addError(r),s()}):s()}const gc={onCreate(n){_d(n),W.logEvent(G.newThread)},onCreateFinished(n,e,t){var i;if(Pa()||!t)return;if(!Ae.checkGate("2562876640")){const r=(i=qt.getThread(t))==null?void 0:i.initialThreadData.lastModelUsed;r==null&&et.addError("missing lastModelUsed on conversation create finished"),wC(e,t,r)}const s=qt.getConversationMode(t);Ko(s)&&sp(e).then(r=>{ip(r)||vC(n,e,t)})}},Zu=Ke.div`m-8 flex flex-col items-center`;function ef(n){return c.jsx(yt.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...n})}function SC({clientThreadId:n}){const e=Qk(n),t=e==null?void 0:e.gizmoId,{data:s}=$s(t);return t==null||s==null||!Hy(s)?null:c.jsx(CC,{gizmoId:t})}function CC({gizmoId:n}){const[e,t]=k.useState(!1),[s,i]=k.useState(!1),r=qy(n),o=async l=>{t(!0),setTimeout(()=>{i(!0)},5e3),W.logEvent(G.submitInlineRating,{gizmo_id:n,rating:l}),await r.mutateAsync({rating:l})},a=async()=>{i(!0),W.logEvent(G.dismissInlineRating,{gizmo_id:n}),await r.mutateAsync({})};return k.useEffect(()=>{s||W.logEvent(G.showInlineRating,{gizmo_id:n})},[s,n]),s?null:e?c.jsx(Zu,{children:c.jsxs(ef,{className:"flex flex-col items-center gap-4",children:[c.jsx("div",{className:"rounded-lg border border-token-border-heavy p-4",children:c.jsxs("div",{className:"flex justify-between gap-2",children:[c.jsx(j,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),c.jsx(la,{onClick:()=>{i(!0)}})]})}),c.jsx("div",{className:"text-xs text-token-text-tertiary",children:c.jsx(j,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):c.jsx(Zu,{children:c.jsxs(ef,{className:"flex flex-col items-center gap-4 rounded-lg border border-token-border-heavy p-4",children:[c.jsxs("div",{className:"flex justify-between gap-2",children:[c.jsx(j,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),c.jsx(la,{onClick:a})]}),c.jsx(fv,{rating:void 0,onRating:o})]})})}var MC=Fx,TC=vv,EC=Ox;function _C(n,e){var t={};return e=EC(e),TC(n,function(s,i,r){MC(t,i,e(s,i,r))}),t}var AC=_C;const NC=Oa(AC),zm={files:[],connectorFileData:{}},At=ao(()=>zm),Vm={hasUploadInProgress:({files:n})=>n.some(e=>e.status===Is.Uploading),getReadyFiles:({files:n})=>n.filter(e=>e.status===Is.Ready)},bl=2048;async function IC(n,e,t,s,i,r,o){const a=performance.now();W.logEvent(G.uploadFileInitiated,{client:"web",useCase:t.kind,contextConnector:i.contextConnector,fileSourceType:i.type});let l=pl.Initial;t.kind===Wt.Gizmo&&(t={...t,kind:s.includes(e.type)?Wt.Multimodal:Wt.MyFiles});try{const d=await _e.uploadConnectorAPI(n,i.contextConnector,t,e,r,i.o365DriveId);switch(d.type){case"error":throw RC(d.error);case"file":{switch(ei.onFileCreated(n,d.file.id,"",i.contextConnector),l=pl.FileProcessed,t.kind){case Wt.MyFiles:{ei.onFileUploadProgress(n,90);const u=await Nv(d.file.file_id,r);(u==null?void 0:u.status)===Lx.Skipped&&xt.danger(o.formatMessage(Iv.retrievalSkippedFile,{fileName:u.name}),da),ei.onFileUploaded(n,d.file.file_id,void 0,{fileTokenSize:u.file_size_tokens,mimeType:d.file.mime_type}),l=pl.RetrievalIndexCreated;break}case Wt.Multimodal:{ei.onFileUploaded(n,d.file.file_id,{width:512,height:512},{mimeType:d.file.mime_type});break}case Wt.AceUpload:{ei.onFileUploaded(n,d.file.file_id,void 0,{mimeType:d.file.mime_type});break}case Wt.DalleAgent:case Wt.Gizmo:case Wt.ProfilePicture:throw new Ho(`Use case not supported by cloud doc: ${t.kind}`)}break}case"folder":throw new Ho("Folder type not supported")}_e.postRetrievalTiming({e2eLatencyMs:performance.now()-a,type:i.contextConnector})}catch(d){et.addError(new Error(`Failed to upload connected file by ${i.contextConnector}`,{cause:d}));const u=Tv(e.name,i==null?void 0:i.syntheticExtension);Rv(o,u,d);let f="NotInstanceOfError";d instanceof Wn?f=`FatalServerError_type_${d.type??"undefined"}`:(d instanceof Ns||d instanceof Error||d instanceof Ho)&&(f=d.name),ei.onError(n,"error","connector_upload_"+f,{kind:Wt.MyFiles},l)}}function RC({status_code:n,error_code:e,error_message:t}){if(n&&n<500){let s="internal_error";return e?s=e:n===404?s="file_not_found":n===403?s="permission_error":n===413&&(s="file_too_large"),new Ho(t,s)}else return new Wn(t)}const Lt={reset:()=>{At.setState(zm)},uploadFile:async(n,e,t,s,i,r={},o,a)=>{const{gizmoId:l}=r,d=At.getState().files,u=Sv(t,e.name,e.type,a==null?void 0:a.contextConnector,o),f={tempId:n,gizmoId:r.gizmoId,status:Is.Uploading,file:e,progress:1,fileId:null,cdnUrl:null,contextConnectorInfo:a,contextConnector:a==null?void 0:a.contextConnector};if(d.length===Hr)W.logEvent(G.uploadedMaxFilesError),xt.danger(i.formatMessage(tf.maxUploadsAtATime,{maxUploads:Hr,fileName:e.name}),da);else if(d.some(h=>h.tempId===n))W.logEvent(G.uploadedDuplicateFileError),xt.danger(i.formatMessage(tf.duplicateFileAttached,{fileName:e.name.length>20?e.name.slice(0,19)+"…":e.name}),da);else{At.setState(({files:x})=>({files:[...x,f]}));let h;const g={};if(s.includes(e.type)){if(h={kind:Wt.Multimodal},!a){let{width:x,height:y}=await zu(e);if(x>bl||y>bl)try{const w=await Cv(e,bl),S=await zu(w);x=S.width,y=S.height,e=w}catch(w){et.addError(new Error("Error resizing image:",{cause:w}))}g.imageDimensions={width:x,height:y}}}else switch(u){case Tt.Multimodal:throw new Error(`Multimodal file upload not supported mime type, ${e.type}
Supported mime types: `+s.join(", "));case Tt.Interpreter:h={kind:Wt.AceUpload};break;case Tt.Retrieval:h={kind:Wt.MyFiles},g.usesRetrievalIndex=!0;break;case Tt.ProfilePicture:throw new Error("cannot upload profile picture via uploadFile");case Tt.ContextConnector:case Tt.None:return}l!=null&&(h={kind:Wt.Gizmo,gizmoId:l}),r.skipUpload||(a?await IC(n,e,h,s,a,r.gizmoId,i):await Cm(n,e,i,h,ei,g))}},createFileCompleted:(n,e,t,s)=>{const i=At.getState().files,r=i.findIndex(a=>a.tempId===n),o=i[r];if(r>=0&&o.status===Is.Uploading){const a=[...i];a.splice(r,1,{...o,progress:10,fileId:e,cdnUrl:t,contextConnector:s}),At.setState({files:a})}},updateProgress:(n,e)=>{const t=At.getState().files,s=t.findIndex(r=>r.tempId===n),i=t[s];if(s>=0&&i.status===Is.Uploading){const r=[...t];r.splice(s,1,{...i,progress:e}),At.setState({files:r})}},uploadCompleted:(n,e,t,s,i)=>{const r=At.getState().files,o=r.findIndex(a=>a.tempId===n);if(o>=0&&r[o].status===Is.Uploading&&r[o].fileId!=null){const a=r[o],l=[...r],d={...a,tempId:n,status:Is.Ready,progress:100,fileSpec:{name:a.file.name,id:a.fileId,size:a.file.size,contextConnectorInfo:a.contextConnectorInfo,mimeType:(s==null?void 0:s.mimeType)??a.file.type??Mv(a.file.name),...t||{},...s||{}}};l.splice(o,1,d);const u={...At.getState().connectorFileData};i&&(u[i==null?void 0:i.file_id]=i),At.setState({files:l,connectorFileData:u}),W.logEvent(G.uploadFileCompleted,{status:a.status,fileId:a.fileId,contextConnector:a.contextConnector??"local"})}},remove:(n,e,t,s,i)=>{const r=At.getState().files,o=r.findIndex(a=>a.tempId===n);if(o>=0){const a=r[o];e==="error"?W.logEvent(G.uploadFileError,{status:a.status,fileId:a.fileId,client:"web",errorClassName:t??"undefined",useCaseType:s,uploadStatus:i??"undefined",contextConnector:a.contextConnector}):W.logEvent(G.removeFile,{status:a.status,fileId:a.fileId});const l=[...r];l.splice(o,1),At.setState({files:l})}}},ei={onFileCreated:Lt.createFileCompleted,onFileUploadProgress:Lt.updateProgress,onFileUploaded:Lt.uploadCompleted,onError:Lt.remove},tf=Ce({maxUploadsAtATime:{id:"useFilePickerState.maxUploadsAtATime",defaultMessage:"Unable to upload {fileName}. Max {maxUploads} uploads at a time"},duplicateFileAttached:{id:"useFilePickerState.duplicateFileAttached",defaultMessage:"Unable to upload {fileName} because an identical file has already been attached to this message."}}),Ir={uploadFile:DC,uploadPickedFile:PC,doContextConnectorOauthRedirect:jC};function DC(n,e,t,s,i){Lt.uploadFile(Kr(n),n,Tt.Retrieval,e,t,{gizmoId:i},s)}async function jC(n,e,t,s){if(!e)return;t();let i="";s===ms.Picker&&(i=`${o1}=${e.type}`),n??(n="/"),i&&(n.includes("?")?n+=`&${i}`:n+=`?${i}`),a1({id:e.id},l1(s),`${window.location.origin}/ccc/${e.id}/oauth/callback`,n)}function PC(n,e,t,s,i,r,o){let a=n.title;e===Se.GDRIVE&&(a=n.syntheticExtension?`${n.title}.${n.syntheticExtension}`:n.title);const l=n.mimeType.split(";")[0],d=l.startsWith("image/");if((s==null?void 0:s.includes(l))===!1||d&&!t.includes(l)){xt.danger(o.formatMessage(OC.unsupportedFileType,{fileName:a}),da);return}Lt.uploadFile(n.id,new File([],a,{type:l}),Tt.Retrieval,t,o,{gizmoId:r},i,{contextConnector:e,sourceUrl:n.url,syntheticExtension:n.syntheticExtension,type:ms.Picker,o365DriveId:n.o365DriveId})}function Vd(n,e){n.access_token&&n.expires_at!=null&&n.expires_at*1e3<=Date.now()&&Rt.expiredAccessTokenUsed(n.type,e)}const OC=Ce({unsupportedFileType:{id:"ContextConnectorUtils.unsupportedFileType",defaultMessage:"{fileName} is not a supported file type"}});function FC({composerController:n,parsedDocumentHandler:e}){const{gdriveLinkStatus:t,o365BusinessLinkStatus:s,o365PersonalLinkStatus:i}=ym();return t==="false"&&s==="false"&&i==="false"?null:c.jsx(LC,{composerController:n,parsedDocumentHandler:e})}function LC({composerController:n,parsedDocumentHandler:e}){const{connectorConfig:t}=Tm();return k.useEffect(()=>{const s=()=>{const i=BC(n,t);e(i)};return s(),n.subscribe("change",s)},[n,t,e]),null}function BC(n,e){const t=n.getCurrentText(),s=[];for(const i of e.values())switch(i.type){case Se.GDRIVE:{const r=VC(t,i);s.push(...r),i.access_token&&r.reduce((a,l)=>a.replace(l.url,""),t)!==t&&r.forEach(({url:a})=>n.replaceAll(a,""));break}case Se.O365:break;case Se.O365_BUSINESS:{const r=KC(t,i).filter(o=>o!=null);i.access_token&&r.forEach(({url:o})=>n.replaceAll(o,"")),s.push(...r);break}case Se.O365_PERSONAL:{const r=HC(t,i).filter(o=>o!=null);i.access_token&&r.forEach(({url:o})=>n.replaceAll(o,"")),s.push(...r);break}}return s.length&&Rt.linkPasted(NC(bm(s,i=>i.type),i=>i.length)),s}const UC=/\bhttps:\/\/docs\.google\.com\/(document|spreadsheets|presentation)\/d\/([\w-]+)\/?(?:(?:edit|view)\/?)?(?:\?[\w\-.~%=]*)?(?:#[\w\-.~%=]*)?/gm,zC=/\bhttps:\/\/drive\.google\.com\/(file)\/d\/([\w-]+)\/?(?:(?:edit|view)\/?)?(?:\?[\w\-.~%=]*)?(?:#[\w\-.~%=]*)?/gm;function VC(n,e){return[...n.matchAll(UC),...n.matchAll(zC)].map(t=>{const s={url:t[0],id:t[2],type:Se.GDRIVE};return e.access_token?{...s,handler:{type:"fetch",tryFetch:async()=>{Vd(e,ms.Link);const i=`https://www.googleapis.com/drive/v3/files/${s.id}?fields=name,mimeType`,r=await fetch(i,{method:"GET",headers:{Authorization:`Bearer ${e.access_token}`,"Content-Type":"application/json"}});if(!r.ok)return Promise.reject(new Error(`HTTP ${r.status}`));const{name:o,mimeType:a}=await r.json(),l=Np(a);return{connector:Se.GDRIVE,id:s.id,title:o,mimeType:a,url:s.url,syntheticExtension:l}}}}:{...s,handler:{type:"prompt",message:"not-connected"}}})}function Gm(n){let e;try{e=new URL(n).toString()}catch{return null}return`u!${btoa(e).replaceAll("=","").replaceAll("/","_").replaceAll("+","-")}`}const GC=/\bhttps:\/\/onedrive\.live\.com\/[\w\-_.~!*'();:@&=+$,\\/?%#[\]]*/gm,$C=/\bhttps:\/\/photos\.onedrive\.com\/(?:share|photo)\/[\w\-_.~!*'();:@&=+$,\\/?%#[\]]*/gm,WC=/\bhttps:\/\/1drv\.ms\/[\w\-_.~!*'();:@&=+$,\\/?%#[\]]*/gm;function HC(n,e){return[...n.matchAll(GC),...n.matchAll(WC),...n.matchAll($C)].map(t=>{const s=Gm(t[0]);if(!s)return null;const i={url:t[0],id:s,type:Se.O365_PERSONAL};return e.access_token?{...i,handler:{type:"fetch",tryFetch:$m(si.OneDrive_PERSONAL_SHARES,s,e.access_token,e)}}:{...i,handler:{type:"prompt",message:"not-connected"}}})}const qC=/\bhttps:\/\/[^\s]+?\.sharepoint\.com\/[^\s]*/gm;function KC(n,e){return[...n.matchAll(qC)].map(t=>{const s=Gm(t[0]),i=si.OneDrive_BUSINESS_SHARES;if(!s)return null;const r={url:t[0],id:s,type:Se.O365_BUSINESS};return e.access_token?{...r,handler:{type:"fetch",tryFetch:$m(i,s,e.access_token,e)}}:{...r,handler:{type:"prompt",message:"not-connected"}}})}function $m(n,e,t,s,i){switch(n){case si.OneDrive_BUSINESS_SHARES:case si.OneDrive_PERSONAL_SHARES:return()=>kl(`${n}/${encodeURIComponent(e)}/driveItem`,t,s);case si.OneDrive_BUSINESS_DRIVE_ITEMS:return()=>kl(`${n}/${encodeURIComponent(e)}`,t,s);case si.OneDrive_BUSINESS_DRIVE_ROOT:return async()=>{const r=await JC(t,e);if(!r)return Promise.reject(null);const o=`${n}:${encodeURIComponent(r)}`;return kl(o,t,s)};case si.OneDrive_PERSONAL_DRIVE_ITEMS:return()=>Promise.reject(null)}}async function JC(n,e){const s=await fetch("https://graph.microsoft.com/v1.0/me/drive/root",{method:"GET",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(!s.ok)return null;const{webUrl:i}=await s.json(),o=new URL(i).pathname;return e.startsWith(o)?e.substring(o.length):e}async function kl(n,e,t,s){var u;Vd(t,ms.Link);const i=await fetch(n,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!i.ok)return Promise.reject(new Error(`HTTP ${i.status}`));const{id:r,name:o,file:a,webUrl:l,...d}=await i.json();return s||(s=(u=d.parentReference)==null?void 0:u.driveId),{connector:t.type,id:r,title:o??"",mimeType:(a==null?void 0:a.mimeType)??"",url:l??"",syntheticExtension:null,o365DriveId:s}}function Wm({size:n="default",triggerIcon:e,triggerButton:t,children:s,side:i="bottom",className:r,sideOffset:o=10,open:a,onOpenChange:l,alignAgainstAnchor:d="center",disableAutofocus:u=!1}){return c.jsxs(Pv,{open:a,onOpenChange:l,children:[e?c.jsx(Gu,{className:"rounded-lg p-2 hover:bg-token-main-surface-secondary",children:c.jsx(e,{className:"icon-md"})}):c.jsx(Gu,{asChild:!0,children:t}),c.jsx(Ov,{children:c.jsx(Ip,{$as:Fv,side:i,sideOffset:o,align:d,collisionPadding:10,onOpenAutoFocus:f=>{u&&f.preventDefault()},className:J({"min-w-[200px] max-w-xs":n==="default"},r),children:s})})]})}function YC({onOauthRedirect:n,children:e}){const{connectorConfig:t,isLoading:s}=Tm(),i=ua(),{getFirstMessage:r}=i,o=r(),a=o?t.get(o.connector):null,l=s||!a,d=k.useMemo(()=>{if(l||!o)return null;switch(o.type){case"not-connected":return c.jsx(XC,{unconnectedMessage:o,onOauthRedirect:n,entry:a})}},[l,a,o,n]),{dismissMessage:u}=ua(),f=k.useCallback(h=>{!h&&o&&!l&&u(o)},[l,u,o]);return c.jsx(Wm,{size:"none",open:!l,onOpenChange:f,side:"top",sideOffset:4,triggerButton:e,children:d})}function XC({unconnectedMessage:n,onOauthRedirect:e,entry:t}){const{dismissMessage:s}=ua(),i=ye(),r=vi(),o=Qa(n.connector,i),{icon1:a,icon2:l,icon3:d,icon4:u}=QC(n.connector);return c.jsxs("div",{className:"flex w-[294px] max-w-full flex-col p-4 sm:w-[384px]",children:[c.jsxs("div",{className:"mb-3 flex flex-row gap-2 self-center",children:[c.jsx(Io,{icon:a,rotation:-6}),c.jsx(Io,{icon:l,rotation:6}),c.jsx(Io,{icon:d,rotation:-6}),c.jsx(Io,{icon:u,rotation:6})]}),c.jsx("span",{className:"mb-3 text-lg font-semibold",children:c.jsx(j,{...Ro.connectTo,values:{connectorName:o}})}),c.jsx("span",{className:"mb-4 text-sm text-token-text-secondary",children:c.jsx(j,{...Ro.description,values:{connectorName:o}})}),c.jsxs("div",{className:"flex flex-row-reverse gap-3 self-end",children:[c.jsx(Xe,{color:"primary",onClick:()=>{Rt.oauthUpsellButtonClick(t.type,"link"),Ir.doContextConnectorOauthRedirect(r.asPath,t,e,ms.Link)},children:c.jsx(j,{...Ro.connect})}),c.jsx(Xe,{color:"secondary",onClick:()=>{Rt.oauthUpsellButtonClick(t.type,"not-now"),s(n)},children:c.jsx(j,{...Ro.notNow})})]})]})}function QC(n){switch(n){case Se.GDRIVE:return{icon1:c.jsx(Iw,{}),icon2:c.jsx(Rw,{}),icon3:c.jsx(Dw,{}),icon4:c.jsx(jw,{})};case Se.O365:case Se.O365_BUSINESS:case Se.O365_PERSONAL:return{icon1:c.jsx(Ew,{}),icon2:c.jsx(_w,{}),icon3:c.jsx(Aw,{}),icon4:c.jsx(Nw,{})}}jv(n)}function Io({rotation:n,icon:e}){return c.jsx("div",{className:J("flex h-[44px] w-[44px] items-center justify-center rounded-xl border border-[#EDEDF2] bg-white shadow-[0_1px_12px_0px_#0000000B]"),style:{transform:`rotate(${n}deg)`},children:c.jsx("div",{className:"object-contain",children:e})})}const Ro=Ce({connectTo:{id:"ContextConnectorPastedLinkPopover.connectTo",defaultMessage:"Connect to {connectorName}"},description:{id:"ContextConnectorPastedLinkPopover.description",defaultMessage:"Connect ChatGPT to {connectorName} to reference the content from this link."},notNow:{id:"ContextConnectorPastedLinkPopover.notNow",defaultMessage:"Not now"},connect:{id:"ContextConnectorPastedLinkPopover.connect",defaultMessage:"Connect"},addFromGdriveDescription:{id:"ContextConnectorPastedLinkPopover.addFromDriveDescription",defaultMessage:"To add files from Google Drive, upload them directly to your message."},addFromGdriveNotNow:{id:"ContextConnectorPastedLinkPopover.addFromDriveNotNow",defaultMessage:"Not now"},addFromGdriveUploadFile:{id:"ContextConnectorPastedLinkPopover.addFromDriveUploadFile",defaultMessage:"Upload file"}});function ZC(n,e){const t=Mi(Ws.MentionGPTs),s=Lv(),[i,r]=k.useState(!1),o=()=>{r(!0),t.markAsViewed()};return k.useImperativeHandle(e,()=>({handleClose:o})),t.eligible&&!t.isLoading&&!s?c.jsx(eM,{wasDismissed:i,onDismiss:o}):null}function eM({wasDismissed:n,onDismiss:e}){const t=ye(),{recent:s,pinned:i}=hv(),r=s&&s.pages.flatMap(o=>o.list.items).length>0||i&&i.items.length>0;return k.useEffect(()=>{r&&W.logEvent(G.mentionsDisplayNux)},[r]),r?c.jsx(Za,{badge:"beta",align:"start",side:"top",arrowPadding:58,show:!n,title:t.formatMessage({id:"mentionGptsAnnouncement.title",defaultMessage:"GPT mentions"}),onDismiss:e,sideOffset:25,theme:"default",description:c.jsx(j,{id:"mentionGptsAnnouncement.description",defaultMessage:"Type {key} to mention a GPT and add it directly into your conversation",values:{key:c.jsx("span",{className:"font-bold",children:"@"})}}),children:c.jsx("div",{className:"absolute sm:left-16"})}):null}const tM=k.forwardRef(ZC);function nM({suggestions:n,composerController:e,onSelect:t,onChange:s}){const i=am(),r=k.useCallback((l,d,u)=>{t==null||t(l,d,u),i(l,d,u)},[t,i]),[o,a]=k.useState(-1);return k.useEffect(()=>{const l=d=>{if(d.key==="ArrowDown"){const u=o===n.length-1?0:o+1;a(u),s==null||s(u,!0,n[u])}else if(d.key==="ArrowUp"){d.preventDefault();const u=o===0?n.length-1:o-1;a(u),s==null||s(u,!0,n[u])}else d.key==="Enter"&&n[o]&&r(n[o],n,o)};return e.subscribe("keydown",l)},[n,o,s,r,e]),k.useEffect(()=>e.subscribe("blur",()=>{a(-1),s==null||s(-1,!1)}),[e,s]),c.jsx(yt.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"hidden w-full flex-col p-2.5 group-focus-within:block",children:n.map((l,d)=>c.jsx(yt.li,{initial:{opacity:0},animate:{opacity:1},transition:{delay:d*.03},exit:{opacity:0},className:"hover:border-b-none w-full border-b border-token-main-surface-secondary last:border-b-0 hover:border-b-transparent",children:c.jsxs("button",{className:J("inline w-full cursor-pointer items-center justify-start rounded-lg px-2.5 py-2 text-start",o===d?"bg-token-main-surface-secondary":"bg-token-main-surface-primary"),onClick:u=>{u.preventDefault(),r(l,n,d)},onMouseEnter:()=>{a(d),s==null||s(d,!1,l)},onMouseLeave:()=>{a(-1),s==null||s(-1,!1,l)},children:[c.jsx("span",{className:"text-token-text-primary",children:l.title}),c.jsx("span",{className:"ml-1 text-token-text-secondary",children:l.body})]})},l.id??d))})}const sM=({event:n,intl:e,conversationMode:t,clientThreadId:s,currentModelConfig:i,getEditorGizmoId:r,modelSupportedImageMimeTypes:o})=>{var f,h;const a=sr(i,t),l=o.length>0;if(W.logEvent(G.pastedToComposer,{client_thread_id:s}),!l)return;const d=jd(i,t),{clipboardData:u}=n;if(u&&u.files.length>0){const g=u.files[0],x=(f=d==null?void 0:d.attachments)==null?void 0:f.accepted_mime_types,y=(h=d==null?void 0:d.attachments)==null?void 0:h.can_accept_all_mime_types;if(x!==void 0&&!x.includes(g.type)&&y!==!0){xt.danger(e.formatMessage(Sn.unsupportedFileType,{file_type:g.type})),n.preventDefault();return}if(xi.hideThreadHeader(),W.logEvent(G.uploadFile,{client:"web",eventSource:"paste"}),r!=null){r().then(w=>Lt.uploadFile(Kr(g),g,a,o,e,{gizmoId:w}));return}Lt.uploadFile(Kr(g),g,a,o,e,void 0,d==null?void 0:d.attachments)}},P5=({className:n})=>c.jsxs(Un,{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:n,children:[c.jsx("path",{d:"M11.5047 10C12.8828 10 14 11.1172 14 12.4953C14 15.2919 10.9404 14.9905 9.00947 14.9905C9.00947 13.0596 8.70813 10 11.5047 10Z",stroke:"currentColor",strokeWidth:"2",strokeLinejoin:"round"}),c.jsx("path",{d:"M12 9.5C13.8983 6.79576 16.0839 4.85949 18.8983 3.40128C19.3829 3.15019 19.9712 3.25691 20.3571 3.64286V3.64286C20.7431 4.0288 20.8498 4.61706 20.5987 5.10168C19.1405 7.91612 17.2042 10.1017 14.5 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),c.jsx("path",{d:"M12.0003 21.0003C11.5003 21.0003 8.93732 20.1297 6.71782 17.9102C3.00784 14.2002 2.05809 9.13491 4.5965 6.5965C6.68218 4.51082 10.4738 4.78002 13.8179 7.00031M17.1066 10.0003C19.9927 13.3315 21.2146 16.7289 19.0003 18.5003C17.3415 19.8274 15.2424 18.2927 14.0176 17.1097",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),O5=({className:n})=>c.jsx(Un,{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:n,children:c.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.70711 2.29289C8.09763 2.68342 8.09763 3.31658 7.70711 3.70711L6.41421 5H13.5C17.6421 5 21 8.35786 21 12.5C21 16.6421 17.6421 20 13.5 20H9C8.44772 20 8 19.5523 8 19C8 18.4477 8.44772 18 9 18H13.5C16.5376 18 19 15.5376 19 12.5C19 9.46243 16.5376 7 13.5 7H6.41421L7.70711 8.29289C8.09763 8.68342 8.09763 9.31658 7.70711 9.70711C7.31658 10.0976 6.68342 10.0976 6.29289 9.70711L3.29289 6.70711C2.90237 6.31658 2.90237 5.68342 3.29289 5.29289L6.29289 2.29289C6.68342 1.90237 7.31658 1.90237 7.70711 2.29289Z",fill:"currentColor"})}),F5=({className:n})=>c.jsx(Un,{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:n,children:c.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.2929 2.29289C16.6834 1.90237 17.3166 1.90237 17.7071 2.29289L20.7071 5.29289C21.0976 5.68342 21.0976 6.31658 20.7071 6.70711L17.7071 9.70711C17.3166 10.0976 16.6834 10.0976 16.2929 9.70711C15.9024 9.31658 15.9024 8.68342 16.2929 8.29289L17.5858 7H10.5C7.46243 7 5 9.46243 5 12.5C5 15.5376 7.46243 18 10.5 18H15C15.5523 18 16 18.4477 16 19C16 19.5523 15.5523 20 15 20H10.5C6.35786 20 3 16.6421 3 12.5C3 8.35786 6.35786 5 10.5 5H17.5858L16.2929 3.70711C15.9024 3.31658 15.9024 2.68342 16.2929 2.29289Z",fill:"currentColor"})}),iM=({className:n})=>c.jsx(Un,{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:n,children:c.jsx("path",{d:"M3 18H4.17157C4.70201 18 5.21071 17.7893 5.58579 17.4142L15.4142 7.58579C15.7893 7.21071 16.298 7 16.8284 7H19M3 6H4.17157C4.70201 6 5.21071 6.21071 5.58579 6.58579L8 9M19 17H16.8284C16.298 17 15.7893 16.7893 15.4142 16.4142L14 15M18 4L21 7L18 10M18 14L21 17L18 20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),rM=({className:n})=>c.jsx(Un,{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:n,children:c.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",stroke:"currentColor",strokeWidth:"2"})}),oM=({className:n})=>c.jsx(Un,{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:n,children:c.jsx("rect",{x:"2",y:"6",width:"20",height:"12",rx:"2",stroke:"currentColor",strokeWidth:"2"})}),aM=({className:n})=>c.jsx(Un,{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:n,children:c.jsx("rect",{x:"6",y:"2",width:"12",height:"20",rx:"2",stroke:"currentColor",strokeWidth:"2"})}),L5=({className:n})=>c.jsx(Un,{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:n,children:c.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M13 4C13 3.44772 13.4477 3 14 3H20C20.5523 3 21 3.44772 21 4V10C21 10.5523 20.5523 11 20 11C19.4477 11 19 10.5523 19 10V6.41421L15.2071 10.2071C14.8166 10.5976 14.1834 10.5976 13.7929 10.2071C13.4024 9.81658 13.4024 9.18342 13.7929 8.79289L17.5858 5H14C13.4477 5 13 4.55228 13 4ZM4 13C4.55228 13 5 13.4477 5 14V17.5858L8.79289 13.7929C9.18342 13.4024 9.81658 13.4024 10.2071 13.7929C10.5976 14.1834 10.5976 14.8166 10.2071 15.2071L6.41421 19H10C10.5523 19 11 19.4477 11 20C11 20.5523 10.5523 21 10 21H4C3.44772 21 3 20.5523 3 20V14C3 13.4477 3.44772 13 4 13Z",fill:"currentColor"})}),lM=[{name:N({id:"dalleControls.aspectRatio.square",defaultMessage:"Square"}),expandedName:N({id:"dalleControls.aspectRatio.squareExpanded",defaultMessage:"Square aspect ratio"}),icon:rM},{name:N({id:"dalleControls.aspectRatio.widescreen",defaultMessage:"Widescreen"}),expandedName:N({id:"dalleControls.aspectRatio.widescreenExpanded",defaultMessage:"Wide aspect ratio"}),icon:oM},{name:N({id:"dalleControls.aspectRatio.vertical",defaultMessage:"Vertical"}),expandedName:N({id:"dalleControls.aspectRatio.verticalExpanded",defaultMessage:"Vertical aspect ratio"}),icon:aM}],Hm=[{name:N({id:"dalleStyle.3dWireframe",defaultMessage:"3D Wireframe"}),image:c1},{name:N({id:"dalleStyle.35mmFilm",defaultMessage:"35mm film"}),expandedName:N({id:"dalleStyle.35mmFilmExpanded",defaultMessage:"35mm film style"}),image:d1},{name:N({id:"dalleStyle.abstract",defaultMessage:"Abstract"}),image:u1},{name:N({id:"dalleStyle.acrylic",defaultMessage:"Acrylic"}),image:f1},{name:N({id:"dalleStyle.aerial",defaultMessage:"Aerial"}),expandedName:N({id:"dalleStyle.aerialExpanded",defaultMessage:"Aerial view"}),image:h1},{name:N({id:"dalleStyle.analogFilm",defaultMessage:"Analog film"}),expandedName:N({id:"dalleStyle.analogFilmExpanded",defaultMessage:"Analog film style"}),image:p1},{name:N({id:"dalleStyle.artDeco",defaultMessage:"Art deco"}),image:m1},{name:N({id:"dalleStyle.artNouveau",defaultMessage:"Art nouveau"}),image:g1},{name:N({id:"dalleStyle.artificialLighting",defaultMessage:"Artificial lighting"}),image:x1},{name:N({id:"dalleStyle.anime",defaultMessage:"Anime"}),image:y1},{name:N({id:"dalleStyle.baroque",defaultMessage:"Baroque"}),image:b1},{name:N({id:"dalleStyle.blackAndWhite",defaultMessage:"Black and white"}),image:k1},{name:N({id:"dalleStyle.candy",defaultMessage:"Candy"}),expandedName:N({id:"dalleStyle.candyExpanded",defaultMessage:"Made of candy"}),image:w1},{name:N({id:"dalleStyle.cartoon",defaultMessage:"Cartoon"}),image:v1},{name:N({id:"dalleStyle.caricature",defaultMessage:"Caricature"}),image:S1},{name:N({id:"dalleStyle.caveArt",defaultMessage:"Cave art"}),expandedName:N({id:"dalleStyle.caveArtExpanded",defaultMessage:"Cave art style"}),image:C1},{name:N({id:"dalleStyle.chalkArt",defaultMessage:"Chalk art"}),image:M1},{name:N({id:"dalleStyle.charcoal",defaultMessage:"Charcoal"}),image:T1},{name:N({id:"dalleStyle.claymation",defaultMessage:"Claymation"}),image:E1},{name:N({id:"dalleStyle.closeUp",defaultMessage:"Close-up"}),image:_1},{name:N({id:"dalleStyle.comicBook",defaultMessage:"Comic book"}),expandedName:N({id:"dalleStyle.comicBookExpanded",defaultMessage:"Comic book style"}),image:A1},{name:N({id:"dalleStyle.comicStrip",defaultMessage:"Comic strip"}),expandedName:N({id:"dalleStyle.comicStripExpanded",defaultMessage:"Comic strip style"}),image:N1},{name:N({id:"dalleStyle.conceptArt",defaultMessage:"Concept art"}),image:I1},{name:N({id:"dalleStyle.cubism",defaultMessage:"Cubism"}),image:R1},{name:N({id:"dalleStyle.crayon",defaultMessage:"Crayon"}),expandedName:N({id:"dalleStyle.crayonExpanded",defaultMessage:"Crayon style"}),image:D1},{name:N({id:"dalleStyle.crystal",defaultMessage:"Crystal"}),expandedName:N({id:"dalleStyle.crystalExpanded",defaultMessage:"Made of crystal"}),image:j1},{name:N({id:"dalleStyle.cyberpunk",defaultMessage:"Cyberpunk"}),image:P1},{name:N({id:"dalleStyle.dawn",defaultMessage:"Dawn"}),expandedName:N({id:"dalleStyle.dawnExpanded",defaultMessage:"Dawn lighting"}),image:O1},{name:N({id:"dalleStyle.digitalArt",defaultMessage:"Digital art"}),image:F1},{name:N({id:"dalleStyle.dusk",defaultMessage:"Dusk"}),expandedName:N({id:"dalleStyle.duskExpanded",defaultMessage:"Dusk lighting"}),image:L1},{name:N({id:"dalleStyle.dutchAngle",defaultMessage:"Dutch angle"}),image:B1},{name:N({id:"dalleStyle.dystopian",defaultMessage:"Dystopian"}),image:U1},{name:N({id:"dalleStyle.electronics",defaultMessage:"Electronics"}),expandedName:N({id:"dalleStyle.electronicsExpanded",defaultMessage:"Made of electronics"}),image:z1},{name:N({id:"dalleStyle.expressionism",defaultMessage:"Expressionism"}),image:V1},{name:N({id:"dalleStyle.extremeCloseUp",defaultMessage:"Extreme close-up"}),image:G1},{name:N({id:"dalleStyle.fairyTale",defaultMessage:"Fairy tale"}),expandedName:N({id:"dalleStyle.fairyTaleExpanded",defaultMessage:"Fairy tale style"}),image:$1},{name:N({id:"dalleStyle.fantasy",defaultMessage:"Fantasy"}),image:W1},{name:N({id:"dalleStyle.fauvism",defaultMessage:"Fauvism"}),image:H1},{name:N({id:"dalleStyle.feathers",defaultMessage:"Feathers"}),expandedName:N({id:"dalleStyle.feathersExpanded",defaultMessage:"Made of feathers"}),image:q1},{name:N({id:"dalleStyle.flowers",defaultMessage:"Flowers"}),expandedName:N({id:"dalleStyle.flowersExpanded",defaultMessage:"Made of flowers"}),image:K1},{name:N({id:"dalleStyle.felt",defaultMessage:"Felt"}),image:J1},{name:N({id:"dalleStyle.filmNoir",defaultMessage:"Film noir"}),image:Y1},{name:N({id:"dalleStyle.fishEye",defaultMessage:"Fish-eye"}),expandedName:N({id:"dalleStyle.fishEyeExpanded",defaultMessage:"Fish-eye lens"}),image:X1},{name:N({id:"dalleStyle.folkArt",defaultMessage:"Folk art"}),image:Q1},{name:N({id:"dalleStyle.futurism",defaultMessage:"Futurism"}),expandedName:N({id:"dalleStyle.futurismExpanded",defaultMessage:"Futurism style"}),image:Z1},{name:N({id:"dalleStyle.gold",defaultMessage:"Gold"}),expandedName:N({id:"dalleStyle.goldExpanded",defaultMessage:"Made of gold"}),image:eb},{name:N({id:"dalleStyle.goldenHour",defaultMessage:"Golden hour"}),expandedName:N({id:"dalleStyle.goldenHourExpanded",defaultMessage:"Golden hour lighting"}),image:tb},{name:N({id:"dalleStyle.gothic",defaultMessage:"Gothic"}),image:nb},{name:N({id:"dalleStyle.graffiti",defaultMessage:"Graffiti"}),expandedName:N({id:"dalleStyle.graffitiExpanded",defaultMessage:"Graffiti style"}),image:sb},{name:N({id:"dalleStyle.handDrawn",defaultMessage:"Hand-drawn"}),image:ib},{name:N({id:"dalleStyle.highAngle",defaultMessage:"High angle"}),image:rb},{name:N({id:"dalleStyle.highContrast",defaultMessage:"High contrast"}),image:ob},{name:N({id:"dalleStyle.ice",defaultMessage:"Ice"}),expandedName:N({id:"dalleStyle.iceExpanded",defaultMessage:"Made of ice"}),image:ab},{name:N({id:"dalleStyle.impressionism",defaultMessage:"Impressionism"}),image:lb},{name:N({id:"dalleStyle.inkWash",defaultMessage:"Ink wash"}),image:cb},{name:N({id:"dalleStyle.kawaii",defaultMessage:"Kawaii"}),image:db},{name:N({id:"dalleStyle.lava",defaultMessage:"Lava"}),expandedName:N({id:"dalleStyle.lavaExpanded",defaultMessage:"Made of flowing lava"}),image:ub},{name:N({id:"dalleStyle.lineArt",defaultMessage:"Line art"}),image:fb},{name:N({id:"dalleStyle.linocut",defaultMessage:"Linocut"}),image:hb},{name:N({id:"dalleStyle.lithograph",defaultMessage:"Lithograph"}),expandedName:N({id:"dalleStyle.lithographExpanded",defaultMessage:"19th-century lithograph style"}),image:pb},{name:N({id:"dalleStyle.lowAngle",defaultMessage:"Low angle"}),image:mb},{name:N({id:"dalleStyle.lowPolygon",defaultMessage:"Low polygon"}),image:gb},{name:N({id:"dalleStyle.minimalist",defaultMessage:"Minimalist"}),image:xb},{name:N({id:"dalleStyle.mirroredGlass",defaultMessage:"Mirrored glass"}),expandedName:N({id:"dalleStyle.mirroredGlassExpanded",defaultMessage:"Made of mirrored glass"}),image:yb},{name:N({id:"dalleStyle.moss",defaultMessage:"Moss"}),expandedName:N({id:"dalleStyle.mossExpanded",defaultMessage:"Made of moss"}),image:bb},{name:N({id:"dalleStyle.mosaic",defaultMessage:"Mosaic"}),image:kb},{name:N({id:"dalleStyle.motionBlur",defaultMessage:"Motion blur"}),image:wb},{name:N({id:"dalleStyle.muted",defaultMessage:"Muted"}),expandedName:N({id:"dalleStyle.mutedExpanded",defaultMessage:"Muted palette"}),image:vb},{name:N({id:"dalleStyle.neonLights",defaultMessage:"Neon lights"}),expandedName:N({id:"dalleStyle.neonLightsExpanded",defaultMessage:"Neon lights style"}),image:Sb},{name:N({id:"dalleStyle.night",defaultMessage:"Night"}),expandedName:N({id:"dalleStyle.nightExpanded",defaultMessage:"Night lighting"}),image:Cb},{name:N({id:"dalleStyle.oilPainting",defaultMessage:"Oil painting"}),image:Mb},{name:N({id:"dalleStyle.origami",defaultMessage:"Origami"}),expandedName:N({id:"dalleStyle.origamiExpanded",defaultMessage:"Made of origami"}),image:Tb},{name:N({id:"dalleStyle.pastel",defaultMessage:"Pastel"}),image:Eb},{name:N({id:"dalleStyle.pencilSketch",defaultMessage:"Pencil sketch"}),image:_b},{name:N({id:"dalleStyle.pinholeCamera",defaultMessage:"Pinhole camera"}),expandedName:N({id:"dalleStyle.pinholeCameraExpanded",defaultMessage:"Pinhole camera style"}),image:Ab},{name:N({id:"dalleStyle.pixelArt",defaultMessage:"Pixel art"}),image:Nb},{name:N({id:"dalleStyle.pointillism",defaultMessage:"Pointillism"}),image:Ib},{name:N({id:"dalleStyle.polishedStone",defaultMessage:"Stone"}),expandedName:N({id:"dalleStyle.polishedStoneExpanded",defaultMessage:"Made of polished stone"}),image:Rb},{name:N({id:"dalleStyle.popArt",defaultMessage:"Pop art"}),image:Db},{name:N({id:"dalleStyle.retro",defaultMessage:"Retro"}),image:jb},{name:N({id:"dalleStyle.rococo",defaultMessage:"Rococo"}),image:Pb},{name:N({id:"dalleStyle.scifi",defaultMessage:"Sci-fi"}),image:Ob},{name:N({id:"dalleStyle.sculpture",defaultMessage:"Sculpture"}),image:Fb},{name:N({id:"dalleStyle.sepia",defaultMessage:"Sepia"}),image:Lb},{name:N({id:"dalleStyle.silkScreen",defaultMessage:"Silk screen"}),expandedName:N({id:"dalleStyle.silkScreenExpanded",defaultMessage:"Silk screen style"}),image:Bb},{name:N({id:"dalleStyle.solarpunk",defaultMessage:"Solarpunk"}),image:Ub},{name:N({id:"dalleStyle.stars",defaultMessage:"Stars"}),expandedName:N({id:"dalleStyle.starsExpanded",defaultMessage:"Made of stars"}),image:zb},{name:N({id:"dalleStyle.steampunk",defaultMessage:"Steampunk"}),image:Vb},{name:N({id:"dalleStyle.surrealism",defaultMessage:"Surrealism"}),image:Gb},{name:N({id:"dalleStyle.synthwave",defaultMessage:"Synthwave"}),image:$b},{name:N({id:"dalleStyle.tapestry",defaultMessage:"Tapestry"}),expandedName:N({id:"dalleStyle.tapestryExpanded",defaultMessage:"Tapestry style"}),image:Wb},{name:N({id:"dalleStyle.ukiyoE",defaultMessage:"Ukiyo-e"}),image:Hb},{name:N({id:"dalleStyle.victorian",defaultMessage:"Victorian"}),image:qb},{name:N({id:"dalleStyle.watercolor",defaultMessage:"Watercolor"}),image:Kb},{name:N({id:"dalleStyle.wideAngle",defaultMessage:"Wide-angle"}),expandedName:N({id:"dalleStyle.wideAngleExpanded",defaultMessage:"Wide-angle lens"}),image:Jb},{name:N({id:"dalleStyle.woodcut",defaultMessage:"Woodcut"}),image:Yb}];function cM({composerController:n}){const{doesUserHaveAnyAccountsWithPlusFeatures:e}=cr(),t=ye();return c.jsxs("div",{className:"flex justify-between bg-gradient-to-t from-token-main-surface-primary to-transparent px-4",children:[c.jsx("div",{className:"flex gap-2",children:c.jsx(uM,{onClickStyle:s=>{sf(t.formatMessage(s.expandedName??s.name),n)}})}),e&&c.jsx("div",{className:"flex gap-2",children:c.jsx(dM,{onClickAspectRatio:s=>sf(t.formatMessage(s.expandedName),n)})})]})}function dM({onClickAspectRatio:n}){const e=ye();return c.jsxs(Oe.Root,{onOpenChange:t=>{t&&(Ae.logEvent(G.dalleOpenAspectRatioDropdown),W.logEvent(G.dalleOpenAspectRatioDropdown))},children:[c.jsxs(xc,{$as:Oe.Trigger,className:"pr-1.5",children:[c.jsx(j,{id:"dalleControls.aspectRatio",defaultMessage:"Aspect Ratio"}),c.jsx(mo,{className:"icon-md"})]}),c.jsx(Oe.Portal,{children:c.jsx(Oe.Content,{children:lM.map(t=>c.jsx(Oe.Item,{onClick:()=>{var s;n(t),Ae.logEvent(G.dalleClickAspectRatio,(s=t.name.defaultMessage)==null?void 0:s.toString()),W.logEvent(G.dalleClickAspectRatio,{aspectRatio:t.name.defaultMessage})},icon:t.icon,children:e.formatMessage(t.name)},t.name.id))})})]})}function uM({onClickStyle:n}){const[e,t]=k.useState(nf()),s=np(),i=td(),r=mr(),o=ye();let a=2;return r||(i?a=5:s&&(a=3)),c.jsxs(c.Fragment,{children:[e.slice(0,a).map(l=>c.jsx(bs,{label:c.jsx(fM,{style:l}),side:"top",sideOffset:4,customPaddingClassName:"p-1",children:c.jsxs(xc,{$as:"button",type:"button",onClick:()=>{var d;n(l),Ae.logEvent(G.dalleClickStyle,(d=l.name.defaultMessage)==null?void 0:d.toString()),W.logEvent(G.dalleClickStyle,{style:l.name.defaultMessage})},children:[c.jsx(Pw,{className:"h-4 w-4 text-token-text-tertiary"}),o.formatMessage(l.name)]})},l.name.id)),c.jsx(xc,{$as:"button",type:"button",onClick:()=>{t(nf()),Ae.logEvent(G.dalleShuffleStyles),W.logEvent(G.dalleShuffleStyles)},children:c.jsx(iM,{className:"icon-sm text-token-text-tertiary"})}),Hm.map(l=>c.jsx(Rp,{src:l.image,alt:o.formatMessage(l.name),width:100,height:100,className:"invisible fixed -left-96 -top-96"},l.name.id))]})}function fM({style:n}){const e=ye();return c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx(Rp,{src:n.image,alt:e.formatMessage(n.name),width:100,height:100,className:"rounded-md"}),c.jsx("div",{className:"text-xs font-medium",children:e.formatMessage(n.name)})]})}function nf(){return[...Hm].sort(()=>Math.random()-.5)}function hM(n,e){const t=e.getCurrentText();return t.trim()===""?n:t.endsWith(",")?` ${n.toLocaleLowerCase()}`:t.endsWith(", ")?n.toLocaleLowerCase():`, ${n.toLocaleLowerCase()}`}function sf(n,e){const t=hM(n,e);e.appendText(t),qr()}const xc=Ke.div`h-7 bg-token-main-surface-primary border border-token-border-light text-xs hover:bg-token-main-surface-secondary hover:text-token-text-primary px-2.5 radix-state-open:bg-token-main-surface-secondary radix-state-open:text-token-text-primary rounded-full flex flex-nowrap gap-0.5 items-center text-token-text-secondary font-normal`;function pM({threadId:n}){return k.useEffect(()=>{Dp.updateBannerDisclaimerClientThreadId(n),Ae.logEvent("chatgpt_unauthenticated_legal_banner"),W.logEvent(G.unauthLegalBanner,{threadId:n})},[n]),c.jsx(jp,{type:"none",children:c.jsx(j,{...xa.bannerTermsDisclaimer,values:{learnMoreLink:e=>c.jsx("a",{href:"https://help.openai.com/en/articles/5722486-how-your-data-is-used-to-improve-model-performance",target:"_blank",className:"text-token-text-primary underline",onClick:()=>{Ae.logEvent("chatgpt_unauthenticated_banner_learn_more_clicked"),W.logEvent(G.unauthDisclaimerBannerLearnMoreClicked,{threadId:n})},children:e})}})})}function mM({threadId:n}){const e=ye();k.useEffect(()=>{Ae.logEvent("chatgpt_unauthenticated_signup_banner"),W.logEvent(G.unauthSignupBanner,{threadId:n})},[n]);const t=yr();return c.jsx($a,{content:e.formatMessage(xa.bannerSignup),onPrimaryCtaClick:()=>{const s=t({authType:"signup"});Ae.logEvent("chatgpt_unauthenticated_banner_signup_button_clicked"),W.logSignUpButtonClicked({location:"Chat Stage Signup Banner",provider:s})},primaryCtaText:e.formatMessage(xa.bannerSignupButton)})}function gM({threadId:n}){const e=ye();k.useEffect(()=>{Ae.logEvent("chatgpt_unauthenticated_login_banner"),W.logEvent(G.unauthLoginBanner,{threadId:n})},[n]);const t=yr();return c.jsx($a,{content:e.formatMessage(xa.bannerSignup),onPrimaryCtaClick:()=>{const s=t({authType:"login"});Ae.logEvent("chatgpt_unauthenticated_banner_login_button_clicked"),W.logLogInButtonClicked({location:"Chat Stage Login Banner",provider:s})},primaryCtaText:e.formatMessage(Bx.logInButtonText)})}const xa=Ce({bannerTermsDisclaimer:{id:"bannerTermsDisclaimer",defaultMessage:"Don't share sensitive info. Chats may be reviewed and used to train our models. <learnMoreLink>Learn more</learnMoreLink>"},bannerSignup:{id:"4qlPtW",defaultMessage:"Get smarter responses, upload files and images, and more."},bannerSignupButton:{id:"hedgehog.banner_signup_button",defaultMessage:"Sign up"}}),Do={initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:.1},exit:{opacity:0,scale:.5,transition:{duration:.2}}},xM=({suggestions:n,onSelectingSuggestedReply:e})=>c.jsx("div",{className:"absolute bottom-full mb-4 flex max-w-[100vw] grow justify-center gap-2 overflow-auto px-1 pb-1 sm:px-2 sm:pb-0 md:static md:mb-0 md:max-w-none md:overflow-visible",children:n.slice(0,2).map((t,s)=>c.jsx(yt.div,{initial:Do.initial,animate:Do.animate,transition:{delay:(s-1)*Do.transition.delay},exit:Do.exit,children:c.jsx(Xe,{as:"button",color:"secondary",size:"small",onClick:()=>{e(t,n,s)},className:"group whitespace-nowrap md:whitespace-normal",children:c.jsx(bM,{suggestion:t})},s)},s))});function yM({suggestions:n,onSelectingSuggestedReply:e,clientThreadId:t}){const s=(n==null?void 0:n.length)>0;k.useEffect(()=>{s&&lm(n,t)},[s,t]);const{isUnauthenticated:i}=Dt();return s?n.every(cm)?c.jsxs(yt.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"flex flex-col items-center",children:[i&&c.jsx(Em,{className:"mb-6 h-12 w-12 sm:hidden"}),c.jsx(mw,{starterPrompts:n,onSelectStarterPrompt:e})]}):n.every(dm)?c.jsx(xM,{suggestions:n,onSelectingSuggestedReply:e}):null:null}function bM({suggestion:n}){return dm(n)?c.jsx(c.Fragment,{children:n.text}):cm(n)?c.jsxs("div",{className:"flex flex-col overflow-hidden",children:[n.title&&c.jsx("div",{className:"truncate font-semibold",children:n.title}),c.jsx("div",{className:J("truncate font-normal",n.title?"opacity-50":""),children:n.body})]}):null}function kM(){const{store:n}=en(),e=n.useSharedProps();return e?c.jsx(wM,{...e}):null}function wM({clientThreadId:n,suggestions:e}){const t=am();return e===void 0||e.length===0?null:c.jsx("div",{children:c.jsx(vM,{children:c.jsx("div",{className:"grow",children:e!==void 0&&c.jsx(yM,{suggestions:e,onSelectingSuggestedReply:t,clientThreadId:n})})})})}const vM=Ke.div`h-full flex ml-1 md:w-full md:m-auto gap-0 md:gap-2 justify-center`,qm=({className:n,children:e})=>c.jsx(yt.div,{className:n,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:e});function SM({currentLeafId:n,canContinue:e,onContinueGenerating:t}){const s=k.useCallback(()=>{t(n),qr()},[t,n]);let i=null;return e&&(i=c.jsx(CM,{onHandleContinueGenerating:s})),i&&c.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:i})}const CM=({onHandleContinueGenerating:n})=>{const e=lo();return c.jsx(qm,{children:c.jsxs(Xe,{as:"button",color:"secondary",onClick:n,className:"whitespace-nowrap border-0 md:border",children:[c.jsx(pm,{className:J("-rotate-180",e?"icon-xs":"icon-sm")}),e&&c.jsx(j,{...Sn.continueGenerating})]})})},MM=({clientThreadId:n})=>{const e=rp(),t=ho(n),s=gs(t);k.useEffect(()=>{s&&Gr.dismissBanner()},[s]);const i=e!=null&&e.is_dismissible?()=>Gr.dismissBanner():void 0;return c.jsx(yi,{children:e&&c.jsx(yt.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:c.jsx(pv,{clientThreadId:n,rateLimitInfo:e,onDismiss:i})})})};function TM(n){const e=ho(n),t=gs(e),s=rp();return!t&&s!=null}function EM(n){return n.shouldRender?c.jsx(_M,{...n}):null}function _M({contentArea:n,children:e}){const{store:t}=en(),s=k.useRef(null);return t.useContentAreaResizeObserver(n,s),c.jsx("div",{ref:s,className:"relative h-full w-full",children:e})}const cs=window.sessionStorage,yc=ao(op(()=>({memoryFullBannerDismissed:!!(cs!=null&&cs.getItem(Xn.MemoryFullBannerDismissed))}))),Km={dismissBanner(){yc.setState(n=>{n.memoryFullBannerDismissed=!0}),cs==null||cs.setItem(Xn.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){yc.setState(n=>{n.memoryFullBannerDismissed=!1}),cs==null||cs.removeItem(Xn.MemoryFullBannerDismissed)}};function AM(n){const e=Bn(n),t=Ua(),{data:s}=za(e,!1,t),i=s!=null,r=i&&s.memoryFullPct>=100,[o,a]=k.useState(!1);k.useEffect(()=>{!r&&i&&(a(!0),Km.clearDismissedBanner())},[r,i]);const l=yc(d=>d.memoryFullBannerDismissed);return r&&o&&!l}function NM(){const n=ye(),{openSettings:e}=Wv();return c.jsx(yt.div,{initial:{opacity:0},animate:{opacity:1},children:c.jsx($a,{title:n.formatMessage(jo.memoryFullTitle),content:n.formatMessage(jo.memoryFullTooltip,jo.memoryFullTooltip.values),primaryCtaText:n.formatMessage(jo.memoryManageButton),onPrimaryCtaClick:()=>e(Hv.Personalization),onDismiss:()=>Km.dismissBanner()})})}const jo=Ce({memoryFullTitle:{id:"yRGU2/",defaultMessage:"Memory is full."},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"neUc+N",defaultMessage:"New memories won’t be created until you make space. <a>Learn more</a>",values:{a:n=>c.jsx("a",{href:Xb,target:"_blank",rel:"noopener noreferrer",className:"underline",children:n})}}}),Jm={isParagenVisible:!1,isParagenSkipped:!1},Gd=()=>{const{config:n}=ap("4274348958"),e=n.get("show_paragen_skip_button",null),t=n.get("show_paragen_descriptor_labels",null),s=n.get("default_paragen_descriptor_label",null);return{shouldShowParagenLabels:t,defaultParagenLabel:s,shouldShowSkipButton:e}},$d=ao(op(()=>Jm)),ya=$d.setState,Ym={reset:()=>ya(Jm),skipParagen:()=>{ya(n=>{n.isParagenSkipped=!0})}},IM=()=>$d(({isParagenSkipped:n})=>n),RM=()=>{Pp(()=>(ya(n=>{n.isParagenVisible=!0}),()=>{ya(n=>{n.isParagenVisible=!1})}))},DM=()=>{const{shouldShowSkipButton:n}=Gd();return n?c.jsx(qm,{className:"flex justify-center",children:c.jsx(Xe,{as:"button",color:"secondary",onClick:()=>Ym.skipParagen(),children:c.jsx(j,{...jM.skip})})}):null},jM=Ce({skip:{id:"dvcUbp",defaultMessage:"Skip"}}),PM=k.memo(function({className:e}){const{store:t}=en(),s=t.useIsHeaderContentAreaPopulated();return c.jsx("div",{className:J(e??"absolute bottom-full left-0 right-0",lc.PromptTextareaHeader),children:c.jsx(EM,{shouldRender:s,contentArea:tr.Header,children:c.jsxs("div",{className:"flex flex-col gap-3.5 pb-3.5 pt-2",children:[c.jsx(OM,{}),c.jsx(FM,{})]})})})});function OM(){const{store:n}=en(),e=n.useContentAreaId(tr.HeaderTop);let t;switch(e){case Nt.ParagenControls:t=c.jsx(DM,{});break;case Nt.ItemActions:t=c.jsx(kM,{});break;case Nt.BannerSignup:t=c.jsx(BM,{});break;case Nt.BannerTermsDisclaimer:t=c.jsx(UM,{});break;case Nt.PromptTextareaAction:t=c.jsx(zM,{});break;case Nt.BannersRateLimit:t=c.jsx(VM,{});break;case Nt.BannerSidekickAnnouncement:t=c.jsx(qv,{});break;case Nt.BannerMemoryFull:t=c.jsx(NM,{});break;case Nt.Box:t=c.jsxs("div",{className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",c.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",c.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;default:t=null;break}return t}function FM(){const{store:n}=en(),e=n.useContentAreaId(tr.HeaderBottom);let t;switch(e){case um.DallePromptControls:t=c.jsx(LM,{});break;default:t=null;break}return t}function LM(){const{store:n}=en(),e=n.useSharedProps(t=>t==null?void 0:t.composerController);return e?c.jsx(cM,{composerController:e}):null}function BM(){const{store:n}=en(),e=n.useSharedProps(s=>s==null?void 0:s.clientThreadId),t=Va();return e?t?c.jsx(gM,{threadId:e}):c.jsx(mM,{threadId:e}):null}function UM(){const{store:n}=en(),e=n.useSharedProps(t=>t==null?void 0:t.clientThreadId);return e?c.jsx(pM,{threadId:e}):null}function zM(){const{store:n}=en(),e=n.useSharedProps();return e?c.jsx(SM,{...e}):null}function VM(){const{store:n}=en(),e=n.useSharedProps(t=>t==null?void 0:t.clientThreadId);return e?c.jsx(MM,{clientThreadId:e}):null}function Wd(){return cp(Si.DataAnalysisV2)}function B5(){const n=pr(),e=Ln();return e&&n&&!lp(n)&&e.isEnterprise()}function GM(){return cp(Si.ChartSerialization)}function U5(n,e){const t=n==="chart"?Xn.HasSeenAdaInteractiveChart:Xn.HasSeenAdaInteractiveTable,[s,i]=k.useState(aa.getItem(t,{userId:e})??!1),r=k.useCallback(()=>{i(!0),aa.setItem(t,!0,{userId:e})},[t,e]);return[s,r]}function z5(n){const[e,t]=k.useState([]),s=xs(()=>{const i=z.resolveThreadId(n),r=z.getThreadCurrentLeafId(n);return z.getTree(i).getBranchFromLeaf(r)});return k.useEffect(()=>{const i=Qm(s);i.length!==e.length&&t(i)},[e.length,n,s]),e}function $M(n){return xs(()=>{const e=z.resolveThreadId(n),t=z.getThreadCurrentLeafId(n),i=z.getTree(e).getBranchFromLeaf(t);return Qm(i).length>0})}function Xm(n){var r,o,a,l;const e=((o=(r=n.metadata)==null?void 0:r.aggregate_result)==null?void 0:o.messages.filter(Ld))??[];let t=0;const s=(((a=n.metadata)==null?void 0:a.ada_visualizations)??[]).map(d=>{let u=d;return d.type=="chart"&&(u={...d,fallback_image:e[t++]}),u}),i=(((l=n.metadata)==null?void 0:l.attachments)??[]).filter(d=>km(d.name)).map(d=>({type:"table",file_id:d.id??"",title:wm(d),file_name:d.name,context_connector_info:d.context_connector_info}));return[...s,...i]}function Qm(n){return n.filter(t=>{var s,i,r,o;return((s=t.message)==null?void 0:s.author.role)==="tool"&&((i=t.message)==null?void 0:i.author.name)==="python"||(((o=(r=t.message)==null?void 0:r.metadata)==null?void 0:o.attachments)??[]).length>0}).flatMap(t=>Xm(t.message))}ao(n=>({selectedSpreadsheet:null,setSelectedSpreadsheet:e=>n({selectedSpreadsheet:e})}));async function WM(n,e,t){const s=await n.text(),{parse:i}=await Ue(async()=>{const{parse:o}=await import("./oeujip5i1ptrxie5.js");return{parse:o}},[]),r=i(s);return{content:{columnNames:r.shift(),columnTypes:r[0].map(()=>"string"),rows:r},file_name:e,download_url:t}}function HM(n){const e=n[0].values.length,t=[];for(let s=0;s<e;s++){const i=n.map(r=>r.values[s]);t.push(i)}return t}function V5(n){return Vs({queryKey:["ada-visualization","chart",n.file_id],queryFn:async()=>{const e=await _e.getFileDownloadLink(n.file_id);if(e.status===nd.Success){const s=await(await fetch(e.download_url)).json();return{content:{chart_type:s.type,title:s.title,labels:s.labels,datasets:s.datasets,x_label:s.x_label,y_label:s.y_label},file_name:e.file_name??"",download_url:e.download_url}}else throw new Error("Failed to download chart json from interpreter")}})}function G5(n){return Vs({queryKey:["ada-visualization","table",n.file_id],queryFn:async()=>{if(n.file_name&&Ev(n.file_name)){const e=await _e.getAdaExcelFileContents(n.file_id);return{content:e.sheets.map(t=>({name:t.name,columnNames:t.columns.map(s=>s.name),columnTypes:t.columns.map(()=>"string"),rows:HM(t.columns)})),download_url:e.download_url,file_name:n.file_name}}else{const e=await _e.getFileDownloadLink(n.file_id);if(e.status===nd.Success){const t=await fetch(e.download_url);return WM(t,e.file_name??"",e.download_url)}else throw new Error("Failed to download from interpreter")}}})}function Zm(n){const e=er(),t=$M(n),s=Wd();return t&&s&&!e.displayingSideBySideFeedback}function qM(n){var e,t;return((t=(e=n.metadata)==null?void 0:e.dalle)==null?void 0:t.prompt)??""}async function KM(n,e,t="image/png"){return new Promise((s,i)=>{n.toBlob(r=>{r!=null?s(new File([r],e,{type:t})):i(new Error("Failed to convert canvas to blob"))},t)})}async function JM(n,e){const t=document.createElement("canvas");t.width=n.width,t.height=n.height;const s=t.getContext("2d");if(s==null)throw new Error("Failed to get 2d context for mask canvas");const i=s.createImageData(n.width,n.height);for(let r=0;r<n.data.length;r+=4)n.data[r+3]!==0?(i.data[r]=0,i.data[r+1]=0,i.data[r+2]=0,i.data[r+3]=255):(i.data[r]=255,i.data[r+1]=255,i.data[r+2]=255,i.data[r+3]=255);return s.putImageData(i,0,0),KM(t,e)}async function YM(n,e){const s=await(await fetch(n)).blob(),i=document.createElement("a");i.href=URL.createObjectURL(s),i.download=e,i.click(),i.remove()}function XM(n){const e=sS(new Date,"yyyy-MM-dd HH.mm.ss");let t=n.slice(0,150);return t.endsWith(".")&&(t=t.slice(0,-1)),`DALL·E ${e} - ${t}.webp`}async function $5(n,e,t){var r,o,a,l,d,u,f,h,g,x;const s=qM(n),i=XM(s);await YM(n.url,i),Ae.logEvent("chatgpt_dalle_image_download",null,{sourceOperation:((o=(r=n.metadata)==null?void 0:r.dalle)==null?void 0:o.edit_op)??"none",hasParent:((l=(a=n.metadata)==null?void 0:a.dalle)==null?void 0:l.parent_gen_id)!=null?"true":"false"}),W.logEvent(G.dalleImageDownload,{conversationId:e,messageId:t,generationId:(u=(d=n.metadata)==null?void 0:d.dalle)==null?void 0:u.gen_id,parentGenerationId:(h=(f=n.metadata)==null?void 0:f.dalle)==null?void 0:h.parent_gen_id,fileId:gi(n.asset_pointer),sourceOperation:(x=(g=n.metadata)==null?void 0:g.dalle)==null?void 0:x.edit_op})}function QM(n){const e=el(n),t=mr(),s=e&&"gizmo"in e?e.gizmo:void 0;return!t&&(s==null?void 0:s.gizmo.id)===Ky}function W5(n,e){var i,r;const t=(r=(i=e.metadata)==null?void 0:i.dalle)==null?void 0:r.gen_id,s=gi(e.asset_pointer);return s==null||t==null?n:{...n,messageMetadata:{...n.messageMetadata,dalle:{from_client:{operation:{type:"transformation",original_gen_id:t,original_file_id:s}}}}}}async function ZM(n,e,t){return new Promise((s,i)=>{Cm(Kr(n),n,e,{kind:Wt.DalleAgent},{onFileCreated:vt,onFileUploadProgress:vt,onFileUploaded:(r,o)=>s(o),onError:(r,o)=>{i(new Error(`Failed to upload file with reason: ${o}`))}},t)})}async function H5(n,e,t,s){var o,a;const i=(a=(o=e.metadata)==null?void 0:o.dalle)==null?void 0:a.gen_id,r=gi(e.asset_pointer);if(r==null||i==null||t==null)return n;try{const l=await JM(t,"mask.png"),d=await ZM(l,s,{imageDimensions:{width:e.width,height:e.height}});return{...n,messageMetadata:{...n.messageMetadata,dalle:{from_client:{operation:{type:"inpainting",original_gen_id:i,original_file_id:r,mask_file_id:d}}}}}}catch(l){return et.addError(l),n}}const eg={data:void 0},bc=ao()(()=>({...eg}));function kc(n){if(n.data==null)return bc.setState(n);const e=n.data.suggestions.map(t=>({text:t,type:Op.Reply}));bc.setState({data:{messageId:n.data.messageId,suggestions:e}})}function tg(){return bc(n=>n.data)}const eT=async(n,e,t)=>{kc({data:void 0});try{const s=await _e.generateSuggestions(n,e,t),{suggestions:i}=s;kc({data:{messageId:e,suggestions:i}})}catch(s){et.addError(s)}},wc=()=>{kc(eg)},tT=()=>{const{shouldShowSkipButton:n=!1}=Gd(),e=$d(({isParagenVisible:t})=>t);return!!n&&e},nT=k.memo(function(e){return sT(e),iT(e),rT(),null});function sT(n){const{store:e}=en(),t=e.useSetSharedProps();k.useLayoutEffect(()=>{t(n)},[n,t])}function iT(n){const{clientThreadId:e,canContinue:t}=n,{store:s}=en(),i=k.useRef({top:s.useContentAreaApi(tr.HeaderTop),bottom:s.useContentAreaApi(tr.HeaderBottom)}).current,r=lT(n),o=QM(e),{shouldShowBannerSignup:a,shouldShowBannerTermsDisclaimer:l}=cT(e),d=TM(e),u=Kv(n),f=AM(e),h=tT();k.useLayoutEffect(()=>{h?i.top.set(Nt.ParagenControls):l?i.top.set(Nt.BannerTermsDisclaimer):d?i.top.set(Nt.BannersRateLimit):u.eligible?i.top.set(Nt.BannerSidekickAnnouncement):r?i.top.set(Nt.ItemActions):t?i.top.set(Nt.PromptTextareaAction):a?i.top.set(Nt.BannerSignup):f?i.top.set(Nt.BannerMemoryFull):i.top.set(null)},[i,r,t,l,a,d,u,f,h]),k.useLayoutEffect(()=>{o&&i.bottom.set(um.DallePromptControls)},[i,o])}function rT(){const{store:n}=en();k.useEffect(()=>()=>{n.reset()},[n])}function oT(n){var i,r;const e=tg(),t=Qn(n),s=(r=(i=z.getTree(n).getLastValidNode(t))==null?void 0:i.message)==null?void 0:r.id;return(e==null?void 0:e.messageId)===s?e.suggestions:[]}function aT(n){return oT(n).length>0}function lT(n){const e=Zm(n.clientThreadId),t=aT(n.clientThreadId);return n.isDisabled?!1:n.isNewThread||e||t}function cT(n){var f;const{isUnauthenticated:e}=Dt(),t=Qn(n),{layer:s}=Ux("3637408529"),i=s.get("should_show_no_auth_signup_banner",!0),r=Fp(h=>h.bannerDisclaimerClientThreadId),o={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1};if(!n)return o;const a=z.getTree(n),l=a.countMessagesByAuthor($e.User),d=a.getNodeByIdOrMessageId(t),u=((f=d==null?void 0:d.message)==null?void 0:f.author.role)===$e.Assistant&&sd(d.message);return o.shouldShowBannerTermsDisclaimer=u&&e&&l===1&&(r==null||r===n),o.shouldShowBannerSignup=i&&u&&e&&l>0&&l%5===0,o}const dT="OAI-Echo-Logs",ji={FOCUS_IN:0,FOCUS_OUT:1,COPY:2,PASTE:3,TOUCH_START:4,TOUCH_END:5},ng=[];function Pi(n){return()=>{ng.push({type:n,ts:Math.round(performance.now())})}}const uT={focusin:Pi(ji.FOCUS_IN),focusout:Pi(ji.FOCUS_OUT),copy:Pi(ji.COPY),paste:Pi(ji.PASTE),touchstart:Pi(ji.TOUCH_START),touchend:Pi(ji.TOUCH_END)};function fT(){const n=document.getElementById(hd);for(const[e,t]of Object.entries(uT))n==null||n.removeEventListener(e,t),n==null||n.addEventListener(e,t)}function hT(){return{[dT]:ng.slice(0,10).map(n=>`${n.type},${n.ts}`).join(",")}}function pT(n,e,t,s,i){const{getGizmoId:r}=gr(),[o,a]=k.useState();k.useEffect(()=>{r?r().then(u=>a(u)):a(void 0)},[r]);const l=dp(e);return k.useCallback(u=>{const{docsReferencedByURL:f}=qt.getThread(n)??{};if(f!=null)for(const h of u){const{id:g,type:x,handler:y}=h,w=`${x}:${g}`,S=f[w],O=At.getState().files.find(T=>T.tempId===g);if(S!=null&&S!=="failed"&&O){xt.success(t.formatMessage(wl.fileAlreadyAttached),{hasCloseButton:!0});continue}switch(y.type){case"fetch":{z.updateReferencedDocState(n,w,"pending"),Lt.uploadFile(g,new File([],t.formatMessage(wl.fileLoading)),Tt.None,s,t,{skipUpload:!0,gizmoId:o},i,{contextConnector:x,sourceUrl:h.url,syntheticExtension:null,type:ms.Link}),Rt.linkMetadataFetchStarted(x),y.tryFetch().then(T=>{if(Lt.remove(g,"none"),T==null)return null;const{id:E,title:R,connector:F,mimeType:D,url:I,syntheticExtension:$,o365DriveId:B}=T;Rt.linkMetadataFetchSucceeded(x,D),z.updateReferencedDocState(n,w,"fetched");let U=R;F===Se.GDRIVE&&(U=$?`${R}.${$}`:R),Lt.uploadFile(E,new File([],U,{type:D.split(";")[0]}),Tt.Retrieval,s,t,{gizmoId:o},i,{contextConnector:F,sourceUrl:I,syntheticExtension:$,type:ms.Link,o365DriveId:B})}).catch(T=>{Rt.linkMetadataFetchFailed(x,T),xt.danger(t.formatMessage(wl.fileFetchFailed),{hasCloseButton:!0}),z.updateReferencedDocState(n,w,"failed"),Lt.remove(g,"none")});break}case"prompt":{l.appendMessageIfNotDismissed({connector:x,type:y.message}),z.updateReferencedDocState(n,w,"prompted");break}}}},[i,n,l,o,t,s])}const wl=Ce({fileLoading:{id:"CCC.fileLoading",defaultMessage:"Loading…"},fileFetchFailed:{id:"CCC.fileFetchFailed",defaultMessage:"Unable to fetch file information"},fileAlreadyAttached:{id:"CCC.fileAlreadyAttached",defaultMessage:"This file is already a part of your message."}});function mT(n,e,t){let s=Vm.getReadyFiles(At.getState());(t==null?void 0:t.kind)===tt.GizmoMagicCreate?s=s.filter(f=>f.gizmoId!=null):s=s.filter(f=>f.gizmoId==null);let i=n??"";const r=[],o=[],a=sr(e,t),d=Pd(e,t).length>0,u=a===Tt.Interpreter||a===Tt.Retrieval||a===Tt.ContextConnector;return s.forEach(({fileSpec:f})=>{if(u){const h=f.contextConnectorInfo;r.push({id:f.id,size:f.size,name:f.name,context_connector_info:h?{context_connector:h==null?void 0:h.contextConnector,source_url:h==null?void 0:h.sourceUrl,synthetic_extension:(h==null?void 0:h.syntheticExtension)??null,type:h==null?void 0:h.type}:void 0,mime_type:f.mimeType,width:"width"in f?f.width:void 0,height:"height"in f?f.height:void 0,file_token_size:f.fileTokenSize})}d&&"width"in f&&"height"in f&&o.push({content_type:oc.ImageAssetPointer,asset_pointer:_v(f.id),size_bytes:f.size,width:f.width,height:f.height})}),o.length>0&&(o.push(n??""),i={content_type:Ht.MultimodalText,parts:o}),{content:i,attachments:r}}const sg=({clientThreadId:n,rateLimitPopup:e,children:t})=>{const s=Sd(n),i=Ln(),r=a=>{e!=null&&a&&W.logPopoverHover({type:"rate_limit",location:"file_upload",plan_type:(i==null?void 0:i.planType)??"unknown"})},o=!!e;return c.jsx(c.Fragment,{children:o?c.jsxs(up,{delayDuration:150,onOpenChange:r,children:[c.jsx(fp,{children:t}),c.jsx(hp,{children:c.jsx(Ip,{$as:pp,side:"top",sideOffset:4,className:"max-w-[260px]",children:c.jsx(gT,{isNewConversation:s,rateLimitPopup:e})})})]}):t})},gT=({isNewConversation:n=!1,rateLimitPopup:e})=>{const t=Ln(),s=Gs();if(e==null)return null;const{call_to_action:i,description:r}=e,o=r||c.jsx(j,{...rf.defaultDescription}),a=i==null?void 0:i.includes(zx.GET_PLUS);return c.jsxs("div",{className:"p-2 text-sm text-token-text-primary",children:[c.jsx("div",{children:o}),a?c.jsx(Xe,{size:"small",color:"secondary",className:"mt-3",onClick:()=>{go(s,"Rate limited file upload popover"),W.logRateLimitGetPlusButtonClicked({type:"file_upload",location:"popover",plan_type:(t==null?void 0:t.planType)??"unknown",is_hard_block:!1,is_new_conversation:n,hard_block_reason:""})},children:c.jsx(j,{...rf.getPlus})}):null]})},rf=Ce({defaultDescription:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlus:{id:"TeyLcp",defaultMessage:"Get Plus"}});function xT({clientThreadId:n,getInputProps:e,openFileDialog:t,uploadType:s,icon:i}){const r=ye(),o=id(),a=!!o,l=c.jsx(Lp,{className:"mb-1 ml-1.5",disabled:a,onClick:f=>{f.preventDefault(),W.logEvent(G.openFileViewer,{intent:s.toString()}),t()},"aria-label":r.formatMessage({id:"PromptFilePicker.attachFiles",defaultMessage:"Attach files"}),children:i}),d=c.jsx("input",{disabled:a,...e({className:"hidden"})}),u=c.jsxs("div",{className:"flex",children:[l,d]});return c.jsx(sg,{clientThreadId:n,rateLimitPopup:o,children:u})}function yT({code:n,message:e}){switch(n){case Vu.FileTooLarge:return of.errorFileTooLarge;case Vu.TooManyFiles:return W.logEvent(G.uploadedMaxFilesError),of.errorTooManyFiles;default:return e}}const of=Ce({attachImages:{id:"PromptFilePicker.attachImages",defaultMessage:"Attach images"},attachFiles:{id:"PromptFilePicker.attachFiles",defaultMessage:"Attach files"},errorFileTooLarge:{id:"PromptFilePicker.errorFileTooLarge",defaultMessage:"Your file is too large. The maximum file size is {size}MB."},errorTooManyFiles:{id:"PromptFilePicker.errorTooManyFiles",defaultMessage:"You may only upload {maxNum} files at a time."},defaultFileUploadRateLimited:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"}}),af=Ce({dragInstructions:{id:"FileDropZone.dragInstructions",defaultMessage:"Add anything"},dragAllAccepted:{id:"FileDropZone.dragAllAccepted",defaultMessage:"Drop any file here to add it to the conversation"}});function bT(n){var T;const{className:e,children:t,clientThreadId:s,currentModelConfig:i}=n,r=ye(),o=el(s),a=sr(i,o),l=a!==Tt.None,d=At(E=>E.files),u=(a===Tt.Multimodal?pd:Hr)-d.length,f=u<=0,{getGizmoId:h}=gr(),{handleFileAccepted:g}=rg(r,sr(i,o),Pd(i,o),"drag",h,(T=jd(i,o))==null?void 0:T.attachments),x=id(),y=vm(Sm(i,o)),{getRootProps:w,isDragActive:S}=Mm({maxFiles:u,disabled:!l||f||x!=null,noClick:!0,onDropAccepted:g,onDropRejected:E=>ig(E,r,a),multiple:!0,maxSize:Bp,...y}),_=O();function O(){if(!y.accept||Object.keys(y.accept).length===0)return[];const E=[];return Object.values(y.accept).forEach(R=>E.push(...R)),E.sort()}return c.jsxs("div",{...w({className:e}),children:[t,S&&c.jsxs(kT,{children:[c.jsx(uS,{}),c.jsx("h3",{children:c.jsx(j,{...af.dragInstructions})}),c.jsx("h4",{className:"w-2/3 text-center",children:_.length>0?_.join(", "):c.jsx(j,{...af.dragAllAccepted})})]})]})}function ig(n,e,t){const{errors:s}=n[0];s.forEach(i=>{const r=yT(i);typeof r=="string"?xt.danger(r,{hasCloseButton:!0}):xt.danger(e.formatMessage(r,{size:Qb,maxNum:t===Tt.Multimodal?pd:Hr}),{hasCloseButton:!0})})}function rg(n,e,t,s,i,r){return{handleFileAccepted:k.useCallback(async(a,l)=>{W.logEvent(G.uploadFile,{client:"web",eventSource:s,intent:e.toString()});const d=i!=null?await i():void 0;a.length>0&&a.forEach(u=>{Lt.uploadFile(Kr(u),u,e,t,n,{gizmoId:d},r)})},[s,e,i,t,n,r])}}const kT=Ke.div`absolute inset-0 opacity-80 flex gap-2 flex-col justify-center items-center bg-token-main-surface-primary text-token-text-primary`;function wT(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)t.hasOwnProperty(s)&&(n[s]=t[s])}return n}function vc(n,e){return Array(e+1).join(n)}function vT(n){return n.replace(/^\n*/,"")}function ST(n){for(var e=n.length;e>0&&n[e-1]===`
`;)e--;return n.substring(0,e)}var CT=["ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","BODY","CANVAS","CENTER","DD","DIR","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","FRAMESET","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","HTML","ISINDEX","LI","MAIN","MENU","NAV","NOFRAMES","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","UL"];function Hd(n){return qd(n,CT)}var og=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];function ag(n){return qd(n,og)}function MT(n){return cg(n,og)}var lg=["A","TABLE","THEAD","TBODY","TFOOT","TH","TD","IFRAME","SCRIPT","AUDIO","VIDEO"];function TT(n){return qd(n,lg)}function ET(n){return cg(n,lg)}function qd(n,e){return e.indexOf(n.nodeName)>=0}function cg(n,e){return n.getElementsByTagName&&e.some(function(t){return n.getElementsByTagName(t).length})}var Ut={};Ut.paragraph={filter:"p",replacement:function(n){return`

`+n+`

`}};Ut.lineBreak={filter:"br",replacement:function(n,e,t){return t.br+`
`}};Ut.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(n,e,t){var s=Number(e.nodeName.charAt(1));if(t.headingStyle==="setext"&&s<3){var i=vc(s===1?"=":"-",n.length);return`

`+n+`
`+i+`

`}else return`

`+vc("#",s)+" "+n+`

`}};Ut.blockquote={filter:"blockquote",replacement:function(n){return n=n.replace(/^\n+|\n+$/g,""),n=n.replace(/^/gm,"> "),`

`+n+`

`}};Ut.list={filter:["ul","ol"],replacement:function(n,e){var t=e.parentNode;return t.nodeName==="LI"&&t.lastElementChild===e?`
`+n:`

`+n+`

`}};Ut.listItem={filter:"li",replacement:function(n,e,t){n=n.replace(/^\n+/,"").replace(/\n+$/,`
`).replace(/\n/gm,`
    `);var s=t.bulletListMarker+"   ",i=e.parentNode;if(i.nodeName==="OL"){var r=i.getAttribute("start"),o=Array.prototype.indexOf.call(i.children,e);s=(r?Number(r)+o:o+1)+".  "}return s+n+(e.nextSibling&&!/\n$/.test(n)?`
`:"")}};Ut.indentedCodeBlock={filter:function(n,e){return e.codeBlockStyle==="indented"&&n.nodeName==="PRE"&&n.firstChild&&n.firstChild.nodeName==="CODE"},replacement:function(n,e,t){return`

    `+e.firstChild.textContent.replace(/\n/g,`
    `)+`

`}};Ut.fencedCodeBlock={filter:function(n,e){return e.codeBlockStyle==="fenced"&&n.nodeName==="PRE"&&n.firstChild&&n.firstChild.nodeName==="CODE"},replacement:function(n,e,t){for(var s=e.firstChild.getAttribute("class")||"",i=(s.match(/language-(\S+)/)||[null,""])[1],r=e.firstChild.textContent,o=t.fence.charAt(0),a=3,l=new RegExp("^"+o+"{3,}","gm"),d;d=l.exec(r);)d[0].length>=a&&(a=d[0].length+1);var u=vc(o,a);return`

`+u+i+`
`+r.replace(/\n$/,"")+`
`+u+`

`}};Ut.horizontalRule={filter:"hr",replacement:function(n,e,t){return`

`+t.hr+`

`}};Ut.inlineLink={filter:function(n,e){return e.linkStyle==="inlined"&&n.nodeName==="A"&&n.getAttribute("href")},replacement:function(n,e){var t=e.getAttribute("href"),s=ba(e.getAttribute("title"));return s&&(s=' "'+s+'"'),"["+n+"]("+t+s+")"}};Ut.referenceLink={filter:function(n,e){return e.linkStyle==="referenced"&&n.nodeName==="A"&&n.getAttribute("href")},replacement:function(n,e,t){var s=e.getAttribute("href"),i=ba(e.getAttribute("title"));i&&(i=' "'+i+'"');var r,o;switch(t.linkReferenceStyle){case"collapsed":r="["+n+"][]",o="["+n+"]: "+s+i;break;case"shortcut":r="["+n+"]",o="["+n+"]: "+s+i;break;default:var a=this.references.length+1;r="["+n+"]["+a+"]",o="["+a+"]: "+s+i}return this.references.push(o),r},references:[],append:function(n){var e="";return this.references.length&&(e=`

`+this.references.join(`
`)+`

`,this.references=[]),e}};Ut.emphasis={filter:["em","i"],replacement:function(n,e,t){return n.trim()?t.emDelimiter+n+t.emDelimiter:""}};Ut.strong={filter:["strong","b"],replacement:function(n,e,t){return n.trim()?t.strongDelimiter+n+t.strongDelimiter:""}};Ut.code={filter:function(n){var e=n.previousSibling||n.nextSibling,t=n.parentNode.nodeName==="PRE"&&!e;return n.nodeName==="CODE"&&!t},replacement:function(n){if(!n)return"";n=n.replace(/\r?\n|\r/g," ");for(var e=/^`|^ .*?[^ ].* $|`$/.test(n)?" ":"",t="`",s=n.match(/`+/gm)||[];s.indexOf(t)!==-1;)t=t+"`";return t+e+n+e+t}};Ut.image={filter:"img",replacement:function(n,e){var t=ba(e.getAttribute("alt")),s=e.getAttribute("src")||"",i=ba(e.getAttribute("title")),r=i?' "'+i+'"':"";return s?"!["+t+"]("+s+r+")":""}};function ba(n){return n?n.replace(/(\n+\s*)+/g,`
`):""}function dg(n){this.options=n,this._keep=[],this._remove=[],this.blankRule={replacement:n.blankReplacement},this.keepReplacement=n.keepReplacement,this.defaultRule={replacement:n.defaultReplacement},this.array=[];for(var e in n.rules)this.array.push(n.rules[e])}dg.prototype={add:function(n,e){this.array.unshift(e)},keep:function(n){this._keep.unshift({filter:n,replacement:this.keepReplacement})},remove:function(n){this._remove.unshift({filter:n,replacement:function(){return""}})},forNode:function(n){if(n.isBlank)return this.blankRule;var e;return(e=vl(this.array,n,this.options))||(e=vl(this._keep,n,this.options))||(e=vl(this._remove,n,this.options))?e:this.defaultRule},forEach:function(n){for(var e=0;e<this.array.length;e++)n(this.array[e],e)}};function vl(n,e,t){for(var s=0;s<n.length;s++){var i=n[s];if(_T(i,e,t))return i}}function _T(n,e,t){var s=n.filter;if(typeof s=="string"){if(s===e.nodeName.toLowerCase())return!0}else if(Array.isArray(s)){if(s.indexOf(e.nodeName.toLowerCase())>-1)return!0}else if(typeof s=="function"){if(s.call(n,e,t))return!0}else throw new TypeError("`filter` needs to be a string, array, or function")}function AT(n){var e=n.element,t=n.isBlock,s=n.isVoid,i=n.isPre||function(f){return f.nodeName==="PRE"};if(!(!e.firstChild||i(e))){for(var r=null,o=!1,a=null,l=lf(a,e,i);l!==e;){if(l.nodeType===3||l.nodeType===4){var d=l.data.replace(/[ \r\n\t]+/g," ");if((!r||/ $/.test(r.data))&&!o&&d[0]===" "&&(d=d.substr(1)),!d){l=Sl(l);continue}l.data=d,r=l}else if(l.nodeType===1)t(l)||l.nodeName==="BR"?(r&&(r.data=r.data.replace(/ $/,"")),r=null,o=!1):s(l)||i(l)?(r=null,o=!0):r&&(o=!1);else{l=Sl(l);continue}var u=lf(a,l,i);a=l,l=u}r&&(r.data=r.data.replace(/ $/,""),r.data||Sl(r))}}function Sl(n){var e=n.nextSibling||n.parentNode;return n.parentNode.removeChild(n),e}function lf(n,e,t){return n&&n.parentNode===e||t(e)?e.nextSibling||e.parentNode:e.firstChild||e.nextSibling||e.parentNode}var ug=typeof window<"u"?window:{};function NT(){var n=ug.DOMParser,e=!1;try{new n().parseFromString("","text/html")&&(e=!0)}catch{}return e}function IT(){var n=function(){};return RT()?n.prototype.parseFromString=function(e){var t=new window.ActiveXObject("htmlfile");return t.designMode="on",t.open(),t.write(e),t.close(),t}:n.prototype.parseFromString=function(e){var t=document.implementation.createHTMLDocument("");return t.open(),t.write(e),t.close(),t},n}function RT(){var n=!1;try{document.implementation.createHTMLDocument("").open()}catch{window.ActiveXObject&&(n=!0)}return n}var DT=NT()?ug.DOMParser:IT();function jT(n,e){var t;if(typeof n=="string"){var s=PT().parseFromString('<x-turndown id="turndown-root">'+n+"</x-turndown>","text/html");t=s.getElementById("turndown-root")}else t=n.cloneNode(!0);return AT({element:t,isBlock:Hd,isVoid:ag,isPre:e.preformattedCode?OT:null}),t}var Cl;function PT(){return Cl=Cl||new DT,Cl}function OT(n){return n.nodeName==="PRE"||n.nodeName==="CODE"}function FT(n,e){return n.isBlock=Hd(n),n.isCode=n.nodeName==="CODE"||n.parentNode.isCode,n.isBlank=LT(n),n.flankingWhitespace=BT(n,e),n}function LT(n){return!ag(n)&&!TT(n)&&/^\s*$/i.test(n.textContent)&&!MT(n)&&!ET(n)}function BT(n,e){if(n.isBlock||e.preformattedCode&&n.isCode)return{leading:"",trailing:""};var t=UT(n.textContent);return t.leadingAscii&&cf("left",n,e)&&(t.leading=t.leadingNonAscii),t.trailingAscii&&cf("right",n,e)&&(t.trailing=t.trailingNonAscii),{leading:t.leading,trailing:t.trailing}}function UT(n){var e=n.match(/^(([ \t\r\n]*)(\s*))(?:(?=\S)[\s\S]*\S)?((\s*?)([ \t\r\n]*))$/);return{leading:e[1],leadingAscii:e[2],leadingNonAscii:e[3],trailing:e[4],trailingNonAscii:e[5],trailingAscii:e[6]}}function cf(n,e,t){var s,i,r;return n==="left"?(s=e.previousSibling,i=/ $/):(s=e.nextSibling,i=/^ /),s&&(s.nodeType===3?r=i.test(s.nodeValue):t.preformattedCode&&s.nodeName==="CODE"?r=!1:s.nodeType===1&&!Hd(s)&&(r=i.test(s.textContent))),r}var zT=Array.prototype.reduce,VT=[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^-/g,"\\-"],[/^\+ /g,"\\+ "],[/^(=+)/g,"\\$1"],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]];function ka(n){if(!(this instanceof ka))return new ka(n);var e={rules:Ut,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",preformattedCode:!1,blankReplacement:function(t,s){return s.isBlock?`

`:""},keepReplacement:function(t,s){return s.isBlock?`

`+s.outerHTML+`

`:s.outerHTML},defaultReplacement:function(t,s){return s.isBlock?`

`+t+`

`:t}};this.options=wT({},e,n),this.rules=new dg(this.options)}ka.prototype={turndown:function(n){if(!WT(n))throw new TypeError(n+" is not a string, or an element/document/fragment node.");if(n==="")return"";var e=fg.call(this,new jT(n,this.options));return GT.call(this,e)},use:function(n){if(Array.isArray(n))for(var e=0;e<n.length;e++)this.use(n[e]);else if(typeof n=="function")n(this);else throw new TypeError("plugin must be a Function or an Array of Functions");return this},addRule:function(n,e){return this.rules.add(n,e),this},keep:function(n){return this.rules.keep(n),this},remove:function(n){return this.rules.remove(n),this},escape:function(n){return VT.reduce(function(e,t){return e.replace(t[0],t[1])},n)}};function fg(n){var e=this;return zT.call(n.childNodes,function(t,s){s=new FT(s,e.options);var i="";return s.nodeType===3?i=s.isCode?s.nodeValue:e.escape(s.nodeValue):s.nodeType===1&&(i=$T.call(e,s)),hg(t,i)},"")}function GT(n){var e=this;return this.rules.forEach(function(t){typeof t.append=="function"&&(n=hg(n,t.append(e.options)))}),n.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}function $T(n){var e=this.rules.forNode(n),t=fg.call(this,n),s=n.flankingWhitespace;return(s.leading||s.trailing)&&(t=t.trim()),s.leading+e.replacement(t,n,this.options)+s.trailing}function hg(n,e){var t=ST(n),s=vT(e),i=Math.max(n.length-t.length,e.length-s.length),r=`

`.substring(0,i);return t+r+s}function WT(n){return n!=null&&(typeof n=="string"||n.nodeType&&(n.nodeType===1||n.nodeType===9||n.nodeType===11))}function df(n){const e={...n};for(const t of Object.keys(e))e[t]=Math.round(e[t]);return e}const Ml={clientRect:void 0,isCollapsed:void 0,textContent:void 0,documentFragment:void 0,selection:void 0},pg=new ka;pg.use(Zb);function HT(n){const t=n.getRangeAt(0).cloneContents(),s=document.createElement("div");return s.appendChild(t),pg.turndown(s.innerHTML)}function qT(n){const[{clientRect:e,isCollapsed:t,textContent:s,documentFragment:i,selection:r},o]=k.useState(Ml);return k.useLayoutEffect(()=>{const a=()=>{setTimeout(()=>{let l;const d=window.getSelection(),u={};if(d==null||!d.rangeCount){o(Ml);return}const f=d.getRangeAt(0);if(f==null){o(Ml);return}const h=f.cloneContents();u.documentFragment=h,u.textContent=HT(d);const g=f.getClientRects();if(g.length===0&&f.commonAncestorContainer!=null&&f.commonAncestorContainer instanceof HTMLElement){const x=f.commonAncestorContainer;l=df(x.getBoundingClientRect().toJSON())}else{if(g.length<1)return;l=df(g[0].toJSON())}u.clientRect=l,u.isCollapsed=f.collapsed,u.selection=d,o(u)},0)};return window.addEventListener("mouseup",a),()=>{window.removeEventListener("mouseup",a)}},[n]),{clientRect:e,isCollapsed:t,textContent:s,documentFragment:i,selection:r}}const mg="agent-turn",KT=[tt.PrimaryAssistant,tt.GizmoInteraction];function JT(n){return Gx.createPortal(n.children,n.mount??document.body)}function YT({messageId:n,anchorNode:e,clientRect:t,onClick:s}){const i=ye(),r=()=>{s(n)};if(!e)return null;const o=e.closest(`.${mg}`);if(!o)return null;const a=e.getBoundingClientRect();return c.jsx(JT,{mount:o,children:c.jsx("div",{className:"absolute",style:{top:e.offsetTop-36+t.top-a.top,left:t.left-a.left,width:t.width,height:t.height},children:c.jsx(bs,{label:i.formatMessage(ZT.replyTooltip),side:"top",children:c.jsx(Xe,{size:"small",color:"secondary",className:"shadow-lg",onClick:r,children:c.jsx(Ow,{className:"icon-md"})})})})})}function Tl(n,e){for(;n;){if(n instanceof HTMLElement&&n.dataset[e]!=null)return{node:n,dataValue:n.dataset[e]};n=n.parentNode}return{node:void 0,dataValue:void 0}}const XT=3;function QT({onTargetedReply:n}){const{clientRect:e,isCollapsed:t,textContent:s,selection:i}=qT(),{dataValue:r}=Tl(i==null?void 0:i.anchorNode,"messageAuthorRole"),{node:o,dataValue:a}=Tl(i==null?void 0:i.anchorNode,"messageId"),{dataValue:l}=Tl(i==null?void 0:i.focusNode,"messageId"),d=!l||a===l,u=s==null?void 0:s.trim(),f=(u==null?void 0:u.length)??0,h=g=>{u!==void 0&&n({targetedReply:{type:"text",label:u,createNewCompletionParams:x=>{const y=Vx(u);return{...x,messageMetadata:{...x.messageMetadata,targeted_reply:u},appendMessages:x.appendMessages==null?[y]:[...x.appendMessages,y]}},onCreateCompletion:({serverThreadId:x,currentLeafId:y})=>{W.logEvent(G.targetedReplySubmitted,{conversationId:x,currentLeafId:y})},onCleared:({serverThreadId:x,currentLeafId:y})=>{W.logEvent(G.targetedReplyCleared,{conversationId:x,currentLeafId:y})}},messageId:g})};return e==null||t||f<XT||!d||r!=="assistant"?null:c.jsx(YT,{messageId:a??"",anchorNode:o,clientRect:e,onClick:h})}const ZT=Ce({replyTooltip:{id:"targetedReply.replyTooltip",defaultMessage:"Reply"}});function e2({hasConnectors:n}){const{eligible:e,markAsViewed:t}=Mi(Ws.ContextConnectors),{activeModals:s}=Fd(),i=ye();return c.jsx(Za,{side:"top",show:e&&n&&s.size===0,title:i.formatMessage(uf.connectApps),onDismiss:t,sideOffset:32,theme:"bright",description:i.formatMessage(uf.description),children:c.jsx("div",{})})}const uf=Ce({connectApps:{id:"ContextConnectorAnnouncementTooltipContent.connectApps",defaultMessage:"Connect Apps"},description:{id:"ContextConnectorAnnouncementTooltipContent.description",defaultMessage:"Connect apps to access files in ChatGPT, like docs and spreadsheets."}});async function t2(n,e,t,s){if(t.type==="business"){const d=new URL(t.baseUrl);e=await Up.getState().getToken(Se.O365_BUSINESS,`${d.origin}/.default`)}const i=n2(s,t.baseUrl),r=new URLSearchParams({filePicker:JSON.stringify(i)}),o=`${t.parsedUrl}?${r}`,a=n.document.createElement("form");a.setAttribute("action",o),a.setAttribute("method","POST");const l=n.document.createElement("input");l.setAttribute("type","hidden"),l.setAttribute("name","access_token"),l.setAttribute("value",e),a.appendChild(l),n.document.body.append(a),a.submit()}function n2(n,e){return{sdk:"8.0",messaging:{channelId:n,origin:location.origin},authentication:{},entry:{sharePoint:{byPath:{list:e}}},typesAndSources:{mode:"files"},selection:{mode:"multiple"},search:{enabled:!0}}}function s2(n,e,t,s,i,r){function o(a){if((a==null?void 0:a.source)!==e)return;const l=a.data;if(l.type==="initialize"&&l.channelId===t){Rt.filePickerLoaded(r);const d=a.ports[0],f=r2(n,async h=>{if(d.removeEventListener("message",f),d.close(),e.close(),h!=null){const g=await Promise.all(h.map(x=>i2(x,n,i)));s({type:"pick",docs:g})}else s({type:"cancel"})},d,r);d.addEventListener("message",f),d.start(),d.postMessage({type:"activate"})}}window.addEventListener("message",o)}async function i2(n,e,t){var a;let s=`https://graph.microsoft.com/v1.0/drives/${encodeURIComponent(n.parentReference.driveId)}/items/${encodeURIComponent(n.id)}`;t.type==="personal"&&(s=`https://api.onedrive.com/v1.0/drives/${encodeURIComponent(n.parentReference.driveId)}/items/${encodeURIComponent(n.id)}`);const r=await(await fetch(s,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})).json();return{connector:t.type==="personal"?Se.O365_PERSONAL:Se.O365_BUSINESS,id:n.id,title:r.name??"",mimeType:((a=r.file)==null?void 0:a.mimeType)??"",url:r.webUrl??"",syntheticExtension:null,o365DriveId:n.parentReference.driveId}}function r2(n,e,t,s){return async function(r){const o=r.data;if(o.type==="notification"||o.type!=="command")return;const a=o.data;switch(t.postMessage({type:"acknowledge",id:r.data.id}),a.command){case"authenticate":{s===Se.O365_BUSINESS&&(n=await Up.getState().getToken(s,`${a.resource}/.default`)),t.postMessage({type:"result",id:r.data.id,data:{result:"token",token:n}});break}case"close":{e(null);break}case"pick":{try{e(a.items),t.postMessage({type:"result",id:r.data.id,data:{result:"success"}})}catch(l){t.postMessage({type:"result",id:r.data.id,data:{result:"error",error:{code:"unusableItem",message:l.message}}})}break}default:{t.postMessage({type:"result",id:r.data.id,data:{result:"error",error:{code:"unsupportedCommand",message:a.command}}});break}}}}const o2=co.memo(function({type:e,onClose:t,uploadPickedFile:s}){const{connectorConfig:i}=Xa(),r=e?i.get(e):null;return!(r!=null&&r.onedrive_endpoint_hint)||!r.access_token?null:c.jsx(a2,{onClose:t,accessToken:r==null?void 0:r.access_token,oneDriveURL:r==null?void 0:r.onedrive_endpoint_hint,uploadPickedFile:s})});function a2({onClose:n,accessToken:e,oneDriveURL:t,uploadPickedFile:s}){const i=k.useRef(null),{current:r}=k.useRef(new WeakMap),o=t.type==="personal"?Se.O365_PERSONAL:Se.O365_BUSINESS;return k.useEffect(()=>{const{current:a}=i,l=a==null?void 0:a.contentWindow;if(a==null||l==null||r.has(a))return;r.set(a,!0);const d=dr();Rt.filePickerStarted(o),t2(l,e,t,d),s2(e,l,d,u=>{switch(u.type){case"pick":Rt.filePickerPicked(o,u.docs.length),u.docs.forEach(f=>s(f,o));break;case"cancel":Rt.filePickerCancelled(o);break}n()},t,o)},[o,e,t,s,n,r]),c.jsx($x,{defaultOpen:!0,onOpenChange:a=>{a||n()},children:c.jsx(Wx,{children:c.jsx(Hx,{className:"fixed inset-0 flex items-center justify-center bg-black/50 dark:bg-black/80",children:c.jsx(qx,{className:"flex h-full max-h-[600px] w-full max-w-[1300px] items-center justify-center",onPointerDownOutside:()=>{Rt.filePickerCancelled(o)},children:c.jsx("iframe",{className:"mx-[32px] my-[32px] h-full w-full",src:"about:blank",ref:i})})})})})}let El=null;function gg(n){return El==null&&(El=l2().then(()=>(gapi.client.setToken({access_token:n}),gapi.client.init({apiKey:zp,scope:"https://www.googleapis.com/auth/drive.file",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]})))),El}function l2(){return new Promise((n,e)=>{const t=document.createElement("script");t.src="https://apis.google.com/js/api.js",t.onload=n,t.onerror=e,document.documentElement.appendChild(t)}).then(()=>Promise.all([new Promise(n=>gapi.load("client",n)),new Promise(n=>gapi.load("client:picker",n))]))}function ff({entry:n,onClick:e}){const{connectorConfig:t}=Xa();k.useEffect(()=>{if(!open||n.type!==Se.GDRIVE)return;const o=t.get(Se.GDRIVE),a=o==null?void 0:o.access_token;a&&gg(a)},[t,n.type]);const s=Vp(n.type),i=ye(),r=n.access_token?hf.uploadFromMessage:hf.signinWithMessage;return c.jsx(Oe.Item,{onClick:e,icon:s,children:c.jsxs("div",{className:"flex flex-col",children:[c.jsx(j,{...r,values:{connectorName:Qa(n.type,i)}}),n.type===Se.O365_BUSINESS&&c.jsx("div",{className:"text-s text-token-text-tertiary",children:c.jsx(j,{...Od.includesSharePoint})})]})},n.id)}const hf=Ce({signinWithMessage:{id:"ContextConnectorPickerDropdownItem.signInWithMessage",defaultMessage:"Connect to {connectorName}"},uploadFromMessage:{id:"ContextConnectorPickerDropdownItem.uploadWithMessage",defaultMessage:"Add from {connectorName}"}});function c2({clientThreadId:n,icon:e,setOpen:t}){const s=id(),i=!!s,r=ye();return c.jsxs(c.Fragment,{children:[c.jsx(Oe.Trigger,{className:"m-0 h-0 w-0 border-none bg-transparent p-0"}),c.jsx(sg,{clientThreadId:n,rateLimitPopup:s,children:c.jsx(Lp,{className:"mb-1 ml-1.5","aria-disabled":i,"aria-label":r.formatMessage({id:"tA7CXR",defaultMessage:"Attach files"}),onClick:o=>{o.preventDefault(),i||t(!0)},children:e})})]})}function d2({connectorEntries:n,onOauthRedirect:e}){const t=ye();return c.jsxs(Oe.Sub,{children:[c.jsx(Oe.SubMenuTrigger,{icon:Fw,children:c.jsx("div",{className:"line-clamp-1 text-ellipsis",children:c.jsx(j,{...u2.connectApps})})}),c.jsx(Oe.Portal,{children:c.jsx(Oe.SubContent,{children:n.map(s=>c.jsx(Oe.Item,{onClick:()=>e(s),icon:Vp(s.type),children:c.jsxs("div",{className:"flex flex-col",children:[Qa(s.type,t),s.type===Se.O365_BUSINESS&&c.jsx("div",{className:"text-s text-token-text-tertiary",children:c.jsx(j,{...Od.includesSharePoint})})]})},s.id))})})]})}const u2=Ce({connectApps:{id:"ContextConnectorPicker.connectApps",defaultMessage:"Connect apps"}});function f2({onOauthRedirect:n,connectors:e}){const t=ye();return c.jsxs(Oe.Sub,{children:[c.jsx(Oe.SubMenuTrigger,{icon:Lw,children:c.jsx(j,{...h2.oneDriveSubmenuName})}),c.jsx(Oe.Portal,{children:c.jsx(Oe.SubContent,{children:e.map(s=>s?c.jsx(Oe.Item,{onClick:()=>n(s),children:c.jsxs("div",{className:"flex flex-col",children:[Qa(s.type,t),s.type===Se.O365_BUSINESS&&c.jsx("div",{className:"text-s text-token-text-tertiary",children:c.jsx(j,{...Od.includesSharePoint})})]})},s.id):null)})})]})}const h2=Ce({oneDriveSubmenuName:{id:"ContextConnectorPickerOneDriveSubmenu.oneDriveSubmenuName",defaultMessage:"Connect to Microsoft OneDrive"}});async function p2(n,e,t,s){await gg(t);async function i(u){switch(u.action){case google.picker.Action.PICKED:{Rt.filePickerPicked(Se.GDRIVE,u.docs.length);const f=u.docs.map(h=>({connector:e,id:h.id,title:h.name,mimeType:h.mimeType,url:h.url,syntheticExtension:h.type==="document"?Np(h.mimeType):null}));s(f);break}case google.picker.Action.CANCEL:Rt.filePickerCancelled(Se.GDRIVE);return;case"loaded":{Rt.filePickerLoaded(Se.GDRIVE);return}}}const r=new google.picker.DocsView(google.picker.ViewId.DOCS).setIncludeFolders(!0).setSelectFolderEnabled(!1).setMode(google.picker.DocsViewMode.LIST);let o="en";pf.includes(n)?o=n:pf.includes(n.split("-")[0])&&(o=n.split("-")[0]);const a=new google.picker.PickerBuilder().enableFeature(google.picker.Feature.MULTISELECT_ENABLED).enableFeature(google.picker.Feature.SUPPORT_DRIVES).setDeveloperKey(zp).setAppId(ek).setOAuthToken(t).addView(r).setCallback(i).setLocale(o).build();Rt.filePickerStarted(Se.GDRIVE),a.setVisible(!0);const l=m2(),d=()=>{Rt.filePickerCancelled(Se.GDRIVE),a.setVisible(!1),l==null||l.removeEventListener("click",d)};l==null||l.addEventListener("click",d)}function m2(){if(typeof window>"u")return null;const n=window.document.body.querySelector("div.picker-dialog-bg")??window.document.body.querySelector("div.oai-picker-dialog-bg");return n==null||n.classList.add("oai-picker-dialog-bg","bg-black/50","dark:bg-black/80","absolute","inset-0","z-[1000]"),n==null||n.classList.remove("picker-dialog-bg"),n}const pf=["af","am","ar","bg","bn","ca","cs","da","de","el","en","en-GB","es","es-419","et","eu","fa","fi","fil","fr","fr-CA","gl","gu","hi","hr","hu","id","is","it","iw","ja","kn","ko","lt","lv","ml","mr","ms","nl","no","pl","pt-BR","pt-PT","ro","ru","sk","sl","sr","sv","sw","ta","te","th","tr","uk","ur","vi","zh-CN","zh-HK","zh-TW","zu"];var g2=wv,x2=g2(function(n,e,t){n[t?0:1].push(e)},function(){return[[],[]]}),y2=x2;const wa=Oa(y2);function b2(){const{connectorConfig:n}=Xa(),e=uo(),[t,s]=wa(_m([...n.values()],d=>!!d.access_token),d=>!!d.access_token),[i,r]=wa(s,d=>d.type===Se.O365_PERSONAL||d.type===Se.O365_BUSINESS),o=!e&&t.length>0,a=!e&&!o&&i.length>1;return{unconnectedConnectors:a?r:s,showUnconnectedInSubmenu:o,showOneDriveInSubmenu:a}}function k2({clientThreadId:n,icon:e,modelAcceptedMimeTypes:t,modelSupportedImageMimeTypes:s,attachmentsProductFeature:i,onOauthRedirect:r,uploadType:o,getInputProps:a,openFileDialog:l}){const{currentLocale:d}=Kx(),u=ye(),f=uo(),{connectorConfig:h,isLoading:g}=Xa(),x=Mi(Ws.ContextConnectors),{getGizmoId:y}=gr(),[w,S]=k.useState();k.useEffect(()=>{y?y().then(q=>S(q)):S(void 0)},[y]);const _=k.useRef(null),[O,T]=k.useState(!1),E=k.useRef(!1),R=k.useCallback(()=>{var Z;const q=(Z=_.current)==null?void 0:Z.files;Array.from(q??[]).forEach(Me=>Ir.uploadFile(Me,s,u,i))},[s,i,u]),[F,D]=k.useState(null),I=k.useCallback(()=>D(null),[D]),$=k.useCallback((q,Z)=>Ir.uploadPickedFile(q,Z,s,t,i,w,u),[s,t,i,w,u]),{openMenu:B,confirmMenuOpened:U}=ua();k.useEffect(()=>{B&&(T(!0),U())},[B,U,T]);const V=vi(),Y=k.useCallback(q=>{Ir.doContextConnectorOauthRedirect(V.asPath,q,r,ms.Picker),r()},[r,V.asPath]),te=k.useCallback(q=>{Ir.uploadPickedFile(q,Se.GDRIVE,s,t,i,w,u)},[s,t,i,w,u]),ne=k.useCallback(async q=>{const{access_token:Z}=q;if(!Z){Y(q);return}switch(Vd(q,ms.Picker),q.type){case Se.GDRIVE:p2(d,q.type,Z,Me=>Me.forEach(te));break;case Se.O365_PERSONAL:case Se.O365_BUSINESS:D(q.type);break}},[te,Y,D,d]),pe=()=>{W.logEvent(G.openFileViewer,{intent:o.toString()}),l()},H=q=>{if(!q&&E.current&&!g)pe();else if(q&&me&&!g){pe();return}T(q),q&&(x.eligible&&x.markAsViewed(),W.logEvent(G.composerOpenContextConnectorPicker),E.current=!0,setTimeout(()=>{E.current=!1},250))},[L,ue]=wa(_m([...h.values()],q=>!!q.access_token),q=>!!q.access_token);w2(L,ne);const[le]=wa(ue,q=>q.type===Se.O365_PERSONAL||q.type===Se.O365_BUSINESS),{unconnectedConnectors:Q,showUnconnectedInSubmenu:Ge,showOneDriveInSubmenu:ze}=b2(),me=!L.length&&!Q.length,we=c.jsxs(c.Fragment,{children:[Ge&&Q.length>0&&c.jsx(d2,{connectorEntries:Q,onOauthRedirect:q=>Y(q)}),!Ge&&Q.map(q=>c.jsx(ff,{entry:q,onClick:()=>ne(q)},q.id)),ze&&c.jsx(f2,{connectors:le,onOauthRedirect:Y}),g&&c.jsx(Oe.Item,{icon:c.jsx(Fa,{className:"text-token-text-secondary"})}),(Q.length>0||g)&&c.jsx(Oe.Separator,{}),L.map(q=>c.jsx(ff,{entry:q,onClick:()=>ne(q)},q.id)),c.jsx(Oe.Item,{onClick:pe,icon:mm,children:c.jsx(j,{...f?mf.uploadFileMobile:mf.uploadFile})},"upload")]}),Fe=c.jsxs("div",{className:"flex flex-col",children:[c.jsx(o2,{type:F,onClose:I,uploadPickedFile:$}),c.jsx("input",{onChange:R,...a({className:"hidden"})}),c.jsxs(Oe.Root,{open:O,onOpenChange:H,children:[c.jsx(c2,{clientThreadId:n,icon:e,setOpen:H}),c.jsx(Oe.Portal,{children:c.jsx(Oe.Content,{size:"large",children:we})})]}),c.jsx(e2,{hasConnectors:!g&&!me})]});return{dropdownItems:we,mainComponent:Fe}}function w2(n,e){const{connector:t,clearParam:s}=tk(),i=n.find(r=>r.type===t&&!!r.access_token);k.useEffect(()=>{i&&(e(i),s())},[i,e,s])}function v2(n){const{mainComponent:e}=k2(n);return e}const mf=Ce({attachFiles:{id:"ContextConnectorPicker.attachFiles",defaultMessage:"Attach files"},uploadFile:{id:"LocalFileDropdownItem.uploadFile",defaultMessage:"Upload from computer"},uploadFileMobile:{id:"LocalFileDropdownItem.uploadFileMobile",defaultMessage:"Upload file"}});function S2({clientThreadId:n,uploadType:e,modelAcceptedMimeTypes:t,modelSupportedImageMimeTypes:s,attachmentsProductFeature:i,getInputProps:r,openFileDialog:o,onOauthRedirect:a,historyDisabled:l,className:d,highlightTooltip:u}){const{gdriveStatus:f,o365Status:h}=ym(),g=c.jsx(Bw,{className:l?"text-white":u?"text-brand-blue-800":void 0}),[x,y]=k.useState(!1),w=ye();return c.jsxs("div",{className:J("relative",d),children:[c.jsx(bs,{sideOffset:14,label:w.formatMessage({id:"oUK/GV",defaultMessage:"Attach file"}),className:"flex",onOpenChange:y,open:!!(x||u),side:"top",children:f!=="false"||h!=="false"?c.jsx(v2,{clientThreadId:n,icon:g,modelAcceptedMimeTypes:t,modelSupportedImageMimeTypes:s,attachmentsProductFeature:i,onOauthRedirect:a,uploadType:e,openFileDialog:o,getInputProps:r}):c.jsx(xT,{clientThreadId:n,uploadType:e,openFileDialog:o,getInputProps:r,icon:g})}),u&&c.jsx(yt.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:"pointer-events-none absolute bottom-1 left-1.5 h-8 w-8 rounded-full bg-brand-blue-800/20"})]})}function xg(n,e,t){for(let s=0;;s++){if(s==n.childCount||s==e.childCount)return n.childCount==e.childCount?null:t;let i=n.child(s),r=e.child(s);if(i==r){t+=i.nodeSize;continue}if(!i.sameMarkup(r))return t;if(i.isText&&i.text!=r.text){for(let o=0;i.text[o]==r.text[o];o++)t++;return t}if(i.content.size||r.content.size){let o=xg(i.content,r.content,t+1);if(o!=null)return o}t+=i.nodeSize}}function yg(n,e,t,s){for(let i=n.childCount,r=e.childCount;;){if(i==0||r==0)return i==r?null:{a:t,b:s};let o=n.child(--i),a=e.child(--r),l=o.nodeSize;if(o==a){t-=l,s-=l;continue}if(!o.sameMarkup(a))return{a:t,b:s};if(o.isText&&o.text!=a.text){let d=0,u=Math.min(o.text.length,a.text.length);for(;d<u&&o.text[o.text.length-d-1]==a.text[a.text.length-d-1];)d++,t--,s--;return{a:t,b:s}}if(o.content.size||a.content.size){let d=yg(o.content,a.content,t-1,s-1);if(d)return d}t-=l,s-=l}}class K{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let s=0;s<e.length;s++)this.size+=e[s].nodeSize}nodesBetween(e,t,s,i=0,r){for(let o=0,a=0;a<t;o++){let l=this.content[o],d=a+l.nodeSize;if(d>e&&s(l,i+a,r||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,t-u),s,i+u)}a=d}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,s,i){let r="",o=!0;return this.nodesBetween(e,t,(a,l)=>{let d=a.isText?a.text.slice(Math.max(e,l)-l,t-l):a.isLeaf?i?typeof i=="function"?i(a):i:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&d||a.isTextblock)&&s&&(o?o=!1:r+=s),r+=d},0),r}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,s=e.firstChild,i=this.content.slice(),r=0;for(t.isText&&t.sameMarkup(s)&&(i[i.length-1]=t.withText(t.text+s.text),r=1);r<e.content.length;r++)i.push(e.content[r]);return new K(i,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let s=[],i=0;if(t>e)for(let r=0,o=0;o<t;r++){let a=this.content[r],l=o+a.nodeSize;l>e&&((o<e||l>t)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,t-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,t-o-1))),s.push(a),i+=a.nodeSize),o=l}return new K(s,i)}cutByIndex(e,t){return e==t?K.empty:e==0&&t==this.content.length?this:new K(this.content.slice(e,t))}replaceChild(e,t){let s=this.content[e];if(s==t)return this;let i=this.content.slice(),r=this.size+t.nodeSize-s.nodeSize;return i[e]=t,new K(i,r)}addToStart(e){return new K([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new K(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,s=0;t<this.content.length;t++){let i=this.content[t];e(i,s,t),s+=i.nodeSize}}findDiffStart(e,t=0){return xg(this,e,t)}findDiffEnd(e,t=this.size,s=e.size){return yg(this,e,t,s)}findIndex(e,t=-1){if(e==0)return Po(0,e);if(e==this.size)return Po(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let s=0,i=0;;s++){let r=this.child(s),o=i+r.nodeSize;if(o>=e)return o==e||t>0?Po(s+1,o):Po(s,i);i=o}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return K.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new K(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return K.empty;let t,s=0;for(let i=0;i<e.length;i++){let r=e[i];s+=r.nodeSize,i&&r.isText&&e[i-1].sameMarkup(r)?(t||(t=e.slice(0,i)),t[t.length-1]=r.withText(t[t.length-1].text+r.text)):t&&t.push(r)}return new K(t||e,s)}static from(e){if(!e)return K.empty;if(e instanceof K)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new K([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}K.empty=new K([],0);const _l={index:0,offset:0};function Po(n,e){return _l.index=n,_l.offset=e,_l}function va(n,e){if(n===e)return!0;if(!(n&&typeof n=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(n);if(Array.isArray(e)!=t)return!1;if(t){if(n.length!=e.length)return!1;for(let s=0;s<n.length;s++)if(!va(n[s],e[s]))return!1}else{for(let s in n)if(!(s in e)||!va(n[s],e[s]))return!1;for(let s in e)if(!(s in n))return!1}return!0}class Be{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,s=!1;for(let i=0;i<e.length;i++){let r=e[i];if(this.eq(r))return e;if(this.type.excludes(r.type))t||(t=e.slice(0,i));else{if(r.type.excludes(this.type))return e;!s&&r.type.rank>this.type.rank&&(t||(t=e.slice(0,i)),t.push(this),s=!0),t&&t.push(r)}}return t||(t=e.slice()),s||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&va(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let s=e.marks[t.type];if(!s)throw new RangeError(`There is no mark type ${t.type} in this schema`);let i=s.create(t.attrs);return s.checkAttrs(i.attrs),i}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let s=0;s<e.length;s++)if(!e[s].eq(t[s]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return Be.none;if(e instanceof Be)return[e];let t=e.slice();return t.sort((s,i)=>s.type.rank-i.type.rank),t}}Be.none=[];class Sa extends Error{}class ie{constructor(e,t,s){this.content=e,this.openStart=t,this.openEnd=s}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let s=kg(this.content,e+this.openStart,t);return s&&new ie(s,this.openStart,this.openEnd)}removeBetween(e,t){return new ie(bg(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return ie.empty;let s=t.openStart||0,i=t.openEnd||0;if(typeof s!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new ie(K.fromJSON(e,t.content),s,i)}static maxOpen(e,t=!0){let s=0,i=0;for(let r=e.firstChild;r&&!r.isLeaf&&(t||!r.type.spec.isolating);r=r.firstChild)s++;for(let r=e.lastChild;r&&!r.isLeaf&&(t||!r.type.spec.isolating);r=r.lastChild)i++;return new ie(e,s,i)}}ie.empty=new ie(K.empty,0,0);function bg(n,e,t){let{index:s,offset:i}=n.findIndex(e),r=n.maybeChild(s),{index:o,offset:a}=n.findIndex(t);if(i==e||r.isText){if(a!=t&&!n.child(o).isText)throw new RangeError("Removing non-flat range");return n.cut(0,e).append(n.cut(t))}if(s!=o)throw new RangeError("Removing non-flat range");return n.replaceChild(s,r.copy(bg(r.content,e-i-1,t-i-1)))}function kg(n,e,t,s){let{index:i,offset:r}=n.findIndex(e),o=n.maybeChild(i);if(r==e||o.isText)return n.cut(0,e).append(t).append(n.cut(e));let a=kg(o.content,e-r-1,t);return a&&n.replaceChild(i,o.copy(a))}function C2(n,e,t){if(t.openStart>n.depth)throw new Sa("Inserted content deeper than insertion position");if(n.depth-t.openStart!=e.depth-t.openEnd)throw new Sa("Inconsistent open depths");return wg(n,e,t,0)}function wg(n,e,t,s){let i=n.index(s),r=n.node(s);if(i==e.index(s)&&s<n.depth-t.openStart){let o=wg(n,e,t,s+1);return r.copy(r.content.replaceChild(i,o))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&n.depth==s&&e.depth==s){let o=n.parent,a=o.content;return ui(o,a.cut(0,n.parentOffset).append(t.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=M2(t,n);return ui(r,Sg(n,o,a,e,s))}else return ui(r,Ca(n,e,s))}function vg(n,e){if(!e.type.compatibleContent(n.type))throw new Sa("Cannot join "+e.type.name+" onto "+n.type.name)}function Sc(n,e,t){let s=n.node(t);return vg(s,e.node(t)),s}function di(n,e){let t=e.length-1;t>=0&&n.isText&&n.sameMarkup(e[t])?e[t]=n.withText(e[t].text+n.text):e.push(n)}function Br(n,e,t,s){let i=(e||n).node(t),r=0,o=e?e.index(t):i.childCount;n&&(r=n.index(t),n.depth>t?r++:n.textOffset&&(di(n.nodeAfter,s),r++));for(let a=r;a<o;a++)di(i.child(a),s);e&&e.depth==t&&e.textOffset&&di(e.nodeBefore,s)}function ui(n,e){return n.type.checkContent(e),n.copy(e)}function Sg(n,e,t,s,i){let r=n.depth>i&&Sc(n,e,i+1),o=s.depth>i&&Sc(t,s,i+1),a=[];return Br(null,n,i,a),r&&o&&e.index(i)==t.index(i)?(vg(r,o),di(ui(r,Sg(n,e,t,s,i+1)),a)):(r&&di(ui(r,Ca(n,e,i+1)),a),Br(e,t,i,a),o&&di(ui(o,Ca(t,s,i+1)),a)),Br(s,null,i,a),new K(a)}function Ca(n,e,t){let s=[];if(Br(null,n,t,s),n.depth>t){let i=Sc(n,e,t+1);di(ui(i,Ca(n,e,t+1)),s)}return Br(e,null,t,s),new K(s)}function M2(n,e){let t=e.depth-n.openStart,i=e.node(t).copy(n.content);for(let r=t-1;r>=0;r--)i=e.node(r).copy(K.from(i));return{start:i.resolveNoCache(n.openStart+t),end:i.resolveNoCache(i.content.size-n.openEnd-t)}}class Yr{constructor(e,t,s){this.pos=e,this.path=t,this.parentOffset=s,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let s=this.pos-this.path[this.path.length-1],i=e.child(t);return s?e.child(t).cut(s):i}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let s=this.path[t*3],i=t==0?0:this.path[t*3-1]+1;for(let r=0;r<e;r++)i+=s.child(r).nodeSize;return i}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return Be.none;if(this.textOffset)return e.child(t).marks;let s=e.maybeChild(t-1),i=e.maybeChild(t);if(!s){let a=s;s=i,i=a}let r=s.marks;for(var o=0;o<r.length;o++)r[o].type.spec.inclusive===!1&&(!i||!r[o].isInSet(i.marks))&&(r=r[o--].removeFromSet(r));return r}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let s=t.marks,i=e.parent.maybeChild(e.index());for(var r=0;r<s.length;r++)s[r].type.spec.inclusive===!1&&(!i||!s[r].isInSet(i.marks))&&(s=s[r--].removeFromSet(s));return s}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let s=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);s>=0;s--)if(e.pos<=this.end(s)&&(!t||t(this.node(s))))return new _2(this,e,s);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let s=[],i=0,r=t;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(r),d=r-l;if(s.push(o,a,i+l),!d||(o=o.child(a),o.isText))break;r=d-1,i+=l+1}return new Yr(t,s,r)}static resolveCached(e,t){let s=gf.get(e);if(s)for(let r=0;r<s.elts.length;r++){let o=s.elts[r];if(o.pos==t)return o}else gf.set(e,s=new T2);let i=s.elts[s.i]=Yr.resolve(e,t);return s.i=(s.i+1)%E2,i}}class T2{constructor(){this.elts=[],this.i=0}}const E2=12,gf=new WeakMap;class _2{constructor(e,t,s){this.$from=e,this.$to=t,this.depth=s}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const A2=Object.create(null);class Yn{constructor(e,t,s,i=Be.none){this.type=e,this.attrs=t,this.marks=i,this.content=s||K.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,s,i=0){this.content.nodesBetween(e,t,s,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,s,i){return this.content.textBetween(e,t,s,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,s){return this.type==e&&va(this.attrs,t||e.defaultAttrs||A2)&&Be.sameSet(this.marks,s||Be.none)}copy(e=null){return e==this.content?this:new Yn(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new Yn(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,s=!1){if(e==t)return ie.empty;let i=this.resolve(e),r=this.resolve(t),o=s?0:i.sharedDepth(t),a=i.start(o),d=i.node(o).content.cut(i.pos-a,r.pos-a);return new ie(d,i.depth-o,r.depth-o)}replace(e,t,s){return C2(this.resolve(e),this.resolve(t),s)}nodeAt(e){for(let t=this;;){let{index:s,offset:i}=t.content.findIndex(e);if(t=t.maybeChild(s),!t)return null;if(i==e||t.isText)return t;e-=i+1}}childAfter(e){let{index:t,offset:s}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:s}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:s}=this.content.findIndex(e);if(s<e)return{node:this.content.child(t),index:t,offset:s};let i=this.content.child(t-1);return{node:i,index:t-1,offset:s-i.nodeSize}}resolve(e){return Yr.resolveCached(this,e)}resolveNoCache(e){return Yr.resolve(this,e)}rangeHasMark(e,t,s){let i=!1;return t>e&&this.nodesBetween(e,t,r=>(s.isInSet(r.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),Cg(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,s=K.empty,i=0,r=s.childCount){let o=this.contentMatchAt(e).matchFragment(s,i,r),a=o&&o.matchFragment(this.content,t);if(!a||!a.validEnd)return!1;for(let l=i;l<r;l++)if(!this.type.allowsMarks(s.child(l).marks))return!1;return!0}canReplaceWith(e,t,s,i){if(i&&!this.type.allowsMarks(i))return!1;let r=this.contentMatchAt(e).matchType(s),o=r&&r.matchFragment(this.content,t);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=Be.none;for(let t=0;t<this.marks.length;t++){let s=this.marks[t];s.type.checkAttrs(s.attrs),e=s.addToSet(e)}if(!Be.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let s;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");s=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,s)}let i=K.fromJSON(e,t.content),r=e.nodeType(t.type).create(t.attrs,i,s);return r.type.checkAttrs(r.attrs),r}}Yn.prototype.text=void 0;class Ma extends Yn{constructor(e,t,s,i){if(super(e,t,null,i),!s)throw new RangeError("Empty text nodes are not allowed");this.text=s}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Cg(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new Ma(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new Ma(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function Cg(n,e){for(let t=n.length-1;t>=0;t--)e=n[t].type.name+"("+e+")";return e}class bi{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let s=new N2(e,t);if(s.next==null)return bi.empty;let i=Mg(s);s.next&&s.err("Unexpected trailing text");let r=F2(O2(i));return L2(r,s),r}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,s=e.childCount){let i=this;for(let r=t;i&&r<s;r++)i=i.matchType(e.child(r).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let s=0;s<e.next.length;s++)if(this.next[t].type==e.next[s].type)return!0;return!1}fillBefore(e,t=!1,s=0){let i=[this];function r(o,a){let l=o.matchFragment(e,s);if(l&&(!t||l.validEnd))return K.from(a.map(d=>d.createAndFill()));for(let d=0;d<o.next.length;d++){let{type:u,next:f}=o.next[d];if(!(u.isText||u.hasRequiredAttrs())&&i.indexOf(f)==-1){i.push(f);let h=r(f,a.concat(u));if(h)return h}}return null}return r(this,[])}findWrapping(e){for(let s=0;s<this.wrapCache.length;s+=2)if(this.wrapCache[s]==e)return this.wrapCache[s+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),s=[{match:this,type:null,via:null}];for(;s.length;){let i=s.shift(),r=i.match;if(r.matchType(e)){let o=[];for(let a=i;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<r.next.length;o++){let{type:a,next:l}=r.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in t)&&(!i.type||l.validEnd)&&(s.push({match:a.contentMatch,type:a,via:i}),t[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(s){e.push(s);for(let i=0;i<s.next.length;i++)e.indexOf(s.next[i].next)==-1&&t(s.next[i].next)}return t(this),e.map((s,i)=>{let r=i+(s.validEnd?"*":" ")+" ";for(let o=0;o<s.next.length;o++)r+=(o?", ":"")+s.next[o].type.name+"->"+e.indexOf(s.next[o].next);return r}).join(`
`)}}bi.empty=new bi(!0);class N2{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function Mg(n){let e=[];do e.push(I2(n));while(n.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function I2(n){let e=[];do e.push(R2(n));while(n.next&&n.next!=")"&&n.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function R2(n){let e=P2(n);for(;;)if(n.eat("+"))e={type:"plus",expr:e};else if(n.eat("*"))e={type:"star",expr:e};else if(n.eat("?"))e={type:"opt",expr:e};else if(n.eat("{"))e=D2(n,e);else break;return e}function xf(n){/\D/.test(n.next)&&n.err("Expected number, got '"+n.next+"'");let e=Number(n.next);return n.pos++,e}function D2(n,e){let t=xf(n),s=t;return n.eat(",")&&(n.next!="}"?s=xf(n):s=-1),n.eat("}")||n.err("Unclosed braced range"),{type:"range",min:t,max:s,expr:e}}function j2(n,e){let t=n.nodeTypes,s=t[e];if(s)return[s];let i=[];for(let r in t){let o=t[r];o.groups.indexOf(e)>-1&&i.push(o)}return i.length==0&&n.err("No node type or group '"+e+"' found"),i}function P2(n){if(n.eat("(")){let e=Mg(n);return n.eat(")")||n.err("Missing closing paren"),e}else if(/\W/.test(n.next))n.err("Unexpected token '"+n.next+"'");else{let e=j2(n,n.next).map(t=>(n.inline==null?n.inline=t.isInline:n.inline!=t.isInline&&n.err("Mixing inline and block content"),{type:"name",value:t}));return n.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function O2(n){let e=[[]];return i(r(n,0),t()),e;function t(){return e.push([])-1}function s(o,a,l){let d={term:l,to:a};return e[o].push(d),d}function i(o,a){o.forEach(l=>l.to=a)}function r(o,a){if(o.type=="choice")return o.exprs.reduce((l,d)=>l.concat(r(d,a)),[]);if(o.type=="seq")for(let l=0;;l++){let d=r(o.exprs[l],a);if(l==o.exprs.length-1)return d;i(d,a=t())}else if(o.type=="star"){let l=t();return s(a,l),i(r(o.expr,l),l),[s(l)]}else if(o.type=="plus"){let l=t();return i(r(o.expr,a),l),i(r(o.expr,l),l),[s(l)]}else{if(o.type=="opt")return[s(a)].concat(r(o.expr,a));if(o.type=="range"){let l=a;for(let d=0;d<o.min;d++){let u=t();i(r(o.expr,l),u),l=u}if(o.max==-1)i(r(o.expr,l),l);else for(let d=o.min;d<o.max;d++){let u=t();s(l,u),i(r(o.expr,l),u),l=u}return[s(l)]}else{if(o.type=="name")return[s(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function Tg(n,e){return e-n}function yf(n,e){let t=[];return s(e),t.sort(Tg);function s(i){let r=n[i];if(r.length==1&&!r[0].term)return s(r[0].to);t.push(i);for(let o=0;o<r.length;o++){let{term:a,to:l}=r[o];!a&&t.indexOf(l)==-1&&s(l)}}}function F2(n){let e=Object.create(null);return t(yf(n,0));function t(s){let i=[];s.forEach(o=>{n[o].forEach(({term:a,to:l})=>{if(!a)return;let d;for(let u=0;u<i.length;u++)i[u][0]==a&&(d=i[u][1]);yf(n,l).forEach(u=>{d||i.push([a,d=[]]),d.indexOf(u)==-1&&d.push(u)})})});let r=e[s.join(",")]=new bi(s.indexOf(n.length-1)>-1);for(let o=0;o<i.length;o++){let a=i[o][1].sort(Tg);r.next.push({type:i[o][0],next:e[a.join(",")]||t(a)})}return r}}function L2(n,e){for(let t=0,s=[n];t<s.length;t++){let i=s[t],r=!i.validEnd,o=[];for(let a=0;a<i.next.length;a++){let{type:l,next:d}=i.next[a];o.push(l.name),r&&!(l.isText||l.hasRequiredAttrs())&&(r=!1),s.indexOf(d)==-1&&s.push(d)}r&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function Eg(n){let e=Object.create(null);for(let t in n){let s=n[t];if(!s.hasDefault)return null;e[t]=s.default}return e}function _g(n,e){let t=Object.create(null);for(let s in n){let i=e&&e[s];if(i===void 0){let r=n[s];if(r.hasDefault)i=r.default;else throw new RangeError("No value supplied for attribute "+s)}t[s]=i}return t}function Ag(n,e,t,s){for(let i in e)if(!(i in n))throw new RangeError(`Unsupported attribute ${i} for ${t} of type ${i}`);for(let i in n){let r=n[i];r.validate&&r.validate(e[i])}}function Ng(n,e){let t=Object.create(null);if(e)for(let s in e)t[s]=new U2(n,s,e[s]);return t}let bf=class Ig{constructor(e,t,s){this.name=e,this.schema=t,this.spec=s,this.markSet=null,this.groups=s.group?s.group.split(" "):[],this.attrs=Ng(e,s.attrs),this.defaultAttrs=Eg(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(s.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==bi.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:_g(this.attrs,e)}create(e=null,t,s){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Yn(this,this.computeAttrs(e),K.from(t),Be.setFrom(s))}createChecked(e=null,t,s){return t=K.from(t),this.checkContent(t),new Yn(this,this.computeAttrs(e),t,Be.setFrom(s))}createAndFill(e=null,t,s){if(e=this.computeAttrs(e),t=K.from(t),t.size){let o=this.contentMatch.fillBefore(t);if(!o)return null;t=o.append(t)}let i=this.contentMatch.matchFragment(t),r=i&&i.fillBefore(K.empty,!0);return r?new Yn(this,e,t.append(r),Be.setFrom(s)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let s=0;s<e.childCount;s++)if(!this.allowsMarks(e.child(s).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){Ag(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let s=0;s<e.length;s++)this.allowsMarkType(e[s].type)?t&&t.push(e[s]):t||(t=e.slice(0,s));return t?t.length?t:Be.none:e}static compile(e,t){let s=Object.create(null);e.forEach((r,o)=>s[r]=new Ig(r,t,o));let i=t.spec.topNode||"doc";if(!s[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!s.text)throw new RangeError("Every schema needs a 'text' type");for(let r in s.text.attrs)throw new RangeError("The text node type should not have attributes");return s}};function B2(n,e,t){let s=t.split("|");return i=>{let r=i===null?"null":typeof i;if(s.indexOf(r)<0)throw new RangeError(`Expected value of type ${s} for attribute ${e} on type ${n}, got ${r}`)}}class U2{constructor(e,t,s){this.hasDefault=Object.prototype.hasOwnProperty.call(s,"default"),this.default=s.default,this.validate=typeof s.validate=="string"?B2(e,t,s.validate):s.validate}get isRequired(){return!this.hasDefault}}class tl{constructor(e,t,s,i){this.name=e,this.rank=t,this.schema=s,this.spec=i,this.attrs=Ng(e,i.attrs),this.excluded=null;let r=Eg(this.attrs);this.instance=r?new Be(this,r):null}create(e=null){return!e&&this.instance?this.instance:new Be(this,_g(this.attrs,e))}static compile(e,t){let s=Object.create(null),i=0;return e.forEach((r,o)=>s[r]=new tl(r,i++,t,o)),s}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){Ag(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class z2{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let i in e)t[i]=e[i];t.nodes=Du.from(e.nodes),t.marks=Du.from(e.marks||{}),this.nodes=bf.compile(this.spec.nodes,this),this.marks=tl.compile(this.spec.marks,this);let s=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let r=this.nodes[i],o=r.spec.content||"",a=r.spec.marks;if(r.contentMatch=s[o]||(s[o]=bi.parse(o,this.nodes)),r.inlineContent=r.contentMatch.inlineContent,r.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!r.isInline||!r.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=r}r.markSet=a=="_"?null:a?kf(this,a.split(" ")):a==""||!r.inlineContent?[]:null}for(let i in this.marks){let r=this.marks[i],o=r.spec.excludes;r.excluded=o==null?[r]:o==""?[]:kf(this,o.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,s,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof bf){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,s,i)}text(e,t){let s=this.nodes.text;return new Ma(s,s.defaultAttrs,e,Be.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeFromJSON(e){return Yn.fromJSON(this,e)}markFromJSON(e){return Be.fromJSON(this,e)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}}function kf(n,e){let t=[];for(let s=0;s<e.length;s++){let i=e[s],r=n.marks[i],o=r;if(r)t.push(r);else for(let a in n.marks){let l=n.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&t.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[s]+"'")}return t}function V2(n){return n.tag!=null}function G2(n){return n.style!=null}class Xr{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let s=this.matchedStyles=[];t.forEach(i=>{if(V2(i))this.tags.push(i);else if(G2(i)){let r=/[^=]*/.exec(i.style)[0];s.indexOf(r)<0&&s.push(r),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let r=e.nodes[i.node];return r.contentMatch.matchType(r)})}parse(e,t={}){let s=new vf(this,t,!1);return s.addAll(e,t.from,t.to),s.finish()}parseSlice(e,t={}){let s=new vf(this,t,!0);return s.addAll(e,t.from,t.to),ie.maxOpen(s.finish())}matchTag(e,t,s){for(let i=s?this.tags.indexOf(s)+1:0;i<this.tags.length;i++){let r=this.tags[i];if(H2(e,r.tag)&&(r.namespace===void 0||e.namespaceURI==r.namespace)&&(!r.context||t.matchesContext(r.context))){if(r.getAttrs){let o=r.getAttrs(e);if(o===!1)continue;r.attrs=o||void 0}return r}}}matchStyle(e,t,s,i){for(let r=i?this.styles.indexOf(i)+1:0;r<this.styles.length;r++){let o=this.styles[r],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!s.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=t))){if(o.getAttrs){let l=o.getAttrs(t);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let t=[];function s(i){let r=i.priority==null?50:i.priority,o=0;for(;o<t.length;o++){let a=t[o];if((a.priority==null?50:a.priority)<r)break}t.splice(o,0,i)}for(let i in e.marks){let r=e.marks[i].spec.parseDOM;r&&r.forEach(o=>{s(o=Sf(o)),o.mark||o.ignore||o.clearMark||(o.mark=i)})}for(let i in e.nodes){let r=e.nodes[i].spec.parseDOM;r&&r.forEach(o=>{s(o=Sf(o)),o.node||o.ignore||o.mark||(o.node=i)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Xr(e,Xr.schemaRules(e)))}}const Rg={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},$2={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Dg={ol:!0,ul:!0},Ta=1,Ea=2,Ur=4;function wf(n,e,t){return e!=null?(e?Ta:0)|(e==="full"?Ea:0):n&&n.whitespace=="pre"?Ta|Ea:t&~Ur}class Oo{constructor(e,t,s,i,r,o,a){this.type=e,this.attrs=t,this.marks=s,this.pendingMarks=i,this.solid=r,this.options=a,this.content=[],this.activeMarks=Be.none,this.stashMarks=[],this.match=o||(a&Ur?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(K.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let s=this.type.contentMatch,i;return(i=s.findWrapping(e.type))?(this.match=s,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Ta)){let s=this.content[this.content.length-1],i;if(s&&s.isText&&(i=/[ \t\r\n\u000c]+$/.exec(s.text))){let r=s;s.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=r.withText(r.text.slice(0,r.text.length-i[0].length))}}let t=K.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(K.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}popFromStashMark(e){for(let t=this.stashMarks.length-1;t>=0;t--)if(e.eq(this.stashMarks[t]))return this.stashMarks.splice(t,1)[0]}applyPending(e){for(let t=0,s=this.pendingMarks;t<s.length;t++){let i=s[t];(this.type?this.type.allowsMarkType(i.type):q2(i.type,e))&&!i.isInSet(this.activeMarks)&&(this.activeMarks=i.addToSet(this.activeMarks),this.pendingMarks=i.removeFromSet(this.pendingMarks))}}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Rg.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class vf{constructor(e,t,s){this.parser=e,this.options=t,this.isOpen=s,this.open=0;let i=t.topNode,r,o=wf(null,t.preserveWhitespace,0)|(s?Ur:0);i?r=new Oo(i.type,i.attrs,Be.none,Be.none,!0,t.topMatch||i.type.contentMatch,o):s?r=new Oo(null,null,Be.none,Be.none,!0,null,o):r=new Oo(e.schema.topNodeType,null,Be.none,Be.none,!0,null,o),this.nodes=[r],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e){e.nodeType==3?this.addTextNode(e):e.nodeType==1&&this.addElement(e)}withStyleRules(e,t){let s=e.style;if(!s||!s.length)return t();let i=this.readStyles(e.style);if(!i)return;let[r,o]=i,a=this.top;for(let l=0;l<o.length;l++)this.removePendingMark(o[l],a);for(let l=0;l<r.length;l++)this.addPendingMark(r[l]);t();for(let l=0;l<r.length;l++)this.removePendingMark(r[l],a);for(let l=0;l<o.length;l++)this.addPendingMark(o[l])}addTextNode(e){let t=e.nodeValue,s=this.top;if(s.options&Ea||s.inlineContext(e)||/[^ \t\r\n\u000c]/.test(t)){if(s.options&Ta)s.options&Ea?t=t.replace(/\r\n?/g,`
`):t=t.replace(/\r?\n|\r/g," ");else if(t=t.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(t)&&this.open==this.nodes.length-1){let i=s.content[s.content.length-1],r=e.previousSibling;(!i||r&&r.nodeName=="BR"||i.isText&&/[ \t\r\n\u000c]$/.test(i.text))&&(t=t.slice(1))}t&&this.insertNode(this.parser.schema.text(t)),this.findInText(e)}else this.findInside(e)}addElement(e,t){let s=e.nodeName.toLowerCase(),i;Dg.hasOwnProperty(s)&&this.parser.normalizeLists&&W2(e);let r=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(i=this.parser.matchTag(e,this,t));if(r?r.ignore:$2.hasOwnProperty(s))this.findInside(e),this.ignoreFallback(e);else if(!r||r.skip||r.closeParent){r&&r.closeParent?this.open=Math.max(0,this.open-1):r&&r.skip.nodeType&&(e=r.skip);let o,a=this.top,l=this.needsBlock;if(Rg.hasOwnProperty(s))a.content.length&&a.content[0].isInline&&this.open&&(this.open--,a=this.top),o=!0,a.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e);return}r&&r.skip?this.addAll(e):this.withStyleRules(e,()=>this.addAll(e)),o&&this.sync(a),this.needsBlock=l}else this.withStyleRules(e,()=>{this.addElementByRule(e,r,r.consuming===!1?i:void 0)})}leafFallback(e){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`))}ignoreFallback(e){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))}readStyles(e){let t=Be.none,s=Be.none;if(e.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let r=this.parser.matchedStyles[i],o=e.getPropertyValue(r);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(r,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?this.top.pendingMarks.concat(this.top.activeMarks).forEach(d=>{l.clearMark(d)&&(s=d.addToSet(s))}):t=this.parser.schema.marks[l.mark].create(l.attrs).addToSet(t),l.consuming===!1)a=l;else break}}return[t,s]}addElementByRule(e,t,s){let i,r,o;t.node?(r=this.parser.schema.nodes[t.node],r.isLeaf?this.insertNode(r.create(t.attrs))||this.leafFallback(e):i=this.enter(r,t.attrs||null,t.preserveWhitespace)):(o=this.parser.schema.marks[t.mark].create(t.attrs),this.addPendingMark(o));let a=this.top;if(r&&r.isLeaf)this.findInside(e);else if(s)this.addElement(e,s);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l));else{let l=e;typeof t.contentElement=="string"?l=e.querySelector(t.contentElement):typeof t.contentElement=="function"?l=t.contentElement(e):t.contentElement&&(l=t.contentElement),this.findAround(e,l,!0),this.addAll(l)}i&&this.sync(a)&&this.open--,o&&this.removePendingMark(o,a)}addAll(e,t,s){let i=t||0;for(let r=t?e.childNodes[t]:e.firstChild,o=s==null?null:e.childNodes[s];r!=o;r=r.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(r);this.findAtPoint(e,i)}findPlace(e){let t,s;for(let i=this.open;i>=0;i--){let r=this.nodes[i],o=r.findWrapping(e);if(o&&(!t||t.length>o.length)&&(t=o,s=r,!o.length)||r.solid)break}if(!t)return!1;this.sync(s);for(let i=0;i<t.length;i++)this.enterInner(t[i],null,!1);return!0}insertNode(e){if(e.isInline&&this.needsBlock&&!this.top.type){let t=this.textblockFromContext();t&&this.enterInner(t)}if(this.findPlace(e)){this.closeExtra();let t=this.top;t.applyPending(e.type),t.match&&(t.match=t.match.matchType(e.type));let s=t.activeMarks;for(let i=0;i<e.marks.length;i++)(!t.type||t.type.allowsMarkType(e.marks[i].type))&&(s=e.marks[i].addToSet(s));return t.content.push(e.mark(s)),!0}return!1}enter(e,t,s){let i=this.findPlace(e.create(t));return i&&this.enterInner(e,t,!0,s),i}enterInner(e,t=null,s=!1,i){this.closeExtra();let r=this.top;r.applyPending(e),r.match=r.match&&r.match.matchType(e);let o=wf(e,i,r.options);r.options&Ur&&r.content.length==0&&(o|=Ur),this.nodes.push(new Oo(e,t,r.activeMarks,r.pendingMarks,s,null,o)),this.open++}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(e){for(let t=this.open;t>=0;t--)if(this.nodes[t]==e)return this.open=t,!0;return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let s=this.nodes[t].content;for(let i=s.length-1;i>=0;i--)e+=s[i].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let s=0;s<this.find.length;s++)this.find[s].node==e&&this.find[s].offset==t&&(this.find[s].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,s){if(e!=t&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&t.compareDocumentPosition(this.find[i].node)&(s?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),s=this.options.context,i=!this.isOpen&&(!s||s.parent.type==this.nodes[0].type),r=-(s?s.depth+1:0)+(i?0:1),o=(a,l)=>{for(;a>=0;a--){let d=t[a];if(d==""){if(a==t.length-1||a==0)continue;for(;l>=r;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&i?this.nodes[l].type:s&&l>=r?s.node(l-r).type:null;if(!u||u.name!=d&&u.groups.indexOf(d)==-1)return!1;l--}}return!0};return o(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let s=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(s&&s.isTextblock&&s.defaultAttrs)return s}for(let t in this.parser.schema.nodes){let s=this.parser.schema.nodes[t];if(s.isTextblock&&s.defaultAttrs)return s}}addPendingMark(e){let t=K2(e,this.top.pendingMarks);t&&this.top.stashMarks.push(t),this.top.pendingMarks=e.addToSet(this.top.pendingMarks)}removePendingMark(e,t){for(let s=this.open;s>=0;s--){let i=this.nodes[s];if(i.pendingMarks.lastIndexOf(e)>-1)i.pendingMarks=e.removeFromSet(i.pendingMarks);else{i.activeMarks=e.removeFromSet(i.activeMarks);let o=i.popFromStashMark(e);o&&i.type&&i.type.allowsMarkType(o.type)&&(i.activeMarks=o.addToSet(i.activeMarks))}if(i==t)break}}}function W2(n){for(let e=n.firstChild,t=null;e;e=e.nextSibling){let s=e.nodeType==1?e.nodeName.toLowerCase():null;s&&Dg.hasOwnProperty(s)&&t?(t.appendChild(e),e=t):s=="li"?t=e:s&&(t=null)}}function H2(n,e){return(n.matches||n.msMatchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector).call(n,e)}function Sf(n){let e={};for(let t in n)e[t]=n[t];return e}function q2(n,e){let t=e.schema.nodes;for(let s in t){let i=t[s];if(!i.allowsMarkType(n))continue;let r=[],o=a=>{r.push(a);for(let l=0;l<a.edgeCount;l++){let{type:d,next:u}=a.edge(l);if(d==e||r.indexOf(u)<0&&o(u))return!0}};if(o(i.contentMatch))return!0}}function K2(n,e){for(let t=0;t<e.length;t++)if(n.eq(e[t]))return e[t]}class br{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},s){s||(s=Al(t).createDocumentFragment());let i=s,r=[];return e.forEach(o=>{if(r.length||o.marks.length){let a=0,l=0;for(;a<r.length&&l<o.marks.length;){let d=o.marks[l];if(!this.marks[d.type.name]){l++;continue}if(!d.eq(r[a][0])||d.type.spec.spanning===!1)break;a++,l++}for(;a<r.length;)i=r.pop()[1];for(;l<o.marks.length;){let d=o.marks[l++],u=this.serializeMark(d,o.isInline,t);u&&(r.push([d,i]),i.appendChild(u.dom),i=u.contentDOM||u.dom)}}i.appendChild(this.serializeNodeInner(o,t))}),s}serializeNodeInner(e,t){let{dom:s,contentDOM:i}=Jo(Al(t),this.nodes[e.type.name](e),null,e.attrs);if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,i)}return s}serializeNode(e,t={}){let s=this.serializeNodeInner(e,t);for(let i=e.marks.length-1;i>=0;i--){let r=this.serializeMark(e.marks[i],e.isInline,t);r&&((r.contentDOM||r.dom).appendChild(s),s=r.dom)}return s}serializeMark(e,t,s={}){let i=this.marks[e.type.name];return i&&Jo(Al(s),i(e,t),null,e.attrs)}static renderSpec(e,t,s=null,i){return Jo(e,t,s,i)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new br(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=Cf(e.nodes);return t.text||(t.text=s=>s.text),t}static marksFromSchema(e){return Cf(e.marks)}}function Cf(n){let e={};for(let t in n){let s=n[t].spec.toDOM;s&&(e[t]=s)}return e}function Al(n){return n.document||window.document}const Mf=new WeakMap;function J2(n){let e=Mf.get(n);return e===void 0&&Mf.set(n,e=Y2(n)),e}function Y2(n){let e=null;function t(s){if(s&&typeof s=="object")if(Array.isArray(s))if(typeof s[0]=="string")e||(e=[]),e.push(s);else for(let i=0;i<s.length;i++)t(s[i]);else for(let i in s)t(s[i])}return t(n),e}function Jo(n,e,t,s){if(typeof e=="string")return{dom:n.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let i=e[0],r;if(typeof i!="string")throw new RangeError("Invalid array passed to renderSpec");if(s&&(r=J2(s))&&r.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=i.indexOf(" ");o>0&&(t=i.slice(0,o),i=i.slice(o+1));let a,l=t?n.createElementNS(t,i):n.createElement(i),d=e[1],u=1;if(d&&typeof d=="object"&&d.nodeType==null&&!Array.isArray(d)){u=2;for(let f in d)if(d[f]!=null){let h=f.indexOf(" ");h>0?l.setAttributeNS(f.slice(0,h),f.slice(h+1),d[f]):l.setAttribute(f,d[f])}}for(let f=u;f<e.length;f++){let h=e[f];if(h===0){if(f<e.length-1||f>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:g,contentDOM:x}=Jo(n,h,t,s);if(l.appendChild(g),x){if(a)throw new RangeError("Multiple content holes");a=x}}}return{dom:l,contentDOM:a}}const jg=65535,Pg=Math.pow(2,16);function X2(n,e){return n+e*Pg}function Tf(n){return n&jg}function Q2(n){return(n-(n&jg))/Pg}const Og=1,Fg=2,Yo=4,Lg=8;class Cc{constructor(e,t,s){this.pos=e,this.delInfo=t,this.recover=s}get deleted(){return(this.delInfo&Lg)>0}get deletedBefore(){return(this.delInfo&(Og|Yo))>0}get deletedAfter(){return(this.delInfo&(Fg|Yo))>0}get deletedAcross(){return(this.delInfo&Yo)>0}}class dn{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&dn.empty)return dn.empty}recover(e){let t=0,s=Tf(e);if(!this.inverted)for(let i=0;i<s;i++)t+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[s*3]+t+Q2(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,s){let i=0,r=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>e)break;let d=this.ranges[a+r],u=this.ranges[a+o],f=l+d;if(e<=f){let h=d?e==l?-1:e==f?1:t:t,g=l+i+(h<0?0:u);if(s)return g;let x=e==(t<0?l:f)?null:X2(a/3,e-l),y=e==l?Fg:e==f?Og:Yo;return(t<0?e!=l:e!=f)&&(y|=Lg),new Cc(g,y,x)}i+=u-d}return s?e+i:new Cc(e+i,0,null)}touches(e,t){let s=0,i=Tf(t),r=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?s:0);if(l>e)break;let d=this.ranges[a+r],u=l+d;if(e<=u&&a==i*3)return!0;s+=this.ranges[a+o]-d}return!1}forEach(e){let t=this.inverted?2:1,s=this.inverted?1:2;for(let i=0,r=0;i<this.ranges.length;i+=3){let o=this.ranges[i],a=o-(this.inverted?r:0),l=o+(this.inverted?0:r),d=this.ranges[i+t],u=this.ranges[i+s];e(a,a+d,l,l+u),r+=u-d}}invert(){return new dn(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?dn.empty:new dn(e<0?[0,-e,0]:[0,0,e])}}dn.empty=new dn([]);class Gi{constructor(e=[],t,s=0,i=e.length){this.maps=e,this.mirror=t,this.from=s,this.to=i}slice(e=0,t=this.maps.length){return new Gi(this.maps,this.mirror,e,t)}copy(){return new Gi(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(e,t){this.to=this.maps.push(e),t!=null&&this.setMirror(this.maps.length-1,t)}appendMapping(e){for(let t=0,s=this.maps.length;t<e.maps.length;t++){let i=e.getMirror(t);this.appendMap(e.maps[t],i!=null&&i<t?s+i:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,s=this.maps.length+e.maps.length;t>=0;t--){let i=e.getMirror(t);this.appendMap(e.maps[t].invert(),i!=null&&i>t?s-i-1:void 0)}}invert(){let e=new Gi;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let s=this.from;s<this.to;s++)e=this.maps[s].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,s){let i=0;for(let r=this.from;r<this.to;r++){let o=this.maps[r],a=o.mapResult(e,t);if(a.recover!=null){let l=this.getMirror(r);if(l!=null&&l>r&&l<this.to){r=l,e=this.maps[l].recover(a.recover);continue}}i|=a.delInfo,e=a.pos}return s?e:new Cc(e,i,null)}}const Nl=Object.create(null);class zt{getMap(){return dn.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let s=Nl[t.stepType];if(!s)throw new RangeError(`No step type ${t.stepType} defined`);return s.fromJSON(e,t)}static jsonID(e,t){if(e in Nl)throw new RangeError("Duplicate use of step JSON ID "+e);return Nl[e]=t,t.prototype.jsonID=e,t}}class gt{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new gt(e,null)}static fail(e){return new gt(null,e)}static fromReplace(e,t,s,i){try{return gt.ok(e.replace(t,s,i))}catch(r){if(r instanceof Sa)return gt.fail(r.message);throw r}}}function Kd(n,e,t){let s=[];for(let i=0;i<n.childCount;i++){let r=n.child(i);r.content.size&&(r=r.copy(Kd(r.content,e,r))),r.isInline&&(r=e(r,t,i)),s.push(r)}return K.fromArray(s)}class js extends zt{constructor(e,t,s){super(),this.from=e,this.to=t,this.mark=s}apply(e){let t=e.slice(this.from,this.to),s=e.resolve(this.from),i=s.node(s.sharedDepth(this.to)),r=new ie(Kd(t.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),t.openStart,t.openEnd);return gt.fromReplace(e,this.from,this.to,r)}invert(){return new Kn(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),s=e.mapResult(this.to,-1);return t.deleted&&s.deleted||t.pos>=s.pos?null:new js(t.pos,s.pos,this.mark)}merge(e){return e instanceof js&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new js(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new js(t.from,t.to,e.markFromJSON(t.mark))}}zt.jsonID("addMark",js);class Kn extends zt{constructor(e,t,s){super(),this.from=e,this.to=t,this.mark=s}apply(e){let t=e.slice(this.from,this.to),s=new ie(Kd(t.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),t.openStart,t.openEnd);return gt.fromReplace(e,this.from,this.to,s)}invert(){return new js(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),s=e.mapResult(this.to,-1);return t.deleted&&s.deleted||t.pos>=s.pos?null:new Kn(t.pos,s.pos,this.mark)}merge(e){return e instanceof Kn&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Kn(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Kn(t.from,t.to,e.markFromJSON(t.mark))}}zt.jsonID("removeMark",Kn);class Ps extends zt{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return gt.fail("No node at mark step's position");let s=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return gt.fromReplace(e,this.pos,this.pos+1,new ie(K.from(s),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let s=this.mark.addToSet(t.marks);if(s.length==t.marks.length){for(let i=0;i<t.marks.length;i++)if(!t.marks[i].isInSet(s))return new Ps(this.pos,t.marks[i]);return new Ps(this.pos,this.mark)}}return new rr(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Ps(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Ps(t.pos,e.markFromJSON(t.mark))}}zt.jsonID("addNodeMark",Ps);class rr extends zt{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return gt.fail("No node at mark step's position");let s=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return gt.fromReplace(e,this.pos,this.pos+1,new ie(K.from(s),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new Ps(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new rr(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new rr(t.pos,e.markFromJSON(t.mark))}}zt.jsonID("removeNodeMark",rr);class Ft extends zt{constructor(e,t,s,i=!1){super(),this.from=e,this.to=t,this.slice=s,this.structure=i}apply(e){return this.structure&&Mc(e,this.from,this.to)?gt.fail("Structure replace would overwrite content"):gt.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new dn([this.from,this.to-this.from,this.slice.size])}invert(e){return new Ft(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),s=e.mapResult(this.to,-1);return t.deletedAcross&&s.deletedAcross?null:new Ft(t.pos,Math.max(t.pos,s.pos),this.slice)}merge(e){if(!(e instanceof Ft)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?ie.empty:new ie(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new Ft(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?ie.empty:new ie(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new Ft(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new Ft(t.from,t.to,ie.fromJSON(e,t.slice),!!t.structure)}}zt.jsonID("replace",Ft);class fn extends zt{constructor(e,t,s,i,r,o,a=!1){super(),this.from=e,this.to=t,this.gapFrom=s,this.gapTo=i,this.slice=r,this.insert=o,this.structure=a}apply(e){if(this.structure&&(Mc(e,this.from,this.gapFrom)||Mc(e,this.gapTo,this.to)))return gt.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return gt.fail("Gap is not a flat range");let s=this.slice.insertAt(this.insert,t.content);return s?gt.fromReplace(e,this.from,this.to,s):gt.fail("Content does not fit in gap")}getMap(){return new dn([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new fn(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),s=e.mapResult(this.to,-1),i=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),r=this.to==this.gapTo?s.pos:e.map(this.gapTo,1);return t.deletedAcross&&s.deletedAcross||i<t.pos||r>s.pos?null:new fn(t.pos,s.pos,i,r,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new fn(t.from,t.to,t.gapFrom,t.gapTo,ie.fromJSON(e,t.slice),t.insert,!!t.structure)}}zt.jsonID("replaceAround",fn);function Mc(n,e,t){let s=n.resolve(e),i=t-e,r=s.depth;for(;i>0&&r>0&&s.indexAfter(r)==s.node(r).childCount;)r--,i--;if(i>0){let o=s.node(r).maybeChild(s.indexAfter(r));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function Z2(n,e,t,s){let i=[],r=[],o,a;n.doc.nodesBetween(e,t,(l,d,u)=>{if(!l.isInline)return;let f=l.marks;if(!s.isInSet(f)&&u.type.allowsMarkType(s.type)){let h=Math.max(d,e),g=Math.min(d+l.nodeSize,t),x=s.addToSet(f);for(let y=0;y<f.length;y++)f[y].isInSet(x)||(o&&o.to==h&&o.mark.eq(f[y])?o.to=g:i.push(o=new Kn(h,g,f[y])));a&&a.to==h?a.to=g:r.push(a=new js(h,g,s))}}),i.forEach(l=>n.step(l)),r.forEach(l=>n.step(l))}function eE(n,e,t,s){let i=[],r=0;n.doc.nodesBetween(e,t,(o,a)=>{if(!o.isInline)return;r++;let l=null;if(s instanceof tl){let d=o.marks,u;for(;u=s.isInSet(d);)(l||(l=[])).push(u),d=u.removeFromSet(d)}else s?s.isInSet(o.marks)&&(l=[s]):l=o.marks;if(l&&l.length){let d=Math.min(a+o.nodeSize,t);for(let u=0;u<l.length;u++){let f=l[u],h;for(let g=0;g<i.length;g++){let x=i[g];x.step==r-1&&f.eq(i[g].style)&&(h=x)}h?(h.to=d,h.step=r):i.push({style:f,from:Math.max(a,e),to:d,step:r})}}}),i.forEach(o=>n.step(new Kn(o.from,o.to,o.style)))}function Bg(n,e,t,s=t.contentMatch,i=!0){let r=n.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<r.childCount;l++){let d=r.child(l),u=a+d.nodeSize,f=s.matchType(d.type);if(!f)o.push(new Ft(a,u,ie.empty));else{s=f;for(let h=0;h<d.marks.length;h++)t.allowsMarkType(d.marks[h].type)||n.step(new Kn(a,u,d.marks[h]));if(i&&d.isText&&t.whitespace!="pre"){let h,g=/\r?\n|\r/g,x;for(;h=g.exec(d.text);)x||(x=new ie(K.from(t.schema.text(" ",t.allowedMarks(d.marks))),0,0)),o.push(new Ft(a+h.index,a+h.index+h[0].length,x))}}a=u}if(!s.validEnd){let l=s.fillBefore(K.empty,!0);n.replace(a,a,new ie(l,0,0))}for(let l=o.length-1;l>=0;l--)n.step(o[l])}function tE(n,e,t){return(e==0||n.canReplace(e,n.childCount))&&(t==n.childCount||n.canReplace(0,t))}function Jd(n){let t=n.parent.content.cutByIndex(n.startIndex,n.endIndex);for(let s=n.depth;;--s){let i=n.$from.node(s),r=n.$from.index(s),o=n.$to.indexAfter(s);if(s<n.depth&&i.canReplace(r,o,t))return s;if(s==0||i.type.spec.isolating||!tE(i,r,o))break}return null}function nE(n,e,t){let{$from:s,$to:i,depth:r}=e,o=s.before(r+1),a=i.after(r+1),l=o,d=a,u=K.empty,f=0;for(let x=r,y=!1;x>t;x--)y||s.index(x)>0?(y=!0,u=K.from(s.node(x).copy(u)),f++):l--;let h=K.empty,g=0;for(let x=r,y=!1;x>t;x--)y||i.after(x+1)<i.end(x)?(y=!0,h=K.from(i.node(x).copy(h)),g++):d++;n.step(new fn(l,d,o,a,new ie(u.append(h),f,g),u.size-f,!0))}function sE(n,e,t=null,s=n){let i=iE(n,e),r=i&&rE(s,e);return r?i.map(Ef).concat({type:e,attrs:t}).concat(r.map(Ef)):null}function Ef(n){return{type:n,attrs:null}}function iE(n,e){let{parent:t,startIndex:s,endIndex:i}=n,r=t.contentMatchAt(s).findWrapping(e);if(!r)return null;let o=r.length?r[0]:e;return t.canReplaceWith(s,i,o)?r:null}function rE(n,e){let{parent:t,startIndex:s,endIndex:i}=n,r=t.child(s),o=e.contentMatch.findWrapping(r.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let d=s;l&&d<i;d++)l=l.matchType(t.child(d).type);return!l||!l.validEnd?null:o}function oE(n,e,t){let s=K.empty;for(let o=t.length-1;o>=0;o--){if(s.size){let a=t[o].type.contentMatch.matchFragment(s);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}s=K.from(t[o].type.create(t[o].attrs,s))}let i=e.start,r=e.end;n.step(new fn(i,r,i,r,new ie(s,0,0),t.length,!0))}function aE(n,e,t,s,i){if(!s.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let r=n.steps.length;n.doc.nodesBetween(e,t,(o,a)=>{if(o.isTextblock&&!o.hasMarkup(s,i)&&dE(n.doc,n.mapping.slice(r).map(a),s)){let l=null;if(s.schema.linebreakReplacement){let h=s.whitespace=="pre",g=!!s.contentMatch.matchType(s.schema.linebreakReplacement);h&&!g?l=!1:!h&&g&&(l=!0)}l===!1&&cE(n,o,a,r),Bg(n,n.mapping.slice(r).map(a,1),s,void 0,l===null);let d=n.mapping.slice(r),u=d.map(a,1),f=d.map(a+o.nodeSize,1);return n.step(new fn(u,f,u+1,f-1,new ie(K.from(s.create(i,null,o.marks)),0,0),1,!0)),l===!0&&lE(n,o,a,r),!1}})}function lE(n,e,t,s){e.forEach((i,r)=>{if(i.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(i.text);){let l=n.mapping.slice(s).map(t+1+r+o.index);n.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function cE(n,e,t,s){e.forEach((i,r)=>{if(i.type==i.type.schema.linebreakReplacement){let o=n.mapping.slice(s).map(t+1+r);n.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function dE(n,e,t){let s=n.resolve(e),i=s.index();return s.parent.canReplaceWith(i,i+1,t)}function uE(n,e,t,s,i){let r=n.doc.nodeAt(e);if(!r)throw new RangeError("No node at given position");t||(t=r.type);let o=t.create(s,null,i||r.marks);if(r.isLeaf)return n.replaceWith(e,e+r.nodeSize,o);if(!t.validContent(r.content))throw new RangeError("Invalid content for node type "+t.name);n.step(new fn(e,e+r.nodeSize,e+1,e+r.nodeSize-1,new ie(K.from(o),0,0),1,!0))}function Xo(n,e,t=1,s){let i=n.resolve(e),r=i.depth-t,o=s&&s[s.length-1]||i.parent;if(r<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let d=i.depth-1,u=t-2;d>r;d--,u--){let f=i.node(d),h=i.index(d);if(f.type.spec.isolating)return!1;let g=f.content.cutByIndex(h,f.childCount),x=s&&s[u+1];x&&(g=g.replaceChild(0,x.type.create(x.attrs)));let y=s&&s[u]||f;if(!f.canReplace(h+1,f.childCount)||!y.type.validContent(g))return!1}let a=i.indexAfter(r),l=s&&s[0];return i.node(r).canReplaceWith(a,a,l?l.type:i.node(r+1).type)}function fE(n,e,t=1,s){let i=n.doc.resolve(e),r=K.empty,o=K.empty;for(let a=i.depth,l=i.depth-t,d=t-1;a>l;a--,d--){r=K.from(i.node(a).copy(r));let u=s&&s[d];o=K.from(u?u.type.create(u.attrs,o):i.node(a).copy(o))}n.step(new Ft(e,e,new ie(r.append(o),t,t),!0))}function Ug(n,e){let t=n.resolve(e),s=t.index();return hE(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(s,s+1)}function hE(n,e){return!!(n&&e&&!n.isLeaf&&n.canAppend(e))}function pE(n,e,t){let s=new Ft(e-t,e+t,ie.empty,!0);n.step(s)}function mE(n,e,t){let s=n.resolve(e);if(s.parent.canReplaceWith(s.index(),s.index(),t))return e;if(s.parentOffset==0)for(let i=s.depth-1;i>=0;i--){let r=s.index(i);if(s.node(i).canReplaceWith(r,r,t))return s.before(i+1);if(r>0)return null}if(s.parentOffset==s.parent.content.size)for(let i=s.depth-1;i>=0;i--){let r=s.indexAfter(i);if(s.node(i).canReplaceWith(r,r,t))return s.after(i+1);if(r<s.node(i).childCount)return null}return null}function gE(n,e,t){let s=n.resolve(e);if(!t.content.size)return e;let i=t.content;for(let r=0;r<t.openStart;r++)i=i.firstChild.content;for(let r=1;r<=(t.openStart==0&&t.size?2:1);r++)for(let o=s.depth;o>=0;o--){let a=o==s.depth?0:s.pos<=(s.start(o+1)+s.end(o+1))/2?-1:1,l=s.index(o)+(a>0?1:0),d=s.node(o),u=!1;if(r==1)u=d.canReplace(l,l,i);else{let f=d.contentMatchAt(l).findWrapping(i.firstChild.type);u=f&&d.canReplaceWith(l,l,f[0])}if(u)return a==0?s.pos:a<0?s.before(o+1):s.after(o+1)}return null}function Yd(n,e,t=e,s=ie.empty){if(e==t&&!s.size)return null;let i=n.resolve(e),r=n.resolve(t);return zg(i,r,s)?new Ft(e,t,s):new xE(i,r,s).fit()}function zg(n,e,t){return!t.openStart&&!t.openEnd&&n.start()==e.start()&&n.parent.canReplace(n.index(),e.index(),t.content)}class xE{constructor(e,t,s){this.$from=e,this.$to=t,this.unplaced=s,this.frontier=[],this.placed=K.empty;for(let i=0;i<=e.depth;i++){let r=e.node(i);this.frontier.push({type:r.type,match:r.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=K.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let d=this.findFittable();d?this.placeNodes(d):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,s=this.$from,i=this.close(e<0?this.$to:s.doc.resolve(e));if(!i)return null;let r=this.placed,o=s.depth,a=i.depth;for(;o&&a&&r.childCount==1;)r=r.firstChild.content,o--,a--;let l=new ie(r,o,a);return e>-1?new fn(s.pos,e,this.$to.pos,this.$to.end(),l,t):l.size||s.pos!=this.$to.pos?new Ft(s.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,s=0,i=this.unplaced.openEnd;s<e;s++){let r=t.firstChild;if(t.childCount>1&&(i=0),r.type.spec.isolating&&i<=s){e=s;break}t=r.content}for(let t=1;t<=2;t++)for(let s=t==1?e:this.unplaced.openStart;s>=0;s--){let i,r=null;s?(r=Il(this.unplaced.content,s-1).firstChild,i=r.content):i=this.unplaced.content;let o=i.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:d}=this.frontier[a],u,f=null;if(t==1&&(o?d.matchType(o.type)||(f=d.fillBefore(K.from(o),!1)):r&&l.compatibleContent(r.type)))return{sliceDepth:s,frontierDepth:a,parent:r,inject:f};if(t==2&&o&&(u=d.findWrapping(o.type)))return{sliceDepth:s,frontierDepth:a,parent:r,wrap:u};if(r&&d.matchType(r.type))break}}}openMore(){let{content:e,openStart:t,openEnd:s}=this.unplaced,i=Il(e,t);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new ie(e,t+1,Math.max(s,i.size+t>=e.size-s?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:s}=this.unplaced,i=Il(e,t);if(i.childCount<=1&&t>0){let r=e.size-t<=t+i.size;this.unplaced=new ie(Rr(e,t-1,1),t-1,r?t-1:s)}else this.unplaced=new ie(Rr(e,t,1),t,s)}placeNodes({sliceDepth:e,frontierDepth:t,parent:s,inject:i,wrap:r}){for(;this.depth>t;)this.closeFrontierNode();if(r)for(let y=0;y<r.length;y++)this.openFrontierNode(r[y]);let o=this.unplaced,a=s?s.content:o.content,l=o.openStart-e,d=0,u=[],{match:f,type:h}=this.frontier[t];if(i){for(let y=0;y<i.childCount;y++)u.push(i.child(y));f=f.matchFragment(i)}let g=a.size+e-(o.content.size-o.openEnd);for(;d<a.childCount;){let y=a.child(d),w=f.matchType(y.type);if(!w)break;d++,(d>1||l==0||y.content.size)&&(f=w,u.push(Vg(y.mark(h.allowedMarks(y.marks)),d==1?l:0,d==a.childCount?g:-1)))}let x=d==a.childCount;x||(g=-1),this.placed=Dr(this.placed,t,K.from(u)),this.frontier[t].match=f,x&&g<0&&s&&s.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let y=0,w=a;y<g;y++){let S=w.lastChild;this.frontier.push({type:S.type,match:S.contentMatchAt(S.childCount)}),w=S.content}this.unplaced=x?e==0?ie.empty:new ie(Rr(o.content,e-1,1),e-1,g<0?o.openEnd:e-1):new ie(Rr(o.content,e,d),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!Rl(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:s}=this.$to,i=this.$to.after(s);for(;s>1&&i==this.$to.end(--s);)++i;return i}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:s,type:i}=this.frontier[t],r=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),o=Rl(e,t,i,s,r);if(o){for(let a=t-1;a>=0;a--){let{match:l,type:d}=this.frontier[a],u=Rl(e,a,d,l,!0);if(!u||u.childCount)continue e}return{depth:t,fit:o,move:r?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=Dr(this.placed,t.depth,t.fit)),e=t.move;for(let s=t.depth+1;s<=e.depth;s++){let i=e.node(s),r=i.type.contentMatch.fillBefore(i.content,!0,e.index(s));this.openFrontierNode(i.type,i.attrs,r)}return e}openFrontierNode(e,t=null,s){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=Dr(this.placed,this.depth,K.from(e.create(t,s))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(K.empty,!0);t.childCount&&(this.placed=Dr(this.placed,this.frontier.length,t))}}function Rr(n,e,t){return e==0?n.cutByIndex(t,n.childCount):n.replaceChild(0,n.firstChild.copy(Rr(n.firstChild.content,e-1,t)))}function Dr(n,e,t){return e==0?n.append(t):n.replaceChild(n.childCount-1,n.lastChild.copy(Dr(n.lastChild.content,e-1,t)))}function Il(n,e){for(let t=0;t<e;t++)n=n.firstChild.content;return n}function Vg(n,e,t){if(e<=0)return n;let s=n.content;return e>1&&(s=s.replaceChild(0,Vg(s.firstChild,e-1,s.childCount==1?t-1:0))),e>0&&(s=n.type.contentMatch.fillBefore(s).append(s),t<=0&&(s=s.append(n.type.contentMatch.matchFragment(s).fillBefore(K.empty,!0)))),n.copy(s)}function Rl(n,e,t,s,i){let r=n.node(e),o=i?n.indexAfter(e):n.index(e);if(o==r.childCount&&!t.compatibleContent(r.type))return null;let a=s.fillBefore(r.content,!0,o);return a&&!yE(t,r.content,o)?a:null}function yE(n,e,t){for(let s=t;s<e.childCount;s++)if(!n.allowsMarks(e.child(s).marks))return!0;return!1}function bE(n){return n.spec.defining||n.spec.definingForContent}function kE(n,e,t,s){if(!s.size)return n.deleteRange(e,t);let i=n.doc.resolve(e),r=n.doc.resolve(t);if(zg(i,r,s))return n.step(new Ft(e,t,s));let o=$g(i,n.doc.resolve(t));o[o.length-1]==0&&o.pop();let a=-(i.depth+1);o.unshift(a);for(let h=i.depth,g=i.pos-1;h>0;h--,g--){let x=i.node(h).type.spec;if(x.defining||x.definingAsContext||x.isolating)break;o.indexOf(h)>-1?a=h:i.before(h)==g&&o.splice(1,0,-h)}let l=o.indexOf(a),d=[],u=s.openStart;for(let h=s.content,g=0;;g++){let x=h.firstChild;if(d.push(x),g==s.openStart)break;h=x.content}for(let h=u-1;h>=0;h--){let g=d[h],x=bE(g.type);if(x&&!g.sameMarkup(i.node(Math.abs(a)-1)))u=h;else if(x||!g.type.isTextblock)break}for(let h=s.openStart;h>=0;h--){let g=(h+u+1)%(s.openStart+1),x=d[g];if(x)for(let y=0;y<o.length;y++){let w=o[(y+l)%o.length],S=!0;w<0&&(S=!1,w=-w);let _=i.node(w-1),O=i.index(w-1);if(_.canReplaceWith(O,O,x.type,x.marks))return n.replace(i.before(w),S?r.after(w):t,new ie(Gg(s.content,0,s.openStart,g),g,s.openEnd))}}let f=n.steps.length;for(let h=o.length-1;h>=0&&(n.replace(e,t,s),!(n.steps.length>f));h--){let g=o[h];g<0||(e=i.before(g),t=r.after(g))}}function Gg(n,e,t,s,i){if(e<t){let r=n.firstChild;n=n.replaceChild(0,r.copy(Gg(r.content,e+1,t,s,r)))}if(e>s){let r=i.contentMatchAt(0),o=r.fillBefore(n).append(n);n=o.append(r.matchFragment(o).fillBefore(K.empty,!0))}return n}function wE(n,e,t,s){if(!s.isInline&&e==t&&n.doc.resolve(e).parent.content.size){let i=mE(n.doc,e,s.type);i!=null&&(e=t=i)}n.replaceRange(e,t,new ie(K.from(s),0,0))}function vE(n,e,t){let s=n.doc.resolve(e),i=n.doc.resolve(t),r=$g(s,i);for(let o=0;o<r.length;o++){let a=r[o],l=o==r.length-1;if(l&&a==0||s.node(a).type.contentMatch.validEnd)return n.delete(s.start(a),i.end(a));if(a>0&&(l||s.node(a-1).canReplace(s.index(a-1),i.indexAfter(a-1))))return n.delete(s.before(a),i.after(a))}for(let o=1;o<=s.depth&&o<=i.depth;o++)if(e-s.start(o)==s.depth-o&&t>s.end(o)&&i.end(o)-t!=i.depth-o)return n.delete(s.before(o),t);n.delete(e,t)}function $g(n,e){let t=[],s=Math.min(n.depth,e.depth);for(let i=s;i>=0;i--){let r=n.start(i);if(r<n.pos-(n.depth-i)||e.end(i)>e.pos+(e.depth-i)||n.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(r==e.start(i)||i==n.depth&&i==e.depth&&n.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==r-1)&&t.push(i)}return t}class $i extends zt{constructor(e,t,s){super(),this.pos=e,this.attr=t,this.value=s}apply(e){let t=e.nodeAt(this.pos);if(!t)return gt.fail("No node at attribute step's position");let s=Object.create(null);for(let r in t.attrs)s[r]=t.attrs[r];s[this.attr]=this.value;let i=t.type.create(s,null,t.marks);return gt.fromReplace(e,this.pos,this.pos+1,new ie(K.from(i),0,t.isLeaf?0:1))}getMap(){return dn.empty}invert(e){return new $i(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new $i(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new $i(t.pos,t.attr,t.value)}}zt.jsonID("attr",$i);class Qr extends zt{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let i in e.attrs)t[i]=e.attrs[i];t[this.attr]=this.value;let s=e.type.create(t,e.content,e.marks);return gt.ok(s)}getMap(){return dn.empty}invert(e){return new Qr(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Qr(t.attr,t.value)}}zt.jsonID("docAttr",Qr);let or=class extends Error{};or=function n(e){let t=Error.call(this,e);return t.__proto__=n.prototype,t};or.prototype=Object.create(Error.prototype);or.prototype.constructor=or;or.prototype.name="TransformError";class SE{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Gi}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new or(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,s=ie.empty){let i=Yd(this.doc,e,t,s);return i&&this.step(i),this}replaceWith(e,t,s){return this.replace(e,t,new ie(K.from(s),0,0))}delete(e,t){return this.replace(e,t,ie.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,s){return kE(this,e,t,s),this}replaceRangeWith(e,t,s){return wE(this,e,t,s),this}deleteRange(e,t){return vE(this,e,t),this}lift(e,t){return nE(this,e,t),this}join(e,t=1){return pE(this,e,t),this}wrap(e,t){return oE(this,e,t),this}setBlockType(e,t=e,s,i=null){return aE(this,e,t,s,i),this}setNodeMarkup(e,t,s=null,i){return uE(this,e,t,s,i),this}setNodeAttribute(e,t,s){return this.step(new $i(e,t,s)),this}setDocAttribute(e,t){return this.step(new Qr(e,t)),this}addNodeMark(e,t){return this.step(new Ps(e,t)),this}removeNodeMark(e,t){if(!(t instanceof Be)){let s=this.doc.nodeAt(e);if(!s)throw new RangeError("No node at position "+e);if(t=t.isInSet(s.marks),!t)return this}return this.step(new rr(e,t)),this}split(e,t=1,s){return fE(this,e,t,s),this}addMark(e,t,s){return Z2(this,e,t,s),this}removeMark(e,t,s){return eE(this,e,t,s),this}clearIncompatible(e,t,s){return Bg(this,e,t,s),this}}const Dl=Object.create(null);class Ne{constructor(e,t,s){this.$anchor=e,this.$head=t,this.ranges=s||[new CE(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=ie.empty){let s=t.content.lastChild,i=null;for(let a=0;a<t.openEnd;a++)i=s,s=s.lastChild;let r=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:d}=o[a],u=e.mapping.slice(r);e.replaceRange(u.map(l.pos),u.map(d.pos),a?ie.empty:t),a==0&&Nf(e,r,(s?s.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,t){let s=e.steps.length,i=this.ranges;for(let r=0;r<i.length;r++){let{$from:o,$to:a}=i[r],l=e.mapping.slice(s),d=l.map(o.pos),u=l.map(a.pos);r?e.deleteRange(d,u):(e.replaceRangeWith(d,u,t),Nf(e,s,t.isInline?-1:1))}}static findFrom(e,t,s=!1){let i=e.parent.inlineContent?new We(e):Bi(e.node(0),e.parent,e.pos,e.index(),t,s);if(i)return i;for(let r=e.depth-1;r>=0;r--){let o=t<0?Bi(e.node(0),e.node(r),e.before(r+1),e.index(r),t,s):Bi(e.node(0),e.node(r),e.after(r+1),e.index(r)+1,t,s);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new hn(e.node(0))}static atStart(e){return Bi(e,e,0,0,1)||new hn(e)}static atEnd(e){return Bi(e,e,e.content.size,e.childCount,-1)||new hn(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let s=Dl[t.type];if(!s)throw new RangeError(`No selection type ${t.type} defined`);return s.fromJSON(e,t)}static jsonID(e,t){if(e in Dl)throw new RangeError("Duplicate use of selection JSON ID "+e);return Dl[e]=t,t.prototype.jsonID=e,t}getBookmark(){return We.between(this.$anchor,this.$head).getBookmark()}}Ne.prototype.visible=!0;class CE{constructor(e,t){this.$from=e,this.$to=t}}let _f=!1;function Af(n){!_f&&!n.parent.inlineContent&&(_f=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+n.parent.type.name+")"))}class We extends Ne{constructor(e,t=e){Af(e),Af(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let s=e.resolve(t.map(this.head));if(!s.parent.inlineContent)return Ne.near(s);let i=e.resolve(t.map(this.anchor));return new We(i.parent.inlineContent?i:s,s)}replace(e,t=ie.empty){if(super.replace(e,t),t==ie.empty){let s=this.$from.marksAcross(this.$to);s&&e.ensureMarks(s)}}eq(e){return e instanceof We&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new nl(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new We(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,s=t){let i=e.resolve(t);return new this(i,s==t?i:e.resolve(s))}static between(e,t,s){let i=e.pos-t.pos;if((!s||i)&&(s=i>=0?1:-1),!t.parent.inlineContent){let r=Ne.findFrom(t,s,!0)||Ne.findFrom(t,-s,!0);if(r)t=r.$head;else return Ne.near(t,s)}return e.parent.inlineContent||(i==0?e=t:(e=(Ne.findFrom(e,-s,!0)||Ne.findFrom(e,s,!0)).$anchor,e.pos<t.pos!=i<0&&(e=t))),new We(e,t)}}Ne.jsonID("text",We);class nl{constructor(e,t){this.anchor=e,this.head=t}map(e){return new nl(e.map(this.anchor),e.map(this.head))}resolve(e){return We.between(e.resolve(this.anchor),e.resolve(this.head))}}class he extends Ne{constructor(e){let t=e.nodeAfter,s=e.node(0).resolve(e.pos+t.nodeSize);super(e,s),this.node=t}map(e,t){let{deleted:s,pos:i}=t.mapResult(this.anchor),r=e.resolve(i);return s?Ne.near(r):new he(r)}content(){return new ie(K.from(this.node),0,0)}eq(e){return e instanceof he&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Xd(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new he(e.resolve(t.anchor))}static create(e,t){return new he(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}he.prototype.visible=!1;Ne.jsonID("node",he);class Xd{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:s}=e.mapResult(this.anchor);return t?new nl(s,s):new Xd(s)}resolve(e){let t=e.resolve(this.anchor),s=t.nodeAfter;return s&&he.isSelectable(s)?new he(t):Ne.near(t)}}class hn extends Ne{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=ie.empty){if(t==ie.empty){e.delete(0,e.doc.content.size);let s=Ne.atStart(e.doc);s.eq(e.selection)||e.setSelection(s)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new hn(e)}map(e){return new hn(e)}eq(e){return e instanceof hn}getBookmark(){return ME}}Ne.jsonID("all",hn);const ME={map(){return this},resolve(n){return new hn(n)}};function Bi(n,e,t,s,i,r=!1){if(e.inlineContent)return We.create(n,t);for(let o=s-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let a=e.child(o);if(a.isAtom){if(!r&&he.isSelectable(a))return he.create(n,t-(i<0?a.nodeSize:0))}else{let l=Bi(n,a,t+i,i<0?a.childCount:0,i,r);if(l)return l}t+=a.nodeSize*i}return null}function Nf(n,e,t){let s=n.steps.length-1;if(s<e)return;let i=n.steps[s];if(!(i instanceof Ft||i instanceof fn))return;let r=n.mapping.maps[s],o;r.forEach((a,l,d,u)=>{o==null&&(o=u)}),n.setSelection(Ne.near(n.doc.resolve(o),t))}const If=1,Fo=2,Rf=4;class TE extends SE{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|If)&~Fo,this.storedMarks=null,this}get selectionSet(){return(this.updated&If)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Fo,this}ensureMarks(e){return Be.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Fo)>0}addStep(e,t){super.addStep(e,t),this.updated=this.updated&~Fo,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let s=this.selection;return t&&(e=e.mark(this.storedMarks||(s.empty?s.$from.marks():s.$from.marksAcross(s.$to)||Be.none))),s.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,s){let i=this.doc.type.schema;if(t==null)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(s==null&&(s=t),s=s??t,!e)return this.deleteRange(t,s);let r=this.storedMarks;if(!r){let o=this.doc.resolve(t);r=s==t?o.marks():o.marksAcross(this.doc.resolve(s))}return this.replaceRangeWith(t,s,i.text(e,r)),this.selection.empty||this.setSelection(Ne.near(this.selection.$to)),this}}setMeta(e,t){return this.meta[typeof e=="string"?e:e.key]=t,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=Rf,this}get scrolledIntoView(){return(this.updated&Rf)>0}}function Df(n,e){return!e||!n?n:n.bind(e)}class jr{constructor(e,t,s){this.name=e,this.init=Df(t.init,s),this.apply=Df(t.apply,s)}}const EE=[new jr("doc",{init(n){return n.doc||n.schema.topNodeType.createAndFill()},apply(n){return n.doc}}),new jr("selection",{init(n,e){return n.selection||Ne.atStart(e.doc)},apply(n){return n.selection}}),new jr("storedMarks",{init(n){return n.storedMarks||null},apply(n,e,t,s){return s.selection.$cursor?n.storedMarks:null}}),new jr("scrollToSelection",{init(){return 0},apply(n,e){return n.scrolledIntoView?e+1:e}})];class jl{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=EE.slice(),t&&t.forEach(s=>{if(this.pluginsByKey[s.key])throw new RangeError("Adding different instances of a keyed plugin ("+s.key+")");this.plugins.push(s),this.pluginsByKey[s.key]=s,s.spec.state&&this.fields.push(new jr(s.key,s.spec.state,s))})}}class zi{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let s=0;s<this.config.plugins.length;s++)if(s!=t){let i=this.config.plugins[s];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],s=this.applyInner(e),i=null;for(;;){let r=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=i?i[o].n:0,d=i?i[o].state:this,u=l<t.length&&a.spec.appendTransaction.call(a,l?t.slice(l):t,d,s);if(u&&s.filterTransaction(u,o)){if(u.setMeta("appendedTransaction",e),!i){i=[];for(let f=0;f<this.config.plugins.length;f++)i.push(f<o?{state:s,n:t.length}:{state:this,n:0})}t.push(u),s=s.applyInner(u),r=!0}i&&(i[o]={state:s,n:t.length})}}if(!r)return{state:s,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new zi(this.config),s=this.config.fields;for(let i=0;i<s.length;i++){let r=s[i];t[r.name]=r.apply(e,this[r.name],this,t)}return t}get tr(){return new TE(this)}static create(e){let t=new jl(e.doc?e.doc.type.schema:e.schema,e.plugins),s=new zi(t);for(let i=0;i<t.fields.length;i++)s[t.fields[i].name]=t.fields[i].init(e,s);return s}reconfigure(e){let t=new jl(this.schema,e.plugins),s=t.fields,i=new zi(t);for(let r=0;r<s.length;r++){let o=s[r].name;i[o]=this.hasOwnProperty(o)?this[o]:s[r].init(e,i)}return i}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(s=>s.toJSON())),e&&typeof e=="object")for(let s in e){if(s=="doc"||s=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[s],r=i.spec.state;r&&r.toJSON&&(t[s]=r.toJSON.call(i,this[i.key]))}return t}static fromJSON(e,t,s){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new jl(e.schema,e.plugins),r=new zi(i);return i.fields.forEach(o=>{if(o.name=="doc")r.doc=Yn.fromJSON(e.schema,t.doc);else if(o.name=="selection")r.selection=Ne.fromJSON(r.doc,t.selection);else if(o.name=="storedMarks")t.storedMarks&&(r.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(s)for(let a in s){let l=s[a],d=l.spec.state;if(l.key==o.name&&d&&d.fromJSON&&Object.prototype.hasOwnProperty.call(t,a)){r[o.name]=d.fromJSON.call(l,e,t[a],r);return}}r[o.name]=o.init(e,r)}}),r}}function Wg(n,e,t){for(let s in n){let i=n[s];i instanceof Function?i=i.bind(e):s=="handleDOMEvents"&&(i=Wg(i,e,{})),t[s]=i}return t}class Ei{constructor(e){this.spec=e,this.props={},e.props&&Wg(e.props,this,this.props),this.key=e.key?e.key.key:Hg("plugin")}getState(e){return e[this.key]}}const Pl=Object.create(null);function Hg(n){return n in Pl?n+"$"+ ++Pl[n]:(Pl[n]=0,n+"$")}class kr{constructor(e="key"){this.key=Hg(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const qg=new kr("transactionEventPlugin"),Tc="prosemirrorDispatchTransaction";function _E(n,e){const{eventTarget:t}=qg.getState(n.state);return t.addEventListener(Tc,e),()=>{t.removeEventListener(Tc,e)}}function AE(n){return new Ei({key:qg,state:{init(){return{eventTarget:n}},apply(e,t){return t}}})}const Kg=(n,e)=>n.selection.empty?!1:(e&&e(n.tr.deleteSelection().scrollIntoView()),!0);function NE(n,e){let{$cursor:t}=n.selection;return!t||(e?!e.endOfTextblock("backward",n):t.parentOffset>0)?null:t}const IE=(n,e,t)=>{let s=NE(n,t);if(!s)return!1;let i=Jg(s);if(!i){let o=s.blockRange(),a=o&&Jd(o);return a==null?!1:(e&&e(n.tr.lift(o,a).scrollIntoView()),!0)}let r=i.nodeBefore;if(!r.type.spec.isolating&&e0(n,i,e))return!0;if(s.parent.content.size==0&&(ar(r,"end")||he.isSelectable(r))){let o=Yd(n.doc,s.before(),s.after(),ie.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=n.tr.step(o);a.setSelection(ar(r,"end")?Ne.findFrom(a.doc.resolve(a.mapping.map(i.pos,-1)),-1):he.create(a.doc,i.pos-r.nodeSize)),e(a.scrollIntoView())}return!0}}return r.isAtom&&i.depth==s.depth-1?(e&&e(n.tr.delete(i.pos-r.nodeSize,i.pos).scrollIntoView()),!0):!1};function ar(n,e,t=!1){for(let s=n;s;s=e=="start"?s.firstChild:s.lastChild){if(s.isTextblock)return!0;if(t&&s.childCount!=1)return!1}return!1}const RE=(n,e,t)=>{let{$head:s,empty:i}=n.selection,r=s;if(!i)return!1;if(s.parent.isTextblock){if(t?!t.endOfTextblock("backward",n):s.parentOffset>0)return!1;r=Jg(s)}let o=r&&r.nodeBefore;return!o||!he.isSelectable(o)?!1:(e&&e(n.tr.setSelection(he.create(n.doc,r.pos-o.nodeSize)).scrollIntoView()),!0)};function Jg(n){if(!n.parent.type.spec.isolating)for(let e=n.depth-1;e>=0;e--){if(n.index(e)>0)return n.doc.resolve(n.before(e+1));if(n.node(e).type.spec.isolating)break}return null}function DE(n,e){let{$cursor:t}=n.selection;return!t||(e?!e.endOfTextblock("forward",n):t.parentOffset<t.parent.content.size)?null:t}const jE=(n,e,t)=>{let s=DE(n,t);if(!s)return!1;let i=Yg(s);if(!i)return!1;let r=i.nodeAfter;if(e0(n,i,e))return!0;if(s.parent.content.size==0&&(ar(r,"start")||he.isSelectable(r))){let o=Yd(n.doc,s.before(),s.after(),ie.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=n.tr.step(o);a.setSelection(ar(r,"start")?Ne.findFrom(a.doc.resolve(a.mapping.map(i.pos)),1):he.create(a.doc,a.mapping.map(i.pos))),e(a.scrollIntoView())}return!0}}return r.isAtom&&i.depth==s.depth-1?(e&&e(n.tr.delete(i.pos,i.pos+r.nodeSize).scrollIntoView()),!0):!1},PE=(n,e,t)=>{let{$head:s,empty:i}=n.selection,r=s;if(!i)return!1;if(s.parent.isTextblock){if(t?!t.endOfTextblock("forward",n):s.parentOffset<s.parent.content.size)return!1;r=Yg(s)}let o=r&&r.nodeAfter;return!o||!he.isSelectable(o)?!1:(e&&e(n.tr.setSelection(he.create(n.doc,r.pos)).scrollIntoView()),!0)};function Yg(n){if(!n.parent.type.spec.isolating)for(let e=n.depth-1;e>=0;e--){let t=n.node(e);if(n.index(e)+1<t.childCount)return n.doc.resolve(n.after(e+1));if(t.type.spec.isolating)break}return null}const OE=(n,e)=>{let{$head:t,$anchor:s}=n.selection;return!t.parent.type.spec.code||!t.sameParent(s)?!1:(e&&e(n.tr.insertText(`
`).scrollIntoView()),!0)};function Qd(n){for(let e=0;e<n.edgeCount;e++){let{type:t}=n.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}const FE=(n,e)=>{let{$head:t,$anchor:s}=n.selection;if(!t.parent.type.spec.code||!t.sameParent(s))return!1;let i=t.node(-1),r=t.indexAfter(-1),o=Qd(i.contentMatchAt(r));if(!o||!i.canReplaceWith(r,r,o))return!1;if(e){let a=t.after(),l=n.tr.replaceWith(a,a,o.createAndFill());l.setSelection(Ne.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},Xg=(n,e)=>{let t=n.selection,{$from:s,$to:i}=t;if(t instanceof hn||s.parent.inlineContent||i.parent.inlineContent)return!1;let r=Qd(i.parent.contentMatchAt(i.indexAfter()));if(!r||!r.isTextblock)return!1;if(e){let o=(!s.parentOffset&&i.index()<i.parent.childCount?s:i).pos,a=n.tr.insert(o,r.createAndFill());a.setSelection(We.create(a.doc,o+1)),e(a.scrollIntoView())}return!0},Qg=(n,e)=>{let{$cursor:t}=n.selection;if(!t||t.parent.content.size)return!1;if(t.depth>1&&t.after()!=t.end(-1)){let r=t.before();if(Xo(n.doc,r))return e&&e(n.tr.split(r).scrollIntoView()),!0}let s=t.blockRange(),i=s&&Jd(s);return i==null?!1:(e&&e(n.tr.lift(s,i).scrollIntoView()),!0)};function LE(n){return(e,t)=>{let{$from:s,$to:i}=e.selection;if(e.selection instanceof he&&e.selection.node.isBlock)return!s.parentOffset||!Xo(e.doc,s.pos)?!1:(t&&t(e.tr.split(s.pos).scrollIntoView()),!0);if(!s.parent.isBlock)return!1;if(t){let r=i.parentOffset==i.parent.content.size,o=e.tr;(e.selection instanceof We||e.selection instanceof hn)&&o.deleteSelection();let a=s.depth==0?null:Qd(s.node(-1).contentMatchAt(s.indexAfter(-1))),l=r&&a?[{type:a}]:void 0,d=Xo(o.doc,o.mapping.map(s.pos),1,l);if(!l&&!d&&Xo(o.doc,o.mapping.map(s.pos),1,a?[{type:a}]:void 0)&&(a&&(l=[{type:a}]),d=!0),d&&(o.split(o.mapping.map(s.pos),1,l),!r&&!s.parentOffset&&s.parent.type!=a)){let u=o.mapping.map(s.before()),f=o.doc.resolve(u);a&&s.node(-1).canReplaceWith(f.index(),f.index()+1,a)&&o.setNodeMarkup(o.mapping.map(s.before()),a)}t(o.scrollIntoView())}return!0}}const Zg=LE(),BE=(n,e)=>(e&&e(n.tr.setSelection(new hn(n.doc))),!0);function UE(n,e,t){let s=e.nodeBefore,i=e.nodeAfter,r=e.index();return!s||!i||!s.type.compatibleContent(i.type)?!1:!s.content.size&&e.parent.canReplace(r-1,r)?(t&&t(n.tr.delete(e.pos-s.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(r,r+1)||!(i.isTextblock||Ug(n.doc,e.pos))?!1:(t&&t(n.tr.clearIncompatible(e.pos,s.type,s.contentMatchAt(s.childCount)).join(e.pos).scrollIntoView()),!0)}function e0(n,e,t){let s=e.nodeBefore,i=e.nodeAfter,r,o;if(s.type.spec.isolating||i.type.spec.isolating)return!1;if(UE(n,e,t))return!0;let a=e.parent.canReplace(e.index(),e.index()+1);if(a&&(r=(o=s.contentMatchAt(s.childCount)).findWrapping(i.type))&&o.matchType(r[0]||i.type).validEnd){if(t){let f=e.pos+i.nodeSize,h=K.empty;for(let y=r.length-1;y>=0;y--)h=K.from(r[y].create(null,h));h=K.from(s.copy(h));let g=n.tr.step(new fn(e.pos-1,f,e.pos,f,new ie(h,1,0),r.length,!0)),x=f+2*r.length;Ug(g.doc,x)&&g.join(x),t(g.scrollIntoView())}return!0}let l=Ne.findFrom(e,1),d=l&&l.$from.blockRange(l.$to),u=d&&Jd(d);if(u!=null&&u>=e.depth)return t&&t(n.tr.lift(d,u).scrollIntoView()),!0;if(a&&ar(i,"start",!0)&&ar(s,"end")){let f=s,h=[];for(;h.push(f),!f.isTextblock;)f=f.lastChild;let g=i,x=1;for(;!g.isTextblock;g=g.firstChild)x++;if(f.canReplace(f.childCount,f.childCount,g.content)){if(t){let y=K.empty;for(let S=h.length-1;S>=0;S--)y=K.from(h[S].copy(y));let w=n.tr.step(new fn(e.pos-h.length,e.pos+i.nodeSize,e.pos+x,e.pos+i.nodeSize-x,new ie(y,h.length,0),0,!0));t(w.scrollIntoView())}return!0}}return!1}function t0(n){return function(e,t){let s=e.selection,i=n<0?s.$from:s.$to,r=i.depth;for(;i.node(r).isInline;){if(!r)return!1;r--}return i.node(r).isTextblock?(t&&t(e.tr.setSelection(We.create(e.doc,n<0?i.start(r):i.end(r)))),!0):!1}}const zE=t0(-1),VE=t0(1);function q5(n,e=null){return function(t,s){let{$from:i,$to:r}=t.selection,o=i.blockRange(r),a=o&&sE(o,n,e);return a?(s&&s(t.tr.wrap(o,a).scrollIntoView()),!0):!1}}function K5(n,e=null){return function(t,s){let i=!1;for(let r=0;r<t.selection.ranges.length&&!i;r++){let{$from:{pos:o},$to:{pos:a}}=t.selection.ranges[r];t.doc.nodesBetween(o,a,(l,d)=>{if(i)return!1;if(!(!l.isTextblock||l.hasMarkup(n,e)))if(l.type==n)i=!0;else{let u=t.doc.resolve(d),f=u.index();i=u.parent.canReplaceWith(f,f+1,n)}})}if(!i)return!1;if(s){let r=t.tr;for(let o=0;o<t.selection.ranges.length;o++){let{$from:{pos:a},$to:{pos:l}}=t.selection.ranges[o];r.setBlockType(a,l,n,e)}s(r.scrollIntoView())}return!0}}function GE(n,e,t){for(let s=0;s<e.length;s++){let{$from:i,$to:r}=e[s],o=i.depth==0?n.inlineContent&&n.type.allowsMarkType(t):!1;if(n.nodesBetween(i.pos,r.pos,a=>{if(o)return!1;o=a.inlineContent&&a.type.allowsMarkType(t)}),o)return!0}return!1}function J5(n,e=null){return function(t,s){let{empty:i,$cursor:r,ranges:o}=t.selection;if(i&&!r||!GE(t.doc,o,n))return!1;if(s)if(r)n.isInSet(t.storedMarks||r.marks())?s(t.tr.removeStoredMark(n)):s(t.tr.addStoredMark(n.create(e)));else{let a=!1,l=t.tr;for(let d=0;!a&&d<o.length;d++){let{$from:u,$to:f}=o[d];a=t.doc.rangeHasMark(u.pos,f.pos,n)}for(let d=0;d<o.length;d++){let{$from:u,$to:f}=o[d];if(a)l.removeMark(u.pos,f.pos,n);else{let h=u.pos,g=f.pos,x=u.nodeAfter,y=f.nodeBefore,w=x&&x.isText?/^\s*/.exec(x.text)[0].length:0,S=y&&y.isText?/\s*$/.exec(y.text)[0].length:0;h+w<g&&(h+=w,g-=S),l.addMark(h,g,n.create(e))}}s(l.scrollIntoView())}return!0}}function sl(...n){return function(e,t,s){for(let i=0;i<n.length;i++)if(n[i](e,t,s))return!0;return!1}}let Ol=sl(Kg,IE,RE),jf=sl(Kg,jE,PE);const ds={Enter:sl(OE,Xg,Qg,Zg),"Mod-Enter":FE,Backspace:Ol,"Mod-Backspace":Ol,"Shift-Backspace":Ol,Delete:jf,"Mod-Delete":jf,"Mod-a":BE},n0={"Ctrl-h":ds.Backspace,"Alt-Backspace":ds["Mod-Backspace"],"Ctrl-d":ds.Delete,"Ctrl-Alt-Backspace":ds["Mod-Delete"],"Alt-Delete":ds["Mod-Delete"],"Alt-d":ds["Mod-Delete"],"Ctrl-a":zE,"Ctrl-e":VE};for(let n in ds)n0[n]=ds[n];const $E=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform?os.platform()=="darwin":!1,WE=$E?n0:ds;function s0(n){let e="",t=!1;function s(i){if(t=!1,i.type.name==="paragraph")return i.descendants(r=>s(r)),e+=`
`,t=!0,!1;i.isText&&(e+=i.text)}return n.descendants(i=>s(i)),t&&e.endsWith(`
`)&&(e=e.slice(0,-1)),e}function HE(n){return s0(n.state.doc)}const Ec=sl(Xg,Qg,Zg);function qE(n,e){const t=n.state.schema;e.split(`
`).forEach((s,i)=>{if(i===0)n.dispatch(n.state.tr.insertText(s));else{Ec(n.state,n.dispatch);const r=s?t.nodes.paragraph.create(null,t.text(s)):t.nodes.paragraph.create();n.dispatch(n.state.tr.replaceSelectionWith(r))}})}const Wi=new kr("menuSelectorPlugin");function KE(n){n.dispatch(n.state.tr.setMeta(Wi,{active:!1,onMenuAction:void 0}))}function JE(n,e){n.dispatch(n.state.tr.setMeta(Wi,{active:!0,onMenuAction:e}))}function YE(n={submitKeys:["Enter","Tab"],cancelKeys:["Escape"],checkStrictMatchKeys:[]}){return new Ei({key:Wi,state:{init(){return{...n,active:!1}},apply(e,t){const s=e.getMeta(Wi);return s?{...t,...s}:t}},props:{handleKeyDown(e,t){var i,r,o,a,l;const s=Wi.getState(e.state);return s.active?s.submitKeys.includes(t.key)?(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),(i=s.onMenuAction)==null||i.call(s,"submit"),KE(e),!0):s.cancelKeys.includes(t.key)?(t.preventDefault(),(r=s.onMenuAction)==null||r.call(s,"cancel"),JE(e,s.onMenuAction),!0):t.key==="ArrowUp"?(t.preventDefault(),(o=s.onMenuAction)==null||o.call(s,"up"),!0):t.key==="ArrowDown"?(t.preventDefault(),(a=s.onMenuAction)==null||a.call(s,"down"),!0):(s.checkStrictMatchKeys.includes(t.key)&&((l=s.onMenuAction)==null||l.call(s,"checkMatch")),!1):!1}}})}const It=function(n){for(var e=0;;e++)if(n=n.previousSibling,!n)return e},Zr=function(n){let e=n.assignedSlot||n.parentNode;return e&&e.nodeType==11?e.host:e};let _c=null;const ls=function(n,e,t){let s=_c||(_c=document.createRange());return s.setEnd(n,t??n.nodeValue.length),s.setStart(n,e||0),s},XE=function(){_c=null},ki=function(n,e,t,s){return t&&(Pf(n,e,t,s,-1)||Pf(n,e,t,s,1))},QE=/^(img|br|input|textarea|hr)$/i;function Pf(n,e,t,s,i){for(;;){if(n==t&&e==s)return!0;if(e==(i<0?0:qn(n))){let r=n.parentNode;if(!r||r.nodeType!=1||xo(n)||QE.test(n.nodeName)||n.contentEditable=="false")return!1;e=It(n)+(i<0?0:1),n=r}else if(n.nodeType==1){if(n=n.childNodes[e+(i<0?-1:0)],n.contentEditable=="false")return!1;e=i<0?qn(n):0}else return!1}}function qn(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function ZE(n,e){for(;;){if(n.nodeType==3&&e)return n;if(n.nodeType==1&&e>0){if(n.contentEditable=="false")return null;n=n.childNodes[e-1],e=qn(n)}else if(n.parentNode&&!xo(n))e=It(n),n=n.parentNode;else return null}}function e_(n,e){for(;;){if(n.nodeType==3&&e<n.nodeValue.length)return n;if(n.nodeType==1&&e<n.childNodes.length){if(n.contentEditable=="false")return null;n=n.childNodes[e],e=0}else if(n.parentNode&&!xo(n))e=It(n)+1,n=n.parentNode;else return null}}function t_(n,e,t){for(let s=e==0,i=e==qn(n);s||i;){if(n==t)return!0;let r=It(n);if(n=n.parentNode,!n)return!1;s=s&&r==0,i=i&&r==qn(n)}}function xo(n){let e;for(let t=n;t&&!(e=t.pmViewDesc);t=t.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==n||e.contentDOM==n)}const il=function(n){return n.focusNode&&ki(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)};function ii(n,e){let t=document.createEvent("Event");return t.initEvent("keydown",!0,!0),t.keyCode=n,t.key=t.code=e,t}function n_(n){let e=n.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function s_(n,e,t){if(n.caretPositionFromPoint)try{let s=n.caretPositionFromPoint(e,t);if(s)return{node:s.offsetNode,offset:s.offset}}catch{}if(n.caretRangeFromPoint){let s=n.caretRangeFromPoint(e,t);if(s)return{node:s.startContainer,offset:s.startOffset}}}const Zn=typeof navigator<"u"?navigator:null,Of=typeof document<"u"?document:null,qs=Zn&&Zn.userAgent||"",Ac=/Edge\/(\d+)/.exec(qs),i0=/MSIE \d/.exec(qs),Nc=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(qs),Zt=!!(i0||Nc||Ac),Ls=i0?document.documentMode:Nc?+Nc[1]:Ac?+Ac[1]:0,Fn=!Zt&&/gecko\/(\d+)/i.test(qs);Fn&&+(/Firefox\/(\d+)/.exec(qs)||[0,0])[1];const Ic=!Zt&&/Chrome\/(\d+)/.exec(qs),Bt=!!Ic,r0=Ic?+Ic[1]:0,Kt=!Zt&&!!Zn&&/Apple Computer/.test(Zn.vendor),lr=Kt&&(/Mobile\/\w+/.test(qs)||!!Zn&&Zn.maxTouchPoints>2),xn=lr||(Zn?/Mac/.test(Zn.platform):!1),i_=Zn?/Win/.test(Zn.platform):!1,Dn=/Android \d/.test(qs),yo=!!Of&&"webkitFontSmoothing"in Of.documentElement.style,r_=yo?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function o_(n){let e=n.defaultView&&n.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:n.documentElement.clientWidth,top:0,bottom:n.documentElement.clientHeight}}function as(n,e){return typeof n=="number"?n:n[e]}function a_(n){let e=n.getBoundingClientRect(),t=e.width/n.offsetWidth||1,s=e.height/n.offsetHeight||1;return{left:e.left,right:e.left+n.clientWidth*t,top:e.top,bottom:e.top+n.clientHeight*s}}function Ff(n,e,t){let s=n.someProp("scrollThreshold")||0,i=n.someProp("scrollMargin")||5,r=n.dom.ownerDocument;for(let o=t||n.dom;o;o=Zr(o)){if(o.nodeType!=1)continue;let a=o,l=a==r.body,d=l?o_(r):a_(a),u=0,f=0;if(e.top<d.top+as(s,"top")?f=-(d.top-e.top+as(i,"top")):e.bottom>d.bottom-as(s,"bottom")&&(f=e.bottom-e.top>d.bottom-d.top?e.top+as(i,"top")-d.top:e.bottom-d.bottom+as(i,"bottom")),e.left<d.left+as(s,"left")?u=-(d.left-e.left+as(i,"left")):e.right>d.right-as(s,"right")&&(u=e.right-d.right+as(i,"right")),u||f)if(l)r.defaultView.scrollBy(u,f);else{let h=a.scrollLeft,g=a.scrollTop;f&&(a.scrollTop+=f),u&&(a.scrollLeft+=u);let x=a.scrollLeft-h,y=a.scrollTop-g;e={left:e.left-x,top:e.top-y,right:e.right-x,bottom:e.bottom-y}}if(l||/^(fixed|sticky)$/.test(getComputedStyle(o).position))break}}function l_(n){let e=n.dom.getBoundingClientRect(),t=Math.max(0,e.top),s,i;for(let r=(e.left+e.right)/2,o=t+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=n.root.elementFromPoint(r,o);if(!a||a==n.dom||!n.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=t-20){s=a,i=l.top;break}}return{refDOM:s,refTop:i,stack:o0(n.dom)}}function o0(n){let e=[],t=n.ownerDocument;for(let s=n;s&&(e.push({dom:s,top:s.scrollTop,left:s.scrollLeft}),n!=t);s=Zr(s));return e}function c_({refDOM:n,refTop:e,stack:t}){let s=n?n.getBoundingClientRect().top:0;a0(t,s==0?0:s-e)}function a0(n,e){for(let t=0;t<n.length;t++){let{dom:s,top:i,left:r}=n[t];s.scrollTop!=i+e&&(s.scrollTop=i+e),s.scrollLeft!=r&&(s.scrollLeft=r)}}let Oi=null;function d_(n){if(n.setActive)return n.setActive();if(Oi)return n.focus(Oi);let e=o0(n);n.focus(Oi==null?{get preventScroll(){return Oi={preventScroll:!0},!0}}:void 0),Oi||(Oi=!1,a0(e,0))}function l0(n,e){let t,s=2e8,i,r=0,o=e.top,a=e.top,l,d;for(let u=n.firstChild,f=0;u;u=u.nextSibling,f++){let h;if(u.nodeType==1)h=u.getClientRects();else if(u.nodeType==3)h=ls(u).getClientRects();else continue;for(let g=0;g<h.length;g++){let x=h[g];if(x.top<=o&&x.bottom>=a){o=Math.max(x.bottom,o),a=Math.min(x.top,a);let y=x.left>e.left?x.left-e.left:x.right<e.left?e.left-x.right:0;if(y<s){t=u,s=y,i=y&&t.nodeType==3?{left:x.right<e.left?x.right:x.left,top:e.top}:e,u.nodeType==1&&y&&(r=f+(e.left>=(x.left+x.right)/2?1:0));continue}}else x.top>e.top&&!l&&x.left<=e.left&&x.right>=e.left&&(l=u,d={left:Math.max(x.left,Math.min(x.right,e.left)),top:x.top});!t&&(e.left>=x.right&&e.top>=x.top||e.left>=x.left&&e.top>=x.bottom)&&(r=f+1)}}return!t&&l&&(t=l,i=d,s=0),t&&t.nodeType==3?u_(t,i):!t||s&&t.nodeType==1?{node:n,offset:r}:l0(t,i)}function u_(n,e){let t=n.nodeValue.length,s=document.createRange();for(let i=0;i<t;i++){s.setEnd(n,i+1),s.setStart(n,i);let r=Cs(s,1);if(r.top!=r.bottom&&Zd(e,r))return{node:n,offset:i+(e.left>=(r.left+r.right)/2?1:0)}}return{node:n,offset:0}}function Zd(n,e){return n.left>=e.left-1&&n.left<=e.right+1&&n.top>=e.top-1&&n.top<=e.bottom+1}function f_(n,e){let t=n.parentNode;return t&&/^li$/i.test(t.nodeName)&&e.left<n.getBoundingClientRect().left?t:n}function h_(n,e,t){let{node:s,offset:i}=l0(e,t),r=-1;if(s.nodeType==1&&!s.firstChild){let o=s.getBoundingClientRect();r=o.left!=o.right&&t.left>(o.left+o.right)/2?1:-1}return n.docView.posFromDOM(s,i,r)}function p_(n,e,t,s){let i=-1;for(let r=e,o=!1;r!=n.dom;){let a=n.docView.nearestDesc(r,!0);if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)){let l=a.dom.getBoundingClientRect();if(a.node.isBlock&&a.parent&&(!o&&l.left>s.left||l.top>s.top?i=a.posBefore:(!o&&l.right<s.left||l.bottom<s.top)&&(i=a.posAfter),o=!0),!a.contentDOM&&i<0&&!a.node.isText)return(a.node.isBlock?s.top<(l.top+l.bottom)/2:s.left<(l.left+l.right)/2)?a.posBefore:a.posAfter}r=a.dom.parentNode}return i>-1?i:n.docView.posFromDOM(e,t,-1)}function c0(n,e,t){let s=n.childNodes.length;if(s&&t.top<t.bottom)for(let i=Math.max(0,Math.min(s-1,Math.floor(s*(e.top-t.top)/(t.bottom-t.top))-2)),r=i;;){let o=n.childNodes[r];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let d=a[l];if(Zd(e,d))return c0(o,e,d)}}if((r=(r+1)%s)==i)break}return n}function m_(n,e){let t=n.dom.ownerDocument,s,i=0,r=s_(t,e.left,e.top);r&&({node:s,offset:i}=r);let o=(n.root.elementFromPoint?n.root:t).elementFromPoint(e.left,e.top),a;if(!o||!n.dom.contains(o.nodeType!=1?o.parentNode:o)){let d=n.dom.getBoundingClientRect();if(!Zd(e,d)||(o=c0(n.dom,e,d),!o))return null}if(Kt)for(let d=o;s&&d;d=Zr(d))d.draggable&&(s=void 0);if(o=f_(o,e),s){if(Fn&&s.nodeType==1&&(i=Math.min(i,s.childNodes.length),i<s.childNodes.length)){let u=s.childNodes[i],f;u.nodeName=="IMG"&&(f=u.getBoundingClientRect()).right<=e.left&&f.bottom>e.top&&i++}let d;yo&&i&&s.nodeType==1&&(d=s.childNodes[i-1]).nodeType==1&&d.contentEditable=="false"&&d.getBoundingClientRect().top>=e.top&&i--,s==n.dom&&i==s.childNodes.length-1&&s.lastChild.nodeType==1&&e.top>s.lastChild.getBoundingClientRect().bottom?a=n.state.doc.content.size:(i==0||s.nodeType!=1||s.childNodes[i-1].nodeName!="BR")&&(a=p_(n,s,i,e))}a==null&&(a=h_(n,o,e));let l=n.docView.nearestDesc(o,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function Lf(n){return n.top<n.bottom||n.left<n.right}function Cs(n,e){let t=n.getClientRects();if(t.length){let s=t[e<0?0:t.length-1];if(Lf(s))return s}return Array.prototype.find.call(t,Lf)||n.getBoundingClientRect()}const g_=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function d0(n,e,t){let{node:s,offset:i,atom:r}=n.docView.domFromPos(e,t<0?-1:1),o=yo||Fn;if(s.nodeType==3)if(o&&(g_.test(s.nodeValue)||(t<0?!i:i==s.nodeValue.length))){let l=Cs(ls(s,i,i),t);if(Fn&&i&&/\s/.test(s.nodeValue[i-1])&&i<s.nodeValue.length){let d=Cs(ls(s,i-1,i-1),-1);if(d.top==l.top){let u=Cs(ls(s,i,i+1),-1);if(u.top!=l.top)return Er(u,u.left<d.left)}}return l}else{let l=i,d=i,u=t<0?1:-1;return t<0&&!i?(d++,u=-1):t>=0&&i==s.nodeValue.length?(l--,u=1):t<0?l--:d++,Er(Cs(ls(s,l,d),u),u<0)}if(!n.state.doc.resolve(e-(r||0)).parent.inlineContent){if(r==null&&i&&(t<0||i==qn(s))){let l=s.childNodes[i-1];if(l.nodeType==1)return Fl(l.getBoundingClientRect(),!1)}if(r==null&&i<qn(s)){let l=s.childNodes[i];if(l.nodeType==1)return Fl(l.getBoundingClientRect(),!0)}return Fl(s.getBoundingClientRect(),t>=0)}if(r==null&&i&&(t<0||i==qn(s))){let l=s.childNodes[i-1],d=l.nodeType==3?ls(l,qn(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(d)return Er(Cs(d,1),!1)}if(r==null&&i<qn(s)){let l=s.childNodes[i];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let d=l?l.nodeType==3?ls(l,0,o?0:1):l.nodeType==1?l:null:null;if(d)return Er(Cs(d,-1),!0)}return Er(Cs(s.nodeType==3?ls(s):s,-t),t>=0)}function Er(n,e){if(n.width==0)return n;let t=e?n.left:n.right;return{top:n.top,bottom:n.bottom,left:t,right:t}}function Fl(n,e){if(n.height==0)return n;let t=e?n.top:n.bottom;return{top:t,bottom:t,left:n.left,right:n.right}}function u0(n,e,t){let s=n.state,i=n.root.activeElement;s!=e&&n.updateState(e),i!=n.dom&&n.focus();try{return t()}finally{s!=e&&n.updateState(s),i!=n.dom&&i&&i.focus()}}function x_(n,e,t){let s=e.selection,i=t=="up"?s.$from:s.$to;return u0(n,e,()=>{let{node:r}=n.docView.domFromPos(i.pos,t=="up"?-1:1);for(;;){let a=n.docView.nearestDesc(r,!0);if(!a)break;if(a.node.isBlock){r=a.contentDOM||a.dom;break}r=a.dom.parentNode}let o=d0(n,i.pos,1);for(let a=r.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=ls(a,0,a.nodeValue.length).getClientRects();else continue;for(let d=0;d<l.length;d++){let u=l[d];if(u.bottom>u.top+1&&(t=="up"?o.top-u.top>(u.bottom-o.top)*2:u.bottom-o.bottom>(o.bottom-u.top)*2))return!1}}return!0})}const y_=/[\u0590-\u08ac]/;function b_(n,e,t){let{$head:s}=e.selection;if(!s.parent.isTextblock)return!1;let i=s.parentOffset,r=!i,o=i==s.parent.content.size,a=n.domSelection();return!y_.test(s.parent.textContent)||!a.modify?t=="left"||t=="backward"?r:o:u0(n,e,()=>{let{focusNode:l,focusOffset:d,anchorNode:u,anchorOffset:f}=n.domSelectionRange(),h=a.caretBidiLevel;a.modify("move",t,"character");let g=s.depth?n.docView.domAfterPos(s.before()):n.dom,{focusNode:x,focusOffset:y}=n.domSelectionRange(),w=x&&!g.contains(x.nodeType==1?x:x.parentNode)||l==x&&d==y;try{a.collapse(u,f),l&&(l!=u||d!=f)&&a.extend&&a.extend(l,d)}catch{}return h!=null&&(a.caretBidiLevel=h),w})}let Bf=null,Uf=null,zf=!1;function k_(n,e,t){return Bf==e&&Uf==t?zf:(Bf=e,Uf=t,zf=t=="up"||t=="down"?x_(n,e,t):b_(n,e,t))}const kn=0,Vf=1,oi=2,es=3;class bo{constructor(e,t,s,i){this.parent=e,this.children=t,this.dom=s,this.contentDOM=i,this.dirty=kn,s.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,s){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,s=this.posAtStart;;t++){let i=this.children[t];if(i==e)return s;s+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,s){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(s<0){let r,o;if(e==this.contentDOM)r=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;r=e.previousSibling}for(;r&&!((o=r.pmViewDesc)&&o.parent==this);)r=r.previousSibling;return r?this.posBeforeChild(o)+o.size:this.posAtStart}else{let r,o;if(e==this.contentDOM)r=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;r=e.nextSibling}for(;r&&!((o=r.pmViewDesc)&&o.parent==this);)r=r.nextSibling;return r?this.posBeforeChild(o):this.posAtEnd}let i;if(e==this.dom&&this.contentDOM)i=t>It(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(t==0)for(let r=e;;r=r.parentNode){if(r==this.dom){i=!1;break}if(r.previousSibling)break}if(i==null&&t==e.childNodes.length)for(let r=e;;r=r.parentNode){if(r==this.dom){i=!0;break}if(r.nextSibling)break}}return i??s>0?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let s=!0,i=e;i;i=i.parentNode){let r=this.getDesc(i),o;if(r&&(!t||r.node))if(s&&(o=r.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))s=!1;else return r}}getDesc(e){let t=e.pmViewDesc;for(let s=t;s;s=s.parent)if(s==this)return t}posFromDOM(e,t,s){for(let i=e;i;i=i.parentNode){let r=this.getDesc(i);if(r)return r.localPosFromDOM(e,t,s)}return-1}descAt(e){for(let t=0,s=0;t<this.children.length;t++){let i=this.children[t],r=s+i.size;if(s==e&&r!=s){for(;!i.border&&i.children.length;)i=i.children[0];return i}if(e<r)return i.descAt(e-s-i.border);s=r}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let s=0,i=0;for(let r=0;s<this.children.length;s++){let o=this.children[s],a=r+o.size;if(a>e||o instanceof h0){i=e-r;break}r=a}if(i)return this.children[s].domFromPos(i-this.children[s].border,t);for(let r;s&&!(r=this.children[s-1]).size&&r instanceof f0&&r.side>=0;s--);if(t<=0){let r,o=!0;for(;r=s?this.children[s-1]:null,!(!r||r.dom.parentNode==this.contentDOM);s--,o=!1);return r&&t&&o&&!r.border&&!r.domAtom?r.domFromPos(r.size,t):{node:this.contentDOM,offset:r?It(r.dom)+1:0}}else{let r,o=!0;for(;r=s<this.children.length?this.children[s]:null,!(!r||r.dom.parentNode==this.contentDOM);s++,o=!1);return r&&o&&!r.border&&!r.domAtom?r.domFromPos(0,t):{node:this.contentDOM,offset:r?It(r.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,s=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,r=-1;for(let o=s,a=0;;a++){let l=this.children[a],d=o+l.size;if(i==-1&&e<=d){let u=o+l.border;if(e>=u&&t<=d-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,t,u);e=o;for(let f=a;f>0;f--){let h=this.children[f-1];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(1)){i=It(h.dom)+1;break}e-=h.size}i==-1&&(i=0)}if(i>-1&&(d>t||a==this.children.length-1)){t=d;for(let u=a+1;u<this.children.length;u++){let f=this.children[u];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(-1)){r=It(f.dom);break}t+=f.size}r==-1&&(r=this.contentDOM.childNodes.length);break}o=d}return{node:this.contentDOM,from:e,to:t,fromOffset:i,toOffset:r}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return t.size==0||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:s}=this.domFromPos(e,0);if(t.nodeType!=1||s==t.childNodes.length)throw new RangeError("No node after pos "+e);return t.childNodes[s]}setSelection(e,t,s,i=!1){let r=Math.min(e,t),o=Math.max(e,t);for(let h=0,g=0;h<this.children.length;h++){let x=this.children[h],y=g+x.size;if(r>g&&o<y)return x.setSelection(e-g-x.border,t-g-x.border,s,i);g=y}let a=this.domFromPos(e,e?-1:1),l=t==e?a:this.domFromPos(t,t?-1:1),d=s.getSelection(),u=!1;if((Fn||Kt)&&e==t){let{node:h,offset:g}=a;if(h.nodeType==3){if(u=!!(g&&h.nodeValue[g-1]==`
`),u&&g==h.nodeValue.length)for(let x=h,y;x;x=x.parentNode){if(y=x.nextSibling){y.nodeName=="BR"&&(a=l={node:y.parentNode,offset:It(y)+1});break}let w=x.pmViewDesc;if(w&&w.node&&w.node.isBlock)break}}else{let x=h.childNodes[g-1];u=x&&(x.nodeName=="BR"||x.contentEditable=="false")}}if(Fn&&d.focusNode&&d.focusNode!=l.node&&d.focusNode.nodeType==1){let h=d.focusNode.childNodes[d.focusOffset];h&&h.contentEditable=="false"&&(i=!0)}if(!(i||u&&Kt)&&ki(a.node,a.offset,d.anchorNode,d.anchorOffset)&&ki(l.node,l.offset,d.focusNode,d.focusOffset))return;let f=!1;if((d.extend||e==t)&&!u){d.collapse(a.node,a.offset);try{e!=t&&d.extend(l.node,l.offset),f=!0}catch{}}if(!f){if(e>t){let g=a;a=l,l=g}let h=document.createRange();h.setEnd(l.node,l.offset),h.setStart(a.node,a.offset),d.removeAllRanges(),d.addRange(h)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let s=0,i=0;i<this.children.length;i++){let r=this.children[i],o=s+r.size;if(s==o?e<=o&&t>=s:e<o&&t>s){let a=s+r.border,l=o-r.border;if(e>=a&&t<=l){this.dirty=e==s||t==o?oi:Vf,e==a&&t==l&&(r.contentLost||r.dom.parentNode!=this.contentDOM)?r.dirty=es:r.markDirty(e-a,t-a);return}else r.dirty=r.dom==r.contentDOM&&r.dom.parentNode==this.contentDOM&&!r.children.length?oi:es}s=o}this.dirty=oi}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let s=e==1?oi:Vf;t.dirty<s&&(t.dirty=s)}}get domAtom(){return!1}get ignoreForCoords(){return!1}isText(e){return!1}}class f0 extends bo{constructor(e,t,s,i){let r,o=t.type.toDOM;if(typeof o=="function"&&(o=o(s,()=>{if(!r)return i;if(r.parent)return r.parent.posBeforeChild(r)})),!t.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=t,this.widget=t,r=this}matchesWidget(e){return this.dirty==kn&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return t?t(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class w_ extends bo{constructor(e,t,s,i){super(e,[],t,null),this.textDOM=s,this.text=i}get size(){return this.text.length}localPosFromDOM(e,t){return e!=this.textDOM?this.posAtStart+(t?this.size:0):this.posAtStart+t}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class wi extends bo{constructor(e,t,s,i){super(e,[],s,i),this.mark=t}static create(e,t,s,i){let r=i.nodeViews[t.type.name],o=r&&r(t,i,s);return(!o||!o.dom)&&(o=br.renderSpec(document,t.type.spec.toDOM(t,s),null,t.attrs)),new wi(e,t,o.dom,o.contentDOM||o.dom)}parseRule(){return this.dirty&es||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=es&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),this.dirty!=kn){let s=this.parent;for(;!s.node;)s=s.parent;s.dirty<this.dirty&&(s.dirty=this.dirty),this.dirty=kn}}slice(e,t,s){let i=wi.create(this.parent,this.mark,!0,s),r=this.children,o=this.size;t<o&&(r=jc(r,t,o,s)),e>0&&(r=jc(r,0,e,s));for(let a=0;a<r.length;a++)r[a].parent=i;return i.children=r,i}}class Bs extends bo{constructor(e,t,s,i,r,o,a,l,d){super(e,[],r,o),this.node=t,this.outerDeco=s,this.innerDeco=i,this.nodeDOM=a}static create(e,t,s,i,r,o){let a=r.nodeViews[t.type.name],l,d=a&&a(t,r,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},s,i),u=d&&d.dom,f=d&&d.contentDOM;if(t.isText){if(!u)u=document.createTextNode(t.text);else if(u.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else u||({dom:u,contentDOM:f}=br.renderSpec(document,t.type.spec.toDOM(t),null,t.attrs));!f&&!t.isText&&u.nodeName!="BR"&&(u.hasAttribute("contenteditable")||(u.contentEditable="false"),t.type.spec.draggable&&(u.draggable=!0));let h=u;return u=g0(u,s,t),d?l=new v_(e,t,s,i,u,f||null,h,d,r,o+1):t.isText?new rl(e,t,s,i,u,h,r):new Bs(e,t,s,i,u,f||null,h,r,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let t=this.children.length-1;t>=0;t--){let s=this.children[t];if(this.dom.contains(s.dom.parentNode)){e.contentElement=s.dom.parentNode;break}}e.contentElement||(e.getContent=()=>K.empty)}return e}matchesNode(e,t,s){return this.dirty==kn&&e.eq(this.node)&&Dc(t,this.outerDeco)&&s.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let s=this.node.inlineContent,i=t,r=e.composing?this.localCompositionInfo(e,t):null,o=r&&r.pos>-1?r:null,a=r&&r.pos<0,l=new C_(this,o&&o.node,e);E_(this.node,this.innerDeco,(d,u,f)=>{d.spec.marks?l.syncToMarks(d.spec.marks,s,e):d.type.side>=0&&!f&&l.syncToMarks(u==this.node.childCount?Be.none:this.node.child(u).marks,s,e),l.placeWidget(d,e,i)},(d,u,f,h)=>{l.syncToMarks(d.marks,s,e);let g;l.findNodeMatch(d,u,f,h)||a&&e.state.selection.from>i&&e.state.selection.to<i+d.nodeSize&&(g=l.findIndexWithChild(r.node))>-1&&l.updateNodeAt(d,u,f,g,e)||l.updateNextNode(d,u,f,e,h,i)||l.addNode(d,u,f,e,i),i+=d.nodeSize}),l.syncToMarks([],s,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==oi)&&(o&&this.protectLocalComposition(e,o),p0(this.contentDOM,this.children,e),lr&&__(this.dom))}localCompositionInfo(e,t){let{from:s,to:i}=e.state.selection;if(!(e.state.selection instanceof We)||s<t||i>t+this.node.content.size)return null;let r=e.input.compositionNode;if(!r||!this.dom.contains(r.parentNode))return null;if(this.node.inlineContent){let o=r.nodeValue,a=A_(this.node.content,o,s-t,i-t);return a<0?null:{node:r,pos:a,text:o}}else return{node:r,pos:-1,text:""}}protectLocalComposition(e,{node:t,pos:s,text:i}){if(this.getDesc(t))return;let r=t;for(;r.parentNode!=this.contentDOM;r=r.parentNode){for(;r.previousSibling;)r.parentNode.removeChild(r.previousSibling);for(;r.nextSibling;)r.parentNode.removeChild(r.nextSibling);r.pmViewDesc&&(r.pmViewDesc=void 0)}let o=new w_(this,r,t,i);e.input.compositionNodes.push(o),this.children=jc(this.children,s,s+i.length,e,o)}update(e,t,s,i){return this.dirty==es||!e.sameMarkup(this.node)?!1:(this.updateInner(e,t,s,i),!0)}updateInner(e,t,s,i){this.updateOuterDeco(t),this.node=e,this.innerDeco=s,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=kn}updateOuterDeco(e){if(Dc(e,this.outerDeco))return;let t=this.nodeDOM.nodeType!=1,s=this.dom;this.dom=m0(this.dom,this.nodeDOM,Rc(this.outerDeco,this.node,t),Rc(e,this.node,t)),this.dom!=s&&(s.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function Gf(n,e,t,s,i){g0(s,e,n);let r=new Bs(void 0,n,e,t,s,s,s,i,0);return r.contentDOM&&r.updateChildren(i,0),r}class rl extends Bs{constructor(e,t,s,i,r,o,a){super(e,t,s,i,r,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,t,s,i){return this.dirty==es||this.dirty!=kn&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(t),(this.dirty!=kn||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=kn,!0)}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,s){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,s)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,t,s){let i=this.node.cut(e,t),r=document.createTextNode(i.text);return new rl(this.parent,i,this.outerDeco,this.innerDeco,r,r,s)}markDirty(e,t){super.markDirty(e,t),this.dom!=this.nodeDOM&&(e==0||t==this.nodeDOM.nodeValue.length)&&(this.dirty=es)}get domAtom(){return!1}isText(e){return this.node.text==e}}class h0 extends bo{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==kn&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class v_ extends Bs{constructor(e,t,s,i,r,o,a,l,d,u){super(e,t,s,i,r,o,a,d,u),this.spec=l}update(e,t,s,i){if(this.dirty==es)return!1;if(this.spec.update){let r=this.spec.update(e,t,s);return r&&this.updateInner(e,t,s,i),r}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,t,s,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,s,i){this.spec.setSelection?this.spec.setSelection(e,t,s):super.setSelection(e,t,s,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function p0(n,e,t){let s=n.firstChild,i=!1;for(let r=0;r<e.length;r++){let o=e[r],a=o.dom;if(a.parentNode==n){for(;a!=s;)s=$f(s),i=!0;s=s.nextSibling}else i=!0,n.insertBefore(a,s);if(o instanceof wi){let l=s?s.previousSibling:n.lastChild;p0(o.contentDOM,o.children,t),s=l?l.nextSibling:n.firstChild}}for(;s;)s=$f(s),i=!0;i&&t.trackWrites==n&&(t.trackWrites=null)}const zr=function(n){n&&(this.nodeName=n)};zr.prototype=Object.create(null);const ai=[new zr];function Rc(n,e,t){if(n.length==0)return ai;let s=t?ai[0]:new zr,i=[s];for(let r=0;r<n.length;r++){let o=n[r].type.attrs;if(o){o.nodeName&&i.push(s=new zr(o.nodeName));for(let a in o){let l=o[a];l!=null&&(t&&i.length==1&&i.push(s=new zr(e.isInline?"span":"div")),a=="class"?s.class=(s.class?s.class+" ":"")+l:a=="style"?s.style=(s.style?s.style+";":"")+l:a!="nodeName"&&(s[a]=l))}}}return i}function m0(n,e,t,s){if(t==ai&&s==ai)return e;let i=e;for(let r=0;r<s.length;r++){let o=s[r],a=t[r];if(r){let l;a&&a.nodeName==o.nodeName&&i!=n&&(l=i.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(i),a=ai[0]),i=l}S_(i,a||ai[0],o)}return i}function S_(n,e,t){for(let s in e)s!="class"&&s!="style"&&s!="nodeName"&&!(s in t)&&n.removeAttribute(s);for(let s in t)s!="class"&&s!="style"&&s!="nodeName"&&t[s]!=e[s]&&n.setAttribute(s,t[s]);if(e.class!=t.class){let s=e.class?e.class.split(" ").filter(Boolean):[],i=t.class?t.class.split(" ").filter(Boolean):[];for(let r=0;r<s.length;r++)i.indexOf(s[r])==-1&&n.classList.remove(s[r]);for(let r=0;r<i.length;r++)s.indexOf(i[r])==-1&&n.classList.add(i[r]);n.classList.length==0&&n.removeAttribute("class")}if(e.style!=t.style){if(e.style){let s=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,i;for(;i=s.exec(e.style);)n.style.removeProperty(i[1])}t.style&&(n.style.cssText+=t.style)}}function g0(n,e,t){return m0(n,n,ai,Rc(e,t,n.nodeType!=1))}function Dc(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(!n[t].type.eq(e[t].type))return!1;return!0}function $f(n){let e=n.nextSibling;return n.parentNode.removeChild(n),e}class C_{constructor(e,t,s){this.lock=t,this.view=s,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=M_(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let s=e;s<t;s++)this.top.children[s].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,s){let i=0,r=this.stack.length>>1,o=Math.min(r,e.length);for(;i<o&&(i==r-1?this.top:this.stack[i+1<<1]).matchesMark(e[i])&&e[i].type.spec.spanning!==!1;)i++;for(;i<r;)this.destroyRest(),this.top.dirty=kn,this.index=this.stack.pop(),this.top=this.stack.pop(),r--;for(;r<e.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let d=this.top.children[l];if(d.matchesMark(e[r])&&!this.isLocked(d.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=wi.create(this.top,e[r],t,s);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,r++}}findNodeMatch(e,t,s,i){let r=-1,o;if(i>=this.preMatch.index&&(o=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&o.matchesNode(e,t,s))r=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let d=this.top.children[a];if(d.matchesNode(e,t,s)&&!this.preMatch.matched.has(d)){r=a;break}}return r<0?!1:(this.destroyBetween(this.index,r),this.index++,!0)}updateNodeAt(e,t,s,i,r){let o=this.top.children[i];return o.dirty==es&&o.dom==o.contentDOM&&(o.dirty=oi),o.update(e,t,s,r)?(this.destroyBetween(this.index,i),this.index++,!0):!1}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let s=e.pmViewDesc;if(s){for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==s)return i}return-1}e=t}}updateNextNode(e,t,s,i,r,o){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof Bs){let d=this.preMatch.matched.get(l);if(d!=null&&d!=r)return!1;let u=l.dom,f,h=this.isLocked(u)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=es&&Dc(t,l.outerDeco));if(!h&&l.update(e,t,s,i))return this.destroyBetween(this.index,a),l.dom!=u&&(this.changed=!0),this.index++,!0;if(!h&&(f=this.recreateWrapper(l,e,t,s,i,o)))return this.top.children[this.index]=f,f.contentDOM&&(f.dirty=oi,f.updateChildren(i,o+1),f.dirty=kn),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,t,s,i,r,o){if(e.dirty||t.isAtom||!e.children.length||!e.node.content.eq(t.content))return null;let a=Bs.create(this.top,t,s,i,r,o);if(a.contentDOM){a.children=e.children,e.children=[];for(let l of a.children)l.parent=a}return e.destroy(),a}addNode(e,t,s,i,r){let o=Bs.create(this.top,e,t,s,i,r);o.contentDOM&&o.updateChildren(i,r+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,t,s){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(e)&&(e==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{let r=new f0(this.top,e,t,s);this.top.children.splice(this.index++,0,r),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;for(;e instanceof wi;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof rl)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Kt||Bt)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",t),this.addHackNode("BR",this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let s=document.createElement(e);e=="IMG"&&(s.className="ProseMirror-separator",s.alt=""),e=="BR"&&(s.className="ProseMirror-trailingBreak");let i=new h0(this.top,[],s,null);t!=this.top?t.children.push(i):t.children.splice(this.index++,0,i),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function M_(n,e){let t=e,s=t.children.length,i=n.childCount,r=new Map,o=[];e:for(;i>0;){let a;for(;;)if(s){let d=t.children[s-1];if(d instanceof wi)t=d,s=d.children.length;else{a=d,s--;break}}else{if(t==e)break e;s=t.parent.children.indexOf(t),t=t.parent}let l=a.node;if(l){if(l!=n.child(i-1))break;--i,r.set(a,i),o.push(a)}}return{index:i,matched:r,matches:o.reverse()}}function T_(n,e){return n.type.side-e.type.side}function E_(n,e,t,s){let i=e.locals(n),r=0;if(i.length==0){for(let d=0;d<n.childCount;d++){let u=n.child(d);s(u,i,e.forChild(r,u),d),r+=u.nodeSize}return}let o=0,a=[],l=null;for(let d=0;;){let u,f;for(;o<i.length&&i[o].to==r;){let w=i[o++];w.widget&&(u?(f||(f=[u])).push(w):u=w)}if(u)if(f){f.sort(T_);for(let w=0;w<f.length;w++)t(f[w],d,!!l)}else t(u,d,!!l);let h,g;if(l)g=-1,h=l,l=null;else if(d<n.childCount)g=d,h=n.child(d++);else break;for(let w=0;w<a.length;w++)a[w].to<=r&&a.splice(w--,1);for(;o<i.length&&i[o].from<=r&&i[o].to>r;)a.push(i[o++]);let x=r+h.nodeSize;if(h.isText){let w=x;o<i.length&&i[o].from<w&&(w=i[o].from);for(let S=0;S<a.length;S++)a[S].to<w&&(w=a[S].to);w<x&&(l=h.cut(w-r),h=h.cut(0,w-r),x=w,g=-1)}else for(;o<i.length&&i[o].to<x;)o++;let y=h.isInline&&!h.isLeaf?a.filter(w=>!w.inline):a.slice();s(h,y,e.forChild(r,h),g),r=x}}function __(n){if(n.nodeName=="UL"||n.nodeName=="OL"){let e=n.style.cssText;n.style.cssText=e+"; list-style: square !important",window.getComputedStyle(n).listStyle,n.style.cssText=e}}function A_(n,e,t,s){for(let i=0,r=0;i<n.childCount&&r<=s;){let o=n.child(i++),a=r;if(r+=o.nodeSize,!o.isText)continue;let l=o.text;for(;i<n.childCount;){let d=n.child(i++);if(r+=d.nodeSize,!d.isText)break;l+=d.text}if(r>=t){if(r>=s&&l.slice(s-e.length-a,s-a)==e)return s-e.length;let d=a<s?l.lastIndexOf(e,s-a-1):-1;if(d>=0&&d+e.length+a>=t)return a+d;if(t==s&&l.length>=s+e.length-a&&l.slice(s-a,s-a+e.length)==e)return s}}return-1}function jc(n,e,t,s,i){let r=[];for(let o=0,a=0;o<n.length;o++){let l=n[o],d=a,u=a+=l.size;d>=t||u<=e?r.push(l):(d<e&&r.push(l.slice(0,e-d,s)),i&&(r.push(i),i=void 0),u>t&&r.push(l.slice(t-d,l.size,s)))}return r}function eu(n,e=null){let t=n.domSelectionRange(),s=n.state.doc;if(!t.focusNode)return null;let i=n.docView.nearestDesc(t.focusNode),r=i&&i.size==0,o=n.docView.posFromDOM(t.focusNode,t.focusOffset,1);if(o<0)return null;let a=s.resolve(o),l,d;if(il(t)){for(l=a;i&&!i.node;)i=i.parent;let u=i.node;if(i&&u.isAtom&&he.isSelectable(u)&&i.parent&&!(u.isInline&&t_(t.focusNode,t.focusOffset,i.dom))){let f=i.posBefore;d=new he(o==f?a:s.resolve(f))}}else{let u=n.docView.posFromDOM(t.anchorNode,t.anchorOffset,1);if(u<0)return null;l=s.resolve(u)}if(!d){let u=e=="pointer"||n.state.selection.head<a.pos&&!r?1:-1;d=tu(n,l,a,u)}return d}function x0(n){return n.editable?n.hasFocus():b0(n)&&document.activeElement&&document.activeElement.contains(n.dom)}function ps(n,e=!1){let t=n.state.selection;if(y0(n,t),!!x0(n)){if(!e&&n.input.mouseDown&&n.input.mouseDown.allowDefault&&Bt){let s=n.domSelectionRange(),i=n.domObserver.currentSelection;if(s.anchorNode&&i.anchorNode&&ki(s.anchorNode,s.anchorOffset,i.anchorNode,i.anchorOffset)){n.input.mouseDown.delayedSelectionSync=!0,n.domObserver.setCurSelection();return}}if(n.domObserver.disconnectSelection(),n.cursorWrapper)I_(n);else{let{anchor:s,head:i}=t,r,o;Wf&&!(t instanceof We)&&(t.$from.parent.inlineContent||(r=Hf(n,t.from)),!t.empty&&!t.$from.parent.inlineContent&&(o=Hf(n,t.to))),n.docView.setSelection(s,i,n.root,e),Wf&&(r&&qf(r),o&&qf(o)),t.visible?n.dom.classList.remove("ProseMirror-hideselection"):(n.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&N_(n))}n.domObserver.setCurSelection(),n.domObserver.connectSelection()}}const Wf=Kt||Bt&&r0<63;function Hf(n,e){let{node:t,offset:s}=n.docView.domFromPos(e,0),i=s<t.childNodes.length?t.childNodes[s]:null,r=s?t.childNodes[s-1]:null;if(Kt&&i&&i.contentEditable=="false")return Ll(i);if((!i||i.contentEditable=="false")&&(!r||r.contentEditable=="false")){if(i)return Ll(i);if(r)return Ll(r)}}function Ll(n){return n.contentEditable="true",Kt&&n.draggable&&(n.draggable=!1,n.wasDraggable=!0),n}function qf(n){n.contentEditable="false",n.wasDraggable&&(n.draggable=!0,n.wasDraggable=null)}function N_(n){let e=n.dom.ownerDocument;e.removeEventListener("selectionchange",n.input.hideSelectionGuard);let t=n.domSelectionRange(),s=t.anchorNode,i=t.anchorOffset;e.addEventListener("selectionchange",n.input.hideSelectionGuard=()=>{(t.anchorNode!=s||t.anchorOffset!=i)&&(e.removeEventListener("selectionchange",n.input.hideSelectionGuard),setTimeout(()=>{(!x0(n)||n.state.selection.visible)&&n.dom.classList.remove("ProseMirror-hideselection")},20))})}function I_(n){let e=n.domSelection(),t=document.createRange(),s=n.cursorWrapper.dom,i=s.nodeName=="IMG";i?t.setEnd(s.parentNode,It(s)+1):t.setEnd(s,0),t.collapse(!1),e.removeAllRanges(),e.addRange(t),!i&&!n.state.selection.visible&&Zt&&Ls<=11&&(s.disabled=!0,s.disabled=!1)}function y0(n,e){if(e instanceof he){let t=n.docView.descAt(e.from);t!=n.lastSelectedViewDesc&&(Kf(n),t&&t.selectNode(),n.lastSelectedViewDesc=t)}else Kf(n)}function Kf(n){n.lastSelectedViewDesc&&(n.lastSelectedViewDesc.parent&&n.lastSelectedViewDesc.deselectNode(),n.lastSelectedViewDesc=void 0)}function tu(n,e,t,s){return n.someProp("createSelectionBetween",i=>i(n,e,t))||We.between(e,t,s)}function Jf(n){return n.editable&&!n.hasFocus()?!1:b0(n)}function b0(n){let e=n.domSelectionRange();if(!e.anchorNode)return!1;try{return n.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(n.editable||n.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function R_(n){let e=n.docView.domFromPos(n.state.selection.anchor,0),t=n.domSelectionRange();return ki(e.node,e.offset,t.anchorNode,t.anchorOffset)}function Pc(n,e){let{$anchor:t,$head:s}=n.selection,i=e>0?t.max(s):t.min(s),r=i.parent.inlineContent?i.depth?n.doc.resolve(e>0?i.after():i.before()):null:i;return r&&Ne.findFrom(r,e)}function _s(n,e){return n.dispatch(n.state.tr.setSelection(e).scrollIntoView()),!0}function Yf(n,e,t){let s=n.state.selection;if(s instanceof We)if(t.indexOf("s")>-1){let{$head:i}=s,r=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter;if(!r||r.isText||!r.isLeaf)return!1;let o=n.state.doc.resolve(i.pos+r.nodeSize*(e<0?-1:1));return _s(n,new We(s.$anchor,o))}else if(s.empty){if(n.endOfTextblock(e>0?"forward":"backward")){let i=Pc(n.state,e);return i&&i instanceof he?_s(n,i):!1}else if(!(xn&&t.indexOf("m")>-1)){let i=s.$head,r=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,o;if(!r||r.isText)return!1;let a=e<0?i.pos-r.nodeSize:i.pos;return r.isAtom||(o=n.docView.descAt(a))&&!o.contentDOM?he.isSelectable(r)?_s(n,new he(e<0?n.state.doc.resolve(i.pos-r.nodeSize):i)):yo?_s(n,new We(n.state.doc.resolve(e<0?a:a+r.nodeSize))):!1:!1}}else return!1;else{if(s instanceof he&&s.node.isInline)return _s(n,new We(e>0?s.$to:s.$from));{let i=Pc(n.state,e);return i?_s(n,i):!1}}}function _a(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function Vr(n,e){let t=n.pmViewDesc;return t&&t.size==0&&(e<0||n.nextSibling||n.nodeName!="BR")}function Fi(n,e){return e<0?D_(n):j_(n)}function D_(n){let e=n.domSelectionRange(),t=e.focusNode,s=e.focusOffset;if(!t)return;let i,r,o=!1;for(Fn&&t.nodeType==1&&s<_a(t)&&Vr(t.childNodes[s],-1)&&(o=!0);;)if(s>0){if(t.nodeType!=1)break;{let a=t.childNodes[s-1];if(Vr(a,-1))i=t,r=--s;else if(a.nodeType==3)t=a,s=t.nodeValue.length;else break}}else{if(k0(t))break;{let a=t.previousSibling;for(;a&&Vr(a,-1);)i=t.parentNode,r=It(a),a=a.previousSibling;if(a)t=a,s=_a(t);else{if(t=t.parentNode,t==n.dom)break;s=0}}}o?Oc(n,t,s):i&&Oc(n,i,r)}function j_(n){let e=n.domSelectionRange(),t=e.focusNode,s=e.focusOffset;if(!t)return;let i=_a(t),r,o;for(;;)if(s<i){if(t.nodeType!=1)break;let a=t.childNodes[s];if(Vr(a,1))r=t,o=++s;else break}else{if(k0(t))break;{let a=t.nextSibling;for(;a&&Vr(a,1);)r=a.parentNode,o=It(a)+1,a=a.nextSibling;if(a)t=a,s=0,i=_a(t);else{if(t=t.parentNode,t==n.dom)break;s=i=0}}}r&&Oc(n,r,o)}function k0(n){let e=n.pmViewDesc;return e&&e.node&&e.node.isBlock}function P_(n,e){for(;n&&e==n.childNodes.length&&!xo(n);)e=It(n)+1,n=n.parentNode;for(;n&&e<n.childNodes.length;){let t=n.childNodes[e];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;n=t,e=0}}function O_(n,e){for(;n&&!e&&!xo(n);)e=It(n),n=n.parentNode;for(;n&&e;){let t=n.childNodes[e-1];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;n=t,e=n.childNodes.length}}function Oc(n,e,t){if(e.nodeType!=3){let r,o;(o=P_(e,t))?(e=o,t=0):(r=O_(e,t))&&(e=r,t=r.nodeValue.length)}let s=n.domSelection();if(il(s)){let r=document.createRange();r.setEnd(e,t),r.setStart(e,t),s.removeAllRanges(),s.addRange(r)}else s.extend&&s.extend(e,t);n.domObserver.setCurSelection();let{state:i}=n;setTimeout(()=>{n.state==i&&ps(n)},50)}function Xf(n,e){let t=n.state.doc.resolve(e);if(!(Bt||i_)&&t.parent.inlineContent){let i=n.coordsAtPos(e);if(e>t.start()){let r=n.coordsAtPos(e-1),o=(r.top+r.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(r.left-i.left)>1)return r.left<i.left?"ltr":"rtl"}if(e<t.end()){let r=n.coordsAtPos(e+1),o=(r.top+r.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(r.left-i.left)>1)return r.left>i.left?"ltr":"rtl"}}return getComputedStyle(n.dom).direction=="rtl"?"rtl":"ltr"}function Qf(n,e,t){let s=n.state.selection;if(s instanceof We&&!s.empty||t.indexOf("s")>-1||xn&&t.indexOf("m")>-1)return!1;let{$from:i,$to:r}=s;if(!i.parent.inlineContent||n.endOfTextblock(e<0?"up":"down")){let o=Pc(n.state,e);if(o&&o instanceof he)return _s(n,o)}if(!i.parent.inlineContent){let o=e<0?i:r,a=s instanceof hn?Ne.near(o,e):Ne.findFrom(o,e);return a?_s(n,a):!1}return!1}function Zf(n,e){if(!(n.state.selection instanceof We))return!0;let{$head:t,$anchor:s,empty:i}=n.state.selection;if(!t.sameParent(s))return!0;if(!i)return!1;if(n.endOfTextblock(e>0?"forward":"backward"))return!0;let r=!t.textOffset&&(e<0?t.nodeBefore:t.nodeAfter);if(r&&!r.isText){let o=n.state.tr;return e<0?o.delete(t.pos-r.nodeSize,t.pos):o.delete(t.pos,t.pos+r.nodeSize),n.dispatch(o),!0}return!1}function eh(n,e,t){n.domObserver.stop(),e.contentEditable=t,n.domObserver.start()}function F_(n){if(!Kt||n.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:t}=n.domSelectionRange();if(e&&e.nodeType==1&&t==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let s=e.firstChild;eh(n,s,"true"),setTimeout(()=>eh(n,s,"false"),20)}return!1}function L_(n){let e="";return n.ctrlKey&&(e+="c"),n.metaKey&&(e+="m"),n.altKey&&(e+="a"),n.shiftKey&&(e+="s"),e}function B_(n,e){let t=e.keyCode,s=L_(e);if(t==8||xn&&t==72&&s=="c")return Zf(n,-1)||Fi(n,-1);if(t==46&&!e.shiftKey||xn&&t==68&&s=="c")return Zf(n,1)||Fi(n,1);if(t==13||t==27)return!0;if(t==37||xn&&t==66&&s=="c"){let i=t==37?Xf(n,n.state.selection.from)=="ltr"?-1:1:-1;return Yf(n,i,s)||Fi(n,i)}else if(t==39||xn&&t==70&&s=="c"){let i=t==39?Xf(n,n.state.selection.from)=="ltr"?1:-1:1;return Yf(n,i,s)||Fi(n,i)}else{if(t==38||xn&&t==80&&s=="c")return Qf(n,-1,s)||Fi(n,-1);if(t==40||xn&&t==78&&s=="c")return F_(n)||Qf(n,1,s)||Fi(n,1);if(s==(xn?"m":"c")&&(t==66||t==73||t==89||t==90))return!0}return!1}function w0(n,e){n.someProp("transformCopied",g=>{e=g(e,n)});let t=[],{content:s,openStart:i,openEnd:r}=e;for(;i>1&&r>1&&s.childCount==1&&s.firstChild.childCount==1;){i--,r--;let g=s.firstChild;t.push(g.type.name,g.attrs!=g.type.defaultAttrs?g.attrs:null),s=g.content}let o=n.someProp("clipboardSerializer")||br.fromSchema(n.state.schema),a=E0(),l=a.createElement("div");l.appendChild(o.serializeFragment(s,{document:a}));let d=l.firstChild,u,f=0;for(;d&&d.nodeType==1&&(u=T0[d.nodeName.toLowerCase()]);){for(let g=u.length-1;g>=0;g--){let x=a.createElement(u[g]);for(;l.firstChild;)x.appendChild(l.firstChild);l.appendChild(x),f++}d=l.firstChild}d&&d.nodeType==1&&d.setAttribute("data-pm-slice",`${i} ${r}${f?` -${f}`:""} ${JSON.stringify(t)}`);let h=n.someProp("clipboardTextSerializer",g=>g(e,n))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:h,slice:e}}function v0(n,e,t,s,i){let r=i.parent.type.spec.code,o,a;if(!t&&!e)return null;let l=e&&(s||r||!t);if(l){if(n.someProp("transformPastedText",h=>{e=h(e,r||s,n)}),r)return e?new ie(K.from(n.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):ie.empty;let f=n.someProp("clipboardTextParser",h=>h(e,i,s,n));if(f)a=f;else{let h=i.marks(),{schema:g}=n.state,x=br.fromSchema(g);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(y=>{let w=o.appendChild(document.createElement("p"));y&&w.appendChild(x.serializeNode(g.text(y,h)))})}}else n.someProp("transformPastedHTML",f=>{t=f(t,n)}),o=V_(t),yo&&G_(o);let d=o&&o.querySelector("[data-pm-slice]"),u=d&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(d.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let f=+u[3];f>0;f--){let h=o.firstChild;for(;h&&h.nodeType!=1;)h=h.nextSibling;if(!h)break;o=h}if(a||(a=(n.someProp("clipboardParser")||n.someProp("domParser")||Xr.fromSchema(n.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||u),context:i,ruleFromNode(h){return h.nodeName=="BR"&&!h.nextSibling&&h.parentNode&&!U_.test(h.parentNode.nodeName)?{ignore:!0}:null}})),u)a=$_(th(a,+u[1],+u[2]),u[4]);else if(a=ie.maxOpen(z_(a.content,i),!0),a.openStart||a.openEnd){let f=0,h=0;for(let g=a.content.firstChild;f<a.openStart&&!g.type.spec.isolating;f++,g=g.firstChild);for(let g=a.content.lastChild;h<a.openEnd&&!g.type.spec.isolating;h++,g=g.lastChild);a=th(a,f,h)}return n.someProp("transformPasted",f=>{a=f(a,n)}),a}const U_=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function z_(n,e){if(n.childCount<2)return n;for(let t=e.depth;t>=0;t--){let i=e.node(t).contentMatchAt(e.index(t)),r,o=[];if(n.forEach(a=>{if(!o)return;let l=i.findWrapping(a.type),d;if(!l)return o=null;if(d=o.length&&r.length&&C0(l,r,a,o[o.length-1],0))o[o.length-1]=d;else{o.length&&(o[o.length-1]=M0(o[o.length-1],r.length));let u=S0(a,l);o.push(u),i=i.matchType(u.type),r=l}}),o)return K.from(o)}return n}function S0(n,e,t=0){for(let s=e.length-1;s>=t;s--)n=e[s].create(null,K.from(n));return n}function C0(n,e,t,s,i){if(i<n.length&&i<e.length&&n[i]==e[i]){let r=C0(n,e,t,s.lastChild,i+1);if(r)return s.copy(s.content.replaceChild(s.childCount-1,r));if(s.contentMatchAt(s.childCount).matchType(i==n.length-1?t.type:n[i+1]))return s.copy(s.content.append(K.from(S0(t,n,i+1))))}}function M0(n,e){if(e==0)return n;let t=n.content.replaceChild(n.childCount-1,M0(n.lastChild,e-1)),s=n.contentMatchAt(n.childCount).fillBefore(K.empty,!0);return n.copy(t.append(s))}function Fc(n,e,t,s,i,r){let o=e<0?n.firstChild:n.lastChild,a=o.content;return n.childCount>1&&(r=0),i<s-1&&(a=Fc(a,e,t,s,i+1,r)),i>=t&&(a=e<0?o.contentMatchAt(0).fillBefore(a,r<=i).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(K.empty,!0))),n.replaceChild(e<0?0:n.childCount-1,o.copy(a))}function th(n,e,t){return e<n.openStart&&(n=new ie(Fc(n.content,-1,e,n.openStart,0,n.openEnd),e,n.openEnd)),t<n.openEnd&&(n=new ie(Fc(n.content,1,t,n.openEnd,0,0),n.openStart,t)),n}const T0={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let nh=null;function E0(){return nh||(nh=document.implementation.createHTMLDocument("title"))}function V_(n){let e=/^(\s*<meta [^>]*>)*/.exec(n);e&&(n=n.slice(e[0].length));let t=E0().createElement("div"),s=/<([a-z][^>\s]+)/i.exec(n),i;if((i=s&&T0[s[1].toLowerCase()])&&(n=i.map(r=>"<"+r+">").join("")+n+i.map(r=>"</"+r+">").reverse().join("")),t.innerHTML=n,i)for(let r=0;r<i.length;r++)t=t.querySelector(i[r])||t;return t}function G_(n){let e=n.querySelectorAll(Bt?"span:not([class]):not([style])":"span.Apple-converted-space");for(let t=0;t<e.length;t++){let s=e[t];s.childNodes.length==1&&s.textContent==" "&&s.parentNode&&s.parentNode.replaceChild(n.ownerDocument.createTextNode(" "),s)}}function $_(n,e){if(!n.size)return n;let t=n.content.firstChild.type.schema,s;try{s=JSON.parse(e)}catch{return n}let{content:i,openStart:r,openEnd:o}=n;for(let a=s.length-2;a>=0;a-=2){let l=t.nodes[s[a]];if(!l||l.hasRequiredAttrs())break;i=K.from(l.create(s[a+1],i)),r++,o++}return new ie(i,r,o)}const Jt={},Yt={},W_={touchstart:!0,touchmove:!0};class H_{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastAndroidDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function q_(n){for(let e in Jt){let t=Jt[e];n.dom.addEventListener(e,n.input.eventHandlers[e]=s=>{J_(n,s)&&!nu(n,s)&&(n.editable||!(s.type in Yt))&&t(n,s)},W_[e]?{passive:!0}:void 0)}Kt&&n.dom.addEventListener("input",()=>null),Lc(n)}function Os(n,e){n.input.lastSelectionOrigin=e,n.input.lastSelectionTime=Date.now()}function K_(n){n.domObserver.stop();for(let e in n.input.eventHandlers)n.dom.removeEventListener(e,n.input.eventHandlers[e]);clearTimeout(n.input.composingTimeout),clearTimeout(n.input.lastIOSEnterFallbackTimeout)}function Lc(n){n.someProp("handleDOMEvents",e=>{for(let t in e)n.input.eventHandlers[t]||n.dom.addEventListener(t,n.input.eventHandlers[t]=s=>nu(n,s))})}function nu(n,e){return n.someProp("handleDOMEvents",t=>{let s=t[e.type];return s?s(n,e)||e.defaultPrevented:!1})}function J_(n,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target;t!=n.dom;t=t.parentNode)if(!t||t.nodeType==11||t.pmViewDesc&&t.pmViewDesc.stopEvent(e))return!1;return!0}function Y_(n,e){!nu(n,e)&&Jt[e.type]&&(n.editable||!(e.type in Yt))&&Jt[e.type](n,e)}Yt.keydown=(n,e)=>{let t=e;if(n.input.shiftKey=t.keyCode==16||t.shiftKey,!A0(n,t)&&(n.input.lastKeyCode=t.keyCode,n.input.lastKeyCodeTime=Date.now(),!(Dn&&Bt&&t.keyCode==13)))if(t.keyCode!=229&&n.domObserver.forceFlush(),lr&&t.keyCode==13&&!t.ctrlKey&&!t.altKey&&!t.metaKey){let s=Date.now();n.input.lastIOSEnter=s,n.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{n.input.lastIOSEnter==s&&(n.someProp("handleKeyDown",i=>i(n,ii(13,"Enter"))),n.input.lastIOSEnter=0)},200)}else n.someProp("handleKeyDown",s=>s(n,t))||B_(n,t)?t.preventDefault():Os(n,"key")};Yt.keyup=(n,e)=>{e.keyCode==16&&(n.input.shiftKey=!1)};Yt.keypress=(n,e)=>{let t=e;if(A0(n,t)||!t.charCode||t.ctrlKey&&!t.altKey||xn&&t.metaKey)return;if(n.someProp("handleKeyPress",i=>i(n,t))){t.preventDefault();return}let s=n.state.selection;if(!(s instanceof We)||!s.$from.sameParent(s.$to)){let i=String.fromCharCode(t.charCode);!/[\r\n]/.test(i)&&!n.someProp("handleTextInput",r=>r(n,s.$from.pos,s.$to.pos,i))&&n.dispatch(n.state.tr.insertText(i).scrollIntoView()),t.preventDefault()}};function ol(n){return{left:n.clientX,top:n.clientY}}function X_(n,e){let t=e.x-n.clientX,s=e.y-n.clientY;return t*t+s*s<100}function su(n,e,t,s,i){if(s==-1)return!1;let r=n.state.doc.resolve(s);for(let o=r.depth+1;o>0;o--)if(n.someProp(e,a=>o>r.depth?a(n,t,r.nodeAfter,r.before(o),i,!0):a(n,t,r.node(o),r.before(o),i,!1)))return!0;return!1}function Hi(n,e,t){n.focused||n.focus();let s=n.state.tr.setSelection(e);s.setMeta("pointer",!0),n.dispatch(s)}function Q_(n,e){if(e==-1)return!1;let t=n.state.doc.resolve(e),s=t.nodeAfter;return s&&s.isAtom&&he.isSelectable(s)?(Hi(n,new he(t)),!0):!1}function Z_(n,e){if(e==-1)return!1;let t=n.state.selection,s,i;t instanceof he&&(s=t.node);let r=n.state.doc.resolve(e);for(let o=r.depth+1;o>0;o--){let a=o>r.depth?r.nodeAfter:r.node(o);if(he.isSelectable(a)){s&&t.$from.depth>0&&o>=t.$from.depth&&r.before(t.$from.depth+1)==t.$from.pos?i=r.before(t.$from.depth):i=r.before(o);break}}return i!=null?(Hi(n,he.create(n.state.doc,i)),!0):!1}function eA(n,e,t,s,i){return su(n,"handleClickOn",e,t,s)||n.someProp("handleClick",r=>r(n,e,s))||(i?Z_(n,t):Q_(n,t))}function tA(n,e,t,s){return su(n,"handleDoubleClickOn",e,t,s)||n.someProp("handleDoubleClick",i=>i(n,e,s))}function nA(n,e,t,s){return su(n,"handleTripleClickOn",e,t,s)||n.someProp("handleTripleClick",i=>i(n,e,s))||sA(n,t,s)}function sA(n,e,t){if(t.button!=0)return!1;let s=n.state.doc;if(e==-1)return s.inlineContent?(Hi(n,We.create(s,0,s.content.size)),!0):!1;let i=s.resolve(e);for(let r=i.depth+1;r>0;r--){let o=r>i.depth?i.nodeAfter:i.node(r),a=i.before(r);if(o.inlineContent)Hi(n,We.create(s,a+1,a+1+o.content.size));else if(he.isSelectable(o))Hi(n,he.create(s,a));else continue;return!0}}function iu(n){return Aa(n)}const _0=xn?"metaKey":"ctrlKey";Jt.mousedown=(n,e)=>{let t=e;n.input.shiftKey=t.shiftKey;let s=iu(n),i=Date.now(),r="singleClick";i-n.input.lastClick.time<500&&X_(t,n.input.lastClick)&&!t[_0]&&(n.input.lastClick.type=="singleClick"?r="doubleClick":n.input.lastClick.type=="doubleClick"&&(r="tripleClick")),n.input.lastClick={time:i,x:t.clientX,y:t.clientY,type:r};let o=n.posAtCoords(ol(t));o&&(r=="singleClick"?(n.input.mouseDown&&n.input.mouseDown.done(),n.input.mouseDown=new iA(n,o,t,!!s)):(r=="doubleClick"?tA:nA)(n,o.pos,o.inside,t)?t.preventDefault():Os(n,"pointer"))};class iA{constructor(e,t,s,i){this.view=e,this.pos=t,this.event=s,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!s[_0],this.allowDefault=s.shiftKey;let r,o;if(t.inside>-1)r=e.state.doc.nodeAt(t.inside),o=t.inside;else{let u=e.state.doc.resolve(t.pos);r=u.parent,o=u.depth?u.before():0}const a=i?null:s.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.dom.nodeType==1?l.dom:null;let{selection:d}=e.state;(s.button==0&&r.type.spec.draggable&&r.type.spec.selectable!==!1||d instanceof he&&d.from<=o&&d.to>o)&&(this.mightDrag={node:r,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Fn&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Os(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>ps(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(ol(e))),this.updateAllowDefault(e),this.allowDefault||!t?Os(this.view,"pointer"):eA(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Kt&&this.mightDrag&&!this.mightDrag.node.isAtom||Bt&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(Hi(this.view,Ne.near(this.view.state.doc.resolve(t.pos))),e.preventDefault()):Os(this.view,"pointer")}move(e){this.updateAllowDefault(e),Os(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Jt.touchstart=n=>{n.input.lastTouch=Date.now(),iu(n),Os(n,"pointer")};Jt.touchmove=n=>{n.input.lastTouch=Date.now(),Os(n,"pointer")};Jt.contextmenu=n=>iu(n);function A0(n,e){return n.composing?!0:Kt&&Math.abs(e.timeStamp-n.input.compositionEndedAt)<500?(n.input.compositionEndedAt=-2e8,!0):!1}const rA=Dn?5e3:-1;Yt.compositionstart=Yt.compositionupdate=n=>{if(!n.composing){n.domObserver.flush();let{state:e}=n,t=e.selection.$from;if(e.selection.empty&&(e.storedMarks||!t.textOffset&&t.parentOffset&&t.nodeBefore.marks.some(s=>s.type.spec.inclusive===!1)))n.markCursor=n.state.storedMarks||t.marks(),Aa(n,!0),n.markCursor=null;else if(Aa(n),Fn&&e.selection.empty&&t.parentOffset&&!t.textOffset&&t.nodeBefore.marks.length){let s=n.domSelectionRange();for(let i=s.focusNode,r=s.focusOffset;i&&i.nodeType==1&&r!=0;){let o=r<0?i.lastChild:i.childNodes[r-1];if(!o)break;if(o.nodeType==3){n.domSelection().collapse(o,o.nodeValue.length);break}else i=o,r=-1}}n.input.composing=!0}N0(n,rA)};Yt.compositionend=(n,e)=>{n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=e.timeStamp,n.input.compositionPendingChanges=n.domObserver.pendingRecords().length?n.input.compositionID:0,n.input.compositionNode=null,n.input.compositionPendingChanges&&Promise.resolve().then(()=>n.domObserver.flush()),n.input.compositionID++,N0(n,20))};function N0(n,e){clearTimeout(n.input.composingTimeout),e>-1&&(n.input.composingTimeout=setTimeout(()=>Aa(n),e))}function I0(n){for(n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=aA());n.input.compositionNodes.length>0;)n.input.compositionNodes.pop().markParentsDirty()}function oA(n){let e=n.domSelectionRange();if(!e.focusNode)return null;let t=ZE(e.focusNode,e.focusOffset),s=e_(e.focusNode,e.focusOffset);if(t&&s&&t!=s){let i=s.pmViewDesc,r=n.domObserver.lastChangedTextNode;if(t==r||s==r)return r;if(!i||!i.isText(s.nodeValue))return s;if(n.input.compositionNode==s){let o=t.pmViewDesc;if(!(!o||!o.isText(t.nodeValue)))return s}}return t||s}function aA(){let n=document.createEvent("Event");return n.initEvent("event",!0,!0),n.timeStamp}function Aa(n,e=!1){if(!(Dn&&n.domObserver.flushingSoon>=0)){if(n.domObserver.forceFlush(),I0(n),e||n.docView&&n.docView.dirty){let t=eu(n);return t&&!t.eq(n.state.selection)?n.dispatch(n.state.tr.setSelection(t)):n.updateState(n.state),!0}return!1}}function lA(n,e){if(!n.dom.parentNode)return;let t=n.dom.parentNode.appendChild(document.createElement("div"));t.appendChild(e),t.style.cssText="position: fixed; left: -10000px; top: 10px";let s=getSelection(),i=document.createRange();i.selectNodeContents(e),n.dom.blur(),s.removeAllRanges(),s.addRange(i),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t),n.focus()},50)}const eo=Zt&&Ls<15||lr&&r_<604;Jt.copy=Yt.cut=(n,e)=>{let t=e,s=n.state.selection,i=t.type=="cut";if(s.empty)return;let r=eo?null:t.clipboardData,o=s.content(),{dom:a,text:l}=w0(n,o);r?(t.preventDefault(),r.clearData(),r.setData("text/html",a.innerHTML),r.setData("text/plain",l)):lA(n,a),i&&n.dispatch(n.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function cA(n){return n.openStart==0&&n.openEnd==0&&n.content.childCount==1?n.content.firstChild:null}function dA(n,e){if(!n.dom.parentNode)return;let t=n.input.shiftKey||n.state.selection.$from.parent.type.spec.code,s=n.dom.parentNode.appendChild(document.createElement(t?"textarea":"div"));t||(s.contentEditable="true"),s.style.cssText="position: fixed; left: -10000px; top: 10px",s.focus();let i=n.input.shiftKey&&n.input.lastKeyCode!=45;setTimeout(()=>{n.focus(),s.parentNode&&s.parentNode.removeChild(s),t?to(n,s.value,null,i,e):to(n,s.textContent,s.innerHTML,i,e)},50)}function to(n,e,t,s,i){let r=v0(n,e,t,s,n.state.selection.$from);if(n.someProp("handlePaste",l=>l(n,i,r||ie.empty)))return!0;if(!r)return!1;let o=cA(r),a=o?n.state.tr.replaceSelectionWith(o,s):n.state.tr.replaceSelection(r);return n.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function R0(n){let e=n.getData("text/plain")||n.getData("Text");if(e)return e;let t=n.getData("text/uri-list");return t?t.replace(/\r?\n/g," "):""}Yt.paste=(n,e)=>{let t=e;if(n.composing&&!Dn)return;let s=eo?null:t.clipboardData,i=n.input.shiftKey&&n.input.lastKeyCode!=45;s&&to(n,R0(s),s.getData("text/html"),i,t)?t.preventDefault():dA(n,t)};class D0{constructor(e,t,s){this.slice=e,this.move=t,this.node=s}}const j0=xn?"altKey":"ctrlKey";Jt.dragstart=(n,e)=>{let t=e,s=n.input.mouseDown;if(s&&s.done(),!t.dataTransfer)return;let i=n.state.selection,r=i.empty?null:n.posAtCoords(ol(t)),o;if(!(r&&r.pos>=i.from&&r.pos<=(i instanceof he?i.to-1:i.to))){if(s&&s.mightDrag)o=he.create(n.state.doc,s.mightDrag.pos);else if(t.target&&t.target.nodeType==1){let f=n.docView.nearestDesc(t.target,!0);f&&f.node.type.spec.draggable&&f!=n.docView&&(o=he.create(n.state.doc,f.posBefore))}}let a=(o||n.state.selection).content(),{dom:l,text:d,slice:u}=w0(n,a);(!t.dataTransfer.files.length||!Bt||r0>120)&&t.dataTransfer.clearData(),t.dataTransfer.setData(eo?"Text":"text/html",l.innerHTML),t.dataTransfer.effectAllowed="copyMove",eo||t.dataTransfer.setData("text/plain",d),n.dragging=new D0(u,!t[j0],o)};Jt.dragend=n=>{let e=n.dragging;window.setTimeout(()=>{n.dragging==e&&(n.dragging=null)},50)};Yt.dragover=Yt.dragenter=(n,e)=>e.preventDefault();Yt.drop=(n,e)=>{let t=e,s=n.dragging;if(n.dragging=null,!t.dataTransfer)return;let i=n.posAtCoords(ol(t));if(!i)return;let r=n.state.doc.resolve(i.pos),o=s&&s.slice;o?n.someProp("transformPasted",x=>{o=x(o,n)}):o=v0(n,R0(t.dataTransfer),eo?null:t.dataTransfer.getData("text/html"),!1,r);let a=!!(s&&!t[j0]);if(n.someProp("handleDrop",x=>x(n,t,o||ie.empty,a))){t.preventDefault();return}if(!o)return;t.preventDefault();let l=o?gE(n.state.doc,r.pos,o):r.pos;l==null&&(l=r.pos);let d=n.state.tr;if(a){let{node:x}=s;x?x.replace(d):d.deleteSelection()}let u=d.mapping.map(l),f=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,h=d.doc;if(f?d.replaceRangeWith(u,u,o.content.firstChild):d.replaceRange(u,u,o),d.doc.eq(h))return;let g=d.doc.resolve(u);if(f&&he.isSelectable(o.content.firstChild)&&g.nodeAfter&&g.nodeAfter.sameMarkup(o.content.firstChild))d.setSelection(new he(g));else{let x=d.mapping.map(l);d.mapping.maps[d.mapping.maps.length-1].forEach((y,w,S,_)=>x=_),d.setSelection(tu(n,g,d.doc.resolve(x)))}n.focus(),n.dispatch(d.setMeta("uiEvent","drop"))};Jt.focus=n=>{n.input.lastFocus=Date.now(),n.focused||(n.domObserver.stop(),n.dom.classList.add("ProseMirror-focused"),n.domObserver.start(),n.focused=!0,setTimeout(()=>{n.docView&&n.hasFocus()&&!n.domObserver.currentSelection.eq(n.domSelectionRange())&&ps(n)},20))};Jt.blur=(n,e)=>{let t=e;n.focused&&(n.domObserver.stop(),n.dom.classList.remove("ProseMirror-focused"),n.domObserver.start(),t.relatedTarget&&n.dom.contains(t.relatedTarget)&&n.domObserver.currentSelection.clear(),n.focused=!1)};Jt.beforeinput=(n,e)=>{if(Bt&&Dn&&e.inputType=="deleteContentBackward"){n.domObserver.flushSoon();let{domChangeCount:s}=n.input;setTimeout(()=>{if(n.input.domChangeCount!=s||(n.dom.blur(),n.focus(),n.someProp("handleKeyDown",r=>r(n,ii(8,"Backspace")))))return;let{$cursor:i}=n.state.selection;i&&i.pos>0&&n.dispatch(n.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let n in Yt)Jt[n]=Yt[n];function no(n,e){if(n==e)return!0;for(let t in n)if(n[t]!==e[t])return!1;for(let t in e)if(!(t in n))return!1;return!0}class Na{constructor(e,t){this.toDOM=e,this.spec=t||fi,this.side=this.spec.side||0}map(e,t,s,i){let{pos:r,deleted:o}=e.mapResult(t.from+i,this.side<0?-1:1);return o?null:new un(r-s,r-s,this)}valid(){return!0}eq(e){return this==e||e instanceof Na&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&no(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Us{constructor(e,t){this.attrs=e,this.spec=t||fi}map(e,t,s,i){let r=e.map(t.from+i,this.spec.inclusiveStart?-1:1)-s,o=e.map(t.to+i,this.spec.inclusiveEnd?1:-1)-s;return r>=o?null:new un(r,o,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof Us&&no(this.attrs,e.attrs)&&no(this.spec,e.spec)}static is(e){return e.type instanceof Us}destroy(){}}class ru{constructor(e,t){this.attrs=e,this.spec=t||fi}map(e,t,s,i){let r=e.mapResult(t.from+i,1);if(r.deleted)return null;let o=e.mapResult(t.to+i,-1);return o.deleted||o.pos<=r.pos?null:new un(r.pos-s,o.pos-s,this)}valid(e,t){let{index:s,offset:i}=e.content.findIndex(t.from),r;return i==t.from&&!(r=e.child(s)).isText&&i+r.nodeSize==t.to}eq(e){return this==e||e instanceof ru&&no(this.attrs,e.attrs)&&no(this.spec,e.spec)}destroy(){}}class un{constructor(e,t,s){this.from=e,this.to=t,this.type=s}copy(e,t){return new un(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,s){return this.type.map(e,this,t,s)}static widget(e,t,s){return new un(e,e,new Na(t,s))}static inline(e,t,s,i){return new un(e,t,new Us(s,i))}static node(e,t,s,i){return new un(e,t,new ru(s,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof Us}get widget(){return this.type instanceof Na}}const Ui=[],fi={};class mt{constructor(e,t){this.local=e.length?e:Ui,this.children=t.length?t:Ui}static create(e,t){return t.length?Ia(t,e,0,fi):Ot}find(e,t,s){let i=[];return this.findInner(e??0,t??1e9,i,0,s),i}findInner(e,t,s,i,r){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=t&&a.to>=e&&(!r||r(a.spec))&&s.push(a.copy(a.from+i,a.to+i))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<t&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,t-a,s,i+a,r)}}map(e,t,s){return this==Ot||e.maps.length==0?this:this.mapInner(e,t,0,0,s||fi)}mapInner(e,t,s,i,r){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,s,i);l&&l.type.valid(t,l)?(o||(o=[])).push(l):r.onRemove&&r.onRemove(this.local[a].spec)}return this.children.length?uA(this.children,o||[],e,t,s,i,r):o?new mt(o.sort(hi),Ui):Ot}add(e,t){return t.length?this==Ot?mt.create(e,t):this.addInner(e,t,0):this}addInner(e,t,s){let i,r=0;e.forEach((a,l)=>{let d=l+s,u;if(u=O0(t,a,d)){for(i||(i=this.children.slice());r<i.length&&i[r]<l;)r+=3;i[r]==l?i[r+2]=i[r+2].addInner(a,u,d+1):i.splice(r,0,l,l+a.nodeSize,Ia(u,a,d+1,fi)),r+=3}});let o=P0(r?F0(t):t,-s);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new mt(o.length?this.local.concat(o).sort(hi):this.local,i||this.children)}remove(e){return e.length==0||this==Ot?this:this.removeInner(e,0)}removeInner(e,t){let s=this.children,i=this.local;for(let r=0;r<s.length;r+=3){let o,a=s[r]+t,l=s[r+1]+t;for(let u=0,f;u<e.length;u++)(f=e[u])&&f.from>a&&f.to<l&&(e[u]=null,(o||(o=[])).push(f));if(!o)continue;s==this.children&&(s=this.children.slice());let d=s[r+2].removeInner(o,a+1);d!=Ot?s[r+2]=d:(s.splice(r,3),r-=3)}if(i.length){for(let r=0,o;r<e.length;r++)if(o=e[r])for(let a=0;a<i.length;a++)i[a].eq(o,t)&&(i==this.local&&(i=this.local.slice()),i.splice(a--,1))}return s==this.children&&i==this.local?this:i.length||s.length?new mt(i,s):Ot}forChild(e,t){if(this==Ot)return this;if(t.isLeaf)return mt.empty;let s,i;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(s=this.children[a+2]);break}let r=e+1,o=r+t.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>r&&l.type instanceof Us){let d=Math.max(r,l.from)-r,u=Math.min(o,l.to)-r;d<u&&(i||(i=[])).push(l.copy(d,u))}}if(i){let a=new mt(i.sort(hi),Ui);return s?new Rs([a,s]):a}return s||Ot}eq(e){if(this==e)return!0;if(!(e instanceof mt)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return ou(this.localsInner(e))}localsInner(e){if(this==Ot)return Ui;if(e.inlineContent||!this.local.some(Us.is))return this.local;let t=[];for(let s=0;s<this.local.length;s++)this.local[s].type instanceof Us||t.push(this.local[s]);return t}}mt.empty=new mt([],[]);mt.removeOverlap=ou;const Ot=mt.empty;class Rs{constructor(e){this.members=e}map(e,t){const s=this.members.map(i=>i.map(e,t,fi));return Rs.from(s)}forChild(e,t){if(t.isLeaf)return mt.empty;let s=[];for(let i=0;i<this.members.length;i++){let r=this.members[i].forChild(e,t);r!=Ot&&(r instanceof Rs?s=s.concat(r.members):s.push(r))}return Rs.from(s)}eq(e){if(!(e instanceof Rs)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,s=!0;for(let i=0;i<this.members.length;i++){let r=this.members[i].localsInner(e);if(r.length)if(!t)t=r;else{s&&(t=t.slice(),s=!1);for(let o=0;o<r.length;o++)t.push(r[o])}}return t?ou(s?t:t.sort(hi)):Ui}static from(e){switch(e.length){case 0:return Ot;case 1:return e[0];default:return new Rs(e.every(t=>t instanceof mt)?e:e.reduce((t,s)=>t.concat(s instanceof mt?s:s.members),[]))}}}function uA(n,e,t,s,i,r,o){let a=n.slice();for(let d=0,u=r;d<t.maps.length;d++){let f=0;t.maps[d].forEach((h,g,x,y)=>{let w=y-x-(g-h);for(let S=0;S<a.length;S+=3){let _=a[S+1];if(_<0||h>_+u-f)continue;let O=a[S]+u-f;g>=O?a[S+1]=h<=O?-2:-1:h>=u&&w&&(a[S]+=w,a[S+1]+=w)}f+=w}),u=t.maps[d].map(u,-1)}let l=!1;for(let d=0;d<a.length;d+=3)if(a[d+1]<0){if(a[d+1]==-2){l=!0,a[d+1]=-1;continue}let u=t.map(n[d]+r),f=u-i;if(f<0||f>=s.content.size){l=!0;continue}let h=t.map(n[d+1]+r,-1),g=h-i,{index:x,offset:y}=s.content.findIndex(f),w=s.maybeChild(x);if(w&&y==f&&y+w.nodeSize==g){let S=a[d+2].mapInner(t,w,u+1,n[d]+r+1,o);S!=Ot?(a[d]=f,a[d+1]=g,a[d+2]=S):(a[d+1]=-2,l=!0)}else l=!0}if(l){let d=fA(a,n,e,t,i,r,o),u=Ia(d,s,0,o);e=u.local;for(let f=0;f<a.length;f+=3)a[f+1]<0&&(a.splice(f,3),f-=3);for(let f=0,h=0;f<u.children.length;f+=3){let g=u.children[f];for(;h<a.length&&a[h]<g;)h+=3;a.splice(h,0,u.children[f],u.children[f+1],u.children[f+2])}}return new mt(e.sort(hi),a)}function P0(n,e){if(!e||!n.length)return n;let t=[];for(let s=0;s<n.length;s++){let i=n[s];t.push(new un(i.from+e,i.to+e,i.type))}return t}function fA(n,e,t,s,i,r,o){function a(l,d){for(let u=0;u<l.local.length;u++){let f=l.local[u].map(s,i,d);f?t.push(f):o.onRemove&&o.onRemove(l.local[u].spec)}for(let u=0;u<l.children.length;u+=3)a(l.children[u+2],l.children[u]+d+1)}for(let l=0;l<n.length;l+=3)n[l+1]==-1&&a(n[l+2],e[l]+r+1);return t}function O0(n,e,t){if(e.isLeaf)return null;let s=t+e.nodeSize,i=null;for(let r=0,o;r<n.length;r++)(o=n[r])&&o.from>t&&o.to<s&&((i||(i=[])).push(o),n[r]=null);return i}function F0(n){let e=[];for(let t=0;t<n.length;t++)n[t]!=null&&e.push(n[t]);return e}function Ia(n,e,t,s){let i=[],r=!1;e.forEach((a,l)=>{let d=O0(n,a,l+t);if(d){r=!0;let u=Ia(d,a,t+l+1,s);u!=Ot&&i.push(l,l+a.nodeSize,u)}});let o=P0(r?F0(n):n,-t).sort(hi);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(s.onRemove&&s.onRemove(o[a].spec),o.splice(a--,1));return o.length||i.length?new mt(o,i):Ot}function hi(n,e){return n.from-e.from||n.to-e.to}function ou(n){let e=n;for(let t=0;t<e.length-1;t++){let s=e[t];if(s.from!=s.to)for(let i=t+1;i<e.length;i++){let r=e[i];if(r.from==s.from){r.to!=s.to&&(e==n&&(e=n.slice()),e[i]=r.copy(r.from,s.to),sh(e,i+1,r.copy(s.to,r.to)));continue}else{r.from<s.to&&(e==n&&(e=n.slice()),e[t]=s.copy(s.from,r.from),sh(e,i,s.copy(r.from,s.to)));break}}}return e}function sh(n,e,t){for(;e<n.length&&hi(t,n[e])>0;)e++;n.splice(e,0,t)}function Bl(n){let e=[];return n.someProp("decorations",t=>{let s=t(n.state);s&&s!=Ot&&e.push(s)}),n.cursorWrapper&&e.push(mt.create(n.state.doc,[n.cursorWrapper.deco])),Rs.from(e)}const hA={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},pA=Zt&&Ls<=11;class mA{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class gA{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new mA,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(s=>{for(let i=0;i<s.length;i++)this.queue.push(s[i]);Zt&&Ls<=11&&s.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),pA&&(this.onCharData=s=>{this.queue.push({target:s.target,type:"characterData",oldValue:s.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,hA)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(Jf(this.view)){if(this.suppressingSelectionUpdates)return ps(this.view);if(Zt&&Ls<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&ki(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t=new Set,s;for(let r=e.focusNode;r;r=Zr(r))t.add(r);for(let r=e.anchorNode;r;r=Zr(r))if(t.has(r)){s=r;break}let i=s&&this.view.docView.nearestDesc(s);if(i&&i.ignoreMutation({type:"selection",target:s.nodeType==3?s.parentNode:s}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.pendingRecords();t.length&&(this.queue=[]);let s=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(s)&&Jf(e)&&!this.ignoreSelectionChange(s),r=-1,o=-1,a=!1,l=[];if(e.editable)for(let u=0;u<t.length;u++){let f=this.registerMutation(t[u],l);f&&(r=r<0?f.from:Math.min(f.from,r),o=o<0?f.to:Math.max(f.to,o),f.typeOver&&(a=!0))}if(Fn&&l.length){let u=l.filter(f=>f.nodeName=="BR");if(u.length==2){let[f,h]=u;f.parentNode&&f.parentNode.parentNode==h.parentNode?h.remove():f.remove()}else{let{focusNode:f}=this.currentSelection;for(let h of u){let g=h.parentNode;g&&g.nodeName=="LI"&&(!f||bA(e,f)!=g)&&h.remove()}}}let d=null;r<0&&i&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&il(s)&&(d=eu(e))&&d.eq(Ne.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,ps(e),this.currentSelection.set(s),e.scrollToSelection()):(r>-1||i)&&(r>-1&&(e.docView.markDirty(r,o),xA(e)),this.handleDOMChange(r,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(s)||ps(e),this.currentSelection.set(s))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let s=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(s==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!s||s.ignoreMutation(e))return null;if(e.type=="childList"){for(let u=0;u<e.addedNodes.length;u++){let f=e.addedNodes[u];t.push(f),f.nodeType==3&&(this.lastChangedTextNode=f)}if(s.contentDOM&&s.contentDOM!=s.dom&&!s.contentDOM.contains(e.target))return{from:s.posBefore,to:s.posAfter};let i=e.previousSibling,r=e.nextSibling;if(Zt&&Ls<=11&&e.addedNodes.length)for(let u=0;u<e.addedNodes.length;u++){let{previousSibling:f,nextSibling:h}=e.addedNodes[u];(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(i=f),(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(r=h)}let o=i&&i.parentNode==e.target?It(i)+1:0,a=s.localPosFromDOM(e.target,o,-1),l=r&&r.parentNode==e.target?It(r):e.target.childNodes.length,d=s.localPosFromDOM(e.target,l,1);return{from:a,to:d}}else return e.type=="attributes"?{from:s.posAtStart-s.border,to:s.posAtEnd+s.border}:(this.lastChangedTextNode=e.target,{from:s.posAtStart,to:s.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let ih=new WeakMap,rh=!1;function xA(n){if(!ih.has(n)&&(ih.set(n,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(n.dom).whiteSpace)!==-1)){if(n.requiresGeckoHackNode=Fn,rh)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),rh=!0}}function oh(n,e){let t=e.startContainer,s=e.startOffset,i=e.endContainer,r=e.endOffset,o=n.domAtPos(n.state.selection.anchor);return ki(o.node,o.offset,i,r)&&([t,s,i,r]=[i,r,t,s]),{anchorNode:t,anchorOffset:s,focusNode:i,focusOffset:r}}function yA(n,e){if(e.getComposedRanges){let i=e.getComposedRanges(n.root)[0];if(i)return oh(n,i)}let t;function s(i){i.preventDefault(),i.stopImmediatePropagation(),t=i.getTargetRanges()[0]}return n.dom.addEventListener("beforeinput",s,!0),document.execCommand("indent"),n.dom.removeEventListener("beforeinput",s,!0),t?oh(n,t):null}function bA(n,e){for(let t=e.parentNode;t&&t!=n.dom;t=t.parentNode){let s=n.docView.nearestDesc(t,!0);if(s&&s.node.isBlock)return t}return null}function kA(n,e,t){let{node:s,fromOffset:i,toOffset:r,from:o,to:a}=n.docView.parseRange(e,t),l=n.domSelectionRange(),d,u=l.anchorNode;if(u&&n.dom.contains(u.nodeType==1?u:u.parentNode)&&(d=[{node:u,offset:l.anchorOffset}],il(l)||d.push({node:l.focusNode,offset:l.focusOffset})),Bt&&n.input.lastKeyCode===8)for(let w=r;w>i;w--){let S=s.childNodes[w-1],_=S.pmViewDesc;if(S.nodeName=="BR"&&!_){r=w;break}if(!_||_.size)break}let f=n.state.doc,h=n.someProp("domParser")||Xr.fromSchema(n.state.schema),g=f.resolve(o),x=null,y=h.parse(s,{topNode:g.parent,topMatch:g.parent.contentMatchAt(g.index()),topOpen:!0,from:i,to:r,preserveWhitespace:g.parent.type.whitespace=="pre"?"full":!0,findPositions:d,ruleFromNode:wA,context:g});if(d&&d[0].pos!=null){let w=d[0].pos,S=d[1]&&d[1].pos;S==null&&(S=w),x={anchor:w+o,head:S+o}}return{doc:y,sel:x,from:o,to:a}}function wA(n){let e=n.pmViewDesc;if(e)return e.parseRule();if(n.nodeName=="BR"&&n.parentNode){if(Kt&&/^(ul|ol)$/i.test(n.parentNode.nodeName)){let t=document.createElement("div");return t.appendChild(document.createElement("li")),{skip:t}}else if(n.parentNode.lastChild==n||Kt&&/^(tr|table)$/i.test(n.parentNode.nodeName))return{ignore:!0}}else if(n.nodeName=="IMG"&&n.getAttribute("mark-placeholder"))return{ignore:!0};return null}const vA=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function SA(n,e,t,s,i){let r=n.input.compositionPendingChanges||(n.composing?n.input.compositionID:0);if(n.input.compositionPendingChanges=0,e<0){let I=n.input.lastSelectionTime>Date.now()-50?n.input.lastSelectionOrigin:null,$=eu(n,I);if($&&!n.state.selection.eq($)){if(Bt&&Dn&&n.input.lastKeyCode===13&&Date.now()-100<n.input.lastKeyCodeTime&&n.someProp("handleKeyDown",U=>U(n,ii(13,"Enter"))))return;let B=n.state.tr.setSelection($);I=="pointer"?B.setMeta("pointer",!0):I=="key"&&B.scrollIntoView(),r&&B.setMeta("composition",r),n.dispatch(B)}return}let o=n.state.doc.resolve(e),a=o.sharedDepth(t);e=o.before(a+1),t=n.state.doc.resolve(t).after(a+1);let l=n.state.selection,d=kA(n,e,t),u=n.state.doc,f=u.slice(d.from,d.to),h,g;n.input.lastKeyCode===8&&Date.now()-100<n.input.lastKeyCodeTime?(h=n.state.selection.to,g="end"):(h=n.state.selection.from,g="start"),n.input.lastKeyCode=null;let x=TA(f.content,d.doc.content,d.from,h,g);if((lr&&n.input.lastIOSEnter>Date.now()-225||Dn)&&i.some(I=>I.nodeType==1&&!vA.test(I.nodeName))&&(!x||x.endA>=x.endB)&&n.someProp("handleKeyDown",I=>I(n,ii(13,"Enter")))){n.input.lastIOSEnter=0;return}if(!x)if(s&&l instanceof We&&!l.empty&&l.$head.sameParent(l.$anchor)&&!n.composing&&!(d.sel&&d.sel.anchor!=d.sel.head))x={start:l.from,endA:l.to,endB:l.to};else{if(d.sel){let I=ah(n,n.state.doc,d.sel);if(I&&!I.eq(n.state.selection)){let $=n.state.tr.setSelection(I);r&&$.setMeta("composition",r),n.dispatch($)}}return}n.input.domChangeCount++,n.state.selection.from<n.state.selection.to&&x.start==x.endB&&n.state.selection instanceof We&&(x.start>n.state.selection.from&&x.start<=n.state.selection.from+2&&n.state.selection.from>=d.from?x.start=n.state.selection.from:x.endA<n.state.selection.to&&x.endA>=n.state.selection.to-2&&n.state.selection.to<=d.to&&(x.endB+=n.state.selection.to-x.endA,x.endA=n.state.selection.to)),Zt&&Ls<=11&&x.endB==x.start+1&&x.endA==x.start&&x.start>d.from&&d.doc.textBetween(x.start-d.from-1,x.start-d.from+1)=="  "&&(x.start--,x.endA--,x.endB--);let y=d.doc.resolveNoCache(x.start-d.from),w=d.doc.resolveNoCache(x.endB-d.from),S=u.resolve(x.start),_=y.sameParent(w)&&y.parent.inlineContent&&S.end()>=x.endA,O;if((lr&&n.input.lastIOSEnter>Date.now()-225&&(!_||i.some(I=>I.nodeName=="DIV"||I.nodeName=="P"))||!_&&y.pos<d.doc.content.size&&!y.sameParent(w)&&(O=Ne.findFrom(d.doc.resolve(y.pos+1),1,!0))&&O.head==w.pos)&&n.someProp("handleKeyDown",I=>I(n,ii(13,"Enter")))){n.input.lastIOSEnter=0;return}if(n.state.selection.anchor>x.start&&MA(u,x.start,x.endA,y,w)&&n.someProp("handleKeyDown",I=>I(n,ii(8,"Backspace")))){Dn&&Bt&&n.domObserver.suppressSelectionUpdates();return}Bt&&Dn&&x.endB==x.start&&(n.input.lastAndroidDelete=Date.now()),Dn&&!_&&y.start()!=w.start()&&w.parentOffset==0&&y.depth==w.depth&&d.sel&&d.sel.anchor==d.sel.head&&d.sel.head==x.endA&&(x.endB-=2,w=d.doc.resolveNoCache(x.endB-d.from),setTimeout(()=>{n.someProp("handleKeyDown",function(I){return I(n,ii(13,"Enter"))})},20));let T=x.start,E=x.endA,R,F,D;if(_){if(y.pos==w.pos)Zt&&Ls<=11&&y.parentOffset==0&&(n.domObserver.suppressSelectionUpdates(),setTimeout(()=>ps(n),20)),R=n.state.tr.delete(T,E),F=u.resolve(x.start).marksAcross(u.resolve(x.endA));else if(x.endA==x.endB&&(D=CA(y.parent.content.cut(y.parentOffset,w.parentOffset),S.parent.content.cut(S.parentOffset,x.endA-S.start()))))R=n.state.tr,D.type=="add"?R.addMark(T,E,D.mark):R.removeMark(T,E,D.mark);else if(y.parent.child(y.index()).isText&&y.index()==w.index()-(w.textOffset?0:1)){let I=y.parent.textBetween(y.parentOffset,w.parentOffset);if(n.someProp("handleTextInput",$=>$(n,T,E,I)))return;R=n.state.tr.insertText(I,T,E)}}if(R||(R=n.state.tr.replace(T,E,d.doc.slice(x.start-d.from,x.endB-d.from))),d.sel){let I=ah(n,R.doc,d.sel);I&&!(Bt&&Dn&&n.composing&&I.empty&&(x.start!=x.endB||n.input.lastAndroidDelete<Date.now()-100)&&(I.head==T||I.head==R.mapping.map(E)-1)||Zt&&I.empty&&I.head==T)&&R.setSelection(I)}F&&R.ensureMarks(F),r&&R.setMeta("composition",r),n.dispatch(R.scrollIntoView())}function ah(n,e,t){return Math.max(t.anchor,t.head)>e.content.size?null:tu(n,e.resolve(t.anchor),e.resolve(t.head))}function CA(n,e){let t=n.firstChild.marks,s=e.firstChild.marks,i=t,r=s,o,a,l;for(let u=0;u<s.length;u++)i=s[u].removeFromSet(i);for(let u=0;u<t.length;u++)r=t[u].removeFromSet(r);if(i.length==1&&r.length==0)a=i[0],o="add",l=u=>u.mark(a.addToSet(u.marks));else if(i.length==0&&r.length==1)a=r[0],o="remove",l=u=>u.mark(a.removeFromSet(u.marks));else return null;let d=[];for(let u=0;u<e.childCount;u++)d.push(l(e.child(u)));if(K.from(d).eq(n))return{mark:a,type:o}}function MA(n,e,t,s,i){if(t-e<=i.pos-s.pos||Ul(s,!0,!1)<i.pos)return!1;let r=n.resolve(e);if(!s.parent.isTextblock){let a=r.nodeAfter;return a!=null&&t==e+a.nodeSize}if(r.parentOffset<r.parent.content.size||!r.parent.isTextblock)return!1;let o=n.resolve(Ul(r,!0,!0));return!o.parent.isTextblock||o.pos>t||Ul(o,!0,!1)<t?!1:s.parent.content.cut(s.parentOffset).eq(o.parent.content)}function Ul(n,e,t){let s=n.depth,i=e?n.end():n.pos;for(;s>0&&(e||n.indexAfter(s)==n.node(s).childCount);)s--,i++,e=!1;if(t){let r=n.node(s).maybeChild(n.indexAfter(s));for(;r&&!r.isLeaf;)r=r.firstChild,i++}return i}function TA(n,e,t,s,i){let r=n.findDiffStart(e,t);if(r==null)return null;let{a:o,b:a}=n.findDiffEnd(e,t+n.size,t+e.size);if(i=="end"){let l=Math.max(0,r-Math.min(o,a));s-=o+l-r}if(o<r&&n.size<e.size){let l=s<=r&&s>=o?r-s:0;r-=l,r&&r<e.size&&lh(e.textBetween(r-1,r+1))&&(r+=l?1:-1),a=r+(a-o),o=r}else if(a<r){let l=s<=r&&s>=a?r-s:0;r-=l,r&&r<n.size&&lh(n.textBetween(r-1,r+1))&&(r+=l?1:-1),o=r+(o-a),a=r}return{start:r,endA:o,endB:a}}function lh(n){if(n.length!=2)return!1;let e=n.charCodeAt(0),t=n.charCodeAt(1);return e>=56320&&e<=57343&&t>=55296&&t<=56319}class EA{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new H_,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(hh),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=uh(this),dh(this),this.nodeViews=fh(this),this.docView=Gf(this.state.doc,ch(this),Bl(this),this.dom,this),this.domObserver=new gA(this,(s,i,r,o)=>SA(this,s,i,r,o)),this.domObserver.start(),q_(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let t in e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&Lc(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(hh),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let s in this._props)t[s]=this._props[s];t.state=this.state;for(let s in e)t[s]=e[s];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){var s;let i=this.state,r=!1,o=!1;e.storedMarks&&this.composing&&(I0(this),o=!0),this.state=e;let a=i.plugins!=e.plugins||this._props.plugins!=t.plugins;if(a||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let g=fh(this);AA(g,this.nodeViews)&&(this.nodeViews=g,r=!0)}(a||t.handleDOMEvents!=this._props.handleDOMEvents)&&Lc(this),this.editable=uh(this),dh(this);let l=Bl(this),d=ch(this),u=i.plugins!=e.plugins&&!i.doc.eq(e.doc)?"reset":e.scrollToSelection>i.scrollToSelection?"to selection":"preserve",f=r||!this.docView.matchesNode(e.doc,d,l);(f||!e.selection.eq(i.selection))&&(o=!0);let h=u=="preserve"&&o&&this.dom.style.overflowAnchor==null&&l_(this);if(o){this.domObserver.stop();let g=f&&(Zt||Bt)&&!this.composing&&!i.selection.empty&&!e.selection.empty&&_A(i.selection,e.selection);if(f){let x=Bt?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=oA(this)),(r||!this.docView.update(e.doc,d,l,this))&&(this.docView.updateOuterDeco(d),this.docView.destroy(),this.docView=Gf(e.doc,d,l,this.dom,this)),x&&!this.trackWrites&&(g=!0)}g||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&R_(this))?ps(this,g):(y0(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(i),!((s=this.dragging)===null||s===void 0)&&s.node&&!i.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,i),u=="reset"?this.dom.scrollTop=0:u=="to selection"?this.scrollToSelection():h&&c_(h)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!this.someProp("handleScrollToSelection",t=>t(this)))if(this.state.selection instanceof he){let t=this.docView.domAfterPos(this.state.selection.from);t.nodeType==1&&Ff(this,t.getBoundingClientRect(),e)}else Ff(this,this.coordsAtPos(this.state.selection.head,1),e)}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let t=0;t<this.directPlugins.length;t++){let s=this.directPlugins[t];s.spec.view&&this.pluginViews.push(s.spec.view(this))}for(let t=0;t<this.state.plugins.length;t++){let s=this.state.plugins[t];s.spec.view&&this.pluginViews.push(s.spec.view(this))}}else for(let t=0;t<this.pluginViews.length;t++){let s=this.pluginViews[t];s.update&&s.update(this,e)}}updateDraggedNode(e,t){let s=e.node,i=-1;if(this.state.doc.nodeAt(s.from)==s.node)i=s.from;else{let r=s.from+(this.state.doc.content.size-t.doc.content.size);(r>0&&this.state.doc.nodeAt(r))==s.node&&(i=r)}this.dragging=new D0(e.slice,e.move,i<0?void 0:he.create(this.state.doc,i))}someProp(e,t){let s=this._props&&this._props[e],i;if(s!=null&&(i=t?t(s):s))return i;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(i=t?t(a):a))return i}let r=this.state.plugins;if(r)for(let o=0;o<r.length;o++){let a=r[o].props[e];if(a!=null&&(i=t?t(a):a))return i}}hasFocus(){if(Zt){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&d_(this.dom),ps(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let t=this.dom.parentNode;t;t=t.parentNode)if(t.nodeType==9||t.nodeType==11&&t.host)return t.getSelection||(Object.getPrototypeOf(t).getSelection=()=>t.ownerDocument.getSelection()),this._root=t}return e||document}updateRoot(){this._root=null}posAtCoords(e){return m_(this,e)}coordsAtPos(e,t=1){return d0(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,s=-1){let i=this.docView.posFromDOM(e,t,s);if(i==null)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,t){return k_(this,t||this.state,e)}pasteHTML(e,t){return to(this,"",e,!1,t||new ClipboardEvent("paste"))}pasteText(e,t){return to(this,e,null,!0,t||new ClipboardEvent("paste"))}destroy(){this.docView&&(K_(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Bl(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,XE())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return Y_(this,e)}dispatch(e){let t=this._props.dispatchTransaction;t?t.call(this,e):this.updateState(this.state.apply(e))}domSelectionRange(){let e=this.domSelection();return Kt&&this.root.nodeType===11&&n_(this.dom.ownerDocument)==this.dom&&yA(this,e)||e}domSelection(){return this.root.getSelection()}}function ch(n){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(n.editable),n.someProp("attributes",t=>{if(typeof t=="function"&&(t=t(n.state)),t)for(let s in t)s=="class"?e.class+=" "+t[s]:s=="style"?e.style=(e.style?e.style+";":"")+t[s]:!e[s]&&s!="contenteditable"&&s!="nodeName"&&(e[s]=String(t[s]))}),e.translate||(e.translate="no"),[un.node(0,n.state.doc.content.size,e)]}function dh(n){if(n.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),n.cursorWrapper={dom:e,deco:un.widget(n.state.selection.head,e,{raw:!0,marks:n.markCursor})}}else n.cursorWrapper=null}function uh(n){return!n.someProp("editable",e=>e(n.state)===!1)}function _A(n,e){let t=Math.min(n.$anchor.sharedDepth(n.head),e.$anchor.sharedDepth(e.head));return n.$anchor.start(t)!=e.$anchor.start(t)}function fh(n){let e=Object.create(null);function t(s){for(let i in s)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=s[i])}return n.someProp("nodeViews",t),n.someProp("markViews",t),e}function AA(n,e){let t=0,s=0;for(let i in n){if(n[i]!=e[i])return!0;t++}for(let i in e)s++;return t!=s}function hh(n){if(n.spec.state||n.spec.filterTransaction||n.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}const Pr=new kr("placeholderPlugin");function NA(n){return new Ei({key:Pr,state:{init(){return{placeholder:n}},apply(e,t){return e.getMeta(Pr)?{placeholder:e.getMeta(Pr).placeholder}:t}},props:{decorations(e){var i;const{doc:t}=e;if(t.childCount===1&&((i=t.firstChild)==null?void 0:i.isTextblock)&&t.firstChild.content.size===0){const r=[],{placeholder:o}=Pr.getState(e);return e.doc.descendants((a,l)=>{const d=un.node(l,l+a.nodeSize,{class:"placeholder","data-placeholder":o});r.push(d)}),mt.create(t,r)}}}})}const au="command_token",IA={group:"inline",inline:!0,atom:!0,content:"text*",attrs:{id:"",hint:""},selectable:!1,draggable:!1,toDOM:n=>["span",{"data-mention-id":n.attrs.id,"data-mention-hint":n.attrs.hint,class:"shimmer-blue"},n.attrs.hint],parseDOM:[{tag:"span[data-mention-id][data-mention-hint]",getAttrs:n=>{const e=n.getAttribute("data-mention-id"),t=n.getAttribute("data-mention-hint");return{id:e,hint:t}}}]};function RA(n){if(n.depth===0)return;const e=n.before(),s=n.doc.textBetween(e,n.pos,`
`,"\0").match(new RegExp(/(^|\s)\/(\w*)$/));if(s&&s.index!==void 0){const i=s[0].startsWith(" ")?s.index+1:s.index,r=s[0].startsWith(" ")?s[0].length-1:s[0].length,o=n.start()+i,a=o+r;return{range:{from:o,to:a},queryText:s[2]}}}const ph=new kr("slashCommandPlugin");function mh(){return{queryText:"",active:!1,range:void 0}}function Y5(n,e,t,s){const i=n.state.schema.nodes[au].create({...e},n.state.schema.text(e.hint)),r=n.state.tr.replaceWith(t.from,t.to,i);s&&r.insertText(" ",t.from+i.nodeSize),n.dispatch(r)}function gh(n){const{active:e,range:t,queryText:s,onHintMatch:i}=n;if(i)return i(!e||!t?void 0:{text:s,range:t})}function DA(n){const e=[];return n.descendants(t=>{var s;t.type.name===au&&typeof((s=t.attrs)==null?void 0:s.id)=="string"&&e.push(t.attrs.id)}),e}function jA(){return new Ei({key:ph,state:{init(){return mh()},apply(n,e){const t=n.getMeta(ph),s=n.selection,i=s.$from,r=RA(i),o={...mh(),...e,...t};return s.from!==s.to?(gh(o),o):(o.active=!!r,r&&(o.queryText=r.queryText,o.range=r.range),gh(o),o)}}})}class L0 extends Gp{constructor(e){super(),this.view=e}isEmpty(){return!this.view.state.doc.textContent}trimLeadingText(e){const s=this.view.state.tr;let i=!1,r=!1;return s.doc.descendants((o,a)=>{var l;i||!o.isText||(i=!0,(l=o.text)!=null&&l.startsWith(e)&&(r=!0,s.insertText(o.text.replace(e,""),a,a+o.text.length)))}),r&&this.view.dispatch(s),r}replaceAll(e,t){const i=this.view.state.tr,r=[];i.doc.descendants((o,a)=>{!o.isText||o.text===void 0||r.push({node:o,pos:a})}),r.reverse(),r.forEach(({node:o,pos:a})=>{!o.isText||o.text===void 0||o.text.includes(e)&&i.insertText(o.text.replaceAll(e,t),a,a+o.text.length)}),this.view.dispatch(i)}appendText(e){this.view.dispatch(this.view.state.tr.insertText(e))}focus(){this.view.dom.focus()}setText(e){const{tr:t,schema:s}=this.view.state,i=e?s.nodes.paragraph.create(null,s.text(e)):s.nodes.paragraph.create();this.view.dispatch(t.replaceWith(0,this.view.state.doc.content.size,i))}getCurrentText(){return this.view.state.doc.textContent}getTextToSend(){return HE(this.view)}resize(){}isReady(){return!!this.view.state.doc}setPlaceholder(e){this.view.dispatch(this.view.state.tr.setMeta(Pr,{placeholder:e}))}getSelectionStart(){return this.view.state.selection.ranges[0].$from.pos}isMenuSelectorActive(){return Wi.getState(this.view.state).active}acceptLegacyKeydown(){return!this.isMenuSelectorActive()}subscribe(e,t){var s;return(s=this.view.dom)==null||s.addEventListener(e,t),()=>{var i;(i=this.view.dom)==null||i.removeEventListener(e,t)}}useState(e){return k.useSyncExternalStore(t=>_E(this.view,t),()=>e(this))}getSystemHints(){const e=DA(this.view.state.tr.doc);return e.length?[e[0]]:[]}canShowAutocompletion(){return!this.isMenuSelectorActive()&&!this.getSystemHints().length}}const PA=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function OA(n){let e=n.split(/-(?!$)/),t=e[e.length-1];t=="Space"&&(t=" ");let s,i,r,o;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))s=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))r=!0;else if(/^mod$/i.test(l))PA?o=!0:i=!0;else throw new Error("Unrecognized modifier name: "+l)}return s&&(t="Alt-"+t),i&&(t="Ctrl-"+t),o&&(t="Meta-"+t),r&&(t="Shift-"+t),t}function FA(n){let e=Object.create(null);for(let t in n)e[OA(t)]=n[t];return e}function zl(n,e,t=!0){return e.altKey&&(n="Alt-"+n),e.ctrlKey&&(n="Ctrl-"+n),e.metaKey&&(n="Meta-"+n),t&&e.shiftKey&&(n="Shift-"+n),n}function Bc(n){return new Ei({props:{handleKeyDown:B0(n)}})}function B0(n){let e=FA(n);return function(t,s){let i=nk(s),r,o=e[zl(i,s)];if(o&&o(t.state,t.dispatch,t))return!0;if(i.length==1&&i!=" "){if(s.shiftKey){let a=e[zl(i,s,!1)];if(a&&a(t.state,t.dispatch,t))return!0}if((s.shiftKey||s.altKey||s.metaKey||i.charCodeAt(0)>127)&&(r=sk[s.keyCode])&&r!=i){let a=e[zl(r,s)];if(a&&a(t.state,t.dispatch,t))return!0}}return!1}}class dt extends Ne{constructor(e){super(e,e)}map(e,t){let s=e.resolve(t.map(this.head));return dt.valid(s)?new dt(s):Ne.near(s)}content(){return ie.empty}eq(e){return e instanceof dt&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new dt(e.resolve(t.pos))}getBookmark(){return new lu(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!LA(e)||!BA(e))return!1;let s=t.type.spec.allowGapCursor;if(s!=null)return s;let i=t.contentMatchAt(e.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(e,t,s=!1){e:for(;;){if(!s&&dt.valid(e))return e;let i=e.pos,r=null;for(let o=e.depth;;o--){let a=e.node(o);if(t>0?e.indexAfter(o)<a.childCount:e.index(o)>0){r=a.child(t>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;i+=t;let l=e.doc.resolve(i);if(dt.valid(l))return l}for(;;){let o=t>0?r.firstChild:r.lastChild;if(!o){if(r.isAtom&&!r.isText&&!he.isSelectable(r)){e=e.doc.resolve(i+r.nodeSize*t),s=!1;continue e}break}r=o,i+=t;let a=e.doc.resolve(i);if(dt.valid(a))return a}return null}}}dt.prototype.visible=!1;dt.findFrom=dt.findGapCursorFrom;Ne.jsonID("gapcursor",dt);class lu{constructor(e){this.pos=e}map(e){return new lu(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return dt.valid(t)?new dt(t):Ne.near(t)}}function LA(n){for(let e=n.depth;e>=0;e--){let t=n.index(e),s=n.node(e);if(t==0){if(s.type.spec.isolating)return!0;continue}for(let i=s.child(t-1);;i=i.lastChild){if(i.childCount==0&&!i.inlineContent||i.isAtom||i.type.spec.isolating)return!0;if(i.inlineContent)return!1}}return!0}function BA(n){for(let e=n.depth;e>=0;e--){let t=n.indexAfter(e),s=n.node(e);if(t==s.childCount){if(s.type.spec.isolating)return!0;continue}for(let i=s.child(t);;i=i.firstChild){if(i.childCount==0&&!i.inlineContent||i.isAtom||i.type.spec.isolating)return!0;if(i.inlineContent)return!1}}return!0}function UA(){return new Ei({props:{decorations:$A,createSelectionBetween(n,e,t){return e.pos==t.pos&&dt.valid(t)?new dt(t):null},handleClick:VA,handleKeyDown:zA,handleDOMEvents:{beforeinput:GA}}})}const zA=B0({ArrowLeft:Lo("horiz",-1),ArrowRight:Lo("horiz",1),ArrowUp:Lo("vert",-1),ArrowDown:Lo("vert",1)});function Lo(n,e){const t=n=="vert"?e>0?"down":"up":e>0?"right":"left";return function(s,i,r){let o=s.selection,a=e>0?o.$to:o.$from,l=o.empty;if(o instanceof We){if(!r.endOfTextblock(t)||a.depth==0)return!1;l=!1,a=s.doc.resolve(e>0?a.after():a.before())}let d=dt.findGapCursorFrom(a,e,l);return d?(i&&i(s.tr.setSelection(new dt(d))),!0):!1}}function VA(n,e,t){if(!n||!n.editable)return!1;let s=n.state.doc.resolve(e);if(!dt.valid(s))return!1;let i=n.posAtCoords({left:t.clientX,top:t.clientY});return i&&i.inside>-1&&he.isSelectable(n.state.doc.nodeAt(i.inside))?!1:(n.dispatch(n.state.tr.setSelection(new dt(s))),!0)}function GA(n,e){if(e.inputType!="insertCompositionText"||!(n.state.selection instanceof dt))return!1;let{$from:t}=n.state.selection,s=t.parent.contentMatchAt(t.index()).findWrapping(n.state.schema.nodes.text);if(!s)return!1;let i=K.empty;for(let o=s.length-1;o>=0;o--)i=K.from(s[o].createAndFill(null,i));let r=n.state.tr.replace(t.pos,t.pos,new ie(i,0,0));return r.setSelection(We.near(r.doc.resolve(t.pos+1))),n.dispatch(r),!1}function $A(n){if(!(n.selection instanceof dt))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",mt.create(n.doc,[un.widget(n.selection.head,e,{key:"gapcursor"})])}var Ra=200,Et=function(){};Et.prototype.append=function(e){return e.length?(e=Et.from(e),!this.length&&e||e.length<Ra&&this.leafAppend(e)||this.length<Ra&&e.leafPrepend(this)||this.appendInner(e)):this};Et.prototype.prepend=function(e){return e.length?Et.from(e).append(this):this};Et.prototype.appendInner=function(e){return new WA(this,e)};Et.prototype.slice=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.length),e>=t?Et.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))};Et.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};Et.prototype.forEach=function(e,t,s){t===void 0&&(t=0),s===void 0&&(s=this.length),t<=s?this.forEachInner(e,t,s,0):this.forEachInvertedInner(e,t,s,0)};Et.prototype.map=function(e,t,s){t===void 0&&(t=0),s===void 0&&(s=this.length);var i=[];return this.forEach(function(r,o){return i.push(e(r,o))},t,s),i};Et.from=function(e){return e instanceof Et?e:e&&e.length?new U0(e):Et.empty};var U0=function(n){function e(s){n.call(this),this.values=s}n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e;var t={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(i,r){return i==0&&r==this.length?this:new e(this.values.slice(i,r))},e.prototype.getInner=function(i){return this.values[i]},e.prototype.forEachInner=function(i,r,o,a){for(var l=r;l<o;l++)if(i(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(i,r,o,a){for(var l=r-1;l>=o;l--)if(i(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(i){if(this.length+i.length<=Ra)return new e(this.values.concat(i.flatten()))},e.prototype.leafPrepend=function(i){if(this.length+i.length<=Ra)return new e(i.flatten().concat(this.values))},t.length.get=function(){return this.values.length},t.depth.get=function(){return 0},Object.defineProperties(e.prototype,t),e}(Et);Et.empty=new U0([]);var WA=function(n){function e(t,s){n.call(this),this.left=t,this.right=s,this.length=t.length+s.length,this.depth=Math.max(t.depth,s.depth)+1}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(s){return s<this.left.length?this.left.get(s):this.right.get(s-this.left.length)},e.prototype.forEachInner=function(s,i,r,o){var a=this.left.length;if(i<a&&this.left.forEachInner(s,i,Math.min(r,a),o)===!1||r>a&&this.right.forEachInner(s,Math.max(i-a,0),Math.min(this.length,r)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(s,i,r,o){var a=this.left.length;if(i>a&&this.right.forEachInvertedInner(s,i-a,Math.max(r,a)-a,o+a)===!1||r<a&&this.left.forEachInvertedInner(s,Math.min(i,a),r,o)===!1)return!1},e.prototype.sliceInner=function(s,i){if(s==0&&i==this.length)return this;var r=this.left.length;return i<=r?this.left.slice(s,i):s>=r?this.right.slice(s-r,i-r):this.left.slice(s,r).append(this.right.slice(0,i-r))},e.prototype.leafAppend=function(s){var i=this.right.leafAppend(s);if(i)return new e(this.left,i)},e.prototype.leafPrepend=function(s){var i=this.left.leafPrepend(s);if(i)return new e(i,this.right)},e.prototype.appendInner=function(s){return this.left.depth>=Math.max(this.right.depth,s.depth)+1?new e(this.left,new e(this.right,s)):new e(this,s)},e}(Et);const HA=500;class jn{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(this.eventCount==0)return null;let s=this.items.length;for(;;s--)if(this.items.get(s-1).selection){--s;break}let i,r;t&&(i=this.remapping(s,this.items.length),r=i.maps.length);let o=e.tr,a,l,d=[],u=[];return this.items.forEach((f,h)=>{if(!f.step){i||(i=this.remapping(s,h+1),r=i.maps.length),r--,u.push(f);return}if(i){u.push(new $n(f.map));let g=f.step.map(i.slice(r)),x;g&&o.maybeStep(g).doc&&(x=o.mapping.maps[o.mapping.maps.length-1],d.push(new $n(x,void 0,void 0,d.length+u.length))),r--,x&&i.appendMap(x,r)}else o.maybeStep(f.step);if(f.selection)return a=i?f.selection.map(i.slice(r)):f.selection,l=new jn(this.items.slice(0,s).append(u.reverse().concat(d)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:a}}addTransform(e,t,s,i){let r=[],o=this.eventCount,a=this.items,l=!i&&a.length?a.get(a.length-1):null;for(let u=0;u<e.steps.length;u++){let f=e.steps[u].invert(e.docs[u]),h=new $n(e.mapping.maps[u],f,t),g;(g=l&&l.merge(h))&&(h=g,u?r.pop():a=a.slice(0,a.length-1)),r.push(h),t&&(o++,t=void 0),i||(l=h)}let d=o-s.depth;return d>KA&&(a=qA(a,d),o-=d),new jn(a.append(r),o)}remapping(e,t){let s=new Gi;return this.items.forEach((i,r)=>{let o=i.mirrorOffset!=null&&r-i.mirrorOffset>=e?s.maps.length-i.mirrorOffset:void 0;s.appendMap(i.map,o)},e,t),s}addMaps(e){return this.eventCount==0?this:new jn(this.items.append(e.map(t=>new $n(t))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let s=[],i=Math.max(0,this.items.length-t),r=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(h=>{h.selection&&a--},i);let l=t;this.items.forEach(h=>{let g=r.getMirror(--l);if(g==null)return;o=Math.min(o,g);let x=r.maps[g];if(h.step){let y=e.steps[g].invert(e.docs[g]),w=h.selection&&h.selection.map(r.slice(l+1,g));w&&a++,s.push(new $n(x,y,w))}else s.push(new $n(x))},i);let d=[];for(let h=t;h<o;h++)d.push(new $n(r.maps[h]));let u=this.items.slice(0,i).append(d).append(s),f=new jn(u,a);return f.emptyItemCount()>HA&&(f=f.compress(this.items.length-s.length)),f}emptyItemCount(){let e=0;return this.items.forEach(t=>{t.step||e++}),e}compress(e=this.items.length){let t=this.remapping(0,e),s=t.maps.length,i=[],r=0;return this.items.forEach((o,a)=>{if(a>=e)i.push(o),o.selection&&r++;else if(o.step){let l=o.step.map(t.slice(s)),d=l&&l.getMap();if(s--,d&&t.appendMap(d,s),l){let u=o.selection&&o.selection.map(t.slice(s));u&&r++;let f=new $n(d.invert(),l,u),h,g=i.length-1;(h=i.length&&i[g].merge(f))?i[g]=h:i.push(f)}}else o.map&&s--},this.items.length,0),new jn(Et.from(i.reverse()),r)}}jn.empty=new jn(Et.empty,0);function qA(n,e){let t;return n.forEach((s,i)=>{if(s.selection&&e--==0)return t=i,!1}),n.slice(t)}class $n{constructor(e,t,s,i){this.map=e,this.step=t,this.selection=s,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new $n(t.getMap().invert(),t,this.selection)}}}class As{constructor(e,t,s,i,r){this.done=e,this.undone=t,this.prevRanges=s,this.prevTime=i,this.prevComposition=r}}const KA=20;function JA(n,e,t,s){let i=t.getMeta(pi),r;if(i)return i.historyState;t.getMeta(QA)&&(n=new As(n.done,n.undone,null,0,-1));let o=t.getMeta("appendedTransaction");if(t.steps.length==0)return n;if(o&&o.getMeta(pi))return o.getMeta(pi).redo?new As(n.done.addTransform(t,void 0,s,Qo(e)),n.undone,xh(t.mapping.maps),n.prevTime,n.prevComposition):new As(n.done,n.undone.addTransform(t,void 0,s,Qo(e)),null,n.prevTime,n.prevComposition);if(t.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=t.getMeta("composition"),l=n.prevTime==0||!o&&n.prevComposition!=a&&(n.prevTime<(t.time||0)-s.newGroupDelay||!YA(t,n.prevRanges)),d=o?Vl(n.prevRanges,t.mapping):xh(t.mapping.maps);return new As(n.done.addTransform(t,l?e.selection.getBookmark():void 0,s,Qo(e)),jn.empty,d,t.time,a??n.prevComposition)}else return(r=t.getMeta("rebased"))?new As(n.done.rebased(t,r),n.undone.rebased(t,r),Vl(n.prevRanges,t.mapping),n.prevTime,n.prevComposition):new As(n.done.addMaps(t.mapping.maps),n.undone.addMaps(t.mapping.maps),Vl(n.prevRanges,t.mapping),n.prevTime,n.prevComposition)}function YA(n,e){if(!e)return!1;if(!n.docChanged)return!0;let t=!1;return n.mapping.maps[0].forEach((s,i)=>{for(let r=0;r<e.length;r+=2)s<=e[r+1]&&i>=e[r]&&(t=!0)}),t}function xh(n){let e=[];for(let t=n.length-1;t>=0&&e.length==0;t--)n[t].forEach((s,i,r,o)=>e.push(r,o));return e}function Vl(n,e){if(!n)return null;let t=[];for(let s=0;s<n.length;s+=2){let i=e.map(n[s],1),r=e.map(n[s+1],-1);i<=r&&t.push(i,r)}return t}function XA(n,e,t){let s=Qo(e),i=pi.get(e).spec.config,r=(t?n.undone:n.done).popEvent(e,s);if(!r)return null;let o=r.selection.resolve(r.transform.doc),a=(t?n.done:n.undone).addTransform(r.transform,e.selection.getBookmark(),i,s),l=new As(t?a:r.remaining,t?r.remaining:a,null,0,-1);return r.transform.setSelection(o).setMeta(pi,{redo:t,historyState:l})}let Gl=!1,yh=null;function Qo(n){let e=n.plugins;if(yh!=e){Gl=!1,yh=e;for(let t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){Gl=!0;break}}return Gl}const pi=new kr("history"),QA=new kr("closeHistory");function ZA(n={}){return n={depth:n.depth||100,newGroupDelay:n.newGroupDelay||500},new Ei({key:pi,state:{init(){return new As(jn.empty,jn.empty,null,0,-1)},apply(e,t,s){return JA(t,s,e,n)}},config:n,props:{handleDOMEvents:{beforeinput(e,t){let s=t.inputType,i=s=="historyUndo"?V0:s=="historyRedo"?Uc:null;return i?(t.preventDefault(),i(e.state,e.dispatch)):!1}}}})}function z0(n,e){return(t,s)=>{let i=pi.getState(t);if(!i||(n?i.undone:i.done).eventCount==0)return!1;if(s){let r=XA(i,t,n);r&&s(e?r.scrollIntoView():r)}return!0}}const V0=z0(!1,!0),Uc=z0(!0,!0);function eN(){return Bc({"Shift-Enter":(n,e)=>Ec(n,e),Enter:(n,e)=>window.innerWidth>Jx[Yx.Medium]?!1:Ec(n,e)})}const tN=["p",0],nN=["br"],sN=new z2({nodes:{paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p",preserveWhitespace:"full"}],toDOM(){return tN}},text:{group:"inline"},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM(){return nN}},[au]:IA,doc:{content:"block+"}},marks:{}});function iN(){const n=new EventTarget,e=new EA(null,{state:zi.create({schema:sN,plugins:[ZA(),YE({submitKeys:["Enter","Tab"],cancelKeys:["Escape"],checkStrictMatchKeys:[" "]}),NA(""),jA(),eN(),Bc({"Mod-z":V0,"Mod-y":Uc,"Mod-Shift-z":Uc}),Bc(WE),AE(n),UA()]}),dispatchTransaction(t){const s=e.state.apply(t);e.updateState(s),t.docChanged&&n.dispatchEvent(new Event(Tc))},handlePaste(t,s){var r;const i=(r=s.clipboardData)==null?void 0:r.getData("text/plain");return i===void 0?!1:(qE(t,i),!0)},clipboardTextSerializer(t){return s0(t.content)}});return e}function rN(){try{return navigator.userAgent.toLocaleLowerCase().includes("firefox")}catch{return!1}}const oN=[J([ik["prosemirror-parent"],"text-token-text-primary","max-h-[25dvh]","max-h-52","overflow-auto",rN()?"firefox":"default-browser"])],aN=({children:n})=>{const[e]=k.useState(()=>iN()),[t]=k.useState(()=>new L0(e));return n(t)},lN=({composerController:n,placeholder:e})=>{if(!(n instanceof L0))throw new Error(`Expected instance of ProseMirrorComposerController but got ${n.constructor.name}`);const t=k.useRef(null);return k.useEffect(()=>{t.current.appendChild(n.view.dom)},[]),k.useEffect(()=>{const s=n.view.dom;s&&(s.id=hd,n.focus())},[n]),k.useEffect(()=>{n.setPlaceholder(e)},[e,n]),k.useEffect(()=>{n.logPageMount()},[]),c.jsx("div",{ref:t,className:J(oN)})};var bh=Object.keys,cN=function(e,t){if(e===t)return!0;if(!(e instanceof Object)||!(t instanceof Object))return!1;for(var s=bh(e),i=s.length,r=0;r<i;r++)if(!(s[r]in t))return!1;for(var r=0;r<i;r++)if(e[s[r]]!==t[s[r]])return!1;return i===bh(t).length},dN=function(n,e){var t=window.getComputedStyle(e),s=t.borderBottomWidth,i=t.borderTopWidth,r=t.fontSize,o=t.lineHeight,a=t.paddingBottom,l=t.paddingTop,d=o==="normal"?parseFloat(r)*1.2:parseFloat(o),u=n===0?0:d*n+parseFloat(s)+parseFloat(i)+parseFloat(a)+parseFloat(l),f=e.scrollHeight+parseFloat(s)+parseFloat(i);return Math.max(u,f)},Zo=function(n,e){if(e){var t="hidden",s=window.getComputedStyle(e).maxHeight;if(s!=="none"){var i=parseFloat(s);i<e.scrollHeight&&(t="")}e.style.height="0",e.style.overflowY=t,e.style.height="".concat(dN(n,e),"px")}},uN=function(n){var e=k.useRef(n),t=k.useRef(0);return cN(n,e.current)||(e.current=n,t.current+=1),k.useMemo(function(){return e.current},[t.current])},kh=typeof window>"u"?Function.prototype:k.useLayoutEffect,fN=function(n){var e=n.forwardedRef,t=Su(n,["forwardedRef"]),s=typeof e=="function",i=uN(t.style),r=k.useRef(),o=s||!e?r:e,a=t.rows?parseInt(""+t.rows,10):0,l=t.onChange,d=t.onInput,u=Su(t,["onChange","onInput"]);kh(function(){Zo(a,o.current)},[t.className,t.value,o,a,i]),kh(function(){if(window.ResizeObserver){var g=new ResizeObserver(function(){Zo(a,o.current)});return g.observe(o.current),function(){g.disconnect()}}},[o,a]);var f=k.useCallback(function(g){l==null||l(g),d==null||d(g),Zo(a,o.current)},[l,d,o,a]),h=k.useCallback(function(g){o.current=g,s&&e(g)},[e,s,o]);return co.createElement("textarea",Xx({},u,{onInput:f,ref:h,rows:a}))};const G0=rk(fN);class zc extends Gp{constructor(){super(...arguments);se(this,"textArea",null)}setValue(t){this.textArea&&(typeof t=="string"?this.textArea.value=t:this.textArea.value=t(this.textArea.value))}getSystemHints(){return[]}isEmpty(){var t;return!((t=this.textArea)!=null&&t.value)}trimLeadingText(t){let s=!1;return this.setValue(i=>i.startsWith(t)?(s=!0,i.replace(t,"")):i),s&&this.textArea&&this.textArea.setSelectionRange(this.textArea.selectionStart-t.length,this.textArea.selectionEnd-t.length),s}replaceAll(t,s){this.setValue(i=>i.replaceAll(t,s))}appendText(t){this.setValue(s=>s+t)}focus(){var t;(t=this.textArea)==null||t.focus()}setText(t){this.setValue(t)}getCurrentText(){var t;return((t=this.textArea)==null?void 0:t.value)||""}resize(t){this.textArea&&Zo(t,this.textArea)}isReady(){return this.textArea!==null}acceptLegacyKeydown(){return!0}getSelectionStart(){var t;return((t=this.textArea)==null?void 0:t.selectionStart)??0}subscribe(t,s){var i;return(i=this.textArea)==null||i.addEventListener(t,s),()=>{var r;(r=this.textArea)==null||r.removeEventListener(t,s)}}}const hN=k.forwardRef(function({type:e,placeholder:t,replyRegions:s,state:i,renderFiles:r,icon:o,onSubmit:a,inputState:l,currentLeafId:d,composerController:u,clientThreadId:f,gizmoId:h},g){const x=Ja(),y=Rm(),S=$p()?`${t} (preview, #tmp-composer-v2-feedback)`:t;return k.useEffect(()=>{u.focus()},[y==null?void 0:y.modelId,u]),c.jsxs("div",{ref:g,className:J("flex w-full flex-col gap-1.5 rounded-[26px] p-1.5 transition-colors",x&&"bg-token-composer-surface backdrop-blur-2xl no-transparency:backdrop-blur-none",!x&&e!=="temporary"&&"bg-[#f4f4f4] dark:bg-token-main-surface-secondary",e==="temporary"&&"dark dark:bg-black"),children:[s.length>0&&c.jsx(gN,{replyRegions:s}),c.jsxs("div",{className:"flex items-end gap-1.5 md:gap-2",children:[o,c.jsxs("div",{className:J("flex min-w-0 flex-1 flex-col",!o&&"pl-4"),children:[r,u instanceof zc?c.jsx(G0,{id:hd,tabIndex:0,"data-id":d,dir:"auto",ref:_=>{if(!(u instanceof zc))throw new Error("Expected TextAreaComposerController");_!=null&&(u.textArea=_,u.logPageMount())},rows:1,placeholder:t,disabled:l!=="default",className:J("m-0 resize-none border-0 bg-transparent px-0 text-token-text-primary focus:ring-0 focus-visible:ring-0",l==="disabled"&&"text-center",["max-h-[25dvh]","max-h-52"])}):c.jsx(lN,{composerController:u,placeholder:S})]}),c.jsx(pN,{inputState:l,state:i,onSubmit:a,composerController:u,clientThreadId:f,gizmoId:h})]})]})});function pN(n){const{isUnauthenticated:e}=Dt();if(n.inputState==="disabled")return null;const t=c.jsx(mN,{state:n.state,onSubmit:n.onSubmit});return!e&&n.state==="disabled"&&n.clientThreadId?c.jsx(ok,{clientThreadId:n.clientThreadId,gizmoId:n.gizmoId,fallback:()=>t}):t}function mN({state:n,onSubmit:e}){const t=n==="streaming"?zw:Vw,s=ye(),i=s.formatMessage({id:"+yfm/p",defaultMessage:"Stop streaming"}),r=s.formatMessage({id:"xfIykB",defaultMessage:"Send prompt"}),o=Ja();return c.jsx("button",{onClick:e,disabled:n==="disabled","aria-label":n==="streaming"?i:r,"data-testid":n==="streaming"?"stop-button":"send-button",className:J("mb-1 me-1 flex h-8 w-8 items-center justify-center rounded-full bg-black text-white transition-colors hover:opacity-70 focus-visible:outline-none focus-visible:outline-black disabled:text-[#f4f4f4] disabled:hover:opacity-100 dark:bg-white dark:text-black dark:focus-visible:outline-white disabled:dark:bg-token-text-quaternary dark:disabled:text-token-main-surface-secondary",o&&"disabled:bg-black disabled:bg-opacity-[0.27]",!o&&"disabled:bg-[#D7D7D7]"),children:c.jsx(t,{className:J(n==="streaming"?"icon-lg":"icon-2xl")})})}function gN({replyRegions:n}){return c.jsx("div",{className:"flex flex-col divide-y divide-token-border-light overflow-hidden rounded-b-lg rounded-t-[20px] bg-token-main-surface-primary",children:n.map((e,t)=>{switch(e.type){case"text":return c.jsx(xN,{value:e.value,onRemoveRegion:e.onRemoveRegion},t);case"object":return c.jsx(yN,{value:e.value,onRemoveRegion:e.onRemoveRegion},t);case"mention":return c.jsx(bN,{value:e.value,icon:e.icon,onRemoveRegion:e.onRemoveRegion},t)}})})}function xN({value:n,onRemoveRegion:e}){return c.jsxs(du,{className:"text-token-text-secondary",children:[c.jsx(uu,{children:c.jsx(Nd,{className:"icon-lg-heavy"})}),c.jsx(fu,{children:`“${n}”`}),c.jsx(cu,{onClick:e})]})}function yN({value:n,onRemoveRegion:e}){return c.jsxs(du,{className:"text-blue-selection",children:[c.jsx(uu,{children:c.jsx(Nd,{className:"icon-lg-heavy"})}),c.jsx(fu,{className:"font-semibold",children:n}),c.jsx(cu,{onClick:e})]})}function bN({value:n,icon:e,onRemoveRegion:t}){return c.jsxs(du,{children:[c.jsx(uu,{className:"mt-0",children:e}),c.jsx(fu,{className:"font-semibold text-token-text-secondary",children:n}),c.jsx(cu,{onClick:t})]})}function cu({onClick:n}){return c.jsx("button",{onClick:n,className:"flex-shrink-0 text-token-text-secondary",children:c.jsx(Uw,{className:"icon-lg"})})}const du=Ke.div`flex items-start py-2.5 gap-4 pl-3 pr-1.5 text-sm`,uu=Ke.span`flex-shrink-0 mt-0.5 w-6 h-6 flex justify-center items-center`,fu=Ke.span`flex-1 line-clamp-3 py-0.5`,$0=Ve(()=>Ue(()=>import("./sso-ihqxdzxswuiox36n.js").then(n=>n.b),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100])).then(n=>n.default),{ssr:!1}),kN=Ve(()=>Ue(()=>import("./bbqvjx94pawdyae1.js"),__vite__mapDeps([101,1,2,3,4,5,15,13,6,14,19,102,76,28,9,10,58,17,18,25,59,32,60,61,62,63,23,35,31,103,22,104,16,20,7,8,11,12,24,26,27,29,30,89,74,37,44,105,88,81,34,48,33,36,38,106,98,107])).then(n=>n.SystemHintSuggestor)),wN=Ve(()=>Ue(()=>import("./sso-ihqxdzxswuiox36n.js").then(n=>n.d),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100])).then(n=>n.default),{ssr:!1}),vN=1,SN=3e3;function CN({files:n,className:e,clientThreadId:t,isCanmoreEnabled:s=!1}){const i=uo();return c.jsxs("div",{className:e,children:[s&&c.jsx($0,{clientThreadId:t}),n.map(r=>c.jsx(Am,{width:i?"normal":"wide",onRemoveFileClick:()=>Lt.remove(r.tempId,"none"),file:r.file,fileId:r.fileId??void 0,contextConnectorInfo:r.contextConnectorInfo,loadingPercentage:r.status===Is.Uploading?r.progress:void 0},r.tempId))]})}function MN({onAbortCompletion:n,onCreateNewCompletion:e,onContinueGenerating:t,currentModelId:s,clientThreadId:i,isNewThread:r,isCompletionInProgress:o,className:a,disabled:l=!1,disabledReason:d,canPause:u=!1,canContinue:f=!1,suggestions:h,isInteractableSharedThread:g,composerContainerRef:x,composerController:y,autocompletions:w,requiresFileUpload:S,onComposerInput:_,onAutocompleteSelect:O,headerClassName:T,setComposerBarElement:E}){var vo,ku;const R=pr(),{isUnauthenticated:F}=Dt(),D=ye(),I=Qn(i),$=ho(i),B=vi(),{gizmoEditorData:U,mode:V,getGizmoId:Y}=gr(),te=ur(),ne=lo(),pe=ys(),H=mr(),L=po(i),ue=!!Qx(),le=!!rd(),[Q,Ge]=k.useState({}),[ze,me]=k.useState(!1),[we,Fe]=k.useState(!1),q=k.useRef(!1),Z=Qh(),Me=s!==null?Z[s]:void 0;let be=el(i),ve=be&&"gizmo"in be?be.gizmo:void 0;const[Ee,ut]=k.useState(null);Ee!==null&&(be={gizmo:Ee,gizmo_id:Ee.gizmo.id,kind:tt.GizmoInteraction},ve=Ee);const ke=sr(Me,be);let bt=!1;hS(be)&&(ve==null?void 0:ve.gizmo.id)===Jy&&(bt=!0);const Xt=!l&&ke!==Tt.None&&!bt&&!F,He=Pd(Me,be),ft=Sm(Me,be);let qe=At(re=>re.files);const[kt]=k.useState(()=>ak());V==="magic"?qe=qe.filter(re=>re.gizmoId!=null):qe=qe.filter(re=>re.gizmoId==null);const Ie=qe.length>0,nt=At(Vm.hasUploadInProgress),Re=y.useState(re=>!re.isEmpty()),st=Ie?!nt:Re,at=(ke===Tt.Multimodal?pd:Hr)-qe.length,b=at<=0,p=st&&!l&&!o&&!le,[m,v]=k.useState(!1),M=Zc(),A=s||M.id,P=(vo=Z[A])==null?void 0:vo.tags,{targetedContent:ce,setTargetedContent:Te}=Wp(),oe=ce!=null&&ce.isFocusedViewContent&&!H?void 0:ce,{rebaseSystemMessageContent:De}=Ti();k.useEffect(()=>{Re||_==null||_()},[_,Re]),k.useEffect(()=>{fT()}),k.useEffect(()=>{if(!(R!=null&&R.id))return;const re=ju.getAndReset(R==null?void 0:R.id,L);re&&y.setText(re.inputText)},[R==null?void 0:R.id,L,y]),k.useEffect(()=>{m!==p&&(v(p),p&&(od(!0).then(re=>{$r.startEnforcement(re),ma.startEnforcement(re),ca.startEnforcement(re)}),te!=null&&te.includes(Si.SharedWebsocket)&&Fs.registerIfNotConnected()))},[p,m,be==null?void 0:be.kind,te]);const fe=jd(Me,be),{handleFileAccepted:zn}=rg(D,sr(Me,be),He,"mouse",Y,fe==null?void 0:fe.attachments),{getInputProps:ks,open:Ks}=Mm({disabled:l||!Xt||b,noClick:!0,onDropAccepted:zn,onDropRejected:re=>ig(re,D,ke),multiple:!0,maxSize:Bp,maxFiles:at,...vm(ft)}),ws=dp(kt),pn=k.useCallback(()=>{y.eraseContent(),ws.clearMessages(),y.resize(vN),wc();for(const re of qe)Lt.remove(re.tempId,"none")},[qe,ws,y]),je=async(re,nn)=>{var wu;if(re==null||re.preventDefault(),l||!st&&!nn||!be||qt.isLoading(i)!==!1)return;me(!0);const rs=y.getTextToSend().replace(/[\u{E0000}-\u{E007F}]+/gu,""),Ii=`${I}-nextPrompt`,Cr=ck({namespace:fa.CompletionRequest,key:Ii,opts:{expectedTimingLogs:[{name:"prompt_submitted",expectedInMs:3e3}]}}),{content:So,attachments:Mr}=mT(rs,Me,be),dl=[];De&&dl.push(ty(De));const ul={...be};"gizmo"in ul&&delete ul.gizmo;let fl={promptId:Ii,content:So,eventMetadata:{eventSource:re?"mouse":"keyboard"},completionMetadata:{suggestions:h,conversationMode:ul,systemHints:y.getSystemHints()},messageMetadata:{...Mr.length>0&&{attachments:Mr},...Ee&&{gizmo_id:Ee==null?void 0:Ee.gizmo.id},...Q},appendMessages:dl.length>0?dl:void 0};oe!=null&&oe.createNewCompletionParams&&(fl=await oe.createNewCompletionParams(fl)),Cr.logTiming("request_params_ready"),await e(fl),(wu=oe==null?void 0:oe.onCreateCompletion)==null||wu.call(oe,{serverThreadId:L,currentLeafId:I}),(oe==null?void 0:oe.shouldPersistAcrossMessages)!==!0&&Te(void 0),xi.hideThreadHeader(),pn(),me(!1),Cr.logTiming("prompt_submitted"),dk({namespace:fa.CompletionRequest,key:Ii}),h!==void 0&&(Ae.logEvent("chatgpt_prompt_ignore_suggestions"),W.logEvent(G.promptIgnoreSuggestions))},rt=k.useRef(je);k.useLayoutEffect(()=>{rt.current=je}),k.useEffect(()=>Zx.subscribe(ey.SEND_PROMPT,({prompt:re})=>{y.setText(re),rt.current(void 0,!0)}),[y]);const ot=re=>{Te(re.targetedReply),re.targetedReply&&(y.focus(),W.logEvent(G.targetedReplyButtonClicked,{conversationId:L,sourceMessageId:re.messageId}))},ts=k.useCallback(()=>{var re;(re=oe==null?void 0:oe.onCleared)==null||re.call(oe,{serverThreadId:L,currentLeafId:I}),Te(void 0),y.focus()},[I,L,oe,Te,y]),ns={Enter:{validator:re=>{const nn=re.isComposing||re.keyCode===229,rs=we&&q.current;return p&&!rs&&(re.metaKey||(ne||ny)&&!re.shiftKey&&!nn)},handler:re=>{re.preventDefault(),je()}},Escape:{validator:re=>!re.isComposing,handler:re=>{u&&o&&(n("",$),W.logEvent(G.pauseCompletion,{threadId:z.getServerThreadId(i),currentLeafId:z.getTree(i).getMessageId(I),eventSource:"keyboard"})),re.target.value===""&&ts()}}},Vn=k.useRef(ns);Vn.current=ns;const ss=k.useRef(null),Vt=Yy(P,be==null?void 0:be.kind),[Js,vs]=k.useState(!1),wo=Vt&&Js,vr=y.isReady();k.useEffect(()=>y.subscribe("keydown",re=>{var Ii,Cr;y.acceptLegacyKeydown()&&((Ii=Vn.current[re.key])!=null&&Ii.validator(re))&&Vn.current[re.key].handler(re);const rs=y.getCurrentText();if(re.key==="@"){const So=y.getSelectionStart(),Mr=rs.substring(0,So);(!Mr||/\s$/.test(Mr)||So===0)&&((Cr=ss.current)==null||Cr.handleClose(),setTimeout(()=>vs(!0),10))}else Js&&vs(!1);re.key==="Escape"&&(ut(null),Fe(!1))}),[y,vr,Js]),k.useEffect(()=>y.subscribe("paste",re=>{sM({event:re,intl:D,clientThreadId:i,conversationMode:be,currentModelConfig:Me,getEditorGizmoId:Y,modelSupportedImageMimeTypes:He})}),[D,i,be,Me,Y,He,y]);const Ys=re=>{ue||ut(re),y.trimLeadingText("@"),qr(),vs(!1)},Ai=pT(i,kt,D,He,fe==null?void 0:fe.attachments),Ni=k.useCallback(()=>{n("",$),W.logEvent(G.pauseCompletion,{threadId:z.getServerThreadId(i),currentLeafId:z.getTree(i).getMessageId(I),eventSource:"mouse"}),qr()},[n,i,$,I]),xe=k.useCallback(()=>{ju.set(R==null?void 0:R.id,L,y.getCurrentText())},[L,R==null?void 0:R.id,y]);k.useEffect(()=>{U||ze||y.focus()},[ze,y]),k.useEffect(()=>{U||Lt.reset()},[s,U]),k.useEffect(()=>{(!Vt&&Ee||ue)&&ut(null)},[Vt,Ee,ue]);const[_t,lt]=(()=>{switch(d){case"workspaceDisallowsGizmo":return[Sn.disallowedByWorkspacePlaceholder,!0];case"feedbackRequired":return[Sn.disabledFeedbackPlaceholder,!0];case"noModelsAvailable":return[Sn.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[Sn.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[Sn.loading,!0];case"noTestGizmoId":return[Sn.noTestGizmoId,!0];default:return g?[Sn.continueSharedConversationPlaceholder,!1]:(oe==null?void 0:oe.placeholderTextOverride)!=null?[oe.placeholderTextOverride,!1]:[Sn.placeholderWithName,!1]}})(),St=D.formatMessage(_t,{name:U!=null?V==="magic"?Xy:U.name||"GPT":(ve==null?void 0:ve.gizmo.display.name)??"ChatGPT"});k.useEffect(()=>y.subscribe("input",()=>{Fd.getState().isThreadHeaderVisible&&xi.hideThreadHeader(),Fe(!0)}),[y]),k.useEffect(()=>{if(_)return y.subscribe("input",()=>{_()})},[y,_]),k.useEffect(()=>y.subscribe("focus",()=>{Fe(!0)}),[y]);const wn={clientThreadId:i,uploadType:ke,modelAcceptedMimeTypes:ft,modelSupportedImageMimeTypes:He,attachmentsProductFeature:fe==null?void 0:fe.attachments,getInputProps:ks,openFileDialog:Ks,historyDisabled:pe,onOauthRedirect:xe,highlightTooltip:S&&!Ie},Ye=!l&&!b&&Xt&&c.jsx(S2,{...wn}),tn=Ya(i),Xs=Ie?c.jsxs(c.Fragment,{children:[V==="magic"&&c.jsx("div",{className:"m-2 mb-0 rounded-lg bg-token-main-surface-secondary p-2 text-xs text-token-text-secondary",children:c.jsx(j,{...Sn.gizmoKnowledgeWarning})}),c.jsx(CN,{files:qe,clientThreadId:i,className:"flex flex-nowrap gap-2 overflow-x-auto pb-1.5 pt-[7px]"})]}):tn&&c.jsx($0,{wrapperClassName:"flex flex-nowrap gap-2 overflow-x-auto pb-1.5 pt-[7px]",clientThreadId:i}),Qs=lt?"disabled":"default",Ss=o&&u?"streaming":!p||ze?"disabled":"idle",is=k.useRef(null),ct=k.useRef(null),{value:Zs}=fs("364642024");k.useEffect(()=>{const re=()=>{is.current!=null&&et.addAction("composer_state_disabled",{threadId:z.getServerThreadId(i),disabledReason:is.current})};if(st&&Ss==="disabled"){let nn="unknown";l?nn=d??"component_disabled_unknown":o?nn="completion_in_progress":le?nn="thread_hard_blocked":ze&&(nn="starting_new_completion_request"),is.current!==nn&&(ct.current&&clearTimeout(ct.current),ct.current=setTimeout(re,SN)),is.current=nn}else is.current=null;return()=>{ct.current&&(clearTimeout(ct.current),ct.current=null)}},[i,st,Ss,l,d,o,le,ze]);const Sr=[];if(oe!=null&&oe.label&&Sr.push({type:oe.type,value:oe.label,onRemoveRegion:ts}),Ee!==null){const re=!!((ku=Ee.gizmo.tags)!=null&&ku.includes(ld.FirstParty));Sr.push({type:"mention",value:Ee.gizmo.display.name,icon:c.jsx(Im,{isFirstParty:re,src:Ee.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{ut(null),y.focus()}})}k.useEffect(()=>{(!w||w.length===0||!we)&&(q.current=!1)},[w,we]);const cl=(re,nn,rs)=>{q.current=re>=0,nn&&y.setText(rs?`${rs.title} ${rs.body}`:"")};return c.jsxs(lk.Provider,{value:kt,children:[c.jsx(YC,{onOauthRedirect:xe,children:c.jsx("form",{className:a,onSubmit:je,children:c.jsxs("div",{className:"relative flex h-full max-w-full flex-1 flex-col",children:[c.jsx(PM,{className:T}),c.jsxs("div",{ref:x,className:"group relative flex w-full items-center",children:[r&&"from_template_row"in B.query&&c.jsx("button",{type:"button",onClick:()=>{B.push("/",void 0,{shallow:!0})},className:"mr-2 flex h-8 w-8 items-center justify-center text-token-text-tertiary hover:text-token-text-secondary",children:c.jsx(Gw,{className:"icon-lg"})}),Vt&&!!L&&c.jsx(tM,{ref:ss}),wo&&c.jsx("div",{className:J("absolute bottom-16 w-full space-y-2",lc.TagGpt),children:c.jsx(mv,{onClick:re=>Ys(re),onClose:()=>{vs(!1),y.focus()}})}),Zs&&c.jsx("div",{className:J("absolute bottom-16 w-full space-y-2",lc.TagGpt),children:c.jsx(kN,{composerController:y})}),tn&&c.jsx(wN,{composerController:y}),c.jsx(hN,{type:pe?"temporary":"default",ref:E,replyRegions:Sr,placeholder:St,inputState:Qs,composerController:y,icon:Ye,state:Ss,onSubmit:Ss==="streaming"?Ni:je,renderFiles:Xs,currentLeafId:I,clientThreadId:i,gizmoId:ve==null?void 0:ve.gizmo.id}),we&&w&&w.length>0&&y.canShowAutocompletion()&&c.jsx("div",{className:J("absolute left-0 top-full z-10 mt-2 box-border w-full bg-token-main-surface-primary",Ye?"px-8":"pl-0"),children:c.jsx(nM,{suggestions:w,composerController:y,onSelect:O,onChange:cl})})]}),c.jsx(FC,{composerController:y,parsedDocumentHandler:Ai})]})})}),c.jsx(nT,{canUseInlineTagging:Vt,isDisabled:l,clientThreadId:i,currentLeafId:I,currentRequestId:$,canContinue:f,composerController:y,setPromptInputMetadata:Ge,suggestions:h,isNewThread:r,onCreateNewCompletion:e,onContinueGenerating:t,onResetState:pn,conversationMode:be}),be!=null&&KT.includes(be.kind)&&c.jsx(QT,{onTargetedReply:ot})]})}function W0(n){const e=k.useContext(ad);return({id:s,requestedModelId:i,eventMetadata:r,focusOnNewCompletion:o=!0,variantPurpose:a="none",useDefaultModel:l,appendMessages:d,conversationMode:u,juice:f=void 0})=>{const g=z.getTree(n).getParentPromptNode(s).id;e({type:Jn.Variant,promptId:g,requestedModelId:i,eventMetadata:r,cancelActiveRequests:!1,focusOnNewCompletion:o,useDefaultModel:l,completionMetadata:{variantPurpose:a,conversationMode:u,juice:f},appendMessages:d})}}const TN=({children:n})=>{const[e]=k.useState(()=>new zc);return n(e)},H0=({children:n})=>{const{value:e}=La("374328013");return e?c.jsx(aN,{children:n}):c.jsx(TN,{children:n})};function EN(n){var s,i,r;const e=((s=n.message)==null?void 0:s.author.role)===$e.User,t=((i=n.metadata)==null?void 0:i.err)!=null&&((r=n.metadata)==null?void 0:r.errCode)!==bn.ContentPolicy;return e||t}function _N(n){return c.jsx(H0,{children:e=>c.jsx(AN,{...n,composerController:e})})}function AN({clientThreadId:n,isNewThread:e,currentModelId:t,showPromptStarters:s,onRequestCompletion:i,composerContainerRef:r,composerController:o,setComposerBarElement:a}){const l=xr(),d=md(),u=xs(f=>{const h=qt.getCurrentNode(n,f);return EN(h)});return!d&&u?c.jsx(NN,{clientThreadId:n}):c.jsxs(mp,{children:[c.jsx(SC,{clientThreadId:n}),c.jsx(Td,{clientThreadId:n,isStaticSharedThread:l,showInlineEmbeddedDisplay:!1,withVerticalPadding:!1,withHorizontalPadding:!0,children:c.jsx(Ed,{children:c.jsx(q0,{composerContainerRef:r,composerController:o,clientThreadId:n,currentModelId:t,isNewThread:e,showPromptStarters:s,setComposerBarElement:a,onRequestCompletion:i})})})]})}function NN({clientThreadId:n}){const e=W0(n),t=xs(r=>{var a;return((a=qt.getCurrentNode(n,r).metadata)==null?void 0:a.errCode)===ha}),s=gd(r=>r.isoDate),i=Qn(n);return t&&s!=null&&s!==""?null:c.jsxs("div",{children:[c.jsx("div",{className:"mb-3 text-center text-xs",children:c.jsx(j,{...wh.errorGeneratingResponse})}),c.jsx("div",{className:"flex items-center md:mb-4",children:c.jsx(Xe,{as:"button",color:"primary",onClick:()=>{e({id:i,eventMetadata:{eventSource:"mouse"},conversationMode:qt.getConversationMode(n)})},className:"m-auto",icon:pm,children:c.jsx(j,{...wh.regenerateResponse})})})]})}function q0({clientThreadId:n,currentModelId:e,isNewThread:t,onRequestCompletion:s,showPromptStarters:i,composerContainerRef:r,composerController:o,autocompletions:a,requiresFileUpload:l,onComposerInput:d,onAutocompleteSelect:u,headerClassName:f,setComposerBarElement:h}){var qe,kt;const g=Qn(n),x=ho(n),y=er(),{isUnauthenticated:w}=Dt(),_=Pu.useState(Pu.selectConversationStatus)(n)===sy.PENDING,O=em({clientThreadId:n,conversationLeafId:g}),T=gs(x),E=(T||_)&&!O,R=Qn(n),F=!w,{isOpen:D,onClose:I}=GS(),$=k.useCallback(Ie=>{W.logEvent(G.continueCompletion),s({type:Jn.Continue,promptId:Ie,eventMetadata:{eventSource:"mouse"},cancelActiveRequests:!1,completionMetadata:{conversationMode:qt.getConversationMode(n)}})},[s,n]),B=fr(),U=Gs(),V=k.useCallback(async(Ie,nt)=>{var b;const Re=z.getServerThreadId(n);Fs.stopConversation(Re);const st=z.getTree(n);!st.hasReceivedServerCompletion&&!Pa()&&((b=st.getParent(nt).metadata)==null?void 0:b.errCode)!==bn.ContentPolicy&&setTimeout(()=>{gc.onCreateFinished(U,B,Re)},500),Re&&Ae.checkGate("3922476776")&&await _e.stopConversationProcess(Re),Wa.abortRequest(nt)&&z.updateTree(n,p=>{const m=z.getThreadCurrentLeafId(n);p.updateNodeMessageMetadata(m,{finish_details:{type:"interrupted"}})})},[B,n,U]),Y=k.useCallback(async({promptId:Ie,content:nt,eventMetadata:Re,completionMetadata:st,messageMetadata:at,appendMessages:b})=>{const p=z.getThreadCurrentLeafId(n);z.updateTree(n,m=>{m.addNode(Ie,nt,p,$e.User,void 0,at)}),await s({type:Jn.Next,promptId:Ie,eventMetadata:Re,cancelActiveRequests:!0,completionMetadata:st,appendMessages:b})},[n,s]),te=Zk(n,g),ne=ew(n,g),pe=!O&&T,H=k.useMemo(()=>pe?!1:!te&&ne,[te,ne,pe]),L=pe&&e!=="gpt-4-pbrowse",ue=Cd(n),le=Bn(n),Q=$s(le).data,{promptStarters:Ge,isSuccess:ze}=fm(t&&!ue,n,4),me=tg(),we=(()=>{var Ie,nt;if((me==null?void 0:me.messageId)===((nt=(Ie=z.getTree(n).getLastValidNode(g))==null?void 0:Ie.message)==null?void 0:nt.id))return me==null?void 0:me.suggestions;if(i&&!ue&&ze&&!F)return Ge})(),Fe=z.getTree(n),q=Fe.countMessagesByAuthor($e.User),Z=k.useRef(),Me=k.useRef();let be=!1;Z.current==q&&Me.current==R?be=!0:Z.current!==q&&Me.current!==R&&(be=!0,Z.current=q,Me.current=R);const ve=Fe.getNodeByIdOrMessageId(g),Ee=be&&((qe=ve==null?void 0:ve.message)==null?void 0:qe.author.role)==$e.Assistant&&sd(ve.message),ut=Qc(),ke=iy(),bt=(()=>{var Re;if(((Re=Q==null?void 0:Q.gizmo.tags)==null?void 0:Re.includes(ld.WorkspaceDisabled))&&!ke)return"workspaceDisallowsGizmo";if(ut.size){if(y.displayingSideBySideFeedback&&y.unskippable)return"feedbackRequired"}else return"noModelsAvailable";const nt=qt.getConversationMode(n);return(nt==null?void 0:nt.kind)===tt.GizmoTest&&nt.gizmo_id==null?"noTestGizmoId":null})(),Xt=tm(n),He=Hs(n),ft=(kt=fs("15117983"))==null?void 0:kt.value;return c.jsxs(c.Fragment,{children:[(t||Ee)&&D?c.jsx(US,{onClose:I}):null,ft&&He&&He.kind===tt.PrimaryAssistant&&He.plugin_ids&&He.plugin_ids.length>0?c.jsx(IN,{}):c.jsx(MN,{composerContainerRef:r,composerController:o,clientThreadId:n,onCreateNewCompletion:Y,onAbortCompletion:V,onContinueGenerating:$,currentModelId:e,isNewThread:t,isCompletionInProgress:E,className:"w-full",canContinue:H,suggestions:we??[],disabled:!!bt,disabledReason:bt??void 0,canPause:L,isInteractableSharedThread:Xt,autocompletions:a,requiresFileUpload:l,onComposerInput:d,onAutocompleteSelect:u,headerClassName:f,setComposerBarElement:h},n)]})}function IN(){return c.jsxs("div",{className:"mx-auto flex max-w-md flex-col items-center justify-center gap-2 rounded-xl border border-token-border-light bg-token-main-surface-primary p-6 shadow-lg",children:[c.jsx("span",{className:"text-token-text-primary",children:c.jsx(j,{id:"PluginsDecrepatedNotice.pluginsDeprecationTitle",defaultMessage:"Conversations with plugins are archived"})}),c.jsx("span",{className:"text-token-text-secondary",children:c.jsx(j,{id:"PluginsDecrepatedNotice.pluginsDeprecationSubtitle",defaultMessage:"Explore GPT Store to find a replacement"})}),c.jsxs("a",{href:"https://chat.openai.com/gpts",className:"text-green-500 hover:cursor-pointer dark:text-green-400",children:[c.jsx(j,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLink",defaultMessage:"Explore GPTs"}),c.jsx("span",{className:"ml-2",children:c.jsx(j,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLinkArrow",defaultMessage:"→"})})]})]})}const wh=Ce({errorGeneratingResponse:{id:"PromptTextarea.errorGeneratingResponse",defaultMessage:"There was an error generating a response"},regenerateResponse:{id:"PromptTextarea.regenerateResponse",defaultMessage:"Regenerate"}});function RN(){const{layer:n}=oo("4031588851");return n.get("enable_new_homepage",!1)}function DN(n){return c.jsx(H0,{children:e=>c.jsx(jN,{...n,composerController:e})})}function jN({clientThreadId:n,currentModelId:e,onRequestCompletion:t,composerController:s}){const i=hs(n),r=Cd(n),o=rd(),a=uo(),[l,d]=k.useState([]),u=La("589604007").value,{promptStarters:f,isSuccess:h,isError:g}=fm(i&&!r,n,a?4:8,u),x=!!l.find(B=>!!B.requires_file_upload),y=k.useRef(null),w=k.useRef(null),S=B=>{const U=B.title;s.setText(U),s.focus(),d((f==null?void 0:f.filter(V=>V.theme===B.theme))??[])},_=f==null?void 0:f.reduce((B,U)=>(U.theme&&!B[U.theme]&&(B[U.theme]=U),B),{}),O=[];if(_)for(const B in _)O.push(_[B]);const T=O&&O.length>0,E=!!(h&&T),{layer:R}=oo("4031588851"),F=R.get("autocomplete_mode","HARDCODED"),D=k.useCallback(Md(async()=>{const B=s.getCurrentText();if(!B){d([]);return}d(V=>V.filter(Y=>Y.title===B));const U=Date.now();w.current=B,y.current=U;try{const V=await _e.generateAutocompletions(B,4);if(y.current!==U||s.getCurrentText()!==w.current)return;d(V.completions.map(Y=>({id:dr(),type:Op.Starter,title:B,body:Y,oneliner:Y,prompt:`${B} ${Y}`})))}catch{}},250),[s]),$=F==="MODEL"?D:()=>{d(s.getCurrentText()?l.filter(B=>`${B.title} ${B.body}`.startsWith(s.getCurrentText())):[])};return c.jsx(c.Fragment,{children:c.jsx(yi,{children:(g||h)&&c.jsx(c.Fragment,{children:c.jsx(Td,{isStaticSharedThread:!1,showInlineEmbeddedDisplay:!1,withVerticalPadding:!0,withHorizontalPadding:!0,clientThreadId:n,children:c.jsxs(gw,{children:[c.jsx(PN,{}),c.jsx(mp,{children:c.jsx("div",{className:"w-full",children:c.jsx(q0,{clientThreadId:n,isNewThread:i,currentModelId:e,onRequestCompletion:t,showPromptStarters:!1,composerController:s,autocompletions:l,requiresFileUpload:x,onComposerInput:$,onAutocompleteSelect:(B,U,V)=>{d([U[V]])},headerClassName:"hidden"})})}),E&&c.jsx(ON,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},promptStarters:O,onSelectStarterPrompt:S,isSendBlocked:o,clientThreadId:n,className:"h-8"})]})})})})})}function PN(){const e=ye().formatMessage(K0.whatCanIHelpWith),[t,s]=k.useState(1),[i,r]=k.useState(!0),o=20;return k.useEffect(()=>{let a;return t<e.length?a=setTimeout(()=>{s(t+1)},o):i&&(a=setTimeout(()=>{r(!1)},500)),()=>clearTimeout(a)},[e,t,i]),c.jsxs("div",{className:"mb-7 flex justify-center text-center text-2xl font-semibold leading-9",children:[c.jsx("h1",{children:e.substring(0,t)}),c.jsx("h1",{className:"result-streaming transition-opacity",style:{opacity:i?1:0},children:c.jsx("span",{})})]})}function ON({promptStarters:n,onSelectStarterPrompt:e,isSendBlocked:t,clientThreadId:s,...i}){return k.useEffect(()=>{lm(n,s)},[s]),c.jsx(yt.div,{...i,children:c.jsx(LN,{starterPrompts:n,onSelectStarterPrompt:e,disabled:t})})}const FN=/\s/;function vh({starterPrompt:n,starterPrompts:e,index:t,disabled:s,onSelectStarterPrompt:i}){const r=n.theme??n.title,o=FN.test(r);return c.jsxs("button",{className:"relative flex items-center gap-1.5 rounded-full border border-token-border-light px-3 py-2 text-start text-[13px] shadow-xxs transition enabled:hover:bg-token-main-surface-secondary disabled:cursor-not-allowed xl:gap-2 xl:text-[14px]",disabled:s,onClick:()=>i(n,e,t),children:[c.jsx(Sw,{starterPrompt:n,useV2Colors:!0}),c.jsx("div",{className:J("max-w-full text-balance text-gray-600 dark:text-gray-500",o?"break-word":"break-all"),children:r})]})}function LN({starterPrompts:n,onSelectStarterPrompt:e,disabled:t}){const s=ye(),[i,r]=k.useState(4),o=4,l=n.slice(0,i).slice(0,o).map((f,h)=>c.jsx(yt.li,{initial:{opacity:0},animate:{opacity:1},transition:{delay:h*.03},exit:{opacity:0},children:c.jsx(vh,{starterPrompt:f,starterPrompts:n,index:h,disabled:t,onSelectStarterPrompt:e})},f.id??h)),u=n.slice(o,i).map((f,h)=>c.jsx(yt.li,{initial:{opacity:0},animate:{opacity:1},transition:{delay:h*.03},exit:{opacity:0},children:c.jsx(vh,{starterPrompt:f,starterPrompts:n,index:h,disabled:t,onSelectStarterPrompt:e})},f.id??h));return c.jsxs("div",{className:"mt-7 flex flex-col flex-wrap gap-y-2.5",children:[c.jsx("div",{children:c.jsxs("ul",{className:"flex max-w-3xl flex-wrap items-stretch justify-center gap-x-2 xl:mx-3 xl:gap-x-2.5",children:[l,n.length>i&&c.jsx("button",{className:"relative flex max-w-full items-center gap-2 text-balance rounded-full border border-token-border-light px-3 py-2 text-start text-[14px] text-gray-600 shadow-xxs transition enabled:hover:bg-token-main-surface-secondary disabled:cursor-not-allowed dark:text-gray-500",onClick:()=>r(n.length),children:s.formatMessage(K0.moreStarterPrompts)})]})}),u&&u.length>0&&c.jsx("div",{children:c.jsx("ul",{className:"mx-3 flex max-w-3xl flex-wrap items-stretch justify-center gap-x-2.5",children:u})})]})}const K0=Ce({whatCanIHelpWith:{id:"SplashScreenV2.whatCanIHelpWith",defaultMessage:"What can I help with?"},moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}});function BN({skeleton:n}){const e=Ja();return c.jsxs("div",{className:J(e?"absolute inset-0 flex flex-col":"hidden"),children:[c.jsx("div",{className:"bg-thread--header",style:{"--composer-bar_skeleton":n}}),c.jsx("div",{className:"bg-thread--footer"})]})}function J0(n){const t=Qn(n)==="root",s=ho(n),i=gs(s),{serviceStatus:r}=k.useContext(ry),o=er(),{isUnauthenticated:a}=Dt();return!t&&!i&&!(r!=null&&r.oof)&&!o.displayingSideBySideFeedback&&!a}function Y0({clientThreadId:n}){var o;const e=z.getThreadCurrentLeafId(n),s=((o=z.getTree(n).getMessage(e).metadata)==null?void 0:o.model_switcher_deny)??[],i={};s.forEach(a=>{const{slug:l,context:d,reason:u,description:f}=a,h=i[l]??{},g=h[d]??[];g.push({reason:u,description:f}),h[d]=g,i[l]=h});const r=tp();for(const{resets_after:a,model_slug:l}of r)[Cu.CONVERSATION,Cu.REGENERATE].forEach(d=>{const u=i[l]??{},f=u[d]??[],h={reason:fo.RATE_LIMIT,resetsAfter:a};f.push(h),u[d]=f,i[l]=u});return i}function UN(n){if(n<60)return{type:"minute",value:n,text:n<2?"minute":`${n} minutes`};const e=Math.floor(n/60);if(e<24)return{type:"hour",value:e,text:e<2?"hour":`${e} hours`};const t=Math.floor(e/24);return t<7?{type:"day",value:t,text:t<2?"day":`${t} days`}:{type:"minute",value:n,text:n<2?"minute":`${n} minutes`}}const $l={textarea:"","model-switcher":""};function zN(){const n=gd(a=>a.isoDate),e=Hp(n),t=ye(),s=mi(Ha.isEnterprisePlan),{isUnauthenticated:i,isLoading:r}=Dt(),{data:o}=Vs({queryKey:["modelMessageCap",i],queryFn:()=>_e.getModelMessageCap(i),enabled:!r});return k.useMemo(()=>{const a=(o==null?void 0:o.message_cap)??0,l=(o==null?void 0:o.message_cap_window)??1,{text:d,type:u,value:f}=UN(l),h=(o==null?void 0:o.message_disclaimer)??$l;if(!d||s)return{textareaDisclaimer:h.textarea,modelSwitcherDisclaimer:h["model-switcher"],modelSwitcherLimitShort:""};if(!o||!l||!a)return{textareaDisclaimer:$l.textarea,modelSwitcherDisclaimer:$l["model-switcher"],modelSwitcherLimitShort:""};let g=t.formatMessage(Wl.shortLimitMinutes,{numerator:a,denominator:f});switch(u){case"hour":g=t.formatMessage(Wl.shortLimitHours,{numerator:a,denominator:f});break;case"day":g=t.formatMessage(Wl.shortLimitDays,{numerator:a,denominator:f});break}return{textareaDisclaimer:h.textarea.replaceAll("%FORMATTED_TIME%",e).replaceAll("%NUMERATOR%",`${a}`).replaceAll("%DENOMINATOR%",d),modelSwitcherDisclaimer:h["model-switcher"].replaceAll("%FORMATTED_TIME%",e).replaceAll("%NUMERATOR%",`${a}`).replaceAll("%DENOMINATOR%",d),modelSwitcherLimitShort:g}},[o,e,t,s])}const Wl=Ce({shortLimitMinutes:{id:"modelCapMessaging.shortLimitMinutes",defaultMessage:"Limit {numerator, plural, =0 {# message} one {# message} other {# messages}} / {denominator, plural, =0 {# minute} one {# minute} other {# minutes}}"},shortLimitHours:{id:"modelCapMessaging.shortLimitHours",defaultMessage:"Limit {numerator, plural, =0 {# message} one {# message} other {# messages}} / {denominator, plural, =0 {# hour} one {# hour} other {# hours}}"},shortLimitDays:{id:"modelCapMessaging.shortLimitDays",defaultMessage:"Limit {numerator, plural, =0 {# message} one {# message} other {# messages}} / {denominator, plural, =0 {# day} one {# day} other {# days}}"}});var X0=(n=>(n.BROWSING="browsing_model",n.CODE_INTERPRETER="code_interpreter_model",n.DALLE="dalle_model",n))(X0||{}),ti=(n=>(n.ALPHA="alpha",n.EXPERIMENTS="experiments",n.MAINLINE="mainline",n))(ti||{});const Hl={browsing_model:{name:c.jsxs("span",{children:["Browse with ",c.jsx(Gv,{className:"icon-sm mt-[-3px] inline-block"})," Bing"]})},code_interpreter_model:{name:"Advanced Data Analysis"},dalle_model:{name:"DALL·E 3"}};function VN(n){const e=GN(n??void 0);return qp(["alpha","experiments","mainline"],e)?"bg-orange-500 text-white":"bg-token-main-surface-primary text-token-text-primary"}function GN(n){const e=hu();for(const t of e)if(t.options.length>0&&t.options.find(i=>i.value===n))return t.categoryId;return null}function $N(n,e){const{data:t}=Zh();return(t==null?void 0:t.categories.some(i=>i[e]===n))??!1}const WN=n=>bm(n,({id:e})=>e.split(":").slice(0,1).join(":"));function hu(){const{data:n}=Zh(),e=uk(),t=Ln(),s=oy(t==null?void 0:t.getWorkspaceId()),i=(t==null?void 0:t.isEnterprise())??!1,{modelSwitcherDisclaimer:r}=zN(),o=Qc();return k.useMemo(()=>{const a=[];if(!n)return a;const{categories:l,groups:d,modelsMap:u}=n;for(const f of l){const{defaultModel:h,categoryId:g,label:x}=f;if(o.has(h)){const y=e===h,w=n.modelsMap[h],S=y?[]:HN(s.data,f,o,n.modelsMap,i);a.push({categoryId:g,value:h,name:x,description:y?r:w.description,options:[qi(w,{name:"Default"}),...S]})}}for(const f of d){const{group:h,label:g,modelIds:x}=f,y=x[0],w=x.map(S=>u[S]).filter(({tags:S})=>!S.includes(ay.HIDDEN));if(h==="experiments"){const S=WN(w),_=Object.entries(S).map(([O,T])=>{const E=O.split(":").slice(-1)[0];return{key:O,value:E,name:E,options:T.map(R=>{const{title:F}=R;return qi({...R,title:F.replace(E,"")})})}});a.push({categoryId:h,value:y,name:g,options:_})}else a.push({categoryId:h,value:y,name:g,options:w.map(S=>qi(S))})}return a},[n,o,e,s.data,i,r])}function qi(n,e={}){return{value:n.id,name:n.title,...e}}function HN(n,e,t,s,i){const r=[],o=n==null?void 0:n.browsing;if((i&&o||!i)&&e.browsing_model!=null&&t.has(e.browsing_model)){const l=Hl.browsing_model;r.push(qi(s[e.browsing_model],{name:l.name}))}if(e.code_interpreter_model!=null&&t.has(e.code_interpreter_model)){const l=Hl.code_interpreter_model;r.push(qi(s[e.code_interpreter_model],{name:l.name}))}if(e.dalle_model!=null&&t.has(e.dalle_model)){const l=Hl.dalle_model;r.push(qi(s[e.dalle_model],{name:l.name}))}return r}const pu=({categoryId:n,type:e,className:t})=>{const{data:s,isLoading:i}=Ex(),r=c.jsx("div",{className:t});if(i)return r;const{iconFilledSrc:o,iconOutlineSrc:a}=(s==null?void 0:s[n])??{},l=(e==="filled"?o:a)??"";return c.jsx(gp,{name:"ModelCategoryIcon",fallback:r,children:c.jsx("div",{className:J("[&_svg]:h-full [&_svg]:w-full",t),dangerouslySetInnerHTML:{__html:l}})})},qN=({clientThreadId:n,message:e})=>{var y,w,S,_,O,T,E,R;const t=hu(),s=Mi(Ws.ModelSwitcherAutoDowngrade),{categories:i}=ro({isRegen:!0}),r=Y0({clientThreadId:n}),{doesUserHaveAnyAccountsWithPlusFeatures:o}=cr(),a=_x()!=null,l=[];for(const F of i){if(Kp(F))continue;const{defaultModel:D,label:I,tagline:$,categoryId:B,subscriptionLevel:U}=F,V=(w=(y=r[D])==null?void 0:y.regenerate)==null?void 0:w[0];l.push({label:I,value:D,subtitle:$,icon:c.jsx(pu,{className:"icon-md h-4 w-4",categoryId:B,type:"filled"}),modelSwitcherDeny:V,subscriptionLevel:U})}const d=KN(n,e.nodeId),u=(S=e.message.metadata)==null?void 0:S.model_slug,f=(_=t.find(F=>F.value===u))==null?void 0:_.name,h=JN(a,d,u),g=(O=e.message.metadata)==null?void 0:O.model_adjustments,x=o&&s.eligible&&!s.isLoading&&f&&((T=l[0])==null?void 0:T.label)&&f!==((E=l[0])==null?void 0:E.label)&&(g==null?void 0:g.some(F=>F.startsWith("auto:smaller_model")));return{modelOptions:l,modelSlug:u,animateModelLabelOnRender:h,nuxProps:{shouldRenderNux:x,usedModelName:f,largestModelName:(R=l[0])==null?void 0:R.label,announcement:s}}};function KN(n,e){var o,a;return(a=(o=z.getTree(n).getConversationTurns(e).flatMap(l=>l.messages).filter(l=>l.message.author.role===$e.Assistant&&!xp(l.message)).reverse()[1])==null?void 0:o.message.metadata)==null?void 0:a.model_slug}function JN(n,e,t){return n&&!e?!0:!!(e&&t!==e)}function YN(){const{doesUserHaveAnyAccountsWithPlusFeatures:n}=cr(),{categories:e}=ro();return!!n||!!e.find(Kp)}function Q0({modelSwitcherDeny:n}){switch(n.reason){case Tr.UNSUPPORTED_TOOL_USE:case Tr.UNSUPPORTED_AUDIO:case Tr.UNSUPPORTED_IMAGE:case Tr.UNSUPPORTED_GIZMO:case Tr.UNSUPPORTED_ATTACHMENT:return c.jsx(c.Fragment,{children:n.description});case fo.RATE_LIMIT:{const{resetsAfter:t}=n,s=new Date(t),i=new Date(t).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});if(iS(s))return c.jsx(j,{id:"HUybjA",defaultMessage:"Your limit will reset at {time}",values:{time:i}});if(_S(s))return c.jsx(j,{id:"TvYw9K",defaultMessage:"Your limit will reset at {time} tomorrow",values:{time:i}});{const r=s.toLocaleDateString([],{month:"short",day:"numeric"});return c.jsx(j,{id:"60ZcZL",defaultMessage:"Your limit will reset on {date}",values:{date:r}})}}}const e=n.description;return e?c.jsx(c.Fragment,{children:e}):c.jsx(j,{id:"wGF6eE",defaultMessage:"This model is not supported."})}const XN=({modelSwitcherDeny:n,value:e,label:t,subtitle:s,icon:i,onMouseEnter:r,onMouseLeave:o,onSelect:a,messageModelSlug:l,isHovered:d=!1,shouldShowUpsell:u=!1,className:f,includeCheck:h,includeRegenerate:g})=>{const x=Ln(),y=!n,w=!y&&!u,S=Gs(),_=()=>{if(!u){a==null||a();return}W.logEvent(G.openModalAccountPaymentfromMessageModelPicker),W.logRateLimitGetPlusButtonClicked({type:fo.RATE_LIMIT,location:"message_model_switcher_dropdown",plan_type:(x==null?void 0:x.planType)??"unknown",is_hard_block:!1,hard_block_reason:"",is_new_conversation:!1}),go(S,"Message model switcher dropdown")};return c.jsx(Oe.Item,{onSelect:_,onMouseEnter:()=>y&&(r==null?void 0:r()),onMouseLeave:()=>y&&(o==null?void 0:o()),disabled:w,className:f??"radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed radix-disabled:hover:bg-transparent",children:c.jsxs(bs,{label:n&&c.jsx(Q0,{modelSwitcherDeny:n}),className:"flex w-full items-center justify-between gap-2",sideOffset:0,children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("span",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-token-main-surface-secondary",children:i}),c.jsxs("div",{children:[c.jsx("div",{children:t}),c.jsx("div",{className:J({"text-sm text-token-text-secondary":!w},{"text-sm text-token-text-quaternary":w}),children:s})]})]}),u?c.jsx(Xe,{color:"secondary",size:"small",children:c.jsx(j,{id:"54fmrA",defaultMessage:"Get Plus"})}):c.jsx(QN,{messageModelSlug:l,isHovered:d,modelSwitcherDeny:n,optionModelSlug:e,includeCheck:h,includeRegenerate:g})]})})},QN=({modelSwitcherDeny:n,optionModelSlug:e,isHovered:t,messageModelSlug:s,includeRegenerate:i=!0,includeCheck:r=!0})=>{let o=null;if(n)switch(n.reason){case fo.RATE_LIMIT:o=$w;break;default:o=nr;break}if(n)return c.jsx(o,{className:"icon-md"});const a=!!i&&c.jsx(Id,{className:J("icon-md hidden text-token-text-tertiary",{"group-hover:block":t})});return s===e&&r?c.jsxs(c.Fragment,{children:[c.jsx(gm,{className:J("icon-md text-token-text-primary",{"group-hover:hidden":t})}),a]}):a};function ZN({className:n,clientThreadId:e,message:t,onModelSelect:s,onDropdownChange:i}){const[r,o]=k.useState(null),[a,l]=k.useState(!1),[d,u]=k.useState(!1),f=YN(),h=J0(e),g=Bn(e),x=qN({clientThreadId:e,message:t}),{doesUserHaveAnyAccountsWithPlusFeatures:y}=cr(),w=k.useRef(null),S=I=>{I||setTimeout(()=>{w.current&&w.current.blur()},10)};if(k.useEffect(()=>{S(a)},[a]),!f||g)return null;const{modelOptions:_,modelSlug:O,animateModelLabelOnRender:T,nuxProps:E}=x;let R,F;E.shouldRenderNux?(R=nI,F={title:c.jsx(j,{id:"g/+2Hh",defaultMessage:"Optimized your response"}),description:c.jsx(j,{id:"H0Flqm",defaultMessage:"Used {usedModelName} for a faster response that saves your limited {largestModelName} messages",values:{usedModelName:E.usedModelName,largestModelName:E.largestModelName}}),markAsViewed:E.announcement.markAsViewed}):(R=tI,F={label:h?c.jsx(j,{id:"LBYK9a",defaultMessage:"Change model"}):c.jsx(j,{id:"nygjPN",defaultMessage:"Used {modelName}",values:{modelName:E.usedModelName}})});const D=h&&_.some(I=>Sh(I,y));return c.jsxs(Oe.Root,{onOpenChange:I=>{h&&(l(I),i(I),S(I)),I&&W.logEvent(G.conversationOpenMessageModelSelector,{has_get_plus_button:D})},children:[c.jsx(R,{...F,children:c.jsx(zv,{ref:w,className:J("cursor-pointer",n),onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:c.jsx(eI,{modelSlug:O,animateModelLabelOnRender:T,isDropdownOpen:a,isRegenerateEnabled:h,isHovered:d})})}),h&&c.jsx(Oe.Content,{className:"z-30 origin-top-right text-token-text-primary",side:"bottom",align:"start",children:_.map(I=>{var V;const $=Sh(I,y),{value:B,...U}=I;return c.jsx(XN,{value:B,onSelect:()=>s(B),onMouseEnter:()=>o(B),onMouseLeave:()=>o(null),isHovered:r===B,messageModelSlug:(V=t.message.metadata)==null?void 0:V.model_slug,shouldShowUpsell:$,...U},B)})})]})}function eI({modelSlug:n,animateModelLabelOnRender:e,isDropdownOpen:t,isRegenerateEnabled:s,isHovered:i,isRegenLabel:r=!1}){const[o,a]=k.useState("initial"),{categories:l}=ro({isRegen:!!r});k.useEffect(()=>{if(e){const y=setTimeout(()=>a("show"),500),w=setTimeout(()=>a("initial"),2e3);return()=>{clearTimeout(y),clearTimeout(w)}}a("initial")},[e]);const d=l.find(({defaultModel:y})=>y===n),u=n===Ax?{categoryId:"gpt_3.5",shorterLabel:"3.5"}:{},{categoryId:f,shorterLabel:h}=d??u,g={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},x=t?"visible":i?"show":o;return c.jsxs(yt.div,{initial:"initial",animate:x,className:"flex items-center pb-0",children:[r?c.jsx(Id,{className:"icon-md h-4 w-4"}):f&&c.jsx(pu,{type:"outline",categoryId:f,className:"icon-md h-4 w-4"}),s&&c.jsx(yt.span,{className:"overflow-hidden text-clip whitespace-nowrap text-sm",variants:g,transition:{type:"tween",duration:.18},children:h}),s&&c.jsx(mo,{className:J("icon-sm",{"text-token-text-quaternary":!i},{"text-token-text-secondary":i})})]})}function tI({children:n,label:e}){return c.jsx(bs,{label:e,sideOffset:0,children:n})}function nI({children:n,title:e,description:t,markAsViewed:s}){return c.jsx(Za,{show:!0,side:"bottom",sideOffset:-4,title:e,description:t,badge:"beta",onDismiss:s,dismissOnOutsideClick:!0,children:n})}function Sh(n,e){const{modelSwitcherDeny:t,subscriptionLevel:s}=n;return!!t&&t.reason===fo.RATE_LIMIT&&s===ly.PLUS&&!e}const sI=k.memo(ZN),Ch=Xn.IndepthFeedbackDismissedAt;function iI(){const[n,e]=k.useState(()=>{const s=localStorage.getItem(Ch);return s?rI(new Date(s)):!1}),t=k.useCallback(()=>{e(!0),localStorage.setItem(Ch,new Date().toISOString())},[]);return[n,t]}function rI(n){const e=new Date;return n.getFullYear()===e.getFullYear()&&n.getMonth()===e.getMonth()&&n.getDate()===e.getDate()}function oI({clientThreadId:n,conversationLeafId:e,trigger:t,variantIds:s}){const i=s.find(u=>u!==e),r=Ti(u=>u.forceIndepthFeedback&&u.forceIndepthFeedbackPrompt),o=Ae.getExperimentValue({experimentName:"4146182738",key:t==="paragen"?"enable_indepth_feedback_paragen":"enable_indepth_feedback_thumbsdown",defaultValue:!1,shouldLogExposure:!1}),a=Ae.getExperimentValue({experimentName:"4146182738",key:t==="paragen"?"indepth_feedback_paragen_prompt":"indepth_feedback_thumbsdown_prompt",defaultValue:"",shouldLogExposure:!1}),l=i?z.getTree(n).getTextFromNode(i):"NONE";return(r||(o?a:"")).replace("{paragen_losing_response}",l)}function aI({clientThreadId:n,conversationLeafId:e,trigger:t,variantIds:s}){const[i,r]=iI(),o=cI({clientThreadId:n}),a=oI({clientThreadId:n,conversationLeafId:e,trigger:t,variantIds:s}),l=()=>{r(),W.logEventWithStatsig(G.messageIndepthFeedbackDeclined,"chatgpt_indepth_feedback_declined",{trigger:t})},d=()=>{o(e,{intent:"indepth_feedback"},a),W.logEventWithStatsig(G.messageIndepthFeedbackAccepted,"chatgpt_indepth_feedback_accepted",{trigger:t})};return i||!a?null:c.jsx($a,{content:c.jsx(j,{...ql.indepthFeedbackPrompt}),primaryCtaText:c.jsx(j,{...ql.indepthFeedbackAcceptButton}),onPrimaryCtaClick:d,secondaryCtaText:c.jsx(j,{...ql.indepthFeedbackRejectButton}),onSecondaryCtaClick:l})}function lI(n){const e=n.rating==="thumbsDown"?"thumbsDown":qp(["original","new"],n.inlineComparisonRating)?"paragen":void 0,t=Ti(i=>i.forceIndepthFeedback);if(!e||t||e==="paragen"||Ae.getExperimentValue({experimentName:"4146182738",key:"enable_indepth_feedback_thumbsdown",defaultValue:!1,shouldLogExposure:!0}))return e}function cI({clientThreadId:n}){const e=k.useContext(ad),t=qt.getConversationMode(n);return(i,r,o)=>{e({type:Jn.Next,promptId:i,eventMetadata:r,focusOnNewCompletion:!0,cancelActiveRequests:!1,completionMetadata:{conversationMode:t},useDefaultModel:!1,appendMessages:[{id:dr(),author:{role:$e.System},content:{content_type:Ht.Text,parts:[o]},metadata:{is_indepth_feedback:!0,indepth_feedback_prompt:o}}]})}}const ql=Ce({indepthFeedbackPrompt:{id:"qEHwDx",defaultMessage:"Would you like to tell ChatGPT more about your feedback, so it can improve its responses?"},indepthFeedbackAcceptButton:{id:"IeyTQ7",defaultMessage:"Continue"},indepthFeedbackRejectButton:{id:"+o5xmp",defaultMessage:"Not now"},indepthFeedbackRejectAlwaysButton:{id:"Qdko+f",defaultMessage:"Don't ask again"}}),dI={[ht.Browsing]:{group:X.Browsing},[ht.BrowseTool]:{group:X.Browsing},[ht.SearchGPTQuery]:{group:X.SearchGPTQuery},[ht.RetrievalBrowsing]:{group:X.RetrievalBrowsing},[ht.RetrievalBrowsingTool]:{group:X.RetrievalBrowsing},[ht.ParallelBrowsing]:{group:X.ParallelBrowsing},[ht.ParallelBrowsingTool]:{group:X.ParallelBrowsing},[ht.JITPlugin]:{group:X.JITPlugin,alwaysStartsNewGroup:!0},[ht.JITPluginTool]:{group:X.JITPlugin},[ht.GizmoContactsTool]:{group:X.GizmoContacts},[ht.Dalle]:{group:X.Dalle,alwaysStartsNewGroup:!0},[ht.DalleTool]:{group:X.Dalle},[ht.CodeInterpreter]:{group:X.CodeInterpreter,alwaysStartsNewGroup:!0},[ht.a8km123]:{group:X.a8km123},[ht.CodeInterpreterTool]:{group:X.CodeInterpreter},[ht.GizmoEditor]:{group:X.GizmoEditor},[ht.SearchResultTool]:{group:X.SearchResult},[ht.ImagePreloadTool]:{group:X.SearchResult},[ht.CanmoreTool]:{group:X.Canmore}};function Da(n){const e=[];for(let t=0;t<n.length;t++){const s=n[t],i=cy(s.message),r=n==null?void 0:n[t-1],o=dI[i],a=r!=null&&(yp(r.message)||dy(s.message)),l=i===ht.Text&&hr(s.message);if(xp(s.message))e.push({type:X.Debug,message:s});else if(o!==void 0){const d=e.findLast(u=>u.type!==X.Debug);(d==null?void 0:d.type)===o.group&&"messages"in d&&!o.alwaysStartsNewGroup?d.messages.push(s):o.group!==X.Text&&o.group!==X.Debug&&e.push({type:o.group,messages:[s]})}else if(a&&l!=null){const d=e.pop();(d==null?void 0:d.type)===X.MultiText?(d.messages.push(s),e.push(d)):(d==null?void 0:d.type)===X.Text&&e.push({type:X.MultiText,messages:[d.message,s]})}else e.push({type:X.Text,message:s})}return e}const uI=({actions:n,pagination:e,isHovered:t,showInline:s,alwaysShow:i})=>!e&&!n?null:c.jsxs("div",{className:J("items-center justify-start rounded-xl p-1",s?"flex":"z-10 -mt-1 bg-token-main-surface-primary md:absolute md:border md:border-token-border-light",s?!1:t?"flex":"md:sr-only"),children:[e,n&&c.jsx("div",{className:J("flex items-center",s&&!i?t?"visible":"md:invisible":!1),children:n})]}),fI=({onClick:n})=>{const[e,t]=k.useState(!1),s=hk(),i=ye(),r=k.useCallback(o=>{o.stopPropagation(),n(),t(!0),setTimeout(()=>{s()&&t(!1)},2e3),Ae.logEvent("chatgpt_turn_action_copy")},[s,n]);return c.jsx(Ki,{icon:e?Ww:Hw,onClick:r,label:i.formatMessage({id:"CopyButton.copyTooltip",defaultMessage:"Copy"})})},Ki=({icon:n,label:e,iconClassName:t,className:s,onClick:i,disabled:r=!1,asLink:o=!1,href:a,style:l,target:d})=>{const u=o?"a":"button";return c.jsx(fk,{sideOffset:0,label:e,disabled:!e,children:c.jsx(u,{className:J("rounded-lg text-token-text-secondary hover:bg-token-main-surface-secondary",s),"aria-label":e,onClick:i,disabled:r,target:d,href:a,style:l,children:n&&c.jsx("span",{className:"flex h-[30px] w-[30px] items-center justify-center",children:c.jsx(n,{className:J("icon-md-heavy",t)})})})})},hI=k.memo(function(e){const{hasModelTunerAutoGPT4:t}=Z0(e),s=ex(),i=Gs();if(!t)return null;const r=s&&e.isFinalTurn,o=c.jsx(Ki,{icon:dc,className:J(r&&"hover:text-token-text-tertiary",!r&&"cursor-pointer"),iconClassName:e.isFinalTurn?"icon-shimmer":void 0});return r?o:c.jsxs(up,{delayDuration:150,children:[c.jsx(fp,{children:o}),c.jsx(hp,{children:c.jsx(pp,{side:"top",sideOffset:0,children:c.jsxs("div",{className:"flex max-w-2xs flex-col flex-nowrap rounded-lg border border-token-border-light bg-token-main-surface-primary p-4 shadow-xl",children:[c.jsxs("div",{className:"mb-1 flex flex-nowrap items-start gap-2",children:[c.jsx(dc,{className:"h-[20px] w-[20px]"}),c.jsx("div",{className:"text-sm font-semibold",children:c.jsx(j,{id:"ModelTunerDisclaimer.autoUpgradeToGPT4.title",defaultMessage:"Upgraded response"})})]}),c.jsx("div",{className:"mb-3 text-sm text-token-text-secondary",children:c.jsx(j,{id:"ModelTunerDisclaimer.autoUpgradeToGPT4.content",defaultMessage:"Written with our most capable model, GPT-4, available on ChatGPT Plus"})}),c.jsx("div",{children:c.jsx(Xe,{onClick:()=>go(i,"ModelTuner disclaimer cta"),size:"small",children:c.jsx(j,{id:"ModelTunerDisclaimer.autoUpgradeToGPT4.getPlus",defaultMessage:"Get Plus"})})})]})})})]})}),pI=k.memo(function(e){const t=ex(),{hasModelTunerAutoGPT4:s}=Z0(e);return!s||!e.isFinalTurn||!t?null:c.jsx(mI,{})});function mI(){const n=pk().mutate,e=Gs();return k.useEffect(()=>{n({key:Ws.ModelTunerDisclaimer})},[]),c.jsx("div",{className:"py-4",children:c.jsx("div",{className:"flex items-start justify-start gap-2.5 rounded-2xl bg-token-main-surface-secondary p-4 pr-5 text-token-text-primary",children:c.jsxs("div",{className:"flex w-full items-center justify-between gap-4",children:[c.jsxs("div",{className:"flex flex-nowrap items-start gap-2",children:[c.jsx(dc,{className:"h-[20px] w-[20px] shrink-0"}),c.jsxs("div",{className:"text-sm",children:[c.jsx("div",{className:"font-semibold",children:c.jsx(j,{id:"ModelTunerDisclaimer.autoUpgradeToGPT4.title",defaultMessage:"Upgraded response"})}),c.jsx("div",{className:"pt-0.5",children:c.jsx(j,{id:"ModelTunerDisclaimer.autoUpgradeToGPT4.content",defaultMessage:"Written with our most capable model, GPT-4, available on ChatGPT Plus"})})]})]}),c.jsx(Xe,{className:"shrink-0",onClick:()=>go(e,"ModelTuner disclaimer cta"),size:"small",children:c.jsx(j,{id:"ModelTunerDisclaimer.autoUpgradeToGPT4.getPlus",defaultMessage:"Get Plus"})})]})})})}function Z0({message:n}){var s,i;const e=(i=(s=n==null?void 0:n.message)==null?void 0:s.metadata)==null?void 0:i.model_adjustments;return{hasModelTunerAutoGPT4:e==null?void 0:e.includes(uy.AUTO_UPGRADE_TO_GPT4)}}function ex(){var n;return k.useRef((n=fy(e=>!e.announcements[Ws.ModelTunerDisclaimer]))==null?void 0:n.data).current}function gI({clientThreadId:n,conversationMode:e}){const t=W0(n);return(i,r,o,a,l)=>{const u=z.getTree(n).getConversationTurns(i),f=u==null?void 0:u[(u==null?void 0:u.length)-1].variantIds,h=(f==null?void 0:f.length)===1,g=h?{...r,intent:"comparison_implicit"}:r;t({id:i,requestedModelId:o,eventMetadata:g,focusOnNewCompletion:!0,variantPurpose:h?"comparison_implicit":"none",conversationMode:e??qt.getConversationMode(n),useDefaultModel:!1,appendMessages:a?[{id:dr(),author:{role:$e.System},content:{content_type:Ht.Text,parts:[a]},metadata:{exclude_after_next_user_message:!0}}]:void 0,juice:l})}}const ko=Ke.a`bold underline`,Pn=({className:n,isUserTurn:e,flag:t,children:s})=>t!=="info"&&e?c.jsx(Mh,{className:J("w-full pr-5 text-right",n),$flag:t,children:s}):c.jsxs(Mh,{$flag:t,className:J("flex w-full items-start gap-3 rounded-2xl border p-4",t==="warning"||t==="danger"?"bg-opacity-5":"bg-opacity-10",n),children:[c.jsx(nr,{className:"icon-lg"}),c.jsx("div",{className:"pt-px",children:s})]}),Mh=Ke.div`text-sm 
${({$flag:n})=>{switch(n){case"danger":return"text-token-text-error border-token-surface-error/15 bg-token-surface-error bg-opacity-0";case"warning":return"text-orange-600 border-token-border-light bg-orange-400 bg-opacity-0";case"info":return"text-token-text-primary border-token-border-light bg-token-main-surface-primary bg-opacity-0";default:return"text-green-500 border-green-500 bg-green-500 bg-opacity-0"}}}`;function xI(n){var e,t;return((t=(e=n.message.metadata)==null?void 0:e.finish_details)==null?void 0:t.type)==="content_filter"}function wr(n){if(n===void 0)return{flagSeverity:void 0,shouldHideContent:!1,errCode:void 0,errMessage:void 0};const{errType:e,errCode:t,err:s,disclaimers:i}=n,r=xI(n);return!(i&&i.length>0)&&r?{flagSeverity:"warning",shouldHideContent:!1,errCode:bn.ContentOrTos,errMessage:s}:{flagSeverity:e,shouldHideContent:e==="danger"&&(t===bn.ContentPolicy||t===bn.ModelIncompatibility),disclaimers:i,errCode:t,errMessage:s}}function al(n){return c.jsx(Pn,{flag:"danger",isUserTurn:!1,children:c.jsx(j,{...cn.somethingWentWrong})})}function yI({message:n,onRequestMoreCompletions:e,clientThreadId:t,id:s,isFeedbackEnabled:i,isUserTurn:r,className:o}){const{errCode:a,errMessage:l,flagSeverity:d}=wr(n);switch(a){case bn.ContentPolicy:return c.jsx(Pn,{flag:d,isUserTurn:r,className:o,children:c.jsx(wI,{isFeedbackEnabled:i})});case bn.ModelIncompatibility:return c.jsx(Pn,{flag:d,isUserTurn:r,className:o,children:c.jsx(j,{...cn.modelIncompatibilityMessage})});case bn.ContentOrTos:return c.jsx(Pn,{flag:d,isUserTurn:r,className:o,children:c.jsx(kI,{isFeedbackEnabled:i})});case ha:return c.jsx(bI,{className:o,id:s,onRequestMoreCompletions:e,flag:d,clientThreadId:t,isUserTurn:r});case bp:return c.jsx(Pn,{flag:d,isUserTurn:r,className:o,children:c.jsx(j,{...cn.historyDisabledConversationMissing})});default:return l!==void 0?c.jsx(Pn,{flag:d,isUserTurn:r,className:o,children:c.jsx(Yv,{rehypePlugins:[[Xv,{target:"_new",rel:"noopener noreferrer"}]],className:"markdown prose w-full break-words dark:prose-invert",children:l})}):null}}function bI({className:n,id:e,onRequestMoreCompletions:t,flag:s,clientThreadId:i,isUserTurn:r}){const o=gd(y=>y.isoDate),a=Hp(o),l=Hs(i??hy),d=l&&l.kind!==tt.PrimaryAssistant,u=ep(),f=Zc(),h=k.useCallback(()=>{t(e,{eventSource:"mouse"},!0,"none",!1)},[e,t]),g=k.useCallback(()=>{const y=f.id;u({modelId:y,location:"Model switcher menu item"}),t(e,{eventSource:"mouse"},!0,"none",!0)},[t,e,f.id,u]);let x;return d?x=o!=null?c.jsx("span",{children:c.jsx(j,{...cn.gptUsageCapExceededCustomFeature,values:{link:Th,formattedTime:a}})}):c.jsx(j,{...cn.gptUsageCapExceededExpired}):x=o!=null?c.jsx("span",{children:c.jsx(j,{...cn.gptUsageCapExceeded,values:{link:Th,formattedTime:a}})}):c.jsx(j,{...cn.gptUsageCapExceededExpired}),c.jsx(Pn,{flag:o!=null?s:void 0,isUserTurn:r,className:n,children:c.jsxs("div",{className:"flex items-center gap-6",children:[x,o==null&&c.jsx(Xe,{color:"secondary",className:"flex-shrink-0",onClick:h,children:c.jsx(j,{...cn.buttonTryAgain})}),o!=null&&!d&&c.jsx(Xe,{color:"secondary",className:"flex-shrink-0",onClick:g,children:c.jsx(j,{...cn.buttonUseDefaultModel})})]})})}const Th=n=>c.jsx("a",{href:"https://share.hsforms.com/16d0ZZVM3QZirXnCD_q7u1Q4sk30",target:"_blank",rel:"noreferrer",className:"underline",children:n});function kI({isFeedbackEnabled:n}){return c.jsxs(c.Fragment,{children:[c.jsx("div",{className:n?"font-semibold":"",children:c.jsx(j,{...cn.contentOrTosViolationNoFeedback,values:{contentPolicyLink:tx,termsLink:vI}})}),c.jsx("div",{children:n&&c.jsx(j,{...cn.contentPolicyFeedback})})]})}function wI({isFeedbackEnabled:n}){return c.jsxs(c.Fragment,{children:[c.jsx("div",{className:n?"font-semibold":"",children:c.jsx(j,{...cn.contentPolicyViolationNoFeedback,values:{contentPolicyLink:tx}})}),c.jsx("div",{children:n&&c.jsx(j,{...cn.contentPolicyFeedback})})]})}const tx=n=>c.jsx(ko,{target:"_blank",href:"https://openai.com/policies/usage-policies",rel:"noreferrer",children:n}),vI=n=>c.jsx(ko,{target:"_blank",href:"https://openai.com/policies/terms-of-use",rel:"noreferrer",children:n}),cn=Ce({contentPolicyFeedback:{id:"TextMessageDisplay.contentPolicyFeedback",defaultMessage:"Did we get it wrong? Please tell us by giving this response a thumbs down."},contentPolicyViolation:{id:"TextMessageDisplay.contentPolicyViolation.2",defaultMessage:"This content may violate our <contentPolicyLink>usage policies</contentPolicyLink>. Did we get it wrong? Please tell us by giving this response a thumbs down."},contentPolicyViolationNoFeedback:{id:"TextMessageDisplay.contentPolicyViolationNoFeedback",defaultMessage:"This content may violate our <contentPolicyLink>usage policies</contentPolicyLink>."},modelIncompatibilityMessage:{id:"zXOUK3",defaultMessage:"This model can't support this action. Try again with a different model."},contentOrTosViolation:{id:"TextMessageDisplay.contentOrTosViolation.2",defaultMessage:"This content may violate our <termsLink>Terms of Use</termsLink> or <contentPolicyLink>usage policies</contentPolicyLink>. Did we get it wrong? Please tell us by giving this response a thumbs down."},contentOrTosViolationNoFeedback:{id:"TextMessageDisplay.contentOrTosViolationNoFeedback",defaultMessage:"This content may violate our <termsLink>Terms of Use</termsLink> or <contentPolicyLink>usage policies</contentPolicyLink>."},historyDisabledConversationMissing:{id:"TextMessageDisplay.historyDisabledConversationMissing",defaultMessage:"Sorry, conversations created when Chat History is off expire after 6 hours of inactivity. Please start a new conversation to continue using ChatGPT."},somethingWentWrong:{id:"TextMessageDisplay.somethingWentWrong",defaultMessage:"Something went wrong."},gptUsageCapExceeded:{id:"TextMessageDisplay.gptUsageCapExceeded",defaultMessage:"You've reached the current usage cap for GPT-4. You can continue with the default model now, or try again {formattedTime}. <link>Learn more</link>"},gptUsageCapExceededCustomFeature:{id:"TextMessageDisplay.gptUsageCapExceededCustomFeature",defaultMessage:"You've reached the current usage cap for GPT-4, please try again {formattedTime}. <link>Learn more</link>"},gptUsageCapExceededExpired:{id:"TextMessageDisplay.gptUsageCapExceededExpired",defaultMessage:"You previously reached your usage cap for GPT-4, but you can now try sending your message again"},buttonUseDefaultModel:{id:"TextMessageDisplay.buttonUseDefaultModel",defaultMessage:"Use default model"},buttonTryAgain:{id:"TextMessageDisplay.buttonTryAgain",defaultMessage:"Try again"}});var SI={};class CI{async fetch(e,t){return await e.fetchQuery(this.makeQueryOptions(t))}makeQueryOptions(e){const t=gi(e.asset.asset_pointer),s={...e,id:t},i=["getFileDownloadLink",gi(e.asset.asset_pointer)];return e.gizmoId&&i.push(e.gizmoId),{queryKey:i,queryFn:async()=>{let r;return e.sharedThreadId!=null?r={...e.asset,url:TI(s)}:r=await MI(s),r}}}}const ll=new CI;async function MI({asset:n,gizmoId:e,id:t,isUnauthenticated:s}){const i=await _e.getFileDownloadLink(t,e,s).catch(r=>{throw et.addError(new Error(`Could not fetch file with ID ${t} from file service`,{cause:r})),r});if(i.status!==nd.Success)throw et.addError(`Could not fetch file with ID ${t} from file service`,i),new Error(`Could not fetch file with ID ${t} from file service`);return{...n,url:i.download_url}}function TI({asset:n,id:e,sharedThreadId:t}){let s=null;if(n.content_type===oc.ImageAssetPointer?s="image":n.content_type===oc.AudioAssetPointer&&(s="audio"),!s)throw new Error("Unsupported asset type");const i=SI.CDN_IMAGE_BASE_URL??"",r=`${t}/${s}/${e}`;return i?`${i}/${r}`:`${py}/share/${r}`}function EI({audioAssetPointer:n}){const e=fr(),[t,s]=k.useState(!1),i=k.useRef(!0),[r,o]=k.useState(void 0),a=k.useRef(null),l=kp(),d=wp(g=>g.isPlaying&&g.sourceUrl===r),u=k.useCallback(()=>{const g=ac();if(g)a.current?a.current.then(()=>{g.stop(),a.current=null}):g.stop();else return},[]);k.useEffect(()=>(i.current=!0,()=>{i.current=!1}),[]),k.useEffect(()=>()=>{vp().isPlaying&&u()},[u]);const f=k.useCallback(async()=>{if(!l||!i.current)return;s(!0);const{url:g}=await ll.fetch(e,{asset:n});s(!1),o(g),l.changeSource(g),a.current=l.play()},[n,l,e]);return{togglePlayback:k.useCallback(()=>{if(l)d?u():(Vi.messagePlayback.click(),f());else return},[d,f,l,u]),isPlaying:d,isLoading:t}}const Li=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,nx=new Set,Vc=typeof process=="object"&&process?process:{},sx=(n,e,t,s)=>{typeof Vc.emitWarning=="function"?Vc.emitWarning(n,e,t,s):console.error(`[${t}] ${e}: ${n}`)};let ja=globalThis.AbortController,Eh=globalThis.AbortSignal;var Jh;if(typeof ja>"u"){Eh=class{constructor(){se(this,"onabort");se(this,"_onabort",[]);se(this,"reason");se(this,"aborted",!1)}addEventListener(s,i){this._onabort.push(i)}},ja=class{constructor(){se(this,"signal",new Eh);e()}abort(s){var i,r;if(!this.signal.aborted){this.signal.reason=s,this.signal.aborted=!0;for(const o of this.signal._onabort)o(s);(r=(i=this.signal).onabort)==null||r.call(i,s)}}};let n=((Jh=Vc.env)==null?void 0:Jh.LRU_CACHE_IGNORE_AC_WARNING)!=="1";const e=()=>{n&&(n=!1,sx("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}const _I=n=>!nx.has(n),Ms=n=>n&&n===Math.floor(n)&&n>0&&isFinite(n),ix=n=>Ms(n)?n<=Math.pow(2,8)?Uint8Array:n<=Math.pow(2,16)?Uint16Array:n<=Math.pow(2,32)?Uint32Array:n<=Number.MAX_SAFE_INTEGER?ea:null:null;class ea extends Array{constructor(e){super(e),this.fill(0)}}var Yi;const ri=class ri{constructor(e,t){se(this,"heap");se(this,"length");if(!C(ri,Yi))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new t(e),this.length=0}static create(e){const t=ix(e);if(!t)return[];de(ri,Yi,!0);const s=new ri(e,t);return de(ri,Yi,!1),s}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}};Yi=new WeakMap,Le(ri,Yi,!1);let Gc=ri;var Yh,Xh,Mn,sn,Tn,En,Xi,wt,_n,pt,Ze,ge,Gt,rn,Pt,Ct,An,Mt,Nn,In,on,Rn,Ds,$t,ee,Wc,li,us,so,an,rx,ci,Qi,io,Ts,Es,Hc,ta,na,Qe,qc,Or;const bu=class bu{constructor(e){Le(this,ee);Le(this,Mn);Le(this,sn);Le(this,Tn);Le(this,En);Le(this,Xi);se(this,"ttl");se(this,"ttlResolution");se(this,"ttlAutopurge");se(this,"updateAgeOnGet");se(this,"updateAgeOnHas");se(this,"allowStale");se(this,"noDisposeOnSet");se(this,"noUpdateTTL");se(this,"maxEntrySize");se(this,"sizeCalculation");se(this,"noDeleteOnFetchRejection");se(this,"noDeleteOnStaleGet");se(this,"allowStaleOnFetchAbort");se(this,"allowStaleOnFetchRejection");se(this,"ignoreFetchAbort");Le(this,wt);Le(this,_n);Le(this,pt);Le(this,Ze);Le(this,ge);Le(this,Gt);Le(this,rn);Le(this,Pt);Le(this,Ct);Le(this,An);Le(this,Mt);Le(this,Nn);Le(this,In);Le(this,on);Le(this,Rn);Le(this,Ds);Le(this,$t);Le(this,li,()=>{});Le(this,us,()=>{});Le(this,so,()=>{});Le(this,an,()=>!1);Le(this,ci,e=>{});Le(this,Qi,(e,t,s)=>{});Le(this,io,(e,t,s,i)=>{if(s||i)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0});se(this,Yh,"LRUCache");const{max:t=0,ttl:s,ttlResolution:i=1,ttlAutopurge:r,updateAgeOnGet:o,updateAgeOnHas:a,allowStale:l,dispose:d,disposeAfter:u,noDisposeOnSet:f,noUpdateTTL:h,maxSize:g=0,maxEntrySize:x=0,sizeCalculation:y,fetchMethod:w,noDeleteOnFetchRejection:S,noDeleteOnStaleGet:_,allowStaleOnFetchRejection:O,allowStaleOnFetchAbort:T,ignoreFetchAbort:E}=e;if(t!==0&&!Ms(t))throw new TypeError("max option must be a nonnegative integer");const R=t?ix(t):Array;if(!R)throw new Error("invalid max value: "+t);if(de(this,Mn,t),de(this,sn,g),this.maxEntrySize=x||C(this,sn),this.sizeCalculation=y,this.sizeCalculation){if(!C(this,sn)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(w!==void 0&&typeof w!="function")throw new TypeError("fetchMethod must be a function if specified");if(de(this,Xi,w),de(this,Ds,!!w),de(this,pt,new Map),de(this,Ze,new Array(t).fill(void 0)),de(this,ge,new Array(t).fill(void 0)),de(this,Gt,new R(t)),de(this,rn,new R(t)),de(this,Pt,0),de(this,Ct,0),de(this,An,Gc.create(t)),de(this,wt,0),de(this,_n,0),typeof d=="function"&&de(this,Tn,d),typeof u=="function"?(de(this,En,u),de(this,Mt,[])):(de(this,En,void 0),de(this,Mt,void 0)),de(this,Rn,!!C(this,Tn)),de(this,$t,!!C(this,En)),this.noDisposeOnSet=!!f,this.noUpdateTTL=!!h,this.noDeleteOnFetchRejection=!!S,this.allowStaleOnFetchRejection=!!O,this.allowStaleOnFetchAbort=!!T,this.ignoreFetchAbort=!!E,this.maxEntrySize!==0){if(C(this,sn)!==0&&!Ms(C(this,sn)))throw new TypeError("maxSize must be a positive integer if specified");if(!Ms(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");ae(this,ee,rx).call(this)}if(this.allowStale=!!l,this.noDeleteOnStaleGet=!!_,this.updateAgeOnGet=!!o,this.updateAgeOnHas=!!a,this.ttlResolution=Ms(i)||i===0?i:1,this.ttlAutopurge=!!r,this.ttl=s||0,this.ttl){if(!Ms(this.ttl))throw new TypeError("ttl must be a positive integer if specified");ae(this,ee,Wc).call(this)}if(C(this,Mn)===0&&this.ttl===0&&C(this,sn)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!C(this,Mn)&&!C(this,sn)){const F="LRU_CACHE_UNBOUNDED";_I(F)&&(nx.add(F),sx("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",F,bu))}}static unsafeExposeInternals(e){return{starts:C(e,In),ttls:C(e,on),sizes:C(e,Nn),keyMap:C(e,pt),keyList:C(e,Ze),valList:C(e,ge),next:C(e,Gt),prev:C(e,rn),get head(){return C(e,Pt)},get tail(){return C(e,Ct)},free:C(e,An),isBackgroundFetch:t=>{var s;return ae(s=e,ee,Qe).call(s,t)},backgroundFetch:(t,s,i,r)=>{var o;return ae(o=e,ee,na).call(o,t,s,i,r)},moveToTail:t=>{var s;return ae(s=e,ee,Or).call(s,t)},indexes:t=>{var s;return ae(s=e,ee,Ts).call(s,t)},rindexes:t=>{var s;return ae(s=e,ee,Es).call(s,t)},isStale:t=>{var s;return C(s=e,an).call(s,t)}}}get max(){return C(this,Mn)}get maxSize(){return C(this,sn)}get calculatedSize(){return C(this,_n)}get size(){return C(this,wt)}get fetchMethod(){return C(this,Xi)}get dispose(){return C(this,Tn)}get disposeAfter(){return C(this,En)}getRemainingTTL(e){return C(this,pt).has(e)?1/0:0}*entries(){for(const e of ae(this,ee,Ts).call(this))C(this,ge)[e]!==void 0&&C(this,Ze)[e]!==void 0&&!ae(this,ee,Qe).call(this,C(this,ge)[e])&&(yield[C(this,Ze)[e],C(this,ge)[e]])}*rentries(){for(const e of ae(this,ee,Es).call(this))C(this,ge)[e]!==void 0&&C(this,Ze)[e]!==void 0&&!ae(this,ee,Qe).call(this,C(this,ge)[e])&&(yield[C(this,Ze)[e],C(this,ge)[e]])}*keys(){for(const e of ae(this,ee,Ts).call(this)){const t=C(this,Ze)[e];t!==void 0&&!ae(this,ee,Qe).call(this,C(this,ge)[e])&&(yield t)}}*rkeys(){for(const e of ae(this,ee,Es).call(this)){const t=C(this,Ze)[e];t!==void 0&&!ae(this,ee,Qe).call(this,C(this,ge)[e])&&(yield t)}}*values(){for(const e of ae(this,ee,Ts).call(this))C(this,ge)[e]!==void 0&&!ae(this,ee,Qe).call(this,C(this,ge)[e])&&(yield C(this,ge)[e])}*rvalues(){for(const e of ae(this,ee,Es).call(this))C(this,ge)[e]!==void 0&&!ae(this,ee,Qe).call(this,C(this,ge)[e])&&(yield C(this,ge)[e])}[(Xh=Symbol.iterator,Yh=Symbol.toStringTag,Xh)](){return this.entries()}find(e,t={}){for(const s of ae(this,ee,Ts).call(this)){const i=C(this,ge)[s],r=ae(this,ee,Qe).call(this,i)?i.__staleWhileFetching:i;if(r!==void 0&&e(r,C(this,Ze)[s],this))return this.get(C(this,Ze)[s],t)}}forEach(e,t=this){for(const s of ae(this,ee,Ts).call(this)){const i=C(this,ge)[s],r=ae(this,ee,Qe).call(this,i)?i.__staleWhileFetching:i;r!==void 0&&e.call(t,r,C(this,Ze)[s],this)}}rforEach(e,t=this){for(const s of ae(this,ee,Es).call(this)){const i=C(this,ge)[s],r=ae(this,ee,Qe).call(this,i)?i.__staleWhileFetching:i;r!==void 0&&e.call(t,r,C(this,Ze)[s],this)}}purgeStale(){let e=!1;for(const t of ae(this,ee,Es).call(this,{allowStale:!0}))C(this,an).call(this,t)&&(this.delete(C(this,Ze)[t]),e=!0);return e}info(e){const t=C(this,pt).get(e);if(t===void 0)return;const s=C(this,ge)[t],i=ae(this,ee,Qe).call(this,s)?s.__staleWhileFetching:s;if(i===void 0)return;const r={value:i};if(C(this,on)&&C(this,In)){const o=C(this,on)[t],a=C(this,In)[t];if(o&&a){const l=o-(Li.now()-a);r.ttl=l,r.start=Date.now()}}return C(this,Nn)&&(r.size=C(this,Nn)[t]),r}dump(){const e=[];for(const t of ae(this,ee,Ts).call(this,{allowStale:!0})){const s=C(this,Ze)[t],i=C(this,ge)[t],r=ae(this,ee,Qe).call(this,i)?i.__staleWhileFetching:i;if(r===void 0||s===void 0)continue;const o={value:r};if(C(this,on)&&C(this,In)){o.ttl=C(this,on)[t];const a=Li.now()-C(this,In)[t];o.start=Math.floor(Date.now()-a)}C(this,Nn)&&(o.size=C(this,Nn)[t]),e.unshift([s,o])}return e}load(e){this.clear();for(const[t,s]of e){if(s.start){const i=Date.now()-s.start;s.start=Li.now()-i}this.set(t,s.value,s)}}set(e,t,s={}){var h,g,x,y,w;if(t===void 0)return this.delete(e),this;const{ttl:i=this.ttl,start:r,noDisposeOnSet:o=this.noDisposeOnSet,sizeCalculation:a=this.sizeCalculation,status:l}=s;let{noUpdateTTL:d=this.noUpdateTTL}=s;const u=C(this,io).call(this,e,t,s.size||0,a);if(this.maxEntrySize&&u>this.maxEntrySize)return l&&(l.set="miss",l.maxEntrySizeExceeded=!0),this.delete(e),this;let f=C(this,wt)===0?void 0:C(this,pt).get(e);if(f===void 0)f=C(this,wt)===0?C(this,Ct):C(this,An).length!==0?C(this,An).pop():C(this,wt)===C(this,Mn)?ae(this,ee,ta).call(this,!1):C(this,wt),C(this,Ze)[f]=e,C(this,ge)[f]=t,C(this,pt).set(e,f),C(this,Gt)[C(this,Ct)]=f,C(this,rn)[f]=C(this,Ct),de(this,Ct,f),Co(this,wt)._++,C(this,Qi).call(this,f,u,l),l&&(l.set="add"),d=!1;else{ae(this,ee,Or).call(this,f);const S=C(this,ge)[f];if(t!==S){if(C(this,Ds)&&ae(this,ee,Qe).call(this,S)){S.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:_}=S;_!==void 0&&!o&&(C(this,Rn)&&((h=C(this,Tn))==null||h.call(this,_,e,"set")),C(this,$t)&&((g=C(this,Mt))==null||g.push([_,e,"set"])))}else o||(C(this,Rn)&&((x=C(this,Tn))==null||x.call(this,S,e,"set")),C(this,$t)&&((y=C(this,Mt))==null||y.push([S,e,"set"])));if(C(this,ci).call(this,f),C(this,Qi).call(this,f,u,l),C(this,ge)[f]=t,l){l.set="replace";const _=S&&ae(this,ee,Qe).call(this,S)?S.__staleWhileFetching:S;_!==void 0&&(l.oldValue=_)}}else l&&(l.set="update")}if(i!==0&&!C(this,on)&&ae(this,ee,Wc).call(this),C(this,on)&&(d||C(this,so).call(this,f,i,r),l&&C(this,us).call(this,l,f)),!o&&C(this,$t)&&C(this,Mt)){const S=C(this,Mt);let _;for(;_=S==null?void 0:S.shift();)(w=C(this,En))==null||w.call(this,..._)}return this}pop(){var e;try{for(;C(this,wt);){const t=C(this,ge)[C(this,Pt)];if(ae(this,ee,ta).call(this,!0),ae(this,ee,Qe).call(this,t)){if(t.__staleWhileFetching)return t.__staleWhileFetching}else if(t!==void 0)return t}}finally{if(C(this,$t)&&C(this,Mt)){const t=C(this,Mt);let s;for(;s=t==null?void 0:t.shift();)(e=C(this,En))==null||e.call(this,...s)}}}has(e,t={}){const{updateAgeOnHas:s=this.updateAgeOnHas,status:i}=t,r=C(this,pt).get(e);if(r!==void 0){const o=C(this,ge)[r];if(ae(this,ee,Qe).call(this,o)&&o.__staleWhileFetching===void 0)return!1;if(C(this,an).call(this,r))i&&(i.has="stale",C(this,us).call(this,i,r));else return s&&C(this,li).call(this,r),i&&(i.has="hit",C(this,us).call(this,i,r)),!0}else i&&(i.has="miss");return!1}peek(e,t={}){const{allowStale:s=this.allowStale}=t,i=C(this,pt).get(e);if(i===void 0||!s&&C(this,an).call(this,i))return;const r=C(this,ge)[i];return ae(this,ee,Qe).call(this,r)?r.__staleWhileFetching:r}async fetch(e,t={}){const{allowStale:s=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,ttl:o=this.ttl,noDisposeOnSet:a=this.noDisposeOnSet,size:l=0,sizeCalculation:d=this.sizeCalculation,noUpdateTTL:u=this.noUpdateTTL,noDeleteOnFetchRejection:f=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:h=this.allowStaleOnFetchRejection,ignoreFetchAbort:g=this.ignoreFetchAbort,allowStaleOnFetchAbort:x=this.allowStaleOnFetchAbort,context:y,forceRefresh:w=!1,status:S,signal:_}=t;if(!C(this,Ds))return S&&(S.fetch="get"),this.get(e,{allowStale:s,updateAgeOnGet:i,noDeleteOnStaleGet:r,status:S});const O={allowStale:s,updateAgeOnGet:i,noDeleteOnStaleGet:r,ttl:o,noDisposeOnSet:a,size:l,sizeCalculation:d,noUpdateTTL:u,noDeleteOnFetchRejection:f,allowStaleOnFetchRejection:h,allowStaleOnFetchAbort:x,ignoreFetchAbort:g,status:S,signal:_};let T=C(this,pt).get(e);if(T===void 0){S&&(S.fetch="miss");const E=ae(this,ee,na).call(this,e,T,O,y);return E.__returned=E}else{const E=C(this,ge)[T];if(ae(this,ee,Qe).call(this,E)){const $=s&&E.__staleWhileFetching!==void 0;return S&&(S.fetch="inflight",$&&(S.returnedStale=!0)),$?E.__staleWhileFetching:E.__returned=E}const R=C(this,an).call(this,T);if(!w&&!R)return S&&(S.fetch="hit"),ae(this,ee,Or).call(this,T),i&&C(this,li).call(this,T),S&&C(this,us).call(this,S,T),E;const F=ae(this,ee,na).call(this,e,T,O,y),I=F.__staleWhileFetching!==void 0&&s;return S&&(S.fetch=R?"stale":"refresh",I&&R&&(S.returnedStale=!0)),I?F.__staleWhileFetching:F.__returned=F}}get(e,t={}){const{allowStale:s=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,status:o}=t,a=C(this,pt).get(e);if(a!==void 0){const l=C(this,ge)[a],d=ae(this,ee,Qe).call(this,l);return o&&C(this,us).call(this,o,a),C(this,an).call(this,a)?(o&&(o.get="stale"),d?(o&&s&&l.__staleWhileFetching!==void 0&&(o.returnedStale=!0),s?l.__staleWhileFetching:void 0):(r||this.delete(e),o&&s&&(o.returnedStale=!0),s?l:void 0)):(o&&(o.get="hit"),d?l.__staleWhileFetching:(ae(this,ee,Or).call(this,a),i&&C(this,li).call(this,a),l))}else o&&(o.get="miss")}delete(e){var s,i,r,o;let t=!1;if(C(this,wt)!==0){const a=C(this,pt).get(e);if(a!==void 0)if(t=!0,C(this,wt)===1)this.clear();else{C(this,ci).call(this,a);const l=C(this,ge)[a];if(ae(this,ee,Qe).call(this,l)?l.__abortController.abort(new Error("deleted")):(C(this,Rn)||C(this,$t))&&(C(this,Rn)&&((s=C(this,Tn))==null||s.call(this,l,e,"delete")),C(this,$t)&&((i=C(this,Mt))==null||i.push([l,e,"delete"]))),C(this,pt).delete(e),C(this,Ze)[a]=void 0,C(this,ge)[a]=void 0,a===C(this,Ct))de(this,Ct,C(this,rn)[a]);else if(a===C(this,Pt))de(this,Pt,C(this,Gt)[a]);else{const d=C(this,rn)[a];C(this,Gt)[d]=C(this,Gt)[a];const u=C(this,Gt)[a];C(this,rn)[u]=C(this,rn)[a]}Co(this,wt)._--,C(this,An).push(a)}}if(C(this,$t)&&((r=C(this,Mt))!=null&&r.length)){const a=C(this,Mt);let l;for(;l=a==null?void 0:a.shift();)(o=C(this,En))==null||o.call(this,...l)}return t}clear(){var e,t,s;for(const i of ae(this,ee,Es).call(this,{allowStale:!0})){const r=C(this,ge)[i];if(ae(this,ee,Qe).call(this,r))r.__abortController.abort(new Error("deleted"));else{const o=C(this,Ze)[i];C(this,Rn)&&((e=C(this,Tn))==null||e.call(this,r,o,"delete")),C(this,$t)&&((t=C(this,Mt))==null||t.push([r,o,"delete"]))}}if(C(this,pt).clear(),C(this,ge).fill(void 0),C(this,Ze).fill(void 0),C(this,on)&&C(this,In)&&(C(this,on).fill(0),C(this,In).fill(0)),C(this,Nn)&&C(this,Nn).fill(0),de(this,Pt,0),de(this,Ct,0),C(this,An).length=0,de(this,_n,0),de(this,wt,0),C(this,$t)&&C(this,Mt)){const i=C(this,Mt);let r;for(;r=i==null?void 0:i.shift();)(s=C(this,En))==null||s.call(this,...r)}}};Mn=new WeakMap,sn=new WeakMap,Tn=new WeakMap,En=new WeakMap,Xi=new WeakMap,wt=new WeakMap,_n=new WeakMap,pt=new WeakMap,Ze=new WeakMap,ge=new WeakMap,Gt=new WeakMap,rn=new WeakMap,Pt=new WeakMap,Ct=new WeakMap,An=new WeakMap,Mt=new WeakMap,Nn=new WeakMap,In=new WeakMap,on=new WeakMap,Rn=new WeakMap,Ds=new WeakMap,$t=new WeakMap,ee=new WeakSet,Wc=function(){const e=new ea(C(this,Mn)),t=new ea(C(this,Mn));de(this,on,e),de(this,In,t),de(this,so,(r,o,a=Li.now())=>{if(t[r]=o!==0?a:0,e[r]=o,o!==0&&this.ttlAutopurge){const l=setTimeout(()=>{C(this,an).call(this,r)&&this.delete(C(this,Ze)[r])},o+1);l.unref&&l.unref()}}),de(this,li,r=>{t[r]=e[r]!==0?Li.now():0}),de(this,us,(r,o)=>{if(e[o]){const a=e[o],l=t[o];if(!a||!l)return;r.ttl=a,r.start=l,r.now=s||i();const d=r.now-l;r.remainingTTL=a-d}});let s=0;const i=()=>{const r=Li.now();if(this.ttlResolution>0){s=r;const o=setTimeout(()=>s=0,this.ttlResolution);o.unref&&o.unref()}return r};this.getRemainingTTL=r=>{const o=C(this,pt).get(r);if(o===void 0)return 0;const a=e[o],l=t[o];if(!a||!l)return 1/0;const d=(s||i())-l;return a-d},de(this,an,r=>{const o=t[r],a=e[r];return!!a&&!!o&&(s||i())-o>a})},li=new WeakMap,us=new WeakMap,so=new WeakMap,an=new WeakMap,rx=function(){const e=new ea(C(this,Mn));de(this,_n,0),de(this,Nn,e),de(this,ci,t=>{de(this,_n,C(this,_n)-e[t]),e[t]=0}),de(this,io,(t,s,i,r)=>{if(ae(this,ee,Qe).call(this,s))return 0;if(!Ms(i))if(r){if(typeof r!="function")throw new TypeError("sizeCalculation must be a function");if(i=r(s,t),!Ms(i))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return i}),de(this,Qi,(t,s,i)=>{if(e[t]=s,C(this,sn)){const r=C(this,sn)-e[t];for(;C(this,_n)>r;)ae(this,ee,ta).call(this,!0)}de(this,_n,C(this,_n)+e[t]),i&&(i.entrySize=s,i.totalCalculatedSize=C(this,_n))})},ci=new WeakMap,Qi=new WeakMap,io=new WeakMap,Ts=function*({allowStale:e=this.allowStale}={}){if(C(this,wt))for(let t=C(this,Ct);!(!ae(this,ee,Hc).call(this,t)||((e||!C(this,an).call(this,t))&&(yield t),t===C(this,Pt)));)t=C(this,rn)[t]},Es=function*({allowStale:e=this.allowStale}={}){if(C(this,wt))for(let t=C(this,Pt);!(!ae(this,ee,Hc).call(this,t)||((e||!C(this,an).call(this,t))&&(yield t),t===C(this,Ct)));)t=C(this,Gt)[t]},Hc=function(e){return e!==void 0&&C(this,pt).get(C(this,Ze)[e])===e},ta=function(e){var r,o;const t=C(this,Pt),s=C(this,Ze)[t],i=C(this,ge)[t];return C(this,Ds)&&ae(this,ee,Qe).call(this,i)?i.__abortController.abort(new Error("evicted")):(C(this,Rn)||C(this,$t))&&(C(this,Rn)&&((r=C(this,Tn))==null||r.call(this,i,s,"evict")),C(this,$t)&&((o=C(this,Mt))==null||o.push([i,s,"evict"]))),C(this,ci).call(this,t),e&&(C(this,Ze)[t]=void 0,C(this,ge)[t]=void 0,C(this,An).push(t)),C(this,wt)===1?(de(this,Pt,de(this,Ct,0)),C(this,An).length=0):de(this,Pt,C(this,Gt)[t]),C(this,pt).delete(s),Co(this,wt)._--,t},na=function(e,t,s,i){const r=t===void 0?void 0:C(this,ge)[t];if(ae(this,ee,Qe).call(this,r))return r;const o=new ja,{signal:a}=s;a==null||a.addEventListener("abort",()=>o.abort(a.reason),{signal:o.signal});const l={signal:o.signal,options:s,context:i},d=(y,w=!1)=>{const{aborted:S}=o.signal,_=s.ignoreFetchAbort&&y!==void 0;if(s.status&&(S&&!w?(s.status.fetchAborted=!0,s.status.fetchError=o.signal.reason,_&&(s.status.fetchAbortIgnored=!0)):s.status.fetchResolved=!0),S&&!_&&!w)return f(o.signal.reason);const O=g;return C(this,ge)[t]===g&&(y===void 0?O.__staleWhileFetching?C(this,ge)[t]=O.__staleWhileFetching:this.delete(e):(s.status&&(s.status.fetchUpdated=!0),this.set(e,y,l.options))),y},u=y=>(s.status&&(s.status.fetchRejected=!0,s.status.fetchError=y),f(y)),f=y=>{const{aborted:w}=o.signal,S=w&&s.allowStaleOnFetchAbort,_=S||s.allowStaleOnFetchRejection,O=_||s.noDeleteOnFetchRejection,T=g;if(C(this,ge)[t]===g&&(!O||T.__staleWhileFetching===void 0?this.delete(e):S||(C(this,ge)[t]=T.__staleWhileFetching)),_)return s.status&&T.__staleWhileFetching!==void 0&&(s.status.returnedStale=!0),T.__staleWhileFetching;if(T.__returned===T)throw y},h=(y,w)=>{var _;const S=(_=C(this,Xi))==null?void 0:_.call(this,e,r,l);S&&S instanceof Promise&&S.then(O=>y(O===void 0?void 0:O),w),o.signal.addEventListener("abort",()=>{(!s.ignoreFetchAbort||s.allowStaleOnFetchAbort)&&(y(void 0),s.allowStaleOnFetchAbort&&(y=O=>d(O,!0)))})};s.status&&(s.status.fetchDispatched=!0);const g=new Promise(h).then(d,u),x=Object.assign(g,{__abortController:o,__staleWhileFetching:r,__returned:void 0});return t===void 0?(this.set(e,x,{...l.options,status:void 0}),t=C(this,pt).get(e)):C(this,ge)[t]=x,x},Qe=function(e){if(!C(this,Ds))return!1;const t=e;return!!t&&t instanceof Promise&&t.hasOwnProperty("__staleWhileFetching")&&t.__abortController instanceof ja},qc=function(e,t){C(this,rn)[t]=e,C(this,Gt)[e]=t},Or=function(e){e!==C(this,Ct)&&(e===C(this,Pt)?de(this,Pt,C(this,Gt)[e]):ae(this,ee,qc).call(this,C(this,rn)[e],C(this,Gt)[e]),ae(this,ee,qc).call(this,C(this,Ct),e),de(this,Ct,e))};let $c=bu;function AI({conversationId:n,messageId:e}){const[t,s]=k.useState(!1),i=k.useRef({isMediaSourceAvailable:mu(),mediaSourceFormat:gu()??"n/a",playPromise:null,shouldAbortQueuedPlayback:!1}).current,r=ye(),{voiceName:o}=mk(),a=`${n}.${e}.${o}`,l=kp(),d=wp(x=>{var y;return x.isPlaying&&x.sourceUrl===((y=yn.get(a))==null?void 0:y.src)}),u=k.useCallback(async()=>{if(!l)return;s(!0);const x={isMediaSourceAvailable:i.isMediaSourceAvailable,format:i.mediaSourceFormat};try{const y=await NI({key:a,message_id:e,conversation_id:n,voice:o,onStreamingError:w=>{Vi.readAloud.error(w,x),s(!1),xt.danger(r.formatMessage(_h.playbackError,{error:w.message}))},onStreamingStart:()=>{s(!1)}});if(i.shouldAbortQueuedPlayback){i.shouldAbortQueuedPlayback=!1;return}l.changeSource(y),i.playPromise=l.play()}catch(y){Vi.readAloud.error(y,x),s(!1),xt.danger(r.formatMessage(_h.playbackError,{error:y.message}))}},[l,a,e,n,o,i,r]),f=k.useCallback(()=>{const x=ac();x&&(i.playPromise?i.playPromise.then(()=>{x.stop(),i.playPromise=null}):x.stop())},[i]),h=k.useCallback(()=>{var y;const x=ac();x&&(x.state.isPlaying&&x.state.sourceUrl===((y=yn.get(a))==null?void 0:y.src)?f():(Vi.readAloud.click({isMediaSourceAvailable:i.isMediaSourceAvailable,format:i.mediaSourceFormat}),u()))},[a,i,u,f]);k.useEffect(()=>{t&&d&&s(!1)},[t,d]);const g=k.useRef(a);return k.useEffect(()=>{g.current=a}),k.useEffect(()=>(i.shouldAbortQueuedPlayback=!1,()=>{var w;const x=vp();x.isPlaying&&x.sourceUrl===((w=yn.get(g.current))==null?void 0:w.src)?f():i.shouldAbortQueuedPlayback=!0}),[i,f]),{togglePlayback:h,isPlaying:d,isLoading:t}}async function ox({message_id:n,conversation_id:e,voice:t}){const s=await _e.synthesize({message_id:n,conversation_id:e,voice:t,format:gu()}),i=s.headers.get("content-type")??"audio/aac";return{response:s,format:i}}async function NI(n){return mu()?RI(n):II(n)}async function II({key:n,...e}){const t=yn.get(n);if(t!=null&&t.blob)return t.src;const{response:s,format:i}=await ox(e),r=await s.arrayBuffer(),o=new Blob([r],{type:i}),a=ax({key:n,src:URL.createObjectURL(o),format:i,blob:o});return yn.set(n,a),a.src}async function RI({key:n,onStreamingError:e,onStreamingStart:t,...s}){let i=yn.get(n);i!=null&&i.streaming&&(yn.delete(n),i=void 0);let r,o;const a=jI(),l=new a;if(i)r=i,r.src=URL.createObjectURL(l);else{const{format:f,response:h}=await ox(s);o=h,r=ax({key:n,src:URL.createObjectURL(l),format:f})}const d=DI(r.id),u={sourceopen:async()=>{var g,x;d("sourceopen");const f=l.addSourceBuffer(r.format),h=async()=>{f.updating&&await new Promise(y=>f.addEventListener("updateend",y,{once:!0}))};if(r.segments.length&&!r.streaming){d("streaming from cache"),r.streaming=!0,t();for(const y of r.segments)f.appendBuffer(y),await h();l.readyState==="open"&&l.endOfStream(),r.streaming=!1,d("done streaming from cache");return}if(o){d("fetching audio");try{const y=(g=o.body)==null?void 0:g.getReader();if(!y)return;for(;((x=yn.get(n))==null?void 0:x.id)===r.id;){const{done:w,value:S}=await y.read();if(w){d("done streaming"),r.streaming=!1,l.readyState==="open"&&l.endOfStream();break}if(!Array.from(l.sourceBuffers).includes(f)){d("stop streaming, source buffer removed"),r.streaming=!1;break}r.streaming||(d("start streaming"),r.streaming=!0,t()),f.appendBuffer(S),r.segments.push(S),await h()}}catch(y){if(d("error while streaming",y),r.streaming=!1,l.readyState==="open")try{l.endOfStream("network")}catch(w){Vi.readAloud.error(w)}yn.delete(n),e(y)}}},sourceclose:()=>{var f;d("sourceclose"),r.streaming&&(r.streaming=!1,((f=yn.get(n))==null?void 0:f.id)===r.id&&(d("sourceclosed while streaming, cleaning up cache"),yn.delete(n)))},sourceended:vt};for(const[f,h]of Object.entries(u))l.addEventListener(f,()=>{try{return h()}catch(g){Vi.readAloud.error(g)}});return yn.set(n,r),r.src}const _h=Ce({playbackError:{id:"useVoiceReadAloudAudio.playbackError",defaultMessage:"Failed to play message"}}),DI=n=>vt;function jI(){return mu()?window.MediaSource:null}function mu(){return!!gu()}function gu(){if("MediaSource"in window){const n=e=>my(e)&&MediaSource.isTypeSupported(e);if(n("audio/aac"))return"aac";if(n("audio/mpeg"))return"mp3";if(n("audio/ogg"))return"ogg"}}const ax=n=>({id:dr(),segments:[],streaming:!1,...n}),yn=new $c({max:50,dispose:n=>{URL.revokeObjectURL(n.src)}}),PI=k.memo(function(e){var o;const t=(o=fs("1923022511"))==null?void 0:o.value,s=po(e.conversationId),{errCode:i}=wr(e.message);if(!t||!s||i)return null;const r=Sp.getAudioAssetPointers(e.message.message)[0];return r?c.jsx(OI,{audioAssetPointer:r}):c.jsx(FI,{...e,conversationId:s})});function OI({audioAssetPointer:n}){const{isLoading:e,isPlaying:t,togglePlayback:s}=EI({audioAssetPointer:n});return c.jsx(lx,{onClick:s,isPlaying:t,isLoading:e,playText:xu.replay})}function FI({conversationId:n,message:e}){const{isLoading:t,isPlaying:s,togglePlayback:i}=AI({conversationId:n,messageId:e.message.id});return c.jsx(lx,{onClick:i,isPlaying:s,isLoading:t,playText:xu.play})}function lx({onClick:n,isPlaying:e,isLoading:t,playText:s}){let i,r;const o=ye();return t?i=Fa:e?(i=qw,r=xu.stop):(i=Kw,r=s),c.jsx(Ki,{icon:i,label:r?o.formatMessage(r):void 0,disabled:t,onClick:n,style:e||t?{visibility:"visible"}:void 0})}const xu={replay:{id:"VoiceReadOutLoudButton.replay",defaultMessage:"Replay",description:"The tooltip for the replay button"},play:{id:"VoiceReadOutLoudButton.play",defaultMessage:"Read Aloud",description:"The tooltip for the read aloud button"},stop:{id:"VoiceReadOutLoudButton.stop",defaultMessage:"Stop",description:"The tooltip for the stop button"}},LI="bg-token-main-surface-primary text-token-text-primary",BI="openai",Ah=["bg-blue-300 text-white"];function UI(n){return Ah[((n==null?void 0:n.charCodeAt(0))??0)%Ah.length]}const Bo=({children:n})=>c.jsx("div",{className:"pt-0",children:c.jsx("div",{className:J(k.isValidElement(n)&&n.type===cc?"gizmo-bot-avatar":"gizmo-shadow-stroke","flex h-8 w-8 items-center justify-center overflow-hidden rounded-full"),children:n})});function Kc({messages:n,isUserTurn:e,avatarClassName:t,gizmo:s,showInlineEmbeddedDisplay:i=!1}){var g;const r="medium",o=n[0],a=(g=o==null?void 0:o.message.metadata)==null?void 0:g.shared_conversation_id,l=a!=null,d=pr(),{gizmoEditorData:u,mode:f}=gr();let h=c.jsx(Bo,{children:c.jsx(cc,{className:t??LI,iconName:BI,size:r})});return s?h=c.jsx(Bo,{children:c.jsx(xS,{gizmoId:s.gizmo.id,className:"h-full w-full"})}):u!=null&&f==="test"&&(h=c.jsx(Im,{isFirstParty:!1,src:u.profilePictureUrl,className:"h-8 w-8 first:pt-[3px]"})),c.jsx("div",{children:e?l||i?c.jsx(Bo,{children:c.jsx(cc,{className:UI(a),iconName:"user",size:r})}):c.jsx(Bo,{children:c.jsx(Cw,{user:d,size:r})}):h})}const zI={a:n=>{const{node:e,...t}=n;return c.jsx(ko,{...t,target:"_blank",rel:"noreferrer",className:"[&&]:text-black [&&]:underline [&&]:hover:text-black [&&]:dark:text-white [&&]:hover:dark:text-white"})}};function VI({disclaimerContent:n,isUserTurn:e,className:t}){switch(n){case"us_elections_policy":return c.jsx(Pn,{flag:"info",isUserTurn:e,className:t,children:c.jsx(j,{id:"D1Mw8a",defaultMessage:"Always verify information about voting with your state or local election authority. For more information, visit <usElectionLink></usElectionLink>.",values:{usElectionLink:$I}})});case"eu_elections_policy":return c.jsx(Pn,{flag:"info",isUserTurn:e,className:t,children:c.jsx(j,{id:"Disclaimer.EUElections",defaultMessage:"Always verify information about voting with your local election authority. For more information about the EU elections, visit <euElectionLink></euElectionLink>.",values:{euElectionLink:GI}})});case"generic_elections_policy":return c.jsx(Pn,{flag:"info",isUserTurn:e,className:t,children:c.jsx(j,{id:"Disclaimer.GenericElections",defaultMessage:"Always verify information about voting with your local election authority."})})}return c.jsx(Pn,{flag:"info",isUserTurn:e,className:t,children:c.jsx(qa,{className:"text-sm",componentOverrides:zI,children:n})})}const GI=()=>c.jsx(ko,{target:"_blank",href:"https://elections.europa.eu",rel:"noreferrer",children:"elections.europa.eu"}),$I=()=>c.jsx(ko,{target:"_blank",href:"https://canivote.org",rel:"noreferrer",children:"canivote.org"});function WI({className:n,isUserTurn:e,message:t}){var s;return(s=t==null?void 0:t.disclaimers)!=null&&s.length?c.jsx("div",{className:"flex flex-col gap-2",children:t.disclaimers.map(i=>c.jsx(VI,{className:n,disclaimerContent:i,isUserTurn:e},i))}):null}const Nh=n=>({type:"table",file_id:n.id??"",title:wm(n),file_name:n.name,context_connector_info:n.context_connector_info}),HI=Ve(()=>Ue(()=>import("./i0420t4q4x9i8gsb.js"),__vite__mapDeps([108,1,2,3,77,32,14,4,5,27,28,9,10,6,20,36,13,74,37,78,79,34,35,33,38,26,23,29,30,80,81,44,82,48,15,19,102,76,58,17,18,25,59,60,61,62,63,31,103,22,104,16,7,8,11,12,24,89,105,88,106,98,107])).then(n=>n.default)),qI=Ve(()=>Ue(()=>import("./sso-ihqxdzxswuiox36n.js").then(n=>n.e),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100])).then(n=>n.CanmoreADAMessage).catch(()=>al)),KI=Ke.div`flex gap-2 flex-wrap mt-1 max-w-[80%] justify-end`,JI=Ke.div`flex flex-col gap-2`,YI=({parts:n,attachments:e,isUserTurn:t,clientThreadId:s})=>{const i=uo(),r=Ya(s),o=Wd(),a=Sp.getImageAssetPointersFromParts(n),l=new Set(a.map(x=>gi(x.asset_pointer))),u=mr()||i,f=(e??[]).filter(x=>km(x.name)),h=(e??[]).filter(x=>x.id==null||l.has(x.id)?!1:o||r?!f.includes(x):!0);return(o||r?(h.length>0||f.length>0)&&t:h.length>0&&t)?c.jsxs(c.Fragment,{children:[c.jsxs(KI,{children:[h.map(x=>c.jsx(Am,{file:x.name,fileId:x.id,contextConnectorInfo:Av(x.context_connector_info),width:i?"normal":"wide",alwaysShowData:!0},x.id)),r&&f.map(x=>c.jsx(qI,{clientThreadId:s,visualization:Nh(x)},x.id))]}),o&&!r&&c.jsx(JI,{className:J(!u&&"w-[80%]"),children:f.map(x=>c.jsx(HI,{clientThreadId:s,visualization:Nh(x)},x.id))})]}):null};function cx(n){return sd(n)&&!gy(n)}const Uo=50,XI=95;function QI(n,e){if(n<=e)return n/e*Uo;{const t=Uo,s=XI-Uo,i=n-e,o=-(Uo/e)/s;return t+s*(1-Math.exp(o*i))}}class ZI{constructor(){se(this,"mostRecentCompletionRequest");se(this,"loggedRequestIds",new Set)}onCompletionRequestStarted(e){this.mostRecentCompletionRequest={requestId:e,timestamp:Date.now()}}onDisplayTextAfterBrowsingSession(e,t){const s=this.mostRecentCompletionRequest;if(s!=null&&!this.loggedRequestIds.has(s.requestId)){const r=z.getThreadConversationTurns(e,t).find(o=>o.messages.some(a=>a.message.id===t));r!=null&&r.messages.some(o=>o.nodeId===s.requestId)&&(W.logEvent(G.browsingTimeToFirstTextToken,{messageId:t,timeMs:Date.now()-s.timestamp}),this.loggedRequestIds.add(s.requestId))}}}const dx=new ZI;function e9(n){var i;const e=n.find(r=>{var o;return((o=r.message.metadata)==null?void 0:o.image_search_results)!==void 0});return(((i=e==null?void 0:e.message.metadata)==null?void 0:i.image_search_results)??[]).slice(0,5)}function t9({messages:n}){const e=e9(n),t=gk();return e.length===0?null:c.jsx("div",{className:J({"mb-2":!0,"grid grid-flow-col gap-3":e.length>1,"w-1/3":e.length===1}),children:e.filter(({contentUrl:s})=>t.has(s)).map((s,i)=>c.jsx("a",{href:s.hostPageUrl,target:"_blank",rel:"noreferrer",children:c.jsx("img",{src:s.contentUrl,alt:s.name,className:"aspect-square rounded-xl object-cover"})},i))})}function n9({className:n,onLoad:e,fadeIn:t=!0,...s}){const[i,r]=k.useState(!1);function o(a){r(!0),e==null||e(a)}return c.jsx("img",{...s,alt:s.alt,onLoad:a=>o(a),className:J(n,t&&"transition-opacity duration-300",i?"opacity-100":"opacity-0")})}function Z5(n,e){const t=k.useContext(Ba),{isUnauthenticated:s}=Dt(),i=t==null?void 0:t.serverSharedThreadId;return xy({queries:n.map(r=>ll.makeQueryOptions({asset:r,sharedThreadId:i,gizmoId:e,isUnauthenticated:s}))})}function s9(n,e){const t=k.useContext(Ba),{isUnauthenticated:s}=Dt(),i=t==null?void 0:t.serverSharedThreadId;return Vs(ll.makeQueryOptions({asset:n,sharedThreadId:i,gizmoId:e,isUnauthenticated:s}))}async function e3(n,e,t,s){return await Promise.all(e.map(i=>ll.fetch(n,{asset:i,sharedThreadId:t,gizmoId:s}))).catch(i=>{const r=e.map(o=>gi(o.asset_pointer));throw et.addError(new Error(`Could not fetch files with IDs ${r} from file service`,{cause:i})),i})}function i9({asset:n,contextConnectorSourceUrl:e,isSingle:t,className:s}){const[i,r]=k.useState(!1),{gizmoEditorData:o}=gr(),a=mr(),l=ye(),{data:d,isLoading:u,error:f}=s9(n,o==null?void 0:o.id),{url:h,width:g,height:x}=d??{},y=u||!i,w=g&&x?{Landscape:g>x,Portrait:g<x,Square:g===x}:void 0,S=["overflow-hidden rounded-lg"];t&&(S.push("w-full h-full"),w!=null&&w.Landscape?S.push("max-w-96 max-h-64"):w!=null&&w.Portrait?S.push("max-h-96 max-w-64"):S.push("max-w-64 max-h-64")),s&&S.unshift(s);let _;return h!=null&&(_=c.jsx(n9,{alt:l.formatMessage(zo.imageAltText),className:J("max-w-full",!t&&"aspect-square","object-cover object-center",S),src:h,width:g,height:x,onLoad:()=>r(!0)}),a||(_=c.jsx(fS,{src:h,alt:l.formatMessage(zo.imageAltText),contextConnectorSourceUrl:e,className:J(S),children:_}))),c.jsx("div",{className:J(S),children:c.jsx("div",{className:J("relative flex h-auto w-full max-w-lg items-center justify-center overflow-hidden bg-token-main-surface-secondary text-token-text-tertiary",!t&&"aspect-square"),children:h!=null?_:c.jsx("div",{className:"flex items-center justify-center",style:{aspectRatio:`${g} / ${x}`,width:g},title:y?l.formatMessage(zo.loadingImage):l.formatMessage(zo.errorLoadingImage),children:y?c.jsx(Fa,{}):f?c.jsx(Jw,{className:"icon-sm"}):null})})})}const zo=Ce({loadingImage:{id:"textMessage.loadingImage",defaultMessage:"Loading..."},errorLoadingImage:{id:"textMessage.errorLoadingImage",defaultMessage:"Could not load image"},imageAltText:{id:"textMessage.imageAltText",defaultMessage:"Uploaded image"},targetedReply:{id:"textMessage.targetedReply",defaultMessage:"Replying to:"}});function yu({assets:n,attachments:e}){const t=n.length===1,{containerClassname:s,imageClassnames:i}=yu.computeClassnames(n.length);return c.jsx("div",{className:J("flex w-[70%] flex-row items-center justify-end gap-1",s),children:n.map((r,o)=>{var l;const a=e==null?void 0:e.find(d=>d.id&&r.asset_pointer.includes(d.id));return c.jsx(i9,{asset:r,isSingle:t,contextConnectorSourceUrl:(l=a==null?void 0:a.context_connector_info)==null?void 0:l.source_url,className:i[o]},o)})})}yu.computeClassnames=n=>{if(n<2)return{containerClassname:null,imageClassnames:[]};let e=n>=4?"flex-wrap":"";const t=Array(n),s=d=>{t.fill(d)},i=d=>{e+=` ${d}`},r=(d,u)=>{t[d]=J(t[d],u)},o=n<=4&&n%2===0?2:3,a=Math.ceil(n/o),l=n%o!==0;o===2?(s("h-32 w-32"),i("max-w-72")):a<=2?(s("h-24 w-24 sm:h-32 sm:w-32"),i("max-w-80 sm:max-w-100")):(s("h-16 w-16"),i("max-w-52"));for(let d=0;d<n;d++){const u=Math.floor(d/o),f=d%o,h=Math.min(n-u*o,o),g=u===0,x=u===a-1,y=u===a-2,w=f===0,S=f===h-1;g&&w&&r(d,"rounded-tl-2xl"),g&&S&&r(d,"rounded-tr-2xl"),x&&w&&r(d,"rounded-bl-2xl"),x&&S&&r(d,"rounded-br-sm"),l&&w&&y&&r(d,"rounded-bl-2xl")}return{containerClassname:e,imageClassnames:t}};function r9({onEnterEdit:n}){const t=ye().formatMessage({id:"gG9rea",defaultMessage:"Edit message"});return c.jsx("div",{className:"absolute bottom-0 right-full top-0 -mr-3.5 hidden pr-5 pt-1 [.group\\/conversation-turn:hover_&]:block",children:c.jsx(bs,{sideOffset:4,label:t,children:c.jsx("button",{"aria-label":t,className:"flex h-9 w-9 items-center justify-center rounded-full text-token-text-secondary transition hover:bg-token-main-surface-tertiary",onClick:n,children:c.jsx(Yw,{className:"icon-md"})})})})}function Kl({containsImagesOrAttachments:n,isUserTurn:e,showEditButton:t,onEnterEdit:s,children:i}){return c.jsxs("div",{className:J("relative max-w-[70%]",e&&"rounded-3xl bg-[#f4f4f4] px-5 py-2.5 dark:bg-token-main-surface-secondary",e&&n&&"rounded-tr-lg"),children:[i,t&&c.jsx(r9,{onEnterEdit:s})]})}const o9=Ve(()=>Ue(()=>import("./sso-ihqxdzxswuiox36n.js").then(n=>n.f),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100])).then(n=>n.default).catch(()=>al));function ux({attachments:n,citations:e,contentReferences:t,className:s,clientThreadId:i,displayParts:r,id:o,isActivelyStreaming:a,isUserTurn:l,turnIndex:d,isFeedbackEnabled:u,messages:f,onRequestMoreCompletions:h,parts:g,prevGroupedMessageType:x,prevGroupedMessages:y,showEditButton:w,onEnterEdit:S,size:_="medium"}){var $,B,U;const O=Ya(i),T=f.length>1,{flagSeverity:E,shouldHideContent:R}=wr(T?void 0:f[0]),F=!g.some(V=>V!==""),D=(($=La("2342431234"))==null?void 0:$.value)!==!0,I=((B=f[0].message.metadata)==null?void 0:B.targeted_reply_label)??((U=f[0].message.metadata)==null?void 0:U.targeted_reply);return k.useEffect(()=>{!F&&x===X.Browsing&&dx.onDisplayTextAfterBrowsingSession(i,f[0].message.id)},[F,f,i,x]),c.jsxs("div",{"data-message-author-role":f[0].message.author.role,"data-message-id":f[0].message.id,dir:"auto",className:J(s,"text-message flex w-full flex-col items-end gap-2 break-words [.text-message+&]:mt-5",!F&&"overflow-x-auto",D?"whitespace-pre-wrap":"whitespace-normal"),children:[I&&c.jsxs("div",{className:"mb-1 mt-1 flex items-start gap-1.5 text-sm font-normal text-token-text-tertiary",children:[c.jsx(Nd,{className:"icon-md mt-1 shrink-0"}),c.jsx("p",{className:"mr-5 line-clamp-3",children:I})]}),l&&O&&c.jsx(o9,{clientThreadId:i,messages:f}),c.jsx(xk,{messages:f}),c.jsx(a9,{parts:g,attachments:n,isUserTurn:l,turnIndex:d,displayParts:r,isActivelyStreaming:a,shouldHideContent:R,showEditButton:w,onEnterEdit:S,clientThreadId:i,id:o,isEmpty:F,prevGroupedMessageType:x,prevGroupedMessages:y,flagSeverity:E,messages:f,citations:e,contentReferences:t,size:_}),c.jsx(yI,{message:T?void 0:f[0],id:o,isFeedbackEnabled:u,onRequestMoreCompletions:h,clientThreadId:i,isUserTurn:l}),c.jsx(WI,{isUserTurn:l,message:T?void 0:f[0]}),!l&&!a&&y&&x===X.SearchResult&&c.jsx(t9,{messages:y})]})}function a9({clientThreadId:n,id:e,displayParts:t,turnIndex:s,isActivelyStreaming:i,shouldHideContent:r,showEditButton:o=!1,onEnterEdit:a,isEmpty:l,prevGroupedMessageType:d,prevGroupedMessages:u,messages:f,citations:h,contentReferences:g,size:x,isUserTurn:y,parts:w,attachments:S}){var U;const _=ye(),O=yk(t),T=Nm(),E=(U=f[0].message.metadata)==null?void 0:U.gizmo_id,R=bk(f[0].message),F=!!E&&T.includes(E),D=c.jsx(YI,{parts:w,attachments:S,isUserTurn:y,clientThreadId:n},"files-and-tables"),I=!!(S!=null&&S.length||t.some(V=>V.type==="images")),$=t.map((V,Y)=>{var te;if(V.type==="transcription"){const ne=r?null:V.text;let pe=null;return y&&r?pe=c.jsx("span",{className:"italic opacity-30",children:c.jsx(j,{...Vo.contentRemoved})}):y&&ne!=null?pe=ne.trim().length===0?c.jsx("span",{className:"italic opacity-30",children:c.jsx(To,{text:_.formatMessage(Vo.transcriptUnavailable)})}):c.jsx("span",{className:"italic opacity-50",children:c.jsx(To,{text:`“${ne.trim()}”`})}):!y&&ne!=null&&(pe=c.jsx(To,{text:ne})),c.jsx(Kl,{containsImagesOrAttachments:I,isUserTurn:y,showEditButton:o,onEnterEdit:a,children:pe},Y)}else if(V.type==="text"){const ne=r?null:V.text;if(!l&&!r&&!y){const pe=d===X.CodeInterpreter?u==null?void 0:u.map(Q=>Q.message):void 0,{text:H,contentReferences:L}=pS(O,h,g,F),{processedText:ue,displayedContentReferences:le}=rS(H,L,i?void 0:pe);return c.jsx(kk.Provider,{value:{clientThreadId:n,message:f[0].message,contentReferences:le,isActivelyStreaming:i,turnIndex:s,useSafeUrls:!0},children:c.jsx(qa,{clientThreadId:n,messageId:e,size:x,className:J(i&&"result-streaming",R&&"headers-v2"),children:ue===""?"&#8203;":ue})},Y)}else if(l&&i&&!y)return c.jsx("div",{className:"result-streaming",children:c.jsx("div",{children:c.jsx("pre",{})})},Y);return c.jsx(Kl,{containsImagesOrAttachments:I,isUserTurn:y,showEditButton:o,onEnterEdit:a,children:y&&r?c.jsx("span",{className:"italic opacity-30",children:c.jsx(j,{...Vo.contentRemoved})}):ne?c.jsx(To,{text:ne}):null},Y)}else if(V.type==="images"){const ne=((te=f[0].message.metadata)==null?void 0:te.attachments)??[];return c.jsx(yu,{assets:V.imageAssets,attachments:ne},Y)}else return null}),B=t.findIndex(V=>V.type==="text");if(B!==-1?$.splice(B,0,D):$.push(D),r&&y)$.length=0,$.push(c.jsx(Kl,{containsImagesOrAttachments:I,isUserTurn:y,onEnterEdit:vt,children:c.jsx("span",{className:"italic opacity-30",children:c.jsx(j,{...Vo.contentRemoved})})}));else if(r&&!y)return null;return c.jsx("div",{className:J("flex w-full flex-col gap-1 empty:hidden",y&&"items-end rtl:items-start",!y&&"first:pt-[3px]"),children:$})}const Vo=Ce({contentRemoved:{id:"textMessage.contentRemoved",defaultMessage:"Content removed"},transcriptUnavailable:{id:"textMessage.transcriptUnavailable",defaultMessage:"Transcript Unavailable"}});function l9(n){var d;const{isActivelyStreaming:e,...t}=n,s=ur(),i=(s==null?void 0:s.includes("debug"))??!1,r=n.messages[n.messages.length-1].message.id,[o,a]=k.useState([]),l=k.useRef();return l.current===void 0&&(l.current=(s==null?void 0:s.includes(yy))??!1?new oS(n.parts,a,e,void 0,{debug:i}):new aS(n.parts,a,e)),k.useEffect(()=>{l.current!=null&&(l.current.onMessagePartsUpdated(n.parts,e),l.current.isBuffering()&&Lr.addDelayedRenderingMessage(r))},[n.parts,r,e]),k.useEffect(()=>{l.current!=null&&!l.current.isBuffering()&&Lr.removeDelayedRenderingMessage(r)},[o,r]),k.useEffect(()=>()=>Lr.removeDelayedRenderingMessage(r),[r]),k.useEffect(()=>()=>{l.current!=null&&(l.current.destroy(),l.current=void 0)},[]),c.jsx(ux,{...t,displayParts:o,isActivelyStreaming:e||((d=l.current)==null?void 0:d.isBuffering())})}function c9({message:n,isCompletionInProgress:e,clientThreadId:t,className:s,isUserTurn:i,turnIndex:r,isFeedbackEnabled:o,prevGroupedMessageType:a,prevGroupedMessages:l,showEditButton:d,onEnterEdit:u,onRequestMoreCompletions:f}){var g,x,y;const h=k.useMemo(()=>"parts"in n.message.content?n.message.content.parts:[hr(n.message)],[n]);return c.jsx(u9,{parts:h,messages:[n],isCompletionInProgress:e,className:s,citations:(g=n.message.metadata)==null?void 0:g.citations,contentReferences:(x=n.message.metadata)==null?void 0:x.content_references,attachments:(y=n.message.metadata)==null?void 0:y.attachments,isUserTurn:i,turnIndex:r,id:n.nodeId,isFeedbackEnabled:o,onRequestMoreCompletions:f,clientThreadId:t,showEditButton:d,onEnterEdit:u,prevGroupedMessageType:a,prevGroupedMessages:l})}const d9=co.memo(c9);function u9(n){const e=n.messages.length>1,{flagSeverity:t}=wr(e?void 0:n.messages[0]),s=t!=="danger"&&n.isCompletionInProgress,i=!n.parts.some(o=>o!==""),[r]=k.useState(()=>!n.isUserTurn&&(n.isCompletionInProgress||i));return r?c.jsx(l9,{...n,isActivelyStreaming:s}):c.jsx(ux,{...n,displayParts:wk({isUserTurn:n.isUserTurn,parts:n.parts}),isActivelyStreaming:s})}const f9="5.7.5",h9=100,p9=0,m9=350,g9=24,x9=24,y9="Comp 1",b9=0,k9=[],w9=[{ddd:0,ind:1,ty:4,nm:"border",sr:1,ks:{o:{a:0,k:100,ix:2},r:{a:0,k:0,ix:2},p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2}},ao:0,hd:!1,shapes:[{ty:"gr",hd:!1,it:[{ty:"el",hd:!1,d:1,s:{a:0,k:[22,22],ix:2},p:{a:0,k:[0,0],ix:2}},{ty:"st",c:{a:0,k:[.203921568627451,.207843137254902,.2509803921568627],ix:2},o:{a:0,k:100,ix:2},w:{a:0,k:2,ix:2},hd:!1,lc:2,lj:2},{ty:"tm",s:{a:0,k:0,ix:2},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:2},m:1,hd:!1},{ty:"tr",hd:!1,p:{a:0,k:[12,12],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2},r:{a:0,k:-180,ix:2},o:{a:0,k:100,ix:2},sk:{a:0,k:0,ix:2},sa:{a:0,k:0,ix:2}}]}],ip:0,op:350,st:0,bm:0},{ddd:0,ind:2,ty:4,nm:"Path",sr:1,ks:{o:{a:0,k:100,ix:2},r:{a:0,k:0,ix:2},p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2}},ao:0,hd:!1,shapes:[{ty:"gr",hd:!1,it:[{ty:"sh",hd:!1,d:1,ks:{a:0,k:{c:!1,v:[[8.6485975,.1178352687211168],[8.880497499999999,1.074935268721117],[6.6505975,3.304865268721118],[6.6505975,6.016105268721118],[9.3617975,6.016105268721118],[11.5916975,3.786175268721117],[12.5487975,4.018115268721118],[11.1692975,8.727405268721117],[5.5576975,9.820205268721118],[3.272757499999999,12.10510526872112],[.561517499999999,12.10510526872112],[.561517499999999,9.393905268721117],[2.8464575,7.109005268721118],[3.9393075,1.497375268721117],[8.6485975,.1178352687211168],[8.6485975,.1178352687211168],[8.6485975,.1178352687211168]],i:[[0,0],[.3205000000000009,-.3204799999999999],[.7432999999999996,-.7433100000000001],[-.7487000000000013,-.7487000000000013],[-.7487000000000013,.7486999999999995],[-.7433000000000014,.743310000000001],[-.09659999999999869,-.4428200000000011],[1.278300000000002,-1.2783],[1.8610999999999986,.7885999999999989],[.7616466666666675,-.7616333333333323],[.7486899999999999,.7486999999999995],[-.7486899999999999,.7487000000000013],[-.7616466666666675,.7616333333333323],[-1.5171100000000006,1.5171199999999994],[-1.6442,-.3585899999999995],[0,0],[0,0]],o:[[.4428000000000001,.09658000000000033],[-.7432999999999996,.7433100000000001],[-.7487000000000013,.7486899999999999],[.7485999999999997,.7486999999999995],[.7432999999999996,-.743310000000001],[.3204999999999991,-.3204799999999999],[.3585999999999991,1.644189999999998],[-1.5170999999999992,1.5170999999999992],[-.7616466666666675,.761633333333334],[-.7486899999999999,.7486999999999995],[-.7486899999999999,-.7485999999999997],[.7616466666666666,-.7616333333333323],[-.7885500000000008,-1.8611],[1.278289999999998,-1.27829],[0,0],[0,0],[.4428000000000001,.09658000000000033]]}}},{ty:"fl",c:{a:0,k:[.6980392156862745,.3843137254901961,.996078431372549],ix:2},o:{a:0,k:100,ix:2},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tm",s:{a:0,k:0,ix:2},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:2},m:1,hd:!1},{ty:"tr",hd:!1,p:{a:1,k:[{t:0,s:[13.23,10.77154381752014],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:50,s:[12,12],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:100,s:[12,12],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:117,s:[12,12],i:{x:[.5],y:[1.5]},o:{x:[.8],y:[0]}},{t:227,s:[12,12],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:282,s:[13.23,10.77],i:{x:[1],y:[1]},o:{x:[0],y:[0]}}],ix:2},a:{a:1,k:[{t:0,s:[7.559483528137207,5.104858875274658],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:50,s:[7.559483528137207,5.104858875274658],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}}],ix:2},s:{a:1,k:[{t:0,s:[100,100],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:50,s:[121.15,121.15],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:60,s:[121.15,121.15],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:100,s:[121.15,121.15],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:117,s:[121.15,121.15],i:{x:[.5],y:[1.5]},o:{x:[.8],y:[0]}},{t:227,s:[121.15,121.15],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:282,s:[100,100],i:{x:[1],y:[1]},o:{x:[0],y:[0]}}],ix:2},r:{a:1,k:[{t:0,s:[0],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:50,s:[45],i:{x:[1],y:[1]},o:{x:[0],y:[0]}},{t:60,s:[45],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:100,s:[-45],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:117,s:[-45],i:{x:[.5],y:[1.5]},o:{x:[.8],y:[0]}},{t:167,s:[45],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:184,s:[45],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:217,s:[-45],i:{x:[1],y:[1]},o:{x:[0],y:[0]}},{t:227,s:[-45],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:282,s:[0],i:{x:[1],y:[1]},o:{x:[0],y:[0]}}],ix:2},o:{a:0,k:100,ix:2},sk:{a:1,k:[{t:0,s:[0],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:50,s:[0],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}}],ix:2},sa:{a:0,k:0,ix:2}}]}],ip:0,op:350,st:0,bm:0},{ddd:0,ind:3,ty:4,nm:"Circle",sr:1,ks:{o:{a:0,k:100,ix:2},r:{a:0,k:0,ix:2},p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2}},ao:0,hd:!1,shapes:[{ty:"gr",hd:!1,it:[{ty:"sh",hd:!1,d:1,ks:{a:0,k:{c:!1,v:[[0,-10],[10,0],[0,10],[-10,0],[0,-10]],i:[[-5.5228475,0],[0,-5.5228475],[5.5228475,0],[0,5.5228475],[-5.5228475,0]],o:[[5.5228475,0],[0,5.5228475],[-5.5228475,0],[0,-5.5228475],[5.5228475,0]]}}},{ty:"fl",c:{a:0,k:[.203921568627451,.207843137254902,.2509803921568627],ix:2},o:{a:0,k:100,ix:2},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tm",s:{a:0,k:0,ix:2},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:2},m:1,hd:!1},{ty:"tr",hd:!1,p:{a:0,k:[12,12],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2},r:{a:0,k:90,ix:2},o:{a:0,k:100,ix:2},sk:{a:0,k:0,ix:2},sa:{a:0,k:0,ix:2}}]}],ip:0,op:350,st:0,bm:0},{ddd:0,ind:4,ty:4,nm:"Circle",sr:1,ks:{o:{a:0,k:100,ix:2},r:{a:0,k:0,ix:2},p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2}},ao:0,hd:!1,shapes:[{ty:"gr",hd:!1,it:[{ty:"el",hd:!1,d:1,s:{a:0,k:[24,24],ix:2},p:{a:0,k:[0,0],ix:2}},{ty:"fl",c:{a:0,k:[.6980392156862745,.3843137254901961,.996078431372549],ix:2},o:{a:0,k:100,ix:2},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tm",s:{a:0,k:0,ix:2},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:2},m:1,hd:!1},{ty:"tr",hd:!1,p:{a:0,k:[12,12],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2},r:{a:0,k:-180,ix:2},o:{a:0,k:25,ix:2},sk:{a:0,k:0,ix:2},sa:{a:0,k:0,ix:2}}]}],ip:0,op:350,st:0,bm:0}],v9=[],S9={v:f9,fr:h9,ip:p9,op:m9,w:g9,h:x9,nm:y9,ddd:b9,assets:k9,layers:w9,markers:v9},C9="5.7.5",M9=100,T9=0,E9=400,_9=24,A9=24,N9="Comp 1",I9=0,R9=[],D9=[{ddd:0,ind:1,ty:3,nm:"",sr:1,ks:{o:{a:0,k:100,ix:2},r:{a:0,k:0,ix:2},p:{a:0,k:[12,12],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2}},ao:0,ip:0,op:400,st:0,bm:0,hd:!1},{ddd:0,ind:2,ty:4,nm:"Path's solid stroke",sr:1,ks:{o:{a:0,k:100,ix:2},r:{a:0,k:0,ix:2},p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2}},ao:0,hd:!1,parent:1,shapes:[{ty:"gr",hd:!1,it:[{ty:"sh",hd:!1,d:1,ks:{a:1,k:[{t:125,s:[{c:!1,v:[[3.5,0],[0,5.8332999999999995],[3.5,5.8332999999999995]],i:[[0,0],[1.166666666666667,-1.944433333333334],[-1.166666666666667,0]],o:[[-1.166666666666666,1.944433333333333],[1.166666666666666,0],[0,0]]}],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:200,s:[{c:!1,v:[[5.836999893188477,0],[9.336999893188477,5.83329963684082],[5.9886474609375,5.83329963684082]],i:[[-1.184650421142578,-1.832367897033691],[0,0],[-1.166666666666667,0]],o:[[1.184650897979736,1.832367539405823],[0,0],[0,0]]}],i:{x:[1],y:[1]},o:{x:[0],y:[0]}},{t:325,s:[{c:!1,v:[[5.836999893188477,0],[9.336999893188477,5.83329963684082],[5.9886474609375,5.83329963684082]],i:[[-1.184650421142578,-1.832367897033691],[0,0],[-1.166666666666667,0]],o:[[1.184650897979736,1.832367539405823],[0,0],[0,0]]}],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:400,s:[{c:!1,v:[[3.503000259399414,0],[.003000259399414062,5.83329963684082],[3.503000259399414,5.83329963684082]],i:[[.2074432373046875,-.3626899719238281],[0,0],[-1.166666666666667,0]],o:[[-.2074427604675293,.3626899123191833],[0,0],[0,0]]}],i:{x:[1],y:[1]},o:{x:[0],y:[0]}}],ix:2}},{ty:"st",c:{a:0,k:[.6941176470588235,.3803921568627451,.9921568627450981],ix:2},o:{a:0,k:100,ix:2},w:{a:0,k:2.33333,ix:2},hd:!1,lc:2,lj:2},{ty:"tm",s:{a:0,k:0,ix:2},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:2},m:1,hd:!1},{ty:"tr",hd:!1,p:{a:1,k:[{t:125,s:[-4.666999816894531,-4.666650772094727],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:200,s:[-4.67,-4.666650772094727],i:{x:[1],y:[1]},o:{x:[0],y:[0]}},{t:325,s:[-4.67,-4.666650772094727],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}}],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2},r:{a:0,k:0,ix:2},o:{a:0,k:100,ix:2},sk:{a:0,k:0,ix:2},sa:{a:0,k:0,ix:2}}]}],ip:0,op:400,st:0,bm:0},{ddd:0,ind:3,ty:4,nm:"Path's solid stroke",sr:1,ks:{o:{a:0,k:100,ix:2},r:{a:0,k:0,ix:2},p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2}},ao:0,hd:!1,parent:1,shapes:[{ty:"gr",hd:!1,it:[{ty:"sh",hd:!1,d:1,ks:{a:1,k:[{t:125,s:[{c:!1,v:[[0,2.3332999999999995],[3.5,0]],i:[[0,0],[-.7981999999999996,1.4169]],o:[[1.4311000000000007,0],[0,0]]}],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:200,s:[{c:!1,v:[[-2.333999633789062,2.333300590515137],[-5.833999633789062,0]],i:[[1.169005393981934,0],[.7811636924743652,1.481373190879822]],o:[[-1.169005155563354,0],[-.7811641693115234,-1.481372833251953]]}],i:{x:[1],y:[1]},o:{x:[0],y:[0]}},{t:325,s:[{c:!1,v:[[-2.333999633789062,2.333300590515137],[-5.833999633789062,0]],i:[[1.169005393981934,0],[.7811636924743652,1.481373190879822]],o:[[-1.169005155563354,0],[-.7811641693115234,-1.481372833251953]]}],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:400,s:[{c:!1,v:[[-.003000259399414062,2.333300590515137],[3.496999740600586,0]],i:[[-1.720494270324707,0],[-.6510887145996094,1.120759010314941]],o:[[1.720494627952576,0],[.6510882377624512,-1.120759010314941]]}],i:{x:[1],y:[1]},o:{x:[0],y:[0]}}],ix:2}},{ty:"st",c:{a:0,k:[.6941176470588235,.3803921568627451,.9921568627450981],ix:2},o:{a:0,k:100,ix:2},w:{a:0,k:2.33333,ix:2},hd:!1,lc:2,lj:2},{ty:"tm",s:{a:0,k:0,ix:2},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:2},m:1,hd:!1},{ty:"tr",hd:!1,p:{a:1,k:[{t:200,s:[1.166999816894531,2.33335018157959],i:{x:[1],y:[1]},o:{x:[0],y:[0]}},{t:325,s:[1.17,2.33335018157959],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}}],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2},r:{a:0,k:0,ix:2},o:{a:0,k:100,ix:2},sk:{a:0,k:0,ix:2},sa:{a:0,k:0,ix:2}}]}],ip:0,op:400,st:0,bm:0},{ddd:0,ind:4,ty:4,nm:"border",sr:1,ks:{o:{a:0,k:100,ix:2},r:{a:0,k:0,ix:2},p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2}},ao:0,hd:!1,shapes:[{ty:"gr",hd:!1,it:[{ty:"el",hd:!1,d:1,s:{a:0,k:[22,22],ix:2},p:{a:0,k:[0,0],ix:2}},{ty:"st",c:{a:0,k:[.203921568627451,.207843137254902,.2509803921568627],ix:2},o:{a:0,k:100,ix:2},w:{a:0,k:2,ix:2},hd:!1,lc:2,lj:2},{ty:"tm",s:{a:0,k:0,ix:2},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:2},m:1,hd:!1},{ty:"tr",hd:!1,p:{a:0,k:[12,12],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2},r:{a:0,k:-180,ix:2},o:{a:0,k:100,ix:2},sk:{a:0,k:0,ix:2},sa:{a:0,k:0,ix:2}}]}],ip:0,op:400,st:0,bm:0}],j9=[],P9={v:C9,fr:M9,ip:T9,op:E9,w:_9,h:A9,nm:N9,ddd:I9,assets:R9,layers:D9,markers:j9},O9="5.7.5",F9=100,L9=0,B9=400,U9=24,z9=24,V9="Comp 1",G9=0,$9=[],W9=[{ddd:0,ind:1,ty:3,nm:"",sr:1,ks:{o:{a:0,k:100,ix:2},r:{a:0,k:0,ix:2},p:{a:0,k:[12,12],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2}},ao:0,ip:0,op:400,st:0,bm:0,hd:!1},{ddd:0,ind:2,ty:4,nm:"Path's solid stroke",sr:1,ks:{o:{a:0,k:100,ix:2},r:{a:0,k:0,ix:2},p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2}},ao:0,hd:!1,parent:1,shapes:[{ty:"gr",hd:!1,it:[{ty:"sh",hd:!1,d:1,ks:{a:1,k:[{t:125,s:[{c:!1,v:[[3.5,0],[0,5.8332999999999995],[3.5,5.8332999999999995]],i:[[0,0],[1.166666666666667,-1.9444333333333343],[-1.166666666666667,0]],o:[[-1.166666666666666,1.9444333333333326],[1.166666666666666,0],[0,0]]}],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:200,s:[{c:!1,v:[[5.836999893188477,0],[9.336999893188477,5.83329963684082],[5.9886474609375,5.83329963684082]],i:[[-1.1846504211425781,-1.8323678970336914],[0,0],[-1.166666666666667,0]],o:[[1.1846508979797363,1.8323675394058228],[0,0],[0,0]]}],i:{x:[1],y:[1]},o:{x:[0],y:[0]}},{t:325,s:[{c:!1,v:[[5.836999893188477,0],[9.336999893188477,5.83329963684082],[5.9886474609375,5.83329963684082]],i:[[-1.1846504211425781,-1.8323678970336914],[0,0],[-1.166666666666667,0]],o:[[1.1846508979797363,1.8323675394058228],[0,0],[0,0]]}],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:400,s:[{c:!1,v:[[3.503000259399414,0],[.0030002593994140625,5.83329963684082],[3.503000259399414,5.83329963684082]],i:[[.2074432373046875,-.3626899719238281],[0,0],[-1.166666666666667,0]],o:[[-.2074427604675293,.36268991231918335],[0,0],[0,0]]}],i:{x:[1],y:[1]},o:{x:[0],y:[0]}}],ix:2}},{ty:"st",c:{a:0,k:[.6941176470588235,.3803921568627451,.9921568627450981],ix:2},o:{a:0,k:100,ix:2},w:{a:0,k:2.33333,ix:2},hd:!1,lc:2,lj:2},{ty:"tm",s:{a:0,k:0,ix:2},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:2},m:1,hd:!1},{ty:"tr",hd:!1,p:{a:1,k:[{t:125,s:[-4.666999816894531,-4.666650772094727],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:200,s:[-4.67,-4.666650772094727],i:{x:[1],y:[1]},o:{x:[0],y:[0]}},{t:325,s:[-4.67,-4.666650772094727],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}}],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2},r:{a:0,k:0,ix:2},o:{a:0,k:100,ix:2},sk:{a:0,k:0,ix:2},sa:{a:0,k:0,ix:2}}]}],ip:0,op:400,st:0,bm:0},{ddd:0,ind:3,ty:4,nm:"Path's solid stroke",sr:1,ks:{o:{a:0,k:100,ix:2},r:{a:0,k:0,ix:2},p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2}},ao:0,hd:!1,parent:1,shapes:[{ty:"gr",hd:!1,it:[{ty:"sh",hd:!1,d:1,ks:{a:1,k:[{t:125,s:[{c:!1,v:[[0,2.3332999999999995],[3.5,0]],i:[[0,0],[-.7981999999999996,1.4169]],o:[[1.4311000000000007,0],[0,0]]}],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:200,s:[{c:!1,v:[[-2.3339996337890625,2.3333005905151367],[-5.8339996337890625,0]],i:[[1.1690053939819336,0],[.7811636924743652,1.4813731908798218]],o:[[-1.1690051555633545,0],[-.7811641693115234,-1.4813728332519531]]}],i:{x:[1],y:[1]},o:{x:[0],y:[0]}},{t:325,s:[{c:!1,v:[[-2.3339996337890625,2.3333005905151367],[-5.8339996337890625,0]],i:[[1.1690053939819336,0],[.7811636924743652,1.4813731908798218]],o:[[-1.1690051555633545,0],[-.7811641693115234,-1.4813728332519531]]}],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:400,s:[{c:!1,v:[[-.0030002593994140625,2.3333005905151367],[3.496999740600586,0]],i:[[-1.720494270324707,0],[-.6510887145996094,1.1207590103149414]],o:[[1.7204946279525757,0],[.6510882377624512,-1.1207590103149414]]}],i:{x:[1],y:[1]},o:{x:[0],y:[0]}}],ix:2}},{ty:"st",c:{a:0,k:[.6941176470588235,.3803921568627451,.9921568627450981],ix:2},o:{a:0,k:100,ix:2},w:{a:0,k:2.33333,ix:2},hd:!1,lc:2,lj:2},{ty:"tm",s:{a:0,k:0,ix:2},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:2},m:1,hd:!1},{ty:"tr",hd:!1,p:{a:1,k:[{t:200,s:[1.1669998168945312,2.33335018157959],i:{x:[1],y:[1]},o:{x:[0],y:[0]}},{t:325,s:[1.17,2.33335018157959],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}}],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2},r:{a:0,k:0,ix:2},o:{a:0,k:100,ix:2},sk:{a:0,k:0,ix:2},sa:{a:0,k:0,ix:2}}]}],ip:0,op:400,st:0,bm:0},{ddd:0,ind:4,ty:4,nm:"border",sr:1,ks:{o:{a:0,k:100,ix:2},r:{a:0,k:0,ix:2},p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2}},ao:0,hd:!1,shapes:[{ty:"gr",hd:!1,it:[{ty:"el",hd:!1,d:1,s:{a:0,k:[22,22],ix:2},p:{a:0,k:[0,0],ix:2}},{ty:"st",c:{a:0,k:[1,1,1],ix:2},o:{a:0,k:100,ix:2},w:{a:0,k:2,ix:2},hd:!1,lc:2,lj:2},{ty:"tm",s:{a:0,k:0,ix:2},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:2},m:1,hd:!1},{ty:"tr",hd:!1,p:{a:0,k:[12,12],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2},r:{a:0,k:-180,ix:2},o:{a:0,k:100,ix:2},sk:{a:0,k:0,ix:2},sa:{a:0,k:0,ix:2}}]}],ip:0,op:400,st:0,bm:0}],H9=[],q9={v:O9,fr:F9,ip:L9,op:B9,w:U9,h:z9,nm:V9,ddd:G9,assets:$9,layers:W9,markers:H9},K9="5.7.5",J9=100,Y9=0,X9=350,Q9=24,Z9=24,eR="Comp 1",tR=0,nR=[],sR=[{ddd:0,ind:1,ty:4,nm:"border",sr:1,ks:{o:{a:0,k:100,ix:2},r:{a:0,k:0,ix:2},p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2}},ao:0,hd:!1,shapes:[{ty:"gr",hd:!1,it:[{ty:"el",hd:!1,d:1,s:{a:0,k:[22,22],ix:2},p:{a:0,k:[0,0],ix:2}},{ty:"st",c:{a:0,k:[1,1,1],ix:2},o:{a:0,k:100,ix:2},w:{a:0,k:2,ix:2},hd:!1,lc:2,lj:2},{ty:"tm",s:{a:0,k:0,ix:2},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:2},m:1,hd:!1},{ty:"tr",hd:!1,p:{a:0,k:[12,12],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2},r:{a:0,k:-180,ix:2},o:{a:0,k:100,ix:2},sk:{a:0,k:0,ix:2},sa:{a:0,k:0,ix:2}}]}],ip:0,op:350,st:0,bm:0},{ddd:0,ind:2,ty:4,nm:"Path",sr:1,ks:{o:{a:0,k:100,ix:2},r:{a:0,k:0,ix:2},p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2}},ao:0,hd:!1,shapes:[{ty:"gr",hd:!1,it:[{ty:"sh",hd:!1,d:1,ks:{a:0,k:{c:!1,v:[[8.6485975,.1178352687211168],[8.880497499999999,1.074935268721117],[6.6505975,3.304865268721118],[6.6505975,6.016105268721118],[9.3617975,6.016105268721118],[11.5916975,3.786175268721117],[12.5487975,4.018115268721118],[11.1692975,8.727405268721117],[5.5576975,9.820205268721118],[3.272757499999999,12.10510526872112],[.561517499999999,12.10510526872112],[.561517499999999,9.393905268721117],[2.8464575,7.109005268721118],[3.9393075,1.497375268721117],[8.6485975,.1178352687211168],[8.6485975,.1178352687211168],[8.6485975,.1178352687211168]],i:[[0,0],[.3205000000000009,-.3204799999999999],[.7432999999999996,-.7433100000000001],[-.7487000000000013,-.7487000000000013],[-.7487000000000013,.7486999999999995],[-.7433000000000014,.743310000000001],[-.09659999999999869,-.4428200000000011],[1.278300000000002,-1.2783],[1.8610999999999986,.7885999999999989],[.7616466666666675,-.7616333333333323],[.7486899999999999,.7486999999999995],[-.7486899999999999,.7487000000000013],[-.7616466666666675,.7616333333333323],[-1.5171100000000006,1.5171199999999994],[-1.6442,-.3585899999999995],[0,0],[0,0]],o:[[.4428000000000001,.09658000000000033],[-.7432999999999996,.7433100000000001],[-.7487000000000013,.7486899999999999],[.7485999999999997,.7486999999999995],[.7432999999999996,-.743310000000001],[.3204999999999991,-.3204799999999999],[.3585999999999991,1.644189999999998],[-1.5170999999999992,1.5170999999999992],[-.7616466666666675,.761633333333334],[-.7486899999999999,.7486999999999995],[-.7486899999999999,-.7485999999999997],[.7616466666666666,-.7616333333333323],[-.7885500000000008,-1.8611],[1.278289999999998,-1.27829],[0,0],[0,0],[.4428000000000001,.09658000000000033]]}}},{ty:"fl",c:{a:0,k:[.6980392156862745,.3843137254901961,.996078431372549],ix:2},o:{a:0,k:100,ix:2},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tm",s:{a:0,k:0,ix:2},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:2},m:1,hd:!1},{ty:"tr",hd:!1,p:{a:1,k:[{t:0,s:[13.23,10.77154381752014],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:50,s:[12,12],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:100,s:[12,12],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:117,s:[12,12],i:{x:[.5],y:[1.5]},o:{x:[.8],y:[0]}},{t:227,s:[12,12],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:282,s:[13.23,10.77],i:{x:[1],y:[1]},o:{x:[0],y:[0]}}],ix:2},a:{a:1,k:[{t:0,s:[7.559483528137207,5.104858875274658],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:50,s:[7.559483528137207,5.104858875274658],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}}],ix:2},s:{a:1,k:[{t:0,s:[100,100],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:50,s:[121.15,121.15],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:60,s:[121.15,121.15],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:100,s:[121.15,121.15],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:117,s:[121.15,121.15],i:{x:[.5],y:[1.5]},o:{x:[.8],y:[0]}},{t:227,s:[121.15,121.15],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:282,s:[100,100],i:{x:[1],y:[1]},o:{x:[0],y:[0]}}],ix:2},r:{a:1,k:[{t:0,s:[0],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:50,s:[45],i:{x:[1],y:[1]},o:{x:[0],y:[0]}},{t:60,s:[45],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:100,s:[-45],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:117,s:[-45],i:{x:[.5],y:[1.5]},o:{x:[.8],y:[0]}},{t:167,s:[45],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:184,s:[45],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:217,s:[-45],i:{x:[1],y:[1]},o:{x:[0],y:[0]}},{t:227,s:[-45],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:282,s:[0],i:{x:[1],y:[1]},o:{x:[0],y:[0]}}],ix:2},o:{a:0,k:100,ix:2},sk:{a:1,k:[{t:0,s:[0],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}},{t:50,s:[0],i:{x:[.2],y:[1]},o:{x:[.5],y:[-.5]}}],ix:2},sa:{a:0,k:0,ix:2}}]}],ip:0,op:350,st:0,bm:0},{ddd:0,ind:3,ty:4,nm:"Circle",sr:1,ks:{o:{a:0,k:100,ix:2},r:{a:0,k:0,ix:2},p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2}},ao:0,hd:!1,shapes:[{ty:"gr",hd:!1,it:[{ty:"sh",hd:!1,d:1,ks:{a:0,k:{c:!1,v:[[0,-10],[10,0],[0,10],[-10,0],[0,-10]],i:[[-5.5228475,0],[0,-5.5228475],[5.5228475,0],[0,5.5228475],[-5.5228475,0]],o:[[5.5228475,0],[0,5.5228475],[-5.5228475,0],[0,-5.5228475],[5.5228475,0]]}}},{ty:"fl",c:{a:0,k:[1,1,1],ix:2},o:{a:0,k:100,ix:2},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tm",s:{a:0,k:0,ix:2},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:2},m:1,hd:!1},{ty:"tr",hd:!1,p:{a:0,k:[12,12],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2},r:{a:0,k:90,ix:2},o:{a:0,k:100,ix:2},sk:{a:0,k:0,ix:2},sa:{a:0,k:0,ix:2}}]}],ip:0,op:350,st:0,bm:0},{ddd:0,ind:4,ty:4,nm:"Circle",sr:1,ks:{o:{a:0,k:100,ix:2},r:{a:0,k:0,ix:2},p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2}},ao:0,hd:!1,shapes:[{ty:"gr",hd:!1,it:[{ty:"el",hd:!1,d:1,s:{a:0,k:[24,24],ix:2},p:{a:0,k:[0,0],ix:2}},{ty:"fl",c:{a:0,k:[.6941176470588235,.3803921568627451,.9921568627450981],ix:2},o:{a:0,k:100,ix:2},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tm",s:{a:0,k:0,ix:2},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:2},m:1,hd:!1},{ty:"tr",hd:!1,p:{a:0,k:[12,12],ix:2},a:{a:0,k:[0,0],ix:2},s:{a:0,k:[100,100],ix:2},r:{a:0,k:-180,ix:2},o:{a:0,k:25,ix:2},sk:{a:0,k:0,ix:2},sa:{a:0,k:0,ix:2}}]}],ip:0,op:350,st:0,bm:0}],iR=[],rR={v:K9,fr:J9,ip:Y9,op:X9,w:Q9,h:Z9,nm:eR,ddd:tR,assets:nR,layers:sR,markers:iR},oR=Ve(()=>Ue(()=>import("./e1mzt3krac2ynvw2.js"),__vite__mapDeps([109,1,2,3])));function fx({animationData:n,animationSegmentToPlay:e,animationLoopCounter:t}){const s=k.useRef(null);return k.useEffect(()=>{var i;(i=s.current)==null||i.playSegments(e,!0)},[t]),c.jsx(oR,{animationData:n,lottieRef:s,loop:!1,autoplay:!1})}function aR(n){return c.jsx(Un,{width:"8",height:"9",viewBox:"0 0 8 9",fill:"none",...n,children:c.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.66607 0.376042C8.01072 0.605806 8.10385 1.07146 7.87408 1.4161L3.54075 7.9161C3.40573 8.11863 3.18083 8.24304 2.93752 8.24979C2.69421 8.25654 2.46275 8.1448 2.31671 7.95008L0.150044 5.06119C-0.098484 4.72982 -0.0313267 4.25972 0.300044 4.01119C0.631415 3.76266 1.10152 3.82982 1.35004 4.16119L2.88068 6.20204L6.62601 0.584055C6.85577 0.239408 7.32142 0.146278 7.66607 0.376042Z",fill:"currentColor"})})}function lR(n){return c.jsxs(Un,{width:"4",height:"12",viewBox:"0 0 4 12",fill:"none",...n,children:[c.jsx("mask",{id:"path-1-inside-1_1975_4008",fill:"currentColor",children:c.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1 6.5C1 7.05228 1.44772 7.5 2 7.5C2.55228 7.5 3 7.05228 3 6.5V1.5C3 0.947715 2.55228 0.5 2 0.5C1.44772 0.5 1 0.947715 1 1.5L1 6.5ZM0.75 10.25C0.75 10.9404 1.30964 11.5 2 11.5C2.69036 11.5 3.25 10.9404 3.25 10.25C3.25 9.55964 2.69036 9 2 9C1.30964 9 0.75 9.55964 0.75 10.25Z"})}),c.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1 6.5C1 7.05228 1.44772 7.5 2 7.5C2.55228 7.5 3 7.05228 3 6.5V1.5C3 0.947715 2.55228 0.5 2 0.5C1.44772 0.5 1 0.947715 1 1.5L1 6.5ZM0.75 10.25C0.75 10.9404 1.30964 11.5 2 11.5C2.69036 11.5 3.25 10.9404 3.25 10.25C3.25 9.55964 2.69036 9 2 9C1.30964 9 0.75 9.55964 0.75 10.25Z",fill:"currentColor"}),c.jsx("path",{d:"M1 6.5H-0.25H1ZM1 1.5L-0.25 1.5L-0.25 1.5L1 1.5ZM2 6.25C2.13807 6.25 2.25 6.36193 2.25 6.5H-0.25C-0.25 7.74264 0.757359 8.75 2 8.75V6.25ZM1.75 6.5C1.75 6.36193 1.86193 6.25 2 6.25V8.75C3.24264 8.75 4.25 7.74264 4.25 6.5H1.75ZM1.75 1.5V6.5H4.25V1.5H1.75ZM2 1.75C1.86193 1.75 1.75 1.63807 1.75 1.5H4.25C4.25 0.257359 3.24264 -0.75 2 -0.75V1.75ZM2.25 1.5C2.25 1.63807 2.13807 1.75 2 1.75V-0.75C0.757359 -0.75 -0.25 0.257359 -0.25 1.5L2.25 1.5ZM2.25 6.5L2.25 1.5L-0.25 1.5L-0.25 6.5L2.25 6.5ZM2 10.25H-0.5C-0.5 11.6307 0.619288 12.75 2 12.75V10.25ZM2 10.25V12.75C3.38071 12.75 4.5 11.6307 4.5 10.25H2ZM2 10.25H2H4.5C4.5 8.86929 3.38071 7.75 2 7.75V10.25ZM2 10.25H2V7.75C0.619288 7.75 -0.5 8.86929 -0.5 10.25H2Z",fill:"currentColor",mask:"url(#path-1-inside-1_1975_4008)"})]})}function cR(n){return c.jsx(Un,{width:"8",height:"9",viewBox:"0 0 8 9",fill:"none",...n,children:c.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.32256 1.48447C7.59011 1.16827 7.55068 0.695034 7.23447 0.427476C6.91827 0.159918 6.44503 0.199354 6.17748 0.515559L4.00002 3.08892L1.82256 0.515559C1.555 0.199354 1.08176 0.159918 0.765559 0.427476C0.449355 0.695034 0.409918 1.16827 0.677476 1.48447L3.01755 4.25002L0.677476 7.01556C0.409918 7.33176 0.449354 7.805 0.765559 8.07256C1.08176 8.34011 1.555 8.30068 1.82256 7.98447L4.00002 5.41111L6.17748 7.98447C6.44503 8.30068 6.91827 8.34011 7.23447 8.07256C7.55068 7.805 7.59011 7.33176 7.32256 7.01556L4.98248 4.25002L7.32256 1.48447Z",fill:"currentColor"})})}function t3({animationLoopCounter:n}){const{resolvedTheme:e}=Cp(),t=e==="dark";return c.jsx(fx,{animationData:t?S9:rR,animationSegmentToPlay:[0,300],animationLoopCounter:n})}function n3({animationLoopCounter:n}){const{resolvedTheme:e}=Cp(),t=e==="dark";return c.jsx(fx,{animationData:t?P9:q9,animationSegmentToPlay:[0,400],animationLoopCounter:n})}const dR=2e3,hx=.4,uR=.45,fR=.2,hR=.1,pR=.25;var On=(n=>(n[n.Running=0]="Running",n[n.Finished=1]="Finished",n[n.Error=2]="Error",n[n.Stopped=3]="Stopped",n[n.Paused=4]="Paused",n))(On||{});function s3({conversationMessages:n,icon:e,status:t,text:s,estimatedToolDurationMs:i,animationLoopDurationMs:r=dR,shouldPersistAfterFinished:o=!1}){const[a,l]=k.useState(t===0?0:t===1&&!o?7:1),[d,u]=k.useState(0);k.useEffect(()=>{t===2?l(8):t===3?l(9):t===4?l(10):t===1?l(a===2?3:7):t===0&&a===10&&(l(2),u(h=>h+1))},[t]);const f=xR(a);return k.useEffect(()=>{const h=n[0].message.id;if(f)return Lr.addDelayedRenderingMessage(h),()=>{Lr.removeDelayedRenderingMessage(h)}},[f]),Jp(()=>{Ji(a)&&u(h=>h+1)},r),a===7&&!o?null:c.jsxs("div",{className:"my-2.5 flex items-center gap-2.5",children:[c.jsx(mR,{icon:e,status:t,uiState:a,estimatedToolDurationMs:i,animationLoopCounter:d,shouldPersistAfterFinished:o,onFillProgressBarAnimationComplete:()=>l(4),onFinishAnimationComplete:()=>{l(5),setTimeout(()=>{l(o?7:6)},hR*1e3)},onHideAnimationComplete:()=>l(7)}),c.jsx(gR,{text:s,uiState:a,animationLoopCounter:d,onEnterAnimationComplete:()=>l(2)})]})}const Ih=50;function mR({icon:n,status:e,uiState:t,estimatedToolDurationMs:s,animationLoopCounter:i,shouldPersistAfterFinished:r,onFillProgressBarAnimationComplete:o,onFinishAnimationComplete:a,onHideAnimationComplete:l}){const[d,u]=k.useState(0);Jp(()=>{Ji(t)?u(_=>_+Ih):t===10&&u(0)},Ih);let f,h,g;Ji(t)||t===10?(f="running",h=c.jsx(n,{animationLoopCounter:i}),g="bg-transparent"):t===4||t===5||t===7&&r?(f="finished",h=c.jsx(aR,{}),g="bg-brand-purple"):e===2?(f="error",h=c.jsx(lR,{}),g="bg-orange-500"):e===3&&(f="stopped",h=c.jsx(cR,{}),g="bg-gray-300");let x={opacity:0,scale:0,rotate:-180,x:0},y={type:"spring",bounce:.3,duration:uR},w={opacity:0,scale:.6,rotate:0,x:0};t===0?(x={opacity:0,scale:.5,rotate:-180,x:-8},y={type:"spring",bounce:.3,duration:hx}):t===1?x=!1:t===5&&(w={opacity:0,scale:0,rotate:0,x:0},y={type:"spring",bounce:.3,duration:pR});const S=QI(d,s);return c.jsx("div",{className:"relative h-5 w-5 shrink-0",children:c.jsx(yi,{onExitComplete:()=>{t===6&&l()},children:f!=null&&c.jsxs(yt.div,{className:J("absolute left-0 top-0 flex h-full w-full items-center justify-center rounded-full text-white",g),initial:x,animate:{opacity:1,scale:1,rotate:0,x:0},exit:w,transition:y,onAnimationComplete:()=>{t===4&&a()},children:[h,(Ji(t)||t===10)&&c.jsx(vk,{percentage:t===3?100:S,thickness:1.5/23,className:"absolute left-1/2 top-1/2 h-[23px] w-[23px] -translate-x-1/2 -translate-y-1/2 text-brand-purple",backgroundStrokeClassName:"stroke-brand-purple/25 dark:stroke-brand-purple/50",transitionDuration:t===3?`${(100-S)/100*fR}s`:void 0,transitionTimingFunction:t===3?"cubic-bezier(0.55, 0, 1, 1)":void 0,onTransitionEnd:()=>{t===3&&o()}})]},f)})})}function gR({text:n,uiState:e,animationLoopCounter:t,onEnterAnimationComplete:s}){const[i,r]=k.useState(n);k.useEffect(()=>{e===2&&r(n)},[t]),k.useEffect(()=>{Ji(e)||r(n)},[e,n]);let o={opacity:0,x:0,y:15},a={type:"spring",bounce:.3,opacity:{duration:.15},y:{duration:.3}};e===0?(o={opacity:0,x:-8,y:0},a={type:"spring",bounce:.3,duration:hx,delay:.15}):e===1&&(o=!1);const l=i??void 0;return c.jsx("div",{className:J("relative h-5 w-full leading-5",e===8||e===9?"text-token-text-tertiary":"text-token-text-secondary"),children:c.jsx(yi,{children:l!=null&&c.jsx(yt.div,{className:"absolute left-0 top-0 line-clamp-1 overflow-visible",initial:o,animate:{opacity:1,x:0,y:0},exit:{opacity:0,x:0,y:-15},transition:a,onAnimationComplete:()=>{e===0&&s()},children:l},l.toString())})})}function Ji(n){return n===0||n===2||n===3}function xR(n){return Ji(n)||n===4||n===5||n===6||n===10}function px({highlightedCommand:n,status:e,children:t,showWorkUserSetting:s=!1,hideOnlyIfNotInteractedWith:i=!1}){const r=t!=null,[o]=k.useState(s),[a,l]=k.useState(s),[d,u]=k.useState(!1);return(e===On.Finished||e===On.Error)&&(i?o?!1:!d:!1)?null:r?c.jsxs(c.Fragment,{children:[c.jsx(Rh,{$canShowWork:!0,children:c.jsx(yi,{children:c.jsx(yt.button,{onClick:()=>{l(g=>!g),u(!0)},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:J(e===On.Running&&"loading-shimmer","group absolute left-0 top-0 mr-1.5 h-8 overflow-hidden"),children:c.jsxs("div",{className:"flex items-center justify-start gap-1",children:[c.jsx("span",{children:n}),a?c.jsx(xm,{className:"icon-md group-hover:visible md:invisible"}):c.jsx(mo,{className:"icon-md group-hover:visible md:invisible"})]})},n==null?void 0:n.toString())})}),c.jsx(yi,{children:a&&t&&c.jsx(yt.div,{initial:"collapsed",animate:"reveal",exit:"collapsed",variants:{collapsed:{translateY:-20,opacity:0,height:0},reveal:{translateY:0,opacity:1,height:"auto"}},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:t})})]}):c.jsx(Rh,{$canShowWork:!1,children:n})}const Rh=Ke.p`first:mt-0 my-1.5 relative h-8
${({$canShowWork:n})=>n?"text-token-text-secondary hover:text-token-text-primary":"text-token-text-secondary"}`,yR=Ve(()=>Ue(()=>import("./sso-ihqxdzxswuiox36n.js").then(n=>n.e),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100])).then(n=>n.CanmoreADAMessage).catch(()=>al)),Dh=Ve(()=>Ue(()=>import("./i0420t4q4x9i8gsb.js"),__vite__mapDeps([108,1,2,3,77,32,14,4,5,27,28,9,10,6,20,36,13,74,37,78,79,34,35,33,38,26,23,29,30,80,81,44,82,48,15,19,102,76,58,17,18,25,59,60,61,62,63,31,103,22,104,16,7,8,11,12,24,89,105,88,106,98,107])).then(n=>n.default));function bR({messages:n,isRequestActive:e,clientThreadId:t}){var w,S,_;const[s,i]=n,r=cx(s.message),o=(w=i==null?void 0:i.message.metadata)==null?void 0:w.aggregate_result,a=GM(),l=Wd(),d=Ya(t),u=i!=null&&i.message?Xm(i.message):[],f=((_=(S=i==null?void 0:i.message.metadata)==null?void 0:S.aggregate_result)==null?void 0:_.messages.filter(Ld))??[],g=(u.filter(O=>O.type==="chart")??[]).length!==f.length,x=l&&!g;let y=On.Running;return(o==null?void 0:o.status)==="success"?y=On.Finished:i!=null&&i.message.content.content_type!==Ht.ExecutionOutput||o!=null&&o.status!=="running"?y=On.Error:(r||!e)&&(y=On.Stopped),c.jsxs(c.Fragment,{children:[c.jsx(kR,{messages:n,status:y,isRequestActive:e}),x&&u.map((O,T)=>{const{file_id:E,type:R}=O;return d?c.jsx(yR,{clientThreadId:t,isGenerating:y===On.Running,visualization:O},E):R==="chart"&&!a?(O.fallback_to_image=!0,c.jsx(jh,{children:c.jsx(Dh,{clientThreadId:t,visualization:O})},T)):c.jsx(jh,{children:c.jsx(Dh,{clientThreadId:t,visualization:O})},T)}),!x&&i!=null&&c.jsx(Qv,{message:i.message})]})}const jh=Ke.div`mb-3 max-w-[80%]`;function kR({messages:n,status:e,isRequestActive:t}){var f;const[s,i]=n,r=ye(),o=(f=i==null?void 0:i.message.metadata)==null?void 0:f.aggregate_result,a=cx(s.message),{data:l,error:d}=by(ky.ShowExpandedCodeView);let u=r.formatMessage({id:"message.tools.data-analysis.running",defaultMessage:"Analyzing"});if((o==null?void 0:o.status)==="success"?u=r.formatMessage({id:"message.tools.data-analysis.finished",defaultMessage:"Analyzed"}):i!=null&&i.message.content.content_type!==Ht.ExecutionOutput||o!=null&&o.status!=="running"?u=r.formatMessage({id:"message.tools.data-analysis.error",defaultMessage:"Analysis errored"}):(a||!t)&&(u=r.formatMessage({id:"message.tools.data-analysis.stopped",defaultMessage:"Analysis paused"})),l!==void 0||d){const h=Zv(s.message)!=null;return c.jsx(px,{status:e,highlightedCommand:u,showWorkUserSetting:l??!1,hideOnlyIfNotInteractedWith:!0,children:h?c.jsxs("div",{className:"mb-3 mt-0.5 overflow-hidden rounded-xl bg-black",children:[c.jsx(eS,{message:s.message,FormattedText:qa}),i!=null&&c.jsx(tS,{message:i.message})]}):null})}return null}function wR({nextMessage:n,isLastMessage:e,isRequestActive:t}){if(e||(n==null?void 0:n.message.content.content_type)===Ht.Text&&!(n!=null&&n.message.content.parts.some(i=>i.length>0))){const i=t?c.jsx(j,{id:"O+zD9o",defaultMessage:"Searching..."}):c.jsx(j,{id:"fssXGM",defaultMessage:"Error while searching"});return c.jsx(px,{highlightedCommand:i,status:t?On.Running:On.Error,children:i})}return null}const vR={strong:n=>{const{node:e,children:t,...s}=n;return c.jsx("strong",{...s,className:J(s.className,"font-medium text-token-text-primary"),children:t})},p:n=>{const{node:e,children:t,...s}=n;return c.jsx("p",{...s,className:J(s.className,"text-base","has-[strong]:mb-1 has-[strong]:mt-3 [&:not(:has(strong))]:mb-3"),children:t})}};function SR({messages:n,isStreaming:e}){var h,g;const[t,s]=k.useState(""),[i,r]=k.useState(!1),[o,a]=k.useState(!1),l=k.useRef(e),d=n[0].message,u=hr(d);k.useEffect(()=>{var S;const x=/\*\*(.*?)(?:\*\*|\n|$)/g;let y,w="";for(;(y=x.exec(u))!=null;)w=y[1].trim();w?s(w):((S=d.metadata)==null?void 0:S.initial_text)!=null&&s(d.metadata.initial_text)},[u,(h=d.metadata)==null?void 0:h.initial_text]),k.useEffect(()=>{u.length>0&&a(!0)},[u]),k.useEffect(()=>{l.current&&!e&&i&&r(!1),l.current=e},[l,i,e,r]);const f=e;return c.jsxs("div",{children:[c.jsxs("div",{className:J("inline-flex items-center text-token-text-tertiary",o&&"cursor-pointer",{"loading-shimmer":f}),onClick:()=>{o&&r(!i)},children:[e?t:((g=d.metadata)==null?void 0:g.finished_text)??"",o&&c.jsxs(c.Fragment,{children:[" ",i?c.jsx(xm,{className:"icon-md"}):c.jsx(mo,{className:"icon-md"})]})]}),i&&c.jsx("div",{className:"my-4 border-l-2 pl-4",children:c.jsx(qa,{componentOverrides:vR,className:"not-prose leading-6 text-token-text-secondary",children:u})})]})}const CR=Ve(()=>Ue(()=>import("./sso-ihqxdzxswuiox36n.js").then(n=>n.e),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100])).then(n=>n.CanmoreCanvasMessage).catch(()=>al)),MR=Ve(()=>Ue(()=>import("./br9a1av9voo62vec.js"),__vite__mapDeps([110,1,2,3,15,13,6,4,5,14,19,102,76,28,9,10,58,17,18,25,59,32,60,61,62,63,23,35,31,103,22,104,16,20,7,8,11,12,24,26,27,29,30,89,74,37,44,105,88,81,34,48,33,36,38,106,98,107]))),TR=Ve(()=>Ue(()=>import("./ncn9hh8scg46yn3g.js"),__vite__mapDeps([111,1,2,3]))),ER=Ve(()=>Ue(()=>import("./bndy98029e5l14vk.js"),__vite__mapDeps([112,1,2,3,15,13,6,4,5,14,19,102,76,28,9,10,58,17,18,25,59,32,60,61,62,63,23,35,31,103,22,104,16,20,7,8,11,12,24,26,27,29,30,89,74,37,44,105,88,81,34,48,33,36,38,106,98,107]))),_R=Ve(()=>Ue(()=>import("./feif6oz75iaq3hwp.js"),__vite__mapDeps([113,1,2,3,44,4,5,13,6,14,106,81,18])).then(n=>n.TextMessageEditor)),AR=Ve(()=>Ue(()=>import("./jk75a2w0m5kujdnq.js"),__vite__mapDeps([114,1,2,3,32,14,4,5,44,19,15,13,6,102,76,28,9,10,58,17,18,25,59,60,61,62,63,23,35,31,103,22,104,16,20,7,8,11,12,24,26,27,29,30,89,74,37,105,88,81,34,48,33,36,38,106,98,107]))),NR=Ve(()=>Ue(()=>import("./i6z7gagoqkwvcqcz.js"),__vite__mapDeps([115,1,2,3,15,13,6,4,5,14,19,102,76,28,9,10,58,17,18,25,59,32,60,61,62,63,23,35,31,103,22,104,16,20,7,8,11,12,24,26,27,29,30,89,74,37,44,105,88,81,34,48,33,36,38,106,98,107]))),IR=Ve(()=>Ue(()=>import("./ep4yxennpm3bmzsr.js"),__vite__mapDeps([116,1,2,3,4,5,67,19,15,13,6,14,69,32,102,76,28,9,10,58,17,18,25,59,60,61,62,63,23,35,31,103,22,104,16,20,7,8,11,12,24,26,27,29,30,89,74,37,44,105,88,81,34,48,33,36,38,106,98,107])).then(n=>n.BrowsingMessage)),RR=Ve(()=>Ue(()=>import("./jw65xsfufdcj9cuy.js"),__vite__mapDeps([117,1,2,3,67,4,5,15,13,6,14,19,102,76,28,9,10,58,17,18,25,59,32,60,61,62,63,23,35,31,103,22,104,16,20,7,8,11,12,24,26,27,29,30,89,74,37,44,105,88,81,34,48,33,36,38,106,98,107])).then(n=>n.SearchResultMessage)),DR=Ve(()=>Ue(()=>import("./kjmxh82h04idd7tm.js"),__vite__mapDeps([118,1,2,3,19,4,5,15,13,6,14,16,17,18,20,7,8,9,10,11,12])).then(n=>n.GizmoContactsMessage)),jR=Ve(()=>Ue(()=>import("./nh0xrpjs4anr1mol.js"),__vite__mapDeps([119,1,2,3,106,4,5,81,18,44,59,19,15,13,6,14,102,76,28,9,10,58,17,25,32,60,61,62,63,23,35,31,103,22,104,16,20,7,8,11,12,24,26,27,29,30,89,74,37,105,88,34,48,33,36,38,98,107])).then(n=>n.JITPluginMessage));function PR(n){switch(n.type){case X.Text:case X.Debug:return[n.message];case X.MultiText:case X.Browsing:case X.CodeInterpreter:case X.JITPlugin:case X.RetrievalBrowsing:case X.ParallelBrowsing:case X.Dalle:case X.GizmoEditor:case X.SearchResult:case X.GizmoContacts:case X.a8km123:case X.Canmore:case X.SearchGPTQuery:return n.messages;default:throw new Error("Bad")}}function Jc({groupedMessagesToRender:n,allGroupedMessages:e,clientThreadId:t,isEditing:s,isUserTurn:i,isCompletionRequestInProgress:r,isFeedbackEnabled:o,isFinalTurn:a,turnIndex:l,hasActiveRequest:d,showEditButton:u=!1,handleEnterEdit:f,handleExitEdit:h,onChangeItemInView:g,onRequestMoreCompletions:x,onRequestCompletion:y,shouldGrowContainer:w=!0}){const{showDebugConversationTurns:S}=Ti(),_=Hs(t),O=n.map((T,E)=>{var F,D,I,$,B,U,V,Y,te,ne,pe,H;const R=E===e.length-1;switch(T.type){case X.Text:case X.MultiText:{const L=n[E-1],ue=L==null?void 0:L.type,le=L&&"messages"in L?L.messages:void 0;if(T.type===X.Text){const Q=s?c.jsx(_R,{message:T.message,clientThreadId:t,onChangeItemInView:g,onRequestCompletion:y,onRequestMoreCompletions:x,onExitEdit:h,disabled:d}):c.jsx(d9,{className:"min-h-[20px]",message:T.message,isFeedbackEnabled:o,isCompletionInProgress:R&&r,turnIndex:l,clientThreadId:t,showEditButton:u,onEnterEdit:f,isUserTurn:i,onRequestMoreCompletions:x,prevGroupedMessageType:ue,prevGroupedMessages:le});return c.jsxs(k.Fragment,{children:[Q,c.jsx(Sk,{isUserTurn:i,message:T.message.message})]},"group-"+T.message.nodeId)}else return T.type===X.MultiText?c.jsx(ER,{clientThreadId:t,messages:T.messages,isCompletionInProgress:R&&r,isFeedbackEnabled:o,onRequestMoreCompletions:x,prevGroupedMessageType:ue,prevGroupedMessages:le},"multitext-"+(((F=T.messages[0])==null?void 0:F.nodeId)??E)):T.type}case X.Browsing:case X.RetrievalBrowsing:{const L=_!=null&&[tt.GizmoInteraction,tt.GizmoMagicCreate,tt.GizmoTest].includes(_.kind);return c.jsx(IR,{messages:T.messages,isRequestActive:d,isLastMessageInTurn:R,isUsingGizmo:L,isRetrieval:T.type===X.RetrievalBrowsing},"browsing-"+(((D=T.messages[0])==null?void 0:D.nodeId)??E))}case X.SearchGPTQuery:{const L=e[E+1];return c.jsx(wR,{isRequestActive:d,isLastMessage:R,nextMessage:L&&L.type===X.Text?L.message:void 0},"searchquery-"+(((I=T.messages[0])==null?void 0:I.nodeId)??E))}case X.a8km123:return c.jsx(SR,{messages:T.messages,isStreaming:R&&r},"sum-"+((($=T.messages[0])==null?void 0:$.nodeId)??E));case X.ParallelBrowsing:return c.jsx(NR,{messages:T.messages},"parallel-"+(((B=T.messages[0])==null?void 0:B.nodeId)??E));case X.CodeInterpreter:return c.jsx(bR,{messages:T.messages,isRequestActive:d,clientThreadId:t},"ada-"+(((U=T.messages[0])==null?void 0:U.nodeId)??E));case X.JITPlugin:return c.jsx(jR,{messages:T.messages,clientThreadId:t,isLastTurnInConversation:a,onRequestCompletion:y},"jit-"+(((V=T.messages[0])==null?void 0:V.nodeId)??E));case X.GizmoContacts:return c.jsx(DR,{messages:T.messages,clientThreadId:t,isLastTurnInConversation:a,onRequestCompletion:y},"gizmo-contacts-"+(((Y=T.messages[0])==null?void 0:Y.nodeId)??E));case X.Dalle:return c.jsx(AR,{messages:T.messages,clientThreadId:t},"dalle-"+(((te=T.messages[0])==null?void 0:te.nodeId)??E));case X.GizmoEditor:return c.jsx(MR,{messages:T.messages},"gizmo-editor-"+(((ne=T.messages[0])==null?void 0:ne.nodeId)??E));case X.Canmore:return c.jsx(CR,{messages:T.messages,isRequestActive:d,clientThreadId:t},"canmore-"+(((pe=T.messages[0])==null?void 0:pe.nodeId)??E));case X.Debug:return S?c.jsx(TR,{message:T.message},"debug-"+T.message.nodeId):null;case X.SearchResult:return c.jsx(RR,{messages:T.messages},"search-result-"+(((H=T.messages[0])==null?void 0:H.nodeId)??E))}});return c.jsx(FR,{shouldGrowContainer:w,children:O})}function OR(){return c.jsx(jp,{type:"danger",children:c.jsx(j,{id:"daIg0P",defaultMessage:"Unable to display this message due to a error."})})}function FR({children:n,shouldGrowContainer:e}){return c.jsx("div",{className:J({"flex max-w-full flex-col":!0,"flex-grow":e}),children:c.jsx(gp,{name:"GroupedMessages",fallback:OR,children:n})})}function LR({messages:n}){const e=Ck(n.flatMap(s=>{var i,r;return((r=(i=s==null?void 0:s.message)==null?void 0:i.metadata)==null?void 0:r.content_references)??[]})),t=bS(e.filter(s=>(s==null?void 0:s.type)==="webpage").map(s=>mS(!0,s)).filter(Mk),s=>s==null?void 0:s.url);return c.jsx("div",{className:"mt-4 grid w-full grid-cols-[50%,50%] gap-3",children:t.map(s=>c.jsx(Tk,{contentReference:s},s.url))})}const mx=new Tw;xd.exports;(function(n){(function(e,t,s){function i(l){var d=this,u=a();d.next=function(){var f=2091639*d.s0+d.c*23283064365386963e-26;return d.s0=d.s1,d.s1=d.s2,d.s2=f-(d.c=f|0)},d.c=1,d.s0=u(" "),d.s1=u(" "),d.s2=u(" "),d.s0-=u(l),d.s0<0&&(d.s0+=1),d.s1-=u(l),d.s1<0&&(d.s1+=1),d.s2-=u(l),d.s2<0&&(d.s2+=1),u=null}function r(l,d){return d.c=l.c,d.s0=l.s0,d.s1=l.s1,d.s2=l.s2,d}function o(l,d){var u=new i(l),f=d&&d.state,h=u.next;return h.int32=function(){return u.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&r(f,u),h.state=function(){return r(u,{})}),h}function a(){var l=4022871197,d=function(u){u=String(u);for(var f=0;f<u.length;f++){l+=u.charCodeAt(f);var h=.02519603282416938*l;l=h>>>0,h-=l,h*=l,l=h>>>0,h-=l,l+=h*4294967296}return(l>>>0)*23283064365386963e-26};return d}t&&t.exports?t.exports=o:this.alea=o})(Ci,n)})(xd);var BR=xd.exports;yd.exports;(function(n){(function(e,t,s){function i(a){var l=this,d="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var f=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^f^f>>>8},a===(a|0)?l.x=a:d+=a;for(var u=0;u<d.length+64;u++)l.x^=d.charCodeAt(u)|0,l.next()}function r(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var d=new i(a),u=l&&l.state,f=function(){return(d.next()>>>0)/4294967296};return f.double=function(){do var h=d.next()>>>11,g=(d.next()>>>0)/4294967296,x=(h+g)/(1<<21);while(x===0);return x},f.int32=d.next,f.quick=f,u&&(typeof u=="object"&&r(u,d),f.state=function(){return r(d,{})}),f}t&&t.exports?t.exports=o:this.xor128=o})(Ci,n)})(yd);var UR=yd.exports;bd.exports;(function(n){(function(e,t,s){function i(a){var l=this,d="";l.next=function(){var f=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(f^f<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:d+=a;for(var u=0;u<d.length+64;u++)l.x^=d.charCodeAt(u)|0,u==d.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function r(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var d=new i(a),u=l&&l.state,f=function(){return(d.next()>>>0)/4294967296};return f.double=function(){do var h=d.next()>>>11,g=(d.next()>>>0)/4294967296,x=(h+g)/(1<<21);while(x===0);return x},f.int32=d.next,f.quick=f,u&&(typeof u=="object"&&r(u,d),f.state=function(){return r(d,{})}),f}t&&t.exports?t.exports=o:this.xorwow=o})(Ci,n)})(bd);var zR=bd.exports;kd.exports;(function(n){(function(e,t,s){function i(a){var l=this;l.next=function(){var u=l.x,f=l.i,h,g;return h=u[f],h^=h>>>7,g=h^h<<24,h=u[f+1&7],g^=h^h>>>10,h=u[f+3&7],g^=h^h>>>3,h=u[f+4&7],g^=h^h<<7,h=u[f+7&7],h=h^h<<13,g^=h^h<<9,u[f]=g,l.i=f+1&7,g};function d(u,f){var h,g=[];if(f===(f|0))g[0]=f;else for(f=""+f,h=0;h<f.length;++h)g[h&7]=g[h&7]<<15^f.charCodeAt(h)+g[h+1&7]<<13;for(;g.length<8;)g.push(0);for(h=0;h<8&&g[h]===0;++h);for(h==8?g[7]=-1:g[h],u.x=g,u.i=0,h=256;h>0;--h)u.next()}d(l,a)}function r(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var d=new i(a),u=l&&l.state,f=function(){return(d.next()>>>0)/4294967296};return f.double=function(){do var h=d.next()>>>11,g=(d.next()>>>0)/4294967296,x=(h+g)/(1<<21);while(x===0);return x},f.int32=d.next,f.quick=f,u&&(u.x&&r(u,d),f.state=function(){return r(d,{})}),f}t&&t.exports?t.exports=o:this.xorshift7=o})(Ci,n)})(kd);var VR=kd.exports;wd.exports;(function(n){(function(e,t,s){function i(a){var l=this;l.next=function(){var u=l.w,f=l.X,h=l.i,g,x;return l.w=u=u+1640531527|0,x=f[h+34&127],g=f[h=h+1&127],x^=x<<13,g^=g<<17,x^=x>>>15,g^=g>>>12,x=f[h]=x^g,l.i=h,x+(u^u>>>16)|0};function d(u,f){var h,g,x,y,w,S=[],_=128;for(f===(f|0)?(g=f,f=null):(f=f+"\0",g=0,_=Math.max(_,f.length)),x=0,y=-32;y<_;++y)f&&(g^=f.charCodeAt((y+32)%f.length)),y===0&&(w=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,y>=0&&(w=w+1640531527|0,h=S[y&127]^=g+w,x=h==0?x+1:0);for(x>=128&&(S[(f&&f.length||0)&127]=-1),x=127,y=4*128;y>0;--y)g=S[x+34&127],h=S[x=x+1&127],g^=g<<13,h^=h<<17,g^=g>>>15,h^=h>>>12,S[x]=g^h;u.w=w,u.X=S,u.i=x}d(l,a)}function r(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var d=new i(a),u=l&&l.state,f=function(){return(d.next()>>>0)/4294967296};return f.double=function(){do var h=d.next()>>>11,g=(d.next()>>>0)/4294967296,x=(h+g)/(1<<21);while(x===0);return x},f.int32=d.next,f.quick=f,u&&(u.X&&r(u,d),f.state=function(){return r(d,{})}),f}t&&t.exports?t.exports=o:this.xor4096=o})(Ci,n)})(wd);var GR=wd.exports;vd.exports;(function(n){(function(e,t,s){function i(a){var l=this,d="";l.next=function(){var f=l.b,h=l.c,g=l.d,x=l.a;return f=f<<25^f>>>7^h,h=h-g|0,g=g<<24^g>>>8^x,x=x-f|0,l.b=f=f<<20^f>>>12^h,l.c=h=h-g|0,l.d=g<<16^h>>>16^x,l.a=x-f|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):d+=a;for(var u=0;u<d.length+20;u++)l.b^=d.charCodeAt(u)|0,l.next()}function r(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var d=new i(a),u=l&&l.state,f=function(){return(d.next()>>>0)/4294967296};return f.double=function(){do var h=d.next()>>>11,g=(d.next()>>>0)/4294967296,x=(h+g)/(1<<21);while(x===0);return x},f.int32=d.next,f.quick=f,u&&(typeof u=="object"&&r(u,d),f.state=function(){return r(d,{})}),f}t&&t.exports?t.exports=o:this.tychei=o})(Ci,n)})(vd);var $R=vd.exports;(function(n){(function(e,t,s){var i=256,r=6,o=52,a="random",l=s.pow(i,r),d=s.pow(2,o),u=d*2,f=i-1,h;function g(T,E,R){var F=[];E=E==!0?{entropy:!0}:E||{};var D=S(w(E.entropy?[T,O(t)]:T??_(),3),F),I=new x(F),$=function(){for(var B=I.g(r),U=l,V=0;B<d;)B=(B+V)*i,U*=i,V=I.g(1);for(;B>=u;)B/=2,U/=2,V>>>=1;return(B+V)/U};return $.int32=function(){return I.g(4)|0},$.quick=function(){return I.g(4)/4294967296},$.double=$,S(O(I.S),t),(E.pass||R||function(B,U,V,Y){return Y&&(Y.S&&y(Y,I),B.state=function(){return y(I,{})}),V?(s[a]=B,U):B})($,D,"global"in E?E.global:this==s,E.state)}function x(T){var E,R=T.length,F=this,D=0,I=F.i=F.j=0,$=F.S=[];for(R||(T=[R++]);D<i;)$[D]=D++;for(D=0;D<i;D++)$[D]=$[I=f&I+T[D%R]+(E=$[D])],$[I]=E;(F.g=function(B){for(var U,V=0,Y=F.i,te=F.j,ne=F.S;B--;)U=ne[Y=f&Y+1],V=V*i+ne[f&(ne[Y]=ne[te=f&te+U])+(ne[te]=U)];return F.i=Y,F.j=te,V})(i)}function y(T,E){return E.i=T.i,E.j=T.j,E.S=T.S.slice(),E}function w(T,E){var R=[],F=typeof T,D;if(E&&F=="object")for(D in T)try{R.push(w(T[D],E-1))}catch{}return R.length?R:F=="string"?T:T+"\0"}function S(T,E){for(var R=T+"",F,D=0;D<R.length;)E[f&D]=f&(F^=E[f&D]*19)+R.charCodeAt(D++);return O(E)}function _(){try{var T;return h&&(T=h.randomBytes)?T=T(i):(T=new Uint8Array(i),(e.crypto||e.msCrypto).getRandomValues(T)),O(T)}catch{var E=e.navigator,R=E&&E.plugins;return[+new Date,e,R,e.screen,O(t)]}}function O(T){return String.fromCharCode.apply(0,T)}if(S(s.random(),t),n.exports){n.exports=g;try{h=wy}catch{}}else s["seed"+a]=g})(typeof self<"u"?self:Ci,[],Math)})(Yp);var WR=Yp.exports,HR=BR,qR=UR,KR=zR,JR=VR,YR=GR,XR=$R,_i=WR;_i.alea=HR;_i.xor128=qR;_i.xorwow=KR;_i.xorshift7=JR;_i.xor4096=YR;_i.tychei=XR;var QR=_i;const gx=Oa(QR);function Yc({messages:n,isMemoryEnabled:e,isMemoryFull:t,gizmoId:s,isParagen:i}){const[r,o]=k.useState(!1),[a,l]=k.useState(!1),{eligible:d,isLoading:u}=kS(),f=e&&!t,h=n.filter((y,w)=>{const S=n[w+1],O=(S==null?void 0:S.message.recipient)==="assistant"&&(S==null?void 0:S.message.author.role)===$e.Tool&&(S==null?void 0:S.message.author.name)==="bio"&&hr(S.message)==="Model set context updated."||!S&&f;return y.message.author.role===$e.Assistant&&y.message.recipient==="bio"&&O}).flatMap(y=>{const w=y.message.content.content_type;return w===Ht.Text?y.message.content.parts:w===Ht.Code?[y.message.content.text]:[]}).map(ZR),g=k.useMemo(()=>h.length>0,[h]);if(k.useEffect(()=>{g&&d&&!u&&xi.openModal(Jr.GlobalMemoryOnboarding)},[g,d,u]),h.length===0)return null;const x=y=>{const w=y??!a;l(w),w&&W.logEvent(G.memoryUpdatePopoverShown,{updateCount:h.length})};return c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"inline-block",onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),children:c.jsxs(Wm,{open:a,sideOffset:4,side:"bottom",alignAgainstAnchor:"start",size:"none",className:"z-10 min-w-60 max-w-96 text-sm",onOpenChange:y=>x(y),disableAutofocus:!0,triggerButton:c.jsxs("button",{className:J("my-1 flex items-center gap-1 text-sm font-semibold outline-none",a?"text-token-text-secondary":"text-token-text-tertiary"),children:[c.jsx(Xw,{className:"mb-[-1px]"}),h.length===1?c.jsx(j,{id:"MemoryActionResult.memoryWriteSingular.1",defaultMessage:"Memory updated"}):c.jsx(j,{id:"MemoryActionResult.memoryWritePlural.1",defaultMessage:"Memories updated"})]}),children:[c.jsx("div",{className:"mb-2 rounded border border-token-border-light bg-token-main-surface-secondary",children:h.map((y,w)=>c.jsx("div",{className:"border-b border-token-border-light px-3 py-2 first-letter:uppercase last:border-b-0",children:y},w))}),i?c.jsx("div",{className:"text-xs text-token-text-tertiary",children:c.jsx(j,{id:"MemoryActionResult.paragenMessage",defaultMessage:"This memory will be saved if you choose this response."})}):c.jsxs("button",{className:"flex w-full items-center justify-between rounded px-3 py-2 font-semibold hover:bg-token-main-surface-secondary",onClick:()=>{o(!0),W.logEvent(G.memoryUpdatePopoverManageButtonClicked,{updateCount:h.length})},children:[c.jsx(j,{id:"MemoryActionResult.manageMemories",defaultMessage:"Manage memories"}),c.jsx(Qw,{className:"icon-md -mr-1 text-token-text-tertiary"})]})]})}),r&&c.jsx(Dv,{initialGizmoId:s,onClose:()=>o(!1)})]})}function ZR(n){const e=["The user ","The user's ","User ","User's "];for(const t of e)if(n.startsWith(t))return n.slice(t.length);return n}function Ph(n,e,t){z.updateTree(n,s=>{s.updateNodeMetadata(e,{inlineComparisonRating:t})})}const Oh=({messages:n})=>{for(const{message:{metadata:e}}of n){const{augmented_paragen_prompt_label:t}=e??{};if(t)return t}};function eD(n){const e=rD(),t=k.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});return n.stubSideBySideFeedback?c.jsx(xx,{shouldEnableUnifiedDesign:e,setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:t,...n}):c.jsx(tD,{...n,shouldEnableUnifiedDesign:e,visibilityStateRef:t})}function tD({shouldEnableUnifiedDesign:n,...e}){const{clientThreadId:t,variantIds:s,variantsInStreamInfo:i}=e;if(s.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const[r]=k.useState(()=>Date.now()),o=md(),[a,l]=k.useMemo(()=>gx(s.join(""))()<.5?[0,1]:[1,0],[s[0],s[1]]),d=a<l?"left":"right",u=d==="left"?"right":"left",f=s[a],h=s[l],g=Bu(t,f),x=Bu(t,h),y=Ar(Uu(t,Ar(g).id)),w=Ar(Uu(t,Ar(x).id)),S=d==="left"?y:w,_=d==="left"?w:y,O=i.display_treatment==="unskippable",T=O?"unskippable_parallel_2_in_stream:a:1.0":n?"skippable_parallel_2_in_stream:a:1.5":"skippable_parallel_2_in_stream:a:1.0";k.useEffect(()=>(er.setState({displayingSideBySideFeedback:!0,unskippable:O}),()=>{er.setState({displayingSideBySideFeedback:!1,unskippable:!1})}),[O]),RM();const E=k.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});k.useEffect(()=>vy(mx,{requestCompletion:()=>{var I,$,B,U;const F=(I=Nr(S.messages))==null?void 0:I.completionSampleFinishTime,D=($=Nr(_.messages))==null?void 0:$.completionSampleFinishTime;_e.submitMessageComparisonFeedback({feedback_version:T,original_message_id:(B=S.messages[S.messages.length-1])==null?void 0:B.message.id,new_message_id:(U=_.messages[_.messages.length-1])==null?void 0:U.message.id,rating:"none",conversation_id:z.getServerThreadId(t),text:"",tags:[],completion_comparison_rating:"skip",new_completion_placement:u,feedback_start_time:r,compare_step_start_time:r,original_completion_load_start_time:r,original_completion_load_end_time:F??0,new_completion_load_start_time:r,new_completion_load_end_time:D??0,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),...E.current})}}),[y,w,t,r,T,u,S==null?void 0:S.messages,_==null?void 0:_.messages]);const R=F=>{var te,ne,pe,H;const I=z.getTree(t).getLeafFromNode(F);z.setThreadCurrentLeafId(t,I.id);const B=F===f===(d==="left"),U=(te=Nr(S.messages))==null?void 0:te.completionSampleFinishTime,V=(ne=Nr(_.messages))==null?void 0:ne.completionSampleFinishTime;S.messages.length>0&&Ph(t,S.messages[S.messages.length-1].nodeId,B?"original":"new"),_.messages.length>0&&Ph(t,_.messages[_.messages.length-1].nodeId,B?"original":"new");let Y;U==null||V==null?Y=B?"partial_load_comparison_original":"partial_load_comparison_new":Y=B?"original":"new",_e.submitMessageComparisonFeedback({feedback_version:T,original_message_id:(pe=S.messages[S.messages.length-1])==null?void 0:pe.message.id,new_message_id:(H=_.messages[_.messages.length-1])==null?void 0:H.message.id,rating:"none",conversation_id:z.getServerThreadId(t),text:"",tags:[],completion_comparison_rating:Y,new_completion_placement:u,feedback_start_time:r,compare_step_start_time:r,original_completion_load_start_time:r,original_completion_load_end_time:U??null,new_completion_load_start_time:r,new_completion_load_end_time:V??null,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),...E.current})};return c.jsx(xx,{...e,setPreferredFeedback:R,leftVariantId:f,rightVariantId:h,leftTurn:y,rightTurn:w,hasActiveRequest:o,shouldEnableUnifiedDesign:n,originalTurn:S,visibilityStateRef:E})}function nD(n){if(!n.length)return!1;const e=n.filter(t=>t.type===X.Text||t.type===X.MultiText).filter(t=>{var s;return t.message.message.status!=="finished_successfully"&&((s=t.message.message.metadata)==null?void 0:s.snorkle_status)!==void 0});return e.length>0&&e.every(t=>{const s=t.message.message.content;return(s==null?void 0:s.content_type)===Ht.Text&&s.parts.join("")===""})}function xx({setPreferredFeedback:n,shouldEnableUnifiedDesign:e,leftVariantId:t,rightVariantId:s,leftTurn:i,rightTurn:r,hasActiveRequest:o,originalTurn:a,visibilityStateRef:l,...d}){const{defaultParagenLabel:u,shouldShowParagenLabels:f=!1}=Gd(),h=i&&Oh(i)||u,g=r&&Oh(r)||u,x=k.useMemo(()=>(i==null?void 0:i.messages)??[],[i==null?void 0:i.messages]),y=k.useMemo(()=>(r==null?void 0:r.messages)??[],[r==null?void 0:r.messages]),{avatarClassName:w}=d,S=k.useMemo(()=>Da(x),[x]),_=k.useMemo(()=>Da(y),[y]),O=Ua(),T=Ti();function E(L){var Ge,ze;if(!T.showDebugConversationTurns&&!T.forceParagen)return null;let ue=L===a?"ORIGINAL":"NEW";const le=L.messages[L.messages.length-1],Q=(ze=(Ge=le==null?void 0:le.message)==null?void 0:Ge.metadata)==null?void 0:ze.__internal;if(Q){const{model_id:me,model_definition_slug:we,model_definition_virtual_model_id:Fe,augmented_paragen_prompt_group_id:q,augmented_paragen_prompt_id:Z,augmented_paragen_prompt:Me}=Q;me&&(ue+=`
Model ID: ${me}`),we&&(ue+=`
Model Slug: ${we}`),Fe&&(ue+=`
Virtual Model ID: ${Fe}`),q&&(ue+=`
Prompt Group ID: ${q}`),Z&&(ue+=`
Prompt ID: ${Z}`),Me&&(ue+=`
Prompt: ${Me}`)}return c.jsx("div",{className:"whitespace-pre-wrap text-sm text-red-500",children:ue})}const[R,F]=k.useMemo(()=>[S,_].map(L=>nD(L)),[S,_]),D=gs(i?Wr.getRequestIdFromConversationTurn(i):"")||R,I=gs(r?Wr.getRequestIdFromConversationTurn(r):"")||F,$=(i==null?void 0:i.role)===$e.User,B=(r==null?void 0:r.role)===$e.User,U=dd(),V=k.useRef(null),Y=k.useRef(null),te=k.useRef(null);k.useEffect(()=>{if(V.current&&Y.current&&te.current){const L=Array(11).fill(0).map((le,Q)=>Q/10),ue=new IntersectionObserver(le=>le.forEach(Q=>{Q.target===Y.current?(l.current.left_visibility_initial==null&&(l.current.left_visibility_initial=Q.intersectionRatio),l.current.left_visibility_max=Math.max(l.current.left_visibility_max??0,Q.intersectionRatio)):Q.target===te.current&&(l.current.right_visibility_initial==null&&(l.current.right_visibility_initial=Q.intersectionRatio),l.current.right_visibility_max=Math.max(l.current.right_visibility_max??0,Q.intersectionRatio))}),{root:V.current,threshold:L});return ue.observe(Y.current),ue.observe(te.current),()=>ue.disconnect()}},[l]);const{data:ne}=za(void 0,!1,O),pe=ne==null?void 0:ne.memoryFullPct,H=typeof pe=="number"&&pe>=100;return c.jsxs("div",{className:"relative flex flex-col",children:[c.jsx("div",{className:"sticky top-[-1px] z-[1] bg-token-main-surface-primary px-3 text-center text-lg md:static md:px-5",children:c.jsx(j,{...Fr.responsePrompt})}),c.jsx("div",{className:"px-3 pb-5 text-center text-sm text-token-text-tertiary md:px-5",children:c.jsx(j,{...Fr.responsePromptExplanation})}),c.jsx("div",{className:"sticky top-[calc(1.75em-1px)] z-[1] h-3 bg-gradient-to-b from-token-main-surface-primary from-50% to-transparent md:static"}),c.jsx("div",{className:"-mb-2 snap-x snap-mandatory overflow-x-auto px-3 pb-4 md:px-5 lg:px-10",ref:V,children:c.jsx("div",{className:"min-w-fit",children:c.jsxs("div",{className:J({"mx-auto flex max-w-6xl":!0,"gap-2 sm:gap-3":!e,"items-start gap-4 sm:gap-6":e}),children:[c.jsxs(Fh,{elemRef:Y,onClick:()=>{n(t)},shouldEnableUnifiedDesign:e,hasActiveRequest:o,children:[c.jsxs(Bh,{children:[c.jsx(Kc,{messages:x,isUserTurn:$,avatarClassName:w,showInlineEmbeddedDisplay:!1}),c.jsx(Lh,{children:f?c.jsx("span",{className:"font-bold text-token-text-primary",children:h}):c.jsx(j,{...Fr.responseNumber,values:{responseIndex:1}})})]}),ne!=null&&!$&&c.jsx(Yc,{messages:x,isMemoryEnabled:U,isMemoryFull:H,isParagen:!0}),c.jsx(Jc,{...d,groupedMessagesToRender:S,allGroupedMessages:S,isEditing:!1,isUserTurn:$,isCompletionRequestInProgress:D,hasActiveRequest:o,handleEnterEdit:vt,handleExitEdit:vt,shouldGrowContainer:!e}),!!i&&E(i)]}),c.jsxs(Fh,{elemRef:te,onClick:()=>{n(s)},shouldEnableUnifiedDesign:e,hasActiveRequest:o,children:[c.jsxs(Bh,{children:[c.jsx(Kc,{messages:y,isUserTurn:B,avatarClassName:w,showInlineEmbeddedDisplay:!1}),c.jsx(Lh,{children:f?c.jsx("span",{className:"font-bold text-token-text-primary",children:g}):c.jsx(j,{...Fr.responseNumber,values:{responseIndex:2}})})]}),ne!=null&&!B&&c.jsx(Yc,{messages:y,isMemoryEnabled:U,isMemoryFull:H,isParagen:!0}),c.jsx(Jc,{...d,groupedMessagesToRender:_,allGroupedMessages:_,isEditing:!1,isUserTurn:B,isCompletionRequestInProgress:I,hasActiveRequest:o,handleEnterEdit:vt,handleExitEdit:vt,shouldGrowContainer:!e}),!!r&&E(r)]})]})})})]})}function Fh({shouldEnableUnifiedDesign:n,...e}){return n?c.jsx(sD,{...e}):c.jsx(iD,{...e})}function sD({elemRef:n,onClick:e,children:t,hasActiveRequest:s}){return c.jsxs("div",{className:"relative flex w-full min-w-[min(450px,80vw)] snap-center flex-col gap-1 truncate rounded-2xl border border-token-main-surface-tertiary bg-white p-5 text-left dark:bg-gray-700",ref:n,children:[t,s?null:c.jsx(Xe,{className:"mt-4 self-start",onClick:e,children:c.jsx(j,{id:"U2EAH6",defaultMessage:"I prefer this response"})})]})}function iD({elemRef:n,onClick:e,children:t}){const s=Sy(),i="relative flex w-full flex-col gap-1 bg-white cursor-pointer truncate rounded-lg border border-token-main-surface-tertiary text-left dark:bg-gray-700 p-3 sm:py-4 sm:px-5 hover:border-gray-300 min-w-[min(450px,80vw)] snap-center";return s?c.jsx("button",{className:i,onClick:e,ref:n,children:t}):c.jsxs("div",{className:i,ref:n,children:[t,c.jsx("button",{className:"mt-4 rounded-full bg-token-main-surface-primary p-2",onClick:e,children:c.jsx(j,{...Fr.responseChoice})})]})}const Lh=Ke.div`text-sm text-token-text-tertiary font-semibold`,Bh=Ke.div`flex gap-4 items-center mb-1`,Fr=Ce({responsePrompt:{id:"ConversationTurnTwoUpFeedback.responsePrompt",defaultMessage:"Which response do you prefer?"},responsePromptExplanation:{id:"ConversationTurnTwoUpFeedback.responsePromptExplanation",defaultMessage:"Your choice will help make ChatGPT better."},responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}"},responseChoice:{id:"ConversationTurnTwoUpFeedback.responseChoice",defaultMessage:"Choose this response"}});function rD(){const{layer:n}=oo("229662723");return n.get("should-enable-chair",!1)}function oD({clientThreadId:n,messageForRating:e,variantIds:t,conversationTurnMountTime:s}){const[i]=k.useState(()=>e.message.create_time!=null?e.message.create_time*1e3:Date.now()),[r]=k.useState(()=>Date.now());function o(a){var E,R;const l=z.getTree(n),d=t[0]||"",u=(l==null?void 0:l.getConversationTurns(d))||[],f=u[u.length-1],h=(f==null?void 0:f.messages)||[],g=h[h.length-1],x=((E=g==null?void 0:g.message)==null?void 0:E.id)||"",y=t[1]||"",w=(l==null?void 0:l.getConversationTurns(y))||[],S=w[w.length-1],_=(S==null?void 0:S.messages)||[],O=_[_.length-1],T=((R=O==null?void 0:O.message)==null?void 0:R.id)||"";_e.submitMessageComparisonFeedback({feedback_version:"inline_regen_feedback:a:1.0",original_message_id:x,new_message_id:T,rating:"none",conversation_id:z.getServerThreadId(n),text:"",tags:[],completion_comparison_rating:a,new_completion_placement:"not-applicable",feedback_start_time:s,compare_step_start_time:s,new_completion_load_start_time:i,new_completion_load_end_time:r,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset()}),z.updateTree(n,F=>{F.updateNodeMetadata(e.nodeId,{inlineComparisonRating:a})}),z.updateTree(n,F=>{F.updateNodeMetadata(g.nodeId,{inlineComparisonRating:"baseline"})})}return c.jsxs(aD,{children:[c.jsx("h6",{className:"min-w-[150px] grow",children:c.jsx(j,{...Go.regenTitle})}),c.jsxs("div",{className:"flex flex-wrap items-end justify-center gap-2",children:[c.jsx(Xe,{color:"secondary",onClick:()=>o("new"),children:c.jsx(j,{...Go.regenBetterText})}),c.jsx(Xe,{color:"secondary",onClick:()=>o("original"),children:c.jsx(j,{...Go.regenWorseText})}),c.jsx(Xe,{color:"secondary",onClick:()=>o("same"),children:c.jsx(j,{...Go.regenSameText})})]}),c.jsx(la,{onClick:()=>{z.updateTree(n,a=>{a.updateNodeMetadata(e.nodeId,{inlineComparisonRating:"skip"})})}})]})}const aD=Ke.div`flex items-center p-4 rounded-2xl bg-token-main-surface-primary text-token-text-primary text-sm border border-token-border-light gap-5 mt-3`,Go=Ce({regenTitle:{id:"ConversationTurnInlineFeedback.regenTitle",defaultMessage:"Was this response better or worse?"},regenBetterText:{id:"ConversationTurnInlineFeedback.regenBetterText",defaultMessage:"Better"},regenWorseText:{id:"ConversationTurnInlineFeedback.regenWorseText",defaultMessage:"Worse"},regenSameText:{id:"ConversationTurnInlineFeedback.regenSameText",defaultMessage:"Same"}}),Uh=({allGroupedMessages:n})=>n.some(e=>[X.Browsing,X.RetrievalBrowsing,X.ParallelBrowsing].includes(e.type)),zh=({allGroupedMessages:n})=>n.some(e=>e.type===X.CodeInterpreter);function lD(n){return!n||!n.instructions?"":typeof n.instructions=="string"?n.instructions:n.instructions.filter(e=>typeof e=="string").join("")}const cD=[{match:Uh,tag:"Shouldn't have searched the web",label:N({id:"kL047b",defaultMessage:"Shouldn't have searched the web"})},{match:Uh,tag:"Don't like the source it cited",label:N({id:"+ds/Q/",defaultMessage:"Don't like the source it cited"})},{match:zh,tag:"Shouldn't have run code",label:N({id:"53w4ay",defaultMessage:"Shouldn't have run code"})},{match:zh,tag:"Couldn't handle my file",label:N({id:"EkFTQ5",defaultMessage:"Couldn't handle my file"})},{match:({allGroupedMessages:n})=>n.some(e=>e.type===X.Dalle),tag:"Shouldn't have created an image",label:N({id:"S8FRsr",defaultMessage:"Shouldn't have created an image"})},{match:({allGroupedMessages:n})=>n.some(e=>{if(e.type!==X.Text)return!1;const{message:t}=e.message,{content:s}=t;return s.content_type===Ht.Text&&hr(t).match(/^```[\S]+\n/gm)}),tag:"Code was incorrect",label:N({id:"4EBdQk",defaultMessage:"Code was incorrect"})},{match:({systemContent:n})=>lD(n).includes("Personality")??!1,tag:"Too chatty or casual",label:N({id:"ATzJKW",defaultMessage:"Too chatty or casual"})},{match:({features:n})=>n.includes(Si.Sunshine),tag:"Shouldn't have used Memory",label:N({id:"yfUEiz",defaultMessage:"Shouldn't have used Memory"})},{tag:"Don't like the style",label:N({id:"nGxjdj",defaultMessage:"Don't like the style"})},{tag:"Not factually correct",label:N({id:"Ke7JtQ",defaultMessage:"Not factually correct"})},{tag:"Didn't fully follow instructions",label:N({id:"Rdlt9V",defaultMessage:"Didn't fully follow instructions"})},{tag:"Refused when it shouldn't have",label:N({id:"2yRS/Q",defaultMessage:"Refused when it shouldn't have"})},{tag:"Being lazy",label:N({id:"14MPmT",defaultMessage:"Being lazy"})},{tag:"Unsafe or problematic",label:N({id:"02pXBl",defaultMessage:"Unsafe or problematic"})},{tag:"Other",label:N({id:"WiIGE+",defaultMessage:"Other"})}],dD=[{tag:"I disagree with the policy",label:N({id:"oKyDLz",defaultMessage:"I disagree with the policy"})},{tag:"This didn't violate the policy",label:N({id:"7fUkVF",defaultMessage:"This didn't violate the policy"})},{tag:"I don't understand the policy",label:N({id:"4Cdp6N",defaultMessage:"I don't understand the policy"})},{tag:"This didn't take the full context",label:N({id:"vnZJDP",defaultMessage:"This didn't take the full context"})}];function uD(n,e,t){return e.filter(s=>!s.match||s.match(t)).map(s=>({value:s.tag,label:n.formatMessage(s.label)}))}function fD(n){const e=n[n.length-1];if(!e)return!1;const t="message"in e?e.message:null;if(t){const{errCode:s}=wr(t);return[bn.ContentPolicy,bn.ContentOrTos].includes(s)}else return!1}function hD({clientThreadId:n,conversationMessage:e,currentModelId:t,allGroupedMessages:s}){const i=ye(),r=ur()??[],o=e.rating,{value:a}=fs("1410082514"),l=tw(n,e.message.id),d=(l==null?void 0:l.message.content.content_type)===Ht.SystemContent?l==null?void 0:l.message.content:null,u=k.useCallback(g=>{var S;const x=z.getServerThreadId(n);if(!x||g.tags.length===0&&!g.textFeedback)return;W.logEvent(g.source==="inline"?G.messageFeedbackInlineSubmitted:G.messageFeedbackDialogSubmitted,{id:e.message.id,threadId:x,tags:g.tags,content:g.textFeedback,model:t,rating:o});const w=a&&((S=e.message.metadata)==null?void 0:S.snorkle_status)!=null?_e.submitSnorkleFeedback:_e.submitMessageFeedback;o&&w({message_id:e.message.id,conversation_id:x,rating:o,text:g.textFeedback,tags:g.tags,tag_choices:g.tagChoices})},[n,e.message,t,o,a]),f=()=>{W.logEvent(G.messageFeedbackMoreOptionsClicked,{id:e.message.id,threadId:z.getServerThreadId(n),model:t,rating:o})},h=uD(i,fD(s)?dD:cD,{allGroupedMessages:s,features:r,currentModelId:t,systemContent:d});return o==="thumbsUp"?null:c.jsx(lS,{tagOptions:h,onSubmit:u,onMoreClicked:f})}const Vh=[1,2,3,4],pD=.5;function mD({clientThreadId:n,conversationLeafId:e}){const t=mi(Ha.isBusinessWorkspace),s=k.useRef(!1),i=po(n),r=Hs(n),{isUnauthenticated:o}=Dt(),{value:a}=fs("1410082514"),l=k.useMemo(()=>{if(!i)return-1;const U=gx(i);return U()>pD?-1:Vh[Math.floor(U()*Vh.length)]},[i]),d=nm(n,e),u=d[d.length-1],f=k.useMemo(()=>Wr.getRequestIdFromConversationTurn(u),[u]),h=gs(f),[g,x]=k.useState(null),[y,w]=k.useState(!1),[S,_]=k.useState(!1),[O,T]=k.useState(!1),E=U=>{var Y,te;const V=(te=(Y=Nr(d))==null?void 0:Y.messages[0])==null?void 0:te.message.id;x(U),$(V,U)},R=d.filter(U=>U.role===$e.Assistant).length,F=(u==null?void 0:u.role)===$e.Assistant,D=u==null?void 0:u.messages.some(U=>{var V;return(V=U.message.metadata)==null?void 0:V.is_nulligen}),I=a&&(u==null?void 0:u.messages.some(U=>{var V;return((V=U.message.metadata)==null?void 0:V.snorkle_status)!=null})),$=k.useMemo(()=>Md((U,V)=>{i&&U&&(I?_e.submitSnorkleFeedback({conversation_id:i,message_id:U,rating:V}):_e.submitConversationRating({conversation_id:i,message_id:U,rating:V,shown_at_assistant_turn:l})),W.logEvent(G.conversationRatingSubmitted,{rating:V,showAtAssistantTurn:l,conversationId:i}),w(!0),setTimeout(()=>{_(!0)},1500)},2e3),[i,l,I]),B=R!==l||h||!F||D||!!t||(r==null?void 0:r.kind)!==tt.PrimaryAssistant||O||o;return k.useEffect(()=>{!B&&!s.current&&(W.logEvent(G.conversationRatingShown,{showAtAssistantTurn:l,conversationId:i}),s.current=!0)},[B]),O||B&&!I?null:c.jsxs("div",{className:"mx-auto",children:[c.jsx(yi,{children:y&&!S&&c.jsx(yt.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:c.jsx(Gh,{$padded:!0,children:c.jsx("span",{className:"text-sm text-token-text-tertiary",children:c.jsx(j,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!y&&c.jsx(yt.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:c.jsxs(Gh,{$padded:!1,children:[c.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-secondary",children:[c.jsx(j,{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?"}),c.jsxs("div",{className:"flex items-center gap-5",children:[c.jsx(Jl,{$selected:g==="thumbsUp",onClick:()=>E("thumbsUp"),children:c.jsx(Rd,{className:"icon-md"})}),c.jsx(Jl,{$selected:g==="thumbsDown",onClick:()=>E("thumbsDown"),children:c.jsx(Dd,{className:"icon-md"})})]})]}),c.jsx("div",{className:"w-px flex-1 self-stretch bg-token-main-surface-tertiary"}),c.jsx(Jl,{className:"p-3",$selected:!1,onClick:()=>T(!0),children:c.jsx(Zw,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const Jl=Ke.button`
  ${n=>n.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,Gh=Ke.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${n=>n.$padded&&"py-3 px-4"}
`;function gD({clientThreadId:n,conversationLeafId:e,canShowIndepthFeedbackType:t,canShowInlineComparisonFeedback:s,canShowInlineMessageFeedback:i,messageForRating:r,allGroupedMessages:o,currentModelId:a,conversationTurnMountTime:l,variantIds:d}){let u=null;return nw(n,e)?null:(t!==void 0?u=c.jsx(aI,{clientThreadId:n,conversationLeafId:e,trigger:t,variantIds:d}):r.rating&&i?u=c.jsx(hD,{clientThreadId:n,conversationMessage:r,allGroupedMessages:o,currentModelId:a}):s?u=c.jsx(oD,{clientThreadId:n,messageForRating:r,variantIds:d,conversationTurnMountTime:l}):u=c.jsx("div",{className:"text-center",children:c.jsx(mD,{clientThreadId:n,conversationLeafId:e})}),c.jsx("div",{className:"mt-3 w-full empty:hidden",children:u}))}function xD(n){const{isCompletionRequestInProgress:e,isUserTurn:t,message:s}=n,i=ye(),r=k.useRef(e);k.useEffect(()=>{if(!e)return;let o;Eo.setLiveRegionAssertive(i.formatMessage({id:"0LFLpz",defaultMessage:"ChatGPT is generating a response..."}));const a=i.formatMessage({id:"uqqkLX",defaultMessage:"ChatGPT is still generating a response..."}),l=5e3;function d(){Eo.setLiveRegionAssertive(""),o=window.setTimeout(()=>{Eo.setLiveRegionAssertive(a),o=window.setTimeout(()=>d(),l)},1e3)}return o=window.setTimeout(d,l),()=>{window.clearTimeout(o)}},[e,i]),k.useEffect(()=>{var d,u;if(e||t||!s||!r.current){r.current=e;return}const{content:o}=s,a=(o.content_type===Ht.Text,o),l=i.formatMessage({id:"lZ4dVJ",defaultMessage:"ChatGPT says: {message}"},{message:((u=(d=a==null?void 0:a.parts)==null?void 0:d.join)==null?void 0:u.call(d,`
`))??""});Eo.setLiveRegionAssertive(l),r.current=!1},[t,e,i,s])}const yD=Ve(()=>Ue(()=>import("./sso-ihqxdzxswuiox36n.js").then(n=>n.R),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100])),{ssr:!1}),bD=Ve(()=>Ue(()=>import("./sso-ihqxdzxswuiox36n.js").then(n=>n.g),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100])).then(n=>n.ContextualAnswerCitationCards).catch(()=>()=>null));function kD(n){var wn;const{turnIndex:e,conversationLeafId:t,isFinalTurn:s,clientThreadId:i,onChangeItemInView:r,onChangeRating:o,showInlineEmbeddedDisplay:a=!1,currentModelId:l,initiallyHighlightedMessageId:d,avatarClassName:u,scrollToBottom:f}=n,h=ye(),g=xr(),x=mi(Ha.isBusinessWorkspace),y=dd(),w=Ua(),S=Ar(sw(i,e,t)),{messages:_,variantIds:O,variantsInStreamInfo:T}=S,E=Da(_),R=Ek();let F=_[_.length-1];for(const Je of E){const Ye=PR(Je);if(Ye.some(tn=>R.has(tn.message.id))){F=Ye[Ye.length-1];break}}const D=_.slice(0,_.indexOf(F)+1),I=td(),[$,B]=k.useState(!1),[U,V]=k.useState(!1),Y=O.findIndex(Je=>D.some(Ye=>Ye.nodeId===Je)),te=S.role===$e.User,ne=ys(),pe=Bn(i),H=(wn=$s(S.gizmoId??pe))==null?void 0:wn.data,L=Nm(),ue=H&&L.includes(H.gizmo.id),le=hm(l),Q=Hs(i,H==null?void 0:H.gizmo.id),{data:Ge}=za(H==null?void 0:H.gizmo.id,!1,w),ze=Ge==null?void 0:Ge.memoryFullPct,me=ze!==void 0&&ze>=100,we=ur(),{value:Fe}=fs("1410082514"),q=D.some(Je=>Je.message.content.content_type===Ht.MultimodalText),{isUnauthenticated:Z}=Dt(),[Me,be]=k.useState(!1),[ve,Ee]=k.useState(!1);Pp(()=>{S.role==="user"&&f&&f()});const ut=k.useRef(null);k.useEffect(()=>{var Ye;if(d==null)return;S.messages.map(tn=>tn.message.id).includes(d)&&((Ye=ut.current)==null||Ye.scrollIntoView({behavior:"auto"}))},[d]);const ke=_[_.length-1],bt=ke.rating,Xt=()=>{D.length===1&&(W.logEvent(G.editPrompt,{id:D[0].message.id,threadId:z.getServerThreadId(i)}),Ae.logEvent("chatgpt_edit_prompt"),B(!0))},He=k.useCallback(()=>{B(!1)},[]),ft=k.useCallback(()=>{z.copyMessageToClipboard(i,e)},[i,e]),qe=Je=>{o({nodeId:ke.nodeId,messageId:ke.message.id,rating:Je}),Ae.getExperimentValue({experimentName:"101132775",key:"show_new_ui",defaultValue:!1})&&(W.logEvent(G.messageFeedbackThumbsDownClicked,{id:ke.message.id,threadId:z.getServerThreadId(i),model:l,rating:Je}),V(!0))},[kt]=k.useState(()=>Date.now()),Ie=k.useMemo(()=>Wr.getRequestIdFromConversationTurn(S),[S]),nt=em({clientThreadId:i,conversationLeafId:t}),Re=gs(Ie)&&!nt,st=md(),at=Da(D),{showDebugConversationTurns:b}=Ti(),p=tm(i),m=J0(i),v=gI({clientThreadId:i,conversationMode:Q}),M=Qn(i),A=k.useCallback((Je,Ye,tn)=>{v(ke.nodeId,{eventSource:"mouse"},Je,Ye,tn)},[ke,v]),P=Fe&&D.some(Je=>{var Ye;return((Ye=Je.message.metadata)==null?void 0:Ye.snorkle_status)!=null}),ce=!g&&!p&&!ne&&!te,Te=ce&&(!x||P),oe=IM(),De=!Z&&Te&&I&&!Re&&!a&&!$&&(Q==null?void 0:Q.kind)!==tt.GizmoMagicCreate&&Y===1&&s&&!ke.inlineComparisonRating&&!bt&&O.length===2&&!oe&&Date.now()-(ke.message.create_time??0)*1e3<1e3*60*10,fe=!Z&&Te&&!Re&&!a&&!$&&(Q==null?void 0:Q.kind)!==tt.GizmoMagicCreate&&l===Nx&&s&&y&&!me&&Date.now()-(ke.message.create_time??0)*1e3<1e3*60*10,zn=lI(ke),ks=F.message.author.role===$e.Assistant?F.message:null;xD({isCompletionRequestInProgress:Re,isUserTurn:te,message:ks});const Ks=fe?zn:void 0,ws=iw(i,O),pn=gS(Q),je=!oe&&!pn&&ce&&s&&(T==null?void 0:T.num_variants_in_stream)===2&&!ke.inlineComparisonRating&&!ws,rt=O.length===2,ot=je,ts=je&&!rt,ns=!te&&!a&&!g&&!p&&!pn&&!Re,Vn=ns&&(!x||P||le)&&!pn&&!Z&&!ne,ss=!g&&!a&&!(Re&&s)&&O.length>1&&!$&&!ot;let Vt=!1;if(te&&D.length===1){const{shouldHideContent:Je}=wr(D[0]);Je&&(Vt=!0)}const Js=te&&!a&&!pn&&!g&&!q&&D.length===1&&!Vt&&!$&&!Z,vs=Je=>{r(O[Je]),W.logEvent(G.changeNode,{intent:"toggle_between"})};if(!(S.role===$e.Root?!1:S.role===$e.System||D.every(Je=>{var Ye;return(Ye=Je.message.metadata)==null?void 0:Ye.is_visually_hidden_from_conversation})?b:!0)&&!ot)return null;const vr=s&&m&&!Fe?c.jsx(Ki,{onClick:()=>{v(M,{eventSource:"mouse"}),qr()},icon:Id,label:h.formatMessage({id:"ConversationTurn.regenerateTooltip",defaultMessage:"Regenerate"})}):null,Ys="h-[30px] rounded-md px-1 text-token-text-secondary hover:bg-token-main-surface-secondary",Ai=m&&Fe?c.jsx(yD,{className:Ys,clientThreadId:i,message:ke,onModelSelect:A,onDropdownChange:be}):null,Ni=!te&&!Vt&&!a&&(!s||!Re)?c.jsx(fI,{onClick:ft}):null,xe=!te&&!a&&(!s||!Re)&&(ke.disclaimers??[]).length===0&&ke.nodeId?c.jsx(PI,{conversationId:i,message:ke,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-xs text-token-text-tertiary hover:text-token-text-primary"}):null,_t=!te&&!a&&ke&&(!s||!Re)?c.jsx(hI,{message:ke,isFinalTurn:s,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-token-text-tertiary hover:text-token-text-primary"}):null,lt=Vn&&!Re?c.jsxs("div",{className:"flex",children:[!(we!=null&&we.includes(Si.ThumbsDownOnly))&&bt!=="thumbsDown"&&c.jsx(Ki,{onClick:()=>qe("thumbsUp"),disabled:bt==="thumbsUp",icon:bt==="thumbsUp"?ev:Rd,label:h.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"})},`thumbsUp:${ke.nodeId}`),bt!=="thumbsUp"&&c.jsx(Ki,{onClick:()=>qe("thumbsDown"),disabled:bt==="thumbsDown",icon:bt==="thumbsDown"?tv:Dd,label:h.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"})},`thumbsDown:${ke.nodeId}`)]}):null,St=!Fe&&c.jsx(sI,{className:Ys,clientThreadId:i,message:ke,onModelSelect:A,onDropdownChange:be});return c.jsxs("article",{className:"w-full text-token-text-primary focus-visible:outline-2 focus-visible:outline-offset-[-4px]",ref:ut,dir:"auto","data-testid":`conversation-turn-${e}`,"data-scroll-anchor":s,onMouseEnter:()=>Ee(!0),onMouseLeave:()=>Ee(!1),children:[c.jsx(_k,{role:S.role}),c.jsx(Td,{clientThreadId:i,showInlineEmbeddedDisplay:a,isStaticSharedThread:g,withVerticalPadding:!0,withHorizontalPadding:!ot,children:ot?c.jsx(eD,{isFeedbackEnabled:Vn,variantIds:O,variantsInStreamInfo:T,conversationTurnMountTime:kt,stubSideBySideFeedback:ts,...n}):c.jsxs(Ed,{children:[!te&&c.jsx(wD,{children:c.jsx(Kc,{messages:D,isUserTurn:te,avatarClassName:u,showInlineEmbeddedDisplay:a,gizmo:H})}),c.jsx("div",{className:J("group/conversation-turn relative flex w-full min-w-0 flex-col",!te&&mg),children:c.jsx("div",{className:"flex-col gap-1 md:gap-3",children:c.jsxs(c.Fragment,{children:[!te&&!g&&c.jsx(Yc,{messages:D,isMemoryEnabled:y,isMemoryFull:me,gizmoId:H==null?void 0:H.gizmo.id}),c.jsx(Jc,{groupedMessagesToRender:at,allGroupedMessages:E,...n,isEditing:$,isUserTurn:te,isCompletionRequestInProgress:Re,isFeedbackEnabled:Vn,isFinalTurn:s,hasActiveRequest:st,showEditButton:Js,handleEnterEdit:Xt,handleExitEdit:He}),ue&&c.jsx("div",{className:"mb-4",children:c.jsx(LR,{messages:D})}),le&&c.jsx("div",{className:"mb-4",children:c.jsx(bD,{messages:D})}),(ns||ss)&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:J("mt-1 flex gap-3 empty:hidden",te?"mr-1 flex-row-reverse":"-ml-2"),children:c.jsx(uI,{alwaysShow:s,showInline:s||ss,isHovered:ve||Me,pagination:ss&&c.jsx(yS,{showInline:s||ss,currentPage:Y,onChangeIndex:vs,length:O.length,className:J("self-center",O.length>1?"visible":"!invisible")}),actions:ns&&c.jsxs(c.Fragment,{children:[xe,Ni,vr,lt,_t,St,Ai]})})}),ns&&!Re?c.jsx("div",{className:"pr-2 lg:pr-0",children:c.jsx(pI,{message:ke,isFinalTurn:s})}):null,s&&!Re&&c.jsx(gD,{canShowIndepthFeedbackType:Ks,canShowInlineComparisonFeedback:De,canShowInlineMessageFeedback:U,clientThreadId:i,conversationLeafId:t,messageForRating:ke,allGroupedMessages:E,currentModelId:l,conversationTurnMountTime:kt,variantIds:O})]})]})})})]})})]})}const sa=co.memo(kD),wD=Ke.div`flex-shrink-0 flex flex-col relative items-end`,Pe=Ce({submitFeedback:{id:"feedbackModal.submitFeedback",defaultMessage:"Submit feedback"},submitReport:{id:"feedbackModal.submitReport",defaultMessage:"Submit report"},submitRejectModeration:{id:"feedbackModal.moderationReject",defaultMessage:"Block Content"},submitAcceptModeration:{id:"feedbackModal.moderationAccept",defaultMessage:"Allow Content"},thumbsUpPlaceholder:{id:"feedbackModal.thumbsUpPlaceholder",defaultMessage:"What do you like about the response?"},thumbsDownPlaceholder:{id:"feedbackModal.thumbsDownPlaceholder",defaultMessage:"What was the issue with the response? How could it be improved?"},reportContentExplanationPlaceholder:{id:"feedbackModal.reportContentExplanationPlaceholder",defaultMessage:"What is wrong with the response? What about this response is harmful? Please be as specific as possible, and add any details that are not present in the checkboxes below."},harmfulUnsafe:{id:"feedbackModal.harmfulUnsafe",defaultMessage:"This is harmful / unsafe"},harmfulOffensive:{id:"feedbackModal.harmfulOffensive",defaultMessage:"This content is harmful or offensive"},copyrightContent:{id:"feedbackModal.copyrightContent",defaultMessage:"This content violates copyright law"},reportOtherContent:{id:"feedbackModal.reportOtherContent",defaultMessage:"I don't like this for some other reason (please describe)"},notTrue:{id:"feedbackModal.notTrue",defaultMessage:"This isn't true"},notHelpful:{id:"feedbackModal.notHelpful",defaultMessage:"This isn't helpful"},dontLikeThis:{id:"feedbackModal.dontLikeThis",defaultMessage:"I don't like this"},sexualAbuse:{id:"feedbackModal.sexualAbuse",defaultMessage:"This content contains sexual abuse"},provideAdditionalFeedback:{id:"feedbackModal.provideAdditionalFeedback",defaultMessage:"Provide additional feedback"},provideReportModalTitle:{id:"feedbackModal.provideReportModalTitle",defaultMessage:"Report This Content"},pickBestAnswer:{id:"feedbackModal.pickBestAnswer",defaultMessage:"Pick the best answer to improve the model"},newAnswer:{id:"feedbackModal.newAnswer",defaultMessage:"New Answer"},originalAnswer:{id:"feedbackModal.originalAnswer",defaultMessage:"Original Answer"},newAnswerBetter:{id:"feedbackModal.newAnswerBetter",defaultMessage:"New answer is better"},originalAnswerBetter:{id:"feedbackModal.originalAnswerBetter",defaultMessage:"Original answer is better"},neitherAnswerBetter:{id:"feedbackModal.neitherAnswerBetter",defaultMessage:"Neither answer is better"},skipStep:{id:"feedbackModal.skipStep",defaultMessage:"Skip this step"},continueWithChosenAnswer:{id:"feedbackModal.continueWithChosenAnswer",defaultMessage:"The conversation will continue with the answer you choose."},employeeConsent:{id:"feedbackModal.employeeConsent",defaultMessage:"Allow this content to be used for model evals"},employeeConsentExplanation:{id:"feedbackModal.employeeConsentExplanation",defaultMessage:"Allow your feedback and conversation to be used to in model evals. Please verify there is no confidential data in the conversation."}});function ia(n,e=!1){var t,s,i;return((t=n==null?void 0:n.messages)==null?void 0:t.length)===1&&!((s=n==null?void 0:n.messages)!=null&&s.some(r=>"error"in r))&&(e?!(((i=n==null?void 0:n.messages)==null?void 0:i.length)===1&&hr(n==null?void 0:n.messages[0].message).length<20):!0)}function Yl({ratingModalNodeId:n,ratingModalOpen:e,onCloseRatingModal:t,onSubmitFeedback:s,onHandleChangeFeedbackComparisonRating:i,feedbackTextareaRef:r,clientThreadId:o,currentModelId:a,onChangeItemInView:l,onRequestMoreCompletions:d,onRequestCompletion:u}){var pn;const f=ye(),h=z.getTree(o),g=(pn=k.useContext(Ba))==null?void 0:pn.serverSharedThreadId,x=z.getServerThreadId(o),y=g??x,w=pr(),S=!!w&&lp(w),[_,O]=k.useState(!1),T=k.useRef(Math.random()<.5?"left":"right"),E=h==null?void 0:h.getConversationTurns(n||"root"),R=E.length-1,F=E[E.length-1],[D,I]=k.useState("critique"),$=lo(),B=ia(F,!0)&&$,U=k.useMemo(()=>({id:n||"root",threadId:z.getServerThreadId(o),rating:e,model:a}),[n,o,e,a]),V=E==null?void 0:E[(E==null?void 0:E.length)-1].variantIds,Y=V==null?void 0:V[(V==null?void 0:V.length)-1],te=function(){const je=h==null?void 0:h.getConversationTurns(Y),rt=je[je.length-1];return rt.messages[rt.messages.length-1].nodeId}(),ne=function(){return h==null?void 0:h.getConversationTurns(te)}(),pe=k.useMemo(()=>{const je=ne==null?void 0:ne[(ne==null?void 0:ne.length)-1];return e==="thumbsDown"&&B&&ia(je)&&ia(F)},[e,B,ne,F]),H=k.useRef(Date.now()),L=k.useRef(-1),ue=k.useRef(Date.now()),le=k.useRef(Date.now());k.useEffect(()=>{D==="compare"?(L.current=Date.now(),W.logEvent(G.displayedComparisonUIV0,U)):D==="critique"&&e==="thumbsDown"&&W.logEvent(G.displayedThumbsDownFeedbackForm,U)},[D]);const Q=E.length-2,Ge=ne.length-1,ze=ne[ne.length-1],me=k.useMemo(()=>ze&&Wr.getRequestIdFromConversationTurn(ze),[ze]),we=gs(me);k.useMemo(()=>{we||(le.current=Date.now())},[we]);const Fe=F.messages,q=Fe[Fe.length-1],Z=q.message.id,Me=q.nodeId,be=h.getLeafFromNode(Me),ve=ze.messages,Ee=ve[ve.length-1],ut=Ee.message.id,ke=Ee.nodeId,bt=h.getLeafFromNode(ke),Xt=D==="critique"?e==="report"?f.formatMessage(Pe.provideReportModalTitle):f.formatMessage(Pe.provideAdditionalFeedback):f.formatMessage(Pe.pickBestAnswer),He=k.useRef([]),ft=k.useRef(""),qe=k.useCallback(()=>{var rt;const je=(rt=r.current)==null?void 0:rt.elements;He.current=[...je||[]].filter(ot=>ot.checked).map(ot=>ot.id).map(ot=>ot.replace("feedback-","")),ft.current=(je==null?void 0:je["feedback-other"].value)||""},[r]),kt=k.useCallback(()=>{qe(),s({customFeedback:ft.current,tags:He.current,employeeConsented:S?_:void 0}),e==="thumbsDown"&&W.logEvent(G.submitThumbsDownFeedbackForm,U),pe?I("compare"):t()},[qe,s,S,_,e,pe,U,t]),Ie=k.useCallback((je,rt)=>{if(y==null){xt.danger("Moderation NOT logged successfully! serverThreadId is null"),et.addError("Moderation: serverThreadId is null");return}const ot=h.getMessageId(z.getThreadCurrentLeafId(o));_e.submitSharedConversationReportFeedback({message_id:ot,shared_conversation_id:y,text:je,tags:rt}).then(()=>{xt.success("Moderation logged successfully")}).catch(ts=>{xt.danger("Moderation NOT logged successfully! Please try again"),et.addError(new Error("Moderation: failed to log",{cause:ts}))}),t()},[h,o,t,y]),nt=k.useCallback(()=>{qe(),He.current.push("moderation-reject"),Ie(ft.current,He.current)},[Ie,qe]),Re=k.useCallback(()=>{qe(),He.current.push("moderation-accept"),Ie(ft.current,He.current)},[Ie,qe]),st=e==="moderate"?c.jsxs(c.Fragment,{children:[c.jsx(Cn.Button,{title:f.formatMessage(Pe.submitRejectModeration),color:"danger",onClick:nt}),c.jsx(Cn.Button,{title:f.formatMessage(Pe.submitAcceptModeration),color:"primary",onClick:Re})]}):D==="critique"?c.jsxs("div",{className:"flex items-center gap-3",children:[S&&e!=="report"&&c.jsx(bs,{label:f.formatMessage(Pe.employeeConsentExplanation),children:c.jsx(mn,{id:"employee-consent",checked:_,onChange:je=>O(je.currentTarget.checked),label:f.formatMessage(Pe.employeeConsent)})}),c.jsx(Cn.Button,{title:f.formatMessage(e==="report"?Pe.submitReport:Pe.submitFeedback),onClick:kt})]}):null,at=T.current==="left",b=at?Ge:R,p=at?R:Ge,m=at?ke:Me,v=at?Me:ke,M=at?"new":"original",A=at?"original":"new",P=at?f.formatMessage(Pe.newAnswer):f.formatMessage(Pe.originalAnswer),ce=at?f.formatMessage(Pe.originalAnswer):f.formatMessage(Pe.newAnswer),Te=at?f.formatMessage(Pe.newAnswerBetter):f.formatMessage(Pe.originalAnswerBetter),oe=at?f.formatMessage(Pe.originalAnswerBetter):f.formatMessage(Pe.newAnswerBetter),De=e&&e!=="report"&&e!=="moderate",fe=k.useCallback(je=>{const rt=je==="left"?M:je==="right"?A:"same";if(W.logEvent(G.submittedComparisonUIV0,Object.assign({},U,{choice:rt})),De){const ot=z.getTree(o);ot.updateNodeMetadata(Me,{inlineComparisonRating:"baseline"}),ot.updateNodeMetadata(ke,{inlineComparisonRating:rt}),i(Z,ut,e,rt,T.current,H.current,L.current,ue.current,le.current,ft.current,He.current)}z.setThreadCurrentLeafId(o,je===T.current?bt.id:be.id),t()},[M,A,U,De,o,bt.id,be.id,t,Me,ke,i,Z,ut,e]),zn=!we&&le.current!=null&&pe,ks=k.useCallback(()=>{t(),D==="critique"?W.logEvent(G.skippedThumbsDownFeedbackForm,Object.assign({},U)):D==="compare"&&W.logEvent(G.skippedComparisonUIV0,Object.assign({},U))},[t,U,D]),[Ks,ws]=k.useState([]);return k.useEffect(()=>{e==="moderate"&&_e.fetchShareModerationCategories().then(je=>{const rt=je.moderation_categories;ws(Object.keys(rt).map(ot=>[ot,rt[ot]]))})},[]),c.jsxs(Zi,{isOpen:!0,onClose:ks,showCloseButton:!0,size:"custom",className:"md:max-w-[672px] lg:max-w-[896px] xl:max-w-6xl",type:D==="critique"?e==="thumbsUp"?"success":"danger":"success",icon:D==="critique"?e==="thumbsUp"?Rd:Dd:void 0,title:Xt,children:[D==="critique"&&c.jsxs("form",{ref:r,children:[c.jsx(G0,{id:"feedback-other",placeholder:e==="thumbsUp"?f.formatMessage(Pe.thumbsUpPlaceholder):e==="report"?f.formatMessage(Pe.reportContentExplanationPlaceholder):f.formatMessage(Pe.thumbsDownPlaceholder),rows:3,className:"mb-1 mt-4 w-full resize-none rounded-md bg-token-main-surface-primary"}),e==="thumbsDown"&&c.jsxs("div",{className:"mb-4",children:[c.jsx(mn,{id:"feedback-harmful",label:f.formatMessage(Pe.harmfulUnsafe)}),c.jsx(mn,{id:"feedback-false",label:f.formatMessage(Pe.notTrue)}),c.jsx(mn,{id:"feedback-not-helpful",label:f.formatMessage(Pe.notHelpful)})]}),e!=null&&!De&&c.jsx(c.Fragment,{children:c.jsxs("div",{className:"mb-4",children:[e==="report"&&c.jsxs(c.Fragment,{children:[c.jsx(mn,{id:"feedback-dont-like-this",label:f.formatMessage(Pe.dontLikeThis)}),c.jsx(mn,{id:"feedback-false",label:f.formatMessage(Pe.notTrue)}),c.jsx(mn,{id:"feedback-not-helpful",label:f.formatMessage(Pe.notHelpful)}),c.jsx(mn,{id:"feedback-harmful-offensive",label:f.formatMessage(Pe.harmfulOffensive)}),c.jsx(mn,{id:"feedback-sexual-abuse",label:f.formatMessage(Pe.sexualAbuse)})]}),e==="moderate"&&c.jsxs(c.Fragment,{children:[Ks.map(([je,rt])=>c.jsx(mn,{id:"feedback-"+je,label:rt},je)),c.jsx(mn,{id:"feedback-copyright",label:f.formatMessage(Pe.copyrightContent)})]}),c.jsx(mn,{id:"feedback-content-other",label:f.formatMessage(Pe.reportOtherContent)})]})})]}),D==="compare"&&ne&&y!==void 0&&c.jsxs("div",{className:J("w-full"),children:[c.jsx("p",{className:J("mb-7 mt-3"),children:c.jsx(j,{...Pe.continueWithChosenAnswer})}),c.jsx(vD,{className:"rounded-md",children:c.jsx(Xl,{children:c.jsx(sa,{currentModelId:a,turnIndex:Q,conversationLeafId:v,isFinalTurn:!1,clientThreadId:o,onChangeItemInView:l,onChangeRating:vt,onRequestMoreCompletions:d,onRequestCompletion:u,showInlineEmbeddedDisplay:!0})})}),c.jsxs("div",{className:J(),children:[c.jsxs("div",{className:J("mb-2 grid w-full grid-cols-2 gap-5"),children:[c.jsx("div",{children:c.jsx("p",{className:J("font-semibold"),children:P})}),c.jsx("div",{children:c.jsx("p",{className:J("font-semibold"),children:ce})})]}),c.jsxs("div",{className:J("mb-5 grid w-full grid-cols-2 gap-5"),children:[c.jsxs(Wh,{children:[c.jsx(Xl,{children:c.jsx(sa,{currentModelId:a,turnIndex:b,conversationLeafId:m,isFinalTurn:!0,clientThreadId:o,onChangeItemInView:l,onChangeRating:vt,onRequestMoreCompletions:d,onRequestCompletion:u,showInlineEmbeddedDisplay:!0})}),c.jsx($h,{children:c.jsx(Cn.Button,{disabled:!zn,title:Te,onClick:()=>fe("left"),color:"primary"})})]}),c.jsxs(Wh,{children:[c.jsx(Xl,{children:c.jsx(sa,{currentModelId:a,turnIndex:p,conversationLeafId:v,isFinalTurn:!0,clientThreadId:o,onChangeItemInView:l,onChangeRating:vt,onRequestMoreCompletions:d,onRequestCompletion:u,showInlineEmbeddedDisplay:!0})}),c.jsx($h,{children:c.jsx(Cn.Button,{disabled:!zn,title:oe,onClick:()=>fe("right"),color:"primary"})})]})]}),c.jsx("div",{className:J("grid w-full"),children:c.jsxs("div",{className:J("mb-2 text-right"),children:[c.jsx(Cn.Button,{disabled:!zn,title:f.formatMessage(Pe.neitherAnswerBetter),color:"primary",onClick:()=>fe("same"),className:J("mr-2")}),c.jsx(Cn.Button,{title:f.formatMessage(Pe.skipStep),onClick:()=>t()})]})})]})]}),c.jsx(Cn.Actions,{primaryButton:st})]},`RatingModal-${n}`)}const $h=Ke.div`mb-2 mt-auto ml-auto mr-auto`,Wh=Ke.div`relative rounded-md border border-token-border-light bg-token-main-surface-secondary flex flex-col overflow-hidden`,vD=Ke.div`mb-5 border bg-token-main-surface-primary overflow-hidden`,Xl=Ke.div``;function SD({clientThreadId:n,currentLeafId:e,currentModelId:t,onChangeItemInView:s,onRequestMoreCompletions:i,onChangeRating:r,onRequestCompletion:o,ratingModalOpen:a,ratingModalNodeId:l,ratingModalCompletionId:d,sharedConversationReportModalNodeId:u,setRatingModalOpen:f,setSharedConversationReportModalNodeId:h}){const g=ye(),x=k.useRef(null),y=Bv(Jr.SharedConversationModeration),[w,S]=k.useState(!1),_=k.useCallback(E=>{const{customFeedback:R,tags:F,employeeConsented:D}=E;if(a&&l!=null&&l!==""&&(R||F.length>0||D)){const I=z.getServerThreadId(n);W.logEvent(G.reportResult,{id:d,threadId:I,content:R,model:t,rating:a,tags:F}),n&&d&&_e.submitMessageFeedback({message_id:d,conversation_id:I,rating:a,text:R,tags:F,employee_consented:D})}},[a,l,n,d,t]),O=k.useCallback(E=>{const{customFeedback:R,tags:F}=E;if(u!=null&&u!==""){const D=z.getServerThreadId(n);W.logEvent(G.reportResult,{id:d,threadId:D,content:R,model:t,rating:a,tags:F}),_e.submitSharedConversationReportFeedback({message_id:u,shared_conversation_id:D,text:R,tags:F}),S(!0)}},[u,n,d,t,a,S]),T=k.useCallback(async(E,R,F,D,I,$,B,U,V,Y,te)=>{await _e.submitMessageComparisonFeedback({feedback_version:"comparison_feedback_modal:a:1.0",original_message_id:E,new_message_id:R,rating:F,conversation_id:z.getServerThreadId(n),text:Y,tags:te.map(ne=>ne.replace("feedback-","")),completion_comparison_rating:D,new_completion_placement:I,feedback_start_time:$,compare_step_start_time:B,new_completion_load_start_time:U,new_completion_load_end_time:V,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset()})},[n]);return a!=null?c.jsx(Yl,{ratingModalNodeId:l,ratingModalOpen:a,onCloseRatingModal:()=>f(void 0),onSubmitFeedback:_,onHandleChangeFeedbackComparisonRating:T,currentModelId:t,feedbackTextareaRef:x,clientThreadId:n,onChangeItemInView:s,onRequestMoreCompletions:i,onChangeRating:r,onRequestCompletion:o}):u!=null?c.jsx(Yl,{ratingModalNodeId:u,ratingModalOpen:"report",onCloseRatingModal:()=>h(void 0),onSubmitFeedback:O,onHandleChangeFeedbackComparisonRating:vt,currentModelId:t,feedbackTextareaRef:x,clientThreadId:n,onChangeItemInView:s,onRequestMoreCompletions:i,onChangeRating:r,onRequestCompletion:o}):w?c.jsx(Zi,{onClose:()=>S(!1),isOpen:!0,icon:nv,title:g.formatMessage(Ql.reportModalThankYouTitle),description:g.formatMessage(Ql.reportModalThankYouDescription),primaryButton:c.jsx(Cn.Button,{onClick:()=>S(!1),title:g.formatMessage(Ql.reportModalThankYouDismiss)}),type:"danger"}):y?c.jsx(Yl,{ratingModalNodeId:e,ratingModalOpen:"moderate",onCloseRatingModal:()=>xi.closeModal(Jr.SharedConversationModeration),onSubmitFeedback:vt,onHandleChangeFeedbackComparisonRating:vt,currentModelId:t,feedbackTextareaRef:x,clientThreadId:n,onChangeItemInView:s,onRequestMoreCompletions:i,onChangeRating:r,onRequestCompletion:o}):null}const Ql=Ce({reportModalThankYouTitle:{id:"thread.modal.reportModalThankYou.title",defaultMessage:"Thank you for your report!"},reportModalThankYouDescription:{id:"thread.modal.reportModalThankYou.description",defaultMessage:"Thank you for your report."},reportModalThankYouDismiss:{id:"thread.modal.reportModalThankYou.dismissButton",defaultMessage:"Close"}});function CD(n){return n.sort((e,t)=>{const s={activated:0,created:1,claimed:2,subscription_granted:3},i=e.status,r=t.status;return s[i]<s[r]?-1:s[i]>s[r]?1:e.updated_at>t.updated_at?-1:e.updated_at<t.updated_at?1:0})}function MD({isOpen:n,onClose:e}){const t=k.useCallback(()=>{W.logEvent(G.closeAccountPaymentModal),e()},[e]),{data:s,isLoading:i,isSuccess:r}=Vs({queryKey:["referralInvites"],queryFn:()=>_e.getEligibleReferralInvites(),enabled:n}),o=(s==null?void 0:s.invites_remaining)??0,a=r?s.invite_codes:[];return k.useEffect(()=>{n&&(Ae.logEvent("chatgpt_referral_invite_modal_opened"),W.logEvent(G.chatgptReferralInviteModalOpened))},[n]),r?c.jsx(Zi,{size:"custom",noPadding:!0,isOpen:n,onClose:e,type:"success",className:"focus-none !bg-transparent !shadow-none outline-none md:max-w-4xl lg:w-full",children:c.jsx("div",{className:"focus-none flex h-full flex-col items-center justify-start outline-none",children:c.jsx("div",{className:"relative",children:c.jsxs(_D,{children:[c.jsxs("div",{className:"flex w-full flex-row items-center justify-between border-b px-4 py-3 dark:border-gray-700",children:[c.jsx("span",{className:"text-base font-semibold sm:text-base",children:c.jsx(j,{...ln.modalTitle,values:{remainingInviteCount:o}})}),c.jsx(la,{onClick:t})]}),c.jsx("div",{className:"px-4 py-4",children:c.jsx("div",{className:"relative col-span-1 px-3 md:w-[500px] md:px-0",children:c.jsxs("div",{children:[c.jsx("div",{className:"flex flex-col items-center pb-5 pt-4",children:c.jsx(Cy,{className:"h-12 w-12 text-token-text-tertiary"})}),c.jsxs("div",{className:"flex flex-col items-center gap-2 text-center",children:[c.jsx("p",{className:"text-xl font-semibold leading-6",children:c.jsx(j,{...ln.inviteDescription})}),c.jsx("p",{className:"max-w-sm text-xs text-token-text-tertiary",children:c.jsx(j,{...ln.inviteDescriptionFollowUp})})]}),c.jsxs("div",{className:"mt-6",children:[c.jsxs("div",{className:"flex flex-row justify-between px-2",children:[c.jsx("label",{className:"block text-sm font-semibold text-gray-900",children:c.jsx(j,{...ln.referralCodeLabel})}),c.jsx("label",{className:"block text-sm text-token-text-tertiary",children:c.jsx(j,{...ln.inviteRemaining,values:{remainingInviteCount:o}})})]}),i?c.jsx("div",{className:"h-40 py-2",children:c.jsx(Fa,{className:"h-4 w-4"})}):null,(a==null?void 0:a.length)>0&&c.jsx(TD,{referralCodes:a})]})]})})})]})})})}):null}const $o=n=>`${window.location.host}/invite/${n}`,TD=({referralCodes:n})=>{const e=k.useRef(null);return c.jsx("div",{className:"mt-2 flow-root",children:c.jsx("div",{className:"-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8",children:c.jsx("div",{className:"inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8",children:c.jsx("div",{ref:e,className:J("shadow ring-1 ring-black ring-opacity-5 sm:rounded-md",{"h-44 overflow-y-scroll":n.length>4,"overflow-hidden":n.length<=4}),children:c.jsx("table",{className:"min-w-full",children:c.jsx("tbody",{className:"divide-y divide-gray-200 bg-token-main-surface-primary dark:divide-gray-900",children:CD(n).map(t=>c.jsx(ED,{tableRef:e,referralCode:t},t.id))})})})})})})},ED=({referralCode:n,tableRef:e})=>{const t=ye(),s=k.useRef(null),[i,r]=k.useState(!1),[o,a]=k.useState(!1),l=fr(),{mutateAsync:d}=My({mutationFn:()=>_e.postActivateReferralInvite(n.id),onSettled:()=>{l.invalidateQueries({queryKey:["referralInvites"]}),r(!1)},onError:async()=>{xt.danger(t.formatMessage(ln.activateReferralError))},onSuccess:g=>{var y,w;r(!1);const x=g.invite_code;a(!0),Ap($o(x??"")).then(()=>{xt.success(t.formatMessage(ln.copiedReferralToastMessage,{referralInviteCode:x}),{duration:3,hasCloseButton:!0})}),(y=s.current)==null||y.select(),(w=e.current)==null||w.scrollTo(0,0)}}),u=async g=>{switch(g.status){case"created":r(!0),Ae.logEvent("chatgpt_referral_invite_link_activated"),W.logEvent(G.chatgptReferralInviteLinkActivated),await d();break;case"activated":Ae.logEvent("chatgpt_referral_invite_link_copied"),W.logEvent(G.chatgptReferralInviteLinkCopied),navigator.clipboard.writeText($o(g.code_token??"")),a(!0),xt.success(t.formatMessage(ln.copiedReferralToastMessage,{referralInviteCode:g.code_token}),{duration:3,hasCloseButton:!0});break}},f=`${window.location.host}/invite/`;return c.jsxs("tr",{children:[c.jsxs("td",{className:"relative w-full whitespace-nowrap py-1.5 pl-1 pr-3 text-sm text-gray-900 dark:text-white",children:[c.jsx("input",{ref:s,name:"referral-code",className:"block w-full border-0 bg-transparent py-1.5 pl-2 text-token-text-primary shadow-none ring-0 ring-inset placeholder:text-gray-600 focus:ring-0 focus:ring-inset placeholder:dark:text-white sm:text-sm",disabled:n.status!="activated",readOnly:!0,value:n.status=="created"||n.status=="subscription_granted"?"":$o(n.code_token)}),c.jsxs("span",{className:"absolute top-3 flex items-center pl-2 text-token-text-secondary",children:[n.status=="created"&&c.jsxs("span",{children:[f,c.jsx("span",{className:"select-none text-token-text-tertiary",children:"•••••••"})]}),n.status=="subscription_granted"&&c.jsx("span",{className:"select-none line-through opacity-25",children:$o(n.code_token)})]})]}),c.jsx("td",{className:"relative whitespace-nowrap py-1.5 pl-3 pr-2 text-right text-sm font-semibold sm:pr-2",children:c.jsx(Xe,{disabled:i||n.status=="claimed"||n.status=="subscription_granted",loading:i,onClick:()=>u(n),color:n.status==="created"||n.status==="activated"?"primary":"secondary",children:c.jsx("span",{className:"flex flex-row items-center",children:n.status=="created"?c.jsx(j,{...ln.referralActivate}):n.status=="activated"?o?c.jsx(j,{...ln.referralCopied}):c.jsx(j,{...ln.referralCopy}):n.status=="claimed"?c.jsx(j,{...ln.referralClaimed}):n.status=="subscription_granted"?c.jsx(j,{...ln.referralClaimed}):null})})})]})},_D=Ke.div`flex grow justify-center popover bg-token-main-surface-primary rounded-md flex-col items-start overflow-hidden border shadow-md border-token-border-light`,ln=Ce({modalTitle:{id:"InviteReferralModal.modalTitle",defaultMessage:"Refer a friend"},inviteFormTitle:{id:"InviteReferralModal.inviteFormTitle",defaultMessage:"Emails"},invitePlaceholder:{id:"InviteReferralModal.invitePlaceholder",defaultMessage:"friend@openai.com, friend2@openai.com..."},referralActivate:{id:"InviteReferralModal.referralActivate",defaultMessage:"Copy"},referralCopy:{id:"InviteReferralModal.referralCopy",defaultMessage:"Copy"},referralCopied:{id:"InviteReferralModal.referralCopied",defaultMessage:"Copied"},referralClaimed:{id:"InviteReferralModal.referralClaimed",defaultMessage:"Claimed"},inviteDescription:{id:"InviteReferralModal.inviteDescription",defaultMessage:"Share ChatGPT Plus with your friends!"},inviteDescriptionFollowUp:{id:"InviteReferralModal.inviteDescriptionFollowUp",defaultMessage:"Activate and copy the referral links below to share ChatGPT Plus with your friends, giving them access to a free trial!"},inviteRemaining:{id:"InviteReferralModal.inviteRemaining",defaultMessage:"{remainingInviteCount} available"},usersInvited:{id:"InviteReferralModal.usersInvited",defaultMessage:"<showcaseValue>{usersInviteCount}</showcaseValue><description>users invited</description>"},referralCodeLabel:{id:"InviteReferralModal.referralCodeLabel",defaultMessage:"Links"},sendInviteCta:{id:"InviteReferralModal.sendInviteCta",defaultMessage:"Send invites"},clickToActivateString:{id:"InviteReferralModal.clickToActivateString",defaultMessage:"chatgpt.com/invite/<codeStyle>•••••••</codeStyle>"},clickToCopyString:{id:"InviteReferralModal.clickToCopyString",defaultMessage:"Click to copy"},copiedReferralToastMessage:{id:"InviteReferralModal.copiedReferralToastMessage",defaultMessage:"Your referral link {referralInviteCode} has been copied to your clipboard. Share it with your friends!"},activateReferralError:{id:"InviteReferralModal.activateReferralError",defaultMessage:"Failed to accept referral invite. Please try again."}}),AD=({clientThreadId:n})=>{const e=Ln(),t=Bn(n),{data:s,isLoading:i}=$s(t);if(i)return null;const r=e!=null&&e.id?s?Zl.loggedInCtaGizmo:Zl.loggedInCta:Zl.loggedOutCta,o=e&&s?Ep(s):"/";let a=G.sharedConversationLoggedOutClicked;return e&&(e.isFree()?a=s?G.sharedConversationFreeGizmoClicked:G.sharedConversationFreeClicked:a=s?G.sharedConversationPaidGizmoClicked:G.sharedConversationPaidClicked),c.jsx("div",{className:"flex flex-col items-center gap-4",children:c.jsx(Ak,{href:o,onClickTrackingEventName:a,children:c.jsx(j,{...r,values:{name:s==null?void 0:s.gizmo.display.name}})})})},Zl=Ce({loggedOutCta:{id:"GizmoSharedConversationCTA.loggedOutCta",defaultMessage:"Sign up to chat"},loggedInCtaGizmo:{id:"GizmoSharedConversationCTA.loggedInCtaGizmo",defaultMessage:"Get started with {name}"},loggedInCta:{id:"GizmoSharedConversationCTA.loggedInCta",defaultMessage:"Get started with ChatGPT"}});function ND({clientThreadId:n,isModeratingThread:e,continueConversationUrl:t}){const s=ur(),i=ye();return c.jsxs("div",{className:"relative flex w-full flex-1 flex-col items-center justify-center gap-2 pt-3 empty:hidden sm:flex-row",children:[c.jsx(AD,{clientThreadId:n}),e&&c.jsx(Xe,{onClick:()=>{xi.openModal(Jr.SharedConversationModeration)},children:i.formatMessage({id:"thread.sharedConversation.moderate",defaultMessage:"Moderate conversation"})}),(s==null?void 0:s.includes("debug"))&&t&&c.jsx(Xe,{color:"secondary",as:"link",to:t,icon:sv,size:"giant",children:i.formatMessage({id:"thread.sharedConversation.continue",defaultMessage:"Continue this conversation"})})]})}function ID({children:n}){const e=Mi(Ws.AG8PqS2q),{eligible:t,isLoading:s}=Jv(),{doesUserHaveAnyAccountsWithPlusFeatures:i}=cr(),r=t&&!s;if(k.useEffect(()=>{r&&W.logEvent(G.gpt4oNUXTooltipShown)},[r]),!r)return c.jsx(c.Fragment,{children:n});const o=()=>{W.logEvent(G.gpt4oNUXTooltipDismissed),e.markAsViewed()};return c.jsx(Za,{side:"bottom",show:!0,title:c.jsx(j,{...ec.title,values:{modelName:"GPT‑4o"}}),onDismiss:o,sideOffset:0,theme:"default",description:c.jsx(j,{...i?ec.bodyPaidFinal:ec.bodyFreeFinal,values:{modelName:"GPT‑4o",anotherModelName:"GPT‑4"}}),children:n})}const ec=Ce({title:{id:"1kewDD",defaultMessage:"Introducing {modelName}"},bodyPaidFinal:{id:"Z6KHqN",defaultMessage:"You can now try our newest model, {modelName}. It’s faster than {anotherModelName}, better at understanding images, and speaks more languages."},bodyFreeFinal:{id:"w8Y79o",defaultMessage:"You now have limited access to our latest model, {modelName}. It’s smarter, understands images, can browse the web, and speaks more languages."}}),RD=()=>{const n=yr(),e=Va(),t=()=>{const o=n({authType:"login"});W.logLogInButtonClicked({location:"Model switcher dropdown",provider:o}),Ae.logEvent("chatgpt_modelswitcher_login_button_clicked")},s=()=>{const o=n({authType:"signup"});W.logSignUpButtonClicked({location:"Model switcher dropdown",provider:o}),Ae.logEvent("chatgpt_modelswitcher_signup_button_clicked")},i=c.jsx(Xe,{as:"button",size:"medium",color:e?"primary":"secondary",onClick:t,children:c.jsx(j,{id:"NavigationContent.unauthLoginCta",defaultMessage:"Log in"})}),r=c.jsx(Xe,{as:"button",size:"medium",color:e?"secondary":"primary",onClick:s,children:c.jsx(j,{id:"NavigationContent.unauthSignupCta",defaultMessage:"Sign up"})});return c.jsxs("div",{className:"p-4",children:[c.jsxs("div",{className:"mb-4",children:[c.jsx("p",{className:"text-md mb-1 font-medium text-token-text-primary",children:e?c.jsx(j,{id:"5JLF3H",defaultMessage:"Log in to try advanced features"}):c.jsx(j,{id:"g7yYMy",defaultMessage:"Sign up to try GPT 4o for free"})}),c.jsx("p",{className:"text-sm text-token-text-secondary",children:c.jsx(j,{id:"pyWwm8",defaultMessage:"Get smarter responses, upload files, analyze images, and more by logging in."})})]}),c.jsx("div",{className:"flex flex-row justify-start space-x-2",children:e?[i,r]:[r,i]})]})};function DD({currentModel:n,categoryOptions:e,className:t,modelSwitcherDenialsBySlug:s}){const i=n==null?void 0:n.id;return c.jsx(Oe.Portal,{children:c.jsx(Oe.SubContent,{className:t,children:e.map(r=>{const{value:o}=r;return"options"in r?c.jsx(ra,{currentModel:n,isSelected:i.startsWith(o),option:r,modelSwitcherDenialsBySlug:s},o):c.jsx(oa,{isSelected:i===o,value:o,renderName:()=>r.name,modelSwitcherDenialsBySlug:s,showNewChatHint:!1},o)})})})}function ra({currentModel:n,option:e,isSelected:t=!1,modelSwitcherDenialsBySlug:s}){const{name:i,options:r,categoryId:o}=e,a=`${i} Models`,l=()=>c.jsx("div",{className:"flex shrink-0 grow justify-between gap-2",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(rv,{className:"icon-md w-7 text-token-text-secondary"}),a]})});return c.jsxs(Oe.Sub,{children:[c.jsx(Oe.SubMenuTrigger,{children:c.jsxs("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:[o?l():i,t&&c.jsx("div",{className:"truncate text-token-text-tertiary",children:n.title})]})}),c.jsx(DD,{currentModel:n,categoryOptions:r,modelSwitcherDenialsBySlug:s})]})}function oa({value:n,renderName:e,isSelected:t,showNewChatHint:s=!0,onClick:i,modelSwitcherDenialsBySlug:r,isUpgradeUpsell:o=!1}){var f,h;const a=ep(),l=AS(),d=n?(h=(f=r[n])==null?void 0:f.conversation)==null?void 0:h[0]:null,u=c.jsx(Oe.Item,{onClick:()=>{if(i)i();else if(n){const g=n;a({modelId:g,location:"Model switcher menu item"}),l(g)}},className:J("!pr-3",t&&"!opacity-100",d&&"pointer-events-none text-token-text-quaternary"),children:c.jsxs("div",{className:"flex grow items-center justify-between gap-2",children:[c.jsx("div",{children:e(d!=null)}),o&&c.jsx(Xe,{color:"secondary",size:"small",children:c.jsx(j,{id:"oKo8wt",defaultMessage:"Upgrade"})}),o?c.jsx(c.Fragment,{children:t&&c.jsx(gm,{className:J("icon-md group-hover:invisible",!s&&"block group-hover:hidden")})}):t&&c.jsx(iv,{className:"icon-md"})]})},n);return d?c.jsx(bs,{isLeftArrow:!0,sideOffset:-10,label:c.jsx(Q0,{modelSwitcherDeny:d}),children:u}):u}const jD=Ve(()=>Ue(()=>import("./it7h829f0ifo3smd.js"),__vite__mapDeps([120,1,2,3,19,4,5,15,13,6,14,121,8,9,10,122,103,123,23,124,20,60,61,62,63,35,17,18,58,25,59,32,104,125,102])).then(n=>n.ThreadHeaderGizmoDropdown)),PD=Ve(()=>Ue(()=>import("./sso-ihqxdzxswuiox36n.js").then(n=>n.h),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100])).then(n=>n.default)),Hh=Ke.div`group flex cursor-pointer items-center gap-1 rounded-lg py-1.5 px-3 text-lg font-semibold hover:bg-token-main-surface-secondary radix-state-open:bg-token-main-surface-secondary text-token-text-secondary overflow-hidden whitespace-nowrap`;function OD({clientThreadId:n}){const e=ye(),t=ys(),s=Sd(n),i=vi(),r=()=>{xv(i,s,t,!0)};return c.jsx(Oe.Item,{size:"large",className:"!pr-3",onClick:r,icon:Ad,children:c.jsxs("div",{className:"flex grow items-center justify-between gap-2",children:[c.jsx("div",{className:"flex flex-1 items-center gap-3",children:c.jsx(j,{...VD.temporaryChat})}),c.jsx(vS,{onChange:r,enabled:t,label:e.formatMessage({defaultMessage:"Temporary",id:"temporaryChatToggleLabel"})})]})})}function yx(n,e,t){let s=n;if(n===Mu.AUTO){const o=e.filter(({defaultModel:a})=>a!==Mu.AUTO);o.length===1&&(s=o[0].defaultModel)}const i=e.find(({defaultModel:o})=>o===s);if(i){const{categoryId:o,shortLabel:a}=i;return{selectedCategory:o,modelLabel:a}}const r=t.find(({modelIds:o})=>o.includes(s));if(r){const{group:o,shortLabel:a}=r;return{selectedCategory:o,modelLabel:a}}return{selectedCategory:null,modelLabel:null}}function FD({modelLabel:n}){return c.jsx("span",{className:"text-token-text-secondary",children:n})}function LD({clientThreadId:n,inMobileHeader:e}){const{isLoading:t,categories:s,groups:i}=ro(),r=Ty(),a=ed(n).id,l=hu(),{modelLabel:d}=yx(a,s,i),u=BD(n,l),f=ye(),{isUnauthenticated:h}=Dt(),g=bx(),x=(!h||!g)&&!r;k.useEffect(()=>{var w;t||(w=Xp({namespace:fa.ChatPageLoad}))==null||w.logTiming("render_model_switcher")},[t]);const y=c.jsxs("div",{className:"text-token-text-secondary",children:[Nk," ",x?c.jsx("span",{className:"text-token-text-secondary",children:d}):h&&d?c.jsx(FD,{modelLabel:d}):null]});return u.length?t?null:c.jsx(Vv,{sideOffset:8,size:"large",triggerButton:c.jsxs(Hh,{"aria-label":d?f.formatMessage({id:"JrtGPQ",defaultMessage:"Model selector, current model is {modelLabel}"},{modelLabel:d}):"",children:[y,c.jsx(mo,{className:"icon-md text-token-text-tertiary"})]}),onOpenChange:w=>{W.logEvent(G.toggleModelSwitcher,{isOpen:w}),Ae.logEvent("toggle_model_switcher",null,{isOpen:String(w)})},contentAlign:e?"center":"start",children:c.jsx(UD,{sections:u})}):c.jsx(Hh,{className:"cursor-default",children:y})}function bx(){return La("462735957").value}function BD(n,e){var te,ne,pe;const t=ed(n),s=t.id,i=Bn(n),{categories:r,groups:o}=ro(),{doesUserHaveAnyAccountsWithPlusFeatures:a}=cr(),l=z.getServerThreadId(n),d=Y0({clientThreadId:n}),u=gv(),f=ye(),h=!l,{isUnauthenticated:g}=Dt(),x=yr(),{layer:y}=oo("2723963139"),w=y.get("is_dynamic_model_enabled",!1),S=bx(),_=e.find(({categoryId:H})=>H===ti.ALPHA),O=e.find(({categoryId:H})=>H===ti.EXPERIMENTS),T=e.find(({categoryId:H})=>H===ti.MAINLINE),E=!!((te=_==null?void 0:_.options)!=null&&te.length),R=!!((ne=O==null?void 0:O.options)!=null&&ne.length),F=!!((pe=T==null?void 0:T.options)!=null&&pe.length),D=Gs(),I=k.useCallback(()=>{W.logEvent(G.openModalAccountPaymentfromModelPicker,{content:"gizmo-button"}),go(D,"Thread header dropdown")},[D]),$=()=>{if(Ae.logEvent("chatgpt_model_switcher_plus_upgrade_button_clicked"),W.logEvent(G.modelSwitcherPlusUpgradeButtonClicked),g){Ey.setCookie(_y.ShowPaymentModal,!0,{maxAge:6*60*60});const H=x();W.logSignUpButtonClicked({location:"Model switcher GPT-4 upsell",provider:H})}else I()},B=[],U=c.jsxs("div",{className:"mb-1 flex items-center justify-between px-5 pt-2",children:[c.jsx("span",{className:"text-sm text-token-text-tertiary",children:c.jsx(j,{id:"ilkdMh",defaultMessage:"Model"})}),c.jsx("a",{href:w?"https://help.openai.com/en/articles/9155758-what-is-the-chatgpt-plus-model-selector":"https://help.openai.com/en/articles/7102672-how-can-i-access-gpt-4",target:"_blank",rel:"noreferrer",children:c.jsx(nr,{className:"icon-md h-5 w-5 pl-0.5 text-token-text-tertiary"})})]},"header");if(S&&g){const H={id:"modelSection",content:[]};H.content.push(c.jsx(RD,{},"noAuthUpsell")),B.push(H)}else if(a){const H={id:"modelSection",content:[]};r.length&&H.content.push(U);for(const{categoryId:L,defaultModel:ue,label:le,description:Q}of r)H.content.push(c.jsx(oa,{value:ue,modelSwitcherDenialsBySlug:d,renderName:Ge=>c.jsx(tc,{categoryId:L,name:le,description:Q,isDisabled:Ge}),isSelected:!i&&s===ue},ue));B.push(H)}else{const H={id:"modelSection",content:[]};H.content.push(c.jsx(oa,{value:"",onClick:$,modelSwitcherDenialsBySlug:d,isUpgradeUpsell:!0,renderName:L=>c.jsx(tc,{icon:av,isDisabled:L,name:f.formatMessage({id:"mzDzkX",defaultMessage:"ChatGPT Plus"}),description:f.formatMessage({id:"bqTHri",defaultMessage:"Our smartest model & more"})}),isSelected:!1,showNewChatHint:!1},"plusUpgrade")),H.content.push(c.jsx(oa,{value:ml.AUTO,modelSwitcherDenialsBySlug:d,renderName:L=>c.jsx(tc,{icon:ov,name:f.formatMessage({id:"U9E7Rx",defaultMessage:"ChatGPT"}),description:f.formatMessage({id:"n96qML",defaultMessage:"Great for everyday tasks"}),isDisabled:L}),isSelected:!i&&s===ml.AUTO,showNewChatHint:!0},ml.AUTO)),B.push(H)}const V={id:"otherOptionsSection",content:[]},{selectedCategory:Y}=yx(s,r,o);return h&&(E&&V.content.push(c.jsx(ra,{isSelected:Y===ti.ALPHA,currentModel:t,option:_,modelSwitcherDenialsBySlug:d},_.value)),R&&V.content.push(c.jsx(ra,{currentModel:t,isSelected:Y===ti.EXPERIMENTS,option:O,modelSwitcherDenialsBySlug:d},O.value)),F&&V.content.push(c.jsx(ra,{isSelected:Y===ti.MAINLINE,currentModel:t,option:T,modelSwitcherDenialsBySlug:d},T.value))),u&&V.content.push(c.jsx(PD,{clientThreadId:n},"c")),V.content.length&&B.push(V),g||B.push({id:"temporaryChatSection",content:[c.jsx(OD,{clientThreadId:n},"tempChat")]}),B}function tc({isDisabled:n,name:e,icon:t,categoryId:s,description:i,extra:r}){return c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("span",{className:"flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-full bg-token-main-surface-secondary",children:t?c.jsx(t,{className:"h-4 w-4 text-token-text-primary"}):s&&c.jsx(pu,{type:"filled",className:J("h-4 w-4",n&&"text-gray-300",!n&&"text-token-text-primary"),categoryId:s})}),c.jsxs("div",{children:[e,c.jsxs("div",{className:J(!n&&"text-token-text-secondary","text-xs"),children:[i,r]})]})]})}function UD({sections:n}){return c.jsx(c.Fragment,{children:n.map((e,t)=>c.jsxs(co.Fragment,{children:[t!==0?c.jsx(Oe.Separator,{}):null,e.content]},e.id))})}function zD({clientThreadId:n,inMobileHeader:e=!1}){const t=Bn(n);return t==null?c.jsx(LD,{clientThreadId:n,inMobileHeader:e}):c.jsx(jD,{clientThreadId:n,gizmoId:t,inMobileHeader:e})}const VD=Ce({gpt35ShortExplainer:{defaultMessage:"Great for everyday tasks",id:"ModelSwitcher.gpt35ShortExplainer"},modelTunerSmartSelectionTitle:{id:"czjW8I",defaultMessage:"Dynamic"},modelTunerSmartSelectionExplainer:{id:"gp/YH1",defaultMessage:"Optimized for speed and intelligence"},gpt4ShortExplainer:{defaultMessage:"With DALL·E, browsing and analysis",id:"ModelSwitcher.gpt4ShortExplainer"},gpt4ShortExplainerWithoutBrowse:{defaultMessage:"With DALL·E and analysis",id:"ModelSwitcher.gpt4ShortExplainerWithoutBrowse"},gpt4UpsellExplainer:{id:"ModelSwitcher.gpt4Upsell",defaultMessage:"Our smartest and most capable model. Includes DALL·E, browsing and more."},userUpgrade:{id:"ModelSwithcer.upgradeButton",defaultMessage:"Upgrade to Plus"},userUpgradeSignup:{id:"ModelSwitcher.signupUpgradeButton",defaultMessage:"Sign up for ChatGPT Plus"},temporaryChat:{id:"ModelSwitcher.temporaryChat",defaultMessage:"Temporary chat"},shareChat:{id:"ModelSwitcher.shareChat",defaultMessage:"Share chat"}}),kx=Ws.TemporaryChatOnboarding;function GD(){const n=ys(),{eligible:e}=Mi(kx);return e&&n}function _r({icon:n,title:e,description:t}){return c.jsxs("div",{className:"flex items-start",children:[c.jsx("div",{className:"mt-1 h-5 w-5",children:n}),c.jsxs("div",{className:"ml-4",children:[c.jsx("div",{className:"text-lg font-semibold",children:e}),c.jsx("p",{className:"mt-1 text-sm text-token-text-secondary",children:t})]})]})}function $D({onClose:n}){const[e,t]=k.useState(!0),s=Ln(),i=ye(),{markAsViewed:r}=Mi(kx),o=cd(),a=k.useCallback(()=>{r(),t(!1),n==null||n()},[r,n]);return s!=null&&s.isWorkspaceAccount()?c.jsx(Zi,{isOpen:e,onClose:vt,size:"custom",className:"max-w-xl",type:"success",title:i.formatMessage(it.title),primaryButton:c.jsx(Cn.Button,{onClick:a,title:i.formatMessage(it.continue),color:"primary"}),children:c.jsxs("div",{className:"mb-6 flex flex-col gap-3",children:[c.jsx(_r,{icon:c.jsx(it.bulletTitle1.Icon,{}),title:i.formatMessage(it.bulletTitle1),description:i.formatMessage({id:"nSGhxr",defaultMessage:"Temporary chats won't appear in your history."})}),c.jsx(_r,{icon:o?c.jsx(it.bulletTitle2MemoryAvailable.Icon,{}):c.jsx(it.bulletTitle2MemoryUnavailable.Icon,{}),title:i.formatMessage(o?it.bulletTitle2MemoryAvailable:it.bulletTitle2MemoryUnavailable),description:i.formatMessage(o?it.bulletDescription2MemoryAvailable:it.bulletDescription2MemoryUnavailable)})]})}):c.jsx(Zi,{isOpen:e,onClose:vt,size:"custom",className:"max-w-xl",type:"success",title:i.formatMessage(it.title),primaryButton:c.jsx(Cn.Button,{onClick:a,title:i.formatMessage(it.continue),color:"primary"}),children:c.jsxs("div",{className:"mb-6 flex flex-col gap-3",children:[c.jsx(_r,{icon:c.jsx(it.bulletTitle1.Icon,{}),title:i.formatMessage(it.bulletTitle1),description:i.formatMessage(it.bulletDescription1)}),c.jsx(_r,{icon:c.jsx(it.bulletTitle3.Icon,{}),title:i.formatMessage(it.bulletTitle3),description:i.formatMessage(it.bulletDescription3)}),c.jsx(_r,{icon:o?c.jsx(it.bulletTitle2MemoryAvailable.Icon,{}):c.jsx(it.bulletTitle2MemoryUnavailable.Icon,{}),title:i.formatMessage(o?it.bulletTitle2MemoryAvailable:it.bulletTitle2MemoryUnavailable),description:i.formatMessage(o?it.bulletDescription2MemoryAvailable:it.bulletDescription2MemoryUnavailable)})]})})}const it=Ce({title:{id:"TemporaryChatOnboardingModal.title",defaultMessage:"Temporary Chat"},bulletTitle1:{Icon:Ad,id:"TemporaryChatOnboardingModal.bulletTitle1",defaultMessage:"Not in history"},bulletDescription1:{id:"TemporaryChatOnboardingModal.bulletDescription1.1",defaultMessage:"Temporary chats won't appear in your history. For safety purposes, we may keep a copy of your chat for up to 30 days."},bulletTitle2MemoryAvailable:{Icon:lv,id:"TemporaryChatOnboardingModal.bulletTitle2MemoryAvailable",defaultMessage:"Memory off"},bulletDescription2MemoryAvailable:{id:"Ziehyb",defaultMessage:"While in a Temporary Chat, ChatGPT won't use or create memories. Custom Instructions will still be followed if you have them enabled."},bulletTitle2MemoryUnavailable:{Icon:cv,id:"TemporaryChatOnboardingModal.bulletTitle2MemoryUnavailable",defaultMessage:"Follows Custom Instructions"},bulletDescription2MemoryUnavailable:{id:"TemporaryChatOnboardingModal.bulletDescription2MemoryUnavailable",defaultMessage:"Custom Instructions will still be followed if you have them enabled."},bulletTitle3:{Icon:$v,id:"TemporaryChatOnboardingModal.bulletTitle3",defaultMessage:"No model training"},bulletDescription3:{id:"TemporaryChatOnboardingModal.bulletDescription3",defaultMessage:"Temporary chats won't be used to improve our models."},continue:{id:"TemporaryChatOnboardingModal.continue",defaultMessage:"Continue"}}),WD=Ve(()=>Ue(()=>import("./lig9eswxocc0gjns.js"),__vite__mapDeps([126,1,2,3,127,128,19,4,5,15,13,6,14,129,76,28,9,10,7,8,11,12,20,24,25,18,23,26,27,29,30,31,124,60,61,62,63,35,17,58,59,32,130,102,125,131,132,133,134])).then(n=>n.GizmoUsingAsOwnerNotice)),HD=({clientThreadId:n})=>{const e=Fd(l=>l.activeStageSidebar),t=z.getServerThreadId(n),s=Ik(Si.WorkspaceShareLinks),{isUnauthenticated:i}=Dt(),r=ys(),o=s&&t&&!i&&!r,a=!e;return c.jsx("div",{className:"flex items-center gap-2 pr-1 leading-[0]",children:c.jsx(bv,{showShareButton:o,showProfileDropdown:a,clientThreadId:n})})};function qD({clientThreadId:n,gizmoId:e}){var r;const t=GD(),{data:s}=$s(e),i=Ln();return c.jsxs(c.Fragment,{children:[c.jsxs(hw,{children:[c.jsxs("div",{className:"absolute start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2",children:[s!=null&&(i==null?void 0:i.isWorkspaceAccount())&&((r=s.gizmo.tags)==null?void 0:r.includes(ld.WorkspaceDisabled))&&c.jsx(WD,{gizmo:s}),c.jsx(LS,{gizmoId:e,clientThreadId:n})]}),c.jsx(ID,{children:c.jsxs("div",{className:"flex items-center gap-0 overflow-hidden",children:[c.jsx(yv,{clientThreadId:n}),c.jsx(zD,{clientThreadId:n})]})}),c.jsx(HD,{clientThreadId:n})]}),t&&c.jsx($D,{})]})}function wx({clientThreadId:n}){const e=Bn(n),t=xr();return lo()?t?null:c.jsx(qD,{gizmoId:e,clientThreadId:n}):c.jsx("div",{className:"h-1.5"})}function KD({clientThreadId:n,currentModelId:e,onRequestCompletion:t,enableV2Homepage:s}){const i=ys();let r=c.jsx(yw,{}),o;return i?(o=c.jsx(JD,{}),r=c.jsx(Em,{className:"mb-6 h-12 w-12"})):n!=null?(o=s?c.jsx(DN,{clientThreadId:n,currentModelId:e,onRequestCompletion:t}):c.jsx(bw,{clientThreadId:n}),r=null):o=c.jsx(YD,{}),c.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-token-text-primary",children:[r,o]})}function JD({gizmo:n}){const e=cd(),t=n?RS(n.tools):!1,s=Ln();return c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"mb-5 text-2xl font-semibold",children:c.jsx(j,{...ni.temporaryChat})}),c.jsxs("div",{className:"max-w-sm text-center text-sm font-normal text-token-text-tertiary",children:[c.jsx(j,{...s!=null&&s.isWorkspaceAccount()?e?ni.temporaryChatBizMemoryAvailable:ni.temporaryChatBizMemoryUnavailable:e?ni.temporaryChatDescriptionMemoryAvailable:ni.temporaryChatDescriptionMemoryUnavailable}),t&&c.jsx("div",{className:"mt-3",children:c.jsx(j,{...ni.temporaryChatDescriptionGptActions,values:{link:i=>c.jsx("a",{href:"https://help.openai.com/en/articles/8914046-temporary-chat-faq",target:"_blank",className:"underline",rel:"noreferrer",children:i})}})})]})]})}function YD(){return c.jsx("div",{className:"mb-5 text-2xl font-semibold",children:c.jsx(j,{...ni.howCanIHelpYouToday})})}function XD({clientThreadId:n,currentModelId:e,onRequestCompletion:t,enableV2Homepage:s}){const i=Bn(n),r=Rk(),o=rd(),{data:a}=$s(i);return(r!=null||i!=null)&&a==null?null:c.jsxs("div",{className:"relative h-full",children:[c.jsx("div",{className:"absolute left-0 right-0",children:c.jsx(wx,{clientThreadId:n})}),a!=null?c.jsx(xw,{gizmo:a,showStarterPrompts:!0,disableStarterPrompts:o}):c.jsx(KD,{clientThreadId:n,currentModelId:e,onRequestCompletion:t,enableV2Homepage:s})]})}const ni=Ce({temporaryChat:{id:"GizmoLanding.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatBizMemoryAvailable:{id:"g1opBW",defaultMessage:"This chat won't appear in your history and won't use or create memories."},temporaryChatBizMemoryUnavailable:{id:"fQmbtG",defaultMessage:"This chat won't appear your conversation history."},temporaryChatDescriptionMemoryAvailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryAvailable",defaultMessage:"This chat won't appear in history, use or create memories, or be used to train our models. For safety purposes, we may keep a copy for up to 30 days."},temporaryChatDescriptionMemoryUnavailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryUnavailable",defaultMessage:"This chat won't appear in history or be used to train our models. For safety purposes, we may keep a copy of this chat for up to 30 days."},temporaryChatDescriptionGptActions:{id:"GizmoLanding.temporaryChatDescriptionGptActions",defaultMessage:"Any data shared with a third party through GPT actions are subject to the third party's privacy policy. <link>Learn more</link>"},howCanIHelpYouToday:{id:"GizmoLanding.howCanIHelpYouToday",defaultMessage:"How can I help you today?"}});function QD(n){var t,s;const e=(t=n.message.metadata)==null?void 0:t.aggregate_result;return(s=e==null?void 0:e.messages)==null?void 0:s.some(Ld)}function ZD(n){const e=n.message.content;return("parts"in e?e.parts.join(""):"").includes("sandbox:")}function ej(n){return n.some(e=>e.messages.some(t=>QD(t)||ZD(t)))}function tj({clientThreadId:n}){const e=rw(n),t=sm(n),s=xs(u=>qt.getThreadCreateTime(n,u)),i=Qn(n),r=nm(n,i),o=k.useMemo(()=>ej(r),[r]),a=ow(n),l=aw(n),d=a||l;return c.jsxs("div",{className:"border-b border-gray-100 px-4 pb-4 pt-3 sm:mb-2 sm:pb-6 sm:pt-8 md:px-0",children:[c.jsx("h1",{className:"text-3xl font-semibold leading-tight text-token-text-primary sm:text-4xl",children:e}),(t!=null||s!=null)&&c.jsxs("div",{className:"pt-3 text-base text-gray-400 sm:pt-4",children:[t!=null&&c.jsx("span",{children:t}),t!=null&&s!=null&&c.jsx("span",{className:"px-2",children:"•"}),s!=null&&c.jsx(Ay,{value:s,month:"long",year:"numeric",day:"numeric"})]}),c.jsx(nj,{shouldShowCodeInterpreterDisclaimer:o,shouldShowPersonalizedDataDisclaimer:d})]})}const nj=({shouldShowCodeInterpreterDisclaimer:n,shouldShowPersonalizedDataDisclaimer:e})=>c.jsxs(c.Fragment,{children:[n&&c.jsx("div",{className:"mt-4",children:c.jsx(Ou,{icon:nr,children:c.jsx(j,{id:"sharedConversation.advancedDataAnalysisSupportDisclaimer",defaultMessage:"This chat contains files or images produced by Advanced Data Analysis which are not yet visible in Shared Chats."})})}),e&&c.jsx("div",{className:"mt-4",children:c.jsx(Ou,{icon:nr,children:c.jsx(j,{id:"sharedConversation.personalizedDataDisclaimer",defaultMessage:"This conversation may reflect the link creator’s personalized data, which isn’t shared and can meaningfully change how the model responds."})})})]}),sj=n=>{const e=ys();return k.useCallback(t=>{var a,l;Dk(t);const{target:s}=t;if(!(s instanceof Element))return;const i=(a=s.closest("[data-message-id]"))==null?void 0:a.getAttribute("data-message-id"),r=(l=document.getSelection())==null?void 0:l.toString(),o=z.getServerThreadId(n);!i||!r||!o||e||_e.submitImplicitMessageFeedback({source:"keyboard",type:"copy",messageId:i,serverThreadId:o,selectedText:r})},[n,e])};function ij({onChangeItemInView:n,onRequestMoreCompletions:e,onChangeRating:t,onRequestCompletion:s,clientThreadId:i,conversationLeafId:r,inlineEmbeddedDisplay:o,initiallyHighlightedMessageId:a,hideHeader:l,renderOnlyTurns:d}){const u=en(),f=xr(),h=cS(),[g]=dS(),x=Hs(i),y=Ln(),w=ed(i),S=u.store.useContentAreaDimensions(tr.Header,V=>V!=null&&V.height?V.height:void 0),_=u.store.useIsHeaderContentAreaPopulated(),O=im(i),{isArchived:T}=O,E=VN(w.id),R=(x==null?void 0:x.kind)===tt.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":E,F=rm(i,r),D=Ja(),I=k.useCallback(()=>{h({behavior:"smooth"})},[h]),$=(V=!0)=>[...new Array(F).keys()].map(Y=>c.jsx(sa,{isFinalTurn:V&&Y===F-1,turnIndex:Y,clientThreadId:i,conversationLeafId:r,onChangeItemInView:n,onChangeRating:t,onRequestMoreCompletions:e,onRequestCompletion:s,currentModelId:w.id,showInlineEmbeddedDisplay:o,initiallyHighlightedMessageId:a,avatarClassName:R,scrollToBottom:I},Y)),B=sj(i),U=D&&!T;return d?c.jsx(c.Fragment,{children:$(!1)}):c.jsxs("div",{onCopy:B,className:J("flex flex-col text-sm",f&&"pt-2",U&&"pb-[120px]",S||U?null:"md:pb-9"),style:{paddingBottom:S},children:[!l&&(f||(y==null?void 0:y.data))&&!o&&c.jsx(wx,{clientThreadId:i}),f&&!o&&c.jsx(Ed,{children:c.jsx(tj,{clientThreadId:i})}),$(),!g&&!o&&c.jsx(rj,{className:J(S?null:"bottom-5",U?_?"translate-y-[-90px]":"translate-y-[-70px]":""),style:{bottom:S},onClick:()=>{Ae.logEvent("chatgpt_thread_scroll_to_bottom"),h({behavior:"smooth"})},children:c.jsx(dv,{className:"icon-md text-token-text-primary"})})]})}const rj=Ke.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-light right-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`;var oj=jk,aj=NaN;function lj(n,e){var t=n==null?0:n.length;return t?oj(n,e)/t:aj}var cj=lj,dj=cj,uj=Ny;function fj(n){return dj(n,uj)}var hj=fj;const pj=Oa(hj);var vn=(n=>(n.FirstTokenLatency="first_token_lat",n.TotalRequestTime="total_request_time",n.TokenCount="token_count",n.StdDevTokenLatency="std_dev_token_lat",n.MeanTokenLatency="mean_token_lat",n.MedianTokenLatency="median_token_lat",n.MinTokenLatency="min_token_lat",n.MaxTokenLatency="max_token_lat",n.P95TokenLatency="p95_token_lat",n.P99TokenLatency="p99_token_lat",n))(vn||{});const vx=n=>{var h;const e=n.filter(g=>g.requestCount>1);let t=0;for(let g=0;g<n.length;g++){const x=n[g];if(t=x.requestDuration,x.content!=="")break}const s=Fu(e.map(g=>g.lastTokenDuration),.95),i=Fu(e.map(g=>g.lastTokenDuration),.99),r=pj(e.map(g=>g.lastTokenDuration)),o=Ok(e.map(g=>g.lastTokenDuration)),a=e.filter(g=>g.lastTokenDuration!==0).reduce((g,x)=>Math.min(g,x.lastTokenDuration),1/0),l=e.reduce((g,x)=>Math.max(g,x.lastTokenDuration),-1/0),d=Fk(e.map(g=>g.lastTokenDuration)),u=(h=n[n.length-1])==null?void 0:h.requestDuration;return[{id:"first_token_lat",name:"First Token lat.",stat:t>0?`${t.toFixed(2)}ms`:null,value:t>0?t:null,category:"summary"},{id:"total_request_time",name:"Total request time",stat:u?`${(u/1e3).toFixed(2)}s`:null,value:u||null,category:"summary"},{id:"token_count",name:"Token count",stat:`${n.length}`,value:n.length,category:"summary"},{id:"std_dev_token_lat",name:"Std dev Token lat.",stat:`${d.toFixed(2)}`,value:d,category:"token"},{id:"mean_token_lat",name:"Mean Token lat.",stat:r?`${r.toFixed(2)}ms`:null,value:r??null,category:"aggregate"},{id:"median_token_lat",name:"Median Token lat.",stat:o?`${o.toFixed(2)}ms`:null,value:o??null,category:"token"},{id:"min_token_lat",name:"Min Token lat.",stat:`${a.toFixed(2)}ms`,value:a??null,category:"token"},{id:"max_token_lat",name:"Max Token lat.",stat:`${l.toFixed(2)}ms`,value:l??null,category:"token"},{id:"p95_token_lat",name:"p95 Token lat.",stat:s?`${s.toFixed(2)}ms`:null,value:s??null,category:"aggregate"},{id:"p99_token_lat",name:"p99 Token lat.",stat:i?`${i.toFixed(2)}ms`:null,value:i??null,category:"aggregate"}]},i3=()=>{const n=Qp(),e=Pk();if(!n||!e)return{stats:[],targetLatencyData:[]};const t=n[e],s=(t==null?void 0:t.data)??[];return{stats:vx(s),targetLatencyData:s}},mj=(n,e,t,s)=>{Ka.setState(i=>{const r={focusedNodeId:n},o={status:"active",data:[],model:e,serverRequestId:t,preflightTime:s};return{...i,activeNodeId:n,ui:r,messagesDevData:{...i.messagesDevData,[n]:o}}})},gj=(n,e)=>{Ka.setState(t=>{const s=t.messagesDevData[n];return{...t,activeNodeId:n,messagesDevData:{...t.messagesDevData,[n]:{...s,data:[...(s==null?void 0:s.data)??[],e]}}}})},Gn=(n,e)=>{var t;return(t=e.find(s=>s.id===n))==null?void 0:t.value},xj=n=>{const t=Qp()[n],s=vx(t.data),{preflightTime:i,model:r,serverRequestId:o}=t,a={model:r,serverRequestId:o,preflightTime:i,countTokens:Gn(vn.TokenCount,s),tsFirstToken:Gn(vn.FirstTokenLatency,s),tsMaxTokenTime:Gn(vn.MaxTokenLatency,s),tsMeanTokenWithoutFirst:Gn(vn.MeanTokenLatency,s),tsMedianTokenWithoutFirst:Gn(vn.MedianTokenLatency,s),tsMinTokenTime:Gn(vn.MinTokenLatency,s),tsStdDevTokenTime:Gn(vn.StdDevTokenLatency,s),tsP95TokenWithoutFirst:Gn(vn.P95TokenLatency,s),tsP99TokenWithoutFirst:Gn(vn.P99TokenLatency,s),tsTotalRequestTime:Gn(vn.TotalRequestTime,s)};_e.postLatencyTimingEvent(a)},yj=n=>Ka.setState(e=>{const t={...e.messagesDevData[n],status:"finished"};return{...e,messagesDevData:{...e.messagesDevData,[n]:t}}}),r3=n=>Ka.setState(e=>({...e,ui:{...e.ui,focusedNodeId:n}}));class bj{constructor(e){se(this,"requestStartTime",performance.now());se(this,"requestLastTokenTime",performance.now());se(this,"requestCount",0);se(this,"requestTimes",[]);this.requestLatencyId=e}onResponse(e,t,s){var d,u;const i=performance.now(),r=i-this.requestLastTokenTime,o=i-this.requestStartTime;this.requestLastTokenTime=i,this.requestCount+=1;const a=t.content.content_type==Ht.Text?(u=t==null?void 0:t.content)==null?void 0:u.parts[((d=t==null?void 0:t.content)==null?void 0:d.parts.length)-1]:"",l={requestCount:this.requestCount,requestDuration:o,lastTokenDuration:Number(JSON.stringify(r)),messageType:t.content.content_type,content:a};this.requestTimes.push(l),e.type==="message"?gj(this.requestLatencyId,l):e.type==="done"&&s!=null&&(yj(this.requestLatencyId),xj(this.requestLatencyId))}}function qh(n,e){n.updateNodeMetadata(e.id,{completionSampleFinishTime:Date.now()})}class kj{constructor(e,t,s,i,r,o,a,l,d,u){se(this,"currentTree");se(this,"currentNodeId");se(this,"firstResponse",!0);se(this,"didCreateFirstCompletionInNewThread",!1);se(this,"activeBranchLastMessage");se(this,"messagesToUpdate",{});se(this,"allIncompleteStreamedMessages",{});se(this,"responseThreadId");se(this,"isCompletionBlocked",!1);se(this,"isEitherFlagged",!1);se(this,"variantsInStreamInfo");se(this,"activeBranchNodeId");se(this,"blurDuringCompletionTracker",new Lk);se(this,"completionLatencyTracker");se(this,"debouncedUpdateCompletion",Md(()=>{this.isCompletionBlocked||z.updateTree(this.clientThreadId,e=>{Object.values(this.messagesToUpdate).forEach(t=>{e.updateNodeMessage(t.id,t)})}),this.messagesToUpdate={}},50,{leading:!0,maxWait:50}));se(this,"handleResponse",async e=>{if(this.completionLatencyTracker.onResponse(e,this.activeBranchLastMessage,this.responseThreadId),this.responseThreadId===void 0&&"conversationId"in e){const t=e.conversationId;this.responseThreadId=t,hs(this.clientThreadId)&&z.getServerThreadId(this.clientThreadId)!==t&&(z.setServerIdForNewThread(this.clientThreadId,t),W.logEvent(G.attributeClientThreadToServerThread,{client_thread_id:this.clientThreadId,server_thread_id:t}))}switch(e.type){case"error":this.handleError(e);break;case"num_variants_in_stream":this.bindVariantInfoToTree(e);break;case"moderation":this.handleModeration(e);break;case"url_moderation":this.handleUrlModeration(e);break;case"message":this.handleMessage(e),this.debouncedUpdateCompletion();break;case"done":this.handleDone();break;case"gizmo_inline_review":this.handleGizmoInlineReview(e);break;case"title_generation":this.handleTitleGeneration(e);break;case"conversation_detail_metadata":this.handleConversationDetailMetadata(e);break}});this.queryClient=e,this.clientThreadId=t,this.targetNodeId=s,this.completionType=i,this.model=r,this.eventSource=o,this.navigate=a,this.callModelAgain=d,this.onCompletionFinished=u,this.currentTree=z.getTree(t),this.currentNodeId=s,this.activeBranchLastMessage=this.currentTree.getMessage(this.currentNodeId),this.completionLatencyTracker=new bj(l)}handleError(e){const t=e.error,s=(t==null?void 0:t.message)||"Something went wrong",i=t instanceof Ns&&t.code||"";switch(z.updateTree(this.clientThreadId,r=>{r.updateNodeMessage(this.currentNodeId,this.activeBranchLastMessage),r.updateNodeMetadata(this.currentNodeId,{err:s,errType:"danger",errCode:i,completionSampleFinishTime:Date.now()})}),i){case bn.ContentPolicy:case bn.ContentOrTos:case ha:case bp:break;default:s!==void 0&&Ae.logEvent("chatgpt_conversation_error_web",s)}this.blurDuringCompletionTracker.onMessageError(),this.cleanUp(),this.onCompletionFinished(this.responseThreadId),t instanceof Ns&&(t==null?void 0:t.code)===ha&&(t!=null&&t.clearsIn)&&(Bk(new Date(Date.now()+t.clearsIn*1e3).toISOString()),setTimeout(()=>{Uk()},t.clearsIn*1e3))}handleGizmoInlineReview(e){z.setPromptGptRating(this.clientThreadId,e.gizmoId)}handleTitleGeneration(e){z.setTitle(this.clientThreadId,e.title,Zp.Generated)}handleConversationDetailMetadata(e){const{default_model_slug:t}=e;t&&z.setThreadModelId(this.clientThreadId,t),Gr.updateDetails(e)}bindVariantInfoToTree(e){this.variantsInStreamInfo=e,z.updateTree(this.clientThreadId,t=>{const s=t.getParentPromptNode(this.currentNodeId);t.updateNodeMetadata(s.id,{variantsInStreamInfo:this.variantsInStreamInfo})})}handleModeration(e){const{isCompletion:t,messageId:s,conversationId:i,flagged:r,blocked:o,disclaimers:a,metadata:l}=e,d=!!(a!=null&&a.length)&&t;(r||o||d)&&(this.isEitherFlagged=!0,o&&t&&(this.isCompletionBlocked=!0),z.updateTree(this.clientThreadId,u=>{const f=u.messageIdToNodeId(s);o&&u.clearNodeMessageParts(f),u.updateNodeMetadata(f,{...(d&&!!(a!=null&&a.length)&&Iy(a,o))??{},...r&&Ry,...o&&(l!=null&&l.model_incompatibility?Dy:jy),completionSampleFinishTime:Date.now()})}),W.logEvent(t?o?G.completionBlockedByModeration:G.completionFlaggedByModeration:o?G.promptBlockedByModeration:G.promptFlaggedByModeration,{threadId:i,id:s}))}handleUrlModeration(e){const{conversationId:t,url:s,isSafe:i}=e;i&&z.addThreadSafeUrl(t,s)}handleMessage(e){var r,o,a,l,d,u,f,h,g;let t=!0;const{message:s,conversationId:i}=e;if(this.firstResponse&&!this.currentTree.hasReceivedServerCompletion){if((s==null?void 0:s.author.role)===$e.System){const x=(r=s.metadata)!=null&&r.parent_id?this.currentTree.getNodeByIdOrMessageId(s.metadata.parent_id):void 0;if((x==null?void 0:x.message.author.role)!==$e.User){this.currentTree.appendSystemMessageToRoot(s);return}}else if((s==null?void 0:s.author.role)===$e.User)return;if(this.currentTree.hasNodeOrMessageId(s.id))return}if(this.firstResponse&&((o=s.metadata)!=null&&o.rebase_system_message)){z.updateTree(this.clientThreadId,x=>{var w;if(((w=s.metadata)==null?void 0:w.parent_id)==null)throw Error("Unexpected rebased system message without parent");const y=x.getNodeByIdOrMessageId(this.targetNodeId);x.deleteNode(this.targetNodeId),x.addNode(s.id,s,s.metadata.parent_id,s.author.role),x.addNode(y.id,y.message,s.id,y.message.author.role)});return}if(this.firstResponse){const x=((a=xs.getState().threads[this.clientThreadId])==null?void 0:a.continuingFromSharedConversationId)!=null;z.removeContinuingFromSharedConversationId(this.clientThreadId),this.firstResponse=!1,this.didCreateFirstCompletionInNewThread=!this.currentTree.hasReceivedServerCompletion||x,z.updateTree(this.clientThreadId,w=>{w.updateNodeMessage(this.currentNodeId,s)}),this.didCreateFirstCompletionInNewThread&&gc.onCreate(this.queryClient);const y={id:this.targetNodeId,threadId:i,completionType:this.completionType,eventSource:this.eventSource,model:this.model};if(this.completionType===Jn.Next){const w=xs.getState().threads[i],S=(l=w==null?void 0:w.conversationTurns)==null?void 0:l.length,_=(d=w==null?void 0:w.conversationTurns)==null?void 0:d.filter(T=>T.role==$e.User),O=_&&((u=_[_.length-1])==null?void 0:u.messages[0].message);if((O==null?void 0:O.content.content_type)==Ht.Text){const T=O.content.parts.join("").length,E=(_==null?void 0:_.length)??0;y.countConversationTurns=S,y.countUserSubmittedMessages=E,y.countLastUserPromptTextMessageLength=T}}W.logEvent(G.generateCompletion,y)}else if(this.completionType!==Jn.Continue){const x=this.currentTree.containsNodeOrMessageId(s.id),y=(f=s.metadata)==null?void 0:f.parent_id;if(x||(this.debouncedUpdateCompletion.flush(),z.updateTree(this.clientThreadId,w=>{if(y==null)throw new Error(`Received a message with no parentId: ${JSON.stringify(s)}`);w.addNode(s.id,s,y,$e.Assistant)})),y!=null&&y===this.activeBranchNodeId){const w=this.allIncompleteStreamedMessages[y];w!=null&&(z.updateTree(this.clientThreadId,S=>{qh(S,w)}),delete this.allIncompleteStreamedMessages[y])}if(t=(((h=this.variantsInStreamInfo)==null?void 0:h.num_variants_in_stream)??1)===1||this.activeBranchNodeId==null||this.activeBranchNodeId===s.id||this.currentTree.isAncestorOfNode(this.activeBranchNodeId,s.id),t&&this.activeBranchNodeId!==s.id){this.activeBranchNodeId=s.id,this.currentNodeId=s.id;const w=z.getThreadCurrentLeafId(this.clientThreadId);this.currentTree.messageIdToNodeId(this.currentNodeId)!==this.currentTree.messageIdToNodeId(w)&&z.setThreadCurrentLeafId(this.clientThreadId,this.currentNodeId),y!=null&&z.updateTree(this.clientThreadId,S=>{const _=S.getParentPromptNode(s.id);S.updateNodeMetadata(_.id,{variantsInStreamInfo:this.variantsInStreamInfo})})}}if((s==null?void 0:s.author.role)===$e.Tool&&(s==null?void 0:s.author.name)==="bio"){const x=(g=s.metadata)==null?void 0:g.gizmo_id;setTimeout(()=>{this.queryClient.invalidateQueries({queryKey:zk(x)})},5e3)}t&&(this.activeBranchLastMessage=s),this.messagesToUpdate[s.id]=s,this.allIncompleteStreamedMessages[s.id]=s}async handleDone(){var e,t;if(this.isCompletionBlocked||(this.debouncedUpdateCompletion.flush(),this.isEitherFlagged||(this.didCreateFirstCompletionInNewThread&&gc.onCreateFinished(this.navigate,this.queryClient,this.responseThreadId),this.onCompletionFinished(this.responseThreadId))),z.updateTree(this.clientThreadId,s=>{Object.values(this.allIncompleteStreamedMessages).forEach(i=>{qh(s,i)})}),this.blurDuringCompletionTracker.onMessageDone(),this.cleanUp(),((t=(e=this.activeBranchLastMessage)==null?void 0:e.metadata)==null?void 0:t.client_actions)!==void 0){const s=await Vk(this.clientThreadId,this.activeBranchLastMessage);s.length>0&&this.callModelAgain(this.currentNodeId,s)}}cleanUp(){setTimeout(()=>{Wa.removeRequest(this.targetNodeId),z.releaseThread(this.clientThreadId)},0)}}var wj=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(n);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(n,s[i])&&(t[s[i]]=n[s[i]]);return t};const Xc="text/event-stream",vj=1e3,Kh="last-event-id";function Sj(n,e){var{signal:t,headers:s,onopen:i,onmessage:r,onclose:o,onerror:a,openWhenHidden:l,fetch:d}=e,u=wj(e,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((f,h)=>{const g=Object.assign({},s);g.accept||(g.accept=Xc);let x;function y(){x.abort(),document.hidden||E()}l||document.addEventListener("visibilitychange",y);let w=vj,S=0;function _(){document.removeEventListener("visibilitychange",y),window.clearTimeout(S),x.abort()}t==null||t.addEventListener("abort",()=>{_(),f()});const O=d??window.fetch,T=i??Cj;async function E(){var R;x=new AbortController;try{const F=await O(n,Object.assign(Object.assign({},u),{headers:g,signal:x.signal}));await T(F),await Gk(F.body,$k(Wk(D=>{D?g[Kh]=D:delete g[Kh]},D=>{w=D},r))),o==null||o(),_(),f()}catch(F){if(!x.signal.aborted)try{const D=(R=a==null?void 0:a(F))!==null&&R!==void 0?R:w;window.clearTimeout(S),S=window.setTimeout(E,D)}catch(D){_(),h(D)}}}E()})}function Cj(n){const e=n.headers.get("content-type");if(!(e!=null&&e.startsWith(Xc)))throw new Error(`Expected content-type to be ${Xc}, Actual: ${e}`)}const Mj=1e3*30,nc=Mp.getTracer("completion"),sc=n=>(n==null?void 0:n.code)==="challenge_required";class ic extends Error{}function Tj(n,e,t,s){const i=async(r=null,o=!1)=>{var U,V,Y,te,ne,pe;const a=new AbortController,l="threadId"in e?e.threadId:void 0,d="continueFromSharedConversationId"in e?e.continueFromSharedConversationId:void 0,u=dr(),f={action:e.completionType,messages:e.messages.length>0?e.messages:void 0,conversation_id:l,continue_from_shared_conversation_id:l!=null?void 0:d,parent_message_id:e.parentMessageId,model:e.model,timezone_offset_min:new Date().getTimezoneOffset(),variant_purpose:(U=e.completionMetadata)==null?void 0:U.variantPurpose,suggestions:(V=e.completionMetadata)!=null&&V.suggestions?e.completionMetadata.suggestions.map(H=>kw(H)):void 0,history_and_training_disabled:e.historyDisabled,juice:(Y=e.completionMetadata)==null?void 0:Y.juice,conversation_mode:(te=e.completionMetadata)==null?void 0:te.conversationMode,force_paragen:e.forceParagen,force_paragen_model_slug:e.forceParagenModel,force_nulligen:e.forceNulligen,force_indepth_feedback:e.forceIndepthFeedback,force_rate_limit:e.forceRateLimit,reset_rate_limits:e.resetRateLimits,disable_system_content_toggling:e.disableSystemContentToggling,websocket_request_id:u,source:(ne=e.completionMetadata)==null?void 0:ne.source,system_hints:(pe=e.completionMetadata)==null?void 0:pe.systemHints,force_use_sse:!Fs.isWebsocketConnected(),conversation_origin:e.conversationOrigin,force_use_search:e.forceUseSearch},h=ip(await sp(n));let g="https://chatgpt.com/backend-api";h&&(g="https://chatgpt.com/backend-anon");const x=`${g}/conversation`;let y=!0,w=!0;const S=h?Tu.getUnauthHeaders().additionalHeaders:await Tu.getAuthedHeaders(),_=Py(e.chatReq,r??e.arkoseToken,e.turnstileToken,e.proofToken,null),O={...S,...hT(),..._};let T,E,R;nc.startActiveSpan("completion.response",H=>{T=nc.startSpan("completion.first_response"),E=nc.startSpan("completion.first_token"),R=H});const F=Mp.setSpan(Eu.active(),R);function D(H){if(H.data==="[DONE]")a.abort(),R.end(),t({type:"done"});else if(H.event!=="ping")try{const L=JSON.parse(H.data);if(L.error){const ue=new Wn(L.error);throw t({type:"error",error:ue}),ue}else"type"in L?L.type==="gizmo_inline_review"?t({type:"gizmo_inline_review",gizmoId:L.gizmo_id}):L.type==="title_generation"?t({type:"title_generation",title:L.title,conversation_id:L.conversation_id}):L.type==="moderation"?t({type:"moderation",conversationId:L.conversation_id,messageId:L.message_id,isCompletion:L.is_completion,flagged:L.moderation_response.flagged,blocked:L.moderation_response.blocked,disclaimers:L.moderation_response.disclaimers,metadata:L.moderation_response.metadata}):L.type==="url_moderation"?t({type:"url_moderation",conversationId:L.conversation_id,messageId:L.message_id,url:L.url_moderation_result.full_url,isSafe:L.url_moderation_result.is_safe}):L.type==="num_variants_in_stream"?t({type:"num_variants_in_stream",num_variants_in_stream:L.num_variants_in_stream,display_treatment:L.display_treatment}):L.type==="conversation_detail_metadata"&&t(L):(t({type:"message",message:L.message,conversationId:L.conversation_id}),w&&(w=!1,T.end()),y&&L.message.author.role==="assistant"&&L.message.content.content_type==="text"&&L.message.content.parts[0]!==""&&(y=!1,E.end()))}catch(L){if(L instanceof Ns)throw new Wn(L.message)}}let I=null,$=setTimeout(()=>{I===!0?W.logEvent(G.asyncResponseWaitTooLong,{}):I===!1&&W.logEvent(G.sseResponseWaitTooLong,{})},Mj);return bC(u,D,a.signal),Eu.with(F,()=>Sj(x,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...O},body:JSON.stringify(f),signal:a.signal,openWhenHidden:!0,async onopen(H){var le;const L=H.headers.get("content-type")??"",ue=H.headers.get("Cf-Ray")??null;if(H.ok&&L.includes("text/event-stream")){I=!1,s(ue,e.model);return}else if(L.includes("application/json")){const Q=await H.json(),{webSocketUrl:Ge,fallbackWebSocketUrl:ze,conversationId:me,responseId:we,expiresAt:Fe,websocketRequestId:q}=yC(Q);if(Ge!=null&&me!=null&&we!=null&&q!=null&&Fe){I=!0,s(ue,e.model);try{await kC(Ge,ze,Fe,me,we,q,D,a.signal,$)}catch(Z){Z instanceof Wn&&t({type:"error",error:Z})}throw new ic}else{const Z=(Q==null?void 0:Q.error)??(Q==null?void 0:Q.detail),Me=(Z==null?void 0:Z.message)??Z??"Unknown server error";if(Z){if(sc(Z))throw new Ns(Me,H.status,Z.code);if(H.status>=500)throw new Wn(Me);if(((Z==null?void 0:Z.code)==="expired_session_key"||(Z==null?void 0:Z.code)==="invalid_api_key"||(Z==null?void 0:Z.code)==="token_expired")&&typeof window<"u"&&((le=window._oaiHandleSessionExpired)==null||le.call(window,"stream",JSON.stringify(Z))),(Z==null?void 0:Z.code)==="deactivated_workspace"){window.location.href.includes("/workspace/deactivated")||(window.location.href="/workspace/deactivated");return}throw new Ns(Me,H.status,Z==null?void 0:Z.code,Z==null?void 0:Z.type,void 0,Z==null?void 0:Z.clears_in)}}}throw new Wn(_u)},onmessage:H=>{if(I)throw new Wn(_u);$&&(clearTimeout($),$=null),D(H)},onerror(H){let L=H instanceof Error?H:new Error(JSON.stringify(H));throw L instanceof ic||I||sc(L)&&!o||(L.message==="Failed to fetch"&&(L=new Wn(`An error occurred. Either the engine you requested does not exist or there was another issue processing your request. ${rc}`)),L.message==="network error"&&(L=new Ns(`A network error occurred. Please check your connection and try again. ${rc}`,400)),Oy("fetch-error:conversation:new-message",{url:x,message:L==null?void 0:L.message}),t({type:"error",error:L})),L}})).catch(async H=>{if(sc(H)){if(o)throw new Ns("Failed to complete your call, please try again",H.status);{const L=await $r.getEnforcementToken(e.chatReq);return i(L,!0)}}H instanceof ic||et.addError(H)}),a};return i()}function Ej(n,e,t){const s=fr(),i=Gs(),r=k.useRef(t);r.current=t;const o=k.useCallback(async function({model:a,completionType:l,parentNodeId:d,metadata:u,focusOnNewCompletion:f=!0,completionMetadata:h,chatReq:g,arkoseToken:x,turnstileToken:y,proofToken:w,preflightTime:S,extraStreamParams:_,appendMessages:O,updateTree:T}){var ue,le,Q,Ge,ze;mx.publish({kind:"requestCompletion"});const E=z.getTree(n);z.retainThread(n);const R=lw(),F=`${Fy}${n}-${R}`,D=`${n}-${R}`;T==null||T();const I=E.getNodeByIdOrMessageId(d),B={gizmo_id:(ue=I.message.metadata)==null?void 0:ue.gizmo_id};(h==null?void 0:h.juice)!=null&&(B.snorkle_status=1),z.updateTree(n,me=>{me.addNode(F,"",d,$e.Assistant,void 0,B)}),f&&z.setThreadCurrentLeafId(n,F);let U;const V=[];let Y=E.getNodeByIdOrMessageId(I.parentId);for(;Y!=null&&(((le=Y.metadata)==null?void 0:le.isPlaceholderTemplateAssistantWelcomeMessage)===!0||((Q=Y.metadata)==null?void 0:Q.isClientCreatedSystemMessage)===!0);){const me=Y.message;V.unshift(me);const we=E.getNodeByIdOrMessageId(Y.parentId);U=((Ge=we.message)==null?void 0:Ge.id)??we.id,Y=we}if(l===Jn.Next||l===Jn.Variant){const me=E.getNodeByIdOrMessageId(I.parentId);if(U??(U=((ze=me.message)==null?void 0:ze.id)??me.id),V.push(I.message),O){let we=d;z.updateTree(n,Fe=>{for(const q of O)Fe.insertNodeBefore(F,{id:q.id,message:q,parentId:we,children:[]}),we=q.id}),V.push(...O)}}else U??(U=I.message.id);const te=z.getServerThreadId(n);te===void 0&&hs(n)&&z.updateInitialThreadDataForNewThread(n,a);async function ne(me,we){const Fe=performance.now(),q=await od();$r.initializeAndGatherData(q),ma.initializeAndGatherData(q),ca.initializeAndGatherData(q),z.updateTree(n,ve=>{for(const Ee of we)ve.addNode(Ee.id,Ee,me,$e.Assistant,{completionSampleFinishTime:Date.now()}),me=Ee.id}),z.setThreadCurrentLeafId(n,me);const Z=await $r.getEnforcementToken(q),Me=await ma.getEnforcementToken(q),be=await ca.getEnforcementToken(q);o({model:a,completionType:Jn.Next,parentNodeId:me,metadata:{},chatReq:q,arkoseToken:Z??null,turnstileToken:Me??null,proofToken:be??null,preflightTime:performance.now()-Fe,extraStreamParams:_})}const pe=new kj(s,n,F,l,a,u.eventSource,i,D,ne,(...me)=>r.current(...me)),H=(me,we)=>{mj(D,we,me,S)},L=await Tj(s,{conversationOrigin:z.getConversationOrigin(n),model:a,completionType:l,threadId:te,continueFromSharedConversationId:e,historyDisabled:Pa(),parentMessageId:U,messages:V,chatReq:g,arkoseToken:x??null,turnstileToken:y??null,proofToken:w??null,completionMetadata:h,..._},pe.handleResponse,H);Wa.addRequest(F,L),dx.onCompletionRequestStarted(F)},[s,n,e,i]);return o}function _j({clientThreadId:n,currentModelId:e}){const t=$N(e,X0.CODE_INTERPRETER);Nj(t,n)}async function Aj({queryKey:[n,e]}){return await _e.getThreadInterpreterState(e).then(t=>(t.time_remaining_ms===0&&t.kernel_started&&xt.warning("This advanced data analysis (beta) chat has timed out. You may continue the conversation, but previous files, links, and code blocks below may not work as expected.",{hasCloseButton:!0,duration:0}),t))}function Nj(n,e){const t=xr(),s=z.getServerThreadId(e);return Vs({queryKey:["interpreterState",s],queryFn:Aj,enabled:!!(n&&s&&!t),gcTime:0})}const Ij=Ve(()=>Ue(()=>import("./iqvwu2kwo3fu70ma.js"),__vite__mapDeps([135,1,2,3,13,6,4,5,14,15,22,75,8,9,10,71,38,72,49,24,25,18,23,7,11,12,26,27,28,29,30,31,19,134,102,76,58,17,59,32,60,61,62,63,35,103,104,16,20,89,74,37,44,105,88,81,34,48,33,36,106,98,107])).then(n=>n.OpenDebugSidebarButton)),Rj=Ve(()=>Ue(()=>import("./lp0skyh0p8bkybfk.js"),__vite__mapDeps([136,1,2,3,6,4,5,86,14,15,13,19,102,76,28,9,10,58,17,18,25,59,32,60,61,62,63,23,35,31,103,22,104,16,20,7,8,11,12,24,26,27,29,30,89,74,37,44,105,88,81,34,48,33,36,38,106,98,107])),{ssr:!1}),Dj=Ve(()=>Ue(()=>import("./sso-ihqxdzxswuiox36n.js").then(n=>n.j),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100])).catch(()=>()=>null),{ssr:!1}),jj=Ve(()=>Ue(()=>import("./sso-ihqxdzxswuiox36n.js").then(n=>n.P),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100])).then(n=>n.default)),Pj=Ve(()=>Ue(()=>import("./sso-ihqxdzxswuiox36n.js").then(n=>n.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100])).then(n=>n.CAFeedbackModal).catch(()=>()=>null)),zs=Ce({doNotShareSensitive:{id:"thread.modal.onboarding.title",defaultMessage:"Do not share sensitive materials with this application"},mayProduceInaccurateInformation:{id:"thread.chatgptMayProduceInaccurateInformation-oct-30",defaultMessage:"ChatGPT can make mistakes. Check important info."},mayProduceInaccurateInformationNoAuth:{id:"thread.chatgptMayProduceInaccurateInformationNoAuth-march-27",defaultMessage:"ChatGPT can make mistakes. Check important info. Read our <termsLink>Terms</termsLink> and <privacyLink>Privacy Policy</privacyLink>."},mayProduceInaccurateInformationNoAuthV2:{id:"thread.chatgptMayProduceInaccurateInformationNoAuth-may-06",defaultMessage:"By messaging ChatGPT, you agree to our <termsLink>Terms</termsLink> and have read our <privacyLink>Privacy Policy</privacyLink>."},mayProduceInaccurateInformationNoAuthKorea:{id:"thread.chatgptMayProduceInaccurateInformationNoAuthKorea-may-06",defaultMessage:"By messaging ChatGPT, you agree to our <termsLink>Terms</termsLink> and have read our <privacyLink>Privacy Policy</privacyLink> and its <koreaAddendumLink>Korea addendum</koreaAddendumLink>."},businessDisclaimer:{id:"thread.businessDisclaimer-oct-30",defaultMessage:"{workspaceName} workspace chats aren't used to train our models. ChatGPT can make mistakes."},businessDisclaimerNoName:{id:"thread.businessDisclaimerNoName-oct-30",defaultMessage:"Your workspace chats aren'ts used to train our models. ChatGPT can make mistakes."},outdatedGptDisclaimer:{id:"thread.outdatedGptDisclaimer.0",defaultMessage:"<bold>New version of GPT available</bold> - Continue chatting to use the old version, or start a <link>new chat</link> for the latest version."},somethingWentWrong:{id:"thread.modal.unrecoverableError.title",defaultMessage:"Something went wrong"},tryAgainLater:{id:"thread.modal.unrecoverableError.description",defaultMessage:"We're sorry, but something went wrong. Please try again later."},resetThread:{id:"thread.modal.unrecoverableError.resetThread",defaultMessage:"Reset thread"},sharedConversationReportConversation:{id:"thread.sharedConversation.report",defaultMessage:"Report conversation"},latencyButton:{id:"thread.latencyButton",defaultMessage:"Latency"},archivedConversationDescription:{id:"thread.archivedConversationDescription",defaultMessage:"This conversation is archived. To continue, please unarchive it first."},unarchiveButton:{id:"thread.unarchiveButton",defaultMessage:"Unarchive"}});function Oj({clientThreadId:n}){const e=Bn(n);return e!=null?c.jsx(Fj,{clientThreadId:n,gizmoId:e}):c.jsx(Sx,{clientThreadId:n})}function Fj({clientThreadId:n,gizmoId:e}){const t=$s(e).data,s=xs(r=>qt.getThreadCreateTime(n,r)),i=(t==null?void 0:t.gizmo.updated_at)!=null?new Date(t.gizmo.updated_at):void 0;return(t==null?void 0:t.gizmo.short_url)==null||i==null||s==null||i<=s?c.jsx(Sx,{clientThreadId:n}):c.jsxs("span",{className:"text-token-text-tertiary",children:[c.jsx(mm,{className:"text-token-secondary mb-1 mr-1 inline-block h-4 w-4 stroke-0"}),c.jsx(j,{...zs.outdatedGptDisclaimer,values:{link:r=>c.jsx(Gy,{href:Tp(t.gizmo.short_url),className:"underline",shallow:!0,children:r}),bold:r=>c.jsx("span",{className:"text-token-secondary font-semibold",children:r})}})]})}function Sx({clientThreadId:n}){const e=mi(Ha.isBusinessWorkspace),t=mi(u=>u.currentWorkspace),s=t==null?void 0:t.name,{isUnauthenticated:i,isLoading:r}=Dt(),a=om({clientThreadId:n,role:$e.User})>0,l=Fp(u=>u.hasAcceptedFooterDisclaimer),d=i&&!a&&!l;return r?null:e?c.jsx("span",{children:s!=null?c.jsx(j,{...zs.businessDisclaimer,values:{workspaceName:s}}):c.jsx(j,{...zs.businessDisclaimerNoName})}):d?c.jsx(Lj,{clientThreadId:n}):c.jsx("span",{children:c.jsx(j,{...zs.mayProduceInaccurateInformation})})}function Lj({clientThreadId:n}){const{country:e}=$y(),t=e==="KR"?zs.mayProduceInaccurateInformationNoAuthKorea:zs.mayProduceInaccurateInformationNoAuthV2;return k.useEffect(()=>()=>{om({clientThreadId:n,role:$e.User})>0&&Dp.updateHasAcceptedFooterDisclaimer()},[n]),c.jsx("span",{className:"text-sm",children:c.jsx(j,{...t,values:{privacyLink:s=>c.jsx("a",{href:"https://openai.com/privacy",target:"_blank",className:"text-token-text-primary underline decoration-token-text-primary",onClick:()=>{Ae.logEvent("chatgpt_footer_disclaimer_privacy_link_clicked"),W.logEvent(G.footerDisclaimerPrivacyLinkClicked)},children:s}),termsLink:s=>c.jsx("a",{href:"https://openai.com/terms",target:"_blank",className:"text-token-text-primary underline decoration-token-text-primary",onClick:()=>{Ae.logEvent("chatgpt_footer_disclaimer_terms_link_clicked"),W.logEvent(G.footerDisclaimerTermsLinkClicked)},children:s}),koreaAddendumLink:s=>c.jsx("a",{href:"https://openai.com/ko/policies/kr-privacy-policy-addendum",target:"_blank",className:"text-token-text-primary underline decoration-token-text-primary",onClick:()=>{Ae.logEvent("chatgpt_footer_disclaimer_korea_addendum_link_clicked"),W.logEvent(G.footerDisclaimerKoreaAddendumLinkClicked)},children:s})}})})}function Bj({clientThreadId:n}){const e=fr(),t=po(n),s=async()=>{t&&(await _e.patchConversation(t,{is_archived:!1}),e.invalidateQueries({queryKey:["conversation",n]}),xs.setState(i=>{const r=i.threads[t];r!=null&&(r.initialThreadData.isArchived=!1)}),_d(e))};return c.jsxs("div",{className:"my-6 flex flex-col items-center justify-center gap-4",children:[c.jsx("div",{className:"px-3 text-center text-sm text-token-text-secondary",children:c.jsx(j,{...zs.archivedConversationDescription})}),c.jsx("div",{children:c.jsx(Xe,{disabled:!t,onClick:s,icon:uv,children:c.jsx(j,{...zs.unarchiveButton})})})]})}function Uj(n,e){const t=hs(n),s=z.getTitle(n);return e&&e.kind===tt.GizmoInteraction&&e.gizmo?t?`ChatGPT - ${e.gizmo.gizmo.display.name}`:s&&`${e.gizmo.gizmo.display.name} - ${s}`:t?"ChatGPT":s}const o3=function({clientThreadId:n,initiallyHighlightedMessageId:e,continueConversationUrl:t,onCompletionFinished:s,preRequestCompletion:i,hideHeader:r,hideMessages:o,hideFooter:a,hideToolsOverlay:l,messagesVerticalAlign:d="top",prependThreadChildren:u,renderEmptyState:f}){var Ys,Ai,Ni;const h=fr(),g=k.useContext(Ba),x=g!=null,y=Ln(),w=ur(),S=lo(),_=td(),O=S,T=er(),E=el(n),R=vi(),F=x&&((Ai=(Ys=R.query)==null?void 0:Ys.shareParams)==null?void 0:Ai[1])==="moderate",D=Cd(n),I=Qn(n),B=im(n).isArchived;k.useEffect(()=>{D||(hs(n)?et.addTiming("chatgpt.web.chatPage.renderNewConversation"):et.addTiming("chatgpt.web.chatPage.renderExistingConversation"))},[n,D]);const U=cw(n,I),V=rm(n,I),Y=sm(n),{setTargetedContent:te}=Wp(),ne=(Ni=fs("90459671"))==null?void 0:Ni.value,[pe,H]=k.useState(),[L,ue]=k.useState(),[le,Q]=k.useState(),[Ge,ze]=k.useState(),me=w==null?void 0:w.includes(Ly),we=$p(),Fe=V>=2,q=hs(n)&&!Fe&&Ko(E),Z=hs(n)&&!U&&(Ko(E)||(E==null?void 0:E.kind)===tt.GizmoTest),be=Zc().id,ve=Ix(n)??be,{value:Ee}=fs("1410082514"),{value:ut}=fs("4203174056"),ke=hm(ve),Xt=Qh()[ve],He=Uj(n,E),ft=Hs(n),qe=mr(),kt=Zm(n),{config:Ie}=ap("1013114931"),nt=Ie.get("show_follow_ups",!1)&&(y==null?void 0:y.isPersonalAccount()),Re=!T.displayingSideBySideFeedback&&nt;k.useEffect(()=>{wc()},[]),k.useEffect(()=>{qe||te(void 0)},[n,te,qe]);const st=k.useCallback(xe=>{if(xe==null||(s==null||s(xe),Pa())||((ft==null?void 0:ft.kind)===tt.GizmoInteraction&&Qy.handleGizmoInteracted(h,ft.gizmo_id),!(kt||Re)))return;const lt=z.getThreadCurrentLeafId(xe),St=z.getTree(xe).getMessage(lt);yp(St)||By(St)||eT(xe,St.id,ve)},[h,s,ft,kt,Re,ve]),at=dw(n),b=Ej(n,at,st),p=k.useCallback(()=>{const xe=z.getThreadCurrentLeafId(n);if(xe==null)return;const lt=z.getTree(n).getBranchFromLeaf(xe);Wa.abortRequests(lt.map(St=>St.id))},[n]),m=Ti(),{isUnauthenticated:v}=Dt(),M=yr(),A=k.useCallback(async({type:xe,promptId:_t,requestedModelId:lt,eventMetadata:St,cancelActiveRequests:wn,focusOnNewCompletion:Je=!0,useDefaultModel:Ye,completionMetadata:tn,appendMessages:Xs,updateTree:Qs})=>{wc(),Ym.reset(),wn&&p();const Ss=performance.now();let is=ve;lt?is=lt:Ye&&(is=be);const ct=Xp({namespace:fa.CompletionRequest,key:_t});ct==null||ct.logTiming("start_chat_requirements");const Zs=await od();ct==null||ct.logTiming("fetched_chat_requirements"),Zs.force_login&&M({authType:"login"});const Sr=await $r.getEnforcementToken(Zs);ct==null||ct.logTiming("fetched_arkose_token");const cl=await ma.getEnforcementToken(Zs);ct==null||ct.logTiming("fetched_turnstile_token");const vo=await ca.getEnforcementToken(Zs);ct==null||ct.logTiming("fetched_p_token"),i==null||i(n,_t),b({model:is,completionType:xe,parentNodeId:_t,metadata:St,focusOnNewCompletion:Je,completionMetadata:tn,chatReq:Zs,arkoseToken:Sr??null,turnstileToken:cl??null,proofToken:vo??null,preflightTime:performance.now()-Ss,extraStreamParams:{forceParagen:m.forceParagen,forceParagenModel:m.forceParagenModel.value,forceNulligen:m.forceNulligen,forceRateLimit:m.forceRateLimit,resetRateLimits:m.resetRateLimits,disableSystemContentToggling:m.rebaseSystemMessageContent?!0:void 0,forceUseSearch:m.forceUseSearch??void 0},appendMessages:Xs,updateTree:Qs}),v&&Hk.incrementUserMessageCount()},[be,ve,i,n,b,m.forceParagen,m.forceParagenModel,m.forceNulligen,m.forceRateLimit,m.resetRateLimits,m.rebaseSystemMessageContent,m.forceUseSearch,p,M,v]),P=!!(y!=null&&y.features.includes(Si.SharedWebsocket));k.useEffect(()=>{P&&Fs.registerIfNotConnected()},[P]),k.useEffect(()=>{const xe=()=>{if(document.visibilityState==="visible"){if(!P)return;Fs.registerIfNotConnected()}};return document.addEventListener("visibilitychange",xe),()=>{document.removeEventListener("visibilitychange",xe)}},[P]);const ce=po(n);k.useEffect(()=>{const xe=()=>{Fs.stopConversation(ce)};return window.addEventListener("beforeunload",xe),()=>{window.removeEventListener("beforeunload",xe)}},[ce]),Zy({clientThreadId:n,currentLeafId:I,handleRequestCompletion:A});const Te=k.useCallback((xe,_t,lt=!0,St="none",wn)=>{const Ye=z.getTree(n).getParentPromptNode(xe).id;A({type:Jn.Variant,promptId:Ye,eventMetadata:_t,cancelActiveRequests:!1,focusOnNewCompletion:lt,useDefaultModel:wn,completionMetadata:{variantPurpose:St,conversationMode:qt.getConversationMode(n)}})},[A,n]),oe=k.useCallback(xe=>{const lt=z.getTree(n).getLeafFromNode(xe);z.setThreadCurrentLeafId(n,lt.id)},[n]),[De,fe]=k.useState(),zn=k.useCallback(({nodeId:xe,messageId:_t,rating:lt})=>{var Ye,tn;const St=z.getServerThreadId(n);W.logEvent(G.thumbRating,{id:_t,threadId:St,rating:lt,model:ve});const wn=z.getTree(n),Je=wn.getNodeByIdOrMessageId(xe);if(St!==void 0&&(Ee&&((Ye=Je.message.metadata)==null?void 0:Ye.snorkle_status)!=null?_e.submitSnorkleFeedback:ke?vt:_e.submitMessageFeedback)({message_id:_t,conversation_id:St,rating:lt}),z.updateTree(n,Xs=>{Xs.updateNodeMetadata(xe,{rating:lt})}),ke){fe(c.jsx(Pj,{citations:((tn=Je.message.metadata)==null?void 0:tn.citations)??[],rating:lt,conversationId:St??"",messageId:_t,onSubmit:()=>{fe(void 0)},onCancel:()=>fe(void 0),conversationTree:wn,nodeId:xe},`${xe}-${lt}`));return}if(!Ae.getExperimentValue({experimentName:"101132775",key:"show_new_ui",defaultValue:!1})&&(Q(xe),ze(_t),ue(lt),lt==="thumbsDown"&&O)){const Qs=z.getTree(n).getConversationTurns(xe||"root"),Ss=Qs[Qs.length-1];ia(Ss)&&Te(xe,{eventSource:"mouse",intent:"comparison"},!1,"comparison")}},[n,ve,O,Te,ke,Ee]),{setShowReferralInviteModal:ks}=Lu(xe=>({setShowReferralInviteModal:xe.setShowReferralInviteModal})),Ks=k.useCallback(()=>{ks(!1)},[ks]),ws=Lu(xe=>xe.showReferralInviteModal);_j({clientThreadId:n,currentModelId:ve});const pn=xe=>x?c.jsx("div",{className:"h-full overflow-auto bg-token-main-surface-primary",children:xe}):c.jsx(Jk,{scrollAnchorTopOffset:r?0:pw,children:d==="bottom"?c.jsxs("div",{className:"flex h-full flex-col",children:[c.jsx("div",{className:"flex-1"}),xe]}):xe}),je=(xe=!1)=>c.jsx(ij,{onChangeItemInView:oe,onRequestMoreCompletions:Te,onChangeRating:zn,onRequestCompletion:A,clientThreadId:n,initiallyHighlightedMessageId:e,inlineEmbeddedDisplay:!1,conversationLeafId:I,hideHeader:r,renderOnlyTurns:xe},n);k.useEffect(()=>{document.title=He??"ChatGPT"},[He]);const rt=RN(),ot=Bn(n),ts=Z&&!f&&rt&&_&&!ot,{composerBarSize:ns,composerSkeleton:Vn,footerBarSize:ss,isClippedComposerBar:Vt,setComposerBarElement:Js,setFooterBarElement:vs,ThreadSizeWrapper:wo}=ww({isArchived:B}),vr=Vt?{footerBarSize:ss,composerBarSize:ns}:{};return c.jsxs(wo,{...vr,children:[me&&c.jsx(Rj,{}),ut&&c.jsx(jj,{}),c.jsxs(Uy,{children:[He!=null&&c.jsx("title",{children:He}),x&&c.jsxs(c.Fragment,{children:[c.jsx("meta",{property:"og:site_name",content:"ChatGPT"}),c.jsx("meta",{name:"robots",content:g.isIndexable?"index,nofollow":"noindex,nofollow"},"robots"),c.jsx("meta",{property:"og:title",content:He??"Shared Chat on ChatGPT"},"og:title"),c.jsx("meta",{property:"og:description",content:"Shared "+(Y!=null?`by ${Y} `:"")+"via ChatGPT"},"og:description"),c.jsx("meta",{property:"og:image",content:zy.src},"og:image")]})]}),(E==null?void 0:E.kind)===tt.GizmoInteraction&&E.gizmo&&c.jsx(uw,{gizmo:E.gizmo}),c.jsx(ad.Provider,{value:A,children:c.jsxs(vw,{children:[c.jsxs(bT,{clientThreadId:n,currentModelConfig:Xt,className:"composer-parent flex h-full flex-col focus-visible:outline-0",children:[!o&&c.jsx(zj,{className:J(Vt&&"masked-content"),style:{"--composer-bar_skeleton":Vn},children:D?null:Z?f??c.jsx(XD,{clientThreadId:n,currentModelId:ve,onRequestCompletion:A,enableV2Homepage:ts}):Fe?pn(c.jsxs(c.Fragment,{children:[u,je()]})):null}),c.jsx(Vj,{className:J(Vt&&"mask-scrollbars absolute bottom-0 z-20"),children:B?c.jsx(Bj,{clientThreadId:n}):c.jsxs("div",{className:J(Vt&&"relative mx-auto flex max-w-3xl flex-1 flex-col"),children:[Vt?c.jsx(BN,{skeleton:Vn}):null,x?c.jsx(ND,{clientThreadId:n,isModeratingThread:F,continueConversationUrl:t}):!ts&&c.jsx(_N,{clientThreadId:n,isNewThread:q,setComposerBarElement:Js,showPromptStarters:q||!U,currentModelId:ve,onRequestCompletion:A}),!a&&c.jsx("div",{ref:vs,className:"relative w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",children:x?c.jsx(qk,{onClickReportSharedConversation:()=>{ne?xi.openModal(Jr.ReportConversation):H(I)}}):Ko(E)&&c.jsx(Oj,{clientThreadId:n})})]})})]}),!l&&c.jsxs("div",{className:"group absolute bottom-2 end-2 z-20 hidden gap-1 md:flex lg:bottom-3 lg:end-3",children:[we?c.jsxs(c.Fragment,{children:[c.jsx(Ij,{}),c.jsx(Dj,{})]}):null,c.jsx(wS,{})]}),De,c.jsx(fw,{serverThreadId:(g==null?void 0:g.serverSharedThreadId)??void 0,clientThreadId:n,isStaticSharedThread:x}),c.jsx(SD,{clientThreadId:n,currentLeafId:I,currentModelId:ve,onChangeItemInView:oe,onRequestMoreCompletions:Te,onChangeRating:zn,onRequestCompletion:A,ratingModalOpen:L,ratingModalNodeId:le,ratingModalCompletionId:Ge,setRatingModalOpen:ue,sharedConversationReportModalNodeId:pe,setSharedConversationReportModalNodeId:H}),c.jsx(kv,{}),(w==null?void 0:w.includes(Vy))&&c.jsx(MD,{isOpen:ws,onClose:Ks}),c.jsx(Kk,{conversationId:n,currentModelId:ve})]})})]})},zj=Ke.div`grow flex-1 overflow-hidden`,Vj=Ke.div`md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent w-full`;export{n3 as $,js as A,Kn as B,Jc as C,mt as D,Gi as E,K as F,Hh as G,zi as H,UA as I,ZA as J,EA as K,R5 as L,eI as M,o3 as N,z5 as O,kr as P,u9 as Q,Ft as R,CE as S,Ki as T,On as U,px as V,cx as W,e9 as X,al as Y,Z5 as Z,s3 as _,Nh as a,t3 as a0,n9 as a1,U5 as a2,gE as a3,L0 as a4,ph as a5,JE as a6,KE as a7,Y5 as a8,ej as a9,_2 as aA,fn as aB,ie as aC,Xo as aD,Jd as aE,ES as aF,ij as aa,qM as ab,el as ac,L5 as ad,$5 as ae,O5 as af,F5 as ag,Wm as ah,P5 as ai,W5 as aj,H5 as ak,e3 as al,hu as am,ll as an,zD as ao,LS as ap,I5 as aq,IS as ar,ig as as,wa as at,sa as au,At as av,i3 as aw,r3 as ax,sE as ay,Ug as az,Xm as b,qN as c,XN as d,AS as e,Ei as f,Da as g,un as h,We as i,sl as j,FE as k,Ne as l,WE as m,Bc as n,z2 as o,Ej as p,ma as q,_N as r,K5 as s,J5 as t,J0 as u,G5 as v,q5 as w,B5 as x,GM as y,V5 as z};
//# sourceMappingURL=j6ap2wbjx1muhlqy.js.map
