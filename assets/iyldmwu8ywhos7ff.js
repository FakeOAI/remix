import{a4 as ve,r as C,j as I,ax as Ie,a3 as pe,ay as _e,T as P,I as Ce,i as O,ai as X,aK as v,b3 as f,D as U,a2 as Y,a7 as Q,p as ye,x as xe,l as be,ei as V,aC as Me,aN as b,ej as L,ek as Se,k as J,at as w,aF as Z,R as ee,cM as Le,el as Re,em as Fe,h as Ee,bd as we}from"./hc9xxm00a3r3byem.js";import{t as re}from"./guykwp3ov0cliuel.js";import{D as Ne,S as te,cp as ke,cq as Ue,B as $e,cr as ne,cs as De,ct as Pe,cu as q,cv as se,i as $,cw as Ae,br as je,cx as qe,O as ze,k as Oe,cy as Be,P as Ge}from"./ozzpumen10p6g0yq.js";import{m as He}from"./ovjwzbtdrcsgos3a.js";const ae=Ne.FirstTimeUsingUserContext;function Hr(){const{eligible:e}=te(ae);return e}const Wr=({onClose:e})=>{const r=ve(),{markAsViewed:t}=te(ae),n=C.useCallback(()=>{t(),e()},[t,e]);return I.jsxs(Ie,{isOpen:!0,onClose:pe,size:"custom",className:"max-w-xl",type:"success",title:r.formatMessage(E.title),primaryButton:I.jsx(_e.Button,{onClick:n,title:r.formatMessage(E.ok),color:"primary"}),children:[I.jsxs("div",{className:"mb-6 flex flex-col gap-3",children:[I.jsx("p",{children:I.jsx(P,{...E.body1})}),I.jsx("p",{children:I.jsx(P,{...E.body2})})]}),I.jsx("div",{className:"flex flex-col gap-3 text-sm text-token-text-tertiary",children:I.jsx("p",{children:I.jsx(P,{...E.legal1,values:{article:s=>I.jsx("a",{href:ke,target:"_blank",className:"underline",rel:"noopener noreferrer",children:s})}})})})]})},E=Ce({title:{id:"UserContextFirstTimeModal.title",defaultMessage:"Introducing Custom Instructions"},body1:{id:"UserContextFirstTimeModal.body1",defaultMessage:"Customize your interactions with ChatGPT by providing specific details and guidelines for your chats."},body2:{id:"UserContextFirstTimeModal.body2",defaultMessage:"Whenever you edit your custom instructions, they'll take effect in all new chats you create. Existing chats won't be updated."},legal1:{id:"UserContextFirstTimeModal.legal1",defaultMessage:"Your instructions will be used to make our models better unless you've opted out and may be shared with any plugins you've enabled. Visit our <article>Help Center</article> to learn more."},ok:{id:"UserContextFirstTimeModal.ok",defaultMessage:"OK"}});var We=X,A=Ue,W=re,Ke="Expected a function",Xe=Math.max,Ye=Math.min;function Qe(e,r,t){var n,s,o,u,d,i,h=0,p=!1,y=!1,M=!0;if(typeof e!="function")throw new TypeError(Ke);r=W(r)||0,We(t)&&(p=!!t.leading,y="maxWait"in t,o=y?Xe(W(t.maxWait)||0,r):o,M="trailing"in t?!!t.trailing:M);function S(T){var x=n,F=s;return n=s=void 0,h=T,u=e.apply(F,x),u}function R(T){return h=T,d=setTimeout(N,r),p?S(T):u}function Te(T){var x=T-i,F=T-h,H=r-x;return y?Ye(H,o-F):H}function B(T){var x=T-i,F=T-h;return i===void 0||x>=r||x<0||y&&F>=o}function N(){var T=A();if(B(T))return G(T);d=setTimeout(N,Te(T))}function G(T){return d=void 0,M&&n?S(T):(n=s=void 0,u)}function me(){d!==void 0&&clearTimeout(d),h=0,n=i=s=d=void 0}function fe(){return d===void 0?u:G(A())}function D(){var T=A(),x=B(T);if(n=arguments,s=this,i=T,x){if(d===void 0)return R(i);if(y)return clearTimeout(d),d=setTimeout(N,r),S(i)}return d===void 0&&(d=setTimeout(N,r)),u}return D.cancel=me,D.flush=fe,D}var oe=Qe;const de=O(oe);var Ve=oe,Je=X,Ze="Expected a function";function er(e,r,t){var n=!0,s=!0;if(typeof e!="function")throw new TypeError(Ze);return Je(t)&&(n="leading"in t?!!t.leading:n,s="trailing"in t?!!t.trailing:s),Ve(e,r,{leading:n,maxWait:r,trailing:s})}var rr=er;const tr=O(rr),Kr=async({queryKey:e})=>{const[r,t]=e;if(t.length<2)return[];const n=new URLSearchParams({query_fragment:t});return v.get(`${f}/suggestions?${n.toString()}`).then(s=>s.suggestions).catch(()=>[])};async function Xr({threadId:e,sessionId:r,query:t,agentSettingsOverrides:n,metadata:s}){const o=ue(n),u=e?`${f}/threads/${e}/turns?blocking=false`:`${f}/turns?nonce=${r}`;n.emulated_location&&(s={...s,...n.emulated_location});const d=new PerformanceObserver(i=>{const h=i.getEntriesByName(u,"resource");if(h.length){const p=h[0];if(p.connectEnd){const y=p.connectEnd-p.fetchStart;U.addAction("sonic.web.home.new_turn_connection_time",{durationMs:y})}d.disconnect()}});return d.observe({type:"resource"}),v.post(u,{...o,turn:{user_query:t},user_metadata:s})}async function Yr(){return v.delete(`${f}/threads`)}function ue(e){return{settings_overrides:{search_results:{search_engines:e.use_labrador?{bing:{}}:{bing:{ranking_model:null,rrf_alpha:1,rrf_input_threshold:0},labrador:null}},model_response:{enable_multimodal:e.show_image_to_model,completion_model:e.completion_model?{model:e.completion_model,clip_model:"@mmapi",direct_connection_urls:[]}:{}}},base_config:e.base_config??$e.SCALLION,eval_preset:e.eval_preset}}async function Qr({threadId:e,threadUserId:r,routePrefix:t}){let n=f;t&&(n=n+t);const s=new URL(`${n}/threads/${e}/with_turns`);return r&&s.searchParams.append("thread_user_id",r),await v.get(s.toString())}async function Vr(e){const r=new FormData;return r.append("feedback",JSON.stringify({thread_id:e.threadId,turn_index:e.turnIndex,rating:e.rating,search_query:e.searchQuery,text:e.text,model_instructions:e.modelInstructions,tags:e.tags,user_email:e.userEmail})),e.screenshot&&r.append("file",new File([e.screenshot],"screenshot.jpeg",{type:"image/jpeg"})),v.post(`${f}/feedback/turns`,r)}async function nr(e,r){return v.post(`${f}/threads/${e}/turns/${r}/images_try_hard`)}async function Jr(){return v.get(`${f}/feedback/turns`)}async function Zr(e,r){return v.get(`${f}/feedback/turns/${e}/${r}`)}async function et(e,r){return v.get(`${f}/feedback/links/${e}/${r}`)}async function rt(e){const r=new FormData;return e.screenshot&&r.append("file",new File([e.screenshot],"screenshot.jpeg",{type:"image/jpeg"})),r.append("feedback",JSON.stringify({thread_id:e.threadId,url:e.url,title:e.title,snippet:e.snippet,rating:e.rating,search_query:e.searchQuery,text:e.text,tags:e.tags,user_email:e.userEmail})),v.post(`${f}/feedback/links`,r)}function tt(e){const r=ue(e.agentSettingsOverrides);v.post(`${f}/prefetch`,{...r,turn:{user_query:e.query},user_metadata:e.metadata})}function nt(){return v.get(`${f}/healthcheck`)}function st(){return v.post(`${f}/waitlist`)}function sr(e){return _(r=>{var t;return((t=r.thread)==null?void 0:t.turns.map(n=>e.reduce((s,o)=>(s[o]=n[o],s),{})))??[]},(r,t)=>{if(r.length!==t.length)return!1;for(let n=0;n<r.length;n++)if(!se(r[n],t[n]))return!1;return!0})}function ar(){return _(e=>{var r;return $((r=e.thread)==null?void 0:r.turns.flatMap(t=>{var n;return(n=t.model_response)==null?void 0:n.citations}))},se)}const ie={thread:null,error:void 0},_=Y(Q(()=>({...ie}))),or=de(()=>{U.addError(new ne("got updateTurn with no current thread"))},1e3),dr=de(e=>{U.addError(new ne("turn not found"),{turnIndex:e})},1e3),k={threadId:e=>{var r;return((r=e.thread)==null?void 0:r.id)??null},turns:e=>{var r;return((r=e.thread)==null?void 0:r.turns)??[]},turnCitations:e=>r=>{var t,n;return((n=(t=r.thread)==null?void 0:t.turns[e].model_response)==null?void 0:n.citations)??[]},hasResponse:e=>{var r;return De((r=e.thread)==null?void 0:r.turns[0])},firstTurn:e=>e.thread!=null?e.thread.turns[0]:void 0,lastTurn:e=>e.thread!=null?e.thread.turns[e.thread.turns.length-1]:void 0,numTurns:e=>{var r;return((r=e.thread)==null?void 0:r.turns.length)??0},isLastTurnStreaming:e=>{const r=e.thread!=null?e.thread.turns[e.thread.turns.length-1]:void 0;return r!=null&&Pe(r)},hasModelResponseText:e=>{var t,n;const r=(t=e.thread)==null?void 0:t.turns[0];return((n=r==null?void 0:r.model_response)==null?void 0:n.text)!=null},hasFirstTurnError:e=>{var t;const r=(t=e.thread)==null?void 0:t.turns[0];return!!r&&q(r)},hasTurnError:e=>{var r;return((r=e.thread)==null?void 0:r.turns.some(q))??!1},threadError:e=>e.error,__deprecated_sportsWidget:e=>{var t;const r=(t=e.thread)==null?void 0:t.turns[0];return(r==null?void 0:r.sports_widget)??null}},at={appendTurn(e,r,t){_.setState(n=>{var s;((s=n.thread)==null?void 0:s.id)!==e&&(t==null||t(e),n.thread={id:e,turns:[]}),n.thread.turns.push(r)})},updateTurn(e,r){_.setState(t=>{const n=t.thread;if(!n){or();return}const s=n.turns[e];if(!s){dr(e);return}r(s)})},clearThread(){_.setState(()=>({...ie}))},setError(e){_.setState(r=>{r.error=e})},setThread(e,r){_.setState(t=>{t.thread={id:e,turns:r}})}};function ot(){const{imageResults:e}=ir();Ae([...e.map(r=>he(r))])}const ur=tr((...e)=>nr(...e),5e3);function ir(e=!1){var d,i;const r=sr(["image_results","image_try_hard_status","execution_status"]),t=_(k.threadId),n=$(r.toReversed().flatMap(h=>{var p;return(p=h.image_results)==null?void 0:p.entries})).map(h=>({...h,thumbnail_url:h.thumbnail_url.replace(/^http:\/\//,"https://"),content_url:h.content_url.replace(/^http:\/\//,"https://")})),s=_(k.hasModelResponseText),o=r.some(h=>q(h));let u=n.length===0&&!s;return t!=null&&e&&!u&&n.length===0&&((d=r[0])==null?void 0:d.image_try_hard_status)==="not_attempted"&&(ur(t,0),u=!0),e&&((i=r[0])==null?void 0:i.image_try_hard_status)==="in_progress"&&(u=!0),{imageResults:n,isLoading:u,isErrored:n.length===0&&o}}function dt(){const e=ar(),r=_(k.hasTurnError),t=_(k.hasModelResponseText),n=le(e);return{imageResults:n,isLoading:n.length===0&&!t,isErrored:n.length===0&&r}}function le(e){return $(e.flatMap(r=>r.type==="image_v2"?r.images:[]))}function lr(e){return xe({queryKey:["downloadImage",{imageUrl:e}],queryFn:()=>new Promise((r,t)=>{const n=new Image;n.onload=()=>{r({width:n.width,height:n.height})},n.onerror=()=>{t()},n.src=e}),enabled:e!=null})}function ut(e){return ye(lr(e))}const ce={width:474,square:!0};function he(e,r=ce){if(e==null)return;const t=new URL(e.thumbnail_url);if(t.hostname.indexOf(".bing.")===-1)return e.thumbnail_url;const n=Math.min(r.width,e.content_size.width),s=r.height??Math.floor(n*e.content_size.height/e.content_size.width);if(t.searchParams.delete("pid"),r.square){const o=Math.min(n,s);t.searchParams.set("w",o.toString()),t.searchParams.set("h",o.toString())}else t.searchParams.set("w",n.toString()),t.searchParams.set("h",s.toString());return t.searchParams.set("c","7"),t.toString()}function it(e,r=ce){return C.useMemo(()=>he(e,r),[e,r])}const cr={type:"spring",stiffness:700,damping:82};function lt({children:e,className:r}){return I.jsx(He.div,{animate:{opacity:1},initial:{width:"100%",height:"100%",translateX:0,translateY:0,opacity:0},whileHover:{width:"103%",height:"103%",translateX:"-1.5%",translateY:"-1.5%"},transition:cr,className:r,children:e})}var hr=re,K=1/0,gr=17976931348623157e292;function Tr(e){if(!e)return e===0?e:0;if(e=hr(e),e===K||e===-K){var r=e<0?-1:1;return r*gr}return e===e?e:0}var mr=Tr,fr=mr;function vr(e){var r=fr(e),t=r%1;return r===r?t?r-t:r:0}var Ir=vr,pr=je,_r=be,Cr=Ir,yr=Math.max,xr=Math.min;function br(e,r,t){var n=e==null?0:e.length;if(!n)return-1;var s=n-1;return t!==void 0&&(s=Cr(t),s=t<0?yr(n+s,0):xr(s,n-1)),pr(e,_r(r),s,!0)}var Mr=br,Sr=qe,Lr=Mr,Rr=Sr(Lr),Fr=Rr;const Er=O(Fr);function ge(e,r,t){var s,o;if(t)return t;const n=e[r];return(o=(s=n==null?void 0:n.message)==null?void 0:s.metadata)!=null&&o.model_slug?n.message.metadata.model_slug:n!=null&&n.parentId?ge(e,n.parentId):null}function ct(){return`${V}${Me()}`}let wr=0;function ht(){return wr++}function z(e){return e.startsWith(V)}const Nr=()=>new L,kr=()=>Object.freeze({lastModelUsed:null,createTime:new Date});var Ur=(e=>(e.NewChat="NewChat",e.Server="Server",e.User="User",e.Generated="Generated",e.Unknown="Unknown",e))(Ur||{});const j={},c=Y(Q(()=>({threads:{},clientNewThreadIdToServerIdMapping:{},threadRetainCounts:{}}))),l=c.getState,m=c.setState,g={resolveThreadId:(e,r=l())=>r.clientNewThreadIdToServerIdMapping[e]??e,getThread:(e,r=l())=>{const t=g.resolveThreadId(e,r);return r.threads[t]??null},hasThread:(e,r=l())=>{const t=g.resolveThreadId(e,r);return r.threads[t]!=null},isLoading:(e,r=l())=>{var n;const t=g.resolveThreadId(e,r);return(n=r.threads[t])==null?void 0:n.isLoading},getConversationMode:(e,r=l())=>{var n;const t=g.resolveThreadId(e,r);return(n=r.threads[t])==null?void 0:n.mode},getThreadModelId:(e,r=l())=>{var t;return((t=g.getThread(e,r))==null?void 0:t.modelId)??null},getGizmoId(e,r=l()){const t=r.threads[g.resolveThreadId(e,r)];if((t==null?void 0:t.mode.kind)===b.GizmoInteraction||(t==null?void 0:t.mode.kind)===b.GizmoTest)return t.mode.gizmo_id},getThreadTitleSource(e,r=l()){const t=g.resolveThreadId(e,r),n=r.threads[t];return n!=null?n.titleSource:"Unknown"},getThreadCreateTime(e,r=l()){var n,s;const t=g.resolveThreadId(e,r);return(s=(n=r.threads[t])==null?void 0:n.initialThreadData)==null?void 0:s.createTime},getCurrentNode(e,r=l()){var s;const t=g.resolveThreadId(e,r),n=((s=r.threads[t])==null?void 0:s.currentLeafId)??"root";return a.getTree(e).getNodeByIdOrMessageId(n)},isThreadUrlSafe(e,r,t=l()){var s;const n=g.resolveThreadId(e,t);return((s=t.threads[n])==null?void 0:s.safeUrls.includes(r))??!1},getRatingPrompt(e,r=l()){var n;const t=g.resolveThreadId(e,r);return(n=r.threads[t])==null?void 0:n.promptGptRating},getTurnContentReferences(e,r=l(),t){var s,o;const n=(o=(s=g.getThread(e,r))==null?void 0:s.conversationTurns[t])==null?void 0:o.messages;return n?$(n.flatMap(u=>{var d,i;return(i=(d=u.message)==null?void 0:d.metadata)==null?void 0:i.content_references})):[]}},a={initThread:(e,r,t=null)=>{const n=a.resolveThreadId(e);if(l().threads[n]==null){const s=Re();m(o=>{o.threads[n]={initialThreadData:s,mode:r,modelId:t,tree:new L(L.createTree()),title:null,titleSource:"NewChat",currentLeafId:"root",conversationTurns:[],safeUrls:[],isLoading:!z(n),docsReferencedByURL:{},conversationOrigin:null}})}},setThreadModelId:(e,r)=>{const t=a.resolveThreadId(e);m(n=>{const s=n.threads[t];s!=null&&(s.modelId=r)})},updateConversationMode:(e,r)=>{const t=a.resolveThreadId(e);m(n=>{const s=n.threads[t];s!=null&&(s.mode=r)})},getServerThreadId:e=>z(e)?l().clientNewThreadIdToServerIdMapping[e]:e,setServerIdForNewThread:(e,r)=>{l().clientNewThreadIdToServerIdMapping[e]===void 0&&m(t=>{t.threads[r]=t.threads[e],delete t.threads[e],t.clientNewThreadIdToServerIdMapping[e]=r})},initThreadFromServerData:(e,r,t=!1,n=void 0,s=!1)=>{var M;const o=a.resolveThreadId(e);if(!s&&(l().threads[o]==null&&!t||((M=l().threads[o])==null?void 0:M.isLoading)===!1))return;const u=Se(r),d=u.mapping??L.createTree(),i={lastModelUsed:ge(u.mapping,u.initialCurrentLeafId,r.default_model_slug),createTime:"create_time"in r?new Date(r.create_time*1e3):void 0,isArchived:r.is_archived??!1},h=new L(d),p=u.initialCurrentLeafId??u.rootId??"root",y="has_user_editable_context"in r?{hasUserEditableContextFlag:r.has_user_editable_context,authorName:r.author_name,model:"model"in r&&r.model!=null?ze(r.model):void 0}:void 0;m(S=>{const R=S.threads[o];S.threads[o]={modelId:(R==null?void 0:R.modelId)??null,initialThreadData:i,mode:r.gizmo_id!=null?{kind:b.GizmoInteraction,gizmo_id:r.gizmo_id}:{kind:b.PrimaryAssistant,plugin_ids:r.plugin_ids},sharedConversationMetadata:y,title:r.title??null,titleSource:"Server",tree:h,currentLeafId:p,isLoading:!1,continuingFromSharedConversationId:n,safeUrls:r.safe_urls??[],conversationTurns:[],docsReferencedByURL:{},conversationOrigin:r.conversation_origin??null}}),a.recomputeConversationTurnsForCurrentLeafId(o,[])},updateInitialThreadDataForNewThread:(e,r)=>{const t=a.resolveThreadId(e);m(n=>{const s=n.threads[t];s!=null&&(s.initialThreadData.lastModelUsed=r)})},getThreadCurrentLeafId:e=>{var t;const r=a.resolveThreadId(e);return((t=l().threads[r])==null?void 0:t.currentLeafId)??"root"},getThreadSafeUrls:e=>{var t;const r=a.resolveThreadId(e);return(t=l().threads[r])==null?void 0:t.safeUrls},addThreadSafeUrl:(e,r)=>{const t=a.resolveThreadId(e);t&&m(n=>{const s=n.threads[t];s!=null&&s.safeUrls.push(r)})},setThreadCurrentLeafId:(e,r)=>{const t=a.resolveThreadId(e);l().threads[t]!=null&&m(s=>{const o=s.threads[t];if(o==null)return;o.currentLeafId=r;const u=a.computeThreadConversationTurns(t,o.currentLeafId,o.conversationTurns);o.conversationTurns=u})},setTitle:(e,r,t)=>{const n=a.resolveThreadId(e);m(s=>{const o=s.threads[n];o&&(o.title=r,o.titleSource=t)})},getTitle:e=>{var t;const r=g.resolveThreadId(e);return((t=l().threads[r])==null?void 0:t.title)??void 0},getTitleAndSource:e=>({title:a.getTitle(e),titleSource:g.getThreadTitleSource(e)}),getConversationOrigin:e=>{var t;const r=g.resolveThreadId(e);return((t=l().threads[r])==null?void 0:t.conversationOrigin)??null},setConversationOrigin:(e,r)=>{const t=a.resolveThreadId(e);m(n=>{const s=n.threads[t];s&&(s.conversationOrigin=r)})},deleteNodesByFilter:(e,r)=>{const t=a.getThreadCurrentLeafId(e);a.updateTree(e,n=>{n.deleteNodesByFilter(r).includes(t)&&a.setThreadCurrentLeafId(e,"root")})},updateTree:(e,r)=>{var d;const t=a.resolveThreadId(e);if(!(l().threads[t]!=null)){console.warn("Thread does not exist, cannot update tree: ",t);return}const s=a.getTree(e);r(s);const u=((d=l().threads[t])==null?void 0:d.conversationTurns)??[];a.recomputeConversationTurnsForCurrentLeafId(t,u)},getTree:e=>{var t;const r=a.resolveThreadId(e);return((t=l().threads[r])==null?void 0:t.tree)??Nr()},resolveThreadId:e=>g.resolveThreadId(e),recomputeConversationTurnsForCurrentLeafId:(e,r)=>{const t=a.resolveThreadId(e);m(n=>{const s=n.threads[t];if(s==null)return;const o=a.computeThreadConversationTurns(t,s.currentLeafId,r);s.conversationTurns=o})},computeThreadConversationTurns:(e,r,t)=>{const n=a.resolveThreadId(e);return a.getTree(n).getConversationTurns(r).map((d,i)=>{const h=t==null?void 0:t[i];return J(h,d)?h:d})},getThreadConversationTurns:(e,r,t)=>{var h;const n=a.resolveThreadId(e),o=l().threads[n];if(o==null)return[];const u=o.tree,d=u.messageIdToNodeId((o==null?void 0:o.currentLeafId)??"root"),i=r!=null?u.messageIdToNodeId(r):null;return i!=null&&i!==d?a.computeThreadConversationTurns(n,i,t??[]):((h=l().threads[n])==null?void 0:h.conversationTurns)??[]},removeContinuingFromSharedConversationId:e=>{const r=a.resolveThreadId(e);m(t=>{const n=t.threads[r];(n==null?void 0:n.continuingFromSharedConversationId)!=null&&delete n.continuingFromSharedConversationId})},updateReferencedDocState:(e,r,t)=>{const n=a.resolveThreadId(e);m(s=>{const o=s.threads[n];o&&(o.docsReferencedByURL[r]=t)})},copyLastMessageToClipboard:(e,r="mouse")=>{const t=a.getThreadCurrentLeafId(e),n=a.getThreadConversationTurns(e,t);return a.copyMessageToClipboard(e,n.length-1,r)},copyMessageToClipboard:(e,r,t="mouse")=>{const n=a.getThreadCurrentLeafId(e),o=a.getThreadConversationTurns(e,n)[r];if(!o)return Promise.reject();const{messages:u}=o,d=u.reduce((i,h)=>!h.err&&h.message.author.role===w.Assistant&&h.message.recipient==="all"?i+(i?`

`:"")+Z(h.message):i,"");return Oe(d).then(()=>{const i=a.getServerThreadId(e);i&&ee.submitImplicitMessageFeedback({messageId:u[0].message.id,type:"copy",serverThreadId:i,selectedText:d,source:t})})},deleteThread:e=>{m(r=>{delete r.threads[e],delete r.clientNewThreadIdToServerIdMapping[e]})},retainThread:e=>{m(r=>{r.threadRetainCounts[e]=(r.threadRetainCounts[e]??0)+1}),clearTimeout(j[e])},releaseThread:e=>{l().threads[e]!=null&&(m(t=>{t.threadRetainCounts[e]=Math.max((t.threadRetainCounts[e]??0)-1,0)}),!(l().threadRetainCounts[e]>0)&&(clearTimeout(j[e]),j[e]=setTimeout(()=>{l().threads[e]!=null&&(l().threadRetainCounts[e]>0||a.deleteThread(e))},3e4)))},setPromptGptRating:(e,r)=>{const t=a.resolveThreadId(e);m(n=>{const s=n.threads[t];s!=null&&(r==null?s.promptGptRating=void 0:s.promptGptRating={gizmoId:r})})}};async function gt(e,r){const t=await ee.getConversation(e);return U.addTiming("chatgpt.web.chatPage.loadExistingConversation"),a.initThreadFromServerData(e,t,r,void 0,r),t}const Tt=e=>c(t=>g.getThreadModelId(e,t))??Ge,$r=e=>c(r=>{if(e!=null)return z(e)?r.clientNewThreadIdToServerIdMapping[e]:e}),mt=e=>c(r=>{var n;const t=a.resolveThreadId(e);return((n=r.threads[t])==null?void 0:n.initialThreadData)??kr()}),ft=(e,r)=>c(t=>{const n=g.getConversationMode(e,t);return r&&((n==null?void 0:n.kind)===b.GizmoInteraction||(n==null?void 0:n.kind)===b.PrimaryAssistant)?{gizmo_id:r,kind:b.GizmoInteraction}:n}),Dr=e=>{const r=Be();return c(t=>t.threads[g.resolveThreadId(e,t)]==null?r:g.getGizmoId(e,t))},vt=e=>!!Dr(e),It=e=>c(r=>{var n;const t=a.resolveThreadId(e);return((n=r.threads[t])==null?void 0:n.isLoading)??!1}),Pr=e=>c(()=>a.getThreadCurrentLeafId(e)),pt=(e,r)=>{const t=C.useRef([]);return c(()=>{const n=a.getThreadConversationTurns(e,r,t.current);return t.current=n,(n==null?void 0:n.length)??0})},_t=(e,r)=>{const t=C.useRef([]);return c(()=>{const n=a.getThreadConversationTurns(e,r,t.current);return t.current=n,n})},Ct=(e,r,t)=>{const n=C.useRef([]);return c(()=>{const s=a.getThreadConversationTurns(e,t,n.current);return n.current=s,r>=0&&r<s.length?s[r]:null})},yt=(e,r)=>{const t=C.useRef([]);return c(()=>{const n=a.getThreadConversationTurns(e,r,t.current);return t.current=n,n.length>0?n[n.length-1]:null})},xt=(e,r)=>{const t=C.useRef([]);return c(()=>{const n=a.getThreadConversationTurns(e,r,t.current);t.current=n;let s=0;for(let o=n.length-1;o>=0;o--){const u=n[o];if(u.messages.some(d=>{var i;return(i=d.message.metadata)==null?void 0:i.is_indepth_feedback}))return!0;if(u.messages.some(d=>d.message.author.role===w.Assistant)&&s++,s>=3)break}return!1})},bt=(e,r)=>c(()=>{const t=a.resolveThreadId(e);return a.getTree(t).getBranchFromLeaf(r).some(o=>o.message.author.role===w.User)}),Mt=e=>{const r=Pr(e);return C.useMemo(()=>{const t=a.getThreadConversationTurns(e,r,[]),n=(t==null?void 0:t.length)??0,s=(t==null?void 0:t[n-1])??null;return n===0?r:L.getRequestIdFromConversationTurn(s)},[r,e])},St=e=>c(()=>a.getTitle(e)),Lt=e=>Fe(c,()=>a.getTitleAndSource(e),J),Rt=e=>c(()=>{var t;const r=a.resolveThreadId(e);return(t=l().threads[r])==null?void 0:t.continuingFromSharedConversationId}),Ft=e=>c(()=>{var t,n;const r=a.resolveThreadId(e);return(n=(t=l().threads[r])==null?void 0:t.sharedConversationMetadata)==null?void 0:n.authorName}),Et=(e,r)=>c(()=>{const t=a.getTree(e).getNodeByIdOrMessageId(r);if(t==null)throw new Error(`useThreadTreeNode: cannot get tree node for ${r} in thread ${e}`);return t}),wt=(e,r)=>c(()=>{var t;return((t=a.getTree(e))==null?void 0:t.getHasErrorFromNode(r))??!1}),Nt=(e,r)=>c(()=>{var t;return((t=a.getTree(e))==null?void 0:t.isMessageIncomplete(r))??!1}),Ar=(e,r)=>c(()=>{const t=a.getTree(e);return t==null?[]:t.getBranchFromLeaf(r).filter(n=>n.message.author.role!==w.Root)}),kt=(e,r)=>Ar(e,r).map(t=>t.message),Ut=(e,r)=>c(()=>{const t=a.getTree(e);return t==null?null:t.getLeafFromNode(r)}),$t=(e,r)=>c(()=>{const t=a.getTree(e);return t==null?!1:r.map(s=>t.getLeafFromNode(s)).some(s=>t.getHasErrorFromNode(s.id))}),jr=e=>{var o,u;const t=a.getTree(e).getUserContext();if(t==null)return null;const{message:n}=t,s=((o=n.metadata)==null?void 0:o.shared_conversation_id)??null;if(((u=n.metadata)==null?void 0:u.user_context_message_data)!=null){const{about_user_message:d,about_model_message:i}=n.metadata.user_context_message_data;return{aboutUserMessage:(d==null?void 0:d.trim())??"",aboutModelMessage:(i==null?void 0:i.trim())??"",fallback:null,shareId:s}}return{aboutUserMessage:null,aboutModelMessage:null,fallback:Z(n),shareId:s}},qr=e=>c(r=>{var n,s;const t=a.resolveThreadId(e);return(s=(n=r.threads[t])==null?void 0:n.sharedConversationMetadata)==null?void 0:s.hasUserEditableContextFlag}),Dt=e=>!!a.getTree(e).findNode(t=>t.message.content.content_type==="model_editable_context"),Pt=e=>{const r=qr(e);return jr(e)!=null||!!r},At=e=>c(()=>{var t;const r=a.resolveThreadId(e);return((t=l().threads[r])==null?void 0:t.continuingFromSharedConversationId)!=null}),jt=e=>c(()=>a.getThreadCurrentLeafId(e)==="root"),qt=e=>{const r=Ee(),t=$r(e);return t?r.query.convId&&r.query.convId===t?!0:we(r.query.default)?r.query.default[0]==="c"&&r.query.default[1]===t:!1:!1},zt=e=>c(()=>{var t;const r=a.resolveThreadId(e);return(t=l().threads[r])==null?void 0:t.promptGptRating}),Ot=(e,r)=>c(()=>{const t=a.resolveThreadId(e),s=a.getTree(t).getBranchFromLeaf(r);return Er(s,o=>o.message.author.role===w.System&&o.message.content.content_type==="system_content")}),Bt=()=>C.useContext(Le)!=null;function Gt(e){var s;const r=a.getTree(e),t=a.getThreadCurrentLeafId(e);let n=r.getNodeByIdOrMessageId(t);for(;n;){const o=(s=n.message.metadata)==null?void 0:s.default_model_slug;if(o)return o;if(n.parentId)n=r.getNodeByIdOrMessageId(n.parentId);else return}}function Ht({clientThreadId:e,role:r}){return a.getTree(e).countMessagesByAuthor(r)}function Wt({clientThreadId:e,conversationLeafId:r}){const t=a.getTree(e);return C.useMemo(()=>t.getNodeByIdOrMessageId(r).message.end_turn,[r,t])}function Kt(e,r){const t=c(n=>g.getTurnContentReferences(e,n,r));return le(t)}export{Vr as $,ft as A,Yr as B,Pt as C,Dt as D,Et as E,c as F,tr as G,yt as H,Ir as I,vt as J,It as K,kt as L,Er as M,Ar as N,Lt as O,Ur as P,qt as Q,pt as R,st as S,a as T,nt as U,Xr as V,Hr as W,Wr as X,Kr as Y,tt as Z,sr as _,Pr as a,rt as a0,lr as a1,ot as a2,it as a3,lt as a4,cr as a5,Gt as a6,zt as a7,Wt as a8,wt as a9,Nt as aa,At as ab,Ut as ac,Ot as ad,xt as ae,Ct as af,$t as ag,St as ah,Ft as ai,mt as aj,ht as ak,bt as al,Rt as am,Ht as an,_t as b,jt as c,$r as d,Dr as e,gt as f,g,de as h,z as i,at as j,Qr as k,_ as l,k as m,et as n,Zr as o,ue as p,Jr as q,Tt as r,Bt as s,ct as t,Mt as u,ir as v,dt as w,Kt as x,ut as y,mr as z};
//# sourceMappingURL=iyldmwu8ywhos7ff.js.map
