import{aa as x,v as J,d9 as X,r as S,bU as Z,p as P,R as T,D as ee,ec as se,ed as ne,i as te,ee as re,ai as ae,ef as oe,j as e,c as C,T as m,F as ie,a4 as q,u as $,ax as ce,a as le,G as de,t as ue}from"./hc9xxm00a3r3byem.js";import{u as H}from"./btkpb7dih1nft29s.js";import{i as me,c6 as fe,c7 as xe,c8 as he,c9 as O,ca as ge,cb as Me,cc as pe,T as Q,cd as A,ce as je,cf as ve,cg as ye,ch as be,z as b,ci as W,cj as _e,ck as we}from"./ozzpumen10p6g0yq.js";import{I as Se}from"./iyldmwu8ywhos7ff.js";import{D as w}from"./i9qil017zb3p1czr.js";import{bd as Ce,a1 as Ee,w as Ne}from"./fga5qe14lr2llx8v.js";import{G as ke}from"./g8nlf109ai64grtj.js";import{m as Ue}from"./ovjwzbtdrcsgos3a.js";const Te=new Map;function ws(){const{gdriveLinkStatus:s,o365BusinessLinkStatus:r,o365PersonalLinkStatus:o}=H();return Y(s,r,o)}function Ss(){const{gdriveStatus:s,o365Status:r}=H();return Y(s,r,r)}const Oe=[x.GDRIVE,x.O365_PERSONAL,x.O365_BUSINESS];function Y(s,r,o){var j,_,d;const n=J(),i=n==null?void 0:n.getWorkspaceId(),{connectors:t,isLoading:l}=Re(Oe),{data:a,isLoading:c}=X(i),f=!i||((j=a==null?void 0:a.beta_settings)==null?void 0:j.context_connector_gdrive),y=!i||((_=a==null?void 0:a.beta_settings)==null?void 0:_.context_connector_o365_personal),M=!i||((d=a==null?void 0:a.beta_settings)==null?void 0:d.context_connector_o365_business),u=t.get(x.GDRIVE),h=t.get(x.O365_PERSONAL),p=t.get(x.O365_BUSINESS),v=(E,N)=>E==="true"||E==="ifConnected"&&N;return{connectorConfig:S.useMemo(()=>{const E=!!(u!=null&&u.access_token),N=v(s,E),I=!!((h==null?void 0:h.access_token)??(p==null?void 0:p.access_token)),K=v(r,I),V=v(o,I),z=[N&&u&&f?[x.GDRIVE,u]:null,V&&h&&y?[x.O365_PERSONAL,h]:null,K&&p&&M?[x.O365_BUSINESS,p]:null];return new Map(me(z))},[u,s,h,p,r,o,f,y,M]),isLoading:l||c}}function Re(s){const[r,o]=S.useState(Te),{isUnauthenticated:n}=Z(),{isSuccess:i,data:t,isLoading:l}=P({queryKey:["fetchConnectorData",s],queryFn:Le,refetchInterval:30*60*1e3,enabled:!n});return S.useEffect(()=>{i&&o(new Map(t.map(a=>[a.type,a])))},[i,t]),{connectors:r,isLoading:l}}async function Le({queryKey:s}){const[r,o]=s;let n=null;try{n=await T.checkConnectorAPI(o)}catch(t){ee.addError(new Error("Error while retrieving context connector entry",{cause:t}))}return n?n.connectors.map(t=>{var l;if(!t.access_token)return t;if(t.type===x.O365_PERSONAL)t.onedrive_endpoint_hint={type:"personal",baseUrl:"https://onedrive.live.com",parsedUrl:"https://onedrive.live.com/picker"};else if(t.type===x.O365_BUSINESS){const a=(l=t.onedrive_business_metadata)==null?void 0:l.base_url;if(a){const c=new URL(a);t.onedrive_endpoint_hint={type:"business",baseUrl:a,parsedUrl:`https://${c.hostname}/_layouts/15/FilePicker.aspx`}}}return t}):[]}var Ie=fe;function Ae(s,r,o){var n=s.length;return o=o===void 0?n:o,!r&&o>=n?s:Ie(s,r,o)}var De=Ae,Ge=xe,Be=ne,D=se,G=D&&D.isRegExp,Fe=G?Be(G):Ge,Pe=Fe,qe=he,$e=O,He=ge;function Qe(s){return $e(s)?He(s):qe(s)}var We=Qe,Ye=Me,Ke=O,Ve=pe;function ze(s){return Ke(s)?Ve(s):Ye(s)}var Je=ze,B=re,Xe=De,Ze=O,es=ae,ss=Pe,ns=We,ts=Je,rs=Se,F=oe,as=30,os="...",is=/\w*$/;function cs(s,r){var o=as,n=os;if(es(r)){var i="separator"in r?r.separator:i;o="length"in r?rs(r.length):o,n="omission"in r?B(r.omission):n}s=F(s);var t=s.length;if(Ze(s)){var l=ts(s);t=l.length}if(o>=t)return s;var a=o-ns(n);if(a<1)return n;var c=l?Xe(l,0,a).join(""):s.slice(0,a);if(i===void 0)return c+n;if(l&&(a+=c.length-a),ss(i)){if(s.slice(a).search(i)){var f,y=c;for(i.global||(i=RegExp(i.source,F(is.exec(i))+"g")),i.lastIndex=0;f=i.exec(y);)var M=f.index;c=c.slice(0,M===void 0?a:M)}}else if(s.indexOf(B(i),a)!=a){var u=c.lastIndexOf(i);u>-1&&(c=c.slice(0,u))}return c+n}var ls=cs;const ds=te(ls),us=91,R=100;function U(s){return s<R?"bg-[#fcf6e0] text-yellow-500 dark:bg-yellow-600 dark:text-yellow-100":"bg-orange-100 text-[#f48c15] dark:bg-orange-800 dark:text-orange-100"}function L(s){return je()&&s!=null&&s>=us}function ms({memoryFullPct:s,className:r,children:o}){return L(s)?e.jsx("div",{className:C("rounded-lg border border-token-border-light p-1 text-sm",r),children:e.jsxs(Ue.div,{className:C("flex items-center overflow-hidden whitespace-nowrap rounded px-2 py-1.5",U(s)),initial:{width:0},animate:{width:`${s}%`},transition:{duration:.5},children:[e.jsx(m,{id:"6D2etG",defaultMessage:"{memoryFullPct}% full",values:{memoryFullPct:s}}),o]})}):null}function Cs({memoryFullPct:s}){return L(s)?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:C("relative -mr-1 h-2 w-2 rotate-45 transform border-white/10",U(s))}),e.jsxs("div",{className:C("flex items-center rounded-lg px-3 py-1.5",U(s)),children:[e.jsx(m,{id:"x7M6HK",defaultMessage:"{memoryFullPct}%",values:{memoryFullPct:s}}),e.jsx(Q,{label:s<R?e.jsx(m,{id:"VXohcH",defaultMessage:"Memory is almost full. Once memory is full, new memories won’t be created. You can forget existing memories to make space."}):e.jsx(m,{id:"pQ9dnt",defaultMessage:"Memory is full. New memories won’t be created. You can forget existing memories to make space."}),children:e.jsx(Ce,{className:"icon-sm ml-1 text-token-text-secondary"})})]})]}):null}function fs({memoryFullPct:s,className:r}){return L(s)?e.jsxs("div",{className:C("flex flex-col gap-2",r),children:[e.jsx(ms,{memoryFullPct:s}),e.jsx("div",{className:"pl-3 text-sm text-token-text-secondary",children:s<R?e.jsx(m,{id:"z3LYM2",defaultMessage:"<strong>Memory almost full</strong>. Once memory is full, new memories won’t be created. You can forget existing memories to make space. <a>Learn more</a>.",values:{strong:n=>e.jsx("strong",{children:n}),a:n=>e.jsx("a",{href:A,target:"_blank",rel:"noopener noreferrer",className:"underline",children:n})}}):e.jsx(m,{id:"6rc4Jv",defaultMessage:"<strong>Memory is full</strong>. New memories won’t be created. You can forget existing memories to make space. <a>Learn more</a>.",values:{strong:n=>e.jsx("strong",{children:n}),a:n=>e.jsx("a",{href:A,target:"_blank",rel:"noopener noreferrer",className:"underline",children:n})}})})]}):null}function xs({gizmo:s,memory:r}){const o=q(),n=$(),{mutate:i,isPending:t}=le({mutationFn:f=>T.deleteMemory(f,s==null?void 0:s.id),onSettled:()=>{n.invalidateQueries({queryKey:W(s==null?void 0:s.id)})},onError:()=>{ue.danger(o.formatMessage({id:"MemoriesModal.deleteFailed",defaultMessage:"Failed to forget memory"}),{id:"memoryDeleteFailed"})}}),[l,a]=S.useState(!1),c=o.formatMessage({id:"z2CNgB",defaultMessage:"Forget"});return e.jsxs(e.Fragment,{children:[e.jsxs(b.Row,{disabled:t,children:[e.jsx(b.Cell,{children:e.jsx("div",{className:"whitespace-pre-wrap py-2",children:r.content})}),e.jsx(b.Cell,{textAlign:"right",children:e.jsx(b.Actions,{children:e.jsx("button",{onClick:()=>a(!0),"aria-label":c,className:"text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(Q,{className:"leading-none",label:c,sideOffset:4,side:"top",children:e.jsx(Ee,{className:"icon-sm"})})})})})]}),l&&e.jsx(we,{isOpen:!0,primaryButtonColor:"danger",title:c,confirmText:o.formatMessage({id:"fCn0ar",defaultMessage:"Forget"}),onConfirm:()=>{i(r.id),a(!1)},onClose:()=>{a(!1)},children:e.jsx(m,{id:"pZ/TCe",defaultMessage:'{name} will forget "{title}". This cannot be undone. <link>Learn more</link>',values:{name:(s==null?void 0:s.name)??"ChatGPT",title:e.jsx("strong",{children:ds(r.content,{length:130,omission:"..."})}),link:f=>e.jsx("a",{href:"https://help.openai.com/en/articles/8590148-memory-faq#h_41527f643d",target:"_blank",className:"underline",rel:"noreferrer",children:f})}})})]})}function hs({selectedGizmoId:s,onSelect:r,items:o}){const n=o.find(t=>t.id===s);function i(t){return e.jsx(ke,{isFirstParty:t.id===void 0,src:t.iconUrl??null,className:"icon-md"})}return e.jsx("div",{className:"mb-2 inline-flex rounded-md border border-token-border-medium",children:e.jsxs(w.Root,{children:[e.jsx(w.Trigger,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[n?e.jsxs(e.Fragment,{children:[i(n),e.jsx("span",{className:"text-token-text-primary",children:n==null?void 0:n.name})]}):e.jsx(m,{id:"MemoriesModal.unknownGizmo",defaultMessage:"Unknown GPT"}),e.jsx(Ne,{className:"icon-sm text-token-text-tertiary"})]})}),e.jsx(w.Portal,{children:e.jsx(w.Content,{children:o.map(t=>e.jsxs(w.Item,{className:"flex items-center gap-3",onClick:()=>{r(t.id)},children:[i(t),t.name]},t.id))})})]})})}const k=ie.div`flex h-full items-center justify-center pb-8 text-sm text-token-text-tertiary rounded-lg border border-token-border-light`;function Es({onClose:s,initialGizmoId:r}){var _;const o=q(),n=$(),i=ve(),[t,l]=S.useState(r),a=ye(),{data:c,isLoading:f,isError:y,refetch:M}=be(t,!0,i),u=c==null?void 0:c.memories,{data:h,refetch:p}=P({queryKey:["memory_gizmos"],queryFn:()=>T.getGizmosWithMemory(),refetchOnMount:"always"}),v=[{id:void 0,name:"ChatGPT",iconUrl:null},...((_=h==null?void 0:h.items)==null?void 0:_.map(({gizmo:d})=>({id:d.id,name:d.display.name,iconUrl:d.display.profile_picture_url})))??[]],g=v.find(d=>d.id===t);let j;return f?j=e.jsx(k,{children:e.jsx(m,{id:"MemoriesModal.loading",defaultMessage:"Loading..."})}):y?j=e.jsx(k,{children:e.jsxs("div",{className:"max-w-sm text-center",children:[e.jsx("div",{className:"mb-4 text-red-500",children:e.jsx(m,{id:"MemoriesModal.somethingWentWrong",defaultMessage:"Something went wrong..."})}),e.jsx("div",{children:e.jsx(de,{color:"secondary",onClick:()=>{M()},children:e.jsx(m,{id:"MemoriesModal.retry",defaultMessage:"Retry"})})})]})}):!u||u.length===0?j=e.jsx(k,{children:e.jsx("div",{className:"max-w-sm text-center",children:i?e.jsx(m,{id:"MemoriesModal.noMemories.1",defaultMessage:"As you chat with {name}, the details and preferences it remembers will be shown here.",values:{name:(g==null?void 0:g.name)??"ChatGPT"}}):e.jsx(m,{id:"MemoriesModal.noMemoriesAndDisabled",defaultMessage:"Memory is disabled. ChatGPT won't use or create memories."})})}):j=e.jsx(b.Root,{className:"h-full",size:"compact",bordered:!0,children:e.jsx(b.Body,{children:u.map(d=>e.jsx(xs,{gizmo:g?{id:g.id,name:g.name}:void 0,memory:d},d.id))})}),e.jsxs(ce,{isOpen:!0,onClose:s,size:"custom",className:"max-w-5xl",type:"success",title:o.formatMessage({id:"MemoriesModal.title",defaultMessage:"Memory"}),showCloseButton:!0,children:[a&&v.length>1&&e.jsx("div",{className:"mb-4",children:e.jsx(hs,{selectedGizmoId:t,items:v,onSelect:d=>{n.invalidateQueries({queryKey:W(d)}),l(d)}})}),e.jsx(fs,{memoryFullPct:c==null?void 0:c.memoryFullPct,className:"mb-5"}),e.jsx("div",{className:"h-[24rem]",children:j}),e.jsx("div",{className:"mt-5 flex justify-end",children:e.jsx(_e,{onReset:()=>{M(),p(),t&&l(void 0)},gizmoId:t,memoryName:(g==null?void 0:g.name)??"ChatGPT"})})]})}export{Cs as M,Ss as a,Es as b,ws as c,Re as u};
//# sourceMappingURL=os9q9b6j79v07zj6.js.map
