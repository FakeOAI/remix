const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/iv4ixuukcg9wgx9n.js","assets/hc9xxm00a3r3byem.js","assets/fga5qe14lr2llx8v.js","assets/root-gxieg4k5.css","assets/gr8wto7g581ivnj9.js"])))=>i.map(i=>d[i]);
import{r as x,p as F,dd as O,aj as H,ak as L,F as P,j as e,ax as U,G as A,H as B,c as q}from"./hc9xxm00a3r3byem.js";import{C as J}from"./ejr5bx585q00u2xr.js";import{V as G}from"./fga5qe14lr2llx8v.js";import{D as Q}from"./qknnp5ml7bnljg47.js";import{u as K,a as W,U as M,b as X}from"./eaz86xbejavxr5kl.js";import{j as I,k as Y}from"./iyldmwu8ywhos7ff.js";import{k as Z,bb as ee}from"./ozzpumen10p6g0yq.js";import{$ as se,a as te,b as j,c as v}from"./k0a5tmklve7lhdwt.js";function z({threadId:s,threadUserId:a,refetchOnMount:t}){return F({queryKey:["thread",s,a],queryFn:async()=>{if(!s)return{thread:null,turns:null};const l=await Y({threadId:s,threadUserId:a}),o=l.turns;return{thread:l,turns:o}},enabled:!!s,refetchOnMount:t})}function ge({threadId:s,threadUserId:a}){var o,r;const t=z({threadId:s,threadUserId:a}),l=t.data;return x.useEffect(()=>{s&&I.setThread(s,(l==null?void 0:l.turns)??[])},[s,l]),{query:(r=(o=t.data)==null?void 0:o.turns[0])==null?void 0:r.user_query,refetch:t.refetch,isLoading:t.isLoading,isError:t.isError}}function ne(s){return O({tag:"svg",attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{d:"M9 9H4v1h5V9z"}},{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M5 3l1-1h7l1 1v7l-1 1h-2v2l-1 1H3l-1-1V6l1-1h2V3zm1 2h4l1 1v4h2V3H6v2zm4 1H3v7h7V6z"}}]})(s)}function ae(s){return O({tag:"svg",attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{d:"M9 9H4v1h5V9z"}},{tag:"path",attr:{d:"M7 12V7H6v5h1z"}},{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M5 3l1-1h7l1 1v7l-1 1h-2v2l-1 1H3l-1-1V6l1-1h2V3zm1 2h4l1 1v4h2V3H6v2zm4 1H3v7h7V6z"}}]})(s)}const le=H(()=>L(()=>import("./iv4ixuukcg9wgx9n.js"),__vite__mapDeps([0,1,2,3,4])).then(s=>s.default),{ssr:!1});function re({threadId:s,threadUserId:a}){return K(W.isDebugModalOpen)&&e.jsx(U,{isOpen:!0,onClose:()=>M.toggleDebugModalOpen(),type:"success",size:"fullscreen",noPadding:!0,rootClassName:"z-50",children:e.jsx(R,{threadId:s,threadUserId:a,onClose:()=>M.toggleDebugModalOpen()})})}const oe=(s,a)=>{const t=JSON.stringify(a,null,2),l=new Blob([t],{type:"application/json"}),o=window.URL.createObjectURL(l),r=document.createElement("a");r.href=o,r.download=s,r.click(),window.URL.revokeObjectURL(o)},V="<|im_start|>",T="<|im_sep|>",D="<|im_end|>",ce="<|fim_suffix|>";function ie({prompt:s}){const a=[];let t=0;for(;;){const l=s.indexOf(V,t);if(l===-1)break;const o=s.indexOf(T,l);if(o===-1)break;let r=s.indexOf(D,o);const d=s.indexOf(ce,o);if(d!==-1&&(r===-1||d<r)&&(r=d),r===-1)break;const f=s.substring(l+V.length,o),b=s.substring(o+T.length,r);a.push(e.jsxs("div",{children:[e.jsxs("span",{className:"font-semibold",children:["[",f,"]"]})," ",b]},l)),t=r+D.length}return a}const g=P.div`mb-[-5px] px-2 pb-1 font-semibold uppercase border-b-2 ${({$isSelected:s})=>s?"border-black dark:border-white":"border-transparent"}`;function R({threadId:s,threadUserId:a,message:t,onClose:l}){var C,N,S;const{sessionUser:o}=X(),[r,d]=x.useState(t?"message":"json"),{data:f,isLoading:b,refetch:E}=z({threadId:s,threadUserId:a,refetchOnMount:"always"}),n=f==null?void 0:f.thread;if(x.useEffect(()=>{d(t?"message":n!=null&&n.turns.length?`turn${(n==null?void 0:n.turns.length)-1}`:"thread")},[n==null?void 0:n.turns.length,t]),!b&&!n&&!t)return e.jsxs(Q,{onClickRetry:()=>E(),children:["Failed to load."," "]});if(b)return e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:"Loading..."});const u=n==null?void 0:n.turns,y=(S=(N=(C=n==null?void 0:n.turns[n.turns.length-1])==null?void 0:C.artifacts__)==null?void 0:N.model_snapshots)==null?void 0:S.default_id,k=a&&s?ee(a,s):null;return e.jsx("div",{className:"flex flex-col gap-2 break-words font-mono text-xs",children:e.jsxs(se,{orientation:"vertical",value:r,onValueChange:i=>d(i),children:[e.jsxs(te,{className:"flex items-center justify-center gap-2 px-4 py-1",children:[t&&e.jsx(j,{value:"message",children:e.jsx(g,{$isSelected:r==="message",children:"Message"})},"message"),n&&e.jsx(j,{value:"thread",children:e.jsx(g,{$isSelected:r==="thread",children:"Thread"})},"thread"),u==null?void 0:u.map((i,c)=>{var h,m;return e.jsxs(x.Fragment,{children:[e.jsx(j,{value:`turn${c}`,children:e.jsxs(g,{$isSelected:r===`turn${c}`,children:["Turn[",c,"]"]})},c),(m=(h=i.artifacts__)==null?void 0:h.debug_ddtrace_urls)==null?void 0:m.map(p=>e.jsx(g,{$isSelected:!1,children:e.jsxs("a",{target:"_blank",href:p,className:"text-nowrap",children:["Trace[",c,"] â†—"]})},p))]},c)}),e.jsx("div",{className:"flex-grow"}),y&&e.jsxs(e.Fragment,{children:[e.jsx(_,{name:"Model",id:y})," ",e.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx(_,{name:"User ID",id:o.id})," ",e.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),k&&e.jsxs(e.Fragment,{children:[e.jsx(_,{name:"Permalink",id:k}),e.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),n&&e.jsxs(A,{size:"small",color:"secondary",onClick:()=>oe("thread.json",n),children:[e.jsx(G,{className:"icon-sm"})," thread.json"]}),e.jsx(B,{onClick:l})]}),u==null?void 0:u.map((i,c)=>{var h,m,p,$;return e.jsxs(v,{value:`turn${c}`,className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth",children:[e.jsxs("div",{className:q("flex flex-col gap-1 p-6",i.index%2===0&&"bg-token-main-surface-tertiary"),children:[e.jsx(ie,{prompt:((p=(m=(h=i.artifacts__)==null?void 0:h.debug_info)==null?void 0:m.main_model_response)==null?void 0:p.prompt_string)??""}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"[assistant]"})," ",($=i.model_response)==null?void 0:$.text]})]})," "]},c)}),n&&e.jsx(v,{value:"thread",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-6",children:e.jsx(w,{data:n,collapsed:4})}),t&&e.jsx(v,{value:"message",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-6",children:e.jsx(w,{data:t,collapsed:4})})]},(n==null?void 0:n.turns.length)??"message")})}function w({data:s,collapsed:a}){const[t,l]=x.useState(a??!0);return e.jsxs("div",{className:"flex flex-col items-start gap-1",children:[e.jsx("button",{onClick:()=>l(!t),className:"flex items-center gap-1",children:t?e.jsxs(e.Fragment,{children:[e.jsx(ae,{size:14})," Expand all"]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{size:14})," Collapse all"]})}),e.jsx("div",{className:"w-full",children:e.jsx(le,{json:s,jsonViewProps:{collapsed:t,shortenTextAfterLength:0}},String(t))})]})}function _({name:s,id:a}){const t=x.useCallback(()=>{Z(a)},[a]);return e.jsxs("div",{className:"flex items-center gap-2 truncate",children:[e.jsxs("span",{className:"text-nowrap font-semibold",children:[s,":"]}),e.jsx("span",{title:a,className:"truncate text-gray-500 dark:text-white",children:a}),e.jsx(J,{onCopy:t})]})}const je=Object.freeze(Object.defineProperty({__proto__:null,DebugJsonViewer:w,DebugModal:re,DebugModalContents:R},Symbol.toStringTag,{value:"Module"}));export{w as D,re as a,je as b,ge as u};
//# sourceMappingURL=hgnflhls3cvgkj18.js.map
